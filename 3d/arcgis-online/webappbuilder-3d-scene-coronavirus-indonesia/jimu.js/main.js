// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./portalUtils esri/config esri/tasks/GeometryService".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t){function u(a,d){var c=b.clone(a),e=l.widgetProperties;"undefined"===typeof d&&(d=!1);delete c.mode;l.visitElement(c,function(a,f){a.widgets?(delete a.isOnScreen,
delete a.gid,"jimu.js/images/group_icon.png"===a.icon&&delete a.icon,delete a.openType,f.isOnScreen&&a.panel&&l.isEqual(a.panel,c.widgetOnScreen.panel)&&delete a.panel):(a.icon&&a.icon===a.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete a.icon,delete a.panel,delete a.folderUrl,delete a.amdFolder,delete a.thumbnail,delete a.configFile,delete a.gid,delete a.isOnScreen,e.forEach(function(c){delete a[c]}),d?("undefined"===typeof a.openAtStart&&(a.openAtStart=!1),a.config||delete a.config):
(a.visible&&delete a.visible,a.manifest&&a.label===a.manifest.label&&delete a.label,a.isDefaultConfig&&(delete a.config,delete a.isDefaultConfig)),delete a.manifest)});delete c.rawAppConfig;delete c._ssl;delete c.getConfigElementById;delete c.getConfigElementsByName;delete c.getConfigElementByLabel;delete c.processNoUriWidgets;delete c.addElementId;delete c.getCleanConfig;delete c.visitElement;delete c.agolConfig;delete c._itemData;delete c.oldWabVersion;return c}var r=null,x;x=n(null,{urlParams:null,
appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(c){this.urlParams=c||{};this.listenBuilderEvents();this.versionManager=new d;this.widgetManager=h.getInstance();this.configLoader=a.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&b.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(g);"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&
b.isFunction(window.parent.setPreviewViewerTopic)&&window.parent.setPreviewViewerTopic(g);f(window,"resize",b.hitch(this,this._onWindowResize))},listenBuilderEvents:function(){g.subscribe("builder/widgetChanged",b.hitch(this,this._onWidgetChanged));g.subscribe("builder/groupChanged",b.hitch(this,this._onGroupChanged));g.subscribe("builder/widgetPoolChanged",b.hitch(this,this._onWidgetPoolChanged));g.subscribe("builder/openAtStartChange",b.hitch(this,this._onOpenAtStartChanged));g.subscribe("builder/onScreenOrderChanged",
b.hitch(this,this._onScreenOrderChanged));g.subscribe("builder/layoutDefinitionChanged",b.hitch(this,this._onLayoutDefinitionChanged));g.subscribe("builder/sceneViewChanged",b.hitch(this,this._onSceneViewChanged));g.subscribe("builder/mapOptionsChanged",b.hitch(this,this._onMapOptionsChanged));g.subscribe("builder/appAttributeChanged",b.hitch(this,this._onAppAttributeChanged));g.subscribe("builder/setAppConfig",b.hitch(this,this._onAppConfigSet));g.subscribe("builder/themeChanged",b.hitch(this,this._onThemeChanged));
g.subscribe("builder/layoutChanged",b.hitch(this,this._onLayoutChanged));g.subscribe("builder/styleChanged",b.hitch(this,this._onStyleChanged));g.subscribe("builder/syncExtent",b.hitch(this,this._onSyncExtent));g.subscribe("builder/loadingPageChanged",b.hitch(this,this._onLoadingPageChanged));g.subscribe("builder/templateConfigChanged",b.hitch(this,this._onTemplateConfigChanged));g.subscribe("builder/sharedThemeChanged",b.hitch(this,this._onSharedThemeChanged))},loadConfig:function(){if("preview"!==
this.urlParams.mode&&"config"!==this.urlParams.mode)return this.configLoader.loadConfig().then(b.hitch(this,function(a){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(a);window.appInfo.isRunInMobile=this._isRunInMobile();console.timeEnd("Load Config");a=this.getAppConfig();g.publish("appConfigLoaded",a);return a}),b.hitch(this,function(a){console.error(a);a&&a.message&&"string"===typeof a.message&&this._showErrorMessage(a.message)}))},_showErrorMessage:function(a){k.create("div",
{"class":"app-error",innerHTML:l.sanitizeHTML("Unable to create map: "+a)},document.body)},getAppConfig:function(){var a;window.appInfo.isRunInMobile?(a=b.clone(this._getMobileConfig(this.appConfig)),a._originConfig=b.clone(this.appConfig)):a=b.clone(this.appConfig);a.getConfigElementById=function(a){return l.getConfigElementById(this,a)};a.getConfigElementByLabel=function(a){return l.getConfigElementByLabel(this,a)};a.getConfigElementsByName=function(a){return l.getConfigElementsByName(this,a)};
a.getCleanConfig=function(a){return this._originConfig?u(this._originConfig,a):u(this,a)};a.visitElement=function(a){l.visitElement(this,a)};return a},_onWindowResize:function(){var a=this._isRunInMobile();window.appInfo.isRunInMobile!==a&&(window.appInfo.isRunInMobile=a,this.appConfig&&g.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_isRunInMobile:function(){var a=k.getMarginBox(window.jimuConfig.layoutId);if(a.w<=window.jimuConfig.breakPoints[0]||a.h<=window.jimuConfig.breakPoints[0])return k.addClass(window.jimuConfig.layoutId,
"jimu-ismobile"),!0;k.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1},_getMobileConfig:function(a){return l.mixinAppConfigPosition(a,a.mobileLayout)},_onWidgetChanged:function(a){var c=l.reCreateObject(a);a=l.getConfigElementById(this.appConfig,a.id);!1!==c.inPanel||a.uri||(c.closeable=!0);for(var d in c)a[d]=c[d];delete a.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"widgetChange",
c)},_onGroupChanged:function(a){var c=l.reCreateObject(a);a=l.getConfigElementById(this.appConfig,a.id);for(var d in c)a[d]=c[d];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"groupChange",c)},_onWidgetPoolChanged:function(a){a=l.reCreateObject(a);if(1===this.widgetManager.getControllerWidgets().length)this.appConfig.widgetPool.widgets=a.widgets,this.appConfig.widgetPool.groups=a.groups;else{var c=l.getConfigElementById(this.appConfig,
a.controllerId);m.forEach(c.controlledWidgets,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,a)},this);m.forEach(c.controlledGroups,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,a)},this);this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?a.widgets:this.appConfig.widgetPool.widgets.concat(a.widgets);this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?a.groups:this.appConfig.widgetPool.groups.concat(a.groups);
this.configLoader.addNeedValues(this.appConfig);c.controlledWidgets=m.map(a.widgets,function(a){return a.id});c.controlledGroups=m.map(a.groups,function(a){return a.id})}this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",a)},_removeWidgetOrGroupFromPoolById:function(a,c){m.some(a.widgetPool.widgets,function(d,e){if(d.id===c)return a.widgetPool.widgets.splice(e,1),!0});m.some(a.widgetPool.groups,
function(d,e){if(d.id===c)return a.widgetPool.groups.splice(e,1),!0})},_onOpenAtStartChanged:function(a){var c=l.reCreateObject(a),d=this.appConfig;a.isOnScreen?(d=d.widgetOnScreen&&d.widgetOnScreen.widgets)&&0<d.length&&m.forEach(d,b.hitch(this,function(c){c.id===a.id?c.openAtStart=!c.openAtStart:delete c.openAtStart})):((d=d.widgetPool)&&d.groups&&0<d.groups.length&&m.forEach(d.groups,b.hitch(this,function(c){c.id===a.id?c.openAtStart=!c.openAtStart:delete c.openAtStart})),d&&d.widgets&&0<d.widgets.length&&
m.forEach(d.widgets,b.hitch(this,function(c){c.id===a.id?c.openAtStart=!c.openAtStart:delete c.openAtStart})));g.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",c)},_onScreenOrderChanged:function(a){var c=l.reCreateObject(a);m.forEach(this.appConfig.widgetOnScreen.widgets,function(a){a.isController||(!1!==a.inPanel||!0!==a.closeable)&&!0!==a.inPanel&&a.uri||m.some(c,function(c){if(a.id===c.id)return a.position=c.position,!0})},this);g.publish("appConfigChanged",this.getAppConfig(),
"onScreenOrderChange",c)},_onAppAttributeChanged:function(a){a=l.reCreateObject(a);b.mixin(this.appConfig,a);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"attributeChange",a)},_onLoadingPageChanged:function(a){a=l.reCreateObject(a);var c;"backgroundColor"in a?this.appConfig.loadingPage.backgroundColor=a.backgroundColor:"backgroundImage"in a?(c=this.appConfig.loadingPage.backgroundImage||
{},this.appConfig.loadingPage.backgroundImage=b.mixin(c,a.backgroundImage)):"loadingGif"in a&&(c=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=b.mixin(c,a.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",a)},_onTemplateConfigChanged:function(a){a=l.reCreateObject(a);this.appConfig.templateConfig=a;this.configLoader.addNeedValues(this.appConfig);
this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",a)},_onLayoutDefinitionChanged:function(a){a=l.reCreateObject(a);l.isEqual(this.appConfig.layoutDefinition,a.layoutDefinition)||(this.appConfig.layoutDefinition=a.layoutDefinition,this.appConfig.widgetOnScreen.groups=l.handleGridLayoutOnScreenGroupChange(this.appConfig.widgetOnScreen.groups,a.groupIds),this.configLoader.addNeedValues(this.appConfig),this._addDefaultValues(this.appConfig),
g.publish("appConfigChanged",this.getAppConfig(),"layoutDefinitionChange",a.layoutDefinition))},_onSceneViewChanged:function(a){a=l.reCreateObject(a);a.itemId&&a.itemId!==this.appConfig.map.itemId&&this.appConfig.map.mapOptions&&l.deleteMapOptions(this.appConfig.map.mapOptions);b.mixin(this.appConfig.map,a);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"mapChange",a)},_onMapOptionsChanged:function(a){a=l.reCreateObject(a);
this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});b.mixin(this.appConfig.map.mapOptions,a);g.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",a)},_onThemeChanged:function(a){this._getAppConfigFromTheme(a).then(b.hitch(this,function(c){this.appConfig=c;g.publish("appConfigChanged",this.getAppConfig(),"themeChange",a.getName())}))},_onLayoutChanged:function(a){this.appConfig=l.mixinAppConfigPosition(this.appConfig,a.layoutConfig);this.appConfig.layoutDefinition=a.layoutConfig.layoutDefinition;
this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);this._addDefaultPanelAndPosition(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"layoutChange",a.name)},_onStyleChanged:function(a){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,a.name);a.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:a.styleColor}:(delete this.appConfig.theme.customStyles,delete this.appConfig.titleColor,this.appConfig.theme.sharedTheme=
{isPortalSupport:this.appConfig.theme.sharedTheme.isPortalSupport,useHeader:!1,useLogo:!1});g.publish("appConfigChanged",this.getAppConfig(),"styleChange",a.name)},_onSharedThemeChanged:function(a){var c=this.appConfig.theme.sharedTheme;a=l.reCreateObject(a);a.useHeader&&!c.useHeader&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},this.appConfig.titleColor=
this.portalSelf.portalProperties.sharedTheme.header.text,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor})):console.error("Portal does not support sharedTheme."));!a.useHeader&&c.useHeader&&(delete this.appConfig.titleColor,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor}));a.useLogo&&!c.useLogo&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:
"images/app-logo.png",this.appConfig.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link,this._onAppAttributeChanged({logo:this.appConfig.logo,logoLink:this.appConfig.logoLink})):console.error("Portal does not support sharedTheme."));!a.useLogo&&c.useLogo&&this._onAppAttributeChanged({logo:this.appConfig.logo});b.mixin(c,a);g.publish("appConfigChanged",this.getAppConfig(),"sharedThemeChange",a)},_onSyncExtent:function(a){g.publish("syncExtent",a)},_genStyles:function(a,c){var d=[];d.push(c);
m.forEach(a,function(a){0>d.indexOf(a)&&d.push(a)});return d},_getAppConfigFromTheme:function(a){var c=new e,d,l=[],f=this.getAppConfig().getCleanConfig();f.mode=this.urlParams.mode;m.forEach(f.widgetPool.groups,function(a){delete a.panel},this);if(a.appConfig)d=b.clone(a.appConfig),d.map=f.map,d.map.position=a.appConfig.map.position,this._copyPoolToThemePool(f,d),d.links=f.links,d.title=f.title,d.subtitle=f.subtitle,d.logo=f.logo;else{var h=a.getCurrentLayout(),l=a.getCurrentStyle();d=b.clone(f);
h=b.clone(h.layoutConfig);d.widgetOnScreen=h.widgetOnScreen;h.widgetPool&&(m.forEach(h.widgetPool.widgets,function(a){a.isPreconfiguredInTheme=!0}),m.forEach(h.widgetPool.groups,function(a){a.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(f,h);d.widgetPool=h.widgetPool;h.map&&h.map.position&&(d.map.position=h.map.position);d.mobileLayout=h.mobileLayout;d.layoutDefinition=h.layoutDefinition;l=this._genStyles(m.map(a.getStyles(),function(a){return a.name}),l.name);d.theme={name:a.getName(),
styles:l,version:a.getVersion()};this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(d.theme.sharedTheme={useHeader:!0,useLogo:!0,isPortalSupport:!0},d.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background}):(d.theme.sharedTheme={useHeader:!1,useLogo:!1,isPortalSupport:!1},d.theme.customStyles={mainBackgroundColor:""});d.titleColor=f.titleColor;d.logoLink=f.logoLink}this.configLoader.addNeedValues(d);this.configLoader.loadWidgetsManifest(d).then(b.hitch(this,
function(){this._addDefaultValues(d);c.resolve(d)}));return c},_copyPoolToThemePool:function(a,c){var d=a.widgetPool;c.widgetPool||(c.widgetPool={});a=c.widgetPool;var e=m.filter(a.widgets,function(a){if(a.isPreconfiguredInTheme||!m.some(d.widgets,function(c){return c.name===a.name}))return!0}),l=m.filter(a.groups,function(a){return a.isPreconfiguredInTheme}),f=m.filter(d.widgets,function(a){return!a.isPreconfiguredInTheme}),h=m.filter(d.groups,function(a){return!a.isPreconfiguredInTheme}),f=this._getPoolWidgetsWithoutDuplicated(f,
c.widgetOnScreen.widgets||[]);a.widgets=f.concat(e);a.groups=h.concat(l)},_getPoolWidgetsWithoutDuplicated:function(a,c){for(var d=b.clone(a),e=this.getAppConfig(),f=a.length-1;0<=f;f--)for(var h=c.length-1;0<=h;h--)if(c[h].uri){var r=c[h].name;r||(r=l.getWidgetNameFromUri(c[h].uri));var p=e.getConfigElementById(a[f].id);a[f]&&a[f].name===r&&!1===p.supportMultiInstance&&(console.log("Widget",a[f].name,"is not copied to new theme because this widget exists in new theme."),d.splice(f,1))}return d},
_onAppConfigSet:function(a){a=l.reCreateObject(a);window.appInfo.isRunInMobile=this._isRunInMobile();this.configLoader.processProxy(a);this.configLoader.addNeedValues(a);this._addDefaultValues(a);c.setPortalUrl(a.portalUrl);this.appConfig?(a.map.itemId&&a.map.itemId!==this.appConfig.map.itemId&&l.deleteMapOptions(a.map.mapOptions),this.appConfig=a,g.publish("appConfigChanged",this.getAppConfig(),"resetConfig",a)):(this.appConfig=a,q.getPortal(a.portalUrl).loadSelfInfo().then(b.hitch(this,function(a){this.portalSelf=
a;g.publish("appConfigLoaded",this.getAppConfig())})))},_addDefaultValues:function(a){this._addDefaultPortalUrl(a);this._addDefaultGeometryService(a);this._addDefaultStyle(a);this._addDefaultMap(a);this._addDefaultVisible(a);this._addDefaultSharedTheme(a);"undefined"===typeof a.widgetOnScreen&&(a.widgetOnScreen={});"undefined"===typeof a.widgetPool&&(a.widgetPool={});this._addDefaultPanelAndPosition(a);this._addDefaultOfWidgetGroup(a);(a.widgetPool.widgets&&0<a.widgetPool.widgets.length&&void 0===
a.widgetPool.widgets[0].index||a.widgetPool.groups&&0<a.widgetPool.groups.length&&void 0===a.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(a);return a},_addDefaultPortalUrl:function(a){"undefined"===typeof a.portalUrl&&(a.portalUrl="http://www.arcgis.com/");a.portalUrl&&"/"!==a.portalUrl.substr(a.portalUrl.length-1)&&(a.portalUrl+="/")},_addDefaultGeometryService:function(a){var c=a&&a.geometryService,c=c&&"string"===typeof c&&b.trim(c)?b.trim(c):this.portalSelf.helperServices.geometry.url;
a.geometryService=c;p.geometryService=new t(a.geometryService);l.setGlobalGeometryService(a.geometryService)},_addDefaultStyle:function(a){!a.theme||a.theme.styles&&0!==a.theme.styles.length||(a.theme.styles=["default"])},_addDefaultMap:function(a){a.map.id="map";"undefined"===typeof a.map["3D"]&&"undefined"===typeof a.map["2D"]&&(a.map["2D"]=!0);"undefined"===typeof a.map.position&&(a.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof a.map.portalUrl&&(a.map.portalUrl=a.portalUrl)},
_addDefaultVisible:function(a){l.visitElement(a,function(a){void 0===a.visible&&(a.visible=!0)})},_addDefaultSharedTheme:function(a){a.theme.sharedTheme?("undefined"===typeof a.theme.sharedTheme.useHeader&&(a.theme.sharedTheme.useHeader=!1),"undefined"===typeof a.theme.sharedTheme.useLogo&&(a.theme.sharedTheme.useLogo=!1)):a.theme.sharedTheme={useHeader:!1,useLogo:!1}},_addDefaultPanelAndPosition:function(a){this._addOnScreenDefaultPanelAndPosition(a);this._addPoolDefaultPanelAndPosition(a)},_addOnScreenDefaultPanelAndPosition:function(a){var c,
d;if(a=a.widgetOnScreen){c=a.panel&&a.panel.positionRelativeTo?a.panel.positionRelativeTo:"map";"undefined"===typeof a.panel||"undefined"===typeof a.panel.uri?a.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:c}}:"undefined"===typeof a.panel.position?a.panel.position={relativeTo:c}:"undefined"===typeof a.panel.position.relativeTo&&(a.panel.position.relativeTo=c);if(a.widgets)for(c=0;c<a.widgets.length;c++)a.widgets[c].position||(a.widgets[c].position={}),a.widgets[c].position.relativeTo||
(a.widgets[c].position.relativeTo=a.widgets[c]&&a.widgets[c].positionRelativeTo?a.widgets[c].positionRelativeTo:"map"),!0!==a.widgets[c].inPanel||a.widgets[c].panel||(a.widgets[c].panel=b.clone(a.panel),a.widgets[c].panel.position=a.widgets[c].position,a.widgets[c].panel.position.relativeTo=a.widgets[c].position.relativeTo);if(a.groups)for(c=0;c<a.groups.length;c++)for(a.groups[c].panel||(a.groups[c].panel=a.panel),a.groups[c].panel&&!a.groups[c].panel.position&&(a.groups[c].panel.position={}),a.groups[c].panel.position.relativeTo||
(a.groups[c].panel.position.relativeTo=a.groups[c].panel.positionRelativeTo?a.groups[c].panel.positionRelativeTo:"map"),a.groups[c].widgets||(a.groups[c].widgets=[]),d=0;d<a.groups[c].widgets.length;d++)a.groups[c].widgets[d].panel=a.groups[c].panel}},_addPoolDefaultPanelAndPosition:function(a){var c,d,e=a.widgetPool;if(e){c=e.panel&&e.panel.positionRelativeTo?e.panel.positionRelativeTo:"map";"undefined"===typeof e.panel||"undefined"===typeof e.panel.uri?e.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:c}}:
"undefined"===typeof e.panel.position?e.panel.position={relativeTo:c}:"undefined"===typeof e.panel.position.relativeTo&&(e.panel.position.relativeTo=c);if(e.groups)for(c=0;c<e.groups.length;c++)for(e.groups[c].panel?e.groups[c].panel.position.relativeTo||(e.groups[c].panel.position.relativeTo=e.groups[c].panel.positionRelativeTo?e.groups[c].panel.positionRelativeTo:"map"):e.groups[c].panel=e.panel,e.groups[c].widgets||(e.groups[c].widgets=[]),d=0;d<e.groups[c].widgets.length;d++)e.groups[c].widgets[d].panel=
e.groups[c].panel;if(e.widgets)for(c=0;c<e.widgets.length;c++)!1===e.widgets[c].inPanel?(d=e.widgets[c].positionRelativeTo?e.widgets[c].positionRelativeTo:"map",e.widgets[c].position)?e.widgets[c].position.relativeTo||(e.widgets[c].position.relativeTo=d):e.widgets[c].position={relativeTo:d}:e.widgets[c].panel||(e.widgets[c].panel=a.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(a){l.visitElement(a,b.hitch(this,function(a,c){a.isOnScreen=c.isOnScreen;a.widgets?(a.gid=a.id,1===a.widgets.length?
(a.label||(a.label=a.widgets[0].label?a.widgets[0].label:"Group"),a.icon||(a.icon=a.widgets[0].uri?this._getDefaultIconFromUri(a.widgets[0].uri):"jimu.js/images/group_icon.png")):(a.icon=a.icon?a.icon:"jimu.js/images/group_icon.png",a.label=a.label?a.label:"Group_"+c.index)):(a.gid=c.groupId,a.uri&&l.processWidgetSetting(a))}))},_getDefaultIconFromUri:function(a){a=a.split("/");a.pop();return a.join("/")+"/images/icon.png"},_addIndexForWidgetPool:function(a){var c=0,d,e;if(a.widgetPool.widgets)for(d=
0;d<a.widgetPool.widgets.length;d++)a.widgetPool.widgets[d].index=c,c++;if(a.widgetPool.groups)for(d=0;d<a.widgetPool.groups.length;d++)for(a.widgetPool.groups[d].index=c,c++,e=0;e<a.widgetPool.groups[d].widgets.length;e++)a.widgetPool.groups[d].widgets[e].index=e}});x.getInstance=function(a){null===r?r=new x(a):a&&(r.urlParams=a);window.getAppConfig=b.hitch(r,r.getAppConfig);return r};return x})},"dojo/_base/html":function(){define("./kernel ../dom ../dom-style ../dom-attr ../dom-prop ../dom-class ../dom-construct ../dom-geometry".split(" "),
function(n,b,m,k,g,e,f,l){n.byId=b.byId;n.isDescendant=b.isDescendant;n.setSelectable=b.setSelectable;n.getAttr=k.get;n.setAttr=k.set;n.hasAttr=k.has;n.removeAttr=k.remove;n.getNodeProp=k.getNodeProp;n.attr=function(e,d,a){return 2==arguments.length?k["string"==typeof d?"get":"set"](e,d):k.set(e,d,a)};n.hasClass=e.contains;n.addClass=e.add;n.removeClass=e.remove;n.toggleClass=e.toggle;n.replaceClass=e.replace;n._toDom=n.toDom=f.toDom;n.place=f.place;n.create=f.create;n.empty=function(e){f.empty(e)};
n._destroyElement=n.destroy=function(e){f.destroy(e)};n._getPadExtents=n.getPadExtents=l.getPadExtents;n._getBorderExtents=n.getBorderExtents=l.getBorderExtents;n._getPadBorderExtents=n.getPadBorderExtents=l.getPadBorderExtents;n._getMarginExtents=n.getMarginExtents=l.getMarginExtents;n._getMarginSize=n.getMarginSize=l.getMarginSize;n._getMarginBox=n.getMarginBox=l.getMarginBox;n.setMarginBox=l.setMarginBox;n._getContentBox=n.getContentBox=l.getContentBox;n.setContentSize=l.setContentSize;n._isBodyLtr=
n.isBodyLtr=l.isBodyLtr;n._docScroll=n.docScroll=l.docScroll;n._getIeDocumentElementOffset=n.getIeDocumentElementOffset=l.getIeDocumentElementOffset;n._fixIeBiDiScrollLeft=n.fixIeBiDiScrollLeft=l.fixIeBiDiScrollLeft;n.position=l.position;n.marginBox=function(e,d){return d?l.setMarginBox(e,d):l.getMarginBox(e)};n.contentBox=function(e,d){return d?l.setContentSize(e,d):l.getContentBox(e)};n.coords=function(e,d){n.deprecated("dojo.coords()","Use dojo.position() or dojo.marginBox().");e=b.byId(e);var a=
m.getComputedStyle(e),a=l.getMarginBox(e,a);e=l.position(e,d);a.x=e.x;a.y=e.y;return a};n.getProp=g.get;n.setProp=g.set;n.prop=function(e,d,a){return 2==arguments.length?g["string"==typeof d?"get":"set"](e,d):g.set(e,d,a)};n.getStyle=m.get;n.setStyle=m.set;n.getComputedStyle=m.getComputedStyle;n.__toPixelValue=n.toPixelValue=m.toPixelValue;n.style=function(e,d,a){switch(arguments.length){case 1:return m.get(e);case 2:return m["string"==typeof d?"get":"set"](e,d)}return m.set(e,d,a)};return n})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/kernel esri/config esri/geometry/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/support/webMercatorUtils esri/tasks/GeometryService esri/tasks/support/ProjectParameters esri/core/urlUtils esri/request esri/identity/IdentityManager esri/identity/OAuthInfo jimu/portalUrlUtils ./shared/utils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L,O){function K(a,c){a=a||"";var d=0,e=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!J.file.isEnabledFlash(),failure:[a+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){d++;d===e.length&&c()}}];for(a=0;a<e.length;a++)testLoad(e[a])}function N(a,c){var d=a.match(/url\([^)]+\)/gi),e,f;if(null===d||""===c)return a;for(e=0;e<d.length;e++)if(f=d[e].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),4<=f.length){var l=
f[2];/^data:image\/.*;/.test(l)||(c.endWith("/")||(c+="/"),a=a.replace(f[1]+l+f[3],f[1]+c+l+f[3]))}return a}function Q(a,c){var d=Array.isArray(c),e=d&&[]||{};d?(a=a||[],e=e.concat(a),c.forEach(function(c,d){"undefined"===typeof a[d]?e[d]=c:"object"===typeof c?e[d]=Q(a[d],c):-1===a.indexOf(c)&&e.push(c)})):(a&&"object"===typeof a&&Object.keys(a).forEach(function(c){e[c]=a[c]}),Object.keys(c).forEach(function(d){e[d]="object"===typeof c[d]&&c[d]?a[d]?Q(a[d],c[d]):c[d]:c[d]}));return e}function M(a){var c,
d={};c=a.indexOf("/");a.substring(0,c);c=a.substring(0,a.lastIndexOf("/")+1);d.folderUrl=require(J.getRequireConfig()).toUrl(c);d.amdFolder=c;d.url=d.folderUrl;if(/^http(s)?:\/\//.test(a)||/^\/\//.test(a))d.isRemote=!0;return d}function T(a){a.panels.forEach(function(a){a.uri="panels/"+a.name+"/Panel.js"});a.styles.forEach(function(a){a.uri="styles/"+a.name+"/style.css"});a.layouts.forEach(function(a){a.uri="layouts/"+a.name+"/config.json";a.icon="layouts/"+a.name+"/icon.png";a.RTLIcon="layouts/"+
a.name+"/icon_rtl.png"})}function P(a,c){var d=a.map(function(a){return a.id});b.forEach(c,function(c){0>d.indexOf(c)&&a.push({id:c,widgets:[]})},this);var e=[];a=b.filter(a,function(a){return 0>c.indexOf(a.id)?(e.push(a),!1):!0},this);if(0===a.length)return[];var f=a[a.length-1];b.forEach(e,function(a){f.widgets=f.widgets.concat(a.widgets)},this);return a=a.sort(function(a,d){return c.indexOf(a.id)-c.indexOf(d.id)})}function S(a,c,d){function e(a,c){return n.isArray(a[c.key])?a[c.key][c.index]:a[c.key]}
c=function(a){var c=[];a.split("_").forEach(function(a){var d=!1,e;"--"===a.slice(a.length-2)&&(d=!0,a=a.slice(0,a.length-2));e=a.search(/\[[0-9]+\]/);-1===e&&(e=a.length);c.push({key:a.slice(0,e),index:Number(a.slice(e+1,-1)),deleteFlag:d})});return c}(c);for(var f=1;f<c.length-1;f++)if(a=e(a,c[f]),!a)return;if(c[c.length-1].deleteFlag)!0===d&&(n.isArray(a[c[c.length-1].key])?delete a[c[c.length-1].key][c[c.length-1].index]:delete a[c[c.length-1].key]);else if(n.isArray(a[c[c.length-1].key])){if(void 0===
d)return a[c[c.length-1].key][c[c.length-1].index];a[c[c.length-1].key][c[c.length-1].index]=d}else{if(void 0===d)return a[c[c.length-1].key];a[c[c.length-1].key]=d}}function V(a,c,d){function e(d){d=J.template.getSearchRange(c,d,"]");var e=c.slice(d.firstPos,d.lastPos);return-1!==d.firstPos?(e=c.slice(d.firstPos+e.indexOf("[")+1,d.lastPos-1),d=c.slice(d.lastPos+1),(e=J.getConfigElementById(a,e))?{object:e,key:"section_"+d,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var f=a,l=c=c.replace(/\//g,
"_"),h=e("groups\\[.+\\]");if("deleted"!==h.state&&("isSection"===h.state&&(f=h.object,l=h.key),h=e("widgets\\[.+\\]"),"delete"!==h.state))return"isSection"===h.state&&(f=h.object,l=h.key),S(f,l,d)}var J={},U={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};n.mixin(J,O);window.atob||(window.atob=function(a){a=r.decode(a);for(var c="",d=0,e=a.length;d<e;d++)c+=String.fromCharCode(a[d]);return c});window.btob||(window.btob=function(a){for(var c=[],d=0,
e=a.length;d<e;d++)c.push(String.charCodeAt(a[d]));return r.encode(c)});var Y="unload",X=[];require.on("error",function(a){b.forEach(X,function(c){a.info[0]&&-1<a.info[0].indexOf(c.resKey)&&c.def.reject(a);for(var d in a.info)-1<d.indexOf(c.resKey)&&c.def.reject(a)})});J.checkError=function(a,c){X.push({resKey:a,def:c})};J.replacePlaceHolder=function(a,d){var e=c.stringify(a),f=e.match(/\$\{(\w)+\}/g);if(null===f)return a;for(a=0;a<f.length;a++){var l=f[a].match(/(\w)+/g)[0];d[l]&&(e=e.replace(f[a],
d[l]))}return c.parse(e)};J.changeUnit=function(a){var c=Math.abs(a),d;a=Math.floor(c);d=Math.floor(60*(c-a));c=(60*(60*(c-a)-d)).toFixed(2);return a+"\u00b0"+(10>d?"0"+d:d)+"'"+(10>c?"0"+c:c)+'"'};J.formatTime=function(a){var c=a/1E3;a=Math.floor(c/60);c=Number(c-60*a).toFixed(1);return(10>a?"0"+a:a)+":"+(10>c?"0"+c:c)};J.parseTime=function(a){var c=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!c.test(a))return console.log("wrong time format."),-1;a=a.match(c);return 1E3*(60*parseInt(a[1],10)+parseInt(a[2],10)+
parseInt(a[3],10)/10)};J.preloadImg=function(a,c){var d=[],d="string"===typeof a?[a]:a;b.forEach(d,function(a){(new Image).src=c?c+a:a})};J.setWABLogoDefaultAlt=function(a){if(a){a=f("img",a);for(var c=["img_1412759111499","img_1545621838463","img_1560482577021"],d=0,e=a.length;d<e;d++){var l=a[d];-1<c.indexOf(m.getAttr(l,"id"))&&!m.getAttr(l,"alt")&&m.setAttr(l,"alt","Web AppBuilder for ArcGIS.png")}}};var R=null;J.getImagesSize=function(c){var d=new h;if(!c||0!==c.indexOf("http"))return d.reject(),
d;null===R&&(R=m.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var e=a(R,"load",function(){clearTimeout(f);f=null;e.remove();var a=m.getContentBox(R);1===a.w&&1===a.h||0===a.w||0===a.h?d.reject():d.resolve([a.w,a.h])},{}),f=setTimeout(function(){clearTimeout(f);f=null;d.reject()},5E3);m.setAttr(R,"src",c);return d};J.getPositionStyle=function(a){var c={};if(!a)return c;a=n.clone(a);if(window.isRTL){var d;"undefined"!==typeof a.left&&
"undefined"!==typeof a.right?(d=a.left,a.left=a.right,a.right=d):"undefined"!==typeof a.left?(a.right=a.left,delete a.left):"undefined"!==typeof a.right&&(a.left=a.right,delete a.right);"undefined"!==typeof a.paddingLeft&&"undefined"!==typeof a.paddingRight?(d=a.paddingLeft,a.paddingLeft=a.paddingRight,a.paddingRight=d):"undefined"!==typeof a.paddingLeft?(a.paddingRight=a.paddingLeft,delete a.paddingLeft):"undefined"!==typeof a.paddingRight&&(a.paddingLeft=a.paddingRight,delete a.paddingRight);"undefined"!==
typeof a.marginLeft&&"undefined"!==typeof a.marginRight?(d=a.marginLeft,a.marginLeft=a.marginRight,a.marginRight=d):"undefined"!==typeof a.marginLeft?(a.marginRight=a.marginLeft,delete a.marginLeft):"undefined"!==typeof a.marginRight&&(a.marginLeft=a.marginRight,delete a.marginRight)}d="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom margin marginLeft marginRight marginTop marginBottom".split(" ");for(var e=0;e<d.length;e++){var f=d[e];"number"===typeof a[f]?
c[f]=a[f]+"px":"undefined"!==typeof a[f]?c[f]=a[f]:"padding"===f.substr(0,7)||"margin"===f.substr(0,7)?c[f]=0:c[f]="auto"}c.zIndex="undefined"===typeof a.zIndex?"auto":a.zIndex;return c};J.isEqual=function(a,c){function d(a,c){var l;if(null===a&&null===c||"undefined"===typeof a&&"undefined"===typeof c)return!0;if(null===a&&null!==c||null===c&&null!==a||"undefined"===typeof a&&"undefined"!==typeof c||"undefined"===typeof c&&"undefined"!==typeof a)return!1;if(isNaN(a)&&isNaN(c)&&"number"===typeof a&&
"number"===typeof c||a===c)return!0;if("function"===typeof a&&"function"===typeof c||a instanceof Date&&c instanceof Date||a instanceof RegExp&&c instanceof RegExp||a instanceof String&&c instanceof String||a instanceof Number&&c instanceof Number)return a.toString()===c.toString();if(-1<e.indexOf(a)||-1<f.indexOf(c))return!1;if(null!==c){for(l in c)if(c.hasOwnProperty(l)!==a.hasOwnProperty(l)||typeof c[l]!==typeof a[l])return!1;for(l in a){if(c.hasOwnProperty(l)!==a.hasOwnProperty(l)||typeof c[l]!==
typeof a[l])return!1;switch(typeof a[l]){case "object":case "function":e.push(a);f.push(c);if(!d(a[l],c[l]))return!1;e.pop();f.pop();break;default:if(a[l]!==c[l])return!1}}}return!0}var e,f;e=[];f=[];return d(a,c)?!0:!1};J.getUriInfo=M;J.file={loadFileAPI:function(){var a=new h;if("unload"===Y){var c=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:c+"libs/polyfills/fileAPI/",flashUrl:c+"libs/polyfills/fileAPI/FileAPI.flash.swf",flashImageUrl:c+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};
K(c,n.hitch(this,function(){Y="loaded";a.resolve()}));Y="loading"}else"loaded"===Y&&a.resolve();return a},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return k("safari")&&6>k("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var a=null;if(document.all)try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(da){a=null}else navigator.plugins&&0<navigator.plugins.length&&(a=
navigator.plugins["Shockwave Flash"]);return!!a},containSeparator:function(a){return 0<=a.indexOf("/")?!0:0<=a.indexOf("\\")?!0:!1},getNameFromPath:function(a){var c="",c=0<=a.indexOf("/")?"/":"\\";a=a.split(c);return 0<a.length?a[a.length-1]:null},getFolderFromPath:function(a){return a.substr(0,a.length-J.file.getNameFromPath(a).length)},readFile:function(a,c,d,e){if(this.supportHTML5()){var f=a.target.files[0];f&&(f.type.match(c)?f.size>=d?e({errCode:"exceed"}):(a=new FileReader,a.onload=function(a){e(null,
f.name,a.target.result)},a.readAsDataURL(f)):e({errCode:"invalidType"}))}else if(this.supportFileAPI()){var l=window.FileAPI.getFiles(a);l[0].type.match(c)?l[0].size>=d?e({errCode:"exceed"}):window.FileAPI.readAsDataURL(l[0],function(a){a&&a.result?e(null,l[0].name,a.result):e({errCode:"readError"})}):e({errCode:"invalidType"})}}};J.processWidgetSetting=function(a){if(!a.uri)return a;n.mixin(a,M(a.uri));a.icon||(a.icon=a.amdFolder+"images/icon.png");a.thumbnail||(a.thumbnail=a.amdFolder+"images/thumbnail.png");
return a};J.getRequireConfig=function(){if(jimuConfig){var a=[];jimuConfig.widgetsPackage&&(a=a.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(a=a.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(a=a.concat(jimuConfig.configsPackage));return{packages:a}}return{}};J.getTypeByGeometryType=function(a){var c="",d="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),e=["esriGeometryRing",
"esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(a)?c="point":0<=d.indexOf(a)?c="polyline":0<=e.indexOf(a)&&(c="polygon");return c};J.getSymbolTypeByGeometryType=function(a){var c=null;a=J.getTypeByGeometryType(a);"point"===a?c="marker":"polyline"===a?c="line":"polygon"===a&&(c="fill");return c};J.getServices=function(){return U};J.getArcGISDefaultGeometryService=function(){return new F(U.geometryService)};J.restoreToDefaultWebMapExtent=function(a,
c,d){var e=new h;if(!a||"esri.Map"!==a.declaredClass)return setTimeout(function(){e.reject("Invalid map.")},0),e;c=c&&c.itemInfo;if(!c)return setTimeout(function(){e.reject("Invalid itemInfo")},0),e;c=c.item&&c.item.extent;if(!c)return setTimeout(function(){e.reject("Invalid itemInfo.item.extent")}),e;var f=new v({wkid:4326}),f=new z(c[0][0],c[0][1],c[1][0],c[1][1],f);if(4326===parseInt(a.spatialReference.wkid,10))return a.setExtent(f);if(a.spatialReference.isWebMercator)return f=C.geographicToWebMercator(f),
a.setExtent(f);c=new E;c.geometries=[f];c.outSR=a.spatialReference;f=w&&w.defaults&&w.defaults.geometryService;f&&"esri.tasks.GeometryService"===f.declaredClass||(d&&"string"===typeof d&&n.trim(d)?(d=n.trim(d),f=new F(d)):f=J.getArcGISDefaultGeometryService());f.project(c).then(function(c){if(c=c&&c[0])return a.setExtent(c);e.reject("Invalid projected geometry.");return e},function(a){console.error(a);e.reject(a);return e});return e};J.getAncestorWindow=function(){for(var a=window;a&&a.parent&&a!==
a.parent;)a=a.parent;return a};J.getAncestorDom=function(a,c,d){if(a&&1===a.nodeType&&c&&"function"===typeof c){var e=100,f=document.body;d&&("number"===typeof d?(d=parseInt(d,10),0<d&&(e=d)):1===d.nodeType&&(f=d));for(d=0;a.parentNode&&d<e&&m.isDescendant(a.parentNode,f);){if(c(a.parentNode))return a.parentNode;a=a.parentNode;d++}}return null};J.bindClickAndDblclickEvents=function(c,d,e,f){var l=null;if(c&&1===c.nodeType&&d&&"function"===typeof d&&e&&"function"===typeof e){var h=200;f&&"number"===
typeof f&&(f=parseInt(f,10),0<f&&(h=f));var r=0,l=a(c,"click",function(a){r++;1===r?setTimeout(function(){1===r&&(r=0,d(a))},h):2===r&&(r=0,e(a))})}return l};J.isScrollToBottom=function(a){var c=m.getContentBox(a);return 1>a.scrollHeight-(a.scrollTop+c.h)};J.getAllItemTypes=function(){var a=[],a=a.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service",
"Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return a=a.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer",
"Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};J.getItemQueryStringByTypes=function(a){var c="",d=J.getAllItemTypes();if(a&&0<a.length&&0<a.length){var e="";b.forEach(a,function(c,d){e+=' type:"'+c+'" ';d!==a.length-1&&(e+=" OR ")});c=" ( "+e+" ) ";d=a.concat(d);d=b.filter(d,function(c){return b.every(a,
function(a){return 0>a.toLowerCase().indexOf(c.toLowerCase())})});b.forEach(d,function(a){c+=' -type:"'+a+'" '})}return c};J.getItemQueryStringByTypeKeywords=function(a){var c="";a&&0<a.length&&(c=' typekeywords:"'+a.join(",")+'" ');return c};J.isNotEmptyString=function(a,c){var d=a&&"string"===typeof a;return d?c?d&&n.trim(a):!0:!1};J.isValidNumber=function(a){return"number"===typeof a&&!isNaN(a)};J.isObject=function(a){return a&&"object"===typeof a};J.getRandomString=function(){var a=Math.random().toString();
return a=a.slice(2,a.length)};J._getDomainsByServerName=function(a){var c=a.split("."),d=c.length;return b.map(c,n.hitch(this,function(a,e){a=c.slice(e,d);var f="",l=a.length-1;b.forEach(a,n.hitch(this,function(a,c){f+=a;c!==l&&(f+=".")}));return f}))};J.removeCookie=function(a,c){var d=this._getDomainsByServerName(window.location.hostname);b.forEach(d,n.hitch(this,function(d){q(a,null,{expires:-1,path:c});q(a,null,{expires:-1,path:c,domain:d});q(a,null,{expires:-1,path:c,domain:"."+d})}))};J.isLocaleChanged=
function(a,c){return!a.startWith(c)};J.hashToObject=function(a){a=a.replace("#","");a=e.queryToObject(a);for(var d in a)if(a.hasOwnProperty(d))try{a[d]=c.parse(a[d])}catch(ca){}return a};J.reCreateObject=function(a){function c(a){var e=[];a.forEach(function(a){Array.isArray(a)?e.push(c(a)):"object"===typeof a?e.push(d(a)):e.push(a)});return e}function d(a){var e={},f;for(f in a)a.hasOwnProperty(f)&&(null===a[f]?e[f]=null:Array.isArray(a[f])?e[f]=c(a[f]):e[f]="object"===typeof a[f]?d(a[f]):a[f]);return e}
return Array.isArray(a)?c(a):d(a)};J.setVerticalCenter=function(a){setTimeout(function(){var c=f(".jimu-vcenter-text",a),d,e;b.forEach(c,function(a){d=m.getContentBox(a).h;m.setStyle(a,{lineHeight:d+"px"})},this);c=f(".jimu-vcenter",a);b.forEach(c,function(a){d=m.getContentBox(a).h;e=m.getContentBox(f(a).parent()[0]).h;m.setStyle(a,{marginTop:(e-d)/2+"px"})},this)},10)};J.merge=Q;J.loadStyleLink=function(c,d,e){var f=new h,l,r=require(J.getRequireConfig()).toUrl(d);if(require.cache["url:"+r]){l=require.cache["url:"+
r];var p=r.split("/").pop(),r=r.substr(0,r.length-p.length);l=N(l,r);c=e?m.create("style",{id:c,type:"text/css"},m.byId(e),"before"):m.create("style",{id:c,type:"text/css"},document.getElementsByTagName("head")[0]);c.styleSheet&&!c.sheet?c.styleSheet.cssText=l:c.appendChild(m.toDom(l));f.resolve("load");return f}l=e?m.create("link",{id:c,rel:"stylesheet",type:"text/css",href:r},m.byId(e),"before"):m.create("link",{id:c,rel:"stylesheet",type:"text/css",href:r},document.getElementsByTagName("head")[0]);
a(l,"load",function(){f.resolve("load")});var q=setInterval(function(){var a;if(b.some(document.styleSheets,function(c){if(c.href&&c.href.substr(c.href.indexOf(d),c.href.length)===d)return a=c,!0}))try{!f.isFulfilled()&&(a.cssRules&&a.cssRules.length||a.rules&&a.rules.length)&&f.resolve("load"),clearInterval(q)}catch(la){}},50);return f};J.changeLocation=function(a){window.history.pushState&&window.history.pushState({path:a},"",a)};J.urlToObject=function(a){var c=null;-1===a.indexOf("#")?(c=G.urlToObject(a),
c.hash=null):(a=a.split("#"),c=G.urlToObject(a[0]),c.hash=a[1]?-1<a[1].indexOf("\x3d")?e.queryToObject(a[1]):a[1]:null);return c};J.addManifestProperies=function(a){a.icon=a.url+"images/icon.png";"theme"===a.category?T(a):("undefined"!==typeof a["2D"]&&(a.support2D=a["2D"]),"undefined"!==typeof a["3D"]&&(a.support3D=a["3D"]),"undefined"===typeof a["2D"]&&"undefined"===typeof a["3D"]&&(a.support2D=!0),delete a["2D"],delete a["3D"],"undefined"===typeof a.properties&&(a.properties={}),O.processWidgetProperties(a))};
J.getUniqueValues=function(a,d){var e=new h;a=a.replace(/\/*$/g,"")+"/generateRenderer";d=c.stringify({type:"uniqueValueDef",uniqueValueFields:[d]});H(a,{query:{classificationDef:d,f:"json"},responseType:"json",callbackParamName:"callback"}).then(n.hitch(this,function(a){var c=a.data;a=[];(c=c&&c.uniqueValueInfos)&&0<c.length&&(a=b.map(c,n.hitch(this,function(a){return a.value})));e.resolve(a)}),n.hitch(this,function(a){e.reject(a)}));return e};J.combineRadioCheckBoxWithLabel=function(a,c){var d=
!1;if(a&&1===a.nodeType&&"input"===a.tagName.toLowerCase()){var e=a.getAttribute("type")||"",e=e.toLowerCase();if("radio"===e||"checkbox"===e)d=!0}e=!1;c&&1===c.nodeType&&"label"===c.tagName.toLowerCase()&&(e=!0);d&&e&&(d=a.getAttribute("id"),d||(d="input_"+J.getRandomString(),a.setAttribute("id",d)),c.setAttribute("for",d),m.setStyle(c,"cursor","pointer"))};J.convertExtentToPolygon=function(a){var c=a.xmin,d=a.xmax,e=a.ymin,f=a.ymax;return new B({rings:[[[c,f],[d,f],[d,e],[c,e],[c,f]]],spatialReference:a.toJson()})};
J.combineGeometries=function(a){function c(a){var c={points:[],spatialReference:a[0].spatialReference.toJson()};b.forEach(a,function(a){c.points=c.points.concat(a.points)});return new y(c)}function d(a){var c={paths:[],spatialReference:a[0].spatialReference.toJson()};b.forEach(a,function(a){c.paths=c.paths.concat(a.paths)});return new A(c)}function e(a){var c={rings:[],spatialReference:a[0].spatialReference.toJson()};b.forEach(a,function(a){"polygon"===a.type?c.rings=c.rings.concat(a.rings):"extent"===
a.type&&(a=J.convertExtentToPolygon(a),c.rings=c.rings.concat(a.rings))});return new B(c)}var f=null;if(a&&0<a.length)if(1===a.length)f=a[0];else{for(var l=null,h=null,r=null,p=null,q=0;q<a.length;q++){l=a[q];switch(l.type){case "point":case "multipoint":p="point";break;case "polyline":p="polyline";break;case "polygon":case "extent":p="polygon";break;default:return null}if(0===q)r=p;else if(r!==p)return null;if(q!==a.length-1&&(h=a[q+1],!l.spatialReference.equals(h.spatialReference)))return null}"point"===
p?f=c(a):"polyline"===p?f=d(a):"polygon"===p&&(f=e(a))}return f};J.isFeaturelayerUrlSupportQuery=function(a,c){var d=!1,e=/\/featureserver\//gi.test(a);a=/\/mapserver\//gi.test(a);c=(c||"").toLowerCase();e?d=0<=c.indexOf("query"):a&&(d=0<=c.indexOf("data"));return d};J.isImageServiceSupportQuery=function(a){return 0<=(a||"").toLowerCase().indexOf("catalog")};J.isStringEndWith=function(a,c){return a.lastIndexOf(c)+c.length===a.length};J.processManifestLabel=function(a,c){a.label=a.i18nLabels&&(a.i18nLabels[c]||
a.i18nLabels.defaultLabel)||a.label||a.name;a.layouts&&b.forEach(a.layouts,function(d){var e="i18nLabels_layout_"+d.name;d.label=a[e]&&(a[e][c]||a[e].defaultLabel)||d.label||d.name});a.styles&&b.forEach(a.styles,function(d){var e="i18nLabels_style_"+d.name;d.label=a[e]&&(a[e][c]||a[e].defaultLabel)||d.label||d.name})};J.addManifest2WidgetJson=function(a,c){n.mixin(a,c.properties);a.name=c.name;a.label||(a.label=c.label);a.manifest=c};J.widgetJson=function(){var a={addManifest2WidgetJson:function(a,
c){n.mixin(a,c.properties);a.name=c.name;a.label||(a.label=c.label);a.manifest=c;a.isRemote=c.isRemote;a.isRemote&&(a.itemId=c.itemId);c.featureActions&&(a.featureActions=c.featureActions);a.icon||(a.icon=c.icon);a.thumbnail||(a.thumbnail=c.thumbnail);a.folderUrl=c.folderUrl;a.amdFolder=c.amdFolder},removeManifestFromWidgetJson:function(a){if(a.manifest){for(var c in a.manifest.properties)a[c]=void 0;a.name=void 0;a.label=void 0;a.featureActions=void 0;a.manifest=void 0}},getUriFromItem:function(c){return c.url?
a.getFolderUrlFromItem(c)+"Widget":null},getFolderUrlFromItem:function(a){if(!a.url)return null;a=/manifest\.json$/.test(a.url)?a.url.substring(0,a.url.length-13):/\/$/.test(a.url)?a.url:a.url+"/";"https:"===window.location.protocol&&(a=a.replace(/^http:\/\//,"https://"));return a}};return a}();J.addI18NLabel=function(a){var c=new h;if(a.i18nLabels)return c.resolve(a),c;a.i18nLabels={};if(a.properties&&!1===a.properties.hasLocale)return c.resolve(a),c;var d="widget"===a.category?"_widgetLabel":"_themeLabel";
require(J.getRequireConfig(),["dojo/i18n!"+a.amdFolder+"nls/strings"],function(e){a.i18nLabels[dojoConfig.locale]=e[d];"theme"===a.category&&(a.layouts&&a.layouts.forEach(function(c){a["i18nLabels_layout_"+c.name]={};a["i18nLabels_layout_"+c.name][dojoConfig.locale]=e["_layout_"+c.name]}),a.styles&&a.styles.forEach(function(c){a["i18nLabels_style_"+c.name]={};a["i18nLabels_style_"+c.name][dojoConfig.locale]=e["_style_"+c.name]}));c.resolve(a)});return c};J.localizeNumber=function(a,c){var d=(a.toString().split(".")[1]||
"").length,e="",e=c&&isFinite(c.places)&&c.places,e=0<e||0<d?"#,###,###,##0.0"+Array.prototype.join.call({length:0<e?e+1:d},"0"):"#,###,###,##0",d={locale:g.locale,pattern:e};n.mixin(d,c||{});try{return p.format(a,d)}catch(W){return console.error(W),a.toLocaleString()}};J.parseNumber=function(a,c){var d={locale:g.locale};n.mixin(d,c||{});try{return p.parse(a,d)}catch(ba){return console.error(ba),a}};J.localizeDate=function(a,c){var d={locale:g.locale,fullYear:!0};n.mixin(d,c||{});try{return t.format(a,
d)}catch(ba){return console.error(ba),"date"===d.selector?a.toLocaleDateString():"time"===d.selector?a.toLocaleTimeString():a.toLocaleString()}};J.localizeNumberByFieldInfo=function(a,c){var d=null,d=n.exists("format.places",c)&&c.format.places,d=J.localizeNumber(a,{places:d});return n.exists("format.digitSeparator",c)&&!c.format.digitSeparator?d.toString().replace(new RegExp("\\"+u.group,"g"),""):d};J.fieldFormatter={getFormattedUrl:function(a){if(a&&"string"===typeof a){var c=a.indexOf("http:");
-1===c&&(c=a.indexOf("https:"));if(-1<c&&-1===a.indexOf("href\x3d")){var d=a.indexOf(" ",c);-1===d&&(d=a.length);var e=a.substring(c,d);a=a.substring(0,c)+'\x3cA href\x3d"'+e+'" target\x3d"_blank"\x3e'+e+"\x3c/A\x3e"+a.substring(d,a.length)}}return a||""},getFormattedNumber:function(a,c){if("number"===typeof a){var d=(a.toString().split(".")[1]||"").length;a=J.localizeNumberByFieldInfo(a,{format:{places:c&&"number"===typeof c.places?parseInt(c.places,10):d,digitSeparator:c&&c.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+
(a||"")+"\x3c/span\x3e"}return a},getFormattedDate:function(a){a&&(a=J.localizeDate(new Date(a),{fullYear:!0}));return a||""},getCodedValue:function(a,c){if(a&&a.codedValues){for(var d=0,e=a.codedValues.length;d<e;d++){var f=a.codedValues[d];if(J.isDefined(c)&&n.exists("code",f)&&c.toString()===f.code.toString())return f.name}return c}return c||null},getTypeName:function(a,c){for(var d=c.length,e=0;e<d;e++)if(a===c[e].id)return c[e].name;return a}};J.addRelativePathInCss=N;J.url={isAbsolute:function(a){return a?
a.startWith("http")||a.startWith("/"):!1},removeQueryParamFromUrl:function(a,c){a=G.urlToObject(a);a.query&&delete a.query[c];c=a.path;for(var d in a.query)c=c===a.path?c+"?"+d+"\x3d"+a.query[d]:c+"\x26"+d+"\x3d"+a.query[d];return c},addQueryParamToUrl:function(a,c,d){a=G.urlToObject(a);a.query||(a.query={});a.query[c]=d;c=a.path;for(var e in a.query)c=c===a.path?c+"?"+e+"\x3d"+a.query[e]:c+"\x26"+e+"\x3d"+a.query[e];return c}};J.processUrlInWidgetConfig=function(a,c){if(a)return a.startWith("data:")||
a.startWith("http")||a.startWith("/")?a:a.startWith("${appPath}")?a.replace("${appPath}",window.appInfo.appPath):c+a};J.processUrlInAppConfig=function(a){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:window.appInfo.appPath+a};J.getLocationUrlWithoutHashAndQueryParams=function(){var a=window.location,c=a.protocol+"//"+a.host+a.pathname,a=G.urlToObject(a.href);a.query&&a.query.apiurl&&(c=J.url.addQueryParamToUrl(c,"apiurl",a.query.apiurl));return c};J.getDefaultWebMapThumbnail=
function(){return require.toUrl("jimu/images/webmap.png")};J.invertColor=function(a){a=a.substring(1);3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?"#000000":"#ffffff"};J.mixinAppConfigPosition=function(a,c){var d=n.clone(a);if(!c)return d;c=n.clone(c);var e=d.widgetOnScreen,f=c.widgetOnScreen;f&&f.widgets&&("[object Object]"===Object.prototype.toString.call(f.widgets)?b.forEach(e.widgets,function(a,c){c=a.uri?a.uri:
"ph_"+c;f.widgets[c]&&f.widgets[c].position&&(f.widgets[c].position.relativeTo||(f.widgets[c].position.relativeTo="map"),a.position=f.widgets[c].position)},this):b.forEach(f.widgets,function(a,c){a.position&&!a.position.relativeTo&&(a.position.relativeTo="map");e.widgets[c]&&a.position&&(e.widgets[c].position=a.position)}));f&&f.groups&&("[object Object]"===Object.prototype.toString.call(f.groups)?b.forEach(e.groups,function(a,c){c=a.label?a.label:"g_"+c;f.groups[c]&&f.groups[c].panel&&f.groups[c].panel.position&&
(f.groups[c].panel.position.relativeTo||(f.groups[c].panel.position.relativeTo="map"),a.panel.position=f.groups[c].panel.position)},this):(a=a.layoutDefinition?a.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager","jimu/layoutManagers/AbsolutePositionLayoutManager"===a?b.forEach(f.groups,function(a,c){a.panel&&a.panel.position&&!a.panel.position.relativeTo&&(a.panel.position.relativeTo="map");e.groups[c]&&a.panel&&a.panel.position&&(e.groups[c].panel.position=a.panel.position)}):
"jimu/layoutManagers/GridLayoutManager"===a&&(e.groups=P(e.groups,f.groups.map(function(a){return a.id})))));c.map&&c.map.position&&(d.map?d.map.position=c.map.position:d.map={position:c.map.position});c.widgetPool&&c.widgetPool.panel&&(c.widgetPool.panel.position&&!c.widgetPool.panel.position.relativeTo&&(c.widgetPool.panel.position.relativeTo="map"),d.widgetPool.panel.position=c.widgetPool.panel.position);c.mobileLayout&&(d.mobileLayout=c.mobileLayout);return d};J.handleGridLayoutOnScreenGroupChange=
P;J.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(a,c,d){var e=-1;c=a.search(new RegExp(c));0<=c&&(a=a.slice(c,a.length),a=a.indexOf(d),e=c+a+d.length);return{firstPos:c,lastPos:e}},setConfigValue:function(a,c,d){S(a,c,d)},getConfigValue:function(a,c){return S(a,c)},setConfigValueWithId:function(a,c,d){V(a,c,d)},getConfigValueWithId:function(a,c){return V(a,c)},getKeyInfo:function(a){var c=this.getWidgetIdByKey(a);if(null!==c)return{type:"widget",
id:c};a=this.getGroupIdByKey(a);return null!==a?{type:"group",id:a}:{type:"unknow",id:null}},getWidgetIdByKey:function(a){var c=J.template.getSearchRange(a,J.template.widgetIdentification,"]");if(-1===c.firstPos)a=null;else{var d=a.slice(c.firstPos,c.lastPos);a=a.slice(c.firstPos+d.indexOf("[")+1,c.lastPos-1)}return a},getGroupIdByKey:function(a){var c=J.template.getSearchRange(a,J.template.groupIdentification,"]");if(-1===c.firstPos)a=null;else{var d=a.slice(c.firstPos,c.lastPos);a=a.slice(c.firstPos+
d.indexOf("[")+1,c.lastPos-1)}return a},getConfigedWidgetsByTemplateConfig:function(a){var c=[],d=J.template.widgetIdentification+"_config",e;b.forEach(a.configurationSettings,function(a){b.forEach(a.fields,function(a){a.fieldName&&(e=J.template.getSearchRange(a.fieldName,d,"]"),0<=e.firstPos&&(a=J.template.getWidgetIdByKey(a.fieldName),-1===c.indexOf(a)&&c.push(a)))},this)},this);return c},mergeTemplateAppConfigToAppConfig:function(a,c,d){function e(a){var c=[];b.forEach(a,function(a){a&&c.push(a)},
this);return c}var f=a.widgetOnScreen,l=a.portalUrl;c.values.webmap&&(a.map.itemId=c.values.webmap);d&&(a.map.mapOptions&&J.deleteMapOptions(a.map.mapOptions),a.map.portalUrl=l,c.values.app_title||(c.values.app_title=d.title),c.values.app_subtitle||(c.values.app_subtitle=d.snippet));for(var h in c.values)"webmap"!==h&&J.template.setConfigValueWithId(a,h,c.values[h]);a.widgetPool.widgets=e(a.widgetPool.widgets);f.widgets=e(f.widgets);if(a.widgetPool.groups)for(c=0;c<a.widgetPool.groups.length;c++)a.widgetPool.groups[c].widgets=
e(a.widgetPool.groups[c].widgets);if(f.groups)for(c=0;c<f.groups.length;c++)f.groups[c].widgets=e(f.groups[c].widgets);return a}};J.deleteMapOptions=function(a){a&&(delete a.extent,delete a.lods,delete a.center,delete a.scale,delete a.zoom,delete a.maxScale,delete a.maxZoom,delete a.minScale,delete a.minZoom,delete a.initialState)};J.localeIsSame=function(a,c){return a.split("-")[0]===c.split("-")[0]};J.graphicsExtent=function(){return null};J.sanitizeHTML=function(a){return html_sanitize(a,function(a){return a},
function(a){return a})};J.stripHTML=function(a){return a?-1<a.indexOf("\x3c")&&-1<a.indexOf("\x3e")?a.replace(/<(?:.|\s)*?>/g,""):a:a};J.removeSuffixSlashes=function(a){return a.replace(/\/*$/g,"")};J.getBestDisplayAttributes=function(a,c){var d={},e=null,f;for(f in a)e=J.getBestDisplayValue(f,a,c),d[f]=e;return d};J.getBestDisplayValue=function(a,c,d){var e="",f=null;n.isArrayLike(d)?f=J.getFieldInfoByFieldName(d,a):"object"===typeof d&&d.name===a&&(f=d);f&&(e=c[a],"esriFieldTypeDate"===f.type?e&&
(a=new Date(parseInt(e,10)),e=J._tryLocaleDate(a)):"number"===typeof e&&(f.domain&&"codedValue"===f.domain.type?b.some(f.domain.codedValues,function(a){if(a.code===e)return e=a.name,!0}):e=J._tryLocaleNumber(e)));if(null===e||void 0===e)e="";return e};J._tryLocaleNumber=function(a){var c=J.localizeNumber(a);if(null===c||void 0===c)c=a;return c};J._tryLocaleDate=function(a){var c=J.localizeDate(a);c||(c=a.toLocaleDateString());return c};J.getFieldInfoByFieldName=function(a,c){var d=null;a&&0<a.length&&
b.some(a,n.hitch(this,function(a){return a.name===c?(d=a,!0):!1}));return d};J.containsNonLatinCharacter=function(a){for(var c=0;c<a.length;c++)if(255<a.charCodeAt(c))return!0;return!1};J.isVersion4API=function(){return 0===x.version.indexOf("4")};J.getEsriConfig=function(){return w};J.getEsriConfigRequestObject=function(){var a=null;return a=J.isVersion4API()?w.request:w.defaults.io};J.setGlobalGeometryService=function(a){a=new F(a);J.isVersion4API()?w.geometryService=a:w.defaults.geometryService=
a;return a};J.getQueryableFeatureLayersFromMap=function(a){var c=[];a.layers&&(c=a.layers.filter(function(a){return"esri.layers.FeatureLayer"===a.declaredClass&&a.url&&a.supportedQueryFormats&&0<=a.supportedQueryFormats.toUpperCase().indexOf("JSON")}));return c};J.has=function(a){var c=k(a);if(c)return c;if("ie"===a.toLowerCase()){a=0;var d=/MSIE (\d+\.\d+);/.test(navigator.userAgent),e=!!navigator.userAgent.match(/Trident\/7.0/),f=navigator.userAgent.indexOf("rv:11.0");d&&(a=Number(RegExp.$1));-1!==
navigator.appVersion.indexOf("MSIE 10")&&(a=10);e&&-1!==f&&(a=11);return 11===a&&11||c}if("edge"===a.toLowerCase())return navigator.userAgent.split("Edge/")[1]||c};J.detectUserAgent=function(){var a={},c={},d=navigator.userAgent,e=navigator.platform,f=d.match(/Web[kK]it[\/]{0,1}([\d.]+)/),l=d.match(/(Android);?[\s\/]+([\d.]+)?/),h=!!d.match(/\(Macintosh\; Intel /),r=d.match(/(iPad).*OS\s([\d_]+)/),p=d.match(/(iPod)(.*OS\s([\d_]+))?/),q=!r&&d.match(/(iPhone\sOS)\s([\d_]+)/),b=d.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),
e=/Win\d{2}|Windows/.test(e),g=d.match(/Windows Phone ([\d.]+)/),u=b&&d.match(/TouchPad/),t=d.match(/Kindle\/([\d.]+)/),k=d.match(/Silk\/([\d._]+)/),w=d.match(/(BlackBerry).*Version\/([\d.]+)/),v=d.match(/(BB10).*Version\/([\d.]+)/),x=d.match(/(RIM\sTablet\sOS)\s([\d.]+)/),y=d.match(/PlayBook/),m=d.match(/Chrome\/([\d.]+)/)||d.match(/CriOS\/([\d.]+)/),z=d.match(/Firefox\/([\d.]+)/),A=d.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),B=d.match(/MSIE\s([\d.]+)/)||d.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),
C=!m&&d.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),F=C||d.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);c.webkit=!!f;c.webkit&&(c.version=f[1]);l&&(a.android=!0,a.version=l[2]);q&&!p&&(a.ios=a.iphone=!0,a.version=q[2].replace(/_/g,"."));r&&(a.ios=a.ipad=!0,a.version=r[2].replace(/_/g,"."));p&&(a.ios=a.ipod=!0,a.version=p[3]?p[3].replace(/_/g,"."):null);g&&(a.wp=!0,a.version=g[1]);b&&(a.webos=!0,a.version=b[2]);u&&(a.touchpad=!0);w&&(a.blackberry=!0,a.version=w[2]);
v&&(a.bb10=!0,a.version=v[2]);x&&(a.rimtabletos=!0,a.version=x[2]);y&&(c.playbook=!0);t&&(a.kindle=!0,a.version=t[1]);k&&(c.silk=!0,c.version=k[1]);!k&&a.android&&d.match(/Kindle Fire/)&&(c.silk=!0);m&&(c.chrome=!0,c.version=m[1]);z&&(c.firefox=!0,c.version=z[1]);A&&(a.firefoxos=!0,a.version=A[1]);B&&(c.ie=!0,c.version=B[1]);F&&(h||a.ios||e)&&(c.safari=!0,a.ios||(c.version=F[1]));C&&(c.webview=!0);a.tablet=!!(r||y||l&&!d.match(/Mobile/)||z&&d.match(/Tablet/)||B&&!d.match(/Phone/)&&d.match(/Touch/));
a.phone=!(a.tablet||a.ipod||!(l||q||b||w||v||m&&d.match(/Android/)||m&&d.match(/CriOS\/([\d.]+)/)||z&&d.match(/Mobile/)||B&&d.match(/Touch/)));return{os:a,browser:c}};J.isMobileUa=function(){var a=J.detectUserAgent();return!0===a.os.phone||!0===a.os.tablet?!0:!1};J.isNeedHttpsButNot=function(){var a=navigator.geolocation,c=window.hasOwnProperty("isSecureContext");return(c&&window.isSecureContext||!c&&"https:"===window.location.protocol)&&a?!1:!0};J.isInConfigOrPreviewWindow=function(){var a=!1;try{a=
!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(da){a=!1}return!!a};J.getAppHref=function(){var a="";return a=J.isInConfigOrPreviewWindow()?window.parent.location.href:window.location.href};J.getAppIdFromUrl=function(){var a=!0,c=J.getAppHref();if(-1!==c.indexOf("id\x3d")||-1!==c.indexOf("appid\x3d")||-1!==c.indexOf("apps"))a=!1;if(!0===a)return c;a=this.urlToObject(window.location.href);if(a.query&&(a.query.id||a.query.appid))return a.query.id||a.query.appid;
if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(a=window.appInfo.appPath.split("/"),a.length&&2<a.length)return a[a.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};J.getEditorContentHeight=function(a,c,d){var e=new h;this._content=a;this._dom=c;this._domParam=d;var l=setTimeout(n.hitch(this,function(){clearTimeout(l);l=null;var a=0,c=this._domParam.contentWidth;try{var d=document.createElement("div");d.setAttribute("id","fakeContent");m.setStyle(d,
"background-size","contain");d.innerHTML=this._content;this._dom.appendChild(d);if(d){var h=f("img",d);h&&h.length&&h.style({maxWidth:c-20+"px"});m.setStyle(d,"position","absolute");m.setStyle(d,"width",c+"px");m.setStyle(d,"left","-99999px");m.setStyle(d,"top","-99999px");m.setStyle(d,"visibility","hidden");var r=m.getContentBox(d);r.h&&(a=r.h,a+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(ma){console.error("can't getEditorContentHeight"+ma),a=200}e.resolve(a)}),1500);return e};
J.getEditorTextColor=function(a,c){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:J.getColorRecordName(a),forceAttr:c}}};J.getEditorBackgroundColor=function(a){return{name:"dijit.editor.plugins.EditorBackgroundColor",custom:{recordUID:J.getColorRecordName(a)}}};J.getColorRecordName=function(a){return"wab_cr_"+(a||"")};J.isEsriDomain=function(a){return/^https?:\/\/(?:[\w\-\_]+\.)+(?:esri|arcgis)\.com/.test(a)};J.b64toBlob=function(a,c,d){c=c||"";d=d||512;a=window.atob(a.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,
""));for(var e=[],f=0;f<a.length;f+=d){for(var l=a.slice(f,f+d),h=Array(l.length),r=0;r<l.length;r++)h[r]=l.charCodeAt(r);l=new Uint8Array(h);e.push(l)}return new Blob(e,{type:c})};J.subtractionArray=function(a,c){for(var d=a.length-1;0<=d;d--)for(var e=a[d],f=c.length-1;0<=f;f--)if(e===c[f]){a.splice(d,1);c.splice(f,1);break}return a};J.resourcesUrlToBlob=function(a){return H({url:a,handleAs:"blob"})};J.processItemResourceOfAppConfig=function(a,c){function e(a){var c=a.obj,d=a.key,e={obj:c,key:d};
"number"===typeof a.i?(e.i=a.i,e.value=c[d][a.i]):e.value=c[d];return e}function f(a){for(var c in a)if("object"===typeof a[c])if(Array.isArray(a[c]))for(var d=a,e=c,h=0;h<d[e].length;h++)"string"===typeof d[e][h]?l(d,e,h):"object"===typeof d[e][h]&&f(d[e][h]);else f(a[c]);else"string"===typeof a[c]&&l(a,c)}function l(a,d,f){"number"===typeof f?c.test(a[d][f])&&(p=c.func(e({obj:a,key:d,i:f})),"function"===typeof p.then?r.push(p):h.push(p)):c.test(a[d])&&(p=c.func(e({obj:a,key:d})),"function"===typeof p.then?
r.push(p):h.push(p))}var h=[],r=[],p;f(a);return 0<r.length?d(r).then(function(c){0<h.length&&(c=c.concat(h));return{appConfig:a,result:c}}):{appConfig:a,result:h}};J.isDefined=function(a){return void 0!==a&&null!==a};J.getDefaultPopupInfo=function(a,c,d){var e=null;a&&a.fields&&(e={title:c,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},b.forEach(a.fields,function(a){var c=!1;d?b.some(d,n.hitch(this,function(c){return c&&a.name.toLowerCase()===c.toLowerCase()}))&&(c=!0):c=!0;c&&
(c=this.getDefaultPortalFieldInfo(a),c.visible=!0,c.isEditable=a.editable,e.fieldInfos.push(c))},this));return e};J.getDefaultPortalFieldInfo=function(a){var c=a.name,c={fieldName:c,label:a.alias||c,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(a.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":c.format={places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":c.format={places:2,digitSeparator:!0};break;case "esriFieldTypeDate":c.format=
{dateFormat:"longMonthDayYear"}}return c};J.checkEssentialAppsLicense=function(a,c,d){var e=L.getStandardPortalUrl(c.portalUrl),f=L.getSharingUrl(e),e=new I({appId:"arcgisWebApps",portalUrl:e});D.registerOAuthInfos([e]);return d?D.checkAppAccess(f,"arcgisWebApps"):c.getItemById(a).then(function(a){if("public"!==a.access)return D.checkAppAccess(f,"arcgisWebApps",{force:!0})})};J.getStyleColorInTheme=function(a){var c=new h,d,e;window&&window.isBuilder?(e="./stemapp3d/themes/",d=window.appConfig):(e=
"./themes/",d=window.getAppConfig());if(d&&d.theme.customStyles&&d.theme.customStyles.mainBackgroundColor)return c.resolve(d.theme.customStyles.mainBackgroundColor),c.promise;var f=d.theme.name,l=d.theme.styles[0];a&&(l=a);H(e+f+"/manifest.json",{responseType:"json"}).then(n.hitch(this,function(a){if(a&&a.data){a=a.data.styles;for(var d=0;d<a.length;d++){var e=a[d];e.name===l&&c.resolve(e.styleColor)}}}),n.hitch(this,function(a){console.error(a);c.reject(null)}));return c.promise};return J})},"dojo/NodeList-traverse":function(){define(["./query",
"./_base/lang","./_base/array"],function(n,b,m){var k=n.NodeList;b.extend(k,{_buildArrayFromCallback:function(b){for(var e=[],f=0;f<this.length;f++){var l=b.call(this[f],this[f],e);l&&(e=e.concat(l))}return e},_getUniqueAsNodeList:function(b){for(var e=[],f=0,l;l=b[f];f++)1==l.nodeType&&-1==m.indexOf(e,l)&&e.push(l);return this._wrap(e,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(b,e){b=this._getUniqueAsNodeList(b);b=e?n._filterResult(b,e):b;return b._stash(this)},_getRelatedUniqueNodes:function(b,
e){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(e),b)},children:function(g){return this._getRelatedUniqueNodes(g,function(e,f){return b._toArray(e.childNodes)})},closest:function(b,e){return this._getRelatedUniqueNodes(null,function(f,l){do if(n._filterResult([f],b,e).length)return f;while(f!=e&&(f=f.parentNode)&&1==f.nodeType);return null})},parent:function(b){return this._getRelatedUniqueNodes(b,function(e,f){return e.parentNode})},parents:function(b){return this._getRelatedUniqueNodes(b,
function(e,f){for(f=[];e.parentNode;)e=e.parentNode,f.push(e);return f})},siblings:function(b){return this._getRelatedUniqueNodes(b,function(e,f){f=[];for(var l=e.parentNode&&e.parentNode.childNodes,h=0;h<l.length;h++)l[h]!=e&&f.push(l[h]);return f})},next:function(b){return this._getRelatedUniqueNodes(b,function(e,f){for(e=e.nextSibling;e&&1!=e.nodeType;)e=e.nextSibling;return e})},nextAll:function(b){return this._getRelatedUniqueNodes(b,function(e,f){for(f=[];e=e.nextSibling;)1==e.nodeType&&f.push(e);
return f})},prev:function(b){return this._getRelatedUniqueNodes(b,function(e,f){for(e=e.previousSibling;e&&1!=e.nodeType;)e=e.previousSibling;return e})},prevAll:function(b){return this._getRelatedUniqueNodes(b,function(e,f){for(f=[];e=e.previousSibling;)1==e.nodeType&&f.push(e);return f})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(b,
e){return 0!=e%2})},odd:function(){return this.filter(function(b,e){return 0==e%2})}});return k})},"dojo/cookie":function(){define(["./_base/kernel","./regexp"],function(n,b){n.cookie=function(m,k,g){var e=document.cookie,f;if(1==arguments.length)f=(f=e.match(new RegExp("(?:^|; )"+b.escapeString(m)+"\x3d([^;]*)")))?decodeURIComponent(f[1]):void 0;else{g=g||{};e=g.expires;if("number"==typeof e){var l=new Date;l.setTime(l.getTime()+864E5*e);e=g.expires=l}e&&e.toUTCString&&(g.expires=e.toUTCString());
k=encodeURIComponent(k);var e=m+"\x3d"+k,h;for(h in g)e+="; "+h,l=g[h],!0!==l&&(e+="\x3d"+l);document.cookie=e}return f};n.cookie.isSupported=function(){"cookieEnabled"in navigator||(this("__djCookieTest__","CookiesAllowed"),navigator.cookieEnabled="CookiesAllowed"==this("__djCookieTest__"),navigator.cookieEnabled&&this("__djCookieTest__","",{expires:-1}));return navigator.cookieEnabled};return n.cookie})},"dojo/regexp":function(){define(["./_base/kernel","./_base/lang"],function(n,b){var m={};b.setObject("dojo.regexp",
m);m.escapeString=function(b,g){return b.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,function(e){return g&&-1!=g.indexOf(e)?e:"\\"+e})};m.buildGroupRE=function(b,g,e){if(!(b instanceof Array))return g(b);for(var f=[],l=0;l<b.length;l++)f.push(g(b[l]));return m.group(f.join("|"),e)};m.group=function(b,g){return"("+(g?"?:":"")+b+")"};return m})},"dojo/number":function(){define(["./_base/lang","./i18n","./i18n!./cldr/nls/number","./string","./regexp"],function(n,b,m,k,g){var e={};n.setObject("dojo.number",
e);e.format=function(f,h){h=n.mixin({},h||{});var d=b.normalizeLocale(h.locale),d=b.getLocalization("dojo.cldr","number",d);h.customs=d;d=h.pattern||d[(h.type||"decimal")+"Format"];return isNaN(f)||Infinity==Math.abs(f)?null:e._applyPattern(f,d,h)};e._numberPatternRE=/[#0,]*[#0](?:\.0*#*)?/;e._applyPattern=function(f,h,d){d=d||{};var a=d.customs.group,c=d.customs.decimal;h=h.split(";");var l=h[0];h=h[0>f?1:0]||"-"+l;if(-1!=h.indexOf("%"))f*=100;else if(-1!=h.indexOf("\u2030"))f*=1E3;else if(-1!=h.indexOf("\u00a4"))a=
d.customs.currencyGroup||a,c=d.customs.currencyDecimal||c,h=h.replace(/([\s\xa0]*)(\u00a4{1,3})([\s\xa0]*)/,function(a,c,e,f){return(a=d[["symbol","currency","displayName"][e.length-1]]||d.currency||"")?c+a+f:""});else if(-1!=h.indexOf("E"))throw Error("exponential notation not supported");var p=e._numberPatternRE,l=l.match(p);if(!l)throw Error("unable to find a number expression in pattern: "+h);!1===d.fractional&&(d.places=0);return h.replace(p,e._formatAbsolute(f,l[0],{decimal:c,group:a,places:d.places,
round:d.round}))};e.round=function(e,f,d){d=10/(d||10);return(d*+e).toFixed(f)/d};if(0==(.9).toFixed()){var f=e.round;e.round=function(e,h,d){var a=Math.pow(10,-h||0),c=Math.abs(e);if(!e||c>=a)a=0;else if(c/=a,.5>c||.95<=c)a=0;return f(e,h,d)+(0<e?a:-a)}}e._formatAbsolute=function(f,h,d){d=d||{};!0===d.places&&(d.places=0);Infinity===d.places&&(d.places=6);h=h.split(".");var a="string"==typeof d.places&&d.places.indexOf(","),c=d.places;a?c=d.places.substring(a+1):0<=c||(c=(h[1]||[]).length);0>d.round||
(f=e.round(f,c,d.round));f=String(Math.abs(f)).split(".");var l=f[1]||"";h[1]||d.places?(a&&(d.places=d.places.substring(0,a)),a=void 0!==d.places?d.places:h[1]&&h[1].lastIndexOf("0")+1,a>l.length&&(f[1]=k.pad(l,a,"0",!0)),c<l.length&&(f[1]=l.substr(0,c))):f[1]&&f.pop();c=h[0].replace(",","");a=c.indexOf("0");-1!=a&&(a=c.length-a,a>f[0].length&&(f[0]=k.pad(f[0],a)),-1==c.indexOf("#")&&(f[0]=f[0].substr(f[0].length-a)));var c=h[0].lastIndexOf(","),p,b;-1!=c&&(p=h[0].length-c-1,h=h[0].substr(0,c),c=
h.lastIndexOf(","),-1!=c&&(b=h.length-c-1));h=[];for(c=f[0];c;)a=c.length-p,h.push(0<a?c.substr(a):c),c=0<a?c.slice(0,a):"",b&&(p=b,b=void 0);f[0]=h.reverse().join(d.group||",");return f.join(d.decimal||".")};e.regexp=function(f){return e._parseInfo(f).regexp};e._parseInfo=function(f){f=f||{};var l=b.normalizeLocale(f.locale),l=b.getLocalization("dojo.cldr","number",l),d=f.pattern||l[(f.type||"decimal")+"Format"],a=l.group,c=l.decimal,q=1;if(-1!=d.indexOf("%"))q/=100;else if(-1!=d.indexOf("\u2030"))q/=
1E3;else{var p=-1!=d.indexOf("\u00a4");p&&(a=l.currencyGroup||a,c=l.currencyDecimal||c)}l=d.split(";");1==l.length&&l.push("-"+l[0]);l=g.buildGroupRE(l,function(d){d="(?:"+g.escapeString(d,".")+")";return d.replace(e._numberPatternRE,function(d){var l={signed:!1,separator:f.strict?a:[a,""],fractional:f.fractional,decimal:c,exponent:!1};d=d.split(".");var h=f.places;1==d.length&&1!=q&&(d[1]="###");1==d.length||0===h?l.fractional=!1:(void 0===h&&(h=f.pattern?d[1].lastIndexOf("0")+1:Infinity),h&&void 0==
f.fractional&&(l.fractional=!0),!f.places&&h<d[1].length&&(h+=","+d[1].length),l.places=h);d=d[0].split(",");1<d.length&&(l.groupSize=d.pop().length,1<d.length&&(l.groupSize2=d.pop().length));return"("+e._realNumberRegexp(l)+")"})},!0);p&&(l=l.replace(/([\s\xa0]*)(\u00a4{1,3})([\s\xa0]*)/g,function(a,c,d,e){a=g.escapeString(f[["symbol","currency","displayName"][d.length-1]]||f.currency||"");if(!a)return"";c=c?"[\\s\\xa0]":"";e=e?"[\\s\\xa0]":"";return f.strict?c+a+e:(c&&(c+="*"),e&&(e+="*"),"(?:"+
c+a+e+")?")}));return{regexp:l.replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:a,decimal:c,factor:q}};e.parse=function(f,h){h=e._parseInfo(h);f=(new RegExp("^"+h.regexp+"$")).exec(f);if(!f)return NaN;var d=f[1];if(!f[1]){if(!f[2])return NaN;d=f[2];h.factor*=-1}d=d.replace(new RegExp("["+h.group+"\\s\\xa0]","g"),"").replace(h.decimal,".");return d*h.factor};e._realNumberRegexp=function(f){f=f||{};"places"in f||(f.places=Infinity);"string"!=typeof f.decimal&&(f.decimal=".");"fractional"in f&&!/^0/.test(f.places)||
(f.fractional=[!0,!1]);"exponent"in f||(f.exponent=[!0,!1]);"eSigned"in f||(f.eSigned=[!0,!1]);var l=e._integerRegexp(f),d=g.buildGroupRE(f.fractional,function(a){var c="";a&&0!==f.places&&(c="\\"+f.decimal,c=Infinity==f.places?"(?:"+c+"\\d+)?":c+("\\d{"+f.places+"}"));return c},!0),a=g.buildGroupRE(f.exponent,function(a){return a?"([eE]"+e._integerRegexp({signed:f.eSigned})+")":""}),l=l+d;d&&(l="(?:(?:"+l+")|(?:"+d+"))");return l+a};e._integerRegexp=function(e){e=e||{};"signed"in e||(e.signed=[!0,
!1]);"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="";var f=g.buildGroupRE(e.signed,function(a){return a?"[-+]":""},!0),d=g.buildGroupRE(e.separator,function(a){if(!a)return"(?:\\d+)";a=g.escapeString(a);" "==a?a="\\s":"\u00a0"==a&&(a="\\s\\xa0");var c=e.groupSize,d=e.groupSize2;return d?(a="(?:0|[1-9]\\d{0,"+(d-1)+"}(?:["+a+"]\\d{"+d+"})*["+a+"]\\d{"+c+"})",0<c-d?"(?:"+a+"|(?:0|[1-9]\\d{0,"+(c-1)+"}))":a):"(?:0|[1-9]\\d{0,"+(c-1)+"}(?:["+a+"]\\d{"+c+"})*)"},!0);return f+d};return e})},
"dojo/date/locale":function(){define("../_base/lang ../_base/array ../date ../cldr/supplemental ../i18n ../regexp ../string ../i18n!../cldr/nls/gregorian module".split(" "),function(n,b,m,k,g,e,f,l,h){function d(a,c,d,e){return e.replace(/([a-z])\1*/ig,function(l){var h,r,p=l.charAt(0);l=l.length;var b=["abbr","wide","narrow"];switch(p){case "G":h=c[4>l?"eraAbbr":"eraNames"][0>a.getFullYear()?0:1];break;case "y":h=a.getFullYear();switch(l){case 1:break;case 2:if(!d.fullYear){h=String(h);h=h.substr(h.length-
2);break}default:r=!0}break;case "Q":case "q":h=Math.ceil((a.getMonth()+1)/3);r=!0;break;case "M":case "L":h=a.getMonth();3>l?(h+=1,r=!0):(p=["months","L"==p?"standAlone":"format",b[l-3]].join("-"),h=c[p][h]);break;case "w":h=q._getWeekOfYear(a,0);r=!0;break;case "d":h=a.getDate();r=!0;break;case "D":h=q._getDayOfYear(a);r=!0;break;case "e":case "c":if(h=a.getDay(),2>l){h=(h-k.getFirstDayOfWeek(d.locale)+8)%7;break}case "E":h=a.getDay();3>l?(h+=1,r=!0):(p=["days","c"==p?"standAlone":"format",b[l-
3]].join("-"),h=c[p][h]);break;case "a":p=12>a.getHours()?"am":"pm";h=d[p]||c["dayPeriods-format-wide-"+p];break;case "h":case "H":case "K":case "k":r=a.getHours();switch(p){case "h":h=r%12||12;break;case "H":h=r;break;case "K":h=r%12;break;case "k":h=r||24}r=!0;break;case "m":h=a.getMinutes();r=!0;break;case "s":h=a.getSeconds();r=!0;break;case "S":h=Math.round(a.getMilliseconds()*Math.pow(10,l-3));r=!0;break;case "v":case "z":if(h=q._getZone(a,!0,d))break;l=4;case "Z":p=q._getZone(a,!1,d);p=[0>=
p?"+":"-",f.pad(Math.floor(Math.abs(p)/60),2),f.pad(Math.abs(p)%60,2)];4==l&&(p.splice(0,0,"GMT"),p.splice(3,0,":"));h=p.join("");break;default:throw Error("dojo.date.locale.format: invalid pattern char: "+e);}r&&(h=f.pad(h,l));return h})}function a(a,c,d,e){var f=function(a){return a};c=c||f;d=d||f;e=e||f;var l=a.match(/(''|[^'])+/g),h="'"==a.charAt(0);b.forEach(l,function(a,e){a?(l[e]=(h?d:c)(a.replace(/''/g,"'")),h=!h):l[e]=""});return e(l.join(""))}function c(a,c,d,f){f=e.escapeString(f);d.strict||
(f=f.replace(" a"," ?a"));return f.replace(/([a-z])\1*/ig,function(e){var f;f=e.charAt(0);var l=e.length,h="",r="";d.strict?(1<l&&(h="0{"+(l-1)+"}"),2<l&&(r="0{"+(l-2)+"}")):(h="0?",r="0{0,2}");switch(f){case "y":f="\\d{2,4}";break;case "M":case "L":2<l?(f=c["months-"+("L"==f?"standAlone":"format")+"-"+p[l-3]].slice(0).join("|"),d.strict||(f=f.replace(/\./g,""),f="(?:"+f+")\\.?")):f="1[0-2]|"+h+"[1-9]";break;case "D":f="[12][0-9][0-9]|3[0-5][0-9]|36[0-6]|"+h+"[1-9][0-9]|"+r+"[1-9]";break;case "d":f=
"3[01]|[12]\\d|"+h+"[1-9]";break;case "w":f="[1-4][0-9]|5[0-3]|"+h+"[1-9]";break;case "E":case "e":case "c":f=".+?";break;case "h":f="1[0-2]|"+h+"[1-9]";break;case "k":f="1[01]|"+h+"\\d";break;case "H":f="1\\d|2[0-3]|"+h+"\\d";break;case "K":f="1\\d|2[0-4]|"+h+"[1-9]";break;case "m":case "s":f="[0-5]\\d";break;case "S":f="\\d{"+l+"}";break;case "a":l=d.am||c["dayPeriods-format-wide-am"];h=d.pm||c["dayPeriods-format-wide-pm"];f=l+"|"+h;d.strict||(l!=l.toLowerCase()&&(f+="|"+l.toLowerCase()),h!=h.toLowerCase()&&
(f+="|"+h.toLowerCase()),-1!=f.indexOf(".")&&(f+="|"+f.replace(/\./g,"")));f=f.replace(/\./g,"\\.");break;default:f=".*"}a&&a.push(e);return"("+f+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var q={};n.setObject(h.id.replace(/\//g,"."),q);q._getZone=function(a,c,d){return c?m.getTimezoneName(a):a.getTimezoneOffset()};q.format=function(c,e){e=e||{};var f=g.normalizeLocale(e.locale),l=e.formatLength||"short",f=q._getGregorianBundle(f),h=[];c=n.hitch(this,d,c,f,e);if("year"==e.selector)return a(f["dateFormatItem-yyyy"]||
"yyyy",c);var r;"date"!=e.selector&&(r=e.timePattern||f["timeFormat-"+l])&&h.push(a(r,c));"time"!=e.selector&&(r=e.datePattern||f["dateFormat-"+l])&&h.push(a(r,c));return 1==h.length?h[0]:f["dateTimeFormat-"+l].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,c){return h[c]})};q.regexp=function(a){return q._parseInfo(a).regexp};q._parseInfo=function(d){d=d||{};var e=g.normalizeLocale(d.locale),e=q._getGregorianBundle(e),f=d.formatLength||"short",l=d.datePattern||e["dateFormat-"+f],h=d.timePattern||
e["timeFormat-"+f],f="date"==d.selector?l:"time"==d.selector?h:e["dateTimeFormat-"+f].replace(/\{(\d+)\}/g,function(a,c){return[h,l][c]}),r=[];return{regexp:a(f,n.hitch(this,c,r,e,d)),tokens:r,bundle:e}};q.parse=function(a,c){var d=/[\u200E\u200F\u202A\u202E]/g,e=q._parseInfo(c),f=e.tokens,l=e.bundle;a=(new RegExp("^"+e.regexp.replace(d,"")+"$",e.strict?"":"i")).exec(a&&a.replace(d,""));if(!a)return null;var h=["abbr","wide","narrow"],r=[1970,0,1,0,0,0,0],p="";a=b.every(a,function(a,d){if(!d)return!0;
var e=f[d-1];d=e.length;e=e.charAt(0);switch(e){case "y":if(2!=d&&c.strict)r[0]=a;else if(100>a)a=Number(a),e=""+(new Date).getFullYear(),d=100*e.substring(0,2),e=Math.min(Number(e.substring(2,4))+20,99),r[0]=a<e?d+a:d-100+a;else{if(c.strict)return!1;r[0]=a}break;case "M":case "L":if(2<d){if(d=l["months-"+("L"==e?"standAlone":"format")+"-"+h[d-3]].concat(),c.strict||(a=a.replace(".","").toLowerCase(),d=b.map(d,function(a){return a.replace(".","").toLowerCase()})),a=b.indexOf(d,a),-1==a)return!1}else a--;
r[1]=a;break;case "E":case "e":case "c":d=l["days-"+("c"==e?"standAlone":"format")+"-"+h[d-3]].concat();c.strict||(a=a.toLowerCase(),d=b.map(d,function(a){return a.toLowerCase()}));a=b.indexOf(d,a);if(-1==a)return!1;break;case "D":r[1]=0;case "d":r[2]=a;break;case "a":d=c.am||l["dayPeriods-format-wide-am"];e=c.pm||l["dayPeriods-format-wide-pm"];if(!c.strict){var q=/\./g;a=a.replace(q,"").toLowerCase();d=d.replace(q,"").toLowerCase();e=e.replace(q,"").toLowerCase()}if(c.strict&&a!=d&&a!=e)return!1;
p=a==e?"p":a==d?"a":"";break;case "K":24==a&&(a=0);case "h":case "H":case "k":if(23<a)return!1;r[3]=a;break;case "m":r[4]=a;break;case "s":r[5]=a;break;case "S":r[6]=a}return!0});d=+r[3];"p"===p&&12>d?r[3]=d+12:"a"===p&&12==d&&(r[3]=0);d=new Date(r[0],r[1],r[2],r[3],r[4],r[5],r[6]);c.strict&&d.setFullYear(r[0]);var g=f.join(""),e=-1!=g.indexOf("d"),g=-1!=g.indexOf("M");if(!a||g&&d.getMonth()>r[1]||e&&d.getDate()>r[2])return null;if(g&&d.getMonth()<r[1]||e&&d.getDate()<r[2])d=m.add(d,"hour",1);return d};
var p=["abbr","wide","narrow"],t=[],u={};q.addCustomFormats=function(a,c){t.push({pkg:a,name:c});u={}};q._getGregorianBundle=function(a){if(u[a])return u[a];var c={};b.forEach(t,function(d){d=g.getLocalization(d.pkg,d.name,a);c=n.mixin(c,d)},this);return u[a]=c};q.addCustomFormats(h.id.replace(/\/date\/locale$/,".cldr"),"gregorian");q.getNames=function(a,c,d,e){var f;e=q._getGregorianBundle(e);a=[a,d,c];"standAlone"==d&&(d=a.join("-"),f=e[d],1==f[0]&&(f=void 0));a[1]="format";return(f||e[a.join("-")]).concat()};
q.isWeekend=function(a,c){c=k.getWeekend(c);a=(a||new Date).getDay();c.end<c.start&&(c.end+=7,a<c.start&&(a+=7));return a>=c.start&&a<=c.end};q._getDayOfYear=function(a){return m.difference(new Date(a.getFullYear(),0,1,a.getHours()),a)+1};q._getWeekOfYear=function(a,c){1==arguments.length&&(c=0);var d=(new Date(a.getFullYear(),0,1)).getDay(),e=(d-c+7)%7,e=Math.floor((q._getDayOfYear(a)+e-1)/7);d==c&&e++;return e};return q})},"dojo/date":function(){define(["./has","./_base/lang"],function(n,b){var m=
{getDaysInMonth:function(b){var g=b.getMonth();return 1==g&&m.isLeapYear(b)?29:[31,28,31,30,31,30,31,31,30,31,30,31][g]},isLeapYear:function(b){b=b.getFullYear();return!(b%400)||!(b%4)&&!!(b%100)},getTimezoneName:function(b){var g=b.toString(),e="",f=g.indexOf("(");if(-1<f)e=g.substring(++f,g.indexOf(")"));else if(f=/([A-Z\/]+) \d{4}$/,g=g.match(f))e=g[1];else if(g=b.toLocaleString(),f=/ ([A-Z\/]+)$/,g=g.match(f))e=g[1];return"AM"==e||"PM"==e?"":e},compare:function(b,g,e){b=new Date(+b);g=new Date(+(g||
new Date));"date"==e?(b.setHours(0,0,0,0),g.setHours(0,0,0,0)):"time"==e&&(b.setFullYear(0,0,0),g.setFullYear(0,0,0));return b>g?1:b<g?-1:0},add:function(b,g,e){var f=new Date(+b),l=!1,h="Date";switch(g){case "day":break;case "weekday":var d;(g=e%5)?d=parseInt(e/5):(g=0<e?5:-5,d=0<e?(e-5)/5:(e+5)/5);var a=b.getDay(),c=0;6==a&&0<e?c=1:0==a&&0>e&&(c=-1);a+=g;if(0==a||6==a)c=0<e?2:-2;e=7*d+g+c;break;case "year":h="FullYear";l=!0;break;case "week":e*=7;break;case "quarter":e*=3;case "month":l=!0;h="Month";
break;default:h="UTC"+g.charAt(0).toUpperCase()+g.substring(1)+"s"}if(h)f["set"+h](f["get"+h]()+e);l&&f.getDate()<b.getDate()&&f.setDate(0);return f},difference:function(b,g,e){g=g||new Date;e=e||"day";var f=g.getFullYear()-b.getFullYear(),l=1;switch(e){case "quarter":b=b.getMonth();g=g.getMonth();l=Math.floor(g/3)+1+4*f-(Math.floor(b/3)+1);break;case "weekday":f=Math.round(m.difference(b,g,"day"));e=parseInt(m.difference(b,g,"week"));if(0==f%7)f=5*e;else{var l=0,h=b.getDay(),d=g.getDay();e=parseInt(f/
7);g=f%7;b=new Date(b);b.setDate(b.getDate()+7*e);b=b.getDay();if(0<f)switch(!0){case 6==h:l=-1;break;case 0==h:l=0;break;case 6==d:l=-1;break;case 0==d:l=-2;break;case 5<b+g:l=-2}else if(0>f)switch(!0){case 6==h:l=0;break;case 0==h:l=1;break;case 6==d:l=2;break;case 0==d:l=1;break;case 0>b+g:l=2}f=f+l-2*e}l=f;break;case "year":l=f;break;case "month":l=g.getMonth()-b.getMonth()+12*f;break;case "week":l=parseInt(m.difference(b,g,"day")/7);break;case "day":l/=24;case "hour":l/=60;case "minute":l/=60;
case "second":l/=1E3;case "millisecond":l*=g.getTime()-b.getTime()}return Math.round(l)}};b.mixin(b.getObject("dojo.date",!0),m);return m})},"dojo/cldr/supplemental":function(){define(["../_base/lang","../i18n"],function(n,b){var m={};n.setObject("dojo.cldr.supplemental",m);m.getFirstDayOfWeek=function(b){b={bd:5,mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,iq:6,ir:6,jo:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,sy:6,ye:6,ag:0,ar:0,as:0,au:0,br:0,bs:0,bt:0,bw:0,by:0,bz:0,ca:0,cn:0,co:0,dm:0,"do":0,et:0,gt:0,gu:0,
hk:0,hn:0,id:0,ie:0,il:0,"in":0,jm:0,jp:0,ke:0,kh:0,kr:0,la:0,mh:0,mm:0,mo:0,mt:0,mx:0,mz:0,ni:0,np:0,nz:0,pa:0,pe:0,ph:0,pk:0,pr:0,py:0,sg:0,sv:0,th:0,tn:0,tt:0,tw:0,um:0,us:0,ve:0,vi:0,ws:0,za:0,zw:0}[m._region(b)];return void 0===b?1:b};m._region=function(k){k=b.normalizeLocale(k);k=k.split("-");var g=k[1];g?4==g.length&&(g=k[2]):g={aa:"et",ab:"ge",af:"za",ak:"gh",am:"et",ar:"eg",as:"in",av:"ru",ay:"bo",az:"az",ba:"ru",be:"by",bg:"bg",bi:"vu",bm:"ml",bn:"bd",bo:"cn",br:"fr",bs:"ba",ca:"es",ce:"ru",
ch:"gu",co:"fr",cr:"ca",cs:"cz",cv:"ru",cy:"gb",da:"dk",de:"de",dv:"mv",dz:"bt",ee:"gh",el:"gr",en:"us",es:"es",et:"ee",eu:"es",fa:"ir",ff:"sn",fi:"fi",fj:"fj",fo:"fo",fr:"fr",fy:"nl",ga:"ie",gd:"gb",gl:"es",gn:"py",gu:"in",gv:"gb",ha:"ng",he:"il",hi:"in",ho:"pg",hr:"hr",ht:"ht",hu:"hu",hy:"am",ia:"fr",id:"id",ig:"ng",ii:"cn",ik:"us","in":"id",is:"is",it:"it",iu:"ca",iw:"il",ja:"jp",ji:"ua",jv:"id",jw:"id",ka:"ge",kg:"cd",ki:"ke",kj:"na",kk:"kz",kl:"gl",km:"kh",kn:"in",ko:"kr",ks:"in",ku:"tr",kv:"ru",
kw:"gb",ky:"kg",la:"va",lb:"lu",lg:"ug",li:"nl",ln:"cd",lo:"la",lt:"lt",lu:"cd",lv:"lv",mg:"mg",mh:"mh",mi:"nz",mk:"mk",ml:"in",mn:"mn",mo:"ro",mr:"in",ms:"my",mt:"mt",my:"mm",na:"nr",nb:"no",nd:"zw",ne:"np",ng:"na",nl:"nl",nn:"no",no:"no",nr:"za",nv:"us",ny:"mw",oc:"fr",om:"et",or:"in",os:"ge",pa:"in",pl:"pl",ps:"af",pt:"br",qu:"pe",rm:"ch",rn:"bi",ro:"ro",ru:"ru",rw:"rw",sa:"in",sd:"in",se:"no",sg:"cf",si:"lk",sk:"sk",sl:"si",sm:"ws",sn:"zw",so:"so",sq:"al",sr:"rs",ss:"za",st:"za",su:"id",sv:"se",
sw:"tz",ta:"in",te:"in",tg:"tj",th:"th",ti:"et",tk:"tm",tl:"ph",tn:"za",to:"to",tr:"tr",ts:"za",tt:"ru",ty:"pf",ug:"cn",uk:"ua",ur:"pk",uz:"uz",ve:"za",vi:"vn",wa:"be",wo:"sn",xh:"za",yi:"il",yo:"ng",za:"cn",zh:"cn",zu:"za",ace:"id",ady:"ru",agq:"cm",alt:"ru",amo:"ng",asa:"tz",ast:"es",awa:"in",bal:"pk",ban:"id",bas:"cm",bax:"cm",bbc:"id",bem:"zm",bez:"tz",bfq:"in",bft:"pk",bfy:"in",bhb:"in",bho:"in",bik:"ph",bin:"ng",bjj:"in",bku:"ph",bqv:"ci",bra:"in",brx:"in",bss:"cm",btv:"pk",bua:"ru",buc:"yt",
bug:"id",bya:"id",byn:"er",cch:"ng",ccp:"in",ceb:"ph",cgg:"ug",chk:"fm",chm:"ru",chp:"ca",chr:"us",cja:"kh",cjm:"vn",ckb:"iq",crk:"ca",csb:"pl",dar:"ru",dav:"ke",den:"ca",dgr:"ca",dje:"ne",doi:"in",dsb:"de",dua:"cm",dyo:"sn",dyu:"bf",ebu:"ke",efi:"ng",ewo:"cm",fan:"gq",fil:"ph",fon:"bj",fur:"it",gaa:"gh",gag:"md",gbm:"in",gcr:"gf",gez:"et",gil:"ki",gon:"in",gor:"id",grt:"in",gsw:"ch",guz:"ke",gwi:"ca",haw:"us",hil:"ph",hne:"in",hnn:"ph",hoc:"in",hoj:"in",ibb:"ng",ilo:"ph",inh:"ru",jgo:"cm",jmc:"tz",
kaa:"uz",kab:"dz",kaj:"ng",kam:"ke",kbd:"ru",kcg:"ng",kde:"tz",kdt:"th",kea:"cv",ken:"cm",kfo:"ci",kfr:"in",kha:"in",khb:"cn",khq:"ml",kht:"in",kkj:"cm",kln:"ke",kmb:"ao",koi:"ru",kok:"in",kos:"fm",kpe:"lr",krc:"ru",kri:"sl",krl:"ru",kru:"in",ksb:"tz",ksf:"cm",ksh:"de",kum:"ru",lag:"tz",lah:"pk",lbe:"ru",lcp:"cn",lep:"in",lez:"ru",lif:"np",lis:"cn",lki:"ir",lmn:"in",lol:"cd",lua:"cd",luo:"ke",luy:"ke",lwl:"th",mad:"id",mag:"in",mai:"in",mak:"id",man:"gn",mas:"ke",mdf:"ru",mdh:"ph",mdr:"id",men:"sl",
mer:"ke",mfe:"mu",mgh:"mz",mgo:"cm",min:"id",mni:"in",mnk:"gm",mnw:"mm",mos:"bf",mua:"cm",mwr:"in",myv:"ru",nap:"it",naq:"na",nds:"de","new":"np",niu:"nu",nmg:"cm",nnh:"cm",nod:"th",nso:"za",nus:"sd",nym:"tz",nyn:"ug",pag:"ph",pam:"ph",pap:"bq",pau:"pw",pon:"fm",prd:"ir",raj:"in",rcf:"re",rej:"id",rjs:"np",rkt:"in",rof:"tz",rwk:"tz",saf:"gh",sah:"ru",saq:"ke",sas:"id",sat:"in",saz:"in",sbp:"tz",scn:"it",sco:"gb",sdh:"ir",seh:"mz",ses:"ml",shi:"ma",shn:"mm",sid:"et",sma:"se",smj:"se",smn:"fi",sms:"fi",
snk:"ml",srn:"sr",srr:"sn",ssy:"er",suk:"tz",sus:"gn",swb:"yt",swc:"cd",syl:"bd",syr:"sy",tbw:"ph",tcy:"in",tdd:"cn",tem:"sl",teo:"ug",tet:"tl",tig:"er",tiv:"ng",tkl:"tk",tmh:"ne",tpi:"pg",trv:"tw",tsg:"ph",tts:"th",tum:"mw",tvl:"tv",twq:"ne",tyv:"ru",tzm:"ma",udm:"ru",uli:"fm",umb:"ao",unr:"in",unx:"in",vai:"lr",vun:"tz",wae:"ch",wal:"et",war:"ph",xog:"ug",xsr:"np",yao:"mz",yap:"fm",yav:"cm",zza:"tr"}[k[0]];return g};m.getWeekend=function(b){var g=m._region(b);b={"in":0,af:4,dz:4,ir:4,om:4,sa:4,
ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,tn:5}[g];g={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6}[g];void 0===b&&(b=6);void 0===g&&(g=0);return{start:b,end:g}};return m})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],function(n){n=n.getObject("dojox.encoding.base64",!0);n.encode=function(b){for(var m=[],k=b.length,g=k%3,k=k-g,e=0;e<k;){var f=b[e++]<<16|b[e++]<<8|b[e++];m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>>
18&63));m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>>12&63));m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>>6&63));m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f&63))}switch(g){case 2:f=b[e++]<<16|b[e++]<<8;m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>>18&63));m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>>12&
63));m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>>6&63));m.push("\x3d");break;case 1:f=b[e++]<<16,m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>>18&63)),m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>>12&63)),m.push("\x3d"),m.push("\x3d")}return m.join("")};n.decode=function(b){b=b.split("");for(var m=[],k=b.length;"\x3d"==b[--k];);for(var g=0;g<k;){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[g++])<<
18;g<=k&&(e|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[g++])<<12);g<=k&&(e|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[g++])<<6);g<=k&&(e|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[g++]));m.push(e>>>16&255);m.push(e>>>8&255);m.push(e&255)}for(;0==m[m.length-1];)m.pop();return m};return n})},"esri/tasks/GeometryService":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/tsSupport/assignHelper ../geometry ../request ../core/jsonMap ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../geometry/support/jsonUtils ./Task ./operations/generalize ./operations/lengths ./operations/offset ./operations/relation ./operations/trimExtend ./support/GeneralizeParameters ./support/LengthsParameters ./support/OffsetParameters ./support/ProjectParameters ./support/RelationParameters ./support/TrimExtendParameters".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B){var C=new h.JSONMap({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"}),F=a.ensureType(y);return function(a){function h(c){c=a.call(this,c)||this;c.url=null;return c}m(h,a);h.prototype.areasAndLengths=function(a,c){a=e({},this.parsedUrl.query,{f:"json"},a.toJSON());c=this._asValidOptions(a,c);return l(this.parsedUrl.path+"/areasAndLengths",c).then(function(a){return a.data})};h.prototype.autoComplete=
function(a,c,d){var h=a[0].spatialReference;a=e({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(h.toJSON()),polygons:JSON.stringify(this._encodeGeometries(a).geometries),polylines:JSON.stringify(this._encodeGeometries(c).geometries)});d=this._asValidOptions(a,d);return l(this.parsedUrl.path+"/autoComplete",d).then(function(a){return(a.data.geometries||[]).map(function(a){return new f.Polygon({spatialReference:h,rings:a.rings})})})};h.prototype.buffer=function(a,c){var d=e({},this.parsedUrl.query,
{f:"json"},a.toJSON()),h=a.outSpatialReference||a.geometries[0].spatialReference;a=this._asValidOptions(d,c);return l(this.parsedUrl.path+"/buffer",a).then(function(a){return(a.data.geometries||[]).map(function(a){return new f.Polygon({spatialReference:h,rings:a.rings})})})};h.prototype.convexHull=function(a,d){var f=a[0].spatialReference;a=e({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(f.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a))});d=this._asValidOptions(a,d);return l(this.parsedUrl.path+
"/convexHull",d).then(function(a){return c.fromJSON(a.data.geometry).set({spatialReference:f})})};h.prototype.cut=function(a,d,f){var h=a[0].spatialReference,r=a.map(function(a){return a.toJSON()});a=e({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(h.toJSON()),target:JSON.stringify({geometryType:c.getJsonType(a[0]),geometries:r}),cutter:JSON.stringify(d.toJSON())});f=this._asValidOptions(a,f);return l(this.parsedUrl.path+"/cut",f).then(function(a){a=a.data;return{cutIndexes:a.cutIndexes,geometries:(a.geometries||
[]).map(function(a){return c.fromJSON(a).set({spatialReference:h})})}})};h.prototype.densify=function(a,d){var f=a.geometries[0].spatialReference;a=e({},this.parsedUrl.query,{f:"json"},a.toJSON());d=this._asValidOptions(a,d);return l(this.parsedUrl.path+"/densify",d).then(function(a){return(a.data.geometries||[]).map(function(a){return c.fromJSON(a).set({spatialReference:f})})})};h.prototype.difference=function(a,d,f){var h=a[0].spatialReference;a={query:e({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(h.toJSON()),
geometries:JSON.stringify(this._encodeGeometries(a)),geometry:JSON.stringify({geometryType:c.getJsonType(d),geometry:d.toJSON()})})};if(this.requestOptions||f)a=e({},this.requestOptions,f,a);return l(this.parsedUrl.path+"/difference",a).then(function(a){return(a.data.geometries||[]).map(function(a){return c.fromJSON(a).set({spatialReference:h})})})};h.prototype.distance=function(a,c){a=e({},this.parsedUrl.query,{f:"json"},a.toJSON());c=this._asValidOptions(a,c);return l(this.parsedUrl.path+"/distance",
c).then(function(a){return(a=a.data)&&a.distance})};h.prototype.fromGeoCoordinateString=function(a,c){var d={};d.sr=null!=a.sr&&"object"===typeof a.sr?a.sr.wkid||JSON.stringify(a.sr):a.sr;d.strings=JSON.stringify(a.strings);d.conversionType=C.toJSON(a.conversionType||"mgrs");d.conversionMode=a.conversionMode;a=e({},this.parsedUrl.query,{f:"json"},d);c=this._asValidOptions(a,c);return l(this.parsedUrl.path+"/fromGeoCoordinateString",c).then(function(a){return a.data.coordinates})};h.prototype.generalize=
function(a,d){a=w.from(a);var f=a.toJSON();a=p.generalizeToRESTParameters(a);a=e({},this.parsedUrl.query,{f:"json"},a);var h=f.geometries[0].spatialReference;d=this._asValidOptions(a,d);return l(this.parsedUrl.path+"/generalize",d).then(function(a){return(a.data.geometries||[]).map(function(a){return c.fromJSON(a).set({spatialReference:h})})})};h.prototype.intersect=function(a,d,f){var h=a[0].spatialReference;a=e({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(h.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a)),
geometry:JSON.stringify({geometryType:c.getJsonType(d),geometry:d.toJSON()})});f=this._asValidOptions(a,f);return l(this.parsedUrl.path+"/intersect",f).then(function(a){return(a.data.geometries||[]).map(function(a){return c.fromJSON(a).set({spatialReference:h})})})};h.prototype.labelPoints=function(a,d){var f=a.map(function(a){return a.toJSON()}),h=a[0].spatialReference;a=e({},this.parsedUrl.query,{f:"json",sr:h.wkid?h.wkid:JSON.stringify(h.toJSON()),polygons:JSON.stringify(f)});d=this._asValidOptions(a,
d);return l(this.parsedUrl.path+"/labelPoints",d).then(function(a){return(a.data.labelPoints||[]).map(function(a){return c.fromJSON(a).set({spatialReference:h})})})};h.prototype.lengths=function(a,c){a=v.from(a);a=t.lengthsToRESTParameters(a);a=e({},this.parsedUrl.query,{f:"json"},a);c=this._asValidOptions(a,c);return l(this.parsedUrl.path+"/lengths",c).then(function(a){return a.data})};h.prototype.offset=function(a,d){a=z.from(a);var f=u.offsetToRESTParameters(a),f=e({},this.parsedUrl.query,{f:"json"},
f),h=a.geometries[0].spatialReference;a=this._asValidOptions(f,d);return l(this.parsedUrl.path+"/offset",a).then(function(a){return(a.data.geometries||[]).map(function(a){return c.fromJSON(a).set({spatialReference:h})})})};h.prototype.project=function(a,d){var f=this;a=F(a);var h=e({},this.parsedUrl.query,{f:"json"},a.toJSON()),r=a.outSpatialReference,p=c.getJsonType(a.geometries[0]);a=this._asValidOptions(h,d);return l(this.parsedUrl.path+"/project",a).then(function(a){return f._decodeGeometries(a.data,
p,r)})};h.prototype.relation=function(a,c){a=A.from(a);a=r.relationToRESTParameters(a);a=e({},this.parsedUrl.query,{f:"json"},a);c=this._asValidOptions(a,c);return l(this.parsedUrl.path+"/relation",c).then(function(a){return a.data.relations})};h.prototype.reshape=function(a,d,f){var h=a.spatialReference;a=e({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(h.toJSON()),target:JSON.stringify({geometryType:c.getJsonType(a),geometry:a.toJSON()}),reshaper:JSON.stringify(d.toJSON())});f=this._asValidOptions(a,
f);return l(this.parsedUrl.path+"/reshape",f).then(function(a){return c.fromJSON(a.data.geometry).set({spatialReference:h})})};h.prototype.simplify=function(a,d){var f=this,h=a[0].spatialReference,r=e({},this.parsedUrl.query,{f:"json",sr:h.wkid?h.wkid:JSON.stringify(h.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a))}),p=c.getJsonType(a[0]);a=this._asValidOptions(r,d);return l(this.parsedUrl.path+"/simplify",a).then(function(a){return f._decodeGeometries(a.data,p,h)})};h.prototype.toGeoCoordinateString=
function(a,c){var d={};d.sr=null!=a.sr&&"object"===typeof a.sr?a.sr.wkid||JSON.stringify(a.sr):a.sr;d.coordinates=JSON.stringify(a.coordinates);d.conversionType=C.toJSON(a.conversionType||"mgrs");d.conversionMode=a.conversionMode;d.numOfDigits=a.numOfDigits;d.rounding=a.rounding;d.addSpaces=a.addSpaces;a=e({},this.parsedUrl.query,{f:"json"},d);c=this._asValidOptions(a,c);return l(this.parsedUrl.path+"/toGeoCoordinateString",c).then(function(a){return a.data.strings})};h.prototype.trimExtend=function(a,
c){a=B.from(a);var d=x.trimExtendToRESTParameters(a),d=e({},this.parsedUrl.query,{f:"json"},d),h=a.sr;a=this._asValidOptions(d,c);return l(this.parsedUrl.path+"/trimExtend",a).then(function(a){return(a.data.geometries||[]).map(function(a){return new f.Polyline({spatialReference:h,paths:a.paths})})})};h.prototype.union=function(a,d){var f=a[0].spatialReference;a=e({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(f.toJSON()),geometries:JSON.stringify(this._encodeGeometries(a))});d=this._asValidOptions(a,
d);return l(this.parsedUrl.path+"/union",d).then(function(a){return c.fromJSON(a.data.geometry).set({spatialReference:f})})};h.prototype._asValidOptions=function(a,c){a={query:a};if(this.requestOptions||c)a=e({},this.requestOptions,c,a);return a};h.prototype._encodeGeometries=function(a){for(var d=[],e=a.length,f=0;f<e;f++)d.push(a[f].toJSON());return{geometryType:c.getJsonType(a[0]),geometries:d}};h.prototype._decodeGeometries=function(a,d,f){var h=c.getGeometryType(d);a=a.geometries;var l=[],r=
{spatialReference:f.toJSON()};a.forEach(function(a,c){l[c]=new h(e({},a,r))});return l};h.prototype._toProjectGeometry=function(a){var c=a.spatialReference.toJSON();return a instanceof f.Extent?new f.Polygon({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:c}):new f.Polyline({paths:[[].concat(a.points)],spatialReference:c})};h.prototype._fromProjectedGeometry=function(a,c,d){return"extent"===c?(a=a.rings[0],new f.Extent(a[0][0],a[0][1],a[2][0],
a[2][1],d)):new f.Multipoint({points:a.paths[0],spatialReference:d.toJSON()})};h.UNIT_METER=9001;h.UNIT_GERMAN_METER=9031;h.UNIT_FOOT=9002;h.UNIT_SURVEY_FOOT=9003;h.UNIT_CLARKE_FOOT=9005;h.UNIT_FATHOM=9014;h.UNIT_NAUTICAL_MILE=9030;h.UNIT_SURVEY_CHAIN=9033;h.UNIT_SURVEY_LINK=9034;h.UNIT_SURVEY_MILE=9035;h.UNIT_KILOMETER=9036;h.UNIT_CLARKE_YARD=9037;h.UNIT_CLARKE_CHAIN=9038;h.UNIT_CLARKE_LINK=9039;h.UNIT_SEARS_YARD=9040;h.UNIT_SEARS_FOOT=9041;h.UNIT_SEARS_CHAIN=9042;h.UNIT_SEARS_LINK=9043;h.UNIT_BENOIT_1895A_YARD=
9050;h.UNIT_BENOIT_1895A_FOOT=9051;h.UNIT_BENOIT_1895A_CHAIN=9052;h.UNIT_BENOIT_1895A_LINK=9053;h.UNIT_BENOIT_1895B_YARD=9060;h.UNIT_BENOIT_1895B_FOOT=9061;h.UNIT_BENOIT_1895B_CHAIN=9062;h.UNIT_BENOIT_1895B_LINK=9063;h.UNIT_INDIAN_FOOT=9080;h.UNIT_INDIAN_1937_FOOT=9081;h.UNIT_INDIAN_1962_FOOT=9082;h.UNIT_INDIAN_1975_FOOT=9083;h.UNIT_INDIAN_YARD=9084;h.UNIT_INDIAN_1937_YARD=9085;h.UNIT_INDIAN_1962_YARD=9086;h.UNIT_INDIAN_1975_YARD=9087;h.UNIT_FOOT_1865=9070;h.UNIT_RADIAN=9101;h.UNIT_DEGREE=9102;h.UNIT_ARCMINUTE=
9103;h.UNIT_ARCSECOND=9104;h.UNIT_GRAD=9105;h.UNIT_GON=9106;h.UNIT_MICRORADIAN=9109;h.UNIT_ARCMINUTE_CENTESIMAL=9112;h.UNIT_ARCSECOND_CENTESIMAL=9113;h.UNIT_MIL6400=9114;h.UNIT_BRITISH_1936_FOOT=9095;h.UNIT_GOLDCOAST_FOOT=9094;h.UNIT_INTERNATIONAL_CHAIN=109003;h.UNIT_INTERNATIONAL_LINK=109004;h.UNIT_INTERNATIONAL_YARD=109001;h.UNIT_STATUTE_MILE=9093;h.UNIT_SURVEY_YARD=109002;h.UNIT_50KILOMETER_LENGTH=109030;h.UNIT_150KILOMETER_LENGTH=109031;h.UNIT_DECIMETER=109005;h.UNIT_CENTIMETER=109006;h.UNIT_MILLIMETER=
109007;h.UNIT_INTERNATIONAL_INCH=109008;h.UNIT_US_SURVEY_INCH=109009;h.UNIT_INTERNATIONAL_ROD=109010;h.UNIT_US_SURVEY_ROD=109011;h.UNIT_US_NAUTICAL_MILE=109012;h.UNIT_UK_NAUTICAL_MILE=109013;h.UNIT_SQUARE_INCHES="esriSquareInches";h.UNIT_SQUARE_FEET="esriSquareFeet";h.UNIT_SQUARE_YARDS="esriSquareYards";h.UNIT_ACRES="esriAcres";h.UNIT_SQUARE_MILES="esriSquareMiles";h.UNIT_SQUARE_MILLIMETERS="esriSquareMillimeters";h.UNIT_SQUARE_CENTIMETERS="esriSquareCentimeters";h.UNIT_SQUARE_DECIMETERS="esriSquareDecimeters";
h.UNIT_SQUARE_METERS="esriSquareMeters";h.UNIT_ARES="esriAres";h.UNIT_HECTARES="esriHectares";h.UNIT_SQUARE_KILOMETERS="esriSquareKilometers";k([d.property()],h.prototype,"url",void 0);return h=k([d.subclass("esri.tasks.GeometryService")],h)}(d.declared(q))})},"esri/tasks/operations/generalize":function(){define(["require","exports","../../core/jsonMap","../../geometry/support/jsonUtils"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});var g=new m.default({109006:"centimeters",
9102:"decimal-degrees",109005:"decimeters",9002:"feet",109009:"inches",9036:"kilometers",9001:"meters",9035:"miles",109007:"millimeters",109012:"nautical-miles",9096:"yards"});b.generalizeToRESTParameters=function(e){var f=e.toJSON();e=f.geometries;var l=f.deviationUnit,f={maxDeviation:f.maxDeviation};e&&e.length&&(f.geometries=JSON.stringify({geometryType:k.getJsonType(e[0]),geometries:e}),f.sr=JSON.stringify(e[0].spatialReference));g.write(l,f,"deviationUnit");return f}})},"esri/tasks/operations/lengths":function(){define(["require",
"exports","../../core/jsonMap"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});var k=new m.default({preserveShape:"preserve-shape"});b.lengthsToRESTParameters=function(b){var e=b.toJSON(),f=e.lengthUnit,l=e.geodesic,h=e.calculationType,d={};d.polylines=JSON.stringify(e.polylines);b=b.polylines[0].spatialReference;d.sr=b.wkid?b.wkid:JSON.stringify(b.toJSON());f&&(d.lengthUnit=f);l&&(d.geodesic=l);h&&(d.calculationType=k.toJSON(h));return d}})},"esri/tasks/operations/offset":function(){define(["require",
"exports","../../core/jsonMap","../../geometry/support/jsonUtils"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});var g=new m.default({esriGeometryOffsetBevelled:"bevelled",esriGeometryOffsetMitered:"mitered",esriGeometryOffsetRounded:"rounded"}),e=new m.default({9001:"meters",9002:"feet",9036:"kilometers",9093:"miles",109012:"nautical-miles",109001:"yards"});b.offsetToRESTParameters=function(f){var l=f.toJSON();f=l.geometries;var h=l.offsetHow,d=l.offsetUnit,l={bevelRatio:l.bevelRatio,
offsetDistance:l.offsetDistance};f&&f.length&&(l.geometries=JSON.stringify({geometryType:k.getJsonType(f[0]),geometries:f}),l.sr=JSON.stringify(f[0].spatialReference));h&&(l.offsetHow=g.toJSON(h));d&&(l.offsetUnit=e.toJSON(d));return l}})},"esri/tasks/operations/relation":function(){define(["require","exports","../../core/jsonMap","../../geometry/support/jsonUtils"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});var g=new m.default({esriGeometryRelationCross:"cross",esriGeometryRelationDisjoint:"disjoint",
esriGeometryRelationIn:"in",esriGeometryRelationInteriorIntersection:"interior-intersection",esriGeometryRelationIntersection:"intersection",esriGeometryRelationLineCoincidence:"line-coincidence",esriGeometryRelationLineTouch:"line-touch",esriGeometryRelationOverlap:"overlap",esriGeometryRelationPointTouch:"point-touch",esriGeometryRelationTouch:"touch",esriGeometryRelationWithin:"within",esriGeometryRelationRelation:"relation"});b.relationToRESTParameters=function(e){var f=e.toJSON(),l=f.geometries1;
e=f.geometries2;var h=f.relation,f=f.relationParameter,d={};l&&l.length&&(d.geometries1=JSON.stringify({geometryType:k.getJsonType(l[0]),geometries:l}),l=l[0].spatialReference,d.sr=l.wkid?l.wkid:JSON.stringify(l));e&&0<e.length&&(d.geometries2=JSON.stringify({geometryType:k.getJsonType(e[0]),geometries:e}));h&&(d.relation=g.toJSON(h));f&&(d.relationParam=f);return d}})},"esri/tasks/operations/trimExtend":function(){define(["require","exports","../../core/jsonMap"],function(n,b,m){Object.defineProperty(b,
"__esModule",{value:!0});var k=new m.default({0:"default-curve-extension",1:"relocate-ends",2:"keep-end-attributes",4:"no-end-attributes",8:"no-extend-at-from",16:"no-extend-at-to"});b.trimExtendToRESTParameters=function(b){b=b.toJSON();var e=b.polylines,f=b.trimExtendTo,l={};l.extendHow=k.toJSON(b.extendHow);e&&e.length&&(l.polylines=JSON.stringify(e),l.sr=JSON.stringify(e[0].spatialReference));f&&(l.trimExtendTo=JSON.stringify(f));return l}})},"esri/tasks/support/GeneralizeParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils".split(" "),
function(n,b,m,k,g,e,f,l){n=function(f){function d(a){a=f.call(this,a)||this;a.deviationUnit=null;a.geometries=null;a.maxDeviation=null;return a}m(d,f);k([e.property({type:String,json:{write:!0}})],d.prototype,"deviationUnit",void 0);k([e.property({json:{read:{reader:function(a){return a?a.map(function(a){return l.fromJSON(a)}):null}},write:{writer:function(a,c){c.geometries=a.map(function(a){return a.toJSON()})}}}})],d.prototype,"geometries",void 0);k([e.property({type:Number,json:{write:!0}})],
d.prototype,"maxDeviation",void 0);return d=k([e.subclass("esri.tasks.support.GeneralizeParameters")],d)}(e.declared(g.JSONSupport));n.from=f.default(n);return n})},"esri/tasks/support/LengthsParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils".split(" "),function(n,b,m,k,g,e,f,l,
h){n=function(d){function a(a){a=d.call(this,a)||this;a.calculationType=null;a.geodesic=null;a.lengthUnit=null;a.polylines=null;return a}m(a,d);k([f.property({type:String,json:{write:!0}})],a.prototype,"calculationType",void 0);k([f.property({type:Boolean,json:{write:!0}})],a.prototype,"geodesic",void 0);k([f.property({json:{write:!0}})],a.prototype,"lengthUnit",void 0);k([f.property({type:[g.Polyline],json:{read:{reader:function(a){return a?a.map(function(a){return h.fromJSON(a)}):null}},write:{writer:function(a,
d){d.polylines=a.map(function(a){return a.toJSON()})}}}})],a.prototype,"polylines",void 0);return a=k([f.subclass("esri.tasks.support.LengthsParameters")],a)}(f.declared(e.JSONSupport));n.from=l.default(n);return n})},"esri/tasks/support/OffsetParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils".split(" "),
function(n,b,m,k,g,e,f,l){n=function(f){function d(a){a=f.call(this,a)||this;a.bevelRatio=null;a.geometries=null;a.offsetDistance=null;a.offsetHow=null;a.offsetUnit=null;return a}m(d,f);k([e.property({type:Number,json:{write:!0}})],d.prototype,"bevelRatio",void 0);k([e.property({json:{read:{reader:function(a){return a?a.map(function(a){return l.fromJSON(a)}):null}},write:{writer:function(a,c){c.geometries=a.map(function(a){return a.toJSON()})}}}})],d.prototype,"geometries",void 0);k([e.property({type:Number,
json:{write:!0}})],d.prototype,"offsetDistance",void 0);k([e.property({type:String,json:{write:!0}})],d.prototype,"offsetHow",void 0);k([e.property({type:String,json:{write:!0}})],d.prototype,"offsetUnit",void 0);return d=k([e.subclass("esri.tasks.support.OffsetParameters")],d)}(e.declared(g.JSONSupport));n.from=f.default(n);return n})},"esri/tasks/support/ProjectParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/jsonUtils".split(" "),
function(n,b,m,k,g,e,f,l){var h=e.getLogger("esri.tasks.support.ProjectParameters");return function(d){function a(a){a=d.call(this,a)||this;a.geometries=null;a.outSpatialReference=null;a.transformation=null;a.transformForward=null;return a}m(a,d);Object.defineProperty(a.prototype,"outSR",{get:function(){h.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");return this.outSpatialReference},set:function(a){h.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");
this.outSpatialReference=a},enumerable:!0,configurable:!0});a.prototype.toJSON=function(){var a=this.geometries.map(function(a){return a.toJSON()}),d=this.geometries[0],e={};e.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());e.inSR=d.spatialReference.wkid||JSON.stringify(d.spatialReference.toJSON());e.geometries=JSON.stringify({geometryType:l.getJsonType(d),geometries:a});this.transformation&&(e.transformation=this.transformation.wkid||JSON.stringify(this.transformation));
null!=this.transformForward&&(e.transformForward=this.transformForward);return e};k([f.property()],a.prototype,"geometries",void 0);k([f.property({json:{read:{source:"outSR"}}})],a.prototype,"outSpatialReference",void 0);k([f.property({json:{read:!1}})],a.prototype,"outSR",null);k([f.property()],a.prototype,"transformation",void 0);k([f.property()],a.prototype,"transformForward",void 0);return a=k([f.subclass("esri.tasks.support.ProjectParameters")],a)}(f.declared(g.JSONSupport))})},"esri/tasks/support/RelationParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils".split(" "),
function(n,b,m,k,g,e,f,l){n=function(f){function d(a){a=f.call(this,a)||this;a.geometries1=null;a.geometries2=null;a.relation=null;a.relationParameter=null;return a}m(d,f);k([e.property({json:{read:{reader:function(a){return a?a.map(function(a){return l.fromJSON(a)}):null}},write:{writer:function(a,c){c.geometries1=a.map(function(a){return a.toJSON()})}}}})],d.prototype,"geometries1",void 0);k([e.property({json:{read:{reader:function(a){return a?a.map(function(a){return l.fromJSON(a)}):null}},write:{writer:function(a,
c){c.geometries2=a.map(function(a){return a.toJSON()})}}}})],d.prototype,"geometries2",void 0);k([e.property({type:String,json:{write:!0}})],d.prototype,"relation",void 0);k([e.property({type:String,json:{write:!0}})],d.prototype,"relationParameter",void 0);return d=k([e.subclass("esri.tasks.support.RelationParameters")],d)}(e.declared(g.JSONSupport));n.from=f.default(n);return n})},"esri/tasks/support/TrimExtendParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils".split(" "),
function(n,b,m,k,g,e,f,l,h){n=function(d){function a(a){a=d.call(this,a)||this;a.extendHow="default-curve-extension";a.polylines=null;a.trimExtendTo=null;return a}m(a,d);k([f.property({type:String,json:{write:!0}})],a.prototype,"extendHow",void 0);k([f.property({type:[g.Polyline],json:{read:{reader:function(a){return a?a.map(function(a){return h.fromJSON(a)}):null}},write:{writer:function(a,d){d.polylines=a.map(function(a){return a.toJSON()})}}}})],a.prototype,"polylines",void 0);k([f.property({json:{read:{reader:function(a){return a?
h.fromJSON(a):null}},write:{writer:function(a,d){d.trimExtendTo=a.toJSON()}}}})],a.prototype,"trimExtendTo",void 0);return a=k([f.subclass("esri.tasks.support.TrimExtendParameters")],a)}(f.declared(e.JSONSupport));n.from=l.default(n);return n})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(n,b){var m=n.clone(b);m.declaredClass="jimu.portalUrlUtils";m.getPortalUrlFromLocation=function(){return m.getPortalServerFromLocation()+m.getDeployContextFromLocation()};
m.getPortalSignInUrlFromLocation=function(){return m.getPortalUrlFromLocation()+"home/signin.html"};m.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};m.getDeployContextFromLocation=function(){var b=window.location.href.split("?")[0],g=b.indexOf("/home/");0>g&&(g=b.indexOf("/apps/"));b=b.substring(b.indexOf(window.location.host)+window.location.host.length+1,g);"/"!==b&&(b="/"+b+"/");return b};m.getRestBaseUrlFromLocation=function(){return window.location.protocol+
"//"+window.location.host+m.getDeployContextFromLocation()+"sharing/rest/"};return m})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var n={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(b){return this.substr(0,b.length)===b});"function"!==typeof String.prototype.endWith&&
(String.prototype.endWith=function(b){return this.substr(this.length-b.length,b.length)===b});n.getServerByUrl=function(b){b=(b||"").trim();b=b.replace(/^(http(s?):?)\/\//gi,"");0===b.indexOf("//")&&(b=b.slice(2));return b.split("/")[0]};n.getServerWithProtocol=function(b){var m="";if(b=(b||"").trim()){var k=n.getServerByUrl(b);if(!k)return m;var g=n.getProtocol(b);g?m=g+"://"+k:0===b.indexOf("//")&&(m="//"+k)}return m};n.isSameServer=function(b,m){b=n.getServerByUrl(b)||"";m=n.getServerByUrl(m)||
"";return b.toLowerCase()===m.toLowerCase()};n.isOnline=function(b){return 0<=n.getServerByUrl(b).toLowerCase().indexOf(".arcgis.com")};n.isArcGIScom=function(b){b=n.getServerByUrl(b).toLowerCase();return"www.arcgis.com"===b||"arcgis.com"===b};n.getStandardPortalUrl=function(b){var m=n.getServerByUrl(b);if(""===m)return"";n.isOnline(m)?(n.isArcGIScom(m)&&(m="www.arcgis.com"),b=n.addProtocol(b),b=n.getProtocol(b)+"://"+m):(b=(b||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),b=n.addProtocol(b),
b.replace(new RegExp("http(s?)://"+m,"g"),"")||(b+="/arcgis"));return b};n.isSamePortalUrl=function(b,m){var k=/^http(s?):\/\//gi,g=/^\/\//gi;b=n.getStandardPortalUrl(b).toLowerCase().replace(k,"").replace(g,"");m=n.getStandardPortalUrl(m).toLowerCase().replace(k,"").replace(g,"");return b===m};n.addProtocol=function(b){if(-1>=b.toLowerCase().indexOf("http://")&&-1>=b.toLowerCase().indexOf("https://")){var m="";"undefined"!==typeof window&&window.location?(m=window.location.protocol,b=b.startWith("//")?
m+b:b.startWith("/")?m+"//"+window.location.host+b:m+"//"+b):(m="http:",b.startWith("//")&&(b=m+b))}return b};n.getProtocol=function(b){var m="";b=b.toLowerCase();0===b.indexOf("https://")?m="https":0===b.indexOf("http://")&&(m="http");return m};n.updateUrlProtocolByOtherUrl=function(b,m){m=m.toLowerCase();0===m.indexOf("https://")?b=n.setHttpsProtocol(b):0===m.indexOf("http://")&&(b=n.setHttpProtocol(b));return b};n.removeProtocol=function(b){return b.replace(/^http(s?):\/\//i,"//")};n.setHttpProtocol=
function(b){b=n.addProtocol(b);return b.replace(/^https:\/\//,"http://")};n.setHttpsProtocol=function(b){b=n.addProtocol(b);return b.replace(/^http:\/\//,"https://")};n.setProtocol=function(b,m){return 0<=m.indexOf("https")?n.setHttpsProtocol(b):0<=m.indexOf("http")?n.setHttpProtocol(b):b};n.getSharingUrl=function(b){var m="";(b=n.getStandardPortalUrl(b))&&(m=b+"/sharing");return m};n.getOAuth2Url=function(b){var m="";(b=n.getStandardPortalUrl(b))&&(m=b+"/sharing/oauth2");return m};n.getAppIdUrl=
function(b,m){var k="";(b=n.getStandardPortalUrl(b))&&(k=b+"/sharing/oauth2/apps/"+m);return k};n.getSignInUrl=function(b){var m="";(b=n.getStandardPortalUrl(b))&&(m=b+"/home/signin.html");return m};n.getBaseSearchUrl=function(b){var m="";b=n.getStandardPortalUrl(b);(b=b.replace(/\/*$/g,""))&&(m=b+"/sharing/rest/search");return m};n.getBaseItemUrl=function(b){var m="";(b=n.getStandardPortalUrl(b))&&(m=b+"/sharing/rest/content/items");return m};n.getItemUrl=function(b,m){var k="";(b=n.getBaseItemUrl(b))&&
m&&(k=b+"/"+m);return k};n.getItemDataUrl=function(b,m){var k="";(b=n.getItemUrl(b,m))&&(k=b+"/data");return k};n.getGenerateTokenUrl=function(b){var m="";b&&(b=n.getStandardPortalUrl(b),m=b+"/sharing/generateToken");return m};n.getItemDetailsPageUrl=function(b,m){var k="";b&&m&&(b=n.getStandardPortalUrl(b),k=b+"/home/item.html?id\x3d"+m);return k};n.getUserProfilePageUrl=function(b,m){var k="";b&&m&&(b=n.getStandardPortalUrl(b),k=b+"/home/user.html?user\x3d"+m);return k};n.getBaseGroupUrl=function(b){var m=
"";(b=n.getStandardPortalUrl(b))&&(m=b+"/sharing/rest/community/groups");return m};n.getPortalSelfInfoUrl=function(b){var m="";(b=n.getStandardPortalUrl(b||""))&&(m=b+"/sharing/portals/self");return m};n.getCommunitySelfUrl=function(b){var m="";(b=n.getStandardPortalUrl(b||""))&&(m=b+"/sharing/rest/community/self");return m};n.getBaseUserUrl=function(b){var m="";(b=n.getStandardPortalUrl(b))&&(m=b+"/sharing/rest/community/users");return m};n.getUserUrl=function(b,m){var k="",g=n.getBaseUserUrl(b);
b&&m&&(k=g+"/"+m);return k};n.getUserTagsUrl=function(b,m){var k="",g=n.getUserUrl(b,m);b&&m&&(k=g+"/tags");return k};n.getUserThumbnailUrl=function(b,m,k){var g="";(b=n.getUserUrl(b,m))&&k&&(g=b+"/info/"+k);return g};n.getContentUrl=function(b){var m="";b&&(b=n.getStandardPortalUrl(b),m=b+"/sharing/rest/content");return m};n.getUserContentUrl=function(b,m,k){var g="",g="";b&&m&&(g=n.getContentUrl(b),g=k?g+"/users/"+m+"/"+k:g+"/users/"+m);return g};n.getUserContentItemUrl=function(b,m,k){var g="",
g="";b&&m&&k&&(g=n.getUserContentUrl(b,m),g=g+"/items/"+k);return g};n.getItemResourceUrl=function(b,m,k){var g="",g="";b&&m&&(g=n.getContentUrl(b),g=k?g+"/items/"+m+"/resources/"+k:g+"/items/"+m+"/resources");return g};n.getAddItemUrl=function(b,m,k){var g="",g="";b&&m&&(g=n.getUserContentUrl(b,m,k),g+="/addItem");return g};n.getDeleteItemUrl=function(b,m,k){var g="";(b=n.getUserItemsUrl(b,m))&&(g=b+"/"+k+"/delete");return g};n.getUserItemsUrl=function(b,m,k){var g="",g="";b&&m&&(g=n.getUserContentUrl(b,
m,k),g+="/items");return g};n.getUpdateItemUrl=function(b,m,k,g){var e="",e="";b&&m&&(e=n.getUserItemsUrl(b,m,g),e=e+"/"+k+"/update");return e};n.shareItemUrl=function(b,m,k,g){var e="",e="";b&&m&&(e=n.getUserItemsUrl(b,m,g),e=e+"/"+k+"/share");return e};n.getHomeIndexUrl=function(b){var m="";(b=n.getStandardPortalUrl(b))&&(m=b+"/home/index.html");return m};n.getHomeMapViewerUrl=function(b,m){var k="";if(b=n.getStandardPortalUrl(b))k=b+"/home/webmap/viewer.html",k=m?k+("?webmap\x3d"+m):k+"?useExisting\x3d1";
return k};n.getHomeGalleryUrl=function(b){var m="";(b=n.getStandardPortalUrl(b))&&(m=b+"/home/gallery.html");return m};n.getHomeGroupsUrl=function(b){var m="";(b=n.getStandardPortalUrl(b))&&(m=b+"/home/groups.html");return m};n.getHomeMyContentUrl=function(b){var m="";(b=n.getStandardPortalUrl(b))&&(m=b+"/home/content.html");return m};n.getHomeMyOrganizationUrl=function(b){var m="";(b=n.getStandardPortalUrl(b))&&(m=b+"/home/organization.html");return m};n.getHomeUserUrl=function(b){var m="";(b=n.getStandardPortalUrl(b))&&
(m=b+"/home/user.html");return m};n.getPortalHelpUrl=function(b,m){var k="";(b=n.getStandardPortalUrl(b))&&(k=b+"/portalhelp/"+(m||"en")+"/portal/");return k};n.getPortalAdminHelpUrl=function(b,m){var k="";(b=n.getStandardPortalUrl(b))&&(k=b+"/portalhelp/"+(m||"en")+"/admin/help/");return k};n.getPortalProxyUrl=function(b){var m="";(b=n.getStandardPortalUrl(b))&&(m=b+"/sharing/proxy");return m};n.getOAuth2SignOutUrl=function(b){var m="";(b=n.getStandardPortalUrl(b))&&(m=b+"/sharing/oauth2/signout");
return m};n.getNewPrintUrl=function(b){var m="";if(b=n.getStandardPortalUrl(b))b=n.setHttpProtocol(b),m=b+"/sharing/tools/newPrint";return m};return n})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],function(n){function b(b,e){function f(e,f){var d,a,c,h,l="widgetOnScreen"===e;if(b[e]){if(b[e].groups)for(d=0;d<b[e].groups.length;d++)if(c=b[e].groups[d],f(c,{index:d,isWidget:!1,groupId:c.id,isThemeWidget:!1,isOnScreen:l}),b[e].groups[d].widgets)for(a=0;a<b[e].groups[d].widgets.length;a++)h=
b[e].groups[d].widgets[a],f(h,{index:a,isWidget:!0,groupId:c.id,isThemeWidget:h.uri&&-1<h.uri.indexOf("themes/"+b.theme.name),isOnScreen:l});if(b[e].widgets)for(d=0;d<b[e].widgets.length;d++)h=b[e].widgets[d],f(b[e].widgets[d],{index:d,isWidget:!0,groupId:e,isThemeWidget:h.uri&&-1<h.uri.indexOf("themes/"+b.theme.name),isOnScreen:l})}}f("widgetOnScreen",e);f("widgetPool",e)}var m={},k="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance mirrorIconForRTL".split(" ");
m.visitElement=b;m.getConfigElementById=function(g,e){var f;if("map"===e)return g.map;b(g,function(l){if(l.id===e)return f=l,!0});return f};m.getConfigElementByLabel=function(g,e){var f;if("map"===e)return g.map;b(g,function(l){if(l.label||l.name===e)return f=l,!0});return f};m.getConfigElementsByName=function(g,e){var f=[];if("map"===e)return[g.map];b(g,function(l){l.name===e&&f.push(l)});return f};m.getWidgetNameFromUri=function(b){b=b.split("/");b.pop();return b.pop()};m.getAmdFolderFromUri=function(b){b=
b.split("/");b.pop();return b.join("/")+"/"};m.widgetProperties=k;m.processWidgetProperties=function(b){"undefined"===typeof b.properties.isController&&(b.properties.isController=!1);"undefined"===typeof b.properties.isThemeWidget&&(b.properties.isThemeWidget=!1);"undefined"===typeof b.properties.hasVersionManager&&(b.properties.hasVersionManager=!1);"undefined"===typeof b.properties.mirrorIconForRTL&&(b.properties.mirrorIconForRTL=!1);k.forEach(function(e){"undefined"===typeof b.properties[e]&&(b.properties[e]=
!0)})};m.getControllerWidgets=function(b){var e=[];b.visitElement(function(f){f.isController&&e.push(f)});return e};m.isHostedService=function(b){var e=n.getServerByUrl(b);return(new RegExp(e+"/[^/]+/[^/]+/rest/services","gi")).test(b)};return m})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all ./utils jimu/tokenUtils ./dijit/Message".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u){var r=null,x=n(f,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(e.subscribe("app/sceneViewLoaded",b.hitch(this,this._onSceneViewLoaded)),e.subscribe("app/sceneViewChanged",b.hitch(this,this._onSceneViewChanged))):(e.subscribe("sceneViewLoaded",b.hitch(this,this._onSceneViewLoaded)),e.subscribe("sceneViewChanged",b.hitch(this,this._onSceneViewChanged)));window.isBuilder?(e.subscribe("app/appConfigLoaded",
b.hitch(this,this._onAppConfigLoaded)),e.subscribe("app/appConfigChanged",b.hitch(this,this._onAppConfigChanged))):(e.subscribe("appConfigLoaded",b.hitch(this,this._onAppConfigLoaded)),e.subscribe("appConfigChanged",b.hitch(this,this._onAppConfigChanged)));e.subscribe("userSignIn",b.hitch(this,this._onUserSignIn));e.subscribe("userSignOut",b.hitch(this,this._onUserSignOut));e.subscribe("builder/actionTriggered",b.hitch(this,this._onActionTriggered));e.subscribe("/dnd/move/start",b.hitch(this,this._onMoveStart))},
loadWidget:function(a){var c=new g,d;a=b.clone(a);a.folderUrl||p.processWidgetSetting(a);(d=this.getWidgetById(a.id))?c.resolve(d):q([this.loadWidgetClass(a),this.loadWidgetManifest(a)]).then(b.hitch(this,function(a){var d=a[0],f=a[1];this.loadWidgetResources(f).then(b.hitch(this,function(a){try{var h=this.createWidget(f,d,a);console.log("widget ["+f.uri+"] created.")}catch(E){console.log("create ["+f.uri+"] error:"+E.stack),new u({message:window.jimuNls.createWidgetError+": "+f.uri}),c.reject(E)}setTimeout(b.hitch(this,
function(){c.resolve(h);this.emit("widget-created",h);e.publish("widgetCreated",h)}),50)}),function(a){c.reject(a)})}),function(a){c.reject(a)});return c},loadWidgetClass:function(a){var c=new g,d;d=a.isRemote?a.uri+".js":a.uri;require(p.getRequireConfig(),[d],b.hitch(this,function(a){c.resolve(a)}));p.checkError(a.uri,c);return c},loadWidgetResources:function(a){var c=new g,d,e,f,h=[];f=b.clone(a);a=this.tryLoadWidgetConfig(f);d=this._tryLoadResource(f,"i18n");e=this._tryLoadResource(f,"style");
f=this._tryLoadResource(f,"template");h.push(a);h.push(d);h.push(f);h.push(e);q(h).then(b.hitch(this,function(a){var d={};d.config=a[0];d.i18n=a[1];d.template=a[2];d.style=a[3];c.resolve(d)}),function(a){c.reject(a)});return c},loadWidgetManifest:function(a){var d=new g,e=p.getUriInfo(a.uri),e=e.isRemote?e.folderUrl+"manifest.json?f\x3djson":e.folderUrl+"manifest.json";if(a.manifest)return d.resolve(a),d;c(e,{handleAs:"json",headers:{"X-Requested-With":null}}).then(b.hitch(this,function(c){if(c.error&&
c.error.code)return d.reject(c.error);c.amdFolder=a.amdFolder;c.category="widget";a.label?(this._processManifest(c),p.addManifest2WidgetJson(a,c),d.resolve(a)):p.addI18NLabel(c).then(b.hitch(this,function(){this._processManifest(c);p.addManifest2WidgetJson(a,c);d.resolve(a)}))}),function(a){d.reject(a)});return d},getWidgetMarginBox:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return{};if(a._marginBox)return a._marginBox;a.setPosition({left:-9999,top:-9999,relativeTo:a.position.relativeTo});
this.openWidget(a);a._marginBox=a.getMarginBox();this.closeWidget(a);return a._marginBox},_processManifest:function(a){p.addManifestProperies(a);p.processManifestLabel(a,window.dojoConfig.locale)},createWidget:function(a,c,d){if(this.getWidgetById(a.id))return this.getWidgetById(a.id);d.config&&d.i18n&&(d.config=p.replacePlaceHolder(d.config,d.i18n));a.rawConfig=a.config;a.config=d.config||{};this.appConfig._appData&&this._mergeAgolConfig(a);a.nls=d.i18n||{};d.template&&(a.templateString=d.template);
a["class"]="jimu-widget";a.label||(a.label=a.name);a.sceneView=this.sceneView;a.appConfig=this.appConfig;d={};for(var e in a)a.hasOwnProperty(e)&&(d[e]=a[e]);d.widgetManager=this;a=new c(d);a.clazz=c;h.after(a,"startup",b.hitch(this,this._postWidgetStartup,a));h.before(a,"destroy",b.hitch(this,this._onDestroyWidget,a));l(a.domNode,"click",b.hitch(this,this._onClickWidget,a));this.loaded.push(a);return a},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var a=m.map(this.loaded,
function(a){return a.id});m.forEach(a,function(a){this.destroyWidget(a)},this);this.loaded=[]},loadWidgetSettingPage:function(a){var c=new g;a=b.clone(a);a.id+="_setting";q([this.loadWidgetSettingClass(a)]).then(b.hitch(this,function(d){var e=d[0];this.loadWidgetSettingPageResources(a).then(b.hitch(this,function(d){var f,l={nls:d.i18n,appConfig:this.appConfig,sceneView:this.sceneView,"class":"jimu-widget-setting"};null!==d.template&&(l.templateString=d.template);for(var r in a)a.hasOwnProperty(r)&&
(l[r]=a[r]);try{f=new e(l),h.before(f,"destroy",b.hitch(this,this._onDestroyWidgetSetting,f)),c.resolve(f)}catch(E){new u({message:window.jimuNls.createWidgetSettingError+":"+a.uri}),c.reject(E)}}),function(a){console.log(a)})}),function(a){c.reject(a)});return c},loadWidgetSettingClass:function(a){var c=new g,d;d=a.isRemote?a.folderUrl+"setting/Setting.js":a.amdFolder+"setting/Setting";require(p.getRequireConfig(),[d],b.hitch(this,function(a){c.resolve(a)}));p.checkError(a.folderUrl+"setting/Setting.js",
c);return c},loadWidgetSettingPageResources:function(a){var c=new g,d,e,f=[];a=b.clone(a);d=this._tryLoadResource(a,"settingI18n");e=this._tryLoadResource(a,"settingTemplate");a=this._tryLoadResource(a,"settingStyle");f.push(d);f.push(e);f.push(a);q(f).then(b.hitch(this,function(a){var d={};d.i18n=a[0]||{};d.template=a[1];d.style=a[2];c.resolve(d)}),function(a){console.log(a)});return c},getWidgetById:function(a){var c;m.some(this.loaded,function(d){if(d.id===a)return c=d,!0},this);return c},getWidgetByLabel:function(a){var c;
m.some(this.loaded,function(d){if(d.label===a)return c=d,!0},this);return c},getWidgetsByName:function(a){var c=[];m.some(this.loaded,function(d){d.name===a&&c.push(d)},this);return c},changeWindowStateTo:function(a,c){"normal"===c?this.normalizeWidget(a):"minimized"===c?this.minimizeWidget(a):"maximized"===c?this.maximizeWidget(a):console.log("error state: "+c)},closeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if("closed"!==a.state){this.activeWidget&&this.activeWidget.id===
a.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);k.setStyle(a.domNode,"display","none");a.setState("closed");try{a.onClose()}catch(v){console.log(console.error("fail to close widget "+a.name+". "+v.stack))}}},openWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if(!a.started)try{a.started=!0,a.startup()}catch(v){console.error("fail to startup widget "+a.name+". "+v.stack)}if("closed"===a.state){k.setStyle(a.domNode,"display","");a.setState("opened");try{a.onOpen()}catch(v){console.error("fail to open widget "+
a.name+". "+v.stack)}}},activateWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"opened"===a.state&&this._activeWidget(a)},maximizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("maximized");try{a.onMaximize()}catch(v){console.log(console.error("fail to maximize widget "+a.name+". "+v.stack))}},minimizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;
"closed"===a.state&&this.openWidget(a);a.setWindowState("minimized");try{a.onMinimize()}catch(v){console.log(console.error("fail to minimize widget "+a.name+". "+v.stack))}},normalizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("normal");try{a.onNormalize()}catch(v){console.log(console.error("fail to normalize widget "+a.name+". "+v.stack))}},destroyWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),
!a))return;this._removeWidget(a);try{a.destroy()}catch(v){console.log(console.error("fail to destroy widget "+a.name+". "+v.stack))}},tryLoadWidgetConfig:function(a){return this._tryLoadWidgetConfig(a).then(b.hitch(this,function(c){return this._upgradeWidgetConfig(a,c).then(function(c){return a.config=c})}))},triggerWidgetOpen:function(a){function c(a){var c=h.after(a,"onOpen",function(){c.remove();d.resolve(a)})}var d=new g,f=this.getWidgetById(a);if(f){if("closed"!==f.state)return d.resolve(f),
d;c(f)}else var l=e.subscribe("widgetCreated",b.hitch(this,function(c){c.id===a&&(l.remove(),d.resolve(c))}));e.publish("openWidget",a);return d},_tryLoadWidgetConfig:function(a){var e=new g;if(a.config&&b.isObject(a.config))return e.resolve(a.config),e;if(a.config){if(require.cache["url:"+a.config])return e.resolve(d.parse(require.cache["url:"+a.config])),e;e=p.processUrlInAppConfig(a.config);e=e.split("/");e[e.length-1]=encodeURIComponent(e[e.length-1]);e=e.join("/");return c(e,{handleAs:"json"})}return this._tryLoadResource(a,
"config").then(function(c){a.isDefaultConfig=!0;return c})},_upgradeWidgetConfig:function(a,c){var d=new g,e=a.manifest.version,f=a.version,h;if(e===f)return d.resolve(c),d;if(!1===a.hasVersionManager)return a.version=e,d.resolve(c),d;require(p.getRequireConfig(),[a.amdFolder+"VersionManager"],b.hitch(this,function(l){l=new l;var r=l.getVersionIndex(f),b=l.getVersionIndex(e);if(r>b)d.reject("Bad widget version number, "+a.name+","+f);else try{h=l.upgrade(c,f,e),a.version=e,d.resolve(h)}catch(G){console.log("Read widget ["+
a.name+"] old config error,"+G.stack),d.resolve(c)}}));return d},loadWidgetStyle:function(a){var c="widget/style/"+a.uri,d=new g,c=this._replaceId(c);return k.byId(c)?(d.resolve("load"),d):p.loadStyleLink(c,a.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(a){var c="widget/style/"+a.uri+"/setting",d=new g,c=this._replaceId(c);return k.byId(c)?(d.resolve("load"),d):p.loadStyleLink(c,a.settingStyleFile)},loadWidgetConfig:function(a){a=require(p.getRequireConfig()).toUrl(a.configFile);
if(require.cache["url:"+a]){var e=new g;e.resolve(d.parse(require.cache["url:"+a]));return e}return c(a,{handleAs:"json"})},loadWidgetI18n:function(a){var c=new g;require(p.getRequireConfig(),["dojo/i18n!"+a.i18nFile],function(a){c.resolve(a)});return c},loadWidgetSettingI18n:function(a){var c=new g;require(p.getRequireConfig(),["dojo/i18n!"+a.settingI18nFile],function(a){c.resolve(a)});return c},loadWidgetTemplate:function(a){var c=new g;require(p.getRequireConfig(),["dojo/text!"+a.templateFile],
function(a){c.resolve(a)});p.checkError(a.templateFile,c);return c},loadWidgetSettingTemplate:function(a){var c=new g;require(p.getRequireConfig(),["dojo/text!"+a.settingTemplateFile],function(a){c.resolve(a)});p.checkError(a.settingTemplateFile,c);return c},removeWidgetStyle:function(a){k.destroy(this._replaceId("widget/style/"+a.uri))},removeWidgetSettingStyle:function(a){k.destroy(this._replaceId("widget/style/"+a.uri+"/setting"))},getControllerWidgets:function(){return m.filter(this.loaded,function(a){return a.isController})},
getOffPanelWidgets:function(){return m.filter(this.loaded,function(a){return!a.inPanel})},getOnScreenOffPanelWidgets:function(){return m.filter(this.loaded,function(a){return a.isOnScreen&&!a.inPanel})},closeOtherWidgetsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;for(var c=0;c<this.loaded.length;c++)this.loaded[c].gid===a.gid&&this.loaded[c].id!==a.id&&this.closeWidget(this.loaded[c])},closeAllWidgetsInGroup:function(a){for(var c=0;c<this.loaded.length;c++)this.loaded[c].gid===
a&&this.closeWidget(this.loaded[c])},_mergeAgolConfig:function(a){var c=this.appConfig._appData.values,d="widgets["+a.id+"]",e;for(e in c){var f=e.replace(/\//g,"_").indexOf(d+"_config");0<=f&&p.template.setConfigValue(a,e.replace(/\//g,"_").substr(f,e.length).replace(d,"widget"),c[e])}},_onUserSignIn:function(a){m.forEach(this.loaded,function(c){c.onSignIn(a)},this)},_onUserSignOut:function(){m.forEach(this.loaded,function(a){a.onSignOut()},this)},_activeWidget:function(a){if(this.activeWidget){if(this.activeWidget.id===
a.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&k.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&k.setStyle(a.domNode,"zIndex","zIndex"in a.position?a.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=a;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&
k.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),e.publish("widgetActived",a))},_onClickWidget:function(c,d){var e=a(".jimu-widget",c.domNode);if(0<e.length)for(var f=0;f<e.length;f++)if(d.target===e[f]||k.isDescendant(d.target,e[f]))return;this._activeWidget(c)},_onMoveStart:function(a){m.forEach(this.loaded,function(c){c.domNode===a.node&&this._activeWidget(c)},this)},_onAppConfigLoaded:function(a){this.appConfig=a=b.clone(a);t.setPortalUrl(a.portalUrl)},_onSceneViewLoaded:function(a){this.sceneView=
a},_onSceneViewChanged:function(a){this.sceneView=a},_onAppConfigChanged:function(a,c,d,e){var f=b.clone(a);this.appConfig=f;m.forEach(this.loaded,function(a){a&&(a.onAppConfigChanged(f,c,d,e),"widgetChange"===c&&this._onConfigChanged(d.id,d.config,e))},this)},_onConfigChanged:function(a,c){if(a=this.getWidgetById(a))a.onConfigChanged(c),b.mixin(a.config,c)},_onActionTriggered:function(a){if("map"!==a.elementId&&"app"!==a.elementId){var c=this.getWidgetById(a.elementId);if(c)c.onAction(a.action,a.data);
else this.missedActions.push({id:a.elementId,action:{name:a.action,data:a.data}});m.forEach(this.getControllerWidgets(),function(c){if(c.widgetIsControlled(a.elementId))c.onAction(a.action,{widgetId:a.elementId,data:a.data})},this)}},_postWidgetStartup:function(a){a.started=!0;p.setVerticalCenter(a.domNode);h.after(a,"resize",b.hitch(this,p.setVerticalCenter,a.domNode));this.openWidget(a);var c=t.getPortalCredential(this.appConfig.portalUrl);if(c)a.onSignIn(c);else a.onSignOut();this._triggerMissedAction(a)},
_triggerMissedAction:function(a){this.missedActions.forEach(function(c){if(c.id===a.id)a.onAction(c.action.name,c.action.data)})},_remove:function(a){return m.some(this.loaded,function(c,d){if(c.id===a)return this.loaded.splice(d,1),!0},this)},_tryLoadResource:function(a,c){var d,e=new g;if("config"===c)d=a.amdFolder+"config.json",a.configFile=d,d="hasConfig";else if("style"===c)d=a.amdFolder+"css/style.css",a.styleFile=d,d="hasStyle";else if("i18n"===c)d=a.amdFolder+"nls/strings.js",a.i18nFile=a.isRemote?
d:a.amdFolder+"nls/strings",d="hasLocale";else if("template"===c)d=a.amdFolder+"Widget.html",a.templateFile=d,d="hasUIFile";else if("settingTemplate"===c)d=a.amdFolder+"setting/Setting.html",a.settingTemplateFile=d,d="hasSettingUIFile";else if("settingI18n"===c)d=a.amdFolder+"setting/nls/strings.js",a.settingI18nFile=a.isRemote?d:a.amdFolder+"setting/nls/strings",d="hasSettingLocale";else if("settingStyle"===c)d=a.amdFolder+"setting/css/style.css",a.settingStyleFile=d,d="hasSettingStyle";else return e;
a[d]?function(){var d;if("config"===c)d=this.loadWidgetConfig(a);else if("style"===c)d=this.loadWidgetStyle(a);else if("i18n"===c)d=this.loadWidgetI18n(a);else if("template"===c)d=this.loadWidgetTemplate(a);else if("settingTemplate"===c)d=this.loadWidgetSettingTemplate(a);else if("settingStyle"===c)d=this.loadWidgetSettingStyle(a);else if("settingI18n"===c)d=this.loadWidgetSettingI18n(a);else return e;d.then(function(a){e.resolve(a)},function(d){console.error("Load widget resource error. resource:",
c);console.error(d);new u({message:window.jimuNls.loadWidgetResourceError+": "+a.uri});e.reject(d)})}.apply(this):e.resolve(null);return e},_replaceId:function(a){return a.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(a){"closed"!==a.state&&this.closeWidget(a);this._removeWidget(a);console.log("destroy widget ["+a.uri+"].")},_onDestroyWidgetSetting:function(a){this.removeWidgetSettingStyle(a)},_removeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;
this.activeWidget&&this.activeWidget.id===a.id&&(this.activeWidget=null);this._remove(a.id);0===this.getWidgetsByName(a.name).length&&this.removeWidgetStyle(a)}});x.getInstance=function(a){null===r&&(r=new x(a),window._widgetManager=r);return r};return x})},"jimu/tokenUtils":function(){define("require dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/request esri/core/urlUtils esri/identity/IdentityManager esri/identity/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u){"function"!==typeof e.getAll&&(e.getAll=function(a){var c=[];(a=e(a))&&c.push(a);return c});q={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return u.isInConfigOrPreviewWindow()},isStringStartWith:function(a,c){return a.substr(0,c.length)===c},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(a){(a=t.getStandardPortalUrl(a))&&(a+=
"/");this.portalUrl=a},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(a){var e=new g,f=t.getStandardPortalUrl(a);a=f+"/sharing";var l=t.setHttpsProtocol(f+"/sharing/generateToken?f\x3djson"),r=t.setHttpsProtocol(a);h.get(l,{jsonp:"callback"}).then(b.hitch(this,function(a){a.token?(this.webTierPortalUrls.push(f),this.removeWabAuthCookie(),d.id.getCredential(r).then(b.hitch(this,function(d){function r(a){var c=a.creationTime||(new Date).getTime(),d=a.expires;0<c&&0<d&&d>c&&
setTimeout(function(){h.get(l,{jsonp:"callback"}).then(function(c){c.token&&(a.token=c.token,a.expires=c.expires,a.creationTime=(new Date).getTime(),a.refreshServerTokens(),r(a))},function(a){console.error(a)})},.8*(d-c))}d.token||(d.token=a.token);d.expires||(d.expires=a.expires);var b=u.getEsriConfigRequestObject(),p=c.isTrustedServer(d.server,!0);-1<p&&b.corsEnabledServers.splice(p,1);this._pushCorsEnabledServerInfo({host:t.getServerByUrl(f),withCredentials:!0});e.resolve(!0);r(d)}),b.hitch(this,
function(){e.resolve(!0)}))):e.resolve(!1)}),b.hitch(this,function(a){console.error(a);e.reject(a)}));return e},addAuthorizedCrossOriginDomains:function(a){if(a&&0<a.length)for(var c=0;c<a.length;c++)this.addWithCredentialDomain(a[c])},addWithCredentialDomain:function(a){if(a&&"string"===typeof a){var d=u.getEsriConfigRequestObject().corsEnabledServers,e=t.getServerByUrl(a);(a=t.getServerWithProtocol(a))||(a="http://"+e);a=c.isTrustedServer(a,!0);-1<a&&d.splice(a,1);this._pushCorsEnabledServerInfo({host:e,
withCredentials:!0})}},_pushCorsEnabledServerInfo:function(a){if(a){var c=u.getEsriConfigRequestObject(),d=c.corsEnabledServers,e="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");if("object"===typeof a&&"string"===typeof a.host){for(var f in a.host)a[f]="function"===typeof a.host[f]?function(){return a.host[f].apply(a.host,
arguments)}:a.host[f];a.length=a.host.length;m.forEach(e,function(c){"function"===typeof a.host[c]&&(a[c]=function(){return a.host[c].apply(a.host,arguments)})});a.withCredentials&&c.webTierAuthServers&&0>c.webTierAuthServers.indexOf(a.host)&&c.webTierAuthServers.push(a.host)}d.push(a)}},tryRegisterCredential:function(a){return this.isValidCredential(a)?m.some(d.id.credentials,b.hitch(this,function(c){return a.token===c.token}))?!1:(d.id.credentials.push(a),!0):!1},registerToken:function(a){var c=
t.getSharingUrl(this.portalUrl);d.id.findCredential(c)&&m.some(d.id.credentials,b.hitch(this,function(a,c){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a))return d.id.credentials.splice(c,1),!0}));return this._getTokenInfo(a).then(function(a){d.id.registerToken(a)})},_getTokenInfo:function(a){var c=t.getPortalSelfInfoUrl(this.portalUrl);return h.get(c+("?f\x3djson\x26token\x3d"+a),{jsonp:"callback"}).then(b.hitch(this,function(c){if(c.user)return{server:t.getSharingUrl(this.portalUrl),
ssl:c.allSSL,token:a,userId:c.user.username};throw Error(window.jimuNls.urlParams.invalidToken);}),function(a){console.error(a);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(a){return a&&"string"===typeof a&&b.trim(a)},signInPortal:function(a){var c=new g;if(this._isInvalidPortalUrl(a)){a=t.getStandardPortalUrl(a);var e=t.getSharingUrl(a),f=this.getPortalCredential(a);f?setTimeout(b.hitch(this,function(){c.resolve(f)}),0):c=d.id.getCredential(e)}else setTimeout(b.hitch(this,
function(){c.reject("Invalid portalurl.")}),0);return c},_loadPortalSelfInfo:function(c){c=t.getPortalSelfInfoUrl(c);var d=new g;a(c,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(b.hitch(this,function(a){d.resolve(a.data)}),b.hitch(this,function(a){d.reject(a)}));return d},registerOAuthInfo:function(a,c){if(!a||"string"!==typeof a||!c||"string"!==typeof c)return null;var e=d.id.findOAuthInfo(a);e||(e=window.location.protocol+"//"+window.location.host+n.toUrl("jimu")+"/oauth-callback.html",
e=new p({appId:c,expiration:20160,portalUrl:a,authNamespace:"/",popup:!0,popupCallbackUrl:e}),d.id.registerOAuthInfos([e]));e.appId=c;return e},signOutAll:function(){var a=t.getStandardPortalUrl(this.portalUrl),c=!!d.id.findCredential(a+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():this.removeWabAuthCookie();d.id.destroyCredentials();d.id._oAuthHash=null;c&&this._publishCurrentPortalUserSignOut(a)},userHaveSignInPortal:function(a){return!!this.getPortalCredential(b.trim(a||
""))},isValidCredential:function(a){var c=!1;if(a){var c=a.token,d=a.server,e=a.scope,c=c&&"string"===typeof c&&b.trim(c),d=d&&"string"===typeof d&&b.trim(d),e="portal"===e||"server"===e,f=!0;a.expires&&(a=parseInt(a.expires,10),f=(new Date).getTime(),f=a>f);c=c&&d&&e&&f}return c},isValidPortalCredentialOfPortalUrl:function(a,c){var d=!1;this.isValidCredential(c)&&(d="portal"===c.scope,a=t.isSameServer(a,c.server),d=d&&a);return d},getPortalCredential:function(a){var c=null;a=b.trim(a||"");if(!a)return null;
a=t.getStandardPortalUrl(a);return c=this._filterPortalCredential(a,d.id.credentials)},saveAndRegisterCookieToCredential:function(a){a=b.clone(a);a.referer=window.location.host;a.scope="portal";a.isAdmin=!!a.isAdmin;this.saveWabCookie(a);var c=a.server+"/sharing/rest";a.server=c;d.id.registerToken(a);return d.id.findCredential(c,a.userId)},registerAuth2Hash:function(a){a=b.clone(a);var c=1E3*parseInt(a.expires_in,10),c=(new Date).getTime()+c,d=t.getStandardPortalUrl(a.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,
server:d,token:a.access_token,expires:c,userId:a.username,scope:"portal",isAdmin:!!a.isAdmin})},saveWabCookie:function(a){this.removeCookie("wab_auth");e("wab_auth",f.stringify(a),{expires:new Date(a.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(a,
c){var d=null;c&&0<c.length&&(c=m.filter(c,b.hitch(this,function(c){return this.isValidPortalCredentialOfPortalUrl(a,c)})),0<c.length&&(d=c[c.length-1]));return d},_removePortalCredential:function(a){var c=b.trim(a||"");if(c){c=t.getStandardPortalUrl(c);for(a=m.filter(d.id.credentials,b.hitch(this,function(a){return this.isValidPortalCredentialOfPortalUrl(c,a)}));0<a.length;)a[0].destroy(),a.splice(0,1);d.id.credentials=m.filter(d.id.credentials,b.hitch(this,function(a){return!this.isValidPortalCredentialOfPortalUrl(c,
a)}))}},getUserIdByToken:function(c,e){var f=new g;if(c&&"string"===typeof c&&e&&"string"===typeof e){var h=t.getStandardPortalUrl(e);e=m.filter(d.id.credentials,b.hitch(this,function(a){var d=a.token===c&&a.userId;a=t.isSameServer(h,a.server);return d&&a}));if(0<e.length){var l=e[0];setTimeout(b.hitch(this,function(){f.resolve(l.userId)}),0);return f}e=t.getCommunitySelfUrl(h);a(e,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(b.hitch(this,function(a){a=a&&a.data;f.resolve(a&&
a.username||"")}),b.hitch(this,function(a){console.error(a);f.reject("fail to get userId by token")}))}else setTimeout(b.hitch(this,function(){f.reject("invalid parameters")}),0);return f},xtGetCredentialFromCookie:function(a){var c=e("wab_auth"),h=null;if(c)try{h=f.parse(c)}catch(v){console.error(v)}if(!h||"object"!==typeof h||!t.isSameServer(a,h.server)||window.location.host!==h.referer)return null;h.expires=parseInt(h.expires,10);c=(new Date).getTime();if(!(h.expires>c))return this.removeCookie("wab_auth"),
null;a+="/sharing/rest";h.server=a;(c=d.id.findCredential(a))||d.id.registerToken(h);return c=d.id.findCredential(a)},removeCookie:function(a){var c=this.getCookiePath();u.removeCookie(a,c)},_getDomainsByServerName:function(a){var c=a.split("."),d=c.length;return m.map(c,b.hitch(this,function(a,e){a=c.slice(e,d);var f="",h=a.length-1;m.forEach(a,b.hitch(this,function(a,c){f+=a;c!==h&&(f+=".")}));return f}))},_publishCurrentPortalUserSignIn:function(a){if(this.isValidCredential(a))try{l.publish("userSignIn",
a)}catch(x){console.error(x)}},_publishAnyUserSignIn:function(a){if(this.isValidCredential(a))try{l.publish("anyUserSignIn",a)}catch(x){console.error(x)}},_publishCurrentPortalUserSignOut:function(a){try{l.publish("userSignOut",a)}catch(x){console.error(x)}},_signInSuccess:function(a){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a)&&this._publishCurrentPortalUserSignIn(a),this._publishAnyUserSignIn(a)}catch(x){console.error(x)}},_bindEvents:function(){k.after(d.id,"signIn",b.hitch(this,
function(a,c){console.log(c[1]);k.after(a,"callback",b.hitch(this,function(a,c){this._signInSuccess(c[0],!1)}));return a}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var a=window.parent;if(a){var c=a.esri&&a.esri.id;if(c){d.id=c;n.module.deps.some(b.hitch(this,function(a){return"esri/identity/IdentityManager"===a.mid?(a.result=c,!0):!1}));var e=u.getEsriConfigRequestObject(),a=a.esriConfig.defaults.io;e.corsEnabledServers=
a.corsEnabledServers;e.webTierAuthServers=a.webTierAuthServers;e._processedCorsServers=a._processedCorsServers;e.corsStatus=a.corsStatus}}}this._bindEvents();this._started=!0}}};q.startup();return q})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup jimu/utils".split(" "),function(n,b,m,k,g,e,f){return n(e,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,
maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=m.create("div",{"class":"title"},this.domNode),this.titleLabeNode=m.create("span",{"class":"title-label jimu-float-leading",innerHTML:f.sanitizeHTML(this.titleLabel)||"\x26nbsp"},this.titleNode),this.closeBtnNode=m.create("div",{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(g(this.closeBtnNode,"click",b.hitch(this,this.close))))},_preProcessing:function(){0===
this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:k.ENTER,onClick:b.hitch(this,this.close)})},_increaseZIndex:function(){m.setStyle(this.domNode,"zIndex",501);m.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c){var q=0;return n(a,
{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();this._positioning();k.place(this.domNode,this.container);
setTimeout(b.hitch(this,function(){this._moveToMiddle()}),50);this.own(e(window,"resize",b.hitch(this,function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),this._moveToMiddle()):this._positioning()})));this.overlayNode=k.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();g.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===typeof this.height&&(this._fixedHeight=!0,this.autoHeight=
!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=k.create("div",{"class":"title"},this.domNode);this.titleLabeNode=k.create("span",{"class":"title-label jimu-float-leading",innerHTML:c.sanitizeHTML(this.titleLabel)||"\x26nbsp"},this.titleNode);this.closeBtnNode=k.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var a=null,a="ontouchstart"in document?l.press:"click";this.own(e(this.closeBtnNode,a,b.hitch(this,this.close)))},
_initDomNode:function(){this._createTitleNode();this.contentContainerNode=k.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&k.place(this.content,this.contentContainerNode));this.buttonContainer=k.create("div",{"class":"button-container"},this.domNode);0===this.buttons.length&&k.setStyle(this.buttonContainer,
"display","none");for(var a=this.buttons.length-1;-1<a;a--)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=this.enabledButtons.length;if(0!==a){var c=k.getContentBox(this.buttonContainer),d=k.getMarginExtents(this.enabledButtons[0]),e=k.getPadBorderExtents(this.enabledButtons[0]),h=0,e=8===f("ie")?e.l+e.r:0,h=(c.w-(d.l+d.r+e)*a)/a;0<h&&(m.forEach(this.enabledButtons,b.hitch(this,function(a){k.setStyle(a,"maxWidth",h+"px")})),
m.forEach(this.disabledButtons,b.hitch(this,function(a){k.setStyle(a,"maxWidth",h+"px")})))}},_moveableNode:function(a,c){this.moveable&&(this.moveable.destroy(),this.moveable=null);var f=k.getMarginBox(this.container);f.l=f.l-a+c;f.w+=2*(a-c);this.moveable=new d.boxConstrainedMoveable(this.domNode,{box:f,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(e(this.moveable,"Moving",b.hitch(this,this.onMoving)));this.own(e(this.moveable,"MoveStop",b.hitch(this,this.onMoveStop)))},
_getHeaderBox:function(){return 0===h("#header").length?{t:0,l:0,w:0,h:0}:k.getMarginBox("header")},_getFooterBox:function(){return 0===h(".footer",this.container).length?{t:0,l:0,w:0,h:0}:k.getMarginBox(h(".footer",this.container)[0])},_calculatePosition:function(){var a=k.getContentBox(this.container),c=this._getHeaderBox(),d=this._getFooterBox(),d=a.h-c.h-d.h-40,e=0;e=this._fixedHeight?this.height:this.autoHeight?d-200:this.height=d>this.maxHeight?this.maxHeight:d;d=(d-e)/2+c.h+20;d=d<c.h?c.h:
d;this.width=this.width||this.maxWidth;k.setStyle(this.domNode,{left:(a.w-this.width)/2+"px",top:d+"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(k.setStyle(this.domNode,"height","auto"),k.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&k.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(k.setStyle(this.domNode,"height",this.height+"px"),k.addClass(this.contentContainerNode,"content-absolute"),k.addClass(this.buttonContainer,"button-container-absolute"),
0===this.buttons.length&&k.setStyle(this.contentContainerNode,{bottom:"15px"}));this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var a=k.getMarginBox(this.domNode),c=k.getContentBox(this.container),d=this._getHeaderBox(),e=this._getFooterBox(),e=c.h-d.h-e.h-40,f=0,f=a.h||e-200,a=(e-f)/2+d.h+20,a=a<d.h?d.h:a;k.setStyle(this.domNode,{left:(c.w-this.width)/2+"px",top:a+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();this._calculateHeight()},
_increaseZIndex:function(){k.setStyle(this.domNode,"zIndex",q+200+1);k.setStyle(this.overlayNode,"zIndex",q+200);q++},setTitleLabel:function(a){this.titleNode.innerHTML=c.stripHTML(a)},onMoving:function(a){k.setStyle(a.node,"opacity",.9)},onMoveStop:function(a){k.setStyle(a.node,"opacity",1)},close:function(){if(!this.onClose||!1!==this.onClose()){var a=this.domNode.parentNode,c=b.clone(this.domNode);k.setStyle(this.domNode,"display","none");k.destroy(this.overlayNode);this.destroy();this.moveable.destroy();
k.place(c,a);g.animateProperty({node:c,properties:{opacity:0},duration:200,onEnd:function(){k.destroy(c)}}).play()}},addButton:function(a){this._createButton(a)},_createButton:function(a){var c=" ";a.classNames&&0<a.classNames.length&&"function"===typeof a.classNames.join&&(c+=a.classNames.join(" "));var d=k.create("div",{"class":"jimu-btn jimu-float-trailing jimu-trailing-margin1 "+c,innerHTML:a.label,title:a.title},this.buttonContainer);this.enabledButtons.unshift(d);c=k.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+
c,title:a.title,innerHTML:a.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(c);this.own(e(d,"click",b.hitch(this,function(c){if(a.onClick)a.onClick(c);else this.close()})))},setButtonProps:function(a,c){"number"===typeof a&&isFinite(a)||(c=a,a=0);if(c&&0!==this.enabledButtons.length)for(var d in c)"title"===d?(k.setAttr(this.enabledButtons[a],"title",c[d]),k.setAttr(this.disabledButtons[a],"title",c[d])):"label"===d&&(k.setProp(this.enabledButtons[a],"innerHTML",c[d]),
k.setProp(this.disabledButtons[a],"innerHTML",c[d]))},enableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.enabledButtons.length?(k.setStyle(this.enabledButtons[a],"display","inline-block"),k.setStyle(this.disabledButtons[a],"display","none")):(m.forEach(this.enabledButtons[a],b.hitch(this,function(a){k.setStyle(a,"display","inline-block")})),m.forEach(this.disabledButtons[a],b.hitch(this,function(a){k.setStyle(a,"display","none")})))},disableButton:function(a){"number"===typeof a&&isFinite(a)&&
a<this.disabledButtons.length?(k.setStyle(this.disabledButtons[a],"display","inline-block"),k.setStyle(this.enabledButtons[a],"display","none")):(m.forEach(this.disabledButtons,b.hitch(this,function(a){k.setStyle(a,"display","inline-block")})),m.forEach(this.enabledButtons,b.hitch(this,function(a){k.setStyle(a,"display","none")})))},showButton:function(a){this.enableButton(a)},hideButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(k.setStyle(this.disabledButtons[a],
"display","none"),k.setStyle(this.enabledButtons[a],"display","none")):(m.forEach(this.disabledButtons,b.hitch(this,function(a){k.setStyle(a,"display","none")})),m.forEach(this.enabledButtons,b.hitch(this,function(a){k.setStyle(a,"display","none")})))}})})},"dojo/_base/fx":function(){define("./kernel ./config ./lang ../Evented ./Color ../aspect ../sniff ../dom ../dom-style".split(" "),function(n,b,m,k,g,e,f,l,h){var d=m.mixin,a={},c=a._Line=function(a,c){this.start=a;this.end=c};c.prototype.getValue=
function(a){return(this.end-this.start)*a+this.start};var q=a.Animation=function(a){d(this,a);m.isArray(this.curve)&&(this.curve=new c(this.curve[0],this.curve[1]))};q.prototype=new k;m.extend(q,{duration:350,repeat:0,rate:20,_percent:0,_startRepeatCount:0,_getStep:function(){var a=this._percent,c=this.easing;return c?c(a):a},_fire:function(a,c){c=c||[];if(this[a])if(b.debugAtAllCosts)this[a].apply(this,c);else try{this[a].apply(this,c)}catch(z){console.error("exception in animation handler for:",
a),console.error(z)}return this},play:function(a,c){this._delayTimer&&this._clearTimer();if(c)this._stopTimer(),this._active=this._paused=!1,this._percent=0;else if(this._active&&!this._paused)return this;this._fire("beforeBegin",[this.node]);a=a||this.delay;c=m.hitch(this,"_play",c);if(0<a)return this._delayTimer=setTimeout(c,a),this;c();return this},_play:function(a){this._delayTimer&&this._clearTimer();this._startTime=(new Date).valueOf();this._paused&&(this._startTime-=this.duration*this._percent);
this._active=!0;this._paused=!1;a=this.curve.getValue(this._getStep());this._percent||(this._startRepeatCount||(this._startRepeatCount=this.repeat),this._fire("onBegin",[a]));this._fire("onPlay",[a]);this._cycle();return this},pause:function(){this._delayTimer&&this._clearTimer();this._stopTimer();if(!this._active)return this;this._paused=!0;this._fire("onPause",[this.curve.getValue(this._getStep())]);return this},gotoPercent:function(a,c){this._stopTimer();this._active=this._paused=!0;this._percent=
a;c&&this.play();return this},stop:function(a){this._delayTimer&&this._clearTimer();if(!this._timer)return this;this._stopTimer();a&&(this._percent=1);this._fire("onStop",[this.curve.getValue(this._getStep())]);this._active=this._paused=!1;return this},destroy:function(){this.stop()},status:function(){return this._active?this._paused?"paused":"playing":"stopped"},_cycle:function(){if(this._active){var a=(new Date).valueOf(),a=0===this.duration?1:(a-this._startTime)/this.duration;1<=a&&(a=1);this._percent=
a;this.easing&&(a=this.easing(a));this._fire("onAnimate",[this.curve.getValue(a)]);1>this._percent?this._startTimer():(this._active=!1,0<this.repeat?(this.repeat--,this.play(null,!0)):-1==this.repeat?this.play(null,!0):this._startRepeatCount&&(this.repeat=this._startRepeatCount,this._startRepeatCount=0),this._percent=0,this._fire("onEnd",[this.node]),!this.repeat&&this._stopTimer())}return this},_clearTimer:function(){clearTimeout(this._delayTimer);delete this._delayTimer}});var p=0,t=null,u={run:function(){}};
m.extend(q,{_startTimer:function(){this._timer||(this._timer=e.after(u,"run",m.hitch(this,"_cycle"),!0),p++);t||(t=setInterval(m.hitch(u,"run"),this.rate))},_stopTimer:function(){this._timer&&(this._timer.remove(),this._timer=null,p--);0>=p&&(clearInterval(t),t=null,p=0)}});var r=f("ie")?function(a){var c=a.style;c.width.length||"auto"!=h.get(a,"width")||(c.width="auto")}:function(){};a._fade=function(c){c.node=l.byId(c.node);var f=d({properties:{}},c);c=f.properties.opacity={};c.start="start"in f?
f.start:function(){return+h.get(f.node,"opacity")||0};c.end=f.end;c=a.animateProperty(f);e.after(c,"beforeBegin",m.partial(r,f.node),!0);return c};a.fadeIn=function(c){return a._fade(d({end:1},c))};a.fadeOut=function(c){return a._fade(d({end:0},c))};a._defaultEasing=function(a){return.5+Math.sin((a+1.5)*Math.PI)/2};var x=function(a){this._properties=a;for(var c in a){var d=a[c];d.start instanceof g&&(d.tempColor=new g)}};x.prototype.getValue=function(a){var c={},d;for(d in this._properties){var e=
this._properties[d],f=e.start;f instanceof g?c[d]=g.blendColors(f,e.end,a,e.tempColor).toCss():m.isArray(f)||(c[d]=(e.end-f)*a+f+("opacity"!=d?e.units||"px":0))}return c};a.animateProperty=function(a){var c=a.node=l.byId(a.node);a.easing||(a.easing=n._defaultEasing);a=new q(a);e.after(a,"beforeBegin",m.hitch(a,function(){var a={},e;for(e in this.properties){var f=function(a,c){var d={height:a.offsetHeight,width:a.offsetWidth}[c];if(void 0!==d)return d;d=h.get(a,c);return"opacity"==c?+d:b?d:parseFloat(d)};
if("width"==e||"height"==e)this.node.display="block";var l=this.properties[e];m.isFunction(l)&&(l=l(c));l=a[e]=d({},m.isObject(l)?l:{end:l});m.isFunction(l.start)&&(l.start=l.start(c));m.isFunction(l.end)&&(l.end=l.end(c));var b=0<=e.toLowerCase().indexOf("color");"end"in l?"start"in l||(l.start=f(c,e)):l.end=f(c,e);b?(l.start=new g(l.start),l.end=new g(l.end)):l.start="opacity"==e?+l.start:parseFloat(l.start)}this.curve=new x(a)}),!0);e.after(a,"onAnimate",m.hitch(h,"set",a.node),!0);return a};a.anim=
function(c,d,e,f,h,l){return a.animateProperty({node:c,duration:e||q.prototype.duration,properties:d,easing:f,onEnd:h}).play(l||0)};d(n,a);n._Animation=q;return a})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(n,b,m,k,g,e,f,l,h,d){function a(a,c,d){return d?function(a,c){return e(a,d,c)}:t?function(d,f){var h=e(d,c,function(a){f.call(this,a);C=(new Date).getTime()}),l=e(d,a,function(a){(!C||
(new Date).getTime()>C+1E3)&&f.call(this,a)});return{remove:function(){h.remove();l.remove()}}}:function(c,d){return e(c,a,d)}}function c(a){do if(void 0!==a.dojoClick)return a;while(a=a.parentNode)}function q(a,f,h){if(!l.isRight(a)){var b=c(a.target);if(r=!a.target.disabled&&b&&b.dojoClick)if(w=(x="useTarget"==r)?b:a.target,x&&a.preventDefault(),v=a.changedTouches?a.changedTouches[0].pageX-d.global.pageXOffset:a.clientX,z=a.changedTouches?a.changedTouches[0].pageY-d.global.pageYOffset:a.clientY,
y=("object"==typeof r?r.x:"number"==typeof r?r:0)||4,A=("object"==typeof r?r.y:"number"==typeof r?r:0)||4,!u){a=function(a){d.doc.addEventListener(a,function(c){var d=c.target;r&&!c._dojo_click&&(new Date).getTime()<=B+1E3&&("INPUT"!=d.tagName||!k.contains(d,"dijitOffScreen"))&&(c.stopPropagation(),c.stopImmediatePropagation&&c.stopImmediatePropagation(),"click"==a&&("INPUT"!=d.tagName||"radio"==d.type&&(k.contains(d,"dijitCheckBoxInput")||k.contains(d,"mblRadioButton"))||"checkbox"==d.type&&(k.contains(d,
"dijitCheckBoxInput")||k.contains(d,"mblCheckBox")))&&"TEXTAREA"!=d.tagName&&"AUDIO"!=d.tagName&&"VIDEO"!=d.tagName&&c.preventDefault())},!0)};var p=function(a){r=x?m.isDescendant(d.doc.elementFromPoint(a.changedTouches?a.changedTouches[0].pageX-d.global.pageXOffset:a.clientX,a.changedTouches?a.changedTouches[0].pageY-d.global.pageYOffset:a.clientY),w):r&&(a.changedTouches?a.changedTouches[0].target:a.target)==w&&Math.abs((a.changedTouches?a.changedTouches[0].pageX-d.global.pageXOffset:a.clientX)-
v)<=y&&Math.abs((a.changedTouches?a.changedTouches[0].pageY-d.global.pageYOffset:a.clientY)-z)<=A};u=!0;d.doc.addEventListener(f,function(a){l.isRight(a)||(p(a),x&&a.preventDefault())},!0);d.doc.addEventListener(h,function(a){if(!l.isRight(a)&&(p(a),r)){var c=function(c){var d=document.createEvent("MouseEvents");d._dojo_click=!0;d.initMouseEvent(c,!0,!0,a.view,a.detail,f.screenX,f.screenY,f.clientX,f.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null);return d};B=(new Date).getTime();var d=x?
w:a.target;"LABEL"===d.tagName&&(d=m.byId(d.getAttribute("for"))||d);var f=a.changedTouches?a.changedTouches[0]:a,h=c("mousedown"),b=c("mouseup"),q=c("click");setTimeout(function(){e.emit(d,"mousedown",h);e.emit(d,"mouseup",b);e.emit(d,"click",q);B=(new Date).getTime()},0)}},!0);a("click");a("mousedown");a("mouseup")}}}f("ios");var p=function(){var a={},c;for(c in{down:1,move:1,up:1,cancel:1,over:1,out:1})a[c]="pointer"+c;return a}(),t=f("touch-events"),u,r,x=!1,w,v,z,y,A,B,C;f("touch")&&h(function(){d.doc.addEventListener(p.down,
function(a){q(a,p.move,p.up)},!0)});b={press:a("mousedown","touchstart",p.down),move:a("mousemove","dojotouchmove",p.move),release:a("mouseup","dojotouchend",p.up),cancel:a(l.leave,"touchcancel",p.cancel),over:a("mouseover","dojotouchover",p.over),out:a("mouseout","dojotouchout",p.out),enter:l._eventHandler(a("mouseover","dojotouchover",p.over)),leave:l._eventHandler(a("mouseout","dojotouchout",p.out))};return n.touch=b})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),
function(n,b,m,k,g,e){k=n("dojo.dnd.move.constrainedMoveable",e,{constraints:function(){},within:!1,constructor:function(e,l){l||(l={});this.constraints=l.constraints;this.within=l.within},onFirstMove:function(e){var f=this.constraintBox=this.constraints.call(this,e);f.r=f.l+f.w;f.b=f.t+f.h;this.within&&(e=b.getMarginSize(e.node),f.r-=e.w,f.b-=e.h)},onMove:function(e,l){var f=this.constraintBox,d=e.node.style;this.onMoving(e,l);l.l=l.l<f.l?f.l:f.r<l.l?f.r:l.l;l.t=l.t<f.t?f.t:f.b<l.t?f.b:l.t;d.left=
l.l+"px";d.top=l.t+"px";this.onMoved(e,l)}});g=n("dojo.dnd.move.boxConstrainedMoveable",k,{box:{},constructor:function(e,l){var f=l&&l.box;this.constraints=function(){return f}}});n=n("dojo.dnd.move.parentConstrainedMoveable",k,{area:"content",constructor:function(e,l){var f=l&&l.area;this.constraints=function(){var d=this.node.parentNode,a=m.getComputedStyle(d),c=b.getMarginBox(d,a);if("margin"==f)return c;var e=b.getMarginExtents(d,a);c.l+=e.l;c.t+=e.t;c.w-=e.w;c.h-=e.h;if("border"==f)return c;
e=b.getBorderExtents(d,a);c.l+=e.l;c.t+=e.t;c.w-=e.w;c.h-=e.h;if("padding"==f)return c;e=b.getPadExtents(d,a);c.l+=e.l;c.t+=e.t;c.w-=e.w;c.h-=e.h;return c}}});return{constrainedMoveable:k,boxConstrainedMoveable:g,parentConstrainedMoveable:n}})},"dojo/dnd/common":function(){define(["../sniff","../_base/kernel","../_base/lang","../dom"],function(n,b,m,k){var g=m.getObject("dojo.dnd",!0);g.getCopyKeyState=function(e){return e.metaKey};g._uniqueId=0;g.getUniqueId=function(){var e;do e=b._scopeName+"Unique"+
++g._uniqueId;while(k.byId(e));return e};g._empty={};g.isFormElement=function(e){e=e.target;3==e.nodeType&&(e=e.parentNode);return 0<=" a button textarea input select option ".indexOf(" "+e.tagName.toLowerCase()+" ")};return g})},"dojo/dnd/Mover":function(){define("../_base/array ../_base/declare ../_base/lang ../sniff ../_base/window ../dom ../dom-geometry ../dom-style ../Evented ../on ../touch ./common ./autoscroll".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,q){return b("dojo.dnd.Mover",[h],{constructor:function(c,
f,h){function l(a){a.preventDefault();a.stopPropagation()}this.node=e.byId(c);this.marginBox={l:f.pageX,t:f.pageY};this.mouseButton=f.button;f=this.host=h;c=c.ownerDocument;this.events=[d(c,a.move,m.hitch(this,"onFirstMove")),d(c,a.move,m.hitch(this,"onMouseMove")),d(c,a.release,m.hitch(this,"onMouseUp")),d(c,"dragstart",l),d(c.body,"selectstart",l)];q.autoScrollStart(c);if(f&&f.onMoveStart)f.onMoveStart(this)},onMouseMove:function(a){q.autoScroll(a);var c=this.marginBox;this.host.onMove(this,{l:c.l+
a.pageX,t:c.t+a.pageY},a);a.preventDefault();a.stopPropagation()},onMouseUp:function(a){(k("webkit")&&2==this.mouseButton?0==a.button:this.mouseButton==a.button)&&this.destroy();a.preventDefault();a.stopPropagation()},onFirstMove:function(a){var c=this.node.style,d,e=this.host;switch(c.position){case "relative":case "absolute":d=Math.round(parseFloat(c.left))||0;c=Math.round(parseFloat(c.top))||0;break;default:c.position="absolute";c=f.getMarginBox(this.node);d=g.doc.body;var h=l.getComputedStyle(d),
b=f.getMarginBox(d,h),h=f.getContentBox(d,h);d=c.l-(h.l-b.l);c=c.t-(h.t-b.t)}this.marginBox.l=d-this.marginBox.l;this.marginBox.t=c-this.marginBox.t;if(e&&e.onFirstMove)e.onFirstMove(this,a);this.events.shift().remove()},destroy:function(){n.forEach(this.events,function(a){a.remove()});var a=this.host;if(a&&a.onMoveStop)a.onMoveStop(this);this.events=this.node=this.host=null}})})},"dojo/dnd/autoscroll":function(){define("../_base/lang ../sniff ../_base/window ../dom-geometry ../dom-style ../window".split(" "),
function(n,b,m,k,g,e){var f={};n.setObject("dojo.dnd.autoscroll",f);f.getViewport=e.getBox;f.V_TRIGGER_AUTOSCROLL=32;f.H_TRIGGER_AUTOSCROLL=32;f.V_AUTOSCROLL_VALUE=16;f.H_AUTOSCROLL_VALUE=16;var l,h=m.doc,d=Infinity,a=Infinity;f.autoScrollStart=function(c){h=c;l=e.getBox(h);c=m.body(h).parentNode;d=Math.max(c.scrollHeight-l.h,0);a=Math.max(c.scrollWidth-l.w,0)};f.autoScroll=function(c){var b=l||e.getBox(h),p=m.body(h).parentNode,g=0,u=0;c.clientX<f.H_TRIGGER_AUTOSCROLL?g=-f.H_AUTOSCROLL_VALUE:c.clientX>
b.w-f.H_TRIGGER_AUTOSCROLL&&(g=Math.min(f.H_AUTOSCROLL_VALUE,a-p.scrollLeft));c.clientY<f.V_TRIGGER_AUTOSCROLL?u=-f.V_AUTOSCROLL_VALUE:c.clientY>b.h-f.V_TRIGGER_AUTOSCROLL&&(u=Math.min(f.V_AUTOSCROLL_VALUE,d-p.scrollTop));window.scrollBy(g,u)};f._validNodes={div:1,p:1,td:1};f._validOverflow={auto:1,scroll:1};f.autoScrollNodes=function(a){for(var c,d,e,h,l,x=0,w=0,v=a.target;v;){if(1==v.nodeType&&v.tagName.toLowerCase()in f._validNodes){e=g.getComputedStyle(v);l=e.overflowX.toLowerCase()in f._validOverflow;
h=e.overflowY.toLowerCase()in f._validOverflow;if(l||h)c=k.getContentBox(v,e),d=k.position(v,!0);if(l){e=Math.min(f.H_TRIGGER_AUTOSCROLL,c.w/2);l=a.pageX-d.x;if(b("webkit")||b("opera"))l+=m.body().scrollLeft;x=0;0<l&&l<c.w&&(l<e?x=-e:l>c.w-e&&(x=e),v.scrollLeft+=x)}if(h){h=Math.min(f.V_TRIGGER_AUTOSCROLL,c.h/2);e=a.pageY-d.y;if(b("webkit")||b("opera"))e+=m.body().scrollTop;w=0;0<e&&e<c.h&&(e<h?w=-h:e>c.h-h&&(w=h),v.scrollTop+=w)}if(x||w)return}try{v=v.parentNode}catch(z){v=null}}f.autoScroll(a)};
return f})},"dojo/window":function(){define("./_base/lang ./sniff ./_base/window ./dom ./dom-geometry ./dom-style ./dom-construct".split(" "),function(n,b,m,k,g,e,f){b.add("rtl-adjust-position-for-verticalScrollBar",function(e,d){e=m.body(d);d=f.create("div",{style:{overflow:"scroll",overflowX:"visible",direction:"rtl",visibility:"hidden",position:"absolute",left:"0",top:"0",width:"64px",height:"64px"}},e,"last");var a=f.create("div",{style:{overflow:"hidden",direction:"ltr"}},d,"last"),c=0!=g.position(a).x;
d.removeChild(a);e.removeChild(d);return c});b.add("position-fixed-support",function(e,d){e=m.body(d);d=f.create("span",{style:{visibility:"hidden",position:"fixed",left:"1px",top:"1px"}},e,"last");var a=f.create("span",{style:{position:"fixed",left:"0",top:"0"}},d,"last"),c=g.position(a).x!=g.position(d).x;d.removeChild(a);e.removeChild(d);return c});var l={getBox:function(e){e=e||m.doc;var d="BackCompat"==e.compatMode?m.body(e):e.documentElement,a=g.docScroll(e);if(b("touch")){var c=l.get(e);e=
c.innerWidth||d.clientWidth;d=c.innerHeight||d.clientHeight}else e=d.clientWidth,d=d.clientHeight;return{l:a.x,t:a.y,w:e,h:d}},get:function(e){if(b("ie")&&l!==document.parentWindow){e.parentWindow.execScript("document._parentWindow \x3d window;","Javascript");var d=e._parentWindow;e._parentWindow=null;return d}return e.parentWindow||e.defaultView},scrollIntoView:function(f,d){try{f=k.byId(f);var a=f.ownerDocument||m.doc,c=m.body(a),h=a.documentElement||c.parentNode,l=b("ie")||0,t=b("webkit");if(f!=
c&&f!=h){var u="BackCompat"==a.compatMode,r=Math.min(c.clientWidth||h.clientWidth,h.clientWidth||c.clientWidth),x=Math.min(c.clientHeight||h.clientHeight,h.clientHeight||c.clientHeight),a=t||u?c:h,w=d||g.position(f),v=f.parentNode;d=function(a){return 6>=l||7==l&&u?!1:b("position-fixed-support")&&"fixed"==e.get(a,"position").toLowerCase()};var z=this,t=function(a,c,d){"BODY"==a.tagName||"HTML"==a.tagName?z.get(a.ownerDocument).scrollBy(c,d):(c&&(a.scrollLeft+=c),d&&(a.scrollTop+=d))};if(!d(f))for(;v;){v==
c&&(v=a);var y=g.position(v),A=d(v),B="rtl"==e.getComputedStyle(v).direction.toLowerCase();if(v==a)y.w=r,y.h=x,a==h&&l&&B&&(y.x+=a.offsetWidth-y.w),y.x=0,y.y=0;else{var C=g.getPadBorderExtents(v);y.w-=C.w;y.h-=C.h;y.x+=C.l;y.y+=C.t;var F=v.clientWidth,n=y.w-F;0<F&&0<n&&(B&&b("rtl-adjust-position-for-verticalScrollBar")&&(y.x+=n),y.w=F);F=v.clientHeight;n=y.h-F;0<F&&0<n&&(y.h=F)}A&&(0>y.y&&(y.h+=y.y,y.y=0),0>y.x&&(y.w+=y.x,y.x=0),y.y+y.h>x&&(y.h=x-y.y),y.x+y.w>r&&(y.w=r-y.x));var G=w.x-y.x,H=w.y-y.y,
D=G+w.w-y.w,I=H+w.h-y.h,L,O;0<D*G&&(v.scrollLeft||v==a||v.scrollWidth>v.offsetHeight)&&(L=Math[0>G?"max":"min"](G,D),B&&8==l&&!u&&(L=-L),O=v.scrollLeft,t(v,L,0),L=v.scrollLeft-O,w.x-=L);0<I*H&&(v.scrollTop||v==a||v.scrollHeight>v.offsetHeight)&&(L=Math.ceil(Math[0>H?"max":"min"](H,I)),O=v.scrollTop,t(v,0,L),L=v.scrollTop-O,w.y-=L);v=v!=a&&!A&&v.parentNode}}}catch(K){console.error("scrollIntoView: "+K),f.scrollIntoView(!1)}}};n.setObject("dojo.window",l);return l})},"dojo/dnd/Moveable":function(){define("../_base/array ../_base/declare ../_base/lang ../dom ../dom-class ../Evented ../has ../on ../topic ../touch ./common ./Mover ../_base/window".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){var p,t=function(){},t=function(a,c){"touchAction"in document.body.style?p="touchAction":"msTouchAction"in document.body.style&&(p="msTouchAction");t=function(a,c){a.style[p]=c};t(a,c)};return b("dojo.dnd.Moveable",[e],{handle:"",delay:0,skip:!1,constructor:function(a,e){this.node=k.byId(a);t(this.node,"none");e||(e={});this.handle=e.handle?k.byId(e.handle):null;this.handle||(this.handle=this.node);this.delay=0<e.delay?e.delay:0;this.skip=e.skip;this.mover=e.mover?
e.mover:c;this.events=[l(this.handle,d.press,m.hitch(this,"onMouseDown")),l(this.handle,"dragstart",m.hitch(this,"onSelectStart")),l(this.handle,"selectstart",m.hitch(this,"onSelectStart"))]},markupFactory:function(a,c,d){return new d(c,a)},destroy:function(){n.forEach(this.events,function(a){a.remove()});t(this.node,"");this.events=this.node=this.handle=null},onMouseDown:function(c){if(!this.skip||!a.isFormElement(c)){if(this.delay)this.events.push(l(this.handle,d.move,m.hitch(this,"onMouseMove")),
l(this.handle.ownerDocument,d.release,m.hitch(this,"onMouseUp"))),this._lastX=c.pageX,this._lastY=c.pageY;else this.onDragDetected(c);c.stopPropagation();c.preventDefault()}},onMouseMove:function(a){if(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)this.onMouseUp(a),this.onDragDetected(a);a.stopPropagation();a.preventDefault()},onMouseUp:function(a){for(var c=0;2>c;++c)this.events.pop().remove();a.stopPropagation();a.preventDefault()},onSelectStart:function(c){this.skip&&
a.isFormElement(c)||(c.stopPropagation(),c.preventDefault())},onDragDetected:function(a){new this.mover(this.node,a,this)},onMoveStart:function(a){h.publish("/dnd/move/start",a);g.add(q.body(),"dojoMove");g.add(this.node,"dojoMoveItem")},onMoveStop:function(a){h.publish("/dnd/move/stop",a);g.remove(q.body(),"dojoMove");g.remove(this.node,"dojoMoveItem")},onFirstMove:function(){},onMove:function(a,c){this.onMoving(a,c);var d=a.node.style;d.left=c.l+"px";d.top=c.t+"px";this.onMoved(a,c)},onMoving:function(){},
onMoved:function(){}})})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A){function B(a){return function(c){l[c?
"set":"remove"](this.domNode,a,c);this._set(a,c)}}q.add("dijit-legacy-requires",!p.isAsync);q.add("dojo-bidi",!1);q("dijit-legacy-requires")&&r(0,function(){n(["dijit/_base/manager"])});var C={};k=e("dijit._WidgetBase",[x,z],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:B("lang"),dir:"",_setDirAttr:B("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",
a)},attributeMap:{},_blankGif:k.blankGif||n.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var c=a.prototype,d=a._setterAttrs=[],a=a._onMap={},e;for(e in c.attributeMap)d.push(e);for(e in c)/^on/.test(e)&&(a[e.substring(2).toLowerCase()]=e),/^_set[A-Z](.*)Attr$/.test(e)&&(e=e.charAt(4).toLowerCase()+e.substr(5,e.length-9),c.attributeMap&&e in c.attributeMap||d.push(e))}},postscript:function(a,c){this.create(a,c)},create:function(a,c){this._introspect();
this.srcNodeRef=f.byId(c);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,t.mixin(this,a));this.postMixInProperties();this.id||(this.id=A.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=v.body(this.ownerDocument);A.add(this);
this.buildRendering();var d;this.domNode&&(this._applyAttributes(),(a=this.srcNodeRef)&&a.parentNode&&this.domNode!==a&&(a.parentNode.replaceChild(this.domNode,a),d=!0),this.domNode.setAttribute("widgetId",this.id));this.postCreate();d&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},c;for(c in this.params||{})a[c]=this._get(c);b.forEach(this.constructor._setterAttrs,function(c){if(!(c in a)){var d=this._get(c);d&&this.set(c,d)}},this);for(c in a)this.set(c,a[c])},postMixInProperties:function(){},
buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(b.map(a,function(a){return a+"Rtl"})));h.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,b.forEach(this.getChildren(),function(a){a._started||a._destroyed||!t.isFunction(a.startup)||(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=
!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function c(c){c.destroyRecursive?c.destroyRecursive(a):c.destroy&&c.destroy(a)}this._beingDestroyed=!0;this.uninitialize();b.forEach(this._connects,t.hitch(this,"disconnect"));b.forEach(this._supportingWidgets,c);this.domNode&&b.forEach(A.findWidgets(this.domNode,this.containerNode),c);this.destroyRendering(a);A.remove(this.id);this._destroyed=!0},destroyRendering:function(a){this.bgIframe&&(this.bgIframe.destroy(a),delete this.bgIframe);
this.domNode&&(a?l.remove(this.domNode,"widgetId"):d.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(a||d.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){b.forEach(this.getChildren(),function(c){c.destroyRecursive&&c.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var d=this.domNode;t.isObject(a)?c.set(d,a):d.style.cssText=d.style.cssText?d.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,c,d){d=3<=
arguments.length?d:this.attributeMap[a];b.forEach(t.isArray(d)?d:[d],function(d){var e=this[d.node||d||"domNode"];switch(d.type||"attribute"){case "attribute":t.isFunction(c)&&(c=t.hitch(this,c));d=d.attribute?d.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;e.tagName?l.set(e,d,c):e.set(d,c);break;case "innerText":e.innerHTML="";e.appendChild(this.ownerDocument.createTextNode(c));break;case "textContent":e.textContent=c;break;case "innerHTML":e.innerHTML=c;break;case "class":h.replace(e,
c,this[a]);break;case "toggleClass":h.toggle(e,d.className||a,c)}},this)},get:function(a){var c=this._getAttrNames(a);return this[c.g]?this[c.g]():this._get(a)},set:function(a,c){if("object"===typeof a){for(var d in a)this.set(d,a[d]);return this}d=this._getAttrNames(a);var e=this[d.s];if(t.isFunction(e))var f=e.apply(this,Array.prototype.slice.call(arguments,1));else{var e=this.focusNode&&!t.isFunction(this.focusNode)?"focusNode":"domNode",h=this[e]&&this[e].tagName,l;if((l=h)&&!(l=C[h])){l=this[e];
var b={},q;for(q in l)b[q.toLowerCase()]=!0;l=C[h]=b}q=l;d=a in this.attributeMap?this.attributeMap[a]:d.s in this?this[d.s]:q&&d.l in q&&"function"!=typeof c||/^aria-|^data-|^role$/.test(a)?e:null;null!=d&&this._attrToDom(a,c,d);this._set(a,c)}return f||this},_attrPairNames:{},_getAttrNames:function(a){var c=this._attrPairNames;if(c[a])return c[a];var d=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});return c[a]={n:a+"Node",s:"_set"+d+"Attr",g:"_get"+d+"Attr",
l:d.toLowerCase()}},_set:function(a,c){var d=this[a];this[a]=c;!this._created||d===c||d!==d&&c!==c||(this._watchCallbacks&&this._watchCallbacks(a,d,c),this.emit("attrmodified-"+a,{detail:{prevValue:d,newValue:c}}))},_get:function(a){return this[a]},emit:function(a,c,d){c=c||{};void 0===c.bubbles&&(c.bubbles=!0);void 0===c.cancelable&&(c.cancelable=!0);c.detail||(c.detail={});c.detail.widget=this;var e,f=this["on"+a];f&&(e=f.apply(this,d?d:[c]));this._started&&!this._beingDestroyed&&u.emit(this.domNode,
a.toLowerCase(),c);return e},on:function(a,c){var d=this._onMap(a);return d?m.after(this,d,c,!0):this.own(u(this.domNode,a,c))[0]},_onMap:function(a){var c=this.constructor,d=c._onMap;if(!d){var d=c._onMap={},e;for(e in c.prototype)/^on/.test(e)&&(d[e.replace(/^on/,"").toLowerCase()]=e)}return d["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?A.findWidgets(this.containerNode):
[]},getParent:function(){return A.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,c,d){return this.own(g.connect(a,c,this,d))[0]},disconnect:function(a){a.remove()},subscribe:function(a,c){return this.own(w.subscribe(a,t.hitch(this,c)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():a.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=c.get(this.domNode,"display")},placeAt:function(a,c){var e=
!a.tagName&&A.byId(a);!e||!e.addChild||c&&"number"!==typeof c?(a=e&&"domNode"in e?e.containerNode&&!/after|before|replace/.test(c||"")?e.containerNode:e.domNode:f.byId(a,this.ownerDocument),d.place(this.domNode,a,c),!this._started&&(this.getParent()||{})._started&&this.startup()):e.addChild(this,c);return this},defer:function(a,c){var d=setTimeout(t.hitch(this,function(){d&&(d=null,this._destroyed||t.hitch(this,a)())}),c||0);return{remove:function(){d&&(clearTimeout(d),d=null);return null}}}});q("dojo-bidi")&&
k.extend(y);return k})},"dojo/Stateful":function(){define(["./_base/declare","./_base/lang","./_base/array","./when"],function(n,b,m,k){return n("dojo.Stateful",null,{_attrPairNames:{},_getAttrNames:function(b){var e=this._attrPairNames;return e[b]?e[b]:e[b]={s:"_"+b+"Setter",g:"_"+b+"Getter"}},postscript:function(b){b&&this.set(b)},_get:function(b,e){return"function"===typeof this[e.g]?this[e.g]():this[b]},get:function(b){return this._get(b,this._getAttrNames(b))},set:function(b,e){if("object"===
typeof b){for(var f in b)b.hasOwnProperty(f)&&"_watchCallbacks"!=f&&this.set(f,b[f]);return this}f=this._getAttrNames(b);var l=this._get(b,f);f=this[f.s];var h;"function"===typeof f?h=f.apply(this,Array.prototype.slice.call(arguments,1)):this[b]=e;if(this._watchCallbacks){var d=this;k(h,function(){d._watchCallbacks(b,l,e)})}return this},_changeAttrValue:function(b,e){var f=this.get(b);this[b]=e;this._watchCallbacks&&this._watchCallbacks(b,f,e);return this},watch:function(b,e){var f=this._watchCallbacks;
if(!f)var l=this,f=this._watchCallbacks=function(d,a,c,e){var h=function(e){if(e){e=e.slice();for(var f=0,h=e.length;f<h;f++)e[f].call(l,d,a,c)}};h(f["_"+d]);e||h(f["*"])};e||"function"!==typeof b?b="_"+b:(e=b,b="*");var h=f[b];"object"!==typeof h&&(h=f[b]=[]);h.push(e);b={};b.unwatch=b.remove=function(){var d=m.indexOf(h,e);-1<d&&h.splice(d,1)};return b}})})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(n,b,m){return m("dijit.Destroyable",
null,{destroy:function(b){this._destroyed=!0},own:function(){var k=["destroyRecursive","destroy","remove"];n.forEach(arguments,function(g){function e(){l.remove();n.forEach(h,function(d){d.remove()})}var f,l=b.before(this,"destroy",function(d){g[f](d)}),h=[];g.then?(f="cancel",g.then(e,e)):n.forEach(k,function(d){"function"===typeof g[d]&&(f||(f=d),h.push(b.after(g,d,e,!0)))})},this);return arguments}})})},"dijit/registry":function(){define(["dojo/_base/array","dojo/_base/window","./main"],function(n,
b,m){var k={},g={},e={length:0,add:function(e){if(g[e.id])throw Error("Tried to register widget with id\x3d\x3d"+e.id+" but that id is already registered");g[e.id]=e;this.length++},remove:function(e){g[e]&&(delete g[e],this.length--)},byId:function(e){return"string"==typeof e?g[e]:e},byNode:function(e){return g[e.getAttribute("widgetId")]},toArray:function(){var e=[],l;for(l in g)e.push(g[l]);return e},getUniqueId:function(e){var f;do f=e+"_"+(e in k?++k[e]:k[e]=0);while(g[f]);return"dijit"==m._scopeName?
f:m._scopeName+"_"+f},findWidgets:function(e,l){function f(a){for(a=a.firstChild;a;a=a.nextSibling)if(1==a.nodeType){var c=a.getAttribute("widgetId");c?(c=g[c])&&d.push(c):a!==l&&f(a)}}var d=[];f(e);return d},_destroyAll:function(){m._curFocus=null;m._prevFocus=null;m._activeStack=[];n.forEach(e.findWidgets(b.body()),function(e){e._destroyed||(e.destroyRecursive?e.destroyRecursive():e.destroy&&e.destroy())})},getEnclosingWidget:function(e){for(;e;){var f=1==e.nodeType&&e.getAttribute("widgetId");
if(f)return g[f];e=e.parentNode}return null},_hash:g};return m.registry=e})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager"],function(n){function b(){this.versions=[{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(b){return b},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(b){return b},compatible:!0},{version:"2.0.1",description:"The version for Developer Edition 2.0.",upgrader:function(b){var k=
null,g=0,e=b.widgetOnScreen.widgets;if(e&&0<e.length)for(g=0;g<e.length;g++)k=e[g],"widgets/Viz/Widget"===k.uri&&(k.uri="widgets/3DFx/Widget",k.name="3DFx");if((e=b.widgetPool.widgets)&&0<e.length)for(g=0;g<e.length;g++)k=e[g],"widgets/Viz/Widget"===k.uri&&(k.uri="widgets/3DFx/Widget",k.name="3DFx");return b},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(b){return b},compatible:!0},{version:"2.2",description:"The version for Online 4.3.",upgrader:function(b){return b},
compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(b){return b},compatible:!0},{version:"2.4",description:"The version for Online 5.1.",upgrader:function(b){return b},compatible:!0},{version:"2.5",description:"The version for Online 5.2.",upgrader:function(b){return b},compatible:!0},{version:"2.6",description:"The version for Online 5.3.",upgrader:function(b){return b},compatible:!0},{version:"2.7",description:"The version for Online 5.4.",upgrader:function(b){(function(){function k(g){var e=
0,f=0;if(b[g].widgets)for(e=0;e<b[g].widgets.length;e++)if("widgets/Environment/Widget"===b[g].widgets[e].uri){b[g].widgets[e].uri="widgets/Daylight/Widget";break}if(b[g].groups)for(e=0;e<b[g].groups.length;e++)for(var l=b[g].groups[e],f=0;f<l.widgets.length;f++)if("widgets/Environment/Widget"===l.widgets[f].uri){l.widgets[f].uri="widgets/Daylight/Widget";break}}k("widgetOnScreen");k("widgetPool")})();return b},compatible:!0},{version:"2.8",description:"The version for Online 6.1.",upgrader:function(b){return b},
compatible:!0},{version:"2.9",description:"The version for Online 6.2.",upgrader:function(b){return b},compatible:!0},{version:"2.10",description:"The version for Online 6.3.",upgrader:function(b){return b},compatible:!0},{version:"2.11",description:"The version for Online 6.4.",upgrader:function(b){return b},compatible:!0},{version:"2.12",description:"The version for Online 7.1",upgrader:function(b){return b},compatible:!0},{version:"2.13",description:"The version for Online 7.2",upgrader:function(b){return b},
compatible:!0},{version:"2.14",description:"The version for Online 7.3",upgrader:function(b){return b},compatible:!0},{version:"2.15",description:"The version for Online 7.4",upgrader:function(b){return b},compatible:!0},{version:"2.16",description:"The version for Online 8.1",upgrader:function(b){return b},compatible:!0}];this.isCompatible=function(b,k){b=this.getVersionIndex(b);k=this.getVersionIndex(k);for(b+=1;b<=k;b++)if(!1===this.versions[b].compatible)return!1;return!0}}b.prototype=new n;return b.prototype.constructor=
b})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=[];this.upgrade=function(n,b,m){b=this.getVersionIndex(b);m=this.getVersionIndex(m);if(b>=m)throw Error("New version should higher than old version.");for(b+=1;b<=m;b++)this.versions[b].upgrader&&(n=this.versions[b].upgrader(n));return n};this.getVersionIndex=function(n){n=this.fixVersion(n);var b,m;for(m=0;m<this.versions.length;m++)this.versions[m].version===n&&(b=m);null===n&&(b=-1);void 0===b&&(b=
this.versions.length-1);return b};this.fixVersion=function(n){return n?n:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./appConfigResourceUtils ./portalUrlUtils ./AppStateManager esri/identity/IdentityManager esri/core/urlUtils".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w){var v=
null,z;z=n(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(c,d){this._removeHash(c);this.urlParams=c||{};this.widgetManager=a.getInstance();b.mixin(this,d)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(b.hitch(this,function(a){var c=this.checkConfig(a);if(c)throw c;this.rawAppConfig=b.clone(a);r.getInstance().setRawAppConfig(this.rawAppConfig);a=this._upgradeAppConfig(a);this._processAfterTryLoad(a);
this.appConfig=a;if(this.urlParams.id)return this.loadWidgetsManifest(a).then(b.hitch(this,function(){return this._upgradeAllWidgetsConfig(a)})).then(b.hitch(this,function(a){return this.insertAppIdtoResourceUrlofAppConfig(a,this.urlParams.id)})).then(b.hitch(this,function(){this._configLoaded=!0;a.title&&(document.title=window.isBuilder?d.stripHTML(a.title)+" - Web AppBuilder for ArcGIS":d.stripHTML(a.title));this._readAndSetSharedTheme(a);return this.getAppConfig()}));q.setPortalUrl(a.portalUrl);
return this._proesssWebTierAndSignin(a).then(b.hitch(this,function(){if(this.urlParams.appid){if(window.appInfo.isRunInPortal){var c=u.getStandardPortalUrl(a.portalUrl),c=p.getPortal(c);return d.checkEssentialAppsLicense(this.urlParams.appid,c,q.isInBuilderWindow()).then(b.hitch(this,function(){return this._getAppConfigFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(b.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)}))}),b.hitch(this,
function(a){console.error(a);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))}return this._processNotInPortalAppProtocol(a).then(b.hitch(this,function(a){return this._getAppDataAddTemplateDataFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(b.hitch(this,function(c){c.appData.appConfig&&(a=c.appData.appConfig);a._appData=c.appData;a.templateConfig=c.templateData;a.isTemplateApp=!0;return a}))}))}return this._processNotInPortalAppProtocol(a)})).then(b.hitch(this,function(a){this._processAfterTryLoad(a);
this.appConfig=a;return a.map.itemId?a:p.getDefaultWebScene(a.portalUrl).then(function(c){a.map.itemId=c;return a})})).then(b.hitch(this,function(a){return this.loadWidgetsManifest(a)})).then(b.hitch(this,function(a){return a._appData?a._appData.values&&a._appData.values.webmap?p.getPortal(a.portalUrl).getItemById(a._appData.values.webmap).then(b.hitch(this,function(c){return d.template.mergeTemplateAppConfigToAppConfig(a,a._appData,c)})):d.template.mergeTemplateAppConfigToAppConfig(a,a._appData):
a})).then(b.hitch(this,function(){return this._upgradeAllWidgetsConfig(a)})).then(b.hitch(this,function(a){return a._wabAppId?this.processResourceInAppConfigForConfigLoader(a,this.urlParams):a.appItemId&&-1<window.JSON.stringify(a).indexOf("${itemId}")?this.insertAppIdtoResourceUrlofAppConfig(a,a.appItemId):a})).then(b.hitch(this,function(){this.appConfig=a;this._configLoaded=!0;a.title&&(document.title=d.stripHTML(a.title));this._readAndSetSharedTheme(a);return this.getAppConfig()}))}),b.hitch(this,
function(a){this.showError(a)}))},processResourceInAppConfigForConfigLoader:function(a,c){var d=a.portalUrl,e=a.appItemId,h=c.appid,l=new f,q=b.clone(a);this.insertAppIdtoResourceUrlofAppConfig(q,h).then(function(){if("config"===c.mode){var f=this.getResourceUrlsOfAppConfig(a).result;0!==f.length?p.getItemResources(d,h).then(function(a){if(0===a.length)return f=f.map(function(a){return{resUrl:a}}),t.AddResourcesToItemForAppSave(d,f,e,h).then(function(){l.resolve(q)},function(a){console.warn("Add resource to template based app error:"+
a.message||a);l.resolve(q)});l.resolve(q)},function(a){console.warn("Get resource of template based item error:"+a.message||a);l.resolve(q)}):l.resolve(q)}else l.resolve(q)}.bind(this),function(a){console.warn("Insert appId to resource url of appConfig error:"+a.message||a);l.resolve(q)});return l},getResourceUrlsOfAppConfig:function(a){var c={test:function(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(a)},func:b.hitch(this,function(a){return a.value})};return d.processItemResourceOfAppConfig(a,
c)},insertAppIdtoResourceUrlofAppConfig:function(a,c){function e(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(a)}function f(a,c){var d=c.obj,e=c.key,f={obj:d,key:e};"number"===typeof c.i?(f.i=c.i,f.value=d[e][c.i]):f.value=d[e];c=f;a=l.processItemIdAndTokenOfResources(c.value,a);d=c.obj;e=c.key;"number"===typeof c.i?d[e][c.i]=a:d[e]=a;return!0}var h=a.portalUrl,l=this;return p.getPortal(h).getItemById(c).then(b.hitch(this,function(l){l={test:e,func:b.hitch(this,f,{appId:c,isPublic:"public"===
l.access,portalUrl:h})};return d.processItemResourceOfAppConfig(a,l).appConfig}))},processItemIdAndTokenOfResources:function(a,c){0<a.indexOf("${itemId}")&&(a=a.replace("${itemId}",c.appId));/(\?|\&)token=.+/.test(a)&&(a=a.replace(/(\?|\&)token=.+/,""));c.isPublic||(c=q.getPortalCredential(c.portalUrl))&&(a+="?token\x3d"+c.token);return a},getAppConfig:function(){var a=b.clone(this.appConfig);a.getConfigElementById=function(a){return d.getConfigElementById(this,a)};a.getConfigElementsByName=function(a){return d.getConfigElementsByName(this,
a)};a.visitElement=function(a){d.visitElement(this,a)};this._addAuthorizedCrossOriginDomains(this.portalSelf,a);return a},_addAuthorizedCrossOriginDomains:function(a,c){a&&a.authorizedCrossOriginDomains&&q.addAuthorizedCrossOriginDomains(a.authorizedCrossOriginDomains);c&&c.authorizedCrossOriginDomains&&q.addAuthorizedCrossOriginDomains(c.authorizedCrossOriginDomains)},checkConfig:function(a){return(a=this._getRepeatedId(a))?"repeated id:"+a:null},processProxy:function(a){var c=d.getEsriConfigRequestObject();
c.alwaysUseProxy=a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.alwaysUseProxy;c.proxyUrl="";c.proxyRules=[];a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.url&&(c.proxyUrl=a.httpProxy.url);a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.rules&&m.forEach(a.httpProxy.rules,function(a){w.addProxyRule(a)})},addNeedValues:function(a){this._processNoUriWidgets(a);this._processEmptyGroups(a);this._addElementId(a);this._processWidgetJsons(a)},showError:function(a){k.create("div",{"class":"app-error",innerHTML:d.sanitizeHTML(a.message)},
document.body)},_tryLoadConfig:function(){if(this.urlParams.config)return this.configFile=this.urlParams.config,h(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(b.hitch(this,function(a){q.setPortalUrl(a.portalUrl);return this.urlParams.token?q.registerToken(this.urlParams.token).then(function(){return a}):a}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var a=u.getPortalUrlFromLocation(),c=new f;q.setPortalUrl(a);var e;this.urlParams.token?e=q.registerToken(this.urlParams.token):
(e=new f,e.resolve());e.then(b.hitch(this,function(){var e=p.getPortal(a);e.loadSelfInfo().then(b.hitch(this,function(f){this.portalSelf=f;f.allSSL&&"http:"===window.location.protocol?(window.location.href=u.setHttpsProtocol(window.location.href),c.reject()):this._processSignIn(a).then(b.hitch(this,function(){this._getAppConfigFromAppId(a,this.urlParams.id).then(b.hitch(this,function(a){return d.checkEssentialAppsLicense(this.urlParams.id,e,q.isInBuilderWindow()).then(b.hitch(this,function(){this._tryUpdateAppConfigByLocationUrl(a);
return this._processInPortalAppProtocol(a)}),b.hitch(this,function(a){console.error(a);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))})).then(function(a){c.resolve(a)},function(a){c.reject(a)})}))}))}),b.hitch(this,function(a){this.showError(a)}));return c}this.configFile="config.json";return h(this.configFile,{handleAs:"json"}).then(b.hitch(this,function(a){q.setPortalUrl(a.portalUrl);return this.urlParams.token?q.registerToken(this.urlParams.token).then(function(){return a}):a}))},
_upgradeAppConfig:function(a){var c=window.wabVersion,d=a.wabVersion;if(c===d)return a;var e=this.versionManager.getVersionIndex(d),f=this.versionManager.getVersionIndex(c);if(e>f)throw Error("Bad version number, "+d);a=this.versionManager.upgrade(a,d,c);a.wabVersion=c;a.isUpgraded=!0;return a},_upgradeAllWidgetsConfig:function(a){var d=new f,e=[];if(!a.isUpgraded)return d.resolve(a),d;delete a.isUpgraded;c.visitElement(a,b.hitch(this,function(a){a.uri&&(a.config?(a=this.widgetManager.tryLoadWidgetConfig(a),
e.push(a)):a.version=a.manifest.version)}));l(e).then(b.hitch(this,function(){d.resolve(a)}),function(a){d.reject(a)});return d},_processAfterTryLoad:function(a){this._setPortalUrl(a);this._tryUpdateAppConfigByLocationUrl(a);this._processUrlParams(a);this.addNeedValues(a);this.processProxy(a);x.tokenValidity=10080;return a},_readAndSetSharedTheme:function(a){a.theme.sharedTheme||(a.theme.sharedTheme={useHeader:!1,useLogo:!1},a.theme.sharedTheme.isPortalSupport=this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?
!0:!1);a.theme.sharedTheme.useHeader&&(a.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(a.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},a.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text):console.error("Portal does not support sharedTheme."));a.theme.sharedTheme.useLogo&&(a.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(a.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?
this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",!a.logoLink&&this.portalSelf.portalProperties.sharedTheme.logo.link&&(a.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link)):(console.error("Portal does not support sharedTheme, use default logo."),a.logo="images/app-logo.png"))},_tryUpdateAppConfigByLocationUrl:function(a){if(!(this.urlParams.config&&-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var c=u.getPortalUrlFromLocation(),
c=u.getStandardPortalUrl(c);u.isOnline(c)&&(c=u.updateUrlProtocolByOtherUrl(c,a.portalUrl),a.map.portalUrl&&u.isSamePortalUrl(a.portalUrl,a.map.portalUrl)&&(a.map.portalUrl=c),a.portalUrl=c,a.httpProxy&&a.httpProxy.url&&(a.httpProxy.url=u.getPortalProxyUrl(c)))}},_processWidgetJsons:function(a){c.visitElement(a,function(a,c){c.isWidget&&a.uri&&d.processWidgetSetting(a)})},_processNoUriWidgets:function(a){var d=0;c.visitElement(a,function(a,c){c.isWidget&&!a.uri&&(d++,a.placeholderIndex=d)})},_processEmptyGroups:function(a){var c=
0;a.widgetOnScreen.groups&&m.forEach(a.widgetOnScreen.groups,function(a){if(!a.widgets||a.widgets&&0===a.widgets.length)c++,a.placeholderIndex=c})},_addElementId:function(a){var d=0,e;c.visitElement(a,function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var c=a.id.lastIndexOf("_");-1<c&&(e=a.id.substr(c+1),d=Math.max(d,e))}});c.visitElement(a,function(a){a.id||(d++,a.id=a.uri?a.uri.replace(/\//g,"_")+"_"+d:"_"+d)})},_setPortalUrl:function(a){if(a.portalUrl){var c=u.getPortalUrlFromLocation(),d=u.isOnline(c);
u.isSamePortalUrl(a.portalUrl,c)||d||(window.appInfo.isRunInPortal=!1)}else window.isXT&&e("wab_portalurl")?a.portalUrl=e("wab_portalurl"):(window.appInfo.isRunInPortal=!0,a.portalUrl=u.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(a,c){a.portalUrl=u.setProtocol(a.portalUrl,c);a.map.portalUrl&&(a.map.portalUrl=u.setProtocol(a.map.portalUrl,c));a.httpProxy&&(a.httpProxy.url=u.setProtocol(a.httpProxy.url,c),a.httpProxy&&a.httpProxy.rules&&m.forEach(a.httpProxy.rules,b.hitch(this,function(a){a.proxyUrl=
u.setProtocol(a.proxyUrl,c)})))},_processInPortalAppProtocol:function(a){var c=new f,d=p.getPortal(a.portalUrl),e=b.hitch(this,function(d){if("https:"===window.location.protocol)this._changePortalUrlProtocol(a,"https");else{if(d){window.location.href=u.setHttpsProtocol(window.location.href);c.reject();return}this._changePortalUrlProtocol(a,"http")}this._checkLocale();c.resolve(a)});d.loadSelfInfo().then(b.hitch(this,function(c){this.portalSelf=c;"private"===c.access?(c=0===a.portalUrl.toLowerCase().indexOf("https://"),
e(c)):e(c.allSSL)}),b.hitch(this,function(a){c.reject(a)}));return c},_processNotInPortalAppProtocol:function(a){var c=new f;a.portalUrl?p.getPortal(a.portalUrl).loadSelfInfo().then(b.hitch(this,function(d){this.portalSelf=d;var e="https:"===window.location.protocol;(d.allSSL||e)&&this._changePortalUrlProtocol(a,"https");0!==a.portalUrl.toLowerCase().indexOf("https://")||e||q.isInConfigOrPreviewWindow()?c.resolve(a):(window.location.href=u.setHttpsProtocol(window.location.href),c.reject())}),b.hitch(this,
function(a){c.reject(a)})):c.resolve(a);return c},_proesssWebTierAndSignin:function(a){var c=new f,d=!1,e=a.portalUrl;this._processWebTier(a).then(b.hitch(this,function(a){d=a;return p.getPortal(e).loadSelfInfo()})).then(b.hitch(this,function(a){this.portalSelf=a;return this._processSignIn(e,d)})).then(b.hitch(this,function(){c.resolve()}),function(a){c.reject(a)});return c},_processWebTier:function(a){var c=new f,d=a.portalUrl;a.isWebTier?(q.addAuthorizedCrossOriginDomains([d]),q.isWebTierPortal(d).then(b.hitch(this,
function(){var e=q.getPortalCredential(d);e&&e.ssl&&"http:"===window.location.protocol&&!q.isInConfigOrPreviewWindow()?window.location.href=u.setHttpsProtocol(window.location.href):c.resolve(a.isWebTier)}),b.hitch(this,function(a){c.reject(a)}))):c.resolve(!1);return c},_processSignIn:function(a,c){var d=new f,e=p.getPortal(a),h=u.getSharingUrl(a);window.appInfo.isRunInPortal?(c=x.checkSignInStatus(h),c.catch(function(){}).then(b.hitch(this,function(){d.resolve()}))):(q.isInBuilderWindow()||q.isInConfigOrPreviewWindow()||
!this.portalSelf.supportsOAuth||!this.rawAppConfig.appId||c||q.registerOAuthInfo(a,this.rawAppConfig.appId),c=x.checkSignInStatus(h),c.catch(function(){}).then(b.hitch(this,function(){q.xtGetCredentialFromCookie(a);e.loadSelfInfo().then(b.hitch(this,function(a){this.portalSelf=a;this._checkLocale();d.resolve()}))})));return d},_checkLocale:function(){if(!q.isInConfigOrPreviewWindow()){var a=this.portalSelf.user&&this.portalSelf.user.culture||g.locale,a="hi"===a?"en":a.toLowerCase();!this.urlParams.locale&&
d.isLocaleChanged(g.locale,a)&&(e("wab_app_locale",a),window.location.reload())}},_getAppConfigFromTemplateAppId:function(a,c){var d=p.getPortal(a);return this._getWabAppIdAndDataFromTemplateAppId(a,c).then(b.hitch(this,function(c){var e=c.appId,f=c.appData;return l([this._getAppConfigFromAppId(a,e),d.getItemData(f.source)]).then(b.hitch(this,function(a){var c;f.appConfig?(c=f.appConfig,delete f.appConfig):c=a[0];c=this._upgradeAppConfig(c);a=a[1];c._appData=f;c._wabAppId=e;c.templateConfig=a;c.isTemplateApp=
!0;return c}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(a,c){var d=p.getPortal(a);return d.getItemData(c).then(function(a){return d.getItemData(a.source).then(function(c){return{appData:a,templateData:c}})})},_getWabAppIdAndDataFromTemplateAppId:function(a,c){var d=new f,e=p.getPortal(a);e.getItemData(c).then(b.hitch(this,function(a){e.getItemById(a.source).then(b.hitch(this,function(c){c=w.urlToObject(c.url);d.resolve({appId:c.query.id,appData:a})}))}),function(a){d.reject(a)});return d},
_getAppConfigFromAppId:function(a,c){return p.getPortal(a).getItemData(c)},_removeHash:function(a){for(var c in a)a[c]&&(a[c]=a[c].replace("#",""))},loadWidgetsManifest:function(a){function e(c,e,f){function l(d){return c.loadWidgetManifest(d).then(function(a){return a},function(c){console.log("Widget failed to load, it is removed.",d.name);c.stack?console.error(c.stack):console.log(c);h(a,d)})}return e.itemId?p.getPortal(f).getItemById(e.itemId).then(function(c){var f;f=d.isEsriDomain(c.url)?!0:
q.getPortalCredential(a.portalUrl)?!0:!1;if(f)return e.uri=d.widgetJson.getUriFromItem(c),l(e);console.log("Widget is not useable, it is removed.",e.name);h(a,e)}):l(e)}function h(a,c){function d(d){a[d]&&a[d].widgets&&(a[d].widgets=a[d].widgets.filter(function(a){if(c)return a.id!==c.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}));a[d]&&a[d].groups&&a[d].groups.forEach(function(a){a.widgets&&(a.widgets=a.widgets.filter(function(a){if(c)return a.id!==
c.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}))})}d("widgetOnScreen");d("widgetPool")}var r=[],g=new f;a._buildInfo&&a._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(b.hitch(this,function(f){c.visitElement(a,b.hitch(this,function(c){c.widgets||!c.uri&&!c.itemId||(c.uri&&f[c.uri]?(this._addNeedValuesForManifest(f[c.uri],c.uri),d.widgetJson.addManifest2WidgetJson(c,f[c.uri])):r.push(e(this.widgetManager,
c,a.portalUrl)))}));l(r).then(function(){g.resolve(a)})})):(c.visitElement(a,b.hitch(this,function(c){c.widgets||!c.uri&&!c.itemId||r.push(e(this.widgetManager,c,a.portalUrl))})),l(r).then(function(){g.resolve(a)}));setTimeout(function(){g.isResolved()||(h(a),g.resolve(a))},6E4);return g},_addNeedValuesForManifest:function(a,c){b.mixin(a,d.getUriInfo(c));d.addManifestProperies(a);d.processManifestLabel(a,g.locale)},_loadMergedWidgetManifests:function(){return h(window.appInfo.appPath+"widgets/widgets-manifest.json",
{handleAs:"json"})},_getRepeatedId:function(a){var d=[],e;c.visitElement(a,function(a){if(0<d.indexOf(a.id))return e=a.id,!0;d.push(a.id)});return e},_processUrlParams:function(a){var c=this.urlParams.itemid||this.urlParams.webmap;c&&a.map.itemId!==c&&(a.map.mapOptions&&d.deleteMapOptions(a.map.mapOptions),a.map.itemId=c);this.urlParams.mode&&(a.mode=this.urlParams.mode);a.map.mapOptions||(a.map.mapOptions={});this.urlParams.scale&&(a.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||
this.urlParams.zoom)a.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});z.getInstance=function(a,c){null===v?v=new z(a,c):(v.urlParams=a,v.options=c);return v};return z})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json esri/request ./utils ./portalUrlUtils ./tokenUtils".split(" "),function(n,b,m,k,g,e,f,l,h,d,a){var c=n([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,
portalUrl:null,credential:null,constructor:function(a){this.portalUrl=d.getStandardPortalUrl(a);this.selfUrl=d.getPortalSelfInfoUrl(a)},loadSelfInfo:function(){var a=new g,c={query:{f:"json"},responseType:"json",callbackParamName:"callback",cacheBust:!0};this.isValidCredential()&&(c.query.token=this.credential.token);l(this.selfUrl,c).then(b.hitch(this,function(c){c=c.data;var d=c.user;delete c.user;b.mixin(this,c);c.user=d;a.resolve(c)}),b.hitch(this,function(c){console.error(c);a.reject(c)}));return a},
_checkCredential:function(){var c=a.isValidCredential(this.credential);c||this.clearCredentialAndUser();return c},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=a.getPortalCredential(this.portalUrl))},signIn:function(){var c=new g;this.updateCredential();this.isValidCredential()?setTimeout(b.hitch(this,function(){c.resolve(this.credential)}),0):c=a.signInPortal(this.portalUrl);return c},haveSignIn:function(){return a.userHaveSignInPortal(this.portalUrl)},
clearCredentialAndUser:function(){this.user=this.credential=null},getUser:function(){this.updateCredential();var c=new g;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(b.hitch(this,function(){this.user.updateCredential();c.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(b.hitch(this,function(a){this.user=a;c.resolve(this.user)}),b.hitch(this,function(a){console.error(a);c.reject(a)})):a.getUserIdByToken(this.credential.token,
this.portalUrl).then(b.hitch(this,function(a){this.credential.userId=a;this._getUser(this.credential.userId).then(b.hitch(this,function(a){this.user=a;c.resolve(this.user)}),b.hitch(this,function(a){console.error(a);c.reject(a)}))}),b.hitch(this,function(a){console.error(a);c.reject(a)})):setTimeout(b.hitch(this,function(){c.reject("credential is null.")}),0);return c},queryItems:function(a){this.updateCredential();var c=new g,e=d.getBaseSearchUrl(this.portalUrl),f={f:"json"};a&&(f=b.mixin(f,a));
this.isValidCredential()&&(f.token=this.credential.token);f.sortField||f.sortOrder||(f.sortField="title",f.sortOrder="asc");l(e,{responseType:"json",query:f,callbackParamName:"callback"}).then(b.hitch(this,function(a){a=a.data;a.results=m.map(a.results,b.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new t(a)}));c.resolve(a)}),b.hitch(this,function(a){console.error(a);c.reject(a)}));return c},getItemData:function(a){this.updateCredential();a=d.getItemDataUrl(this.portalUrl,
a);var c={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(c.query.token=this.credential.token);var e=new g;l(a,c).then(b.hitch(this,function(a){e.resolve(a.data)}),b.hitch(this,function(a){e.reject(a)}));return e},getItemById:function(a){var c=new g;this.updateCredential();a=d.getItemUrl(this.portalUrl,a);var e={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(e.query.token=this.credential.token);l(a,e).then(b.hitch(this,
function(a){a=a.data;a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new t(a);c.resolve(a)}),b.hitch(this,function(a){console.error(a);c.reject(a)}));return c},getAppById:function(a){var c=new g;this.updateCredential();this.isValidCredential()?(a=d.getAppIdUrl(this.portalUrl,a),l(a,{responseType:"json",query:{f:"json",token:this.credential.token}}).then(b.hitch(this,function(a){c.resolve(a.data)}),b.hitch(this,function(a){c.reject(a)}))):setTimeout(b.hitch(this,function(){c.reject("token is null.")}),
0);return c},queryGroups:function(a){this.updateCredential();var c=new g,e=d.getBaseGroupUrl(this.portalUrl),f={f:"json"};a&&(f=b.mixin(f,a));this.isValidCredential()&&(f.token=this.credential.token);l(e,{responseType:"json",query:f,callbackParamName:"callback"}).then(b.hitch(this,function(a){a=a.data;a.results=m.map(a.results,b.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new p(a)}));c.resolve(a)}),b.hitch(this,function(a){console.error(a);c.reject(a)}));
return c},registerApp:function(a,c,e){var h=new g;this.updateCredential();if(this.isValidCredential()){var q=this.credential&&this.credential.token,p=d.getOAuth2Url(this.portalUrl);l(p+"/registerApp",{query:{itemId:a,appType:c,redirect_uris:f.stringify(e),token:q,f:"json"},responseType:"json",method:"post"}).then(b.hitch(this,function(a){h.resolve(a.data)}),b.hitch(this,function(a){h.reject(a)}))}else setTimeout(b.hitch(this,function(){h.reject("token is null.")}),0);return h},createAndRegisterApp:function(a){var c=
new g;this.updateCredential();this.isValidCredential()?this.getUser().then(b.hitch(this,function(d){d.addItem({title:"Web AppBuilder for ArcGIS",type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(b.hitch(this,function(d){d.success?this.registerApp(d.id,"browser",a).then(b.hitch(this,function(a){c.resolve(a)}),b.hitch(this,function(a){console.error(a);c.reject(a)})):c.reject("create app failed")}),b.hitch(this,function(a){console.error(a);c.reject(a)}))}),b.hitch(this,
function(a){console.error(a);c.reject(a)})):setTimeout(b.hitch(this,function(){c.reject("token is null.")}),0);return c},_getUser:function(a){this.updateCredential();var c=new g;a=d.getUserUrl(this.portalUrl,a);var e={query:{f:"json"},responseType:"json",callbackParamName:"callback"};this.isValidCredential()&&(e.query.token=this.credential&&this.credential.token);l(a,e).then(b.hitch(this,function(a){a=a.data;a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;this.user=new q(a);
c.resolve(this.user)}),b.hitch(this,function(a){console.error(a);c.reject(a)}));return c},getItemResources:function(a,c,e){e||(e=100);a=d.getStandardPortalUrl(a);a=d.getItemResourceUrl(a,c);return l({url:a,content:{f:"json",num:e}}).then(function(a){if(a&&a.resources)return a.resources})},addResource:function(a,c,e,f,h){a=d.getStandardPortalUrl(a);var b=this.getPortal(a),q=new FormData;q.append("file",e,f);q.append("fileName",f);q.append("f","json");var p="";h?(q.append("resourcesPrefix",h),p=h+"/"+
f):p=f;return b.getItemById(c,!0).then(function(e){e=d.getUserContentItemUrl(a,e.owner,c);return l({url:e+"/addResources",form:q}).then(function(c){var e="";c&&c.success&&(e=d.getItemResourceUrl(a,"${itemId}",p));return e},function(a){console.error(a.message||a);return a})})},removeResources:function(a,c,e,f){var h={resource:f?f+"/"+e:e,f:"json"};a=d.getStandardPortalUrl(a);return this.getPortal(a).getItemById(c,!0).then(function(e){e=d.getUserContentItemUrl(a,e.owner,c);return l({url:e+"/removeResources",
content:h},{usePost:!0}).then(function(a){return a},function(a){console.error(a.message||a);return a})})}}),q=n([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&b.mixin(this,a)},_checkCredential:function(){var c=a.isValidCredential(this.credential);c||(this.credential=null);return c},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),
this.credential=this.portal.credential)},getGroups:function(){var a=[];this.groups&&(a=m.map(this.groups,b.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this.portal;return new p(a)})));return a},getItemsByKeywords:function(a,c){return this.portal.queryItems({start:c||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+a+'"'})},getContent:function(){this.updateCredential();var a=d.getUserContentUrl(this.portalUrl,this.username),c={responseType:"json",
query:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(c.query.token=this.credential.token);var e=new g;l(a,c).then(b.hitch(this,function(a){e.resolve(a.data)}),b.hitch(this,function(a){e.reject(a)}));return e},getTags:function(){this.updateCredential();var a=d.getUserTagsUrl(this.portalUrl,this.username),c={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(c.query.token=this.credential.token);var e=new g;l(a,c).then(b.hitch(this,function(a){e.resolve(a.data)}),
b.hitch(this,function(a){e.reject(a)}));return e},addItem:function(a,c){this.updateCredential();var e=new g;if(this.isValidCredential()){var f={f:"json",token:this.credential.token};a&&(f=b.mixin(f,a));a=d.getAddItemUrl(this.portalUrl,this.username,c);l(a,{responseType:"json",callbackParamName:"callback",query:f,method:"post"}).then(b.hitch(this,function(a){e.resolve(a.data)}),b.hitch(this,function(a){console.error(a);e.reject(a)}))}else setTimeout(b.hitch(this,function(){e.reject("token is null.")}),
0);return e},deleteItem:function(a){this.updateCredential();var c=new g;this.isValidCredential()?(a=d.getDeleteItemUrl(this.portalUrl,this.username,a),l(a,{query:{token:this.credential.token,f:"json"},responseType:"json",method:"post"}).then(b.hitch(this,function(a){c.resolve(a.data)}),b.hitch(this,function(a){c.reject(a)}))):setTimeout(b.hitch(this,function(){c.reject("token is null.")}),0);return c},getItemById:function(a,c){this.updateCredential();var e=new g;c=d.getUserItemsUrl(this.portalUrl,
this.username,c);var f={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(f.query.token=this.credential.token);l(c+"/"+a,f).then(b.hitch(this,function(a){a=a.data;a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new t(a);e.resolve(a)}),b.hitch(this,function(a){console.error(a);e.reject(a)}));return e},shareItem:function(a,c,e){this.updateCredential();var f=new g;this.isValidCredential()?(c=d.shareItemUrl(this.portalUrl,this.username,
c,e),e={responseType:"json",callbackParamName:"callback",query:{f:"json",token:this.credential.token},method:"post"},a&&(a.content&&!a.query&&(a.query=a.content),e.query=b.mixin(e.query,a)),l(c,e).then(b.hitch(this,function(a){f.resolve(a.data)}),b.hitch(this,function(a){console.error(a);f.reject(a)}))):setTimeout(b.hitch(this,function(){f.reject("token is null.")}),0);return f},updateItem:function(a,c){this.updateCredential();var e=new g;this.isValidCredential()?this.portal.getItemById(a).then(b.hitch(this,
function(f){var h={f:"json",token:this.credential.token};c&&(h=b.mixin(h,c));f=d.getUpdateItemUrl(this.portalUrl,this.username,a,f.ownerFolder);l(f,{responseType:"json",callbackParamName:"callback",timeout:1E5,query:h,method:"post"}).then(b.hitch(this,function(a){e.resolve(a.data)}),b.hitch(this,function(a){console.error(a);e.reject(a)}))}),b.hitch(this,function(a){console.error(a);e.reject(a)})):setTimeout(b.hitch(this,function(){e.reject("token is null.")}),0);return e},isAdminRole:function(){return"org_admin"===
this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role}}),p=n([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&b.mixin(this,a)},_checkCredential:function(){var c=a.isValidCredential(this.credential);c||(this.credential=null);return c},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(a){a.q="group:"+this.id+" AND "+a.q;return this.portal.queryItems(a)}}),t=n([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(a){a&&b.mixin(this,a);this.itemUrl=d.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&
this.thumbnail&&this.itemUrl&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=d.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=d.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var c=a.isValidCredential(this.credential);c||(this.credential=null);
return c},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)}}),u={portals:[],webMapQueryStr:" "+h.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+h.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(a){for(var c=0;c<this.portals.length;c++){var e=
this.portals[c];if(d.isSamePortalUrl(a,e.portalUrl))return e.updateCredential(),e}return null},getPortal:function(e){if(!e||"string"!==typeof e||!b.trim(e))return null;e=d.getStandardPortalUrl(e);var f=this._findPortal(e);f||(f=new c(e),f.credential=a.getPortalCredential(f.portalUrl),f.updateCredential(),this.portals.push(f));return f},getPortalSelfInfo:function(a){return this.getPortal(a).loadSelfInfo()},getBasemapGalleryGroup:function(a){return this._getPortalSelfGroup(a,"basemapGalleryGroupQuery")},
getTemplatesGroup:function(a){return this._getPortalSelfGroup(a,"templatesGroupQuery")},getUnits:function(a){var c="english",d="",e=new g;this.getPortal(a).getUser().then(b.hitch(this,function(a){a&&a.units?c=a.units:(d=k.locale,c=d.startWith("en")?"english":"metric");e.resolve(c)}),b.hitch(this,function(f){console.warn(f);this.getPortalSelfInfo(a).then(b.hitch(this,function(a){var c=null;a&&a.units?c=a.units:(d=a&&a.culture||k.locale,c=d.startWith("en")?"english":"metric");e.resolve(c)}),b.hitch(this,
function(a){console.warn(a);d=k.locale;c=d.startWith("en")?"english":"metric";e.resolve(c)}))}));return e.promise},_getPortalSelfGroup:function(a,c){var d=new g,e=this.getPortal(a);e||setTimeout(b.hitch(this,function(){d.reject()}),0);this.getPortalSelfInfo(a).then(b.hitch(this,function(a){e.queryGroups({f:"json",q:a[c]}).then(b.hitch(this,function(a){0<a.results.length?(a=a.results[0],a.portalUrl=e.portalUrl,a.credential=e.credential,a.portal=e,a=new p(a),d.resolve(a)):d.reject("Can't find portal self group.")}),
b.hitch(this,function(a){console.error(a);d.reject(a)}))}),b.hitch(this,function(a){console.error(a);d.reject(a)}));return d},getWebMapsFromBasemapGalleryGroup:function(a){var c=new g;this.getBasemapGalleryGroup(a).then(b.hitch(this,function(a){a?a.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(b.hitch(this,function(a){c.resolve(a)}),b.hitch(this,function(a){console.error(a);c.reject(a)})):c.reject()}),b.hitch(this,function(a){console.error(a);c.reject(a)}));return c},getDefaultWebScene:function(a){var c=
new g,d=this.getPortal(a);d.getUser().then(b.hitch(this,function(a){d.queryItems({start:1,num:1,f:"json",q:this.webSceneQueryStr+' AND owner:"'+a.username+'" ',sortField:"numViews",sortOrder:"desc"}).then(b.hitch(this,function(a){a=a.results;a=m.filter(a,b.hitch(this,function(a){return a.type&&"web scene"===a.type.toLowerCase()}));0<a.length?c.resolve(a[0].id):c.resolve(null)}),b.hitch(this,function(a){c.reject(a)}))}),b.hitch(this,function(){c.reject("not sign in")}));return c},getDefaultWebMap:function(a){var c=
new g;this.getPortalSelfInfo(a).then(b.hitch(this,function(d){var e=d.defaultBasemap&&d.defaultBasemap.id;e?c.resolve(e):this._getDefaultWebMapByBasemapGallery(a,d).then(b.hitch(this,function(d){d?c.resolve(d):this._getMostNumViewsWebMap(a).then(b.hitch(this,function(a){a?c.resolve(a):c.reject()}),b.hitch(this,function(a){console.error(a);c.reject(a)}))}),b.hitch(this,function(a){console.error(a);c.reject(a)}))}),b.hitch(this,function(a){console.error(a);c.reject(a)}));return c},_getDefaultWebMapByBasemapGallery:function(a,
c){var d=new g,e=this.getPortal(a),f=c.defaultBasemap&&c.defaultBasemap.title;e.queryGroups({f:"json",q:c.basemapGalleryGroupQuery}).then(b.hitch(this,function(a){a=a.results;0<a.length?e.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+a[0].id+" AND title:"+f}).then(b.hitch(this,function(a){a=a.results;a=m.filter(a,b.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?d.resolve(a[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),
e.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+f}).then(b.hitch(this,function(a){a=a.results;a=m.filter(a,b.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));if(0<a.length){var c=a[0];e.getItemData(c.id).then(b.hitch(this,function(a){a&&(a.operationalLayers||a.baseMap||a.version)?d.resolve(c.id):d.resolve(null)}),b.hitch(this,function(){d.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),d.resolve(null)}),b.hitch(this,
function(a){console.error(a);d.reject(a)})))}),b.hitch(this,function(a){console.error(a);d.reject(a)})):(console.log("Can't find group by basemapGalleryGroupQuery."),d.resolve(null))}),b.hitch(this,function(a){console.error(a);d.reject(a)}));return d},_getMostNumViewsWebMap:function(a){var c=new g;this.getPortal(a).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(b.hitch(this,function(a){a=a.results;a=m.filter(a,
b.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?c.resolve(a[0].id):c.reject("Can't find most-num-views web map.")}),b.hitch(this,function(a){console.error(a);c.reject(a)}));return c}};e.subscribe("userSignOut",function(a){(a=u._findPortal(a))&&a.clearCredentialAndUser()});return u})},"jimu/appConfigResourceUtils":function(){define(["dojo/Deferred","dojo/promise/all","jimu/portalUtils","jimu/utils"],function(n,b,m,k){return{AddResourcesToItemForAppSave:function(g,
e,f,l){e=e||[];if(0===e.length){var h=new n;h.resolve(e);return h}e=e.map(function(d){var a=d.resUrl.split("resources/")[1],c=new n;d.b64?(d=k.b64toBlob(d.b64),c.resolve({blob:d,fileName:a.split("/")[1],prefixName:a.split("/")[0]})):(d=d.resUrl,0<d.indexOf("${itemId}")&&(d=d.replace("${itemId}",f)),k.resourcesUrlToBlob(d).then(function(d){c.resolve({blob:d,fileName:a.split("/")[1],prefixName:a.split("/")[0]},function(a){console.error(a.message||a);c.reject(a)})}));return c});return b(e).then(function(d){if(d instanceof
Array&&0<d.length)return d=d.map(function(a){var c=f;l&&(c=l);return m.addResource(g,c,a.blob,a.fileName,a.prefixName)}.bind(this)),b(d).then(function(a){return a})}.bind(this))}}})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/geometry/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(n,b,m,k,g,e,f,l,h){var d=null,a=n(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(a){this.rawAppConfig=
a},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var a=k.stringify(this.rawAppConfig.map);this.mapMd5=l(a)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var a=new m,d={};if(h.isInConfigOrPreviewWindow()||!this.rawAppConfig||!this.rawAppConfig.map)return a.resolve(d),a;var l=this._getAppStateKey(),b=f.get(l);b&&b.appStateMd5===this._getAppStateMd5()?
(l=b.map&&b.map.extent,b=b.map&&b.map.layers,l&&(d.extent=new g(l.xmin,l.ymin,l.xmax,l.ymax,new e(l.spatialReference))),b&&(d.layers=b)):f.remove(l);a.resolve(d);return a},saveWabAppState:function(a,d){if(a&&!h.isInConfigOrPreviewWindow()){var c=this._getAppStateKey(),e={extent:{xmin:a.extent.xmin,xmax:a.extent.xmax,ymin:a.extent.ymin,ymax:a.extent.ymax,spatialReference:{wkid:a.extent.spatialReference.wkid,wkt:a.extent.spatialReference.wkt}},layers:{}};d&&d.traversalLayerInfosOfWebmap&&d.traversalLayerInfosOfWebmap(b.hitch(this,
function(a){e.layers[a.id]={visible:a.isShowInMap()}}));f.set(c,{map:e,appStateMd5:this._getAppStateMd5()})}}});a.getInstance=function(c){null===d&&(d=new a);d.urlParams=c;return d};return a})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/Deferred dojo/promise/all dojo/debounce require ./MapManager ./utils".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,q){var p=null,t;t=n([k],{constructor:function(a,c){this.own(g.subscribe("appConfigLoaded",
b.hitch(this,this._onAppConfigLoaded)));this.own(g.subscribe("appConfigChanged",b.hitch(this,this._onAppConfigChanged)));this.own(g.subscribe("sceneViewLoaded",b.hitch(this,this._onSceneViewLoaded)));this.own(g.subscribe("sceneViewChanged",b.hitch(this,this._onSceneViewChanged)));this.own(g.subscribe("beforeSceneViewDestory",b.hitch(this,this._onBeforeSceneViewDestroy)));this.own(g.subscribe("builder/actionTriggered",b.hitch(this,this._onActionTriggered)));this.own(g.subscribe("openWidget",b.hitch(this,
this._onOpenWidgetRequest)));this.own(e(window,"resize",d(b.hitch(this,this.resize),200)));this.id=c},postCreate:function(){this.containerNode=this.domNode},sceneView:null,mapId:"map",mapDiv:null,layoutManager:null,animTime:500,resize:function(){this.layoutManager&&this.layoutManager.resize()},_onAppConfigLoaded:function(a){this.appConfig=b.clone(a);this._loadLayoutManager(this.appConfig).then(b.hitch(this,function(a){this.layoutManager=a;this.layoutManager.onEnter(this.appConfig,this.mapId).then(b.hitch(this,
function(){this.mapDiv=this.layoutManager.getMapDiv();this._loadMap(this.mapId);this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))}))},_loadLayoutManager:function(c){c=c.layoutDefinition?c.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager";var d=new l;a([c],b.hitch(this,function(a){a=a.getInstance();this.sceneView&&a.setSceneView(this.sceneView);d.resolve(a)}));return d},_loadMap:function(){this.mapManager=c.getInstance({appConfig:this.appConfig,urlParams:this.urlParams},
this.mapId);this.mapManager.showMap()},_onSceneViewLoaded:function(a){this.sceneView=a;this.layoutManager.setSceneView(a);this.layoutManager.loadAndLayout(this.appConfig)},_loadTheme:function(c){var d=new l;a(["themes/"+c.name+"/main"],b.hitch(this,function(){h([this._loadThemeCommonStyle(c),this._loadThemeCurrentStyle(c)]).then(b.hitch(this,function(){this._addCustomStyle(c);this.layoutManager.onThemeLoad();d.resolve()}))}));return d},_loadThemeCommonStyle:function(a){m.addClass(this.domNode,a.name);
return q.loadStyleLink(this._getThemeCommonStyleId(a),"themes/"+a.name+"/common.css")},_loadThemeCurrentStyle:function(a){m.addClass(this.domNode,a.styles[0]);return q.loadStyleLink(this._getThemeCurrentStyleId(a),"themes/"+a.name+"/styles/"+a.styles[0]+"/style.css")},_addCustomStyle:function(a){var c=b.getObject("customStyles",!1,a);if(c){var d=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(a=this._getFixedThemeStyles(a))&&(d+=a);d=b.replace(d,c,/\$\{([^\}]+)\}/g);
c=m.create("style",{type:"text/css"});try{c.appendChild(document.createTextNode(d))}catch(w){c.styleSheet.cssText=d}c.setAttribute("source","custom");document.head.appendChild(c)}},_getFixedThemeStyles:function(a){var c=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";"PlateauTheme"===a.name?c+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}.jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important}":
"BillboardTheme"===a.name?c+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-navigate, .jimu-widget-home, .jimu-widget-zoom .esri-zoom .esri-widget, .jimu-widget-placeholder{background-color: ${mainBackgroundColor} !important;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important;}":
"BoxTheme"===a.name?c+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate, .jimu-widget-navigate, .jimu-widget-home, .jimu-widget-zoom .esri-zoom .esri-widget, .jimu-widget-placeholder{background-color: ${mainBackgroundColor} !important;}":"TabTheme"===a.name?c+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}":
"DashboardTheme"===a.name?c+=".jimu-widget-dnd-header{background-color: ${mainBackgroundColor} !important;}":"DartTheme"===a.name&&(c+=".jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}");return c},_onAppConfigChanged:function(a,c,d){a=b.clone(a);switch(c){case "themeChange":this._onThemeChange(a);break;case "styleChange":this._onStyleChange(a);break;case "layoutChange":this._onLayoutChange(a);break;case "widgetChange":this._onWidgetChange(a,d);break;case "groupChange":this._onGroupChange(a,
d);break;case "widgetPoolChange":this._onWidgetPoolChange(a,d);break;case "resetConfig":this._onResetConfig(a);break;case "loadingPageChange":this._onLoadingPageChange(a,d);break;case "layoutDefinitionChange":this._onLayoutDefinitionChange(a,d);break;case "onScreenGroupsChange":this._onOnScreenGroupsChange(a,d);break;case "onScreenOrderChange":this._onOnScreenOrderChange(a,d)}this.appConfig=a},_onSceneViewChanged:function(a){this.sceneView=a;this.layoutManager.setSceneView(a);this.layoutManager.loadAndLayout(this.appConfig)},
_onBeforeSceneViewDestroy:function(){this.layoutManager.destroyOnScreenWidgetsAndGroups()},_onActionTriggered:function(a){this.layoutManager.onActionTriggered(a)},_onWidgetChange:function(a,c){this.layoutManager.onWidgetChange(a,c)},_onGroupChange:function(a,c){this.layoutManager.onGroupChange(a,c)},_onWidgetPoolChange:function(a,c){this.layoutManager.onWidgetPoolChange(a,c)},_onLayoutDefinitionChange:function(a,c){this.layoutManager.onLayoutDefinitionChange(a,c)},_onOnScreenGroupsChange:function(a,
c){this.layoutManager.onOnScreenGroupsChange(a,c)},_onOnScreenOrderChange:function(a,c){this.layoutManager.onOnScreenOrderChange(a,c)},_onThemeChange:function(a){this.layoutManager.destroyOnScreenWidgetsAndGroups();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();h([this._loadLayoutManager(a),this._loadTheme(a.theme)]).then(b.hitch(this,function(c){var d=c[0];this.layoutManager.name!==d.name?(this.layoutManager.onLeave(),
d.onEnter(a,this.mapId).then(b.hitch(this,function(){this.layoutManager=d;this.layoutManager.loadAndLayout(a)}))):this.layoutManager.loadAndLayout(a)}))},_onResetConfig:function(a){var c=this.appConfig;g.publish("appConfigChanged",a,"mapChange",a);this.appConfig=c;this._loadLayoutManager(a).then(b.hitch(this,function(a){this.layoutManager=a;this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();this._loadTheme(this.appConfig.theme)}))},
_onLoadingPageChange:function(a,c){"backgroundColor"in c?m.setStyle(jimuConfig.loadingId,"background-color",a.loadingPage.backgroundColor):"backgroundImage"in c?(a=a.loadingPage.backgroundImage,a.visible&&a.uri?(m.setStyle(jimuConfig.loadingImageId,"background-image","url('"+a.uri+"')"),m.setStyle(jimuConfig.loadingImageId,"width",a.width+"px"),m.setStyle(jimuConfig.loadingImageId,"height",a.height+"px")):(m.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),m.setStyle(jimuConfig.loadingImageId,
"width","0px"),m.setStyle(jimuConfig.loadingImageId,"height","0px"))):"loadingGif"in c&&(a=a.loadingPage.loadingGif,a.visible&&a.uri?(m.setStyle(jimuConfig.loadingGifId,"background-image","url('"+a.uri+"')"),m.setStyle(jimuConfig.loadingGifId,"width",a.width+"px"),m.setStyle(jimuConfig.loadingGifId,"height",a.height+"px")):(m.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),m.setStyle(jimuConfig.loadingGifId,"width","0px"),m.setStyle(jimuConfig.loadingGifId,"height","0px")))},_onStyleChange:function(a){this._removeThemeCurrentStyle(this.appConfig.theme);
this._loadThemeCurrentStyle(a.theme);this._removeCustomStyle();this._addCustomStyle(a.theme)},_onLayoutChange:function(a){this.layoutManager.onLayoutChange(a)},_removeThemeCommonStyle:function(a){m.removeClass(this.domNode,a.name);m.destroy(this._getThemeCommonStyleId(a))},_removeThemeCurrentStyle:function(a){m.removeClass(this.domNode,a.styles[0]);m.destroy(this._getThemeCurrentStyleId(a))},_removeCustomStyle:function(){f('style[source\x3d"custom"]',document.head).forEach(function(a){m.destroy(a)})},
_getThemeCommonStyleId:function(a){return"theme_"+a.name+"_style_common"},_getThemeCurrentStyleId:function(a){return"theme_"+a.name+"_style_"+a.styles[0]},_doPostLoad:function(){a(["dynamic-modules/postload"])},_onOpenWidgetRequest:function(a){this.layoutManager.openWidget(a)}});t.getInstance=function(a,c){null===p&&(p=new t(a,c),window._layoutManager=p);return p};return t})},"dojo/debounce":function(){define([],function(){return function(n,b){var m;return function(){m&&clearTimeout(m);var k=this,
g=arguments;m=setTimeout(function(){n.apply(k,g)},b)}}})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/on dojo/keys esri/geometry/Extent esri/geometry/Point ./utils ./dijit/LoadingShelter ./AppStateManager ./WebSceneLoader esri/Viewpoint".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){var t=null,u=n(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,
constructor:function(a,d){this.appConfig=a.appConfig;this.urlParams=a.urlParams;this.id=this.mapDivId=d;this.appStateManager=c.getInstance(this.urlParams);g.subscribe("appConfigChanged",b.hitch(this,this.onAppConfigChanged));g.subscribe("changeMapPosition",b.hitch(this,this.onChangeMapPosition));g.subscribe("syncViewpoint",b.hitch(this,this.onSyncViewpoint));e(window,"resize",b.hitch(this,this.onWindowResize));e(window,"beforeunload",b.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},
_showMap:function(c){console.time("Load Map");this.loading=new a;this.loading.placeAt(this.mapDivId);this.loading.startup();c.map["3D"]?c.map.itemId?this._show3DWebScene(c):console.log("No webscene found. Please set map.itemId in config.json."):c.map.itemId?this._show2DWebMap(c):console.log("No webmap found. Please set map.itemId in config.json.")},onBeforeUnload:function(){this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),
this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(a){a&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&this._mapMobileInfoWindow.destroy(),this.isMobileInfoWindow=!1);window.appInfo.isRunInMobile&&!this.isMobileInfoWindow?this.isMobileInfoWindow=!0:!window.appInfo.isRunInMobile&&this.isMobileInfoWindow&&(this.isMobileInfoWindow=!1)},onChangeMapPosition:function(a){var c=b.clone(this.mapPosition);
b.mixin(c,a);this.setMapPosition(c)},setMapPosition:function(a){this.mapPosition=a;a=d.getPositionStyle(a);k.setStyle(this.mapDivId,a);this.map&&this.map.resize&&this.map.resize()},getMapPosition:function(){return this.mapPosition},onSyncViewpoint:function(a){this.sceneView&&(this.sceneView.viewpoint=a.clone())},_visitConfigMapLayers:function(a,c){m.forEach(a.map.basemaps,function(a,d){a.isOperationalLayer=!1;c(a,d)},this);m.forEach(a.map.operationallayers,function(a,d){a.isOperationalLayer=!0;c(a,
d)},this)},_destroySceneView:function(){if(this.sceneView)try{this.sceneView.destroy()}catch(r){console.error(r)}this.sceneView=null;window._sceneView=null},_show3DWebScene:function(a){var c=a.map.portalUrl,d=a.map.itemId;this._destroySceneView();q.createMap(this.mapDivId,c,d).then(b.hitch(this,function(c){this._publishSceneViewEvent(c);if(a.map.mapOptions)if((c=a.map.mapOptions.initialState)&&c.viewpoint)try{var d=p.fromJSON(c.viewpoint);d&&(this.sceneView.map.initialViewProperties.viewpoint=d,this.sceneView.viewpoint=
d.clone())}catch(y){console.error(y)}else this.sceneView.map.initialViewProperties.viewpoint=this.sceneView.viewpoint}),b.hitch(this,function(){this.loading&&this.loading.destroy();g.publish("mapCreatedFailed")}))},_publishSceneViewEvent:function(a){window._sceneView=a;console.timeEnd("Load Map");this.loading&&this.loading.destroy();this.sceneView?(this.sceneView=a,console.log("sceneView changed"),g.publish("sceneViewChanged",this.sceneView)):(this.sceneView=a,console.log("sceneView loaded"),g.publish("sceneViewLoaded",
this.sceneView))},_show2DWebMap:function(a){a.map.mapOptions||(a.map.mapOptions={});var c=this._processMapOptions(a.map.mapOptions)||{};c.isZoomSlider=!1;d.createWebMap(a.map.portalUrl,a.map.itemId,this.mapDivId,{mapOptions:c,bingMapsKey:a.bingMapsKey,usePopupManager:!0}).then(b.hitch(this,function(c){var d=c.map;d.hideZoomSlider();d.infoWindow.resize(270,316);d.itemId=a.map.itemId;d.itemInfo=c.itemInfo;d.webMapResponse=c;d.enableSnapping({snapKey:f.copyKey});k.setStyle(d.root,"zIndex",0);d._initialExtent=
d.extent;m.forEach("extent center marker find query scale level".split(" "),function(a){},this);this._publishMapEvent(d)}),b.hitch(this,function(){this.loading&&this.loading.destroy();g.publish("mapCreatedFailed")}))},_processMapOptions:function(a){if(a)return a.lods||delete a.lods,a.lods&&0===a.lods.length&&delete a.lods,a=b.clone(a),a.extent&&(a.extent=new l(a.extent)),a.center&&!b.isArrayLike(a.center)&&(a.center=new h(a.center)),a},onAppConfigChanged:function(a,c,d){this.appConfig=a;"mapChange"===
c?this._recreateMap(a):"mapOptionsChange"===c&&d.initialState&&(a=d.initialState.viewpoint)&&(this.sceneView.map.initialViewProperties.viewpoint=p.fromJSON(a),this.sceneView.animateTo(p.fromJSON(a)))},_recreateMap:function(a){this.sceneView&&(g.publish("beforeSceneViewDestory",this.sceneView),this._destroySceneView());this._showMap(a)},disableWebMapPopup:function(){},enableWebMapPopup:function(){}});u.getInstance=function(a,c){null===t&&(t=new u(a,c));return t};return u})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare",
"dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(n,b,m,k,g){return n([b,m],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:k,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&g.setStyle(this.domNode,"display","none");g.setStyle(this.domNode,{width:"100%",height:"100%"});
this.showLoading||g.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(e){this.domNode&&this.hidden&&("string"===typeof e&&(this.textNode.innerHTML=e),g.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(g.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),
function(n,b,m,k,g,e,f,l){var h=b("dijit._TemplatedMixin",l,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(d){var a=this.declaredClass,c=this;return f.substitute(d,this,function(d,e){"!"==e.charAt(0)&&(d=k.getObject(e.substr(1),!1,c));if("undefined"==typeof d)throw Error(a+" template:"+e);return null==d?"":"!"==e.charAt(0)?d:this._escapeValue(""+d)},this)},_escapeValue:function(d){return d.replace(/["'<>&]/g,function(a){return{"\x26":"\x26amp;",
"\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[a]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=n(this.templatePath,{sanitize:!0}));var d=h.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),a;if(k.isString(d)){if(a=m.toDom(this._stringRepl(d),this.ownerDocument),1!=a.nodeType)throw Error("Invalid template: "+d);}else a=d.cloneNode(!0);this.domNode=a}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);
this._rendered=!0},_fillContent:function(d){var a=this.containerNode;if(d&&a)for(;d.hasChildNodes();)a.appendChild(d.firstChild)}});h._templateCache={};h.getCachedTemplate=function(d,a,c){var e=h._templateCache,l=d,b=e[l];if(b){try{if(!b.ownerDocument||b.ownerDocument==(c||document))return b}catch(u){}m.destroy(b)}d=f.trim(d);if(a||d.match(/\$\{([^\}]+)\}/g))return e[l]=d;a=m.toDom(d,c);if(1!=a.nodeType)throw Error("Invalid template: "+d);return e[l]=a};e("ie")&&g(window,"unload",function(){var d=
h._templateCache,a;for(a in d){var c=d[a];"object"==typeof c&&m.destroy(c);delete d[a]}});return h})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(n){return n.cache})},"dojo/text":function(){define(["./_base/kernel","require","./has","./has!host-browser?./request"],function(n,b,m,k){var g;m("host-browser")?g=function(d,a,c){k(d,{sync:!!a,headers:{"X-Requested-With":null}}).then(c)}:b.getText?g=b.getText:console.error("dojo/text plugin failed to load because loader does not support getText");
var e={},f=function(d){if(d){d=d.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,"");var a=d.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);a&&(d=a[1])}else d="";return d},l={},h={};n.cache=function(d,a,c){var h;"string"==typeof d?/\//.test(d)?(h=d,c=a):h=b.toUrl(d.replace(/\./g,"/")+(a?"/"+a:"")):(h=d+"",c=a);d=void 0!=c&&"string"!=typeof c?c.value:c;c=c&&c.sanitize;if("string"==typeof d)return e[h]=d,c?f(d):d;if(null===d)return delete e[h],null;h in e||g(h,!0,function(a){e[h]=
a});return c?f(e[h]):e[h]};return{dynamic:!0,normalize:function(d,a){d=d.split("!");var c=d[0];return(/^\./.test(c)?a(c):c)+(d[1]?"!"+d[1]:"")},load:function(d,a,c){d=d.split("!");var b=1<d.length,p=d[0],k=a.toUrl(d[0]);d="url:"+k;var u=l,r=function(a){c(b?f(a):a)};p in e?u=e[p]:a.cache&&d in a.cache?u=a.cache[d]:k in e&&(u=e[k]);if(u===l)if(h[k])h[k].push(r);else{var x=h[k]=[r];g(k,!a.async,function(a){e[p]=e[k]=a;for(var c=0;c<x.length;)x[c++](a);delete h[k]})}else r(u)}}})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),
function(n,b,m,k,g,e,f,l,h){var d=g.delegate(l,{mouseenter:e.enter,mouseleave:e.leave,keypress:m._keypress}),a;m=k("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(a){for(var c=a;;)if(1==c.nodeType&&(this._processTemplateNode(c,function(a,c){return a.getAttribute(c)},this._attach)||
this.searchContainerNode)&&c.firstChild)c=c.firstChild;else{if(c==a)break;for(;!c.nextSibling;)if(c=c.parentNode,c==a)return;c=c.nextSibling}},_processTemplateNode:function(a,d,e){var c=!0,f=this.attachScope||this,h=d(a,"dojoAttachPoint")||d(a,"data-dojo-attach-point");if(h)for(var l=h.split(/\s*,\s*/);h=l.shift();)g.isArray(f[h])?f[h].push(a):f[h]=a,c="containerNode"!=h,this._attachPoints.push(h);if(d=d(a,"dojoAttachEvent")||d(a,"data-dojo-attach-event"))for(h=d.split(/\s*,\s*/),l=g.trim;d=h.shift();)if(d){var b=
null;-1!=d.indexOf(":")?(b=d.split(":"),d=l(b[0]),b=l(b[1])):d=l(d);b||(b=d);this._attachEvents.push(e(a,d,g.hitch(f,b)))}return c},_attach:function(c,e,h){e=e.replace(/^on/,"").toLowerCase();e="dijitclick"==e?a||(a=n("./a11yclick")):d[e]||e;return f(c,e,h)},_detachTemplateNodes:function(){var a=this.attachScope||this;b.forEach(this._attachPoints,function(c){delete a[c]});this._attachPoints=[];b.forEach(this._attachEvents,function(a){a.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();
this.inherited(arguments)}});g.extend(h,{dojoAttachEvent:"",dojoAttachPoint:""});return m})},"jimu/WebSceneLoader":function(){define("dojo/Deferred dojo/_base/lang dojo/_base/array dojo/_base/html dojo/promise/all esri/kernel esri/WebScene esri/views/SceneView esri/portal/Portal esri/portal/PortalItem esri/core/has ./utils ./portalUtils ./portalUrlUtils".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){return{createMap:function(c,d,e){var f=new n;a("esri-webgl")?f=this._createMap(c,d,e):(f.reject("The browser doesn't support webgl."),
(c=b.getObject("webSceneLoader.webglSupportTip",!1,window.jimuNls))||(c="3D web apps aren't supported in your browser."),k.create("div",{"class":"app-error",innerHTML:c},document.body));return f},_createMap:function(a,e,k){c.getEsriConfig().portalUrl=p.getStandardPortalUrl(e);var r=new n,t=[];h._default=null;var u=new f({portalItem:new d({id:k})}),m=new l({map:u,container:a,constraints:{collision:{enabled:!1},tilt:{max:179.99}}});t.push(m.when());e=q.getPortal(e);t.push(e.getItemById(k));t.push(e.getItemData(k));
g(t).then(b.hitch(this,function(c){m.popup&&(m.popup.closeOnViewChangeEnabled=!0);u.id=a;u.itemId=k;u.itemInfo={item:c[1],itemData:c[2]};this._handleLocalScene(m);r.resolve(m)}),b.hitch(this,function(a){console.error(a);r.reject(a)}));return r},_handleLocalScene:function(a){try{a.viewingMode&&"local"===a.viewingMode.toLowerCase()&&(b.setObject("constraints.collision.enabled",!1,a),b.setObject("constraints.tilt.max",179.99,a))}catch(u){console.error(u)}},_handleAttribution:function(a){try{if("4.0"!==
e.version){var c=a.ui&&a.ui._components;c&&0<c.length&&m.some(c,function(a){return(a=a&&a._widget)&&"esri.widgets.Attribution"===a.declaredClass?(a.domNode.parentNode.style.width="100%",k.create("span",{innerHTML:"Powered by Esri","class":"esri-attribution-powered-by"},a.domNode),!0):!1})}}catch(r){console.error(r)}}}})},"esri/WebScene":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/tsSupport/paramHelper ./core/tsSupport/assignHelper ./core/tsSupport/generatorHelper ./core/tsSupport/awaiterHelper ./kernel ./Map ./Viewpoint ./core/Collection ./core/Error ./core/Handles ./core/has ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/Promise ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./portal/Portal ./portal/PortalItem ./support/webSceneUtils ./views/3d/support/projectionUtils ./views/support/spatialReferenceSupport ./webdoc/support/thumbnailUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/TransportationNetwork ./webscene/Version".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L,O,K,N,Q,M,T,P,S,V,J,U){var Y=v.getLogger("esri.WebScene"),X=new U.default(1,19);return function(d){function b(a){a=d.call(this,a)||this;a._handles=new p;a.applicationProperties=null;a.clippingArea=null;a.clippingEnabled=!1;a.heightModelInfo=null;a.sourceVersion=null;a.supportsHeightModelInfo=!0;a.transportationNetworks=null;a.presentation=new V;a.initialViewProperties=new S;a.portalItem=null;a.resourceInfo=null;a.authoringApp=
null;a.authoringAppVersion=null;a._isAuthoringAppSetByUser=!1;a._isAuthoringAppVersionSetByUser=!1;return a}m(b,d);b.prototype.initialize=function(){var a=this;this.when().catch(function(a){Y.error("#load()","Failed to load web scene",a)});if(this.resourceInfo){var c=void 0;try{c=this._validateJSON(this.resourceInfo)}catch(ba){this.addResolvingPromise(y.reject(ba));return}this.read(c);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",
function(){return a._scheduleLayersIdGC()}))};b.prototype.destroy=function(){this._unscheduleLayersIdGC();this._handles.destroy()};b.prototype.writeClippingArea=function(a,c){c.clippingArea||(c.clippingArea={});c.clippingArea.geometry=a.toJSON()};b.prototype.readClippingEnabled=function(a,c){return c.clippingArea?!!c.clippingArea.clip:!1};b.prototype.writeClippingEnabled=function(a,c){this.clippingArea&&(c.clippingArea||(c.clippingArea={}),c.clippingArea.clip=a)};b.prototype.writeLayers=function(a,
c,d,f){var h=this,b=e({},f,{layerContainerType:"operational-layers"});a=a.map(function(a){return h.verifyWriteLayer(a,f)?a.write(null,b):null}).filter(function(a){return!!a});c[d]=a.toArray()};b.prototype.verifyWriteLayer=function(a,c){return"write"in a?!0:(c&&c.messages&&c.messages.push(new q("layer:unsupported","Layers ("+a.title+", "+a.id+") of type '"+a.declaredClass+"' cannot be persisted in web scenes",{layer:a})),!1)};b.prototype.readSourceVersion=function(a,c){a=c.version.split(".");c=a[1];
return new U.default(parseInt(a[0],10),parseInt(c,10))};b.prototype.writeSourceVersion=function(a,c,d){c[d]=X.major+"."+X.minor};Object.defineProperty(b.prototype,"thumbnailUrl",{get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(a){a?this._override("thumbnailUrl",a):this._clearOverride("thumbnailUrl")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"authoringApp",{set:function(a){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",a)},
enumerable:!0,configurable:!0});b.prototype.writeAuthoringApp=function(a,c){c.authoringApp=a&&this._isAuthoringAppSetByUser?a:"ArcGIS API for JavaScript"};Object.defineProperty(b.prototype,"authoringAppVersion",{set:function(a){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",a)},enumerable:!0,configurable:!0});b.prototype.writeAuthoringAppVersion=function(a,c){c.authoringAppVersion=a&&this._isAuthoringAppVersionSetByUser?a:h.version};b.prototype.writeGround=function(a,c,d,
e){c[d]=a?a.write(null,e):{transparency:0,layers:[]}};b.prototype.readInitialViewProperties=function(c,d){c={};d.initialState&&d.initialState.environment&&(c.environment=P.fromJSON(d.initialState.environment));c.spatialReference=d.spatialReference?H.fromJSON(d.spatialReference):H.WebMercator;c.viewingMode=d.viewingMode||"global";d.initialState&&d.initialState.viewpoint&&(c.viewpoint=a.fromJSON(d.initialState.viewpoint));return new S(c)};b.prototype.writeInitialViewProperties=function(a,c,d,e){a&&
(d={},a.environment&&(d.environment=a.environment.write({},e)),a.viewpoint&&(d.viewpoint=a.viewpoint.write({},e)),0!==Object.keys(d).length&&(c.initialState=d),c.spatialReference=a.spatialReference?a.spatialReference.write({},e):H.WebMercator.toJSON(),c.viewingMode=null!=a.viewingMode?a.viewingMode:"global")};b.prototype.load=function(a){this.addResolvingPromise(this._loadFromSource());return y.resolve(this)};b.prototype.loadAll=function(){var a=this;return w.default(this,function(c){var d=a.presentation&&
a.presentation.slides;c(a.ground,a.basemap,a.layers,d&&d.map(function(a){return a.basemap}))})};b.prototype.read=function(a,c){var d=this;c=e({},c,{origin:"web-scene"});var f=this._isAuthoringAppVersionSetByUser,h=this._isAuthoringAppSetByUser,b=arguments;F.readLoadable(this,a,function(c){return d.inherited(b,[a,c])},c);h||(this._isAuthoringAppSetByUser=!1);f||(this._isAuthoringAppVersionSetByUser=!1);if(a.baseMap&&Array.isArray(a.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){var f=
a.baseMap.elevationLayers.map(function(a){return{id:a.id}}),l=this.presentation.slides,p=function(a,c){return a.visibleLayers.some(function(a){return a.id===c})},q=f.filter(function(a){return!l.some(function(c){return p(c,a.id)})});l.forEach(function(a){a.visibleLayers.addMany(q)})}};b.prototype._writeBasemapElevationLayers=function(a){var c=a.ground&&a.ground.layers;!a.baseMap&&c&&c.length&&(a.baseMap={title:"Basemap",baseMapLayers:[]});a.baseMap&&(a.baseMap.elevationLayers=r.clone(c))};b.prototype.write=
function(a,c){if("loaded"!==this.loadStatus){var d=new q("webscene:not-loaded","Web scene must be loaded before it can be serialized");Y.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus);throw d;}this._runLayersIdGC();c=e({},c,{origin:"web-scene"});d=this.inherited(arguments,[a,c]);this._writeBasemapElevationLayers(d);return d};b.prototype.save=function(a){return l(this,void 0,void 0,function(){var c,d,e;return f(this,function(f){switch(f.label){case 0:if(this.portalItem)return[3,
2];Y.error("save(): requires the .portalItem property to be set");return[4,y.reject(new q("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))];case 1:f.sent(),f.label=2;case 2:return"Web Scene"===this.portalItem.type?[3,4]:[4,y.reject(new q("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'))];case 3:f.sent(),f.label=4;case 4:return c=this._updateFromPromise,[4,this.load()];case 5:return f.sent(),[4,this._loadObjectsWithLayers()];
case 6:return f.sent(),d=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&A.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||L.getDefault(),writtenProperties:[],blockedRelativeUrls:[]}),e=this.write(null,d),[4,this._verifySave(e,d,a)];case 7:return f.sent(),this._updateTypeKeywords(this.portalItem),[4,this.portalItem.update({data:e})];case 8:return f.sent(),C.updateOrigins(d),c?[4,c]:[3,10];case 9:f.sent(),f.label=10;case 10:return[4,
this._saveThumbnail()];case 11:return f.sent(),[2,this.portalItem]}})})};b.prototype.saveAs=function(a,c){return l(this,void 0,void 0,function(){var d,e,h,b,l,p;return f(this,function(f){switch(f.label){case 0:if(d=O.from(a))return[3,2];Y.error("saveAs(portalItem): requires a portal item parameter");return[4,y.reject(new q("webscene:portal-item-required","saveAs requires a portal item to save to"))];case 1:f.sent(),f.label=2;case 2:return d.id&&(d=d.clone(),d.id=null),e=d.portal||L.getDefault(),[4,
this.load()];case 3:return f.sent(),[4,this._loadObjectsWithLayers()];case 4:return f.sent(),h=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:e,writtenProperties:[],blockedRelativeUrls:[]}),b=this.write(null,h),[4,this._verifySaveAs(b,h,c)];case 5:return f.sent(),[4,e._signIn()];case 6:return f.sent(),l=this.thumbnailUrl,p=!this._isOverridden("thumbnailUrl"),d.type="Web Scene",d.portal=e,this._updateTypeKeywords(d),[4,e.user.addItem({item:d,folder:c&&c.folder,data:b})];
case 7:return f.sent(),this.portalItem=d,u.JSONSupport.prototype.read.call(this,{version:b.version,authoringApp:b.authoringApp,authoringAppVersion:b.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:d.itemUrl&&A.urlToObject(d.itemUrl)}),C.updateOrigins(h),l&&(this.thumbnailUrl=p?A.addQueryParameter(l,"w","8192"):l),[4,this._saveThumbnail()];case 8:return f.sent(),[2,d]}})})};b.prototype._saveThumbnail=function(){return l(this,void 0,void 0,function(){return f(this,function(a){switch(a.label){case 0:return this._isOverridden("thumbnailUrl")?
[4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl})]:[3,2];case 1:a.sent(),this._clearOverride("thumbnailUrl"),a.label=2;case 2:return[2]}})})};b.prototype._verifySave=function(a,c,d,e){void 0===e&&(e=!1);var f=c.messages.filter(function(a){return"error"===a.type}).map(function(a){return new q(a.name,a.message,a.details)});c.blockedRelativeUrls&&(f=f.concat(c.blockedRelativeUrls.map(function(a){return new q("url:unsupported","Relative url '"+a+"' is not supported in Web Scene")})));
d&&d.ignoreUnsupported&&(f=f.filter(function(a){return"layer:unsupported"!==a.name&&"symbol:unsupported"!==a.name&&"symbol-layer:unsupported"!==a.name&&"property:unsupported"!==a.name&&"url:unsupported"!==a.name}));d&&d.strictSchemaValidationEnabled||(f=f.filter(function(a){return"web-document-write:property-required"!==a.name}));var h=d&&d.strictSchemaValidationEnabled;return(h?y.create(function(a){return n(["./webscene/validator"],a)}).then(function(c){c=c.validate(a);if(0<c.length){var d="webscene did not validate:\n"+
c.join("\n");Y.error((e?"saveAs":"save")+"(): "+d)}return c.map(function(a){return new q("webscene:schema-validation",a)})}).then(function(a){if(h&&0<a.length)throw K.createSchemaValidationError(a.concat(f));return f}):y.resolve(f)).then(function(a){if(0<a.length)return y.reject(new q("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a}))})};b.prototype._verifySaveAs=function(a,c,d){return this.canSaveAs(c)?
y.reject(K.createCopyError()):this._verifySave(a,c,d,!0)};b.prototype.verifySaveAs=function(a){var c=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),d=this.write(null,c);return this._verifySaveAs(d,c,a)};b.prototype.canSaveAs=function(a){a||(a=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,a));return a.verifyItemRelativeUrls&&0<a.verifyItemRelativeUrls.writtenUrls.length};b.prototype.updateFrom=function(a,c){void 0===c&&(c={});return l(this,
void 0,void 0,function(){var d,e;return f(this,function(f){switch(f.label){case 0:return this._updateFromPromise=d=this._updateFromInternal(a,c),[4,d];case 1:f.sent();if(e=this._updateFromPromise===d)this._updateFromPromise=null;return[2]}})})};b.prototype._updateFromInternal=function(a,c){void 0===c&&(c={});return l(this,void 0,void 0,function(){return f(this,function(d){switch(d.label){case 0:return[4,a.whenReady()];case 1:return d.sent(),!c.environmentExcluded&&a.environment&&(this.initialViewProperties.environment=
P.prototype.clone.apply(a.environment)),!c.viewpointExcluded&&a.viewpoint&&(this.initialViewProperties.viewpoint=a.viewpoint.clone()),this.initialViewProperties.spatialReference=a.spatialReference.clone(),this.initialViewProperties.viewingMode=a.viewingMode,a.clippingArea?a.clippingArea!==this.clippingArea&&(this.clippingArea=a.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,a.heightModelInfo&&(this.heightModelInfo=a.heightModelInfo.clone()),a.map===this&&a.allLayerViews.forEach(function(a){a.layer.visible=
a.visible}),!1===c.thumbnailExcluded||null==c.thumbnailExcluded&&!c.viewpointExcluded?[4,this._updateFromThumbnail(a,c.thumbnailSize||void 0)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[2]}})})};b.prototype._updateFromThumbnail=function(a,c){return l(this,void 0,void 0,function(){var d,e;return f(this,function(f){switch(f.label){case 0:return d=M.getOptimalThumbnailSize(a,c),[4,a.takeScreenshot({format:"jpg",width:d.width,height:d.height,disableSlice:!0})];case 1:return e=f.sent(),this.thumbnailUrl=
e.dataUrl,[2]}})})};b.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};b.prototype._readAndLoadFromJSON=function(a,c){a=this._validateJSON(a);this.read(a,c);return this._loadFromJSON(a,c)};b.prototype._extractOperationalLayers=function(a){var c=this,d=[];if(!this.sourceVersion.supportsGround&&a.baseMap&&Array.isArray(a.baseMap.elevationLayers))for(var e=
0,f=a.baseMap.elevationLayers;e<f.length;e++)d.push(f[e]);var h=[],b=function(a){a.layers&&(a.layers=a.layers.filter(b));return"ArcGISTiledElevationServiceLayer"===a.layerType?(c.sourceVersion.supportsGround||h.push(a),!1):!0};return{operationalLayers:a.operationalLayers?a.operationalLayers.filter(b):[],operationalElevationLayers:h,basemapElevationLayers:d}};b.prototype._loadFromJSON=function(a,d){var f=this,h=new c;return this._validateSpatialReference().then(function(){return f._validateHeightModelInfo()}).then(function(){return y.create(function(a){return n(["./portal/support/layersCreator"],
a)})}).then(function(c){var b=f._extractOperationalLayers(a),l=b.operationalLayers,p=b.operationalElevationLayers,b=b.basemapElevationLayers,q=[],g={context:e({},d,{layerContainerType:"operational-layers"})};f.portalItem&&(g.context.portal=f.portalItem.portal||L.getDefault());if(0<b.length){var k=e({},g,{context:e({},g.context,{layerContainerType:"ground"})});k.defaultLayerType="ArcGISTiledElevationServiceLayer";q.push(c.populateOperationalLayers(f.ground.layers,b,k))}0<p.length&&(k=e({},g,{context:e({},
g.context,{layerContainerType:"ground"})}),k.defaultLayerType="ArcGISTiledElevationServiceLayer",q.push(c.populateOperationalLayers(h,p,k)));l&&0<l.length&&q.push(c.populateOperationalLayers(f.layers,l,g));return y.eachAlways(q).then(function(){})}).then(function(){return f._loadObjectsWithLayers()}).then(function(){f.ground.layers.addMany(h)})};b.prototype._loadObjectsWithLayers=function(){var a=[];this.ground&&a.push(this.ground.load());this.basemap&&a.push(this.basemap.load());this.presentation.slides.forEach(function(c){c.basemap&&
a.push(c.basemap.load())});return y.eachAlways(a).then(function(){})};b.prototype._loadFromItem=function(a){var c=this;return a.load().catch(function(a){throw new q("webscene:load-portal-item","Failed to load portal item",{error:a});}).then(function(){if("Web Scene"!==a.type)throw new q("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:a.type});}).then(function(){return a.fetchData()}).then(function(d){c.resourceInfo=d;return c._readAndLoadFromJSON(d,
{origin:"web-scene",url:A.urlToObject(a.itemUrl),portal:a.portal||L.getDefault()})})};b.prototype._validateSpatialReference=function(){var a=this.initialViewProperties,c=this._sceneSpatialReference,d;if("local"!==a.viewingMode){if(!Q.isSpatialReferenceSupported(c,"global"))return y.reject(new q("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:c,viewingMode:a.viewingMode}));
d=function(a){return!a||N.canProject(a,c)}}else{if(!Q.isSpatialReferenceSupported(c,"local"))return y.reject(new q("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:c,viewingMode:a.viewingMode}));d=function(a){return!a||a.equals(c)}}var e=function(a){return a&&(a.camera&&a.camera.position&&a.camera.position.spatialReference||a.targetGeometry&&a.targetGeometry.spatialReference)},
f=e(a.viewpoint);return f&&!d(f)?y.reject(new q("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:f,sceneSpatialReference:c,viewingMode:a.viewingMode})):(f=this.presentation.slides.find(function(a){return!d(e(a.viewpoint))}))?(f=e(f.viewpoint),y.reject(new q("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",
{slideSpatialReference:f,sceneSpatialReference:c,viewingMode:a.viewingMode}))):y.resolve()};b.prototype._validateHeightModelInfo=function(){var a=D.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return a?y.reject(a):y.resolve()};b.prototype._validateJSON=function(a){var c=U.default.parse(a.version||"","webscene");X.validate(c);a.version=c.major+"."+c.minor;1===c.major&&2>=c.minor&&(a.spatialReference=H.WebMercator.toJSON());return a};b.prototype._updateTypeKeywords=function(a){"local"===
this.initialViewProperties.viewingMode?a.typeKeywords?-1===a.typeKeywords.indexOf("ViewingMode-Local")&&a.typeKeywords.push("ViewingMode-Local"):a.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a){return"ViewingMode-Local"!==a}));a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,c,d){return d.indexOf(a)===c}))};Object.defineProperty(b.prototype,"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||
H.WebMercator},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"_verifyItemRelativeRootPath",{get:function(){return this.portalItem&&this.portalItem.itemUrl?A.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!0,configurable:!0});b.prototype._enableVerifyItemRelativeUrls=function(a){var c=this._verifyItemRelativeRootPath;c&&(a.verifyItemRelativeUrls={rootPath:c,writtenUrls:[]});return a};b.prototype._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),
this._layersIdGCTimeoutId=0)};b.prototype._scheduleLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(function(){a._layersIdGCTimeoutId=0;a._runLayersIdGC()},3E3)};b.prototype._runLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();var c=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,d=function(c){return!!a.allLayers.find(function(a){return a.id===c})};c&&c.layers&&(c.layers=c.layers.filter(function(a){return d(a.id)}));
(c=this.presentation&&this.presentation.slides)&&c.forEach(function(a){a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(function(a){return d(a.id)}))})};b.fromJSON=function(a){if(!a)throw new q("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:a})};b.VERSION=X;k([B.property({type:T,json:{write:!0}})],b.prototype,"applicationProperties",void 0);k([B.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],b.prototype,"basemap",void 0);
k([B.property({type:E,json:{read:{source:"clippingArea.geometry",reader:I.fromJSON},write:{target:"clippingArea.geometry"}}})],b.prototype,"clippingArea",void 0);k([B.writer("clippingArea")],b.prototype,"writeClippingArea",null);k([B.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],b.prototype,"clippingEnabled",void 0);k([B.reader("clippingEnabled",["clippingArea"])],b.prototype,"readClippingEnabled",null);k([B.writer("clippingEnabled")],b.prototype,"writeClippingEnabled",null);
k([B.property({type:G,json:{write:!0}})],b.prototype,"heightModelInfo",void 0);k([B.property({json:{write:{target:"operationalLayers"}}})],b.prototype,"layers",void 0);k([B.writer("layers")],b.prototype,"writeLayers",null);k([B.property({readOnly:!0,type:U.default,json:{type:String,write:{allowNull:!0,target:"version",isRequired:!0}}})],b.prototype,"sourceVersion",void 0);k([B.reader("sourceVersion",["version"])],b.prototype,"readSourceVersion",null);k([B.writer("sourceVersion")],b.prototype,"writeSourceVersion",
null);k([B.property({dependsOn:["portalItem.thumbnailUrl"]})],b.prototype,"thumbnailUrl",null);k([B.property({type:String,json:{write:{allowNull:!0}}})],b.prototype,"authoringApp",null);k([B.writer("authoringApp")],b.prototype,"writeAuthoringApp",null);k([B.property({type:String,json:{write:{allowNull:!0}}})],b.prototype,"authoringAppVersion",null);k([B.writer("authoringAppVersion")],b.prototype,"writeAuthoringAppVersion",null);k([B.property({json:{write:{isRequired:!0,allowNull:!0,enabled:!0}}})],
b.prototype,"ground",void 0);k([B.writer("ground")],b.prototype,"writeGround",null);k([B.property({type:c.ofType(J),json:{write:!0}})],b.prototype,"transportationNetworks",void 0);k([B.property({type:V,nonNullable:!0,json:{write:function(a,c,d,f){a.slides&&0<a.slides.length&&(d=e({},f,{isPresentation:!0}),c.presentation=a.write(null,d))}}})],b.prototype,"presentation",void 0);k([B.property({type:S,nonNullable:!0,json:{default:function(){return new S({viewingMode:"global",spatialReference:H.WebMercator})}}})],
b.prototype,"initialViewProperties",void 0);k([B.reader("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],b.prototype,"readInitialViewProperties",null);k([B.writer("initialViewProperties",{"initialState.environment":{type:P},spatialReference:{type:H},viewingMode:{type:String},"initialState.viewpoint":{type:a}})],b.prototype,"writeInitialViewProperties",null);k([B.property({type:O})],b.prototype,"portalItem",void 0);k([B.property()],b.prototype,
"resourceInfo",void 0);return b=k([B.subclass("esri.WebScene")],b)}(B.declared(x.LoadableMixin(z.EsriPromiseMixin(u.JSONSupportMixin(d)))))})},"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../MultiOriginJSONSupport"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.updateOrigins=function(b){b&&b.writtenProperties&&b.writtenProperties.forEach(function(b){var e=b.target;b.newOrigin&&b.oldOrigin!==b.newOrigin&&m.isMultiOriginJSONMixin(e)&&e.updateOrigin(b.propName,
b.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require","exports","../core/Error"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.createCopyError=function(){return new m("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};b.isCopyError=function(b){return b&&"webscene:failed-to-copy-embedded-resources"===b.name};b.createSchemaValidationError=function(b){return new m("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",
{errors:b})};b.isSchemaValidationError=function(b){return b&&"webscene:schema-validation"===b.name}})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ../webgl-engine/lib/BufferVectorMath".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){function t(a,c,d,e){2===a.length?(R[0]=a[0],R[1]=a[1],R[2]=0,a=R):a===d&&(f.vec3.copy(R,a),a=R);return u(a,c,0,d,e,0,1)}function u(a,c,d,e,f,h,b){void 0===b&&(b=1);c=E(c,f,V);if(k.isNone(c))return!1;if(c===x){if(a===e&&d===h)return!0;for(c=d+3*b;d<c;d++,h++)e[h]=a[d];return!0}for(b=d+3*b;d<b;d+=3,h+=3)c(a,d,e,h);return!0}function r(a,c){if(c.spatialReference===a)return c.spatialReferenceId;c.spatialReference=a;"metersPerUnit"in c&&(c.metersPerUnit=g.getMetersPerUnitForSR(a,
1));return a.wkt===b.SphericalECEFSpatialReference.wkt?c.spatialReferenceId=1:a.isWGS84?c.spatialReferenceId=2:a.isWebMercator?c.spatialReferenceId=3:a.wkt===b.WGS84ECEFSpatialReference.wkt?c.spatialReferenceId=4:4490===a.wkid?c.spatialReferenceId=5:c.spatialReferenceId=0}function x(a,c,d,e){d[e++]=a[c++];d[e++]=a[c++];d[e]=a[c]}function w(a,c,d,e){d[e++]=Y*(a[c++]/q.earthRadius);d[e++]=Y*(Math.PI/2-2*Math.atan(Math.exp(-1*a[c++]/q.earthRadius)));d[e]=a[c]}function v(a,c,d,e){var f=.4999999*Math.PI,
f=m.clamp(U*a[c+1],-f,f),f=Math.sin(f);d[e++]=U*a[c]*q.earthRadius;d[e++]=q.halfEarthRadius*Math.log((1+f)/(1-f));d[e]=a[c+2]}function z(a,c,d){c=r(c,P);c=T[c][6];if(k.isNone(c))return!1;c(a,0,R,0);d!==R&&(d[0]=R[0],d[1]=R[1],2<d.length&&(d[2]=R[2]));return!0}function y(a,c){R[0]=a.x;R[1]=a.y;R[2]=a.hasZ?a.z:0;return z(R,a.spatialReference,c)}function A(a,c,d,e){var f=q.earthRadius+a[c+2],h=U*a[c+1];a=U*a[c];c=Math.cos(h);d[e++]=Math.cos(a)*c*f;d[e++]=Math.sin(a)*c*f;d[e]=Math.sin(h)*f}function B(a,
c,d,e){var f=p.Vec3Compact.length(a,c),h=m.asinClamped(a[c+2]/(0===f?1:f));a=Math.atan2(a[c+1],a[c]);d[e++]=Y*a;d[e++]=Y*h;d[e]=f-q.earthRadius}function C(a,c,d,e){var f=X,h=U*a[c],b=U*a[c+1];a=a[c+2];c=Math.sin(b);var b=Math.cos(b),l=f.a/Math.sqrt(1-f.e2*c*c);d[e++]=(l+a)*b*Math.cos(h);d[e++]=(l+a)*b*Math.sin(h);d[e++]=(l*(1-f.e2)+a)*c}function F(a,c,d,e){var f=X,h=a[c],b=a[c+1];a=a[c+2];var l,p,q,g,k,r;c=Math.abs(a);l=h*h+b*b;p=Math.sqrt(l);q=l+a*a;g=Math.sqrt(q);h=Math.atan2(b,h);k=a*a/q;q=l/q;
b=f.a2/g;l=f.a3-f.a4/g;.3<q?(k=c/g*(1+q*(f.a1+b+k*l)/g),g=Math.asin(k),b=k*k,q=Math.sqrt(1-b)):(q=p/g*(1-k*(f.a5-b-q*l)/g),g=Math.acos(q),b=1-q*q,k=Math.sqrt(b));r=1-f.e2*b;b=f.a/Math.sqrt(r);f=f.a6*b;b=p-b*q;l=c-f*k;c=q*b+k*l;p=q*l-k*b;f=p/(f/r+c);g+=f;0>a&&(g=-g);d[e++]=Y*h;d[e++]=Y*g;d[e]=c+p*f/2}function E(a,c,d){void 0===d&&(d=H());return G(a,c,d).projector}function G(a,c,d){if(d.source.spatialReference===a&&d.dest.spatialReference===c)return d;var e=r(a,d.source),f=r(c,d.dest);0===e&&0===f?
a.equals(c)?d.projector=x:d.projector=null:d.projector=T[e][f];return d}function H(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:x}}Object.defineProperty(b,"__esModule",{value:!0});var D,I,L,O,K,N,Q,M;b.SphericalECEFSpatialReference=new d({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});
b.WGS84ECEFSpatialReference=new d({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});b.canProject=function(a,c){return!!E(a,c,V)};b.vectorToVector=t;b.pointToPoint=
function(a,c,d,e){void 0===d&&(d=c.spatialReference);void 0===e&&(e=0);R[0]=a.x;R[1]=a.y;var f=a.z;R[2]=void 0!==f?f:e;if(!u(R,a.spatialReference,0,R,d,0,1))return!1;c.x=R[0];c.y=R[1];c.spatialReference=d;void 0!==f?(c.z=R[2],c.hasZ=!0):(c.z=void 0,c.hasZ=!1);return!0};b.pointToVector=function(a,c,d,e){void 0===e&&(e=0);R[0]=a.x;R[1]=a.y;var f=a.z;R[2]=void 0!==f?f:e;return u(R,a.spatialReference,0,c,d,0,1)};b.vectorToPoint=function(a,d,e,f){e instanceof h?f=f||e.spatialReference:c.isPoint(e)?(e.hasZ=
!0,f=f||e.spatialReference):(f=e,e=new h({spatialReference:f}));return u(a,d,0,R,f,0,1)?(e.x=R[0],e.y=R[1],e.z=R[2],e.spatialReference=f,e):null};b.xyzToVector=function(a,c,d,e,f,h){R[0]=a;R[1]=c;R[2]=d;return u(R,e,0,f,h,0,1)};b.bufferToBuffer=u;b.localLinearScaleFactors=function(a,c,d,e){var h=r(c,P),b=r(e,S);if(h===b&&0!==h||c.equals(e))return d[0]=1,d[1]=1,d[2]=1,!0;if(1===h){c=f.vec3.length(a);a=c/Math.sqrt(a[0]*a[0]+a[1]*a[1]);c/=q.earthRadius;if(3===b)return d[0]=a*c,d[1]=a*c,d[2]=1,!0;if(2===
b||5===b)return b=180/(q.earthRadius*Math.PI),d[0]=b*a*c,d[1]=b*c,d[2]=1,!0}return!1};b.computeLinearTransformation=function(a,c,d,f){var h=r(a,P),b=r(f,S);if(h===b&&1!==b&&(0!==h||a.equals(f)))return e.mat4.identity(d),e.mat4.translate(d,d,c),!0;if(1===b){a=T[h][6];b=T[6][b];if(k.isNone(a)||k.isNone(b))return!1;a(c,0,aa,0);b(aa,0,da,0);a=U*aa[0];b=U*aa[1];c=Math.sin(a);a=Math.cos(a);f=Math.sin(b);b=Math.cos(b);d[0]=-c;d[4]=-f*a;d[8]=b*a;d[12]=da[0];d[1]=a;d[5]=-f*c;d[9]=b*c;d[13]=da[1];d[2]=0;d[6]=
b;d[10]=f;d[14]=da[2];d[3]=0;d[7]=0;d[11]=0;d[15]=1;return!0}if(3===b&&(2===h||1===h)){a=T[h][6];if(k.isNone(a))return!1;a(c,0,aa,0);c=U*aa[1];v(aa,0,da,0);e.mat4.identity(d);e.mat4.translate(d,d,da);c=1/Math.cos(c);e.mat4.scale(d,d,[c,c,1]);return!0}return!1};b.transformDirection=function(a,c,d,e,h){f.vec3.copy(ca,a);f.vec3.add(ba,a,c);t(ca,d,ca,h);t(ba,d,ba,h);f.vec3.subtract(e,ba,ca);f.vec3.normalize(e,e)};b.mbsToMbs=function(a,c,d,e){c=G(c,e,J);if(c.projector===x)return d[0]=a[0],d[1]=a[1],d[2]=
a[2],d[3]=a[3],!0;if(k.isNone(c.projector))return!1;e=c.source;var f=c.dest;if(3===f.spatialReferenceId){c=T[e.spatialReferenceId][2];if(k.isNone(c))return!1;c(a,0,aa,0);c=Math.abs(U*aa[1])+Math.asin(a[3]/(q.earthRadius+a[2]));v(aa,0,d,0);d[3]=c>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(c)*a[3];return!0}c.projector(a,0,d,0);d[3]=a[3]*e.metersPerUnit/f.metersPerUnit;return!0};b.extentToBoundingBox=function(a,c,d){if(null==a)return!1;var e;R[0]=null!=a.xmin?a.xmin:0;R[1]=null!=a.ymin?a.ymin:0;R[2]=
null!=a.zmin?a.zmin:0;e=u(R,a.spatialReference,0,c,d,0,1);R[0]=null!=a.xmax?a.xmax:0;R[1]=null!=a.ymax?a.ymax:0;R[2]=null!=a.zmax?a.zmax:0;e=e&&u(R,a.spatialReference,0,c,d,3,1);null==a.xmin&&(c[0]=-Infinity);null==a.ymin&&(c[1]=-Infinity);null==a.zmin&&(c[2]=-Infinity);null==a.xmax&&(c[3]=Infinity);null==a.ymax&&(c[4]=Infinity);null==a.zmax&&(c[5]=Infinity);return e};b.extentToBoundingRect=function(a,c,d){if(null==a)return!1;var e;R[0]=null!=a.xmin?a.xmin:0;R[1]=null!=a.ymin?a.ymin:0;R[2]=null!=
a.zmin?a.zmin:0;e=u(R,a.spatialReference,0,R,d,0,1);c[0]=R[0];c[1]=R[1];R[0]=null!=a.xmax?a.xmax:0;R[1]=null!=a.ymax?a.ymax:0;R[2]=null!=a.zmax?a.zmax:0;e=e&&u(R,a.spatialReference,0,R,d,0,1);c[2]=R[0];c[3]=R[1];null==a.xmin&&(c[0]=-Infinity);null==a.ymin&&(c[1]=-Infinity);null==a.xmax&&(c[2]=Infinity);null==a.ymax&&(c[3]=Infinity);return e};b.boundingRectToBoundingRect=function(c,d,e,f){if(null==c)return!1;if(d.equals(f))return a.set(e,c),!0;R[0]=c[0];R[1]=c[1];R[2]=0;if(!u(R,d,0,R,f,0,1))return!1;
e[0]=R[0];e[1]=R[1];R[0]=c[2];R[1]=c[3];R[2]=0;if(!u(R,d,0,R,f,0,1))return!1;e[2]=R[0];e[3]=R[1];return!0};(function(a){a.x2lon=function(a){return a/q.earthRadius};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/q.earthRadius))};a.lon2x=function(a){return a*q.earthRadius};a.lat2y=function(a){a=Math.sin(a);return q.earthRadius/2*Math.log((1+a)/(1-a))}})(b.webMercator||(b.webMercator={}));b.canProjectToWGS84ComparableLonLat=function(a){a=r(a,P);return!!T[a][6]};b.vectorToWGS84ComparableLonLat=
z;b.pointToWGS84ComparableLonLat=y;b.pointToWGS84ComparableLonLatPoint=function(a,c){var d=r(c.spatialReference,S);return k.isNone(T[6][d])?!1:y(a,R)?(c.x=R[0],c.y=R[1],c.z=R[2],!0):!1};b.wgs84ComparableLonLatToECEF=function(a,c,d,e){void 0===e&&(e=0);e=q.earthRadius+e;var f=Math.cos(d);a[0]=Math.cos(c)*f*e;a[1]=Math.sin(c)*f*e;a[2]=Math.sin(d)*e};var T=(D={},D[2]=(I={},I[5]=null,I[6]=x,I[1]=A,I[0]=null,I[3]=v,I[2]=x,I[4]=C,I),D[5]=(L={},L[5]=x,L[6]=x,L[1]=A,L[0]=null,L[3]=null,L[2]=null,L[4]=C,L),
D[3]=(O={},O[5]=null,O[6]=w,O[1]=function(a,c,d,e){w(a,c,d,e);A(d,e,d,e)},O[0]=null,O[3]=x,O[2]=w,O[4]=function(a,c,d,e){w(a,c,d,e);C(d,e,d,e)},O),D[4]=(K={},K[5]=F,K[6]=F,K[1]=function(a,c,d,e){F(a,c,d,e);A(d,e,d,e)},K[0]=null,K[3]=function(a,c,d,e){F(a,c,d,e);v(d,e,d,e)},K[2]=F,K[4]=x,K),D[1]=(N={},N[5]=B,N[6]=B,N[1]=x,N[0]=null,N[3]=function(a,c,d,e){B(a,c,d,e);v(d,e,d,e)},N[2]=B,N[4]=function(a,c,d,e){B(a,c,d,e);C(d,e,d,e)},N),D[0]=(Q={},Q[5]=null,Q[6]=null,Q[1]=null,Q[0]=x,Q[3]=null,Q[2]=null,
Q[4]=null,Q),D[6]=(M={},M[5]=null,M[6]=x,M[1]=A,M[0]=null,M[3]=null,M[2]=x,M[4]=C,M),D);b.getProjector=E;var P={spatialReference:null,spatialReferenceId:0},S={spatialReference:null,spatialReferenceId:0},V=H(),J=H(),U=m.deg2rad(1),Y=m.rad2deg(1),X={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},R=l.vec3f64.create(),aa=l.vec3f64.create(),da=l.vec3f64.create(),ca=l.vec3f64.create(),
ba=l.vec3f64.create()})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require","exports","./math/mat4"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.mat4=m})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require","exports","../factories/vec3f64","./common"],function(n,b,m,k){function g(d){d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d}function e(d,a,c){var e=a[0],f=a[1],h=a[2],
b=a[3],l=a[4],g=a[5],k=a[6],m=a[7],z=a[8],y=a[9],A=a[10],B=a[11],C=a[12],n=a[13],E=a[14];a=a[15];var G=c[0],H=c[1],D=c[2],I=c[3];d[0]=G*e+H*l+D*z+I*C;d[1]=G*f+H*g+D*y+I*n;d[2]=G*h+H*k+D*A+I*E;d[3]=G*b+H*m+D*B+I*a;G=c[4];H=c[5];D=c[6];I=c[7];d[4]=G*e+H*l+D*z+I*C;d[5]=G*f+H*g+D*y+I*n;d[6]=G*h+H*k+D*A+I*E;d[7]=G*b+H*m+D*B+I*a;G=c[8];H=c[9];D=c[10];I=c[11];d[8]=G*e+H*l+D*z+I*C;d[9]=G*f+H*g+D*y+I*n;d[10]=G*h+H*k+D*A+I*E;d[11]=G*b+H*m+D*B+I*a;G=c[12];H=c[13];D=c[14];I=c[15];d[12]=G*e+H*l+D*z+I*C;d[13]=
G*f+H*g+D*y+I*n;d[14]=G*h+H*k+D*A+I*E;d[15]=G*b+H*m+D*B+I*a;return d}function f(d,a,c){var e=a[0],f=a[1],h=a[2],b=a[3],l=e+e,g=f+f,k=h+h;a=e*l;var m=e*g,e=e*k,z=f*g,f=f*k,h=h*k,l=b*l,g=b*g,b=b*k;d[0]=1-(z+h);d[1]=m+b;d[2]=e-g;d[3]=0;d[4]=m-b;d[5]=1-(a+h);d[6]=f+l;d[7]=0;d[8]=e+g;d[9]=f-l;d[10]=1-(a+z);d[11]=0;d[12]=c[0];d[13]=c[1];d[14]=c[2];d[15]=1;return d}function l(d,a,c){d[0]=a[0]-c[0];d[1]=a[1]-c[1];d[2]=a[2]-c[2];d[3]=a[3]-c[3];d[4]=a[4]-c[4];d[5]=a[5]-c[5];d[6]=a[6]-c[6];d[7]=a[7]-c[7];d[8]=
a[8]-c[8];d[9]=a[9]-c[9];d[10]=a[10]-c[10];d[11]=a[11]-c[11];d[12]=a[12]-c[12];d[13]=a[13]-c[13];d[14]=a[14]-c[14];d[15]=a[15]-c[15];return d}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(d,a){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];d[9]=a[9];d[10]=a[10];d[11]=a[11];d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};b.set=function(d,a,c,e,f,h,b,l,g,k,m,z,y,A,B,C,n){d[0]=a;d[1]=c;d[2]=e;d[3]=f;d[4]=h;d[5]=b;d[6]=l;d[7]=g;d[8]=
k;d[9]=m;d[10]=z;d[11]=y;d[12]=A;d[13]=B;d[14]=C;d[15]=n;return d};b.identity=g;b.transpose=function(d,a){if(d===a){var c=a[1],e=a[2],f=a[3],h=a[6],b=a[7],l=a[11];d[1]=a[4];d[2]=a[8];d[3]=a[12];d[4]=c;d[6]=a[9];d[7]=a[13];d[8]=e;d[9]=h;d[11]=a[14];d[12]=f;d[13]=b;d[14]=l}else d[0]=a[0],d[1]=a[4],d[2]=a[8],d[3]=a[12],d[4]=a[1],d[5]=a[5],d[6]=a[9],d[7]=a[13],d[8]=a[2],d[9]=a[6],d[10]=a[10],d[11]=a[14],d[12]=a[3],d[13]=a[7],d[14]=a[11],d[15]=a[15];return d};b.invert=function(d,a){var c=a[0],e=a[1],f=
a[2],h=a[3],b=a[4],l=a[5],g=a[6],k=a[7],m=a[8],z=a[9],y=a[10],A=a[11],B=a[12],C=a[13],n=a[14];a=a[15];var E=c*l-e*b,G=c*g-f*b,H=c*k-h*b,D=e*g-f*l,I=e*k-h*l,L=f*k-h*g,O=m*C-z*B,K=m*n-y*B,N=m*a-A*B,Q=z*n-y*C,M=z*a-A*C,T=y*a-A*n,P=E*T-G*M+H*Q+D*N-I*K+L*O;if(!P)return null;P=1/P;d[0]=(l*T-g*M+k*Q)*P;d[1]=(f*M-e*T-h*Q)*P;d[2]=(C*L-n*I+a*D)*P;d[3]=(y*I-z*L-A*D)*P;d[4]=(g*N-b*T-k*K)*P;d[5]=(c*T-f*N+h*K)*P;d[6]=(n*H-B*L-a*G)*P;d[7]=(m*L-y*H+A*G)*P;d[8]=(b*M-l*N+k*O)*P;d[9]=(e*N-c*M-h*O)*P;d[10]=(B*I-C*H+
a*E)*P;d[11]=(z*H-m*I-A*E)*P;d[12]=(l*K-b*Q-g*O)*P;d[13]=(c*Q-e*K+f*O)*P;d[14]=(C*G-B*D-n*E)*P;d[15]=(m*D-z*G+y*E)*P;return d};b.adjoint=function(d,a){var c=a[0],e=a[1],f=a[2],h=a[3],b=a[4],l=a[5],g=a[6],k=a[7],m=a[8],z=a[9],y=a[10],A=a[11],B=a[12],C=a[13],n=a[14];a=a[15];d[0]=l*(y*a-A*n)-z*(g*a-k*n)+C*(g*A-k*y);d[1]=-(e*(y*a-A*n)-z*(f*a-h*n)+C*(f*A-h*y));d[2]=e*(g*a-k*n)-l*(f*a-h*n)+C*(f*k-h*g);d[3]=-(e*(g*A-k*y)-l*(f*A-h*y)+z*(f*k-h*g));d[4]=-(b*(y*a-A*n)-m*(g*a-k*n)+B*(g*A-k*y));d[5]=c*(y*a-A*
n)-m*(f*a-h*n)+B*(f*A-h*y);d[6]=-(c*(g*a-k*n)-b*(f*a-h*n)+B*(f*k-h*g));d[7]=c*(g*A-k*y)-b*(f*A-h*y)+m*(f*k-h*g);d[8]=b*(z*a-A*C)-m*(l*a-k*C)+B*(l*A-k*z);d[9]=-(c*(z*a-A*C)-m*(e*a-h*C)+B*(e*A-h*z));d[10]=c*(l*a-k*C)-b*(e*a-h*C)+B*(e*k-h*l);d[11]=-(c*(l*A-k*z)-b*(e*A-h*z)+m*(e*k-h*l));d[12]=-(b*(z*n-y*C)-m*(l*n-g*C)+B*(l*y-g*z));d[13]=c*(z*n-y*C)-m*(e*n-f*C)+B*(e*y-f*z);d[14]=-(c*(l*n-g*C)-b*(e*n-f*C)+B*(e*g-f*l));d[15]=c*(l*y-g*z)-b*(e*y-f*z)+m*(e*g-f*l);return d};b.determinant=function(d){var a=d[0],
c=d[1],e=d[2],f=d[3],h=d[4],b=d[5],l=d[6],g=d[7],k=d[8],m=d[9],z=d[10],y=d[11],A=d[12],B=d[13],C=d[14];d=d[15];return(a*b-c*h)*(z*d-y*C)-(a*l-e*h)*(m*d-y*B)+(a*g-f*h)*(m*C-z*B)+(c*l-e*b)*(k*d-y*A)-(c*g-f*b)*(k*C-z*A)+(e*g-f*l)*(k*B-m*A)};b.multiply=e;b.translate=function(d,a,c){var e=c[0],f=c[1];c=c[2];var h=void 0,b=void 0,l=void 0,g=void 0,k=void 0,m=void 0,z=void 0,y=void 0,A=void 0,B=void 0,C=void 0,n=void 0;a===d?(d[12]=a[0]*e+a[4]*f+a[8]*c+a[12],d[13]=a[1]*e+a[5]*f+a[9]*c+a[13],d[14]=a[2]*e+
a[6]*f+a[10]*c+a[14],d[15]=a[3]*e+a[7]*f+a[11]*c+a[15]):(h=a[0],b=a[1],l=a[2],g=a[3],k=a[4],m=a[5],z=a[6],y=a[7],A=a[8],B=a[9],C=a[10],n=a[11],d[0]=h,d[1]=b,d[2]=l,d[3]=g,d[4]=k,d[5]=m,d[6]=z,d[7]=y,d[8]=A,d[9]=B,d[10]=C,d[11]=n,d[12]=h*e+k*f+A*c+a[12],d[13]=b*e+m*f+B*c+a[13],d[14]=l*e+z*f+C*c+a[14],d[15]=g*e+y*f+n*c+a[15]);return d};b.scale=function(d,a,c){var e=c[0],f=c[1];c=c[2];d[0]=a[0]*e;d[1]=a[1]*e;d[2]=a[2]*e;d[3]=a[3]*e;d[4]=a[4]*f;d[5]=a[5]*f;d[6]=a[6]*f;d[7]=a[7]*f;d[8]=a[8]*c;d[9]=a[9]*
c;d[10]=a[10]*c;d[11]=a[11]*c;d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};b.rotate=function(d,a,c,e){var f=e[0],h=e[1];e=e[2];var b=Math.sqrt(f*f+h*h+e*e),l=void 0,q=void 0,g=void 0,m=void 0,z=void 0,y=void 0,A=void 0,B=void 0,C=void 0,n=void 0,E=void 0,G=void 0,H=void 0,D=void 0,I=void 0,L=void 0,O=void 0,K=void 0,N=void 0,Q=void 0,M=void 0,T=void 0,q=l=void 0;if(b<k.EPSILON)return null;b=1/b;f*=b;h*=b;e*=b;l=Math.sin(c);q=Math.cos(c);g=1-q;m=a[0];z=a[1];y=a[2];A=a[3];B=a[4];C=a[5];
n=a[6];E=a[7];G=a[8];H=a[9];D=a[10];I=a[11];L=f*f*g+q;O=h*f*g+e*l;K=e*f*g-h*l;N=f*h*g-e*l;Q=h*h*g+q;M=e*h*g+f*l;T=f*e*g+h*l;l=h*e*g-f*l;q=e*e*g+q;d[0]=m*L+B*O+G*K;d[1]=z*L+C*O+H*K;d[2]=y*L+n*O+D*K;d[3]=A*L+E*O+I*K;d[4]=m*N+B*Q+G*M;d[5]=z*N+C*Q+H*M;d[6]=y*N+n*Q+D*M;d[7]=A*N+E*Q+I*M;d[8]=m*T+B*l+G*q;d[9]=z*T+C*l+H*q;d[10]=y*T+n*l+D*q;d[11]=A*T+E*l+I*q;a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);return d};b.rotateX=function(d,a,c){var e=Math.sin(c);c=Math.cos(c);var f=a[4],h=a[5],b=a[6],
l=a[7],g=a[8],k=a[9],m=a[10],z=a[11];a!==d&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);d[4]=f*c+g*e;d[5]=h*c+k*e;d[6]=b*c+m*e;d[7]=l*c+z*e;d[8]=g*c-f*e;d[9]=k*c-h*e;d[10]=m*c-b*e;d[11]=z*c-l*e;return d};b.rotateY=function(d,a,c){var e=Math.sin(c);c=Math.cos(c);var f=a[0],h=a[1],b=a[2],l=a[3],g=a[8],k=a[9],m=a[10],z=a[11];a!==d&&(d[4]=a[4],d[5]=a[5],d[6]=a[6],d[7]=a[7],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);d[0]=f*c-g*e;d[1]=h*c-k*e;d[2]=b*c-
m*e;d[3]=l*c-z*e;d[8]=f*e+g*c;d[9]=h*e+k*c;d[10]=b*e+m*c;d[11]=l*e+z*c;return d};b.rotateZ=function(d,a,c){var e=Math.sin(c);c=Math.cos(c);var f=a[0],h=a[1],b=a[2],l=a[3],g=a[4],k=a[5],m=a[6],z=a[7];a!==d&&(d[8]=a[8],d[9]=a[9],d[10]=a[10],d[11]=a[11],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);d[0]=f*c+g*e;d[1]=h*c+k*e;d[2]=b*c+m*e;d[3]=l*c+z*e;d[4]=g*c-f*e;d[5]=k*c-h*e;d[6]=m*c-b*e;d[7]=z*c-l*e;return d};b.fromTranslation=function(d,a){d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;
d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=a[0];d[13]=a[1];d[14]=a[2];d[15]=1;return d};b.fromScaling=function(d,a){d[0]=a[0];d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=a[1];d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=a[2];d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};b.fromRotation=function(d,a,c){var e=c[0],f=c[1];c=c[2];var h=Math.sqrt(e*e+f*f+c*c),b=void 0,l=void 0,g=void 0;if(h<k.EPSILON)return null;h=1/h;e*=h;f*=h;c*=h;b=Math.sin(a);l=Math.cos(a);g=1-l;d[0]=e*e*g+l;d[1]=f*e*g+c*b;d[2]=c*e*g-f*b;d[3]=0;d[4]=e*f*g-
c*b;d[5]=f*f*g+l;d[6]=c*f*g+e*b;d[7]=0;d[8]=e*c*g+f*b;d[9]=f*c*g-e*b;d[10]=c*c*g+l;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};b.fromXRotation=function(d,a){var c=Math.sin(a);a=Math.cos(a);d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=a;d[6]=c;d[7]=0;d[8]=0;d[9]=-c;d[10]=a;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};b.fromYRotation=function(d,a){var c=Math.sin(a);a=Math.cos(a);d[0]=a;d[1]=0;d[2]=-c;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=c;d[9]=0;d[10]=a;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=
1;return d};b.fromZRotation=function(d,a){var c=Math.sin(a);a=Math.cos(a);d[0]=a;d[1]=c;d[2]=0;d[3]=0;d[4]=-c;d[5]=a;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};b.fromRotationTranslation=f;b.fromQuat2=function(d,a){var c=h,e=-a[0],b=-a[1],l=-a[2],g=a[3],k=a[4],m=a[5],w=a[6],v=a[7],z=e*e+b*b+l*l+g*g;0<z?(c[0]=2*(k*g+v*e+m*l-w*b)/z,c[1]=2*(m*g+v*b+w*e-k*l)/z,c[2]=2*(w*g+v*l+k*b-m*e)/z):(c[0]=2*(k*g+v*e+m*l-w*b),c[1]=2*(m*g+v*b+w*e-k*l),c[2]=2*(w*g+v*l+k*b-m*
e));f(d,a,c);return d};var h=m.create();b.getTranslation=function(d,a){d[0]=a[12];d[1]=a[13];d[2]=a[14];return d};b.getScaling=function(d,a){var c=a[0],e=a[1],f=a[2],h=a[4],b=a[5],l=a[6],g=a[8],k=a[9];a=a[10];d[0]=Math.sqrt(c*c+e*e+f*f);d[1]=Math.sqrt(h*h+b*b+l*l);d[2]=Math.sqrt(g*g+k*k+a*a);return d};b.getRotation=function(d,a){var c=a[0]+a[5]+a[10],e=0;0<c?(e=2*Math.sqrt(c+1),d[3]=.25*e,d[0]=(a[6]-a[9])/e,d[1]=(a[8]-a[2])/e,d[2]=(a[1]-a[4])/e):a[0]>a[5]&&a[0]>a[10]?(e=2*Math.sqrt(1+a[0]-a[5]-a[10]),
d[3]=(a[6]-a[9])/e,d[0]=.25*e,d[1]=(a[1]+a[4])/e,d[2]=(a[8]+a[2])/e):a[5]>a[10]?(e=2*Math.sqrt(1+a[5]-a[0]-a[10]),d[3]=(a[8]-a[2])/e,d[0]=(a[1]+a[4])/e,d[1]=.25*e,d[2]=(a[6]+a[9])/e):(e=2*Math.sqrt(1+a[10]-a[0]-a[5]),d[3]=(a[1]-a[4])/e,d[0]=(a[8]+a[2])/e,d[1]=(a[6]+a[9])/e,d[2]=.25*e);return d};b.fromRotationTranslationScale=function(d,a,c,e){var f=a[0],h=a[1],b=a[2],l=a[3],g=f+f,q=h+h,k=b+b;a=f*g;var m=f*q,f=f*k,y=h*q,h=h*k,b=b*k,g=l*g,q=l*q,l=l*k,k=e[0],A=e[1];e=e[2];d[0]=(1-(y+b))*k;d[1]=(m+l)*
k;d[2]=(f-q)*k;d[3]=0;d[4]=(m-l)*A;d[5]=(1-(a+b))*A;d[6]=(h+g)*A;d[7]=0;d[8]=(f+q)*e;d[9]=(h-g)*e;d[10]=(1-(a+y))*e;d[11]=0;d[12]=c[0];d[13]=c[1];d[14]=c[2];d[15]=1;return d};b.fromRotationTranslationScaleOrigin=function(d,a,c,e,f){var h=a[0],b=a[1],l=a[2],g=a[3],p=h+h,q=b+b,k=l+l;a=h*p;var m=h*q,A=h*k,h=b*q,b=b*k,B=l*k,l=g*p,q=g*q,C=g*k,n=e[0],E=e[1],k=e[2];e=f[0];g=f[1];f=f[2];var p=(1-(h+B))*n,G=(m+C)*n,n=(A-q)*n,m=(m-C)*E,B=(1-(a+B))*E,E=(b+l)*E,A=(A+q)*k,b=(b-l)*k;a=(1-(a+h))*k;d[0]=p;d[1]=G;
d[2]=n;d[3]=0;d[4]=m;d[5]=B;d[6]=E;d[7]=0;d[8]=A;d[9]=b;d[10]=a;d[11]=0;d[12]=c[0]+e-(p*e+m*g+A*f);d[13]=c[1]+g-(G*e+B*g+b*f);d[14]=c[2]+f-(n*e+E*g+a*f);d[15]=1;return d};b.fromQuat=function(d,a){var c=a[0],e=a[1],f=a[2];a=a[3];var h=c+c,b=e+e,l=f+f,c=c*h,g=e*h,e=e*b,k=f*h,m=f*b,f=f*l,h=a*h,b=a*b;a*=l;d[0]=1-e-f;d[1]=g+a;d[2]=k-b;d[3]=0;d[4]=g-a;d[5]=1-c-f;d[6]=m+h;d[7]=0;d[8]=k+b;d[9]=m-h;d[10]=1-c-e;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};b.frustum=function(d,a,c,e,f,h,b){var l=1/(c-a),
g=1/(f-e),p=1/(h-b);d[0]=2*h*l;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=2*h*g;d[6]=0;d[7]=0;d[8]=(c+a)*l;d[9]=(f+e)*g;d[10]=(b+h)*p;d[11]=-1;d[12]=0;d[13]=0;d[14]=b*h*2*p;d[15]=0;return d};b.perspective=function(d,a,c,e,f){a=1/Math.tan(a/2);var h=void 0;d[0]=a/c;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=a;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[11]=-1;d[12]=0;d[13]=0;d[15]=0;null!=f&&Infinity!==f?(h=1/(e-f),d[10]=(f+e)*h,d[14]=2*f*e*h):(d[10]=-1,d[14]=-2*e);return d};b.perspectiveFromFieldOfView=function(d,a,c,e){var f=Math.tan(a.upDegrees*
Math.PI/180),h=Math.tan(a.downDegrees*Math.PI/180),b=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);var l=2/(b+a),g=2/(f+h);d[0]=l;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=g;d[6]=0;d[7]=0;d[8]=-((b-a)*l*.5);d[9]=(f-h)*g*.5;d[10]=e/(c-e);d[11]=-1;d[12]=0;d[13]=0;d[14]=e*c/(c-e);d[15]=0;return d};b.ortho=function(d,a,c,e,f,h,b){var l=1/(a-c),g=1/(e-f),p=1/(h-b);d[0]=-2*l;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=-2*g;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=2*p;d[11]=0;d[12]=(a+c)*l;d[13]=(f+e)*
g;d[14]=(b+h)*p;d[15]=1;return d};b.lookAt=function(d,a,c,e){var f=void 0,h=void 0,b=void 0,l=void 0,q=void 0,m=void 0,v=void 0,z=void 0,y=void 0,A=void 0,B=a[0],C=a[1];a=a[2];b=e[0];l=e[1];e=e[2];v=c[0];z=c[1];c=c[2];if(Math.abs(B-v)<k.EPSILON&&Math.abs(C-z)<k.EPSILON&&Math.abs(a-c)<k.EPSILON)return g(d);v=B-v;z=C-z;y=a-c;A=1/Math.sqrt(v*v+z*z+y*y);v*=A;z*=A;y*=A;f=l*y-e*z;h=e*v-b*y;b=b*z-l*v;(A=Math.sqrt(f*f+h*h+b*b))?(A=1/A,f*=A,h*=A,b*=A):b=h=f=0;l=z*b-y*h;q=y*f-v*b;m=v*h-z*f;(A=Math.sqrt(l*l+
q*q+m*m))?(A=1/A,l*=A,q*=A,m*=A):m=q=l=0;d[0]=f;d[1]=l;d[2]=v;d[3]=0;d[4]=h;d[5]=q;d[6]=z;d[7]=0;d[8]=b;d[9]=m;d[10]=y;d[11]=0;d[12]=-(f*B+h*C+b*a);d[13]=-(l*B+q*C+m*a);d[14]=-(v*B+z*C+y*a);d[15]=1;return d};b.targetTo=function(d,a,c,e){var f=a[0],h=a[1];a=a[2];var b=e[0],l=e[1],g=e[2];e=f-c[0];var q=h-c[1];c=a-c[2];var k=e*e+q*q+c*c;0<k&&(k=1/Math.sqrt(k),e*=k,q*=k,c*=k);var m=l*c-g*q,g=g*e-b*c,b=b*q-l*e,k=m*m+g*g+b*b;0<k&&(k=1/Math.sqrt(k),m*=k,g*=k,b*=k);d[0]=m;d[1]=g;d[2]=b;d[3]=0;d[4]=q*b-c*
g;d[5]=c*m-e*b;d[6]=e*g-q*m;d[7]=0;d[8]=e;d[9]=q;d[10]=c;d[11]=0;d[12]=f;d[13]=h;d[14]=a;d[15]=1;return d};b.str=function(d){return"mat4("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+", "+d[4]+", "+d[5]+", "+d[6]+", "+d[7]+", "+d[8]+", "+d[9]+", "+d[10]+", "+d[11]+", "+d[12]+", "+d[13]+", "+d[14]+", "+d[15]+")"};b.frob=function(d){return Math.sqrt(Math.pow(d[0],2)+Math.pow(d[1],2)+Math.pow(d[2],2)+Math.pow(d[3],2)+Math.pow(d[4],2)+Math.pow(d[5],2)+Math.pow(d[6],2)+Math.pow(d[7],2)+Math.pow(d[8],2)+Math.pow(d[9],
2)+Math.pow(d[10],2)+Math.pow(d[11],2)+Math.pow(d[12],2)+Math.pow(d[13],2)+Math.pow(d[14],2)+Math.pow(d[15],2))};b.add=function(d,a,c){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3]+c[3];d[4]=a[4]+c[4];d[5]=a[5]+c[5];d[6]=a[6]+c[6];d[7]=a[7]+c[7];d[8]=a[8]+c[8];d[9]=a[9]+c[9];d[10]=a[10]+c[10];d[11]=a[11]+c[11];d[12]=a[12]+c[12];d[13]=a[13]+c[13];d[14]=a[14]+c[14];d[15]=a[15]+c[15];return d};b.subtract=l;b.multiplyScalar=function(d,a,c){d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;d[3]=a[3]*c;d[4]=
a[4]*c;d[5]=a[5]*c;d[6]=a[6]*c;d[7]=a[7]*c;d[8]=a[8]*c;d[9]=a[9]*c;d[10]=a[10]*c;d[11]=a[11]*c;d[12]=a[12]*c;d[13]=a[13]*c;d[14]=a[14]*c;d[15]=a[15]*c;return d};b.multiplyScalarAndAdd=function(d,a,c,e){d[0]=a[0]+c[0]*e;d[1]=a[1]+c[1]*e;d[2]=a[2]+c[2]*e;d[3]=a[3]+c[3]*e;d[4]=a[4]+c[4]*e;d[5]=a[5]+c[5]*e;d[6]=a[6]+c[6]*e;d[7]=a[7]+c[7]*e;d[8]=a[8]+c[8]*e;d[9]=a[9]+c[9]*e;d[10]=a[10]+c[10]*e;d[11]=a[11]+c[11]*e;d[12]=a[12]+c[12]*e;d[13]=a[13]+c[13]*e;d[14]=a[14]+c[14]*e;d[15]=a[15]+c[15]*e;return d};
b.exactEquals=function(d,a){return d[0]===a[0]&&d[1]===a[1]&&d[2]===a[2]&&d[3]===a[3]&&d[4]===a[4]&&d[5]===a[5]&&d[6]===a[6]&&d[7]===a[7]&&d[8]===a[8]&&d[9]===a[9]&&d[10]===a[10]&&d[11]===a[11]&&d[12]===a[12]&&d[13]===a[13]&&d[14]===a[14]&&d[15]===a[15]};b.equals=function(d,a){var c=d[0],e=d[1],f=d[2],h=d[3],b=d[4],l=d[5],g=d[6],m=d[7],v=d[8],z=d[9],y=d[10],A=d[11],B=d[12],C=d[13],n=d[14];d=d[15];var E=a[0],G=a[1],H=a[2],D=a[3],I=a[4],L=a[5],O=a[6],K=a[7],N=a[8],Q=a[9],M=a[10],T=a[11],P=a[12],S=a[13],
V=a[14];a=a[15];return Math.abs(c-E)<=k.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(e-G)<=k.EPSILON*Math.max(1,Math.abs(e),Math.abs(G))&&Math.abs(f-H)<=k.EPSILON*Math.max(1,Math.abs(f),Math.abs(H))&&Math.abs(h-D)<=k.EPSILON*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(b-I)<=k.EPSILON*Math.max(1,Math.abs(b),Math.abs(I))&&Math.abs(l-L)<=k.EPSILON*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(g-O)<=k.EPSILON*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(m-K)<=k.EPSILON*Math.max(1,Math.abs(m),
Math.abs(K))&&Math.abs(v-N)<=k.EPSILON*Math.max(1,Math.abs(v),Math.abs(N))&&Math.abs(z-Q)<=k.EPSILON*Math.max(1,Math.abs(z),Math.abs(Q))&&Math.abs(y-M)<=k.EPSILON*Math.max(1,Math.abs(y),Math.abs(M))&&Math.abs(A-T)<=k.EPSILON*Math.max(1,Math.abs(A),Math.abs(T))&&Math.abs(B-P)<=k.EPSILON*Math.max(1,Math.abs(B),Math.abs(P))&&Math.abs(C-S)<=k.EPSILON*Math.max(1,Math.abs(C),Math.abs(S))&&Math.abs(n-V)<=k.EPSILON*Math.max(1,Math.abs(n),Math.abs(V))&&Math.abs(d-a)<=k.EPSILON*Math.max(1,Math.abs(d),Math.abs(a))};
b.mul=e;b.sub=l})},"esri/views/3d/support/earthUtils":function(){define("require exports ../../../core/mathUtils ../../../core/wgs84Constants ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ./projectionUtils".split(" "),function(n,b,m,k,g,e,f,l){function h(a,c,d,e){var h,l;a instanceof f&&c instanceof f&&(d=c.longitude,e=c.latitude,l=a.latitude,h=a.longitude);a=m.deg2rad(l);e=m.deg2rad(e);h=m.deg2rad(h);c=m.deg2rad(d);d=Math.sin((a-e)/2);h=Math.sin((h-
c)/2);d=2*m.asinClamped(Math.sqrt(d*d+Math.cos(a)*Math.cos(e)*h*h))*b.earthRadius;return Math.round(1E4*d)/1E4}function d(a,c){a/=15;c||(a=Math.round(a));return a}Object.defineProperty(b,"__esModule",{value:!0});b.earthRadius=k.wgs84Radius;b.halfEarthRadius=b.earthRadius/2;b.halfEarthCircumference=Math.PI*b.earthRadius;b.earthCircumference=2*b.halfEarthCircumference;b.metersPerDegree=b.halfEarthCircumference/180;b.getGreatCircleDistance=h;b.getGreatCircleSpanAt=function(a,c,d){var e=c.spatialReference,
b=new f(c.x,a.y,e),l=new f(d.x,a.y,e);c=new f(a.x,c.y,e);a=new f(a.x,d.y,e);return{lon:h(b,l),lat:h(c,a)}};b.getLonDeltaForDistance=function(a,c){c/=b.earthRadius;a=m.deg2rad(a);c=Math.sin(c/2);a=Math.cos(a);a=2*m.asinClamped(Math.sqrt(c*c/(a*a)));return m.rad2deg(a)};b.getLatDeltaForDistance=function(a){return m.rad2deg(a/b.earthRadius)};b.getMaxCameraAltitude=function(a){a=m.deg2rad(a/2);return(1-Math.sin(a))*b.earthRadius/Math.sin(a)};b.getViewExtentDistance=function(a,c){c=m.deg2rad(c/2);return 2*
m.acosClamped((Math.pow(a+b.earthRadius,2)+Math.pow(b.earthRadius,2)-Math.pow((a+b.earthRadius)*Math.cos(c)-Math.sqrt(Math.pow(Math.cos(c)*(a+b.earthRadius),2)-a*a-2*a*b.earthRadius),2))/(2*(a+b.earthRadius)*b.earthRadius))*b.earthRadius};b.computeCartesianDistance=function(d,e){d=l.wgs84ComparableLonLatToECEF(a,d.longitude,d.latitude,d.z||0);e=l.wgs84ComparableLonLatToECEF(c,e.longitude,e.latitude,e.z||0);e=[e[0]-d[0],e[1]-d[1],e[2]-d[2]];return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])};b.longitudeToTimezone=
d;b.positionToTimezone=function(a,c){c||(c={hours:0,minutes:0,seconds:0});c.hours=d(a[0],!0);a=c.hours%1;c.hours-=a;c.minutes=60*a;a=c.minutes%1;c.minutes-=a;c.seconds=Math.round(60*a);return c};b.distanceToIdealHorizon=function(a,c){c=c||b.earthRadius;a=g.vec3.dot(a,a);return Math.sqrt(Math.abs(a-c*c))};var a=e.vec3f64.create(),c=e.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});
(function(b){b.length=function(b,g){var e=b[g],f=b[g+1];b=b[g+2];return Math.sqrt(e*e+f*f+b*b)};b.normalize=function(b,g){var e=b[g],f=b[g+1],l=b[g+2],e=1/Math.sqrt(e*e+f*f+l*l);b[g]*=e;b[g+1]*=e;b[g+2]*=e};b.scale=function(b,g,e){b[g]*=e;b[g+1]*=e;b[g+2]*=e};b.add=function(b,g,e,f,l,h){void 0===h&&(h=g);l=l||b;l[h]=b[g]+e[f];l[h+1]=b[g+1]+e[f+1];l[h+2]=b[g+2]+e[f+2]};b.subtract=function(b,g,e,f,l,h){void 0===h&&(h=g);l=l||b;l[h]=b[g]-e[f];l[h+1]=b[g+1]-e[f+1];l[h+2]=b[g+2]-e[f+2]}})(b.Vec3Compact||
(b.Vec3Compact={}))})},"esri/views/support/spatialReferenceSupport":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.isSpatialReferenceSupported=function(b,k){return null==b?!1:"2d"===k?!0:"local"===k?!b.isGeographic:b.isWebMercator||b.isWGS84||4490===b.wkid}})},"esri/webdoc/support/thumbnailUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});var m={width:600,height:400};b.getOptimalThumbnailSize=
function(b,g){g=g||m;var e=g.width;g=g.height;var f=e/g;1.5>f?g=e/1.5:1.5<f&&(e=1.5*g);e>b.width&&(g*=b.width/e,e=b.width);g>b.height&&(e*=b.height/g,g=b.height);return{width:Math.round(e),height:Math.round(g)}}})},"esri/webscene/ApplicationProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ../webdoc/applicationProperties/Viewing".split(" "),function(n,b,m,k,g,e,f){return function(b){function h(a){a=
b.call(this,a)||this;a.viewing=null;return a}m(h,b);d=h;h.prototype.clone=function(){return new d({viewing:this.viewing?this.viewing.clone():null})};var d;k([e.property({type:f,json:{write:!0}})],h.prototype,"viewing",void 0);return h=d=k([e.subclass("esri.webscene.ApplicationProperties")],h)}(e.declared(g.JSONSupport))})},"esri/webdoc/applicationProperties/Viewing":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./Search".split(" "),
function(n,b,m,k,g,e,f,l){return function(b){function d(a){a=b.call(this,a)||this;a.search=null;return a}m(d,b);a=d;d.prototype.clone=function(){return new a(e.clone({search:this.search}))};var a;k([f.property({type:l,json:{write:!0}})],d.prototype,"search",void 0);return d=a=k([f.subclass("esri.webdoc.applicationProperties.Viewing")],d)}(f.declared(g.JSONSupport))})},"esri/webdoc/applicationProperties/Search":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./SearchLayer".split(" "),
function(n,b,m,k,g,e,f,l,h){var d=g.ofType(h);return function(a){function c(c){c=a.call(this,c)||this;c.addressSearchEnabled=!0;c.enabled=!0;c.hintText=null;c.layers=new d;return c}m(c,a);e=c;c.prototype.readAddressSearchEnabled=function(a){return!a};c.prototype.writeAddressSearchEnabled=function(a,c,d){c[d]=!a};c.prototype.clone=function(){return new e(f.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers}))};var e;k([l.property({type:Boolean,
json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder"},default:!0,origins:{"web-scene":{read:!1,write:!1}}}})],c.prototype,"addressSearchEnabled",void 0);k([l.reader("addressSearchEnabled")],c.prototype,"readAddressSearchEnabled",null);k([l.writer("addressSearchEnabled")],c.prototype,"writeAddressSearchEnabled",null);k([l.property({type:Boolean,json:{write:!0,default:!0}})],c.prototype,"enabled",void 0);k([l.property({type:String,json:{write:!0}})],c.prototype,"hintText",void 0);
k([l.property({type:d,json:{write:{enabled:!0,isRequired:!0}}})],c.prototype,"layers",void 0);return c=e=k([l.subclass("esri.webdoc.applicationProperties.Search")],c)}(l.declared(e.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),
function(n,b,m,k,g,e,f,l,h){return function(d){function a(a){a=d.call(this,a)||this;a.field=null;a.id=null;a.subLayer=null;return a}m(a,d);c=a;a.prototype.clone=function(){return new c(e.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};var c;k([f.property({type:h,json:{write:{enabled:!0,isRequired:!0}}})],a.prototype,"field",void 0);k([f.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],a.prototype,"id",void 0);k([f.property({type:l.Integer,json:{write:!0}})],a.prototype,
"subLayer",void 0);return a=c=k([f.subclass("esri.webdoc.applicationProperties.SearchLayer")],a)}(f.declared(g.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(n,b,m,k,g,e,f){return function(b){function h(a){a=b.call(this,a)||this;a.exactMatch=!1;a.name=
null;a.type=null;return a}m(h,b);d=h;h.prototype.clone=function(){return new d({exactMatch:this.exactMatch,type:this.type,name:this.name})};var d;k([e.property({type:Boolean,json:{write:!0}})],h.prototype,"exactMatch",void 0);k([e.property({type:String,json:{write:!0}})],h.prototype,"name",void 0);k([e.enumeration.serializable()(f.kebabDict)],h.prototype,"type",void 0);return h=d=k([e.subclass("esri.webdoc.applicationProperties.SearchLayerField")],h)}(e.declared(g.JSONSupport))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(n,b,m,k,g,e,f,l,h){var d=function(a,c,d){return{enabled:!d||!d.isPresentation}};return function(a){function c(c){c=a.call(this,c)||this;c.lighting=new l;c.background=null;c.atmosphereEnabled=!0;c.starsEnabled=!0;return c}m(c,a);b=c;c.prototype.clone=function(){return new b(this.cloneConstructProperties())};c.prototype.cloneConstructProperties=function(){return{lighting:l.prototype.clone.call(this.lighting),background:e.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
var b;k([f.property({type:l,json:{write:!0}})],c.prototype,"lighting",void 0);k([f.property(h.backgroundProperty)],c.prototype,"background",void 0);k([f.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:d}}})],c.prototype,"atmosphereEnabled",void 0);k([f.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:d}}})],c.prototype,"starsEnabled",void 0);return c=b=k([f.subclass("esri.webscene.Environment")],c)}(f.declared(g.JSONSupport))})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),
function(n,b,m,k,g,e){return function(f){function b(d){d=f.call(this,d)||this;d.date=null;d.directShadowsEnabled=!1;d.displayUTCOffset=null;return d}m(b,f);h=b;b.prototype.readDate=function(d,a){return null!=a.datetime&&new Date(a.datetime)||null};b.prototype.writeDate=function(d,a,c){a[c]=d.getTime()};b.prototype.readDirectShadowsEnabled=function(d,a){return!!a.directShadows};b.prototype.writedirectShadowsEnabled=function(d,a,c){d&&(a[c]=d)};b.prototype.writeDisplayUTCOffset=function(d,a){null!=
d&&(a.displayUTCOffset=d)};b.prototype.clone=function(){return new h(this.cloneConstructProperties())};b.prototype.cloneConstructProperties=function(){var d={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(d.date=new Date(this.date.getTime()));return d};var h;k([e.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],b.prototype,"date",void 0);k([e.reader("date",["datetime"])],b.prototype,"readDate",
null);k([e.writer("date")],b.prototype,"writeDate",null);k([e.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],b.prototype,"directShadowsEnabled",void 0);k([e.reader("directShadowsEnabled",["directShadows"])],b.prototype,"readDirectShadowsEnabled",null);k([e.writer("directShadowsEnabled")],b.prototype,"writedirectShadowsEnabled",null);k([e.property({type:Number,json:{write:!0}})],b.prototype,"displayUTCOffset",void 0);k([e.writer("displayUTCOffset")],b.prototype,"writeDisplayUTCOffset",
null);return b=h=k([e.subclass("esri.webscene.Lighting")],b)}(e.declared(g.JSONSupport))})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n={base:m,key:"type",typeMap:{color:k}};b.backgroundProperty={types:n,json:{read:function(b){return function(e,f,l){if(!e)return e;for(var h in b.typeMap)if(e.type===h)return f=new b.typeMap[h],f.read(e,l),f}}(n),write:{overridePolicy:function(b,
e,f){return{enabled:!f||!f.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(n,b,m,k,g,e,f,l){var h=e.strict()({color:"color"});return function(d){function a(a){return d.call(this,a)||this}m(a,d);a.prototype.normalizeCtorArgs=function(a){a&&a.type&&
(a=g({},a),delete a.type);return a};a.prototype.clone=function(){};k([l.property({type:h.apiValues,readOnly:!0,json:{type:h.jsonValues,read:!1,write:h.write}})],a.prototype,"type",void 0);return a=k([l.subclass("esri.webscene.background.Background")],a)}(l.declared(f.JSONSupport))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(n,b,m,k,g,e,f,l,h){var d=g({},l.colorAndTransparencyProperty,{nonNullable:!0});return function(a){function c(c){c=a.call(this,c)||this;c.type="color";c.color=new e([0,0,0,1]);return c}m(c,a);b=c;c.prototype.clone=function(){return new b(this.cloneProperties())};c.prototype.cloneProperties=function(){return{color:this.color.clone()}};var b;k([f.enumeration.serializable()({color:"color"})],c.prototype,"type",void 0);k([f.property(d)],c.prototype,"color",void 0);return c=b=k([f.subclass("esri.webscene.background.ColorBackground")],
c)}(f.declared(h))})},"esri/webscene/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../core/accessorSupport/decorators ../geometry/SpatialReference ./Environment".split(" "),function(n,b,m,k,g,e,f,l,h){return function(d){function a(a){a=d.call(this,a)||this;a.environment=new h;a.spatialReference=null;a.viewpoint=null;return a}m(a,d);c=a;Object.defineProperty(a.prototype,"viewingMode",{set:function(a){this._set("viewingMode",
a)},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new c({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};var c;k([f.property({type:h,json:{write:{isRequired:!0}}})],a.prototype,"environment",void 0);k([f.property({type:l})],a.prototype,"spatialReference",void 0);k([f.property({type:["local","global"]})],a.prototype,"viewingMode",
null);k([f.property({type:g,json:{write:{isRequired:!0}}})],a.prototype,"viewpoint",void 0);return a=c=k([f.subclass("esri.webscene.InitialViewProperties")],a)}(f.declared(e))})},"esri/webscene/Presentation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators ./Slide".split(" "),function(n,b,m,k,g,e,f,l,h){var d=g.ofType(h);return function(a){function c(c){c=
a.call(this,c)||this;c.slides=new d;return c}m(c,a);Object.defineProperty(c.prototype,"slides",{set:function(a){a&&(a=a.filter(function(a){return!!a.viewpoint}));this._set("slides",e.referenceSetter(a,this._get("slides"),d))},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})};k([l.property({type:d,nonNullable:!0,json:{write:!0}}),l.cast(e.castForReferenceSetter)],c.prototype,"slides",null);return c=k([l.subclass("esri.webscene.Presentation")],
c)}(l.declared(f.JSONSupport))})},"esri/webscene/Slide":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../Basemap ../Viewpoint ../core/asyncUtils ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3 ../core/libs/gl-matrix-2/vec3f64 ../layers/Layer ../support/basemapUtils ../views/3d/support/mathUtils ../webdoc/support/Thumbnail ./Environment ./Lighting ./support/Description ./support/SlideGround ./support/SlideVisibleLayer ./support/Title".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H){function D(a){if("building-scene"===a.type||"map-image"===a.type)return a.allSublayers}function I(a){if(a=D(a))return a.filter(function(a){return a.visible}).map(function(a){return a.id}).toArray()}function L(a,c){a=c-a;a>M&&(a-=Q);a<-M&&(a+=Q);return a}var O=0,K=a.ofType(G.default),N=p.getLogger("esri.webscene.Slide"),Q=86400,M=43200;return function(b){function p(a){a=b.call(this,a)||this;a._applyToController=null;a.id=Date.now().toString(16)+
"-slide-"+O++;a.title=new H.default;a.description=new F.default;a.thumbnail=new A.default;a.viewpoint=null;a.basemap=null;a.ground=null;a.environment=new B;a.visibleLayers=new K;return a}k(p,b);p.prototype.castTitle=function(a){return"string"===typeof a?new H.default({text:a}):r.ensureType(H.default,a)};p.prototype.castDescription=function(a){return"string"===typeof a?new F.default({text:a}):r.ensureType(F.default,a)};p.prototype.castThumbnail=function(a){return"string"===typeof a?new A.default({url:a}):
r.ensureType(A.default,a)};p.prototype.castBasemap=function(a){return z.ensureType(a)};Object.defineProperty(p.prototype,"visibleLayers",{set:function(a){this._set("visibleLayers",c.referenceSetter(a,this._get("visibleLayers"),K))},enumerable:!0,configurable:!0});p.prototype.castVisibleLayers=function(a){return a&&"function"===typeof a.map?a.map(function(a){if("string"===typeof a)return{id:a};if(a instanceof v){var c=I(a);return{id:a.id,sublayerIds:c}}if(a.id)return{id:a.id,sublayerIds:a.sublayerIds};
N.warn('Invalid visible layer, expected { id }, Layer or "id"');return a}):null};p.prototype.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||
null})};p.prototype._updateVisibleLayersFrom=function(a){var c=this,d=[];return t.eachAlways(this._allLayers(a.map).map(function(c){return a.whenLayerView(c).then(function(a){if(a.visible){var e=I(c);d.push(new G.default({id:a.layer.id,sublayerIds:e}))}})}).toArray()).then(function(){c.visibleLayers.removeAll();c.visibleLayers.addMany(d)})};p.prototype.updateFrom=function(a,c){var d=this;c={screenshot:m({format:"jpeg",quality:80,width:120,height:75,disableSlice:!0},c&&c.screenshot)};return a.when(function(){d.viewpoint=
a.viewpoint.clone();d.environment.lighting=C.prototype.clone.apply(a.environment.lighting);d.basemap=a.map.basemap&&a.map.basemap.clone()||null;d.ground=a.map.ground?E.default.fromGround(a.map.ground):null;return d._updateVisibleLayersFrom(a)}).then(function(){return a.takeScreenshot(c.screenshot)}).then(function(a){d.thumbnail=new A.default({url:a.dataUrl});return d})};p.prototype.applyTo=function(a,c){return f(this,void 0,void 0,function(){var d,f,b;return e(this,function(e){this._applyToController&&
this._applyToController.abort();this._applyToController=d=t.createAbortController();t.onAbortOrThrow(c,function(){return d.abort()});f=m({animate:!0},c,{signal:this._applyToController.signal});b=t.createDeferred(function(){return d.abort()});this._applyTo(a,f,d).then(b.resolve,b.reject);return[2,b.promise]})})};p.prototype._applyTo=function(a,c,b){return f(this,void 0,void 0,function(){var h,l=this;return e(this,function(g){switch(g.label){case 0:return[4,d.result(function(){return f(l,void 0,void 0,
function(){return e(this,function(d){switch(d.label){case 0:return[4,this._applyBasemap(a,c)];case 1:return d.sent(),this._applyLayerVisibility(a),this._applyGround(a),[4,this._applyViewpoint(a,c)];case 2:return d.sent(),[2]}})})}())];case 1:h=g.sent();this._applyToController===b&&(this._applyToController=null);if(!1===h.ok)throw h.error;return[2,this]}})})};p.prototype._applyBasemap=function(a,c){return f(this,void 0,void 0,function(){var d;return e(this,function(e){switch(e.label){case 0:if(!this.basemap)return[3,
5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.basemap.load(c)];case 2:return e.sent(),[3,4];case 3:d=e.sent();if(t.isAbortError(d))throw d;return[3,4];case 4:a.map.basemap=z.clonePreservingTiledLayers(this.basemap,a.map.basemap),e.label=5;case 5:return[2]}})})};p.prototype._applyGround=function(a){this.ground&&(a.map.ground=this.ground.cloneAndApplyTo(a.map.ground))};p.prototype._allLayers=function(c){var d=new a;this._collectLayers(c,d);this._collectLayers(c.ground,d);return d};p.prototype._collectLayers=
function(a,c){var d=this;a.layers.forEach(function(a){c.add(a);a.layers&&d._collectLayers(a,c)})};p.prototype._applyLayerVisibility=function(a){var c=this;this.visibleLayers&&this._allLayers(a.map).forEach(function(a){var d=c.visibleLayers.find(function(c){return c.id===a.id});a.visible=null!=d;var e=d&&d.sublayerIds,d=D(a);e&&d&&d.forEach(function(a){return a.visible=0<=e.indexOf(a.id)})})};p.prototype._applyViewpoint=function(a,c){return f(this,void 0,void 0,function(){return e(this,function(d){switch(d.label){case 0:if(!this.viewpoint||
c.ignoreViewpoint)return[3,5];this.viewpoint.camera.fov=a.camera.fov;return c.animate&&this.get("environment.lighting.date")?[4,this._animateToLighting(a,c)]:[3,2];case 1:return d.sent(),[2];case 2:if(!c.animate)return[3,4];a.environment.updateLighting(this.environment.lighting.clone());return[4,a.goTo(this.viewpoint,c)];case 3:d.sent(),d.label=4;case 4:a.viewpoint=this.viewpoint,d.label=5;case 5:return a.environment.updateLighting(this.environment.lighting.clone()),[2]}})})};p.prototype._animateToLighting=
function(a,c){return f(this,void 0,void 0,function(){var d,f,b,h=this;return e(this,function(e){d=null;"global"===a.viewingMode&&(d=this._animateLightingWithCamera(a));a.environment.lighting.cameraTrackingEnabled=!1;a.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;null!=this.environment.lighting.displayUTCOffset&&(a.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);f=a.goTo(this.viewpoint,c);b=function(){d&&d.remove();a.environment.lighting.cameraTrackingEnabled=
!0};return[2,f.then(function(){a.environment.updateLighting(h.environment.lighting.clone());b()},function(a){b();throw a;})]})})};p.prototype._getTime=function(a){var c=a.getTime();a=3600*a.getUTCHours()+60*a.getUTCMinutes()+a.getUTCSeconds();return[c,a]};p.prototype._setTime=function(a,c,d){a.setTime(c);a.setUTCHours(d/3600);a.setUTCMinutes(d%3600/60);a.setUTCSeconds(d%3600%60);return a};p.prototype._animateLightingWithCamera=function(a){var c=this,d=this._getTime(new Date(a.environment.lighting.date.toString())),
e=d[0],f=d[1],d=this._getTime(this.environment.lighting.date),b=d[0],h=L(f,d[1]),l=a.renderCoordsHelper,g=w.vec3f64.create();l.toRenderCoords(a.camera.position,g);var p=w.vec3f64.create();l.toRenderCoords(this.viewpoint.camera.position,p);var k=w.vec3f64.create(),q=new Date;return a.watch("camera",function(d){l.toRenderCoords(d.position,k);var r=x.vec3.squaredDistance(g,k),t=x.vec3.squaredDistance(p,k);d=0;0!==r+t&&(d=r/(r+t));r=e+(b-e)*d;d=y.moduloPositive(f+h*d,Q);a.environment.lighting.date=c._setTime(q,
r,d)})};p.createFrom=function(a,c){return(new this).updateFrom(a,c)};g([u.property({type:String,json:{write:{isRequired:!0}}})],p.prototype,"id",void 0);g([u.property({type:H.default,json:{default:function(){return new H.default({text:""})},write:{isRequired:!0}}})],p.prototype,"title",void 0);g([u.cast("title")],p.prototype,"castTitle",null);g([u.property({type:F.default,json:{write:{overridePolicy:function(a){return{enabled:!(!a||!a.text)}}}}})],p.prototype,"description",void 0);g([u.cast("description")],
p.prototype,"castDescription",null);g([u.property({type:A.default,json:{default:function(){return new A.default({url:""})},write:{isRequired:!0}}})],p.prototype,"thumbnail",void 0);g([u.cast("thumbnail")],p.prototype,"castThumbnail",null);g([u.property({type:h,nonNullable:!0,json:{write:{isRequired:!0}}})],p.prototype,"viewpoint",void 0);g([u.property({type:l,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],p.prototype,"basemap",void 0);g([u.cast("basemap")],p.prototype,"castBasemap",null);
g([u.property({type:E.default,json:{write:!0}})],p.prototype,"ground",void 0);g([u.property({type:K,json:{write:{isRequired:!0}}})],p.prototype,"visibleLayers",null);g([u.cast("visibleLayers")],p.prototype,"castVisibleLayers",null);g([u.property({type:B,json:{write:!0}})],p.prototype,"environment",void 0);return p=g([u.subclass("esri.webscene.Slide")],p)}(u.declared(q.JSONSupport))})},"esri/webdoc/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(f){function b(){var d=null!==f&&f.apply(this,arguments)||this;d.url="";return d}m(b,f);h=b;b.prototype.clone=function(){return new h({url:this.url})};var h;k([e.property({type:String,json:{write:{isRequired:!0}}})],b.prototype,"url",void 0);return b=h=k([e.subclass("esri.webdoc.support.Thumbnail")],b)}(e.declared(g.JSONSupport));b.default=n})},"esri/webscene/support/Description":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(f){function b(){var d=null!==f&&f.apply(this,arguments)||this;d.text="";return d}m(b,f);h=b;b.prototype.clone=function(){return new h({text:this.text})};var h;k([e.property({type:String,json:{write:!0}})],b.prototype,"text",void 0);return b=h=k([e.subclass("esri.webscene.support.Description")],b)}(e.declared(g.JSONSupport));b.default=n})},"esri/webscene/support/SlideGround":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../webdoc/support/opacityUtils".split(" "),
function(n,b,m,k,g,e,f,l,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(d){function a(){var a=null!==d&&d.apply(this,arguments)||this;a.opacity=null;return a}m(a,d);c=a;a.prototype.clone=function(){return new c({opacity:this.opacity})};a.prototype.cloneAndApplyTo=function(a){if(null==this.opacity)return a;a=null!=a?a.clone():new g;a.opacity=this.opacity;return a};a.fromGround=function(a){return new c({opacity:a.opacity})};var c;k([f.property({type:Number,json:{type:l.Integer,read:{reader:h.transparencyToOpacity,
source:"transparency"},write:{writer:function(a,c){c.transparency=h.opacityToTransparency(a)},target:"transparency"}}})],a.prototype,"opacity",void 0);return a=c=k([f.subclass("esri.webscene.support.SlideGround")],a)}(f.declared(e.JSONSupport));b.default=n})},"esri/webscene/support/SlideVisibleLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),
function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a){a=b.call(this,a)||this;a.id="";a.sublayerIds=null;return a}m(d,b);a=d;d.prototype.clone=function(){return new a({id:this.id,sublayerIds:e.clone(this.sublayerIds)})};var a;k([f.property({type:String,json:{write:!0}})],d.prototype,"id",void 0);k([f.property({type:[l.Integer],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],d.prototype,"sublayerIds",void 0);return d=a=k([f.subclass("esri.webscene.support.SlideVisibleLayer")],
d)}(f.declared(g.JSONSupport));b.SlideVisibleLayer=n;b.default=n})},"esri/webscene/support/Title":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(f){function b(){var d=null!==f&&f.apply(this,arguments)||this;d.text="";return d}m(b,f);h=b;b.prototype.clone=function(){return new h({text:this.text})};
var h;k([e.property({type:String,json:{write:{isRequired:!0}}})],b.prototype,"text",void 0);return b=h=k([e.subclass("esri.webscene.support.Title")],b)}(e.declared(g.JSONSupport));b.default=n})},"esri/webscene/TransportationNetwork":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(n,b,m,k,g,e){return function(f){function b(d){return f.call(this,d)||this}m(b,f);h=b;
b.prototype.clone=function(){return new h({name:this.name,path:this.path,title:this.title})};var h;k([e.property({json:{write:!0}})],b.prototype,"name",void 0);k([e.property({json:{write:!0}})],b.prototype,"path",void 0);k([e.property({json:{write:!0}})],b.prototype,"title",void 0);return b=h=k([e.subclass("esri.webscene.TransportationNetwork")],b)}(e.declared(g.JSONSupport))})},"esri/webscene/Version":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/Version"],function(n,
b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(e,l){return b.call(this,e,l,"webscene")||this}m(e,b);Object.defineProperty(e.prototype,"supportsGround",{get:function(){return this.since(1,8)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!0,configurable:!0});return e}(k.Version);b.Version=n;b.default=n})},"esri/core/Version":function(){define(["require",
"exports","./Error"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e,f){void 0===f&&(f="");this.major=b;this.minor=e;this._context=f}b.prototype.lessThan=function(b,e){return this.major<b||b===this.major&&this.minor<e};b.prototype.since=function(b,e){return!this.lessThan(b,e)};b.prototype.validate=function(b){if(this.major!==b.major)throw new m((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+
"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:b});};b.prototype.clone=function(){return new b(this.major,this.minor,this._context)};b.parse=function(g,e){void 0===e&&(e="");var f=g.split("."),l=f[0],f=f[1],h=/^\s*\d+\s*$/;if(!l||!l.match||!l.match(h))throw new m((e&&e+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:g});if(!f||!f.match||!f.match(h))throw new m((e&&e+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",
{version:g});g=parseInt(l,10);l=parseInt(f,10);return new b(g,l,e)};return b}();b.Version=n})},"esri/views/SceneView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/assignHelper ../Camera ../geometry ../Graphic ../Ground ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/has ../core/Logger ../core/maybe ../core/promiseUtils ../core/scheduling ../core/watchUtils ./../core/screenUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3f64 ../geometry/HeightModelInfo ../geometry/support/aaBoundingRect ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ../layers/support/layerUtils ../support/arcadeOnDemand ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./3d/layerViewModuleImportUtils ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/graphics/ObjectResourceCache ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/geometryUtils ./3d/support/HighlightOptions ./3d/support/index ./3d/support/MapCoordsHelper ./3d/support/projectionUtils ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/geometryUtils/boundedPlane ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/intersectorUtils ./support/layerViewUtils ./support/screenshotUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment @dojo/framework/shim/Promise".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L,O,K,N,Q,M,T,P,S,V,J,U,Y,X,R,aa,da,ca,ba,W,Z,ea,fa,na,la,ma,oa,ka,ia,ga,ja,ha,qa,Aa,wa,Ba,va,Ca,ua,sa,Da,xa,ya,Ea,za,Fa){function ta(a,c){a.layerUids||(a.layerUids=new Set);a.layerUids.add(c)}function Ga(a,c){a.graphicUids||(a.graphicUids=new Set);a.graphicUids.add(c)}var pa=x.getLogger("esri.views.SceneView");b=function(f){function b(a){var c=f.call(this,a)||this;c._clippingArea=null;c._userClippingArea=null;c._initialDefaultSpatialReference=
null;c._defaults={};c._externallySet={environment:!1};c._createGraphicsViewController=null;c._resolveWhenReady=[];c.propertiesPool=new ia.default({slicePlane:Aa.BoundedPlaneClass},c);c._resourceController=ma.newResourceController(c);c._defaultToMapOptions={include:new Set};c._defaultHitTestOptions={exclude:new Set};c.deconflictor=new Y.GraphicsDeconflictor({view:c});c.labeler=new X.Labeler({view:c,deconflictor:c.deconflictor.labels});c.sharedSymbolResources=null;c.basemapTerrain=null;c.elevationProvider=
null;c.camera=null;c.canvas=null;c.center=null;c.constraints=new S.default;c.environmentManager=new J.default;c.extent=null;c.windowDevicePixelRatio=1;c.fullOpacity=1;c.graphicsView=null;c.groundView=null;c.map=null;c.screenSizePerspectiveEnabled=!0;c.state=null;c.scale=null;c.spatialReference=null;c.isHeightModelInfoRequired=!0;c.alphaCompositingEnabled=!1;c.supersampleScreenhotsEnabled=!0;c.type="3d";c.ui=new za;c._numUpdating=0;c._lastUpdateTime=0;c.updatingProgress=.5;c.viewpoint=null;c.zoom=
null;c.highlightOptions=new la;a&&a.environment||(c._defaults.environment=new V,c.environment=c._defaults.environment);a=function(){c.notifyChange("dataExtent");c.updatingChanged();c.map&&c.map.allLayers.forEach(function(a){return e(c,void 0,void 0,function(){return g(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,a.when()];case 1:return c.sent(),[3,3];case 2:return c.sent(),[3,3];case 3:return this.updatingChanged(),[2]}})})})};c.handles.add([y.on(c,"map.allLayers","after-changes",
a,a,a,!0),c.allLayerViews.on("after-changes",function(){return c._updateUpdatingMonitors()}),c.watch("map",function(a){a&&a.load&&a.load().catch(function(){})})]);c.inputManager=new U({view:c});c.stateManager=new ca.ViewStateManager({view:c,updateDevicePixelRatio:function(){var a=window.devicePixelRatio;a!==c.windowDevicePixelRatio&&(c.windowDevicePixelRatio=a,c.notifyChange("pixelRatio"))}});return c}m(b,f);b.prototype.initialize=function(){var a=this;this.groundView=new N({view:this});this._updateUpdatingMonitors();
var c=function(){return a._updateDefaultToMapOptions()};this.handles.add([y.on(this,"map.allLayers","after-changes",c,c,c)]);this.updatingHandles.add(this.qualitySettings,"memoryLimit",function(c){a.resourceController&&(a.resourceController.memoryController.maxMemory=c)},2);this.updatingHandles.add(this.qualitySettings,"additionalCacheMemory",function(c){a.resourceController&&(a.resourceController.memoryController.additionalCacheMemory=c)},2);this.updatingHandles.add(this.qualitySettings,"frameRate",
function(a){return z.setFrameDuration(0<a?1E3/Math.ceil(a):0)},2);this.updatingHandles.add(Z,"SCENEVIEW_LOCKING_LOG",function(c){return a.defaultsFromMap.logDebugInformation=c},2);this.updatingHandles.add(this,"map.ground",c,3);this.updatingHandles.add(this,"map.ground.opacity",function(){return a._updateDefaultHitTestOptions()},3);this.handles.add(this.watch("spatialReference",function(){return a.notifyChange("clippingArea")},!0))};b.prototype.destroy=function(){this.invalidate();this.activeTool=
null;this.layerViewManager.clear();this._exitSurface();this._disposeGraphicsView();this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null);this.labeler.destroy();this._set("labeler",null);this.deconflictor.destroy();this._set("deconflictor",null);this._resourceController.destroy();this._resourceController=null;this.stateManager.destroy();this._set("stateManager",null);this.inputManager.destroy();this._set("inputManager",null);this.propertiesPool.destroy();
this.handles.remove("updatingMonitors");this.environmentManager.destroy();this._set("environmentManager",null);this.groundView.destroy();this.groundView=null};Object.defineProperty(b.prototype,"renderSpatialReference",{get:function(){return this.renderCoordsHelper?this.renderCoordsHelper.spatialReference:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"clippingArea",{get:function(){if("global"===this.viewingMode)return null;var a=this._userClippingArea||this.get("map.clippingArea");
if(!this._userClippingArea&&!this.get("map.clippingEnabled")||!a)return this._clippingArea=null;if(!(a instanceof h.Extent))return pa.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference){if(!D.canProject(a.spatialReference,this.spatialReference))return pa.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;a=D.project(a,this.spatialReference)}return this._clippingArea&&a&&this._clippingArea.equals(a)?
this._clippingArea:this._clippingArea=a},set:function(a){this.ready&&"global"===this.viewingMode&&a?pa.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=a,this.notifyChange("clippingArea"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"dataExtent",{get:function(){var a=[],c=this.spatialReference||h.SpatialReference.WGS84,d=this.clippingArea;d&&(d=D.project(d,c));var e=function(e){if(e&&(e=D.project(e,c))){if(d&&(e=e.intersection(d),
!e))return;a.push(e)}},f=this._get("basemapTerrain");f&&f.spatialReference&&e(new h.Extent({xmin:f.extent[0],ymin:f.extent[1],zmin:0,xmax:f.extent[2],ymax:f.extent[3],zmax:0,spatialReference:f.spatialReference}));this.map&&this.map.allLayers.forEach(function(a){return e(a.fullExtent)});if(0===a.length)return new h.Extent({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:c});f=a.reduce(function(a,c){return a.union(c)});f.hasZ?(f.zmin=Math.min(0,f.zmin),f.zmax=Math.max(0,f.zmax)):(f.zmin=
0,f.zmax=0);return f},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"environment",{set:function(a){a!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",a)},enumerable:!0,configurable:!0});b.prototype.castEnvironment=function(a){return a?a instanceof V?a:a instanceof Fa?V.fromWebsceneEnvironment(a):C.ensureType(V,a):new V};Object.defineProperty(b.prototype,"pixelRatio",{get:function(){return Math.min(this.windowDevicePixelRatio,this.maximumPixelRatio)},
set:function(a){w.isSome(a)?this._override("pixelRatio",a):this._clearOverride("pixelRatio")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maximumPixelRatio",{get:function(){var a=Infinity,c=this.qualitySettings,d=c.maximumPixelRatio,c=c.maximumRenderResolution;null!=d&&(a=Math.min(a,d));null!=c&&(a=Math.min(a,c/Math.max(this.width,this.height)));return a},set:function(a){w.isSome(a)?this._override("maximumPixelRatio",a):this._clearOverride("maximumPixelRatio")},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"groundExtent",{get:function(){var a=this._get("basemapTerrain");if(a&&a.spatialReference){var c=a.extent;return new h.Extent({xmin:c[0],ymin:c[1],xmax:c[2],ymax:c[3],spatialReference:a.spatialReference})}return new h.Extent({spatialReference:this.spatialReference||h.SpatialReference.WGS84})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"initialExtentRequired",{get:function(){return this.stateManager&&!this.stateManager.hasInitialView},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"interacting",{get:function(){return this.navigating||w.isSome(this.activeTool)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"navigating",{get:function(){return!(!this.state||!this.state.navigating)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"qualityProfile",{get:function(){return this._get("qualityProfile")||ea.getDefaultProfile()},set:function(a){ea.isValidProfile(a)&&(ea.apply(a,this.qualitySettings),
this._set("qualityProfile",a))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"slicePlane",{set:function(a){this._stage.renderView.setRenderParameters({slicePlane:a});if(a){var c=this.propertiesPool.get("slicePlane");na.boundedPlane.copy(a,c);this._set("slicePlane",c)}else this._set("slicePlane",null)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"resolution",{get:function(){return null!=this.spatialReference?H.getResolutionForScale(this.scale,this.spatialReference):
0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"heightModelInfo",{get:function(){var a=this.getDefaultHeightModelInfo();return null!=a?E.deriveUnitFromSR(a,this.spatialReference):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){var a=0,c=0,d=!1;this.allLayerViews.forEach(function(e){e.isFulfilled()?e.updating&&(d=!0,e.suspended||(++c,a="updatingProgress"in e?a+e.updatingProgress:a+.5)):++c});for(var e=0,f=[this.graphicsView,this.basemapView,
this.basemapTerrain,this.layerViewManager,this._resourceController,this._stage&&this._stage.renderView,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.updatingHandles,this.featureTreeDebugger];e<f.length;e++){var b=f[e];w.isSome(b)&&b.updating&&(c+=.1,a+=.05)}e=0;for(f=[this.deconflictor,this.labeler];e<f.length;e++)b=f[e],w.isSome(b)&&b.updating&&(++c,a+=b.updatingProgress);(d=!!(d||0<c||!this.ready||!this.stationary||this._createGraphicsViewController||this.inputManager&&
this.inputManager.hasPendingInputs||this.map&&this.map.allLayers&&this.map.allLayers.some(function(a){return!a.isFulfilled()})))?(this._numUpdating=Math.max(c,this._numUpdating),a+=this._numUpdating-c):this._numUpdating=0;a=0<this._numUpdating?a/this._numUpdating:d?.5:1;this._get("updatingProgress")!==a&&(b=this._resourceController.scheduler.now,1>a&&(e=Math.min((b-this._lastUpdateTime)/2E3,1),a=this.updatingProgress*(1-e)+a*e),this._set("updatingProgress",a),this._lastUpdateTime=d&&1>a?b:0);return d},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewingMode",{get:function(){var a=this.get("map.initialViewProperties.viewingMode"),c=this.spatialReference;a||(a=!c||ya.isSpatialReferenceSupported(c,"global")?"global":"local");return a},set:function(a){this.ready?pa.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(a)?this._override("viewingMode",a):void 0===a&&this._clearOverride("viewingMode")},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"resourceController",{get:function(){return this._resourceController},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"performanceInfo",{get:function(){return new ha(this)},enumerable:!0,configurable:!0});b.prototype.on=function(a,c,d,e){var f=this.viewEvents.on(a,c,d,e);return f?f:this.inherited(arguments)};b.prototype.hasEventListener=function(a){return this.inherited(arguments)||this.viewEvents.hasHandler(a)};b.prototype.toMap=function(a,c){if(!this.ready)return pa.error("#toMap()",
"Scene view cannot be used before it is ready"),null;c=c?this._externalToInternalIntersectOptions(c):this._defaultToMapOptions;var d=w.isSome(c.graphics)&&(w.isSome(c.graphics.include)||w.isSome(c.graphics.exclude));a=A.isSupportedScreenPointEvent(a)?A.createScreenPointFromSupportedEvent(this,a):a;var e=A.screenPointObjectToArray(a);c.enableDraped=c.include&&!c.include.has(sa.TERRAIN_ID)||c.exclude&&c.exclude.has(sa.TERRAIN_ID);var f=this.sceneIntersectionHelper;a=new ua.Intersector(this.viewingMode);
a.options.selectionMode=!0;a.options.store=d?2:0;f.intersectIntersectorScreen(e,a,c);if(d){d=0;for(a=a.results.all;d<a.length;d++)if(e=a[d],f=e.toGraphic(this),w.isNone(f)||this._testGraphicUidFilter(c.graphics,f))return this._intersectResultToMapPoint(e);return null}return this._intersectResultToMapPoint(a.results.min)};b.prototype.toScreen=function(a){if(!this.ready)return pa.error("#toScreen()","Scene view cannot be used before it is ready"),null;var c=null==a.z&&fa.getElevationAtPoint(this.elevationProvider,
a)||0;ka.pointToVector(a,ra,this.renderSpatialReference,c);return this.engineToScreen(ra)};b.prototype.pixelSizeAt=function(a){if(!this.ready)return pa.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!a)return 0;ka.pointToVector(a,ra,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(ra)};b.prototype.hitTest=function(a,c){if(!this.ready)return pa.error("#hitTest()","Scene view cannot be used before it is ready"),null;a=A.isSupportedScreenPointEvent(a)?
A.createScreenPointFromSupportedEvent(this,a):a;var d=A.createScreenPointArray(a.x,a.y),e=c?this._externalToInternalIntersectOptions(c):this._defaultHitTestOptions;e.terrainLocationFeedbackEnabled=!0;e.enableDraped=!0;c=new ua.Intersector(this.viewingMode);c.options.selectionMode=!0;c.options.store=2;this.sceneIntersectionHelper.intersectIntersectorScreen(d,c,e);var d=this._intersectResultsToHits(c.results.all,e.graphics),e=c.results.ground,f=e.toOwner(this),f=w.isSome(f)&&"type"in f&&"integrated-mesh"===
f.type?f:null;a={screenPoint:a,results:d,ground:{mapPoint:this._intersectResultToMapPoint(e),distance:e.hasIntersectionPoint?e.distanceInRenderSpace:0,layer:f}};Z.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(a.intersector=c);return v.resolve(a)};b.prototype.popupHitTest=function(a){return this.hitTest(a).then(function(c){for(var d=[],e=c.results.length?c.results[0].distance:0,f=0,b=c.results;f<b.length;f++){var h=b[f];if(h.distance!==e)break;d.push(h)}f=null;!(0===d.length||1E-5>Math.abs(e-c.ground.distance))||
c.ground.layer&&"integrated-mesh"===c.ground.layer.type||(f=c.ground.mapPoint);return{results:d,screenPoint:a,mapPoint:f}})};b.prototype.goTo=function(a,c){return this.stateManager.goTo(a,c)};b.prototype.whenLayerView=function(a){return this.inherited(arguments)};b.prototype.takeScreenshot=function(a){var c=this;return this.whenReady().then(function(){var d=xa.toRenderSettings(a,c);d.pixelRatio/=c.pixelRatio;return c._stage.renderView.takeScreenshot(xa.screenshotSuperSampleSettings(d,c.supersampleScreenhotsEnabled,
c.padding))})};b.prototype.importLayerView=function(a){return P.layerView3DImporter.importLayerView(a)};b.prototype.hasLayerViewModule=function(a){return P.layerView3DImporter.hasLayerViewModule(a)};b.prototype.forceDOMReadyCycle=function(){this.forceReadyCycle()};b.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||
null};b.prototype.validate=function(){var a=Ea.check();r("safari")&&9>r("safari")&&(a=new t("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:r("safari")}));return a?(pa.warn("#validate()",a.message),v.reject(a)):L.loadArcade().then(function(){},function(){})};b.prototype.isSpatialReferenceSupported=function(a,c,d){var e=a.isGeographic,f=a.isWebMercator,b=ya.isSpatialReferenceSupported(a,"global"),h="local"===
this.viewingMode,l=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(l){if(h&&e)return d&&d("Layer "+c.id+" is ignored because it is GCS and viewing mode is local"),!1;if(!h&&!b)return d&&d("Layer "+c.id+" is ignored because its spatial reference is not supported in global viewing mode"),!1}else if(e&&!b)return d&&d("Layer "+c.id+" is ignored because its spatial reference is geographic but unsupported"),!1;if(c)if(I.isTiledLayer(c)){if(e=void 0,l?l=va.getTiledLayerInfo(c,
a,this.viewingMode):(l=va.getTiledLayerInfo(c,a,"global"),null==l.tileInfo&&(l=va.getTiledLayerInfo(c,a,"local"),null!=l.tileInfo&&f&&!this.ready&&(this.viewingMode="local"))),e=null!=l.tileInfo,!e)return d&&d("Layer "+c.id+" is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode"),!1}else if((a.isWGS84||f)&&!h)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=a),l||this.ready||(this.viewingMode=
"global",d&&d("Viewing mode locked to global due to reprojectable layer "+c.id)),d&&d("Layer "+c.id+" is ignored because it supports server-side reprojection"),!1;return!0};b.prototype.whenReady=function(){var a=this;return v.create(function(c){a.ready?c(a):a._resolveWhenReady.push(c)})};b.prototype.computeMapPointFromVec3d=function(a,c){var d=this.spatialReference||h.SpatialReference.WGS84;ka.vectorToVector(a,this.renderSpatialReference,a,d)||(d=h.SpatialReference.WGS84,ka.vectorToVector(a,this.renderSpatialReference,
a,d));c?(c.x=a[0],c.y=a[1],c.z=a[2],c.spatialReference=d):c=new h.Point(a,d);return c};b.prototype.engineToScreen=function(a,c){var d=A.createRenderScreenPointArray3();this.state.camera.projectPoint(a,d);a=A.screenPointArrayToObject(d);return A.renderToScreen(this,a,c)};b.prototype.flushDisplayModifications=function(){this._stage.processDirty()};b.prototype.trackGraphicState=function(a){if(!a.graphic)return pa.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),
null;var c=this.getViewForGraphic(a.graphic),d=null,e=!1,f=function(c){!e&&w.isSome(c)&&"graphics3d"in c&&c.graphics3d&&c.graphics3d.graphicsCore&&(d=c.graphics3d.graphicsCore.trackGraphicState(a))};w.isSome(c)?f(c):this.whenViewForGraphic(a.graphic,{waitForLayer:!0}).then(function(a){return f(a)},function(){}).catch(function(){});return{remove:function(){e=!0;w.isSome(d)&&(d.remove(),d=null)}}};b.prototype.maskOccludee=function(a){if(!a)return pa.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),
null;var c=this.getViewForGraphic(a),d=null,e=!1,f=function(c){!e&&w.isSome(c)&&"graphics3d"in c&&Da.occludeesSupported(c)&&(d=c.occlude(a))};w.isSome(c)?f(c):this.whenViewForGraphic(a,{waitForLayer:!0}).then(function(a){return f(a)},function(){}).catch(function(){});return{remove:function(){e=!0;w.isSome(d)&&(d.remove(),d=null)}}};b.prototype.getViewForGraphic=function(a){return a.layer===this.graphics?this.graphicsView:a.layer?this.allLayerViews.find(function(c){return c.layer===a.layer}):null};
b.prototype.graphicChanged=function(a){w.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(a)};b.prototype.whenViewForGraphic=function(a,c){return e(this,void 0,void 0,function(){var d=this;return g(this,function(e){switch(e.label){case 0:return a.layer!==this?[3,2]:[4,y.whenOnce(this,"graphicsView")];case 1:return e.sent(),[2,this.graphicsView];case 2:if(!a.layer||!this.map)throw new t("no-view-for-graphic");return c&&c.waitForLayer&&!this.map.allLayers.includes(a.layer)?[2,v.create(function(c,
e){var f=d.map.allLayers.on("change",function(b){-1!==b.added.indexOf(a.layer)&&(f.remove(),d.whenLayerView(a.layer).then(c,e))})})]:[2,this.whenLayerView(a.layer)]}})})};b.prototype._intersectResultToMapPoint=function(a,c){if(a.getIntersectionPoint(ra)){c=this.computeMapPointFromVec3d(ra,c);var d=this.basemapTerrain;"TerrainRenderer"===a.intersector&&d&&(c.z=fa.getElevationAtPoint(d,c)||0);return c}return null};b.prototype._intersectResultsToHits=function(a,c){for(var d=[],e=null,f=0;f<a.length;f++){var b=
a[f],h=b.toOwner(this);if(w.isSome(h)&&(h===this.map.ground||"type"in h&&"integrated-mesh"===h.type))break;h=b.toGraphic(this);if(w.isSome(h)){w.isNone(e)&&f!==a.length-1&&(e=new Set);if(w.isSome(e)){var l=this._getGraphicFilterUid(h);if(e.has(l))continue;e.add(l)}this._testGraphicUidFilter(c,h)&&(l=this._intersectResultToMapPoint(b),d.push({graphic:h,mapPoint:l,distance:b.distanceInRenderSpace}))}}return d};b.prototype._getGraphicFilterUid=function(a){if(a.layer&&"objectIdField"in a.layer){var c=
a.attributes[a.layer.objectIdField];if(c)return"o-"+a.layer.id+"-"+c}return"u-"+a.uid};b.prototype._testGraphicUidFilter=function(a,c){c=this._getGraphicFilterUid(c);return w.isNone(a)||(w.isNone(a.include)||a.include.has(c))&&(w.isNone(a.exclude)||!a.exclude.has(c))};b.prototype._externalToInternalRenderItems=function(c,e,f){var b=this;void 0===f&&(f={layerUids:null,graphicUids:null});if(!c)return f;c instanceof d?(Ga(f,this._getGraphicFilterUid(c)),0===e&&(w.isSome(this.graphicsView)&&c.layer===
this?ta(f,this.graphicsView.mockLayerId):c.layer&&ta(f,c.layer.uid))):"forEach"in c?c.forEach(function(c){Array.isArray(c)?b._externalToInternalRenderItems(c,e,f):q.isCollection(c)?c===b.graphics&&w.isSome(b.graphicsView)?ta(f,b.graphicsView.mockLayerId):b._externalToInternalRenderItems(c,e,f):c instanceof a?c===b.map.ground&&ta(f,sa.TERRAIN_ID):b._externalToInternalRenderItems(c,e,f)}):ta(f,c.uid);return f};b.prototype._externalToInternalIntersectOptions=function(a){var c=this._externalToInternalRenderItems(a.include,
0);a=this._externalToInternalRenderItems(a.exclude,1);return{include:c.layerUids,exclude:a.layerUids,graphics:{include:c.graphicUids,exclude:a.graphicUids}}};b.prototype._viewingModeToManifold=function(a){switch(a){case "global":return"spherical";case "local":return"planar"}};b.prototype._initBasemapTerrain=function(a){this._set("basemapTerrain",new Ba({view:this,manifold:this._viewingModeToManifold(a)}));this._set("elevationProvider",new W.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",
this.basemapTerrain)};b.prototype._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))};b.prototype._initGlobe=function(a){var c=this;this._initCoordinateSystem();this._set("state",new da.default({viewingMode:this.viewingMode,spatialReference:this.spatialReference}));this._initBasemapTerrain(a);this._set("pointsOfInterest",
new wa.default({view:this}));this._set("featureTiles",new aa.default({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler}));a=function(){var a=c.basemapTerrain&&c.basemapTerrain.extent;c.clippingArea||a?a&&c.basemapTerrain.spatialReference?(a=G.toExtent(c.basemapTerrain.extent,c.basemapTerrain.spatialReference),c.featureTiles.filterExtent=
c.clippingArea?a.intersection(c.clippingArea):a):c.featureTiles.filterExtent=c.clippingArea:c.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(Z,"FEATURE_TILE_TREE_SHOW_TILES",function(a){a&&c.featureTiles&&!c.featureTreeDebugger?c.updatingHandles.addPromise(new Promise(function(a,c){n(["./3d/layers/support/FeatureTileTree3DDebugger"],a,c)})).then(function(a){a=a.FeatureTileTree3DDebugger;!c.featureTreeDebugger&&Z.FEATURE_TILE_TREE_SHOW_TILES&&(c.featureTreeDebugger=new a({view:c}))}):
a||!c.featureTreeDebugger||Z.FEATURE_TILE_TREE_SHOW_TILES||(c.featureTreeDebugger.destroy(),c.featureTreeDebugger=null)},3),this.updatingHandles.add(this,"clippingArea",a,3),this.updatingHandles.add(this,"basemapTerrain.extent",a,3)],"feature-tiles");this.stateManager.init()};b.prototype._exitGlobe=function(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),
this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.destroy(),this._set("state",null),this._exitCoordinateSystem())};b.prototype._initCoordinateSystem=function(){var a=this;if(this.spatialReference){var c=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(c)||this._set("mapCoordsHelper",new oa.default(this.map,c));var d="global"===this.viewingMode,c=d?ka.SphericalECEFSpatialReference:c;c!==this.renderSpatialReference&&(this._set("renderCoordsHelper",
ja.RenderCoordsHelper.createMode(this.viewingMode,c)),d||this.handles.add(this.watch("basemapTerrain.extent",function(c){if(0!==c[0]||0!==c[1]||0!==c[2]||0!==c[3])a.renderCoordsHelper.extent=c},!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(ua.Intersector.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)};b.prototype._exitCoordinateSystem=function(){this.mapCoordsHelper&&
(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))};b.prototype.updatingChanged=function(){this.notifyChange("updating")};b.prototype._updateUpdatingMonitors=function(){var a=this;this.handles.remove("updatingMonitors");this.allLayerViews.forEach(function(c){c.destroyed||(a.handles.add([c.watch(["updating","updatingProgress"],function(){return a.updatingChanged()},!0)],"updatingMonitors"),c.when(function(){return a.updatingChanged()},
function(){return a.updatingChanged()}))});this.updatingChanged()};b.prototype._renderScreenshotOverlay=function(a,c){if(this.overlay&&this.overlay.hasVisibleItems){var d=a.getContext("2d");d.putImageData(c,0,0);this.overlay.renderCanvas(a);a=d.getImageData(0,0,c.width,c.height);for(d=0;d<a.data.length;d++)c.data[d]=a.data[d]}};b.prototype._initStage=function(){var a=this,c={renderContext:this.renderContext,deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,
viewingMode:this.viewingMode,alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:function(c,d){return a._renderScreenshotOverlay(c,d)}}},d=new ba.SceneIntersectionHelper(this.viewingMode,{forEachLayer:function(c){a._stage.getLayers().forEach(c)}},this);this._set("sceneIntersectionHelper",d);var e=p.byId(this.surface);this._stage=new Ca.Stage({viewingMode:this.viewingMode,container:e,options:c,sceneIntersectionHelper:d});this._lostWebGLContextHandle=u.on(this._stage.renderView.getCanvas(),
"webglcontextlost",function(){return a.fatalError=new t("webgl-context-lost")});this.handles.add(this.updatingHandles.add(this.qualitySettings,"antialiasingEnabled",function(){a._stage.renderView.setRenderParameters({antialiasingEnabled:a.qualitySettings.antialiasingEnabled})},2),"stage");c=function(){a._stage.renderView.setRenderParameters({defaultHighlightOptions:la.toEngineOptions(a.highlightOptions)})};d=0;for(e=["highlightOptions","highlightOptions.color","highlightOptions.haloColor","highlightOptions.haloOpacity",
"highlightOptions.fillOpacity"];d<e.length;d++)this.handles.add(this.updatingHandles.add(this,e[d],c),"stage");c();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(ua.Intersector.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.getCanvas())};b.prototype._exitStage=function(){this._set("sceneIntersectionHelper",null);this._stage.destroy();this._stage=null;this._lostWebGLContextHandle.remove();this._lostWebGLContextHandle=null;this.handles.remove("stage");
this._set("canvas",null)};b.prototype._initSurface=function(){this._exitSurface();this._initStage();this._initGlobe(this.viewingMode);this.sharedSymbolResources=new qa.default({stage:this._stage,viewingMode:this.viewingMode,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new R.ObjectResourceCache})};b.prototype._exitSurface=function(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),
this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};b.prototype._createGraphicsViewIfNeeded=function(){var a=this;if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");this._createGraphicsViewController=v.createAbortController();var c=function(){a._createGraphicsViewController=null;a.updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(c,c);this.updatingChanged()}};b.prototype._createGraphicsViewAsync=
function(a){return e(this,void 0,void 0,function(){var c;return g(this,function(d){switch(d.label){case 0:return[4,v.create(function(a){return n(["./3d/layers/GraphicsView3D"],a)})];case 1:return c=d.sent(),v.throwIfAborted(a),[4,y.whenTrueOnce(this.basemapTerrain,"ready",a)];case 2:return d.sent(),this._set("graphicsView",new c({view:this})),[2]}})})};b.prototype._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=
null);this.handles.remove("graphics-view");w.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.mockLayerId),this.graphicsView.destroy(),this._set("graphicsView",null))};b.prototype._startup=function(){var a=this;"global"===this.viewingMode&&(this._clippingArea=null);this._set("ready",!0);this._initSurface();this.handles.add(y.on(this,"graphics","after-changes",function(){return a._createGraphicsViewIfNeeded()}),"graphics-view");this._createGraphicsViewIfNeeded();if(!this._externallySet.environment){var c=
this.get("map.initialViewProperties.environment");c&&(this.environment=c)}this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();c=this._resolveWhenReady;this._resolveWhenReady=[];c.forEach(function(c){return c(a)})};b.prototype._teardown=function(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.handles.remove("graphics-view");this._exitSurface();
this._set("ready",!1)};b.prototype._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(sa.TERRAIN_ID);for(var a=0,c=this.map.allLayers.items;a<c.length;a++){var d=c[a];"integrated-mesh"===d.type&&this._defaultToMapOptions.include.add(d.uid)}}};b.prototype._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(sa.TERRAIN_ID);
for(var a=0,c=this.map.allLayers.items;a<c.length;a++){var d=c[a];"integrated-mesh"===d.type&&1>d.opacity&&this._defaultToMapOptions.exclude.add(d.uid)}}};k([B.property()],b.prototype,"_resourceController",void 0);k([B.property()],b.prototype,"_stage",void 0);k([B.property({readOnly:!0})],b.prototype,"deconflictor",void 0);k([B.property({readOnly:!0})],b.prototype,"labeler",void 0);k([B.property({type:T,readOnly:!0,aliasOf:"state.animation"})],b.prototype,"animation",void 0);k([B.property({readOnly:!0})],
b.prototype,"basemapTerrain",void 0);k([B.property({readOnly:!0})],b.prototype,"elevationProvider",void 0);k([B.property({type:l,aliasOf:"stateManager.camera"})],b.prototype,"camera",void 0);k([B.property({readOnly:!0})],b.prototype,"canvas",void 0);k([B.property({type:h.Point,aliasOf:"stateManager.center"})],b.prototype,"center",void 0);k([B.property({type:h.Extent,dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"]})],b.prototype,"clippingArea",null);k([B.property({type:S.default})],
b.prototype,"constraints",void 0);k([B.property({type:h.Extent,dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],b.prototype,"dataExtent",null);k([B.property({value:null,type:V})],b.prototype,"environment",null);k([B.cast("environment")],b.prototype,"castEnvironment",null);k([B.property({readOnly:!0})],b.prototype,"environmentManager",void 0);k([B.property({type:h.Extent,aliasOf:"stateManager.extent"})],b.prototype,"extent",void 0);k([B.property({readOnly:!0,aliasOf:"stateManager.screenCenter"})],
b.prototype,"screenCenter",void 0);k([B.property({type:Number,dependsOn:["maximumPixelRatio"]})],b.prototype,"pixelRatio",null);k([B.property({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"]})],b.prototype,"maximumPixelRatio",null);k([B.property({aliasOf:"stateManager.frustum"})],b.prototype,"frustum",void 0);k([B.property({type:Number,readOnly:!0})],b.prototype,"fullOpacity",void 0);k([B.property({readOnly:!0})],b.prototype,"graphicsView",
void 0);k([B.property({type:h.Extent,dependsOn:["basemapTerrain.extent"],readOnly:!0})],b.prototype,"groundExtent",null);k([B.property()],b.prototype,"groundView",void 0);k([B.property({type:Boolean,dependsOn:["stateManager.hasInitialView"]})],b.prototype,"initialExtentRequired",null);k([B.property({type:Boolean,dependsOn:["navigating","activeTool"],readOnly:!0})],b.prototype,"interacting",null);k([B.property({type:Boolean,dependsOn:["state.navigating"],readOnly:!0})],b.prototype,"navigating",null);
k([B.property()],b.prototype,"map",void 0);k([B.property({readOnly:!0})],b.prototype,"mapCoordsHelper",void 0);k([B.property({aliasOf:"stateManager.padding"})],b.prototype,"padding",void 0);k([B.property({type:wa.default,readOnly:!0})],b.prototype,"pointsOfInterest",void 0);k([B.property({type:aa.default,readOnly:!0})],b.prototype,"featureTiles",void 0);k([B.property()],b.prototype,"featureTreeDebugger",void 0);k([B.property({type:Boolean})],b.prototype,"screenSizePerspectiveEnabled",void 0);k([B.property({constructOnly:!0})],
b.prototype,"deactivatedWebGLExtensions",void 0);k([B.property({constructOnly:!0})],b.prototype,"debugWebGLExtensions",void 0);k([B.property({constructOnly:!0})],b.prototype,"renderCanvas",void 0);k([B.property({readOnly:!0})],b.prototype,"state",void 0);k([B.property({readOnly:!0})],b.prototype,"inputManager",void 0);k([B.property({readOnly:!0})],b.prototype,"stateManager",void 0);k([B.property({type:["low","medium","high"]})],b.prototype,"qualityProfile",null);k([B.property({type:ga,get:function(){var a=
this._get("qualitySettings");a||(a=new ga,ea.apply(this.qualityProfile,a));return a}})],b.prototype,"qualitySettings",void 0);k([B.property()],b.prototype,"slicePlane",null);k([B.property({dependsOn:["viewingMode"]})],b.prototype,"preconditionsReady",void 0);k([B.property({readOnly:!0})],b.prototype,"renderCoordsHelper",void 0);k([B.property({readOnly:!0})],b.prototype,"sceneIntersectionHelper",void 0);k([B.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],b.prototype,"resolution",
null);k([B.property({type:Number,aliasOf:"stateManager.scale"})],b.prototype,"scale",void 0);k([B.property()],b.prototype,"heightModelInfo",null);k([B.property({dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],b.prototype,"spatialReference",void 0);k([B.property({type:Boolean,constructOnly:!0})],b.prototype,"alphaCompositingEnabled",void 0);k([B.property({type:Boolean})],b.prototype,"supersampleScreenhotsEnabled",void 0);k([B.property({readOnly:!0})],
b.prototype,"type",void 0);k([B.property({type:za})],b.prototype,"ui",void 0);k([B.property({type:Boolean,readOnly:!0,dependsOn:"_resourceController.updating labeler.updating layerViewManager.updating deconflictor.updating environmentManager.updating inputManager.hasPendingInputs basemapView.updating basemapTerrain.updating featureTiles.updating pointsOfInterest.updating graphicsView.updating _stage.renderView.updating ready stationary overlay.updating updatingHandles.updating featureTreeDebugger.updating".split(" ")})],
b.prototype,"updating",null);k([B.property({type:Number,readOnly:!0,dependsOn:["updating"]})],b.prototype,"updatingProgress",void 0);k([B.property({type:["global","local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],b.prototype,"viewingMode",null);k([B.property({type:c,aliasOf:"stateManager.viewpoint"})],b.prototype,"viewpoint",void 0);k([B.property({type:Number,aliasOf:"stateManager.zoom"})],b.prototype,"zoom",void 0);k([B.property({type:la})],b.prototype,"highlightOptions",
void 0);return b=k([B.subclass("esri.views.SceneView")],b)}(B.declared(O.BreakpointsOwner(K.DOMContainer(Q.PopupView(M)))));var ra=F.vec3f64.create();return b})},"esri/geometry/support/scaleUtils":function(){define(["require","exports","../../core/unitUtils"],function(n,b,m){function k(b,e){e=m.getMetersPerUnitForSR(e);return b/(e*m.inchesPerMeter*96)}Object.defineProperty(b,"__esModule",{value:!0});b.getScale=function(b,e){e=e||b.extent;b=b.width;var f=m.getMetersPerUnitForSR(e&&e.spatialReference);
return e&&b?e.width/b*f*m.inchesPerMeter*96:0};b.getResolutionForScale=k;b.getScaleForResolution=function(b,e){e=m.getMetersPerUnitForSR(e);return b*e*m.inchesPerMeter*96};b.getExtentForScale=function(b,e){var f=b.extent;b=b.width;e=k(e,f.spatialReference);return f.clone().expand(e*b/f.width)}})},"esri/layers/support/layerUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.isTiledLayer=function(b){return b&&"base-tile"===b.type||"tile"===
b.type||"elevation"===b.type||"base-elevation"===b.type||"open-street-map"===b.type||"web-tile"===b.type||"wmts"===b.type||"vector-tile"===b.type};b.serializeLayerDefinitions=function(b){var k=/[:;]/,g=[],e=!1;if(b&&(b.forEach(function(f,d){g.push([d,f]);!e&&k.test(f)&&(e=!0)}),0<g.length)){b=void 0;if(e){var f={};g.forEach(function(e){f[e[0]]=e[1]});b=JSON.stringify(f)}else{var l=[];g.forEach(function(e){l.push(e[0]+":"+e[1])});b=l.join(";")}return b}return null};b.serializeTimeOptions=function(b){if(b){var k=
[];b.forEach(function(b,e){k.push('"'+e+'":'+JSON.stringify(b))});if(k.length)return"{"+k.join(",")+"}"}};b.getLayersForScale=function(b,k){var g=[];if(0<b&&k)for(var e=function(e){if(0<=k[e].parentLayerId&&-1===g.indexOf(k[e].parentLayerId)&&k.some(function(a){return a.id===k[e].parentLayerId}))return"continue";if(0<=k[e].id){var f=!0,d=k[e].maxScale,a=k[e].minScale;if(0<d||0<a)0<d&&0<a?f=d<=b&&b<=a:0<d?f=d<=b:0<a&&(f=b<=a);f&&g.push(k[e].id)}},f=0;f<k.length;f++)e(f);return g};b.areLabelsVisible=
function(b){return!0===b.labelsVisible&&null!=b.labelingInfo&&0<b.labelingInfo.length}})},"esri/views/BreakpointsOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators".split(" "),function(n,b,m,k,g,e,f,l,h){function d(c,d){return d?a[c].valueToClassName[d].split(" "):[]}Object.defineProperty(b,"__esModule",{value:!0});var a=
{widthBreakpoint:{getValue:function(a){var c=a.viewSize[0];a=a.breakpoints;var d=this.values;return c<=a.xsmall?d.xsmall:c<=a.small?d.small:c<=a.medium?d.medium:c<=a.large?d.large:d.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},
heightBreakpoint:{getValue:function(a){var c=a.viewSize[1];a=a.breakpoints;var d=this.values;return c<=a.xsmall?d.xsmall:c<=a.small?d.small:c<=a.medium?d.medium:c<=a.large?d.large:d.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},
orientation:{getValue:function(a){a=a.viewSize;var c=this.values;return a[1]>=a[0]?c.portrait:c.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},c={xsmall:544,small:768,medium:992,large:1200};b.BreakpointsOwner=function(b){return function(b){function p(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];a=b.apply(this,a)||this;a._breakpointsHandles=new f;a.orientation=null;
a.widthBreakpoint=null;a.heightBreakpoint=null;a.breakpoints=c;return a}m(p,b);p.prototype.initialize=function(){this._breakpointsHandles.add(l.init(this,["breakpoints","size"],this._updateClassNames))};p.prototype.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};Object.defineProperty(p.prototype,"breakpoints",{set:function(a){var d=this._get("breakpoints");if(a!==d){d=(d=a)&&d.xsmall<d.small&&d.small<d.medium&&d.medium<
d.large;if(!d){var e=JSON.stringify(c,null,2);console.warn("provided breakpoints are not valid, using defaults:"+e)}a=d?a:c;this._set("breakpoints",g({},a))}},enumerable:!0,configurable:!0});p.prototype._updateClassNames=function(){if(this.container){var c=e.acquire(),f=e.acquire(),b=!1,h;for(h in a){var l=this[h],g=a[h].getValue({viewSize:this.size,breakpoints:this.breakpoints});l!==g&&(b=!0,this[h]=g,d(h,l).forEach(function(a){return f.push(a)}),d(h,g).forEach(function(a){return c.push(a)}))}b&&
(this._applyClassNameChanges(c,f),e.release(c),e.release(f))}};p.prototype._applyClassNameChanges=function(a,c){var d=this.container;d&&(c.forEach(function(a){return d.classList.remove(a)}),a.forEach(function(a){return d.classList.add(a)}))};p.prototype._removeActiveClassNames=function(){var c=this.container;if(c)for(var e in a)d(e,this[e]).forEach(function(a){return c.classList.remove(a)})};k([h.property()],p.prototype,"breakpoints",null);k([h.property()],p.prototype,"orientation",void 0);k([h.property()],
p.prototype,"widthBreakpoint",void 0);k([h.property()],p.prototype,"heightBreakpoint",void 0);return p=k([h.subclass("esri.views.BreakpointsOwner")],p)}(h.declared(b))}})},"esri/views/GroundView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/Collection ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./support/GroundViewElevationSampler".split(" "),function(n,b,m,k,g,e,f,l,h,d){return function(a){function c(c){c=
a.call(this,c)||this;c.handles=new f;c.view=null;c.layerViews=new e;return c}m(c,a);c.prototype.initialize=function(){var a=this;this.handles.add(l.when(this,"view.map.ground",function(a){return a.load()}));this.handles.add(this.layerViews.on("after-changes",function(){return a.layerViewsAfterChangesHandler()}))};c.prototype.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};Object.defineProperty(c.prototype,"elevationSampler",{get:function(){return this.view&&
"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new d({view:this.view}):null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"updating",{get:function(){return this.suspended?!1:this.layerViews.some(function(a){return a.updating})},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"suspended",{get:function(){return!this.view||this.view.suspended},enumerable:!0,configurable:!0});c.prototype.layerViewsAfterChangesHandler=
function(){var a=this;this.handles.remove("updating");this.handles.add(this.layerViews.map(function(c){return c.watch("updating",function(){return a.updateUpdating()},!0)}).toArray(),"updating");this.updateUpdating()};c.prototype.updateUpdating=function(){this.notifyChange("updating")};k([h.property({readOnly:!0,dependsOn:["view.ready","view.basemapTerrain?.ready"]})],c.prototype,"elevationSampler",null);k([h.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],c.prototype,"updating",null);
k([h.property({constructOnly:!0})],c.prototype,"view",void 0);k([h.property({type:e,readOnly:!0})],c.prototype,"layerViews",void 0);k([h.property({readOnly:!0,dependsOn:["view.suspended"]})],c.prototype,"suspended",null);return c=k([h.subclass("esri.views.GroundView")],c)}(h.declared(g))})},"esri/views/support/GroundViewElevationSampler":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../layers/support/ElevationSampler ../3d/support/ElevationProvider ../3d/terrain/TerrainConst".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){var p=e.getLogger("esri.views.support.GroundViewElevationSampler");return function(e){function b(a){a=e.call(this,a)||this;a.demResolution={min:-1,max:-1};a.noDataValue=q.ELEVATION_NODATA_VALUE;return a}m(b,e);b.prototype.initialize=function(){var a=this;this.view.basemapTerrain.on("elevation-change",function(){return a.emit("changed",{})})};Object.defineProperty(b.prototype,"extent",{get:function(){var a=this.view.basemapTerrain;return a.extent&&a.spatialReference?
l.toExtent(a.extent,a.spatialReference):null},enumerable:!0,configurable:!0});b.prototype.elevationAt=function(a){var e=a.spatialReference,f=this.spatialReference;if(!d.canProject(e,f))return p.error("Cannot sample elevation at a location with spatial reference ("+(e?e.wkid:"unknown")+") different from the view ("+f.wkid+")"),null;h.extentContainsPoint(this.extent,a)||(e=this.extent,p.warn("#elevationAt()","Point used to sample elevation ("+a.x+", "+a.y+") is outside of the sampler extent ("+(e.xmin+
", "+e.ymin+", "+e.xmax+", "+e.ymax)+")"));return c.getElevationAtPoint(this.view.elevationProvider,a)};b.prototype.queryElevation=function(c){return a.updateGeometryElevation(c.clone(),this)};k([f.property({readOnly:!0})],b.prototype,"demResolution",void 0);k([f.property({readOnly:!0,dependsOn:["view.basemapTerrain.extent","view.basemapTerrain.spatialReference"]})],b.prototype,"extent",null);k([f.property({readOnly:!0})],b.prototype,"noDataValue",void 0);k([f.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],
b.prototype,"spatialReference",void 0);k([f.property({constructOnly:!0})],b.prototype,"view",void 0);return b=k([f.subclass("esri.views.support.GroundViewElevationSampler")],b)}(f.declared(g.EventedAccessor))})},"esri/layers/support/ElevationSampler":function(){define("require exports ../../core/tsSupport/extendsHelper ../../geometry ../../core/compilerUtils ../../core/Logger ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d){function a(a,d){var e=c(a,d.spatialReference);if(!e)return null;switch(a.type){case "point":a.z=d.elevationAt(e)||0;break;case "polyline":t.spatialReference=e.spatialReference;for(var f=a.hasM&&!a.hasZ,b=0;b<a.paths.length;b++)for(var h=a.paths[b],l=e.paths[b],p=0;p<h.length;p++){var k=h[p],q=l[p];t.x=q[0];t.y=q[1];q=d.elevationAt(t)||0;f&&(k[3]=k[2]);k[2]=q}a.hasZ=!0;break;case "multipoint":t.spatialReference=e.spatialReference;f=a.hasM&&!a.hasZ;for(b=0;b<a.points.length;b++)h=
a.points[b],l=e.points[b],t.x=l[0],t.y=l[1],l=d.elevationAt(t)||0,f&&(h[3]=h[2]),h[2]=l;a.hasZ=!0;break;default:g.neverReached(a)}return a}function c(a,c){var e=a.spatialReference;return e.equals(c)?a:d.canProject(e,c)?d.project(a,c):(q.error("Cannot project geometry spatial reference (wkid:"+e.wkid+") to elevation sampler spatial reference (wkid:"+c.wkid+")"),null)}Object.defineProperty(b,"__esModule",{value:!0});var q=e.getLogger("esri.layers.support.ElevationSampler");n=function(){function d(){}
d.prototype.queryElevation=function(c){return a(c.clone(),this)};d.prototype.on=function(){return u};d.prototype.projectIfRequired=function(a,d){return c(a,d)};return d}();b.ElevationSamplerBase=n;var p=function(a){function c(c,d,e){var b=a.call(this)||this;b.tile=c;b.noDataValue=e;b.extent=l.toExtent(c.tile.extent,d.spatialReference);e=f.getMetersPerUnitForSR(d.spatialReference);c=d.lodAt(c.tile.level).resolution*e;b.demResolution={min:c,max:c};return b}m(c,a);Object.defineProperty(c.prototype,"spatialReference",
{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0});c.prototype.contains=function(a){a=this.projectIfRequired(a,this.spatialReference);return h.extentContainsPoint(this.extent,a)};c.prototype.elevationAt=function(a){var c=this.projectIfRequired(a,this.spatialReference);if(!c)return null;if(!this.contains(a)){var d=this.extent;q.warn("#elevationAt()","Point used to sample elevation ("+a.x+", "+a.y+") is outside of the sampler extent ("+(d.xmin+", "+d.ymin+", "+d.xmax+
", "+d.ymax)+")")}return this.tile.sample(c.x,c.y)};return c}(n);b.TileElevationSampler=p;n=function(a){function c(c,d,e){var f=a.call(this)||this,b;"number"===typeof d?(f.noDataValue=d,b=null):(b=d,f.noDataValue=e);f.samplers=b?c.map(function(a){return new p(a,b,f.noDataValue)}):c;if(c=f.samplers[0])for(f.extent=c.extent.clone(),c=c.demResolution,f.demResolution={min:c.min,max:c.max},c=1;c<f.samplers.length;c++)d=f.samplers[c],f.extent.union(d.extent),f.demResolution.min=Math.min(f.demResolution.min,
d.demResolution.min),f.demResolution.max=Math.max(f.demResolution.max,d.demResolution.max);else f.extent=l.toExtent(l.create(),b.spatialReference),f.demResolution={min:0,max:0};return f}m(c,a);Object.defineProperty(c.prototype,"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0});c.prototype.elevationAt=function(a){var c=this.projectIfRequired(a,this.spatialReference);if(!c)return null;for(var d=0,e=this.samplers;d<e.length;d++){var f=e[d];if(f.contains(c))return f.elevationAt(c)}q.warn("#elevationAt()",
"Point used to sample elevation ("+a.x+", "+a.y+") is outside of the sampler");return null};return c}(n);b.MultiTileElevationSampler=n;b.updateGeometryElevation=a;var t=new k.Point,u={remove:function(){}}})},"esri/views/3d/support/ElevationProvider":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.getElevationAtPoint=function(b,k,g){return b.getElevation(k.x,k.y,k.z||0,k.spatialReference,g)}})},"esri/views/3d/terrain/TerrainConst":function(){define("require exports ../../../core/mathUtils ../../../geometry/support/aaBoundingRect ../../../layers/support/TilemapCache ./TilingScheme".split(" "),
function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});b.TILE_LOADING_DEBUGLOG=!1;b.MAX_ROOT_TILES=64;b.MAX_PATCH_TESSELATION=512;b.MAX_MEMORY_LOD_BIAS=2.5;b.ELEVATION_NODATA_VALUE=m.clampFloat32(m.NUMBER_MAX_FLOAT32/10);b.LOADING_LEVEL_MODULO=2;b.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;b.TILEMAP_SIZE=1<<g.TILEMAP_SIZE_EXP;b.WEBMERCATOR_WORLD_EXTENT=k.create();e.WebMercatorAuxiliarySphere.getExtent(0,0,0,b.WEBMERCATOR_WORLD_EXTENT);b.GEOGRAPHIC_WORLD_EXTENT=k.create([-180,-90,180,90]);
b.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";b.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";b.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
b.GEOMETRY_VERTEX_STRIDE=5})},"esri/views/3d/terrain/TilingScheme":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/mathUtils ../../../core/unitUtils ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/support/TileInfo ../support/projectionUtils".split(" "),function(n,b,m,k,g,e,f,l,h,d){var a=d.webMercator.x2lon,c=d.webMercator.y2lat;n=function(){function b(a){var c=b.checkUnsupported(a);if(c)throw c;this.spatialReference=
a.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isWGS84Comparable=d.canProjectToWGS84ComparableLonLat(this.spatialReference);this.origin=[a.origin.x,a.origin.y];this.pixelSize=a.size[0];this.dpi=a.dpi;var e=a.lods.reduce(function(a,c,d){c.level<a.min&&(a.min=c.level,a.minIndex=d);a.max=Math.max(a.max,c.level);return a},{min:Infinity,minIndex:0,max:-Infinity}),f=a.lods[e.minIndex],h=Math.pow(2,f.level),c=f.resolution*h,f=f.scale*h;this.levels=Array(e.max+1);for(e=0;e<
this.levels.length;e++)this.levels[e]={resolution:c,scale:f,tileSize:[c*a.size[0],c*a.size[1]]},c/=2,f/=2}b.prototype.clone=function(){return new b(this.toTileInfo())};b.prototype.toTileInfo=function(){return new h({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(function(a,c){return{level:c,scale:a.scale,resolution:a.resolution}})})};b.prototype.getExtent=
function(d,e,f,b,h){void 0===b&&(b=l.create());var k=this.levels[d];d=k.tileSize[0];k=k.tileSize[1];b[0]=this.origin[0]+f*d;b[2]=b[0]+d;b[3]=this.origin[1]-e*k;b[1]=b[3]-k;h&&(this._isWebMercator?(h[0]=a(b[0]),h[1]=c(b[1]),h[2]=a(b[2]),h[3]=c(b[3])):this._isWGS84Comparable&&(h[0]=g.deg2rad(b[0]),h[1]=g.deg2rad(b[1]),h[2]=g.deg2rad(b[2]),h[3]=g.deg2rad(b[3])));return b};b.prototype.getExtentGeometry=function(a,c,d,e){void 0===e&&(e=new m.Extent);this.getExtent(a,c,d,q);e.spatialReference=this.spatialReference;
e.xmin=q[0];e.ymin=q[1];e.xmax=q[2];e.ymax=q[3];e.zmin=void 0;e.zmax=void 0;return e};b.prototype.ensureMaxLod=function(a){if(null==a)return!1;for(var c=!1;this.levels.length<=a;){var c=this.levels[this.levels.length-1],d=c.resolution/2;this.levels.push({resolution:d,scale:c.scale/2,tileSize:[d*this.pixelSize,d*this.pixelSize]});c=!0}return c};b.prototype.capMaxLod=function(a){this.levels.length>a+1&&(this.levels.length=a+1)};b.prototype.getMaxLod=function(){return this.levels.length-1};b.prototype.scaleAtLevel=
function(a){return this.levels[0].scale/Math.pow(2,a)};b.prototype.levelAtScale=function(a){var c=this.levels[0].scale;return a>=c?0:Math.log(c/a)*Math.LOG2E};b.prototype.resolutionAtLevel=function(a){return this.levels[0].resolution/Math.pow(2,a)};b.prototype.compatibleWith=function(a){if(!(a instanceof b)){if(b.checkUnsupported(a))return!1;a=new b(a)}if(!a.spatialReference.equals(this.spatialReference)||a.pixelSize!==this.pixelSize)return!1;var c=Math.min(this.levels.length,a.levels.length)-1,d=
this.levels[c].resolution,e=.5*d;if(!g.floatEqualAbsolute(a.origin[0],this.origin[0],e)||!g.floatEqualAbsolute(a.origin[1],this.origin[1],e))return!1;e=.5*d/Math.pow(2,c)/this.pixelSize*12;return g.floatEqualAbsolute(d,a.levels[c].resolution,e)};b.prototype.rootTilesInExtent=function(a,c,d){var e=this.levels[0].tileSize;if(0===e[0]||0===e[1])return[];b.computeRowColExtent(a,e,this.origin,q);a=q[1];var f=q[3],h=q[0],l=q[2],g=l-h,k=f-a;g*k>d&&(d=Math.floor(Math.sqrt(d)),k>d&&(a=a+Math.floor(.5*k)-Math.floor(.5*
d),f=a+d),g>d&&(h=h+Math.floor(.5*g)-Math.floor(.5*d),l=h+d));d=[];for(g=a;g<f;g++)for(k=h;k<l;k++)d.push([0,g,k]);c&&(c[0]=this.origin[0]+h*e[0],c[1]=this.origin[1]-f*e[1],c[2]=this.origin[0]+l*e[0],c[3]=this.origin[1]-a*e[1]);return d};b.computeRowColExtent=function(a,c,d,e){var f=.001*(a[2]-a[0]+(a[3]-a[1]));e[0]=Math.floor((a[0]+f-d[0])/c[0]);e[2]=Math.ceil((a[2]-f-d[0])/c[0]);e[1]=Math.floor((d[1]-a[3]+f)/c[1]);e[3]=Math.ceil((d[1]-a[1]-f)/c[1])};b.isPowerOfTwo=function(a){a=a.lods;var c=a[0].resolution*
Math.pow(2,a[0].level);return!a.some(function(a){return!g.floatEqualRelative(a.resolution,c/Math.pow(2,a.level))})};b.hasGapInLevels=function(a){a=a.lods.map(function(a){return a.level});a.sort(function(a,c){return a-c});for(var c=1;c<a.length;c++)if(a[c]!==a[0]+c)return!0;return!1};b.tileSizeSupported=function(a){var c=a.size[1];return c===a.size[0]&&0===(c&c-1)&&128<=c&&512>=c};b.checkUnsupported=function(a){return a?1>a.lods.length?new k("tilingscheme:generic","Tiling scheme must have at least one level"):
b.isPowerOfTwo(a)?b.hasGapInLevels(a)?new k("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):b.tileSizeSupported(a)?null:new k("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new k("tilingscheme:power-of-two","Tiling scheme must be power of two"):new k("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};b.fromExtent=function(a,c){var d=a[2]-a[0],f=a[3]-a[1],l=e.getMetersPerUnitForSR(c),g=1.2*
Math.max(d,f);a=new b(new h({size:[256,256],origin:{x:a[0]-.5*(g-d),y:a[3]+.5*(g-f)},lods:[{level:0,resolution:g/256,scale:1/(256/96*.0254/(g*l))}],spatialReference:c}));a.ensureMaxLod(20);return a};b.makeWebMercatorAuxiliarySphere=function(a){var c=new b(b.WebMercatorAuxiliarySphereTileInfo);c.ensureMaxLod(a);return c};b.makeGCSWithTileSize=function(a,c,d){void 0===c&&(c=256);void 0===d&&(d=16);var e=256/c;a=new b(new h({size:[c,c],origin:{x:-180,y:90,spatialReference:a},spatialReference:a,lods:[{level:0,
resolution:.703125*e,scale:2.95497598570834E8*e}]}));a.ensureMaxLod(d);return a};Object.defineProperty(b.prototype,"test",{get:function(){return{isWebMercator:this._isWebMercator,isWGS84:this._isWGS84Comparable}},enumerable:!0,configurable:!0});b.WebMercatorAuxiliarySphereTileInfo=new h({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:f.WebMercator},spatialReference:f.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});b.WebMercatorAuxiliarySphere=
b.makeWebMercatorAuxiliarySphere(19);return b}();var q=l.create();return n})},"esri/views/PopupView":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/generatorHelper ../core/arrayUtils ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators".split(" "),function(n,b,m,k,g,e,f,l,h,d,a){Object.defineProperty(b,"__esModule",{value:!0});b.PopupView=function(c){return function(c){function b(){return null!==
c&&c.apply(this,arguments)||this}k(b,c);b.prototype.fetchPopupFeatures=function(a,c){return this._fetchPopupFeaturesAsync(a,c)};b.prototype._fetchPopupFeaturesAsync=function(a,c){return e(this,void 0,void 0,function(){var e,b,h,g,k,p,q,u,t;return f(this,function(f){switch(f.label){case 0:return[4,this.when()];case 1:return f.sent(),[4,this._prepareFetchPopupFeatures(a,c)];case 2:return e=f.sent(),b=e.location,h=e.queryArea,g=e.layerViewsAndGraphics,k=e.clientOnlyGraphics,p=d.resolve(k),q=this._queryLayerPopupFeatures({queryArea:h,
layerViewsAndGraphics:g,options:c}),u=q.map(function(a){return a.promise}),t=d.eachAlwaysValues([p].concat(u)).then(l.flatten),[2,{location:b,clientOnlyGraphics:k,allGraphicsPromise:t,promisesPerLayerView:q}]}})})};b.prototype._queryLayerPopupFeatures=function(a){var c=a.queryArea,d=a.options;return a.layerViewsAndGraphics.map(function(a){var e=a.layerView;a={clientGraphics:a.graphics,event:h.isSome(d)?d.event:null,signal:h.isSome(d)?d.signal:null,defaultPopupTemplateEnabled:h.isSome(d)?!!d.defaultPopupTemplateEnabled:
!1};a=e.fetchPopupFeatures(c,a);return{layerView:e,promise:a}})};b.prototype._isValidPopupGraphic=function(a,c){return a&&!!a.getEffectivePopupTemplate(h.isSome(c)&&c.defaultPopupTemplateEnabled)};b.prototype._prepareFetchPopupFeatures=function(a,c){return e(this,void 0,void 0,function(){var d,e,b,h,l,g,k,p;return f(this,function(f){switch(f.label){case 0:return[4,this._popupHitTestGraphics(a,c)];case 1:return d=f.sent(),e=d.clientGraphics,b=d.queryArea,h=d.location,l=this._getFetchPopupLayerViews(),
g=this._graphicsPerFetchPopupLayerView(e,l),k=g.layerViewsAndGraphics,p=g.clientOnlyGraphics,[2,{clientOnlyGraphics:p,layerViewsAndGraphics:k,queryArea:b,location:h}]}})})};b.prototype._popupHitTestGraphics=function(a,c){return e(this,void 0,void 0,function(){var d,e,b,h,l,g,k=this;return f(this,function(f){switch(f.label){case 0:return[4,this.popupHitTest(a)];case 1:return d=f.sent(),e=d.results,b=d.mapPoint,h=e.filter(function(a){return k._isValidPopupGraphic(a.graphic,c)}),l=h.length?h[0].mapPoint:
null,g=h.map(function(a){return a.graphic}),[2,{clientGraphics:g,queryArea:b,location:b||l}]}})})};b.prototype._getFetchPopupLayerViews=function(){var a=this,c=[];this.allLayerViews.forEach(function(d){a._isValidPopupLayerView(d)&&c.push(d)});h.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&c.push(this.graphicsView);return c.reverse()};b.prototype._isValidPopupLayerView=function(a){return h.isSome(a)&&(!("layer"in a)||!a.suspended)&&"fetchPopupFeatures"in a};b.prototype._graphicsPerFetchPopupLayerView=
function(a,c){var d=[],e=new Map;c=c.map(function(a){var c=[];"layer"in a?e.set(a.layer,c):e.set(a.graphics,c);return{layerView:a,graphics:c}});for(var f=0;f<a.length;f++){var b=a[f],h=e.get(b.layer)||null;h?h.push(b):d.push(b)}return{layerViewsAndGraphics:c,clientOnlyGraphics:d}};return b=g([a.subclass("esri.views.PopupView")],b)}(a.declared(c))}})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error","../../core/maybe","@dojo/framework/shim/Promise"],
function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});var g=function(){return new Promise(function(e,d){n(["./layers/TileLayerView3D"],e,d)})},e=function(){return new Promise(function(e,d){n(["./layers/FeatureLayerView3D"],e,d)})},f=function(){return new Promise(function(e,d){n(["./layers/ElevationLayerView3D"],e,d)})},l={"base-dynamic":function(){return new Promise(function(e,d){n(["./layers/DynamicLayerView3D"],e,d)})},"base-elevation":f,"base-tile":g,"bing-maps":g,"building-scene":function(){return new Promise(function(e,
d){n(["./layers/BuildingSceneLayerView3D"],e,d)})},csv:e,elevation:f,feature:e,geojson:e,graphics:function(){return new Promise(function(e,d){n(["./layers/GraphicsLayerView3D"],e,d)})},group:function(){return new Promise(function(e,d){n(["../layers/GroupLayerView"],e,d)})},imagery:function(){return new Promise(function(e,d){n(["./layers/ImageryLayerView3D"],e,d)})},"integrated-mesh":function(){return new Promise(function(e,d){n(["./layers/IntegratedMeshLayerView3D"],e,d)})},"map-image":function(){return new Promise(function(e,
d){n(["./layers/MapImageLayerView3D"],e,d)})},"open-street-map":g,"point-cloud":function(){return new Promise(function(e,d){n(["./layers/PointCloudLayerView3D"],e,d)})},scene:function(e){return null==e.profile||"mesh-pyramids"===e.profile?new Promise(function(d,a){n(["./layers/SceneLayerView3D"],d,a)}):new Promise(function(d,a){n(["./layers/SceneLayerGraphicsView3D"],d,a)})},stream:function(){return new Promise(function(e,d){n(["./layers/StreamLayerView3D"],e,d)})},tile:g,"vector-tile":function(){return new Promise(function(e,
d){n(["./layers/VectorTileLayerView3D"],e,d)})},"web-tile":g,wms:function(){return new Promise(function(e,d){n(["./layers/WMSLayerView3D"],e,d)})},wmts:function(){return new Promise(function(e,d){n(["./layers/WMTSLayerView3D"],e,d)})},"geo-rss":null,"imagery-tile":null,kml:null,"map-notes":null,route:null,unknown:null,unsupported:null};b.layerView3DImporter={hasLayerViewModule:function(e){return k.isSome(l[e.type])},importLayerView:function(e){var d=l[e.type];if(!k.isSome(d))throw e=e.declaredClass?
e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",d=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),new m(d+":view-not-supported",e+" is not supported in 3D");return d(e)}}})},"esri/views/3d/constraints/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ./AltitudeConstraint ./ClipDistanceConstraint ./CollisionConstraint ./TiltConstraint".split(" "),
function(n,b,m,k,g,e,f,l,h,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.tilt=new d.default;c.altitude=new f.default;c.clipDistance=new l.default;c.collision=new h.default;return c}m(c,a);k([e.property({type:d.default})],c.prototype,"tilt",void 0);k([e.property({type:f.default})],c.prototype,"altitude",void 0);k([e.property({type:l.default})],c.prototype,"clipDistance",void 0);k([e.property({type:h.default})],c.prototype,
"collision",void 0);return c=k([e.subclass("esri.views.3d.constraints.Constraints")],c)}(e.declared(g));b.Constraints=n;b.default=n})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/deprecate ../../../core/Logger ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(n,b,m,k,g,e,f,l,h){Object.defineProperty(b,"__esModule",
{value:!0});n=function(d){function a(){var a=null!==d&&d.apply(this,arguments)||this;a.min=h.AltitudeDefault.min;a.max=h.AltitudeDefault.max;return a}m(a,d);Object.defineProperty(a.prototype,"mode",{get:function(){e.deprecated(f.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"});return"manual"},set:function(a){e.deprecated(f.getLogger(this.declaredClass),
"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"})},enumerable:!0,configurable:!0});k([l.property({type:Number})],a.prototype,"min",void 0);k([l.property({type:Number})],a.prototype,"max",void 0);return a=k([l.subclass("esri.views.3d.constraints.AltitudeConstraint")],a)}(l.declared(g));b.AltitudeConstraint=n;b.default=n})},"esri/views/3d/state/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/mathUtils ../../../core/accessorSupport/decorators ../support/earthUtils ../support/mathUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){Object.defineProperty(b,"__esModule",{value:!0});var c=e.getLogger("esri.views.3d.state.Constraints");n=function(d){function e(a){a=d.call(this,a)||this;a.collision=new p;a.distance=Infinity;a.minimumPoiDistance=4;return a}m(e,d);Object.defineProperty(e.prototype,"altitude",{get:function(){return"local"===this.mode?null:this._get("altitude")||null},set:function(a){"local"===this.mode?c.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",a)},
enumerable:!0,configurable:!0});e.prototype.clampAltitude=function(a){return this.altitude?f.clamp(a,this.altitude.min,this.altitude.max):a};e.prototype.clampTilt=function(a,c){if(!this.tilt)return c;a=this.tilt(a);return f.clamp(c,a.min,a.max)};e.prototype.clampDistance=function(a){return Math.min(a,this.distance)};e.prototype.createDefaultTilt=function(){return"local"===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};e.prototype.createConstantMaxTilt=function(a){return function(c,
d){void 0===d&&(d=q);d.min=b.TiltDefault.min;d.max=a;return d}};e.prototype.createDefaultTiltLocal=function(){var c=this.collision.enabled?a.makePiecewiseLinearFunction([[4E3,b.TiltDefault.max],[1E4,l.deg2rad(88)],[6E6,l.deg2rad(88)]]):function(){return b.TiltDefault.max};return function(a,d){void 0===d&&(d=q);d.min=b.TiltDefault.min;d.max=c(a);return d}};e.prototype.createDefaultTiltGlobal=function(){var c=this.collision.enabled?a.makePiecewiseLinearFunction([[4E3,b.TiltDefault.max],[5E4,l.deg2rad(88)],
[6E6,l.deg2rad(88)],[2E7,b.TiltDefault.min]]):a.makePiecewiseLinearFunction([[3E5,b.TiltDefault.max],[3E6,l.deg2rad(88)],[6E6,l.deg2rad(88)],[2E7,b.TiltDefault.min]]);return function(a,d){void 0===d&&(d=q);d.min=b.TiltDefault.min;d.max=c(a);return d}};k([h.property()],e.prototype,"altitude",null);k([h.property({readOnly:!0})],e.prototype,"collision",void 0);k([h.property()],e.prototype,"distance",void 0);k([h.property({readOnly:!0})],e.prototype,"minimumPoiDistance",void 0);k([h.property()],e.prototype,
"tilt",void 0);k([h.property({constructOnly:!0})],e.prototype,"mode",void 0);return e=k([h.subclass("esri.views.3d.state.Constraints")],e)}(h.declared(g));b.Constraints=n;b.AltitudeDefault={min:-2E5,max:4*d.earthRadius};b.TiltDefault={min:l.deg2rad(.5),max:l.deg2rad(179.5)};var q={min:0,max:0},p=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.enabled=!0;c.elevationMargin=5;return c}m(c,a);k([h.property({type:Boolean})],c.prototype,"enabled",void 0);k([h.property({type:Number})],
c.prototype,"elevationMargin",void 0);return c=k([h.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],c)}(h.declared(g));b.default=n})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(f){function b(){var e=
null!==f&&f.apply(this,arguments)||this;e.mode="auto";return e}m(b,f);Object.defineProperty(b.prototype,"near",{get:function(){return this._get("near")},set:function(e){this._set("near",e);e>=this._get("far")&&(this.far=e+1E-9);this.mode="manual"},enumerable:!0,configurable:!0});b.prototype.castNear=function(e){return Math.max(1E-8,e)};Object.defineProperty(b.prototype,"far",{get:function(){return this._get("far")},set:function(e){this._set("far",e);e<=this._get("near")&&(this.near=e-1E-9);this.mode=
"manual"},enumerable:!0,configurable:!0});b.prototype.castFar=function(e){return Math.max(1E-8,e)};b.prototype.autoUpdate=function(e,d){"auto"===this.mode&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==d&&this._set("far",d))};k([e.property({type:Number,value:1E-8})],b.prototype,"near",null);k([e.cast("near")],b.prototype,"castNear",null);k([e.property({type:Number,value:1E-8})],b.prototype,"far",null);k([e.cast("far")],b.prototype,"castFar",null);k([e.property({type:["auto","manual"]})],
b.prototype,"mode",void 0);return b=k([e.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],b)}(e.declared(g));b.ClipDistanceConstraint=n;b.default=n})},"esri/views/3d/constraints/CollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/deprecate ../../../core/Logger ../../../core/accessorSupport/decorators".split(" "),function(n,b,m,k,g,e,f,l){Object.defineProperty(b,
"__esModule",{value:!0});n=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}m(d,b);Object.defineProperty(d.prototype,"enabled",{set:function(a){e.deprecated(f.getLogger(this.declaredClass),"SceneView.constraint.collision.enabled",{replacement:"Map.ground.navigationConstraint",version:"4.8"});this._set("enabled",a)},enumerable:!0,configurable:!0});k([l.property({value:!0})],d.prototype,"enabled",null);return d=k([l.subclass("esri.views.3d.constraints.CollisionConstraint")],d)}(l.declared(g));
b.CollisionConstraint=n;b.default=n})},"esri/views/3d/constraints/TiltConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});var h=e.rad2deg(l.TiltDefault.min),d=e.rad2deg(l.TiltDefault.max);n=function(a){function c(){var c=null!==
a&&a.apply(this,arguments)||this;c.mode="auto";return c}m(c,a);Object.defineProperty(c.prototype,"max",{get:function(){return this._get("max")},set:function(a){this._set("max",a);this.mode="manual"},enumerable:!0,configurable:!0});c.prototype.castMax=function(a){return e.clamp(a,h,d)};c.prototype.autoUpdate=function(a){"auto"===this.mode&&this._get("max")!==a&&this._set("max",a)};k([f.property({type:["auto","manual"]})],c.prototype,"mode",void 0);k([f.property({type:Number,value:d})],c.prototype,
"max",null);k([f.cast("max")],c.prototype,"castMax",null);return c=k([f.subclass("esri.views.3d.constraints.TiltConstraint")],c)}(f.declared(g));b.TiltConstraint=n;b.default=n})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType ./SceneViewAtmosphere ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){return function(a){function b(c){c=a.call(this,c)||this;c.atmosphere=new h.default;return c}m(b,a);q=b;b.fromWebsceneEnvironment=function(a){a=a.cloneConstructProperties();return new q(g({},a,{lighting:d.SceneViewLighting.fromWebsceneLighting(a.lighting)}))};b.prototype.castLighting=function(a){return this.convertLighting(a)};b.prototype.updateLighting=function(a){this.lighting=this.convertLighting(a)};b.prototype.convertLighting=function(a){return a?a instanceof
d.SceneViewLighting?a:a instanceof c?this.lighting?this.lighting.cloneWithWebsceneLighting(a):d.SceneViewLighting.fromWebsceneLighting(a):l.ensureType(d.SceneViewLighting,a):new d.SceneViewLighting};b.prototype.clone=function(){return new q({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:e.clone(this.background)})};var q;k([f.property({type:h.default,json:{read:!1}})],b.prototype,"atmosphere",void 0);
k([f.property()],b.prototype,"lighting",void 0);k([f.cast("lighting")],b.prototype,"castLighting",null);return b=q=k([f.subclass("esri.views.3d.environment.SceneViewEnvironment")],b)}(f.declared(a))})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",
{value:!0});n=function(f){function b(){return null!==f&&f.apply(this,arguments)||this}m(b,f);h=b;Object.defineProperty(b.prototype,"quality",{set:function(d){-1!==["low","high"].indexOf(d)&&this._set("quality",d)},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new h({quality:this.quality})};var h;k([e.property({type:["low","high"],value:"low"})],b.prototype,"quality",null);return b=h=k([e.subclass("esri.views.3d.environment.SceneViewAtmosphere")],b)}(e.declared(g));b.SceneViewAtmosphere=
n;b.default=n})},"esri/views/3d/environment/SceneViewLighting":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(d){function a(a){a=d.call(this,a)||this;a.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};
a.cameraTrackingEnabled=!0;a.ambientOcclusionEnabled=!1;var c=(new Date).getFullYear(),c=new Date("March 15, "+c+" 12:00:00 UTC");a._set("defaultDate",c);a._set("date",c);return a}m(a,d);c=a;a.fromWebsceneLighting=function(a){return new c(g({},a.cloneConstructProperties()))};Object.defineProperty(a.prototype,"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(a){var c=this._get("date")===this._get("defaultDate");a=new Date(a.getTime());this._set("defaultDate",
a);c&&this._set("date",a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"date",{set:function(a){null!=a&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(a.getTime())))},enumerable:!0,configurable:!0});a.prototype.autoUpdate=function(a,c){var d=this._calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=c.hours;this.positionTimezoneInfo.minutes=c.minutes;this.positionTimezoneInfo.seconds=c.seconds;c=null;null!=a&&(this.positionTimezoneInfo.autoUpdated=
!0,c=this.date&&this.date.getTime(),this._set("date",new Date(a.getTime())));var e=this._calculateTimezoneOffset(this.positionTimezoneInfo);d!==e&&(h.target=this,h.timezoneOffset=e,this.emit("timezone-will-change",h));if(null!=a)return c!==a.getTime()};a.prototype.clone=function(){var a=this._get("date")===this._get("defaultDate"),d=new c(g({},this.cloneConstructProperties(),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled}));
a&&d._set("date",d._get("defaultDate"));d.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;d.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;d.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;d.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return d};a.prototype.cloneWithWebsceneLighting=function(a){var c=this.clone();null!=a.date&&(c.date=a.date);c.directShadowsEnabled=a.directShadowsEnabled;c.displayUTCOffset=a.displayUTCOffset;return c};
a.prototype._calculateTimezoneOffset=function(a){return Math.round(a.hours+a.minutes/60+a.seconds/3600)};var c;k([f.property({type:Boolean})],a.prototype,"cameraTrackingEnabled",void 0);k([f.property({type:Boolean})],a.prototype,"ambientOcclusionEnabled",void 0);k([f.property({type:Date})],a.prototype,"defaultDate",null);k([f.property({type:Date})],a.prototype,"date",null);return a=c=k([f.subclass("esri.views.3d.environment.SceneViewLighting")],a)}(f.declared(e.EventedMixin(l)));b.SceneViewLighting=
n;var h={target:null,timezoneOffset:0};b.default=n})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ./EnvironmentRenderer ../support/earthUtils ../support/projectionUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y){Object.defineProperty(b,"__esModule",{value:!0});var A=t.vec3f64.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);n=function(b){function l(){var a=b.call(this)||this;a._referencePointUpdateDelay=200;a._referencePointUpdateInterval=3E3;a._referencePointUpdateDistThreshold=1E6;a._referencePosUpdateQuery=null;a._referencePosMapCoordsRequested=null;a._viewHandles=new h;a._preserveAbsoluteDateTime=!1;a._trackingEnabled=!1;a._referencePosResetPreserveAbsoluteTime=
!1;a.referencePosUpdateTimer=null;a._referencePosWGS84Comparable=null;a._referencePosMapCoords=null;a._mainLight=new z.MainLight;a._ambientLight=new z.AmbientLight;a._moonLight=new z.FillLight;a._renderer=null;a._resetReferencePosition();return a}m(l,b);l.prototype.destroy=function(){this.disconnectView();this._viewHandles.destroy()};Object.defineProperty(l.prototype,"updating",{get:function(){return!!(!this.disableQueries&&(this._referencePosUpdateQuery||this._referencePosMapCoordsRequested)||this._renderer&&
this._renderer.updating)},enumerable:!0,configurable:!0});l.prototype.connectView=function(a){var d=this;this._renderer||(this._view=a,this._renderer=new r({view:a}),this._viewHandles.add([a.watch("environment.lighting.date",function(a){return d._lightingDateHandler(a)},!0),a.watch("stationary",function(){return d._interactingStationaryHandler()}),a.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.background.color"],function(){return d._updateRenderParamsHandler()},
!0),a.watch("spatialReference",function(){return d._resetReferencePosition()},!0),c.init(a,"viewingMode",function(){return d._resetReferencePosition()},!0),c.init(a,"environment.lighting.cameraTrackingEnabled",function(a){return d._updateCameraTracking(a)},!0),c.init(a,"state.camera",function(){return d._cameraHandler(null)},!0),this.watch("disableQueries",function(){return d._cameraHandler(null)})]),this._updateRenderParamsHandler(),this._updateLightParams(),this._cameraHandler(),this.notifyChange("updating"))};
l.prototype.disconnectView=function(){this._renderer&&(this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer.destroy(),this._view=this._renderer=null)};l.prototype._updateCameraTracking=function(a){if(this._trackingEnabled=a)this._cameraHandler();else if(a=this._view.environment.lighting)a.positionTimezoneInfo.autoUpdated=!1};l.prototype._lightingDateHandler=function(a){if(a){var c=this._view.environment.lighting;if(!c.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=
!0;if(!w.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var e=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(e)){this._requestReferencePositionUpdate(e);return}}this._preupdateTracking(a);this._referencePosWGS84Comparable&&(e=x.positionToTimezone(this._referencePosWGS84Comparable,C),d.isSome(e)&&(c.autoUpdate(null,e),this._trackingEnabled&&(c.positionTimezoneInfo.autoUpdated=!0)))}this._updateLightParams(a)}};l.prototype._preupdateTracking=
function(a){!this._trackingEnabled&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(a)};l.prototype._cameraHandler=function(a){void 0===a&&(a=null);if(this._view.ready){var c=this._view.camera;c&&(this._cameraHandlerClientSide(c,a)||this._cameraHandlerServerSide(c))}};l.prototype._cameraHandlerClientSide=function(a,c){if(!w.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return!1;a=a.position;this._referencePosWGS84Comparable||(this._referencePosWGS84Comparable=
t.vec3f64.create());w.pointToWGS84ComparableLonLat(a,this._referencePosWGS84Comparable);this._autoUpdateTimezone(this._referencePosWGS84Comparable,c)||this._updateLightParams(c);return!0};l.prototype._cameraHandlerServerSide=function(a){a=a.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(a))&&this._requestReferencePositionUpdate(a,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=
a.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};l.prototype._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};l.prototype._updateLightParams=function(a){var c=this._view.environment.lighting;a=a||c.date;var c=this._view._stage,d;this._referencePosWGS84Comparable?(d=v.computeColorAndIntensity(a,this._referencePosWGS84Comparable),v.computeDirection(a,this._referencePosWGS84Comparable,this._view.viewingMode,d.diffuse.direction)):
d={diffuse:{color:[1,1,1],intensity:.55,direction:A},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};p.vec3.scale(this._mainLight.intensity,d.diffuse.color,d.diffuse.intensity*Math.PI);p.vec3.negate(this._mainLight.direction,d.diffuse.direction);p.vec3.scale(this._ambientLight.intensity,d.ambient.color,d.ambient.intensity);p.vec3.lerp(this._moonLight.intensity,F,E,d.globalFactor);p.vec3.scale(this._moonLight.intensity,this._moonLight.intensity,(1-.5*d.globalFactor)*(1-.4*d.noonFactor*
(1-d.globalFactor)));p.vec3.copy(this._moonLight.direction,d.diffuse.direction);c.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:d.globalFactor,groundLightingFactor:1-d.noonFactor});this._updateRenderParamsHandler()};l.prototype._autoUpdateTimezone=function(a,c){void 0===c&&(c=null);if(!this._view.environment.lighting.cameraTrackingEnabled)return!1;var e=B;e.setTime((c||this._view.environment.lighting.date).getTime());a=x.positionToTimezone(a,C);if(d.isNone(a))return!1;
var f=this._view.environment.lighting.positionTimezoneInfo;if(!f.autoUpdated)f=a;else if(f.hours===a.hours&&f.minutes===a.minutes&&f.seconds===a.seconds)return!1;var b=e.getUTCHours()-(a.hours-f.hours),h=e.getUTCMinutes()-(a.minutes-f.minutes),f=e.getUTCSeconds()-(a.seconds-f.seconds);e.setUTCHours(b);e.setUTCMinutes(h);e.setUTCSeconds(f);return c?!1:this._view.environment.lighting.autoUpdate(e,a)};l.prototype._updateRenderParamsHandler=function(){var a=this._view._stage;if(a){var c=this._referencePosWGS84Comparable?
v.computeShadowsEnabled(this._referencePosWGS84Comparable,this._view.viewingMode):!0,d=this._view.environment.background,d=d instanceof y?{type:"color",color:u.vec4f64.fromArray(f.toUnitRGBA(d.color))}:{type:"color",color:u.vec4f64.fromValues(0,0,0,1)};a.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&c,ssao:this._view.environment.lighting.ambientOcclusionEnabled,background:d})}};l.prototype._resetReferencePosition=function(){this._cancelReferencePosUpdates();
this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating")};l.prototype._requestReferencePositionUpdate=function(c,d){var e=this;void 0===d&&(d=!1);if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(c):this._referencePosMapCoordsRequested=c.clone(),this._referencePosResetPreserveAbsoluteTime=!!d,!this._referencePosUpdateQuery&&
!this.referencePosUpdateTimer&&this._view.stationary)){var f=this._referencePosUpdateQuery=a.after(this._referencePointUpdateDelay).then(function(){if(e._referencePosUpdateQuery===f)return e._doReferencePositionUpdateQuery(function(){return e._referencePosUpdateQuery!==f})}).catch(function(a){"mapcoordshelper:missing-geometry-service"===a.name&&(e.disableQueries=!0)}).then(function(){e._referencePosUpdateQuery===f&&(e._referencePosUpdateQuery=null,e.referencePosUpdateTimer||e._executePendingReferencePositionUpdate(),
e.notifyChange("updating"))}),b=this.referencePosUpdateTimer=a.after(this._referencePointUpdateInterval).then(function(){e.referencePosUpdateTimer===b&&(e.referencePosUpdateTimer=null,e._referencePosUpdateQuery||e._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};l.prototype._doReferencePositionUpdateQuery=function(a){return e(this,void 0,void 0,function(){var c,d;return g(this,function(e){switch(e.label){case 0:return this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=
!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null,[4,this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords)];case 1:return c=e.sent(),a()||isNaN(c[0])||isNaN(c[1])||(d=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=
c[0],this._referencePosWGS84Comparable[1]=c[1],this._referencePosWGS84Comparable[2]=d):this._referencePosWGS84Comparable=[c[0],c[1],d],this._referencePosChanged()),[2]}})})};l.prototype._executePendingReferencePositionUpdate=function(){var a=this._referencePosMapCoordsRequested;a&&this._requestReferencePositionUpdate(a,this._referencePosResetPreserveAbsoluteTime)};l.prototype._referencePosChanged=function(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||
this._updateLightParams()};l.prototype._exceedsReferencePosDistThreshold=function(a){return this._referencePosMapCoords?(a=this._referencePosMapCoords.distance(a),this._view.mapCoordsHelper&&(a*=this._view.mapCoordsHelper.unitInMeters),a>this._referencePointUpdateDistThreshold):!0};l.prototype._cancelReferencePosUpdates=function(){this.referencePosUpdateTimer=this._referencePosUpdateQuery=null};Object.defineProperty(l.prototype,"test",{get:function(){var a=this;return{renderer:this._renderer,set referencePointUpdateInterval(c){a._referencePointUpdateInterval=
c},set referencePointUpdateDistThreshold(c){a._referencePointUpdateDistThreshold=c},set referencePosUpdateTimer(c){a.referencePosUpdateTimer=c},set referencePointUpdateDelay(c){a._referencePointUpdateDelay=c}}},enumerable:!0,configurable:!0});l.FIXED_LIGHT_DIRECTION=A;k([q.property({type:Boolean,dependsOn:["disableQueries","_renderer.updating"],readOnly:!0})],l.prototype,"updating",null);k([q.property()],l.prototype,"disableQueries",void 0);k([q.property()],l.prototype,"_renderer",void 0);return l=
k([q.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],l)}(q.declared(l.EventedAccessor));b.SceneViewEnvironmentManager=n;var B=new Date,C={hours:0,minutes:0,seconds:0},F=t.vec3f64.fromValues(.22,.22,.33),E=t.vec3f64.fromValues(.22,.22,.22);b.default=n})},"esri/core/libs/gl-matrix-2/vec4f64":function(){define(["require","exports","./factories/vec4f64"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.vec4f64=m})},"esri/core/libs/gl-matrix-2/factories/vec4f64":function(){define(["require",
"exports"],function(n,b){function m(){return[0,0,0,0]}function k(){return[1,1,1,1]}function g(){return[1,0,0,0]}function e(){return[0,1,0,0]}function f(){return[0,0,1,0]}function l(){return[0,0,0,1]}Object.defineProperty(b,"__esModule",{value:!0});b.create=m;b.clone=function(e){return[e[0],e[1],e[2],e[3]]};b.fromValues=function(e,d,a,c){return[e,d,a,c]};b.fromArray=function(e){for(var d=m(),a=Math.min(4,e.length),c=0;c<a;++c)d[c]=e[c];return d};b.createView=function(e,d){return new Float64Array(e,
d,4)};b.zeros=function(){return m()};b.ones=k;b.unitX=g;b.unitY=e;b.unitZ=f;b.unitW=l;b.ZEROS=m();b.ONES=k();b.UNIT_X=g();b.UNIT_Y=e();b.UNIT_Z=f();b.UNIT_W=l()})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/compilerUtils ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){var p=[14,15];return function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a._handles=new f;a._initContext=null;a._pendingAtmosphere=null;a._atmosphere=null;a._stars=null;return a}m(g,b);Object.defineProperty(g.prototype,"canRender",{get:function(){return!(!this.view.basemapTerrain||!this.view.basemapTerrain.renderer.canRender)||"global"!==this.view.viewingMode},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){return null!=
this._pendingAtmosphere},enumerable:!0,configurable:!0});g.prototype.initialize=function(){this.view._stage.addRenderPlugin(p,this)};g.prototype.destroy=function(){this._pendingAtmosphere&&(this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null);this._stars&&(this._stars.destroy(),this._stars=null);this._handles&&this._handles.removeAll();this.view&&(this.view._stage.removeRenderPlugin(this),this._set("view",null))};g.prototype.initializeRenderContext=
function(a){this._initContext=a;this._techniqueRepository=this._initContext.shaderTechniqueRep;this.setup()};g.prototype.setup=function(){var a=this;this._handles.add(l.when(this.view,"basemapTerrain",function(){return a._updateBasemapTerrain()},!0));this._handles.add([l.init(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],function(){return a._updateAtmosphere()},!0),l.init(this.view,"environment.starsEnabled",function(){return a._updateStars()},!0)])};g.prototype.uninitializeRenderContext=
function(){this._stars&&(this._stars.uninitializeRenderContext(),this._stars.destroy(),this._stars=null);this._atmosphere&&(this._atmosphere.uninitializeRenderContext(),this._atmosphere.destroy(),this._atmosphere=null)};g.prototype.render=function(a){var c=!0;this._stars&&this._stars.canRender&&(c=this._stars.render(a)&&c);this._atmosphere&&this._atmosphere.canRender&&(c=this._atmosphere.render(a)&&c);return c};g.prototype._setNeedsRender=function(){this._initContext&&this._initContext.requestRender()};
g.prototype._updateStars=function(){var a=this.view.get("environment.starsEnabled")||!1;a&&!this._stars?(this._stars=new q(this.view),this._stars.initializeRenderContext(this._initContext),this._setNeedsRender()):!a&&this._stars&&(this._stars.destroy(),this._stars=null,this._setNeedsRender())};g.prototype._updateAtmosphere=function(){var a=this,c=this._getAtmosphereType();if(this.atmosphereType!==c)if(this.atmosphereType=c,this._pendingAtmosphere&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),
this._pendingAtmosphere=null),c=this._getAtmosphereClass()){var d=new c(this.view,this._techniqueRepository);d.initializeRenderContext(this._initContext);null==this._atmosphere&&(this._atmosphere=d,this._setNeedsRender());this._pendingAtmosphere=d;d.when().then(function(){a._pendingAtmosphere!==a._atmosphere&&(a._atmosphere.destroy(),a._atmosphere=a._pendingAtmosphere);a._pendingAtmosphere=null;a._setNeedsRender();a._updateBasemapTerrain()}).catch(function(){a._pendingAtmosphere===d&&(a._pendingAtmosphere=
null)})}else this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),this._updateBasemapTerrain()};g.prototype._getAtmosphereClass=function(){var f=this._getAtmosphereType();if(this.atmosphereClassFromType)return this.atmosphereClassFromType(f);switch(f){case "none":return null;case "realistic":return a.RealisticAtmosphere;case "panoramic":return d;case "simple":return c;default:e.neverReached(f)}};g.prototype._getAtmosphereType=function(){var c=this.view.get("environment.atmosphereEnabled"),
d=this.view.get("environment.atmosphere.quality");return c&&null!=d?"local"===this.view.viewingMode?"panoramic":"high"===d&&a.RealisticAtmosphere.isSupported(this._initContext)?"realistic":"simple":"none"};g.prototype._updateBasemapTerrain=function(){var a=this.view.basemapTerrain;a&&(a.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)};Object.defineProperty(g.prototype,"test",{get:function(){return{atmosphere:this._atmosphere}},enumerable:!0,configurable:!0});k([h.property({constructOnly:!0})],
g.prototype,"view",void 0);k([h.property({constructOnly:!0})],g.prototype,"atmosphereClassFromType",void 0);k([h.property({dependsOn:["_pendingAtmosphere"]})],g.prototype,"updating",null);k([h.property()],g.prototype,"_pendingAtmosphere",void 0);return g=k([h.subclass("esri.views.3d.environment.EnvironmentRenderer")],g)}(h.declared(g))})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Logger ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/imageUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Util ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v){var z=g.getLogger("esri.views.3d.environment.PanoramicAtmosphere");n=function(){function b(a,c){this.slot=14;this._readyResolver=e.createResolver();this._readyController=e.createAbortController();this.view=a;this._techniqueRepository=c;this._atmosphereTechniqueConfig=new h.SimpleAtmosphereTechniqueConfiguration}Object.defineProperty(b.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!0,configurable:!0});b.prototype.destroy=
function(){this._readyResolver.reject();this._texture&&(this._texture.dispose(),this._texture=null);this._readyController&&(this._readyController.abort(),this._readyController=null)};b.prototype.when=function(){return this._readyResolver.promise};b.prototype.initializeRenderContext=function(c){var f=this,b=c.rctx;this._atmosphereTechniqueConfig.geometry=1;this._atmosphereTechnique=this._techniqueRepository.acquireAndReleaseExisting(h.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereTechnique);
this._vao=this._createVertexArrayObject(b);this._vaoCount=w.vertexCount(this._vao,"geometry");a.requestImage(d,{signal:this._readyController.signal}).then(function(a){f._texture=new x(c.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},a);c.requestRender();f._readyController=null;f._readyResolver.resolve()}).catch(function(a){e.isAbortError(a)||z.error("Unable to initialize atmosphere: image request failed",a);f._readyResolver.reject()})};b.prototype.uninitializeRenderContext=
function(){this.destroy()};b.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass)return!1;var c=a.rctx,d=this._atmosphereTechnique.program;c.bindProgram(d);this._atmosphereTechnique.bindPipelineState(c);c.bindTexture(this._texture);d.setUniform1i("tex",0);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);var e=y;f.mat4.copy(e,a.camera.viewMatrix);e[12]=0;e[13]=0;e[14]=0;e[15]=1;d.setUniformMatrix4fv("view",y);d.setUniform4f("color",1,1,1,1);a.scenelightingData.setLightDirectionUniform(d);
c.bindVAO(this._vao);d.assertCompatibleVertexAttributeLocations(this._vao);c.drawArrays(4,0,this._vaoCount);return!0};b.prototype._createVertexArrayObject=function(a){for(var d=t.createPolySphereGeometry(1,2,!1),e=d.indices[u.VertexAttrConstants.POSITION],f=0;f<e.length;f+=3){var b=e[f];e[f]=e[f+2];e[f+2]=b}for(var d=d.vertexAttributes[u.VertexAttrConstants.POSITION].data,b=A.createBuffer(e.length),h=b.position,f=0;f<e.length;++f){var l=3*e[f];h.set(f,0,d[l]);h.set(f,1,d[l+1]);h.set(f,2,d[l+2])}return new v(a,
p.Default3D,{geometry:c.glLayout(A)},{geometry:r.createVertex(a,35044,b.buffer)})};return b}();var y=l.mat4f64.create(),A=q.newLayout().vec3f("position");return n})},"esri/core/libs/gl-matrix-2/mat4f64":function(){define(["require","exports","./factories/mat4f64"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.mat4f64=m})},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["require","exports"],function(n,b){function m(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}Object.defineProperty(b,
"__esModule",{value:!0});b.create=m;b.clone=function(b){return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15]]};b.fromValues=function(b,g,e,f,l,h,d,a,c,q,p,t,u,r,m,w){return[b,g,e,f,l,h,d,a,c,q,p,t,u,r,m,w]};b.createView=function(b,g){return new Float64Array(b,g,16)};b.IDENTITY=m()})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../environment/SimpleAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});g=function(b){function h(){return null!==b&&b.apply(this,arguments)||this}m(h,b);h.prototype.initializeProgram=function(c){var e=h.shader.get().build({geometry:this.configuration.geometry});return new a(c.rctx,e.generateSource("vertex"),e.generateSource("fragment"),d.Default3D)};h.prototype.initializePipeline=function(){return 1===this.configuration.geometry?c.makePipelineState({blending:c.separateBlendingParams(770,
1,771,771),culling:c.backFaceCullingParams,depthTest:{func:515},colorWrite:c.defaultColorWriteParams}):c.makePipelineState({blending:c.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:c.defaultColorWriteParams})};h.shader=new f.ReloadableShaderModule(e,"../environment/SimpleAtmosphere.glsl",n);return h}(l.ShaderTechnique);b.SimpleAtmosphereTechnique=g;g=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.geometry=0;return c}m(c,a);k([h.parameter({count:3})],
c.prototype,"geometry",void 0);return c}(h.ShaderTechniqueConfiguration);b.SimpleAtmosphereTechniqueConfiguration=g})},"esri/views/3d/environment/SimpleAtmosphere.glsl":function(){define("require exports ../../../core/tsSupport/makeTemplateObjectHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../webgl-engine/core/shaderLibrary/Transform.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderModules/ShaderBuilder".split(" "),function(n,b,
m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var g=new l.ShaderBuilder;2===b.geometry?(g.attributes.add("position","vec2"),g.varyings.add("color","vec4"),g.vertex.uniforms.add("lightingMainDirection","vec3").add("cameraPosition","vec3").add("undergroundFadeAlpha","float"),g.vertex.code.add(f.glsl(h||(h=m(["\n      void main(void) {\n          float ndotl \x3d dot(normalize(cameraPosition), -lightingMainDirection);\n          float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n          color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\n\n          gl_Position \x3d vec4(position.xy, 1.0, 1.0); // on the far plane\n      }\n  "],
["\n      void main(void) {\n          float ndotl \x3d dot(normalize(cameraPosition), -lightingMainDirection);\n          float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n          color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\n\n          gl_Position \x3d vec4(position.xy, 1.0, 1.0); // on the far plane\n      }\n  "])))),g.fragment.code.add(f.glsl(d||(d=m(["\n      void main() {\n          gl_FragColor \x3d color;\n      }\n  "],["\n      void main() {\n          gl_FragColor \x3d color;\n      }\n  "]))))):
(g.include(e.Transform,{linearDepth:!1}),g.attributes.add("position","vec3"),g.varyings.add("vtc","vec2"),g.varyings.add("falloff","float"),1!==b.geometry&&g.varyings.add("innerFactor","float"),g.vertex.uniforms.add("proj","mat4").add("view","mat4").add("lightingMainDirection","vec3"),1!==b.geometry&&g.vertex.uniforms.add("silCircleCenter","vec3").add("silCircleV1","vec3").add("silCircleV2","vec3").add("texV","vec2").add("innerScale","float"),1!==b.geometry&&g.vertex.code.add(f.glsl(a||(a=m(["\n\t\t\tconst float TWICEPI \x3d 2.0*3.14159265;\n\t\t\tconst float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\n\t\t"],
["\n\t\t\tconst float TWICEPI \x3d 2.0*3.14159265;\n\t\t\tconst float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\n\t\t"])))),g.vertex.code.add(f.glsl(c||(c=m(["\n\t\tvoid main(void) {\n\t\t\tvec3 lightDirection \x3d -lightingMainDirection;\n\t"],["\n\t\tvoid main(void) {\n\t\t\tvec3 lightDirection \x3d -lightingMainDirection;\n\t"])))),1===b.geometry?g.vertex.code.add(f.glsl(q||(q=m(["\n\t\t\tvec3 pos \x3d position;\n\t\t\tfloat ndotl \x3d lightDirection.z;\n\t\t\tvtc \x3d vec2(0.0, position.z+0.05);\n\t\t\t"],
["\n\t\t\tvec3 pos \x3d position;\n\t\t\tfloat ndotl \x3d lightDirection.z;\n\t\t\tvtc \x3d vec2(0.0, position.z+0.05);\n\t\t\t"])))):g.vertex.code.add(f.glsl(p||(p=m(["\n\t\t\tinnerFactor \x3d clamp(-position.z, 0.0, 1.0);\n\t\t\tfloat scale \x3d position.y * (1.0 + innerFactor * innerScale);\n\t\t\tfloat phi \x3d position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n\t\t\tvec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\n\t\t\tfloat ndotl \x3d dot(normalize(position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\n\n\t\t\tvtc.x \x3d position.x / ATMOSPHERE_RIM_SEGMENTS;\n\t\t\tvtc.y \x3d texV.x * (1.0 - position.z) + texV.y * position.z;\n\t\t"],
["\n\t\t\tinnerFactor \x3d clamp(-position.z, 0.0, 1.0);\n\t\t\tfloat scale \x3d position.y * (1.0 + innerFactor * innerScale);\n\t\t\tfloat phi \x3d position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n\t\t\tvec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\n\t\t\tfloat ndotl \x3d dot(normalize(position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\n\n\t\t\tvtc.x \x3d position.x / ATMOSPHERE_RIM_SEGMENTS;\n\t\t\tvtc.y \x3d texV.x * (1.0 - position.z) + texV.y * position.z;\n\t\t"])))),
g.vertex.code.add(f.glsl(t||(t=m(["\n\t\tfalloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n\t\tgl_Position \x3d transformPosition(proj, view, pos);\n\t\tgl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n\t\t\t}\n\t"],["\n\t\tfalloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n\t\tgl_Position \x3d transformPosition(proj, view, pos);\n\t\tgl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n\t\t\t}\n\t"])))),g.fragment.uniforms.add("tex",
"sampler2D"),1!==b.geometry&&g.fragment.uniforms.add("altitudeFade","float"),g.fragment.code.add(f.glsl(u||(u=m(["\n\t\tvoid main() {\n\t\t\tvec4 texColor \x3d texture2D(tex, vtc);\n\t"],["\n\t\tvoid main() {\n\t\t\tvec4 texColor \x3d texture2D(tex, vtc);\n\t"])))),1===b.geometry?g.fragment.code.add(f.glsl(r||(r=m(["\n\t\t\tgl_FragColor \x3d texColor * falloff;\n\t\t\t}\n\t\t"],["\n\t\t\tgl_FragColor \x3d texColor * falloff;\n\t\t\t}\n\t\t"])))):g.fragment.code.add(f.glsl(x||(x=m(["\n\t\t\tvec4 atmosphereColor \x3d texColor * falloff;\n\t\t\tvec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\n\t\t\tgl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\n\t\t}\n\t\t"],
["\n\t\t\tvec4 atmosphereColor \x3d texColor * falloff;\n\t\t\tvec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\n\t\t\tgl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\n\t\t}\n\t\t"])))));return g};var h,d,a,c,q,p,t,u,r,x})},"esri/core/tsSupport/makeTemplateObjectHelper":function(){define([],function(){return function(n,b){if(Object.defineProperty)return Object.defineProperty(n,"raw",{value:b});n.raw=b;return n}})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define("require exports ../../../../../core/tsSupport/makeTemplateObjectHelper ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../shaderModules/interfaces".split(" "),
function(n,b,m,k,g,e){function f(a,c){c.linearDepth?a.vertex.code.add(e.glsl(h||(h=m(["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye \x3d view * vec4(pos, 1.0);\n      depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "],["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye \x3d view * vec4(pos, 1.0);\n      depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "])))):
a.vertex.code.add(e.glsl(d||(d=m(["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "],["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "]))))}Object.defineProperty(b,"__esModule",
{value:!0});b.Transform=f;(function(a){function c(a,c,d){k.mat4.translate(l,d,c);a.setUniform3fv("localOrigin",c);a.setUniformMatrix4fv("view",l)}a.bindUniformsCustomOrigin=c;a.bindUniforms=function(a,d){c(a,d.origin,d.view)}})(f=b.Transform||(b.Transform={}));var l=g.mat4f32.create(),h,d})},"esri/core/libs/gl-matrix-2/mat4f32":function(){define(["require","exports","./factories/mat4f32"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.mat4f32=m})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["require",
"exports"],function(n,b){function m(){var b=new Float32Array(16);b[0]=1;b[5]=1;b[10]=1;b[15]=1;return b}Object.defineProperty(b,"__esModule",{value:!0});b.create=m;b.clone=function(b){var g=new Float32Array(16);g[0]=b[0];g[1]=b[1];g[2]=b[2];g[3]=b[3];g[4]=b[4];g[5]=b[5];g[6]=b[6];g[7]=b[7];g[8]=b[8];g[9]=b[9];g[10]=b[10];g[11]=b[11];g[12]=b[12];g[13]=b[13];g[14]=b[14];g[15]=b[15];return g};b.fromValues=function(b,g,e,f,l,h,d,a,c,q,p,t,u,r,m,w){var k=new Float32Array(16);k[0]=b;k[1]=g;k[2]=e;k[3]=
f;k[4]=l;k[5]=h;k[6]=d;k[7]=a;k[8]=c;k[9]=q;k[10]=p;k[11]=t;k[12]=u;k[13]=r;k[14]=m;k[15]=w;return k};b.createView=function(b,g){return new Float32Array(b,g,16)};b.IDENTITY=m()})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["require","exports"],function(n,b){function m(b){for(var g=[],e=1;e<arguments.length;e++)g[e-1]=arguments[e];for(var e="",f=0;f<g.length;f++)e+=b[f]+g[f];return e+=b[b.length-1]}Object.defineProperty(b,"__esModule",{value:!0});b.glsl=m;(function(b){b.int=
function(b){return Math.round(b).toString()};b.float=function(b){return b.toPrecision(8)}})(m=b.glsl||(b.glsl={}))})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["require","exports","../../../../../core/Logger","../../../../../core/MapUtils","../../../../../core/SetUtils"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});var e=m.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");n=function(){function f(){this.vertex=new h;
this.fragment=new h;this.attributes=new d;this.varyings=new a;this.extensions=new c;this.defines=new q;this._includedModules=new Map}f.prototype.include=function(a,c){this._includedModules.has(a)?this._includedModules.get(a)!==c&&e.error("Trying to include shader module multiple times with different sets of options."):(this._includedModules.set(a,c),"shaderModule"in a?a.shaderModule(this,c):a(this,c))};f.prototype.generateSource=function(a){var c=this.extensions.generateSource(a),d=this.attributes.generateSource(a),
e=this.varyings.generateSource(),f="vertex"===a?this.vertex:this.fragment,b=f.uniforms.generateSource(),h=f.code.generateSource();a="vertex"===a?t:p;f=this.defines.generateSource().concat(f.defines.generateSource());return"\n"+c.join("\n")+"\n\n"+f.join("\n")+"\n\n"+a+"\n\n"+b.join("\n")+"\n\n"+d.join("\n")+"\n\n"+e.join("\n")+"\n\n"+h.join("\n")};return f}();b.ShaderBuilder=n;var f=function(){function a(){this._entries=[];this._set=new Set}a.prototype.add=function(a,c,d){var e=a+"_"+c+"_"+d;this._set.has(e)||
(this._entries.push([a,c,d]),this._set.add(e));return this};a.prototype.generateSource=function(){return this._entries.map(function(a){var c=a[2];return"uniform "+a[1]+" "+a[0]+(c?"["+c+"]":"")+";"})};return a}(),l=function(){function a(){this._entries=[]}a.prototype.add=function(a){this._entries.push(a)};a.prototype.generateSource=function(){return this._entries};return a}(),h=function(){return function(){this.uniforms=new f;this.code=new l;this.defines=new q}}(),d=function(){function a(){this._entries=
[]}a.prototype.add=function(a,c){this._entries.push([a,c])};a.prototype.generateSource=function(a){return"fragment"===a?[]:this._entries.map(function(a){return"attribute "+a[1]+" "+a[0]+";"})};return a}(),a=function(){function a(){this._entries=[]}a.prototype.add=function(a,c){this._entries.push([a,c])};a.prototype.generateSource=function(){return this._entries.map(function(a){return"varying "+a[1]+" "+a[0]+";"})};return a}(),c=function(){function a(){this._entries=new Set}a.prototype.add=function(a){this._entries.add(a)};
a.prototype.generateSource=function(c){var d="vertex"===c?a.WHITELIST_VERTEX:a.WHITELIST_FRAGMENT;return g.valuesOfSet(this._entries).filter(function(a){return 0<=d.indexOf(a)}).map(function(a){return"#extension "+a+" : enable"})};a.WHITELIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];a.WHITELIST_VERTEX=[];return a}(),q=function(){function a(){this._entries=new Map}a.prototype.addInt=function(a,c){c=0===c%1?c.toFixed(0):c.toString();this._entries.set(a,c)};a.prototype.addFloat=
function(a,c){c=0===c%1?c.toFixed(1):c.toString();this._entries.set(a,c)};a.prototype.generateSource=function(){return k.pairsOfMap(this._entries).map(function(a){return"#define "+a[0]+" "+a[1]})};return a}(),p="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",t="precision highp float;\nprecision highp sampler2D;"})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["require",
"exports","../../../../../core/promiseUtils"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e,f){this._relativePath=e;this._moduleRequire=f;this._module=b}b.prototype.get=function(){return this._module};b.prototype.reload=function(){var b=this,e=this._moduleRequire.toUrl(this._relativePath),e=e.slice(e.indexOf("esri/"));this._recursivelyInvalidateModuleCache(e);return m.create(function(e){b._moduleRequire([b._relativePath],function(f){b._module=f;e()})})};
b.prototype._recursivelyInvalidateModuleCache=function(b){if(-1!==b.search("shader")||-1!==b.search("shading")){var e=this._moduleRequire.modules,f=e[b];if(f)for(f=f.deps,delete e[b],b=0;b<f.length;b++)e=f[b],"esri"===e.pid&&this._recursivelyInvalidateModuleCache(e.mid)}};return b}();b.ReloadableShaderModule=n})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,
g){if(g){var e=g.__proto__.__configurationParameters||[],f={};f.key=g.key;for(var l=0;l<e.length;l++){var h=e[l];f[h]=g[h]}this._config=f}this._program=this.initializeProgram(b);b.commonUniformStore&&(this._commonUniformStore=b.commonUniformStore,this._commonUniformStore.subscribeProgram(this._program));this._pipeline=this.initializePipeline(b)}b.prototype.dispose=function(){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose(),
this._program=null)};b.prototype.reload=function(b){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose());this._program=this.initializeProgram(b);this._commonUniformStore&&this._commonUniformStore.subscribeProgram(this._program)};Object.defineProperty(b.prototype,"program",{get:function(){return this._program},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"pipeline",{get:function(){return this._pipeline},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"key",{get:function(){return this._config.key},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"configuration",{get:function(){return this._config},enumerable:!0,configurable:!0});b.prototype.bindPass=function(b,g,e){};b.prototype.bindMaterial=function(b,g,e){};b.prototype.bindDraw=function(b,g,e){};b.prototype.bindInstance=function(b){};b.prototype.bindPipelineState=function(b){b.setPipelineState(this.pipeline)};b.prototype.ensureAttributeLocations=
function(b){this.program.assertCompatibleVertexAttributeLocations(b)};Object.defineProperty(b.prototype,"primitiveType",{get:function(){return 4},enumerable:!0,configurable:!0});return b}();b.ShaderTechnique=n})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["require","exports","../../../../../core/mathUtils"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(){this.key=0}}();b.ShaderTechniqueConfiguration=
n;b.parameter=function(b){void 0===b&&(b={});return function(g,e){g.__configurationParameters=g.__configurationParameters||[];g.__configurationParameters.push(e);var f="_"+e;void 0===g.__configurationParameters__offset&&(g.__configurationParameters__offset=0);var l=g.__configurationParameters__offset,h=Math.ceil(m.log2(b.count||2)),d=(1<<h)-1<<l;g.__configurationParameters__offset+=h;if(32<=g.__configurationParameters__offset)throw Error("ShaderTechniqueConfiguration is too complex, requiring more than 32 bits to encode.\n      Either the configuration must be simplified, or this restriction must be relaxed.(Currently used: "+
g.__configurationParameters__offset+")");Object.defineProperty(g,e,{get:function(){return this[f]},set:function(a){this.key=this.key&~d|a<<l&d;this[f]=a}})}}})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,size:4,tangent:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,
region:7,instanceColor:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}})},"esri/views/webgl/Program":function(){define(["require","exports","../../core/has","../../core/maybe","./ShaderTranspiler"],function(n,b,m,k,g){function e(e,b){if(k.isNone(e)||e.length!==b.length)return!0;for(var f=0;f<e.length;++f)if(e[f]!==b[f])return!0;return!1}return function(){function f(e,b,d,a,c){void 0===c&&(c={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=
this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};e||console.error("RenderingContext isn't initialized!");0===b.length&&console.error("Shaders source should not be empty!");this._context=e;this._vertexShaderSource=b;this._fragmentShaderSource=d;if(Array.isArray(c))for(b=0;b<
c.length;b++)this._defines[c[b]]="1";else this._defines=c;this._id=f._nextId++;this._locations=a;m("esri-webgl-debug")&&e.instanceCounter.incrementCount(3)}Object.defineProperty(f.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});f.prototype.getDefine=
function(e){return this._defines[e]};f.prototype.dispose=function(){if(this._context){var e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null);this._fShader&&(e.deleteShader(this._fShader),this._fShader=null);this._glName&&(e.deleteProgram(this._glName),this._glName=null);m("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(3);this._context=null}};f.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=
this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var e=this._context.gl,f=e.createProgram();e.attachShader(f,this._vShader);e.attachShader(f,this._fShader);for(var d in this._locations)e.bindAttribLocation(f,this._locations[d],d);e.linkProgram(f);m("esri-validate-shaders")&&!e.getProgramParameter(f,e.LINK_STATUS)&&console.error("Could not initialize shader\nVALIDATE_STATUS: "+e.getProgramParameter(f,e.VALIDATE_STATUS)+", gl error ["+e.getError()+"]infoLog: "+
e.getProgramInfoLog(f));this._glName=f;this._initialized=!0}};f.prototype.getUniformLocation=function(e){this.initialize();void 0===this._nameToUniformLocation[e]&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this._glName,e));return this._nameToUniformLocation[e]};f.prototype.hasUniform=function(e){return null!==this.getUniformLocation(e)};f.prototype.getAttribLocation=function(e){this.initialize();void 0===this._nameToAttribLocation[e]&&(this._nameToAttribLocation[e]=this._context.gl.getAttribLocation(this._glName,
e));return this._nameToAttribLocation[e]};f.prototype.setUniform1i=function(e,f){var d=this._nameToUniform1[e];if(void 0===d||f!==d)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(e),f),this._nameToUniform1[e]=f};f.prototype.setUniform1iv=function(b,h){var d=this._nameToUniform1v[b];e(d,h)&&(this._context.bindProgram(this),this._context.gl.uniform1iv(this.getUniformLocation(b),h),void 0===d?this._nameToUniform1v[b]=f._arrayCopy(h):f._arrayAssign(h,d))};f.prototype.setUniform2iv=
function(b,h){var d=this._nameToUniform2[b];e(d,h)&&(this._context.bindProgram(this),this._context.gl.uniform2iv(this.getUniformLocation(b),h),void 0===d?this._nameToUniform2[b]=f._arrayCopy(h):f._arrayAssign(h,d))};f.prototype.setUniform3iv=function(b,h){var d=this._nameToUniform3[b];e(d,h)&&(this._context.bindProgram(this),this._context.gl.uniform3iv(this.getUniformLocation(b),h),void 0===d?this._nameToUniform3[b]=f._arrayCopy(h):f._arrayAssign(h,d))};f.prototype.setUniform4iv=function(b,h){var d=
this._nameToUniform4[b];e(d,h)&&(this._context.bindProgram(this),this._context.gl.uniform4iv(this.getUniformLocation(b),h),void 0===d?this._nameToUniform4[b]=f._arrayCopy(h):f._arrayAssign(h,d))};f.prototype.setUniform1f=function(e,f){var d=this._nameToUniform1[e];if(void 0===d||f!==d)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(e),f),this._nameToUniform1[e]=f};f.prototype.setUniform1fv=function(b,h){var d=this._nameToUniform1v[b];e(d,h)&&(this._context.bindProgram(this),
this._context.gl.uniform1fv(this.getUniformLocation(b),h),void 0===d?this._nameToUniform1v[b]=f._arrayCopy(h):f._arrayAssign(h,d))};f.prototype.setUniform2f=function(e,f,d){var a=this._nameToUniform2[e];if(void 0===a||f!==a[0]||d!==a[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(e),f,d),void 0===a?this._nameToUniform2[e]=[f,d]:(a[0]=f,a[1]=d)};f.prototype.setUniform2fv=function(b,h){var d=this._nameToUniform2[b];e(d,h)&&(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(b),
h),void 0===d?this._nameToUniform2[b]=f._arrayCopy(h):f._arrayAssign(h,d))};f.prototype.setUniform3f=function(e,f,d,a){var c=this._nameToUniform3[e];if(void 0===c||f!==c[0]||d!==c[1]||a!==c[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(e),f,d,a),void 0===c?this._nameToUniform3[e]=[f,d,a]:(c[0]=f,c[1]=d,c[2]=a)};f.prototype.setUniform3fv=function(b,h){var d=this._nameToUniform3[b];e(d,h)&&(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(b),
h),void 0===d?this._nameToUniform3[b]=f._arrayCopy(h):f._arrayAssign(h,d))};f.prototype.setUniform4f=function(e,f,d,a,c){var b=this._nameToUniform4[e];if(void 0===b||f!==b[0]||d!==b[1]||a!==b[2]||c!==b[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(e),f,d,a,c),void 0===b?this._nameToUniform4[e]=[f,d,a,c]:(b[0]=f,b[1]=d,b[2]=a,b[3]=c)};f.prototype.setUniform4fv=function(b,h){var d=this._nameToUniform4[b];e(d,h)&&(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(b),
h),void 0===d?this._nameToUniform4[b]=f._arrayCopy(h):f._arrayAssign(h,d))};f.prototype.setUniformMatrix3fv=function(b,h,d){void 0===d&&(d=!1);var a=this._nameToUniformMatrix3[b],c;c=k.isNone(a)?!0:9!==a.length?e(a,h):9!==a.length||a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||a[4]!==h[4]||a[5]!==h[5]||a[6]!==h[6]||a[7]!==h[7]||a[8]!==h[8];c&&(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(b),d,h),void 0===a?this._nameToUniformMatrix3[b]=f._arrayCopy(h):
f._arrayAssign(h,a))};f.prototype.setUniformMatrix4fv=function(b,h,d){void 0===d&&(d=!1);var a=this._nameToUniformMatrix4[b],c;c=k.isNone(a)?!0:16!==a.length?e(a,h):16!==a.length||a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||a[4]!==h[4]||a[5]!==h[5]||a[6]!==h[6]||a[7]!==h[7]||a[8]!==h[8]||a[9]!==h[9]||a[10]!==h[10]||a[11]!==h[11]||a[12]!==h[12]||a[13]!==h[13]||a[14]!==h[14]||a[15]!==h[15];c&&(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(b),d,h),
void 0===a?this._nameToUniformMatrix4[b]=f._arrayCopy(h):f._arrayAssign(h,a))};f.prototype.assertCompatibleVertexAttributeLocations=function(e){(e=e.locations===this.locations)||console.error("VertexAttributeLocations are incompatible");return e};f._padToThree=function(e){var b=e.toString();1E3>e&&(b=("  "+e).slice(-3));return b};f.prototype._addLineNumbers=function(e){var b=2;return e.replace(/\n/g,function(){return"\n"+f._padToThree(b++)+":"})};f.prototype._loadShader=function(e){var b=35633===
e,d=b?this._vertexShaderSource:this._fragmentShaderSource,a;a="";for(var c in this._defines)a+="#define "+c+" "+this._defines[c]+"\n";a+=d;"webgl2"===this._context.contextVersion&&(a=g.transpileShader(a,b?"vertex":"fragment"));c=this._context.gl;e=c.createShader(e);c.shaderSource(e,a);c.compileShader(e);c.getShaderParameter(e,c.COMPILE_STATUS)||(console.error("Compile error in ".concat(b?"vertex":"fragment"," shader")),console.error(c.getShaderInfoLog(e)),console.error(this._addLineNumbers(a)),"webgl2"===
this._context.contextVersion&&(console.log("Shader source before transpilation:"),console.log(d)));return e};f._arrayCopy=function(e){for(var b=[],d=0;d<e.length;++d)b.push(e[d]);return b};f._arrayAssign=function(e,b){for(var d=0;d<e.length;++d)b[d]=e[d]};f._nextId=0;return f}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports","./reservedWordsGLSL3","./lib/glsl-tokenizer/string"],function(n,b,m,k){function g(e){return e.map(function(d){return"eof"!==d.type?d.data:""}).join("")}
function e(b,d,a,c){c=c||a;for(var f=0;f<b.length;f++){var h=b[f];if("ident"===h.type&&h.data===a)return c in d?d[c]++:d[c]=0,e(b,d,c+"_"+d[c],c)}return a}function f(e,d,a){void 0===a&&(a="afterVersion");var c={data:"\n",type:"whitespace"},b=function(a){return a<e.length?/[^\r\n]$/.test(e[a].data):!1},f=function(c){for(var d=-1,e=0,b=-1,f=0;f<c.length;f++){var h=c[f];"preprocessor"===h.type&&(h.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++e:h.data.match(/\#endif\s*.*/)&&--e);("afterVersion"===a||"afterPrecision"===
a)&&"preprocessor"===h.type&&/^#version/.test(h.data)&&(b=Math.max(b,f));if("afterPrecision"===a&&"keyword"===h.type&&"precision"===h.data){a:{for(h=f;h<c.length;h++){var l=c[h];if("operator"===l.type&&";"===l.data)break a}h=null}if(null===h)throw Error("precision statement not followed by any semicolons!");b=Math.max(b,h)}d<b&&0===e&&(d=f)}return d+1}(e);b(f-1)&&e.splice(f++,0,c);for(var h=0;h<d.length;h++){var l=d[h];e.splice(f++,0,l)}b(f-1)&&b(f)&&e.splice(f,0,c)}Object.defineProperty(b,"__esModule",
{value:!0});var l=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];b.transpileShader=function(b,d){b=k(b);var a;a:{a="100";var c="300 es";void 0===a&&(a="100");void 0===c&&(c="300 es");for(var h=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,p=0;p<b.length;p++){var t=b[p];if("preprocessor"===t.type){var u=h.exec(t.data);if(u){h=u[1].replace(/\s\s+/g," ");if(h===c){a=h;break a}if(h===a){t.data="#version "+c;break a}throw Error("unknown glsl version: "+
h);}}}b.splice(0,0,{type:"preprocessor",data:"#version "+c},{type:"whitespace",data:"\n"});a=null}if("300 es"===a)throw Error("shader is already glsl 300 es");h=t=null;p={};u={};for(a=0;a<b.length;++a)switch(c=b[a],c.type){case "keyword":"vertex"===d&&"attribute"===c.data?c.data="in":"varying"===c.data&&(c.data="vertex"===d?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===d&&"gl_FragColor"===
c.data){if(!t){var t=e(b,p,"fragColor"),r=void 0;void 0===r&&(r="lowp");f(b,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}c.data=t}else"fragment"===d&&"gl_FragDepthEXT"===c.data&&(h||(h=e(b,p,"gl_FragDepth")),c.data=h);break;case "ident":if(0<=m.indexOf(c.data)){if(r="vertex"===d)a:{for(r=a-1;0<=r;r--){var x=
b[r];if("whitespace"!==x.type&&"block-comment"!==x.type)if("keyword"===x.type){if("attribute"===x.data||"in"===x.data){r=!0;break a}}else break}r=!1}if(r)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in u||(u[c.data]=e(b,p,c.data));c.data=u[c.data]}}for(a=b.length-1;0<=a;--a)c=b[a],"preprocessor"===c.type&&((d=c.data.match(/\#extension\s+(.*)\:/))&&d[1]&&0<=l.indexOf(d[1].trim())&&(d=b[a+1],b.splice(a,d&&"whitespace"===d.type?2:1)),(d=c.data.match(/\#ifdef\s+(.*)/))&&
d[1]&&0<=l.indexOf(d[1].trim())&&(c.data="#if 1"),(d=c.data.match(/\#ifndef\s+(.*)/))&&d[1]&&0<=l.indexOf(d[1].trim())&&(c.data="#if 0"));return g(b)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],function(n,b){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(n){"use strict;";return function(b){var m=n(),k=[],k=k.concat(m(b));return k=k.concat(m(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(n,b,m){"use strict;";var k="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function g(a){a.length&&x.push({type:k[p],
data:a,position:z,line:w,column:v})}function e(){r=r.length?[]:r;if("/"===u&&"*"===t)return z=q+c-1,p=0,u=t,c+1;if("/"===u&&"/"===t)return z=q+c-1,p=1,u=t,c+1;if("#"===t)return p=2,z=q+c,c;if(/\s/.test(t))return p=9,z=q+c,c;y=/\d/.test(t);A=/[^\w_]/.test(t);z=q+c;p=y?4:A?3:9999;return c}function f(){if(("\r"===t||"\n"===t)&&"\\"!==u)return g(r.join("")),p=999,c;r.push(t);u=t;return c+1}function l(){if("."===u&&/\d/.test(t))return p=5,c;if("/"===u&&"*"===t)return p=0,c;if("/"===u&&"/"===t)return p=
1,c;if("."===t&&r.length){for(;h(r););p=5;return c}if(";"===t||")"===t||"("===t){if(r.length)for(;h(r););g(t);p=999;return c+1}var a=2===r.length&&"\x3d"!==t;if(/[\w_\d\s]/.test(t)||a){for(;h(r););p=999;return c}r.push(t);u=t;return c+1}function h(a){var c=0,d,e;do{d=b.indexOf(a.slice(0,a.length+c).join(""));e=b[d];if(-1===d){if(0<c--+a.length)continue;e=a.slice(0,1).join("")}g(e);z+=e.length;r=r.slice(e.length);return r.length}while(1)}function d(){if("."===t||/[eE]/.test(t))return r.push(t),p=5,
u=t,c+1;if("x"===t&&1===r.length&&"0"===r[0])return p=11,r.push(t),u=t,c+1;if(/[^\d]/.test(t))return g(r.join("")),p=999,c;r.push(t);u=t;return c+1}function a(){"f"===t&&(r.push(t),u=t,c+=1);if(/[eE]/.test(t)||"-"===t&&/[eE]/.test(u))return r.push(t),u=t,c+1;if(/[^\d]/.test(t))return g(r.join("")),p=999,c;r.push(t);u=t;return c+1}var c=0,q=0,p=999,t,u,r=[],x=[],w=1,v=0,z=0,y=!1,A=!1,B="",C;return function(b){x=[];if(null!==b){b=b.replace?b.replace(/\r\n/g,"\n"):b;c=0;B+=b;for(C=B.length;t=B[c],c<
C;){b=c;switch(p){case 0:"/"===t&&"*"===u?(r.push(t),g(r.join("")),p=999):(r.push(t),u=t);c+=1;break;case 1:c=f();break;case 2:c=f();break;case 3:c=l();break;case 4:c=d();break;case 11:/[^a-fA-F0-9]/.test(t)?(g(r.join("")),p=999):(r.push(t),u=t,c+=1);break;case 5:c=a();break;case 9999:if(/[^\d\w_]/.test(t)){var h=r.join("");p=-1<n.indexOf(h)?8:-1<m.indexOf(h)?7:6;g(r.join(""));p=999}else r.push(t),u=t,c+=1;break;case 9:/[^\s]/g.test(t)?(g(r.join("")),p=999):(r.push(t),u=t,c+=1);break;case 999:c=e()}if(b!==
c)switch(B[b]){case "\n":v=0;++w;break;default:++v}}q+=c;B=B.slice(c);return x}r.length&&g(r.join(""));p=10;g("(eof)");return x}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/webgl/renderState":function(){define(["require","exports","../../core/tsSupport/assignHelper"],function(n,b,m){function k(a){return z.intern(a)}function g(a){return y.intern(a)}function e(a){return A.intern(a)}function f(a){return B.intern(a)}function l(a){return C.intern(a)}function h(a){return F.intern(a)}function d(a){return E.intern(a)}function a(a){return G.intern(a)}function c(a){return"["+a.join(",")+"]"}function q(a){return a?c([a.srcRgb,a.srcAlpha,a.dstRgb,a.dstAlpha,a.opRgb,
a.opAlpha,a.color.r,a.color.g,a.color.b,a.color.a]):null}function p(a){return a?c([a.face,a.mode]):null}function t(a){return a?c([a.factor,a.units]):null}function u(a){return a?c([a.func]):null}function r(a){return a?c([a.function.func,a.function.ref,a.function.mask,a.operation.fail,a.operation.zFail,a.operation.zPass]):null}function x(a){return a?c([a.zNear,a.zFar]):null}function w(a){return a?c([a.r,a.g,a.b,a.a]):null}function v(a){return a?c([a.mask]):null}Object.defineProperty(b,"__esModule",
{value:!0});b.simpleBlendingParams=function(a,c,d,e){void 0===d&&(d=32774);void 0===e&&(e=[0,0,0,0]);return{srcRgb:a,srcAlpha:a,dstRgb:c,dstAlpha:c,opRgb:d,opAlpha:d,color:{r:e[0],g:e[1],b:e[2],a:e[3]}}};b.separateBlendingParams=function(a,c,d,e,b,f,h){void 0===b&&(b=32774);void 0===f&&(f=32774);void 0===h&&(h=[0,0,0,0]);return{srcRgb:a,srcAlpha:c,dstRgb:d,dstAlpha:e,opRgb:b,opAlpha:f,color:{r:h[0],g:h[1],b:h[2],a:h[3]}}};b.backFaceCullingParams={face:1029,mode:2305};b.defaultDepthWriteParams={zNear:0,
zFar:1};b.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};b.makeBlending=k;b.makeCulling=g;b.makePolygonOffset=e;b.makeDepthTest=f;b.makeStencilTest=l;b.makeDepthWrite=h;b.makeColorWrite=d;b.makeStencilWrite=a;b.makePipelineState=function(a){return H.intern(a)};n=function(){function a(a,c){this.makeKey=a;this.makeRef=c;this.interns=new Map}a.prototype.intern=function(a){if(!a)return null;var c=this.makeKey(a),d=this.interns;d.has(c)||d.set(c,this.makeRef(a));return d.get(c)};return a}();var z=new n(q,
function(a){return m({__tag:"Blending"},a)}),y=new n(p,function(a){return m({__tag:"Culling"},a)}),A=new n(t,function(a){return m({__tag:"PolygonOffset"},a)}),B=new n(u,function(a){return m({__tag:"DepthTest"},a)}),C=new n(r,function(a){return m({__tag:"StencilTest"},a)}),F=new n(x,function(a){return m({__tag:"DepthWrite"},a)}),E=new n(w,function(a){return m({__tag:"ColorWrite"},a)}),G=new n(v,function(a){return m({__tag:"StencilWrite"},a)}),H=new n(function(a){return a?c([q(a.blending),p(a.culling),
t(a.polygonOffset),u(a.depthTest),r(a.stencilTest),x(a.depthWrite),w(a.colorWrite),v(a.stencilWrite)]):null},function(c){return{blending:k(c.blending),culling:g(c.culling),polygonOffset:e(c.polygonOffset),depthTest:f(c.depthTest),stencilTest:l(c.stencilTest),depthWrite:h(c.depthWrite),colorWrite:d(c.colorWrite),stencilWrite:a(c.stencilWrite)}});n=function(){function a(a){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=
this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=a}a.prototype.setPipeline=function(a){if(this._pipelineInvalid||a!==this._pipeline)this.setBlending(a.blending),this.setCulling(a.culling),this.setPolygonOffset(a.polygonOffset),this.setDepthTest(a.depthTest),this.setStencilTest(a.stencilTest),this.setDepthWrite(a.depthWrite),this.setColorWrite(a.colorWrite),this.setStencilWrite(a.stencilWrite),this._pipeline=a;this._pipelineInvalid=!1};a.prototype.invalidateBlending=
function(){this._pipelineInvalid=this._blendingInvalid=!0};a.prototype.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};a.prototype.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};a.prototype.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};a.prototype.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};a.prototype.invalidateDepthWrite=function(){this._pipelineInvalid=
this._depthWriteInvalid=!0};a.prototype.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};a.prototype.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};a.prototype.setBlending=function(a){this._blending=this.setSubState(a,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};a.prototype.setCulling=function(a){this._culling=this.setSubState(a,this._culling,this._cullingInvalid,this._stateSetters.setCulling);
this._cullingInvalid=!1};a.prototype.setPolygonOffset=function(a){this._polygonOffset=this.setSubState(a,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};a.prototype.setDepthTest=function(a){this._depthTest=this.setSubState(a,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};a.prototype.setStencilTest=function(a){this._stencilTest=this.setSubState(a,this._stencilTest,this._stencilTestInvalid,
this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};a.prototype.setDepthWrite=function(a){this._depthWrite=this.setSubState(a,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};a.prototype.setColorWrite=function(a){this._colorWrite=this.setSubState(a,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};a.prototype.setStencilWrite=function(a){this._stencilWrite=this.setSubState(a,this._stencilWrite,
this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};a.prototype.setSubState=function(a,c,d,e){if(d||a!==c)e(a),this._pipelineInvalid=!0;return a};return a}();b.StateTracker=n})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["require","exports"],function(n,b){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/support/imageUtils":function(){define(["require","exports","../../../core/tsSupport/assignHelper","../../../request"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.dataURItoBlob=function(b){var e=atob(b.split(",")[1]);b=b.split(",")[0].split(":")[1].split(";")[0];for(var f=new ArrayBuffer(e.length),l=new Uint8Array(f),h=0;h<e.length;h++)l[h]=e.charCodeAt(h);return new Blob([f],{type:b})};b.requestImage=function(b,e){return k(b,m({responseType:"image"},e)).then(function(e){return e.data})}})},
"esri/views/3d/support/buffer/glUtil":function(){define(["require","exports","../../../../core/tsSupport/assignHelper"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});var k={divisor:0};b.glLayout=function(e,b){void 0===b&&(b={});b=m({},k,b);var f=e.stride;return e.fieldNames.filter(function(b){b=e.fields.get(b).optional;return!(b&&b.glPadding)}).map(function(h){var d=e.fields.get(h),a=d.constructor.ElementCount;var c=g[d.constructor.ElementType];if(!c)throw Error("BufferType not supported in WebGL");
return{name:h,stride:f,count:a,type:c,offset:d.offset,normalized:!(!d.optional||!d.optional.glNormalized),divisor:b.divisor}})};var g={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["require","exports","./BufferView","./types"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});var g=function(){function e(e,b){this.layout=e;this.buffer="number"===typeof b?new ArrayBuffer(b*e.stride):b;b=0;for(var d=
e.fieldNames;b<d.length;b++){var a=d[b],c=e.fields.get(a);this[a]=new c.constructor(this.buffer,c.offset,this.stride)}}Object.defineProperty(e.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"byteLength",{get:function(){return this.buffer.byteLength},enumerable:!0,configurable:!0});e.prototype.getField=
function(e,b){return(e=this[e])&&e.elementCount===b.ElementCount&&e.elementType===b.ElementType?e:null};e.prototype.slice=function(b,f){return new e(this.layout,this.buffer.slice(b*this.stride,f*this.stride))};e.prototype.copyFrom=function(e,b,d,a){var c=this.stride;0===c%4?(e=new Uint32Array(e.buffer,b*c,a*c/4),d=new Uint32Array(this.buffer,d*c,a*c/4)):(e=new Uint8Array(e.buffer,b*c,a*c),d=new Uint8Array(this.buffer,d*c,a*c));d.set(e)};return e}();b.InterleavedBuffer=g;var e=function(){function e(){this.stride=
0;this.fields=new Map;this.fieldNames=[]}e.prototype.vec2f=function(e,b){this.appendField(e,m.BufferViewVec2f,b);return this};e.prototype.vec2f64=function(e,b){this.appendField(e,m.BufferViewVec2f64,b);return this};e.prototype.vec3f=function(e,b){this.appendField(e,m.BufferViewVec3f,b);return this};e.prototype.vec3f64=function(e,b){this.appendField(e,m.BufferViewVec3f64,b);return this};e.prototype.vec4f=function(e,b){this.appendField(e,m.BufferViewVec4f,b);return this};e.prototype.vec4f64=function(e,
b){this.appendField(e,m.BufferViewVec4f64,b);return this};e.prototype.mat3f=function(e,b){this.appendField(e,m.BufferViewMat3f,b);return this};e.prototype.mat3f64=function(e,b){this.appendField(e,m.BufferViewMat3f64,b);return this};e.prototype.mat4f=function(e,b){this.appendField(e,m.BufferViewMat4f,b);return this};e.prototype.mat4f64=function(e,b){this.appendField(e,m.BufferViewMat4f64,b);return this};e.prototype.vec4u8=function(e,b){this.appendField(e,m.BufferViewVec4u8,b);return this};e.prototype.f32=
function(e,b){this.appendField(e,m.BufferViewFloat,b);return this};e.prototype.f64=function(e,b){this.appendField(e,m.BufferViewFloat64,b);return this};e.prototype.u8=function(e,b){this.appendField(e,m.BufferViewUint8,b);return this};e.prototype.u16=function(e,b){this.appendField(e,m.BufferViewUint16,b);return this};e.prototype.i8=function(e,b){this.appendField(e,m.BufferViewInt8,b);return this};e.prototype.vec2i8=function(e,b){this.appendField(e,m.BufferViewVec2i8,b);return this};e.prototype.vec2i16=
function(e,b){this.appendField(e,m.BufferViewVec2i16,b);return this};e.prototype.vec2u8=function(e,b){this.appendField(e,m.BufferViewVec2u8,b);return this};e.prototype.vec4u16=function(e,b){this.appendField(e,m.BufferViewVec4u16,b);return this};e.prototype.u32=function(e,b){this.appendField(e,m.BufferViewUint32,b);return this};e.prototype.appendField=function(e,b,d){var a=b.ElementCount*k.elementTypeSize(b.ElementType);this.fields.set(e,{size:a,constructor:b,offset:this.stride,optional:d});this.stride+=
a;this.fieldNames.push(e)};e.prototype.alignTo=function(e){this.stride=Math.floor((this.stride+e-1)/e)*e;return this};e.prototype.hasField=function(e){return 0<=this.fieldNames.indexOf(e)};e.prototype.createBuffer=function(e){return new g(this,e)};e.prototype.createView=function(e){return new g(this,e)};e.prototype.clone=function(){var b=new e;b.stride=this.stride;b.fields=new Map;this.fields.forEach(function(e,d){return b.fields.set(d,e)});b.fieldNames=this.fieldNames.slice();b.BufferType=this.BufferType;
return b};return e}();b.InterleavedLayout=e;b.newLayout=function(){return new e}})},"esri/views/3d/support/buffer/BufferView":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(n,b,m,k,g,e,f,l,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Float32Array,a,e,b,f)||this;a.elementType=
"f32";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="f32";return a}(e.BufferViewScalarImpl);b.BufferViewFloat=n;n=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Float32Array,a,e,b,f)||this;a.elementType="f32";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="f32";return a}(f.BufferViewVec2Impl);b.BufferViewVec2f=n;n=function(d){function a(a,
e,b,f){void 0===e&&(e=0);a=d.call(this,Float32Array,a,e,b,f)||this;a.elementType="f32";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="f32";return a}(l.BufferViewVec3Impl);b.BufferViewVec3f=n;n=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Float32Array,a,e,b,f)||this;a.elementType="f32";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType=
"f32";return a}(h.BufferViewVec4Impl);b.BufferViewVec4f=n;n=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Float32Array,a,e,b,f)||this;a.elementType="f32";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="f32";return a}(k.BufferViewMat3Impl);b.BufferViewMat3f=n;k=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Float64Array,a,e,b,f)||this;a.elementType="f64";return a}m(a,d);a.fromTypedArray=
function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="f64";return a}(k.BufferViewMat3Impl);b.BufferViewMat3f64=k;k=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Float32Array,a,e,b,f)||this;a.elementType="f32";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="f32";return a}(g.BufferViewMat4Impl);b.BufferViewMat4f=k;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);
a=d.call(this,Float64Array,a,e,b,f)||this;a.elementType="f64";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="f64";return a}(g.BufferViewMat4Impl);b.BufferViewMat4f64=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Float64Array,a,e,b,f)||this;a.elementType="f64";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="f64";return a}(e.BufferViewScalarImpl);
b.BufferViewFloat64=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Float64Array,a,e,b,f)||this;a.elementType="f64";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="f64";return a}(f.BufferViewVec2Impl);b.BufferViewVec2f64=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Float64Array,a,e,b,f)||this;a.elementType="f64";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,
c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="f64";return a}(l.BufferViewVec3Impl);b.BufferViewVec3f64=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Float64Array,a,e,b,f)||this;a.elementType="f64";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="f64";return a}(h.BufferViewVec4Impl);b.BufferViewVec4f64=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Uint8Array,a,e,b,f)||
this;a.elementType="u8";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="u8";return a}(e.BufferViewScalarImpl);b.BufferViewUint8=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Uint8Array,a,e,b,f)||this;a.elementType="u8";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="u8";return a}(f.BufferViewVec2Impl);b.BufferViewVec2u8=
g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Uint8Array,a,e,b,f)||this;a.elementType="u8";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="u8";return a}(l.BufferViewVec3Impl);b.BufferViewVec3u8=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Uint8Array,a,e,b,f)||this;a.elementType="u8";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+
c.byteLength)};a.ElementType="u8";return a}(h.BufferViewVec4Impl);b.BufferViewVec4u8=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Uint16Array,a,e,b,f)||this;a.elementType="u16";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="u16";return a}(e.BufferViewScalarImpl);b.BufferViewUint16=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Uint16Array,a,e,b,f)||this;a.elementType="u16";return a}
m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="u16";return a}(f.BufferViewVec2Impl);b.BufferViewVec2u16=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Uint16Array,a,e,b,f)||this;a.elementType="u16";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="u16";return a}(l.BufferViewVec3Impl);b.BufferViewVec3u16=g;g=function(d){function a(a,
e,b,f){void 0===e&&(e=0);a=d.call(this,Uint16Array,a,e,b,f)||this;a.elementType="u16";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="u16";return a}(h.BufferViewVec4Impl);b.BufferViewVec4u16=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Uint32Array,a,e,b,f)||this;a.elementType="u32";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType=
"u32";return a}(e.BufferViewScalarImpl);b.BufferViewUint32=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Uint32Array,a,e,b,f)||this;a.elementType="u32";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="u32";return a}(f.BufferViewVec2Impl);b.BufferViewVec2u32=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Uint32Array,a,e,b,f)||this;a.elementType="u32";return a}m(a,d);a.fromTypedArray=
function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="u32";return a}(l.BufferViewVec3Impl);b.BufferViewVec3u32=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Uint32Array,a,e,b,f)||this;a.elementType="u32";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="u32";return a}(h.BufferViewVec4Impl);b.BufferViewVec4u32=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=
0);a=d.call(this,Int8Array,a,e,b,f)||this;a.elementType="i8";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="i8";return a}(e.BufferViewScalarImpl);b.BufferViewInt8=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Int8Array,a,e,b,f)||this;a.elementType="i8";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="i8";return a}(f.BufferViewVec2Impl);
b.BufferViewVec2i8=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Int8Array,a,e,b,f)||this;a.elementType="i8";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="i8";return a}(l.BufferViewVec3Impl);b.BufferViewVec3i8=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Int8Array,a,e,b,f)||this;a.elementType="i8";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,
d,c.byteOffset+c.byteLength)};a.ElementType="i8";return a}(h.BufferViewVec4Impl);b.BufferViewVec4i8=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Int16Array,a,e,b,f)||this;a.elementType="i16";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="i16";return a}(e.BufferViewScalarImpl);b.BufferViewInt16=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Int16Array,a,e,b,f)||this;a.elementType=
"i16";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="i16";return a}(f.BufferViewVec2Impl);b.BufferViewVec2i16=g;g=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Int16Array,a,e,b,f)||this;a.elementType="i16";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="i16";return a}(l.BufferViewVec3Impl);b.BufferViewVec3i16=g;g=function(d){function a(a,
e,b,f){void 0===e&&(e=0);a=d.call(this,Int16Array,a,e,b,f)||this;a.elementType="i16";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="i16";return a}(h.BufferViewVec4Impl);b.BufferViewVec4i16=g;e=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Int32Array,a,e,b,f)||this;a.elementType="i32";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType=
"i32";return a}(e.BufferViewScalarImpl);b.BufferViewInt32=e;f=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Int32Array,a,e,b,f)||this;a.elementType="i32";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="i32";return a}(f.BufferViewVec2Impl);b.BufferViewVec2i32=f;l=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Int32Array,a,e,b,f)||this;a.elementType="i32";return a}m(a,d);a.fromTypedArray=
function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="i32";return a}(l.BufferViewVec3Impl);b.BufferViewVec3i32=l;h=function(d){function a(a,e,b,f){void 0===e&&(e=0);a=d.call(this,Int32Array,a,e,b,f)||this;a.elementType="i32";return a}m(a,d);a.fromTypedArray=function(c,d){return new a(c.buffer,c.byteOffset,d,c.byteOffset+c.byteLength)};a.ElementType="i32";return a}(h.BufferViewVec4Impl);b.BufferViewVec4i32=h})},"esri/views/3d/support/buffer/internals/Mat3":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,g,e,f,l){void 0===e&&(e=0);this.TypedArrayConstructor=b;this.elementCount=9;b=this.TypedArrayConstructor;void 0===f&&(f=9*b.BYTES_PER_ELEMENT);var h=0===g.byteLength?0:e;this.typedBuffer=null==l?new b(g,h):new b(g,h,(l-e)/b.BYTES_PER_ELEMENT);this.typedBufferStride=f/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
b.prototype.getMat=function(b,g){b*=this.typedBufferStride;for(var e=0;9>e;e++)g[e]=this.typedBuffer[b+e];return g};b.prototype.setMat=function(b,g){b*=this.typedBufferStride;for(var e=0;9>e;e++)this.typedBuffer[b+e]=g[e]};b.prototype.get=function(b,g){return this.typedBuffer[b*this.typedBufferStride+g]};b.prototype.set=function(b,g,e){this.typedBuffer[b*this.typedBufferStride+g]=e};b.prototype.copyFrom=function(b,g,e){var f=this.typedBuffer,l=g.typedBuffer;b*=this.typedBufferStride;g=e*g.typedBufferStride;
for(e=0;9>e;++e)f[b+e]=l[g+e]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=9;return b}();b.BufferViewMat3Impl=n})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,g,e,f,l){void 0===e&&(e=0);this.TypedArrayConstructor=b;this.elementCount=16;b=this.TypedArrayConstructor;void 0===f&&
(f=16*b.BYTES_PER_ELEMENT);var h=0===g.byteLength?0:e;this.typedBuffer=null==l?new b(g,h):new b(g,h,(l-e)/b.BYTES_PER_ELEMENT);this.typedBufferStride=f/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getMat=function(b,g){b*=this.typedBufferStride;for(var e=0;16>e;e++)g[e]=this.typedBuffer[b+e];return g};b.prototype.setMat=function(b,g){b*=this.typedBufferStride;for(var e=
0;16>e;e++)this.typedBuffer[b+e]=g[e]};b.prototype.get=function(b,g){return this.typedBuffer[b*this.typedBufferStride+g]};b.prototype.set=function(b,g,e){this.typedBuffer[b*this.typedBufferStride+g]=e};b.prototype.copyFrom=function(b,g,e){var f=this.typedBuffer,l=g.typedBuffer;b*=this.typedBufferStride;g=e*g.typedBufferStride;for(e=0;16>e;++e)f[b+e]=l[g+e]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=16;
return b}();b.BufferViewMat4Impl=n})},"esri/views/3d/support/buffer/internals/Scalar":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,g,e,f,l){void 0===e&&(e=0);this.TypedArrayConstructor=b;this.elementCount=1;b=this.TypedArrayConstructor;void 0===f&&(f=b.BYTES_PER_ELEMENT);var h=0===g.byteLength?0:e;this.typedBuffer=null==l?new b(g,h):new b(g,h,(l-e)/b.BYTES_PER_ELEMENT);this.typedBufferStride=f/b.BYTES_PER_ELEMENT;
this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.get=function(b){return this.typedBuffer[b*this.typedBufferStride]};b.prototype.set=function(b,g){this.typedBuffer[b*this.typedBufferStride]=g};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=1;return b}();b.BufferViewScalarImpl=n})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["require",
"exports","../../../../../core/libs/gl-matrix-2/vec2"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e,f,l,h){void 0===f&&(f=0);this.TypedArrayConstructor=b;this.elementCount=2;b=this.TypedArrayConstructor;void 0===l&&(l=2*b.BYTES_PER_ELEMENT);var d=0===e.byteLength?0:f;this.typedBuffer=null==h?new b(e,d):new b(e,d,(h-f)/b.BYTES_PER_ELEMENT);this.typedBufferStride=l/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);
this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getVec=function(b,e){return m.vec2.set(e,this.typedBuffer[b*this.typedBufferStride],this.typedBuffer[b*this.typedBufferStride+1])};b.prototype.setVec=function(b,e){this.typedBuffer[b*this.typedBufferStride]=e[0];this.typedBuffer[b*this.typedBufferStride+1]=e[1]};b.prototype.get=function(b,e){return this.typedBuffer[b*this.typedBufferStride+e]};b.prototype.set=function(b,e,f){this.typedBuffer[b*this.typedBufferStride+
e]=f};b.prototype.setValues=function(b,e,f){this.typedBuffer[b*this.typedBufferStride]=e;this.typedBuffer[b*this.typedBufferStride+1]=f};b.prototype.copyFrom=function(b,e,f){var l=this.typedBuffer,h=e.typedBuffer;b*=this.typedBufferStride;e=f*e.typedBufferStride;l[b]=h[e];l[b+1]=h[e+1]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=2;return b}();b.BufferViewVec2Impl=n})},"esri/core/libs/gl-matrix-2/vec2":function(){define(["require",
"exports","./math/vec2"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.vec2=m})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["require","exports","./common"],function(n,b,m){function k(a,c,d){a[0]=c[0]-d[0];a[1]=c[1]-d[1];return a}function g(a,c,d){a[0]=c[0]*d[0];a[1]=c[1]*d[1];return a}function e(a,c,d){a[0]=c[0]/d[0];a[1]=c[1]/d[1];return a}function f(a,c){var d=c[0]-a[0];a=c[1]-a[1];return Math.sqrt(d*d+a*a)}function l(a,c){var d=c[0]-a[0];a=c[1]-a[1];return d*
d+a*a}function h(a){var c=a[0];a=a[1];return Math.sqrt(c*c+a*a)}function d(a){var c=a[0];a=a[1];return c*c+a*a}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,c){a[0]=c[0];a[1]=c[1];return a};b.set=function(a,c,d){a[0]=c;a[1]=d;return a};b.add=function(a,c,d){a[0]=c[0]+d[0];a[1]=c[1]+d[1];return a};b.subtract=k;b.multiply=g;b.divide=e;b.ceil=function(a,c){a[0]=Math.ceil(c[0]);a[1]=Math.ceil(c[1]);return a};b.floor=function(a,c){a[0]=Math.floor(c[0]);a[1]=Math.floor(c[1]);return a};
b.min=function(a,c,d){a[0]=Math.min(c[0],d[0]);a[1]=Math.min(c[1],d[1]);return a};b.max=function(a,c,d){a[0]=Math.max(c[0],d[0]);a[1]=Math.max(c[1],d[1]);return a};b.round=function(a,c){a[0]=Math.round(c[0]);a[1]=Math.round(c[1]);return a};b.scale=function(a,c,d){a[0]=c[0]*d;a[1]=c[1]*d;return a};b.scaleAndAdd=function(a,c,d,e){a[0]=c[0]+d[0]*e;a[1]=c[1]+d[1]*e;return a};b.distance=f;b.squaredDistance=l;b.length=h;b.squaredLength=d;b.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];return a};b.inverse=
function(a,c){a[0]=1/c[0];a[1]=1/c[1];return a};b.normalize=function(a,c){var d=c[0],e=c[1],d=d*d+e*e;0<d&&(d=1/Math.sqrt(d),a[0]=c[0]*d,a[1]=c[1]*d);return a};b.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]};b.cross=function(a,c,d){c=c[0]*d[1]-c[1]*d[0];a[0]=a[1]=0;a[2]=c;return a};b.lerp=function(a,c,d,e){var b=c[0];c=c[1];a[0]=b+e*(d[0]-b);a[1]=c+e*(d[1]-c);return a};b.random=function(a,c){c=c||1;var d=2*m.RANDOM()*Math.PI;a[0]=Math.cos(d)*c;a[1]=Math.sin(d)*c;return a};b.transformMat2=function(a,
c,d){var e=c[0];c=c[1];a[0]=d[0]*e+d[2]*c;a[1]=d[1]*e+d[3]*c;return a};b.transformMat2d=function(a,c,d){var e=c[0];c=c[1];a[0]=d[0]*e+d[2]*c+d[4];a[1]=d[1]*e+d[3]*c+d[5];return a};b.transformMat3=function(a,c,d){var e=c[0];c=c[1];a[0]=d[0]*e+d[3]*c+d[6];a[1]=d[1]*e+d[4]*c+d[7];return a};b.transformMat4=function(a,c,d){var e=c[0];c=c[1];a[0]=d[0]*e+d[4]*c+d[12];a[1]=d[1]*e+d[5]*c+d[13];return a};b.rotate=function(a,c,d,e){var b=c[0]-d[0];c=c[1]-d[1];var f=Math.sin(e);e=Math.cos(e);a[0]=b*e-c*f+d[0];
a[1]=b*f+c*e+d[1];return a};b.angle=function(a,c){var d=a[0];a=a[1];var e=c[0];c=c[1];var b=d*d+a*a;0<b&&(b=1/Math.sqrt(b));var f=e*e+c*c;0<f&&(f=1/Math.sqrt(f));d=(d*e+a*c)*b*f;return 1<d?0:-1>d?Math.PI:Math.acos(d)};b.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};b.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]};b.equals=function(a,c){var d=a[0];a=a[1];var e=c[0];c=c[1];return Math.abs(d-e)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(e))&&Math.abs(a-c)<=m.EPSILON*Math.max(1,Math.abs(a),
Math.abs(c))};b.len=h;b.sub=k;b.mul=g;b.div=e;b.dist=f;b.sqrDist=l;b.sqrLen=d})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec3"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e,f,l,h){void 0===f&&(f=0);this.TypedArrayConstructor=b;this.elementCount=3;b=this.TypedArrayConstructor;void 0===l&&(l=3*b.BYTES_PER_ELEMENT);var d=0===e.byteLength?0:f;this.typedBuffer=null==h?new b(e,
d):new b(e,d,(h-f)/b.BYTES_PER_ELEMENT);this.typedBufferStride=l/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getVec=function(b,e){return m.vec3.set(e,this.typedBuffer[b*this.typedBufferStride],this.typedBuffer[b*this.typedBufferStride+1],this.typedBuffer[b*this.typedBufferStride+2])};b.prototype.setVec=function(b,e){this.typedBuffer[b*this.typedBufferStride]=e[0];
this.typedBuffer[b*this.typedBufferStride+1]=e[1];this.typedBuffer[b*this.typedBufferStride+2]=e[2]};b.prototype.get=function(b,e){return this.typedBuffer[b*this.typedBufferStride+e]};b.prototype.set=function(b,e,f){this.typedBuffer[b*this.typedBufferStride+e]=f};b.prototype.setValues=function(b,e,f,l){this.typedBuffer[b*this.typedBufferStride]=e;this.typedBuffer[b*this.typedBufferStride+1]=f;this.typedBuffer[b*this.typedBufferStride+2]=l};b.prototype.copyFrom=function(b,e,f){var l=this.typedBuffer,
h=e.typedBuffer;b*=this.typedBufferStride;e=f*e.typedBufferStride;l[b]=h[e];l[b+1]=h[e+1];l[b+2]=h[e+2]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=3;return b}();b.BufferViewVec3Impl=n})},"esri/views/3d/support/buffer/internals/Vec4":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec4"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,
e,f,l,h){void 0===f&&(f=0);this.TypedArrayConstructor=b;this.elementCount=4;b=this.TypedArrayConstructor;void 0===l&&(l=4*b.BYTES_PER_ELEMENT);var d=0===e.byteLength?0:f;this.typedBuffer=null==h?new b(e,d):new b(e,d,(h-f)/b.BYTES_PER_ELEMENT);this.typedBufferStride=l/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getVec=function(b,e){return m.vec4.set(e,this.typedBuffer[b*
this.typedBufferStride],this.typedBuffer[b*this.typedBufferStride+1],this.typedBuffer[b*this.typedBufferStride+2],this.typedBuffer[b*this.typedBufferStride+3])};b.prototype.setVec=function(b,e){this.typedBuffer[b*this.typedBufferStride]=e[0];this.typedBuffer[b*this.typedBufferStride+1]=e[1];this.typedBuffer[b*this.typedBufferStride+2]=e[2];this.typedBuffer[b*this.typedBufferStride+3]=e[3]};b.prototype.get=function(b,e){return this.typedBuffer[b*this.typedBufferStride+e]};b.prototype.set=function(b,
e,f){this.typedBuffer[b*this.typedBufferStride+e]=f};b.prototype.setValues=function(b,e,f,l,h){this.typedBuffer[b*this.typedBufferStride]=e;this.typedBuffer[b*this.typedBufferStride+1]=f;this.typedBuffer[b*this.typedBufferStride+2]=l;this.typedBuffer[b*this.typedBufferStride+3]=h};b.prototype.copyFrom=function(b,e,f){var l=this.typedBuffer,h=e.typedBuffer;b*=this.typedBufferStride;e=f*e.typedBufferStride;l[b]=h[e];l[b+1]=h[e+1];l[b+2]=h[e+2];l[b+3]=h[e+3]};Object.defineProperty(b.prototype,"buffer",
{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=4;return b}();b.BufferViewVec4Impl=n})},"esri/core/libs/gl-matrix-2/vec4":function(){define(["require","exports","./math/vec4"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.vec4=m})},"esri/core/libs/gl-matrix-2/math/vec4":function(){define(["require","exports","./common"],function(n,b,m){function k(a,c,d){a[0]=c[0]-d[0];a[1]=c[1]-d[1];a[2]=c[2]-d[2];a[3]=c[3]-d[3];return a}function g(a,
c,d){a[0]=c[0]*d[0];a[1]=c[1]*d[1];a[2]=c[2]*d[2];a[3]=c[3]*d[3];return a}function e(a,c,d){a[0]=c[0]/d[0];a[1]=c[1]/d[1];a[2]=c[2]/d[2];a[3]=c[3]/d[3];return a}function f(a,c){var d=c[0]-a[0],e=c[1]-a[1],b=c[2]-a[2];a=c[3]-a[3];return Math.sqrt(d*d+e*e+b*b+a*a)}function l(a,c){var d=c[0]-a[0],e=c[1]-a[1],b=c[2]-a[2];a=c[3]-a[3];return d*d+e*e+b*b+a*a}function h(a){var c=a[0],d=a[1],e=a[2];a=a[3];return Math.sqrt(c*c+d*d+e*e+a*a)}function d(a){var c=a[0],d=a[1],e=a[2];a=a[3];return c*c+d*d+e*e+a*
a}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];return a};b.set=function(a,c,d,e,b){a[0]=c;a[1]=d;a[2]=e;a[3]=b;return a};b.add=function(a,c,d){a[0]=c[0]+d[0];a[1]=c[1]+d[1];a[2]=c[2]+d[2];a[3]=c[3]+d[3];return a};b.subtract=k;b.multiply=g;b.divide=e;b.ceil=function(a,c){a[0]=Math.ceil(c[0]);a[1]=Math.ceil(c[1]);a[2]=Math.ceil(c[2]);a[3]=Math.ceil(c[3]);return a};b.floor=function(a,c){a[0]=Math.floor(c[0]);a[1]=Math.floor(c[1]);a[2]=
Math.floor(c[2]);a[3]=Math.floor(c[3]);return a};b.min=function(a,c,d){a[0]=Math.min(c[0],d[0]);a[1]=Math.min(c[1],d[1]);a[2]=Math.min(c[2],d[2]);a[3]=Math.min(c[3],d[3]);return a};b.max=function(a,c,d){a[0]=Math.max(c[0],d[0]);a[1]=Math.max(c[1],d[1]);a[2]=Math.max(c[2],d[2]);a[3]=Math.max(c[3],d[3]);return a};b.round=function(a,c){a[0]=Math.round(c[0]);a[1]=Math.round(c[1]);a[2]=Math.round(c[2]);a[3]=Math.round(c[3]);return a};b.scale=function(a,c,d){a[0]=c[0]*d;a[1]=c[1]*d;a[2]=c[2]*d;a[3]=c[3]*
d;return a};b.scaleAndAdd=function(a,c,d,e){a[0]=c[0]+d[0]*e;a[1]=c[1]+d[1]*e;a[2]=c[2]+d[2]*e;a[3]=c[3]+d[3]*e;return a};b.distance=f;b.squaredDistance=l;b.length=h;b.squaredLength=d;b.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=-c[3];return a};b.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];a[2]=1/c[2];a[3]=1/c[3];return a};b.normalize=function(a,c){var d=c[0],e=c[1],b=c[2];c=c[3];var f=d*d+e*e+b*b+c*c;0<f&&(f=1/Math.sqrt(f),a[0]=d*f,a[1]=e*f,a[2]=b*f,a[3]=c*f);return a};b.dot=function(a,
c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};b.lerp=function(a,c,d,e){var b=c[0],f=c[1],h=c[2];c=c[3];a[0]=b+e*(d[0]-b);a[1]=f+e*(d[1]-f);a[2]=h+e*(d[2]-h);a[3]=c+e*(d[3]-c);return a};b.random=function(a,c){c=c||1;var d,e,b,f,h,l;do d=2*m.RANDOM()-1,e=2*m.RANDOM()-1,h=d*d+e*e;while(1<=h);do b=2*m.RANDOM()-1,f=2*m.RANDOM()-1,l=b*b+f*f;while(1<=l);h=Math.sqrt((1-h)/l);a[0]=c*d;a[1]=c*e;a[2]=c*b*h;a[3]=c*f*h;return a};b.transformMat4=function(a,c,d){var e=c[0],b=c[1],f=c[2];c=c[3];a[0]=d[0]*e+
d[4]*b+d[8]*f+d[12]*c;a[1]=d[1]*e+d[5]*b+d[9]*f+d[13]*c;a[2]=d[2]*e+d[6]*b+d[10]*f+d[14]*c;a[3]=d[3]*e+d[7]*b+d[11]*f+d[15]*c;return a};b.transformQuat=function(a,c,d){var e=c[0],b=c[1],f=c[2],h=d[0],l=d[1],g=d[2];d=d[3];var k=d*e+l*f-g*b,q=d*b+g*e-h*f,m=d*f+h*b-l*e,e=-h*e-l*b-g*f;a[0]=k*d+e*-h+q*-g-m*-l;a[1]=q*d+e*-l+m*-h-k*-g;a[2]=m*d+e*-g+k*-l-q*-h;a[3]=c[3];return a};b.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===
c[1]&&a[2]===c[2]&&a[3]===c[3]};b.equals=function(a,c){var d=a[0],e=a[1],b=a[2];a=a[3];var f=c[0],h=c[1],l=c[2];c=c[3];return Math.abs(d-f)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(f))&&Math.abs(e-h)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(b-l)<=m.EPSILON*Math.max(1,Math.abs(b),Math.abs(l))&&Math.abs(a-c)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))};b.sub=k;b.mul=g;b.div=e;b.dist=f;b.sqrDist=l;b.len=h;b.sqrLen=d})},"esri/views/3d/support/buffer/types":function(){define(["require",
"exports","../../../../core/compilerUtils"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.elementTypeSize=function(b){switch(b){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8;default:m.neverReached(b)}};b.isSigned=function(b){switch(b){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0;default:m.neverReached(b)}};b.isInteger=
function(b){switch(b){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1;default:m.neverReached(b)}};b.maximumValue=function(b){switch(b){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308;default:m.neverReached(b)}}})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./BufferVectorMath ./GeometryData ./Util".split(" "),
function(n,b,m,k,g,e,f,l,h){var d=f.Vec3Compact,a;(function(a){for(var c=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],d=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],e=[0,0,1,0,1,1,0,1],b=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],f=Array(36),g=0;6>g;g++)for(var k=0;6>k;k++)f[6*g+k]=g;for(var p=Array(36),g=0;6>g;g++)p[6*g+0]=0,p[6*g+1]=1,p[6*g+2]=2,p[6*g+3]=2,p[6*g+4]=3,p[6*g+5]=0;a.createGeometry=function(a){Array.isArray(a)||
(a=[a,a,a]);for(var g=new Float32Array(24),k=0;8>k;k++)g[3*k]=c[k][0]*a[0],g[3*k+1]=c[k][1]*a[1],g[3*k+2]=c[k][2]*a[2];a={};a[h.VertexAttrConstants.POSITION]=new Uint32Array(b);a[h.VertexAttrConstants.NORMAL]=new Uint32Array(f);a[h.VertexAttrConstants.UV0]=new Uint32Array(p);k={};k[h.VertexAttrConstants.POSITION]={size:3,data:g};k[h.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(d)};k[h.VertexAttrConstants.UV0]={size:2,data:new Float32Array(e)};return new l.GeometryData(k,a)}})(a||(a={}));
var c;(function(a){var c=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],d=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],e=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],b=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var f=new Float32Array(18),g=0;6>g;g++)f[3*g]=c[g][0]*a[0],f[3*g+1]=c[g][1]*a[1],f[3*g+2]=c[g][2]*a[2];a={};a[h.VertexAttrConstants.POSITION]=new Uint32Array(e);a[h.VertexAttrConstants.NORMAL]=
new Uint32Array(b);g={};g[h.VertexAttrConstants.POSITION]={size:3,data:f};g[h.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(d)};return new l.GeometryData(g,a)}})(c||(c={}));var q;(function(a){var c=k.vec3f32.fromValues(-.5,0,-.5),d=k.vec3f32.fromValues(.5,0,-.5),e=k.vec3f32.fromValues(0,0,.5),b=k.vec3f32.fromValues(0,.5,0),f=k.vec3f32.create(),g=k.vec3f32.create(),p=k.vec3f32.create(),r=k.vec3f32.create(),u=k.vec3f32.create();m.vec3.subtract(f,c,b);m.vec3.subtract(g,c,d);m.vec3.cross(p,
f,g);m.vec3.normalize(p,p);m.vec3.subtract(f,d,b);m.vec3.subtract(g,d,e);m.vec3.cross(r,f,g);m.vec3.normalize(r,r);m.vec3.subtract(f,e,b);m.vec3.subtract(g,e,c);m.vec3.cross(u,f,g);m.vec3.normalize(u,u);var t=[c,d,e,b],q=[0,-1,0,p[0],p[1],p[2],r[0],r[1],r[2],u[0],u[1],u[2]],x=[0,1,2,3,1,0,3,2,1,3,0,2],n=[0,0,0,1,1,1,2,2,2,3,3,3];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var c=new Float32Array(12),d=0;4>d;d++)c[3*d]=t[d][0]*a[0],c[3*d+1]=t[d][1]*a[1],c[3*d+2]=t[d][2]*a[2];a={};
a[h.VertexAttrConstants.POSITION]=new Uint32Array(x);a[h.VertexAttrConstants.NORMAL]=new Uint32Array(n);d={};d[h.VertexAttrConstants.POSITION]={size:3,data:c};d[h.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(q)};return new l.GeometryData(d,a)}})(q||(q={}));var p;(function(b){function p(a,c,d,e,b){if(Math.abs(m.vec3.dot(c,a))>b)return!1;m.vec3.cross(d,a,c);m.vec3.normalize(d,d);m.vec3.cross(e,d,a);m.vec3.normalize(e,e);return!0}function v(a,c,d,e,b,f,h){return p(a,c,b,f,h)||p(a,d,b,f,
h)||p(a,e,b,f,h)}b.createBoxGeometry=a.createGeometry;b.createDiamondGeometry=c.createGeometry;b.createTetrahedronGeometry=q.createGeometry;b.createSphereGeometry=function(a,c,d,e,b,f,g){a=a||50;e=void 0!==e?e:-Math.PI;b=void 0!==b?b:2*Math.PI;f=void 0!==f?f:.5*-Math.PI;g=void 0!==g?g:Math.PI;var k=Math.max(3,Math.floor(c)||8),p=Math.max(2,Math.floor(d)||6),r=(k+1)*(p+1);d=new Float32Array(3*r);c=new Float32Array(3*r);for(var r=new Float32Array(2*r),u=[],t=0,q=0;q<=p;q++){for(var m=[],v=q/p,x=f+v*
g,y=Math.cos(x),w=0;w<=k;w++){var z=w/k,A=e+z*b,B=Math.cos(A)*y,C=Math.sin(x),A=-Math.sin(A)*y;d[3*t]=B*a;d[3*t+1]=C*a;d[3*t+2]=A*a;c[3*t]=B;c[3*t+1]=C;c[3*t+2]=A;r[2*t]=z;r[2*t+1]=v;m.push(t);++t}u.push(m)}a=new Uint32Array(2*k*(p-1)*3);for(q=t=0;q<p;q++)for(w=0;w<k;w++)e=u[q][w],b=u[q][w+1],f=u[q+1][w+1],g=u[q+1][w],0===q?(a[t++]=e,a[t++]=f,a[t++]=g):q===p-1?(a[t++]=e,a[t++]=b,a[t++]=f):(a[t++]=e,a[t++]=b,a[t++]=f,a[t++]=f,a[t++]=g,a[t++]=e);h.assert(t===a.length);k={};k[h.VertexAttrConstants.POSITION]=
a;k[h.VertexAttrConstants.NORMAL]=a;k[h.VertexAttrConstants.UV0]=a;p={};p[h.VertexAttrConstants.POSITION]={size:3,data:d};p[h.VertexAttrConstants.NORMAL]={size:3,data:c};p[h.VertexAttrConstants.UV0]={size:2,data:r};return new l.GeometryData(p,k)};b.createPolySphereGeometry=function(a,c,e){function b(c,e){c>e&&(e=[e,c],c=e[0],e=e[1]);var b=c.toString()+"."+e.toString();if(k[b])return k[b];var h=f.length;f.length+=3;d.add(f,3*c,f,3*e,f,h);d.scale(f,h,a/d.length(f,h));h/=3;return k[b]=h}var f;e?(f=[0,
-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],e=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(e=a*(1+Math.sqrt(5))/2,f=[-a,e,0,a,e,0,-a,-e,0,a,-e,0,0,-a,e,0,a,e,0,-a,-e,0,a,-e,e,0,-a,e,0,a,-e,0,-a,-e,0,a],e=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var g=0;g<f.length;g+=3)d.scale(f,g,a/d.length(f,g));for(var k={},g=0;g<c;g++){for(var p=e.length,r=new Uint32Array(4*p),t=0;t<
p;t+=3){var u=e[t],q=e[t+1],m=e[t+2],v=b(u,q),x=b(q,m),y=b(m,u),w=4*t;r[w]=u;r[w+1]=v;r[w+2]=y;r[w+3]=q;r[w+4]=x;r[w+5]=v;r[w+6]=m;r[w+7]=y;r[w+8]=x;r[w+9]=v;r[w+10]=x;r[w+11]=y}e=r;k={}}c=new Float32Array(f);for(g=0;g<c.length;g+=3)d.normalize(c,g);g={};g[h.VertexAttrConstants.POSITION]=e;g[h.VertexAttrConstants.NORMAL]=e;e={};e[h.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(f)};e[h.VertexAttrConstants.NORMAL]={size:3,data:c};return new l.GeometryData(e,g)};b.createPointGeometry=function(a,
c,d,e,b,f,g,k){c=c?new Float64Array([c[0],c[1],c[2]]):new Float32Array([0,0,0]);a=a?new Float32Array([a[0],a[1],a[2]]):new Float32Array([0,0,1]);f=f?new Float32Array(f):new Float32Array([0,0]);d=d?new Uint8Array([255*d[0],255*d[1],255*d[2],3<d.length?255*d[3]:255]):new Uint8Array([255,255,255,255]);var p=null!=e&&2===e.length?new Float32Array(e):new Float32Array([1,1]);e={};e[h.VertexAttrConstants.POSITION]={size:3,data:c};e[h.VertexAttrConstants.NORMAL]={size:3,data:a};e[h.VertexAttrConstants.UV0]=
{size:f.length,data:f};e[h.VertexAttrConstants.COLOR]={size:4,data:d};e[h.VertexAttrConstants.SIZE]={size:2,data:p};null!=b&&(b=new Float32Array([b[0],b[1],b[2],b[3]]),e[h.VertexAttrConstants.AUXPOS1]={size:4,data:b});null!=g&&(g=new Float32Array([g[0],g[1],g[2],g[3]]),e[h.VertexAttrConstants.AUXPOS2]={size:4,data:g});return null!=k?(l.GeometryData.call(k,e,l.GeometryData.DefaultIndices,l.GeometryData.DefaultOffsets,"point"),k):new l.GeometryData(e,l.GeometryData.DefaultIndices,l.GeometryData.DefaultOffsets,
"point")};b.updatePointGeometry=function(a,c,d,e,b,f,l,g){var k=g.vertexAttributes;if(null!=a){var p=k[h.VertexAttrConstants.NORMAL].data;p[0]=a[0];p[1]=a[1];p[2]=a[2]}null!=c&&(p=k[h.VertexAttrConstants.POSITION].data,p[0]=c[0],p[1]=c[1],p[2]=c[2]);null!=d&&(p=k[h.VertexAttrConstants.COLOR].data,p[0]=d[0],p[1]=d[1],p[2]=d[2],p[3]=d[3]);null!=e&&(p=k[h.VertexAttrConstants.SIZE].data,p[0]=e[0],p[1]=e[1]);null!=b&&(p=k[h.VertexAttrConstants.AUXPOS1].data,p[0]=b[0],p[1]=b[1],p[2]=b[2],p[3]=b[3]);null!=
f&&(p=k[h.VertexAttrConstants.UV0].data,p[0]=f[0],p[1]=f[1]);null!=l&&(p=k[h.VertexAttrConstants.AUXPOS2].data,p[0]=l[0],p[1]=l[1],p[2]=l[2],p[3]=l[3]);return g};b.createPointArrayGeometry=function(a,c){for(var d=new Float32Array(3*a.length),e=new Float32Array(c?3*a.length:3),b=new Uint32Array(a.length),f=new Uint32Array(a.length),g=0;g<a.length;g++)d[3*g]=a[g][0],d[3*g+1]=a[g][1],d[3*g+2]=a[g][2],c&&(e[3*g]=c[g][0],e[3*g+1]=c[g][1],e[3*g+2]=c[g][2]),b[g]=g,f[g]=0;c||(e[0]=0,e[1]=1,e[2]=0);a=new Float32Array(2);
a[0]=0;a[1]=0;g={};g[h.VertexAttrConstants.POSITION]=b;g[h.VertexAttrConstants.NORMAL]=c?b:f;g[h.VertexAttrConstants.UV0]=f;c={};c[h.VertexAttrConstants.POSITION]={size:3,data:d};c[h.VertexAttrConstants.NORMAL]={size:3,data:e};c[h.VertexAttrConstants.UV0]={size:2,data:a};return new l.GeometryData(c,g,l.GeometryData.DefaultOffsets,"point")};b.createTriangleGeometry=function(){var a=new Float32Array([0,0,0,0,0,100,100,0,0]),c=new Uint32Array([0,1,2]),d=new Float32Array([0,1,0]),e=new Uint32Array([0,
0,0]),b=new Float32Array([0,0]),f=new Uint32Array([0,0,0]),g={};g[h.VertexAttrConstants.POSITION]=c;g[h.VertexAttrConstants.NORMAL]=e;g[h.VertexAttrConstants.UV0]=f;c={};c[h.VertexAttrConstants.POSITION]={size:3,data:a};c[h.VertexAttrConstants.NORMAL]={size:3,data:d};c[h.VertexAttrConstants.UV0]={size:2,data:b};return new l.GeometryData(c,g)};b.createSquareGeometry=function(a){var c=new Float32Array(12);if(a)for(var d=0;4>d;d++)for(var e=0;3>e;e++)c[3*d+e]=a[d][e];else c[0]=-1,c[1]=-1,c[2]=0,c[3]=
1,c[4]=-1,c[5]=0,c[6]=1,c[7]=1,c[8]=0,c[9]=-1,c[10]=1,c[11]=0;var b=new Uint32Array([0,1,2,2,3,0]);a=new Float32Array([0,0,1]);var f=new Uint32Array([0,0,0,0,0,0]),d=new Float32Array([0,0,1,0,1,1,0,1]),e=new Uint8Array([255,255,255,255]),g={};g[h.VertexAttrConstants.POSITION]=b;g[h.VertexAttrConstants.NORMAL]=f;g[h.VertexAttrConstants.UV0]=b;g[h.VertexAttrConstants.COLOR]=f;b={};b[h.VertexAttrConstants.POSITION]={size:3,data:c};b[h.VertexAttrConstants.NORMAL]={size:3,data:a};b[h.VertexAttrConstants.UV0]=
{size:2,data:d};b[h.VertexAttrConstants.COLOR]={size:4,data:e};return new l.GeometryData(b,g)};b.createConeGeometry=function(a,c,d,e,b,f){void 0===b&&(b=!0);void 0===f&&(f=!0);var g=0,p=k.vec3f32.fromValues(0,g,0),r=k.vec3f32.fromValues(0,g+a,0),t=k.vec3f32.fromValues(0,-1,0),u=k.vec3f32.fromValues(0,1,0);e&&(g=a,r=k.vec3f32.fromValues(0,0,0),p=k.vec3f32.fromValues(0,g,0),t=k.vec3f32.fromValues(0,1,0),u=k.vec3f32.fromValues(0,-1,0));p=[r,p];t=[t,u];u=d+2;r=Math.sqrt(a*a+c*c);if(e)for(e=d-1;0<=e;e--)q=
2*Math.PI/d*e,m=k.vec3f32.fromValues(Math.cos(q)*c,g,Math.sin(q)*c),p.push(m),q=k.vec3f32.fromValues(a*Math.cos(q)/r,-c/r,a*Math.sin(q)/r),t.push(q);else for(e=0;e<d;e++){var q=2*Math.PI/d*e,m=k.vec3f32.fromValues(Math.cos(q)*c,g,Math.sin(q)*c);p.push(m);q=k.vec3f32.fromValues(a*Math.cos(q)/r,c/r,a*Math.sin(q)/r);t.push(q)}a=new Uint32Array(6*(d+2));d=new Uint32Array(6*(d+2));g=c=0;if(b){for(e=3;e<p.length;e++)a[c++]=1,a[c++]=e-1,a[c++]=e,d[g++]=0,d[g++]=0,d[g++]=0;a[c++]=p.length-1;a[c++]=2;a[c++]=
1;d[g++]=0;d[g++]=0;d[g++]=0}if(f){for(e=3;e<p.length;e++)a[c++]=e,a[c++]=e-1,a[c++]=0,d[g++]=e,d[g++]=e-1,d[g++]=1;a[c++]=0;a[c++]=2;a[c++]=p.length-1;d[g++]=1;d[g++]=2;d[g++]=t.length-1}b=new Float32Array(3*u);for(e=0;e<u;e++)b[3*e]=p[e][0],b[3*e+1]=p[e][1],b[3*e+2]=p[e][2];f=new Float32Array(3*u);for(e=0;e<u;e++)f[3*e]=t[e][0],f[3*e+1]=t[e][1],f[3*e+2]=t[e][2];p={};p[h.VertexAttrConstants.POSITION]=a;p[h.VertexAttrConstants.NORMAL]=d;t={};t[h.VertexAttrConstants.POSITION]={size:3,data:b};t[h.VertexAttrConstants.NORMAL]=
{size:3,data:f};return new l.GeometryData(t,p)};b.createCylinderGeometry=function(a,c,d,e,b,f){e=e?k.vec3f32.clone(e):k.vec3f32.fromValues(1,0,0);b=b?k.vec3f32.clone(b):k.vec3f32.fromValues(0,0,0);f=void 0===f?!0:f;var g=k.vec3f32.create();m.vec3.normalize(g,e);e=k.vec3f32.create();m.vec3.scale(e,g,Math.abs(a));var p=k.vec3f32.create();m.vec3.scale(p,e,-.5);m.vec3.add(p,p,b);var r=k.vec3f32.fromValues(0,1,0);.2>Math.abs(1-m.vec3.dot(g,r))&&m.vec3.set(r,0,0,1);var t=k.vec3f32.create();m.vec3.cross(t,
g,r);m.vec3.normalize(t,t);m.vec3.cross(r,t,g);var u=2*d+(f?2:0),q=d+(f?2:0);a=new Float32Array(3*u);b=new Float32Array(3*q);var v=new Float32Array(2*u),x=new Uint32Array(3*d*(f?4:2)),y=new Uint32Array(3*d*(f?4:2));f&&(a[3*(u-2)+0]=p[0],a[3*(u-2)+1]=p[1],a[3*(u-2)+2]=p[2],v[2*(u-2)]=0,v[2*(u-2)+1]=0,a[3*(u-1)+0]=a[3*(u-2)+0]+e[0],a[3*(u-1)+1]=a[3*(u-2)+1]+e[1],a[3*(u-1)+2]=a[3*(u-2)+2]+e[2],v[2*(u-1)]=1,v[2*(u-1)+1]=1,b[3*(q-2)+0]=-g[0],b[3*(q-2)+1]=-g[1],b[3*(q-2)+2]=-g[2],b[3*(q-1)+0]=g[0],b[3*
(q-1)+1]=g[1],b[3*(q-1)+2]=g[2]);for(var g=function(a,c,d){x[a]=c;y[a]=d},w=0,z=k.vec3f32.create(),A=k.vec3f32.create(),B=0;B<d;B++){var C=2*Math.PI/d*B;m.vec3.scale(z,r,Math.sin(C));m.vec3.scale(A,t,Math.cos(C));m.vec3.add(z,z,A);b[3*B+0]=z[0];b[3*B+1]=z[1];b[3*B+2]=z[2];m.vec3.scale(z,z,c);m.vec3.add(z,z,p);a[3*B+0]=z[0];a[3*B+1]=z[1];a[3*B+2]=z[2];v[2*B+0]=B/d;v[2*B+1]=0;a[3*(B+d)+0]=a[3*B+0]+e[0];a[3*(B+d)+1]=a[3*B+1]+e[1];a[3*(B+d)+2]=a[3*B+2]+e[2];v[2*(B+d)+0]=B/d;v[2*B+1]=1;C=(B+1)%d;g(w++,
B,B);g(w++,B+d,B);g(w++,C,C);g(w++,C,C);g(w++,B+d,B);g(w++,C+d,C)}if(f){for(B=0;B<d;B++)C=(B+1)%d,g(w++,u-2,q-2),g(w++,B,q-2),g(w++,C,q-2);for(B=0;B<d;B++)C=(B+1)%d,g(w++,B+d,q-1),g(w++,u-1,q-1),g(w++,C+d,q-1)}c={};c[h.VertexAttrConstants.POSITION]=x;c[h.VertexAttrConstants.NORMAL]=y;c[h.VertexAttrConstants.UV0]=x;d={};d[h.VertexAttrConstants.POSITION]={size:3,data:a};d[h.VertexAttrConstants.NORMAL]={size:3,data:b};d[h.VertexAttrConstants.UV0]={size:2,data:v};return new l.GeometryData(d,c)};b.createTubeGeometry=
function(a,c,d,e,f){d=d||10;e=null!=e?e:!0;h.assert(1<a.length);for(var l=[],g=[],k=0;k<d;k++){l.push([0,-k-1,-((k+1)%d)-1]);var p=k/d*2*Math.PI;g.push([Math.cos(p)*c,Math.sin(p)*c])}return b.createPathExtrusionGeometry(g,a,[[0,0,0]],l,e,f)};b.createPathExtrusionGeometry=function(a,c,d,b,f,p){void 0===p&&(p=k.vec3f32.fromValues(0,0,0));var r=a.length,u=new Float32Array(c.length*r*3+(6*d.length||0)),q=new Float32Array(c.length*r+(2*d.length||0)),x=new Float32Array(c.length*r*3+(d?6:0)),y=(c.length-
1)*r*6+6*b.length,w=new Uint32Array(y),y=new Uint32Array(y),z=0,A=0,B=0,C=0,n=0,F=k.vec3f32.create(),P=k.vec3f32.create(),S=k.vec3f32.create(),V=k.vec3f32.create(),J=k.vec3f32.create(),U=k.vec3f32.create(),Y=k.vec3f32.create(),X=g.vec3f64.create(),R=k.vec3f32.create(),aa=k.vec3f32.create(),da=k.vec3f32.create(),ca=k.vec3f32.create(),ba=k.vec3f32.create(),W=e.plane.create();m.vec3.set(R,0,1,0);m.vec3.subtract(P,c[1],c[0]);m.vec3.normalize(P,P);f?(m.vec3.add(X,c[0],p),m.vec3.normalize(S,X)):m.vec3.set(S,
0,0,1);v(P,S,R,R,J,S,t);m.vec3.copy(V,S);m.vec3.copy(ca,J);for(var Z=0;Z<d.length;Z++)m.vec3.scale(U,J,d[Z][0]),m.vec3.scale(X,S,d[Z][2]),m.vec3.add(U,U,X),m.vec3.add(U,U,c[0]),u[z++]=U[0],u[z++]=U[1],u[z++]=U[2],q[B++]=0;x[A++]=-P[0];x[A++]=-P[1];x[A++]=-P[2];for(Z=0;Z<b.length;Z++)w[C++]=0<b[Z][0]?b[Z][0]:-b[Z][0]-1+d.length,w[C++]=0<b[Z][1]?b[Z][1]:-b[Z][1]-1+d.length,w[C++]=0<b[Z][2]?b[Z][2]:-b[Z][2]-1+d.length,y[n++]=0,y[n++]=0,y[n++]=0;for(var ea=d.length,Z=d.length-1,fa=0;fa<c.length;fa++){var na=
!1;0<fa&&(m.vec3.copy(F,P),fa<c.length-1?(m.vec3.subtract(P,c[fa+1],c[fa]),m.vec3.normalize(P,P)):na=!0,m.vec3.add(aa,F,P),m.vec3.normalize(aa,aa),m.vec3.add(da,c[fa-1],V),e.plane.fromPositionAndNormal(c[fa],aa,W),e.plane.intersectRay(W,e.ray.wrap(da,F),X)?(m.vec3.subtract(X,X,c[fa]),m.vec3.normalize(S,X),m.vec3.cross(J,aa,S),m.vec3.normalize(J,J)):v(aa,V,ca,R,J,S,t),m.vec3.copy(V,S),m.vec3.copy(ca,J));f&&(m.vec3.add(X,c[fa],p),m.vec3.normalize(ba,X));for(var la=0;la<r;la++)if(m.vec3.scale(U,J,a[la][0]),
m.vec3.scale(X,S,a[la][1]),m.vec3.add(U,U,X),m.vec3.normalize(Y,U),x[A++]=Y[0],x[A++]=Y[1],x[A++]=Y[2],f?q[B++]=m.vec3.dot(U,ba):q[B++]=U[2],m.vec3.add(U,U,c[fa]),u[z++]=U[0],u[z++]=U[1],u[z++]=U[2],!na){var ma=(la+1)%r;w[C++]=ea+la;w[C++]=ea+r+la;w[C++]=ea+ma;w[C++]=ea+ma;w[C++]=ea+r+la;w[C++]=ea+r+ma;for(ma=0;6>ma;ma++)y[n++]=w[C-6+ma]-Z}ea+=r}a=c[c.length-1];for(Z=0;Z<d.length;Z++)m.vec3.scale(U,J,d[Z][0]),m.vec3.scale(X,S,d[Z][1]),m.vec3.add(U,U,X),m.vec3.add(U,U,a),u[z++]=U[0],u[z++]=U[1],u[z++]=
U[2],q[B++]=0;d=A/3;x[A++]=P[0];x[A++]=P[1];x[A++]=P[2];r=ea-r;for(Z=0;Z<b.length;Z++)w[C++]=0<=b[Z][0]?ea+b[Z][0]:-b[Z][0]-1+r,w[C++]=0<=b[Z][2]?ea+b[Z][2]:-b[Z][2]-1+r,w[C++]=0<=b[Z][1]?ea+b[Z][1]:-b[Z][1]-1+r,y[n++]=d,y[n++]=d,y[n++]=d;b={};b[h.VertexAttrConstants.POSITION]=w;b[h.VertexAttrConstants.NORMAL]=y;w={};w[h.VertexAttrConstants.POSITION]={size:3,data:u};w.zOffset={size:1,data:q};w[h.VertexAttrConstants.NORMAL]={size:3,data:x};return new l.GeometryData(w,b)};b.createPolylineGeometry=function(a,
c){h.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");h.assert(3===a[0].length,"createPolylineGeometry(): malformed vertex");h.assert(void 0===c||c.length===a.length,"createPolylineGeometry: need same number of points and normals");h.assert(void 0===c||3===c[0].length,"createPolylineGeometry(): malformed normal");for(var d=new Float64Array(3*a.length),e=new Uint32Array(2*(a.length-1)),b=0,f=0,g=0;g<a.length;g++){for(var k=0;3>k;k++)d[b++]=a[g][k];0<g&&(e[f++]=g-1,e[f++]=
g)}b={};f={};b[h.VertexAttrConstants.POSITION]=e;f[h.VertexAttrConstants.POSITION]={size:3,data:d};if(c){for(var d=new Float32Array(3*c.length),p=0,g=0;g<a.length;g++)for(k=0;3>k;k++)d[p++]=c[g][k];b[h.VertexAttrConstants.NORMAL]=e;f[h.VertexAttrConstants.NORMAL]={size:3,data:d}}return new l.GeometryData(f,b,l.GeometryData.DefaultOffsets,"line")};b.createExtrudedTriangle=function(a,c,d,e){var b,f,g=new Float32Array(18);a=[[-c,0,e/2],[d,0,e/2],[0,a,e/2],[-c,0,-e/2],[d,0,-e/2],[0,a,-e/2]];for(c=0;6>
c;c++)g[3*c]=a[c][0],g[3*c+1]=a[c][1],g[3*c+2]=a[c][2];a=(b={},b[h.VertexAttrConstants.POSITION]=new Uint32Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),b);b=(f={},f[h.VertexAttrConstants.POSITION]={size:3,data:g},f);return new l.GeometryData(b,a)};b.transformInPlace=function(a,c){a=a.vertexAttributes[h.VertexAttrConstants.POSITION].data;for(var d=0;d<a.length;d+=3)m.vec3.set(u,a[d],a[d+1],a[d+2]),m.vec3.transformMat4(u,u,c),a[d]=u[0],a[d+1]=u[1],a[d+2]=u[2]};b.addVertexColors=function(a,
c){var d=c||[1,1,1,1];c=new Uint8Array(4);c[0]=255*d[0];c[1]=255*d[1];c[2]=255*d[2];c[3]=255*(3<d.length?d[3]:1);var d={},e=a.getVertexAttr(),b;for(b in e)d[b]=e[b];d[h.VertexAttrConstants.COLOR]={size:4,data:c};c={};for(b in a.indices)c[b]=a.indices[b];c[h.VertexAttrConstants.COLOR]=new Uint32Array(c[h.VertexAttrConstants.POSITION].length);return a=new l.GeometryData(d,c,a.componentOffsets,a.primitiveType)};b.addNormals=function(a){var c=a.getVertexAttr();a=a.indices;for(var d=f.Vec3Compact.subtract,
e=new Float32Array(a.position.length/3*3),b=c.position.data,l=0,g=a.position,k=new Uint32Array(g.length),p=0;p<g.length;p+=3){d(b,3*g[p],b,3*g[p+2],r,0);d(b,3*g[p],b,3*g[p+1],u,0);m.vec3.cross(u,u,r);m.vec3.normalize(u,u);var t=l/3;e[l++]=u[0];e[l++]=u[1];e[l++]=u[2];k[p]=t;k[p+1]=t;k[p+2]=t}c[h.VertexAttrConstants.NORMAL]={size:3,data:e,offsetIdx:0,strideIdx:3};a[h.VertexAttrConstants.NORMAL]=k};b.cgToGIS=function(a,c){void 0===c&&(c=a);var d=a.getVertexAttr();a=d.position.data;var d=d.normal.data,
e=c.getVertexAttr(),b=e.position.data,e=e.normal.data;if(d)for(var f=0;f<d.length;f+=3){var h=d[f+1];e[f+1]=-d[f+2];e[f+2]=h}if(a)for(f=0;f<a.length;f+=3)h=a[f+1],b[f+1]=-a[f+2],b[f+2]=h;return c};b.makeOrthoBasisDirUp=p;b.makeOrthoBasisDirUpFallback=v})(p||(p={}));var t=.99619469809,u=k.vec3f32.create(),r=k.vec3f32.create();return p})},"esri/core/libs/gl-matrix-2/vec3f32":function(){define(["require","exports","./factories/vec3f32"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});
b.vec3f32=m})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["require","exports"],function(n,b){function m(){return new Float32Array(3)}function k(e,d,a){var c=new Float32Array(3);c[0]=e;c[1]=d;c[2]=a;return c}function g(){return k(1,1,1)}function e(){return k(1,0,0)}function f(){return k(0,1,0)}function l(){return k(0,0,1)}Object.defineProperty(b,"__esModule",{value:!0});b.create=m;b.clone=function(e){var d=new Float32Array(3);d[0]=e[0];d[1]=e[1];d[2]=e[2];return d};b.fromValues=
k;b.createView=function(e,d){return new Float32Array(e,d,3)};b.zeros=function(){return m()};b.ones=g;b.unitX=e;b.unitY=f;b.unitZ=l;b.ZEROS=m();b.ONES=g();b.UNIT_X=e();b.UNIT_Y=f();b.UNIT_Z=l()})},"esri/views/3d/support/geometryUtils":function(){define("require exports ./geometryUtils/axisAngle ./geometryUtils/boundedPlane ./geometryUtils/clipRay ./geometryUtils/frustum ./geometryUtils/lineSegment ./geometryUtils/plane ./geometryUtils/ray ./geometryUtils/sphere ./geometryUtils/triangle ./geometryUtils/vector".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});b.plane=l;b.boundedPlane=k;b.triangle=a;b.lineSegment=f;b.ray=h;b.clipRay=g;b.sphere=d;b.frustum=e;b.vector=c;b.axisAngle=m})},"esri/views/3d/support/geometryUtils/axisAngle":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../stack","./vector"],function(n,b,m,k,g){function e(e){void 0===e&&(e=b.UP);return[e[0],e[1],e[2],e[3]]}function f(b,f,d,a,c){void 0===c&&(c=e());c[0]=b;c[1]=f;c[2]=
d;c[3]=a;return c}Object.defineProperty(b,"__esModule",{value:!0});b.create=e;b.wrap=function(e,b,d,a){return f(e,b,d,a,k.sv4d.get())};b.wrapAxisAngle=function(e,b){return f(e[0],e[1],e[2],b,k.sv4d.get())};b.copy=function(b,h){void 0===h&&(h=e());return f(b[0],b[1],b[2],b[3],h)};b.fromValues=f;b.fromAxisAndAngle=function(b,f,d){void 0===d&&(d=e());m.vec3.copy(d,b);d[3]=f;return d};b.fromPoints=function(b,f,d){void 0===d&&(d=e());m.vec3.cross(d,b,f);m.vec3.normalize(d,d);d[3]=g.angle(b,f);return d};
b.UP=[0,0,1,0]})},"esri/views/3d/support/stack":function(){define(["require","exports","../../../core/VectorStack"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.sv2d=m.VectorStack.createVec2f64();b.sv3d=m.VectorStack.createVec3f64();b.sv4d=m.VectorStack.createVec4f64();b.sm3d=m.VectorStack.createMat3f64();b.sm4d=m.VectorStack.createMat4f64();b.sq4d=m.VectorStack.createQuatf64()})},"esri/core/VectorStack":function(){define("require exports ./nextTick ./libs/gl-matrix-2/mat3f64 ./libs/gl-matrix-2/mat4f64 ./libs/gl-matrix-2/quatf64 ./libs/gl-matrix-2/vec2f64 ./libs/gl-matrix-2/vec3f64 ./libs/gl-matrix-2/vec4f64".split(" "),
function(n,b,m,k,g,e,f,l,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a,d,e){var c=this;this.itemByteSize=a;this.itemCreate=d;this.buffers=[];this.items=[];this.itemsPtr=this.itemsPerBuffer=0;this.itemsPerBuffer=Math.ceil(e/this.itemByteSize);this.tickHandle=m.before(function(){return c.reset()})}a.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null);this.itemsPtr=0;this.buffers=this.items=null};a.prototype.get=function(){0===
this.itemsPtr&&m(function(){});for(var a=Math.floor(this.itemsPtr/this.itemsPerBuffer);this.buffers.length<=a;){for(var d=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize),e=0;e<this.itemsPerBuffer;++e)this.items.push(this.itemCreate(d,e*this.itemByteSize));this.buffers.push(d)}return this.items[this.itemsPtr++]};a.prototype.reset=function(){for(var a=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);this.buffers.length>a;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;
this.itemsPtr=0};a.createVec2f64=function(c){void 0===c&&(c=d);return new a(16,f.vec2f64.createView,c)};a.createVec3f64=function(c){void 0===c&&(c=d);return new a(24,l.vec3f64.createView,c)};a.createVec4f64=function(c){void 0===c&&(c=d);return new a(32,h.vec4f64.createView,c)};a.createMat3f64=function(c){void 0===c&&(c=d);return new a(72,k.mat3f64.createView,c)};a.createMat4f64=function(c){void 0===c&&(c=d);return new a(128,g.mat4f64.createView,c)};a.createQuatf64=function(c){void 0===c&&(c=d);return new a(32,
e.quatf64.createView,c)};Object.defineProperty(a.prototype,"test",{get:function(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}},enumerable:!0,configurable:!0});return a}();b.VectorStack=n;var d=4096})},"esri/core/libs/gl-matrix-2/mat3f64":function(){define(["require","exports","./factories/mat3f64"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.mat3f64=m})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["require","exports"],function(n,
b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[1,0,0,0,1,0,0,0,1]};b.clone=function(b){return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8]]};b.fromValues=function(b,k,g,e,f,l,h,d,a){return[b,k,g,e,f,l,h,d,a]};b.createView=function(b,k){return new Float64Array(b,k,9)}})},"esri/core/libs/gl-matrix-2/quatf64":function(){define(["require","exports","./factories/quatf64"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.quatf64=m})},"esri/core/libs/gl-matrix-2/factories/quatf64":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[0,0,0,1]};b.clone=function(b){return[b[0],b[1],b[2],b[3]]};b.fromValues=function(b,k,g,e){return[b,k,g,e]};b.createView=function(b,k){return new Float64Array(b,k,4)}})},"esri/core/libs/gl-matrix-2/vec2f64":function(){define(["require","exports","./factories/vec2f64"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.vec2f64=m})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[0,0]};b.clone=function(b){return[b[0],b[1]]};b.fromValues=function(b,k){return[b,k]};b.fromArray=function(b){for(var k=[0,0],g=Math.min(2,b.length),e=0;e<g;++e)k[e]=b[e];return k};b.createView=function(b,k){return new Float64Array(b,k,2)};b.zeros=function(){return[0,0]};b.ones=function(){return[1,1]};b.unitX=function(){return[1,0]};b.unitY=function(){return[0,1]};b.ZEROS=[0,0];b.ONES=[1,1];b.UNIT_X=
[1,0];b.UNIT_Y=[0,1]})},"esri/views/3d/support/geometryUtils/vector":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.projectPoint=function(b,e,f){e=k.vec3.dot(b,e)/k.vec3.dot(b,b);return k.vec3.scale(f,b,e)};b.projectPointSignedLength=function(b,e){return k.vec3.dot(b,e)/k.vec3.length(b)};b.angle=function(b,e){b=k.vec3.dot(b,e)/(k.vec3.length(b)*k.vec3.length(e));return-m.acosClamped(b)}})},
"esri/views/3d/support/geometryUtils/boundedPlane":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../mathUtils ../stack ./lineSegment ./plane ./ray ./vector".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u){function r(a){void 0===a&&(a=
b.UP);return{plane:p.create(a.plane),origin:d.vec3f64.clone(a.origin),basis1:d.vec3f64.clone(a.basis1),basis2:d.vec3f64.clone(a.basis2)}}function x(a,c){void 0===c&&(c=r());return w(a.origin,a.basis1,a.basis2,c)}function w(a,c,d,e){void 0===e&&(e=r());h.vec3.copy(e.origin,a);h.vec3.copy(e.basis1,c);h.vec3.copy(e.basis2,d);p.fromVectorsAndPoint(d,c,a,e.plane);a=e;1E-6<Math.abs(h.vec3.dot(a.basis1,a.basis2)/(h.vec3.length(a.basis1)*h.vec3.length(a.basis2)))&&O.warn("fromValues()","Provided basis vectors are not perpendicular");
1E-6<Math.abs(h.vec3.dot(a.basis1,a.plane))&&O.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-h.vec3.dot(a.plane,a.origin)-a.plane[3])&&O.warn("fromValues()","Plane offset is not consistent with plane origin");return e}function v(a,d,e){a!==e&&x(a,e);a=h.vec3.scale(c.sv3d.get(),a.plane,d);h.vec3.add(e.origin,e.origin,a);e.plane[3]-=d;return e}function z(a,c){void 0===c&&(c=r());var d=(a[2]-a[0])/2,e=(a[3]-a[1])/2;h.vec3.set(c.origin,a[0]+d,a[1]+e,0);h.vec3.set(c.basis1,
d,0,0);h.vec3.set(c.basis2,0,e,0);p.fromValues(0,0,1,0,c.plane);return c}function y(a,c,d){return p.intersectRay(a.plane,c,d)?H(a,d):!1}function A(d,e,b){var f=K.get(),l=K.get();L(d,e,f,l);for(var l=Number.POSITIVE_INFINITY,k=0,r=T;k<r.length;k++){var u=I(d,r[k],N.get()),t=c.sv3d.get();p.intersectLineSegment(f,u,t)&&(u=a.directionFromTo(c.sv3d.get(),e.origin,t),u=Math.abs(g.acosClamped(h.vec3.dot(e.direction,u))),u<l&&(l=u,h.vec3.copy(b,t)))}return l===Number.POSITIVE_INFINITY?B(d,e,b):b}function B(a,
d,e){if(y(a,d,e))return e;var b=K.get(),f=K.get();L(a,d,b,f);for(var l=Number.POSITIVE_INFINITY,g=0,k=T;g<k.length;g++){var r=I(a,k[g],N.get()),u=c.sv3d.get();p.intersectLineSegmentClamp(b,r,u)&&(r=t.distance2(d,u),p.isPointInside(f,u)&&r<l&&(l=r,h.vec3.copy(e,u)))}E(a,d.origin)<l&&C(a,d.origin,e);return e}function C(a,d,e){var b=p.projectPoint(a.plane,d,c.sv3d.get());d=q.projectPointClamp(D(a,a.basis1),b,-1,1,c.sv3d.get());b=q.projectPointClamp(D(a,a.basis2),b,-1,1,c.sv3d.get());h.vec3.subtract(e,
h.vec3.add(c.sv3d.get(),d,b),a.origin);return e}function F(a,d,e){var b=a.origin,f=a.basis1,l=a.basis2;d=h.vec3.subtract(c.sv3d.get(),d,b);f=u.projectPointSignedLength(f,d);l=u.projectPointSignedLength(l,d);a=u.projectPointSignedLength(a.plane,d);return h.vec3.set(e,f,l,a)}function E(a,d){d=F(a,d,c.sv3d.get());var e=a.basis2;a=h.vec3.length(a.basis1);e=h.vec3.length(e);a=Math.max(Math.abs(d[0])-a,0);e=Math.max(Math.abs(d[1])-e,0);d=d[2];return a*a+e*e+d*d}function G(a,c){var d=-a.plane[3];return u.projectPointSignedLength(a.plane,
c)-d}function H(a,d){var e=h.vec3.subtract(c.sv3d.get(),d,a.origin);d=h.vec3.squaredLength(a.basis1);var b=h.vec3.squaredLength(a.basis2),f=h.vec3.dot(a.basis1,e);a=h.vec3.dot(a.basis2,e);return 0>-f-d&&0>f-d&&0>-a-b&&0>a-b}function D(a,c){var d=N.get();h.vec3.copy(d.origin,a.origin);h.vec3.copy(d.vector,c);return d}function I(a,d,e){var b=a.basis1,f=a.basis2;a=a.origin;var l=h.vec3.scale(c.sv3d.get(),b,d.origin[0]),g=h.vec3.scale(c.sv3d.get(),f,d.origin[1]);h.vec3.add(e.origin,l,g);h.vec3.add(e.origin,
e.origin,a);b=h.vec3.scale(c.sv3d.get(),b,d.direction[0]);d=h.vec3.scale(c.sv3d.get(),f,d.direction[1]);h.vec3.scale(e.vector,h.vec3.add(b,b,d),2);return e}function L(a,c,d,e){a=a.plane;p.fromVectorsAndPoint(a,c.direction,c.origin,d);p.fromVectorsAndPoint(d,a,c.origin,e)}Object.defineProperty(b,"__esModule",{value:!0});var O=k.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");n=function(){return function(){this.plane=p.create();this.origin=d.vec3f64.create();this.basis1=d.vec3f64.create();
this.basis2=d.vec3f64.create()}}();b.BoundedPlaneClass=n;b.create=r;b.wrap=function(a,c,d){var e=M.get();e.origin=a;e.basis1=c;e.basis2=d;e.plane=p.fromVectorsAndPoint(d,c,a,p.wrap(0,0,0,0));return e};b.copy=x;b.fromValues=w;b.elevate=v;b.setExtent=function(a,c,d){z(c,d);v(d,G(a,a.origin),d);return d};b.fromAABoundingRect=z;b.intersectRay=y;b.intersectRayClosestSilhouette=function(a,d,e){if(y(a,d,e))return e;a=A(a,d,c.sv3d.get());h.vec3.add(e,d.origin,h.vec3.scale(c.sv3d.get(),d.direction,h.vec3.distance(d.origin,
a)/h.vec3.length(d.direction)));return e};b.closestPointOnSilhouette=A;b.closestPoint=B;b.projectPoint=C;b.projectPointLocal=F;b.distance2=E;b.distance=function(a,c){return Math.sqrt(E(a,c))};b.distanceToSilhouette=function(a,c){for(var d=Number.NEGATIVE_INFINITY,e=0,b=T;e<b.length;e++){var f=I(a,b[e],N.get()),f=q.distance2(f,c);f>d&&(d=f)}return Math.sqrt(d)};b.extrusionContainsPoint=function(a,c){return p.isPointInside(a.plane,c)&&H(a,c)};b.axisAt=function(a,c,d,e){switch(d){case 0:h.vec3.copy(e,
a.basis1);h.vec3.normalize(e,e);break;case 1:h.vec3.copy(e,a.basis2);h.vec3.normalize(e,e);break;case 2:h.vec3.copy(e,a.plane);break;default:m.neverReached(d)}return e};b.altitudeAt=G;b.setAltitudeAt=function(a,c,d,e){var b=G(a,c);a=h.vec3.scale(Q,a.plane,d-b);h.vec3.add(e,c,a);return e};b.transform=function(a,c,d){a!==d&&x(a,d);f.mat4.invert(P,c);f.mat4.transpose(P,P);h.vec3.transformMat4(d.basis1,a.basis1,P);h.vec3.transformMat4(d.basis2,a.basis2,P);h.vec3.transformMat4(d.plane,a.plane,P);h.vec3.transformMat4(d.origin,
a.origin,c);p.setOffsetFromPoint(d.plane,d.origin,d.plane);return d};b.UP={plane:p.create(),origin:d.vec3f64.fromValues(0,0,0),basis1:d.vec3f64.fromValues(1,0,0),basis2:d.vec3f64.fromValues(0,1,0)};var K=new e.ObjectStack(p.create),N=new e.ObjectStack(q.create),Q=d.vec3f64.create(),M=new e.ObjectStack(function(){return{origin:null,basis1:null,basis2:null,plane:null}}),T=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],
P=l.mat4f64.create()})},"esri/core/ObjectStack":function(){define(["require","exports","./nextTick"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(e){var b=this;this.allocator=e;this.items=[];this.itemsPtr=0;this.tickHandle=m.before(function(){return b.reset()});this.grow()}b.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null);this.items=null};b.prototype.get=function(){0===this.itemsPtr&&m(function(){});this.itemsPtr===
this.items.length&&this.grow();return this.items[this.itemsPtr++]};b.prototype.reset=function(){this.items.length=Math.min(Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*k),this.items.length);this.itemsPtr=0};b.prototype.grow=function(){for(var e=0;e<Math.max(8,Math.min(this.items.length,k));e++)this.items.push(this.allocator())};return b}();b.ObjectStack=n;var k=1024;b.default=n})},"esri/views/3d/support/geometryUtils/lineSegment":function(){define("require exports ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack".split(" "),
function(n,b,m,k,g,e,f){function l(a){return a?{origin:e.vec3f64.clone(a.origin),vector:e.vec3f64.clone(a.vector)}:{origin:e.vec3f64.create(),vector:e.vec3f64.create()}}function h(a,c){var d=t.get();d.origin=a;d.vector=c;return d}function d(a,c,d){void 0===d&&(d=l());g.vec3.copy(d.origin,a);g.vec3.copy(d.vector,c);return d}function a(a,c){c=g.vec3.subtract(f.sv3d.get(),c,a.origin);var d=g.vec3.dot(a.vector,c),e=g.vec3.dot(a.vector,a.vector),d=m.clamp(d/e,0,1);a=g.vec3.subtract(f.sv3d.get(),g.vec3.scale(f.sv3d.get(),
a.vector,d),c);return g.vec3.dot(a,a)}function c(a,c,d,e,b){var h=a.vector,l=a.origin;c=g.vec3.subtract(f.sv3d.get(),c,l);l=g.vec3.length(h);c=g.vec3.dot(h,c)/l;g.vec3.scale(b,h,m.clamp(c,d,e));return g.vec3.add(b,b,a.origin)}function q(a,c,d,e){var b=a.origin,h=g.vec3.add(f.sv3d.get(),b,a.vector);a=c.origin;var l=g.vec3.add(f.sv3d.get(),a,c.vector),k=f.sv3d.get();c=f.sv3d.get();k[0]=b[0]-a[0];k[1]=b[1]-a[1];k[2]=b[2]-a[2];c[0]=l[0]-a[0];c[1]=l[1]-a[1];c[2]=l[2]-a[2];if(1E-6>Math.abs(c[0])&&1E-6>
Math.abs(c[1])&&1E-6>Math.abs(c[2]))return!1;l=f.sv3d.get();l[0]=h[0]-b[0];l[1]=h[1]-b[1];l[2]=h[2]-b[2];if(1E-6>Math.abs(l[0])&&1E-6>Math.abs(l[1])&&1E-6>Math.abs(l[2]))return!1;var h=k[0]*c[0]+k[1]*c[1]+k[2]*c[2],p=c[0]*l[0]+c[1]*l[1]+c[2]*l[2],r=c[0]*c[0]+c[1]*c[1]+c[2]*c[2],t=(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])*r-p*p;if(1E-6>Math.abs(t))return!1;k=(h*p-(k[0]*l[0]+k[1]*l[1]+k[2]*l[2])*r)/t;h=(h+p*k)/r;d&&(k=m.clamp(k,0,1),h=m.clamp(h,0,1));d=f.sv3d.get();p=f.sv3d.get();d[0]=b[0]+k*l[0];d[1]=b[1]+k*
l[1];d[2]=b[2]+k*l[2];p[0]=a[0]+h*c[0];p[1]=a[1]+h*c[1];p[2]=a[2]+h*c[2];e.tA=k;e.tB=h;e.pA=d;e.pB=p;e.distance2=g.vec3.squaredDistance(d,p);return!0}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.wrap=h;b.copy=function(a,c){void 0===c&&(c=l());return d(a.origin,a.vector,c)};b.fromValues=d;b.fromPoints=function(a,c,d){void 0===d&&(d=l());g.vec3.copy(d.origin,a);g.vec3.subtract(d.vector,c,a);return d};b.distance2=a;b.distance=function(c,d){return Math.sqrt(a(c,d))};b.projectPoint=function(a,
d,e){return c(a,d,0,1,e)};b.pointAt=function(a,c,d){return g.vec3.add(d,a.origin,g.vec3.scale(d,a.vector,c))};b.projectPointClamp=c;b.closestRayDistance2=function(a,c){if(q(a,h(c.origin,c.direction),!1,p)){c=p.tA;var d=p.pB,e=p.distance2;if(0<=c&&1>=c)return e;if(0>c)return g.vec3.squaredDistance(a.origin,d);if(1<c)return g.vec3.squaredDistance(g.vec3.add(f.sv3d.get(),a.origin,a.vector),d)}return null};b.closestLineSegmentPoint=function(a,c,d){return q(a,c,!0,p)?(g.vec3.copy(d,p.pA),!0):!1};b.closestLineSegmentDistance2=
function(a,c){return q(a,c,!0,p)?p.distance2:null};var p={tA:0,tB:0,pA:e.vec3f64.create(),pB:e.vec3f64.create(),distance2:0},t=new k.ObjectStack(function(){return{origin:null,vector:null}})})},"esri/views/3d/support/geometryUtils/plane":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3","../stack"],function(n,b,m,k,g){function e(a){void 0===a&&(a=b.UP);return[a[0],a[1],a[2],a[3]]}function f(a,c){void 0===c&&(c=e());return l(a[0],a[1],a[2],
a[3],c)}function l(a,c,d,b,f){void 0===f&&(f=e());f[0]=a;f[1]=c;f[2]=d;f[3]=b;return f}function h(a,c,b){void 0===b&&(b=e());k.vec3.copy(b,c);c=k.vec3.dot(c,c);1E-5<Math.abs(c-1)&&1E-12<c&&k.vec3.scale(b,b,1/Math.sqrt(c));d(b,a,b);return b}function d(a,c,d){a!==d&&f(a,d);d[3]=-k.vec3.dot(d,c);return d}function a(a,c,d,b){void 0===b&&(b=e());a=k.vec3.cross(g.sv3d.get(),c,a);return h(d,a,b)}function c(a,c,d){a=k.vec3.scale(g.sv3d.get(),a,k.vec3.dot(a,c));k.vec3.subtract(d,c,a);return d}function q(a,
c){return k.vec3.dot(a,c)+a[3]}function p(a,c,d,e,b,f){var h=k.vec3.dot(a,d);if(0===h)return!1;a=-(k.vec3.dot(a,c)+a[3])/h;b&&(a=e?Math.max(0,a):m.clamp(a,0,1));if(0>a||!e&&1<a)return!1;k.vec3.add(f,c,k.vec3.scale(f,d,a));return!0}Object.defineProperty(b,"__esModule",{value:!0});b.create=e;b.wrap=function(a,c,d,e){return l(a,c,d,e,g.sv4d.get())};b.copy=f;b.fromValues=l;b.fromNormalAndOffset=function(a,c,d){void 0===d&&(d=e());k.vec3.copy(d,a);d[3]=c;return d};b.fromPositionAndNormal=h;b.fromPoints=
function(c,d,b,f){void 0===f&&(f=e());return a(k.vec3.subtract(g.sv3d.get(),c,d),k.vec3.subtract(g.sv3d.get(),b,d),c,f)};b.setOffsetFromPoint=d;b.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};b.fromVectorsAndPoint=a;b.intersectRay=function(a,c,d){return p(a,c.origin,c.direction,!0,!1,d)};b.intersectLineSegment=function(a,c,d){return p(a,c.origin,c.vector,!1,!1,d)};b.intersectLineSegmentClamp=function(a,c,d){return p(a,c.origin,c.vector,!1,!0,d)};b.isSphereFullyInside=
function(a,c){var d=c.radius;return 0<=q(a,c.center)-d};b.isSphereFullyOutside=function(a,c){var d=c.radius;return 0>q(a,c.center)+d};b.isPointInside=function(a,c){return 0<=q(a,c)};b.isPointOutside=function(a,c){return 0>q(a,c)};b.isAABBFullyInside=function(a,c){var d=c[0],e=c[1],b=c[2],f=c[3],h=c[4];c=c[5];return 0<=a[0]*(0<a[0]?d:f)+a[1]*(0<a[1]?e:h)+a[2]*(0<a[2]?b:c)+a[3]};b.clip=function(a,c){var d=k.vec3.dot(a,c.ray.direction);a=-q(a,c.ray.origin);if(0>a&&0<=d)return!1;if(-1E-6<d&&1E-6>d)return 0<
a;if((0>a||0>d)&&!(0>a&&0>d))return!0;a/=d;0<d?a<c.c1&&(c.c1=a):a>c.c0&&(c.c0=a);return c.c0<=c.c1};b.clipInfinite=function(a,c){var d=k.vec3.dot(a,c.ray.direction);a=-q(a,c.ray.origin);if(-1E-6<d&&1E-6>d)return 0<a;a/=d;0<d?a<c.c1&&(c.c1=a):a>c.c0&&(c.c0=a);return c.c0<=c.c1};b.projectPoint=function(a,d,e){var b=k.vec3.scale(g.sv3d.get(),a,-a[3]);d=k.vec3.subtract(g.sv3d.get(),d,b);a=c(a,d,g.sv3d.get());k.vec3.add(e,a,b);return e};b.projectVector=c;b.distance=function(a,c){return Math.abs(q(a,c))};
b.signedDistance=q;b.UP=[0,0,1,0]})},"esri/views/3d/support/geometryUtils/ray":function(){define("require exports ../../../../core/ObjectStack ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack".split(" "),function(n,b,m,k,g,e,f,l){function h(a){return a?{origin:f.vec3f64.clone(a.origin),direction:f.vec3f64.clone(a.direction)}:{origin:f.vec3f64.create(),direction:f.vec3f64.create()}}function d(a,
c,d){void 0===d&&(d=h());e.vec3.copy(d.origin,a);e.vec3.copy(d.direction,c);return d}function a(a,c,d){void 0===d&&(d=h());var b=k.castRenderScreenPointArray3(g.vec2.copy(l.sv3d.get(),c));b[2]=0;a.unprojectPoint(b,d.origin);c=k.castRenderScreenPointArray3(g.vec2.copy(l.sv3d.get(),c));c[2]=1;a=a.unprojectPoint(c,l.sv3d.get());e.vec3.subtract(d.direction,a,d.origin);return d}function c(a,c,d){void 0===d&&(d=h());e.vec3.copy(d.origin,a.eye);c=e.vec3.set(l.sv3d.get(),c[0],c[1],1);a=a.unprojectPoint(c,
l.sv3d.get());e.vec3.subtract(d.direction,a,d.origin);return d}function q(a,c){a=e.vec3.cross(l.sv3d.get(),e.vec3.normalize(l.sv3d.get(),a.direction),e.vec3.subtract(l.sv3d.get(),c,a.origin));return e.vec3.dot(a,a)}function p(){return{origin:null,direction:null}}Object.defineProperty(b,"__esModule",{value:!0});b.create=h;b.wrap=function(a,c){var d=t.get();d.origin=a;d.direction=c;return d};b.copy=function(a,c){void 0===c&&(c=h());return d(a.origin,a.direction,c)};b.fromPoints=function(a,c,d){void 0===
d&&(d=h());e.vec3.copy(d.origin,a);e.vec3.subtract(d.direction,c,a);return d};b.fromValues=d;b.fromScreen=function(c,d,e){void 0===e&&(e=h());return a(c,c.screenToRender(d,k.castRenderScreenPointArray3(l.sv3d.get())),e)};b.fromRender=a;b.fromScreenAtEye=function(a,d,e){void 0===e&&(e=h());return c(a,a.screenToRender(d,k.castRenderScreenPointArray3(l.sv3d.get())),e)};b.fromRenderAtEye=c;b.distance2=q;b.distance=function(a,c){return Math.sqrt(q(a,c))};b.closestPoint=function(a,c,d){c=e.vec3.dot(a.direction,
e.vec3.subtract(d,c,a.origin));e.vec3.add(d,a.origin,e.vec3.scale(d,a.direction,c));return d};b.createWrapper=p;var t=new m.ObjectStack(p)})},"esri/views/3d/support/geometryUtils/clipRay":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../stack ./ray".split(" "),function(n,b,m,k,g,e){function f(a){return a?{ray:e.create(a.ray),c0:a.c0,c1:a.c1}:{ray:e.create(),c0:0,c1:Number.MAX_VALUE}}function l(a,d,b,h){void 0===h&&(h=f());e.copy(a,h.ray);h.c0=
d;h.c1=b;return h}function h(a,d,b){void 0===b&&(b=f());var c=k.vec3.length(a.vector);e.fromValues(a.origin,d,b.ray);b.c0=0;b.c1=c;return b}function d(a,d,e){return k.vec3.add(e,a.ray.origin,k.vec3.scale(e,a.ray.direction,d))}Object.defineProperty(b,"__esModule",{value:!0});b.create=f;b.wrap=function(c,d,e){var b=a.get();b.ray=c;b.c0=d;b.c1=e;return b};b.copy=function(a,d){void 0===d&&(d=f());return l(a.ray,a.c0,a.c1,d)};b.fromValues=l;b.fromRay=function(a,d){void 0===d&&(d=f());e.copy(a,d.ray);d.c0=
0;d.c1=Number.MAX_VALUE;return d};b.fromLineSegment=function(a,d){void 0===d&&(d=f());var c=k.vec3.normalize(g.sv3d.get(),a.vector);return h(a,c,d)};b.fromLineSegmentAndDirection=h;b.getStart=function(a,e){return d(a,a.c0,e)};b.getEnd=function(a,e){return d(a,a.c1,e)};b.getAt=d;var a=new m.ObjectStack(function(){return{c0:0,c1:0,ray:null}})})},"esri/views/3d/support/geometryUtils/frustum":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../stack ./clipRay ./plane".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){function c(c){if(c){var d=c.planes;c=c.points;return{planes:[a.create(d[0]),a.create(d[1]),a.create(d[2]),a.create(d[3]),a.create(d[4]),a.create(d[5])],points:[e.vec3f64.clone(c[0]),e.vec3f64.clone(c[1]),e.vec3f64.clone(c[2]),e.vec3f64.clone(c[3]),e.vec3f64.clone(c[4]),e.vec3f64.clone(c[5]),e.vec3f64.clone(c[6]),e.vec3f64.clone(c[7])]}}return{planes:[a.create(),a.create(),a.create(),a.create(),a.create(),a.create()],points:[e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create(),
e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create(),e.vec3f64.create()]}}function q(d,e,b){void 0===b&&(b=c());for(var f=0;6>f;f++)a.copy(d[f],b.planes[f]);for(f=0;8>f;f++)g.vec3.copy(b.points[f],e[f]);return b}function p(c){var d=c.planes;c=c.points;a.fromPoints(c[4],c[0],c[3],d[0]);a.fromPoints(c[1],c[5],c[6],d[1]);a.fromPoints(c[4],c[5],c[1],d[2]);a.fromPoints(c[3],c[2],c[6],d[3]);a.fromPoints(c[0],c[1],c[2],d[4]);a.fromPoints(c[5],c[4],c[7],d[5])}function t(c,d){for(var e=
0;6>e;e++)if(!a.clip(c[e],d))return!1;return!0}Object.defineProperty(b,"__esModule",{value:!0});b.create=c;b.copy=function(a,d){void 0===d&&(d=c());return q(a.planes,a.points,d)};b.fromValues=q;b.fromMatrix=function(a,d,e){void 0===e&&(e=c());var b=e.points;a=k.mat4.multiply(h.sm4d.get(),d,a);k.mat4.invert(a,a);for(d=0;8>d;++d){var l=f.vec4.transformMat4(h.sv4d.get(),u[d],a);g.vec3.set(b[d],l[0]/l[3],l[1]/l[3],l[2]/l[3])}p(e);return e};b.recomputePlanes=p;b.intersectsSphere=function(c,d){for(var e=
0;6>e;e++)if(a.isSphereFullyInside(c[e],d))return!1;return!0};b.intersectsRay=function(a,c){return t(a,d.fromRay(c,r.get()))};b.intersectClipRay=function(c,d){for(var e=0;6>e;e++)if(!a.clipInfinite(c[e],d))return!1;return!0};b.intersectsLineSegment=function(a,c,e){return t(a,d.fromLineSegmentAndDirection(c,e,r.get()))};b.intersectsPoint=function(c,d){for(var e=0;6>e;e++)if(0<a.signedDistance(c[e],d))return!1;return!0};b.intersectsAABB=function(c,d){for(var e=0;6>e;e++)if(a.isAABBFullyInside(c[e],
d))return!1;return!0};b.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};var u=[l.vec4f64.fromValues(-1,-1,-1,1),l.vec4f64.fromValues(1,-1,-1,1),l.vec4f64.fromValues(1,1,-1,1),l.vec4f64.fromValues(-1,1,-1,1),l.vec4f64.fromValues(-1,-1,1,1),l.vec4f64.fromValues(1,-1,1,1),l.vec4f64.fromValues(1,1,1,1),l.vec4f64.fromValues(-1,1,1,1)],r=new m.ObjectStack(d.create)})},"esri/views/3d/support/geometryUtils/sphere":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../geometryUtils ../mathUtils ../stack ./ray".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){function p(a){return a?{radius:a.radius,center:h.vec3f64.clone(a.center)}:{radius:1,center:h.vec3f64.create()}}function t(a,c){void 0===c&&(c=p());return u(a.radius,a.center,c)}function u(a,c,d){void 0===d&&(d=p());l.vec3.copy(d.center,c);d.radius=a;return d}function r(a,d,e){var b=l.vec3.subtract(c.sv3d.get(),d.origin,a.center),f=l.vec3.dot(d.direction,d.direction),h=2*l.vec3.dot(d.direction,b);a=l.vec3.dot(b,b)-a.radius*a.radius;a=h*h-4*f*a;if(0>a)return!1;b=
Math.sqrt(a);a=(-h-b)/(2*f);f=(-h+b)/(2*f);if(0>a||f<a&&0<f)a=f;if(0>a)return!1;e&&l.vec3.add(e,d.origin,l.vec3.scale(c.sv3d.get(),d.direction,a));return!0}function x(a,e,b){var h=c.sv3d.get(),g=c.sm4d.get();l.vec3.cross(h,e.origin,e.direction);l.vec3.cross(b,h,e.origin);l.vec3.scale(b,b,1/l.vec3.length(b)*a.radius);a=v(a,e.origin);e=d.vector.angle(e.origin,b);f.mat4.identity(g);f.mat4.rotate(g,g,e+a,h);l.vec3.transformMat4(b,b,g);return b}function w(a,d,e){d=l.vec3.subtract(c.sv3d.get(),d,a.center);
d=l.vec3.scale(c.sv3d.get(),d,a.radius/l.vec3.length(d));return l.vec3.add(e,d,a.center)}function v(a,d){d=l.vec3.subtract(c.sv3d.get(),d,a.center);d=l.vec3.length(d);return g.acosClamped(a.radius/(a.radius+Math.abs(a.radius-d)))}function z(c,d,e,b){c=l.vec3.subtract(B,d,c.center);switch(e){case 0:return c=a.cartesianToSpherical(c,B),c=c[2],l.vec3.set(b,-Math.sin(c),Math.cos(c),0);case 1:return c=a.cartesianToSpherical(c,B),e=c[1],c=c[2],d=Math.sin(e),l.vec3.set(b,-d*Math.cos(c),-d*Math.sin(c),Math.cos(e));
case 2:return l.vec3.normalize(b,c);default:m.neverReached(e)}}function y(a,c){c=l.vec3.subtract(G,c,a.center);return l.vec3.length(c)-a.radius}Object.defineProperty(b,"__esModule",{value:!0});var A=k.getLogger("esri.views.3d.support.geometryUtils.sphere");b.create=p;b.wrap=function(a,c){var d=C.get();d.radius=a;d.center=c||E;return d};b.copy=t;b.fromValues=u;b.elevate=function(a,c,d){a!==d&&l.vec3.copy(d.center,a.center);d.radius=a.radius+c;return d};b.setExtent=function(a,c,d){A.error("sphere.setExtent is not yet supported");
return a===d?d:t(a,d)};b.intersectRay=r;b.intersectScreen=function(a,c,d,e){c=q.fromScreenAtEye(c,d,F);return r(a,c,e)};b.intersectsRay=function(a,c){return r(a,c,null)};b.intersectRayClosestSilhouette=function(a,d,e){if(r(a,d,e))return e;a=x(a,d,c.sv3d.get());l.vec3.add(e,d.origin,l.vec3.scale(c.sv3d.get(),d.direction,l.vec3.distance(d.origin,a)/l.vec3.length(d.direction)));return e};b.closestPointOnSilhouette=x;b.closestPoint=function(a,c,d){if(r(a,c,d))return d;q.closestPoint(c,a.center,d);return w(a,
d,d)};b.projectPoint=w;b.distanceToSilhouette=function(a,d){d=l.vec3.subtract(c.sv3d.get(),d,a.center);d=l.vec3.squaredLength(d);return Math.sqrt(Math.abs(d-a.radius*a.radius))};b.angleToSilhouette=v;var B=h.vec3f64.create();b.axisAt=z;b.altitudeAt=y;b.setAltitudeAt=function(a,c,d,e){var b=y(a,c);a=z(a,c,2,G);d=l.vec3.scale(G,a,d-b);l.vec3.add(e,c,d);return e};var C=new e.ObjectStack(function(){return{center:null,radius:0}}),F=q.create(),E=h.vec3f64.create(),G=h.vec3f64.create();Object.freeze(E)})},
"esri/views/3d/support/geometryUtils/triangle":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack ./lineSegment".split(" "),function(n,b,m,k,g,e,f,l){function h(a){return a?{p0:e.vec3f64.clone(a.p0),p1:e.vec3f64.clone(a.p1),p2:e.vec3f64.clone(a.p2)}:{p0:e.vec3f64.create(),p1:e.vec3f64.create(),p2:e.vec3f64.create()}}function d(a,c,d,e){void 0===e&&(e=h());g.vec3.copy(e.p0,
a);g.vec3.copy(e.p1,c);g.vec3.copy(e.p2,d);return e}function a(a,c,d){var e=k.vec2.distance(a,c);c=k.vec2.distance(c,d);a=k.vec2.distance(d,a);d=(e+c+a)/2;e=d*(d-e)*(d-c)*(d-a);return 0>=e?0:Math.sqrt(e)}Object.defineProperty(b,"__esModule",{value:!0});b.create=h;b.wrap=function(a,c,d){var e=q.get();e.p0=a;e.p1=c;e.p2=d;return e};b.copy=function(a,c){void 0===c&&(c=h());return d(a.p0,a.p1,a.p2,c)};b.fromValues=d;b.distance2=function(a,d){var e=a.p0,b=a.p1;a=a.p2;var h=g.vec3.subtract(f.sv3d.get(),
b,e),k=g.vec3.subtract(f.sv3d.get(),a,b),p=g.vec3.subtract(f.sv3d.get(),e,a),q=g.vec3.subtract(f.sv3d.get(),d,e),r=g.vec3.subtract(f.sv3d.get(),d,b),t=g.vec3.subtract(f.sv3d.get(),d,a),m=g.vec3.cross(h,h,p),u=g.vec3.dot(g.vec3.cross(f.sv3d.get(),h,m),q),r=g.vec3.dot(g.vec3.cross(f.sv3d.get(),k,m),r),t=g.vec3.dot(g.vec3.cross(f.sv3d.get(),p,m),t);if(0<u&&0<r&&0<t)return d=g.vec3.dot(m,q),d*d/g.vec3.dot(m,m);e=l.distance2(l.fromValues(e,h,c.get()),d);b=l.distance2(l.fromValues(b,k,c.get()),d);d=l.distance2(l.fromValues(a,
p,c.get()),d);return Math.min(e,b,d)};b.intersectRay=function(a,c,d){var e=c.direction;c=c.origin;var b=a.p0,f=a.p1,h=a.p2,l=f[0]-b[0],k=f[1]-b[1],p=f[2]-b[2],f=h[0]-b[0];a=h[1]-b[1];var h=h[2]-b[2],q=e[1]*h-a*e[2],r=e[2]*f-h*e[0],t=e[0]*a-f*e[1],m=l*q+k*r+p*t;if(-1E-5<m&&1E-5>m)return!1;var m=1/m,u=c[0]-b[0],x=c[1]-b[1],b=c[2]-b[2],q=m*(u*q+x*r+b*t);if(0>q||1<q)return!1;r=x*p-k*b;p=b*l-p*u;l=u*k-l*x;k=m*(e[0]*r+e[1]*p+e[2]*l);if(0>k||1<q+k)return!1;d&&(g.vec3.scale(d,e,m*(f*r+a*p+h*l)),g.vec3.add(d,
c,d));return!0};b.areaPoints2d=a;b.area2d=function(c){return a(c.p0,c.p1,c.p2)};b.areaPoints3d=function(a,c,d){g.vec3.subtract(p,c,a);g.vec3.subtract(t,d,a);return g.vec3.length(g.vec3.cross(p,p,t))/2};var c=new m.ObjectStack(l.create),q=new m.ObjectStack(function(){return{p0:null,p1:null,p2:null}}),p=e.vec3f64.create(),t=e.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require","exports","./ComponentUtils","./geometryDataUtils","./Util"],function(n,b,m,k,g){Object.defineProperty(b,
"__esModule",{value:!0});n=function(){function e(b,l,h,d){void 0===l&&(l=e.DefaultIndices);void 0===h&&(h=e.DefaultOffsets);void 0===d&&(d="triangle");var a={},c;for(c in b){var f=b[c],p=f.size;a[c]={data:f.data,size:p,offsetIdx:0,strideIdx:p}}if(l===e.DefaultIndices){l=g.getFirstObjectValue(a);l=null==l?0:l.data.length/l.size;b=k.generateDefaultIndexArray(l);l={};for(var t in a)l[t]=b}this._id=k.getNewId();this._vertexAttributes=a;this._indices=l;this._componentOffsets=m.createOffsets(h);this._primitiveType=
d}Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"indexCount",{get:function(){var e=g.getFirstObjectValue(this._indices);return null==e?0:e.length},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0});e.prototype.getVertexAttr=function(){return this.vertexAttributes};e.prototype.toRenderData=function(){return{id:this._id.toString(),indices:this._indices,vertexAttr:this._vertexAttributes}};e.prototype.getIndices=function(e){return this._indices[e]};
e.prototype.getAttribute=function(e){return this._vertexAttributes[e]};e.prototype.estimateGpuMemoryUsage=function(){var e=0;this._indices[g.VertexAttrConstants.POSITION]&&(e+=12*this._indices[g.VertexAttrConstants.POSITION].length);this._indices[g.VertexAttrConstants.NORMAL]&&(e+=12*this._indices[g.VertexAttrConstants.NORMAL].length);this._indices[g.VertexAttrConstants.UV0]&&(e+=8*this._indices[g.VertexAttrConstants.UV0].length);this._indices[g.VertexAttrConstants.COLOR]&&(e+=4*this._indices[g.VertexAttrConstants.COLOR].length);
return e};e.DefaultIndices={};e.DefaultOffsets=new Uint32Array(0);return e}();b.GeometryData=n})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require","exports","../../../../core/arrayUtils","../../../../core/maybe"],function(n,b,m,k){function g(a,c,e,b){if(e>=c)return a;null==a&&(a=d());var f=a.data,h=8*f.BYTES_PER_ELEMENT,l=e/h|0,g=e-h*l,k=f;b=b===a.isVisibleBit;e<k.length*h||!b||(e=Math.max(l+1,Math.ceil(1.5*k.length)),e=Math.min(e,((c-1)/h|0)+1),f=new Uint32Array(e),f.set(k));
l<f.length&&(f[l]=f[l]&~(1<<g)|(b?1:0)<<g);a.data=f;return a}function e(a,c){if(null==a)return!0;var d=a.isVisibleBit,e=a.data,b=8*e.BYTES_PER_ELEMENT;return c<e.length*b?p(d,e,c,b):!a.isVisibleBit}function f(a){return k.isSome(a.component)?a.component:-1}function l(a,c,d,b){e(c,b)&&h(a,d[b],d[b+1]-1)}function h(a,c,d){var e=0<a.length?a[a.length-1]:null;(e?e[1]:-1)>=c||a.push([c,d])}function d(a){void 0===a&&(a=!0);return{isVisibleBit:!a,data:new Uint32Array(0)}}function a(a,d){return!c(a,d,!1)}
function c(a,c,d){a=a||u;var e=a.data;a=d===a.isVisibleBit;d=t(c);if(0===e.length||0===d)return!a;var b=8*e.BYTES_PER_ELEMENT;if(e.length*b<d&&!a)return!0;var f=r[b];c=r[0];for(var h=0;h<e.length-1;h++)if(!a&&e[h]!==f||a&&e[h]!==c)return!0;f=e.length-1;d=r[(d-1)%b+1];return!a&&(e[f]&d)!==d||a&&(e[f]&d)!==c}function q(a){return 0<a.length}function p(a,c,d,e){var b=d/e|0;return 0!==(c[b]&1<<d-b*e)===a}function t(a){return Math.max(0,a.length-1)}Object.defineProperty(b,"__esModule",{value:!0});b.updateVisibility=
function(a,c,d,e){return g(a,t(c),d,e)};b.updateVisibilityWithCount=g;b.getVisibility=e;b.hideAllComponents=function(a){if(null==a)return d(!1);a.isVisibleBit=!0;for(var c=0;c<a.data.length;c++)a.data[c]=0;return a};b.unhideAllComponents=function(a){if(null==a)return null;a.isVisibleBit=!1;for(var c=0;c<a.data.length;c++)a.data[c]=0;return a};b.generateVisibleIndexRanges=function(a,c){var d;if(a)if(q(c))if(0===a.data.length)d=[],c=[[c[0],c[c.length-1]-1]],d=a.isVisibleBit?d:c;else{d=[];for(var e=
a.isVisibleBit,b=a.data,f=8*b.BYTES_PER_ELEMENT,h=b.length*f,l=t(c),g=!1,k=0;k<h&&k<l;k++){var r=p(e,b,k,f);if(r!==g){var m=c[k];r?d.push([m,0]):(g=d[d.length-1],g[1]=m-1);g=r}}a=!a.isVisibleBit;l>h&&a&&!g?d.push([c[h],c[l]-1]):g&&(g=d[d.length-1],g[1]=c[a?l:Math.min(l,h)]-1)}else d=[],d=a.isVisibleBit?d:null;else d=null;return d};b.addOccludee=function(a,c){a=a||[];a.push({id:c});return a};b.removeOccludee=function(a,c){if(!a)return a;a=a.filter(function(a){return a.id!==c});return 0===a.length?
null:a};b.addHighlight=function(a,c,d){a=a||[];c={component:c,id:d};a.push(c);d=f(c);for(var e=a.length-1;0<e&&d<f(a[e-1]);)c=[a[e],a[e-1]],a[e-1]=c[0],a[e]=c[1],--e;return a};b.removeHighlight=function(a,c){if(!a)return a;a=a.filter(function(a){return a.id!==c});return 0===a.length?null:a};b.generateHighlightedIndexRanges=function(c,d,e){if(!d)return null;if(!q(e))return c&&c.isVisibleBit?null:d.map(function(a){return null});for(var b=e[0],f=e[e.length-1]-1,g=[],p=a(c,e),r=0;r<d.length;++r){var m=
d[r].component;if(k.isSome(m))l(g,c,e,m);else if(p)h(g,b,f);else for(m=0;m<t(e);++m)l(g,c,e,m)}return 0<g.length?g:null};b.hasHighlights=function(c,d,e){if(!d)return!1;if(!q(e))return c&&c.isVisibleBit?!1:0<d.length;c=a(c,e);for(var b=0;b<d.length;b++)if(k.isSome(d[b].component)||c||0<t(e))return!0;return!1};b.defaultVisibilities=d;b.isAllVisible=a;b.isAllHidden=function(a,d){return!c(a,d,!0)};var u=d();b.createOffsets=function(a){return a instanceof Uint32Array?a:new Uint32Array(a)};b.hasComponents=
q;var r=[];for(n=0;65>n;n++)r.push(Math.pow(2,n)-1);b.componentCount=t;b.componentFind=function(a,c){a=m.binaryIndexOf(a,c,!0);return 0<=a?a:null}})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","../../support/geometryUtils/triangle"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});var e=1,f=null,l=new Uint32Array([0]);b.generateDefaultIndexArray=function(a){if(1===
a)return l;if(a>e||null==f){for(;a>e;)e*=2;f=new Uint32Array(e);for(var c=0;c<e;c++)f[c]=c}return new Uint32Array(f.buffer,0,a)};b.computeAttachmentOriginTriangles=function(e,b,f){if(!e)return!1;var h=e.strideIdx,l=e.offsetIdx;e=e.data;m.vec3.set(f,0,0,0);m.vec3.set(q,0,0,0);for(var k=0,p=0,t=0;t<b.length-2;t+=3){var u=b[t+0]*h+l,A=b[t+1]*h+l,B=b[t+2]*h+l;m.vec3.set(d,e[u+0],e[u+1],e[u+2]);m.vec3.set(a,e[A+0],e[A+1],e[A+2]);m.vec3.set(c,e[B+0],e[B+1],e[B+2]);(u=g.areaPoints3d(d,a,c))?(m.vec3.add(d,
d,a),m.vec3.add(d,d,c),m.vec3.scale(d,d,1/3*u),m.vec3.add(f,f,d),k+=u):(m.vec3.add(q,q,d),m.vec3.add(q,q,a),m.vec3.add(q,q,c),p+=3)}return 0===p&&0===k?!1:0!==k?(m.vec3.scale(f,f,1/k),!0):0!==p?(m.vec3.scale(f,q,1/p),!0):!1};b.computeAttachmentOriginPoints=function(a,c,d){if(!a||!c)return!1;var e=a.strideIdx,b=a.offsetIdx;a=a.data;m.vec3.set(d,0,0,0);for(var f=-1,h=0,l=0;l<c.length;l++){var g=c[l]*e+b;f!==g&&(d[0]+=a[g+0],d[1]+=a[g+1],d[2]+=a[g+2],h++);f=g}1<h&&m.vec3.scale(d,d,1/h);return 0<h};b.computeAttachmentOriginLines=
function(c,e,b,f){if(!c)return!1;var h=c.strideIdx,l=c.offsetIdx;c=c.data;m.vec3.set(f,0,0,0);m.vec3.set(q,0,0,0);var g=0,k=0,p=e?e.length-1:c.length/h-1;b=p+(b?2:0);for(var r=0;r<b;r+=2){var t=r<p?r:p,u=r<p?r+1:0,t=(e?e[t]:t)*h+l,u=(e?e[u]:u)*h+l;d[0]=c[t+0];d[1]=c[t+1];d[2]=c[t+2];a[0]=c[u+0];a[1]=c[u+1];a[2]=c[u+2];m.vec3.scale(d,m.vec3.add(d,d,a),.5);u=m.vec3.dist(d,a);0<u?(m.vec3.add(f,f,m.vec3.scale(d,d,u)),g+=u):(m.vec3.add(q,q,d),k++)}return 0!==g?(m.vec3.scale(f,f,1/g),!0):0!==k?(m.vec3.scale(f,
q,1/k),!0):!1};var h=0;b.getNewId=function(){return h++};var d=k.vec3f64.create(),a=k.vec3f64.create(),c=k.vec3f64.create(),q=k.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/Util":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64".split(" "),
function(n,b,m,k,g,e,f,l,h){function d(a,c){if(!a)throw c=c||"assert",a=Error(c),a.stack&&console.log(a.stack),new u(c);}function a(a){for(var c in a)return c}function c(a,c){a[12]=c[0];a[13]=c[1];a[14]=c[2]}function q(a,c){void 0===c&&(c=0);for(var d=0,e=0;4>e;e++)d+=a[c+e]*x[e];return d}function p(a){return a-Math.floor(a)}Object.defineProperty(b,"__esModule",{value:!0});var t=h.vec4f64.create(),u=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+
this.message};return a}();b.AssertException=u;b.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex",TANGENT:"tangent"};b.assert=d;b.verify=function(a,c){a||console.warn("Verify failed: "+(c||"")+"\n"+Error("verify").stack)};b.encodeInt16=function(a){return m.clamp(Math.round(32767*a),-32767,32767)};b.encodeNormal=
function(a,c){var d=Math.abs(a[0]),e=Math.abs(a[1]),b=1/(d+e+Math.abs(a[2])),f=Math.min(a[2]*b,0);c[0]=(0>a[0]?-1:1)*(d*b-f);c[1]=(0>a[1]?-1:1)*(e*b-f)};b.fallbackIfUndefined=function(a,c){return void 0===a?c:a};b.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]};b.rgb2hex=function(a){var c=m.clamp(Math.round(255*a[0]),0,255),d=m.clamp(Math.round(255*a[1]),0,255);a=m.clamp(Math.round(255*a[2]),0,255);return"0x"+((c<<16)+(d<<8)+a).toString(16)};b.dec2hex=function(a){a=
a.toString(16);return"00000000".substr(0,8-a.length)+a};b.rayTriangle3D=function(a,c,d,e,b,h,l,g,k){void 0===k&&(k=f.vec3f64.create());var p=e[l]-d[h],q=e[l+1]-d[h+1],r=e[l+2]-d[h+2];e=b[g]-d[h];l=b[g+1]-d[h+1];b=b[g+2]-d[h+2];var t=c[1]*b-l*c[2],m=c[2]*e-b*c[0],u=c[0]*l-e*c[1];g=p*t+q*m+r*u;if(-1E-5<g&&1E-5>g)return!1;g=1/g;var v=a[0]-d[h],y=a[1]-d[h+1];a=a[2]-d[h+2];k[1]=g*(v*t+y*m+a*u);if(0>k[1]||1<k[1])return!1;d=y*r-q*a;a=a*p-r*v;p=v*q-p*y;k[2]=g*(c[0]*d+c[1]*a+c[2]*p);if(0>k[2]||1<k[1]+k[2])return!1;
k[0]=g*(e*d+l*a+b*p);return!0};b.rayBoxTest=function(a,c,d,e){var b,f=(d[0]-a[0])/c[0],h=(e[0]-a[0])/c[0];f>h&&(b=f,f=h,h=b);var l=(d[1]-a[1])/c[1],g=(e[1]-a[1])/c[1];l>g&&(b=l,l=g,g=b);if(f>g||l>h)return!1;l>f&&(f=l);g<h&&(h=g);d=(d[2]-a[2])/c[2];a=(e[2]-a[2])/c[2];d>a&&(b=d,d=a,a=b);if(f>a||d>h)return!1;a<h&&(h=a);return 0>h?!1:!0};b.rayRay2D=function(a,c,d,b,f,h){void 0===h&&(h=e.vec2f64.create());var l=(b[f]-d[f])*(c[0]-a[0])-(b[0]-d[0])*(c[f]-a[f]);if(0===l)return!1;d=((b[0]-d[0])*(a[f]-d[f])-
(b[f]-d[f])*(a[0]-d[0]))/l;h[0]=a[0]+d*(c[0]-a[0]);h[1]=a[f]+d*(c[f]-a[f]);return!0};b.project=function(a,c,e,b,f){f||(f=a);t[0]=a[0];t[1]=a[1];t[2]=a[2];t[3]=1;l.vec4.transformMat4(t,t,c);2<f.length&&(f[2]=-t[2]);l.vec4.transformMat4(t,t,e);d(0!==t[3]);f[0]=t[0]/t[3];f[1]=t[1]/t[3];f[2]=t[2]/t[3];f[0]=(.5*f[0]+.5)*b[2]+b[0];f[1]=(.5*f[1]+.5)*b[3]+b[1]};b.getFirstObjectKey=a;b.getFirstObjectValue=function(c){return c[a(c)]};b.objectEmpty=function(a){for(var c in a)return!1;return!0};b.logWithBase=
function(a,c){return Math.log(a)/Math.log(c)};b.setMatrixTranslation=c;b.setMatrixTranslation3=function(a,c,d,e){a[12]=c;a[13]=d;a[14]=e};b.getMatrixTranslation=function(a,c){void 0===c&&(c=f.vec3f64.create());c[0]=a[12];c[1]=a[13];c[2]=a[14];return c};b.createTranslationMatrix=function(a,d){a=k.mat4.identity(a);c(a,d);return a};b.isTranslationMatrix=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};
b.fovx2fovy=function(a,c,d){return 2*Math.atan(d*Math.tan(.5*a)/c)};b.fovy2fovx=function(a,c,d){return 2*Math.atan(c*Math.tan(.5*a)/d)};b.fovx2fovd=function(a,c,d){return 2*Math.atan(Math.sqrt(c*c+d*d)*Math.tan(.5*a)/c)};b.fovy2fovd=function(a,c,d){return 2*Math.atan(Math.sqrt(c*c+d*d)*Math.tan(.5*a)/d)};b.fovd2fovx=function(a,c,d){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(c*c+d*d))};b.fovd2fovy=function(a,c,d){return 2*Math.atan(d*Math.tan(.5*a)/Math.sqrt(c*c+d*d))};b.packFloatRGBA=function(a,
c,d){void 0===d&&(d=0);a=m.clamp(a,0,w);for(var e=0;4>e;e++)c[d+e]=Math.floor(256*p(a*r[e]))};b.unpackFloatRGBA=q;var r=[1,256,65536,16777216],x=[1/256,1/65536,1/16777216,1/4294967296],w=q(new Uint8ClampedArray([255,255,255,255]));b.inverseProjectionInfo=function(a,c,d,e,b){0===a[11]?(e[0]=2/(c*a[0]),e[1]=2/(d*a[5]),e[2]=(1+a[12])/a[0],e[3]=(1+a[13])/a[5],g.vec2.set(b,0,1)):(e[0]=-2/(c*a[0]),e[1]=-2/(d*a[5]),e[2]=(1-a[8])/a[0],e[3]=(1-a[9])/a[5],g.vec2.set(b,1,0))}})},"esri/views/webgl/BufferObject":function(){define(["require",
"exports","../../core/has","../../core/typedArrayUtil"],function(n,b,m,k){return function(){function b(e,f,l,h,d){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=e;this._bufferType=f;this._usage=l;this._id=b._nextId++;this._glName=this._context.gl.createBuffer();m("esri-webgl-debug")&&e.instanceCounter.incrementCount(1);h&&this.setData(h,d)}b.createIndex=function(e,f,l,h){return new b(e,34963,f,l,h)};b.createVertex=function(e,
f,l){return new b(e,34962,f,l)};Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"bufferType",
{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});b.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),
m("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(1),this._context=null)};b.prototype.setData=function(e,b){if(e){if("number"===typeof e){if(0>e&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&b)switch(this._indexType=b,this._size=e,b){case 5123:e*=2;break;case 5125:e*=4}}else b=e.byteLength,k.isUint16Array(e)&&(b/=2,this._indexType=5123),k.isUint32Array(e)&&(b/=4,this._indexType=5125),this._size=b;b=this._context.getBoundVAO();this._context.bindVAO(null);
this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,e,this._usage);this._context.bindVAO(b)}};b.prototype.setSubData=function(e,b,l,h){void 0===b&&(b=0);void 0===l&&(l=0);if(e){(0>b||b>=this._size)&&console.error("offset is out of range!");var d=b,a=l,c=h,f=e.byteLength;k.isUint16Array(e)&&(f/=2,d*=2,a*=2,c*=2);k.isUint32Array(e)&&(f/=4,d*=4,a*=4,c*=4);void 0===h&&(h=f-1);l>=h&&console.error("end must be bigger than start!");b+l-h>this._size&&console.error("An attempt to write beyond the end of the buffer!");
b=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);l=this._context.gl;e=ArrayBuffer.isView(e)?e.buffer:e;l.bufferSubData(this._bufferType,d,e.slice(a,c));this._context.bindVAO(b)}};b._nextId=0;return b}()})},"esri/views/webgl/Texture":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/has","../../core/mathUtils"],function(n,b,m,k,g){return function(){function e(b,l,h){this._glName=this._context=null;this._id=-1;this._descriptor=
void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=b;this._descriptor=m({target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1},l);this._id=++e._nextId;k("esri-webgl-debug")&&b.instanceCounter.incrementCount(0);this.setData(h)}Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"descriptor",{get:function(){return this._descriptor},enumerable:!0,configurable:!0});e.prototype.dispose=function(){var e=this;if(this._context&&this._context.gl){if(this._glName){var b=this._context.gl;this._boundToUnits.forEach(function(b){e._context.bindTexture(null,b)});b.deleteTexture(this._glName);this._glName=null}k("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(0);this._context=null}};e.prototype.release=
function(){this.dispose()};e.prototype.resize=function(e,b){var f=this._descriptor;if(f.width!==e||f.height!==b)f.width=e,f.height=b,this.setData(null)};e.prototype.setData=function(b){var f=this._context.gl;this._glName||(this._glName=f.createTexture());void 0===b&&(b=null);null===b&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);var h=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var d=this._descriptor;e._validateTexture(d);
f.pixelStorei(f.UNPACK_ALIGNMENT,d.unpackAlignment);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,d.flipped?1:0);f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d.preMultiplyAlpha?1:0);var a=d.pixelFormat,c=d.internalFormat?d.internalFormat:a;if(b instanceof ImageData||b instanceof HTMLImageElement||b instanceof HTMLCanvasElement||b instanceof HTMLVideoElement){var g=b.width,k=b.height;b instanceof HTMLVideoElement&&(g=b.videoWidth,k=b.videoHeight);d.width&&d.height&&console.assert(g===d.width&&k===d.height);
f.texImage2D(f.TEXTURE_2D,0,c,a,d.dataType,b);d.hasMipmap&&this.generateMipmap();void 0===d.width&&(d.width=g);void 0===d.height&&(d.height=k)}else if(null!=d.width&&null!=d.height||console.error("Width and height must be specified!"),f.DEPTH24_STENCIL8&&c===f.DEPTH_STENCIL&&(c=f.DEPTH24_STENCIL8),g=d.width,k=d.height,null!=b&&"type"in b&&"compressed"===b.type){a=Math.round(Math.log(Math.max(g,k))/Math.LN2)+1;d.hasMipmap=d.hasMipmap&&a===b.levels.length;for(var t=0;;++t){f.compressedTexImage2D(f.TEXTURE_2D,
t,c,g,k,0,b.levels[Math.min(t,b.levels.length-1)]);if(1===g&&1===k||!d.hasMipmap)break;g=Math.max(1,g>>1);k=Math.max(1,k>>1)}}else if(b)f.texImage2D(f.TEXTURE_2D,0,c,g,k,0,a,d.dataType,b),d.hasMipmap&&this.generateMipmap();else for(t=0;;++t){f.texImage2D(f.TEXTURE_2D,t,c,g,k,0,a,d.dataType,null);if(1===g&&1===k||!d.hasMipmap)break;g=Math.max(1,g>>1);k=Math.max(1,k>>1)}e._applySamplingMode(f,this._descriptor);e._applyWrapMode(f,this._descriptor);e._applyAnisotropicFilteringParameters(this._context,
this._descriptor);this._context.bindTexture(h,0)};e.prototype.updateData=function(e,b,h,d,a,c){c||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var f=this._context.gl,l=this._descriptor,g=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>b||0>h||d>l.width||a>l.height||b+d>l.width||h+a>l.height)&&console.error("An attempt to update out of bounds of the texture!");f.pixelStorei(f.UNPACK_ALIGNMENT,
l.unpackAlignment);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,l.flipped?1:0);f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l.preMultiplyAlpha?1:0);c instanceof ImageData||c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement?f.texSubImage2D(f.TEXTURE_2D,e,b,h,l.pixelFormat,l.dataType,c):f.texSubImage2D(f.TEXTURE_2D,e,b,h,d,a,l.pixelFormat,l.dataType,c);this._context.bindTexture(g,0)};e.prototype.generateMipmap=function(){var b=this._descriptor;b.hasMipmap||(b.hasMipmap=
!0,e._validateTexture(b));9729===b.samplingMode?(this._samplingModeDirty=!0,b.samplingMode=9985):9728===b.samplingMode&&(this._samplingModeDirty=!0,b.samplingMode=9984);b=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var l=this._context.gl;l.generateMipmap(l.TEXTURE_2D);this._context.bindTexture(b,0)};e.prototype.setSamplingMode=function(b){b!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=b,e._validateTexture(this._descriptor),this._samplingModeDirty=!0)};e.prototype.setWrapMode=
function(b){b!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=b,e._validateTexture(this._descriptor),this._wrapModeDirty=!0)};e.prototype.applyChanges=function(){var b=this._context.gl,l=this._descriptor;this._samplingModeDirty&&(e._applySamplingMode(b,l),this._samplingModeDirty=!1);this._wrapModeDirty&&(e._applyWrapMode(b,l),this._wrapModeDirty=!1)};e.prototype.setBoundToUnit=function(e,b){b?this._boundToUnits.add(e):this._boundToUnits.delete(e)};e._validateTexture=function(e){(0>e.width||
0>e.height)&&console.error("Negative dimension parameters are not allowed!");g.isPowerOfTwo(e.width)&&g.isPowerOfTwo(e.height)||("number"===typeof e.wrapMode?33071!==e.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===e.wrapMode.s&&33071===e.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};e._applySamplingMode=function(e,b){var f=
b.samplingMode,d=b.samplingMode;if(9985===f||9987===f)f=9729,b.hasMipmap||(d=9729);else if(9984===f||9986===f)f=9728,b.hasMipmap||(d=9728);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,f);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,d)};e._applyWrapMode=function(e,b){"number"===typeof b.wrapMode?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,b.wrapMode),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,b.wrapMode)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,b.wrapMode.s),e.texParameteri(e.TEXTURE_2D,
e.TEXTURE_WRAP_T,b.wrapMode.t))};e._applyAnisotropicFilteringParameters=function(e,b){if(null!=b.maxAnisotropy){var f=e.capabilities.textureFilterAnisotropic;f&&(e=e.gl,e.texParameterf(e.TEXTURE_2D,f.TEXTURE_MAX_ANISOTROPY,b.maxAnisotropy))}};e._nextId=0;return e}()})},"esri/views/webgl/Util":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/compilerUtils"],function(n,b,m,k){function g(e){return e[0].stride}function e(e){switch(e){case 5126:return 4;case 5124:return 4;
case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw k.neverReached(e),Error("Unknown data type");}}function f(e){switch(e){case 6406:case 6409:return 1;case 6410:return 2;case 6407:return 3;case 6408:return 4;case 34041:return 4;case 33325:return 2;case 33326:return 4;case 35898:return 4;case 33327:return 4;case 33328:return 8;case 34842:return 8;case 34836:return 16;case 33189:return 2;case 34041:return 4;case 32854:return 2;case 36168:return 1;
default:k.neverReached(e)}return 0}function l(e){if(!e)return 0;if("colorAttachment"in e)return e.glName?l(e.colorAttachment)+l(e.depthStencilAttachment):0;if("descriptor"in e)return e.glName?l(e.descriptor):0;var d=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!d)return 0;var a="hasMipmap"in e&&e.hasMipmap?1.3:1;e=e.width*e.height;return f(d)*e*a}Object.defineProperty(b,"__esModule",{value:!0});b.vertexCount=function(e,d){return e.vertexBuffers[d].size/g(e.layout[d])};b.getStride=g;b.getBytesPerElement=
e;b.getTypedArrayConstructor=function(e){switch(e){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array;default:throw k.neverReached(e),Error("Unknown data type");}};b.addDescriptor=function(b,d,a,c,f,l){var h=e(c);if(0<b.length){var g=b[0].stride,k=g+h*a;b.forEach(function(a){return a.stride=k});b.push({name:d,count:a,type:c,offset:g,stride:k,normalized:f,
divisor:l})}else b.push({name:d,count:a,type:c,offset:0,stride:h*a,normalized:f,divisor:l})};b.hasAttribute=function(e,d){for(var a=0;a<e.length;a++)if(e[a].name===d)return!0;return!1};b.findAttribute=function(e,d){for(var a=0;a<e.length;a++)if(e[a].name===d)return e[a];return null};b.copyFramebufferToTexture=function(e,d,a,c,b){void 0===b&&(b=0);var f=e.getBoundFramebufferObject(),h=e.getBoundTexture(0);e.bindFramebuffer(d);e.bindTexture(a,0);e.gl.copyTexImage2D(e.gl.TEXTURE_2D,b,a.descriptor.pixelFormat,
c[0],c[1],c[2],c[3],0);e.gl.flush();e.bindFramebuffer(f);e.bindTexture(h,0)};b.setBaseInstanceOffset=function(e,d){var a={},c;for(c in e)a[c]=e[c].map(function(a){return a.divisor?m({},a,{baseInstance:d}):a});return a};b.bindVertexBufferLayout=function(e,d,a,c,b){var f=e.gl,h=e.capabilities.instancing;e.bindBuffer(a);for(e=0;e<c.length;e++){a=c[e];var l=d[a.name],g=(b?b:0+a.baseInstance?a.baseInstance:0)*a.stride;void 0===l&&console.error("There is no location for vertex attribute '"+a.name+"' defined.");
a.baseInstance&&!a.divisor&&console.error("Vertex attribute '"+a.name+"' uses baseInstanceOffset without divisor.");if(4>=a.count)f.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+g),f.enableVertexAttribArray(l),a.divisor&&0<a.divisor&&h&&h.vertexAttribDivisor(l,a.divisor);else if(9===a.count)for(var k=0;3>k;k++)f.vertexAttribPointer(l+k,3,a.type,a.normalized,a.stride,a.offset+12*k+g),f.enableVertexAttribArray(l+k),a.divisor&&0<a.divisor&&h&&h.vertexAttribDivisor(l+k,a.divisor);
else if(16===a.count)for(k=0;4>k;k++)f.vertexAttribPointer(l+k,4,a.type,a.normalized,a.stride,a.offset+16*k+g),f.enableVertexAttribArray(l+k),a.divisor&&0<a.divisor&&h&&h.vertexAttribDivisor(l+k,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}};b.unbindVertexBufferLayout=function(e,d,a,c){var b=e.gl,f=e.capabilities.instancing;e.bindBuffer(a);for(a=0;a<c.length;a++){var h=c[a],l=d[h.name];if(4>=h.count)b.disableVertexAttribArray(l),h.divisor&&0<h.divisor&&f&&
f.vertexAttribDivisor(l,0);else if(9===h.count)for(var g=0;3>g;g++)b.disableVertexAttribArray(l+g),h.divisor&&0<h.divisor&&f&&f.vertexAttribDivisor(l+g,0);else if(16===h.count)for(g=0;4>g;g++)b.disableVertexAttribArray(l+g),h.divisor&&0<h.divisor&&f&&f.vertexAttribDivisor(l+g,0);else console.error("Unsupported vertex attribute element count: "+h.count)}e.unbindBuffer(34962)};b.getBytesPerElementFormat=f;b.getGpuMemoryUsage=l})},"esri/views/webgl/VertexArrayObject":function(){define(["require","exports",
"../../core/has","./Util"],function(n,b,m,k){return function(){function b(e,f,l,h,d){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=e;this._layout=l;this._buffers=h;this._locations=f;d&&(this._indexBuffer=d);this._id=b._nextId++;m("esri-webgl-debug")&&e.instanceCounter.incrementCount(2)}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){var e=this;return Object.keys(this._buffers).reduce(function(b,l){return b+e._buffers[l].size},this._indexBuffer?this._indexBuffer.size:
0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});b.prototype.dispose=function(e){void 0===e&&(e=!0);if(this._context){var b=this._context.capabilities.vao;b&&this._glName&&(b.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);
if(e){for(var l in this._buffers)this._buffers[l].dispose(),delete this._buffers[l];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}m("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(2);this._context=null}};b.prototype.initialize=function(){if(!this._initialized){var e=this._context.capabilities.vao;if(e){var b=e.createVertexArray();e.bindVertexArray(b);this._bindLayout();e.bindVertexArray(null);this._glName=b}this._initialized=!0}};b.prototype.bind=function(){this.initialize();
var e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};b.prototype._bindLayout=function(){var e=this._buffers,b=!!this._context.capabilities.vao,l=this._layout,h=this._indexBuffer;e||console.error("Vertex buffer dictionary is empty!");var d=this._context.gl,a;for(a in e){var c=e[a];c||console.error("Vertex buffer is uninitialized!");var g=l[a];g||console.error("Vertex element descriptor is empty!");k.bindVertexBufferLayout(this._context,
this._locations,c,g)}h&&(b?d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,h.glName):this._context.bindBuffer(h))};b.prototype.unbind=function(){this.initialize();var e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()};b.prototype._unbindLayout=function(){var e=this._buffers,b=this._layout;e||console.error("Vertex buffer dictionary is empty!");for(var l in e){var h=e[l];h||console.error("Vertex buffer is uninitialized!");k.unbindVertexBufferLayout(this._context,this._locations,h,
b[l])}(e=this._indexBuffer)&&this._context.unbindBuffer(e.bufferType)};b._nextId=0;return b}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ./atmosphereUtils ./RealisticAtmosphereTechnique ../support/earthUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(c,d){this._view=c;this.canRender=!0;this._skyslot=14;this._hazeSlot=15;this._renderData={texDepth:h.vec2f64.create(),cameraPosition:a.vec3f64.create(),cameraUp:a.vec3f64.create(),cameraRight:a.vec3f64.create(),cameraDir:a.vec3f64.create(),halfSizeNearPlane:h.vec2f64.create(),cameraCenterOffset:h.vec2f64.create(),heightParameters:q.vec4f64.create(),atmosphereParameters1:q.vec4f64.create(),
atmosphereParameters2:q.vec4f64.create(),atmosphereParameters3:a.vec3f64.create(),invWavelength:y,invWavelengthScaled:A,radii:h.vec2f64.create(),scale:0,scaleDepth:B,lowerAlphaBlendBound:0,scaleOverScaleDepth:0,oneOverScaleDepth:0,scaleDepthBlue:C,oneOverScaleDepthBlue:E,scaleOverScaleDepthBlue:0,g:G,g2:G*G,miePhaseCoefficients:H,nearFar:h.vec2f64.create(),cameraHeight:0,cameraHeightSq:0,C:0,CSur:0,innerFadeDistance:0,altitudeFade:0};this._lowerElevationBoundRadius=0;this._earthRadius=u.earthRadius;
this._updateRadius(u.earthRadius);this._techniqueRepository=d;this._atmosphereTechniqueConfig=new t.RealisticAtmosphereTechniqueConfiguration}b.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);this._vao&&(this._vao.dispose(),this._vao=null)};b.prototype.when=function(){return e.resolve()};b.prototype.initializeRenderContext=function(a){var c=this;a=a.rctx;this._handles=new g;this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,
tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,context:"ground"});this._handles.add(f.on(this._view,"basemapTerrain","elevation-change",function(a){return c._updateElevation(a)},function(){return c._updateElevation()}));this._handles.add(f.on(this._view,"basemapTerrain","elevation-bounds-change",function(){return c._updateVisibleElevationBounds()},function(){return c._updateVisibleElevationBounds()}));this._atmosphereTechniqueConfig.haze=!1;this._atmosphereTechnique=
this._techniqueRepository.acquireAndReleaseExisting(t.RealisticAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereTechnique);this._atmosphereTechniqueConfig.haze=!0;this._atmosphereHazeTechnique=this._techniqueRepository.acquireAndReleaseExisting(t.RealisticAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereHazeTechnique);this._vao=this._createVertexArrayObject(a)};b.prototype.uninitializeRenderContext=function(){this.destroy()};b.prototype.render=function(a){if(a.slot!==
this._hazeSlot&&a.slot!==this._skyslot||0!==a.pass)return!1;this._update(a.camera);a.slot===this._skyslot&&this._renderSky(a);a.slot===this._hazeSlot&&this._renderHaze(a);return!0};b.prototype._renderSky=function(a){var c=a.rctx,d=this._atmosphereTechnique.program;c.bindProgram(d);this._atmosphereTechnique.bindPipelineState(c);d.setUniform3fv("atmosphereParameters3",this._renderData.atmosphereParameters3);this._renderCommon(d,a)};b.prototype._renderHaze=function(a){var c=this,d=a.rctx,e=a.offscreenRenderingHelper,
b=this._atmosphereHazeTechnique.program;d.bindProgram(b);this._atmosphereHazeTechnique.bindPipelineState(d);e.renderDepthDetached(function(){d.bindTexture(e.depthTexture,0);b.setUniform1i("depthTex",0);c._renderCommon(b,a)})};b.prototype._renderCommon=function(a,c){var d=c.rctx;a.setUniform3fv("invWavelength",this._renderData.invWavelength);a.setUniform3fv("invWavelengthScaled",this._renderData.invWavelengthScaled);c.scenelightingData.setLightDirectionUniform(a);a.setUniform4fv("heightParameters",
this._renderData.heightParameters);a.setUniform3fv("cameraPosition",this._renderData.cameraPosition);a.setUniform3fv("cameraUp",this._renderData.cameraUp);a.setUniform3fv("cameraRight",this._renderData.cameraRight);a.setUniform3fv("cameraDir",this._renderData.cameraDir);a.setUniform2fv("nearFar",this._renderData.nearFar);a.setUniform2fv("halfSizeNearPlane",this._renderData.halfSizeNearPlane);a.setUniform2fv("cameraCenterOffset",this._renderData.cameraCenterOffset);a.setUniform2fv("radii",this._renderData.radii);
a.setUniform4fv("atmosphereParameters1",this._renderData.atmosphereParameters1);a.setUniform4fv("atmosphereParameters2",this._renderData.atmosphereParameters2);a.setUniform1f("innerFadeDistance",this._renderData.innerFadeDistance);a.setUniform1f("altitudeFade",this._renderData.altitudeFade);d.bindVAO(this._vao);a.assertCompatibleVertexAttributeLocations(this._vao);d.drawArrays(5,0,4)};b.prototype._createVertexArrayObject=function(a){var c=D.createBuffer(4);c.position.setVec(0,[-1,-1,1]);c.position.setVec(1,
[1,-1,1]);c.position.setVec(2,[-1,1,1]);c.position.setVec(3,[1,1,1]);c.uv0.setVec(0,[0,0]);c.uv0.setVec(1,[1,0]);c.uv0.setVec(2,[0,1]);c.uv0.setVec(3,[1,1]);return new z(a,w.Default3D,{geometry:r.glLayout(D)},{geometry:v.createVertex(a,35044,c.buffer)})};b.prototype._adjustRadiusForTesselation=function(a){return a*Math.cos(Math.PI/Math.pow(2,4)/16)};b.prototype._updateElevation=function(a){a=a?a.tile:this._view.basemapTerrain.rootTiles[0];0===a.lij[0]&&(a=this._adjustRadiusForTesselation(u.earthRadius+
a.elevationBounds[0]),a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._earthRadius=-1,this._updateVisibleElevationBounds()))};b.prototype._updateVisibleElevationBounds=function(){var a=this._adjustRadiusForTesselation(u.earthRadius+this._view.basemapTerrain.elevationBounds.min);(0>this._earthRadius||a<this._earthRadius)&&this._updateRadius(a)};b.prototype._updateRadius=function(a){this._earthRadius=a;var e=a/10*10.25,b=1/(e-a),f=b/B,h=b/C,g=.3*(e-a)+a,k=this._renderData;
c.vec4.set(k.atmosphereParameters1,b,B,f,F);c.vec4.set(k.atmosphereParameters2,G,C,h,E);d.vec3.set(k.atmosphereParameters3,G*G,H,g);l.vec2.set(k.radii,a,e);k.scale=b;k.lowerAlphaBlendBound=g;k.scaleOverScaleDepth=f;k.scaleOverScaleDepthBlue=h;e=p.INNER_ATMOSPHERE_DEPTH;k.innerFadeDistance=2*Math.sqrt((2*a-e)*e)};b.prototype._update=function(a){a&&(d.vec3.negate(this._renderData.cameraDir,a.viewForward),d.vec3.copy(this._renderData.cameraUp,a.viewUp),d.vec3.copy(this._renderData.cameraRight,a.viewRight),
this._renderData.cameraHeight=d.vec3.length(a.eye),this._renderData.cameraHeightSq=this._renderData.cameraHeight*this._renderData.cameraHeight,this._renderData.C=this._renderData.cameraHeightSq-this._renderData.radii[1]*this._renderData.radii[1],this._renderData.CSur=this._renderData.cameraHeightSq-this._renderData.radii[0]*this._renderData.radii[0],this._renderData.heightParameters=q.vec4f64.fromValues(this._renderData.cameraHeight,this._renderData.cameraHeightSq,this._renderData.C,this._renderData.CSur),
d.vec3.copy(this._renderData.cameraPosition,a.eye),l.vec2.set(this._renderData.halfSizeNearPlane,Math.tan(a.fovX/2)/(a.width/a.fullWidth),Math.tan(a.fovY/2)/(a.height/a.fullHeight)),l.vec2.set(this._renderData.cameraCenterOffset,(a.padding[3]+a.width/2)/a.fullWidth-.5,(a.padding[2]+a.height/2)/a.fullHeight-.5),l.vec2.set(this._renderData.nearFar,a.near,a.far),this._renderData.altitudeFade=p.computeInnerAltitudeFade(this._renderData.cameraHeight-this._earthRadius))};b.isSupported=function(a){return a.rctx.capabilities.depthTexture};
return b}();b.RealisticAtmosphere=n;b=.02*Math.PI;n=.004*Math.PI;var y=a.vec3f64.fromValues(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,4)),A=a.vec3f64.clone(y);d.vec3.scale(A,A,b);d.vec3.add(A,A,a.vec3f64.fromValues(n,n,n));var B=.25,C=.05,F=1/B,E=1/C,G=-.99999,H=(1-G*G)/(2+G*G)*1.5,D=x.newLayout().vec3f("position").vec2f("uv0")})},"esri/views/3d/environment/atmosphereUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.computeInnerAltitudeFade=
function(b){return Math.min(1,Math.max(0,(b-1E5)/9E5))};b.INNER_ATMOSPHERE_DEPTH=1E4})},"esri/views/3d/environment/RealisticAtmosphereTechnique":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../environment/RealisticAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});g=function(b){function h(){return null!==b&&b.apply(this,arguments)||this}m(h,b);h.prototype.initializeProgram=function(c){var e=h.shader.get().build({haze:this.configuration.haze});return new a(c.rctx,e.generateSource("vertex"),e.generateSource("fragment"),d.Default3D)};h.prototype.initializePipeline=function(){return this.configuration.haze?c.makePipelineState({blending:c.separateBlendingParams(1,0,769,1),colorWrite:c.defaultColorWriteParams}):
c.makePipelineState({blending:c.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:c.defaultColorWriteParams})};h.shader=new f.ReloadableShaderModule(e,"../environment/RealisticAtmosphere.glsl",n);return h}(l.ShaderTechnique);b.RealisticAtmosphereTechnique=g;g=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.haze=!1;return c}m(c,a);k([h.parameter()],c.prototype,"haze",void 0);return c}(h.ShaderTechniqueConfiguration);b.RealisticAtmosphereTechniqueConfiguration=
g})},"esri/views/3d/environment/RealisticAtmosphere.glsl":function(){define("require exports ../../../core/tsSupport/makeTemplateObjectHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderModules/ShaderBuilder".split(" "),function(n,b,m,k,g,e,f,l,h){Object.defineProperty(b,
"__esModule",{value:!0});b.build=function(b){var g=new h.ShaderBuilder;g.attributes.add("position","vec3");g.attributes.add("uv0","vec2");g.varyings.add("worldRay","vec3");g.varyings.add("vtc","vec2");b.haze&&g.varyings.add("eyeDir","vec3");g.vertex.uniforms.add("halfSizeNearPlane","vec2").add("cameraUp","vec3").add("cameraRight","vec3").add("cameraDir","vec3").add("cameraCenterOffset","vec2");g.vertex.code.add(l.glsl(d||(d=m(["\n    void main(void) {\n      vec3 v3Pos \x3d position;\n      vtc \x3d uv0;\n      vec2 rayvtc \x3d uv0 - cameraCenterOffset;\n      ",
"\n      worldRay \x3d eyeDir.z * cameraDir + eyeDir.y * cameraUp + eyeDir.x * cameraRight;\n      gl_Position \x3d vec4(v3Pos, 1.0);\n    }\n  "],["\n    void main(void) {\n      vec3 v3Pos \x3d position;\n      vtc \x3d uv0;\n      vec2 rayvtc \x3d uv0 - cameraCenterOffset;\n      ","\n      worldRay \x3d eyeDir.z * cameraDir + eyeDir.y * cameraUp + eyeDir.x * cameraRight;\n      gl_Position \x3d vec4(v3Pos, 1.0);\n    }\n  "])),b.haze?"eyeDir \x3d vec3((2.0 * halfSizeNearPlane * rayvtc) - halfSizeNearPlane, -1.0);":
"vec3 eyeDir \x3d vec3((2.0 * halfSizeNearPlane * rayvtc) - halfSizeNearPlane, -1.0);"));g.fragment.uniforms.add("lightingMainDirection","vec3").add("invWavelength","vec3").add("invWavelengthScaled","vec3").add("radii","vec2").add("atmosphereParameters1","vec4").add("atmosphereParameters2","vec4").add("cameraPosition","vec3").add("nearFar","vec2").add("heightParameters","vec4");b.haze?g.fragment.uniforms.add("depthTex","sampler2D"):g.fragment.uniforms.add("atmosphereParameters3","vec3").add("innerFadeDistance",
"float").add("altitudeFade","float");g.include(f.RgbaFloatEncoding);g.include(e.ColorConversion,{stages:1});g.fragment.code.add(l.glsl(a||(a=m(["\n  // Atmosphere\n  const float krESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\n  const float kmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\n\n  // The inner (planetary) radius\n  #define innerRadius radii[0]\n  // The outer (atmosphere) radius\n  #define outerRadius radii[1]\n\n  // Atmosphere parameters:\n\n  // shellScale:               1.0 / (outerRadius - innerRadius)\n  #define shellScale atmosphereParameters1.x\n\n  // shellDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  // scaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  #define shellDepth vec2(atmosphereParameters1.y, atmosphereParameters2.y)\n\n  // scaleOverScaleDepth:      scale / shellDepth\n  // scaleOverScaleDepthBlue:  scale / scaleDepthBlue\n  #define scaleOverScaleDepth vec2(atmosphereParameters1.z, atmosphereParameters2.z)\n\n  // oneOverScaleDepth:        1.0 / shellDepth\n  // oneOverScaleDepthBlue;    1.0 / scaleDepthBlue\n  #define oneOverScaleDepth vec2(atmosphereParameters1.w, atmosphereParameters2.w)\n  "],
["\n  // Atmosphere\n  const float krESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\n  const float kmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\n\n  // The inner (planetary) radius\n  #define innerRadius radii[0]\n  // The outer (atmosphere) radius\n  #define outerRadius radii[1]\n\n  // Atmosphere parameters:\n\n  // shellScale:               1.0 / (outerRadius - innerRadius)\n  #define shellScale atmosphereParameters1.x\n\n  // shellDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  // scaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  #define shellDepth vec2(atmosphereParameters1.y, atmosphereParameters2.y)\n\n  // scaleOverScaleDepth:      scale / shellDepth\n  // scaleOverScaleDepthBlue:  scale / scaleDepthBlue\n  #define scaleOverScaleDepth vec2(atmosphereParameters1.z, atmosphereParameters2.z)\n\n  // oneOverScaleDepth:        1.0 / shellDepth\n  // oneOverScaleDepthBlue;    1.0 / scaleDepthBlue\n  #define oneOverScaleDepth vec2(atmosphereParameters1.w, atmosphereParameters2.w)\n  "]))));
b.haze||g.fragment.code.add(l.glsl(c||(c=m(["\n      #define g atmosphereParameters2.x\n      #define gSq atmosphereParameters3.x\n      #define miePhaseCoefficients atmosphereParameters3.y\n      #define lowerAlphaBlendBound atmosphereParameters3.z\n    "],["\n      #define g atmosphereParameters2.x\n      #define gSq atmosphereParameters3.x\n      #define miePhaseCoefficients atmosphereParameters3.y\n      #define lowerAlphaBlendBound atmosphereParameters3.z\n    "]))));g.fragment.code.add(l.glsl(q||
(q=m(["\n  // The camera's current height\n  #define cameraHeight heightParameters[0]\n  // cameraHeight^2\n  #define cameraHeightSq heightParameters[1]\n  // cameraHeightSq - outerRadiusSq; // C \x3d ||o-c||^2 - r^2\n  #define C heightParameters[2]\n  // cameraHeightSq - (innerRadiusSq - 63756370000.0); // C \x3d ||o-c||^2 - r^2\n  #define CSur heightParameters[3]\n\n  ","\n    // Loop constants for integral approximation\n    const float samples \x3d 5.0;\n    const int maxSamples \x3d 5;\n\n    // ToneMapping operators\n    vec3 expTM(vec3 inputColor,float _exposure) {\n        return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);\n    }\n\n    // Approximation for inner integral based on a radii ratio of 10.25:10\n    float scale(float _cos) {\n      float x \x3d 1.0 - _cos;\n      return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));\n    }\n\n    void main() {\n      // Obtain ray from Camera\n      vec3 worldSpaceRay \x3d normalize(worldRay);\n\n      // Compute Atmosphere intersection; i.e. ray/sphere intersection\n      float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\n      float det \x3d B * B - 4.0 * C; // det \x3d B^2 - 4.0* C\n\n      // idealized sphere intersection to discard early some pixels\n      float detSur \x3d B * B - 4.0 * CSur; // det \x3d B^2 - 4.0* C\n\n      // the minimal sample start position:\n      // at the camera by default, on the earth radius surface if the camera is underground.\n      float minRayStart \x3d 0.0;\n  "],
["\n  // The camera's current height\n  #define cameraHeight heightParameters[0]\n  // cameraHeight^2\n  #define cameraHeightSq heightParameters[1]\n  // cameraHeightSq - outerRadiusSq; // C \x3d ||o-c||^2 - r^2\n  #define C heightParameters[2]\n  // cameraHeightSq - (innerRadiusSq - 63756370000.0); // C \x3d ||o-c||^2 - r^2\n  #define CSur heightParameters[3]\n\n  ","\n    // Loop constants for integral approximation\n    const float samples \x3d 5.0;\n    const int maxSamples \x3d 5;\n\n    // ToneMapping operators\n    vec3 expTM(vec3 inputColor,float _exposure) {\n        return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);\n    }\n\n    // Approximation for inner integral based on a radii ratio of 10.25:10\n    float scale(float _cos) {\n      float x \x3d 1.0 - _cos;\n      return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));\n    }\n\n    void main() {\n      // Obtain ray from Camera\n      vec3 worldSpaceRay \x3d normalize(worldRay);\n\n      // Compute Atmosphere intersection; i.e. ray/sphere intersection\n      float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\n      float det \x3d B * B - 4.0 * C; // det \x3d B^2 - 4.0* C\n\n      // idealized sphere intersection to discard early some pixels\n      float detSur \x3d B * B - 4.0 * CSur; // det \x3d B^2 - 4.0* C\n\n      // the minimal sample start position:\n      // at the camera by default, on the earth radius surface if the camera is underground.\n      float minRayStart \x3d 0.0;\n  "])),
b.haze?"// Camera HDR\n        const float exposure \x3d 1.5;\n        const vec3 oneOverGamma \x3d vec3(1.0); //Gamma \x3d 1.0":"const float exposure \x3d 2.0;\n        const vec3 oneOverGamma \x3d vec3(0.454545); // Gamma \x3d 2.2\n        vec3 reinhardTM(vec3 inputColor, float _exposure) {\n          vec3 intermediate \x3d inputColor * _exposure;\n          intermediate /\x3d ( 1.0 + intermediate );\n          return pow(intermediate, oneOverGamma);\n        }\n        "));b.haze||g.fragment.code.add(l.glsl(p||
(p=m(["\n      float surfaceBlend \x3d 0.0;\n      vec4 surfaceColor \x3d vec4(0.0);\n      if (detSur \x3e\x3d 0.0) {\n        float nearSurface \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\n        float farSurface \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\n\n        if (nearSurface \x3d\x3d 0.0) {\n          minRayStart \x3d farSurface;\n        }\n\n        // Compute lighting at the point where the ray enters the earth surface\n        // Lighting computation is copied from the terrain shader.\n        vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurface;\n        float lightAngle \x3d dot(-lightingMainDirection, normalize(vPos));\n        float brightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));\n\n        // Make the surface transparent based on altitude\n        surfaceColor \x3d vec4(brightness, brightness, brightness, 1.0 - altitudeFade);\n\n        // Fade based on the distance the ray travels below the earth surface\n        float relDist \x3d (farSurface - nearSurface) / innerFadeDistance;\n\n        // early exit\n        if (relDist \x3e 1.0) {\n          gl_FragColor \x3d surfaceColor;\n          return;\n        }\n\n        surfaceBlend \x3d smoothstep(0.0, 1.0, relDist * relDist);\n      }\n    "],
["\n      float surfaceBlend \x3d 0.0;\n      vec4 surfaceColor \x3d vec4(0.0);\n      if (detSur \x3e\x3d 0.0) {\n        float nearSurface \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\n        float farSurface \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\n\n        if (nearSurface \x3d\x3d 0.0) {\n          minRayStart \x3d farSurface;\n        }\n\n        // Compute lighting at the point where the ray enters the earth surface\n        // Lighting computation is copied from the terrain shader.\n        vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurface;\n        float lightAngle \x3d dot(-lightingMainDirection, normalize(vPos));\n        float brightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));\n\n        // Make the surface transparent based on altitude\n        surfaceColor \x3d vec4(brightness, brightness, brightness, 1.0 - altitudeFade);\n\n        // Fade based on the distance the ray travels below the earth surface\n        float relDist \x3d (farSurface - nearSurface) / innerFadeDistance;\n\n        // early exit\n        if (relDist \x3e 1.0) {\n          gl_FragColor \x3d surfaceColor;\n          return;\n        }\n\n        surfaceBlend \x3d smoothstep(0.0, 1.0, relDist * relDist);\n      }\n    "]))));
g.fragment.code.add(l.glsl(t||(t=m(["\n    if (det \x3e\x3d 0.0) {\n    ","\n    float rayStart \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\n    ","\n\n    float scatterDistance; // calculate its scattering offset\n    // Calculate the ray's starting position\n    if (rayStart \x3c minRayStart)\n    { // ray starts from camera or inner radius sphere to far\n      rayStart \x3d minRayStart;\n      ","\n    }\n    ","\n    // Initialize the scattering loop variables\n    vec3 start \x3d cameraPosition + worldSpaceRay * rayStart;\n  "],
["\n    if (det \x3e\x3d 0.0) {\n    ","\n    float rayStart \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\n    ","\n\n    float scatterDistance; // calculate its scattering offset\n    // Calculate the ray's starting position\n    if (rayStart \x3c minRayStart)\n    { // ray starts from camera or inner radius sphere to far\n      rayStart \x3d minRayStart;\n      ","\n    }\n    ","\n    // Initialize the scattering loop variables\n    vec3 start \x3d cameraPosition + worldSpaceRay * rayStart;\n  "])),
b.haze?"\n          float depthSample \x3d texture2D(depthTex, vtc).r;\n\n          float zNear \x3d nearFar[0];\n          float zFar \x3d nearFar[1];\n\n          // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\n          float zNorm \x3d 2.0 * depthSample - 1.0;\n          float linDepth \x3d 2.0 * zNear * zFar /\n            (zFar + zNear - zNorm * (zFar - zNear));\n\n          float rayEnd;\n          float altitudeAlpha \x3d 1.0;\n\n          // find intersections with ground, but only between the near and far\n          // clipping planes.\n          if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\n            vec3 cameraSpaceRay \x3d normalize(eyeDir);\n            cameraSpaceRay /\x3d cameraSpaceRay.z;\n            cameraSpaceRay *\x3d linDepth;\n\n            float cameraSpaceRayLength \x3d length(cameraSpaceRay);\n\n            vec3 world \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n            float worldRadiusSq \x3d dot(world, world);\n\n            // Handle tall structures:\n            // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\n            float transitionStart \x3d innerRadius + 20000.0;\n            float transitionHeight \x3d 25000.0;\n            float transitionEnd \x3d transitionStart + transitionHeight;\n\n            float edge0 \x3d transitionStart * transitionStart;\n            float edge1 \x3d transitionEnd * transitionEnd;\n\n            altitudeAlpha \x3d 1.0 - clamp((worldRadiusSq - edge0) / (edge1 - edge0), 0.0, 1.0);\n            rayEnd \x3d cameraSpaceRayLength;\n\n            if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\n              float nearSurface \x3d 0.5 * ( -B - sqrt(detSur) );\n              float interp \x3d clamp(((cameraHeight - innerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n              rayEnd \x3d mix(cameraSpaceRayLength, nearSurface, interp);\n            }\n          }":
"",b.haze?"float near \x3d abs(rayStart);\n        float far \x3d abs(rayEnd);":"float rayEnd \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere",b.haze?"":"// clamp to value at inner radius altitude\n          scatterDistance \x3d shellScale * min(0.0, innerRadius - cameraHeight);",b.haze?"":"else { // outside atmosphere\n          scatterDistance \x3d -1.0;\n        }"));b.haze&&g.fragment.code.add(l.glsl(u||(u=m(["\n      vec3 end \x3d cameraPosition + worldSpaceRay * rayEnd;\n\n      float endLength \x3d length(end);\n      //altitudeStart, altitudeEnd\n      vec2 altitudeInterval \x3d vec2(length(start) - innerRadius, endLength - innerRadius);\n\n      // for camera positions below altitude 0, invert the altitudes, to achieve\n      // a similar haze as above ground. Note that there is a small but visible change\n      // when the camera passes altitude 0.\n      if (altitudeInterval.x \x3c 0.0) {\n        altitudeInterval \x3d -altitudeInterval;\n      }\n\n      // computed for the original end point to get consistent light angles after possible inversions\n      float lightAngle \x3d dot(-lightingMainDirection, end) / endLength;\n\n      if (near \x3e far)\n      {\n        if (altitudeInterval.x \x3c altitudeInterval.y)\n        {\n          // Switch positive slopes for flipped rays\n          end \x3d cameraPosition + worldSpaceRay * rayStart;\n          start \x3d cameraPosition + worldSpaceRay * rayEnd;\n          worldSpaceRay *\x3d -1.0;\n          float tmp \x3d altitudeInterval.x;\n          altitudeInterval.x \x3d altitudeInterval.y;\n          altitudeInterval.y \x3d tmp;\n        }\n        else if (altitudeInterval.x \x3d\x3d altitudeInterval.y)\n        { // create minuscule fake slope for integration if the slope is zero\n          altitudeInterval.x +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\n          // slope for the camera function\n        }\n      }\n\n      // Calculate its scattering offset\n      // Assumes camera constrains of WSV 3.8\n      if (altitudeInterval.x \x3e outerRadius - innerRadius)\n      { // outside atmosphere\n        scatterDistance \x3d innerRadius - outerRadius;\n      } else\n      {\n        scatterDistance \x3d altitudeInterval.y - altitudeInterval.x;\n      }\n    "],
["\n      vec3 end \x3d cameraPosition + worldSpaceRay * rayEnd;\n\n      float endLength \x3d length(end);\n      //altitudeStart, altitudeEnd\n      vec2 altitudeInterval \x3d vec2(length(start) - innerRadius, endLength - innerRadius);\n\n      // for camera positions below altitude 0, invert the altitudes, to achieve\n      // a similar haze as above ground. Note that there is a small but visible change\n      // when the camera passes altitude 0.\n      if (altitudeInterval.x \x3c 0.0) {\n        altitudeInterval \x3d -altitudeInterval;\n      }\n\n      // computed for the original end point to get consistent light angles after possible inversions\n      float lightAngle \x3d dot(-lightingMainDirection, end) / endLength;\n\n      if (near \x3e far)\n      {\n        if (altitudeInterval.x \x3c altitudeInterval.y)\n        {\n          // Switch positive slopes for flipped rays\n          end \x3d cameraPosition + worldSpaceRay * rayStart;\n          start \x3d cameraPosition + worldSpaceRay * rayEnd;\n          worldSpaceRay *\x3d -1.0;\n          float tmp \x3d altitudeInterval.x;\n          altitudeInterval.x \x3d altitudeInterval.y;\n          altitudeInterval.y \x3d tmp;\n        }\n        else if (altitudeInterval.x \x3d\x3d altitudeInterval.y)\n        { // create minuscule fake slope for integration if the slope is zero\n          altitudeInterval.x +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\n          // slope for the camera function\n        }\n      }\n\n      // Calculate its scattering offset\n      // Assumes camera constrains of WSV 3.8\n      if (altitudeInterval.x \x3e outerRadius - innerRadius)\n      { // outside atmosphere\n        scatterDistance \x3d innerRadius - outerRadius;\n      } else\n      {\n        scatterDistance \x3d altitudeInterval.y - altitudeInterval.x;\n      }\n    "]))));
g.fragment.code.add(l.glsl(r||(r=m(["\n    vec2 opticalStartDepth \x3d exp(scatterDistance * oneOverScaleDepth);\n\n    float rayLength \x3d rayEnd - rayStart;\n    float sampleLength \x3d rayLength / samples;\n    float scaledLength \x3d sampleLength * shellScale;\n    vec3 sampleRay \x3d worldSpaceRay * sampleLength;\n    vec3 samplePoint \x3d start + sampleRay * 0.5;\n  "],["\n    vec2 opticalStartDepth \x3d exp(scatterDistance * oneOverScaleDepth);\n\n    float rayLength \x3d rayEnd - rayStart;\n    float sampleLength \x3d rayLength / samples;\n    float scaledLength \x3d sampleLength * shellScale;\n    vec3 sampleRay \x3d worldSpaceRay * sampleLength;\n    vec3 samplePoint \x3d start + sampleRay * 0.5;\n  "]))));
b.haze?g.fragment.code.add(l.glsl(x||(x=m(["\n      float cameraAngle \x3d dot(-worldSpaceRay, end) / length(end);\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth;\n\n      float scaledValues \x3d scale(lightAngle) + scaleCameraAngle;\n      vec2 scaledValuesDepth \x3d scaledValues * shellDepth;\n    "],["\n      float cameraAngle \x3d dot(-worldSpaceRay, end) / length(end);\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth;\n\n      float scaledValues \x3d scale(lightAngle) + scaleCameraAngle;\n      vec2 scaledValuesDepth \x3d scaledValues * shellDepth;\n    "])))):
g.fragment.code.add(l.glsl(w||(w=m(["\n      float cameraAngle \x3d dot(worldSpaceRay, start / length(start));\n      float angleMultiplier \x3d cameraAngle \x3e 0.0 ? cameraAngle : 0.0;\n\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth * shellDepth;\n    "],["\n      float cameraAngle \x3d dot(worldSpaceRay, start / length(start));\n      float angleMultiplier \x3d cameraAngle \x3e 0.0 ? cameraAngle : 0.0;\n\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth * shellDepth;\n    "]))));
g.fragment.code.add(l.glsl(v||(v=m(["\n    // Loop variables\n    vec3 frontColor \x3d vec3(0.0);\n    vec3 frontColorBlue \x3d vec3(0.0);\n    vec3 attenuate \x3d vec3(0.0);\n    vec3 attenuateBlue \x3d vec3(0.0);\n\n    // Now loop through the sample rays\n    for(int i\x3d0; i\x3cmaxSamples; i++) {\n      float height \x3d length(samplePoint);\n      float altitude \x3d abs(height - innerRadius);\n\n      vec2 depth \x3d exp(-altitude * scaleOverScaleDepth);\n  "],["\n    // Loop variables\n    vec3 frontColor \x3d vec3(0.0);\n    vec3 frontColorBlue \x3d vec3(0.0);\n    vec3 attenuate \x3d vec3(0.0);\n    vec3 attenuateBlue \x3d vec3(0.0);\n\n    // Now loop through the sample rays\n    for(int i\x3d0; i\x3cmaxSamples; i++) {\n      float height \x3d length(samplePoint);\n      float altitude \x3d abs(height - innerRadius);\n\n      vec2 depth \x3d exp(-altitude * scaleOverScaleDepth);\n  "]))));
b.haze?g.fragment.code.add(l.glsl(z||(z=m(["\n      vec2 scatter \x3d depth * scaledValuesDepth - cameraOffset;\n    "],["\n      vec2 scatter \x3d depth * scaledValuesDepth - cameraOffset;\n    "])))):g.fragment.code.add(l.glsl(y||(y=m(["\n      float lightAngle \x3d dot(-lightingMainDirection, samplePoint) / height;\n      float cameraAngle \x3d dot(worldSpaceRay, samplePoint) / height;\n      float tmpScaledValues \x3d scale(lightAngle) - scale(cameraAngle);\n      vec2 scatter \x3d cameraOffset + tmpScaledValues * depth * shellDepth;\n    "],
["\n      float lightAngle \x3d dot(-lightingMainDirection, samplePoint) / height;\n      float cameraAngle \x3d dot(worldSpaceRay, samplePoint) / height;\n      float tmpScaledValues \x3d scale(lightAngle) - scale(cameraAngle);\n      vec2 scatter \x3d cameraOffset + tmpScaledValues * depth * shellDepth;\n    "]))));g.fragment.code.add(l.glsl(A||(A=m(["\n      attenuate \x3d exp(-scatter.x * invWavelengthScaled);\n      attenuateBlue \x3d exp(-scatter.y * invWavelengthScaled);\n\n      frontColor +\x3d attenuate * depth.x;\n      frontColorBlue +\x3d attenuateBlue * depth.y;\n\n      samplePoint +\x3d sampleRay;\n    }\n\n    // Phase computation\n    // clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\n    float LdotR \x3d clamp(dot(-lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);\n    float LdotRSq \x3d LdotR * LdotR + 1.0;\n  "],
["\n      attenuate \x3d exp(-scatter.x * invWavelengthScaled);\n      attenuateBlue \x3d exp(-scatter.y * invWavelengthScaled);\n\n      frontColor +\x3d attenuate * depth.x;\n      frontColorBlue +\x3d attenuateBlue * depth.y;\n\n      samplePoint +\x3d sampleRay;\n    }\n\n    // Phase computation\n    // clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\n    float LdotR \x3d clamp(dot(-lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);\n    float LdotRSq \x3d LdotR * LdotR + 1.0;\n  "]))));
b.haze?g.fragment.code.add(l.glsl(B||(B=m(["\n      // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\n      vec3 colorCoefficients \x3d (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );\n\n      // Scaled Length is only applied afterwards to save multiplications\n      vec3 color \x3d colorCoefficients * frontColor;\n      vec3 colorBlue \x3d colorCoefficients * frontColorBlue;\n    "],["\n      // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\n      vec3 colorCoefficients \x3d (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );\n\n      // Scaled Length is only applied afterwards to save multiplications\n      vec3 color \x3d colorCoefficients * frontColor;\n      vec3 colorBlue \x3d colorCoefficients * frontColorBlue;\n    "])))):
g.fragment.code.add(l.glsl(C||(C=m(["\n      vec3 rayleighCoefficients \x3d (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;\n      float mieCoefficients \x3d scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);\n\n      // Calculate the attenuation factor for the ground\n      vec3 color \x3d rayleighCoefficients * frontColor + mieCoefficients * frontColor;\n      vec3 colorBlue \x3d rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;\n    "],
["\n      vec3 rayleighCoefficients \x3d (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;\n      float mieCoefficients \x3d scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);\n\n      // Calculate the attenuation factor for the ground\n      vec3 color \x3d rayleighCoefficients * frontColor + mieCoefficients * frontColor;\n      vec3 colorBlue \x3d rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;\n    "]))));g.fragment.code.add(l.glsl(F||
(F=m(["\n    // HDR to LDR conversion\n    vec3 ldrBlue \x3d expTM(colorBlue, 2.0 * exposure);\n    vec3 ldrRed \x3d expTM(color, exposure);\n\n    // mix reddish and blueish atmosphere\n    vec3 LDR \x3d mix(ldrBlue, ldrRed, 0.2);\n  "],["\n    // HDR to LDR conversion\n    vec3 ldrBlue \x3d expTM(colorBlue, 2.0 * exposure);\n    vec3 ldrRed \x3d expTM(color, exposure);\n\n    // mix reddish and blueish atmosphere\n    vec3 LDR \x3d mix(ldrBlue, ldrRed, 0.2);\n  "]))));b.haze?g.fragment.code.add(l.glsl(E||
(E=m(["\n      LDR *\x3d (1.0 - cameraAngle);\n      vec3 hsv \x3d rgb2hsv(LDR);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost haze saturation by 50%\n      LDR \x3d hsv2rgb(hsv);\n      vec3 finalColor \x3d LDR;\n      // when rendering we specify the blend functions such that\n      // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\n    "],["\n      LDR *\x3d (1.0 - cameraAngle);\n      vec3 hsv \x3d rgb2hsv(LDR);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost haze saturation by 50%\n      LDR \x3d hsv2rgb(hsv);\n      vec3 finalColor \x3d LDR;\n      // when rendering we specify the blend functions such that\n      // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\n    "])))):
g.fragment.code.add(l.glsl(G||(G=m(["\n      // reinhard tonemapper for looking upwards\n      vec3 ldrReinhard \x3d reinhardTM(color, exposure);\n      LDR +\x3d angleMultiplier * ldrReinhard;\n\n      // height dependent parameter to smooth out reddish atmosphere\n      float side \x3d (rayEnd + rayStart) * 0.5;\n      float atmoHeight \x3d sqrt(cameraHeightSq - side * side);\n      float h2 \x3d clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);\n\n      vec3 finalColor \x3d LDR * h2;\n      vec3 hsv \x3d rgb2hsv(finalColor);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost sky saturation by 50%\n      finalColor \x3d hsv2rgb(hsv);\n    "],
["\n      // reinhard tonemapper for looking upwards\n      vec3 ldrReinhard \x3d reinhardTM(color, exposure);\n      LDR +\x3d angleMultiplier * ldrReinhard;\n\n      // height dependent parameter to smooth out reddish atmosphere\n      float side \x3d (rayEnd + rayStart) * 0.5;\n      float atmoHeight \x3d sqrt(cameraHeightSq - side * side);\n      float h2 \x3d clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);\n\n      vec3 finalColor \x3d LDR * h2;\n      vec3 hsv \x3d rgb2hsv(finalColor);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost sky saturation by 50%\n      finalColor \x3d hsv2rgb(hsv);\n    "]))));
g.fragment.code.add(l.glsl(H||(H=m(["\n    ","\n      } else { // Outside Atmosphere\n        gl_FragColor \x3d vec4(0.0);\n      }\n    }\n  "],["\n    ","\n      } else { // Outside Atmosphere\n        gl_FragColor \x3d vec4(0.0);\n      }\n    }\n  "])),b.haze?"gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;":"float atmosStrength \x3d clamp((length(ldrRed) - 0.05) * 1.05, 0.0, 1.0);\n          gl_FragColor \x3d vec4(finalColor, atmosStrength * clamp(1.0 - ( atmoHeight - innerRadius ) / (outerRadius - innerRadius), 0.0, 1.0));\n          if (surfaceBlend \x3e 0.0) {\n            gl_FragColor \x3d mix(gl_FragColor, surfaceColor, surfaceBlend);\n          }"));
return g};var d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.ColorConversion=function(b,d){var a=[k.glsl(g||(g=m(["\n      vec4 premultiplyAlpha(vec4 v) {\n        return vec4(v.rgb * v.a, v.a);\n      }\n    "],["\n      vec4 premultiplyAlpha(vec4 v) {\n        return vec4(v.rgb * v.a, v.a);\n      }\n    "]))),
k.glsl(e||(e=m(["\n      vec3 rgb2hsv(vec3 c) {\n        vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n        vec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n        float d \x3d q.x - min(q.w, q.y);\n        float e \x3d 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n      }\n    "],["\n      vec3 rgb2hsv(vec3 c) {\n        vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n        vec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n        float d \x3d q.x - min(q.w, q.y);\n        float e \x3d 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n      }\n    "]))),
k.glsl(f||(f=m(["\n      vec3 hsv2rgb(vec3 c) {\n        vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n      }\n    "],["\n      vec3 hsv2rgb(vec3 c) {\n        vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n      }\n    "]))),k.glsl(l||
(l=m(["\n      float rgb2v(vec3 c) {\n        return max(c.x, max(c.y, c.z));\n      }\n    "],["\n      float rgb2v(vec3 c) {\n        return max(c.x, max(c.y, c.z));\n      }\n    "])))];switch(d.stages){case 0:a.forEach(function(a){return b.vertex.code.add(a)});break;case 1:a.forEach(function(a){return b.fragment.code.add(a)});break;default:a.forEach(function(a){return b.vertex.code.add(a)}),a.forEach(function(a){return b.fragment.code.add(a)})}};var g,e,f,l})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.RgbaFloatEncoding=function(e){var b=k.glsl(g||(g=m(["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT \x3d\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat \x3d 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS \x3d vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0-\x3e1 back to 0-\x3e255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "],
["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT \x3d\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat \x3d 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS \x3d vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0-\x3e1 back to 0-\x3e255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "])));
e.fragment.code.add(b);e.vertex.code.add(b)};var g})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Logger ../../../core/mathUtils ../../../core/mathUtils ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./atmosphereUtils ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/earthUtils ../support/imageUtils ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D){function I(a,c,d,e,b){var f=p.vec3.length(a),h=e*Math.sqrt(f*f-e*e)/f,l=b.silCircleV1,g=b.silCircleV2;p.vec3.scale(b.silCircleCenter,a,Math.sqrt(e*e-h*h)/f);p.vec3.cross(l,a,c);1>p.vec3.squaredLength(l)&&p.vec3.cross(l,a,d);p.vec3.scale(l,l,h/p.vec3.length(l));p.vec3.cross(g,l,a);p.vec3.scale(g,g,h/p.vec3.length(g));return h}function L(a,c,e,b){p.vec3.add(S,b.silCircleCenter,b.silCircleV2);p.vec3.scale(V,S,M);d.mat4.lookAt(P,c,
S,e);F.project(S,P,a.projectionMatrix,a.viewport);F.project(V,P,a.projectionMatrix,a.viewport);return p.vec3.distance(S,V)/a.height}var O=g.getLogger("esri.views.3d.environment.SimpleAtmosphere"),K=-u.INNER_ATMOSPHERE_DEPTH,N=(w.earthRadius+K)/w.earthRadius,Q=(w.earthRadius+0)/w.earthRadius,M=(w.earthRadius+3E5)/w.earthRadius,T=z.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);n=function(){function a(a,c){this.slot=14;this._renderData={texV:q.vec2f64.create(),
silCircleCenter:t.vec3f64.create(),silCircleV1:t.vec3f64.create(),silCircleV2:t.vec3f64.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeVaoCount=0;this._readyResolver=l.createResolver();this._readyController=l.createAbortController();this._techniqueRepository=c;this._atmosphereTechniqueConfig=new r.SimpleAtmosphereTechniqueConfiguration;this.view=a}Object.defineProperty(a.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!0,configurable:!0});a.prototype.when=
function(){return this._readyResolver.promise};a.prototype.initializeRenderContext=function(a){var c=this,d=a.rctx;this._cameraChangeHandle=h.init(this.view,"state.camera",function(){return a.requestRender()},!0);this._atmosphereTechniqueConfig.geometry=0;this._atmosphereConeTechnique=this._techniqueRepository.acquireAndReleaseExisting(r.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereConeTechnique);this._atmosphereTechniqueConfig.geometry=2;this._atmosphereUndergroundTechnique=
this._techniqueRepository.acquireAndReleaseExisting(r.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereUndergroundTechnique);this._vao=this._createRibbon(d);this._vaoCount=H.vertexCount(this._vao,"geometry");this._fadeVao=C.createQuadVAO(d);this._fadeVaoCount=H.vertexCount(this._fadeVao,"geometry");v.requestImage(x,{signal:this._readyController.signal}).then(function(e){c._texture=new G(d,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},e);a.requestRender();
c._readyController=null;c._readyResolver.resolve()}).catch(function(a){l.isAbortError(a)||O.error("Unable to initialize simple atmosphere: image request failed",a);c._readyResolver.reject()})};a.prototype.uninitializeRenderContext=function(){this.destroy()};a.prototype.destroy=function(){this._readyResolver.reject();this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=null);this._texture&&(this._texture.dispose(),this._texture=null);this._fadeVao&&(this._fadeVao.dispose(),
this._fadeVao=null);this._readyController&&(this._readyController.abort(),this._readyController=null)};a.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass)return!1;this._update(a.camera);var c=a.rctx;this._atmosphereConeTechnique.bindPipelineState(c);if(1>this._renderData.undergroundFadeAlpha){var d=this._atmosphereConeTechnique.program;c.bindProgram(d);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);d.setUniformMatrix4fv("view",a.camera.viewMatrix);d.setUniform3fv("silCircleCenter",
this._renderData.silCircleCenter);d.setUniform3fv("silCircleV1",this._renderData.silCircleV1);d.setUniform3fv("silCircleV2",this._renderData.silCircleV2);d.setUniform2fv("texV",this._renderData.texV);c.bindTexture(this._texture,0);d.setUniform1i("tex",0);a.scenelightingData.setLightDirectionUniform(d);d.setUniform1f("altitudeFade",this._renderData.altitudeFade);d.setUniform1f("innerScale",this._renderData.innerScale);c.bindVAO(this._vao);c.drawArrays(4,0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&
(d=this._atmosphereUndergroundTechnique.program,c.bindProgram(d),d.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),a.scenelightingData.setLightDirectionUniform(d),d.setUniform3fv("cameraPosition",a.camera.eye),c.bindVAO(this._fadeVao),c.drawArrays(5,0,this._fadeVaoCount));return!0};a.prototype._update=function(a){var d=t.vec3f64.create(),b=w.earthRadius,h=p.vec3.length(a.eye),l=h-b;this._renderData.undergroundFadeAlpha=0>l?Math.min(-l/5E3,1):0;var g=b+K,k=b+Math.max(50,
l);this._renderData.innerScale=k*k/(Math.sqrt(k*k-b*b)*Math.sqrt(k*k-g*g)+b*g)-1;this._renderData.altitudeFade=u.computeInnerAltitudeFade(l);p.vec3.scale(d,a.eye,(b+50)/h);I(d,a.center,a.up,b,this._renderData);d=L(a,d,a.up,this._renderData);h=T(l);g=.001953125;k=0+d*h*1;50<l&&(I(a.eye,a.center,a.up,b,this._renderData),a=L(a,a.eye,a.up,this._renderData),a=e.clamp((a-1.5)/(d-1.5),0,1),g=0+.001953125*a,k=0+1*f.lerp(1,d*h,a));c.vec2.set(this._renderData.texV,g,k)};a.prototype._createRibbon=function(a){var c=
new Float32Array(1155),d=new Uint32Array(1920);c[0]=0;c[1]=0;c[2]=-1;for(var e=0;128>e;e++){var b=9*e+3;c[b+0]=e;c[b+1]=N;c[b+2]=-1;c[b+3]=e;c[b+4]=Q;c[b+5]=0;c[b+6]=e;c[b+7]=M;c[b+8]=1;var b=3*e+1,f=127===e?1:b+3,h=15*e;d[h+0]=b;d[h+1]=b+1;d[h+2]=f+1;d[h+3]=f+1;d[h+4]=f;d[h+5]=b;d[h+6]=b+1;d[h+7]=b+2;d[h+8]=f+2;d[h+9]=f+2;d[h+10]=f+1;d[h+11]=b+1;d[h+12]=b;d[h+13]=f;d[h+14]=0}b=J.createBuffer(d.length);f=b.position;for(e=0;e<d.length;++e)h=3*d[e],f.set(e,0,c[h]),f.set(e,1,c[h+1]),f.set(e,2,c[h+2]);
return new D(a,B.Default3D,{geometry:y.glLayout(J)},{geometry:E.createVertex(a,35044,b.buffer)})};return a}();var P=a.mat4f64.create(),S=t.vec3f64.create(),V=t.vec3f64.create(),J=A.newLayout().vec3f("position");return n})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("require exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(n,b,m,k,g,e,f){Object.defineProperty(b,
"__esModule",{value:!0});b.createQuadVAO=function(e,b,d){void 0===b&&(b=k.Pos2);void 0===d&&(d=m.Default3D);var a=null;switch(b){case k.Pos2Tex:a=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;default:a=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new f(e,d,{geometry:b},{geometry:g.createVertex(e,35044,a)})};b.createEmptyTexture=function(b,f){void 0===f&&(f=4);return new e(b,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:f,height:f})};b.createColorTexture=function(b,
f,d){void 0===d&&(d=4);for(var a=new Uint8Array(d*d*4),c=0;c<a.length;c+=4)a[c+0]=255*f[0],a[c+1]=255*f[1],a[c+2]=255*f[2],a[c+3]=255*f[3];return new e(b,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:d,height:d},a)};b.createEmptyDepthTexture=function(b){return new e(b,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))}})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require","exports"],
function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];b.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];b.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}];
b.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];b.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];b.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]})},"esri/views/3d/environment/Stars":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x){var w=l.getLogger("esri.views.3d.environment.Stars");b=function(){function b(a){this.slot=14;this.numBinaryFloats=2;this.numBinaryUInt8=1;this.bytesPerStar=9;this._loadDataController=h.createAbortController();this._numStars=0;this._modelMatrix=c.mat4f64.create();this._destroyed=!1;this.view=a;this._loadDataPromise=this._loadBrightStarCatalogue()}Object.defineProperty(b.prototype,"canRender",{get:function(){return null!=this._vao},enumerable:!0,configurable:!0});
b.prototype.destroy=function(){this._destroyed=!0;this._loadDataController&&(this._loadDataController.abort(),this._loadDataController=null);this._dateHandle&&(this._dateHandle.remove(),this._dateHandle=null);this._vao&&(this._vao.dispose(),this._vao=null)};b.prototype.initializeRenderContext=function(a){var c=this;this._initContext=a;var e=a.rctx;this._starsTechnique=new q.StarsTechnique({rctx:e,viewingMode:"local"===this.view.viewingMode?1:0},null);this._dateHandle=d.init(this.view,"environment.lighting.date",
function(a){return c._update(a)});this._loadDataPromise.then(function(){if(!c._destroyed){c._numStars=c._starData.byteLength/c.bytesPerStar;var d=new Float32Array(c._starData,0,c._numStars*c.numBinaryFloats),b=new Uint8Array(c._starData,c._numStars*c.numBinaryFloats*4,c._numStars*c.numBinaryUInt8);c._vao=c._createVertexArrayObject(e,d,b);a.requestRender()}})};b.prototype.uninitializeRenderContext=function(){this.destroy()};b.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass)return!1;
var c=a.rctx,d=this._starsTechnique.program;c.bindProgram(d);this._starsTechnique.bindPass(c,a.camera);d.setUniformMatrix4fv("model",this._modelMatrix);this._starsTechnique.bindPipelineState(c);c.bindVAO(this._vao);d.assertCompatibleVertexAttributeLocations(this._vao);c.drawArrays(0,0,this._numStars);return!0};b.prototype._computeDayDuration=function(a){var c=new Date(a.getFullYear(),0,1,11,58,56),d=new Date(a.getFullYear()+1,0,1,11,58,55);return(+a-+c)/(+d-+c)};b.prototype._update=function(c){if(c){var d=
c.getHours()/12,e=c.getMinutes()/60*(2/24),b=c.getSeconds()/60*(2/1440),d=(d+e+b-.9972222)%2;c=2*this._computeDayDuration(c);e=this._modelMatrix;a.mat4.copy(e,y);a.mat4.rotateZ(e,e,-c*Math.PI);a.mat4.multiply(e,z,e);a.mat4.rotateZ(e,e,-d*Math.PI);this._initContext.requestRender()}};b.prototype._hexToRGB=function(a){return[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]};b.prototype._unpackUint8Attributes=function(a){return 192<=a?[2.9,a-192]:160<=a?[2.5,
a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=a?[.7,a-32]:[.4,a]};b.prototype._createVertexArrayObject=function(a,c,d){for(var e=A.createBuffer(this._numStars),b=e.position,f=e.color,h=e.size,l=0;l<this._numStars;l++){var g=c[2*l+0],k=c[2*l+1];b.set(l,0,-Math.cos(g)*Math.sin(k));b.set(l,1,-Math.sin(g)*Math.sin(k));b.set(l,2,-Math.cos(k));g=this._unpackUint8Attributes(d[l]);k=this._hexToRGB(v[g[1]]);f.set(l,0,255*k[0]);f.set(l,1,255*k[1]);f.set(l,2,255*k[2]);f.set(l,3,255);h.set(l,g[0])}return new x(a,
u.Default3D,{geometry:p.glLayout(A)},{geometry:r.createVertex(a,35044,e.buffer)})};b.prototype._verifyStartData=function(a){if(!a)throw new f("stars:no-data-received","Failed to create stars because star catalogue is missing");a=a.byteLength/this.bytesPerStar;if(0!==a%1||5E4<a||5E3>a)throw new f("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};b.prototype._loadBrightStarCatalogue=function(){return k(this,void 0,void 0,function(){var a,c,d;return m(this,function(b){switch(b.label){case 0:return B?
(this._starData=B,[2]):[4,e.result(g(n.toUrl("./resources/stars.wsv"),{responseType:"array-buffer",signal:this._loadDataController.signal}))];case 1:a=b.sent();this._loadDataController=null;if(!1===a.ok){if(h.isAbortError(a.error))throw a.error;w.error("loadBrightStarCatalogue",a.error.message);return[2]}c=a.value;d=c.data;try{this._verifyStartData(d)}catch(D){throw w.error("loadBrightStarCatalogue",D),D;}this._starData=B=d;return[2]}})})};return b}();var v="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),
z=c.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),y=c.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),A=t.newLayout().vec3f("position").vec4u8("color").f32("size"),B=null;return b})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../environment/Stars.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){Object.defineProperty(b,"__esModule",{value:!0});k=function(c){function b(){return null!==c&&c.apply(this,arguments)||this}m(b,c);b.prototype.initializeProgram=function(a){var c=b.shader.get().build();return new d(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),h.Default3D)};b.prototype.initializePipeline=function(){return a.makePipelineState({blending:a.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:a.defaultColorWriteParams})};
b.prototype.bindPass=function(a,c){this.program.setUniformMatrix4fv("view",c.viewMatrix);this.program.setUniformMatrix4fv("proj",c.projectionMatrix);this.program.setUniform4fv("viewport",c.fullViewport);this.program.setUniform1f("pixelRatio",c.pixelRatio)};b.shader=new f.ReloadableShaderModule(e,"../shaders/Stars.glsl",n);return b}(l.ShaderTechnique);b.StarsTechnique=k})},"esri/views/3d/environment/Stars.glsl":function(){define("require exports ../../../core/tsSupport/makeTemplateObjectHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(){var a=new l.ShaderBuilder;a.attributes.add("position","vec3");a.attributes.add("color","vec4");a.attributes.add("size","float");a.varyings.add("vcolor","vec4");a.varyings.add("vsize","float");a.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4").add("viewport","vec4").add("pixelRatio","float");a.include(e.AlignPixel);a.vertex.code.add(f.glsl(h||(h=m(["\n    void main(void) {\n      vec4 posProj \x3d proj * view * model * vec4(position * 1.0e25, 1.0); // move infinitely far away\n      gl_Position \x3d alignToPixelCenter(posProj, viewport.zw); // pixel align position\n      gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n      vcolor \x3d color / 1.2;\n      vsize \x3d size * 5.0 * pixelRatio;\n      gl_PointSize \x3d vsize;\n    }\n  "],
["\n    void main(void) {\n      vec4 posProj \x3d proj * view * model * vec4(position * 1.0e25, 1.0); // move infinitely far away\n      gl_Position \x3d alignToPixelCenter(posProj, viewport.zw); // pixel align position\n      gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n      vcolor \x3d color / 1.2;\n      vsize \x3d size * 5.0 * pixelRatio;\n      gl_PointSize \x3d vsize;\n    }\n  "]))));a.fragment.code.add(f.glsl(d||(d=m(["\n    void main() {\n      float cap \x3d 0.7;\n      float scale \x3d 1.0 / cap;\n      float helper \x3d clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);\n      float alpha \x3d clamp((cap - helper) * scale, 0.0, 1.0);\n      float intensity \x3d alpha * alpha * alpha;\n      if (vsize \x3c 3.0) {\n        intensity *\x3d 0.5;\n      }\n      gl_FragColor \x3d vec4(1.0, 1.0, 1.0, intensity);\n      gl_FragColor.xyz *\x3d vcolor.xyz;\n    }\n  "],
["\n    void main() {\n      float cap \x3d 0.7;\n      float scale \x3d 1.0 / cap;\n      float helper \x3d clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);\n      float alpha \x3d clamp((cap - helper) * scale, 0.0, 1.0);\n      float intensity \x3d alpha * alpha * alpha;\n      if (vsize \x3c 3.0) {\n        intensity *\x3d 0.5;\n      }\n      gl_FragColor \x3d vec4(1.0, 1.0, 1.0, intensity);\n      gl_FragColor.xyz *\x3d vcolor.xyz;\n    }\n  "]))));return a};var h,d})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.AlignPixel=function(b){var f=k.glsl(g||(g=m(["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],
["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "]))),h=k.glsl(e||(e=m(["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],
["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "])));b.vertex.code.add(f);b.vertex.code.add(h);b.fragment.code.add(f);b.fragment.code.add(h)};var g,e})},"esri/views/3d/support/sunUtils":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../lib/SunCalc".split(" "),
function(n,b,m,k,g,e,f,l){function h(a,c,d,e){for(var b=[],f=0;f<d.length;f++)b[f]=(e[f]-d[f])*a/c+d[f];return b}Object.defineProperty(b,"__esModule",{value:!0});b.settings={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};b.computeColorAndIntensity=function(a,d){var g,k,p,
q,w=d[2],v=c;e.vec3.set(v.ambient.color,1,1,1);v.ambient.intensity=b.settings.global.ambient;e.vec3.set(v.diffuse.color,1,1,1);v.diffuse.intensity=b.settings.global.diffuse;w=(Math.abs(w)-b.settings.local.altitude)/(b.settings.global.altitude-b.settings.local.altitude);w=m.clamp(w,0,1);v.globalFactor=w;d=l.getTimes(a,d[1],d[0]);if(1>w){p=a.valueOf();var z,y;d.polarException===l.POLAR_EXCEPTION.MIDNIGHT_SUN?(z=p-36E5*(a.getHours()+48)-6E4*a.getMinutes(),y=z+432E6):d.polarException===l.POLAR_EXCEPTION.POLAR_NIGHT?
(z=p-2,y=p-1):(z=d.sunrise.valueOf(),y=d.sunset.valueOf());var A=y-z;q=z+A/2;k=A/4;g=q-k;k=q+k;var B=.06*A,A=z-B/2;z+=B/2;var n=y-B/2,F=y+B/2;y=b.settings.local;var E=[.01,y.ambientAtNight],G=[.8,.8,1],H=[.01,.01,.01],D=[y.diffuseAtTwilight,y.ambientAtTwilight],I=[1,.75,.75],L=[.8,.8,1],O=[.9*y.diffuseAtNoon,y.ambientAtNoon],K=[1,.98,.98],N=[.98,.98,1],Q=[y.diffuseAtNoon,y.ambientAtNoon],M=[1,1,1],T=[1,1,1];y=[0,0];var P=[0,0,0],B=[0,0,0];p<A||p>F?(y=E,P=H,B=G):p<z?(B=z-A,y=h(p-A,B,E,D),P=h(p-A,B,
H,I),B=h(p-A,B,G,L)):p<g?(B=g-z,y=h(p-z,B,D,O),P=h(p-z,B,I,K),B=h(p-z,B,L,N)):p<q?(B=q-g,y=h(p-g,B,O,Q),P=h(p-g,B,K,M),B=h(p-g,B,N,T)):p<k?(B=k-q,y=h(p-q,B,Q,O),P=h(p-q,B,M,K),B=h(p-q,B,T,N)):p<n?(B=n-k,y=h(p-k,B,O,D),P=h(p-k,B,K,I),B=h(p-k,B,N,L)):p<F&&(B=F-n,y=h(p-n,B,D,E),P=h(p-n,B,I,H),B=h(p-n,B,L,G));p=y[0];q=f.vec3f64.fromValues(P[0],P[1],P[2]);g=y[1];k=f.vec3f64.fromValues(B[0],B[1],B[2]);e.vec3.lerp(v.ambient.color,k,v.ambient.color,w);v.ambient.intensity=m.lerp(g,v.ambient.intensity,w);e.vec3.lerp(v.diffuse.color,
q,v.diffuse.color,w);v.diffuse.intensity=m.lerp(p,v.diffuse.intensity,w)}w=a.valueOf();d.polarException===l.POLAR_EXCEPTION.MIDNIGHT_SUN?(a=w-36E5*(a.getHours()+48)-6E4*a.getMinutes(),d=a+432E6):d.polarException===l.POLAR_EXCEPTION.POLAR_NIGHT?(a=w-2,d=w-1):(a=d.sunrise.valueOf(),d=d.sunset.valueOf());a=1-m.clamp(Math.abs(w-(a+(d-a)/2))/432E5,0,1);v.noonFactor=a;return v};b.computeDirection=function(c,h,g,u){u||(u=f.vec3f64.create());var p=a,q=k.mat4.identity(d);if("global"===g)l.getPosition(c,0,
0,p),e.vec3.set(u,0,0,-1),k.mat4.rotateX(q,q,-p.azimuth),k.mat4.rotateY(q,q,-p.altitude);else{var t=b.settings.planarDirection;g=t.globalAngles;t=(Math.abs(h[2])-t.localAltitude)/(t.globalAltitude-t.localAltitude);t=m.clamp(t,0,1);1>t?(l.getPosition(c,h[1],h[0],p),p.azimuth=(1-t)*p.azimuth+t*g.azimuth,p.altitude=(1-t)*p.altitude+t*g.altitude):(p.azimuth=g.azimuth,p.altitude=g.altitude);e.vec3.set(u,0,-1,0);k.mat4.rotateZ(q,q,-p.azimuth);k.mat4.rotateX(q,q,-p.altitude)}e.vec3.transformMat4(u,u,q);
return u};b.computeShadowsEnabled=function(a,c){return"global"===c?!0:Math.abs(a[2])<b.settings.planarDirection.localAltitude};var d=g.mat4f64.create(),a={azimuth:0,altitude:0},c={ambient:{color:f.vec3f64.create(),intensity:0},diffuse:{color:f.vec3f64.create(),intensity:0,direction:f.vec3f64.create()},globalFactor:0,noonFactor:0}})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function n(a){return new Date(864E5*(a+.5-2440588))}function b(d,e){return t(a(d)*c(w)-q(e)*a(w),c(d))}function m(d,
e){return p(a(e)*c(w)+c(e)*a(w)*a(d))}function k(d,e,b){return t(a(d),c(d)*a(e)-q(b)*c(e))}function g(d,e,b){return p(a(e)*a(b)+c(e)*c(b)*c(d))}function e(c){return r*(1.9148*a(c)+.02*a(2*c)+3E-4*a(3*c))}function f(a,c){a=r*(357.5291+.98560028*a);var f=e(a);a=a+f+102.9372*r+d;c||(c={dec:0,ra:0});c.dec=m(a,0);c.ra=b(a,0);return c}function l(c,d,e){return 2451545+c+.0053*a(d)-.0069*a(2*e)}function h(d){var e=r*(134.963+13.064993*d),f=r*(93.272+13.22935*d);d=r*(218.316+13.176396*d)+6.289*r*a(e);f=5.128*
r*a(f);e=385001-20905*c(e);return{ra:b(d,f),dec:m(d,f),dist:e}}var d=Math.PI,a=Math.sin,c=Math.cos,q=Math.tan,p=Math.asin,t=Math.atan2,u=Math.acos,r=d/180,x={dec:0,ra:0},w=23.4397*r,v={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(a,c,d,e){d=r*-d;c*=r;var b=a.valueOf()/864E5-.5+2440588-2451545;a=f(b,x);d=r*(280.16+360.9856235*b)-d-a.ra;e||(e={azimuth:0,altitude:0});e.azimuth=k(d,c,a.dec);e.altitude=g(d,c,a.dec);return e}},z=[[-.83,"sunrise","sunset"]];v.addTime=function(a,
c,d){z.push([a,c,d])};v.getTimes=function(b,f,h){function g(e){var b=p,f=w;e=u((a(e)-a(b)*a(f))/(c(b)*c(f)));return l(9E-4+(e+k)/(2*d)+q,t,x)}var k=r*-h,p=r*f,q=Math.round(b.valueOf()/864E5-.5+2440588-2451545-9E-4-k/(2*d));b=9E-4+(0+k)/(2*d)+q;var t=r*(357.5291+.98560028*b);f=e(t);var x=t+f+102.9372*r+d,w=m(x,0);b=l(b,t,x);f={solarNoon:n(b),nadir:n(b-.5),polarException:v.POLAR_EXCEPTION.NORMAL};var y,A,B,N;h=0;for(y=z.length;h<y;h+=1)A=z[h],B=g(A[0]*r),N=b-(B-b),f[A[1]]=n(N),f[A[2]]=n(B);f.polarException=
function(d){d=(a(d)-a(p)*a(w))/(c(p)*c(w));return-1>d?v.POLAR_EXCEPTION.MIDNIGHT_SUN:1<d?v.POLAR_EXCEPTION.POLAR_NIGHT:v.POLAR_EXCEPTION.NORMAL}(z[0][0]*r);return f};v.getMoonPosition=function(a,c,d){d=r*-d;c*=r;var e=a.valueOf()/864E5-.5+2440588-2451545;a=h(e);d=r*(280.16+360.9856235*e)-d-a.ra;e=g(d,c,a.dec);e+=.017*r/q(e+10.26*r/(e+5.1*r));return{azimuth:k(d,c,a.dec),altitude:e,distance:a.dist}};v.getMoonFraction=function(d){var e=d.valueOf()/864E5-.5+2440588-2451545;d=f(e);e=h(e);d=u(a(d.dec)*
a(e.dec)+c(d.dec)*c(e.dec)*c(d.ra-e.ra));d=t(149598E3*a(d),e.dist-149598E3*c(d));return(1+c(d))/2};return v})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(b,g,e){void 0===b&&(b=m.vec3f64.create());void 0===g&&(g=m.vec3f64.fromValues(.57735,.57735,.57735));void 0===e&&(e=!0);this.intensity=b;this.direction=g;this.castShadows=
e}}();b.MainLight=n;n=function(){return function(b,g){void 0===b&&(b=m.vec3f64.create());void 0===g&&(g=m.vec3f64.fromValues(.57735,.57735,.57735));this.intensity=m.vec3f64.create();this.direction=m.vec3f64.create();this.intensity=b;this.direction=g}}();b.FillLight=n;n=function(){return function(b){void 0===b&&(b=m.vec3f64.create());this.intensity=b}}();b.AmbientLight=n;n=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();b.SphericalHarmonicsLight=n})},"esri/views/3d/input/SceneInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E){n=function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a._handles=new e;return a}m(g,b);g.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};Object.defineProperty(g.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==a||a===this._get("primaryDragAction")||(this._set("primaryDragAction",a),
this._updateMode())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!0,configurable:!0});g.prototype.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),this._source=null)};g.prototype.connect=function(){var e=
this,b=this.view;this._source=new v.BrowserEventSource(this.view.surface,b.input);var l=[new B.ImmediateDoubleClick,new C.PointerClickHoldAndDrag,new F.SingleAndDoubleClick,new A.Drag(this.view.navigation),new E.VerticalTwoFingerDrag];this._inputManager=l=new z.InputManager({eventSource:this._source,recognizers:l});l.installHandlers("prevent-context-menu",[new y.PreventContextMenu],z.ViewEventPriorities.INTERNAL);this._modeDragPan=new t.PinchAndPanNavigation(b,"primary");this._modeDragRotate=new d.DragRotate(b,
"secondary","center");this._modeDragZoom=new a.DragZoom(b,"tertiary");l.installHandlers("navigation",[new u.PointerDownCancelAnimation(b),new h.DoubleClickZoom(b),new c.GamepadNavigation(b),new q.KeyboardNavigation(b,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new p.MouseWheelZoom(b),new x.SingleKeyResetTilt(b,"p"),new r.SingleKeyResetHeading(b,"n"),new d.DragRotate(b,
"primary","eye",["b"]),new d.DragRotate(b,"secondary","center",["b"]),new t.PinchAndPanNavigation(b,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new w.TwoFingerTilt(b)],z.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(l);this._updateMode();f.init(this.view.navigation,"browserTouchPanEnabled",function(a){e._source.browserTouchPanningEnabled=!a})};g.prototype._updateMode=function(){var a=this.primaryDragAction,a=G.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerAction=
a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=a.zoom)};Object.defineProperty(g.prototype,"test",{get:function(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}},enumerable:!0,configurable:!0});k([l.property()],g.prototype,"view",void 0);k([l.property({value:"pan"})],g.prototype,"primaryDragAction",null);k([l.property({value:"default"})],
g.prototype,"mode",null);k([l.property({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],g.prototype,"hasPendingInputs",void 0);k([l.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],g.prototype,"latestPointerType",void 0);k([l.property()],g.prototype,"_inputManager",void 0);return g=k([l.subclass("esri.views.3d.input.SceneInputManager")],g)}(l.declared(g));var G=new Map;b=new Map;g=new Map;b.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});b.set("rotate",{pan:"secondary",
rotate:"primary",zoom:"tertiary"});g.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});g.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});G.set("default",b);G.set("pro",g);return n})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,c){var d=b.call(this,!0)||this;d.view=a;d.registerIncoming("double-click",c,function(a){return d.handleDoubleClick(a)});return d}m(d,b);d.prototype.handleDoubleClick=function(a){var c=a.data;if(l.eventMatchesPointerAction(c,"primary")){var d=this.view.state.isGlobal?new g.ZoomStepController(this.view,"animation"):new e.ZoomStepController(this.view,"animation");this.view.state.switchCameraController(d);
d.zoomStep(Math.log(.5)/Math.log(.6),k.createScreenPointArray(c.x,c.y));a.stopPropagation()}};return d}(f.InputHandler);b.DoubleClickZoom=n})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function f(c,e){e=b.call(this,c.state,c.sceneIntersectionHelper,e)||this;e.view=c;e.zoomLocation=g.vec3f64.create();e.tmpCamera=new d.default;e.tmpViewDir=g.vec3f64.create();e.targetOnSphere=g.vec3f64.create();e.tmpCenter=g.vec3f64.create();e.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new d.default,interactionDirection:null,tiltMode:0};e.sphere=h.sphere.create();
e.intersector=new a.Intersector(c.viewingMode);return e}m(f,b);f.prototype.zoomStep=function(a,c){if(this.active){var d=this.view.state,e=this.constraintOptions.interactionStartCamera;this.animation.finished?e.copyFrom(d.camera):this.animation.cameraAt(1,e);e=!1;0<a&&this.intersectionHelper.intersectScreen(c,this.zoomLocation)&&(e=!0);this.tmpCamera.copyFrom(d.camera);e?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):
this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:k.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,c);this.begin(this.tmpCamera)}};f.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:c.outExpo}};f.prototype.updateCamera=function(a,c,d,b){this.sphere.radius=k.vec3.length(d);k.vec3.subtract(this.tmpViewDir,a.center,a.eye);var f=
k.vec3.length(this.tmpViewDir),g=f*c;1>=c&&4>g&&(g=4,c=g/f);1E-6>Math.abs(f-g)||(f=k.vec3.length(a.center),this.sphere.radius!==f&&k.vec3.scale(a.center,a.center,(this.sphere.radius+c*(f-this.sphere.radius))/f),k.vec3.scale(this.tmpViewDir,this.tmpViewDir,-c),k.vec3.add(a.eye,a.center,this.tmpViewDir),e.applyAll(this.view,a,this.constraintOptions),1E-12<k.vec3.squaredDistance(d,a.center)&&h.sphere.intersectScreen(this.sphere,a,b,this.targetOnSphere)&&l.panToPosition(this.sphere,a,d,this.targetOnSphere,
this.view.camera.heading,this.view.camera.tilt,!0),e.applySurfaceCollisionConstraint(this.view,a))};return f}(f.PointToPointAnimationController);b.ZoomStepController=n})},"esri/views/3d/camera/constraintUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec2 ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing ./constraintUtils/tilt ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){Object.defineProperty(b,"__esModule",{value:!0});b.applyTiltConstraint=d.applyTiltConstraint;b.getTiltConstraintError=d.getTiltConstraintError;b.applyAltitudeConstraint=a.applyAltitudeConstraint;b.getAltitudeConstraintError=a.getAltitudeConstraintError;b.applyDistanceConstraint=c.applyDistanceConstraint;b.getDistanceConstraintError=c.getDistanceConstraintError;b.applySurfaceCollisionConstraint=q.applySurfaceCollisionConstraint;b.applyAll=function(a,c,d,e){void 0===
d&&(d=t);void 0===e&&(e=c);var b=!1;e!==c&&e.copyFrom(c);e.markViewDirty();e.computeUp(a.state.mode);for(c=0;c<u;c++){for(var h=0,l=0,k=p;l<k.length;l++){var q=k[l];if(g.hasConstraintType(d.selection,q.type)){var m=Math.abs(q.error(a,e,d));q.apply(a,e,d)&&(b=!0,h+=m)}}if(0===h)break}c=g.hasConstraintType(d.selection,8);a:switch(d.interactionType){case 4:d=1;break a;case 5:d=a.state.isGlobal?2:1;break a;default:d=0}c&&f.applySurfaceCollisionConstraint(a,e,d)&&(b=!0);b&&e.computeUp(a.state.mode);return b};
b.pixelDistanceToInteractionFactor=function(a,c){a="number"===typeof a?a:m.vec2.distance(a,c);return h.inOutCubic(Math.min(1,a/150))};var p=[{type:1,error:function(a,c,d){return l.getTiltConstraintError(a,c,d)*c.distance},apply:l.applyTiltConstraint},{type:2,error:k.getAltitudeConstraintError,apply:k.applyAltitudeConstraint},{type:4,error:e.getDistanceConstraintError,apply:e.applyDistanceConstraint}],t={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:0},u=5})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/intersectionUtils".split(" "),function(n,b,m,k,g,e,f,l){function h(c,d,b){void 0===b&&(b=e.defaultApplyOptions);var f;f=c.state.constraints.altitude;f=c.state.isGlobal&&f?2===b.interactionType&&e.hasConstraintType(b.selection,1)?!1:!0:!1;if(!f)return 0;
var l=c.state.constraints.altitude;f=a;f.min=l.min;f.max=l.max;var g=b.interactionType;if(0!==g){var l=f.min,k=f.max,p=b.interactionStartCamera;b=b.interactionFactor;var g=2===g||1===g,q=h(c,p),p=0===q?0:c.renderCoordsHelper.getAltitude(p.eye);f.min=l;f.max=k;e.adjustRangeForInteraction(q,p,g,b,.05*p,f)}c=c.renderCoordsHelper.getAltitude(d.eye);c=m.clamp(c,f.min,f.max)-c;return 1E-6>=Math.abs(c)?0:c}function d(a,c,d,e){a.renderCoordsHelper.worldUpAtPosition(c.eye,e);k.vec3.scale(e,e,d);return e}Object.defineProperty(b,
"__esModule",{value:!0});b.applyAltitudeConstraint=function(a,b,g){void 0===g&&(g=e.defaultApplyOptions);var t=h(a,b,g);if(0===t)return!1;var r=a.renderCoordsHelper,u=r.getAltitude(b.eye)+t;a=e.interactionDirectionTowardsConstraintMinimization(b,g.interactionDirection,d(a,b,m.sign(t),q),c);g=k.vec3.copy(p,b.viewForward);r.intersectInfiniteManifold(f.ray.wrap(b.eye,a),u,b.eye)||r.setAltitude(u,b.eye);l.closestPointOnRay(b.eye,g,b.center,b.center);b.markViewDirty();return!0};b.getAltitudeConstraintError=
h;var a={min:0,max:0},c=g.vec3f64.create(),q=g.vec3f64.create(),p=g.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/common":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.hasConstraintType=function(b,e){return 0!==(b&e)};b.adjustRangeForInteraction=function(b,e,f,l,h,d){0!==b&&(f?(d.min=Math.min(d.min,e),d.max=Math.max(d.max,e)):null!=l?(d.min-=Math.max(0,(e-
d.min)*(1-l)),d.max+=Math.max(0,(e-d.max)*(1-l))):h&&(d.min-=Math.max(0,e-d.min-h),d.max+=Math.max(0,e-d.max-h)))};b.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};b.interactionDirectionTowardsConstraintMinimization=function(b,e,f,l){e=e||b.viewForward;k.vec3.copy(l,e);k.vec3.scale(l,l,m.sign(k.vec3.dot(e,f)));return l}})},"esri/views/3d/support/intersectionUtils":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2f64",
"../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,m,k,g){function e(d,a,c,e){var b=h;d?(c&&e&&(b.len=k.vec3.distance(a,c)),k.vec3.copy(b.dir,d)):e?(b.len=k.vec3.distance(a,c),k.vec3.subtract(b.dir,c,a),k.vec3.scale(b.dir,b.dir,1/b.len)):(k.vec3.subtract(b.dir,c,a),k.vec3.normalize(b.dir,b.dir));return b}function f(d,a){return-k.vec3.dot(a,d)-d[3]}function l(d,a,c,e){e.clip[0]=0;e.clip[1]=c?e.len:Number.MAX_VALUE;for(c=0;c<d.length;c++){var b;var h=d[c],l=
a;b=e;var g=k.vec3.dot(h,b.dir),h=f(h,l);0>h&&0<=g?b=!1:-1E-6<g&&1E-6>g?b=0<h:!(0>h||0>g)||0>h&&0>g?(h/=g,0<g?h<b.clip[1]&&(b.clip[1]=h):h>b.clip[0]&&(b.clip[0]=h),b=b.clip[0]<=b.clip[1]):b=!0;if(!b)return!1}return!0}Object.defineProperty(b,"__esModule",{value:!0});b.planeSphere=function(d,a,c){return d[0]*a[0]+d[1]*a[1]+d[2]*a[2]+d[3]<c};b.frustumSphere=function(d,a,c){var e=a[0],b=a[1];a=a[2];return d[0][0]*e+d[0][1]*b+d[0][2]*a+d[0][3]>c||d[1][0]*e+d[1][1]*b+d[1][2]*a+d[1][3]>c||d[2][0]*e+d[2][1]*
b+d[2][2]*a+d[2][3]>c||d[3][0]*e+d[3][1]*b+d[3][2]*a+d[3][3]>c||d[4][0]*e+d[4][1]*b+d[4][2]*a+d[4][3]>c||d[5][0]*e+d[5][1]*b+d[5][2]*a+d[5][3]>c?!1:!0};b.frustumRay=function(d,a,c,b){c=e(b,a,c,!1);return l(d,a,null,c)};b.frustumPoint=function(d,a){for(var c=0;6>c;c++)if(0>f(d[c],a))return!1;return!0};b.frustumLineSegment=function(d,a,c,b){b=e(b,a,c,!0);return l(d,a,c,b)};b.closestPointOnRay=function(d,a,c,e){c=k.vec3.dot(a,k.vec3.subtract(e,c,d));k.vec3.add(e,d,k.vec3.scale(e,a,c));return e};var h=
{dir:g.vec3f64.create(),len:0,clip:m.vec2f64.create()}})},"esri/views/3d/camera/constraintUtils/distance":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/mathUtils".split(" "),function(n,b,m,k,g,e,f){function l(a,c,d){void 0===d&&(d=g.defaultApplyOptions);if(!a.state.isLocal)return 0;var e=a.state.constraints.distance;if(!a.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===
e)return 0;h.min=0;h.max=e;var e=h,b=d.interactionType;if(0!==b){var f=e.min,k=e.max,p=d.interactionStartCamera;d=d.interactionFactor;var b=1===b||4===b,q=l(a,p),p=0===q?0:m.vec3.distance(p.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);e.min=f;e.max=k;g.adjustRangeForInteraction(q,p,b,d,.05*p,e)}a=m.vec3.distance(c.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);a=h.max-a;return-1E-6<=a?0:a}Object.defineProperty(b,"__esModule",{value:!0});b.getDistanceConstraintError=l;b.applyDistanceConstraint=
function(b,h,k){void 0===k&&(k=g.defaultApplyOptions);var p=l(b,h,k);if(0===p)return!1;var t=b.pointsOfInterest.surfaceOrigin,p=m.vec3.distance(h.eye,b.pointsOfInterest.surfaceOrigin.renderLocation)+p,u=m.vec3.copy(d,h.eye);k=g.interactionDirectionTowardsConstraintMinimization(h,k.interactionDirection,f.directionFromTo(q,h.eye,b.pointsOfInterest.surfaceOrigin.renderLocation),c);return e.sphere.intersectRay(e.sphere.wrap(p,t.renderLocation),e.ray.wrap(h.eye,k),h.eye)?(t=m.vec3.subtract(a,h.eye,u),
m.vec3.add(h.center,h.center,t),h.markViewDirty(),t=b.renderCoordsHelper.getAltitude(h.center),b.renderCoordsHelper.intersectInfiniteManifold(h.ray,t,h.center),h.markViewDirty(),!0):!1};var h={min:0,max:0},d=k.vec3f64.create(),a=k.vec3f64.create(),c=k.vec3f64.create(),q=k.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","../intersectionUtils"],function(n,
b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.applySurfaceCollisionConstraint=function(b,l,h){void 0===h&&(h=0);var d=b.state.constraints;if(!d.collision.enabled)return!1;var a=g.surfaceElevationBelowEye(b,l),c=b.renderCoordsHelper.getAltitude(l.eye),d=a+d.collision.elevationMargin;if(c>=d)return!1;a=m.vec3.length(l.eye);m.vec3.subtract(e,l.center,l.eye);b.renderCoordsHelper.setAltitude(d,l.eye);1===h?m.vec3.add(l.center,l.eye,e):2===h&&m.vec3.scale(l.center,l.center,(a-c+d)/a);l.markViewDirty();
return!0};var e=k.vec3f64.create()})},"esri/views/3d/camera/intersectionUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ../support/earthUtils ../webgl-engine/lib/Intersector".split(" "),function(n,b,m,k,g,e,f){function l(a,c){return a.basemapTerrain?a.elevationProvider.getElevation(c[0],c[1],c[2],a.renderCoordsHelper.spatialReference)||0:0}function h(a,c,d){if(!a.state.isGlobal)return!1;var e=
l(a,c);a=a.stateManager.constraintsManager.nearFarHeuristic.compute(c,d,a.dataExtent,e,t).far;a*=a;return m.vec3.squaredDistance(c,d)>a}function d(c,d,b){void 0===b&&(b=k.vec3f64.create());var l=a[c.viewingMode];l||(l=new f.Intersector(c.viewingMode),l.options.backfacesTerrain=!c.state.isGlobal,l.options.invisibleTerrain=!0,a[c.viewingMode]=l);var g=c.state.isGlobal;return c.sceneIntersectionHelper.intersectRay(d,l,b)&&!h(c,d.origin,b)?!0:!c.renderCoordsHelper.intersectManifold(d,0,b)||h(c,d.origin,
b)?g?(c=b,b=m.vec3.dot(d.origin,d.origin)-e.earthRadius*e.earthRadius,m.vec3.scale(c,d.direction,(0<b?Math.sqrt(b)/3:1)/m.vec3.length(d.direction)),m.vec3.add(c,c,d.origin),!0):!1:!0}Object.defineProperty(b,"__esModule",{value:!0});b.eyeWithinExtent=function(a,d,e,b){return a.renderCoordsHelper.fromRenderCoords(d.eye,c,b)&&g.containsPoint(e,c)};b.surfaceElevationBelowEye=function(a,c){return l(a,c.eye)};b.cameraOnContentAlongViewDirection=function(a,c,e,b){var f=a.state.camera.clone();c&&(f.eye=c);
e&&(f.center=e);b&&(f.up=b);d(a,f.ray,q)||m.vec3.copy(q,f.center);e=a.state.constraints;b=e.minimumPoiDistance;m.vec3.squaredDistance(f.eye,q)<b&&(c=e.collision.enabled,m.vec3.copy(p,f.viewForward),m.vec3.scale(p,p,b),c?m.vec3.subtract(f.eye,q,p):m.vec3.add(q,f.eye,p),a=a.renderCoordsHelper,b=a.getAltitude(f.eye),e=e.collision.elevationMargin,c&&b<e&&(m.vec3.subtract(p,q,f.eye),a.setAltitude(e,f.eye),m.vec3.add(q,f.eye,p)));f.center=q;return f};var a={},c=k.vec3f64.create(),q=k.vec3f64.create(),p=
k.vec3f64.create(),t={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("require exports ../../../../core/has ../../../../core/maybe ../../../../core/now ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./intersectorUtils".split(" "),function(n,b,m,k,g,e,f,l,h,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a){this.options=new d.IntersectorOptions;
this.results=new d.IntersectorResults;this.transform=new d.IntersectorTransform;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.tolerance=1E-5;this.verticalOffset=null;this._ray={origin:l.vec3f64.create(),direction:l.vec3f64.create()};this._rayEndPoint=l.vec3f64.create();this._rayStartPointTransformed=l.vec3f64.create();this._rayEndPointTransformed=l.vec3f64.create();this.viewingMode=a||"global"}Object.defineProperty(a.prototype,"ray",{get:function(){return this._ray},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"rayBeginPoint",{get:function(){return this._ray.origin},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rayEndPoint",{get:function(){return this._rayEndPoint},enumerable:!0,configurable:!0});a.prototype.reset=function(a,d){this.resetWithRay(h.ray.fromPoints(a,d,this._ray))};a.prototype.resetWithRay=function(a){a!==this._ray&&h.ray.copy(a,this._ray);0!==this.options.verticalOffset?"local"===this.viewingMode?this._ray.origin[2]-=
this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;f.vec3.add(this._rayEndPoint,this._ray.origin,this._ray.direction);this._numObjectsTested=0;this.results.init(this._ray)};a.prototype.intersect=function(a,e,b,f,h,l){var c=this;this.point=e;this.camera=b;this.filterPredicate=h;this.tolerance=null==f?1E-5:f;e=d.getVerticalOffsetObject3D(this.verticalOffset);b=l?function(a){l(a)&&c.intersectObject(a)}:function(a){c.intersectObject(a)};if(a&&0<a.length)for(f=
0;f<a.length;f++){h=a[f];var g=h.getSpatialQueryAccelerator&&h.getSpatialQueryAccelerator();if(g)k.isSome(e)?g.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,b,e):g.forEachAlongRay(this._ray.origin,this._ray.direction,b),this.options.selectionMode&&this.options.hud&&g.forEachDegenerateObject(b);else for(g=0,h=h.getObjects();g<h.length;g++)b(h[g])}this.sortResults()};a.prototype.intersectObject=function(a){var c=this;this._numObjectsTested++;var b=a.geometryRecords;if(b)for(var h=
a.id,l=a.objectTransformation,g,m=d.getVerticalOffsetObject3D(this.verticalOffset),w=function(b){var p=b.geometry,q=b.material,t=b.instanceParameters;if(t.hidden)return"continue";g=p.id;v.transform.setAndInvalidateLazyTransforms(l,b.getShaderTransformation());f.vec3.transformMat4(v._rayStartPointTransformed,v._ray.origin,v.transform.inverse);f.vec3.transformMat4(v._rayEndPointTransformed,v._rayEndPoint,v.transform.inverse);var r=v.transform.transform;k.isSome(m)&&(m.objectTransform=v.transform);q.intersect(p,
t,v.transform.transform,v,v._rayStartPointTransformed,v._rayEndPointTransformed,function(b,f,l,p,m,q){0<=b&&(!k.isSome(c.filterPredicate)||c.filterPredicate(c._ray.origin,c._rayEndPoint,b))&&(m?(null==c.results.hud.dist||b<c.results.hud.dist)&&c.results.hud.set(a,h,b,f,e.mat4f64.IDENTITY,p,q,g,l):(m=function(c){return c.set(a,h,b,f,r,p,null,g,l)},(null==c.results.min.drapedLayerOrder||p>=c.results.min.drapedLayerOrder)&&(null==c.results.min.dist||b<c.results.min.dist)&&m(c.results.min),0!==c.options.store&&
(null==c.results.max.drapedLayerOrder||p<c.results.max.drapedLayerOrder)&&(null==c.results.max.dist||b>c.results.max.dist)&&m(c.results.max),2===c.options.store&&(q=new d.IntersectorResult(c._ray),m(q),c.results.all.push(q))))},b.shaderTransformation)},v=this,z=0;z<b.length;z++)w(b[z])};a.prototype.sortResults=function(){this.results.all.sort(function(a,d){return a.dist!==d.dist?a.dist-d.dist:a.drapedLayerOrder!==d.drapedLayerOrder?(void 0!==a.drapedLayerOrder?a.drapedLayerOrder:Number.MAX_VALUE)-
(void 0!==d.drapedLayerOrder?d.drapedLayerOrder:Number.MAX_VALUE):(void 0!==d.drapedLayerGraphicOrder?d.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==a.drapedLayerGraphicOrder?a.drapedLayerGraphicOrder:Number.MIN_VALUE)})};a.DEFAULT_TOLERANCE=1E-5;return a}();b.Intersector=n})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/geometryUtils/boundedPlane ../../support/geometryUtils/sphere ./Object3D".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x){function w(a,c){return m.isNone(a)||null==a.layerUid?null:m.isSome(c.graphicsView)&&a.layerUid===c.graphicsView.mockLayerId?c.graphics:c.map.findLayerByUid(a.layerUid)}function v(a,c){if(m.isNone(a))return null;var d=w(a,c);return m.isNone(d)?null:d===c.graphics?m.isSome(c.graphicsView)?m.expect(c.graphicsView.getGraphicFromGraphicUid(a.graphicUid)):null:(c=c.allLayerViews.find(function(a){return a.layer===d}))?z(c,a):null}function z(a,c){return!a||a.suspended?
null:"getGraphicFromIntersectorMetadata"in a&&c?a.getGraphicFromIntersectorMetadata(c):"getGraphicFromGraphicUid"in a&&null!=c.graphicUid?a.getGraphicFromGraphicUid(c.graphicUid):null}Object.defineProperty(b,"__esModule",{value:!0});b.sliceFilterPredicate=function(a){return function(c,e,b){d.vec3.lerp(H,c,e,b);return!u.extrusionContainsPoint(a,H)}};n=function(){return function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.storeTerrainResults=
this.backfacesTerrain=!0;this.store=2}}();b.IntersectorOptions=n;n=function(){function a(){this._transform=f.mat4f64.create();this._transformInverse=new y({value:this._transform},e.mat4.invert,f.mat4f64.create);this._transformInverseTranspose=new y(this._transformInverse,e.mat4.transpose,f.mat4f64.create);this._transformTranspose=new y({value:this._transform},e.mat4.transpose,f.mat4f64.create);this._transformInverseRotation=new y({value:this._transform},k.mat3.normalFromMat4Legacy,g.mat3f64.create)}
a.prototype.invalidateLazyTransforms=function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};Object.defineProperty(a.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"inverseTranspose",
{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0});a.prototype.setTransformMatrix=function(a){e.mat4.copy(this._transform,a)};a.prototype.multiplyTransform=function(a){e.mat4.multiply(this._transform,
this._transform,a)};a.prototype.set=function(a){e.mat4.copy(this._transform,a);this.invalidateLazyTransforms()};a.prototype.setAndInvalidateLazyTransforms=function(a,c){this.setTransformMatrix(a);this.multiplyTransform(c);this.invalidateLazyTransforms()};return a}();b.IntersectorTransform=n;var y=function(){function a(a,c,d){this.original=a;this.update=c;this.dirty=!0;this.transform=d()}a.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(a.prototype,"value",{get:function(){this.dirty&&
(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform},enumerable:!0,configurable:!0});return a}();n=function(){function a(){this.min=new A;this.max=new A;this.hud=new A;this.ground=new A}a.prototype.init=function(a){this.min.init(a);this.max.init(a);this.hud.init(a);this.ground.init(a);this.all=[]};return a}();b.IntersectorResults=n;var A=function(){function a(a){this.normal=c.vec3f64.create();this.transformation=f.mat4f64.create();this._ray=t.ray.create();this.init(a)}
Object.defineProperty(a.prototype,"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasIntersectionPoint",{get:function(){return null!=this.dist},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return d.vec3.scale(D,this.ray.direction,this.dist),d.vec3.length(D)},enumerable:!0,configurable:!0});a.prototype.getIntersectionPoint=function(a){if(!this.hasIntersectionPoint)return!1;
d.vec3.scale(D,this.ray.direction,this.dist);d.vec3.add(a,this.ray.origin,D);return!0};a.prototype.getTransformedNormal=function(a){d.vec3.copy(I,this.normal);I[3]=0;q.vec4.transformMat4(I,I,this.transformation);d.vec3.copy(a,I);d.vec3.normalize(a,a);return a};a.prototype.init=function(a){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";a?t.ray.copy(a,this._ray):this._ray=t.ray.create()};
a.prototype.set=function(a,b,f,h,l,g,k,p,m,q){a instanceof x&&(a={type:"stage",obj:a});this.dist=f;d.vec3.copy(this.normal,h);e.mat4.copy(this.transformation,l);this.target=a;this.name=b;this.drapedLayerOrder=g;this.center=k?c.vec3f64.clone(k):null;this.geometryId=p;this.triangleNr=m;this.drapedLayerGraphicOrder=q};a.prototype.copyFrom=function(a){t.ray.copy(a._ray,this._ray);this.dist=a.dist;this.target=a.target;this.name=a.name;this.drapedLayerOrder=a.drapedLayerOrder;this.center=a.center?c.vec3f64.clone(a.center):
null;this.geometryId=a.geometryId;this.triangleNr=a.triangleNr;this.intersector=a.intersector;this.drapedLayerGraphicOrder=a.drapedLayerGraphicOrder;d.vec3.copy(this.normal,a.normal);e.mat4.copy(this.transformation,a.transformation)};a.prototype.toOwner=function(a){if(!this.target)return null;switch(this.target.type){case "stage":return w(this.target.obj.metadata,a);case "external":switch(this.intersector){case "PointRenderer":var c=this.target.metadata.layerUid;return null!=c?a.map.findLayerByUid(c):
null;case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return w(this.target.metadata,a);case "TerrainRenderer":return a.map&&a.map.ground}}return null};a.prototype.toGraphic=function(a){if(!this.target)return null;switch(this.target.type){case "stage":return v(this.target.obj.metadata,a);case "external":switch(this.intersector){case "PointRenderer":return this.target.metadata.createGraphic();case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return v(this.target.metadata,
a)}}return null};return a}();b.IntersectorResult=A;n=function(){function a(a){void 0===a&&(a=0);this.offset=a;this.tmpVertex=c.vec3f64.create()}a.prototype.applyToVertex=function(a,c,d){var e=a+this.localOrigin[0],b=c+this.localOrigin[1],f=d+this.localOrigin[2],h=this.offset/Math.sqrt(e*e+b*b+f*f);this.tmpVertex[0]=a+e*h;this.tmpVertex[1]=c+b*h;this.tmpVertex[2]=d+f*h;return this.tmpVertex};a.prototype.applyToAABB=function(a){var c=a[0]+this.localOrigin[0],d=a[1]+this.localOrigin[1],e=a[2]+this.localOrigin[2],
b=a[3]+this.localOrigin[0],f=a[4]+this.localOrigin[1],h=a[5]+this.localOrigin[2],l=this.offset/Math.sqrt(c*c+d*d+e*e);a[0]+=c*l;a[1]+=d*l;a[2]+=e*l;c=this.offset/Math.sqrt(b*b+f*f+h*h);a[3]+=b*c;a[4]+=f*c;a[5]+=h*c;return a};return a}();b.TerrainVerticalOffsetGlobalViewingMode=n;var B=function(){function e(d){void 0===d&&(d=0);this.offset=d;this.componentLocalOriginLength=0;this.tmpVertex=c.vec3f64.create();this.mbs=p.vec4f64.create();this.obb={center:c.vec3f64.create(),halfSize:a.vec3f32.create(),
quaternion:null}}Object.defineProperty(e.prototype,"localOrigin",{set:function(a){this.componentLocalOriginLength=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])},enumerable:!0,configurable:!0});e.prototype.applyToVertex=function(a,c,d){var e=d+this.componentLocalOriginLength,b=this.offset/Math.sqrt(a*a+c*c+e*e);this.tmpVertex[0]=a+a*b;this.tmpVertex[1]=c+c*b;this.tmpVertex[2]=d+e*b;return this.tmpVertex};e.prototype.applyToAABB=function(a){var c=a[0],d=a[1],e=a[2]+this.componentLocalOriginLength,b=a[3],
f=a[4],h=a[5]+this.componentLocalOriginLength,l=this.offset/Math.sqrt(c*c+d*d+e*e);a[0]+=c*l;a[1]+=d*l;a[2]+=e*l;c=this.offset/Math.sqrt(b*b+f*f+h*h);a[3]+=b*c;a[4]+=f*c;a[5]+=h*c;return a};e.prototype.applyToMbs=function(a){var c=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),d=this.offset/c;this.mbs[0]=a[0]+a[0]*d;this.mbs[1]=a[1]+a[1]*d;this.mbs[2]=a[2]+a[2]*d;this.mbs[3]=a[3]+a[3]*this.offset/c;return this.mbs};e.prototype.applyToObb=function(a){var c=a.center,e=this.offset/Math.sqrt(c[0]*c[0]+c[1]*
c[1]+c[2]*c[2]);this.obb.center[0]=c[0]+c[0]*e;this.obb.center[1]=c[1]+c[1]*e;this.obb.center[2]=c[2]+c[2]*e;d.vec3.transformQuat(this.obb.halfSize,a.halfSize,a.quaternion);d.vec3.add(this.obb.halfSize,this.obb.halfSize,a.center);c=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);this.obb.halfSize[0]+=this.obb.halfSize[0]*c;this.obb.halfSize[1]+=this.obb.halfSize[1]*c;this.obb.halfSize[2]+=this.obb.halfSize[2]*
c;d.vec3.subtract(this.obb.halfSize,this.obb.halfSize,a.center);l.quat.conjugate(L,a.quaternion);d.vec3.transformQuat(this.obb.halfSize,this.obb.halfSize,L);this.obb.halfSize[0]*=0>this.obb.halfSize[0]?-1:1;this.obb.halfSize[1]*=0>this.obb.halfSize[1]?-1:1;this.obb.halfSize[2]*=0>this.obb.halfSize[2]?-1:1;this.obb.quaternion=a.quaternion;return this.obb};return e}();b.I3SVerticalOffsetGlobalViewingMode=B;var C=function(){function a(a){void 0===a&&(a=0);this.offset=a;this.sphere=r.create();this.tmpVertex=
c.vec3f64.create()}a.prototype.applyToVertex=function(a,c,d){var e=this.objectTransform.transform,b=e[0]*a+e[4]*c+e[8]*d+e[12],f=e[1]*a+e[5]*c+e[9]*d+e[13];a=e[2]*a+e[6]*c+e[10]*d+e[14];c=this.offset/Math.sqrt(b*b+f*f+a*a);b+=b*c;f+=f*c;a+=a*c;c=this.objectTransform.inverse;this.tmpVertex[0]=c[0]*b+c[4]*f+c[8]*a+c[12];this.tmpVertex[1]=c[1]*b+c[5]*f+c[9]*a+c[13];this.tmpVertex[2]=c[2]*b+c[6]*f+c[10]*a+c[14];return this.tmpVertex};a.prototype.applyToMinMax=function(a,c){var d=this.offset/Math.sqrt(a[0]*
a[0]+a[1]*a[1]+a[2]*a[2]);a[0]+=a[0]*d;a[1]+=a[1]*d;a[2]+=a[2]*d;a=this.offset/Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);c[0]+=c[0]*a;c[1]+=c[1]*a;c[2]+=c[2]*a};a.prototype.applyToAABB=function(a){var c=this.offset/Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]+=a[0]*c;a[1]+=a[1]*c;a[2]+=a[2]*c;c=this.offset/Math.sqrt(a[3]*a[3]+a[4]*a[4]+a[5]*a[5]);a[3]+=a[3]*c;a[4]+=a[4]*c;a[5]+=a[5]*c;return a};a.prototype.applyToBoundingSphere=function(a,c){var d=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]),e=this.offset/
d;this.sphere.center[0]=c[0]+c[0]*e;this.sphere.center[1]=c[1]+c[1]*e;this.sphere.center[2]=c[2]+c[2]*e;this.sphere.radius=a+a*this.offset/d;return this.sphere};return a}();b.Object3DVerticalOffsetGlobalViewingMode=C;var F=new C;b.getVerticalOffsetObject3D=function(a){return m.isSome(a)?(F.offset=a,F):null};var E=new B;b.getVerticalOffsetI3S=function(a){return m.isSome(a)?(E.offset=a,E):null};var G=new n;b.getVerticalOffsetTerrain=function(a){return m.isSome(a)?(G.offset=a,G):null};b.TERRAIN_ID="terrain";
var H=c.vec3f64.create(),D=c.vec3f64.create(),I=p.vec4f64.create(),L=h.quatf64.create()})},"esri/core/libs/gl-matrix-2/mat3":function(){define(["require","exports","./math/mat3"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.mat3=m})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["require","exports","./common"],function(n,b,m){function k(e,b,l){var f=b[0],d=b[1],a=b[2],c=b[3],g=b[4],k=b[5],m=b[6],u=b[7];b=b[8];var r=l[0],x=l[1],w=l[2],v=l[3],z=l[4],y=l[5],A=l[6],B=
l[7];l=l[8];e[0]=r*f+x*c+w*m;e[1]=r*d+x*g+w*u;e[2]=r*a+x*k+w*b;e[3]=v*f+z*c+y*m;e[4]=v*d+z*g+y*u;e[5]=v*a+z*k+y*b;e[6]=A*f+B*c+l*m;e[7]=A*d+B*g+l*u;e[8]=A*a+B*k+l*b;return e}function g(e,b,l){e[0]=b[0]-l[0];e[1]=b[1]-l[1];e[2]=b[2]-l[2];e[3]=b[3]-l[3];e[4]=b[4]-l[4];e[5]=b[5]-l[5];e[6]=b[6]-l[6];e[7]=b[7]-l[7];e[8]=b[8]-l[8];return e}Object.defineProperty(b,"__esModule",{value:!0});b.fromMat4=function(e,b){e[0]=b[0];e[1]=b[1];e[2]=b[2];e[3]=b[4];e[4]=b[5];e[5]=b[6];e[6]=b[8];e[7]=b[9];e[8]=b[10];
return e};b.copy=function(e,b){e[0]=b[0];e[1]=b[1];e[2]=b[2];e[3]=b[3];e[4]=b[4];e[5]=b[5];e[6]=b[6];e[7]=b[7];e[8]=b[8];return e};b.set=function(e,b,l,h,d,a,c,g,k,m){e[0]=b;e[1]=l;e[2]=h;e[3]=d;e[4]=a;e[5]=c;e[6]=g;e[7]=k;e[8]=m;return e};b.identity=function(e){e[0]=1;e[1]=0;e[2]=0;e[3]=0;e[4]=1;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e};b.transpose=function(e,b){if(e===b){var f=b[1],h=b[2],d=b[5];e[1]=b[3];e[2]=b[6];e[3]=f;e[5]=b[7];e[6]=h;e[7]=d}else e[0]=b[0],e[1]=b[3],e[2]=b[6],e[3]=b[1],e[4]=b[4],
e[5]=b[7],e[6]=b[2],e[7]=b[5],e[8]=b[8];return e};b.invert=function(e,b){var f=b[0],h=b[1],d=b[2],a=b[3],c=b[4],g=b[5],k=b[6],m=b[7];b=b[8];var u=b*c-g*m,r=-b*a+g*k,x=m*a-c*k,w=f*u+h*r+d*x;if(!w)return null;w=1/w;e[0]=u*w;e[1]=(-b*h+d*m)*w;e[2]=(g*h-d*c)*w;e[3]=r*w;e[4]=(b*f-d*k)*w;e[5]=(-g*f+d*a)*w;e[6]=x*w;e[7]=(-m*f+h*k)*w;e[8]=(c*f-h*a)*w;return e};b.adjoint=function(e,b){var f=b[0],h=b[1],d=b[2],a=b[3],c=b[4],g=b[5],k=b[6],m=b[7];b=b[8];e[0]=c*b-g*m;e[1]=d*m-h*b;e[2]=h*g-d*c;e[3]=g*k-a*b;e[4]=
f*b-d*k;e[5]=d*a-f*g;e[6]=a*m-c*k;e[7]=h*k-f*m;e[8]=f*c-h*a;return e};b.determinant=function(e){var b=e[3],l=e[4],h=e[5],d=e[6],a=e[7],c=e[8];return e[0]*(c*l-h*a)+e[1]*(-c*b+h*d)+e[2]*(a*b-l*d)};b.multiply=k;b.translate=function(e,b,l){var f=b[0],d=b[1],a=b[2],c=b[3],g=b[4],k=b[5],m=b[6],u=b[7];b=b[8];var r=l[0];l=l[1];e[0]=f;e[1]=d;e[2]=a;e[3]=c;e[4]=g;e[5]=k;e[6]=r*f+l*c+m;e[7]=r*d+l*g+u;e[8]=r*a+l*k+b;return e};b.rotate=function(e,b,l){var f=b[0],d=b[1],a=b[2],c=b[3],g=b[4],k=b[5],m=b[6],u=b[7];
b=b[8];var r=Math.sin(l);l=Math.cos(l);e[0]=l*f+r*c;e[1]=l*d+r*g;e[2]=l*a+r*k;e[3]=l*c-r*f;e[4]=l*g-r*d;e[5]=l*k-r*a;e[6]=m;e[7]=u;e[8]=b;return e};b.scale=function(e,b,l){var f=l[0],d=l[1];l=l[2];e[0]=f*b[0];e[1]=f*b[1];e[2]=f*b[2];e[3]=d*b[3];e[4]=d*b[4];e[5]=d*b[5];e[6]=l*b[6];e[7]=l*b[7];e[8]=l*b[8];return e};b.scaleByVec2=function(e,b,l){var f=l[0];l=l[1];e[0]=f*b[0];e[1]=f*b[1];e[2]=f*b[2];e[3]=l*b[3];e[4]=l*b[4];e[5]=l*b[5];return e};b.fromTranslation=function(e,b){e[0]=1;e[1]=0;e[2]=0;e[3]=
0;e[4]=1;e[5]=0;e[6]=b[0];e[7]=b[1];e[8]=1;return e};b.fromRotation=function(e,b){var f=Math.sin(b);b=Math.cos(b);e[0]=b;e[1]=f;e[2]=0;e[3]=-f;e[4]=b;e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e};b.fromScaling=function(e,b){e[0]=b[0];e[1]=0;e[2]=0;e[3]=0;e[4]=b[1];e[5]=0;e[6]=0;e[7]=0;e[8]=1;return e};b.fromMat2d=function(e,b){e[0]=b[0];e[1]=b[1];e[2]=0;e[3]=b[2];e[4]=b[3];e[5]=0;e[6]=b[4];e[7]=b[5];e[8]=1;return e};b.fromQuat=function(e,b){var f=b[0],h=b[1],d=b[2];b=b[3];var a=f+f,c=h+h,g=d+d,f=f*a,k=h*
a,h=h*c,m=d*a,u=d*c,d=d*g,a=b*a,c=b*c;b*=g;e[0]=1-h-d;e[3]=k-b;e[6]=m+c;e[1]=k+b;e[4]=1-f-d;e[7]=u-a;e[2]=m-c;e[5]=u+a;e[8]=1-f-h;return e};b.normalFromMat4Legacy=function(e,b){var f=b[0],h=b[1],d=b[2],a=b[4],c=b[5],g=b[6],k=b[8],m=b[9];b=b[10];var u=b*c-g*m,r=-b*a+g*k,x=m*a-c*k,w=f*u+h*r+d*x;if(!w)return null;w=1/w;e[0]=u*w;e[1]=(-b*h+d*m)*w;e[2]=(g*h-d*c)*w;e[3]=r*w;e[4]=(b*f-d*k)*w;e[5]=(-g*f+d*a)*w;e[6]=x*w;e[7]=(-m*f+h*k)*w;e[8]=(c*f-h*a)*w;return e};b.normalFromMat4=function(e,b){var f=b[0],
h=b[1],d=b[2],a=b[3],c=b[4],g=b[5],k=b[6],m=b[7],u=b[8],r=b[9],x=b[10],w=b[11],v=b[12],z=b[13],y=b[14];b=b[15];var A=f*g-h*c,B=f*k-d*c,n=f*m-a*c,F=h*k-d*g,E=h*m-a*g,G=d*m-a*k,H=u*z-r*v,D=u*y-x*v,u=u*b-w*v,I=r*y-x*z,r=r*b-w*z,x=x*b-w*y,w=A*x-B*r+n*I+F*u-E*D+G*H;if(!w)return null;w=1/w;e[0]=(g*x-k*r+m*I)*w;e[1]=(k*u-c*x-m*D)*w;e[2]=(c*r-g*u+m*H)*w;e[3]=(d*r-h*x-a*I)*w;e[4]=(f*x-d*u+a*D)*w;e[5]=(h*u-f*r-a*H)*w;e[6]=(z*G-y*E+b*F)*w;e[7]=(y*n-v*G-b*B)*w;e[8]=(v*E-z*n+b*A)*w;return e};b.projection=function(e,
b,l){e[0]=2/b;e[1]=0;e[2]=0;e[3]=0;e[4]=-2/l;e[5]=0;e[6]=-1;e[7]=1;e[8]=1;return e};b.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"};b.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))};b.add=function(e,b,l){e[0]=b[0]+l[0];e[1]=b[1]+l[1];e[2]=b[2]+l[2];e[3]=b[3]+l[3];e[4]=b[4]+l[4];e[5]=b[5]+
l[5];e[6]=b[6]+l[6];e[7]=b[7]+l[7];e[8]=b[8]+l[8];return e};b.subtract=g;b.multiplyScalar=function(e,b,l){e[0]=b[0]*l;e[1]=b[1]*l;e[2]=b[2]*l;e[3]=b[3]*l;e[4]=b[4]*l;e[5]=b[5]*l;e[6]=b[6]*l;e[7]=b[7]*l;e[8]=b[8]*l;return e};b.multiplyScalarAndAdd=function(e,b,l,h){e[0]=b[0]+l[0]*h;e[1]=b[1]+l[1]*h;e[2]=b[2]+l[2]*h;e[3]=b[3]+l[3]*h;e[4]=b[4]+l[4]*h;e[5]=b[5]+l[5]*h;e[6]=b[6]+l[6]*h;e[7]=b[7]+l[7]*h;e[8]=b[8]+l[8]*h;return e};b.exactEquals=function(e,b){return e[0]===b[0]&&e[1]===b[1]&&e[2]===b[2]&&
e[3]===b[3]&&e[4]===b[4]&&e[5]===b[5]&&e[6]===b[6]&&e[7]===b[7]&&e[8]===b[8]};b.equals=function(e,b){var f=e[0],h=e[1],d=e[2],a=e[3],c=e[4],g=e[5],k=e[6],t=e[7];e=e[8];var u=b[0],r=b[1],x=b[2],w=b[3],v=b[4],z=b[5],y=b[6],A=b[7];b=b[8];return Math.abs(f-u)<=m.EPSILON*Math.max(1,Math.abs(f),Math.abs(u))&&Math.abs(h-r)<=m.EPSILON*Math.max(1,Math.abs(h),Math.abs(r))&&Math.abs(d-x)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(x))&&Math.abs(a-w)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(c-
v)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(g-z)<=m.EPSILON*Math.max(1,Math.abs(g),Math.abs(z))&&Math.abs(k-y)<=m.EPSILON*Math.max(1,Math.abs(k),Math.abs(y))&&Math.abs(t-A)<=m.EPSILON*Math.max(1,Math.abs(t),Math.abs(A))&&Math.abs(e-b)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(b))};b.mul=k;b.sub=g})},"esri/core/libs/gl-matrix-2/quat":function(){define(["require","exports","./math/quat"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.quat=m})},"esri/core/libs/gl-matrix-2/math/quat":function(){define("require exports ../factories/mat3f64 ../factories/quatf64 ../factories/vec3f64 ./common ./vec3 ./vec4".split(" "),
function(n,b,m,k,g,e,f,l){function h(a,c,d){d*=.5;var e=Math.sin(d);a[0]=e*c[0];a[1]=e*c[1];a[2]=e*c[2];a[3]=Math.cos(d);return a}function d(a,c,d){var e=c[0],b=c[1],f=c[2];c=c[3];var h=d[0],l=d[1],g=d[2];d=d[3];a[0]=e*d+c*h+b*g-f*l;a[1]=b*d+c*l+f*h-e*g;a[2]=f*d+c*g+e*l-b*h;a[3]=c*d-e*h-b*l-f*g;return a}function a(a,c,d,b){var f=c[0],h=c[1],l=c[2];c=c[3];var g=d[0],k=d[1],p=d[2];d=d[3];var m,q,r;q=f*g+h*k+l*p+c*d;0>q&&(q=-q,g=-g,k=-k,p=-p,d=-d);1-q>e.EPSILON?(m=Math.acos(q),r=Math.sin(m),q=Math.sin((1-
b)*m)/r,b=Math.sin(b*m)/r):q=1-b;a[0]=q*f+b*g;a[1]=q*h+b*k;a[2]=q*l+b*p;a[3]=q*c+b*d;return a}function c(a,c){var d=c[0]+c[4]+c[8];if(0<d)d=Math.sqrt(d+1),a[3]=.5*d,d=.5/d,a[0]=(c[5]-c[7])*d,a[1]=(c[6]-c[2])*d,a[2]=(c[1]-c[3])*d;else{var e=0;c[4]>c[0]&&(e=1);c[8]>c[3*e+e]&&(e=2);var b=(e+1)%3,f=(e+2)%3,d=Math.sqrt(c[3*e+e]-c[3*b+b]-c[3*f+f]+1);a[e]=.5*d;d=.5/d;a[3]=(c[3*b+f]-c[3*f+b])*d;a[b]=(c[3*b+e]+c[3*e+b])*d;a[f]=(c[3*f+e]+c[3*e+f])*d}return a}Object.defineProperty(b,"__esModule",{value:!0});
b.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};b.setAxisAngle=h;b.getAxisAngle=function(a,c){var d=2*Math.acos(c[3]),b=Math.sin(d/2);b>e.EPSILON?(a[0]=c[0]/b,a[1]=c[1]/b,a[2]=c[2]/b):(a[0]=1,a[1]=0,a[2]=0);return d};b.multiply=d;b.rotateX=function(a,c,d){d*=.5;var e=c[0],b=c[1],f=c[2];c=c[3];var h=Math.sin(d);d=Math.cos(d);a[0]=e*d+c*h;a[1]=b*d+f*h;a[2]=f*d-b*h;a[3]=c*d-e*h;return a};b.rotateY=function(a,c,d){d*=.5;var e=c[0],b=c[1],f=c[2];c=c[3];var h=Math.sin(d);d=Math.cos(d);a[0]=
e*d-f*h;a[1]=b*d+c*h;a[2]=f*d+e*h;a[3]=c*d-b*h;return a};b.rotateZ=function(a,c,d){d*=.5;var e=c[0],b=c[1],f=c[2];c=c[3];var h=Math.sin(d);d=Math.cos(d);a[0]=e*d+b*h;a[1]=b*d-e*h;a[2]=f*d+c*h;a[3]=c*d-f*h;return a};b.calculateW=function(a,c){var d=c[0],e=c[1];c=c[2];a[0]=d;a[1]=e;a[2]=c;a[3]=Math.sqrt(Math.abs(1-d*d-e*e-c*c));return a};b.slerp=a;b.random=function(a){var c=e.RANDOM(),d=e.RANDOM(),b=e.RANDOM(),f=Math.sqrt(1-c),c=Math.sqrt(c);a[0]=f*Math.sin(2*Math.PI*d);a[1]=f*Math.cos(2*Math.PI*d);
a[2]=c*Math.sin(2*Math.PI*b);a[3]=c*Math.cos(2*Math.PI*b);return a};b.invert=function(a,c){var d=c[0],e=c[1],b=c[2];c=c[3];var f=d*d+e*e+b*b+c*c,f=f?1/f:0;a[0]=-d*f;a[1]=-e*f;a[2]=-b*f;a[3]=c*f;return a};b.conjugate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=c[3];return a};b.fromMat3=c;b.fromEuler=function(a,c,d,e){var b=.5*Math.PI/180;c*=b;d*=b;e*=b;b=Math.sin(c);c=Math.cos(c);var f=Math.sin(d);d=Math.cos(d);var h=Math.sin(e);e=Math.cos(e);a[0]=b*d*e-c*f*h;a[1]=c*f*e+b*d*h;a[2]=c*d*h-b*
f*e;a[3]=c*d*e+b*f*h;return a};b.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.copy=l.copy;b.set=l.set;b.add=l.add;b.mul=d;b.scale=l.scale;b.dot=l.dot;b.lerp=l.lerp;b.length=l.length;b.len=b.length;b.squaredLength=l.squaredLength;b.sqrLen=b.squaredLength;b.normalize=l.normalize;b.exactEquals=l.exactEquals;b.equals=l.equals;b.rotationTo=function(a,c,d){var e=f.dot(c,d);if(-.999999>e)return f.cross(q,p,c),1E-6>f.len(q)&&f.cross(q,t,c),f.normalize(q,q),h(a,q,Math.PI),a;if(.999999<
e)return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a;f.cross(q,c,d);a[0]=q[0];a[1]=q[1];a[2]=q[2];a[3]=1+e;return b.normalize(a,a)};var q=g.create(),p=g.fromValues(1,0,0),t=g.fromValues(0,1,0);b.sqlerp=function(c,d,e,b,f,h){a(u,d,f,h);a(r,e,b,h);a(c,u,r,2*h*(1-h));return c};var u=k.create(),r=k.create();b.setAxes=function(a,d,e,f){var h=x;h[0]=e[0];h[3]=e[1];h[6]=e[2];h[1]=f[0];h[4]=f[1];h[7]=f[2];h[2]=-d[0];h[5]=-d[1];h[8]=-d[2];return b.normalize(a,c(a,h))};var x=m.create()})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils ./ComponentUtils ./GeometryRecord ./IdGen ./Object3DStateSet ./Util".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){n=function(){function b(a){void 0===a&&(a={});this._objectTransformation=e.mat4f64.create();this._bvObjectSpace=new u;this._bvWorldSpace=new u;this._bvDirty=!0;this._hasVolatileTransformation=!1;this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;this.id=b._idGen.gen(a.idHint);this.castShadow=null!=a.castShadow?a.castShadow:!0;(this.metadata=a.metadata)&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new t);this.objectTransformation=
e.mat4f64.create();this._initializeGeometryRecords(a.geometries,a.materials,a.transformations,a.origins)}Object.defineProperty(b.prototype,"geometryRecords",{get:function(){return this._geometryRecords},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"geometries",{get:function(){return this._geometries},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"objectTransformation",{get:function(){return this._objectTransformation},set:function(a){g.mat4.copy(this._objectTransformation,
a);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")},enumerable:!0,configurable:!0});b.prototype.dispose=function(){for(var c=0,d=this._geometryRecords;c<d.length;c++)a.pool.release(d[c]);this._geometries=this._geometryRecords=null};b.prototype._initializeGeometryRecords=function(c,d,b,f){if(Array.isArray(c)){p.assert(d.length===c.length,"Object3D: materials don't match geometries");p.assert(b.length===c.length,"Object3D: transformations don't match geometries");this._geometryRecords=
Array(c.length);this._geometries=c.slice();for(var h=0;h<c.length;h++)this._geometryRecords[h]=a.pool.acquire(c[h],d[h],e.mat4f64.clone(b[h]),{},f&&f[h]);this._hasVolatileTransformation=!1}else this._geometryRecords=[],this._geometries=[]};Object.defineProperty(b.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(a){p.assert(null==this._parentLayer||null==a,"Object3D can only be added to a single Layer");this._parentLayer=a},enumerable:!0,configurable:!0});b.prototype.getNumGeometryRecords=
function(){return this._geometryRecords.length};b.prototype.findGeometryRecords=function(a){for(var c=[],d=0;d<this._geometries.length;d++)this._geometries[d]===a&&c.push(this._geometryRecords[d]);return c};b.prototype.getGeometryRecord=function(a){p.assert(0<=a&&a<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this._geometryRecords[a]};b.prototype.addGeometry=function(c,d,b,f,h,l){b=b?b:e.mat4f64.IDENTITY;this._geometries.push(c);c=a.pool.acquire(c,d,b,
f||{},h,l);this._geometryRecords.push(c);this._hasVolatileTransformation=this._geometryRecords.some(function(a){return!!a.shaderTransformation});this._notifyDirty("objGeometryAdded",c);this._invalidateBoundingVolume();this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;return c};b.prototype.removeGeometry=function(c){var d=this._geometryRecords.splice(c,1)[0];a.pool.release(d);this._hasVolatileTransformation=this._geometryRecords.some(function(a){return!!a.shaderTransformation});this._geometries.splice(c,
1);this._notifyDirty("objGeometryRemoved",d);this._invalidateBoundingVolume();this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;return d};b.prototype.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};b.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",this._geometryRecords[a]);this._invalidateBoundingVolume()};b.prototype.isHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=
!1;this._allComponentsHidden=!0;for(var a=0,c=this._geometryRecords;a<c.length;a++){var e=c[a];if(!d.isAllHidden(e.instanceParameters.componentVisibilities,e.geometry.data.componentOffsets)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden};b.prototype.isVisible=function(){if(this._allComponentsVisibleDirty){this._allComponentsVisibleDirty=!1;this._allComponentsVisible=!0;for(var a=0,c=this._geometryRecords;a<c.length;a++){var e=c[a];if(!d.isAllVisible(e.instanceParameters.componentVisibilities,
e.geometry.data.componentOffsets)){this._allComponentsVisible=!1;break}}}return this._allComponentsVisible};b.prototype.hide=function(){if(this._allComponentsHiddenDirty||!this._allComponentsHidden){for(var a=0,c=this._geometryRecords;a<c.length;a++){var e=c[a],b=d.hideAllComponents(e.instanceParameters.componentVisibilities);e.instanceParameters.componentVisibilities=b}this._notifyDirty("visibilityChanged");this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!1;this._allComponentsHidden=
!0;this._allComponentsVisible=!1}};b.prototype.unhide=function(){if(this._allComponentsVisibleDirty||!this._allComponentsVisible){for(var a=0,c=this._geometryRecords;a<c.length;a++){var e=c[a],b=d.unhideAllComponents(e.instanceParameters.componentVisibilities);e.instanceParameters.componentVisibilities=b}this._notifyDirty("visibilityChanged");this._allComponentsHidden=this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!1;this._allComponentsVisible=!0}};b.prototype.occlude=function(){for(var a=
q.generateObject3DStateId(1),c=0,e=this._geometryRecords;c<e.length;c++){var b=e[c];b.instanceParameters.occludees=d.addOccludee(b.instanceParameters.occludees,a)}this._notifyDirty("occlusionChanged");return a};b.prototype.removeOcclude=function(a){for(var c=0,e=this._geometryRecords;c<e.length;c++){var b=e[c];b.instanceParameters.occludees=d.removeOccludee(b.instanceParameters.occludees,a)}this._notifyDirty("occlusionChanged")};b.prototype.highlight=function(){for(var a=q.generateObject3DStateId(0),
c=0,e=this._geometryRecords;c<e.length;c++){var b=e[c];b.instanceParameters.componentHighlights=d.addHighlight(b.instanceParameters.componentHighlights,null,a)}this._notifyDirty("highlightChanged");return a};b.prototype.removeHighlight=function(a){for(var c=0,e=this._geometryRecords;c<e.length;c++){var b=e[c];b.instanceParameters.componentHighlights=d.removeHighlight(b.instanceParameters.componentHighlights,a)}this._notifyDirty("highlightChanged")};b.prototype.getComponentFromTriangleNr=function(a,
c){p.assert(0<=a&&a<this._geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");return d.componentFind(this._geometryRecords[a].geometry.data.componentOffsets,3*c)};b.prototype.setGeometryTransformation=function(c,d){p.assert(0<=c&&c<this._geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var b=this._geometryRecords[c];a.pool.release(b);d=a.pool.acquire(b.geometry,b.material,e.mat4f64.clone(d),b.instanceParameters);this._geometryRecords[c]=
d;this._notifyDirty("objGeometryReplaced",[b,d]);this._invalidateBoundingVolume()};b.prototype.getCombinedStaticTransformation=function(a,c){return g.mat4.multiply(k.unwrapOr(c,e.mat4f64.create()),this.objectTransformation,a.getStaticTransformation())};b.prototype.getCombinedShaderTransformation=function(a,c){c=c||e.mat4f64.create();g.mat4.multiply(c,this.objectTransformation,a.getShaderTransformation());return c};b.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation};
b.prototype.getBBMin=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};b.prototype.getBBMax=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};b.prototype.getCenter=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.center:this._bvWorldSpace.center};b.prototype.getBSRadius=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};
b.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var a=0;a<this._geometryRecords.length;++a){var c=this._geometries[a],d=this._geometryRecords[a],c=c.boundingInfo;this._calculateTransformedBoundingVolume(c,this._bvObjectSpace,d.getShaderTransformation());this._calculateTransformedBoundingVolume(c,this._bvWorldSpace,this.getCombinedShaderTransformation(d))}f.vec3.lerp(this._bvObjectSpace.center,
this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5);f.vec3.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);for(var d=l.vec3f64.create(),e=l.vec3f64.create(),b=h.maxScale(this.objectTransformation),a=0;a<this._geometryRecords.length;++a){var c=this._geometries[a],g=this._geometryRecords[a].getShaderTransformation(),k=h.maxScale(g),c=c.boundingInfo;f.vec3.transformMat4(d,c.getCenter(),g);g=f.vec3.distance(d,this._bvObjectSpace.center);c=c.getBSRadius()*k;this._bvObjectSpace.bsRadius=
Math.max(this._bvObjectSpace.bsRadius,g+c);f.vec3.transformMat4(e,d,this.objectTransformation);k=f.vec3.distance(e,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,k+c*b)}this._bvDirty=!1}};b.prototype._calculateTransformedBoundingVolume=function(a,c,d){var e=a.getBBMin();a=a.getBBMax();var b=l.vec3f64.clone(e),h=l.vec3f64.clone(a);f.vec3.transformMat4(b,b,d);f.vec3.transformMat4(h,h,d);for(var g=0;3>g;++g)c.bbMin[g]=Math.min(c.bbMin[g],b[g],h[g]),c.bbMax[g]=
Math.max(c.bbMax[g],b[g],h[g]);for(g=0;3>g;++g){f.vec3.copy(b,e);f.vec3.copy(h,a);b[g]=a[g];h[g]=e[g];f.vec3.transformMat4(b,b,d);f.vec3.transformMat4(h,h,d);for(var k=0;3>k;++k)c.bbMin[k]=Math.min(c.bbMin[k],b[k],h[k]),c.bbMax[k]=Math.max(c.bbMax[k],b[k],h[k])}};b.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})};b.prototype._notifyDirty=function(a,
c,d,e){this._parentLayer&&this._parentLayer.notifyDirty(a,c,d||1,e||this)};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{hasGeometry:function(c){return-1<a._geometries.indexOf(c)},getGeometryIndex:function(c){return a._geometries.indexOf(c)}}},enumerable:!0,configurable:!0});b._idGen=new c.IdGen;return b}();var t=function(){function a(){this.bbMin=l.vec3f64.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.bbMax=l.vec3f64.fromValues(-Number.MAX_VALUE,
-Number.MAX_VALUE,-Number.MAX_VALUE)}a.prototype.isEmpty=function(){return this.bbMax[0]<this.bbMin[0]&&this.bbMax[1]<this.bbMin[1]&&this.bbMax[2]<this.bbMin[2]};return a}(),u=function(a){function c(){var c=a.call(this)||this;c.center=l.vec3f64.create();c.bsRadius=0;return c}m(c,a);c.prototype.init=function(){f.vec3.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);f.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);f.vec3.set(this.center,0,0,0);this.bsRadius=
0};c.prototype.getCenter=function(){return this.center};c.prototype.getBSRadius=function(){return this.bsRadius};return c}(t);return n})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","../../../../core/ObjectPool","../../../../core/libs/gl-matrix-2/vec3","./IdGen"],function(n,b,m,k,g){return function(){function e(b,l,h,d,a,c){this.id=e._idGen.gen(b&&b.id);this.geometry=b;this.material=l;this.transformation=h;this.instanceParameters=d;this.origin=a;this.shaderTransformation=
c}e.prototype.getStaticTransformation=function(){return this.transformation};e.prototype.getShaderTransformation=function(){return this.shaderTransformation?this.shaderTransformation(this.transformation):this.transformation};e.prototype.computeAttachmentOrigin=function(e){return(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))?(k.vec3.transformMat4(e,e,this.getStaticTransformation()),!0):!1};e._idGen=new g.IdGen;
e.pool=new m(e,!0);return e}()})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._count=0}b.prototype.gen=function(b){null==b&&(b="a");return b+"_"+this._count++};return b}();b.IdGen=n})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["require","exports","./IdGen"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});var k=new m.IdGen;b.generateObject3DStateId=
function(b){return{id:k.gen(0===b?"highlight":"occludee"),channel:b}};n=function(){function b(){this.items=[]}b.prototype.addObject=function(e,b){this.items.push({type:0,objectStateId:b,object:e})};b.prototype.addRenderGeometry=function(e,b,l){this.items.push({type:1,objectStateId:b,renderGeometry:e,owner:l})};b.prototype.addExternal=function(e,b){this.items.push({type:2,objectStateId:b,remove:e})};b.prototype.remove=function(e){for(var b=this.items.length-1;0<=b;--b){var l=this.items[b];l.objectStateId===
e&&(this._removeObjectStateItem(l),this.items.splice(b,1))}};b.prototype.removeObject=function(e){for(var b=this.items.length-1;0<=b;--b){var l=this.items[b];0===l.type&&l.object===e&&(this._removeObjectStateItem(l),this.items.splice(b,1))}};b.prototype.removeRenderGeometry=function(e){for(var b=this.items.length-1;0<=b;--b){var l=this.items[b];1===l.type&&l.renderGeometry===e&&(this._removeObjectStateItem(l),this.items.splice(b,1))}};b.prototype.removeAll=function(){var e=this;this.items.forEach(function(b){e._removeObjectStateItem(b)});
this.items=[]};b.prototype._removeObjectStateItem=function(e){switch(e.type){case 0:0===e.objectStateId.channel?e.object.removeHighlight(e.objectStateId):1===e.objectStateId.channel&&e.object.removeOcclude(e.objectStateId);break;case 1:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case 2:e.remove(e.objectStateId)}};return b}();b.Object3DStateSet=n})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("require exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../state/utils/viewUtils ../../support/earthUtils ../../support/geometryUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){function q(a,c,d,e){void 0===d&&(d=h.defaultApplyOptions);void 0===e&&(e=!0);A.eyeCenterDistance=0;A.requiresTwoSteps=!1;var b=p(a,c,d,void 0,A);if(0===b)return!1;g.mat4.identity(x);g.mat4.rotate(x,x,-b,c.viewRight);switch(d.tiltMode){case 1:f.vec3.transformMat4(r,c.viewForward,x);f.vec3.scale(r,r,A.eyeCenterDistance);f.vec3.add(c.center,c.eye,r);break;case 0:f.vec3.subtract(r,c.center,c.eye);f.vec3.transformMat4(r,r,x);f.vec3.subtract(c.eye,c.center,r);break;default:m.neverReached(d.tiltMode)}f.vec3.transformMat4(c.up,
c.up,x);c.markViewDirty();return A.requiresTwoSteps&&e?q(a,c,d,!1):!0}function p(e,b,l,g,q){void 0===l&&(l=h.defaultApplyOptions);void 0===g&&(g=h.defaultApplyOptions);if(!e.state.constraints.tilt)return 0;var r=e.state.constraints.tilt(b.distance,z);var x=l;if(0!==x.interactionType){var A=x.interactionStartCamera,n=x.interactionFactor,B=r.min,C=r.max,F=p(e,A,h.defaultApplyOptions,x),E=0===F?0:d.viewAngle(e.renderCoordsHelper,A.center,A.eye);r.min=B;r.max=C;2===x.interactionType?(h.hasConstraintType(x.selection,
2)&&u(e,A,r),h.adjustRangeForInteraction(F,E,!0,n,v,r)):h.adjustRangeForInteraction(F,E,!1,n,v,r)}2===g.interactionType&&h.hasConstraintType(g.selection,2)&&u(e,g.interactionStartCamera,r);if(1===l.tiltMode||1===g.tiltMode){a:switch(q&&(q.requiresTwoSteps=!1),e.viewingMode){case "global":l=y;x=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;g=x+a.earthRadius;x=e.renderCoordsHelper.intersectManifold(b.ray,x,w);l.eyeCenterDistance=b.distance;x?(l.eyeCenterDistance=f.vec3.distance(b.eye,
w),l.tiltAtCenter=d.viewAngle(e.renderCoordsHelper,w,b.eye)):e.state.isLocal?l.tiltAtCenter=d.viewAngle(e.renderCoordsHelper,b.center,b.eye):(c.sphere.closestPointOnSilhouette(c.sphere.wrap(g),b.ray,w),l.eyeCenterDistance=f.vec3.distance(b.eye,w),l.tiltAtCenter=k.acosClamped(-f.vec3.dot(b.viewForward,f.vec3.normalize(w,w))));l.radius=g;l.eyeRadius=f.vec3.length(b.eye);l.constraints=e.state.constraints;l.centerIsOnSurface=x;b=k.clamp(l.tiltAtCenter,r.min,r.max);if(1E-9<Math.abs(l.tiltAtCenter-b)){if(l.centerIsOnSurface){b=
l.constraints;e=g=l.tiltAtCenter;r=b.clampTilt(l.eyeCenterDistance,g);x=t(l,r);if(b.clampTilt(x,g)!==r)for(g=0;10>g&&1E-9<Math.abs(r-e);)x=(e+r)/2,A=t(l,x),A=b.clampTilt(A,x),1E-9<Math.abs(A-x)?e=x:r=x,g++;b=r;r=b;e=k.asinClamped(l.radius/l.eyeRadius*Math.sin(l.tiltAtCenter));r=k.asinClamped(l.radius/l.eyeRadius*Math.sin(r));e=l.eyeRadius>l.radius?e-r:r-e}else b=l.constraints.clampTilt(l.eyeCenterDistance,l.tiltAtCenter),q&&b<Math.PI/2&&(q.requiresTwoSteps=!0,b=Math.PI/2-1E-5),e=l.tiltAtCenter-Math.PI/
2-(b-Math.PI/2);q&&(q.eyeCenterDistance=t(l,b));q=e}else q=0;break a;case "local":g=d.viewAngle(e.renderCoordsHelper,b.center,b.eye);l=k.clamp(g,r.min,r.max);r=g-l;1E-9<Math.abs(r)?(q&&(g=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,e=e.renderCoordsHelper.getAltitude(b.eye)-g,l=Math.cos(l),q.eyeCenterDistance=1E-4<Math.abs(l)?e/l:b.distance),q=r):q=0;break a;default:m.neverReached(e.viewingMode),q=void 0}return q}q=d.viewAngle(e.renderCoordsHelper,b.center,b.eye);b=k.clamp(q,
r.min,r.max);q-=b;q=1E-9<Math.abs(q)?q:0;return q}function t(a,c){if(!a.centerIsOnSurface)return a.eyeCenterDistance;c=Math.PI-k.clamp(c,0,Math.PI);var d=k.asinClamped(a.radius/a.eyeRadius*Math.sin(c)),e=Math.sin(Math.PI-c-d)/Math.sin(c);return a.eyeRadius<a.radius&&1<e?Math.sin(Math.PI-c-(Math.PI-d))/Math.sin(c)*a.eyeRadius:e*a.eyeRadius}function u(c,d,e){if(!c.state.isLocal){var b=c.state.constraints;if(b.altitude){c=f.vec3.squaredLength(d.center);var h=Math.sqrt(c);d=d.distance;var l=b.altitude.min+
a.earthRadius,b=b.altitude.max+a.earthRadius,l=(l*l-d*d-c)/(-2*h*d);e.min=Math.max(e.min,Math.min(Math.PI-k.acosClamped((b*b-d*d-c)/(-2*h*d)),e.max));e.max=Math.min(e.max,Math.PI-k.acosClamped(l))}}}Object.defineProperty(b,"__esModule",{value:!0});b.applyTiltConstraint=q;b.getTiltConstraintError=p;var r=l.vec3f64.create(),x=e.mat4f64.create(),w=l.vec3f64.create(),v=k.deg2rad(5),z={min:0,max:0},y={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},A={eyeCenterDistance:0,
requiresTwoSteps:!1}})},"esri/views/3d/state/utils/viewUtils":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.viewAngle=function(b,h,d){b.worldUpAtPosition(h,e);k.vec3.subtract(f,d,h);b=k.vec3.length(f);return 0===b?0:m.acosClamped(k.vec3.dot(f,e)/b)};var e=g.vec3f64.create(),f=g.vec3f64.create()})},"esri/views/animation/easing":function(){define(["require",
"exports"],function(n,b){function m(e){return e}function k(e){var b=2*(e-Math.sqrt((e-1)*e)),l=b/2/e;return function(f){return f<l?e*f*f:b*f-b+1}}function g(e,b){return function(f){return f<b?b*e(f/b):1-e((1-f)/(1-b))*(1-b)}}Object.defineProperty(b,"__esModule",{value:!0});b.linear=m;b.inQuad=function(e){return e*e};b.outQuad=function(e){return 1-b.inQuad(1-e)};b.inOutQuad=function(e){return.5>e?b.inQuad(2*e)/2:(b.outQuad(2*(e-.5))+1)/2};b.inCubic=function(e){return e*e*e};b.outCubic=function(e){return 1-
b.inCubic(1-e)};b.inOutCubic=function(e){return.5>e?b.inCubic(2*e)/2:(b.outCubic(2*(e-.5))+1)/2};b.inQuart=function(e){return e*e*e*e};b.outQuart=function(e){return 1-b.inQuart(1-e)};b.inOutQuart=function(e){return.5>e?b.inQuart(2*e)/2:(b.outQuart(2*(e-.5))+1)/2};b.inQuint=function(e){return e*e*e*e*e};b.outQuint=function(e){return 1-b.inQuint(1-e)};b.inOutQuint=function(e){return.5>e?b.inQuint(2*e)/2:(b.outQuint(2*(e-.5))+1)/2};b.inSine=function(e){return-Math.cos(e*Math.PI/2)+1};b.outSine=function(e){return 1-
b.inSine(1-e)};b.inOutSine=function(e){return.5>e?b.inSine(2*e)/2:(b.outSine(2*(e-.5))+1)/2};b.inExpo=function(e){return Math.pow(2,10*(e-1))};b.outExpo=function(e){return 1-b.inExpo(1-e)};b.inOutExpo=function(e){return.5>e?b.inExpo(2*e)/2:(b.outExpo(2*(e-.5))+1)/2};b.inCirc=function(e){return-(Math.sqrt(1-e*e)-1)};b.outCirc=function(e){return 1-b.inCirc(1-e)};b.inOutCirc=function(e){return.5>e?b.inCirc(2*e)/2:(b.outCirc(2*(e-.5))+1)/2};b.inCoastQuad=g(k(1),1);b.outCoastQuad=g(k(1),0);b.inOutCoastQuad=
g(k(1),.5);b.inCoastCubic=g(k(2),1);b.outCoastCubic=g(k(2),0);b.inOutCoastCubic=g(k(2),.5);b.inCoastQuart=g(k(3),1);b.outCoastQuart=g(k(3),0);b.inOutCoastQuart=g(k(3),.5);b.inCoastQuint=g(k(4),1);b.outCoastQuint=g(k(4),0);b.inOutCoastQuint=g(k(4),.5);b.named={linear:m,"in-quad":b.inQuad,"out-quad":b.outQuad,"in-out-quad":b.inOutQuad,"in-coast-quad":b.inCoastQuad,"out-coast-quad":b.outCoastQuad,"in-out-coast-quad":b.inOutCoastQuad,"in-cubic":b.inCubic,"out-cubic":b.outCubic,"in-out-cubic":b.inOutCubic,
"in-coast-cubic":b.inCoastCubic,"out-coast-cubic":b.outCoastCubic,"in-out-coast-cubic":b.inOutCoastCubic,"in-quart":b.inQuart,"out-quart":b.outQuart,"in-out-quart":b.inOutQuart,"in-coast-quart":b.inCoastQuart,"out-coast-quart":b.outCoastQuart,"in-out-coast-quart":b.inOutCoastQuart,"in-quint":b.inQuint,"out-quint":b.outQuint,"in-out-quint":b.inOutQuint,"in-coast-quint":b.inCoastQuint,"out-coast-quint":b.outCoastQuint,"in-out-coast-quint":b.inOutCoastQuint,"in-sine":b.inSine,"out-sine":b.outSine,"in-out-sine":b.inOutSine,
"in-expo":b.inExpo,"out-expo":b.outExpo,"in-out-expo":b.inOutExpo,"in-circ":b.inCirc,"out-circ":b.outCirc,"in-out-circ":b.inOutCirc}})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector".split(" "),function(n,b,m,k,g,e,
f,l,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(c){function b(a,d,b){var f=c.call(this,"interaction"===b?null:new g)||this;f.viewState=a;f.intersectionHelper=d;f.mode=b;f.hasTarget=!1;f.animation=new e.default(f.viewState.mode);return f}m(b,c);Object.defineProperty(b.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});b.prototype.begin=function(c,e){this.hasTarget=!0;e=this.animationSettings(e);d.copyFrom(this.viewState.camera);
var b=new h.Intersector(this.viewState.mode);this.intersectionHelper.intersectRay(d.ray,b,a)&&(d.center=a);this.animation.update(d,c,e);this.animation.finished&&this.finish()};b.prototype.finish=function(){this.animation.currentTime=this.animation.time;c.prototype.finish.call(this)};Object.defineProperty(b.prototype,"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!0,configurable:!0});b.prototype.stepController=function(a,c){this.hasTarget&&this.animation.step(a,
c)};b.prototype.onControllerEnd=function(a){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,a),this.animation.currentTime=this.animation.time);c.prototype.onControllerEnd.call(this,a)};b.prototype.animationSettings=function(a){void 0===a&&(a={});return{apex:{maximumDistance:this.viewState.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:a.speedFactor,duration:a.duration,maxDuration:a.maxDuration,easing:a.easing}};
return b}(f.AnimationController);b.PointToPointAnimationController=n;var d=new l.default,a=k.vec3f64.create()})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});var h=g.vec3f64.create();
n=function(){function d(a){this.currentTime=0;this.animation=new l.Animation(function(){return new e.default(a)});this._current=new e.default(a)}Object.defineProperty(d.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0});d.prototype.update=function(a,c,d){var e=this.animation.definition.source,b=this.animation.definition.target,
f=k.vec3.subtract(h,c.center,a.center),l=k.vec3.length(f);1E-5<=l?(f[0]/=l,f[1]/=l,f[2]/=l):(f[0]=0,f[1]=1,f[0]=0);k.vec3.copy(e.lookAtDirection,f);k.vec3.copy(b.lookAtDirection,f);e.copyFromRenderCamera(a);b.copyFromRenderCamera(c);this._current.copyFrom(e);this.animation.update(e,b,d);this.currentTime=0;a.almostEquals(c,5E-4,!0)&&(this.currentTime=this.animation.time)};d.prototype.cameraAt=function(a,c){this.animation.cameraAt(a,this._current);c=c||new f.default;this._current.copyToRenderCamera(c);
return c};d.prototype.step=function(a,c){this.finished||(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,c)};return d}();b.Animation=n;b.default=n})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils".split(" "),
function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});var h=f.vec3f64.create(),d=f.vec3f64.create(),a=f.vec3f64.create(),c=f.vec3f64.create(),q=f.vec3f64.create(),p=f.vec3f64.create(),t=f.vec3f64.fromValues(0,0,1),u=f.vec3f64.fromValues(0,1,0),r=f.vec3f64.fromValues(1,0,0),x=g.mat3f64.create();n=function(){function b(a){void 0===a&&(a="global");this.viewingMode=a;this.center=f.vec3f64.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=f.vec3f64.clone(u)}b.prototype.pixelsPerPanAtZoom=
function(a){return this.size/2/(this._zoomToPanScale*a)};b.prototype.zoomAtPixelsPerPan=function(a){return this.size/2/(this._zoomToPanScale*a)};b.prototype.pixelsPerRotateAtZoom=function(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};b.prototype.compareTo=function(a,c){c||(c={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var d=e.vec3.length(this.center),b=e.vec3.length(a.center),d=(d+b)/2;c.pan=l.angle(this.center,a.center)*d}else c.pan=e.vec3.distance(this.center,
a.center);d=Math.abs(a.yaw-this.yaw);d>=Math.PI&&(d=2*Math.PI-d);c.rotate=Math.max(d,Math.abs(a.pitch-this.pitch));c.sourceZoom=this.distance;c.targetZoom=a.distance;return c};b.prototype.interpolate=function(a,c,d){"global"===this.viewingMode?l.slerp(a.center,c.center,d.pan,this.center):e.vec3.lerp(this.center,a.center,c.center,d.pan);this.distance=m.lerp(a.distance,c.distance,d.zoom);this.pitch=m.lerp(a.pitch,c.pitch,d.rotate);a=a.yaw;c=c.yaw;Math.abs(c-a)>=Math.PI&&(a+=2*(a<c?1:-1)*Math.PI);this.yaw=
m.lerp(a,c,d.rotate)};b.prototype.copyFrom=function(a){e.vec3.copy(this.center,a.center);this.pitch=a.pitch;this.yaw=a.yaw;this.distance=a.distance;e.vec3.copy(this.lookAtDirection,a.lookAtDirection);this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode};b.prototype.copyFromRenderCamera=function(a){var d=this._lookAtOrientation(a.center,x);e.vec3.copy(this.center,a.center);e.vec3.subtract(c,a.center,a.eye);e.vec3.transformMat3(c,c,d);e.vec3.transformMat3(q,a.up,d);this.distance=e.vec3.length(c);
c[0]/=this.distance;c[1]/=this.distance;c[2]/=this.distance;this.pitch=this._eyeUpToPitch(c);this.yaw=this._eyeUpToYaw(c,q);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)};b.prototype.copyFromCommon=function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};b.prototype.copyToRenderCamera=function(a){var d=this._lookAtOrientation(this.center,x);k.mat3.transpose(d,d);this._axisAngleVec3(r,this.pitch-Math.PI/2,u,c);this._axisAngleVec3(t,this.yaw,c);this._axisAngleVec3(r,
this.pitch-Math.PI/2,t,q);this._axisAngleVec3(t,this.yaw,q);e.vec3.scale(c,c,this.distance);e.vec3.transformMat3(c,c,d);e.vec3.transformMat3(q,q,d);a.center=this.center;a.eye=e.vec3.subtract(c,this.center,c);a.up=q};b.prototype._axisAngleVec3=function(c,b,f,l){void 0===l&&(l=f);var g=Math.cos(b);b=Math.sin(b);e.vec3.scale(h,f,g);e.vec3.cross(d,c,f);e.vec3.scale(d,d,b);e.vec3.scale(a,c,(1-g)*e.vec3.dot(c,f));return e.vec3.add(l,e.vec3.add(l,h,d),a)};b.prototype._lookAtOrientation=function(c,b){this._upAtLookAt(c,
a);e.vec3.cross(h,this.lookAtDirection,a);e.vec3.normalize(h,h);0===h[0]&&0===h[1]&&0===h[2]&&e.vec3.copy(h,r);e.vec3.cross(d,a,h);e.vec3.normalize(d,d);b||(b=g.mat3f64.create());b[0]=h[0];b[1]=d[0];b[2]=a[0];b[3]=h[1];b[4]=d[1];b[5]=a[1];b[6]=h[2];b[7]=d[2];b[8]=a[2];return b};b.prototype._upAtLookAt=function(a,c){return"local"===this.viewingMode?e.vec3.copy(c,t):e.vec3.normalize(c,a)};b.prototype._eyeUpToPitch=function(a){return Math.PI-l.angle(t,a)};b.prototype._eyeUpToYaw=function(a,c){.5>Math.abs(c[2])?
(e.vec3.copy(p,c),0<a[2]&&e.vec3.scale(p,p,-1)):e.vec3.copy(p,a);e.vec3.cross(d,p,t);e.vec3.normalize(d,d);return l.angle(r,d,t)};return b}();b.default=n})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("require exports ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ../../support/geometryUtils/vector ./Util".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){function t(a,c){var d=c[0]-a[0],e=c[1]-a[1],b=c[2]-a[2];a=c[3]-a[3];return d*d+e*e+b*b+a*a}function u(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]}function r(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(c,b,f){void 0===c&&(c=l.vec3f64.create());void 0===b&&(b=l.vec3f64.create());void 0===f&&(f=l.vec3f64.fromValues(0,0,1));this._viewUp=l.vec3f64.create();this._viewForward=
l.vec3f64.create();this._viewRight=l.vec3f64.create();this._ray=a.ray.createWrapper();this._viewport=d.vec4f64.fromValues(0,0,1,1);this._padding=d.vec4f64.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._near=1;this._far=1E3;this._viewDirty=!0;this._viewMatrix=e.mat4f64.create();this._projectionDirty=!0;this._projectionMatrix=e.mat4f64.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=e.mat4f64.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=e.mat4f64.create();
this._frustumDirty=!0;this._frustum=a.frustum.create();this._fullViewport=null;this.pixelRatio=1;this.relativeElevation=0;this._eye=l.vec3f64.clone(c);this._center=l.vec3f64.clone(b);this._up=l.vec3f64.clone(f);this._padding=d.vec4f64.create()}Object.defineProperty(b.prototype,"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,
this._center)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"ray",{get:function(){this._ray.origin=this.eye;this._ray.direction||(this._ray.direction=l.vec3f64.create());f.vec3.subtract(this._ray.direction,this.center,this.eye);return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewMatrix",
{get:function(){this._ensureViewClean();return this._viewMatrix},set:function(a){g.mat4.copy(this._viewMatrix,a);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewRight",{get:function(){this._ensureViewClean();return this._viewRight},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"near",{get:function(){return this._near},set:function(a){this._near!==a&&(this._near=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"far",{get:function(){return this._far},set:function(a){this._far!==
a&&(this._far=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumDirty=this._viewProjectionDirty=
this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"y",{get:function(){return this._viewport[1]},set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumDirty=this._viewProjectionDirty=
this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this._viewport[3]},set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(a){this.width=a-(this._padding[1]+this._padding[3])},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(a){this.height=a-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=d.vec4f64.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=
this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"padding",{get:function(){return this._padding},set:function(a){if(this._padding[0]!==a[0]||this._padding[1]!==a[1]||this._padding[2]!==a[2]||this._padding[3]!==a[3])this._viewport[0]+=a[3]-this._padding[3],this._viewport[1]+=a[2]-this._padding[2],
this._viewport[2]-=a[1]+a[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=a[0]+a[2]-(this._padding[0]+this._padding[2]),h.vec4.copy(this._padding,a),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewProjectionMatrix",{get:function(){this._viewProjectionDirty&&(g.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var a=this.width,c=this.height,d=this.near*Math.tan(this.fovY/2),e=d*this.aspect;g.mat4.frustum(this._projectionMatrix,-e*(1+2*this._padding[3]/a),e*(1+2*this._padding[1]/a),-d*(1+2*this._padding[2]/c),d*(1+2*this._padding[0]/c),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){g.mat4.copy(this._projectionMatrix,a);this._projectionDirty=
!1;this._frustumDirty=this._viewProjectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fov",{get:function(){return this._fov},set:function(a){this._fov=a;this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fovX",{get:function(){return p.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=p.fovx2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=
this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fovY",{get:function(){return p.fovd2fovy(this._fov,this.width,this.height)},set:function(a){this._fov=p.fovy2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"distance",{get:function(){return f.vec3.distance(this._center,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"frustum",{get:function(){this._recomputeFrustum();return this._frustum},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewInverseTransposeMatrix",{get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=e.mat4f64.create()),g.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),g.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=
!1;return this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"perRenderPixelRatio",{get:function(){return Math.tan(this.fovX/2)/(this.width/2)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"perScreenPixelRatio",{get:function(){return this.perRenderPixelRatio*this.pixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"aboveGround",{get:function(){return 0<=this.relativeElevation},enumerable:!0,configurable:!0});
b.prototype.copyFrom=function(c){f.vec3.copy(this._eye,c._eye);f.vec3.copy(this._center,c._center);f.vec3.copy(this._up,c._up);h.vec4.copy(this._viewport,c._viewport);h.vec4.copy(this._padding,c._padding);this._near=c._near;this._far=c._far;this._fov=c._fov;this.relativeElevation=c.relativeElevation;this._viewDirty=c._viewDirty;this._viewDirty||(g.mat4.copy(this._viewMatrix,c._viewMatrix),f.vec3.copy(this._viewRight,c._viewRight),f.vec3.copy(this._viewUp,c._viewUp),f.vec3.copy(this._viewForward,c._viewForward));
c._projectionDirty?this._projectionDirty=!0:(g.mat4.copy(this._projectionMatrix,c._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;this._frustumDirty=c._frustumDirty;this._frustumDirty||(a.frustum.copy(c._frustum,this._frustum),this._frustumDirty=!1);c._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?g.mat4.copy(this._viewInverseTransposeMatrix,c._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=e.mat4f64.clone(c._viewInverseTransposeMatrix),
this._viewInverseTransposeMatrixDirty=!1);c._fullViewport?this._fullViewport?h.vec4.copy(this._fullViewport,c._fullViewport):this._fullViewport=d.vec4f64.clone(c._fullViewport):this._fullViewport=null;this.pixelRatio=c.pixelRatio;return this};b.prototype.copyViewFrom=function(a){this.eye=a.eye;this.center=a.center;this.up=a.up};b.prototype.clone=function(){var a=new b;a.copyFrom(this);return a};b.prototype.equals=function(a){return u(this._eye,a._eye)&&u(this._center,a._center)&&u(this._up,a._up)&&
r(this._viewport,a._viewport)&&r(this._padding,a._padding)&&this._near===a._near&&this._far===a._far&&this._fov===a._fov&&this.pixelRatio===a.pixelRatio&&this.relativeElevation===a.relativeElevation};b.prototype.almostEquals=function(a,d,e){void 0===e&&(e=!1);d=f.vec3.distance(this._eye,this._center)*(d||5E-4);d*=d;e?(c.directionFromTo(v,a._eye,a._center),c.directionFromTo(z,this._eye,this._center),e=1E-10):(f.vec3.copy(v,a._center),f.vec3.copy(z,this._center),e=d);return f.vec3.squaredDistance(a._eye,
this._eye)<d&&f.vec3.squaredDistance(v,z)<e&&.001>Math.abs(a._fov-this._fov)&&.5>t(a._padding,this._padding)&&.5>t(a._viewport,this._viewport)&&this.pixelRatio===a.pixelRatio};b.prototype.markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};b.prototype.computeRenderPixelSizeAt=function(a){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(a))};b.prototype.computeRenderPixelSizeAtDist=function(a){return a*this.perRenderPixelRatio};b.prototype.computeScreenPixelSizeAt=
function(a){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(a))};b.prototype.viewDirectionDistance=function(a){return Math.abs(q.projectPointSignedLength(this.viewForward,f.vec3.subtract(v,a,this._eye)))};b.prototype.computeScreenPixelSizeAtDist=function(a){return a*this.perScreenPixelRatio};b.prototype.computeDistanceFromRadius=function(a,c){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(c||1)))};b.prototype.getScreenCenter=function(a){void 0===a&&(a=k.createScreenPointArray());
a[0]=(this.padding[3]+this.width/2)/this.pixelRatio;a[1]=(this.padding[0]+this.height/2)/this.pixelRatio;return a};b.prototype.getRenderCenter=function(a,c,d){void 0===c&&(c=.5);void 0===d&&(d=.5);a||(a=k.createRenderScreenPointArray3());a[0]=this.padding[3]+this.width*c;a[1]=this.padding[2]+this.height*d;2<a.length&&(a[2]=.5);return a};b.prototype.setGLViewport=function(a){var c=this.viewport,d=this.padding;a.setViewport(c[0]-d[3],c[1]-d[2],c[2]+d[1]+d[3],c[3]+d[0]+d[2])};b.prototype.applyProjection=
function(a,c,d){void 0===d&&(d=!1);a!==x&&f.vec3.copy(x,a);x[3]=1;d&&(c[2]=-x[2]);h.vec4.transformMat4(x,x,this.projectionMatrix);f.vec3.scale(x,x,1/Math.abs(x[3]));a=this.fullViewport;c[0]=m.lerp(0,a[0]+a[2],.5+.5*x[0]);c[1]=m.lerp(0,a[1]+a[3],.5+.5*x[1]);d||(c[2]=.5*(x[2]+1));return c};b.prototype.projectPoint=function(a,c){x[0]=a[0];x[1]=a[1];x[2]=a[2];x[3]=1;h.vec4.transformMat4(x,x,this.viewProjectionMatrix);if(0===x[3])return null;f.vec3.scale(x,x,1/Math.abs(x[3]));a=this.fullViewport;"x"in
c?(c.x=m.lerp(0,a[0]+a[2],.5+.5*x[0]),c.y=m.lerp(0,a[1]+a[3],.5+.5*x[1])):(c[0]=m.lerp(0,a[0]+a[2],.5+.5*x[0]),c[1]=m.lerp(0,a[1]+a[3],.5+.5*x[1]),2<c.length&&(c[2]=.5*(x[2]+1)));return c};b.prototype.unprojectPoint=function(a,c){g.mat4.multiply(w,this.projectionMatrix,this.viewMatrix);if(!g.mat4.invert(w,w))return null;var d=this.fullViewport;x[0]=2*(a[0]-d[0])/d[2]-1;x[1]=2*(a[1]-d[1])/d[3]-1;x[2]=2*a[2]-1;x[3]=1;h.vec4.transformMat4(x,x,w);if(0===x[3])return null;c[0]=x[0]/x[3];c[1]=x[1]/x[3];
c[2]=x[2]/x[3];return c};b.prototype.computeUp=function(a){"global"===a?this.computeUpGlobal():this.computeUpLocal()};b.prototype.screenToRender=function(a,c){var d=this.fullHeight-a[1]*this.pixelRatio;c[0]=a[0]*this.pixelRatio;c[1]=d;return c};b.prototype.renderToScreen=function(a,c){var d=(this.fullHeight-a[1])/this.pixelRatio;c[0]=a[0]/this.pixelRatio;c[1]=d;return c};b.prototype.computeUpGlobal=function(){f.vec3.subtract(v,this.center,this.eye);var a=f.vec3.length(this.center);1>a?(f.vec3.set(this.up,
0,0,1),this.markViewDirty()):Math.abs(f.vec3.dot(v,this.center))>.9999*f.vec3.length(v)*a||(f.vec3.cross(this.up,v,this.center),f.vec3.cross(this.up,this.up,v),f.vec3.normalize(this.up,this.up),this.markViewDirty())};b.prototype.computeUpLocal=function(){c.directionFromTo(v,this.eye,this.center);.9999>=Math.abs(v[2])&&(f.vec3.scale(v,v,v[2]),f.vec3.set(this.up,-v[0],-v[1],1-v[2]),f.vec3.normalize(this.up,this.up),this.markViewDirty())};b.prototype._compareAndSetView=function(a,c){u(a,c)||(f.vec3.copy(c,
a),this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0)};b.prototype._recomputeFrustum=function(){this._frustumDirty&&(a.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};b.prototype._ensureViewClean=function(){this._viewDirty&&(g.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),f.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),f.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],
this._viewMatrix[9]),f.vec3.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return b}();b.default=n;var x=d.vec4f64.create(),w=e.mat4f64.create(),v=l.vec3f64.create(),z=l.vec3f64.create()})},"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});var f=
{zoom:0,pan:0,rotate:0};n=function(){function b(b){this.createCamera=b;this.time=0;this.definition=new k.Definition(b);this.path=new e.Path}b.prototype.update=function(e,d,a){this.definition.update(e,d,a);this.path.update(this.definition,a);this.time=this._applyTimeSettings(this.path.time,a);this.settings=a};b.prototype.cameraAt=function(e,d){d=d||this.createCamera();e=Math.min(Math.max(0,e),1);e=this.settings.easing?this.normalizedEasing(this.settings.easing,e):1<=this.time?this.normalizedEasing(m.inOutCoastQuad,
e):this.normalizedEasing(m.outExpo,e);e=this.path.interpolateComponentsAt(e,f);d.interpolate(this.definition.source,this.definition.target,e);return d};b.prototype.normalizedEasing=function(e,d){var a=e(0),c=e(1);return(e(d)-a)/(c-a)};b.prototype._applyTimeSettings=function(e,d){var a=null!=d.speedFactor?d.speedFactor:1;null!=d.duration?e=d.duration:null!=d.speedFactor&&(e/=a);return e=Math.min(Math.max(null!=d.minDuration?d.minDuration:g.defaultSettings.minDuration/a,e),null!=d.maxDuration?d.maxDuration:
g.defaultSettings.maxDuration/a)};return b}();b.Animation=n;b.default=n})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.createCamera=b;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:m.defaultSettings.desiredScreenFlow};this.source=b();this.target=b()}b.prototype.clone=function(){var g=new b(this.createCamera);
g.copyFrom(this);return g};b.prototype.copyFrom=function(b){this.update(b.source,b.target,b.settings)};b.prototype.update=function(b,e,f){this.source!==b&&this.source.copyFrom(b);this.target!==e&&this.target.copyFrom(e);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=f.desiredScreenFlow?f.desiredScreenFlow:m.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/
2};b.prototype.halfWindowPanAtZoom=function(b){b=this.target.pixelsPerPanAtZoom(b);return this.halfWindowSize/b};Object.defineProperty(b.prototype,"hasZoom",{get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasRotate",{get:function(){return 1E-9<this.compared.rotate},enumerable:!0,
configurable:!0});return b}();b.Definition=n;b.default=n})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../easing ../Path ../Segment ./planning".split(" "),function(n,b,m,k,g,e,f){Object.defineProperty(b,
"__esModule",{value:!0});n=function(b){function h(d,a){var c=b.call(this)||this;c._preallocSegments=[new e.default,new e.default,new e.default];c.update(d,a);return c}m(h,b);h.prototype.update=function(d,a){if(d){this.definition?this.definition.copyFrom(d):this.definition=d.clone();var c=null;a&&a.apex&&(c=f.optimalDistance(d,a.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==c?this._updateWithoutApex():this._updateWithApex(c,a.apex)}};h.prototype.segmentInterpolateComponentsAt=
function(d,a,c){c=d.interpolateComponentsAt(a,c);d===this._ascensionSegment?c.zoom=k.outQuad(c.zoom):d===this._descensionSegment&&(c.zoom=k.inQuad(c.zoom));return c};h.prototype._updateWithApex=function(d,a){var c=this._preallocSegments,e=c[0],b=c[1],c=c[2],f=null!=a.ascensionFactor?a.ascensionFactor:.5;a=Math.min(1-f,null!=a.ascensionFactor?a.descensionFactor:.5);var h=1-f-a;e.definition?e.definition.copyFrom(this.definition):e.definition=this.definition.clone();e.definition.compared.targetZoom=
d;e.definition.compared.pan=this.definition.compared.pan*f;e.definition.compared.rotate=this.definition.compared.rotate*f;e.update();this._ascensionSegment=e;this.segments.push(e);0<h&&(b.definition?b.definition.copyFrom(this.definition):b.definition=this.definition.clone(),b.definition.copyFrom(this.definition),b.definition.compared.sourceZoom=d,b.definition.compared.targetZoom=d,b.definition.compared.pan=this.definition.compared.pan*h,b.definition.compared.rotate=this.definition.compared.rotate*
h,b.update(),this.segments.push(b));c.definition?c.definition.copyFrom(this.definition):c.definition=this.definition.clone();c.definition.compared.sourceZoom=d;c.definition.compared.pan=this.definition.compared.pan*a;c.definition.compared.rotate=this.definition.compared.rotate*a;c.update();this._descensionSegment=c;this.segments.push(c)};h.prototype._updateWithoutApex=function(){var d=this._preallocSegments[0];d.update(this.definition);this.segments.push(d)};return h}(g.default);b.Path=n;b.default=
n})},"esri/views/animation/pointToPoint/Path":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.segments=[]}Object.defineProperty(b.prototype,"time",{get:function(){return this.segments.reduce(function(b,g){return b+g.time},0)},enumerable:!0,configurable:!0});b.prototype.interpolateComponentsAt=function(b,g){b=Math.min(Math.max(b,0),1);b*=this.time;for(var e=0,f=0,l=this.definition,h=0;h<this.segments.length;h++){var d=
this.segments[h],a=d.definition;if(b<=d.time||h===this.segments.length-1)return g=this.segmentInterpolateComponentsAt(d,b/d.time,g),g.pan=l.hasPan?(e+a.compared.pan*g.pan)/l.compared.pan:1,g.rotate=l.hasRotate?(f+a.compared.rotate*g.rotate)/l.compared.rotate:1,b=g.zoom*(a.compared.targetZoom-a.compared.sourceZoom)+a.compared.sourceZoom,e=this.segments[0].definition.compared.sourceZoom,f=this.segments[this.segments.length-1].definition.compared.targetZoom,g.zoom=l.hasZoom?(b-e)/(f-e):1,g;b-=d.time;
e+=a.compared.pan;f+=a.compared.rotate}};b.prototype.segmentInterpolateComponentsAt=function(b,g,e){return b.interpolateComponentsAt(g,e)};return b}();b.Path=n;b.default=n})},"esri/views/animation/pointToPoint/Segment":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){b&&this.update(b)}b.prototype.update=function(b){b&&(this.definition?this.definition.copyFrom(b):this.definition=b.clone());this._updatePrecomputedVariables();
this._updatePixelFlow()};b.prototype._updatePrecomputedVariables=function(){var b=this.definition,g=b.compared,e=g.sourceZoom,f=g.targetZoom;this._zoomSign=e>f?1:-1;this._panPixelsAtSource=g.pan*b.source.pixelsPerPanAtZoom(e);b=(b.source.pixelsPerRotateAtZoom(e)+b.target.pixelsPerRotateAtZoom(f))/2;this._rotatePixels=g.rotate*b};b.prototype._updatePixelFlow=function(){var b=this.definition.compared.sourceZoom,g=this.definition.compared.targetZoom,e=this.definition,f=e.hasZoom,l=e.hasPan,e=e.hasRotate,
h=0,d=0;f&&(l&&(h=(g/b-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),e&&(d=Math.log(b/g)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;b=this.definition.desiredPixelFlow;f&&l&&e?(g=h+d+h*d,this._zoomPixelFlow=h*d/g*b,this._panPixelFlow=d/g*b,this._rotatePixelFlow=h/g*b):f&&l?(g=1+h,this._zoomPixelFlow=h/g*b,this._panPixelFlow=1/g*b):f&&e?(g=1+d,this._zoomPixelFlow=
d/g*b,this._rotatePixelFlow=1/g*b):l&&e?(h=this._panPixelsAtSource/this._rotatePixels,g=1+h,this._panPixelFlow=h/g*b,this._rotatePixelFlow=1/g*b):l?this._panPixelFlow=b:f?this._zoomPixelFlow=b:e&&(this._rotatePixelFlow=b);this.time=e?this.rotateTime:f?this.zoomTime:l?this.panTime:0};Object.defineProperty(b.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/
this._zoomPixelFlow:0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var b=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*b+1)/(b*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?
this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,configurable:!0});b.prototype._interpolateComponentsZoom=function(b){if(0===b||1===b)return b;if(this.definition.hasZoom){var g=this.definition.compared.sourceZoom,e=this.definition.compared.targetZoom;return(g*Math.pow(g/e,-b)-g)/(e-g)}return b};b.prototype._interpolateComponentsPan=function(b){if(0===b||1===b)return b;if(this.definition.hasPan&&this.definition.hasZoom){var g=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;
return 1/this._panPixelsAtSource*this._panPixelFlow*(Math.pow(2,g*b*this.time)-1)/(g*Math.LN2)}return b};b.prototype._interpolateComponentsRotate=function(b){return b};b.prototype.interpolateComponentsAt=function(b,g){b=Math.min(Math.max(b,0),1);var e=this._interpolateComponentsZoom(b),f=this._interpolateComponentsPan(b);b=this._interpolateComponentsRotate(b);g?(g.zoom=e,g.pan=f,g.rotate=b):g={zoom:e,pan:f,rotate:b};return g};return b}();b.Segment=n;b.default=n})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require",
"exports","./functions"],function(n,b,m){function k(b,e){var f=Math.max(b.compared.sourceZoom,b.compared.targetZoom);b=b.source.zoomAtPixelsPerPan(b.desiredPixelFlow/b.compared.pan)/2;return b<f?null!=e.maximumDistance?f+(e.maximumDistance-f)/2:1.5*f:e.maximumDistance?Math.min(e.maximumDistance,b):b}Object.defineProperty(b,"__esModule",{value:!0});b.optimalDistance=function(b,e){var f=k(b,e),l={ascensionFactor:null!=e.ascensionFactor?e.ascensionFactor:.5,descensionFactor:null!=e.descensionFactor?
e.descensionFactor:.5},h=0===l.ascensionFactor,d=0===l.descensionFactor,a=h?m.tAscensionZoomOnly:m.tAscensionZoomPan,c=h?m.dtAscensionZoomOnly:m.dtAscensionZoomPan,g=h?m.ddtAscensionZoomOnly:m.ddtAscensionZoomPan,p=d?m.tDescensionZoomOnly:m.tDescensionZoomPan,t=d?m.dtDescensionZoomOnly:m.dtDescensionZoomPan,u=d?m.ddtDescensionZoomOnly:m.ddtDescensionZoomPan,h=function(c){return a(b,c,l)+m.tPanion(b,c,l)+p(b,c,l)},d=function(a){return c(b,a,l)+m.dtPanion(b,a,l)+t(b,a,l)},r=function(a){return g(b,a,
l)+m.ddtPanion(b,a,l)+u(b,a,l)},x=h(f),w=m.tBaseLine(b),v=e.maximumIterations||20,z=null!=e.maximumDistance?e.maximumDistance:Infinity;for(e=0;e<v;e++){var y=(d(f)+1E-6)/r(f);if(isNaN(y)||f>=z&&0>y){if(!isFinite(z))return null;f=z;x=h(f);break}f-=y;if(f<b.compared.sourceZoom||f<b.compared.targetZoom)return null;y=h(f);if(.005>=Math.abs(y-x)/x)break;x=y}return x>.7*w||f<b.compared.sourceZoom||f<b.compared.targetZoom?null:f}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.tAscensionZoomPan=function(b,k,g){var e=b.halfWindowPanAtZoom(k-b.compared.sourceZoom);return-b.halfWindowSize*(g.ascensionFactor*Math.LN2*b.compared.pan+e)*Math.log(b.compared.sourceZoom/k)/(b.desiredPixelFlow*Math.LN2*e)};b.dtAscensionZoomPan=function(b,k,g){var e=1/k,f=Math.log(b.compared.sourceZoom*e),l=1/b.desiredPixelFlow,h=1/Math.LN2;k-=b.compared.sourceZoom;var d=1/k;g=(g.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(k))/
b.halfWindowPanAtZoom(1);return b.halfWindowSize*e*l*h*d*g-b.halfWindowSize*f*l*h*d+b.halfWindowSize*f*l*h*g/(k*k)};b.ddtAscensionZoomPan=function(b,k,g){var e=k-b.compared.sourceZoom,f=1/e,l=1/k,h=Math.log(b.compared.sourceZoom*l);g=(g.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(e))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*f*(-2*f*l*g+2*f*h+2*l-2*h*g/(e*e)-g/(k*k))/(b.desiredPixelFlow*Math.LN2)};b.tAscensionZoomOnly=function(b,k){return-b.halfWindowSize*Math.log(b.compared.sourceZoom/
k)/(b.desiredPixelFlow*Math.LN2)};b.dtAscensionZoomOnly=function(b,k){return b.halfWindowSize/(k*b.desiredPixelFlow*Math.LN2)};b.ddtAscensionZoomOnly=function(b,k){return-b.halfWindowSize/(k*k*b.desiredPixelFlow*Math.LN2)};b.tPanion=function(b,k,g){return-b.compared.pan*b.halfWindowSize*(g.ascensionFactor+g.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(k))};b.dtPanion=function(b,k,g){return b.compared.pan*b.halfWindowSize*(g.ascensionFactor+g.descensionFactor-1)/(b.desiredPixelFlow*
b.halfWindowPanAtZoom(k*k))};b.ddtPanion=function(b,k,g){return-2*b.compared.pan*b.halfWindowSize*(g.ascensionFactor+g.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(k*k*k))};b.tDescensionZoomPan=function(b,k,g){return b.halfWindowSize*(-b.halfWindowPanAtZoom(k)-g.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))*Math.log(k/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*b.halfWindowPanAtZoom(-k+b.compared.targetZoom))};b.dtDescensionZoomPan=
function(b,k,g){var e=Math.log(k/b.compared.targetZoom),f=1/b.desiredPixelFlow,l=1/Math.LN2,h=-k+b.compared.targetZoom,d=1/h;g=(-b.halfWindowPanAtZoom(k)-g.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return-b.halfWindowSize*e*f*l*d+b.halfWindowSize*e*f*l*g/(h*h)+b.halfWindowSize*f*l*d*g/k};b.ddtDescensionZoomPan=function(b,k,g){var e=k-b.compared.targetZoom,f=1/e,l=1/k,h=Math.log(k/b.compared.targetZoom);g=(b.halfWindowPanAtZoom(k)+
g.descensionFactor*Math.LN2*b.compared.pan-b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*f*(-2*f*l*g-2*f*h+2*l+2*h*g/(e*e)-g/(k*k))/(b.desiredPixelFlow*Math.LN2)};b.tDescensionZoomOnly=function(b,k){return b.halfWindowSize*Math.log(k/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2)};b.dtDescensionZoomOnly=function(b,k){return b.halfWindowSize/(k*b.desiredPixelFlow*Math.LN2)};b.ddtDescensionZoomOnly=function(b,k){return-b.halfWindowSize/(k*k*b.desiredPixelFlow*
Math.LN2)};b.tBaseLine=function(b){var k=Math.LN2*b.compared.pan,g=b.halfWindowPanAtZoom(b.compared.sourceZoom-b.compared.targetZoom),e=b.halfWindowSize*Math.log(b.compared.sourceZoom/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*g);return b.compared.sourceZoom<=b.compared.targetZoom?e*(k-g):e*(k+g)}})},"esri/views/3d/state/controllers/AnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/maybe ../../../../core/promiseUtils ../../../ViewAnimation ./CameraController".split(" "),
function(n,b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function h(d){var a=b.call(this)||this;a.viewAnimation=d;return a}m(h,b);Object.defineProperty(h.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"asyncResult",{get:function(){return this._asyncResult},set:function(d){this._asyncResult&&(this._asyncResult.reject(g.createAbortError()),this._asyncResult=null);this.state===f.State.Finished||this.state===
f.State.Stopped?this.state===f.State.Finished?d.resolve():d.reject(g.createAbortError()):this._asyncResult=d},enumerable:!0,configurable:!0});h.prototype.onControllerStart=function(){var d=this;this.state=f.State.Running;k.isSome(this.viewAnimation)&&this.viewAnimation.when(function(){return d.updateStateFromViewAnimation()},function(){return d.updateStateFromViewAnimation()})};h.prototype.updateStateFromViewAnimation=function(){!k.isSome(this.viewAnimation)||this.state!==f.State.Ready&&this.state!==
f.State.Running||(this.viewAnimation.state===e.State.FINISHED?this.finish():this.viewAnimation.state===e.State.STOPPED&&(this.state=f.State.Stopped))};h.prototype.onControllerEnd=function(){k.isSome(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===f.State.Finished?this.viewAnimation.finish():this.state===f.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===f.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(g.createAbortError()))};h.prototype.finish=
function(){this.finishController()};return h}(f.CameraController);b.AnimationController=n})},"esri/views/3d/state/controllers/CameraController":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});var f;(function(b){b.Ready="ready";b.Rejected="rejected";b.Running="running";b.Stopped=
"stopped";b.Finished="finished"})(f=b.State||(b.State={}));n=function(b){function h(){var d=null!==b&&b.apply(this,arguments)||this;d.state=f.Ready;return d}m(h,b);Object.defineProperty(h.prototype,"active",{get:function(){return this.state===f.Running},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isInteractive",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"canStop",{get:function(){return!1},enumerable:!0,configurable:!0});h.prototype.stopController=
function(){return this.canStop?(this.state=f.Stopped,!0):!1};h.prototype.finishController=function(){this.state=f.Finished};Object.defineProperty(h.prototype,"steppingFinished",{get:function(){return!1},enumerable:!0,configurable:!0});k([e.property({readOnly:!0,dependsOn:["state"]})],h.prototype,"active",null);k([e.property()],h.prototype,"state",void 0);return h=k([e.subclass("esri.views.3d.state.controllers.CameraController")],h)}(e.declared(g));b.CameraController=n})},"esri/views/3d/state/utils/navigationUtils":function(){define("require exports ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../support/geometryUtils/coordinateSystem ../../webgl-engine/lib/Camera".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u){function r(a,c,d){var b=p.sm4d.get();g.mat4.identity(b);g.mat4.rotate(b,b,d[3],d);h.vec3.subtract(a.eye,a.eye,c);h.vec3.transformMat4(a.eye,a.eye,b);h.vec3.add(a.eye,a.eye,c);h.vec3.subtract(a.center,a.center,c);h.vec3.transformMat4(a.center,a.center,b);h.vec3.add(a.center,a.center,c);h.vec3.transformMat4(a.up,a.up,b);a.markViewDirty()}function x(a,c){h.vec3.set(c,0,0,0);for(var d=0;d<a.length;d++)h.vec3.add(c,c,a[d]);h.vec3.scale(c,c,1/a.length)}function w(c,
d,b){return Math.sin(c/h.vec3.length(d))*(b+a.earthRadius)}function v(a,d,b,e){b=c.ray.fromScreenAtEye(d,b,ma);c.sphere.closestPointOnSilhouette(a,b,K);return c.sphere.intersectRay(a,b,e)?h.vec3.squaredDistance(K,b.origin)<h.vec3.squaredDistance(e,b.origin)?(h.vec3.copy(e,K),!1):!0:(h.vec3.subtract(N,d.eye,d.center),h.vec3.normalize(N,N),c.plane.fromNormalAndOffset(N,-h.vec3.dot(h.vec3.normalize(N,N),K),Q),c.plane.intersectRay(Q,b,e),!1)}function z(a,c,d,e,f,l){h.vec3.cross(na,a,c);h.vec3.subtract(ea,
a,c);h.vec3.length(a)<=f||!e.aboveGround?(h.vec3.cross(d,ea,e.eye),a=h.vec3.dot(a,c)/(h.vec3.length(a)*h.vec3.length(c)),l=Math.cos(m.clamp(q.cyclicalPI.normalize(m.deg2rad(l)),0,b.TiltThresholdPanningSpeed)),c=-m.acosClamped(a)-Math.max(0,h.vec3.length(c)-f)/(l*f)):(h.vec3.subtract(M,e.eye,e.center),h.vec3.cross(d,ea,M),c=-h.vec3.length(ea)/f);h.vec3.normalize(d,d);h.vec3.scale(d,d,h.vec3.length(na));return c}function y(a,c,d,e){e=Math.cos(m.clamp(q.cyclicalPI.normalize(m.deg2rad(e)),0,b.TiltThresholdPanningSpeed));
c=c>d?-(c-d)/(e*d):c<-d?Math.PI-(c+d)/(e*d):m.acosClamped(c/d);return((a>d?-(a-d)/(e*d):a<-d?Math.PI-(a+d)/(e*d):m.acosClamped(a/d))-c)*d}function A(a,c,d,b,e,l,g,k,p,q){p=y(a[2],c[2],g.radius,p);c=q?y(a[0],c[0],g.radius,180):c[0]-a[0];a=Math.sin(k)*c-Math.cos(k)*p;k=Math.cos(k)*c+Math.sin(k)*p;h.vec3.normalize(Z,e);e=q?a/Math.sqrt(Math.abs(Math.pow(g.radius,2)-Math.pow(h.vec3.dot(d,Z),2))):a/g.radius;d=k/Math.sqrt(Math.abs(Math.pow(g.radius,2)-Math.pow(h.vec3.dot(d,b),2)));f.vec2.set(l,e,d)}function B(a,
c,d,b,e,f,l,g,k,p){h.vec3.cross(na,a,c);t.coordinateSystemFromOneAxisAndNormalVector(f.up,f.eye,V,J,U);t.coordinateSystemFromOneAxisAndNormalVector([0,0,1],f.eye,T,P,S);h.vec3.copy(d,P);h.vec3.copy(b,T);h.vec3.normalize(d,d);h.vec3.scale(d,d,h.vec3.length(na));t.vectorCoordinates(a,h.vec3.normalize(J,J),h.vec3.normalize(U,U),h.vec3.normalize(V,V),Y);t.vectorCoordinates(c,J,U,V,X);A(Y,X,a,T,P,e,l,g,k,p)}function C(a,c,d,b,e,f,l){g.mat4.identity(da);g.mat4.identity(ca);g.mat4.identity(ba);g.mat4.rotate(da,
da,e,b);g.mat4.rotate(ca,ca,l,f);g.mat4.multiply(ba,da,ca);h.vec3.subtract(c,a,d);h.vec3.transformMat4(c,c,ba);h.vec3.add(c,c,d)}function F(a,c,d,b,e,f){g.mat4.identity(da);g.mat4.identity(ca);g.mat4.identity(ba);g.mat4.rotate(da,da,b,d);g.mat4.rotate(ca,ca,f,e);g.mat4.multiply(ba,da,ca);h.vec3.subtract(a.eye,a.eye,c);h.vec3.transformMat4(a.eye,a.eye,ba);h.vec3.add(a.eye,a.eye,c);h.vec3.subtract(a.center,a.center,c);h.vec3.transformMat4(a.center,a.center,ba);h.vec3.add(a.center,a.center,c);h.vec3.subtract(a.up,
a.up,c);h.vec3.transformMat4(a.up,a.up,ba);h.vec3.add(a.up,a.up,c);a.markViewDirty()}function E(a,c,d,e,f,h,l,g){void 0===l&&(l=b.PreservingHeadingThreshold.Pole);void 0===g&&(g=b.PreservingHeadingThreshold.Angle);a=Math.abs(a[2])<d*l||Math.abs(c)>d;return(Math.abs(e)>Math.PI-g||Math.abs(e)<g)&&a&&h.aboveGround&&f<b.PreservingHeadingThreshold.Tilt?!0:!1}function G(a,d,b,e,f,h){h?(c.axisAngle.fromPoints(b,e,aa),r(d,a.center,aa)):(b=z(b,e,la,d,a.radius,f),r(d,a.center,c.axisAngle.wrapAxisAngle(la,b)))}
function H(a,c,d,b,e,f,l){var g=l?20:1;h.vec3.copy(W,b);fa.copyFrom(c);for(var k,p=0;p<g&&1E-12<h.vec3.squaredDistance(d,W);p++)if(b=h.vec3.squaredDistance(d,W),B(d,W,P,T,R,fa,a,e,f,l),F(fa,a.center,T,R[1],P,R[0]),C(W,W,a.center,T,R[1],P,R[0]),k=h.vec3.squaredDistance(d,W),k<b||0===p)c.copyFrom(fa);else break}Object.defineProperty(b,"__esModule",{value:!0});b.Earth=c.sphere.fromValues(a.earthRadius,d.vec3f64.create());b.normalizeCoordinate=function(a,c,d){d[0]=c[0]/(a.fullWidth/a.pixelRatio);d[1]=
c[1]/(a.fullHeight/a.pixelRatio);return d};b.rotationFromPointsAroundAxis=function(a,c,d){var b=p.sv3d.get(),e=p.sv3d.get(),f=p.sv3d.get();h.vec3.copy(e,a);h.vec3.copy(f,c);a=h.vec3.dot(e,d);c=h.vec3.dot(f,d);h.vec3.scale(b,d,a);h.vec3.subtract(e,e,b);h.vec3.normalize(e,e);h.vec3.scale(b,d,c);h.vec3.subtract(f,f,b);h.vec3.normalize(f,f);a=h.vec3.dot(e,f);h.vec3.cross(b,d,e);d=h.vec3.dot(f,b);return Math.atan2(d,a)};b.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=
2*Math.PI;return a};b.applyRotation=r;b.intersectPlaneFromScreenPoint=function(a,d,b,e){return c.plane.intersectRay(a,c.ray.fromScreen(d,b,ma),e)};b.applyZoomToPoint=function(a,c,d,b){var e=p.sv3d.get();d=1-d;h.vec3.subtract(e,c,a.eye);var f=h.vec3.length(e),l=f*(1-d);0<=d&&l<b&&(l=b,d=-(l-f)/f);1E-6>Math.abs(f-l)||(h.vec3.scale(e,e,d),h.vec3.add(a.eye,a.eye,e),h.vec3.lerp(a.center,a.center,c,d))};b.applyZoomOnSphere=function(a,d,b){d.getScreenCenter(D);c.sphere.intersectScreen(a,d,D,d.center);d.markViewDirty();
a=d.distance;b*=a;1E-6>Math.abs(a-b)||(b=h.vec3.scale(p.sv3d.get(),d.viewForward,b),h.vec3.subtract(d.eye,d.center,b),d.markViewDirty())};var D=k.createScreenPointArray();b.centroidOnSphere=function(a,c,d){x(c,d);h.vec3.normalize(d,d);h.vec3.scale(d,d,a)};b.centroid=x;b.onSurfaceTiltToEyeTiltGlobal=w;b.offSurfaceTiltToEyeTiltGlobal=function(a,c,d){return w(Math.PI/2,c,d)+(a-Math.PI/2)};var I;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(I=b.PanMode||(b.PanMode={}));b.VerticalPanTresholds=
{Elevation:3E4,Angle:m.deg2rad(8)};b.PreservingHeadingThreshold={Pole:.95,Angle:m.deg2rad(18),Tilt:45};b.TiltThresholdPanningSpeed=m.deg2rad(80);b.pickPointAndInitSphere=function(a,e,f,l){var g=d.vec3f64.create(),k=c.sphere.create(),p=!0;a.intersectScreen(f,g)?k.radius=h.vec3.length(g):(k.radius=e.aboveGround?Math.max(h.vec3.length(e.center),.9*b.Earth.radius):h.vec3.length(e.eye)-e.relativeElevation,l?v(k,e,f,g):p=c.sphere.intersectScreen(k,e,f,g));return{sphere:k,scenePickPoint:p?g:null}};b.decidePanMode=
function(a,c,d){var e=h.vec3.length(a.eye);if(Math.abs(e-b.Earth.radius)>b.VerticalPanTresholds.Elevation)return I.Horizontal;if(a.aboveGround===c.radius>e)return I.Vertical;h.vec3.subtract(L,a.eye,d);h.vec3.normalize(L,L);return Math.abs(.5*Math.PI-m.acosClamped(h.vec3.dot(d,L)/h.vec3.length(d)))<b.VerticalPanTresholds.Angle?I.Vertical:I.Horizontal};var L=d.vec3f64.create();b.applyPanPlanar=function(a,c,d){h.vec3.subtract(O,d,c);h.vec3.subtract(a.eye,a.eye,O);h.vec3.subtract(a.center,a.center,O);
a.markViewDirty()};var O=d.vec3f64.create();b.sphereOrPlanePointFromScreenPoint=v;var K=d.vec3f64.create(),N=d.vec3f64.create(),Q=c.plane.create();b.rotationAngleAndAxisDirectRotation=z;var M=d.vec3f64.create();b.lengthFromPoints=y;b.rotationAnglesHeadingPreserving=A;b.rotationAnglesAndAxesHeadingPreserving=B;b.rotatePointAroundTwoAxes=C;b.applyRotationWithTwoAxes=F;b.preserveHeadingThreshold=E;b.applyPanSphericalDirectRotation=G;b.applyPanSphericalPreserveHeading=H;b.panToPosition=function(a,c,d,
e,f,l,g){E(d,h.vec3.dot(c.up,d),a.radius,-q.cyclicalPI.normalize(m.deg2rad(f)),l,c,b.PreservingHeadingThreshold.Pole,b.PreservingHeadingThreshold.Angle)?H(a,c,d,e,-q.cyclicalPI.normalize(m.deg2rad(f)),l,g):G(a,c,d,e,l,g)};b.panMotionToRotationMatrix=function(a,c,d,b,e,f,l,k,r){if(E(a.center,h.vec3.dot(a.up,a.center),h.vec3.length(a.center),-q.cyclicalPI.normalize(m.deg2rad(f)),l,c))switch(a=-q.cyclicalPI.normalize(m.deg2rad(e)),t.coordinateSystemFromOneAxisAndNormalVector([0,0,1],c.eye,T,P,S),e=d.translation[0]*
b.pan,f=d.translation[1]*b.pan,c=Math.max(Math.sqrt(Math.abs(1-Math.pow(h.vec3.dot(c.center,T),2)/Math.pow(h.vec3.length(c.center),2))),.5),l=-Math.cos(a)*f+Math.sin(a)*e,g.mat4.rotate(k.pan.matrix,k.pan.matrix,(Math.sin(a)*f+Math.cos(a)*e)/c,T),k.pan.enabled=!0,r.mode){case "pan":g.mat4.rotate(k.pan.matrix,k.pan.matrix,l,P);k.pan.enabled=!0;break;case "zoom":k.zoom=-d.translation[1]*b.zoom}else switch(a=c.eye,c=c.viewRight,a=h.vec3.cross(p.sv3d.get(),c,a),e=d.translation[0]*b.pan,0!==e&&(g.mat4.rotate(k.pan.matrix,
k.pan.matrix,-e,a),k.pan.enabled=!0),r.mode){case "pan":d=d.translation[1]*b.pan;0!==d&&(g.mat4.rotate(k.pan.matrix,k.pan.matrix,d,c),k.pan.enabled=!0);break;case "zoom":k.zoom=-d.translation[1]*b.zoom}};var T=d.vec3f64.create(),P=d.vec3f64.create(),S=d.vec3f64.create(),V=d.vec3f64.create(),J=d.vec3f64.create(),U=d.vec3f64.create(),Y=d.vec3f64.create(),X=d.vec3f64.create(),R=l.vec2f64.create(),aa=c.axisAngle.create(),da=e.mat4f64.create(),ca=e.mat4f64.create(),ba=e.mat4f64.create(),W=d.vec3f64.create(),
Z=d.vec3f64.create(),ea=d.vec3f64.create(),fa=new u.default,na=d.vec3f64.create(),la=d.vec3f64.create(),ma={origin:d.vec3f64.create(),direction:d.vec3f64.create()}})},"esri/views/3d/support/geometryUtils/coordinateSystem":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,m,k,g){function e(a){return{operations:a,value:a.create()}}function f(a,c,d,b){return a.operations.setAltitudeAt(a.value,
c,d,b)}Object.defineProperty(b,"__esModule",{value:!0});b.create=function(a){var c=a.operations;return{operations:c,value:c.create(a.value)}};b.setExtent=function(a,c,d){a.operations.setExtent(a.value,c,d.value);return d};b.createFromOperations=e;b.fromValues=function(a,c,d){void 0===d&&(d=e(a));d.operations=a;a.copy(c,d.value);return d};b.wrap=function(a,c){h.operations=a;h.value=c;return h};b.normalAt=function(a,c,d){return a.operations.axisAt(a.value,c,2,d)};b.axisAt=function(a,c,d,b){return a.operations.axisAt(a.value,
c,d,b)};b.intersectRay=function(a,c,d){return a.operations.intersectRay(a.value,c,d)};b.intersectsRay=function(a,c){return a.operations.intersectRay(a.value,c,null)};b.closestPoint=function(a,c,d){return a.operations.closestPoint(a.value,c,d)};b.intersectRayClosestSilhouette=function(a,c,d){return a.operations.intersectRayClosestSilhouette(a.value,c,d)};b.closestPointOnSilhouette=function(a,c,d){return a.operations.closestPointOnSilhouette(a.value,c,d)};b.distanceToSilhouette=function(a,c){return a.operations.distanceToSilhouette(a.value,
c)};b.altitudeAt=function(a,c){return a.operations.altitudeAt(a.value,c)};b.setAltitudeAt=f;b.setAltitudeOfTransformation=function(a,c,d,b){c!==b&&m.mat4.copy(b,c);k.vec3.set(l,b[12],b[13],b[14]);f(a,l,d,l);b[12]=l[0];b[13]=l[1];b[14]=l[2];return b};b.elevate=function(a,c,d){return a.operations.elevate(a.value,c,d.value)};var l=g.vec3f64.create(),h={operations:null,value:null};b.vectorCoordinates=function(a,c,d,b,e){e[0]=k.vec3.dot(a,c);e[1]=k.vec3.dot(a,d);e[2]=k.vec3.dot(a,b);return e};b.coordinateSystemFromOneAxisAndNormalVector=
function(a,c,b,e,f){k.vec3.copy(b,a);k.vec3.copy(d,c);k.vec3.normalize(d,d);k.vec3.cross(e,d,b);k.vec3.cross(f,e,b)};var d=g.vec3f64.create()})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(n,b,m,k,g,e,f,l,h,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function c(c,d){d=a.call(this,c.state,c.sceneIntersectionHelper,d)||this;d.view=c;d.zoomLocation=g.vec3f64.create();d.tmpCamera=new l.default;d.tmpRayDir=g.vec3f64.create();d.tmpCenter=g.vec3f64.create();d.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new l.default,interactionDirection:null,tiltMode:0};return d}m(c,a);c.prototype.zoomStep=function(a,c){if(this.active){var d=
this.view.state,b=this.constraintOptions.interactionStartCamera;this.animation.finished?b.copyFrom(d.camera):this.animation.cameraAt(1,b);this.tmpCamera.copyFrom(d.camera);d=new h.Intersector(this.view.viewingMode);0<a?(this.intersectionHelper.intersectScreenFreePointFallback(c,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,d,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,d,this.zoomLocation)?this.tmpCamera.center=
this.zoomLocation:k.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation);this.begin(this.tmpCamera)}};c.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:d.outExpo}};c.prototype.updateCamera=function(a,c,d){k.vec3.subtract(this.tmpRayDir,d,a.eye);var b=k.vec3.length(this.tmpRayDir),f=b*c;1>=c&&4>f&&(f=4,c=f/b);1E-6>Math.abs(b-f)||(k.vec3.scale(this.tmpRayDir,this.tmpRayDir,c),k.vec3.subtract(a.eye,d,this.tmpRayDir),
k.vec3.lerp(a.center,a.center,d,1-c),e.applyAll(this.view,a,this.constraintOptions))};return c}(f.PointToPointAnimationController);b.ZoomStepController=n})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.eventMatchesPointerAction=function(b,k){switch(k){case "primary":return"touch"===b.pointerType||0===b.button;case "secondary":return"touch"!==b.pointerType&&2===b.button;case "tertiary":return"touch"!==b.pointerType&&
1===b.button}};b.eventMatchesMousePointerAction=function(b,k){if("touch"===b.pointerType)return!1;switch(k){case "primary":return 0===b.button;case "secondary":return 2===b.button;case "tertiary":return 1===b.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(n,b,m,k,g,e,
f){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(d,a,c,e){var f=b.call(this,!0)||this;f.view=d;f.pointerAction=a;f.pivotPoint=c;f.registerIncoming("drag",e,function(a){return f.handleDrag(a)});return f}m(e,b);e.prototype.handleDrag=function(d){var a=d.data;if(!(1<a.pointers.size)&&f.eventMatchesMousePointerAction(d.data,this.pointerAction)){var c=k.createScreenPointArray(a.center.x,a.center.y);switch(a.action){case "start":this.cameraController&&(this.cameraController.end(),
this.cameraController=null);this.cameraController=new g.RotateController(this.view,this.view.sceneIntersectionHelper,this.pivotPoint);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(c);break;case "update":this.cameraController&&this.cameraController.update(c);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}d.stopPropagation()}};return e}(e.InputHandler);b.DragRotate=n})},"esri/views/3d/state/controllers/RotateController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function q(a,c,f){var h=b.call(this)||this;h.view=a;h.intersectionHelper=c;h.pivot=f;h.lastPoint=l.vec2f64.create();h.tmpWorldUp=d.vec3f64.create();h.tmpViewDir=d.vec3f64.create();h.tmpRotCurPoint=l.vec2f64.create();h.tmpTransf=e.mat4f64.create();h.tmpAxis=d.vec3f64.create();h.pivotPos=d.vec3f64.create();h.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,
interactionDirection:null,tiltMode:0};h.rotScale="center"===f?3:1.5;return h}m(q,b);q.prototype.begin=function(a){if(this.active){switch(this.pivot){case "eye":h.vec3.copy(this.pivotPos,this.beginCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case "center":this.intersectionHelper.intersectRayFreePointFallback(this.beginCamera.ray,this.pivotPos)||h.vec3.copy(this.pivotPos,this.beginCamera.center),this.beginCamera.center=
this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;p.normalizeCoordinate(this.beginCamera,a,this.lastPoint)}};q.prototype.update=function(c){if(this.active){var d;switch(this.pivot){case "eye":d=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,d=this.currentCamera.eye}this.applyRotation(this.currentCamera,c,d,this.pivotPos);a.applyAll(this.view,
this.currentCamera,this.constraintOptions)}};q.prototype.end=function(){this.active&&this.finishController()};q.prototype.applyRotation=function(a,d,b,e){this.view.renderCoordsHelper.worldUpAtPosition(e,this.tmpWorldUp);p.normalizeCoordinate(a,d,this.tmpRotCurPoint);d=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale;var l=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;h.vec3.subtract(this.tmpViewDir,b,e);var q=h.vec3.length(this.tmpViewDir),q=k.acosClamped(h.vec3.dot(this.tmpViewDir,
this.tmpWorldUp)/q);if("eye"===this.pivot){var m=.5*Math.PI-q,r=.495*Math.PI;d=m-Math.max(-r,Math.min(r,m+-.5*d))}d=k.clamp(d+q,c.TiltDefault.min,c.TiltDefault.max)-q;g.mat4.identity(this.tmpTransf);h.vec3.cross(this.tmpAxis,a.up,this.tmpViewDir);"center"===this.pivot&&(l=-l);g.mat4.rotate(this.tmpTransf,this.tmpTransf,l,this.tmpWorldUp);g.mat4.rotate(this.tmpTransf,this.tmpTransf,d,this.tmpAxis);h.vec3.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);h.vec3.add(b,e,this.tmpViewDir);
h.vec3.transformMat4(a.up,a.up,this.tmpTransf);f.vec2.copy(this.lastPoint,this.tmpRotCurPoint);a.markViewDirty()};return q}(q.InteractiveController);b.RotateController=n})},"esri/views/3d/state/controllers/InteractiveController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./CameraController","../../webgl-engine/lib/Camera"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){var e=null!==b&&b.apply(this,arguments)||
this;e.beginCamera=new g.default;e.currentCamera=new g.default;return e}m(e,b);Object.defineProperty(e.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});e.prototype.stepController=function(b,e){e.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(e)};e.prototype.onControllerStart=function(b){this.state=k.State.Running;this.beginCamera.copyFrom(b);this.currentCamera.copyFrom(b)};e.prototype.onControllerEnd=function(b){b.copyViewFrom(this.currentCamera)};
return e}(k.CameraController);b.InteractiveController=n})},"esri/views/3d/input/handlers/DragZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,c,d){var e=b.call(this,!0)||this;
e.view=a;e.pointerAction=c;e.registerIncoming("drag",d,function(a){return e.handleDrag(a)});return e}m(d,b);d.prototype.handleDrag=function(a){var c=a.data;if(!(1<c.pointers.size)&&l.eventMatchesMousePointerAction(a.data,this.pointerAction)){var d=k.createScreenPointArray(c.center.x,c.center.y);switch(c.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=this.view.state.isGlobal?new g.ZoomController(this.view,this.view.sceneIntersectionHelper):
new e.ZoomController(this.view,this.view.sceneIntersectionHelper);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController&&this.cameraController.update(d);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}a.stopPropagation()}};return d}(f.InputHandler);b.DragZoom=n})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(d){function b(a,b){var f=d.call(this)||this;f.view=a;f.intersectionHelper=b;f.pickPoint=l.vec3f64.create();f.tmpP0=e.vec2f64.create();f.panAxisAngle=c.axisAngle.create();f.tmpRayDir=l.vec3f64.create();f.targetOnSphere=l.vec3f64.create();f.dragBeginPoint=k.createScreenPointArray();f.normalizedAnchorPoint=e.vec2f64.create();f.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,
interactionDirection:null,tiltMode:0};f.sphere=c.sphere.create();f.hasPickPoint=!1;return f}m(b,d);b.prototype.begin=function(c){this.active&&(g.vec2.copy(this.dragBeginPoint,c),a.normalizeCoordinate(this.beginCamera,c,this.normalizedAnchorPoint),c=a.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,c,!1),this.hasPickPoint=!!c.scenePickPoint,this.pickPoint=c.scenePickPoint,this.sphere=c.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};b.prototype.update=function(d){if(this.active){this.currentCamera.eye=
this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;f.vec3.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var b=f.vec3.length(this.tmpRayDir);a.normalizeCoordinate(this.currentCamera,d,this.tmpP0);var e=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),l=b*Math.pow(2,e),g=this.view.state.constraints.minimumPoiDistance;0>e&&l<g&&(l=g);1E-6>Math.abs(b-l)||(this.hasPickPoint&&l<b&&(e=1-(1-l/b)*(1-this.sphere.radius/
f.vec3.length(this.currentCamera.center)),f.vec3.scale(this.currentCamera.center,this.currentCamera.center,e)),f.vec3.scale(this.tmpRayDir,this.tmpRayDir,-l/b),f.vec3.add(this.currentCamera.eye,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=h.pixelDistanceToInteractionFactor(this.dragBeginPoint,d),h.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(a.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,
this.targetOnSphere),c.axisAngle.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),a.applyRotation(this.currentCamera,this.sphere.center,this.panAxisAngle)),h.applySurfaceCollisionConstraint(this.view,this.currentCamera))}};b.prototype.end=function(){this.active&&this.finishController()};return b}(d.InteractiveController);b.ZoomController=n})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(c,d){var b=a.call(this)||this;b.view=c;b.intersectionHelper=d;b.tmpP=h.vec3f64.create();b.tmpN=h.vec3f64.create();b.tmpP0=f.vec2f64.create();b.tmpPoi=h.vec3f64.create();b.tmpRayDir=h.vec3f64.create();b.dragBeginPoint=g.createScreenPointArray();b.normalizedAnchorPoint=f.vec2f64.create();b.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:h.vec3f64.create(),
tiltMode:0};b.plane=q.plane.create();return b}m(b,a);b.prototype.begin=function(a){this.active&&(e.vec2.copy(this.dragBeginPoint,a),c.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(a,this.tmpP),l.vec3.subtract(this.tmpN,this.beginCamera.eye,this.beginCamera.center),l.vec3.normalize(this.tmpN,this.tmpN),0>this.tmpN[1]&&l.vec3.negate(this.tmpN,this.tmpN),q.plane.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=
this.beginCamera)};b.prototype.update=function(a){if(this.active){c.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||l.vec3.copy(this.tmpPoi,this.currentCamera.center);c.normalizeCoordinate(this.currentCamera,a,this.tmpP0);var b=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);e.vec2.copy(this.normalizedAnchorPoint,this.tmpP0);l.vec3.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var f=l.vec3.length(this.tmpRayDir),h=f*(1-b);l.vec3.copy(this.constraintOptions.interactionDirection,
this.tmpRayDir);l.vec3.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,k.sign(b)/f);var g=this.view.state.constraints.minimumPoiDistance;0<=b&&h<g&&(h=g,b=-(h-f)/f);1E-6>Math.abs(f-h)||(l.vec3.scale(this.tmpRayDir,this.tmpRayDir,b),l.vec3.add(this.currentCamera.eye,this.currentCamera.eye,this.tmpRayDir),l.vec3.lerp(this.currentCamera.center,this.currentCamera.center,this.tmpPoi,b),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?
Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=d.pixelDistanceToInteractionFactor(this.dragBeginPoint,a),d.applyAll(this.view,this.currentCamera,this.constraintOptions))}};b.prototype.end=function(){this.active&&this.finishController()};return b}(a.InteractiveController);b.ZoomController=n})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/watchUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),
function(n,b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function f(d){var a=b.call(this,!0)||this;a.view=d;a.watchHandles=new k;a.handle=a.registerIncoming("gamepad",function(c){return a.handleEventGamepad(c)});a.handle.pause();return a}m(f,b);f.prototype.onInstall=function(d){var a=this;b.prototype.onInstall.call(this,d);this.watchHandles.add([g.init(this.view.navigation.gamepad,"enabled",function(c){c?a.handle.resume():(a.handle.pause(),a.cameraControllerGamepad&&
(a.cameraControllerGamepad.finishController(),a.cameraControllerGamepad=null))}),this.view.navigation.gamepad.watch("device",function(c){a.cameraControllerGamepad&&c&&a.cameraControllerGamepad.gamepadDevice!==c&&(a.cameraControllerGamepad.finishController(),a.cameraControllerGamepad=null)})])};f.prototype.onUninstall=function(){this.watchHandles.removeAll();b.prototype.onUninstall.call(this)};f.prototype.handleEventGamepad=function(d){var a=this.view.navigation.gamepad.device;if(!a||d.data.device===
a)if((a=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||e.GamepadKeyboardController.activatesFor(this.view,d.data))a||(a=new e.GamepadKeyboardController(this.view,d.data.device),this.view.state.switchCameraController(a)&&(this.cameraControllerGamepad=a)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===d.data.device&&this.cameraControllerGamepad.handleEventGamepad(d.data)};return f}(f.InputHandler);b.GamepadNavigation=
n})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A){Object.defineProperty(b,"__esModule",{value:!0});n=function(c){function b(a,d,b){var e=c.call(this)||this;e.view=a;e.gamepadDevice=d;e.disableMovements=b;e.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};e.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];e.tmpCamera=new y.default;e.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new y.default,interactionFactor:0,interactionDirection:null,tiltMode:1};return e}m(b,
c);b.prototype.handleEventGamepad=function(a){var c=A.extractTransformation(a,this.view.navigation.gamepad,this.transformation);("end"===a.action||A.isZeroTransformation(c))&&this.finishController()};b.prototype.activateDirection=function(a){this.keysButtonState[a]=1;A.extractTransformationKeyboard(this.keysButtonState,this.transformation)};b.prototype.deactivateDirection=function(a){this.keysButtonState[a]=0;a=A.extractTransformationKeyboard(this.keysButtonState,this.transformation);A.isZeroTransformation(a)&&
this.finishController()};b.prototype.onControllerStart=function(a){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;c.prototype.onControllerStart.call(this,a)};b.prototype.updateFilteredSurfaceElevation=function(a){this.filteredSurfaceElevation+=1*(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*a};b.prototype.stepController=function(a,b){this.updateStartHeading();this.updateFilteredSurfaceElevation(a);
this.currentCamera.copyViewFrom(b);this.updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this.calculateControlTransformation(a,this.currentCamera,I);this.applyDisabledMovementTypes(I);this.applyPan(I.pan);this.applyRotate(I.rotate);this.applyZoom(I.zoom);this.applyAscend(I.ascend);this.constraintOptions.interactionType=0;this.constraintOptions.selection=8;d.applyAll(this.view,this.currentCamera,this.constraintOptions);c.prototype.stepController.call(this,
a,b)};b.prototype.updateStartHeading=function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};b.prototype.applyRotate=function(a){if(a.enabled){var c=this.currentCamera,b=c.center,e=c.up,f=c.eye;l.vec3.subtract(b,b,f);l.vec3.transformMat4(b,b,a.matrix);l.vec3.add(b,b,f);l.vec3.transformMat4(e,e,a.matrix);c.markViewDirty();this.constraintOptions.interactionType=3;this.constraintOptions.selection=7;d.applyAll(this.view,c,this.constraintOptions)}};b.prototype.applyPan=
function(a,c){void 0===c&&(c=this.currentCamera);if(a.enabled){var b=c.center,e=c.eye,f=c.up;l.vec3.transformMat4(e,e,a.matrix);l.vec3.transformMat4(b,b,a.matrix);this.view.state.isGlobal&&l.vec3.transformMat4(f,f,a.matrix);c.markViewDirty();this.constraintOptions.interactionType=4;this.constraintOptions.selection=15;d.applyAll(this.view,c,this.constraintOptions)}};b.prototype.applyZoom=function(a){if(a){var c=this.currentCamera,b=c.eye,c=c.viewForward;l.vec3.add(b,b,l.vec3.scale(z.sv3d.get(),c,a));
this.currentCamera.markViewDirty();l.vec3.copy(L,c);l.vec3.negate(L,L);this.constraintOptions.interactionDirection=L;this.constraintOptions.interactionType=1;this.constraintOptions.selection=7;d.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};b.prototype.applyAscend=function(a){if(a){var c=this.currentCamera,b=c.center,c=c.eye,e=this.view.renderCoordsHelper.worldUpAtPosition(c,z.sv3d.get());this.constraintOptions.interactionDirection=
l.vec3.copy(L,e);this.view.state.isGlobal?(e=l.vec3.length(c),a=(e+a)/e,l.vec3.scale(c,c,a),l.vec3.scale(b,b,a)):(a=l.vec3.scale(z.sv3d.get(),e,a),l.vec3.add(c,c,a),l.vec3.add(b,b,a));this.currentCamera.markViewDirty();this.updateCameraCenter();this.constraintOptions.interactionType=5;this.constraintOptions.selection=8;d.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter();this.constraintOptions.selection=7;d.applyAll(this.view,this.currentCamera,this.constraintOptions);
this.constraintOptions.interactionDirection=null}};b.prototype.calculateControlTransformation=function(a,c,d){d.zoom=0;d.ascend=0;d.pan.enabled=!1;e.mat4.identity(d.pan.matrix);d.rotate.enabled=!1;e.mat4.identity(d.rotate.matrix);a=this.computeVelocities(a);this.view.state.isLocal?this.calculateControlTransformationLocal(a,c,d):this.calculateControlTransformationGlobal(a,c,d)};b.prototype.updateCameraCenter=function(){var a=this.currentCamera;this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(a.ray,
this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,a.center);this.currentCamera.markViewDirty()};b.prototype.calculateControlTransformationLocal=function(c,d,b){var f=d.viewRight,h=d.viewForward,p=this.transformation,m=this.view.navigation.gamepad,h=l.vec3.set(z.sv3d.get(),h[0],h[1],0);l.vec3.normalize(h,h);var q=p.translation[0]*c.pan;0!==q&&(q=l.vec3.scale(z.sv3d.get(),f,q),e.mat4.translate(b.pan.matrix,b.pan.matrix,q),b.pan.enabled=!0);switch(m.mode){case "pan":m=-p.translation[1]*
c.pan;0!==m&&(m=l.vec3.scale(z.sv3d.get(),h,m),e.mat4.translate(b.pan.matrix,b.pan.matrix,m),b.pan.enabled=!0);b.zoom=p.zoom*c.zoom;break;case "zoom":b.zoom=(-p.translation[1]+p.zoom)*c.zoom;break;default:k.neverReached(m.mode)}b.ascend=p.translation[2]*c.ascend;m=-p.heading*c.rotate;0!==m&&(e.mat4.rotate(b.rotate.matrix,b.rotate.matrix,m,this.view.renderCoordsHelper.worldUpAtPosition(d.eye,z.sv3d.get())),b.rotate.enabled=!0);c=p.tilt*c.rotate;d=t.viewAngle(this.view.renderCoordsHelper,d.center,d.eye);
if(d=g.clamp(d+c,a.TiltDefault.min,a.TiltDefault.max)-d)e.mat4.rotate(b.rotate.matrix,b.rotate.matrix,d,f),b.rotate.enabled=!0};b.prototype.calculateControlTransformationGlobal=function(a,c,d){var b=c.eye,f=c.viewRight,h=this.transformation,g=this.view.navigation.gamepad,b=l.vec3.cross(z.sv3d.get(),f,b);l.vec3.normalize(b,b);l.vec3.negate(b,b);q.panMotionToRotationMatrix(this.beginCamera,c,h,a,this.view.camera.heading,this.headingStart,this.view.camera.tilt,d,g);this.tmpCamera.copyFrom(this.currentCamera);
this.applyPan(I.pan,this.tmpCamera);g=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;d.ascend=h.translation[2]*a.ascend;b=-h.heading*a.rotate;0!==b&&(e.mat4.rotate(d.rotate.matrix,d.rotate.matrix,b,this.tmpCamera.eye),d.rotate.enabled=!0);c=this.clampTiltDeltaGlobalToValidRange(h.tilt*a.rotate,c.ray,g);0!==c&&(e.mat4.rotate(d.rotate.matrix,d.rotate.matrix,c,this.tmpCamera.viewRight),d.rotate.enabled=!0);d.zoom=h.zoom*a.zoom};b.prototype.clampTiltDeltaGlobalToValidRange=
function(c,d,b){var e=p.onSurfaceTiltToEyeTiltGlobal(a.TiltDefault.min,d.origin,b),f=0,h=0,f=z.sv3d.get();this.view.renderCoordsHelper.intersectManifold(d,b,f)?(f=t.viewAngle(this.view.renderCoordsHelper,f,d.origin),f=p.onSurfaceTiltToEyeTiltGlobal(f,d.origin,b),h=p.onSurfaceTiltToEyeTiltGlobal(a.TiltDefault.max,d.origin,b)):(w.sphere.closestPointOnSilhouette(w.sphere.wrap(b+x.earthRadius),d,f),f=g.acosClamped(-l.vec3.dot(d.direction,l.vec3.normalize(f,f))),f=p.offSurfaceTiltToEyeTiltGlobal(f,d.origin,
b),h=p.offSurfaceTiltToEyeTiltGlobal(a.TiltDefault.max,d.origin,b));return g.clamp(f+c,e,h)-f};b.prototype.getPointAbsoluteSurfaceElevation=function(a,c,d){var b=this.view.renderCoordsHelper,e=b.getAltitude(a);c+=Math.abs(e-c);l.vec3.copy(d,a);b.setAltitude(c,d);return c};b.prototype.clampedDistanceToSurface=function(a,c){var d=this.view.renderCoordsHelper,b=this.view.state.camera,e=u.headingTiltToDirectionUp(this.view,c,0,C,O).direction,e=d.intersectManifoldClosestSilhouette(w.ray.wrap(c,e),a,z.sv3d.get()),
e=l.vec3.distance(c,e);a=d.intersectManifoldClosestSilhouette(w.ray.wrap(c,v.directionFromTo(z.sv3d.get(),c,b.center)),a,z.sv3d.get());c=l.vec3.distance(c,a);return Math.min(e,c)};b.prototype.computeHeadingRotateRadius=function(a){var c=this.view,d=c.renderCoordsHelper,b=c.state,c=b.isGlobal,b=d.intersectManifoldClosestSilhouette(b.camera.ray,this.filteredSurfaceElevation,z.sv3d.get());if(c)return c=l.vec3.subtract(z.sv3d.get(),a,b),d=l.vec3.length(c),l.vec3.scale(c,c,1/d),a=l.vec3.normalize(z.sv3d.get(),
a),a=g.acosClamped(l.vec3.dot(a,c)),d*Math.sin(Math.min(F,a));a=l.vec3.copy(z.sv3d.get(),a);d.setAltitude(this.filteredSurfaceElevation,a);return l.vec3.distance(b,a)};b.prototype.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:G};b.prototype.computeVelocities=function(a){var c=this.filteredSurfaceElevation,d=c+x.earthRadius,b=this.view.state,e=b.camera,f=b.isGlobal,h=z.sv3d.get(),l=this.getPointAbsoluteSurfaceElevation(e.eye,c,h),k=this.clampedDistanceToSurface(c,
h),p=e.width/2,m=E*e.width,b=E*e.width,e=k*Math.tan(.5*e.fovX)/p,q=e/d,d=e/this.computeHeadingRotateRadius(h),f=(f?q:e)*m*a,c=l-c,c=Math.max(this.minimumAscendVelocity()*a,Math.pow(2,m*a/p)*c-c),k=Math.pow(2,m*a/p)*k-k;a*=g.clamp(d*b,H,D);return{pan:f,ascend:c,zoom:k,rotate:a}};b.prototype.applyDisabledMovementTypes=function(a){void 0===this.disableMovements||void 0!==this.disableMovements.mode&&this.view.state.mode!==this.disableMovements.mode||(a.zoom=this.disableMovements.zoom?0:a.zoom,a.ascend=
this.disableMovements.ascend?0:a.ascend,a.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&e.mat4.identity(a.pan.matrix),a.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&e.mat4.identity(a.rotate.matrix))};b.activatesFor=function(a,c){a=A.extractTransformation(c,a.navigation.gamepad,B);return!("end"===c.action||A.isZeroTransformation(a))};return b}(c.InteractiveController);b.GamepadKeyboardController=n;var B={translation:[0,0,0],heading:0,tilt:0,zoom:0},
C=80,F=g.deg2rad(C),E=.75,G=5,H=g.deg2rad(30),D=g.deg2rad(80),I={zoom:0,ascend:0,pan:{enabled:!1,matrix:f.mat4f64.create()},rotate:{enabled:!1,matrix:f.mat4f64.create()}},L=h.vec3f64.create(),O=r.createDirectionUp()})},"esri/views/3d/support/cameraUtils":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Camera ../../../core/Logger ../../../core/mathUtils ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../camera/intersectionUtils ./cameraUtilsPlanar ./cameraUtilsSpherical ./earthUtils ./ElevationProvider ./mathUtils ./projectionUtils ../../support/spatialReferenceSupport".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y){function A(a){return"global"===a.viewingMode?r:u}function B(a,c,d){var b=a.state.camera,e=b.fovX,b=b.width/2/b.pixelRatio;"global"===a.viewingMode&&null!=d&&(c*=Math.cos(l.deg2rad(d)));c/=a.renderCoordsHelper.unitInMeters;return b/(96*39.37/c)/Math.tan(e/2)}function C(a,c,d){var b=a.state.camera;c=96*39.37/(b.width/2/b.pixelRatio/(c*Math.tan(b.fovX/2)));"global"===a.viewingMode&&(c/=Math.cos(l.deg2rad(d)));return c*=a.renderCoordsHelper.unitInMeters}
function F(a,c,d,b,e,f){if(M(f)){var h=Q(f.signal);L(a,b.heading,b.tilt,c,d,e,h);h.resolver.promise.then(function(c){return f.resolver.resolve(N(a,c,b.fov))},function(a){return f.resolver.reject(a)})}else return c=L(a,b.heading,b.tilt,c,d,e),N(a,c,b.fov,f)}function E(a,c,d,b,e){return A(a).directionToHeadingTilt(c,d,b,e)}function G(a,c){return!!(a.basemapTerrain&&a.renderCoordsHelper.fromRenderCoords(c,U,a.spatialReference)&&w.getElevationAtPoint(a.elevationProvider,U)>U.z-1)}function H(a,c,d){return g(this,
void 0,void 0,function(){var b;return k(this,function(e){switch(e.label){case 0:return a.renderCoordsHelper.fromRenderCoords(c,U,a.spatialReference)?[4,a.elevationProvider.queryElevation(U.x,U.y,U.z,U.spatialReference,d)]:[2,!1];case 1:return b=e.sent(),[2,b>U.z-1]}})})}function D(b,e,f){return g(this,void 0,void 0,function(){var h,l;return k(this,function(g){switch(g.label){case 0:h=a.vec3f64.create();if(e)return[3,1];d.vec3.copy(h,b.state.camera.center);return[3,5];case 1:if(!(e instanceof c))return[3,
4];z.pointToVector(e,h,b.renderSpatialReference);return null!=e.z||null==b.basemapTerrain?[3,3]:[4,b.elevationProvider.queryElevation(e.x,e.y,e.z,e.spatialReference,f)];case 2:return l=g.sent(),null!=l&&b.renderCoordsHelper.setAltitude(l,h),[2,h];case 3:return[3,5];case 4:d.vec3.copy(h,e),g.label=5;case 5:return[2,h]}})})}function I(b,e){var f=a.vec3f64.create();e&&e instanceof c?(z.pointToVector(e,f,b.renderSpatialReference),null==e.z&&null!=b.basemapTerrain&&(e=w.getElevationAtPoint(b.elevationProvider,
e),null!=e&&b.renderCoordsHelper.setAltitude(e,f))):e?d.vec3.copy(f,e):d.vec3.copy(f,b.state.camera.center);return f}function L(a,d,b,e,f,h,l){var g=e&&e instanceof c?e:null;if(M(l))D(a,e,l.signal).then(function(c){O(a,d,b,g,c,f,h,l)},function(a){return l.resolver.reject(a)});else return e=I(a,e),O(a,d,b,g,e,f,h,l)}function O(c,d,b,e,f,h,l,g){e||(e=z.vectorToPoint(f,c.renderSpatialReference,c.spatialReference||q.WGS84));h=Math.max(h,c.state.constraints.minimumPoiDistance);var k=K(c,d,b,f,h,l),p=A(c).eyeForCenterWithHeadingTilt,
m=p(f,h,k.heading,k.tilt);if(1===l&&"global"===c.viewingMode&&0<b){var r=function(){var a=h,k=h,p=c.state.constraints.tilt(k),k=A(c).eyeTiltToLookAtTilt(b,f,k),k=Math.min(k,.5*Math.PI),p=p.min*(1-R)+k*R,a=A(c).lookAtTiltToEyeTilt(p,f,a);l=1>b-a?0:1;return O(c,d,a,e,f,h,l,g)},k=c.map.ground.navigationConstraint;if(!k||"stay-above"===k.type){if(G(c,m.eye))return r();if(M(g)){H(c,m.eye,g.signal).then(function(c){if(c)return r();g.resolver.resolve({eye:m.eye,up:m.up,center:a.vec3f64.clone(f),heading:m.heading,
tilt:m.tilt})});return}}}k=!g||M(g)?{center:a.vec3f64.create(),eye:a.vec3f64.create(),up:a.vec3f64.create(),tilt:0,heading:0}:g;k.eye=m.eye;k.up=m.up;k.center=a.vec3f64.clone(f);k.heading=m.heading;k.tilt=m.tilt;M(g)&&g.resolver.resolve(k);return k}function K(a,c,d,b,e,f){var h=0;if(f=1===f)if(h=a.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(e/h)/Math.LN2)f=!0;else{var l=a.renderSpatialReference,g=a.spatialReference||q.WGS84;f=z.vectorToPoint(b,l,g);l=z.vectorToPoint(a.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,
l,g);h*=Math.tan(.5*a.state.camera.fov);f=5<l.distance(f)/h}f?(c=0,f=a.state.constraints.tilt(e),f.max=Math.min(f.max,.5*Math.PI),f=f.min*(1-R)+f.max*R,d=A(a).eyeTiltToLookAtTilt(d,b,e),h=Math.min(d,f)):h=A(a).eyeTiltToLookAtTilt(d,b,e);d=h=a.state.constraints.clampTilt(e,h);d=A(a).lookAtTiltToEyeTilt(d,b,e);return{heading:c,tilt:d}}function N(a,c,d,b){a=z.vectorToPoint(c.eye,a.renderSpatialReference,a.spatialReference||q.WGS84);return a?b?(b.position=a,b.heading=c.heading,b.tilt=c.tilt,b.fov=d,b):
new e(a,c.heading,c.tilt,d):null}function Q(a){return{resolver:h.createResolver(),signal:a}}function M(a){return a&&"resolver"in a}Object.defineProperty(b,"__esModule",{value:!0});var T=f.getLogger("esri.views.3d.support.cameraUtils"),P=a.vec3f64.create(),S=a.vec3f64.create(),V=a.vec3f64.create(),J={heading:0,tilt:0},U=new c,Y=new v.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),X=new v.Cyclical(-180,180);b.headingTiltToDirectionUp=function(a,c,d,b,e){return A(a).headingTiltToDirectionUp(c,
d,b,e)};b.externalToInternal=function(c,b){var e=c.renderSpatialReference,f=A(c).headingTiltToDirectionUp,h=a.vec3f64.create();if(!z.pointToVector(b.position,h,e))return null;e=f(h,b.heading,b.tilt);d.vec3.scale(e.direction,e.direction,c.state.camera.distance);d.vec3.add(e.direction,e.direction,h);c=t.cameraOnContentAlongViewDirection(c,h,e.direction,e.up);c.fov=l.deg2rad(b.fov);return c};b.internalToExternal=function(a,b,f){var h=a.renderSpatialReference,g=d.vec3.copy(V,b.viewForward),g=E(a,b.eye,
g,b.up,J);a=a.spatialReference||q.WGS84;z.vectorToVector(b.eye,h,P,a)||(a=q.WGS84,z.vectorToVector(b.eye,h,P,a));if(!f)return new e(new c(P,a),g.heading,g.tilt,l.rad2deg(b.fov));f.position.x=P[0];f.position.y=P[1];f.position.z=P[2];f.position.spatialReference=a;f.heading=g.heading;f.tilt=g.tilt;f.fov=l.rad2deg(b.fov);return f};b.scaleToDistance=B;b.distanceToScale=C;b.fromCenterScale=function(a,c,d,b,e,f){d=B(a,d,c.latitude);return F(a,c,d,b,e,f)};b.fromCenterDistance=F;b.directionToHeadingTilt=E;
b.getObserverForPointAtDistance=L;b.fromExtent=function(a,d,b,e,f,h){var l,g=0;null!=d.zmax&&null!=d.zmin&&(l=(d.zmax+d.zmin)/2,g=d.zmax-d.zmin);var k,p;if("global"===a.viewingMode){if(!y.isSpatialReferenceSupported(d.spatialReference,"global"))return M(h)&&h.resolver.reject(),null;var m=new c(d.xmin,d.ymin,d.spatialReference),r=new c(d.xmax,d.ymax,d.spatialReference),t=d.spatialReference.isGeographic?X:Y;d=new c(t.center(m.x,r.x),(r.y+m.y)/2,d.spatialReference);null!=l&&(d.z=l);p=x.getGreatCircleSpanAt(d,
m,r);k=p.lon;p=p.lat;t.diff(m.x,r.x)>t.range/2&&(k+=x.halfEarthCircumference);k=Math.min(k,x.halfEarthCircumference);p=Math.min(p,x.halfEarthCircumference)}else m=a.spatialReference||q.WGS84,k=d.xmax-d.xmin,p=d.ymax-d.ymin,d=new c({x:d.xmin+.5*k,y:d.ymin+.5*p,z:l,spatialReference:m});l=a.state.camera;g=Math.max(1/Math.tan(l.fovX/2)*k*.5,1/Math.tan(l.fovY/2)*p*.5,1/Math.tan(l.fov/2)*g*.5)/1;if(M(h))k=Q(h.signal),L(a,b,e,d,g,f,k),k.resolver.promise.then(function(c){return h.resolver.resolve(N(a,c,a.camera.fov))},
function(a){return h.resolver.reject(a)});else return b=L(a,b,e,d,g,f),N(a,b,a.camera.fov,h)};b.toExtent=function(a,c,b){var e=a.renderSpatialReference,f=d.vec3.dist(c.eye,b);b=z.vectorToPoint(b,e,a.spatialReference||q.WGS84);e=2*f*Math.tan(c.fovX/2)*1;c=2*f*Math.tan(c.fovY/2)*1;return"global"===a.viewingMode?r.toExtent(a,b,e,c):u.toExtent(a,b,e,c)};var R=.7;b.observerToCamera=N;b.scaleToZoom=function(a,c){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.levelAtScale(c);T.error("#scaleToZoom()",
"Cannot compute zoom from scale without a tiling scheme")};b.zoomToScale=function(a,c){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.scaleAtLevel(c);T.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};b.scaleToResolution=function(a,c){return a.spatialReference?p.getResolutionForScale(c,a.spatialReference):void 0};b.computeScale=function(a,c,b){var f=a.renderSpatialReference;c||(c=a.state.camera);var h;h=q.WGS84;c instanceof e?(h=c.position.latitude,
z.pointToVector(c.position,P,f),z.pointToVector(b,S,f),c=d.vec3.distance(P,S)):(z.vectorToVector(c.center,f,S,h),h=S[1],c=c.distance);return C(a,c,h)};b.createAsyncContext=Q;b.isAsyncContext=M})},"esri/views/3d/support/cameraUtilsPlanar":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ./cameraUtilsInternal ./projectionUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d){function a(a,d,b,f){void 0===f&&(f=h.createDirectionUp());k.mat4.identity(p);a=f.direction;var l=f.up;k.mat4.rotateZ(p,p,-m.deg2rad(d));k.mat4.rotateX(p,p,m.deg2rad(b));e.vec3.transformMat4(a,q,p);e.vec3.scale(a,a,-1);e.vec3.transformMat4(l,c,p);return f}Object.defineProperty(b,"__esModule",{value:!0});var c=f.vec3f64.fromValues(0,1,0),q=f.vec3f64.fromValues(0,0,1),p=g.mat4f64.create(),t=f.vec3f64.create(),u=f.vec3f64.create();b.headingTiltToDirectionUp=a;b.directionToHeadingTilt=
function(a,d,b,e){return h.directionToHeadingTilt(d,b,e,q,c)};b.eyeForCenterWithHeadingTilt=function(c,d,b,h){var l=a(c,b,h),g=f.vec3f64.create();e.vec3.scale(g,l.direction,-d);e.vec3.add(g,g,c);return{up:l.up,eye:g,heading:b,tilt:h}};b.lookAtTiltToEyeTilt=function(a){return m.rad2deg(a)};b.eyeTiltToLookAtTilt=function(a){return m.deg2rad(a)};b.toExtent=function(a,c,b,e,f){var h=a.renderSpatialReference;a=a.map&&a.spatialReference||c.spatialReference;d.pointToVector(c,t,h);d.pointToVector(c,u,h);
t[0]-=b/2;u[0]+=b/2;t[1]-=e/2;u[1]+=e/2;d.vectorToVector(t,h,t,a);d.vectorToVector(u,h,u,a);f?(f.xmin=t[0],f.ymin=t[1],f.xmax=u[0],f.ymax=u[1],f.spatialReference=a):f=new l(t[0],t[1],u[0],u[1],a);return f}})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["require","exports","../../../core/mathUtils","../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});var e=g.vec3f64.create(),f=g.vec3f64.create();
b.createDirectionUp=function(){return{direction:g.vec3f64.create(),up:g.vec3f64.create()}};b.directionToHeadingTilt=function(b,h,d,a,c){var l=e;k.vec3.normalize(l,b);var g=k.vec3.dot(l,a),t=0<g,g=Math.abs(g);.99<g&&(g=Math.abs(k.vec3.dot(h,a)),.99>g?(k.vec3.copy(l,h),t&&k.vec3.scale(l,l,-1)):l=null);h=0;l&&(k.vec3.scale(f,a,k.vec3.dot(a,l)),k.vec3.subtract(l,l,f),h=k.vec3.dot(l,c)/(k.vec3.length(l)*k.vec3.length(c)),k.vec3.cross(f,l,c),h=(0<k.vec3.dot(f,a)?1:-1)*m.rad2deg(m.acosClamped(h)));b=m.rad2deg(m.acosClamped(-k.vec3.dot(a,
b)/k.vec3.length(b)));if(!d)return{heading:h,tilt:b};d.heading=h;d.tilt=b;return d}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){function p(c,d,b,f){void 0===f&&(f=a.createDirectionUp());e.vec3.cross(z,c,r);0===e.vec3.dot(z,z)&&e.vec3.cross(z,c,x);k.mat4.identity(v);k.mat4.rotate(v,v,-m.deg2rad(d),c);k.mat4.rotate(v,v,-m.deg2rad(b),z);d=f.up;b=f.direction;e.vec3.cross(d,z,c);e.vec3.normalize(d,d);e.vec3.transformMat4(d,d,v);e.vec3.normalize(b,c);e.vec3.negate(b,b);e.vec3.transformMat4(b,b,v);return f}function t(a){var c=a[1];a[1]=-a[2];a[2]=c}function u(a,c){c=p(c,a.heading,a.tilt);a.up=
c.up;return a}Object.defineProperty(b,"__esModule",{value:!0});var r=f.vec3f64.fromValues(0,0,1),x=e.vec3.normalize(f.vec3f64.create(),f.vec3f64.fromValues(1,1,1)),w=new q.Cyclical(-180,180),v=g.mat4f64.create(),z=f.vec3f64.create(),y=f.vec3f64.create();b.headingTiltToDirectionUp=p;b.directionToHeadingTilt=function(c,d,b,f){var h=z;e.vec3.normalize(h,c);e.vec3.cross(y,h,r);0===e.vec3.dot(y,y)&&e.vec3.cross(y,h,x);e.vec3.cross(y,y,h);return a.directionToHeadingTilt(d,b,f,h,y)};b.eyeForCenterWithHeadingTilt=
function(a,c,d,b){var h={eye:f.vec3f64.create(),up:null,tilt:b,heading:d},l=z;l[0]=a[0];l[1]=a[2];l[2]=-a[1];d=m.deg2rad(d);var g=m.deg2rad(b);b=Math.sin(d);d=Math.cos(d);var k=Math.sin(g),p=Math.cos(g),q=e.vec3.length(l);if(1E-8>Math.abs(g))g=c+q;else var r=q/k,v=m.asinClamped(c/r),g=r*Math.sin(Math.PI-g-v);var p=p*c,r=c*c*k*k,v=d*d*r,x=g-p,y=x*x,w=v*(v+y-l[1]*l[1]);if(0>w)return e.vec3.scale(h.eye,l,g/q),h.tilt=0,h;var A=Math.sqrt(w),n=l[1]*x,w=v+y,A=0<d?-A+n:A+n;if(1E-8>Math.abs(w))return 1E-8>
q?(h.eye[0]=0,h.eye[1]=0,h.eye[2]=c):e.vec3.scale(h.eye,l,g/q),h.tilt=0,t(h.eye),u(h,a);h.eye[1]=A/w;c*=k;A=h.eye[1]*h.eye[1];k=1-A;w=Math.sqrt(k);r=v*A+b*b*r-2*d*c*h.eye[1]*w*x+k*y;if(1E-8>Math.abs(r))return e.vec3.scale(h.eye,l,g/q),h.tilt=0,t(h.eye),u(h,a);h.eye[0]=(k*(g*l[0]-p*l[0])-c*w*(l[0]*h.eye[1]*d+l[2]*b))/r;h.eye[2]=(k*(g*l[2]-p*l[2])-c*w*(l[2]*h.eye[1]*d-l[0]*b))/r;e.vec3.scale(h.eye,h.eye,g);t(h.eye);return u(h,a)};b.lookAtTiltToEyeTilt=function(a,c,d){c=e.vec3.length(c);d=m.asinClamped(d/
(Math.sqrt(d*d+c*c-2*d*c*Math.cos(Math.PI-a))/Math.sin(a)));return m.rad2deg(a-d)};b.eyeTiltToLookAtTilt=function(a,c,d){a=m.deg2rad(a);c=e.vec3.length(c);return m.asinClamped(d/(c/Math.sin(a)))+a};b.toExtent=function(a,b,e,f,g){function k(a){var c=Math.PI/2;a=q.cyclical2PI.normalize(a,-c);a>c&&(a=Math.PI-a);return a}var p;p=b.latitude;b=b.longitude;var t=c.getLonDeltaForDistance(p,e)/2;e=b-t;b+=t;p=m.deg2rad(p);t=c.earthRadius;p=(1+Math.sin(p))/(1-Math.sin(p));var r=(p+1)*Math.tan(f/t/2);p=1.5*Math.PI-
2*Math.atan(.5*(r+Math.sqrt(4*p+r*r)));f=p+f/t;p=k(p);f=k(f);f<p&&(t=f,f=p,p=t);p=Math.max(m.rad2deg(p),-90);f=Math.min(m.rad2deg(f),90);b=w.monotonic(e,b);180<b-e&&(t=(b-e-180)/2,e+=t,b-=t);t=a.spatialReference&&a.spatialReference.isGeographic?a.spatialReference:h.WGS84;g?(g.xmin=e,g.ymin=p,g.xmax=b,g.ymax=f,g.spatialReference=t):g=new l(e,p,b,f,t);a.spatialReference&&a.spatialReference.isWebMercator&&d.geographicToWebMercator(g,!1,g);return g}})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["require",
"exports","../../core/libs/gl-matrix-2/vec3"],function(n,b,m){function k(b){var e=b*b;0>b&&(e*=-1);return e}Object.defineProperty(b,"__esModule",{value:!0});b.quadraticAccentuation=k;b.resetTransformation=function(b){b.translation[0]=0;b.translation[1]=0;b.translation[2]=0;b.heading=0;b.tilt=0;return b};b.extractTransformation=function(b,e,f){var l=b.state;b=b.device;e="forward-down"===e.tiltDirection?1:-1;"standard"===b.deviceType?(f.translation[0]=k(l.axes[0]),f.translation[1]=k(l.axes[1]),f.translation[2]=
k(l.buttons[7])-k(l.buttons[6]),f.heading=k(l.axes[2]),f.tilt=k(l.axes[3])):"spacemouse"===b.deviceType&&(f.translation[0]=1.2*k(l.axes[0]),f.translation[1]=1.2*k(l.axes[1]),f.translation[2]=2*-k(l.axes[2]),f.heading=1.2*k(l.axes[5]),f.tilt=1.2*k(l.axes[3]));f.tilt*=e;m.vec3.scale(f.translation,f.translation,1);return f};b.extractTransformationKeyboard=function(b,e){e.translation[0]=b[1]-b[0];e.translation[1]=b[3]-b[2];e.translation[2]=b[4]-b[5];e.heading=b[7]-b[6];e.tilt=b[8]-b[9];e.zoom=b[10]-b[11];
return e};b.isZeroTransformation=function(b){return 0===b.translation[0]&&0===b.translation[1]&&0===b.translation[2]&&0===b.heading&&0===b.tilt&&0===b.zoom}})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(e,f,d){var a,c=b.call(this,!0)||
this;c.view=e;c.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:"local"};c.keyToNumber=(a={},a[f.left]=0,a[f.right]=1,a[f.forward]=2,a[f.backward]=3,a[f.up]=4,a[f.down]=5,a[f.headingLeft]=6,a[f.headingRight]=7,a[f.tiltUp]=8,a[f.tiltDown]=9,a[f.zoomIn]=10,a[f.zoomOut]=11,a);c.registerIncoming("key-down",d,function(a){return c.handleKeyDown(a)});c.registerIncoming("key-up",d,function(a){return c.handleKeyUp(a)});c.registerIncoming("blur",d,function(){return c.handleBlur()});return c}m(e,b);
e.prototype.handleKeyDown=function(b){var e=this.keyToNumber[b.data.key];null!=e&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new k.GamepadKeyboardController(this.view,void 0,this.disableMovements),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(e),b.stopPropagation()))};e.prototype.handleBlur=function(){this.cameraControllerKeyboard&&
this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)};e.prototype.handleKeyUp=function(b){var e=this.keyToNumber[b.data.key];null!=e&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(e),b.stopPropagation())};return e}(g.InputHandler);b.KeyboardNavigation=n})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),
function(n,b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function f(d,a){var c=b.call(this,!0)||this;c.view=d;c.registerIncoming("mouse-wheel",a,function(a){return c.handleMouseWheel(a)});return c}m(f,b);f.prototype.handleMouseWheel=function(d){if(this.view.navigation.mouseWheelZoomEnabled){var a=d.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new g.ZoomStepController(this.view,"interaction"):new e.ZoomStepController(this.view,
"interaction"),this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*a.deltaY,k.createScreenPointArray(a.x,a.y));d.preventDefault();d.stopPropagation()}};return f}(f.InputHandler);b.MouseWheelZoom=n})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(n,b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(d,a,c){var e=b.call(this,!0)||this;e.view=d;e.pointerAction=a;e.lastEndTimestamp=0;e.lastTimestamp=0;e.registerIncoming("drag",c,function(a){return e.handleDrag(a)});return e}m(e,b);e.prototype.handleDrag=function(d){if("mouse"!==d.data.pointerType||f.eventMatchesMousePointerAction(d.data,this.pointerAction)){var a=d.timestamp-this.lastEndTimestamp,a=this.momentum&&this.momentum.active&&40>a;switch(d.data.action){case "start":case "update":if(a)break;
this.controller&&this.controller.active?2<d.data.timestamp-this.lastTimestamp&&(this.controller.update(d.data),this.lastTimestamp=d.timestamp):this.startController(d);break;case "end":case "removed":this.endController(d,!0);break;case "added":this.endController(d,!1),this.startController(d)}d.stopPropagation()}};e.prototype.endController=function(d,a){this.controller&&this.controller.active&&(this.lastEndTimestamp=d.timestamp,d=this.controller.end(d.data),a&&d&&(this.momentum=d,this.view.state.switchCameraController(this.momentum)));
this.controller=null};e.prototype.startController=function(d){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(d.data);this.lastTimestamp=d.timestamp};e.prototype.createController=function(){return this.view.state.isGlobal?new k.PinchAndPanController(this.view,this.view.sceneIntersectionHelper):new g.PinchAndPanController(this.view,this.view.sceneIntersectionHelper)};return e}(e.InputHandler);b.PinchAndPanNavigation=n})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../utils/navigationUtils ../../../support/geometryUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function q(a,e){var h=b.call(this)||this;h.view=a;h.intersectionHelper=e;h.smoothRotation=new c.ExponentialFalloff(.05);h.rotationAxis=d.vec3f64.create();h.panningPlane=z.plane.create();h.smoothScaling=new c.ExponentialFalloff(.05);h.zoomCenterScreen=g.createScreenPointArray();h.zoomMomentumEstimator=new E.ZoomMomentumEstimator;h.rotationMomentumEstimator=new F.RotationMomentumEstimator;
h.panSphericalMomentumEstimator=new C.PanSphericalMomentumEstimator;h.panPlanarMomentumEstimator=new B.PanPlanarMomentumEstimator;h.adjustedSphere=z.sphere.create();h.tmp3d=d.vec3f64.create();h.tmpMat=f.mat4f64.create();h.tmpAxisAngle=z.axisAngle.create();h.tmpScreenPointArray=g.createScreenPointArray();h.beginScreenPoint=g.createScreenPointArray();h.beginScenePoint=d.vec3f64.create();h.screenPickPoint=g.createScreenPointArray();h.panMode=v.PanMode.Horizontal;h.tmpInteractionDirection=d.vec3f64.create();
h.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new A.default,interactionDirection:null,tiltMode:0};return h}m(q,b);q.prototype.begin=function(a){if(this.active){var c=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=c;this.rotationMomentumEstimator.enabled=c;this.panPlanarMomentumEstimator.enabled=c;this.panSphericalMomentumEstimator.enabled=c;this.beginHeading=-y.cyclicalPI.normalize(k.deg2rad(this.view.camera.heading));this.beginRadius=
a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.smoothRotation.reset();g.screenPointObjectToArray(a.center,this.screenPickPoint);l.vec2.copy(this.beginScreenPoint,this.screenPickPoint);c=w.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,this.screenPickPoint,!0);this.scenePickPoint=c.scenePickPoint;this.sphere=c.sphere;h.vec3.copy(this.beginScenePoint,this.scenePickPoint);this.panMode=w.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint);this.panMode===
v.PanMode.Vertical&&(this.beginCamera.aboveGround?this.preparePlanarPanModeOverground(a):this.preparePlanarPanMode(a));this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};q.prototype.preparePlanarPanModeOverground=function(a){var c=h.vec3.negate(this.tmp3d,this.beginCamera.viewForward);z.plane.fromPositionAndNormal(this.scenePickPoint,c,this.panningPlane);var b=g.createScreenPointArray(this.screenPickPoint[0],0),c=d.vec3f64.create(),e=h.vec3.length(this.beginCamera.eye);this.adjustedSphere.radius=
e<this.sphere.radius?e-100:this.sphere.radius;w.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.beginCamera,b,c);b=g.createRenderScreenPointArray3();this.beginCamera.projectPoint(c,b);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*b[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&z.plane.fromPositionAndNormal(this.scenePickPoint,this.panningPlane,this.panningPlane);a=g.screenPointObjectToArray(a.center,this.tmpScreenPointArray);w.intersectPlaneFromScreenPoint(this.panningPlane,
this.beginCamera,a,this.beginScenePoint)};q.prototype.preparePlanarPanMode=function(a){var c=h.vec3.negate(this.tmp3d,this.beginCamera.viewForward);z.plane.fromPositionAndNormal(this.scenePickPoint,c,this.panningPlane);var d=z.sphere.angleToSilhouette(this.sphere,this.currentCamera.eye),c=z.axisAngle.fromPoints(this.currentCamera.eye,this.scenePickPoint,this.tmpAxisAngle),d=-c[3]-(this.currentCamera.aboveGround?.25:.025)*d;if(0<d){var b=e.mat4.identity(this.tmpMat);e.mat4.rotate(b,b,-d,c);h.vec3.subtract(this.scenePickPoint,
this.scenePickPoint,this.sphere.center);h.vec3.transformMat4(this.scenePickPoint,this.scenePickPoint,b);h.vec3.add(this.scenePickPoint,this.scenePickPoint,this.sphere.center);z.plane.setOffsetFromPoint(this.panningPlane,this.scenePickPoint,this.panningPlane);a=g.screenPointObjectToArray(a.center,this.tmpScreenPointArray);w.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,a,this.beginScenePoint)}};q.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);
var c=1<a.pointers.size;this.panMode===v.PanMode.Horizontal?(c&&this.zoomSpherical(a),this.panningSpherical(a),c&&this.rotateSpherical(a)):(c&&this.zoomPlanar(a),this.panningPlanar(a),c&&this.rotatePlanar(a));this.currentCamera.markViewDirty()}};q.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();if(a=this.zoomMomentumEstimator.evaluateMomentum())return this.panMode===v.PanMode.Horizontal?new x.ZoomSphericalMomentumController(this.view,a,this.zoomCenterScreen,
this.beginScenePoint,this.sphere.radius):new r.ZoomPlanarMomentumController(this.view,a,this.beginScenePoint);if(a=this.rotationMomentumEstimator.evaluateMomentum())return new u.RotationMomentumController(this.view,a,this.sphere.center,this.rotationAxis);if(this.panMode===v.PanMode.Horizontal){if(a=this.panSphericalMomentumEstimator.evaluateMomentum())return new t.PanSphericalMomentumController(this.view,a)}else if(a=this.panPlanarMomentumEstimator.evaluateMomentum())return new p.PanPlanarMomentumController(this.view,
a);return null};q.prototype.zoomSpherical=function(c){var d=this.beginRadius/c.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(c.radius,40),120);this.smoothScaling.update(d);w.applyZoomOnSphere(this.sphere,this.currentCamera,this.smoothScaling.value);g.screenPointObjectToArray(c.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*c.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(c.radius-
this.beginRadius);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};q.prototype.panningSpherical=function(c){var d=g.screenPointObjectToArray(c.center,this.tmpScreenPointArray);w.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,d,this.tmp3d);w.preserveHeadingThreshold(this.beginScenePoint,h.vec3.dot(this.currentCamera.up,this.beginScenePoint),this.sphere.radius,this.beginHeading,this.view.camera.tilt,this.beginCamera)?(w.applyPanSphericalPreserveHeading(this.sphere,
this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(d,this.tmp3d,.001*c.timestamp,this.beginCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(w.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(d,this.tmp3d,.001*c.timestamp,this.beginCamera,this.sphere.radius,
this.view.camera.tilt));this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.screenPickPoint,d);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};q.prototype.rotateSpherical=function(c){h.vec3.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||h.vec3.negate(this.rotationAxis,this.rotationAxis);var d=this.smoothRotation.value,b=w.normalizeRotationDelta(c.angle-d),d=d+b;this.smoothRotation.gain=
.00125*Math.min(Math.max(c.radius,40),120);this.smoothRotation.update(d);b=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(b,.001*c.timestamp);w.applyRotation(this.currentCamera,this.sphere.center,z.axisAngle.wrapAxisAngle(this.rotationAxis,b));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(c.radius*d);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};q.prototype.panningPlanar=function(c){var d=
g.screenPointObjectToArray(c.center,this.tmpScreenPointArray);w.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,d,this.tmp3d)&&(w.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(d,this.tmp3d,.001*c.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.beginScreenPoint,d),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,
this.tmpInteractionDirection),a.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};q.prototype.zoomPlanar=function(c){var d=this.beginRadius/c.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(c.radius,40),120);this.smoothScaling.update(d);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*c.timestamp);w.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);
this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(c.radius-this.beginRadius);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};q.prototype.rotatePlanar=function(c){h.vec3.copy(this.rotationAxis,this.beginScenePoint);this.currentCamera.aboveGround||h.vec3.negate(this.rotationAxis,this.rotationAxis);var d=this.smoothRotation.value,b=c.angle-d,b=w.normalizeRotationDelta(b);this.smoothRotation.gain=.00125*Math.min(Math.max(c.radius,
40),120);this.smoothRotation.update(d+b);d=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(d,.001*c.timestamp);w.applyRotation(this.currentCamera,this.sphere.center,z.axisAngle.wrapAxisAngle(this.rotationAxis,d));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(c.radius*d);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};return q}(q.InteractiveController);b.PinchAndPanController=n})},"esri/views/3d/input/util":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this._gain=b}b.prototype.reset=function(b){this._value=b};Object.defineProperty(b.prototype,"gain",{set:function(b){this._gain=b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0});b.prototype.update=function(b){this._value=void 0===this._value?b:this._gain*b+(1-this._gain)*this._value};
return b}();b.ExponentialFalloff=n})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(e,d){e=b.call(this,e,4)||this;e.momentum=d;e.tmpPan=g.vec3f64.create();return e}m(e,b);e.prototype.momentumStep=
function(b,d){b=this.momentum.value(b);k.vec3.scale(this.tmpPan,this.momentum.direction,b);k.vec3.subtract(d.eye,d.eye,this.tmpPan);k.vec3.subtract(d.center,d.center,this.tmpPan);d.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};return e}(e.MomentumController);b.PanPlanarMomentumController=n})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../ViewAnimation ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(n,b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(d,a){var c=b.call(this,new k)||this;c.view=d;c.beginCamera=new f.default;c.elapsedTimeSec=0;c.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new f.default,interactionDirection:null,tiltMode:0};c.constraintOptions.interactionType=a;return c}m(e,b);Object.defineProperty(e.prototype,"steppingFinished",{get:function(){return this.momentum.isFinished(this.elapsedTimeSec)},
enumerable:!0,configurable:!0});e.prototype.onControllerStart=function(d){this.beginCamera.copyFrom(d);this.constraintOptions.interactionStartCamera=this.beginCamera;b.prototype.onControllerStart.call(this,d)};e.prototype.stepController=function(d,a){a.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=d;this.momentumStep(this.elapsedTimeSec,a);g.applyAll(this.view,a,this.constraintOptions)};return e}(e.AnimationController);b.MomentumController=n})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils".split(" "),
function(n,b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});var l=g.vec3f64.create(),h=g.vec3f64.create();n=function(d){function a(a,b){a=d.call(this,a,4)||this;a.momentum=b;return a}m(a,d);a.prototype.momentumStep=function(a,d){var c=this.momentum.value1(a);a=this.momentum.value2(a);k.vec3.copy(h,d.eye);k.vec3.normalize(h,h);k.vec3.cross(this.momentum.axis2,h,this.momentum.axis1);f.applyRotationWithTwoAxes(d,l,this.momentum.axis1,c,this.momentum.axis2,a)};return a}(e.MomentumController);
b.PanSphericalMomentumController=n})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,c,d,e){a=b.call(this,a,2)||this;a.momentum=
c;a.axis=g.vec3f64.create();a.center=g.vec3f64.create();k.vec3.copy(a.axis,e);k.vec3.copy(a.center,d);return a}m(d,b);d.prototype.momentumStep=function(a,c){a=this.momentum.value(a);f.applyRotation(c,this.center,l.axisAngle.wrapAxisAngle(this.axis,a))};return d}(e.MomentumController);b.RotationMomentumController=n})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/mathUtils".split(" "),
function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,c,d){a=b.call(this,a,1)||this;a.momentum=c;a.zoomCenter=g.vec3f64.create();k.vec3.copy(a.zoomCenter,d);a.constraintOptions.interactionDirection=g.vec3f64.create();return a}m(d,b);d.prototype.momentumStep=function(a,c){k.vec3.copy(this.constraintOptions.interactionDirection,c.eye);a=this.momentum.valueDelta(0,a);f.applyZoomToPoint(c,this.zoomCenter,a,this.view.state.constraints.minimumPoiDistance);
this.constraintOptions.interactionDirection=l.directionFromTo(this.constraintOptions.interactionDirection,c.eye,this.constraintOptions.interactionDirection)};return d}(e.MomentumController);b.ZoomPlanarMomentumController=n})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(c){function b(d,b,h,l,m){d=c.call(this,d,1)||this;d.momentum=b;d.screenCenter=k.createScreenPointArray();d.sceneCenter=f.vec3f64.create();d.tmpSceneCenter=f.vec3f64.create();d.tmpZoomAxisAngle=a.axisAngle.create();d.sphere=a.sphere.create();g.vec2.copy(d.screenCenter,h);e.vec3.copy(d.sceneCenter,l);d.sphere.radius=m;return d}m(b,c);b.prototype.momentumStep=function(c,b){c=this.momentum.valueDelta(0,c);d.applyZoomOnSphere(this.sphere,
b,c);this.constraintOptions.interactionType=1;l.applyAll(this.view,b,this.constraintOptions);d.sphereOrPlanePointFromScreenPoint(this.sphere,b,this.screenCenter,this.tmpSceneCenter);a.axisAngle.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);d.applyRotation(b,this.sphere.center,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=4};return b}(h.MomentumController);b.ZoomSphericalMomentumController=n})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),
function(n,b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});var l=function(b){function d(a,c,d,e,f){a=b.call(this,a,c,d)||this;a.sceneVelocity=e;a.direction=f;return a}m(d,b);d.prototype.value=function(a){return b.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,a)};return d}(f.Momentum);b.PanPlanarMomentum=l;n=function(){function b(d,a,c){void 0===d&&(d=300);void 0===a&&(a=12);void 0===c&&(c=.84);this.minimumInitialVelocity=d;this.stopVelocity=a;this.friction=c;this.enabled=
!0;this.time=new e.FilteredFiniteDifference(.6);this.screen=[new e.FilteredFiniteDifference(.4),new e.FilteredFiniteDifference(.4)];this.scene=[new e.FilteredFiniteDifference(.6),new e.FilteredFiniteDifference(.6),new e.FilteredFiniteDifference(.6)];this.tmpDirection=g.vec3f64.create()}b.prototype.add=function(d,a,c){!this.enabled||this.time.hasLastValue&&.015>this.time.computeDelta(c)||(this.screen[0].update(d[0]),this.screen[1].update(d[1]),this.scene[0].update(a[0]),this.scene[1].update(a[1]),
this.scene[2].update(a[2]),this.time.update(c))};b.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};b.prototype.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var d=this.screen[0].filteredDelta,a=this.screen[1].filteredDelta,d=Math.sqrt(d*d+a*a)/this.time.filteredDelta;return Math.abs(d)<this.minimumInitialVelocity?null:this.createMomentum(d,this.stopVelocity,
this.friction)};b.prototype.createMomentum=function(d,a,c){k.vec3.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var b=k.vec3.length(this.tmpDirection);0<b&&k.vec3.scale(this.tmpDirection,this.tmpDirection,1/b);return new l(d,a,c,b/this.time.filteredDelta,this.tmpDirection)};return b}();b.PanPlanarMomentumEstimator=n})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,
"__esModule",{value:!0});n=function(){function b(b){this.gain=b}b.prototype.update=function(b){if(this.hasLastValue){var g=this.computeDelta(b);this.updateDelta(g)}this.lastValue=b};b.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(b.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,
configurable:!0});b.prototype.computeDelta=function(b){return b-this.lastValue};b.prototype.updateDelta=function(b){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*b:b};return b}();b.FilteredFiniteDifference=n})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e,f){this._initialVelocity=b;this._stopVelocity=e;this._friction=
f;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(b.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});b.prototype.isFinished=function(b){return b>this.duration};Object.defineProperty(b.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});b.prototype.value=function(b){return this.valueFromInitialVelocity(this._initialVelocity,b)};b.prototype.valueDelta=
function(b,e){var f=this.value(b);return this.value(b+e)-f};b.prototype.valueFromInitialVelocity=function(b,e){e=Math.min(e,this.duration);var f=1-this.friction;return b*(Math.pow(f,e)-1)/Math.log(f)};return b}();b.Momentum=n})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),
function(n,b,m,k,g,e,f,l,h,d){Object.defineProperty(b,"__esModule",{value:!0});var a=function(a){function c(c,d,b,e,f,h,l){void 0===h&&(h=0);c=a.call(this,c,d,b)||this;c.angularVelocity1=e;c.axis1=f;c.angularVelocity2=h;c.axis2=l;return c}m(c,a);c.prototype.value1=function(c){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,c)};c.prototype.value2=function(c){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,c)};return c}(d.Momentum);b.PanSphericalMomentum=
a;n=function(){function c(a,c,d){void 0===a&&(a=300);void 0===c&&(c=12);void 0===d&&(d=.84);this.minimumInitialVelocity=a;this.stopVelocity=c;this.friction=d;this.enabled=!0;this.tmpAxis1=e.vec3f64.create();this.tmpAxis2=e.vec3f64.create();this.tmpAngles=k.vec2f64.create();this.time=new l.FilteredFiniteDifference(.3);this.screen=[new l.FilteredFiniteDifference(.4),new l.FilteredFiniteDifference(.4)];this.angle1=new h.FilteredValue(.6);this.angle2=new h.FilteredValue(.6);this.axis1=e.vec3f64.create();
this.axis2=e.vec3f64.create();this.lastScene=e.vec3f64.create()}c.prototype.addMomentumDirectRotation=function(a,c,d,b,e,h){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(d))return;b=f.rotationAngleAndAxisDirectRotation(this.lastScene,c,this.tmpAxis2,b,e,h);this.angle2.update(0);1E-5>g.vec3.squaredLength(this.tmpAxis2)?b=0:g.vec3.normalize(this.axis1,this.tmpAxis2);this.angle1.update(b);g.vec3.copy(this.lastScene,c)}this.screen[0].update(a[0]);this.screen[1].update(a[1]);
this.time.update(d)}};c.prototype.addMomentumPreserveHeading=function(a,c,d,b,e,h,l){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(d))return;f.rotationAnglesAndAxesHeadingPreserving(this.lastScene,c,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,b,e,h,l,!1);1E-5>g.vec3.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),g.vec3.normalize(this.axis1,this.tmpAxis1),g.vec3.normalize(this.axis2,
this.tmpAxis2));g.vec3.copy(this.lastScene,c)}this.screen[0].update(a[0]);this.screen[1].update(a[1]);this.time.update(d)}};c.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();this.time.reset()};c.prototype.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,c=this.screen[1].filteredDelta,a=Math.sqrt(a*a+c*c)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?
null:this.createMomentum(a,this.stopVelocity,this.friction)};c.prototype.createMomentum=function(c,d,b){return new a(c,d,b,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};return c}();b.PanSphericalMomentumEstimator=n})},"esri/views/navigation/FilteredValue":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.gain=b}b.prototype.update=function(b){this.filteredValue=
this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*b:b};b.prototype.reset=function(){this.filteredValue=void 0};Object.defineProperty(b.prototype,"hasFilteredValue",{get:function(){return void 0!==this.filteredValue},enumerable:!0,configurable:!0});return b}();b.FilteredValue=n})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./MomentumEstimator"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});
n=function(b){function e(e,l,h,d){void 0===e&&(e=3);void 0===l&&(l=.01);void 0===h&&(h=.95);void 0===d&&(d=12);return b.call(this,e,l,h,d)||this}m(e,b);e.prototype.add=function(e,l){if(this.value.hasLastValue){var f=this.value.lastValue;for(e-=f;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;e=f+e}b.prototype.add.call(this,e,l)};return e}(k.MomentumEstimator);b.RotationMomentumEstimator=n})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),
function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e,d,a){void 0===b&&(b=2.5);void 0===e&&(e=.01);void 0===d&&(d=.95);void 0===a&&(a=12);this.minimumInitialVelocity=b;this.stopVelocity=e;this.friction=d;this.maxVelocity=a;this.enabled=!0;this.value=new g.FilteredFiniteDifference(.8);this.time=new g.FilteredFiniteDifference(.3)}b.prototype.add=function(b,e){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(e))return;if(this.value.hasFilteredDelta){var d=
this.value.computeDelta(b);0>this.value.filteredDelta*d&&this.value.reset()}}this.time.update(e);this.value.update(b)}};b.prototype.reset=function(){this.value.reset();this.time.reset()};b.prototype.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;var b=this.value.filteredDelta/this.time.filteredDelta,b=k.clamp(b,-this.maxVelocity,this.maxVelocity);return Math.abs(b)<this.minimumInitialVelocity?null:this.createMomentum(b,this.stopVelocity,this.friction)};b.prototype.createMomentum=
function(b,f,d){return new e.Momentum(b,f,d)};return b}();b.MomentumEstimator=n})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});var e=function(b){function e(e,d,a){return b.call(this,e,d,a)||this}m(e,b);e.prototype.value=function(e){e=b.prototype.value.call(this,e);return Math.exp(e)};e.prototype.valueDelta=function(e,
d){var a=b.prototype.value.call(this,e);e=b.prototype.value.call(this,e+d);return Math.exp(e-a)};return e}(k.Momentum);b.ZoomMomentum=e;n=function(b){function f(e,d,a,c){void 0===e&&(e=2.5);void 0===d&&(d=.01);void 0===a&&(a=.95);void 0===c&&(c=12);return b.call(this,e,d,a,c)||this}m(f,b);f.prototype.add=function(e,d){b.prototype.add.call(this,Math.log(e),d)};f.prototype.createMomentum=function(b,d,a){return new e(b,d,a)};return f}(g.MomentumEstimator);b.ZoomMomentumEstimator=n})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w){Object.defineProperty(b,"__esModule",{value:!0});var v;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(v=b.PanMode||(b.PanMode={}));var z=f.vec3f64.fromValues(0,0,1),y=16/180*Math.PI;n=function(d){function b(a,c){var b=d.call(this)||this;b.view=a;b.intersectionHelper=c;b.rotationValueSmooth=new h.ExponentialFalloff(.05);b.scalingValueSmooth=new h.ExponentialFalloff(.05);b.planeHorizontal=t.plane.create();b.planeVertical=t.plane.create();
b.rotationMomentumEstimator=new x.RotationMomentumEstimator;b.panMomentumEstimator=new r.PanPlanarMomentumEstimator(300,12,.9);b.zoomMomentumEstimator=new w.ZoomMomentumEstimator;b.beginCenter=f.vec3f64.create();b.tmpPoints=[];b.beginCenterScreen=g.createScreenPointArray();b.tmpCentroid3d=f.vec3f64.create();b.tmpCentroid2d=g.createScreenPointArray();b.tmp2d=g.createScreenPointArray();b.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new u.default,interactionDirection:null,
tiltMode:0};return b}m(b,d);b.prototype.begin=function(a){if(this.active){var c=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=c;this.rotationMomentumEstimator.enabled=c;this.panMomentumEstimator.enabled=c;this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();g.screenPointObjectToArray(a.center,this.beginCenterScreen);t.plane.fromNormalAndOffset(z,0,this.planeHorizontal);c=f.vec3f64.create();
this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,c);var d=f.vec3f64.create();e.vec3.negate(d,this.beginCamera.viewForward);var b=f.vec3f64.create();e.vec3.copy(b,z);var h=e.vec3.dot(d,b);this.panMode=k.asinClamped(0>h?-h:h)>=y?v.Horizontal:v.Vertical;t.plane.setOffsetFromPoint(this.planeHorizontal,c,this.planeHorizontal);this.beginCamera.aboveGround||t.plane.negate(this.planeHorizontal,this.planeHorizontal);this.panMode===v.Vertical?(e.vec3.scale(b,b,h),e.vec3.subtract(this.planeVertical,
d,b),e.vec3.normalize(this.planeVertical,this.planeVertical),t.plane.setOffsetFromPoint(this.planeVertical,c,this.planeVertical),this.computePlanePoints(a.pointers,this.planeVertical,this.beginCamera,this.tmpPoints)):this.computePlanePoints(a.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);p.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};b.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);
var c=1<a.pointers.size,d=this.panMode===v.Horizontal?this.planeHorizontal:this.planeVertical,b=this.beginCenter;if(c){var e=this.beginRadius/a.radius,f=.001875*Math.min(Math.max(a.radius,40),120);this.scalingValueSmooth.gain=f;this.scalingValueSmooth.update(e);p.applyZoomToPoint(this.currentCamera,b,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=
l.pixelDistanceToInteractionFactor(Math.abs(a.radius-this.beginRadius));l.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.computePlanePoints(a.pointers,d,this.currentCamera,this.tmpPoints);p.centroid(this.tmpPoints,this.tmpCentroid3d);g.screenPointObjectToArray(a.center,this.tmpCentroid2d);p.applyPanPlanar(this.currentCamera,b,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*a.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=
l.pixelDistanceToInteractionFactor(this.beginCenterScreen,this.tmpCentroid2d);l.applyAll(this.view,this.currentCamera,this.constraintOptions);c&&(c=this.planeHorizontal,d=this.rotationValueSmooth.value,e=p.normalizeRotationDelta(a.angle-d),f=.00125*Math.min(Math.max(a.radius,40),120),this.rotationValueSmooth.gain=f,this.rotationValueSmooth.update(d+e),f=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(f,.001*a.timestamp),p.applyRotation(this.currentCamera,b,t.axisAngle.wrapAxisAngle(c,
f)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=l.pixelDistanceToInteractionFactor(Math.abs(a.radius*f)),l.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};b.prototype.end=function(d){d.pointers.size===this.pointerCount&&this.update(d);this.finishController();return(d=this.zoomMomentumEstimator.evaluateMomentum())?new q.ZoomPlanarMomentumController(this.view,d,this.beginCenter):(d=this.rotationMomentumEstimator.evaluateMomentum())?
new c.RotationMomentumController(this.view,d,this.beginCenter,this.planeHorizontal):(d=this.panMomentumEstimator.evaluateMomentum())?new a.PanPlanarMomentumController(this.view,d):null};b.prototype.computePlanePoints=function(a,c,d,b){b.length=a.size;var e=this.tmp2d,h=0;a.forEach(function(a){e[0]=a.x;e[1]=a.y;void 0===b[h]&&(b[h]=f.vec3f64.create());p.intersectPlaneFromScreenPoint(c,d,e,b[h]);h+=1});return b};return b}(d.InteractiveController);b.PinchAndPanController=n})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require",
"exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(e,l){var f=b.call(this,!0)||this;f.view=e;f.registerIncoming("pointer-down",l,function(){return f.view.state.stopActiveCameraController()});return f}m(e,b);return e}(k.InputHandler);b.PointerDownCancelAnimation=n})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"./SingleKey"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(e,l,h){h=b.call(this,l,h)||this;h.view=e;h.key=l;return h}m(e,b);e.prototype.activate=function(){this.view.goTo({heading:0}).catch(function(){})};return e}(k.SingleKey);b.SingleKeyResetHeading=n})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(n,b,m,k){Object.defineProperty(b,
"__esModule",{value:!0});n=function(b){function e(e,l){var f=b.call(this,!0)||this;f.key=e;f.registerIncoming("key-down",l,function(d){return f._handleKeyDown(d)});return f}m(e,b);e.prototype._handleKeyDown=function(b){b.data.key===this.key&&(this.activate(),b.stopPropagation())};return e}(k.InputHandler);b.SingleKey=n})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],function(n,b,m,k){Object.defineProperty(b,
"__esModule",{value:!0});n=function(b){function e(e,l,h){h=b.call(this,l,h)||this;h.view=e;h.key=l;return h}m(e,b);e.prototype.activate=function(){this.view.goTo({tilt:0}).catch(function(){})};return e}(k.SingleKey);b.SingleKeyResetTilt=n})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,
"__esModule",{value:!0});n=function(b){function e(e,d){void 0===d&&(d=!1);var a=b.call(this,!0)||this;a.view=e;a.invert=d;a.registerIncoming("vertical-two-finger-drag",function(c){return a.handleTwoFinger(c)});return a}m(e,b);e.prototype.handleTwoFinger=function(b){var d=k.createScreenPointArray(0,b.data.delta*(this.invert?-1:1));switch(b.data.action){case "begin":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=new g.RotateController(this.view,
this.view.sceneIntersectionHelper,"center");this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController&&this.cameraController.update(d);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}};return e}(e.InputHandler);b.TwoFingerTilt=n})},"esri/views/input/BrowserEventSource":function(){define("require exports ../../core/has ../../core/screenUtils ../../core/libs/pep/pep ./keys ./gamepad/GamepadSource".split(" "),
function(n,b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});var l=m("trident"),h=m("edge"),d=m("chrome"),a=m("ff"),c=m("safari");n=function(){function b(a,c){var d=this;this.input=c;this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=a;g.applyLocal(a);a.getAttribute("tabindex")||a.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,
"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new f.GamepadSource(a,this.input);this._gamepadSource.onEvent=function(a){return d._callback("gamepad",
a)}}b.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(c){a._releasePointerCaptureSafe(c)});this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)};Object.defineProperty(b.prototype,"browserTouchPanningEnabled",{get:function(){return this._browserTouchPanningEnabled},set:function(a){this._browserTouchPanningEnabled=
a;this._updateTouchAction();this._updateTouchEventHandling()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"activeEvents",{set:function(a){var c=this,d;for(d in this._active)a&&a.has(d)||(this._element.removeEventListener(q[d],this._active[d]),delete this._active[d]);a&&a.forEach(function(a){if(!c._active[a]&&q[a]){var d=(c._eventHandlers[a]||c._handleDefault).bind(c,
a);c._element.addEventListener(q[a],d);c._active[a]=d}});this._gamepadSource.pollingEnabled=a&&a.has("gamepad")},enumerable:!0,configurable:!0});b.prototype.setPointerCapture=function(a,c){c?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):(this._releasePointerCaptureSafe(a.pointerId),this._activePointerCaptures.delete(a.pointerId))};b.prototype._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?"esri-view-surface--touch-none":
"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};b.prototype._updateTouchEventHandling=function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};b.prototype._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");this._element.classList.remove("esri-view-surface--touch-pan");
this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};b.prototype._releasePointerCaptureSafe=function(a){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(a)||this._element.releasePointerCapture(a)}catch(u){}};b.prototype._updateNormalizedPointerLikeEvent=function(a,c){a=k.createScreenPointFromNativeEvent(this._element,a);b.test.disableSubpixelCoordinates&&(a.x=Math.round(a.x),a.y=Math.round(a.y));c.x=a.x;c.y=a.y;return c};b.prototype._handleKey=function(a,
c){var d=e.eventKey(c);d&&"key-up"===a&&this._keyDownState.delete(d);c={native:c,key:d,repeat:d&&this._keyDownState.has(d)};d&&"key-down"===a&&this._keyDownState.add(c.key);this._callback(a,c)};b.prototype._handlePointer=function(a,c){c=this._updateNormalizedPointerLikeEvent(c,{native:c,x:0,y:0,pointerType:c.pointerType,button:c.button,buttons:c.buttons,eventId:this._eventId++});this._callback(a,c)};b.prototype._handlePointerPreventDefault=function(a,c){var d=this._updateNormalizedPointerLikeEvent(c,
{native:c,x:0,y:0,pointerType:c.pointerType,button:c.button,buttons:c.buttons,eventId:this._eventId++});c.preventDefault();this._callback(a,d)};b.prototype._handleMouseWheel=function(b,e){var f=e.deltaY;switch(e.deltaMode){case 0:if(l||h)f=f/document.documentElement.clientHeight*600;break;case 1:f*=30;break;case 2:f*=900}l||h?f*=.7:d||c?f*=.6:a&&(f*=1.375);var g=Math.abs(f);100<g&&(f=f/g*200/(1+Math.exp(-.02*(g-100))));e=this._updateNormalizedPointerLikeEvent(e,{native:e,x:0,y:0,deltaY:f});this._callback(b,
e)};b.prototype._handlePointerCaptureLost=function(a,c){this._activePointerCaptures.delete(c.pointerId);this._handleDefault(a,c)};b.prototype._handleDefault=function(a,c){var d={native:c};c.preventDefault();this._callback(a,d)};b.prototype._preventAltKeyDefault=function(a){"Alt"===a.key&&a.preventDefault()};b.prototype._preventMultiTouchPanning=function(a){1<a.touches.length&&a.preventDefault()};b.test={disableSubpixelCoordinates:!1};return b}();b.BrowserEventSource=n;var q={"key-down":"keydown",
"key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"}})},"esri/core/libs/pep/pep":function(){define(function(){function n(c,b){b=b||Object.create(null);var e=document.createEvent("Event");e.initEvent(c,
b.bubbles||!1,b.cancelable||!1);c=2;for(var f;c<d.length;c++)f=d[c],e[f]=b[f]||a[c];e.buttons=b.buttons||0;c=0;c=b.pressure&&e.buttons?b.pressure:e.buttons?.5:0;e.x=e.clientX;e.y=e.clientY;e.pointerId=b.pointerId||0;e.width=b.width||0;e.height=b.height||0;e.pressure=c;e.tiltX=b.tiltX||0;e.tiltY=b.tiltY||0;e.twist=b.twist||0;e.tangentialPressure=b.tangentialPressure||0;e.pointerType=b.pointerType||"";e.hwTimestamp=b.hwTimestamp||0;e.isPrimary=b.isPrimary||!1;return e}function b(){this.array=[];this.size=
0}function m(a,c,d,b){this.addCallback=a.bind(b);this.removeCallback=c.bind(b);this.changedCallback=d.bind(b);A&&(this.observer=new A(this.mutationWatcher.bind(this)))}function k(a){return"body /shadow-deep/ "+g(a)}function g(a){return'[touch-action\x3d"'+a+'"]'}function e(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; }"}function f(){if(E){C.forEach(function(a){String(a)===a?(F+=g(a)+e(a)+"\n",G&&(F+=k(a)+e(a)+"\n")):(F+=a.selectors.map(g)+e(a.rule)+"\n",G&&(F+=a.selectors.map(k)+e(a.rule)+
"\n"))});var a=document.createElement("style");a.textContent=F;document.head.appendChild(a)}}function l(a){if(!r.pointermap.has(a))throw a=Error("NotFoundError"),a.name="NotFoundError",a;}function h(a){for(var c=a.parentNode;c&&c!==a.ownerDocument;)c=c.parentNode;if(!c)throw a=Error("InvalidStateError"),a.name="InvalidStateError",a;}var d="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),a=[!1,!1,null,null,
0,0,0,0,!1,!1,!1,!1,0,null,0,0],c=window.Map&&window.Map.prototype.forEach?Map:b;b.prototype={set:function(a,c){if(void 0===c)return this.delete(a);this.has(a)||this.size++;this.array[a]=c},has:function(a){return void 0!==this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,c){return this.array.forEach(function(d,b){a.call(c,d,b,this)},this)}};var q="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),
p=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],t={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},u="undefined"!==typeof SVGElementInstance,r={pointermap:new c,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,c){var d=c.events;d&&(d.forEach(function(a){c[a]&&(this.eventMap[a]=c[a].bind(c))},this),this.eventSources[a]=c,this.eventSourceList.push(c))},register:function(a){for(var c=
this.eventSourceList.length,d=0,b;d<c&&(b=this.eventSourceList[d]);d++)b.register.call(b,a)},unregister:function(a){for(var c=this.eventSourceList.length,d=0,b;d<c&&(b=this.eventSourceList[d]);d++)b.unregister.call(b,a)},contains:function(a,c){try{return a.contains(c)}catch(da){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=
!1;this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var c=a.type;(c=this.eventMap&&
this.eventMap[c])&&c(a);a._handledByPE=!0}},listen:function(a,c){c.forEach(function(c){this.addEvent(a,c)},this)},unlisten:function(a,c){c.forEach(function(c){this.removeEvent(a,c)},this)},addEvent:function(a,c){a.addEventListener(c,this.boundHandler)},removeEvent:function(a,c){a.removeEventListener(c,this.boundHandler)},makeEvent:function(a,c){this.captureInfo[c.pointerId]&&(c.relatedTarget=null);a=new n(a,c);c.preventDefault&&(a.preventDefault=c.preventDefault);a._target=a._target||c.target;return a},
fireEvent:function(a,c){a=this.makeEvent(a,c);return this.dispatchEvent(a)},cloneEvent:function(a){for(var c=Object.create(null),d,b=0;b<q.length;b++)d=q[b],c[d]=a[d]||p[b],u&&("target"===d||"relatedTarget"===d)&&c[d]instanceof SVGElementInstance&&(c[d]=c[d].correspondingUseElement);a.preventDefault&&(c.preventDefault=function(){a.preventDefault()});return c},getTarget:function(a){var c=this.captureInfo[a.pointerId];if(!c)return a._target;if(a._target===c||!(a.type in t))return c},propagate:function(a,
c,d){for(var b=a.target,e=[];null!=b&&b!==document&&!b.contains(a.relatedTarget);)if(e.push(b),b=b.parentNode,!b)return;d&&e.reverse();e.forEach(function(d){a.target=d;c.call(this,a)},this)},setCapture:function(a,c,d){this.captureInfo[a]&&this.releaseCapture(a,d);this.captureInfo[a]=c;this.implicitRelease=this.releaseCapture.bind(this,a,d);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);var b=new n("gotpointercapture");b.pointerId=
a;b._target=c;d||this.asyncDispatchEvent(b)},releaseCapture:function(a,c){var d=this.captureInfo[a];if(d){this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",this.implicitRelease);var b=new n("lostpointercapture");b.pointerId=a;b._target=d;c||this.asyncDispatchEvent(b)}},dispatchEvent:function(a){var c=this.getTarget(a);if(c)return c.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,
a))}};r.boundHandler=r.eventHandler.bind(r);var x={shadow:function(a){if(a)return a.shadowRoot||a.webkitShadowRoot},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);if(this.canTarget(a))return a},olderShadow:function(a){var c=a.olderShadowRoot;!c&&(a=a.querySelector("shadow"))&&(c=a.olderShadowRoot);return c},allShadows:function(a){var c=[];for(a=this.shadow(a);a;)c.push(a),a=this.olderShadow(a);return c},searchRoot:function(a,c,d){if(a){var b=a.elementFromPoint(c,
d),e;for(e=this.targetingShadow(b);e;){if(a=e.elementFromPoint(c,d))return b=this.targetingShadow(a),this.searchRoot(b,c,d)||a;e=this.olderShadow(e)}return b}},owner:function(a){for(;a.parentNode;)a=a.parentNode;a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(a=document);return a},findTarget:function(a){var c=a.clientX,d=a.clientY;a=this.owner(a.target);a.elementFromPoint(c,d)||(a=document);return this.searchRoot(a,c,d)}},w=Array.prototype.forEach.call.bind(Array.prototype.forEach),
v=Array.prototype.map.call.bind(Array.prototype.map),z=Array.prototype.slice.call.bind(Array.prototype.slice),y=Array.prototype.filter.call.bind(Array.prototype.filter),A=window.MutationObserver||window.WebKitMutationObserver,B={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};m.prototype={watchSubtree:function(a){this.observer&&x.canTarget(a)&&this.observer.observe(a,B)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?
this.installOnLoad():this.installNewSubtree(a)},installNewSubtree:function(a){w(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},addElement:function(a){this.addCallback(a)},elementChanged:function(a,c){this.changedCallback(a,c)},concatLists:function(a,c){return a.concat(z(c))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===
document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var c=v(a,this.findElements,this);c.push(y(a,this.isElement));return c.reduce(this.concatLists,[])},mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,
this)):"attributes"===a.type&&this.elementChanged(a.target,a.oldValue)}};var C=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],F="",E=window.PointerEvent||window.MSPointerEvent,G=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,H=r.pointermap,D=[1,4,2,8,16],I=!1;try{I=1===(new MouseEvent("test",{buttons:1})).buttons}catch(R){}var L={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){r.listen(a,
this.events)},unregister:function(a){r.unlisten(a,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var c=this.lastTouches,d=a.clientX;a=a.clientY;for(var b=0,e=c.length,f;b<e&&(f=c[b]);b++){var h=Math.abs(a-f.y);if(25>=Math.abs(d-f.x)&&25>=h)return!0}},prepareEvent:function(a){var c=r.cloneEvent(a),d=c.preventDefault;c.preventDefault=function(){a.preventDefault();d()};c.pointerId=this.POINTER_ID;c.isPrimary=!0;c.pointerType=this.POINTER_TYPE;return c},prepareButtonsForMove:function(a,
c){var d=H.get(this.POINTER_ID);a.buttons=0!==c.which&&d?d.buttons:0;c.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=H.get(this.POINTER_ID),d=this.prepareEvent(a);I||(d.buttons=D[d.button],c&&(d.buttons|=c.buttons),a.buttons=d.buttons);H.set(this.POINTER_ID,a);c&&0!==c.buttons?r.move(d):r.down(d)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);I||this.prepareButtonsForMove(c,a);c.button=-1;H.set(this.POINTER_ID,a);r.move(c)}},
mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=H.get(this.POINTER_ID),d=this.prepareEvent(a);if(!I){var b=D[d.button];d.buttons=c?c.buttons&~b:0;a.buttons=d.buttons}H.set(this.POINTER_ID,a);d.buttons&=~D[d.button];0===d.buttons?r.up(d):r.move(d)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);I||this.prepareButtonsForMove(c,a);c.button=-1;H.set(this.POINTER_ID,a);r.enterOver(c)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=
this.prepareEvent(a);I||this.prepareButtonsForMove(c,a);c.button=-1;r.leaveOut(c)}},cancel:function(a){a=this.prepareEvent(a);r.cancel(a);this.deactivateMouse()},deactivateMouse:function(){H.delete(this.POINTER_ID)}},O=r.captureInfo,K=x.findTarget.bind(x),N=x.allShadows.bind(x),Q=r.pointermap,M,T={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){M.enableOnSubtree(a)},unregister:function(){},elementAdded:function(a){var c=a.getAttribute("touch-action"),d=this.touchActionToScrollType(c);
d&&(a._scrollType=d,r.listen(a,this.events),N(a).forEach(function(a){a._scrollType=d;r.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0;r.unlisten(a,this.events);N(a).forEach(function(a){a._scrollType=void 0;r.unlisten(a,this.events)},this)},elementChanged:function(a,c){var d=a.getAttribute("touch-action"),b=this.touchActionToScrollType(d);c=this.touchActionToScrollType(c);b&&c?(a._scrollType=b,N(a).forEach(function(a){a._scrollType=b},this)):c?this.elementRemoved(a):
b&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var c=this.scrollTypes;if("none"===a)return"none";if(a===c.XSCROLLER)return"X";if(a===c.YSCROLLER)return"Y";if(c.SCROLLER.exec(a))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(0===Q.size||1===Q.size&&Q.has(1))this.firstTouch=
a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=!1,this.cancelResetClickCount()},removePrimaryPointer:function(a){a.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var c=0;if("touchstart"===a||"touchmove"===a)c=
1;return c},touchToPointer:function(a){var c=this.currentTouchEvent,d=r.cloneEvent(a),b=d.pointerId=a.identifier+2;d.target=O[b]||K(d);d.bubbles=!0;d.cancelable=!0;d.detail=this.clickCount;d.button=0;d.buttons=this.typeToButtons(c.type);d.width=2*(a.radiusX||a.webkitRadiusX||0);d.height=2*(a.radiusY||a.webkitRadiusY||0);d.pressure=a.force||a.webkitForce||.5;d.isPrimary=this.isPrimaryTouch(a);d.pointerType=this.POINTER_TYPE;d.altKey=c.altKey;d.ctrlKey=c.ctrlKey;d.metaKey=c.metaKey;d.shiftKey=c.shiftKey;
var e=this;d.preventDefault=function(){e.scrolling=!1;e.firstXY=null;c.preventDefault()};return d},processTouches:function(a,c){var d=a.changedTouches;this.currentTouchEvent=a;a=0;for(var b;a<d.length;a++)b=d[a],c.call(this,this.touchToPointer(b))},shouldScroll:function(a){if(this.firstXY){var c;c=a.currentTarget._scrollType;if("none"===c)c=!1;else if("XY"===c)c=!0;else{a=a.changedTouches[0];var d="Y"===c?"X":"Y";c=Math.abs(a["client"+c]-this.firstXY[c])>=Math.abs(a["client"+d]-this.firstXY[d])}this.firstXY=
null;return c}},findTouch:function(a,c){for(var d=0,b=a.length,e;d<b&&(e=a[d]);d++)if(e.identifier===c)return!0},vacuumTouches:function(a){var c=a.touches;if(Q.size>=c.length){var d=[];Q.forEach(function(a,b){1===b||this.findTouch(c,b-2)||d.push(a.out)},this);d.forEach(this.cancelOut,this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){Q.set(a.pointerId,
{target:a.target,out:a,outTarget:a.target});r.enterOver(a);r.down(a)},touchmove:function(a){this.scrolling||(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var c=Q.get(a.pointerId);if(c){var d=c.out,b=c.outTarget;r.move(a);d&&b!==a.target&&(d.relatedTarget=a.target,a.relatedTarget=b,d.target=b,a.target?(r.leaveOut(d),r.enterOver(a)):(a.target=b,a.relatedTarget=null,this.cancelOut(a)));c.out=a;c.outTarget=
a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||(r.up(a),r.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){r.cancel(a);r.leaveOut(a);this.cleanUpPointer(a)},cleanUpPointer:function(a){Q.delete(a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var c=L.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},
c.push(a),c=function(a,c){c=a.indexOf(c);-1<c&&a.splice(c,1)}.bind(null,c,a),setTimeout(c,2500))}};M=new m(T.elementAdded,T.elementRemoved,T.elementChanged,T);var P=r.pointermap,S=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,V={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),register:function(a){r.listen(a,this.events)},unregister:function(a){r.unlisten(a,this.events)},
POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var c=a;S&&(c=r.cloneEvent(a),c.pointerType=this.POINTER_TYPES[a.pointerType]);return c},cleanup:function(a){P.delete(a)},MSPointerDown:function(a){P.set(a.pointerId,a);a=this.prepareEvent(a);r.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);r.move(a)},MSPointerUp:function(a){var c=this.prepareEvent(a);r.up(c);this.cleanup(a.pointerId)},MSPointerOut:function(a){a=this.prepareEvent(a);r.leaveOut(a)},MSPointerOver:function(a){a=
this.prepareEvent(a);r.enterOver(a)},MSPointerCancel:function(a){var c=this.prepareEvent(a);r.cancel(c);this.cleanup(a.pointerId)},MSLostPointerCapture:function(a){a=r.makeEvent("lostpointercapture",a);r.dispatchEvent(a)},MSGotPointerCapture:function(a){a=r.makeEvent("gotpointercapture",a);r.dispatchEvent(a)}},J,U,Y;window.navigator.msPointerEnabled?(J=function(a){l(a);h(this);0!==r.pointermap.get(a).buttons&&(r.setCapture(a,this,!0),this.msSetPointerCapture(a))},U=function(a){l(a);r.releaseCapture(a,
!0);this.msReleasePointerCapture(a)}):(J=function(a){l(a);h(this);0!==r.pointermap.get(a).buttons&&r.setCapture(a,this)},U=function(a){l(a);r.releaseCapture(a)});Y=function(a){return!!r.captureInfo[a]};var X=window.PointerEvent||window.MSPointerEvent;return{dispatcher:r,Installer:m,PointerEvent:n,PointerMap:c,targetFinding:x,applyGlobal:function(){f();window.PointerEvent||(window.PointerEvent=n,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,
enumerable:!0}),r.registerSource("ms",V)):(Object.defineProperty(window.navigator,"maxTouchPoints",{value:0,enumerable:!0}),r.registerSource("mouse",L),void 0!==window.ontouchstart&&r.registerSource("touch",T)),r.register(document));window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:J},releasePointerCapture:{value:U},hasPointerCapture:{value:Y}})},applyLocal:function(a){X||(window.PointerEvent||(window.navigator.msPointerEnabled?
r.registerSource("ms",V):(r.registerSource("mouse",L),void 0!==window.ontouchstart&&r.registerSource("touch",T)),r.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=J.bind(a),a.releasePointerCapture=U.bind(a),a.hasPointerCapture=Y.bind(a)),a.getAttribute("touch-action")||a.setAttribute("touch-action","none"))}}})},"esri/views/input/gamepad/GamepadSource":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/scheduling ./GamepadInputDevice ./GamepadState".split(" "),
function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,f){var d=this;this.element=b;this.input=f;this.handleGamepadConnectedEvent=function(a){d.handleGamepadConnected(a.gamepad)};this.handleGamepadDisconnectedEvent=function(a){a=a.gamepad;var c=d.inputDevices[a.index];c&&(d.emitGamepadEvent(a,e.extractState(c),!1),d.inputDevices[a.index]=void 0,d.latestUpdate[a.index]=void 0,d.input.gamepad.devices.remove(c))};this.frameTask=null;this.latestUpdate=[];this.inputDevices=
[];this.callback=null;if(this.supported="getGamepads"in window.navigator)this.forEachGamepad(function(a){return d.handleGamepadConnected(a)}),window.addEventListener("gamepadconnected",this.handleGamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this.handleGamepadDisconnectedEvent)}b.prototype.destroy=function(){this.pollingEnabled=!1;this.supported&&(window.removeEventListener("gamepadconnected",this.handleGamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",
this.handleGamepadDisconnectedEvent))};Object.defineProperty(b.prototype,"onEvent",{set:function(b){this.callback=b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"pollingEnabled",{set:function(b){this.supported&&(b?this.startPolling():this.stopPolling())},enumerable:!0,configurable:!0});b.prototype.handleGamepadConnected=function(b){var e=new g(b);"unknown"!==e.deviceType&&(this.inputDevices[b.index]=e,this.input.gamepad.devices.add(e))};b.prototype.startPolling=function(){var b=
this;null==this.frameTask&&(this.frameTask=k.addFrameTask({update:function(){return b.readGamepadState()}}))};b.prototype.stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=[])};b.prototype.readGamepadState=function(){var b=this,f=document.hasFocus(),d=this.element.contains(document.activeElement),a="document"===this.input.gamepad.enabledFocusMode&&!f||"view"===this.input.gamepad.enabledFocusMode&&!d;this.forEachGamepad(function(c){var d=b.inputDevices[c.index];
if(d){var f=b.latestUpdate[c.index],d=e.extractState(d),h=a||e.stateIdle(d);f&&(f.timestamp===c.timestamp||!f.active&&h||e.stateEqual(f.state,d))||b.emitGamepadEvent(c,d,!h)}})};b.prototype.forEachGamepad=function(b){for(var e=window.navigator.getGamepads(),d=0;d<e.length;d++){var a=e[d];this.validate(a)&&b(a)}};b.prototype.emitGamepadEvent=function(b,e,d){var a=this.latestUpdate[b.index];if((a=a&&a.active)||d)this.latestUpdate[b.index]={timestamp:b.timestamp,state:e,active:d},this.callback&&this.callback({device:this.inputDevices[b.index],
state:e,action:!a&&d?"start":a&&d?"update":"end"})};b.prototype.validate=function(b){if(!b||!b.connected)return!1;for(var e=0;e<b.axes.length;e++)if(isNaN(b.axes[e]))return!1;return!0};return b}();b.GamepadSource=n})},"esri/views/input/gamepad/GamepadState":function(){define(["require","exports","../../../core/mathUtils"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.extractState=function(b){var g=b.native;return{buttons:g.buttons.map(function(b){return b.pressed?b.value?b.value:
1:0}),axes:g.axes.map(function(e){var f=b.axisThreshold,l=Math.abs(e);e=l<f?0:m.sign(e)*(l-f)/(1-f);return e})}};b.stateEqual=function(b,g){if(b.axes.length!==g.axes.length||b.buttons.length!==g.buttons.length)return!1;for(var e=0;e<b.axes.length;e++)if(b.axes[e]!==g.axes[e])return!1;for(e=0;e<b.buttons.length;e++)if(b.buttons[e]!==g.buttons[e])return!1;return!0};b.stateIdle=function(b){for(var g=0;g<b.axes.length;g++)if(0!==b.axes[g])return!1;for(g=0;g<b.buttons.length;g++)if(0!==b.buttons[g])return!1;
return!0}})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){var e=b.call(this,!0)||this;e.registerIncoming("context-menu",function(b){b.data.native.preventDefault()});return e}m(e,b);return e}(k.InputHandler);b.PreventContextMenu=n;b.default=n})},"esri/views/input/recognizers/Drag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/screenUtils ../../../layers/support/timeUtils ../InputHandler ./support".split(" "),
function(n,b,m,k,g,e,f){function l(a){var c=[];a.forEach(function(a){c.push(k.createScreenPoint(a.event.x,a.event.y))});return f.fitCircleLSQ(c)}function h(c){var d=l(c),b=0;c.forEach(function(c){for(var e=a(c,d),e=e-c.lastAngle;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;e=c.lastAngle+e;c.lastAngle=e;b+=e-c.initialAngle});b/=c.size||1;return{angle:b,radius:d.radius,center:d.center}}function d(a){var c=new Map;a.forEach(function(a,d){return c.set(d,a.event)});return c}function a(a,d){a=
a.event;return Math.atan2(a.y-d.center.y,a.x-d.center.x)}Object.defineProperty(b,"__esModule",{value:!0});n=function(c){function b(a){var d=c.call(this,!1)||this;d.navigationTouch=a;d.startStateModifiers=new Set;d.activePointerMap=new Map;d.isDragging=!1;d.isCurrentDragSuppressed=!1;d.drag=d.registerOutgoing("drag");d.registerIncoming("pointer-drag",d.handlePointerDrag.bind(d));d.registerIncoming("pointer-up",d.handlePointerUpAndPointerLost.bind(d));d.registerIncoming("pointer-capture-lost",d.handlePointerUpAndPointerLost.bind(d));
d.registerIncoming("pointer-cancel",d.handlePointerUpAndPointerLost.bind(d));return d}m(b,c);b.prototype.createPayload=function(a,c,b,e){return{action:a,pointerType:this.pointerType,button:this.mouseButton,buttons:c.buttons,timestamp:e,pointers:d(this.activePointerMap),pointer:c,angle:b.angle,radius:b.radius,center:b.center}};b.prototype.addPointer=function(c){var d=c.native.pointerId,b=h(this.activePointerMap).angle;c={event:c,initialAngle:0,lastAngle:0};this.activePointerMap.set(d,c);d=a(c,l(this.activePointerMap));
c.initialAngle=d;c.lastAngle=d;this.updatePointerAngles(b)};b.prototype.updatePointer=function(a){if(!a||null!=a.x||null!=a.y){var c=this.activePointerMap.get(a.native.pointerId);c?c.event=a:this.addPointer(a)}};b.prototype.removePointer=function(a){var c=h(this.activePointerMap).angle;this.activePointerMap.delete(a);this.updatePointerAngles(c)};b.prototype.updatePointerAngles=function(c){var d=h(this.activePointerMap);this.activePointerMap.forEach(function(b){b.initialAngle=a(b,d)-c;b.lastAngle=
a(b,d)-c})};b.prototype.emitEvent=function(a,c,d){var b=h(this.activePointerMap);this.drag.emit(this.createPayload(a,c,b,d),void 0,this.startStateModifiers)};b.prototype.handlePointerUpAndPointerLost=function(a){var c=a.data.native.pointerId,d=g.Milliseconds(a.timestamp);this.activePointerMap.get(c)&&(1===this.activePointerMap.size?(this.updatePointer(a.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",a.data,d),this.isCurrentDragSuppressed=this.isDragging=!1,this.removePointer(c)):(this.removePointer(c),
this.emitEvent("removed",a.data,g.Milliseconds(a.timestamp))))};b.prototype.handlePointerDrag=function(a){var c=a.data,d=c.currentEvent,b=g.Milliseconds(a.timestamp);switch(c.action){case "start":case "update":this.isDragging?this.activePointerMap.has(d.native.pointerId)?(this.updatePointer(d),!this.isCurrentDragSuppressed&&this.emitEvent("update",d,b)):(this.addPointer(d),this.emitEvent("added",d,b),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(d),this.pointerType=a.data.startEvent.pointerType,
this.mouseButton=a.data.startEvent.button,this.startStateModifiers=a.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",d,b))}};Object.defineProperty(b.prototype,"isSuppressed",{get:function(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size},enumerable:!0,configurable:!0});return b}(e.InputHandler);b.Drag=n;(function(a){a[a.Left=0]="Left";
a[a.Middle=1]="Middle";a[a.Right=2]="Right";a[a.Back=3]="Back";a[a.Forward=4]="Forward";a[a.Undefined=-1]="Undefined"})(b.Button||(b.Button={}))})},"esri/views/input/recognizers/support":function(){define(["require","exports","../../../core/screenUtils"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.manhattanDistance=function(b,g){return Math.abs(g.x-b.x)+Math.abs(g.y-b.y)};b.euclideanDistance=function(b,g){var e=g.x-b.x;b=g.y-b.y;return Math.sqrt(e*e+b*b)};b.fitCircleLSQ=function(b,
g){g?(g.radius=0,g.center.x=0,g.center.y=0):g={radius:0,center:m.createScreenPoint()};if(0===b.length)return g;if(1===b.length)return g.center.x=b[0].x,g.center.y=b[0].y,g;if(2===b.length){var e=b[0];b=b[1];var f=[b.x-e.x,b.y-e.y],l=f[0],f=f[1];g.radius=Math.sqrt(l*l+f*f)/2;g.center.x=(e.x+b.x)/2;g.center.y=(e.y+b.y)/2;return g}for(var h=0,d=0,a=0;a<b.length;a++)h+=b[a].x,d+=b[a].y;for(var h=h/b.length,d=d/b.length,c=b.map(function(a){return a.x-h}),k=b.map(function(a){return a.y-d}),p=e=g=0,t=0,
u=l=0,a=f=0;a<c.length;a++){var r=c[a],x=k[a],w=r*r,v=x*x;g+=w;e+=v;p+=r*x;t+=w*r;l+=v*x;u+=r*v;f+=x*w}a=g;c=p;k=e;t=.5*(t+u);l=.5*(l+f);f=a*k-p*c;u=(t*k-l*c)/f;l=(a*l-p*t)/f;f=m.createScreenPoint(u+h,l+d);return{radius:Math.sqrt(u*u+l*l+(g+e)/b.length),center:f}}})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../InputHandler ./SingleAndDoubleClick ./support".split(" "),function(n,b,m,k,g,e,f){Object.defineProperty(b,
"__esModule",{value:!0});n=function(b){function h(d,a,c,f,h){void 0===d&&(d=e.DefaultParameters.maximumDoubleClickDelay);void 0===a&&(a=e.DefaultParameters.maximumDoubleClickDistance);void 0===c&&(c=e.DefaultParameters.maximumDoubleTouchDelay);void 0===f&&(f=e.DefaultParameters.maximumDoubleTouchDistance);void 0===h&&(h=k.default);var l=b.call(this,!1)||this;l.maximumDoubleClickDelay=d;l.maximumDoubleClickDistance=a;l.maximumDoubleTouchDelay=c;l.maximumDoubleTouchDistance=f;l._clock=h;l._pointerState=
new Map;l._immediateDoubleClick=l.registerOutgoing("immediate-double-click");l.registerIncoming("pointer-down",l._handlePointerDown.bind(l));l.registerIncoming("pointer-up",function(a){l._handlePointerLoss(a,"pointer-up")});l.registerIncoming("pointer-capture-lost",function(a){l._handlePointerLoss(a,"pointer-capture-lost")});l.registerIncoming("pointer-cancel",function(a){l._handlePointerLoss(a,"pointer-cancel")});return l}m(h,b);h.prototype.onUninstall=function(){this._pointerState.forEach(function(d){d.immediateDoubleClick&&
d.immediateDoubleClick.timeoutHandle.remove()});b.prototype.onUninstall.call(this)};h.prototype._handlePointerDown=function(d){d=d.data;var a=d.native.pointerId;this._pointerState.has(a)||(this._pointerState.set(a,{downButton:d.native.button,immediateDoubleClick:null}),this.startCapturingPointer(d.native))};h.prototype._handlePointerLoss=function(d,a){var c=d.data,b=this._pointerState.get(c.native.pointerId);if(b&&"pointer-up"===a&&b.downButton===c.native.button)if(a=b.immediateDoubleClick){a.timeoutHandle.remove();
var e="touch"===d.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;f.manhattanDistance(a,d.data)>e?this._startImmediateDoubleClick(d,b):(this._immediateDoubleClick.emit(d.data,void 0,a.modifiers),this._removeState(c.native))}else this._startImmediateDoubleClick(d,b)};h.prototype._startImmediateDoubleClick=function(d,a){var c=this;a.immediateDoubleClick={x:d.data.x,y:d.data.y,modifiers:d.modifiers,timeoutHandle:this._clock.setTimeout(function(){return c._removeState(d.data.native)},
"touch"===d.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}};h.prototype._removeState=function(d){this._pointerState.delete(d.pointerId);this.stopCapturingPointer(d);this.refreshHasPendingInputs()};return h}(g.InputHandler);b.ImmediateDoubleClick=n})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../../../core/MapUtils ../InputHandler ./support".split(" "),function(n,
b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});b.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};n=function(e){function h(d,a,c,f,h){void 0===d&&(d=b.DefaultParameters.maximumDoubleClickDelay);void 0===a&&(a=b.DefaultParameters.maximumDoubleClickDistance);void 0===c&&(c=b.DefaultParameters.maximumDoubleTouchDelay);void 0===f&&(f=b.DefaultParameters.maximumDoubleTouchDistance);void 0===h&&(h=k.default);
var l=e.call(this,!1)||this;l.maximumDoubleClickDelay=d;l.maximumDoubleClickDistance=a;l.maximumDoubleTouchDelay=c;l.maximumDoubleTouchDistance=f;l._clock=h;l._pointerState=new Map;l._click=l.registerOutgoing("click");l._doubleClick=l.registerOutgoing("double-click");l.registerIncoming("immediate-click",l._handleImmediateClick.bind(l));l.registerIncoming("pointer-drag",l._handlePointerDrag.bind(l));l.registerIncoming("drag",l._handleDrag.bind(l));return l}m(h,e);h.prototype.onUninstall=function(){this._pointerState.forEach(function(d){null!=
d.doubleClickTimeout&&(d.doubleClickTimeout.remove(),d.doubleClickTimeout=null)})};Object.defineProperty(h.prototype,"hasPendingInputs",{get:function(){return g.someMap(this._pointerState,function(d){return null!=d.doubleClickTimeout})},enumerable:!0,configurable:!0});h.prototype._pointerId=function(d){d=d.native;return"mouse"===d.pointerType?d.pointerId+":"+d.button:""+d.pointerType};h.prototype._handleImmediateClick=function(d){var a=d.data,c=this._pointerId(a),b=this._pointerState.get(c);if(b){var e=
"touch"===a.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;f.manhattanDistance(b.event.data,a)>e?(this._clearDoubleClickTimeout(c,!0),this._startClick(d)):(this._clearDoubleClickTimeout(c,!1),this._doubleClick.emit(b.event.data,void 0,b.event.modifiers))}else this._startClick(d)};h.prototype._startClick=function(d){var a=this,c=this._pointerId(d.data);this._pointerState.set(c,{event:d,doubleClickTimeout:this._clock.setTimeout(function(){return a._doubleClickTimeoutExceeded(c)},
"touch"===d.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};h.prototype._handlePointerDrag=function(d){d=this._pointerId(d.data.currentEvent);this._clearDoubleClickTimeout(d,!0)};h.prototype._handleDrag=function(d){d=this._pointerId(d.data.pointer);this._clearDoubleClickTimeout(d,!0)};h.prototype._clearDoubleClickTimeout=function(d,a){var c=this._pointerState.get(d);c&&(c.doubleClickTimeout.remove(),c.doubleClickTimeout=null,a&&
this._doubleClickTimeoutExceeded(d),this._pointerState.delete(d),this.refreshHasPendingInputs())};h.prototype._doubleClickTimeoutExceeded=function(d){var a=this._pointerState.get(d);this._click.emit(a.event.data,void 0,a.event.modifiers);a.doubleClickTimeout=null;this._pointerState.delete(d);this.refreshHasPendingInputs()};return h}(e.InputHandler);b.SingleAndDoubleClick=n})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../InputHandler ./support".split(" "),
function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});b.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};n=function(f){function l(e,d,a,c,l,g){void 0===e&&(e=b.DefaultParameters.maximumClickDelay);void 0===d&&(d=b.DefaultParameters.movementUntilMouseDrag);void 0===a&&(a=b.DefaultParameters.movementUntilPenDrag);void 0===c&&(c=b.DefaultParameters.movementUntilTouchDrag);void 0===l&&(l=b.DefaultParameters.holdDelay);
void 0===g&&(g=k.default);var h=f.call(this,!1)||this;h.maximumClickDelay=e;h.movementUntilMouseDrag=d;h.movementUntilPenDrag=a;h.movementUntilTouchDrag=c;h.holdDelay=l;h._clock=g;h._pointerState=new Map;h._pointerDrag=h.registerOutgoing("pointer-drag");h._immediateClick=h.registerOutgoing("immediate-click");h._pointerHold=h.registerOutgoing("hold");h.registerIncoming("pointer-down",h._handlePointerDown.bind(h));h.registerIncoming("pointer-up",function(a){h._handlePointerLoss(a,"pointer-up")});h.registerIncoming("pointer-capture-lost",
function(a){h._handlePointerLoss(a,"pointer-capture-lost")});h.registerIncoming("pointer-cancel",function(a){h._handlePointerLoss(a,"pointer-cancel")});h._moveHandle=h.registerIncoming("pointer-move",h._handlePointerMove.bind(h));h._moveHandle.pause();return h}m(l,f);l.prototype.onUninstall=function(){this._pointerState.forEach(function(b){null!=b.holdTimeout&&(b.holdTimeout.remove(),b.holdTimeout=null)});f.prototype.onUninstall.call(this)};l.prototype._handlePointerDown=function(b){var d=this,a=
b.data,c=a.native.pointerId,e=null;0===this._pointerState.size&&(e=this._clock.setTimeout(function(){var a=d._pointerState.get(c);a&&(a.isDragging||(d._pointerHold.emit(a.previousEvent,void 0,b.modifiers),a.holdEmitted=!0),a.holdTimeout=null)},this.holdDelay));e={startEvent:a,previousEvent:a,startTimestamp:b.timestamp,isDragging:!1,downButton:a.native.button,holdTimeout:e,modifiers:new Set};this._pointerState.set(c,e);this.startCapturingPointer(a.native);this._moveHandle.resume();1<this._pointerState.size&&
this.startDragging(b)};l.prototype._createPointerDragData=function(b,d,a){return{action:b,startEvent:d.startEvent,previousEvent:d.previousEvent,currentEvent:a}};l.prototype._handlePointerMove=function(b){var d=b.data,a=this._pointerState.get(d.native.pointerId);if(a){if(a.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",a,d),void 0,a.modifiers);else{var c=e.euclideanDistance(d,a.startEvent),f=this._getDragThreshold(d.native.pointerType);c>f&&this.startDragging(b)}a.previousEvent=
d}};l.prototype._getDragThreshold=function(b){switch(b){case "touch":return this.movementUntilTouchDrag;case "pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}};l.prototype.startDragging=function(b){var d=this,a=b.data,c=a.native.pointerId;this._pointerState.forEach(function(e){null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null);e.isDragging||(e.modifiers=b.modifiers,e.isDragging=!0,c===e.startEvent.native.pointerId?d._pointerDrag.emit(d._createPointerDragData("start",
e,a)):d._pointerDrag.emit(d._createPointerDragData("start",e,e.previousEvent),b.timestamp))})};l.prototype._handlePointerLoss=function(b,d){var a=b.data,c=a.native.pointerId,e=this._pointerState.get(c);e&&(null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null),e.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",e,"pointer-up"===d?a:e.previousEvent),void 0,e.modifiers):"pointer-up"===d&&e.downButton===a.native.button&&b.timestamp-e.startTimestamp<=this.maximumClickDelay&&
!e.holdEmitted&&this._immediateClick.emit(a),this._pointerState.delete(c),this.stopCapturingPointer(a.native),0===this._pointerState.size&&this._moveHandle.pause())};return l}(g.InputHandler);b.PointerClickHoldAndDrag=n})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../DragEventSeparator","../InputHandler"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(e,f){void 0===
e&&(e=20);void 0===f&&(f=40);var d=b.call(this,!1)||this;d._threshold=e;d._maxDelta=f;d.state="ready";d.emittedArtificalEnd2=!1;d._vertical=d.registerOutgoing("vertical-two-finger-drag");d._artificalDrag=d.registerOutgoing("drag");d.dragEventSeparator=new k.DragEventSeparator({start:function(a,c){return d.observeStart(a,c)},update:function(a,c,b){return d.observeUpdate(a,c,b)},end:function(a,c){return d.observeEnd(c)}});d.registerIncoming("drag",function(a){return d.dragEventSeparator.handle(a)});
return d}m(e,b);Object.defineProperty(e.prototype,"failed",{get:function(){return"failed"===this.state},enumerable:!0,configurable:!0});e.prototype.observeStart=function(b,e){1===b&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:e.data.button,buttons:e.data.buttons,pointerType:e.data.pointerType,timestamp:e.data.timestamp,pointers:e.data.pointers,pointer:e.data.pointer,angle:e.data.angle,radius:e.data.radius,center:e.data.center,artifical:!0}),
e.stopPropagation());this.state=2===b?"ready":"failed"};e.prototype.observeUpdate=function(b,e,d){"failed"!==this.state&&2===b&&("active"===this.state?(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"update"}),e.stopPropagation()):this.checkMovementWithinLimits(e.data,d.data)?this.checkVerticalThresholdReached(e.data,d.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=e.data.center,this._artificalDrag.emit({action:"end",button:e.data.button,
buttons:e.data.buttons,pointerType:e.data.pointerType,timestamp:e.data.timestamp,pointers:e.data.pointers,pointer:e.data.pointer,angle:e.data.angle,radius:e.data.radius,center:e.data.center,artifical:!0}),this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),e.stopPropagation()):this.state="failed")};e.prototype.observeEnd=function(b){"active"===this.state&&(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",
b.stopPropagation())};e.prototype.checkMovementWithinLimits=function(b,e){var d=-Infinity,a=Infinity,c=-Infinity,f=Infinity;e.pointers.forEach(function(b){d=Math.max(d,b.x);a=Math.min(a,b.x);c=Math.max(c,b.y);f=Math.min(f,b.y)});var h=-Infinity,l=Infinity,g=-Infinity,k=Infinity;b.pointers.forEach(function(a){h=Math.max(h,a.x);l=Math.min(l,a.x);g=Math.max(g,a.y);k=Math.min(k,a.y)});return Math.abs(b.center.x-e.center.x)<this._threshold&&Math.abs(h-l-(d-a))<=this._maxDelta&&Math.abs(g-k-(c-f))<=this._maxDelta};
e.prototype.checkVerticalThresholdReached=function(b,e){var d=Math.abs(b.center.y-e.center.y);b.pointers.forEach(function(a,c){c=e.pointers.get(c);d=Math.min(d,Math.abs(a.y-c.y))});return d>=this._threshold};return e}(g.InputHandler);b.VerticalTwoFingerDrag=n})},"esri/views/input/DragEventSeparator":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.callbacks=b;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=
function(){return!0})}b.prototype.handle=function(b){var g=b.data,e=g.pointers.size;switch(g.action){case "start":this.currentCount=e;this.emitStart(b);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=e;this.emitStart(b);break;case "update":this.emitUpdate(b);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=e;this.emitStart(b);break;case "end":this.emitEnd(b),this.currentCount=0}this.previousEvent=b};b.prototype.emitStart=function(b){this.startEvent=
b;this.callbacks.condition(this.currentCount,b)&&this.callbacks.start(this.currentCount,b,this.startEvent)};b.prototype.emitUpdate=function(b){this.callbacks.condition(this.currentCount,b)&&this.callbacks.update(this.currentCount,b,this.startEvent)};b.prototype.emitEnd=function(b){this.callbacks.condition(this.currentCount,b)&&this.callbacks.end(this.currentCount,b,this.startEvent);this.startEvent=null};return b}();b.DragEventSeparator=n})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/Handles ../../../../core/MapUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ./Deconflictor ./LabelDeconflictor ../../support/geometryUtils ../../../support/Scheduler".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){function q(a){a=a.layer;return!(!a||!a.featureReduction||"selection"!==a.featureReduction.type)}function p(a){(a=a.graphics3DGraphics)&&a.forEach(function(a){return a.clearVisibilityFlag(3)})}Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function u(){var a=null!==b&&b.apply(this,arguments)||this;a._handles=new g;a._contexts=new Map;a.visibilityGroup=0;a._iconMarginFactor=-.1;return a}k(u,b);Object.defineProperty(u.prototype,"labels",{get:function(){return this._labels},
enumerable:!0,configurable:!0});u.prototype.initialize=function(){var a=this;this._handles.add([this.view.watch("state.camera",function(){a.updateSlicePlane();a.setDirty()}),this.view.watch("map.ground.opacity",function(c,d){1!==c&&1!==d||a.setDirty()}),f.init(this.view,"slicePlane",function(){return a.updateSlicePlane()})]);this._frameTask=this.view.resourceController.scheduler.registerTask(c.Task.GRAPHICS_DECONFLICTOR,function(c){return a.update(c)},function(){return a.needsUpdate()});this._labels=
new d.LabelDeconflictor({view:this.view,parent:this})};u.prototype.destroy=function(){this._labels.destroy();this._labels=null;this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null)};Object.defineProperty(u.prototype,"iconMarginFactor",{get:function(){return this._iconMarginFactor},set:function(a){this._iconMarginFactor=a;this.setDirty()},enumerable:!0,configurable:!0});u.prototype.setDirty=function(){0<this._contexts.size&&(this.inherited(arguments),
this._labels.setDirty())};u.prototype.update=function(a){this.inherited(arguments,[a]);this.needsUpdate()||this._labels.setDirty()};u.prototype.setInitialIconVisibilityFlag=function(a,c){a=!(this._graphicSupportsDeconfliction(c)&&q(a));c.setVisibilityFlag(3,a,0)};u.prototype.updateSlicePlane=function(){var c=this.view&&this.view.slicePlane;c?(this.slicePlaneViewSpace||(this.slicePlaneViewSpace=a.boundedPlane.create()),a.boundedPlane.transform(c,this.view.state.camera.viewMatrix,this.slicePlaneViewSpace),
this.slicePlaneChanged()):this.slicePlaneViewSpace&&(this.slicePlaneViewSpace=null,this.slicePlaneChanged())};u.prototype.slicePlaneChanged=function(){e.someMap(this._contexts,function(a,c){return c.symbolCreationContext.slicePlaneEnabled})&&this.setDirty()};u.prototype.addGraphicsOwner=function(a){var c=this,d=this._contexts.get(a);null==d&&(d=new Map,this._contexts.set(a,d),this.setDirty());return{addGraphic:function(b){return c.addGraphic(a,d,b)},removeGraphic:function(a){return c.removeGraphic(d,
a)},labelingInfoChange:function(){return c._labels.enabledChanged(a,d)},featureReductionChange:function(){return c.enabledChanged(a,d)},slicePlaneEnabledChange:function(){return c._slicePlaneEnabledChanged(a,d)},clear:function(){return d.forEach(function(a){return c.removeGraphic(d,a.graphics3DGraphic)})}}};u.prototype.removeGraphicsOwner=function(a){var c=this,d=this._contexts.get(a);d&&(d.forEach(function(a){return c.removeGraphic(d,a.graphics3DGraphic)}),this._contexts.delete(a),this.setDirty())};
u.prototype.addGraphic=function(a,c,d){var b=d.graphic.uid;d=new h.DeconflictorGraphic(d,a.symbolCreationContext.slicePlaneEnabled);c.set(b,d);q(a)&&this.addToActiveGraphics(d);a.labelsEnabled&&this._labels.addToActiveGraphics(d)};u.prototype.removeGraphic=function(a,c){c=c.graphic.uid;var d=a.get(c);d&&(this.removeFromActiveGraphics(d),this._labels.removeFromActiveGraphics(d),a.delete(c),this.setDirty())};u.prototype.enabledChanged=function(a,c){var d=q(a);d||p(a);this.modifyGraphics(c,d)};u.prototype._slicePlaneEnabledChanged=
function(a,c){var d=a.symbolCreationContext.slicePlaneEnabled;c.forEach(function(a){return a.slicePlaneEnabled=d});this.setDirty()};u.prototype.getGraphicsLayers=function(a){return a._graphics};u.prototype._graphicSupportsDeconfliction=function(a){if(a.isDraped)return!1;a=a._graphics;if(!a||!a.length)return!1;for(var c=0;c<a.length;c++)if(this.layerSupportsDeconfliction(a[c]))return!0;return!1};return u=m([l.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],u)}(l.declared(h.Deconflictor));
b.GraphicsDeconflictor=n})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingRect ./deconflictorDebug ../../support/debugFlags ../../support/earthUtils ../../support/geometryUtils ../../support/geometryUtils/sphere ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/Util ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C){function F(a){var c,d,b,e,h;return k(this,function(l){switch(l.label){case 0:if(!Map.prototype.entries)return[3,5];c=a.entries();d=c.next();l.label=1;case 1:return d.done?[3,4]:[4,d.value[1]];case 2:l.sent(),l.label=3;case 3:return d=c.next(),[3,1];case 4:return[3,9];case 5:b=f.valuesOfMap(a),e=0,h=b,l.label=6;case 6:if(!(e<h.length))return[3,9];d=h[e];return[4,d];case 7:l.sent(),l.label=8;case 8:return e++,[3,6];case 9:return[2]}})}function E(a,
c,d){var b,e;return k(this,function(f){switch(f.label){case 0:return c.clear(),a.forEach(function(a,b){var e=c.pushNew();e.id=b;e.prio=a.info?a.info[d].posView:Number.MAX_VALUE}),[4];case 1:f.sent(),b=c.iterableSort(function(a,c){return c.prio-a.prio}),e=b.next(),f.label=2;case 2:return e.done?[3,5]:[4];case 3:f.sent(),f.label=4;case 4:return e=b.next(),[3,2];case 5:return c.forEach(function(c){var d=a.get(c.id);d&&(a.delete(c.id),a.set(c.id,d))}),c.clear(),[2]}})}Object.defineProperty(b,"__esModule",
{value:!0});var G=t.vec4f64.create(),H=t.vec4f64.create(),D=t.vec4f64.create(),I=t.vec4f64.create(),L=v.sphere.create(),O=v.ray.create(),K=p.vec3f64.create(),N=u.create(),Q=u.create(),M=function(){return function(){this.posView=this.yMax=this.yMin=this.xMax=this.xMin=0;this.visible=this.culled=!1}}();n=function(){return function(a,c,d){void 0===d&&(d={});this.graphics3DGraphic=a;this.slicePlaneEnabled=c;this.info=d}}();b.DeconflictorGraphic=n;var T=function(){function a(){this.active=new Map;this.visible=
new Map}a.prototype.clear=function(){this.active.clear();this.visible.clear()};return a}(),P=function(){return function(){}}(),S=function(){return function(){this.sortArray=new d({allocator:function(a){return a||new P}})}}();e=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a._dirty=!1;a._state=0;a.graphics=new T;a.iterators=new S;a.accBinsNumX=15;a.accBinsNumY=20;a.accBinsSizeX=0;a.accBinsSizeY=0;a.accBins=null;a.accNumTests=0;return a}m(b,c);Object.defineProperty(b.prototype,
"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0});b.prototype.destroy=function(){this.graphics.clear();this.iterators=null};b.prototype.setDirty=function(){!this._dirty&&0<this.graphics.active.size&&(this._dirty=!0,this.notifyChange("updating"))};Object.defineProperty(b.prototype,"updating",{get:function(){return 0!==this._state||this._dirty},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"updatingProgress",{get:function(){if(!this.updating)return 1;var a=this._state/4;return this._dirty?.5*a:a},enumerable:!0,configurable:!0});b.prototype.needsUpdate=function(){return this.view.ready&&null!=this.view.state&&this.updating};b.prototype.update=function(a){switch(this._state){case 0:this.startUpdate(),a.madeProgress();case 1:if(this._state=1,!this.processActiveGraphics(a))break;case 2:if(this._state=2,!this.sortVisibleGraphics(a))break;case 3:if(this._state=
3,!this.deconflictVisibleGraphics(a))break;default:r.drawAccelerationStruct(this,this.graphics.visible),this._state=0,this.notifyChange("updating")}};b.prototype.modifyGraphics=function(a,c){var d=this;c?a.forEach(function(a){return d.addToActiveGraphics(a)}):a.forEach(function(a){return d.removeFromActiveGraphics(a)});this.setDirty()};b.prototype.layerSupportsDeconfliction=function(a){if(h.isNone(a)||"object3d"!==a.type)return!1;a=a.stageObject;return 1===(a?a.getNumGeometryRecords():0)&&a.getGeometryRecord(0).material instanceof
B?!0:!1};b.prototype.startUpdate=function(){r.prepare(this.view);this._dirty=!1;this.camera=this.view.state.camera;this.initBins(this.camera.fullWidth,this.camera.fullHeight);this.resetIterators()};b.prototype.addToActiveGraphics=function(a){a.info[this.visibilityGroup]=new M;this.graphics.active.set(a.graphics3DGraphic.graphic.uid,a);this.setDirty()};b.prototype.removeFromActiveGraphics=function(a){this.removeFromVisibleGraphics(a);var c=a.graphics3DGraphic;c.destroyed||c.clearVisibilityFlag(3,this.visibilityGroup);
delete a.info[this.visibilityGroup];this.graphics.active.delete(a.graphics3DGraphic.graphic.uid);this.setDirty()};b.prototype.addToVisibleGraphics=function(a){this.graphics.visible.set(a.graphics3DGraphic.graphic.uid,a)};b.prototype.removeFromVisibleGraphics=function(a){this.graphics.visible.delete(a.graphics3DGraphic.graphic.uid)};b.prototype.processActiveGraphics=function(a){for(var c=this.ensureActiveGraphicsIterator(),d="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this.camera&&
0<this.camera.relativeElevation;!a.done;){a.madeProgress();var b=c.next();if(b.done)return this.resetActiveGraphicsIterator(),!0;var e=(b=b.value)&&b.info[this.visibilityGroup];e&&(this.collectGraphics3DGraphics(b,d),e.culled?this.removeFromVisibleGraphics(b):this.addToVisibleGraphics(b))}return!1};b.prototype.sortVisibleGraphics=function(a){for(var c=this.ensureSortGraphicsIterator();!a.done;){var d=c.next();a.madeProgress();if(d.done)return this.resetSortGraphicsIterator(),!0}return!1};b.prototype.deconflictVisibleGraphics=
function(a){for(var c=this.ensureVisibleGraphicsIterator(),d=1===this.visibilityGroup;!a.done;){a.madeProgress();var b=c.next();if(b.done)return this.resetVisibleGraphicsIterator(),!0;var b=b.value,e=b.info[this.visibilityGroup];if(e&&!e.culled){var f=b.graphics3DGraphic;(f=(!d||f.isVisible())&&!this.isConflicted(b))&&this.addToBins(b);e.visible=f;this.setGraphicVisibility(b,f);r.drawPoly(e,f)}}return!1};b.prototype.resetIterators=function(){this.iterators.active=null;this.iterators.visible=null;
this.iterators.sort=null};b.prototype.ensureActiveGraphicsIterator=function(){this.iterators.active||(this.iterators.active=F(this.graphics.active));return this.iterators.active};b.prototype.resetActiveGraphicsIterator=function(){this.iterators.active=null};b.prototype.ensureVisibleGraphicsIterator=function(){this.iterators.visible||(this.iterators.visible=F(this.graphics.visible));return this.iterators.visible};b.prototype.resetVisibleGraphicsIterator=function(){this.iterators.visible=null};b.prototype.ensureSortGraphicsIterator=
function(){this.iterators.sort||(this.iterators.sort=E(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup));return this.iterators.sort};b.prototype.resetSortGraphicsIterator=function(){this.iterators.sort=null};b.prototype.collectGraphics3DGraphics=function(a,c){var d=a.graphics3DGraphic;if(!d.destroyed){var b=a.info[this.visibilityGroup];if(d.isVisible(0,3)){for(var d=this.getGraphicsLayers(d),e=this.iconMarginFactor,f=this.camera,h=u.empty(N),g,k,m=0;m<d.length;m++){var r=d[m];
if(this.layerSupportsDeconfliction(r)){var t=r.stageObject,n=t.getGeometryRecord(0),B=n.material;if(c&&(L.radius=w.earthRadius,q.vec3.sub(O.direction,t.getCenter(),f.eye),q.vec3.copy(O.origin,f.eye),z.intersectRay(L,O,K))){var F=1-Math.abs(Math.tan(q.vec3.angle(t.getCenter(),O.direction)))/this.view.width,F=Math.pow(F,4),E=q.vec3.sqrDist(f.eye,K),M=q.vec3.sqrDist(f.eye,t.getCenter());if(F*M>E){b.culled=!0;return}}if(!k){k=t.getCenter();F=n.origin.vec3;C.transformToWorld(k,F,G);C.transformToView(G,
F,f.viewMatrix,H);k=n.geometry.data.getVertexAttr();B.applyVerticalOffsetTransformation(H,k[A.VertexAttrConstants.NORMAL].data,t.objectTransformation,f,V);if(a.slicePlaneEnabled&&this.slicePlaneViewSpace&&v.boundedPlane.extrusionContainsPoint(this.slicePlaneViewSpace,H)){b.culled=!0;return}t=k[A.VertexAttrConstants.AUXPOS1].data;n="screen"!==B.getParameters().centerOffsetUnits;C.transformToProjection(H,f.projectionMatrix,n?t:p.vec3f64.ZEROS,D);k=C.transformToNDC(D,I);n||(k[0]+=t[0]/f.fullWidth*2,
k[1]+=t[1]/f.fullHeight*2);if(-1>k[0]||-1>k[1]||-1>k[2]||1<=k[0]||1<=k[1])break;g=H[2];!x.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET&&b.visible&&(g*=.7)}r=r.getScreenSize(J);r[0]*=f.pixelRatio;r[1]*=f.pixelRatio;y.applyPrecomputedScaleFactorVec2(r,V.factor,r);B=u.offset(B.calculateRelativeScreenBounds(r,V.factorAlignment.scale,Q),l.lerp(0,f.fullWidth,.5+.5*k[0]),l.lerp(0,f.fullHeight,.5+.5*k[1]));0!==e&&(r=e*Math.min(u.width(B),u.height(B)),B[0]-=r,B[1]-=r,B[2]+=r,B[3]+=r);u.expand(h,B)}}null==g?b.culled=
!0:(b.xMin=h[0],b.yMin=h[1],b.xMax=h[2],b.yMax=h[3],b.posView=g,b.culled=!1)}else b.culled=!0}};b.prototype.isConflicted=function(a){var c=a.graphics3DGraphic.graphic.uid;a=a.info[this.visibilityGroup];for(var d=Math.floor(a.xMin/this.accBinsSizeX);d<=Math.floor(a.xMax/this.accBinsSizeX);d++)if(!(0>d||d>=this.accBinsNumX))for(var b=Math.floor(a.yMin/this.accBinsSizeY);b<=Math.floor(a.yMax/this.accBinsSizeY);b++)if(!(0>b||b>=this.accBinsNumY))for(var e=this.accBins[d][b],f=0;f<e.length;f++){var h=
e.data[f],l=h.info[this.visibilityGroup];if(l&&l.visible&&h.graphics3DGraphic.graphic.uid!==c&&(this.accNumTests++,!(l.xMin>a.xMax||l.xMax<a.xMin||l.yMin>a.yMax||l.yMax<a.yMin)))return!0}return!1};b.prototype.initBins=function(a,c){if(null==this.accBins){this.accBins=[];for(var b=0;b<this.accBinsNumX;b++){this.accBins.push([]);for(var e=this.accBins[this.accBins.length-1],f=0;f<this.accBinsNumY;f++)e.push(new d)}}else for(b=0;b<this.accBinsNumX;b++)for(f=0;f<this.accBinsNumY;f++)this.accBins[b][f].clear();
this.accBinsSizeX=a/this.accBinsNumX;this.accBinsSizeY=c/this.accBinsNumY;this.accNumTests=0};b.prototype.addToBins=function(a){for(var c=a.info[this.visibilityGroup],d=Math.floor(c.xMax/this.accBinsSizeX),b=Math.floor(c.yMin/this.accBinsSizeY),e=Math.floor(c.yMax/this.accBinsSizeY),c=Math.floor(c.xMin/this.accBinsSizeX);c<=d;c++)if(!(0>c||c>=this.accBinsNumX))for(var f=b;f<=e;f++)0>f||f>=this.accBinsNumY||this.accBins[c][f].push(a)};b.prototype.setGraphicVisibility=function(a,c){a=a.graphics3DGraphic;
a.destroyed||(a.setVisibilityFlag(3,c,this.visibilityGroup),1===this.visibilityGroup&&this.view.labeler.setLabelGraphicVisibility(a,c))};g([a.property({constructOnly:!0})],b.prototype,"view",void 0);g([a.property({type:Boolean,readOnly:!0})],b.prototype,"updating",null);return b=g([a.subclass("esri.views.3d.layers.graphics.Deconflictor")],b)}(a.declared(e));b.Deconflictor=e;var V={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},
J=c.vec2f64.create()})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/debugFlags"],function(n,b,m,k){function g(b,e,f,h,l){d&&(d(),d=null);var g=a.height,k=c;k.beginPath();k.lineWidth=1;k.strokeStyle=l;k.moveTo(b,g-f);k.lineTo(e,g-f);k.stroke();k.lineTo(e,g-h);k.stroke();k.lineTo(e,g-f);k.stroke();k.lineTo(b,g-f);k.stroke();k.lineTo(b,g-f);k.stroke();k.closePath()}Object.defineProperty(b,"__esModule",
{value:!0});var e=!1,f=!1,l=!1,h=!1,d=null,a,c;b.drawAccelerationStruct=function(a,b){if(f&&c){d&&(d(),d=null);for(var e=c,h=0,l=0;l<a.accBinsNumX;l++)for(var k=0;k<a.accBinsNumY;k++){var p=a.accBins[l][a.accBinsNumY-1-k],h=h+p.length,m=l*a.accBinsSizeX,q=(l+1)*a.accBinsSizeX,y=k*a.accBinsSizeY,A=(k+1)*a.accBinsSizeY;e.fillText(p.length.toFixed(),m+5,y+15);g(m,q,y,A,"blue")}e.fillText("total totalShownLabels: "+h,70,40);e.fillText("total visible labels: "+b.size,70,50);e.fillText("total numTests: "+
a.accNumTests,70,30)}};b.prepare=function(b){l=k.DECONFLICTOR_SHOW_OUTLINES;h=k.DECONFLICTOR_SHOW_OUTLINES_INVISIBLE;e=l||h;f=k.DECONFLICTOR_SHOW_GRID;d=null;e||f?d=function(){null==a&&(a=document.createElement("canvas"),a.setAttribute("id","canvas2d"),b.surface.parentElement.style.position="relative",b.surface.parentElement.appendChild(a));var d=b.height*b.pixelRatio;a.setAttribute("width",b.width*b.pixelRatio+"px");a.setAttribute("height",d+"px");a.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:"+
b.width+"px;height:"+b.height+"px");c=a.getContext("2d");c.clearRect(0,0,b.width,b.height);c.font="12px Arial"}:a&&(a.parentElement.removeChild(a),a=null)};b.drawPoly=function(a,c){e&&(c&&l||!c&&h)&&g(a.xMin,a.xMax,a.yMin,a.yMax,c?"green":"red")}})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(n,b,m,k,g,e){return new (function(b){function f(){var e=
null!==b&&b.apply(this,arguments)||this;e.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;e.SCENEVIEW_LOCKING_LOG=!1;e.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;e.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;e.DECONFLICTOR_SHOW_OUTLINES=!1;e.DECONFLICTOR_SHOW_OUTLINES_INVISIBLE=!1;e.DECONFLICTOR_SHOW_GRID=!1;e.LABELS_SHOW_BORDER=!1;e.OVERLAY_DRAW_DEBUG_TEXTURE=!1;e.OVERLAY_SHOW_CENTER=!1;e.TERRAIN_DEBUG_POPUP=!1;e.TESTS_DISABLE_UPDATE_THRESHOLDS=!1;e.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1;e.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=
!1;e.DRAW_MESH_GEOMETRY_NORMALS=!1;e.FEATURE_TILE_FETCH_SHOW_TILES=!1;e.FEATURE_TILE_TREE_SHOW_TILES=!1;e.I3S_TREE_SHOW_TILES=!1;e.ENABLE_PROFILE_DEPTH_RANGE=!1;e.DISABLE_FAST_UPDATES=!1;e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;e.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;return e}m(f,b);k([e.property()],f.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);k([e.property()],f.prototype,"SCENEVIEW_LOCKING_LOG",void 0);k([e.property()],f.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",
void 0);k([e.property()],f.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);k([e.property()],f.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);k([e.property()],f.prototype,"DECONFLICTOR_SHOW_OUTLINES_INVISIBLE",void 0);k([e.property()],f.prototype,"DECONFLICTOR_SHOW_GRID",void 0);k([e.property()],f.prototype,"LABELS_SHOW_BORDER",void 0);k([e.property()],f.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);k([e.property()],f.prototype,"OVERLAY_SHOW_CENTER",void 0);k([e.property()],f.prototype,"TERRAIN_DEBUG_POPUP",
void 0);k([e.property()],f.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0);k([e.property()],f.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);k([e.property()],f.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);k([e.property()],f.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);k([e.property()],f.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);k([e.property()],f.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);k([e.property()],f.prototype,"I3S_TREE_SHOW_TILES",void 0);
k([e.property()],f.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);k([e.property()],f.prototype,"DISABLE_FAST_UPDATES",void 0);k([e.property()],f.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);k([e.property()],f.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);k([e.property()],f.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);return f=k([e.subclass("esri.views.3d.support.DebugFlags")],f)}(e.declared(g)))})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require",
"exports","../../../../core/mathUtils","../../support/earthUtils"],function(n,b,m,k){function g(a){return Math.abs(a*a*a)}function e(a,b,d,e){void 0===e&&(e=c);var f=d.parameters;d=d.paddingPixelsOverride;e.scale=Math.min(f.divisor/(b-f.offset),1);e.factor=g(a);e.minPixelSize=f.minPixelSize;e.paddingPixels=d;return e}function f(a,c){return 0===a?c.minPixelSize:c.minPixelSize*(1+2*c.paddingPixels/a)}function l(a,c){return Math.max(m.lerp(a*c.scale,a,c.factor),f(a,c))}function h(a,c,b){a=e(a,c,b);a.minPixelSize=
0;a.paddingPixels=0;return l(1,a)}Object.defineProperty(b,"__esModule",{value:!0});b.getSettings=function(a){return new d(a,b.defaultDescription)};b.getLabelSettings=function(c){var e=b.defaultDescription.curvatureDependent;return new d(c,{curvatureDependent:{min:{curvature:e.min.curvature,tiltAngle:e.min.tiltAngle,scaleFallOffFactor:a.curvatureDependent.min.scaleFallOffFactor},max:{curvature:e.max.curvature,tiltAngle:e.max.tiltAngle,scaleFallOffFactor:a.curvatureDependent.max.scaleFallOffFactor}},
scaleStart:b.defaultDescription.scaleStart,scaleFallOffRange:b.defaultDescription.scaleFallOffRange,minPixelSize:a.minPixelSize})};b.perspectiveFactor=g;b.scaleFactor=e;b.applyScaleFactor=l;b.applyScaleFactorVec2=function(a,c,b){void 0===b&&(b=[0,0]);var d=Math.min(Math.max(c.scale,f(a[1],c)/a[1]),1);b[0]=m.lerp(a[0]*d,a[0],c.factor);b[1]=m.lerp(a[1]*d,a[1],c.factor);return b};b.precomputeScale=h;b.precomputeScaleFactor=function(a,c,b,d){d.scale=h(a,c,b);d.factor=0;d.minPixelSize=b.parameters.minPixelSize;
d.paddingPixels=b.paddingPixelsOverride;return d};b.applyPrecomputedScaleFactorVec2=function(a,c,b){void 0===b&&(b=[0,0]);c=Math.min(Math.max(c.scale,f(a[1],c)/a[1]),1);b[0]=a[0]*c;b[1]=a[1]*c;return b};b.scale=function(a,c,b,d){return l(a,e(c,b,d))};var d=function(){function a(a,c,b,d){void 0===b&&(b={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});this.viewingMode=a;this.description=c;this.parameters=b;this._paddingPixelsOverride=d;"local"===this.viewingMode?(this.coverageCompensation=
this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(a.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0});a.prototype.update=function(a){if(this.parameters&&
this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===a.distance)return!1;this.calculateParameters(a,this.parameters);return!0};a.prototype.overridePadding=function(c){return c!==this.paddingPixelsOverride?new a(this.viewingMode,this.description,this.parameters,c):this};a.prototype.calculateParameters=function(a,c){var b=this.description,d=b.scaleStart,e=b.scaleFallOffRange,b=b.minPixelSize,f=a.fovY,h=a.distance,l=this.calculateCurvatureDependentParameters(a),g=this.coverageCompensation(a,
l),k=l.tiltAngle,l=l.scaleFallOffFactor,h=Math.sin(k)*h,k=.5*Math.PI-k-f*(.5-d*g),d=h/Math.cos(k),e=(d-h/Math.cos(k+f*e*g)*l)/(1-l);c.camera.fovY=a.fovY;c.camera.distance=a.distance;c.offset=e;c.divisor=d-e;c.minPixelSize=b;return c};a.prototype.calculateCurvatureDependentParametersLocal=function(a,c){void 0===c&&(c=q);c.tiltAngle=this.description.curvatureDependent.min.tiltAngle;c.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;return c};a.prototype.calculateCurvatureDependentParametersGlobal=
function(a,c){void 0===c&&(c=q);var b=this.description.curvatureDependent;a=1+a.distance/k.earthRadius;var d=[b.min.curvature,b.max.curvature],e=d[0];a=m.clamp((Math.sqrt(a*a-1)-e)/(d[1]-e),0,1);d=[b.min,b.max];b=d[0];d=d[1];c.tiltAngle=m.lerp(b.tiltAngle,d.tiltAngle,a);c.scaleFallOffFactor=m.lerp(b.scaleFallOffFactor,d.scaleFallOffFactor,a);return c};a.prototype.surfaceCoverageCompensationLocal=function(a,c){return(a.fovY-c.tiltAngle)/a.fovY};a.prototype.surfaceCoverageCompensationGlobal=function(a,
c){var b=k.earthRadius*k.earthRadius;c=c.tiltAngle+.5*Math.PI;var d=a.fovY;a=a.distance;a=a*a+b-2*Math.cos(c)*a*k.earthRadius;var e=Math.sqrt(a);return(Math.acos(Math.sqrt(a-b)/e)-Math.asin(k.earthRadius/(e/Math.sin(c)))+.5*d)/d};return a}();b.defaultDescription={curvatureDependent:{min:{curvature:m.deg2rad(10),tiltAngle:m.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:m.deg2rad(70),tiltAngle:m.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var a={curvatureDependent:{min:{scaleFallOffFactor:.7},
max:{scaleFallOffFactor:.95}},minPixelSize:14};b.copyParameters=function(a,c){c.camera.distance=a.camera.distance;c.camera.fovY=a.camera.fovY;c.divisor=a.divisor;c.offset=a.offset;c.minPixelSize=a.minPixelSize;return c};var c={scale:0,factor:0,minPixelSize:0,paddingPixels:0},q={tiltAngle:0,scaleFallOffFactor:0}})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/geometryDataUtils ../lib/GLMaterialTexture ../lib/Material ../lib/screenSizePerspectiveUtils ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/HUDMaterial.glsl ../shaders/HUDMaterialTechnique".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E){function G(a,c,b,d,e,f,h,l){c=c-e-(0<l[0]?d[0]*l[0]:0);var g=c+d[0]+2*e;b=b-e-(0<l[1]?d[1]*l[1]:0);e=b+d[1]+2*e;h.textureIsSignedDistanceField&&(h=h.distanceFieldBoundingBox,c+=d[0]*h[0],b+=d[1]*h[1],g-=d[0]*(1-h[2]),e-=d[1]*(1-h[3]),c-=f,g+=f,b-=f,e+=f);return a[0]>c&&a[0]<g&&a[1]>b&&a[1]<e}n=function(a){function b(c,b){b=a.call(this,b)||this;b.techniqueConfig=new E.HUDMaterialTechniqueConfiguration;b.params=B.copyParameters(c,aa);return b}
m(b,a);b.prototype.dispose=function(){};b.prototype.setParameterValues=function(a){for(var c in a)"textureId"===c&&y.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[c]=a[c];this.parametersChanged()};b.prototype.getParameters=function(){return this.params};b.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.verticalOffset=!!this.params.verticalOffset;
this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0;this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset;this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField;this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled;this.techniqueConfig.vvColor=!!this.params.vvColorEnabled;0===a&&(this.techniqueConfig.debugDrawBorder=
!!this.params.debugDrawBorder);4===a&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion);this.techniqueConfig.depthEnabled=this.params.depthEnabled;return this.techniqueConfig};b.prototype.intersect=function(a,c,b,d,e,f,h,l,g){g?this.intersectDrapedHudGeometry(a,f,h,l):this.intersectHudGeometry(a,c,b,d,h,l)};b.prototype.intersectDrapedHudGeometry=function(a,c,b,d){var e=a.getAttribute(y.VertexAttrConstants.POSITION),f=a.getAttribute(y.VertexAttrConstants.SIZE),h=
this.params,l=F.calculateAnchorPosForRendering(h),g=1,k=1;d&&(k=d(J),g=k[0],k=k[5]);g*=a.pixelRatio;k*=a.pixelRatio;d=Y*a.pixelRatio;for(var p=0;p<e.data.length/e.size;p++){var m=p*e.size,q=e.data[m],m=e.data[m+1],r=p*f.size;X[0]=f.data[r]*g;X[1]=f.data[r+1]*k;r=void 0;h.textureIsSignedDistanceField&&(r=h.outlineSize*a.pixelRatio/2);G(c,q,m,X,d,r,h,l)&&b()}};b.prototype.intersectHudGeometry=function(a,b,d,f,h,g){if(f.options.selectionMode&&f.options.hud&&!r.isAllHidden(b.componentVisibilities,a.componentOffsets)){var k=
a.data;a=this.params;var p=b=1;e.mat3.fromMat4(T,d);if(g){p=g(J);b=p[0];p=p[5];g=T;var m=g[0],u=g[1],t=g[2],v=g[3],x=g[4],w=g[5],A=g[6],n=g[7],B=g[8],C=1/Math.sqrt(m*m+u*u+t*t),E=1/Math.sqrt(v*v+x*x+w*w),L=1/Math.sqrt(A*A+n*n+B*B);g[0]=m*C;g[1]=u*C;g[2]=t*C;g[3]=v*E;g[4]=x*E;g[5]=w*E;g[6]=A*L;g[7]=n*L;g[8]=B*L}g=k.getVertexAttr()[y.VertexAttrConstants.POSITION];m=k.getVertexAttr()[y.VertexAttrConstants.SIZE];u=k.getVertexAttr()[y.VertexAttrConstants.NORMAL];k=k.getVertexAttr()[y.VertexAttrConstants.AUXPOS1];
y.assert(3<=g.size);t=f.point;v=f.camera;x=F.calculateAnchorPosForRendering(a);b*=v.pixelRatio;p*=v.pixelRatio;w="screen"===this.params.centerOffsetUnits;for(A=0;A<g.data.length/g.size;A++)n=A*g.size,c.vec3.set(O,g.data[n],g.data[n+1],g.data[n+2]),c.vec3.transformMat4(O,O,d),n=A*m.size,X[0]=m.data[n]*b,X[1]=m.data[n+1]*p,c.vec3.transformMat4(O,O,v.viewMatrix),n=A*k.size,c.vec3.set(S,k.data[n+0],k.data[n+1],k.data[n+2]),w||(O[0]+=S[0],O[1]+=S[1],0!==S[2]&&(n=S[2],c.vec3.normalize(S,O),c.vec3.subtract(O,
O,c.vec3.scale(S,S,n)))),n=A*u.size,c.vec3.set(K,u.data[n],u.data[n+1],u.data[n+2]),this.applyVerticalOffsetTransformation(O,K,T,v,I),v.applyProjection(O,N),-1<N[0]&&(n=Math.floor(N[0])+this.params.screenOffset[0],B=Math.floor(N[1])+this.params.screenOffset[1],w&&(n+=S[0],0!==S[1]&&(B+=z.applyScaleFactor(S[1],I.factorAlignment))),z.applyPrecomputedScaleFactorVec2(X,I.factor,X),C=U*v.pixelRatio,E=void 0,a.textureIsSignedDistanceField&&(E=a.outlineSize*v.pixelRatio/2),G(t,n,B,X,C,E,a,x)&&(B=f.ray,c.vec3.transformMat4(M,
O,l.mat4.invert(P,v.viewMatrix)),N[0]=t[0],N[1]=t[1],v.unprojectPoint(N,O),n=q.vec3f64.create(),c.vec3.copy(n,B.direction),C=1/c.vec3.length(n),c.vec3.scale(n,n,C),B=c.vec3.distance(B.origin,O)*C,h(B,n,-1,1,!0,M)))}};b.prototype.computeAttachmentOrigin=function(a,c){a=a.data;var b="getVertexAttr"in a?a.getVertexAttr():"vertexAttr"in a?a.vertexAttr:null;if(!b)return null;var d=y.VertexAttrConstants.POSITION,b=b[d];a="getIndices"in a?a.getIndices(d):"indices"in a?a.indices[d]:null;return x.computeAttachmentOriginPoints(b,
a,c)};b.prototype.createBufferWriter=function(){return new ca(this)};b.prototype.createRenderer=function(a,c){return new C(a,c,this)};b.prototype.normalAndViewAngle=function(a,b,d,e){void 0===e&&(e=V);c.vec3.transformMat3(e.normal,a,b);c.vec3.transformMat4(e.normal,e.normal,d.viewInverseTransposeMatrix);e.cosAngle=c.vec3.dot(Q,R);return e};b.prototype.updateScaleInfo=function(a,c){var b=this.params;b.screenSizePerspective?a.factor=z.precomputeScaleFactor(V.cosAngle,c,b.screenSizePerspective,a.factor):
(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=0,a.factor.paddingPixels=0);b.screenSizePerspectiveAlignment?a.factorAlignment=z.precomputeScaleFactor(V.cosAngle,c,b.screenSizePerspectiveAlignment,a.factorAlignment):(a.factorAlignment.factor=a.factor.factor,a.factorAlignment.scale=a.factor.scale,a.factorAlignment.minPixelSize=a.factor.minPixelSize,a.factorAlignment.paddingPixels=a.factor.paddingPixels)};b.prototype.applyVerticalOffsetTransformation=function(a,b,d,f,h,l){var g=this.params;
p.isMat4(d)&&(d=e.mat3.fromMat4(T,d));if(!g.verticalOffset||!g.verticalOffset.screenLength)return h&&(g.screenSizePerspective||g.screenSizePerspectiveAlignment)?(f=c.vec3.length(a),this.updateScaleInfo(h,f)):h&&(h.factor.scale=1,h.factorAlignment.scale=1),l?c.vec3.copy(l,a):a;b=this.normalAndViewAngle(b,d,f);d=c.vec3.length(a);f=B.verticalOffsetAtDistance(f,d,g.verticalOffset,b.cosAngle,g.screenSizePerspectiveAlignment||g.screenSizePerspective);h&&this.updateScaleInfo(h,d);return c.vec3.add(l||a,
a,c.vec3.scale(b.normal,b.normal,f))};b.prototype.getGLMaterial=function(a){if(0===a.output)return new H(a);if(4===a.output)return new D(a)};b.prototype.calculateRelativeScreenBounds=function(a,c,b){void 0===b&&(b=t.create());var e=this.params,f=b;void 0===f&&(f=L);d.vec2.copy(f,e.anchorPos);f[0]*=-a[0];f[1]*=-a[1];f[0]+=e.screenOffset[0]*c;f[1]+=e.screenOffset[1]*c;b[2]=b[0]+a[0];b[3]=b[1]+a[1];return b};b.shouldRenderVisibilityDuringRenderPass=function(a){return 0===a||4};return b}(v.Material);
b=function(a){function c(c){c=a.call(this,w.makeCtorParameters(c,c.material.getParameters()))||this;c.updateParameters();return c}m(c,a);c.prototype.beginSlot=function(a){return a===(this.params.drawInSecondSlot?19:18)};c.prototype.updateParameters=function(){this.params=B.copyParameters(this.material.getParameters());this.updateTexture(this.params.textureId);this.selectProgram()};c.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(E.HUDMaterialTechnique,
this.material.getTechniqueConfig(this.output),this.technique)};c.prototype.bind=function(a,c){a.bindProgram(this.technique.program);this.bindTexture(a,this.technique.program);this.bindTextureScale(a,this.technique.program);this.technique.bindPass(a,this.params,c)};return c}(w);var H=function(a){function c(c){c=a.call(this,k({},c,{output:0}))||this;c.isOcclusionSlot=!1;return c}m(c,a);c.prototype.beginSlot=function(a){var c=this.params.drawInSecondSlot?19:18;if(this.params.occlusionTest)return this.isOcclusionSlot=
12===a,12===a||a===c;this.isOcclusionSlot=!1;return a===c};c.prototype.getTechnique=function(){return this.isOcclusionSlot?this.occlusionTechnique:this.technique};c.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(E.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique);this.occlusionTechnique=this.techniqueRep.acquireAndReleaseExisting(E.HUDMaterialTechnique,this.material.getTechniqueConfig(6),this.occlusionTechnique)};c.prototype.bind=
function(a,c){var b=this.getTechnique();a.bindProgram(b.program);this.isOcclusionSlot||(this.bindTexture(a,b.program),this.bindTextureScale(a,b.program));b.bindPass(a,this.params,c)};return c}(b),D=function(a){function c(c){return a.call(this,k({},c,{output:4}))||this}m(c,a);return c}(b),I={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},L=a.vec2f64.create(),O=q.vec3f64.create(),K=q.vec3f64.create(),N=g.createRenderScreenPointArray3(),
Q=q.vec3f64.create(),M=q.vec3f64.create(),T=f.mat3f64.create(),P=h.mat4f64.create(),S=q.vec3f64.create(),V={normal:Q,cosAngle:0},J=h.mat4f64.create(),U=1,Y=2,X=[0,0],R=q.vec3f64.fromValues(0,0,1),aa={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,
1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:a.vec2f64.fromValues(.5,.5),shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,debugDrawBorder:!1},da=u.newLayout().vec3f(y.VertexAttrConstants.POSITION).vec3f(y.VertexAttrConstants.NORMAL).vec2f(y.VertexAttrConstants.UV0).vec4u8(y.VertexAttrConstants.COLOR).vec2f(y.VertexAttrConstants.SIZE).vec4f(y.VertexAttrConstants.AUXPOS1).vec4f(y.VertexAttrConstants.AUXPOS2),
ca=function(){function a(a){this.material=a;this.vertexBufferLayout=da}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return 6*a.indices[y.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,c,b,d){A.writePosition(c.indices[y.VertexAttrConstants.POSITION],c.vertexAttr[y.VertexAttrConstants.POSITION].data,a.transformation,b.position,d,6);A.writeNormal(c.indices[y.VertexAttrConstants.NORMAL],c.vertexAttr[y.VertexAttrConstants.NORMAL].data,
a.invTranspTransformation,b.normal,d,6);a=c.vertexAttr[y.VertexAttrConstants.UV0].data;var e=void 0,f=void 0,h=void 0,l=void 0;null==a||4>a.length?(a=this.material.getParameters(),f=e=0,h=a.texCoordScale[0],l=a.texCoordScale[1]):(e=a[0],f=a[1],h=a[2],l=a[3]);var h=Math.min(1.99999,h+1),l=Math.min(1.99999,l+1),g=c.indices[y.VertexAttrConstants.POSITION].length,k=b.uv0;a=d;for(var p=0;p<g;++p)k.set(a,0,e),k.set(a,1,f),a+=1,k.set(a,0,h),k.set(a,1,f),a+=1,k.set(a,0,h),k.set(a,1,l),a+=1,k.set(a,0,h),k.set(a,
1,l),a+=1,k.set(a,0,e),k.set(a,1,l),a+=1,k.set(a,0,e),k.set(a,1,f),a+=1;A.writeColor(c.indices[y.VertexAttrConstants.COLOR],c.vertexAttr[y.VertexAttrConstants.COLOR].data,4,b.color,d,6);e=c.indices[y.VertexAttrConstants.SIZE];f=c.vertexAttr[y.VertexAttrConstants.SIZE].data;h=e.length;l=b.size;a=d;for(p=0;p<h;++p)for(var g=f[2*e[p]],k=f[2*e[p]+1],m=0;6>m;++m)l.set(a,0,g),l.set(a,1,k),a+=1;c.indices[y.VertexAttrConstants.AUXPOS1]&&c.vertexAttr[y.VertexAttrConstants.AUXPOS1]&&A.writeBufferVec4(c.indices[y.VertexAttrConstants.AUXPOS1],
c.vertexAttr[y.VertexAttrConstants.AUXPOS1].data,b.auxpos1,d,6);c.indices[y.VertexAttrConstants.AUXPOS2]&&c.vertexAttr[y.VertexAttrConstants.AUXPOS2]&&A.writeBufferVec4(c.indices[y.VertexAttrConstants.AUXPOS2],c.vertexAttr[y.VertexAttrConstants.AUXPOS2].data,b.auxpos2,d,6)};return a}();return n})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["require","exports"],function(n,b){function m(b){return b instanceof Float32Array&&16<=b.length}function k(b){return Array.isArray(b)&&16<=b.length}
Object.defineProperty(b,"__esModule",{value:!0});b.isMat4f32=m;b.isMat4f64=k;b.isMat4=function(b){return m(b)||k(b)}})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ./DefaultTextureUnits ./GLMaterial ../materials/internal/MaterialUtil".split(" "),function(n,b,m,k,g,e,f){n=function(b){function e(d){var a=b.call(this,d)||this,c=d.textureRep;a.textureRep=c;a.textureId=d.textureId;
a.initTransparent=!!d.initTextureTransparent;var e=function(b){return f.acquireIfNotUndefined(b,c,a.initTransparent)};a.glTextureRef=e(a.textureId);d.normalTextureId&&(a.glTextureRefNormal=e(d.normalTextureId));d.emissiveTextureId&&(a.glTextureRefEmission=e(d.emissiveTextureId));d.occlusionTextureId&&(a.glTextureRefOcclusion=e(d.occlusionTextureId));d.metallicRoughnessTextureId&&(a.glTextureRefRoughnessMetallness=e(d.metallicRoughnessTextureId));return a}k(e,b);e.prototype.dispose=function(){f.releaseIfNotUndefined(this.textureId,
this.textureRep)};e.prototype.updateTexture=function(b){b!==this.textureId&&(f.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=b,this.glTextureRef=f.acquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))};e.prototype.bindTexture=function(b,a){null!=this.glTextureRef&&(a.setUniform1i("tex",g.DefaultTextureUnits.DIFFUSE),b.bindTexture(this.glTextureRef.glTexture,g.DefaultTextureUnits.DIFFUSE));this.glTextureRefNormal&&(a.setUniform1i("normalTexture",g.DefaultTextureUnits.NORMAL),
b.bindTexture(this.glTextureRefNormal.glTexture,g.DefaultTextureUnits.NORMAL));this.glTextureRefEmission&&(a.setUniform1i("texEmission",g.DefaultTextureUnits.EMISSION),b.bindTexture(this.glTextureRefEmission.glTexture,g.DefaultTextureUnits.EMISSION));this.glTextureRefOcclusion&&(a.setUniform1i("texOcclusion",g.DefaultTextureUnits.OCCLUSION),b.bindTexture(this.glTextureRefOcclusion.glTexture,g.DefaultTextureUnits.OCCLUSION));this.glTextureRefRoughnessMetallness&&(a.setUniform1i("texMetallicRoughness",
g.DefaultTextureUnits.METALLIC_ROUGHNESS),b.bindTexture(this.glTextureRefRoughnessMetallness.glTexture,g.DefaultTextureUnits.METALLIC_ROUGHNESS))};e.prototype.bindTextureScale=function(b,a){(b=this.glTextureRef&&this.glTextureRef.glTexture)&&b.descriptor.textureCoordinateScaleFactor?a.setUniform2fv("textureCoordinateScaleFactor",b.descriptor.textureCoordinateScaleFactor):a.setUniform2f("textureCoordinateScaleFactor",1,1)};return e}(e.GLMaterial);(function(b){b.makeCtorParameters=function(b,d){return m({},
b,d)}})(n||(n={}));return n})},"esri/views/3d/webgl-engine/lib/DefaultTextureUnits":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.DefaultTextureUnits={DIFFUSE:0,NORMAL:1,EMISSION:2,OCCLUSION:3,METALLIC_ROUGHNESS:4,SSAO:6,SHADOW_MAP:7}})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ./AutoDisposable".split(" "),
function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(e){var d=b.call(this)||this;d.material=e.material;d.techniqueRep=e.techniqueRep;d.output=e.output;return d}m(e,b);e.prototype.getTechnique=function(){return this.technique};e.prototype.getPipelineState=function(b,d){return this.getTechnique().pipeline};e.prototype.ensureResources=function(b){return 2};e.prototype.ensureParameters=function(b){};return e=k([g.subclass("esri.views.3d.webgl-engine.lib.GLMaterial")],
e)}(g.declared(e.AutoDisposable));b.GLMaterial=n})},"esri/views/3d/webgl-engine/lib/AutoDisposable":function(){define(["require","exports","../../../../core/tsSupport/declareExtendsHelper","../../../../core/tsSupport/decorateHelper","../../../../core/accessorSupport/decorators"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.AutoDisposableMixin=function(b){return function(b){function e(){var e=null!==b&&b.apply(this,arguments)||this;e._isDisposed=!1;return e}m(e,b);e.prototype.dispose=
function(){for(var b=this.__proto__.__managedDisposables__||[],d=b.length-1;0<=d;d--){var a=b[d];this[a]&&"function"===typeof this[a].dispose&&this[a].dispose();this[a]=null}this._isDisposed=!0};Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0});return e=k([g.subclass("esri.views.3d.webgl-engine.lib.AutoDisposableMixin")],e)}(g.declared(b))};n=function(b){function e(){return null!==b&&b.apply(this,arguments)||this}m(e,b);return e=
k([g.subclass("esri.views.3d.webgl-engine.lib.AutoDisposable")],e)}(g.declared(b.AutoDisposableMixin(function(){return function(){}}())));b.AutoDisposable=n;b.autoDispose=function(){return function(b,f){b.__managedDisposables__=b.__managedDisposables__||[];b.__managedDisposables__.push(f)}}})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4 ../../../../../geometry/support/aaBoundingBox ../../lib/ComponentUtils ../../lib/screenSizePerspectiveUtils ../../lib/Util".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){function t(c,b,d,e,f,h){var l=x(b,d,F);a.setMin(B,c.getBBMin());a.setMax(B,c.getBBMax());g.isSome(f)&&f.applyToAABB(B);if(w(B,b,l,e)){var l=c.getPrimitiveIndices(),k=c.getIndices(),p=c.getPosition(),m=l?l.length:k.length/3;if(m>I&&(c=c.getChildren(),void 0!==c)){for(l=0;8>l;++l)void 0!==c[l]&&t(c[l],b,d,e,f,h);return}u(b,d,0,m,k,p,l,f,h)}}function u(a,c,b,d,e,f,h,l,k){var p,m,q;if(h){var u,t,v=f.data,y=f.offsetIdx;f=f.strideIdx;var x=a[0],w=a[1];a=a[2];var z=
c[0]-x,A=c[1]-w;for(c=c[2]-a;b<d;++b){var n=h[b],B=3*n;t=y+f*e[B++];var C=v[t++],K=v[t++];p=v[t];t=y+f*e[B++];var F=v[t++];m=v[t++];u=v[t];t=y+f*e[B];B=v[t++];q=v[t++];t=v[t];g.isSome(l)&&(p=l.applyToVertex(C,K,p),C=p[0],K=p[1],p=p[2],u=l.applyToVertex(F,m,u),F=u[0],m=u[1],u=u[2],t=l.applyToVertex(B,q,t),B=t[0],q=t[1],t=t[2]);F-=C;m-=K;u-=p;B-=C;q-=K;t-=p;var O=A*t-q*c,N=c*B-t*z,L=z*q-B*A,I=F*O+m*N+u*L;if(!(Math.abs(I)<=E)){C=x-C;K=w-K;p=a-p;O=C*O+K*N+p*L;if(0<I){if(0>O||O>I)continue}else if(0<O||
O<I)continue;N=K*u-m*p;p=p*F-u*C;K=C*m-F*K;C=z*N+A*p+c*K;if(0<I){if(0>C||O+C>I)continue}else if(0<C||O+C<I)continue;K=(B*N+q*p+t*K)/I;0<=K&&(F=r(F,m,u,B,q,t,G),k(K,F,n))}}}else for(h=f.data,v=f.offsetIdx,y=f.strideIdx,f=a[0],x=a[1],w=a[2],a=c[0]-f,z=c[1]-x,A=c[2]-w,c=b,b*=3;c<d;++c)if(q=v+y*e[b++],C=h[q++],K=h[q++],p=h[q],q=v+y*e[b++],n=h[q++],F=h[q++],m=h[q],q=v+y*e[b++],u=h[q++],B=h[q++],q=h[q],g.isSome(l)&&(p=l.applyToVertex(C,K,p),C=p[0],K=p[1],p=p[2],m=l.applyToVertex(n,F,m),n=m[0],F=m[1],m=
m[2],q=l.applyToVertex(u,B,q),u=q[0],B=q[1],q=q[2]),n-=C,F-=K,m-=p,u-=C,B-=K,q-=p,I=z*q-B*A,O=A*u-q*a,N=a*B-u*z,t=n*I+F*O+m*N,!(Math.abs(t)<=E)){C=f-C;K=x-K;p=w-p;I=C*I+K*O+p*N;if(0<t){if(0>I||I>t)continue}else if(0<I||I<t)continue;O=K*m-F*p;p=p*n-m*C;K=C*F-n*K;C=a*O+z*p+A*K;if(0<t){if(0>C||I+C>t)continue}else if(0<C||I+C<t)continue;K=(u*O+B*p+q*K)/t;0<=K&&(n=r(n,F,m,u,B,q,G),k(K,n,c))}}function r(a,c,b,d,e,f,h){l.vec3.set(H,a,c,b);l.vec3.set(D,d,e,f);l.vec3.cross(h,H,D);l.vec3.normalize(h,h);return h}
function x(a,c,b){return l.vec3.set(b,1/(c[0]-a[0]),1/(c[1]-a[1]),1/(c[2]-a[2]))}function w(a,c,b,d){return v(a,c,b,d,Infinity)}function v(a,c,b,d,e){var f=(a[0]-d-c[0])*b[0],h=(a[3]+d-c[0])*b[0],l=Math.min(f,h),f=Math.max(f,h),h=(a[1]-d-c[1])*b[1],g=(a[4]+d-c[1])*b[1],f=Math.min(f,Math.max(h,g));if(0>f)return!1;l=Math.max(l,Math.min(h,g));if(l>f)return!1;h=(a[2]-d-c[2])*b[2];a=(a[5]+d-c[2])*b[2];f=Math.min(f,Math.max(h,a));if(0>f)return!1;l=Math.max(l,Math.min(h,a));return l>f?!1:l<e}function z(a,
c){c=c?z(c):{};for(var b in a){var d=a[b];d&&d.forEach&&(d=y(d));null==d&&b in c||(c[b]=d)}return c}function y(a){var c=[];a.forEach(function(a){return c.push(a)});return c}Object.defineProperty(b,"__esModule",{value:!0});var A=f.mat4f64.create(),B=a.create(),C=p.VertexAttrConstants;b.intersectTriangleGeometry=function(b,d,e,f,h,l,k){d=d&&d.componentVisibilities;e=e.tolerance;if(1<b.componentCount)a:{var m=x(f,h,F),q=b.componentCount,r=b.componentOffsets,v=b.getIndices(C.POSITION),y=b.getAttribute(C.POSITION),
z=b.boundingInfo;if(z&&(a.setMin(B,z.getBBMin()),a.setMax(B,z.getBBMax()),g.isSome(l)&&l.applyToAABB(B),!w(B,f,m,e)))break a;for(z=0;z<q;z++)if(!d||c.getVisibility(d,z)){if(b.getComponentAABB){var A=b.getComponentAABB(z,B);g.isSome(l)&&l.applyToAABB(A);if(!w(A,f,m,e))continue}u(f,h,r[z]/3,r[z+1]/3,v,y,void 0,l,k)}}else if(!d||c.getVisibility(d,0))b.boundingInfo?(p.assert("triangle"===b.data.primitiveType),t(b.boundingInfo,f,h,e,l,k)):(d=b.getIndices(C.POSITION),b=b.getAttribute(C.POSITION),u(f,h,
0,d.length/3,d,b,void 0,l,k))};var F=h.vec3f64.create(),E=Math.pow(2,-52),G=h.vec3f64.create();b.intersectTriangles=u;var H=h.vec3f64.create(),D=h.vec3f64.create();b.computeNormal=r;b.computeInvDir=x;b.intersectAabbInvDir=w;b.intersectAabbInvDirBefore=v;b.transformToWorld=function(a,c,b){return d.vec4.set(b,a[0]-c[0],a[1]-c[1],a[2]-c[2],1)};b.transformToView=function(a,c,b,f){e.mat4.translate(A,b,c);return d.vec4.transformMat4(f,a,A)};b.transformToProjection=function(a,c,b,e){e[0]=a[0]+b[0];e[1]=
a[1]+b[1];e[2]=a[2]+b[2];e[3]=a[3];return d.vec4.transformMat4(e,e,c)};b.transformToNDC=function(a,c){return d.vec4.scale(c,a,1/Math.abs(a[3]))};b.verticalOffsetAtDistance=function(a,c,b,d,e){var f=(b.screenLength||0)*a.pixelRatio;e&&(f=q.scale(f,d,c,e));return k.glClamp(f*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*c,b.minWorldLength||0,null!=b.maxWorldLength?b.maxWorldLength:Infinity)};b.acquireIfNotUndefined=function(a,c,b){if(void 0!==a)return c.acquire(a,b)};b.releaseIfNotUndefined=function(a,c){void 0!==
a&&c.release(a)};b.bindScreenSizePerspective=function(a,c,b){void 0===b&&(b="screenSizePerspectiveAlignment");if(a){var d=a.parameters;c.setUniform4f(b,d.divisor,d.offset,d.minPixelSize,a.paddingPixelsOverride)}};b.copyParameters=z;b.updateParameters=function(a,c){var b=!1,d;for(d in c){var e=c[d];void 0!==e&&(b=!0,Array.isArray(e)?a[d]=e.slice():a[d]=e)}return b};b.intersectDrapedRenderLineGeometry=function(a,c,b,d,e){if(c.options.selectionMode){c=a.getAttribute(C.POSITION).data;var f=a.getAttribute(C.SIZE),
h=b[0];b=b[1];a=(((f&&f.data[0])+d)/2+4)*a.pixelRatio;d=Number.MAX_VALUE;for(f=0;f<c.length-5;f+=3){var l=c[f],g=c[f+1],p=h-l,m=b-g,l=c[f+3]-l,g=c[f+4]-g,q=k.clamp((l*p+g*m)/(l*l+g*g),0,1),p=l*q-p,m=g*q-m,m=p*p+m*m;m<d&&(d=m)}d<a*a&&e()}};b.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var I=1E3})},"esri/views/3d/webgl-engine/lib/Material":function(){define(["require","exports","../../../../core/maybe","./IdGen"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(e){this.supportsEdges=
!1;this._visible=!0;this._renderOccluded=1;this._renderPriority=0;this.id=b._idGen.gen(e)}b.prototype.dispose=function(){};b.prototype.update=function(b){return!1};Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},set:function(b){b!==this._visible&&(this._visible=b,this.parametersChanged())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(b){b!==this._renderOccluded&&(this._renderOccluded=
b,this.parametersChanged())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(b){b!==this._renderPriority&&(this._renderPriority=b,this.parametersChanged())},enumerable:!0,configurable:!0});b.prototype.isVisibleInPass=function(b){return!0};b.prototype.isVisible=function(){return this._visible};b.prototype.parametersChanged=function(){m.isSome(this.materialRepository)&&this.materialRepository.materialChanged(this)};
b._idGen=new k.IdGen;return b}();b.Material=n;b.materialPredicate=function(b,e){return b.isVisible()&&b.isVisibleInPass(e.pass)&&0!==(b.renderOccluded&e.renderOccludedMask)}})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["require","exports","../../../support/buffer/BufferView","../../lib/Util"],function(n,b,m,k){function g(a,c,b,d,e){var f=b.typedBuffer;b=b.typedBufferStride;var h=a.length;d*=b;if(null==e||1===e)for(var l=0;l<h;++l){var g=2*a[l];f[d]=c[g];
f[d+1]=c[g+1];d+=b}else for(l=0;l<h;++l)for(var g=2*a[l],k=0;k<e;++k)f[d]=c[g],f[d+1]=c[g+1],d+=b}function e(a,c,b,d,e){var f=b.typedBuffer;b=b.typedBufferStride;var h=a.length;d*=b;if(null==e||1===e)for(var l=0;l<h;++l){var g=3*a[l];f[d]=c[g];f[d+1]=c[g+1];f[d+2]=c[g+2];d+=b}else for(l=0;l<h;++l)for(var g=3*a[l],k=0;k<e;++k)f[d]=c[g],f[d+1]=c[g+1],f[d+2]=c[g+2],d+=b}function f(a,c,b,d,e){var f=b.typedBuffer;b=b.typedBufferStride;var h=a.length;d*=b;if(null==e||1===e)for(var l=0;l<h;++l){var g=4*
a[l];f[d]=c[g];f[d+1]=c[g+1];f[d+2]=c[g+2];f[d+3]=c[g+3];d+=b}else for(l=0;l<h;++l)for(var g=4*a[l],k=0;k<e;++k)f[d]=c[g],f[d+1]=c[g+1],f[d+2]=c[g+2],f[d+3]=c[g+3],d+=b}function l(a,c,b,d,f,h){if(b){var l=d.typedBuffer;d=d.typedBufferStride;var g=a.length;f*=d;if(null==h||1===h)for(var k=0;k<g;++k){var p=3*a[k],m=c[p],q=c[p+1],u=c[p+2];l[f]=b[0]*m+b[4]*q+b[8]*u+b[12];l[f+1]=b[1]*m+b[5]*q+b[9]*u+b[13];l[f+2]=b[2]*m+b[6]*q+b[10]*u+b[14];f+=d}else for(k=0;k<g;++k)for(var p=3*a[k],m=c[p],q=c[p+1],u=c[p+
2],p=b[0]*m+b[4]*q+b[8]*u+b[12],t=b[1]*m+b[5]*q+b[9]*u+b[13],m=b[2]*m+b[6]*q+b[10]*u+b[14],q=0;q<h;++q)l[f]=p,l[f+1]=t,l[f+2]=m,f+=d}else e(a,c,d,f,h)}function h(a,c,b,d,f,h){if(b){var l=d.typedBuffer;d=d.typedBufferStride;var g=a.length,k=b[0],p=b[1],m=b[2],q=b[4],u=b[5],t=b[6],n=b[8],F=b[9];b=b[10];var E=1E-5<Math.abs(1-k*k+q*q+n*n)||1E-5<Math.abs(1-p*p+u*u+F*F)||1E-5<Math.abs(1-m*m+t*t+b*b);f*=d;if(null==h||1===h)for(var G=0;G<g;++G){var H=3*a[G],D=c[H],I=c[H+1],L=c[H+2];h=k*D+q*I+n*L;var H=p*
D+u*I+F*L,O=m*D+t*I+b*L;E&&(D=h*h+H*H+O*O,.999999>D&&1E-6<D&&(D=Math.sqrt(D),h/=D,H/=D,O/=D));l[f+0]=h;l[f+1]=H;l[f+2]=O;f+=d}else for(G=0;G<g;++G)for(H=3*a[G],D=c[H],I=c[H+1],L=c[H+2],H=k*D+q*I+n*L,O=p*D+u*I+F*L,I=m*D+t*I+b*L,E&&(D=H*H+O*O+I*I,.999999>D&&1E-6<D&&(D=Math.sqrt(D),H/=D,O/=D,I/=D)),D=0;D<h;++D)l[f+0]=H,l[f+1]=O,l[f+2]=I,f+=d}else e(a,c,d,f,h)}function d(a,c,b,d,e,f){var h=d.typedBuffer;d=d.typedBufferStride;var l=a.length;e*=d;if(null==f||1===f)if(4===b)for(b=0;b<l;++b){var g=4*a[b];
h[e]=c[g];h[e+1]=c[g+1];h[e+2]=c[g+2];h[e+3]=c[g+3];e+=d}else{if(3===b)for(b=0;b<l;++b)g=3*a[b],h[e]=c[g],h[e+1]=c[g+1],h[e+2]=c[g+2],h[e+3]=255,e+=d}else if(4===b)for(b=0;b<l;++b)for(var g=4*a[b],k=0;k<f;++k)h[e]=c[g],h[e+1]=c[g+1],h[e+2]=c[g+2],h[e+3]=c[g+3],e+=d;else if(3===b)for(b=0;b<l;++b)for(g=3*a[b],k=0;k<f;++k)h[e]=c[g],h[e+1]=c[g+1],h[e+2]=c[g+2],h[e+3]=255,e+=d}Object.defineProperty(b,"__esModule",{value:!0});b.writeBufferVec2=g;b.writeBufferVec3=e;b.writeBufferVec4=f;b.writeBufferMat3f=
function(a,c,b,d){var e=b.typedBuffer;b=b.typedBufferStride;var f=a.length;d*=b;for(var h=0;h<f;++h){for(var l=9*a[h],g=0;9>g;++g)e[d+g]=c[l+g];d+=b}};b.writeBufferMat4f=function(a,c,b,d){var e=b.typedBuffer;b=b.typedBufferStride;var f=a.length;d*=b;for(var h=0;h<f;++h){for(var l=16*a[h],g=0;16>g;++g)e[d+g]=c[l+g];d+=b}};b.writePosition=l;b.writeNormal=h;b.writeColor=d;b.writeMultipliedColor=function(a,c,b,d,e,f,h){var l=e.typedBuffer;e=e.typedBufferStride;var g=a.length;f*=e;if(null==h||1===h)if(4===
b)for(b=0;b<g;++b){var k=4*a[b];l[f]=c[k]*d[0];l[f+1]=c[k+1]*d[1];l[f+2]=c[k+2]*d[2];l[f+3]=c[k+3]*d[3];f+=e}else{if(3===b){var p=255*d[3];for(b=0;b<g;++b)k=3*a[b],l[f]=c[k]*d[0],l[f+1]=c[k+1]*d[1],l[f+2]=c[k+2]*d[2],l[f+3]=p,f+=e}}else if(4===b)for(b=0;b<g;++b)for(var k=4*a[b],m=0;m<h;++m)l[f]=c[k]*d[0],l[f+1]=c[k+1]*d[1],l[f+2]=c[k+2]*d[2],l[f+3]=c[k+3]*d[3],f+=e;else if(3===b)for(p=255*d[3],b=0;b<g;++b)for(k=3*a[b],m=0;m<h;++m)l[f]=c[k]*d[0],l[f+1]=c[k+1]*d[1],l[f+2]=c[k+2]*d[2],l[f+3]=p,f+=e};
b.writeDefaultAttributes=function(a,c,b,e,t,u){var p=0;for(c=c.fieldNames;p<c.length;p++){var q=c[p],w=a.vertexAttr[q],v=a.indices[q];if(w&&v)switch(q){case k.VertexAttrConstants.POSITION:k.assert(3===w.size);(q=t.getField(q,m.BufferViewVec3f))&&l(v,w.data,b,q,u);break;case k.VertexAttrConstants.NORMAL:k.assert(3===w.size);(q=t.getField(q,m.BufferViewVec3f))&&h(v,w.data,e,q,u);break;case k.VertexAttrConstants.UV0:k.assert(2===w.size);(q=t.getField(q,m.BufferViewVec2f))&&g(v,w.data,q,u);break;case k.VertexAttrConstants.REGION:k.assert(4===
w.size);(q=t.getField(q,m.BufferViewVec4u16))&&f(v,w.data,q,u);break;case k.VertexAttrConstants.COLOR:k.assert(3===w.size||4===w.size);(q=t.getField(q,m.BufferViewVec4u8))&&d(v,w.data,w.size,q,u);break;case k.VertexAttrConstants.SYMBOLCOLOR:k.assert(3===w.size||4===w.size);(q=t.getField(q,m.BufferViewVec4u8))&&d(v,w.data,w.size,q,u);break;case k.VertexAttrConstants.TANGENT:k.assert(4===w.size),(q=t.getField(q,m.BufferViewVec4f))&&f(v,w.data,q,u)}}}})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("require exports ../../../../../core/MapUtils ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ../../lib/IntervalUtilities ../../lib/ResizableFloat32Array ../../lib/Util ../WaterGLMaterial ./Instance ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r){function x(a,c,b,d){for(var e=new Map,f=c.vertexBufferLayout.stride/4,h=function(b,d){var h=b.origin,l=a.get(h.id),g=e.get(h.id);null==g&&(g={optimalCount:null==l?0:l.optimalCount,sparseCount:null==l?0:l.buffer.size,toAdd:[],toRemove:[],origin:h.vec3},e.set(h.id,g));h=c.elementCount(b.data)*f;d?(g.optimalCount+=h,g.sparseCount+=h,g.toAdd.push(b)):(g.optimalCount-=h,g.toRemove.push(b))},l=0;l<b.length;l++){var g=b[l];h(g,!0)}for(b=0;b<d.length;b++)g=d[b],
h(g,!1);return e}n=function(){function b(a,c,b,d){void 0===d&&(d=l.Default3D);this.type="MergedRenderer";this._dataByOrigin=new Map;this._highlightCount=0;this._hasOccludees=!1;this._rctx=a;this._vertexAttributeLocations=d;this._material=b;this._materialRep=c;this._glMaterials=p.acquireMaterials(this._material,this._materialRep);this._bufferWriter=b.createBufferWriter()}b.prototype.dispose=function(){p.releaseMaterials(this._material,this._materialRep)};Object.defineProperty(b.prototype,"isEmpty",
{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return 0<this._highlightCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasOccludees",{get:function(){return this._hasOccludees},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasWater",{get:function(){return!this.isEmpty&&m.someMap(this._glMaterials,function(a){return a instanceof c.WaterGLMaterial})},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"rendersOccluded",{get:function(){return!this.isEmpty&&1!==this._material.renderOccluded},enumerable:!0,configurable:!0});b.prototype.modify=function(a){var c=this,b=A;b.clear();this.updateGeometries(a.toUpdate,b);this.addAndRemoveGeometries(a.toAdd,a.toRemove,b);this.updateHighlightCount();this.updateOccludeeFlag();b.forEach(function(a){return c.updateDisplayedIndexRanges(a)})};b.prototype.addAndRemoveGeometries=function(c,b,d){var e=this,f=this._bufferWriter,
h=f.vertexBufferLayout,l=h.stride/4,g=this._dataByOrigin,k=x(g,f,c,b);k.forEach(function(c,b){k.delete(b);var f=c.optimalCount,p=c.sparseCount,m=g.get(b);null==m&&(a.assert(0<f),m=e.createData(h,f,c.origin),g.set(b,m));if(0===f)m.vao.dispose(!0),m.vao=null,g.delete(b);else{var q=f<c.sparseCount/2;b=w;var r=m.buffer.size,u=m.buffer.array,f=m.buffer.resize(q?f:p,!1);q||f?e.removeAndRebuild(m,c.toRemove,l,u,b):0<c.toRemove.length?(e.removeByErasing(m,c.toRemove,l,b),0<c.toAdd.length&&(b.end=r)):(b.begin=
r,b.end=r);f=v;a.setMatrixTranslation3(f,-c.origin[0],-c.origin[1],-c.origin[2]);e.append(m,c.toAdd,l,f,b);c=m.vao.vertexBuffers.geometry;c.byteSize!==m.buffer.array.buffer.byteLength?c.setData(m.buffer.array):(p=b.begin,f=b.end,p<f&&(p*=4,c.setSubData(m.buffer.array,p,p,4*f)));(b.updatedDisplayedIndexRange||m.displayedIndexRanges)&&d.add(m)}})};b.prototype.updateGeometries=function(c,b){for(var d=this._bufferWriter,e=d.vertexBufferLayout.stride/4,f=0;f<c.length;f++){var h=c[f],l=h.updateType,h=h.renderGeometry,
g=this._dataByOrigin.get(h.origin.id),k=g&&g.instances.get(h.uniqueName);if(!k)break;l&1&&(k.isHidden=p.checkIsHidden(h),b.add(g));l&9&&(k.highlightedIndexRanges=p.generateRenderGeometryHighlightRanges(h),g.highlightCount=null);l&16&&(k.hasOccludees=!!h.instanceParameters.occludees);l&6&&(l=g.buffer.array,g=g.vao,p.calculateTransformRelToOrigin(h,z,y),d.write({transformation:z,invTranspTransformation:y},h.data,d.vertexBufferLayout.createView(l.buffer),k.from),a.assert(k.from+d.elementCount(h.data)===
k.to,"material VBO layout has changed"),g.vertexBuffers.geometry.setSubData(l,k.from*e*4,k.from*e*4,k.to*e*4))}};b.prototype.updateDisplayedIndexRanges=function(a){a.displayedIndexRanges=[];var c=!0;a.instances.forEach(function(b){b.isHidden?c=!1:a.displayedIndexRanges.push([b.from,b.to-1])});a.displayedIndexRanges=c?null:h.mergeIntervals(a.displayedIndexRanges)};b.prototype.updateHighlightCount=function(){var a=this;this._highlightCount=0;this._dataByOrigin.forEach(function(c){if(null==c.highlightCount){var b=
0;c.instances.forEach(function(a){a.highlightedIndexRanges&&++b});c.highlightCount=b}a._highlightCount+=c.highlightCount})};b.prototype.updateOccludeeFlag=function(){this._hasOccludees=m.someMap(this._dataByOrigin,function(a){a.hasOccludees=m.someMap(a.instances,function(a){return a.hasOccludees});return a.hasOccludees})};b.prototype.updateLogic=function(a){return this._material.update(a)};b.prototype.render=function(a,c,b,d){var f=this,h=this._rctx,l=this._glMaterials.get(c.pass),g=4===c.pass,k=
a;2===c.pass&&null===k&&(k=22);if(!l||2!==l.ensureResources(h)||null!=k&&!l.beginSlot(k)||g&&0===this._highlightCount)return!1;l.ensureParameters(b);var p=l.getTechnique(),m=l.getPipelineState(k,!1);h.setPipelineState(m);l.bind(h,b);p.program.setUniformMatrix4fv("model",e.mat4f64.IDENTITY);p.program.hasUniform("modelNormal")&&p.program.setUniformMatrix4fv("modelNormal",e.mat4f64.IDENTITY);var q=!1;this._dataByOrigin.forEach(function(a){if(!g||0!==a.highlightCount)if(b.origin=a.origin,p.bindDraw(b),
p.ensureAttributeLocations(a.vao),h.bindVAO(a.vao),g)q=f.renderHighlightPass(p,a,d)||q;else if(a.hasOccludees){var c=l.getPipelineState(k,!0);q=f.renderDefaultPassWithOccludees(p,a,m,c,d)||q}else q=f.renderDefaultPass(p,a,d)||q});return q};b.prototype.renderDefaultPass=function(a,c,b){var d=this._rctx,e=c.displayedIndexRanges;if(e&&0===e.length)return!1;e?p.drawArraysFaceRange(d,e,0,a.primitiveType,b):(c=4*c.buffer.size/u.getStride(c.vao.layout.geometry),p.drawArrays(d,a.primitiveType,0,c,b));return!0};
b.prototype.renderDefaultPassWithOccludees=function(a,c,b,d,e){var f=this._rctx,h=c.displayedIndexRanges;if(h&&0===h.length)return!1;c.instances.forEach(function(c){c.isHidden||(c.hasOccludees&&f.setPipelineState(d),p.drawArrays(f,a.primitiveType,c.from,c.to-c.from,e),c.hasOccludees&&f.setPipelineState(b))});return!0};b.prototype.renderHighlightPass=function(a,c,b){var d=this._rctx,e=!1;c.instances.forEach(function(c){var f=c.highlightedIndexRanges;if(f&&0!==f.length)for(var h=0;h<f.length;h++){var l=
f[h];p.drawArrays(d,a.primitiveType,l?l[0]+c.from:c.from,l?l[1]-l[0]+1:c.to-c.from,b);e=!0}});return e};b.prototype.createData=function(a,c,b){return{instances:new Map,vao:new r(this._rctx,this._vertexAttributeLocations,{geometry:f.glLayout(a)},{geometry:t.createVertex(this._rctx,35044)}),buffer:new d.ResizableFloat32Array(c),optimalCount:0,origin:b,highlightCount:0,hasOccludees:!1}};b.prototype.removeAndRebuild=function(a,c,b,d,e){for(var f=0;f<c.length;f++){var h=c[f].uniqueName,l=a.instances.get(h);
a.optimalCount-=(l.to-l.from)*b;a.instances.delete(h)}var g=0,k=a.buffer.array;e.begin=0;e.end=0;var p=-1,m=-1,q=0;a.instances.forEach(function(a){var c=a.from*b,e=a.to*b,f=e-c;p!==m&&m!==c?(k.set(d.subarray(p,m),q),q+=m-p,p=c):-1===p&&(p=c);m=e;a.from=g/b;g+=f;a.to=g/b});p!==m&&k.set(d.subarray(p,m),q);e.end=g};b.prototype.removeByErasing=function(a,c,b,d){d.begin=Infinity;d.end=-Infinity;for(var e=-1,f=-1,h=0;h<c.length;h++){var l=c[h].uniqueName,g=a.instances.get(l),k=g.from*b,g=g.to*b;e!==f&&
f!==k?(a.buffer.erase(e,f),e=k):-1===e&&(e=k);f=g;a.instances.delete(l);a.optimalCount-=g-k;k<d.begin&&(d.begin=k);g>d.end&&(d.end=g)}e!==f&&a.buffer.erase(e,f)};b.prototype.append=function(c,b,d,e,f){f.updatedDisplayedIndexRange=!1;for(var h=this._bufferWriter,l=0;l<b.length;l++){var m=b[l],r=m.data,u=k.isSome(m.transformation)?g.mat4.multiply(z,e,m.transformation):e;g.mat4.invert(y,u);g.mat4.transpose(y,y);var t=f.end;h.write({transformation:u,invTranspTransformation:y},r,h.vertexBufferLayout.createView(c.buffer.array.buffer),
f.end/d);var r=h.elementCount(r)*d,v=t+r;a.assert(null==c.instances.get(m.uniqueName));var u=p.checkIsHidden(m),x=p.generateRenderGeometryHighlightRanges(m),w=!!m.instanceParameters.occludees;x&&(c.highlightCount=null);w&&(c.hasOccludees=c.hasOccludees||!0);t=new q.Instance(t/d,v/d,u,x,w);c.instances.set(m.uniqueName,t);u&&(f.updatedDisplayedIndexRange=!0);c.optimalCount+=r;f.end+=r}};Object.defineProperty(b.prototype,"test",{get:function(){return{material:this._material}},enumerable:!0,configurable:!0});
return b}();var w={updatedDisplayedIndexRange:!1,begin:0,end:0},v=e.mat4f64.create(),z=e.mat4f64.create(),y=e.mat4f64.create(),A=new Set;return n})},"esri/views/3d/webgl-engine/lib/IntervalUtilities":function(){define(["require","exports"],function(n,b){return function(){function b(){}b.copyIntervals=function(b){for(var g=[],e=0;e<b.length;e++){var f=b[e];g.push([f[0],f[1]])}return g};b.convertFaceToIndexRange=function(b,g){for(var e=0;e<b.length;e++){var f=b[e];f[0]*=g;f[1]=f[1]*g+(g-1)}};b.sortIntervals=
function(b){return b.sort(function(b,e){return b[0]===e[0]?b[1]>e[1]?1:b[1]<e[1]?-1:0:b[0]>e[0]?1:b[0]<e[0]?-1:0})};b.intersectIntervals=function(b,g){if(0>=b.length)return[];for(var e=[],f=0;f<b.length;f++){var l=b[f];l[1]<g[0]||l[0]>g[1]||(l=[l[0],l[1]],l[0]<g[0]&&(l[0]=g[0]),l[1]>g[1]&&(l[1]=g[1]),e.push(l))}return e};b.mergeIntervals=function(b){if(0>=b.length)return[];var g=[];b=this.sortIntervals(b);g.push(b[0]);for(var e=1;e<b.length;e++){var f=g[g.length-1];f[1]+1<b[e][0]?g.push(b[e]):f[1]<
b[e][1]&&(f[1]=b[e][1],g.pop(),g.push(f))}return g};b.invertIntervals=function(b,g){for(var e=[],f=0,l=0;l<b.length;l++){var h=b[l];h[0]>f&&e.push([f,h[0]-1]);f=h[1]+1}f<=g&&e.push([f,g]);return e};b.offsetIntervals=function(b,g){for(var e=[],f=0;f<b.length;f++){var l=b[f];e.push([l[0]+g,l[1]+g])}return e};return b}()})},"esri/views/3d/webgl-engine/lib/ResizableFloat32Array":function(){define(["require","exports","../../../../core/mathUtils"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});
n=function(){function b(b){null==b?b=16:65536>b&&(b=m.nextHighestPowerOfTwo(b));this._array=new Float32Array(b);this._size=0}b.prototype.resize=function(b,e){this._size=b;if(this._size>this._array.length){for(b=this._array.length||1;b<this._size;)b*=2;var f=new Float32Array(b);e&&f.set(this._array);this._array=f;return!0}f=2*this._size;if(f<=this._array.length){for(b=this._array.length;b>=f;)b=Math.floor(b/2);f=new Float32Array(b);e&&f.set(this._array.subarray(0,b));this._array=f;return!0}return!1};
b.prototype.append=function(b){var e=this._size;this.resize(this._size+b.length,!0);this._array.set(b,e)};b.prototype.erase=function(b,e){for(;b<e;++b)this._array[b]=0};Object.defineProperty(b.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});return b}();b.ResizableFloat32Array=n})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../lib/GLMaterial ./WaterTechnique ./internal/MaterialUtil ./internal/waterMaterialUtils".split(" "),
function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a){a=b.call(this,a)||this;a.updateParameters();return a}m(d,b);d.prototype.updateParameters=function(){this.params=f.copyParameters(this.material.getParameters());this.technique=this.techniqueRep.acquireAndReleaseExisting(e.WaterTechnique,this.material.getTechniqueConfig(this.output),this.technique)};d.prototype.beginSlot=function(a){if(2===this.output)return 22===a;if(5===this.output)return null==
a;var c=3;this.params.transparent&&(c=this.params.writeDepth?5:8);return a===c};d.prototype.setElapsedTimeUniform=function(a){a.setUniform1f("timeElapsed",.001*this.material.animation.time*this.params.animationSpeed)};d.prototype._updateShadowState=function(a){a.shadowMappingEnabled!==this.params.receiveShadows&&(this.material.setParameterValues({receiveShadows:a.shadowMappingEnabled}),this.updateParameters())};d.prototype.ensureResources=function(a){l.waterTextureRepo.ready()||l.waterTextureRepo.loading()||
l.waterTextureRepo.initialize(a);return l.waterTextureRepo.ready()?2:1};d.prototype.ensureParameters=function(a){0===this.output&&this._updateShadowState(a)};d.prototype.bind=function(a,c){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.params);if(2===this.output||0===this.output)l.waterTextureRepo.bindRepo(a),this.setElapsedTimeUniform(this.technique.program)};return d}(g.GLMaterial);b.WaterGLMaterial=n})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultTextureUnits ../lib/DefaultVertexAttributeLocations ../shaders/WaterSurface.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x){Object.defineProperty(b,"__esModule",{value:!0});g=function(c){function b(){return null!==c&&c.apply(this,arguments)||this}m(b,c);b.prototype.initializeProgram=function(a){var c=b.shader.get(),d=this.configuration,c=c.build({output:d.output,viewingMode:a.viewingMode,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:d.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0});return new r(a.rctx,
c.generateSource("vertex"),c.generateSource("fragment"),t.Default3D)};b.prototype.bindPass=function(a,c){0!==this.configuration.output&&2!==this.configuration.output||h.WaterDistortion.bindUniforms(this.program,c);0!==this.configuration.output&&5!==this.configuration.output||this.program.setUniform4fv("waterColor",c.color)};b.prototype.bindDraw=function(a){f.Transform.bindUniforms(this.program,a);0===this.configuration.output&&(d.Camera.bindUniforms(this.program,a),e.Slice.bindUniformsWithOrigin(this.program,
this.configuration,a),l.ReadShadowMap.bindUniforms(this.program,a,p.DefaultTextureUnits.SHADOW_MAP))};b.prototype.initializePipeline=function(){var a=this.configuration;return 2===a.output?x.makePipelineState({depthTest:{func:513},depthWrite:a.writeDepth&&x.defaultDepthWriteParams,colorWrite:x.defaultColorWriteParams}):x.makePipelineState({blending:a.transparent&&x.separateBlendingParams(770,1,771,771),depthTest:{func:513},depthWrite:a.writeDepth&&x.defaultDepthWriteParams,colorWrite:x.defaultColorWriteParams})};
b.shader=new a.ReloadableShaderModule(u,"../shaders/WaterSurface.glsl",n);return b}(c.ShaderTechnique);b.WaterTechnique=g;g=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.output=0;c.receiveShadows=!1;c.slicePlaneEnabled=!1;c.transparent=!1;c.writeDepth=!1;return c}m(c,a);k([q.parameter({count:7})],c.prototype,"output",void 0);k([q.parameter()],c.prototype,"receiveShadows",void 0);k([q.parameter()],c.prototype,"slicePlaneEnabled",void 0);k([q.parameter()],c.prototype,"transparent",
void 0);k([q.parameter()],c.prototype,"writeDepth",void 0);return c}(q.ShaderTechniqueConfiguration);b.WaterTechniqueConfiguration=g})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("require exports ../../../../../core/tsSupport/makeTemplateObjectHelper ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../shaderModules/interfaces".split(" "),function(n,b,m,k,g,e,f){function l(b,e){if(e.slicePlaneEnabled){b.extensions.add("GL_OES_standard_derivatives");
e.sliceEnabledForVertexPrograms&&(b.vertex.uniforms.add("slicePlaneOrigin","vec3"),b.vertex.uniforms.add("slicePlaneBasis1","vec3"),b.vertex.uniforms.add("slicePlaneBasis2","vec3"));b.fragment.uniforms.add("slicePlaneOrigin","vec3");b.fragment.uniforms.add("slicePlaneBasis1","vec3");b.fragment.uniforms.add("slicePlaneBasis2","vec3");var h=f.glsl(d||(d=m(["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel \x3d pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal \x3d -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW \x3d -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 \x3d dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 \x3d dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot \x3d dot(slicePlaneBasis1, rel);\n        float basis2Dot \x3d dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front \x3c 0.0\n          \x26\x26 factors.side0 \x3c 0.0\n          \x26\x26 factors.side1 \x3c 0.0\n          \x26\x26 factors.side2 \x3c 0.0\n          \x26\x26 factors.side3 \x3c 0.0;\n      }\n      \n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) !\x3d 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() \x26\x26 sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "],
["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel \x3d pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal \x3d -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW \x3d -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 \x3d dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 \x3d dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot \x3d dot(slicePlaneBasis1, rel);\n        float basis2Dot \x3d dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front \x3c 0.0\n          \x26\x26 factors.side0 \x3c 0.0\n          \x26\x26 factors.side1 \x3c 0.0\n          \x26\x26 factors.side2 \x3c 0.0\n          \x26\x26 factors.side3 \x3c 0.0;\n      }\n      \n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) !\x3d 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() \x26\x26 sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "]))),
l=f.glsl(a||(a=m(["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors \x3d calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH \x3d 1.0;\n        const vec4 HIGHLIGHT_COLOR \x3d vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor \x3d (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "],
["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors \x3d calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH \x3d 1.0;\n        const vec4 HIGHLIGHT_COLOR \x3d vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor \x3d (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "]))),
l=e.sliceHighlightDisabled?f.glsl(c||(c=m(["#define highlightSlice(_color_, _pos_) (_color_)"],["#define highlightSlice(_color_, _pos_) (_color_)"]))):f.glsl(q||(q=m(["\n        "," \n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "],["\n        "," \n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "])),l);e.sliceEnabledForVertexPrograms&&b.vertex.code.add(h);
b.fragment.code.add(h);b.fragment.code.add(l)}else h=f.glsl(p||(p=m(["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "],["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "]))),e.sliceEnabledForVertexPrograms&&b.vertex.code.add(h),b.fragment.code.add(h)}Object.defineProperty(b,"__esModule",{value:!0});b.Slice=
l;(function(a){a.bindUniformsWithOrigin=function(c,b,d){a.bindUniforms(c,b,d.slicePlane,d.origin)};a.bindUniforms=function(a,c,b,d){c.slicePlaneEnabled&&(k.isSome(b)?(d?(g.vec3.subtract(h,b.origin,d),a.setUniform3fv("slicePlaneOrigin",h)):a.setUniform3fv("slicePlaneOrigin",b.origin),a.setUniform3fv("slicePlaneBasis1",b.basis1),a.setUniform3fv("slicePlaneBasis2",b.basis2)):(a.setUniform3fv("slicePlaneBasis1",e.vec3f64.ZEROS),a.setUniform3fv("slicePlaneBasis2",e.vec3f64.ZEROS),a.setUniform3fv("slicePlaneOrigin",
e.vec3f64.ZEROS)))}})(l=b.Slice||(b.Slice={}));var h=e.vec3f64.create(),d,a,c,q,p})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(n,b,m,k,g){function e(b){b.include(k.RgbaFloatEncoding);b.fragment.uniforms.add("depthTex","sampler2D");b.fragment.uniforms.add("shadowMapNum","int");b.fragment.uniforms.add("shadowMapDistance",
"vec4");b.fragment.uniforms.add("shadowMapMatrix","mat4",4);b.fragment.uniforms.add("depthHalfPixelSz","float");b.fragment.code.add(g.glsl(f||(f=m(["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize \x3d depthHalfPixelSz;\n      vec4 distance \x3d shadowMapDistance;\n      float depth \x3d _linearDepth;\n\n      //choose correct cascade\n      int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\n\n      if (i \x3e\x3d shadowMapNum) { return 0.0; }\n\n      mat4 mat \x3d i \x3d\x3d 0 ? shadowMapMatrix[0] : i \x3d\x3d 1 ? shadowMapMatrix[1] : i \x3d\x3d 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv \x3d mat * vec4(_vpos, 1.0);\n      lv.xy /\x3d lv.w;\n\n      // vertex completely outside? -\x3e no shadow\n      vec3 lvpos \x3d 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z \x3e\x3d 1.0) { return 0.0; }\n      if (lvpos.x \x3c 0.0 || lvpos.x \x3e 1.0 || lvpos.y \x3c 0.0 || lvpos.y \x3e 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv \x3d vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize \x3d 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st \x3d fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "],
["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize \x3d depthHalfPixelSz;\n      vec4 distance \x3d shadowMapDistance;\n      float depth \x3d _linearDepth;\n\n      //choose correct cascade\n      int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\n\n      if (i \x3e\x3d shadowMapNum) { return 0.0; }\n\n      mat4 mat \x3d i \x3d\x3d 0 ? shadowMapMatrix[0] : i \x3d\x3d 1 ? shadowMapMatrix[1] : i \x3d\x3d 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv \x3d mat * vec4(_vpos, 1.0);\n      lv.xy /\x3d lv.w;\n\n      // vertex completely outside? -\x3e no shadow\n      vec3 lvpos \x3d 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z \x3e\x3d 1.0) { return 0.0; }\n      if (lvpos.x \x3c 0.0 || lvpos.x \x3e 1.0 || lvpos.y \x3c 0.0 || lvpos.y \x3e 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv \x3d vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize \x3d 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st \x3d fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "]))))}
Object.defineProperty(b,"__esModule",{value:!0});b.ReadShadowMap=e;(function(b){b.bindUniforms=function(b,d,a){d.shadowMappingEnabled&&(d.shadowMap.bind(b,a),d.shadowMap.bindView(b,d.origin))};b.bindViewCustomOrigin=function(b,d,a){d.shadowMappingEnabled&&d.shadowMap.bindView(b,a)};b.bindView=function(b,d){d.shadowMappingEnabled&&d.shadowMap.bindView(b,d.origin)}})(e=b.ReadShadowMap||(b.ReadShadowMap={}));var f})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){function g(b){b.fragment.uniforms.add("texWaveNormal","sampler2D");b.fragment.uniforms.add("texWavePerturbation","sampler2D");b.fragment.uniforms.add("waveParams","vec4");b.fragment.uniforms.add("waveDirection","vec2");b.fragment.code.add(k.glsl(e||(e=m(["\n      const vec2  FLOW_JUMP \x3d vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress \x3d computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength \x3d waveParams[2];\n        float flowOffset \x3d waveParams[3];\n\n        vec2 flowVector \x3d textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress \x3d computeProgress(uv, time + phaseOffset);\n        float weight \x3d computeWeight(uv, time + phaseOffset);\n\n        vec2 result \x3d uv;\n        result -\x3d flowVector * (progress + flowOffset);\n        result +\x3d phaseOffset;\n        result +\x3d (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT \x3d 0.3737;\n      const float TIME_NOISE_STRENGTH \x3d 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength \x3d waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement \x3d time * -_waveDir;\n\n        float timeNoise \x3d sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A \x3d textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B \x3d textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal \x3d normalize(normal_A + normal_B);\n        mixNormal.xy *\x3d waveStrength;\n        mixNormal.z \x3d sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec3 getSurfaceNormal(vec2 _uv, float _time) {\n        float waveTextureRepeat \x3d waveParams[1];\n        return getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n      }\n    "],
["\n      const vec2  FLOW_JUMP \x3d vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress \x3d computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength \x3d waveParams[2];\n        float flowOffset \x3d waveParams[3];\n\n        vec2 flowVector \x3d textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress \x3d computeProgress(uv, time + phaseOffset);\n        float weight \x3d computeWeight(uv, time + phaseOffset);\n\n        vec2 result \x3d uv;\n        result -\x3d flowVector * (progress + flowOffset);\n        result +\x3d phaseOffset;\n        result +\x3d (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT \x3d 0.3737;\n      const float TIME_NOISE_STRENGTH \x3d 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength \x3d waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement \x3d time * -_waveDir;\n\n        float timeNoise \x3d sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A \x3d textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B \x3d textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal \x3d normalize(normal_A + normal_B);\n        mixNormal.xy *\x3d waveStrength;\n        mixNormal.z \x3d sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec3 getSurfaceNormal(vec2 _uv, float _time) {\n        float waveTextureRepeat \x3d waveParams[1];\n        return getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n      }\n    "]))))}
Object.defineProperty(b,"__esModule",{value:!0});b.WaterDistortion=g;(function(b){b.bindUniforms=function(b,e){b.setUniform1i("texWaveNormal",0);b.setUniform1i("texWavePerturbation",1);b.setUniform4f("waveParams",e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset);b.setUniform2f("waveDirection",e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity)}})(g=b.WaterDistortion||(b.WaterDistortion={}));var e})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/Camera.glsl":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});(function(b){function k(b,e,f){b.setUniform3f("camPos",f[3]-e[0],f[7]-e[1],f[11]-e[2])}b.bindUniformsCustomOrigin=k;b.bindUniforms=function(b,e){k(b,e.origin,e.viewInvTransp)}})(b.Camera||(b.Camera={}));(function(b){b.bindUniforms=function(b,g){b.setUniform1f("pixelRatio",g.pixelRatio||1);b.setUniform4fv("viewport",g.viewport)}})(b.Viewport||(b.Viewport={}))})},"esri/views/3d/webgl-engine/shaders/WaterSurface.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/ForwardLinearDepth.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/shading/NormalUtils.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/Water.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var y=new c.ShaderBuilder;y.include(e.Transform,{linearDepth:!1});y.attributes.add("position","vec3");y.attributes.add("uv0","vec2");y.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4").add("localOrigin","vec3");0===b.output&&(y.include(f.NormalUtils,b),y.include(k.ForwardLinearDepth,b),y.varyings.add("vuv","vec2"),y.varyings.add("vpos","vec3"),y.varyings.add("vnormal","vec3"),
y.varyings.add("vtbnMatrix","mat3"),y.vertex.code.add(a.glsl(q||(q=m(["\n      void main(void) {\n        vuv \x3d uv0;\n        vpos \x3d (model * vec4(position, 1.0)).xyz;\n\n        vnormal \x3d getLocalUp(vpos, localOrigin);\n        vtbnMatrix \x3d getTBNMatrix(vnormal);\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "],["\n      void main(void) {\n        vuv \x3d uv0;\n        vpos \x3d (model * vec4(position, 1.0)).xyz;\n\n        vnormal \x3d getLocalUp(vpos, localOrigin);\n        vtbnMatrix \x3d getTBNMatrix(vnormal);\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "])))),
y.include(d.WaterDistortion,b),y.include(g.Slice,b),b.receiveShadows&&y.include(l.ReadShadowMap,b),y.include(h.Water,b),y.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float"),y.fragment.code.add(a.glsl(p||(p=m(["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp \x3d vnormal;\n        // the created normal is in tangent space\n        vec3 tangentNormal \x3d getSurfaceNormal(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n \x3d normalize(vtbnMatrix * tangentNormal);\n        vec3 v \x3d -normalize(vpos - camPos);\n        vec3 l \x3d normalize(-lightingMainDirection);\n        "],
["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp \x3d vnormal;\n        // the created normal is in tangent space\n        vec3 tangentNormal \x3d getSurfaceNormal(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n \x3d normalize(vtbnMatrix * tangentNormal);\n        vec3 v \x3d -normalize(vpos - camPos);\n        vec3 l \x3d normalize(-lightingMainDirection);\n        "])))),b.receiveShadows?y.fragment.code.add(a.glsl(t||
(t=m(["\n        float shadow \x3d 1.0 - readShadowMap(vpos, linearDepth);\n      "],["\n        float shadow \x3d 1.0 - readShadowMap(vpos, linearDepth);\n      "])))):y.fragment.code.add(a.glsl(u||(u=m(["\n        float shadow \x3d 1.0;\n      "],["\n        float shadow \x3d 1.0;\n      "])))),y.fragment.code.add(a.glsl(r||(r=m(["\n        vec4 final \x3d vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow), waterColor.w);\n\n        // gamma correction\n        gl_FragColor \x3d delinearizeGamma(final);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "],
["\n        vec4 final \x3d vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow), waterColor.w);\n\n        // gamma correction\n        gl_FragColor \x3d delinearizeGamma(final);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "])))));2===b.output&&(y.include(f.NormalUtils,b),y.include(d.WaterDistortion,b),y.include(g.Slice,b),y.varyings.add("vpos","vec3"),y.varyings.add("vuv","vec2"),y.vertex.code.add(a.glsl(x||(x=m(["\n        void main(void) {\n          vuv \x3d uv0;\n          vpos \x3d (model * vec4(position, 1.0)).xyz;\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],
["\n        void main(void) {\n          vuv \x3d uv0;\n          vpos \x3d (model * vec4(position, 1.0)).xyz;\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])))),y.fragment.uniforms.add("timeElapsed","float"),y.fragment.code.add(a.glsl(w||(w=m(["\n        void main() {\n          discardBySlice(vpos);\n          // the created normal is in tangent space\n          vec3 tangentNormal \x3d getSurfaceNormal(vuv, timeElapsed);\n          tangentNormal \x3d normalize(tangentNormal);\n          gl_FragColor \x3d vec4((tangentNormal + vec3(1.0)) * 0.5, 0.0);\n        }\n    "],
["\n        void main() {\n          discardBySlice(vpos);\n          // the created normal is in tangent space\n          vec3 tangentNormal \x3d getSurfaceNormal(vuv, timeElapsed);\n          tangentNormal \x3d normalize(tangentNormal);\n          gl_FragColor \x3d vec4((tangentNormal + vec3(1.0)) * 0.5, 0.0);\n        }\n    "])))));5===b.output&&(y.include(f.NormalUtils,b),y.varyings.add("vpos","vec3"),y.vertex.code.add(a.glsl(v||(v=m(["\n        void main(void) {\n          vpos \x3d (model * vec4(position, 1.0)).xyz;\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],
["\n        void main(void) {\n          vpos \x3d (model * vec4(position, 1.0)).xyz;\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])))),y.fragment.uniforms.add("waterColor","vec4"),y.fragment.code.add(a.glsl(z||(z=m(["\n        void main() {\n          gl_FragColor \x3d waterColor;\n        }\n    "],["\n        void main() {\n          gl_FragColor \x3d waterColor;\n        }\n    "])))));return y};var q,p,t,u,r,x,w,v,z})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["require",
"exports","../../../../../core/tsSupport/makeTemplateObjectHelper","../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.ForwardLinearDepth=function(b,h){0===h.output&&h.receiveShadows?(b.varyings.add("linearDepth","float"),b.vertex.code.add(k.glsl(g||(g=m(["\n      void forwardLinearDepth() { linearDepth \x3d gl_Position.w; }\n    "],["\n      void forwardLinearDepth() { linearDepth \x3d gl_Position.w; }\n    "]))))):1===h.output||3===h.output?(b.varyings.add("linearDepth",
"float"),b.vertex.uniforms.add("uCameraNearFar","vec2"),b.vertex.code.add(k.glsl(e||(e=m(["\n      void forwardLinearDepth() {\n        linearDepth \x3d (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "],["\n      void forwardLinearDepth() {\n        linearDepth \x3d (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "]))))):b.vertex.code.add(k.glsl(f||(f=m(["\n      void forwardLinearDepth() {}\n    "],
["\n      void forwardLinearDepth() {}\n    "]))))};var g,e,f})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.NormalUtils=function(b,d){0===d.viewingMode?b.vertex.code.add(k.glsl(g||(g=m(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "],
["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "])))):b.vertex.code.add(k.glsl(e||(e=m(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "],["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "]))));0===d.viewingMode?b.vertex.code.add(k.glsl(f||(f=
m(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "])))):b.vertex.code.add(k.glsl(l||(l=m(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d vec3(1.0, 0.0, 0.0);\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],
["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d vec3(1.0, 0.0, 0.0);\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "]))))};var g,e,f,l})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ./Gamma.glsl ./PhysicallyBasedRendering.glsl ../../shaderModules/interfaces".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,
"__esModule",{value:!0});b.Water=function(b,h){b.include(g.PhysicallyBasedRendering,h);b.include(k.Gamma);b.fragment.code.add(e.glsl(f||(f=m(["\n    const vec3 fresnelSky \x3d  vec3(0.02, 1.0, 5.0); // f0, f0max, exp\n    const vec2 fresnelMaterial \x3d  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness \x3d 0.06;\n\n    const vec3 skyZenitColor \x3d vec3(0, 0.6, 0.9);\n    const vec3 skyColor \x3d vec3(0.72, 0.92, 1.0);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta \x3d is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon \x3d the dominant color of the sky horizon\n    *   @parameter: cosTheta \x3d the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent \x3d pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n \x3d normal facing away from the surface\n    *   @parameter: v \x3d view direction facing away from the surface.\n    *   @parameter: l \x3d light direction facing away from the surface\n    *   @parameter: lightIntensity \x3d light intensity, currently between 0...PI\n    *   @parameter: localUp \x3d a normal for the general direction of the surface\n    *   @parameter: shadow \x3d the amount of shadow at this pixel (0 \x3d no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow) {\n\n      vec3 seaWaterColor \x3d linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h \x3d normalize(l + v);\n      shadingInfo.NdotL \x3d clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV \x3d clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN \x3d clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH \x3d clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH \x3d clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH \x3d clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV \x3d max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon \x3d linearizeGamma(skyColor);\n      vec3 skyZenit \x3d linearizeGamma(skyZenitColor);\n      vec3 skyColor \x3d getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL \x3d max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      skyColor *\x3d 0.1 + upDotL * 0.9;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier \x3d clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 reflSky \x3d fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]) * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea \x3d seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular \x3d vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV \x3e 0.0 \x26\x26 upDotL \x3e 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun \x3d brdfWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight \x3d lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular \x3d shadingInfo.NdotL * incidentLight * specularSun;\n      }\n      // combining reflected sky, reflected sea and specular highlight.\n      return tonemapACES(reflSky + reflSea + specular);\n    }\n  "],
["\n    const vec3 fresnelSky \x3d  vec3(0.02, 1.0, 5.0); // f0, f0max, exp\n    const vec2 fresnelMaterial \x3d  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness \x3d 0.06;\n\n    const vec3 skyZenitColor \x3d vec3(0, 0.6, 0.9);\n    const vec3 skyColor \x3d vec3(0.72, 0.92, 1.0);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta \x3d is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon \x3d the dominant color of the sky horizon\n    *   @parameter: cosTheta \x3d the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent \x3d pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n \x3d normal facing away from the surface\n    *   @parameter: v \x3d view direction facing away from the surface.\n    *   @parameter: l \x3d light direction facing away from the surface\n    *   @parameter: lightIntensity \x3d light intensity, currently between 0...PI\n    *   @parameter: localUp \x3d a normal for the general direction of the surface\n    *   @parameter: shadow \x3d the amount of shadow at this pixel (0 \x3d no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow) {\n\n      vec3 seaWaterColor \x3d linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h \x3d normalize(l + v);\n      shadingInfo.NdotL \x3d clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV \x3d clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN \x3d clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH \x3d clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH \x3d clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH \x3d clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV \x3d max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon \x3d linearizeGamma(skyColor);\n      vec3 skyZenit \x3d linearizeGamma(skyZenitColor);\n      vec3 skyColor \x3d getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL \x3d max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      skyColor *\x3d 0.1 + upDotL * 0.9;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier \x3d clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 reflSky \x3d fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]) * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea \x3d seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular \x3d vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV \x3e 0.0 \x26\x26 upDotL \x3e 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun \x3d brdfWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight \x3d lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular \x3d shadingInfo.NdotL * incidentLight * specularSun;\n      }\n      // combining reflected sky, reflected sea and specular highlight.\n      return tonemapACES(reflSky + reflSea + specular);\n    }\n  "]))))};
var f})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.Gamma=function(b){b.fragment.code.add(k.glsl(g||(g=m(["\n    const float GAMMA \x3d 2.2;\n    const float INV_GAMMA \x3d 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "],
["\n    const float GAMMA \x3d 2.2;\n    const float INV_GAMMA \x3d 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "]))))};var g})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ./AnalyticalSkyModel.glsl ./PiUtils.glsl ../../shaderModules/interfaces".split(" "),
function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});b.PhysicallyBasedRendering=function(b,w){var v=b.fragment.code;b.include(g.PiUtils);if(3===w.pbrMode||4===w.pbrMode)v.add(e.glsl(f||(f=m(["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent \x3d ",
";\n    "],["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent \x3d ",
";\n    "])),w.useCustomDTRExponentForWater?"2.2":"2.0")),v.add(e.glsl(l||(l=m(["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "],["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "])))),v.add(e.glsl(h||(h=m(["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 \x3d roughness * roughness;\n      float NdotH2 \x3d NdotH * NdotH;\n      float denom \x3d pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "],
["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 \x3d roughness * roughness;\n      float NdotH2 \x3d NdotH * NdotH;\n      float denom \x3d pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "])))),v.add(e.glsl(d||(d=m(["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "],["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "])))),
v.add(e.glsl(a||(a=m(["\n    vec3 brdfWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F \x3d fresnelReflection(props.VdotH, F0, F0Max);\n      float D \x3d normalDistributionWater(props.NdotH, roughness);\n      float V \x3d geometricOcclusionKelemen(props.LdotH);\n      return (D * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "],["\n    vec3 brdfWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F \x3d fresnelReflection(props.VdotH, F0, F0Max);\n      float D \x3d normalDistributionWater(props.NdotH, roughness);\n      float V \x3d geometricOcclusionKelemen(props.LdotH);\n      return (D * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "]))));
else if(1===w.pbrMode||2===w.pbrMode)b.include(k.AnalyticalSkyModel),v.add(e.glsl(c||(c=m(["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "],
["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "])))),
v.add(e.glsl(q||(q=m(["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a \x3d NdotH * roughness;\n        float b \x3d roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "],["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a \x3d NdotH * roughness;\n        float b \x3d roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "])))),v.add(e.glsl(p||(p=m(["\n    const vec4 c0 \x3d vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 \x3d vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 \x3d vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r \x3d roughness * c0 + c1;\n        float a004 \x3d min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "],
["\n    const vec4 c0 \x3d vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 \x3d vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 \x3d vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r \x3d roughness * c0 + c1;\n        float a004 \x3d min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "])))),v.add(e.glsl(t||(t=m(["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse \x3d evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular \x3d evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent \x3d inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg \x3d prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor \x3d inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent \x3d specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "],
["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse \x3d evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular \x3d evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent \x3d inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg \x3d prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor \x3d inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent \x3d specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "])))),
v.add(e.glsl(u||(u=m(["\n    float gamutMapChanel(float x, vec2 p){\n      return (x \x3c p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"],["\n    float gamutMapChanel(float x, vec2 p){\n      return (x \x3c p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }"])))),v.add(e.glsl(r||(r=m(["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p \x3d vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x \x3d gamutMapChanel(inColor.x, p) ;\n      outColor.y \x3d gamutMapChanel(inColor.y, p) ;\n      outColor.z \x3d gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "],
["\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      vec2 p \x3d vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      outColor.x \x3d gamutMapChanel(inColor.x, p) ;\n      outColor.y \x3d gamutMapChanel(inColor.y, p) ;\n      outColor.z \x3d gamutMapChanel(inColor.z, p) ;\n      return outColor;\n    }\n    "]))))};var f,l,h,d,a,c,q,p,t,u,r})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.AnalyticalSkyModel=function(b){b=b.fragment.code;b.add(k.glsl(g||(g=m(["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "],["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "]))));
b.add(k.glsl(e||(e=m(["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "],["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "]))));b.add(k.glsl(f||(f=m(["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 \x3d 1.0 - RdotNG * RdotNG;\n      float intRadTheta \x3d integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground \x3d RdotNG \x3c 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky \x3d 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "],
["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 \x3d 1.0 - RdotNG * RdotNG;\n      float intRadTheta \x3d integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground \x3d RdotNG \x3c 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky \x3d 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "]))))};
var g,e,f})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.PiUtils=function(b){b.vertex.code.add(k.glsl(g||(g=m(["\n    const float PI \x3d 3.141592653589793;\n  "],["\n    const float PI \x3d 3.141592653589793;\n  "]))));b.fragment.code.add(k.glsl(e||(e=m(["\n    const float PI \x3d 3.141592653589793;\n    const float LIGHT_NORMALIZATION \x3d 1.0 / PI;\n    const float INV_PI \x3d 0.3183098861837907;\n    const float HALF_PI \x3d 1.570796326794897;\n    "],
["\n    const float PI \x3d 3.141592653589793;\n    const float LIGHT_NORMALIZATION \x3d 1.0 / PI;\n    const float INV_PI \x3d 0.3183098861837907;\n    const float HALF_PI \x3d 1.570796326794897;\n    "]))))};var g,e})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define("require exports ../../../../../core/Logger ../../../../../core/promiseUtils ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../support/imageUtils ../../../../webgl/Texture".split(" "),function(n,
b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});var l=m.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");b.waveAndPertubationTextureUrls=[n.toUrl("../../../../../images/materials/water/normals.jpg"),n.toUrl("../../../../../images/materials/water/perturbation.jpg")];b.defaultWaterMaterialParameters={waveStrength:.06,waveTextureRepeat:32,waveDirection:g.vec2f64.fromValues(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,.35686,
.4,1],transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0};b.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,
perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,
waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};n=function(){function h(){this.loadingState=0;this.data=[]}h.prototype.getTextureProps=function(b,a,c){void 0===c&&(c=!1);return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:10497,samplingMode:9987,hasMipmap:c,maxAnisotropy:8,width:b,height:a}};h.prototype.ready=function(){return 2===this.loadingState};
h.prototype.loading=function(){return 1===this.loadingState};h.prototype.initialize=function(d){var a=this;this.loadingState=1;k.all(b.waveAndPertubationTextureUrls.map(function(a){return e.requestImage(a)})).then(function(c){c.forEach(function(c,b){a.data[b]=new f(d,a.getTextureProps(c.width,c.height,!0),c)});a.loadingState=2}).catch(function(c){l.error("Failed to load textures for water material.",c);a.loadingState=0})};h.prototype.bindRepo=function(b){for(var a=0;a<this.data.length;a++)b.bindTexture(this.data[a],
a)};return h}();b.waterTextureRepo=new n})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/mat4","../../../../../core/libs/gl-matrix-2/mat4f64"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(b,e,f,l,h,d,a){this.from=b;this.to=e;this.isHidden=f;this.highlightedIndexRanges=l;this.hasOccludees=h;this.transformation=d;this.instanceParameters=a;null!=d&&(this.transformationNormal=
k.mat4f64.clone(d),m.mat4.invert(this.transformationNormal,this.transformationNormal),m.mat4.transpose(this.transformationNormal,this.transformationNormal))}}();b.Instance=n})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("require exports ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../lib/ComponentUtils ../../lib/doublePrecisionUtils ../../lib/Util ../../../../webgl/Util".split(" "),function(n,b,m,
k,g,e,f,l,h){Object.defineProperty(b,"__esModule",{value:!0});b.checkIsHidden=function(a){return a.instanceParameters.hidden||e.generateVisibleIndexRanges(a.instanceParameters.componentVisibilities,a.componentOffsets)?!0:!1};b.generateRenderGeometryHighlightRanges=function(a){return a.instanceParameters.hidden?null:e.generateHighlightedIndexRanges(a.instanceParameters.componentVisibilities,a.instanceParameters.componentHighlights,a.componentOffsets)};b.doesRenderGeometryHaveHighlights=function(a){return a.instanceParameters.hidden?
!1:e.hasHighlights(a.instanceParameters.componentVisibilities,a.instanceParameters.componentHighlights,a.componentOffsets)};b.isRenderGeometryHidden=function(a){return a.instanceParameters.hidden?!0:e.isAllHidden(a.instanceParameters.componentVisibilities,a.componentOffsets)};b.drawArrays=function(a,c,b,d,e){a.drawArrays(c,b,d);e&&(e.drawCalls++,4===c&&(e.triangles+=d))};b.drawElements=function(a,c,b,d,e,f){var l=h.getBytesPerElement(b);a.drawElements(c,e,b,d*l);f&&(f.drawCalls++,4===c&&(f.triangles+=
e))};b.drawArraysFaceRange=function(a,c,b,d,e){for(var f=0,h=0;h<c.length;h++){var l=c[h],g=l[0]+b,l=l[1]-l[0]+1,f=f+l;a.drawArrays(d,g,l)}e&&(e.drawCalls+=c.length,4===d&&(e.triangles=f/3))};b.drawElementsFaceRange=function(a,c,b,d,e,f){for(var l=h.getBytesPerElement(e),g=0,k=0;k<c.length;k++){var p=c[k],m=p[0]+b,p=p[1]-p[0]+1,g=g+p;a.drawElements(d,p,e,m*l)}f&&(f.drawCalls+=c.length,4===d&&(f.triangles+=g/3))};b.acquireMaterials=function(a,c){var b=new Map;b.set(0,c.acquire(a,0));b.set(3,c.acquire(a,
3));b.set(2,c.acquire(a,2));b.set(1,c.acquire(a,1));b.set(4,c.acquire(a,4));return b};b.releaseMaterials=function(a,c){c.release(a,0);c.release(a,3);c.release(a,2);c.release(a,1);c.release(a,4)};b.calculateTransformRelToOrigin=function(a,b,d){var e=a.origin.vec3;l.setMatrixTranslation3(c,-e[0],-e[1],-e[2]);m.isSome(a.transformation)?k.mat4.multiply(b,c,a.transformation):k.mat4.copy(b,c);d&&(k.mat4.invert(d,b),k.mat4.transpose(d,d))};b.encodeDoubleVec3=function(c,b,e,h,l){d[0]=c.get(b,0);d[1]=c.get(b,
1);d[2]=c.get(b,2);f.encodeDoubleArray(d,a,3);e.set(l,0,a[0]);h.set(l,0,a[1]);e.set(l,1,a[2]);h.set(l,1,a[3]);e.set(l,2,a[4]);h.set(l,2,a[5])};var d=new Float64Array(3),a=new Float32Array(6),c=g.mat4f64.create()})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["require","exports"],function(n,b){function m(b,f,l){for(var e=0;e<l;++e)f[2*e]=b[e],f[2*e+1]=b[e]-f[2*e]}Object.defineProperty(b,"__esModule",{value:!0});b.encodeDouble=function(b,f){g[0]=b;g[1]=b-g[0];f[0]=g[0];
f[1]=g[1]};b.encodeDoubleArray=m;b.decodeDoubleArray=function(b,f,l){for(var e=0;e<l;++e)f[e]=b[2*e]+b[2*e+1]};b.encodeDoubleArraySplit=function(b,f,l,h){for(var d=0;d<h;++d)k[0]=b[d],m(k,g,1),f[d]=g[0],l[d]=g[1]};var k=new Float64Array(1),g=new Float32Array(2)})},"esri/views/3d/webgl-engine/shaders/HUDMaterial.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/hud/AlignPixel.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/hud/HUDOcclusionPass.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/AlphaDiscard.glsl ../core/shaderLibrary/util/ColorConversion.glsl ../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../core/shaderLibrary/util/ScreenSizePerspective.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x){function w(a,c){void 0===c&&(c=v);if(a.textureIsSignedDistanceField){var b=a.anchorPos;a=a.distanceFieldBoundingBox;var d=c;d[0]=b[0]*(a[2]-a[0])+a[0];d[1]=b[1]*(a[3]-a[1])+a[1]}else k.vec2.copy(c,a.anchorPos);return c}Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var e=new x.ShaderBuilder,g=b.signedDistanceFieldEnabled;e.include(l.AlignPixel);e.include(h.HUD,b);e.include(f.Slice,b);if(6===b.output)return e.include(d.HUDOcclusionPass,
b),e;e.include(u.ScreenSizePerspective);e.include(t.RgbaFloatEncoding);e.include(p.ColorConversion,{stages:1});e.include(c.VisualVariables,b);e.varyings.add("vcolor","vec4");e.varyings.add("vtc","vec2");e.varyings.add("vsize","vec2");b.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float");e.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4");g&&e.vertex.uniforms.add("outlineColor","vec4");b.screenSizePerspectiveEnabled&&
e.vertex.uniforms.add("screenSizePerspective","vec4");(b.debugDrawBorder||b.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4");e.attributes.add("uv0","vec2");e.attributes.add("color","vec4");e.attributes.add("size","vec2");e.attributes.add("auxpos2","vec4");e.vertex.code.add(r.glsl(A||(A=m(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ",
"\n\n      ","\n\n      vec2 combinedSize \x3d inputSize * pixelRatio;\n      vec4 quadOffset \x3d vec4(0.0);\n\n      ","\n\n      ","\n    "],["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize \x3d inputSize * pixelRatio;\n      vec4 quadOffset \x3d vec4(0.0);\n\n      ",
"\n\n      ","\n    "])),b.screenSizePerspectiveEnabled?r.glsl(z||(z=m(["\n      inputSize \x3d screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "],["\n      inputSize \x3d screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):
r.glsl(y||(y=m(["\n      inputSize \x3d size;\n      vec2 screenOffsetScaled \x3d screenOffset;"],["\n      inputSize \x3d size;\n      vec2 screenOffsetScaled \x3d screenOffset;"]))),b.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":"",b.occlusionTestEnabled||b.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":"",b.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""));var k=r.glsl(B||(B=m(["\n      vec2 uv01 \x3d floor(uv0);\n      vec2 uv \x3d uv0 - uv01;\n      quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "],
["\n      vec2 uv01 \x3d floor(uv0);\n      vec2 uv \x3d uv0 - uv01;\n      quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "]))),v=g?r.glsl(C||(C=m(["\n  posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"],["\n  posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):r.glsl(F||(F=m(["\n  posProj +\x3d quadOffset;\n  if (inputSize.x \x3d\x3d size.x) {\n    posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\n  }"],
["\n  posProj +\x3d quadOffset;\n  if (inputSize.x \x3d\x3d size.x) {\n    posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\n  }"])));e.vertex.code.add(r.glsl(G||(G=m(["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard \x3d vcolor.a \x3c ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (\x3d fill) and outline color (if applicable) are transparent\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',
"\n        gl_Position \x3d posProj;\n      }\n\n      vtc \x3d uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize \x3d inputSize;\n      ","\n    }\n    "],["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard \x3d vcolor.a \x3c ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (\x3d fill) and outline color (if applicable) are transparent\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',
"\n        gl_Position \x3d posProj;\n      }\n\n      vtc \x3d uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize \x3d inputSize;\n      ","\n    }\n    "])),b.occlusionTestEnabled?"if (visible) {":"",k,b.vvColor?"vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;",r.glsl.float(q.symbolAlphaCutoff),g?"alphaDiscard \x3d alphaDiscard \x26\x26 outlineColor.a \x3c "+r.glsl.float(q.symbolAlphaCutoff)+";":"",v,b.debugDrawBorder?
"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":"",b.occlusionTestEnabled?r.glsl(E||(E=m(["} else { vtc \x3d vec2(0.0);\n        ",""],["} else { vtc \x3d vec2(0.0);\n        ",""])),b.debugDrawBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):""));e.fragment.uniforms.add("tex","sampler2D");g&&(e.fragment.uniforms.add("outlineColor","vec4"),e.fragment.uniforms.add("outlineSize","float"));k=b.debugDrawBorder?r.glsl(H||(H=m(["(isBorder \x3e 0.0 ? 0.0 : ",")"],["(isBorder \x3e 0.0 ? 0.0 : ",
")"])),r.glsl.float(q.defaultMaskAlphaCutoff)):r.glsl.float(q.defaultMaskAlphaCutoff);g=r.glsl(K||(K=m(["\n    ","\n\n    ","\n\n    ","\n  "],["\n    ","\n\n    ","\n\n    ","\n  "])),b.debugDrawBorder?r.glsl(D||(D=m(["\n      float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"],["\n      float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):
"",g?r.glsl(I||(I=m(["\n      vec4 fillPixelColor \x3d vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize \x3d 128.0;\n      const float texelSize \x3d 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\n      vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist \x3d d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor \x3d clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *\x3d fillAlphaFactor;\n\n      if (outlineSize \x3e 0.25) {\n        vec4 outlinePixelColor \x3d outlineColor;\n        float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor \x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *\x3d outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor \x3c ",
" ||\n          fillPixelColor.a + outlinePixelColor.a \x3c ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor \x3c ",
") {\n          discard;\n        }\n\n        gl_FragColor \x3d premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "],["\n      vec4 fillPixelColor \x3d vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize \x3d 128.0;\n      const float texelSize \x3d 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\n      vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist \x3d d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor \x3d clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *\x3d fillAlphaFactor;\n\n      if (outlineSize \x3e 0.25) {\n        vec4 outlinePixelColor \x3d outlineColor;\n        float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor \x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *\x3d outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor \x3c ",
" ||\n          fillPixelColor.a + outlinePixelColor.a \x3c ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor \x3c ",
") {\n          discard;\n        }\n\n        gl_FragColor \x3d premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),k,r.glsl.float(q.symbolAlphaCutoff),k):r.glsl(L||(L=m(["\n          vec4 texColor \x3d texture2D(tex, vtc, -0.5);\n          if (texColor.a \x3c ",") {\n            discard;\n          }\n          gl_FragColor \x3d texColor * premultiplyAlpha(vcolor);\n          "],
["\n          vec4 texColor \x3d texture2D(tex, vtc, -0.5);\n          if (texColor.a \x3c ",") {\n            discard;\n          }\n          gl_FragColor \x3d texColor * premultiplyAlpha(vcolor);\n          "])),k),b.debugDrawBorder?r.glsl(O||(O=m(["gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"],["gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"]))):"");0===b.output&&e.fragment.code.add(r.glsl(N||(N=m(["\n    void main() {\n      ","\n    }\n    "],
["\n    void main() {\n      ","\n    }\n    "])),g));4===b.output&&(e.include(a.OutputHighlight),e.fragment.code.add(r.glsl(M||(M=m(["\n    void main() {\n      ","\n      ","\n    }\n    "],["\n    void main() {\n      ","\n      ","\n    }\n    "])),g,b.binaryHighlightOcclusionEnabled?r.glsl(Q||(Q=m(["\n          if (voccluded \x3d\x3d 1.0) {\n            gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n          }"],["\n          if (voccluded \x3d\x3d 1.0) {\n            gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):
"outputHighlight();")));return e};(function(a){a.bindUniforms=function(a,c,b){a.setUniform4fv("materialColor",c.color);c.textureIsSignedDistanceField&&(0>=c.outlineColor[3]||0>=c.outlineSize?(a.setUniform4fv("outlineColor",e.vec4f64.ZEROS),a.setUniform1f("outlineSize",0)):(a.setUniform4fv("outlineColor",c.outlineColor),a.setUniform1f("outlineSize",c.outlineSize)));b=b.pixelRatio||1;a.setUniform2f("screenOffset",2*c.screenOffset[0]*b,2*c.screenOffset[1]*b);a.setUniform2fv("anchorPos",w(c))}})(b.HUDMaterial||
(b.HUDMaterial={}));b.calculateAnchorPosForRendering=w;var v=g.vec2f64.create(),z,y,A,B,C,F,E,G,H,D,I,L,O,K,N,Q,M})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces"],function(n,b,m,k,g){function e(b,e){b.include(k.ScreenSizePerspective);b.attributes.add("position","vec3");b.attributes.add("normal","vec3");b.attributes.add("auxpos1",
"vec4");b.vertex.uniforms.add("proj","mat4");b.vertex.uniforms.add("view","mat4");b.vertex.uniforms.add("viewNormal","mat4");b.vertex.uniforms.add("model","mat4");b.vertex.uniforms.add("modelNormal","mat4");b.vertex.uniforms.add("viewport","vec4");b.vertex.uniforms.add("camPos","vec3");b.vertex.uniforms.add("polygonOffset","float");b.vertex.uniforms.add("cameraGroundRelative","float");b.vertex.uniforms.add("pixelRatio","float");b.vertex.uniforms.add("perDistancePixelRatio","float");b.vertex.uniforms.add("uRenderTransparentlyOccludedHUD",
"float");e.verticalOffsetEnabled&&b.vertex.uniforms.add("verticalOffset","vec4");e.screenSizePerspectiveEnabled&&b.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4");b.vertex.uniforms.add("hudVisibilityTexture","sampler2D");b.vertex.defines.addFloat("SMALL_OFFSET_ANGLE",.984807753012208);b.vertex.code.add(g.glsl(f||(f=m(["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "],["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "]))));
b.vertex.code.add(g.glsl(l||(l=m(["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign \x3d sign(pointGroundDistance);\n\n      if (pointGroundSign \x3d\x3d 0.0) {\n        pointGroundSign \x3d cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative \x3d cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset \x3e .0) {\n        float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor \x3d (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative \x3e 0.0) {\n          posView *\x3d factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /\x3d factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "],
["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign \x3d sign(pointGroundDistance);\n\n      if (pointGroundSign \x3d\x3d 0.0) {\n        pointGroundSign \x3d cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative \x3d cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset \x3e .0) {\n        float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor \x3d (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative \x3e 0.0) {\n          posView *\x3d factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /\x3d factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "]))));
b.vertex.code.add(g.glsl(h||(h=m(["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera \x3d length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset \x3d distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset \x3d normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel +\x3d modelOffset;\n      posView +\x3d viewOffset;\n    }\n  "],
["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera \x3d length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset \x3d distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset \x3d normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel +\x3d modelOffset;\n      posView +\x3d viewOffset;\n    }\n  "]))));
b.vertex.code.add(g.glsl(c||(c=m(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset \x3d auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance \x3d auxpos1.w;\n\n      aux.posModel \x3d (model * vec4(position, 1.0)).xyz;\n      aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal \x3d (modelNormal * vec4(normal, 1.0)).xyz;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera \x3d length(aux.posView);\n\n      vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\n      float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle \x3d abs(cosAngle);\n\n      ",
"\n\n      ","\n\n      ","\n\n      float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "],["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset \x3d auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance \x3d auxpos1.w;\n\n      aux.posModel \x3d (model * vec4(position, 1.0)).xyz;\n      aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal \x3d (modelNormal * vec4(normal, 1.0)).xyz;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera \x3d length(aux.posView);\n\n      vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\n      float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle \x3d abs(cosAngle);\n\n      ",
"\n\n      ","\n\n      ","\n\n      float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),e.screenSizePerspectiveEnabled?e.verticalOffsetEnabled||1===e.screenCenterOffsetUnitsEnabled?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":
"":"",e.verticalOffsetEnabled?e.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":"",e.verticalOffsetEnabled?g.glsl(d||(d=m(["\n            float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset \x3d aux.vnormal * worldOffset;\n            aux.posModel +\x3d modelOffset;\n            vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView +\x3d viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance +\x3d worldOffset;"],
["\n            float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset \x3d aux.vnormal * worldOffset;\n            aux.posModel +\x3d modelOffset;\n            vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView +\x3d viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance +\x3d worldOffset;"]))):
"",1!==e.screenCenterOffsetUnitsEnabled?g.glsl(a||(a=m(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z !\x3d 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z !\x3d 0.0) {\n              aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\n            }\n          "],
["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z !\x3d 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z !\x3d 0.0) {\n              aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",
1===e.screenCenterOffsetUnitsEnabled?e.screenSizePerspectiveEnabled?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":"",1===e.screenCenterOffsetUnitsEnabled?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""));b.vertex.code.add(g.glsl(q||(q=m(["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -\x3e fully transparent)\n      // note that we also check against green \x3d\x3d 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD \x3d 0.75\n        return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\n    }\n  "],
["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -\x3e fully transparent)\n      // note that we also check against green \x3d\x3d 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD \x3d 0.75\n        return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\n    }\n  "]))))}
Object.defineProperty(b,"__esModule",{value:!0});b.HUD=e;(function(a){(function(a){a[a.OCCLUDED=0]="OCCLUDED";a[a.NOTOCCLUDED=1]="NOTOCCLUDED";a[a.BOTH=2]="BOTH";a[a.COUNT=3]="COUNT"})(a.TransparentRenderStyle||(a.TransparentRenderStyle={}));a.bindUniforms=function(c,b){c.setUniform1f("uRenderTransparentlyOccludedHUD",b.renderTransparentlyOccludedHUD===a.TransparentRenderStyle.OCCLUDED?1:b.renderTransparentlyOccludedHUD===a.TransparentRenderStyle.NOTOCCLUDED?0:.75)};a.bindVisibilityTexture=function(a,
c,b){c.setUniform1i("hudVisibilityTexture",1);a.bindTexture(b.hudVisibilityTexture,1);a.setActiveTexture(0)}})(e=b.HUD||(b.HUD={}));var f,l,h,d,a,c,q})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces","../../../materials/internal/MaterialUtil"],function(n,b,m,k,g){function e(b){b.vertex.code.add(k.glsl(f||(f=m(["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize \x3d 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\n                                      // proportionally scaled padding\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "],
["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize \x3d 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\n                                      // proportionally scaled padding\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "]))));
b.vertex.code.add(k.glsl(l||(l=m(["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "],["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "]))));b.vertex.code.add(k.glsl(h||(h=m(["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\n    }\n  "],
["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\n    }\n  "]))));b.vertex.code.add(k.glsl(d||(d=m(["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "],
["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "]))));b.vertex.code.add(k.glsl(a||(a=m(["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "],
["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "]))));b.vertex.code.add(k.glsl(c||(c=m(["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "],
["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "]))));b.vertex.code.add(k.glsl(q||(q=m(["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "],
["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.ScreenSizePerspective=e;(function(a){a.bindUniforms=function(a,c){c.screenSizePerspective&&(g.bindScreenSizePerspective(c.screenSizePerspective,a,"screenSizePerspective"),g.bindScreenSizePerspective(c.screenSizePerspectiveAlignment||
c.screenSizePerspective,a))}})(e=b.ScreenSizePerspective||(b.ScreenSizePerspective={}));var f,l,h,d,a,c,q})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.HUDOcclusionPass=function(b){b.vertex.code.add(k.glsl(g||(g=m(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) \x3e 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n      posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position \x3d posProjCenter;\n    gl_PointSize \x3d 1.0;\n  }\n  "],
["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) \x3e 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n      posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position \x3d posProjCenter;\n    gl_PointSize \x3d 1.0;\n  }\n  "]))));
b.fragment.uniforms.add("color","vec4");b.fragment.code.add(k.glsl(e||(e=m(["\n  void main() {\n    gl_FragColor \x3d color;\n  }\n  "],["\n  void main() {\n    gl_FragColor \x3d color;\n  }\n  "]))))};(function(b){b.bindUniforms=function(b){b.setUniform4f("color",1,1,1,1)}})(b.HUDOcclusion||(b.HUDOcclusion={}));var g,e})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],
function(n,b,m,k){function g(b){b.fragment.uniforms.add("depthTex","sampler2D");b.fragment.uniforms.add("highlightViewportPixelSz","vec4");b.fragment.code.add(k.glsl(e||(e=m(["\n    void outputHighlight() {\n      vec4 fragCoord \x3d gl_FragCoord;\n\n      float sceneDepth \x3d texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z \x3e sceneDepth + 5e-7) {\n        gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "],
["\n    void outputHighlight() {\n      vec4 fragCoord \x3d gl_FragCoord;\n\n      float sceneDepth \x3d texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z \x3e sceneDepth + 5e-7) {\n        gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.OutputHighlight=g;(function(b){b.bindOutputHighlight=
function(b,e,d){b.bindTexture(d.highlightDepthTexture,5);e.setUniform1i("depthTex",5);e.setUniform4f("highlightViewportPixelSz",0,0,1/d.viewport[2],1/d.viewport[3])}})(g=b.OutputHighlight||(b.OutputHighlight={}));var e})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){function g(b,g){g.vvInstancingEnabled&&(g.vvSize||g.vvColor)&&
b.attributes.add("instanceFeatureAttribute","vec4");g.vvSize?(b.vertex.uniforms.add("vvSizeMinSize","vec3"),b.vertex.uniforms.add("vvSizeMaxSize","vec3"),b.vertex.uniforms.add("vvSizeOffset","vec3"),b.vertex.uniforms.add("vvSizeFactor","vec3"),b.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),b.vertex.uniforms.add("vvSymbolAnchor","vec3"),b.vertex.code.add(k.glsl(e||(e=m(["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "],
["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "])))),b.vertex.code.add(k.glsl(l||(l=m(["\n      const float eps \x3d 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale \x3d clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ",
"\n    "],["\n      const float eps \x3d 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale \x3d clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ","\n    "])),g.vvInstancingEnabled?k.glsl(f||(f=m(["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"],
["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"]))):""))):b.vertex.code.add(k.glsl(h||(h=m(["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "],["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "]))));
g.vvColor?(b.vertex.defines.addInt("VV_COLOR_N",8),b.vertex.code.add(k.glsl(a||(a=m(["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value \x3d featureAttribute.y;\n        if (value \x3c\x3d values[0]) {\n          return colors[0];\n        }\n\n        for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n          if (values[i] \x3e\x3d value) {\n            float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ",
"\n    "],["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value \x3d featureAttribute.y;\n        if (value \x3c\x3d values[0]) {\n          return colors[0];\n        }\n\n        for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n          if (values[i] \x3e\x3d value) {\n            float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ",
"\n    "])),g.vvInstancingEnabled?k.glsl(d||(d=m(["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"],["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"]))):""))):b.vertex.code.add(k.glsl(c||(c=m(["\n      vec4 vvColor() { return vec4(1.0); }\n    "],["\n      vec4 vvColor() { return vec4(1.0); }\n    "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.VisualVariables=
g;(function(a){function c(a,c){c.vvSizeEnabled&&(a.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",c.vvSizeOffset),a.setUniform3fv("vvSizeFactor",c.vvSizeFactor));c.vvColorEnabled&&(a.setUniform1fv("vvColorValues",c.vvColorValues),a.setUniform4fv("vvColorColors",c.vvColorColors))}a.bindUniforms=c;a.bindUniformsWithOpacity=function(a,b){c(a,b);b.vvOpacityEnabled&&(a.setUniform1fv("vvOpacityValues",b.vvOpacityValues),a.setUniform1fv("vvOpacityOpacities",
b.vvOpacityOpacities))};a.bindUniformsForSymbols=function(a,b){c(a,b);b.vvSizeEnabled&&(a.setUniform3fv("vvSymbolAnchor",b.vvSymbolAnchor),a.setUniformMatrix3fv("vvSymbolRotationMatrix",b.vvSymbolRotationMatrix))}})(g=b.VisualVariables||(b.VisualVariables={}));var e,f,l,h,d,a,c})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,
k){Object.defineProperty(b,"__esModule",{value:!0});b.defaultMaskAlphaCutoff=.1;b.symbolAlphaCutoff=.001;b.DiscardOrAdjustAlpha=function(b,d){var a=b.fragment;switch(d.alphaDiscardMode){case 0:a.code.add(k.glsl(g||(g=m(["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "],["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "]))));break;case 1:a.code.add(k.glsl(e||(e=m(["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a \x3d 1.0;\n        }\n      "],
["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a \x3d 1.0;\n        }\n      "]))));break;case 2:a.uniforms.add("textureAlphaCutoff","float");a.code.add(k.glsl(f||(f=m(["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } else { color.a \x3d 1.0; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } else { color.a \x3d 1.0; } }\n      "]))));break;case 3:b.fragment.uniforms.add("textureAlphaCutoff",
"float"),b.fragment.code.add(k.glsl(l||(l=m(["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } }\n      "]))))}};var g,e,f,l})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/hud/HUDOcclusionPass.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderLibrary/util/ScreenSizePerspective.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./HUDMaterial.glsl ./HUDMaterial.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A){Object.defineProperty(b,"__esModule",{value:!0});g=function(b){function g(){return null!==b&&b.apply(this,arguments)||this}m(g,b);g.prototype.initializeProgram=function(a){var c=g.shader.get(),b=this.configuration,c=c.build({output:b.output,viewingMode:a.viewingMode,occlusionTestEnabled:b.occlusionTestEnabled,signedDistanceFieldEnabled:b.sdf,slicePlaneEnabled:b.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:b.debugDrawBorder,
binaryHighlightOcclusionEnabled:b.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:b.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:b.screenSizePerspective,verticalOffsetEnabled:b.verticalOffset,vvSize:b.vvSize,vvColor:b.vvColor,vvInstancingEnabled:!1});return new z(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),x.Default3D)};g.prototype.bindPass=function(b,e,f){this.program.setUniform1f("cameraGroundRelative",f.cameraAboveGround?1:-1);this.program.setUniform1f("perDistancePixelRatio",
Math.tan(f.fovY/2)/(f.viewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",f.viewInvTransp);this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset);l.VerticalOffset.bindUniforms(this.program,e,f);p.ScreenSizePerspective.bindUniforms(this.program,e);q.Viewport.bindUniforms(this.program,f);6===this.configuration.output?d.HUDOcclusion.bindUniforms(this.program):(h.HUD.bindUniforms(this.program,f),v.HUDMaterial.bindUniforms(this.program,e,f),c.VisualVariables.bindUniforms(this.program,
e),this.configuration.occlusionTestEnabled&&h.HUD.bindVisibilityTexture(b,this.program,f));4===this.configuration.output&&a.OutputHighlight.bindOutputHighlight(b,this.program,f)};g.prototype.bindDraw=function(a){f.Transform.bindUniforms(this.program,a);q.Camera.bindUniforms(this.program,a);e.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};g.prototype.initializePipeline=function(){return 4===this.configuration.output?A.makePipelineState({blending:y.separateBlendingParams(1,1,771,771),
polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},colorWrite:A.defaultColorWriteParams}):6===this.configuration.output?A.makePipelineState({depthTest:{func:515},depthWrite:A.defaultDepthWriteParams,colorWrite:A.defaultColorWriteParams}):A.makePipelineState({blending:y.simpleBlendingParams(1,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:this.configuration.depthEnabled?515:519},depthWrite:this.configuration.depthEnabled?
A.defaultDepthWriteParams:void 0,colorWrite:A.defaultColorWriteParams})};Object.defineProperty(g.prototype,"primitiveType",{get:function(){return 6===this.configuration.output?0:4},enumerable:!0,configurable:!0});g.shader=new t.ReloadableShaderModule(w,"./HUDMaterial.glsl",n);return g}(u.ShaderTechnique);b.HUDMaterialTechnique=g;g=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.output=0;c.occlusionTestEnabled=!0;c.sdf=!1;c.vvSize=!1;c.vvColor=!1;c.verticalOffset=!1;c.screenSizePerspective=
!1;c.screenCenterOffsetUnitsEnabled=0;c.debugDrawBorder=!0;c.binaryHighlightOcclusion=!0;c.slicePlaneEnabled=!1;c.polygonOffsetEnabled=!1;c.depthEnabled=!0;return c}m(c,a);k([r.parameter({count:7})],c.prototype,"output",void 0);k([r.parameter()],c.prototype,"occlusionTestEnabled",void 0);k([r.parameter()],c.prototype,"sdf",void 0);k([r.parameter()],c.prototype,"vvSize",void 0);k([r.parameter()],c.prototype,"vvColor",void 0);k([r.parameter()],c.prototype,"verticalOffset",void 0);k([r.parameter()],
c.prototype,"screenSizePerspective",void 0);k([r.parameter({count:2})],c.prototype,"screenCenterOffsetUnitsEnabled",void 0);k([r.parameter()],c.prototype,"debugDrawBorder",void 0);k([r.parameter()],c.prototype,"binaryHighlightOcclusion",void 0);k([r.parameter()],c.prototype,"slicePlaneEnabled",void 0);k([r.parameter()],c.prototype,"polygonOffsetEnabled",void 0);k([r.parameter()],c.prototype,"depthEnabled",void 0);return c}(r.ShaderTechniqueConfiguration);b.HUDMaterialTechniqueConfiguration=g})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces"],function(n,b,m,k,g){function e(b,e){var f=b.vertex.code;e.verticalOffsetEnabled?(b.vertex.uniforms.add("verticalOffset","vec4"),e.screenSizePerspectiveEnabled&&(b.include(k.ScreenSizePerspective),b.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),f.add(g.glsl(q||(q=m(["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance \x3d length((view * vec4(worldPos, 1.0)).xyz);\n      ",
"\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "],["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance \x3d length((view * vec4(worldPos, 1.0)).xyz);\n      ",
"\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "])),0===e.viewingMode?g.glsl(h||(h=m(["vec3 worldNormal \x3d normalize(worldPos + localOrigin);"],
["vec3 worldNormal \x3d normalize(worldPos + localOrigin);"]))):g.glsl(d||(d=m(["vec3 worldNormal \x3d vec3(0.0, 0.0, 1.0);"],["vec3 worldNormal \x3d vec3(0.0, 0.0, 1.0);"]))),e.screenSizePerspectiveEnabled?g.glsl(a||(a=m(["\n          float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"],["\n          float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"]))):
g.glsl(c||(c=m(["\n          float verticalOffsetScreenHeight \x3d verticalOffset.x;"],["\n          float verticalOffsetScreenHeight \x3d verticalOffset.x;"])))))):f.add(g.glsl(p||(p=m(["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "],["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "]))))}function f(a,c,b,d){void 0===d&&(d=l);d.screenLength=a.screenLength;d.perDistance=Math.tan(.5*c)/(.5*b);d.minWorldLength=a.minWorldLength;
d.maxWorldLength=a.maxWorldLength;return d}Object.defineProperty(b,"__esModule",{value:!0});b.VerticalOffset=e;(function(a){a.bindUniforms=function(a,c,b){c.verticalOffset&&(c=f(c.verticalOffset,b.fovY,b.viewport[3]),a.setUniform4f("verticalOffset",c.screenLength*(b.pixelRatio||1),c.perDistance,c.minWorldLength,c.maxWorldLength))}})(e=b.VerticalOffset||(b.VerticalOffset={}));b.calculateVerticalOffsetFactors=f;var l={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0},h,d,a,c,q,p})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/now ../../../../core/accessorSupport/decorators ./Deconflictor".split(" "),
function(n,b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function f(){var d=null!==b&&b.apply(this,arguments)||this;d.visibilityGroup=1;d.iconMarginFactor=0;d._lastDeconfliction=0;return d}k(f,b);Object.defineProperty(f.prototype,"slicePlaneViewSpace",{get:function(){return this.parent.slicePlaneViewSpace},enumerable:!0,configurable:!0});f.prototype.update=function(b){if(!this.parent.needsUpdate()){var a=g();if(2===b.state||2E3<a-this._lastDeconfliction)this.inherited(arguments,
[b]),0===this.state&&(this._lastDeconfliction=a)}};f.prototype.enabledChanged=function(b,a){this.modifyGraphics(a,b.labelsEnabled)};f.prototype.getGraphicsLayers=function(b){return b.labelGraphics};m([e.property({constructOnly:!0})],f.prototype,"parent",void 0);return f=m([e.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],f)}(e.declared(f.Deconflictor));b.LabelDeconflictor=n})},"esri/views/3d/layers/graphics/Labeler":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../layers/support/layerUtils ../../../../symbols/callouts/calloutUtils ./Graphics3DCalloutSymbolLayerFactory ./graphicSymbolUtils ./labelPlacement ../../support/debugFlags ../../webgl-engine/lib/Layer ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../../support/Scheduler".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G){Object.defineProperty(b,"__esModule",{value:!0});var H=d.getLogger("esri.views.3d.layers.graphics.Labeler");n=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.idHint="__labeler";a._dirty=!1;a.labels=new Map;a.labelsToAdd=new Map;a.labelsToRemove=new Map;a.labelingContexts=[];return a}m(d,b);d.prototype.setup=function(){var a=this;this.handles||(this.handles=new h,this.handles.add([this.view.watch("state.camera",
function(){return a.setDirty()}),this.view.watch("pixelRatio",function(){return a.resetAllLabels()})]));this.textTextureAtlas||(this.textTextureAtlas=new E.default({idHint:this.idHint+"_atlas",view:this.view}),this.hudMaterialCollection=new B(this.view._stage),this.calloutMaterialCollection=new B(this.view._stage));this.handles.add(this.view.resourceController.scheduler.registerTask(G.Task.LABELER,function(c){return a.update(c)},function(){return a.needsUpdate()}))};d.prototype.dispose=function(){this.handles&&
(this.handles.destroy(),this.handles=null);this.textTextureAtlas&&(this.textTextureAtlas.dispose(),this.textTextureAtlas=null);this.hudMaterialCollection&&(this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null);this.calloutMaterialCollection&&(this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null);this.labelingContexts=[];this.labels.clear();this.labelsToAdd.clear();this.labelsToRemove.clear()};d.prototype.isActiveLabelingContext=function(a){return a.active&&
r.areLabelsVisible(a.layer)};d.prototype.activateLabelingContext=function(a){var c=this;a.labels.forEach(function(a,b){c.labels.set(b,a);a.graphics3DGraphic.setVisibilityFlag(0,!0,1)});a.active=!0};d.prototype.deactivateLabelingContext=function(a){var c=this;a.labels.forEach(function(a,b){a.graphics3DGraphic.setVisibilityFlag(0,!1,1);c.setLabelGraphicVisibility(a.graphics3DGraphic,!1);c.labels.delete(b)});a.active=!1};d.prototype.addLabelTextureToAtlas=function(a){for(var c=0,b=a.graphics3DGraphic.labelGraphics;c<
b.length;c++){var d=b[c];if(d._labelClass){var e=a.textRenderers[d._labelIndex];e&&this.textTextureAtlas.addTextTexture(e,d.stageObject)}}a.rendered=!0};d.prototype.removeLabelTextureFromAtlas=function(a){for(var c=0,b=a.graphics3DGraphic.labelGraphics;c<b.length;c++){var d=b[c];if(d._labelClass){var e=a.textRenderers[d._labelIndex];e&&this.textTextureAtlas.removeTextTexture(e,d.stageObject)}}a.rendered=!1};d.prototype.needsUpdate=function(){return this.view.ready&&this.isDirty};d.prototype.update=
function(a){this._updateLabels(a);!this._dirty&&this.deconflictor.needsUpdate()&&this.deconflictor.update(a)};d.prototype._updateLabels=function(c){var b=this;if(this._dirty){this._dirty=!1;for(var d=function(d){if(!e.isActiveLabelingContext(d))return"continue";if(!e.hasValidLabelClassContext(d)){if(e.hasInvalidLabelClassContext(d))return e.deactivateLabelingContext(d),"continue";e.createLabelClassContext(d);if(e.hasPendingLabelClassContext(d))return e._dirty=!0,"continue";if(!e.hasValidLabelClassContext(d))return"continue"}a.someMap(d.labelsToInitialize,
function(a,e){b.ensureGraphics3DResources(a)&&(b.labels.set(e,a),b.deconflictor.setDirty(),c.madeProgress());if(a.visible&&a.hasTextTextureResources||!a.visible&&a.hasGraphics3DResources)d.labelsToInitialize.delete(e),c.madeProgress();return c.done})&&(e._dirty=!0)},e=this,f=0,h=this.labelingContexts;f<h.length;f++)d(h[f]);this.labelsToRemove.forEach(function(a){return b.removeLabelTextureFromAtlas(a)});this.labelsToRemove.clear();this.labelsToAdd.forEach(function(a){return b.addLabelTextureToAtlas(a)});
this.labelsToAdd.clear();this._dirty||this.notifyChange("updating")}};d.prototype.hasPendingLabelClassContext=function(a){return a.labelClassPromise&&!!a.labelClassAbortController};d.prototype.hasValidLabelClassContext=function(a){return a.labelClassContexts&&a.labelClassContexts.length};d.prototype.hasInvalidLabelClassContext=function(a){return null===a.labelClassContexts};d.prototype.createLabelClassContextAsync=function(a){return e(this,void 0,void 0,function(){var c,b,d,f,h,k,p=this;return g(this,
function(m){switch(m.label){case 0:return c=a.labelClassAbortController.signal,[4,a.layer.when()];case 1:m.sent();q.throwIfAborted(c);a.scaleVisibility&&a.scaleVisibility.updateScaleRangeActive();b=a.graphics3DCore;d=b.layer;f=d.labelingInfo&&d.labelingInfo.filter(function(a){return!!a.symbol});if(!f||0===f.length)return[2];h=Array(f.length);k=!1;return[4,l.forEach(f,function(d,f){return e(p,void 0,void 0,function(){var e,p,m,r;return g(this,function(g){switch(g.label){case 0:return e=d.symbol,p=
v.getGraphics3DSymbol(b.getOrCreateGraphics3DSymbol(e)),[4,p.load()];case 1:g.sent();q.throwIfAborted(c);m=null;if(!x.isCalloutSupport(e)||!e.hasVisibleCallout())return[3,3];m=w.make(e,b.symbolCreationContext);return[4,m.load()];case 2:g.sent(),q.throwIfAborted(c),g.label=3;case 3:return[4,l.result(u.createLabelFunction(d,a.layer.fields.map(function(a){return a.toJSON()}),this.view.spatialReference))];case 4:return r=g.sent(),q.throwIfAborted(c),!0===r.ok?h[f]={labelClass:d,labelFunction:r.value,
graphics3DSymbol:p,graphics3DCalloutSymbolLayer:m,calloutSymbolLayerIndex:0,textRenderParameters:this.createTextRenderParameters(p.symbol)}:(H.error("Label expression failed to evaluate: "+r.error),k=!0),[2]}})})})];case 2:m.sent();q.throwIfAborted(c);if(k)return[2];a.labelClassContexts=h;return[2]}})})};d.prototype.createLabelClassContext=function(a){return e(this,void 0,void 0,function(){var c=this;return g(this,function(b){a.labelClassPromise||(a.labelClassPromise=this.createLabelClassContextAsync(a).catch(function(c){if(q.isAbortError(c))throw c;
a.labelClassContexts=null}).then(function(){a.labelClassAbortController=null;c.notifyChange("updating")}).catch(function(){}),this.notifyChange("updating"));return[2,a.labelClassPromise]})})};d.prototype.createTextRenderParameters=function(a){return(a=a.symbolLayers.getItemAt(0))&&"text"===a.type?F.default.fromSymbol(a,this.view.pixelRatio):null};d.prototype.destroyLabelClassContext=function(a){for(var c=0,b=a.labelClassContexts;c<b.length;c++){var d=b[c];--d.graphics3DSymbol.referenced;d.graphics3DSymbol=
null}c=a.labelClassAbortController;a.labelClassAbortController=q.createAbortController();c&&c.abort();a.labelClassContexts=[];a.labelClassPromise=null;this.notifyChange("updating")};d.prototype.createTextSymbolGraphic=function(a,c,b,d,e){a={text:a.text,centerOffset:b.centerOffset,translation:b.translation,elevationOffset:b.elevationOffset,screenOffset:b.screenOffset,anchor:b.anchor,centerOffsetUnits:b.centerOffsetUnits,verticalOffset:b.verticalOffset,debugDrawBorder:y.LABELS_SHOW_BORDER,displayWidth:a.displayWidth,
displayHeight:a.displayHeight};D.graphic=c;D.renderingInfo=null;D.layer=d;return e.createLabel(D,a,this.hudMaterialCollection,this.textTextureAtlas)};d.prototype.createLineCalloutGraphic=function(a,c,b,d,e){c={symbol:c,translation:d.translation,elevationOffset:d.elevationOffset,screenOffset:d.screenOffset,centerOffset:d.centerOffset,centerOffsetUnits:d.centerOffsetUnits,materialCollection:this.calloutMaterialCollection};D.graphic=a;D.renderingInfo=c;D.layer=e;return b.createGraphics3DGraphic(D)};
d.prototype.ensureGraphics3DResources=function(a){if(a.hasGraphics3DResources)return!1;var b=a.graphics3DGraphic;if(b.destroyed)return!1;this.ensureTextTextureResources(a);var d=a.labelingContext,e=d.labelClassContexts;if(!e||0===e.length||!d.emptySymbolLabelSupported&&0===b._graphics.length)return!1;for(var f=!1,h=b.graphic,l=d.layer,g=r.areLabelsVisible(d.layer),k=this.view._stage,p=0;p<e.length;p++){var m=a.textRenderers[p];if(m){var q=e[p],u=q.graphics3DSymbol,t=null;u.symbol&&"label-3d"===u.symbol.type&&
(t=u.symbol);var v=u.symbolLayers[0];if(v){var u=q.labelClass,y=z.get({graphics3DGraphic:b,labelSymbol:t,labelClass:u,disablePlacement:d.disablePlacement});if(!c.isNone(y)){v.setElevationInfoOverride(d.elevationInfoOverride);f=this.createTextSymbolGraphic(m,h,y,l,v);if(!f)return!1;f._labelClass=u;f._labelIndex=p;b.addLabelGraphic(f,k,d.stageLayer);b.setVisibilityFlag(0,g,1);b.clearVisibilityFlag(1,1);b.setVisibilityFlag(3,!1,1);f=!0;q.graphics3DCalloutSymbolLayer&&y.hasLabelVerticalOffset&&(h=this.createLineCalloutGraphic(h,
t,q.graphics3DCalloutSymbolLayer,y,l))&&(q.calloutSymbolLayerIndex=b.labelGraphics.length,b.addLabelGraphic(h,k,d.stageLayer));break}}}}d.scaleVisibility&&f&&d.scaleVisibility.updateGraphicLabelScaleVisibility(b);return a.hasGraphics3DResources=!0};d.prototype.destroyGraphics3DResources=function(a){for(var c=a.labelingContext.labelClassContexts,b=0,d=a.graphics3DGraphic.labelGraphics;b<d.length;b++){var e=d[b];if(null!=e._labelClass){var f=c[e._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=
f)f.onRemoveGraphic(e)}}a.graphics3DGraphic.clearLabelGraphics();a.hasGraphics3DResources=!1};d.prototype.ensureTextTextureResources=function(a){if(!a.hasTextTextureResources){var b=a.labelingContext,d=b.labelClassContexts;if(d&&0!==d.length){for(var e=a.graphics3DGraphic.graphic,f=0;f<d.length;f++){var h=d[f];a.textRenderers[f]=null;if(h.textRenderParameters){var l=h.labelFunction,g=void 0;if("arcade"===l.type)try{var k=l.needsHydrationToEvaluate()?t.hydrateGraphic(e,b.layer):e,g=l.evaluate(k)}catch(J){g=
null}else g=l.evaluate(e);c.isNone(g)||""===g||(a.textRenderers[f]=new C.default(g,h.textRenderParameters))}}a.hasTextTextureResources=!0}}};d.prototype.destroyTextTextureResources=function(a){a.textRenderers=[];a.hasTextTextureResources=!1};d.prototype.addGraphic=function(a,c){var b={hasGraphics3DResources:!1,hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:a,graphics3DGraphic:c,textRenderers:[]};c=c.graphic.uid;a.labels.set(c,b);a.labelsToInitialize.set(c,b);this.setDirty();this.deconflictor.setDirty()};
d.prototype.removeGraphic=function(a,c){c=c.graphic.uid;var b=a.labels.get(c);b&&(this.destroyGraphic(b,c),a.labels.delete(c),a.labelsToInitialize.delete(c),this.setDirty(),this.deconflictor.setDirty())};d.prototype.destroyGraphic=function(a,c){this.labels.has(c)&&(this.labels.delete(c),this.labelsToAdd.delete(c),this.labelsToRemove.delete(c));a.hasTextTextureResources&&(this.removeLabelTextureFromAtlas(a),this.destroyTextTextureResources(a));a.hasGraphics3DResources&&this.destroyGraphics3DResources(a)};
d.prototype.labelingInfoChange=function(a,c){return e(this,void 0,void 0,function(){var b,d,e,f;return g(this,function(h){if(c){b=0;for(d=c;b<d.length;b++)if(e=d[b],f=a.labels.get(e))this.removeGraphic(a,f.graphics3DGraphic),this.addGraphic(a,f.graphics3DGraphic);return[2]}this.visibilityInfoChange(a);this.resetLabels(a);return[2,this.createLabelClassContext(a)]})})};d.prototype.globalPropertyChanged=function(a,b){for(var d=function(d){var e=new Map;b.labels.forEach(function(a){a=a.graphics3DGraphic;
e.set(a.graphic.uid,a)});c.expect(d.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(a,e,function(a){return a.labelGraphics[0]});d.graphics3DCalloutSymbolLayer&&d.graphics3DCalloutSymbolLayer.globalPropertyChanged(a,e,function(a){return a.labelGraphics[d.calloutSymbolLayerIndex]})},e=0,f=b.labelClassContexts;e<f.length;e++)d(f[e])};d.prototype.visibilityInfoChange=function(a){var c=a.layer.labelsVisible;c&&!a.active&&this.activateLabelingContext(a);!c&&a.active&&this.deactivateLabelingContext(a);
this.setDirty()};d.prototype.resetAllLabels=function(){for(var a=0,c=this.labelingContexts;a<c.length;a++)this.resetLabels(c[a])};d.prototype.resetLabels=function(a){var c=this;a.labels.forEach(function(b,d){c.destroyGraphic(b,d);b.visible=!1;b.rendered=!1;a.labelsToInitialize.set(d,b)});this.destroyLabelClassContext(a);this.setDirty();this.deconflictor.setDirty()};d.prototype.findLabelingContext=function(a){for(var c=0,b=this.labelingContexts;c<b.length;c++){var d=b[c];if(d.graphics3DCore===a)return d}return null};
d.prototype.addGraphicsOwner=function(a,c,b){var d=this,e=b&&b.emptySymbolLabelSupported||!1,f=b&&b.elevationInfoOverride||null;b=b&&b.disablePlacement||null;if(!this.findLabelingContext(a)){var h=a.layer,l={graphics3DCore:a,layer:h,scaleVisibility:c,emptySymbolLabelSupported:e,elevationInfoOverride:f,disablePlacement:b,active:h.labelsVisible,labelClassPromise:null,labelClassAbortController:q.createAbortController(),labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new A(this.idHint+
"_"+h.uid,{isPickable:!0},h.uid)};this.view._stage.add(0,l.stageLayer);this.view._stage.addToViewContent([l.stageLayer.id]);this.labelingContexts.push(l);this.setDirty();return{addGraphic:function(a){return d.addGraphic(l,a)},removeGraphic:function(a){return d.removeGraphic(l,a)},featureReductionChange:function(){},layerLabelsEnabled:function(){return r.areLabelsVisible(l.layer)},labelingInfoChange:function(a){return d.labelingInfoChange(l,a)},elevationInfoChange:function(){return d.globalPropertyChanged("elevationInfo",
l)},slicePlaneEnabledChange:function(){return d.globalPropertyChanged("slicePlaneEnabled",l)},visibilityInfoChange:function(){return d.visibilityInfoChange(l)},reset:function(){return d.resetLabels(l)},clear:function(){},processStageDirty:function(){return d.view._stage.processDirtyLayer(l.stageLayer.id)}}}};d.prototype.removeGraphicsOwner=function(a){var c=this,b=this.findLabelingContext(a);b&&(a=this.labelingContexts.indexOf(b),this.labelingContexts.splice(a,1),b.labels.forEach(function(a){return c.removeGraphic(b,
a.graphics3DGraphic)}),a=b.stageLayer.id,this.view._stage.removeFromViewContent([a]),this.view._stage.remove(0,a),b.stageLayer=null,this.setDirty())};d.prototype.setLabelGraphicVisibility=function(a,c){a=a.graphic.uid;var b=this.labels.get(a);b&&b.visible!==c&&(c&&!b.rendered?(this.labelsToAdd.set(a,b),this.labelsToRemove.delete(a),b.hasTextTextureResources||b.labelingContext.labelsToInitialize.set(a,b)):!c&&b.rendered&&(this.labelsToRemove.set(a,b),this.labelsToAdd.delete(a)),b.visible=c,this.setDirty())};
Object.defineProperty(d.prototype,"isDirty",{get:function(){return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.isDirty||this.deconflictor.needsUpdate()},enumerable:!0,configurable:!0});d.prototype.setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};Object.defineProperty(d.prototype,"updating",{get:function(){var a=this;return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.updating||this.deconflictor.updating||this.labelingContexts.some(function(c){return a.hasPendingLabelClassContext(c)})},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updatingProgress",{get:function(){var a=this;if(!this.updating||!this.textTextureAtlas)return 1;var c=0<this.labelingContexts.length?this.labelingContexts.reduce(function(c,b){return c+(a.hasPendingLabelClassContext(b)?0:1)},0)/this.labelingContexts.length:1;return(this._dirty?0:.3)+(this.textTextureAtlas.updating?0:.1)+.1*c+.5*this.deconflictor.updatingProgress},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"test",
{get:function(){return{textTextureAtlas:this.textTextureAtlas}},enumerable:!0,configurable:!0});k([p.property({constructOnly:!0})],d.prototype,"view",void 0);k([p.property({constructOnly:!0})],d.prototype,"deconflictor",void 0);k([p.property()],d.prototype,"textTextureAtlas",void 0);k([p.property({type:Boolean,readOnly:!0,dependsOn:["textTextureAtlas.updating","deconflictor.updating"]})],d.prototype,"updating",null);return d=k([p.subclass("esri.views.3d.layers.graphics.Labeler")],d)}(p.declared(f));
b.Labeler=n;var D={graphic:null,renderingInfo:null,layer:null}})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/Logger ../../core/promiseUtils ../../intl/date ../../intl/number ./FieldsIndex ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,
t){function u(){return e(this,void 0,void 0,function(){return g(this,function(a){return[2,h.create(function(a){n(["../../core/sql/WhereClause"],a)})]})})}function r(c,b,e,f){c=q.getField(f,c);if(!c)return b;if(null==e[c.name])return"";if(b=c.domain)if("codedValue"===b.type||"coded-value"===b.type){f=e[c.name];var h=0;for(b=b.codedValues;h<b.length;h++){var l=b[h];if(l.code===f)return l.name}}else if("range"===b.type&&(f=+e[c.name],h="range"in b?b.range[1]:b.maxValue,("range"in b?b.range[0]:b.minValue)<=
f&&f<=h))return b.name;e=e[c.name];"date"===c.type||"esriFieldTypeDate"===c.type?e=d.formatDate(e,d.convertDateFormatToIntlOptions("short-date")):q.isNumericField(c)&&(e=a.formatNumber(+e));return e?e:""}Object.defineProperty(b,"__esModule",{value:!0});var x=l.getLogger("esri.layers.support.labelFormatUtils"),w={type:"simple",evaluate:function(){return null}};b.createLabelFunction=function(a,b,d){return e(this,void 0,void 0,function(){var e,h,l,k,m,q,v,y;return g(this,function(g){switch(g.label){case 0:if(!a||
!a.symbol)return[2,w];e=a.where;h=a.getLabelExpression();return e?[4,u()]:[3,2];case 1:return k=g.sent(),[3,3];case 2:k=null,g.label=3;case 3:return l=k,"arcade"!==h.type?[3,5]:[4,t.createLabelExpression(h.expression,d,b)];case 4:return q=g.sent(),m={type:"arcade",evaluate:function(a){try{var c=q.evaluate({$feature:q.repurposeFeature(a)});if(null!=c)return c.toString()}catch(K){x.error(new f("bad-arcade-expression","Encountered an error when evaluating label expression for feature",{feature:a,expression:h}))}return null},
needsHydrationToEvaluate:function(){return null==p.getSingleFieldArcadeExpression(h.expression)}},[3,6];case 5:m={type:"simple",evaluate:function(a){var c=a&&a.attributes;return c?h.expression.replace(/{[^}]*}/g,function(a){return r(a.slice(1,-1),a,c,b)}):null}},g.label=6;case 6:if(e){try{v=l.WhereClause.create(e,new c(b))}catch(L){return[2,w]}y=m.evaluate;m.evaluate=function(a){return v.testFeature(a)?y(a):null}}return[2,m]}})})};b.formatField=r})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require",
"exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});var e=m.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");b.make=function(b,h){if(!k.isCalloutSupport(b))return e.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+b.type+"' does not support callouts"),null;if(!b.callout)return null;var d=f[b.callout.type];return d?new d(b,
h):(e.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+b.callout.type),null)};var f={line:g.default}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w){Object.defineProperty(b,"__esModule",{value:!0});var v,z,y=x.VertexAttrConstants;n=function(c){function b(a,b){a=c.call(this,a,null,b,F)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};a.ensureDrapedStatus(!1);return a}m(b,c);b.prototype.doLoad=function(){return g(this,void 0,void 0,function(){return k(this,function(a){this._material=new w(this.materialParameters,this._getIdHint("_lineCallout_common"));this._context.stage.add(3,
this._material);return[2]})})};b.prototype.destroy=function(){c.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null)};b.prototype.perInstanceMaterialParameters=function(a){var c=this.materialParameters;c.screenOffset=a.screenOffset||[0,0];c.centerOffsetUnits=a.centerOffsetUnits||"world";return c};Object.defineProperty(b.prototype,"materialParameters",{get:function(){var a=this.symbol,c=a.callout,b=f.isSome(c.color)?e.toUnitRGBA(c.color):
[0,0,0,0];b[3]*=this._getLayerOpacity();var d=l.pt2px(c.size||0),h=null;if(a.verticalOffset)var h=a.verticalOffset,g=h.minWorldLength,k=h.maxWorldLength,h={screenLength:l.pt2px(h.screenLength),minWorldLength:g||0,maxWorldLength:null!=k?k:Infinity};c=f.isSome(c.border)&&f.isSome(c.border.color)?e.toUnitRGBA(c.border.color):null;g="object"===a.symbolLayers.getItemAt(0).type;return{color:b,size:d,verticalOffset:h,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:
null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:c,occlusionTest:!g,shaderPolygonOffset:g?0:void 0,depthHUDAlignStart:"label-3d"===a.type,slicePlaneEnabled:this._context.slicePlaneEnabled}},enumerable:!0,configurable:!0});b.prototype._defaultElevationInfoNoZ=function(){return C};b.prototype.createGraphics3DGraphic=function(a){var c=a.renderingInfo;a=a.graphic;var b=this.getGraphicElevationContext(a,c.elevationOffset||0),d=c.symbol,e="on-the-ground"===this._elevationContext.mode&&("cim"===
d.type||!d.symbolLayers.some(function(a){return"object"===a.type||"text"===a.type}));if("label-3d"!==d.type&&e)return null;d=q.computeCentroid(a.geometry);return f.isNone(d)?null:this._createAs3DShape(d,b,c,"graphic"+a.uid,a.uid)};b.prototype.layerOpacityChanged=function(){this._material.setParameterValues(this.materialParameters);return!0};b.prototype.layerElevationInfoChanged=function(a,c,e){var h=this;e=d.elevationModeChangeUpdateType(b.elevationModeChangeTypes,e,this._elevationContext.mode);if(e!==
d.SymbolUpdateType.UPDATE)return e;a.forEach(function(a){var b=c(a);f.isSome(b)&&h.updateGraphicElevationContext(a.graphic,b)});return e};b.prototype.slicePlaneEnabledChanged=function(){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};b.prototype.physicalBasedRenderingChanged=function(){return!0};b.prototype.pixelRatioChanged=function(){return!0};b.prototype.getGraphicElevationContext=function(a,b){void 0===b&&(b=0);a=c.prototype.getGraphicElevationContext.call(this,
a);a.addOffsetRenderUnits(b);return a};b.prototype.updateGraphicElevationContext=function(a,c){a=this.getGraphicElevationContext(a,c.metadata.elevationOffset);c.elevationContext.set(a);c.needsElevationUpdates=d.needsElevationUpdates2D(a.mode)};b.prototype.updateGeometry=function(a,c){return!1};b.prototype.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,estimated:!1,memory:t.emptySymbolComplexity.memory}};b.prototype.createVertexData=function(a){var c,b=a.translation;
a=a.centerOffset;if(!b&&!a)return A;b=b?{size:3,data:[b[0],b[1],b[2]]}:A[y.POSITION];a=a?{size:4,data:[a[0],a[1],a[2],a[3]]}:A[y.AUXPOS1];return c={},c[y.POSITION]=b,c[y.NORMAL]=A[y.NORMAL],c[y.AUXPOS1]=a,c};b.prototype.getOrCreateMaterial=function(a,c){var b=this.perInstanceMaterialParameters(a),d=w.uniqueMaterialIdentifier(b);if(d===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var e=a.materialCollection.getMaterial(d);e||(e=new w(b,
c+"_lineCallout_shared"),a.materialCollection.addMaterial(d,e));return{material:e,isUnique:!1}}e=new w(b,c+"_lineCallout_unique");return{material:e,isUnique:!0}};b.prototype._createAs3DShape=function(c,b,e,f,l){var g=new r.GeometryData(this.createVertexData(e),B,r.GeometryData.DefaultOffsets,"point"),g=[new u(g,f)],k=this.getOrCreateMaterial(e,f);f=p.createStageObjectForHUD(this._context,c,g,[k.material],null,null,b,f,this._context.layer.uid,l);if(null===f)return null;l=new a(this,f.object,g,k.isUnique?
[k.material]:null,null,h.perObjectElevationAligner,b);l.metadata={elevationOffset:e.elevationOffset||0};l.alignedSampledElevation=f.sampledElevation;l.needsElevationUpdates=d.needsElevationUpdates2D(b.mode);p.extendPointGraphicElevationContext(l,c,this._context.elevationProvider);return l};b.elevationModeChangeTypes={definedChanged:d.SymbolUpdateType.UPDATE,staysOnTheGround:d.SymbolUpdateType.UPDATE,onTheGroundChanged:d.SymbolUpdateType.RECREATE};return b}(c.Graphics3DSymbolLayer);b.Graphics3DLineCalloutSymbolLayer=
n;var A=(v={},v[y.POSITION]={size:3,data:[0,0,0]},v[y.NORMAL]={size:3,data:[0,0,1]},v[y.AUXPOS1]={size:4,data:[0,0,0,1]},v);v=new Uint32Array([0]);var B=(z={},z[y.POSITION]=v,z[y.NORMAL]=v,z[y.AUXPOS1]=v,z),C={mode:"relative-to-ground",offset:0},F={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};b.default=n})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ./elevationAlignmentUtils ./graphicUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});var q=c.VertexAttrConstants;b.perVertexElevationAligner=function(a,c,e,f){a=a.stageObject;t.spatialReference=e.spatialReference;for(var h=a.geometryRecords,g=h.length,k="absolute-height"!==c.mode,p=0,m=0;m<g;m++){var v=h[m].geometry,y=h[m].getShaderTransformation();r[0]=y[12];r[1]=y[13];r[2]=y[14];v.invalidateBoundingInfo();for(var y=v.data.getVertexAttr(),w=y[q.POSITION],v=w.data,y=y.mapPos.data,w=w.size,A=v.length/
w,n=0,B=0,C=!1,T=0,P=0;P<A;P++){t.x=y[B++];t.y=y[B++];t.z=y[B++];x[0]=v[n];x[1]=v[n+1];x[2]=v[n+2];var S=l.evaluateElevationAlignmentAtPoint(t,e,c,f,k?z:null);k&&(T+=z.sampledElevation);u[0]=v[n]+r[0];u[1]=v[n+1]+r[1];u[2]=v[n+2]+r[2];f.setAltitude(S,u);v[n]=u[0]-r[0];v[n+1]=u[1]-r[1];v[n+2]=u[2]-r[2];if(d.TESTS_DISABLE_UPDATE_THRESHOLDS)C=!0;else if(S=b.updateThresholdInMeters/f.unitInMeters,Math.abs(x[0]-v[n])>=S||Math.abs(x[1]-v[n+1])>=S||Math.abs(x[2]-v[n+2])>=S)C=!0;n+=w}p+=T/A;C&&a.geometryVertexAttrsUpdated(m)}return p/
g};b.perObjectElevationAligner=function(c,e,f,k){c=c.stageObject;var q=e.centerPointInElevationSR,r=0,t=0;if(c.metadata.usesVerticalDistanceToGround)r=l.evaluateElevationAlignmentAtPoint(q,f,e,k,z),h.updateVertexAttributeAuxpos1w(c,z.verticalDistanceToGround),t=z.sampledElevation;else{var y="absolute-height"!==e.mode,r=l.evaluateElevationAlignmentAtPoint(q,f,e,k,y?z:null);y&&(t=z.sampledElevation)}e=m.mat4.copy(p,c.objectTransformation);f=g.vec3.set(v,e[12],e[13],e[14]);d.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?
(u[0]=q.x,u[1]=q.y,u[2]=r,a.computeLinearTransformation(q.spatialReference,u,e,k.spatialReference)&&(c.objectTransformation=e)):k.setAltitudeOfTransformation(r,e);k=b.updateThresholdInMeters/k.unitInMeters;if(Math.abs(e[12]-f[0])>=k||Math.abs(e[13]-f[1])>=k||Math.abs(e[14]-f[2])>=k)c.objectTransformation=e;return t};var p=k.mat4f64.create();b.perLodInstanceElevationAligner=function(c,e,f,h){var k=e.centerPointInElevationSR,p=0,m=0,q="absolute-height"!==e.mode,p=l.evaluateElevationAlignmentAtPoint(k,
f,e,h,q?z:null);q&&(m=z.sampledElevation);e=c.graphics3DSymbolLayer.lodRenderer.instanceData;c=c.instanceIndex;f=w;e.getGlobalTransform(c,f);q=g.vec3.set(v,f[12],f[13],f[14]);d.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(u[0]=k.x,u[1]=k.y,u[2]=p,a.computeLinearTransformation(k.spatialReference,u,f,h.spatialReference)&&e.setGlobalTransform(c,f)):h.setAltitudeOfTransformation(p,f);h=b.updateThresholdInMeters/h.unitInMeters;(Math.abs(f[12]-q[0])>=h||Math.abs(f[13]-q[1])>=h||Math.abs(f[14]-q[2])>=h)&&
e.setGlobalTransform(c,f);return m};b.updateThresholdInMeters=.01;b.iterativeUpdatesEnabled=!0;var t=new f,u=e.vec3f64.create(),r=e.vec3f64.create(),x=e.vec3f64.create(),w=k.mat4f64.create(),v=e.vec3f64.create(),z={verticalDistanceToGround:0,sampledElevation:0}})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ./graphicUtils ../../support/ElevationProvider ../../support/projectionUtils".split(" "),
function(n,b,m,k,g,e,f,l,h){function d(a,c,b,d,e){var f=a.z||0,h=b.featureExpressionInfoContext;switch(b.mode){case "on-the-ground":var g=l.getElevationAtPoint(c,a,"ground")||0;e&&(e.verticalDistanceToGround=0,e.sampledElevation=g);return g;case "relative-to-ground":return g=l.getElevationAtPoint(c,a,"ground")||0,a=b.calculateOffsetRenderUnits(d),null==h&&(a+=f),e&&(e.verticalDistanceToGround=a,e.sampledElevation=g),a+g;case "relative-to-scene":return g=l.getElevationAtPoint(c,a,"scene")||0,a=b.calculateOffsetRenderUnits(d),
null==h&&(a+=f),e&&(e.verticalDistanceToGround=a,e.sampledElevation=g),a+g;case "absolute-height":return g=b.calculateOffsetRenderUnits(d),null==h&&(g+=f),e&&(f=l.getElevationAtPoint(c,a,"ground")||0,e.verticalDistanceToGround=g-f,e.sampledElevation=f),g;default:return m.neverReached(b.mode),0}}Object.defineProperty(b,"__esModule",{value:!0});b.applyPerVertexElevationAlignment=function(a,b,d,e,f,l,g,k,p,m,q){var r=c[q.mode],u=0;if(h.bufferToBuffer(a,b,d,e,p.spatialReference,f,k)&&(r.requiresAlignment(q)?
(u=r.applyElevationAlignmentBuffer(e,f,l,g,k,p,m,q),a=l,f=g):a=e,h.bufferToBuffer(a,p.spatialReference,f,l,m.spatialReference,g,k)))return u};b.evaluateElevationAlignmentAtPoint=d;b.elevationModeChangeUpdateType=function(c,b,d){return null==b||null==d?c.definedChanged:"on-the-ground"===b&&"on-the-ground"===d?c.staysOnTheGround:b===d||"on-the-ground"!==b&&"on-the-ground"!==d?a.UPDATE:c.onTheGroundChanged};b.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};
b.needsElevationUpdates3D=function(a){return"absolute-height"!==a};b.applyElevationAlignmentForHUD=function(a,c,b,e,l){b=d(c,b,l,e,p);f.updateVertexAttributeAuxpos1w(a,p.verticalDistanceToGround);l=p.sampledElevation;var g=k.mat4.copy(q,a.objectTransformation);t[0]=c.x;t[1]=c.y;t[2]=b;h.computeLinearTransformation(c.spatialReference,t,g,e.spatialReference)?a.objectTransformation=g:console.warn("Could not locate symbol object properly, it might be misplaced");return l};var a;(function(a){a[a.NONE=
0]="NONE";a[a.UPDATE=1]="UPDATE";a[a.RECREATE=2]="RECREATE"})(a=b.SymbolUpdateType||(b.SymbolUpdateType={}));var c={"absolute-height":{applyElevationAlignmentBuffer:function(a,c,b,d,e,f,h,l){f=l.calculateOffsetRenderUnits(h);l=l.featureExpressionInfoContext;c*=3;d*=3;for(h=0;h<e;++h){var g=a[c+1],k=a[c+2];b[d+0]=a[c+0];b[d+1]=g;b[d+2]=null==l?k+f:f;c+=3;d+=3}return 0},requiresAlignment:function(a){var c=a.featureExpressionInfoContext;return 0!==a.meterUnitOffset||null!=c}},"on-the-ground":{applyElevationAlignmentBuffer:function(a,
c,b,d,e,f){var h=0,l=f.spatialReference;c*=3;d*=3;for(var g=0;g<e;++g){var k=a[c+0],p=a[c+1],m=f.getElevation(k,p,a[c+2],l,"ground")||0,h=h+m;b[d+0]=k;b[d+1]=p;b[d+2]=m;c+=3;d+=3}return h/e},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(a,c,b,d,e,f,h,l){var g=0;h=l.calculateOffsetRenderUnits(h);l=l.featureExpressionInfoContext;var k=f.spatialReference;c*=3;d*=3;for(var p=0;p<e;++p){var m=a[c+0],q=a[c+1],r=a[c+2],t=f.getElevation(m,q,r,k,"ground")||
0,g=g+t;b[d+0]=m;b[d+1]=q;b[d+2]=null==l?r+t+h:t+h;c+=3;d+=3}return g/e},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(a,c,b,d,e,f,h,l){var g=0;h=l.calculateOffsetRenderUnits(h);l=l.featureExpressionInfoContext;var k=f.spatialReference;c*=3;d*=3;for(var p=0;p<e;++p){var m=a[c+0],q=a[c+1],r=a[c+2],t=f.getElevation(m,q,r,k,"scene")||0,g=g+t;b[d+0]=m;b[d+1]=q;b[d+2]=null==l?r+t+h:t+h;c+=3;d+=3}return g/e},requiresAlignment:function(){return!0}}},
q=g.mat4f64.create(),p={verticalDistanceToGround:0,sampledElevation:0},t=e.vec3f64.create()})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../support/projectionUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u){function r(a){var c=a.paths[0];if(!c||0===c.length)return null;c=p.getPointOnPath(c,p.getPathLength(c)/2);return t.makeDehydratedPoint(c[0],c[1],c[2],a.spatialReference)}function x(a,c,b){b=b?a:t.clonePoint(a);return c&&a?u.pointToPoint(a,b,c)?b:null:b}function w(a){if(Array.isArray(a)){for(var c=0;c<a.length;c++)if(!w(a[c]))return!1;return!0}return null==a||0<=a}Object.defineProperty(b,"__esModule",{value:!0});b.computeCentroid=function(a,c){if("point"===
a.type)return x(a,c,!1);if(t.isHydratedGeometry(a))switch(a.type){case "extent":return x(a.center,c,!1);case "polygon":return x(a.centroid,c,!1);case "polyline":return x(r(a),c,!0);case "mesh":return x(a.extent.center,c,!1)}else switch(a.type){case "extent":var b=m.isFinite(a.zmin);a=t.makeDehydratedPoint(.5*(a.xmax+a.xmin),.5*(a.ymax+a.ymin),b?.5*(a.zmax+a.zmin):void 0,a.spatialReference);return x(a,c,!0);case "polygon":return(b=a.rings[0])&&0!==b.length?(b=q.ringsCentroid(a.rings,a.hasZ),a=t.makeDehydratedPoint(b[0],
b[1],b[2],a.spatialReference)):a=null,x(a,c,!0);case "polyline":return x(r(a),c,!0)}};b.enlargeExtent=function(a,b,d){if(a){b||(b=c.create());var e=.5*a.width*(d-1);d=.5*a.height*(d-1);a.width<1E-7*a.height?e+=d/20:a.height<1E-7*a.width&&(d+=e/20);h.vec4.set(b,a.xmin-e,a.ymin-d,a.xmax+e,a.ymax+d);return b}return null};b.updateVertexAttributeAuxpos1w=function(a,c){for(var b=0;b<a.geometries.length;++b){var d=a.geometries[b].data.vertexAttributes.auxpos1;d&&d.data[3]!==c&&(d.data[3]=c,a.geometryVertexAttrsUpdated(b))}};
b.mixinColorAndOpacity=function(a,c){var b=d.vec4f64.clone(d.vec4f64.ONES);k.isSome(a)&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);k.isSome(c)?b[3]=c:k.isSome(a)&&3<a.length&&(b[3]=a[3]);return b};b.overrideColor=function(a,c,b,d,e,f){void 0===f&&(f=[0,0,0,0]);for(var h=0;3>h;++h)k.isSome(a)&&null!=a[h]?f[h]=a[h]:k.isSome(b)&&null!=b[h]?f[h]=b[h]:f[h]=e[h];k.isSome(c)?f[3]=c:k.isSome(d)?f[3]=d:f[3]=e[3];return f};b.computeObjectScale=function(a,c,b,d){void 0===a&&(a=l.vec3f64.ONES);void 0===d&&(d=1);var e=Array(3);
if(null==c||null==b)e[0]=1,e[1]=1,e[2]=1;else{for(var f=void 0,h=0,g=2;0<=g;g--){var k=a[g],p=void 0,m=null!=k,q=0===g&&!f&&!m,r=b[g];"symbol-value"===k||q?p=0!==r?c[g]/r:1:m&&"proportional"!==k&&isFinite(k)&&(p=0!==r?k/r:1);null!=p&&(f=e[g]=p,h=Math.max(h,Math.abs(p)))}for(g=2;0<=g;g--)null==e[g]?e[g]=f:0===e[g]&&(e[g]=.001*h)}for(g=2;0<=g;g--)e[g]/=d;return l.vec3f64.fromArray(e)};b.computeSizeWithResourceSize=function(a,c){var b=c.width,d=c.depth,e=c.height;c=c.isPrimitive?10:1;if(null==b&&null==
e&&null==d)return[c*a[0],c*a[1],c*a[2]];for(var b=l.vec3f64.fromValues(b,d,e),f,d=0;3>d;d++)if(e=b[d],null!=e){f=e/a[d];break}for(d=0;3>d;d++)null==b[d]&&(b[d]=a[d]*f);return b};b.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&(a=[a.width,a.depth,a.height]);return w(a)?null:"Symbol sizes may not be negative values"};b.isValidSize=w;b.computeObjectRotation=function(a,c,b,d){void 0===d&&(d=e.mat4f64.create());a=a||0;c=c||0;b=b||0;0!==a&&g.mat4.rotateZ(d,d,-a/180*Math.PI);0!==c&&g.mat4.rotateX(d,
d,c/180*Math.PI);0!==b&&g.mat4.rotateY(d,d,b/180*Math.PI);return d};b.demResolutionForBoundingBox=function(c,b){return null!=b.minDemResolution?b.minDemResolution:a.isPoint(c)?b.minDemResolutionForPoints:.01*a.maximumDimension(c)};b.namedAnchorToHUDMaterialAnchorPos={"bottom-left":f.vec2f64.fromValues(0,0),bottom:f.vec2f64.fromValues(.5,0),"bottom-right":f.vec2f64.fromValues(1,0),left:f.vec2f64.fromValues(0,.5),center:f.vec2f64.fromValues(.5,.5),right:f.vec2f64.fromValues(1,.5),"top-left":f.vec2f64.fromValues(0,
1),top:f.vec2f64.fromValues(.5,1),"top-right":f.vec2f64.fromValues(1,1)}})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){function q(a){return a.isVisible?a.getParameters().transparent?1:2:0}n=function(){function b(c,d,e,f,h,l,g,k,p){this.uniqueGeometries=e;this.uniqueMaterials=f;this.uniqueTextures=h;this.elevationAligner=l;this._edgeState=k;this.type="object3d";this.stage=this.stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=c;this.stageObject=d;this.elevationAligner=l;this.elevationContext=
new a(g);this.visibilityMode=null!=p?p:b.VisibilityModes.HIDE_FACERANGE}Object.defineProperty(b.prototype,"isElevationSource",{get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)},enumerable:!0,configurable:!0});b.prototype.initialize=function(a,c){this.stageLayer=c;this.stage=a;if(this.uniqueMaterials)for(c=0;c<this.uniqueMaterials.length;c++)a.add(3,this.uniqueMaterials[c]);if(this.uniqueGeometries)for(c=0;c<this.uniqueGeometries.length;c++)a.add(2,this.uniqueGeometries[c]);
if(this.uniqueTextures)for(c=0;c<this.uniqueTextures.length;c++)a.add(4,this.uniqueTextures[c]);a.add(1,this.stageObject)};b.prototype.layerOpacityChanged=function(a,c){if(!e.isNone(this._edgeState)){for(var b=q(this._edgeState.baseMaterial),d=!1,f=0,h=this._edgeState.edgeMaterials;f<h.length;f++){var l=h[f];l.objectTransparency!==b&&(l.objectTransparency=b,d=!0)}d&&this.resetEdgeObject(c);this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[a])}};b.prototype.slicePlaneEnabledChanged=
function(a,c){e.isNone(this._edgeState)||(this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:a},!c),this._edgeState.slicePlaneEnabled=a)};b.prototype.setVisibility=function(a){if(null!=this.stage){if(this._visible===a)return!1;(this._visible=a)?this._addedToStage?this.stageObject.unhide():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===b.VisibilityModes.HIDE_FACERANGE?this.stageObject.hide():
(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);if(e.isSome(this._edgeState)){var c=this.stage.renderView.ensureEdgeView();c.hasObject(this.stageObject)?c.updateObjectVisibility(this.stageObject,a):a&&this.addOrUpdateEdgeObject(c,!1)}return!0}};Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0});b.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var c=0;c<this.uniqueMaterials.length;c++)a.remove(3,
this.uniqueMaterials[c].id);if(this.uniqueGeometries)for(c=0;c<this.uniqueGeometries.length;c++)a.remove(2,this.uniqueGeometries[c].id);if(this.uniqueTextures)for(c=0;c<this.uniqueTextures.length;c++)a.remove(4,this.uniqueTextures[c].id)}a.remove(1,this.stageObject.id);this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);a=this.stage.renderView.ensureEdgeView();a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);this.stageObject.dispose();this._visible=
!1;this.stage=this.stageLayer=null};b.prototype.alignWithElevation=function(a,c,b,f){null!=this.elevationAligner&&(e.isSome(b)&&d.setContextFeature(this.elevationContext.featureExpressionInfoContext,b),a=this.elevationAligner(this,this.elevationContext,a,c),null!=a&&(this.alignedSampledElevation=a),this.resetEdgeObject(f))};b.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=l.vec3f64.create());return f.vec3.copy(a,
this.stageObject.getCenter(!0))};b.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=h.create());var c=this.stageObject;a||(a=h.create());h.setMin(a,c.getBBMin(!0));h.setMax(a,c.getBBMax(!0));return a};b.prototype.computeAttachmentOrigin=function(a){for(var c=0,b=this.stageObject.geometryRecords;c<b.length;c++)b[c].computeAttachmentOrigin(u)&&(f.vec3.transformMat4(u,u,this.stageObject.objectTransformation),f.vec3.add(a.render.origin,a.render.origin,u),a.render.num++)};b.prototype.getProjectedBoundingBox=
function(a,b,d,e,l){return g(this,void 0,void 0,function(){var g,m,q,v,y,x,w,z,n,A;return k(this,function(k){switch(k.label){case 0:g=this.getBoundingBoxObjectSpace(l);m=r;q=h.isPoint(g)?1:m.length;for(v=0;v<q;v++)y=m[v],t[0]=g[y[0]],t[1]=g[y[1]],t[2]=g[y[2]],f.vec3.transformMat4(t,t,this.stageObject.objectTransformation),p[3*v+0]=t[0],p[3*v+1]=t[1],p[3*v+2]=t[2];if(!a(p,0,q))return[2,null];h.empty(g);x=null;this.calculateRelativeScreenBounds&&(x=this.calculateRelativeScreenBounds());for(v=0;v<3*
q;v+=3){for(w=0;3>w;w++)g[w]=Math.min(g[w],p[v+w]),g[w+3]=Math.max(g[w+3],p[v+w]);x&&d.push({location:p.slice(v,v+3),screenSpaceBoundingRect:x})}if(!b||!b.service||"absolute-height"===this.elevationContext.mode)return[3,5];h.center(g,u);z="relative-to-scene"===this.elevationContext.mode?"scene":"ground";n=void 0;if(!b.useViewElevation)return[3,1];n=b.service.getElevation(u[0],u[1],z);return[3,4];case 1:return k.trys.push([1,3,,4]),A=c.demResolutionForBoundingBox(g,b),[4,b.service.queryElevation(u[0],
u[1],e,A,z)];case 2:return n=k.sent(),[3,4];case 3:return k.sent(),n=null,[3,4];case 4:h.offset(g,0,0,-this.alignedSampledElevation+n),k.label=5;case 5:return[2,g]}})})};b.prototype.addObjectState=function(a,c){0===a&&c.addObject(this.stageObject,this.stageObject.highlight());1===a&&c.addObject(this.stageObject,this.stageObject.occlude())};b.prototype.removeObjectState=function(a){a.removeObject(this.stageObject)};b.prototype.resetEdgeObject=function(a){if(!e.isNone(this._edgeState)){var c=this.stage.renderView.ensureEdgeView();
this._visible?this.addOrUpdateEdgeObject(c,a):c.removeObject(this.stageObject)}};b.prototype.addOrUpdateEdgeObject=function(a,c){var b=this._edgeState;if(!e.isNone(b)){for(var d=q(b.baseMaterial),f=0,h=b.edgeMaterials;f<h.length;f++)h[f].objectTransparency=d;a.addOrUpdateObject(this.stageObject,b.edgeMaterials,{slicePlaneEnabled:b.slicePlaneEnabled},!c,b.addObjectSettings)}};return b}();(function(a){a=a.VisibilityModes||(a.VisibilityModes={});a[a.REMOVE_OBJECT=0]="REMOVE_OBJECT";a[a.HIDE_FACERANGE=
1]="HIDE_FACERANGE"})(n||(n={}));var p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=l.vec3f64.create(),u=l.vec3f64.create(),r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return n})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Logger ../../../../layers/graphics/dehydratedFeatures ../../../../support/arcadeOnDemand".split(" "),
function(n,b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});var l=g.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");b.createContextWithoutExpressionSupport=function(b){b=b&&b.expression;return"string"===typeof b&&(b="0"===b?0:null,null!=b)?{cachedResult:b}:null};b.createContext=function(b,d,a){return k(this,void 0,void 0,function(){var c,e,h,l,g;return m(this,function(k){switch(k.label){case 0:c=b&&b.expression;if("string"!==typeof c)return[2,null];e="0"===c?0:null;
return null!=e?[2,{cachedResult:e}]:[4,f.loadArcade()];case 1:return h=k.sent(),l=h.arcadeUtils,g=l.createSyntaxTree(c),l.dependsOnView(g)?(null!=a&&a.error("Expressions containing '$view' are not supported on ElevationInfo"),[2,{cachedResult:0}]):[2,{arcade:{func:l.createFunction(g),context:l.createExecContext(null,{sr:d}),modules:h}}]}})})};b.createFeature=function(b,d,a){return b.arcadeUtils.createFeature(d.attributes,d.geometry,a)};b.setContextFeature=function(b,d){null!=b&&null==b.cachedResult&&
(d&&b.arcade?(d._geometry&&(d._geometry=e.hydrateGeometry(d._geometry)),b.arcade.modules.arcadeUtils.updateExecContext(b.arcade.context,d)):l.errorOncePerTick("Arcade support required but not provided"))};b.execute=function(b){if(null!=b){if(null!=b.cachedResult)return b.cachedResult;var d=b.arcade,d=b.arcade.modules.arcadeUtils.executeFunction(d.func,d.context);"number"!==typeof d&&(d=b.cachedResult=0);return d}return 0};b.extractExpressionInfo=function(b,d){void 0===d&&(d=!1);var a=(b=b&&b.featureExpressionInfo)&&
b.expression;d||"0"===a||(b=null);return b};b.zeroContext={cachedResult:0}})},"esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./ElevationContext"],function(n,b,m,k){return function(b){function e(e){e=b.call(this,e)||this;e.centerPointInElevationSR=null;return e}m(e,b);e.fromElevationInfo=function(b){var f=new e;f.setFromElevationInfo(b);return f};return e}(k)})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["require",
"exports","../../../../core/maybe","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(n,b,m,k,g){return function(){function b(b){this._renderUnitOffset=this._meterUnitOffset=0;this.featureExpressionInfoContext=null;b?this.set(b):this.setDefaults()}Object.defineProperty(b.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"unit",{get:function(){return this._unit},enumerable:!0,
configurable:!0});b.prototype.setUnit=function(b){this._unit=b;this._metersPerElevationInfoUnit=k.getMetersPerUnit(b)};b.prototype.setDefaults=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this.featureExpressionInfoContext=null;this.setUnit("meters")};b.prototype.set=function(b){this.mode=b.mode;this._meterUnitOffset=b._meterUnitOffset;this._renderUnitOffset=b._renderUnitOffset;this.featureExpressionInfoContext=b.featureExpressionInfoContext;this.setUnit(b.unit)};b.prototype.setOffsetMeters=
function(b){this._meterUnitOffset=b;this._renderUnitOffset=0};b.prototype.setOffsetElevationInfoUnits=function(b){this._meterUnitOffset=b*this._metersPerElevationInfoUnit;this._renderUnitOffset=0};b.prototype.addOffsetRenderUnits=function(b){this._renderUnitOffset+=b};b.prototype.calculateOffsetRenderUnits=function(b){var e=this._meterUnitOffset,f=this.featureExpressionInfoContext;null!=f&&(e+=g.execute(f)*this._metersPerElevationInfoUnit);return e/b.unitInMeters+this._renderUnitOffset};b.prototype.setFromElevationInfo=
function(b){this.mode=b.mode;this.setUnit(b.unit||"meters");this.setOffsetElevationInfoUnits(m.unwrapOr(b.offset,0))};b.fromElevationInfo=function(e){var f=new b;m.isSome(e)&&f.setFromElevationInfo(e);return f};return b}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../core/arrayUtils ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./Loadable ./symbolComplexity".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w){function v(a,c){a=null!=a?c.attributes[a]:0;return null!=a&&isFinite(a)?a:0}Object.defineProperty(b,"__esModule",{value:!0});var z=new t,y=h.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");n=function(b){function h(a,c,d,e){var f=b.call(this)||this;f._elevationInfoOverride=null;f.complexity=null;f.logger=y;f._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};f.symbol=a;f.symbolLayer=c;f._context=d;f._renderPriority=
e.renderPriority;f._renderPriorityDelta=e.renderPriorityStep;f._elevationContext=new t;f.complexity=f.computeComplexity();f._updateDrivenProperties(e.ignoreDrivers);f._updateElevationContext();return f}m(h,b);h.prototype.getCachedSize=function(){return null};Object.defineProperty(h.prototype,"needsDrivenTransparentPass",{get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque},enumerable:!0,configurable:!0});h.prototype._logGeometryCreationWarnings=function(a,
c,b,d){var e="polygons"in a?a.polygons:null;d+=" geometry failed to be created";var f=null;a.projectionSuccess?!c.length||1===c.length&&!c[0].length?f=d+" (no "+b+" were defined)":Array.isArray(c)&&Array.isArray(c[0])?c.some(function(a){return 1===a.length})?f=d+" ("+b+" should contain at least 2 vertices)":e&&0===e.length&&"rings"===b&&(f=d+" (filled "+b+" should use clockwise winding - try reversing the order of vertices)"):f=d+" ("+b+" should be defined as a 2D array)":f=d+" (failed to project geometry to view spatial reference)";
f&&y.warnOncePerTick(f)};h.prototype._validateGeometryType=function(a,c,b){if(f.includes(c,a.type))return!0;this.logger.warn("unsupported geometry type for "+b+(" symbol: "+a.type));return!1};h.prototype._validateGeometry=function(a){return"point"!==a.type||d.isFinite(a.x)&&d.isFinite(a.y)?!0:(y.warn("point coordinate is not a valid number, graphic skipped"),!1)};h.prototype._defaultElevationInfoNoZ=function(){return A};h.prototype._defaultElevationInfoZ=function(){return B};h.prototype._updateElevationContext=
function(){a.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.featureExpressionInfoContext=null):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.featureExpressionInfoContext=this._context.featureExpressionInfoContext):this._elevationContext.setDefaults()};h.prototype.getDefaultElevationInfo=function(a){return a.hasZ?this._defaultElevationInfoZ():
this._defaultElevationInfoNoZ()};h.prototype.getGeometryElevationMode=function(a,c){void 0===c&&(c=this.getDefaultElevationInfo(a));return this._elevationContext.mode||c.mode};h.prototype.setElevationInfoOverride=function(a){this._elevationInfoOverride=a;this._updateElevationContext()};h.prototype.getGraphicElevationContext=function(c){var b=a.expect(c.geometry),d=this.getDefaultElevationInfo(b);z.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:d.unit);z.mode=this.getGeometryElevationMode(b,
d);z.setOffsetMeters(a.unwrapOr(this._elevationContext.meterUnitOffset,a.unwrapOr(d.offset,0)));z.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext;this._elevationOptions.supportsOnTheGround||"on-the-ground"!==z.mode||(z.mode="relative-to-ground",z.setOffsetMeters(0),z.featureExpressionInfoContext=u.zeroContext);if(b=z.featureExpressionInfoContext&&z.featureExpressionInfoContext.arcade)c=u.createFeature(b.modules,c,this._context.layer),u.setContextFeature(z.featureExpressionInfoContext,
c);return z};h.prototype.prepareSymbolLayerPatch=function(a){};h.prototype.updateGeometry=function(a,c){return!1};h.prototype.onRemoveGraphic=function(a){};h.prototype._updateDrivenProperties=function(a){var c={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};a||(a=this._context.renderer)&&"visualVariables"in a&&a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":c.color=!0;if(a.stops)for(var b=0;b<a.stops.length;b++){var d=a.stops[b].color;d&&(c.opacity=!0,1>d.a&&
(c.opacityAlwaysOpaque=!1))}break;case "opacity":c.opacity=!0;c.opacityAlwaysOpaque=!1;break;case "size":c.size=!0}});this._drivenProperties=c};h.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var a=this._context.layer.opacity;return null==a?1:a};h.prototype._getCombinedOpacity=function(c,b){void 0===b&&(b=C);var d=1;this.draped||(d*=this._getLayerOpacity());if(this._drivenProperties.opacity)return d;
a.isSome(c)?d*=c.a:b.hasIntrinsicColor||(d=0);return d};h.prototype._getCombinedOpacityAndColor=function(b,d){void 0===d&&(d=C);d=this._getCombinedOpacity(b,d);if(this._drivenProperties.color)return r.mixinColorAndOpacity(null,d);b=a.isSome(b)?e.toUnitRGB(b):c.vec3f64.ONES;return r.mixinColorAndOpacity(b,d)};h.prototype._getVertexOpacityAndColor=function(a,c,b){a=r.mixinColorAndOpacity(this._drivenProperties.color?a.color:null,this._drivenProperties.opacity?a.opacity:null);b&&(a[0]*=b,a[1]*=b,a[2]*=
b,a[3]*=b);return c?new c(a):a};h.prototype._getIdHint=function(a){void 0===a&&(a="");return this._context.layer.id+"_symbol"+a};h.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};h.prototype.computeComplexity=function(){return w.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};h.prototype.destroy=function(){this.abortLoad()};h.prototype.globalPropertyChanged=function(a,c,b){switch(a){case "opacity":return this.layerOpacityChanged(c,b);case "elevationInfo":return a=
this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(c,b,a)===p.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(c,b);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();default:return l.neverReachedSilent(a),!1}};h.prototype.updateGraphics3DGraphicElevationInfo=function(c,b,d){var e=this,f=p.SymbolUpdateType.UPDATE;c.forEach(function(c){var h=
b(c);a.isSome(h)?(c=e.getGraphicElevationContext(c.graphic),h.needsElevationUpdates=d(c.mode),h.elevationContext.set(c)):f=p.SymbolUpdateType.RECREATE});return f};h.prototype.applyRendererDiff=function(a,c){return!1};h.prototype.getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;var c=this._fastUpdates.visualVariables,b=c.size?v(c.size.field,a):0,d=c.color?v(c.color.field,a):0;a=c.opacity?v(c.opacity.field,a):0;return q.vec4f64.fromValues(b,d,a,0)};Object.defineProperty(h.prototype,
"draped",{get:function(){return this._draped},enumerable:!0,configurable:!0});h.prototype.ensureDrapedStatus=function(a){if(null==this._draped)return this._draped=a,!0;a!==this.draped&&y.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1};return h}(x.Loadable);b.Graphics3DSymbolLayer=n;b.getAttributeValue=v;var A={mode:"on-the-ground",offset:0,unit:"meters"},B={mode:"absolute-height",
offset:0,unit:"meters"},C={hasIntrinsicColor:!1};b.default=n})},"esri/views/3d/layers/graphics/Loadable":function(){define(["require","exports","../../../../core/tsSupport/generatorHelper","../../../../core/tsSupport/awaiterHelper","../../../../core/promiseUtils"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._abortController=null;this._loadStatus=0;this.logger=this._loader=this._loadError=null}Object.defineProperty(b.prototype,"loadStatus",{get:function(){return this._loadStatus},
enumerable:!0,configurable:!0});b.prototype.load=function(b,e){var f=this;if(1===this._loadStatus)return b&&b(),this._loader;if(2===this._loadStatus)return e&&e(this._loadError),this._loader;this._loader||(this._abortController=g.createAbortController(),this._loader=this.doLoad(this._abortController.signal).then(function(){f._abortController=null;f._loadStatus=1},function(b){f._loadError=b;f._abortController=null;f._loadStatus=2;!g.isAbortError(b)&&f.logger&&b.message&&f.logger.warn(b.message);throw b;
}));this._loader.then(b,e).catch(function(){});return this._loader};b.prototype.abortLoad=function(){this._abortController?(this._abortController.abort(),this._abortController=null):0===this._loadStatus&&(this._loadStatus=2);this._loader=null};return b}();b.Loadable=n})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(n,b,m,k,g,e,f,l,h){function d(a){for(var c=0,b=0,d=!1,e={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}},f=0;f<a.length;f++){var h=a[f];h&&(c+=h.primitivesPerFeature,b+=h.primitivesPerCoordinate,e.bytesPerFeature+=h.memory.bytesPerFeature,e.bytesPerFeatureLabel+=h.memory.bytesPerFeatureLabel,e.bytesPerCoordinate+=h.memory.bytesPerCoordinate,e.draped.bytesPerFeature+=h.memory.bytesPerFeature,e.draped.bytesPerFeatureLabel+=
h.memory.bytesPerFeatureLabel,e.draped.bytesPerCoordinate+=h.memory.bytesPerCoordinate,d=d||h.estimated)}return{primitivesPerFeature:c,primitivesPerCoordinate:b,estimated:d,memory:e}}function a(a,b){var d=c(a,b);switch(b.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,estimated:!1,memory:d};case "fill":return"mesh-3d"===a.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,estimated:!1,memory:d}:g.isSome(b.outline)&&0<b.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,
estimated:!1,memory:d}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,estimated:!1,memory:d};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,estimated:!1,memory:d};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,estimated:!1,memory:d};case "object":return b.resource&&b.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,estimated:!0,memory:d}:m({},q(b.resource&&b.resource.primitive||e.defaultPrimitive),{memory:d});case "path":var f=a=0;switch(b.profile){case "circle":a=
10;break;case "quad":a=4;break;default:k.neverReached(b.profile);return}switch(b.join){case "round":f=3;break;case "miter":case "bevel":f=1;break;default:k.neverReached(b.join);return}var h=2*a,f=a*f*2,l=-2*f-h;switch(b.cap){case "none":break;case "butt":case "square":l+=2*(a-1);break;case "round":l+=2*(4*a+a);break;default:k.neverReached(b.cap);return}return{primitivesPerFeature:l,primitivesPerCoordinate:f+h,estimated:!1,memory:d};case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,
estimated:!1,memory:d};default:k.neverReached(b)}}function c(a,c){a="point-3d"===a.type;switch(c.type){case "extrude":return c.edges&&0<c.edges.size?b.memoryEstimators.EXTRUDE_EDGES:b.memoryEstimators.EXTRUDE;case "fill":return g.isSome(c.outline)&&0<c.outline.size?b.memoryEstimators.FILL_OUTLINE:b.memoryEstimators.FILL;case "water":return b.memoryEstimators.FILL;case "line":return"round"===c.join?b.memoryEstimators.LINE_ROUND:b.memoryEstimators.LINE_MITER;case "path":switch(c.join){case "round":switch(c.profile){case "circle":return b.memoryEstimators.PATH_ROUND_CIRCLE;
case "quad":return b.memoryEstimators.PATH_ROUND_QUAD;default:k.neverReached(c.profile);return}case "miter":case "bevel":switch(c.profile){case "circle":return b.memoryEstimators.PATH_MITER_CIRCLE;case "quad":return b.memoryEstimators.PATH_MITER_QUAD;default:k.neverReached(c.profile);return}default:k.neverReached(c.join);return}case "object":return a?b.memoryEstimators.OBJECT_POINT:b.memoryEstimators.OBJECT_POLYGON;case "icon":case "text":return a?b.memoryEstimators.ICON_POINT:b.memoryEstimators.ICON_POLYGON;
default:k.neverReached(c)}}function q(a){var c=p[a];if(c)return c;c=f.primitiveLodResources(a,null,null);c={primitivesPerFeature:h.geometriesFromLodLevelResources(c.levels[0]).reduce(function(a,c){return a+c.data.getIndices(l.VertexAttrConstants.POSITION).length/3},0),primitivesPerCoordinate:0,estimated:!1};return p[a]=c}Object.defineProperty(b,"__esModule",{value:!0});b.emptySymbolComplexity={primitivesPerFeature:0,primitivesPerCoordinate:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,
bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};b.defaultSymbolComplexity=function(c){if("web-style"===c.type)return b.emptySymbolComplexity;var e=c.symbolLayers.toArray().map(function(b){return a(c,b)});return d(e)};b.totalSymbolComplexities=d;var p={};b.defaultSymbolLayerComplexity=a;b.defaultSymbolLayerMemoryComplexity=c;b.memoryEstimators={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,
bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,
bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},
LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,
bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,
draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,
bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,
bytesPerCoordinate:374.3725221561312}}}})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define("require exports ../../../../core/compilerUtils ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});var f=k.fromValues(-.5,-.5,-.5,.5,.5,.5),l=k.fromValues(-.5,-.5,0,.5,.5,1),h=k.fromValues(-.5,-.5,0,.5,.5,.5);b.isValidPrimitive=function(a){switch(a){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};
b.primitiveBoundingBox=function(a){switch(a){case "sphere":case "cube":case "diamond":return f;case "cylinder":case "cone":case "inverted-cone":return l;case "tetrahedron":return h;default:m.neverReached(a)}};b.primitiveGeometryData=function(a){switch(a){case "sphere":return e.createPolySphereGeometry(.5,2,!0);case "cube":return e.createBoxGeometry(1);case "cylinder":return e.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case "cone":return e.cgToGIS(e.createConeGeometry(1,.5,15,!1));case "inverted-cone":return e.cgToGIS(e.createConeGeometry(1,
.5,15,!0));case "tetrahedron":return e.cgToGIS(e.createTetrahedronGeometry(1));case "diamond":return e.cgToGIS(e.createDiamondGeometry(1));default:m.neverReached(a)}};b.primitiveLodResources=function(a,c,b){var f=function(a,d,f){void 0===f&&(f=!1);return{levels:a.map(function(a,h){var l=d(a.tesselation);f&&e.cgToGIS(l);return{components:[{geometry:new g(l,b+("_lod"+h)),material:c}],faceCount:l.indexCount/3,minScreenSpaceRadius:a.minScreenSpaceRadius}})}};switch(a){case "sphere":return f([{tesselation:0,
minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],function(a){return e.createPolySphereGeometry(.5,a,!0)});case "cube":return f([{tesselation:0,minScreenSpaceRadius:0}],function(){return e.createBoxGeometry(1)});case "cone":return f(d,function(a){return e.createConeGeometry(1,.5,a,!1)},!0);case "inverted-cone":return f(d,function(a){return e.createConeGeometry(1,.5,
a,!0)},!0);case "cylinder":return f(d,function(a){return e.createCylinderGeometry(1,.5,a,[0,0,1],[0,0,.5])});case "tetrahedron":return f([{tesselation:0,minScreenSpaceRadius:0}],function(){return e.createTetrahedronGeometry(1)},!0);case "diamond":return f([{tesselation:0,minScreenSpaceRadius:0}],function(){return e.createDiamondGeometry(1)},!0);default:m.neverReached(a)}};var d=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]})},
"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./BoundingInfo ./ComponentUtils ./geometryDataUtils ./IdGen ./Util ./Util".split(" "),function(n,b,m,k,g,e,f,l){return function(){function b(d,a,c){this._componentAABBs=this._boundingInfo=null;this._id=b.__idGen.gen(a);this._data=d;this._boundingInfo=c}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"data",{get:function(){return this._data},
enumerable:!0,configurable:!0});b.prototype.getIndices=function(b){return this.data.getIndices(b)};Object.defineProperty(b.prototype,"indexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0});b.prototype.getAttribute=function(b){return this.data.getAttribute(b)};Object.defineProperty(b.prototype,"componentCount",{get:function(){return k.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"componentOffsets",{get:function(){return this.data.componentOffsets},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vertexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"boundingInfo",{get:function(){null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo},enumerable:!0,configurable:!0});b.prototype.computeAttachmentOrigin=
function(b){return"triangle"===this.data.primitiveType?this.computeAttachmentOriginTriangles(b):this.computeAttachmentOriginPoints(b)};b.prototype.computeAttachmentOriginTriangles=function(b){var a=this.getIndices(l.VertexAttrConstants.POSITION),c=this.getAttribute(l.VertexAttrConstants.POSITION);return g.computeAttachmentOriginTriangles(c,a,b)};b.prototype.computeAttachmentOriginPoints=function(b){var a=this.getIndices(l.VertexAttrConstants.POSITION),c=this.getAttribute(l.VertexAttrConstants.POSITION);
return g.computeAttachmentOriginPoints(c,a,b)};b.prototype.invalidateBoundingInfo=function(){this._componentAABBs=this._boundingInfo=null};b.prototype.getComponentAABB=function(b,a){null==this._componentAABBs&&(this._componentAABBs=this._computeComponentAABBs());for(var c=0;6>c;c++)a[c]=this._componentAABBs[6*b+c];return a};b.prototype._computeComponentAABBs=function(){for(var b=this.componentCount,a=new Float32Array(6*b),c=0;c<b;c++)this._calculateAABB(c,a,6*c);return a};b.prototype._calculateAABB=
function(b,a,c){var d=this.data.getIndices(l.VertexAttrConstants.POSITION),e=this.data.getAttribute(l.VertexAttrConstants.POSITION),f=this.data.componentOffsets,h=f.length?f[b+1]:d.length,g=Infinity,k=Infinity,m=Infinity,v=-Infinity,z=-Infinity,y=-Infinity,n=e.offsetIdx,B=e.strideIdx;for(b=f.length?f[b]:0;b<h;b++)var C=n+B*d[b],f=e.data[C],F=e.data[C+1],C=e.data[C+2],g=Math.min(g,f),k=Math.min(k,F),m=Math.min(m,C),v=Math.max(v,f),z=Math.max(z,F),y=Math.max(y,C);a[c]=g;a[c+1]=k;a[c+2]=m;a[c+3]=v;a[c+
4]=z;a[c+5]=y};b.prototype._calculateBoundingInfo=function(){var b=this.data.getIndices(l.VertexAttrConstants.POSITION),a=this.data.getAttribute(l.VertexAttrConstants.POSITION),c="triangle"===this.data.primitiveType?3:1;if(0===b.length)for(var b=new Uint32Array(c),e=0;e<c;++e)b[e]=e;e=b.length;f.assert(0===e%c,"Indexing error: "+e.toFixed(0)+" not divisible by "+c.toFixed(0));e=g.generateDefaultIndexArray(e/c);return new m(e,c,b,a)};b.__idGen=new e.IdGen;return b}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Util".split(" "),
function(n,b,m,k,g,e){n=function(){function b(f,h,d,a){this.primitiveIndices=f;this._numIndexPerPrimitive=h;this.indices=d;this._position=a;this.center=g.vec3f64.create();e.assert(1<=f.length);e.assert(0===d.length%this._numIndexPerPrimitive);e.assert(d.length>=f.length*this._numIndexPerPrimitive);e.assert(3===this._position.size||4===this._position.size);a=this._position;h=a.data;var c=a.offsetIdx,l=a.strideIdx;a=0;var p=f.length,m=c+l*d[this._numIndexPerPrimitive*f[a]];b.tmpIndices.clear();b.tmpIndices.push(m);
this.bbMin=g.vec3f64.fromValues(h[m],h[m+1],h[m+2]);for(this.bbMax=g.vec3f64.clone(this.bbMin);a<p;++a)for(var u=this._numIndexPerPrimitive*f[a],r=0;r<this._numIndexPerPrimitive;++r){m=c+l*d[u+r];b.tmpIndices.push(m);var x=h[m];this.bbMin[0]=Math.min(x,this.bbMin[0]);this.bbMax[0]=Math.max(x,this.bbMax[0]);x=h[m+1];this.bbMin[1]=Math.min(x,this.bbMin[1]);this.bbMax[1]=Math.max(x,this.bbMax[1]);x=h[m+2];this.bbMin[2]=Math.min(x,this.bbMin[2]);this.bbMax[2]=Math.max(x,this.bbMax[2])}k.vec3.lerp(this.center,
this.bbMin,this.bbMax,.5);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);f=this.bsRadius*this.bsRadius;for(a=0;a<b.tmpIndices.length;++a)m=b.tmpIndices.data[a],d=h[m]-this.center[0],c=h[m+1]-this.center[1],m=h[m+2]-this.center[2],l=d*d+c*c+m*m,l<=f||(l=Math.sqrt(l),p=.5*(l-this.bsRadius),this.bsRadius+=p,f=this.bsRadius*this.bsRadius,l=p/l,this.center[0]+=d*l,this.center[1]+=c*l,this.center[2]+=m*l);b.tmpIndices.clear()}b.prototype.getCenter=
function(){return this.center};b.prototype.getBSRadius=function(){return this.bsRadius};b.prototype.getBBMin=function(){return this.bbMin};b.prototype.getBBMax=function(){return this.bbMax};b.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};b.prototype.getIndices=function(){return this.indices};b.prototype.getPosition=function(){return this._position};b.prototype.getChildren=function(){if(this._children)return this._children;if(1<k.vec3.squaredDistance(this.bbMin,this.bbMax)){for(var e=
k.vec3.lerp(g.vec3f64.create(),this.bbMin,this.bbMax,.5),f=this.primitiveIndices.length,d=new Uint8Array(f),a=Array(8),c=0;8>c;++c)a[c]=0;for(var c=this._position,m=c.data,p=c.offsetIdx,t=c.strideIdx,c=0;c<f;++c){for(var u=0,r=this._numIndexPerPrimitive*this.primitiveIndices[c],x=p+t*this.indices[r],w=m[x],v=m[x+1],z=m[x+2],y=1;y<this._numIndexPerPrimitive;++y){var x=p+t*this.indices[r+y],n=m[x],B=m[x+1],x=m[x+2];n<w&&(w=n);B<v&&(v=B);x<z&&(z=x)}w<e[0]&&(u|=1);v<e[1]&&(u|=2);z<e[2]&&(u|=4);d[c]=u;
++a[u]}for(c=e=0;8>c;++c)0<a[c]&&++e;if(2>e)return;e=Array(8);for(c=0;8>c;++c)e[c]=0<a[c]?new Uint32Array(a[c]):void 0;for(c=0;8>c;++c)a[c]=0;for(c=0;c<f;++c)u=d[c],e[u][a[u]++]=this.primitiveIndices[c];this._children=Array(8);for(c=0;8>c;++c)void 0!==e[c]&&(this._children[c]=new b(e[c],this._numIndexPerPrimitive,this.indices,this._position))}return this._children};return b}();(n||(n={})).tmpIndices=new m({deallocator:null});return n})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["require",
"exports","../../../../../core/arrayUtils"],function(n,b,m){function k(b){var e=[];b.components.forEach(function(b){e.push(b.geometry)});return m.unique(e)}Object.defineProperty(b,"__esModule",{value:!0});b.materialsFromLodResources=function(b){var e=[];b.levels.forEach(function(b){b.components.forEach(function(b){e.push(b.material)})});return m.unique(e)};b.texturesFromLodResources=function(b){var e=[];b.levels.forEach(function(b){b.components.forEach(function(b){b.textures&&e.push.apply(e,b.textures)})});
return m.unique(e)};b.geometriesFromLodLevelResources=k;b.geometriesFromLodResources=function(b){var e=[];b.levels.forEach(function(b){b.components.forEach(function(b){e.push(b.geometry)})});return m.unique(e)};b.computeFaceCount=function(b){var e=0;k(b).forEach(function(b){e+=b.data.indexCount/3});return e}})},"esri/views/3d/layers/graphics/pointUtils":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./graphicUtils ../../support/projectionUtils ../../webgl-engine/lib/Object3D".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});var q=g.vec3f64.create();b.createStageObjectForHUD=function(b,d,f,l,g,w,v,z,y,n,B){var p=f?f.length:0,r=b.clippingExtent;a.pointToVector(d,q,b.elevationProvider.spatialReference);if(m.isSome(r)&&!e.containsPoint(r,q))return null;a.pointToVector(d,q,b.renderCoordsHelper.spatialReference);r=b.localOriginFactory.getOrigin(q);z=new c({castShadow:!1,metadata:{layerUid:y,graphicUid:n,usesVerticalDistanceToGround:!0},idHint:z});
for(y=0;y<p;y++)z.addGeometry(f[y],l[y],g?g[y]:k.mat4f64.IDENTITY,w,r,B);b=h.applyElevationAlignmentForHUD(z,d,b.elevationProvider,b.renderCoordsHelper,v);return{object:z,sampledElevation:b}};b.extendPointGraphicElevationContext=function(c,b,d){c=c.elevationContext;d=d.spatialReference;a.pointToVector(b,q,d);c.centerPointInElevationSR=l.makeDehydratedPoint(q[0],q[1],b.hasZ?q[2]:0,d)};b.placePointOnGeometry=function(a){switch(a.type){case "point":return a;case "polygon":case "extent":return d.computeCentroid(a);
case "polyline":var c=a.paths[0];if(!c||0===c.length)break;c=f.getPointOnPath(c,f.getPathLength(c)/2);return l.makeDehydratedPoint(c[0],c[1],c[2],a.spatialReference);case "mesh":return a.extent.center}return null}})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec2f32 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/LineCalloutTechnique".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){n=function(b){function e(a,f){f=b.call(this,f)||this;f.techniqueConfig=new c.LineCalloutTechniqueConfiguration;f.params=d.copyParameters(a,p);f._uniqueMaterialIdentifier=e.uniqueMaterialIdentifier(f.params);return f}m(e,b);Object.defineProperty(e.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});e.prototype.dispose=function(){};e.prototype.getGLMaterial=function(a){return 0===a.output?new q(a):
void 0};e.prototype.getPassParameters=function(){return this.params};e.prototype.getTechniqueConfig=function(a){this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.verticalOffset=!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.depthHudEnabled=a;this.techniqueConfig.depthHudAlignStartEnabled=!!this.params.depthHUDAlignStart;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===
this.params.centerOffsetUnits?1:0;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;return this.techniqueConfig};e.prototype.intersect=function(){};e.prototype.createBufferWriter=function(){return new r};e.prototype.createRenderer=function(c,b){return new a(c,b,this)};e.prototype.setParameterValues=function(a){d.updateParameters(this.params,a)&&(this._uniqueMaterialIdentifier=e.uniqueMaterialIdentifier(this.params),this.parametersChanged())};e.prototype.getParameters=function(){return this.params};
e.uniqueMaterialIdentifier=function(a){return JSON.stringify({screenOffset:a.screenOffset||[0,0],centerOffsetUnits:a.centerOffsetUnits||"world"})};return e}(f.Material);var q=function(a){function b(c){c=a.call(this,c)||this;c.isRenderSlot=!0;c.updateParameters();return c}m(b,a);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(c.LineCalloutTechnique,this.material.getTechniqueConfig(!1),this.technique);this.depthTechnique=this.techniqueRep.acquireAndReleaseExisting(c.LineCalloutTechnique,
this.material.getTechniqueConfig(!0),this.depthTechnique)};b.prototype.beginSlot=function(a){switch(a){case 20:return this.isRenderSlot=!0;case 21:return this.isRenderSlot=!1,!0}return!1};b.prototype.getTechnique=function(){return this.isRenderSlot?this.technique:this.depthTechnique};b.prototype.bind=function(a,c){var b=this.getTechnique();a.bindProgram(b.program);b.bindPass(a,this.material.getPassParameters(),c)};return b}(e.GLMaterial),p={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,
0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},t=g.newLayout().vec3f(l.VertexAttrConstants.POSITION).vec3f(l.VertexAttrConstants.NORMAL).vec2f(l.VertexAttrConstants.UV0).vec4f(l.VertexAttrConstants.AUXPOS1),u=[k.vec2f32.fromValues(0,0),k.vec2f32.fromValues(1,0),k.vec2f32.fromValues(0,1),k.vec2f32.fromValues(1,0),k.vec2f32.fromValues(1,1),k.vec2f32.fromValues(0,1)],r=function(){function a(){this.vertexBufferLayout=
t}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return 6*a.indices[l.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,c,b,d){h.writePosition(c.indices[l.VertexAttrConstants.POSITION],c.vertexAttr[l.VertexAttrConstants.POSITION].data,a.transformation,b.position,d,6);h.writeNormal(c.indices[l.VertexAttrConstants.NORMAL],c.vertexAttr[l.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,b.normal,d,6);h.writeBufferVec4(c.indices[l.VertexAttrConstants.AUXPOS1],
c.vertexAttr[l.VertexAttrConstants.AUXPOS1].data,b.auxpos1,d,6);for(a=0;a<u.length;++a)b.uv0.setVec(d+a,u[a])};return a}();return n})},"esri/core/libs/gl-matrix-2/vec2f32":function(){define(["require","exports","./factories/vec2f32"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.vec2f32=m})},"esri/core/libs/gl-matrix-2/factories/vec2f32":function(){define(["require","exports"],function(n,b){function m(){return new Float32Array(2)}function k(b,e){var d=new Float32Array(2);d[0]=
b;d[1]=e;return d}function g(){return k(1,1)}function e(){return k(1,0)}function f(){return k(0,1)}Object.defineProperty(b,"__esModule",{value:!0});b.create=m;b.clone=function(b){var e=new Float32Array(2);e[0]=b[0];e[1]=b[1];return e};b.fromValues=k;b.createView=function(b,e){return new Float32Array(b,e,2)};b.zeros=function(){return m()};b.ones=g;b.unitX=e;b.unitY=f;b.ZEROS=m();b.ONES=g();b.UNIT_X=e();b.UNIT_Y=f()})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../materials/internal/MaterialUtil ./LineCallout.glsl ./LineCallout.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w){Object.defineProperty(b,"__esModule",{value:!0});g=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}m(c,a);c.prototype.initializeProgram=function(a){var b=c.shader.get(),d=this.configuration,b=b.build({occlusionTestEnabled:d.occlusionTestEnabled,verticalOffsetEnabled:d.verticalOffset,screenSizePerspectiveEnabled:d.screenSizePerspective,depthHudEnabled:d.depthHudEnabled,depthHudAlignStartEnabled:d.depthHudAlignStartEnabled,screenCenterOffsetUnitsEnabled:d.screenCenterOffsetUnitsEnabled,
slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:a.viewingMode});return new r(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),q.Default3D)};c.prototype.bindPass=function(a,c,b){u.LineCallout.bindUniforms(this.program,c,b);l.VerticalOffset.bindUniforms(this.program,c,b);var d=b.cameraAboveGround?1:-1;this.program.setUniform1i("hudVisibilityTexture",0);a.bindTexture(b.hudVisibilityTexture,0);this.program.setUniform1f("cameraGroundRelative",
d);this.program.setUniform1f("polygonOffset",c.shaderPolygonOffset);this.program.setUniform4fv("viewport",b.viewport);this.program.setUniform1f("perDistancePixelRatio",Math.tan(b.fovY/2)/(b.viewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",b.viewInvTransp);this.program.setUniform2f("pixelToNDC",2/b.viewport[2],2/b.viewport[3]);this.program.setUniform1f("lineSize",Math.ceil(c.size)*(b.pixelRatio||1));p.bindScreenSizePerspective(c.screenSizePerspective,this.program)};c.prototype.bindDraw=
function(a){f.Transform.bindUniforms(this.program,a);h.Camera.bindUniforms(this.program,a);e.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};c.prototype.initializePipeline=function(){return this.configuration.depthHudEnabled?w.makePipelineState({depthTest:{func:513},depthWrite:x.defaultDepthWriteParams}):w.makePipelineState({blending:w.separateBlendingParams(1,770,771,771),depthTest:{func:513},colorWrite:w.defaultColorWriteParams})};c.shader=new d.ReloadableShaderModule(t,"./LineCallout.glsl",
n);return c}(a.ShaderTechnique);b.LineCalloutTechnique=g;g=function(a){function b(){var c=null!==a&&a.apply(this,arguments)||this;c.occlusionTestEnabled=!0;c.verticalOffset=!1;c.screenSizePerspective=!1;c.depthHudEnabled=!1;c.depthHudAlignStartEnabled=!1;c.screenCenterOffsetUnitsEnabled=0;c.slicePlaneEnabled=!1;return c}m(b,a);k([c.parameter()],b.prototype,"occlusionTestEnabled",void 0);k([c.parameter()],b.prototype,"verticalOffset",void 0);k([c.parameter()],b.prototype,"screenSizePerspective",void 0);
k([c.parameter()],b.prototype,"depthHudEnabled",void 0);k([c.parameter()],b.prototype,"depthHudAlignStartEnabled",void 0);k([c.parameter({count:2})],b.prototype,"screenCenterOffsetUnitsEnabled",void 0);k([c.parameter()],b.prototype,"slicePlaneEnabled",void 0);return b}(c.ShaderTechniqueConfiguration);b.LineCalloutTechniqueConfiguration=g})},"esri/views/3d/webgl-engine/shaders/LineCallout.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/hud/AlignPixel.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,m,k,g,e,f,l){function h(a,c,b){3===b.length?a.setUniform4f(c,b[0],b[1],b[2],1):a.setUniform4fv(c,b)}Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var h=new l.ShaderBuilder;h.include(g.AlignPixel);h.include(e.HUD,b);h.include(k.Slice,b);h.attributes.add("uv0","vec2");h.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2");h.varyings.add("coverageSampling","vec4");h.varyings.add("lineSizes","vec2");h.vertex.code.add(f.glsl(r||
(r=m(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 endPoint \x3d projectPositionHUD(projectAux);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n    ","\n\n    ","\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView \x3d (view * (model * vec4(position, 1.0))).xyz;\n      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n      vec4 startPoint \x3d proj * vec4(posView, 1.0);\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\n      startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\n      endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\n      // Align start and end to pixel origin\n      vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\n    ",
"\n      vec4 projectedPosition \x3d mix(startAligned, endAligned, uv0.y);\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n    ","\n      float halfPixelSize \x3d lineSizeScaled * 0.5;\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt \x3d floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding \x3d 1.0 + borderSizeScaled;\n      vec2 ndcOffset \x3d (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection \x3d (uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize \x3d 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\n\n      coverageSampling \x3d vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position \x3d projectedPosition;\n    }\n  "],
["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 endPoint \x3d projectPositionHUD(projectAux);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n    ","\n\n    ","\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView \x3d (view * (model * vec4(position, 1.0))).xyz;\n      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n      vec4 startPoint \x3d proj * vec4(posView, 1.0);\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\n      startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\n      endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\n      // Align start and end to pixel origin\n      vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\n    ",
"\n      vec4 projectedPosition \x3d mix(startAligned, endAligned, uv0.y);\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n    ","\n      float halfPixelSize \x3d lineSizeScaled * 0.5;\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt \x3d floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding \x3d 1.0 + borderSizeScaled;\n      vec2 ndcOffset \x3d (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection \x3d (uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize \x3d 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\n\n      coverageSampling \x3d vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position \x3d projectedPosition;\n    }\n  "])),
b.occlusionTestEnabled?f.glsl(d||(d=m(["\n      if (!testVisibilityHUD(endPoint)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }"],["\n      if (!testVisibilityHUD(endPoint)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }"]))):"",b.screenSizePerspectiveEnabled?f.glsl(a||(a=m(["\n      vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n        "],
["\n      vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n        "]))):f.glsl(c||(c=m(["\n      vec2 screenOffsetScaled \x3d screenOffset;\n        "],["\n      vec2 screenOffsetScaled \x3d screenOffset;\n        "]))),b.depthHudEnabled?b.depthHudAlignStartEnabled?f.glsl(q||(q=m(["endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);"],
["endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);"]))):f.glsl(p||(p=m(["startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);"],["startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);"]))):"",b.screenSizePerspectiveEnabled?f.glsl(t||(t=m(["\n      float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n        "],
["\n      float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n        "]))):f.glsl(u||(u=m(["\n      float lineSizeScaled \x3d lineSize;\n      float borderSizeScaled \x3d borderSize;\n        "],["\n      float lineSizeScaled \x3d lineSize;\n      float borderSizeScaled \x3d borderSize;\n        "])))));h.fragment.uniforms.add("color","vec4");
h.fragment.uniforms.add("borderColor","vec4");h.fragment.code.add(f.glsl(v||(v=m(["\n    void main() {\n      // Mix between line and border coverage offsets depending on whether we need\n      // a border (based on the sidedness).\n      vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n      // Mix between border and line color based on the line coverage (conceptually the line\n      // blends on top of the border background).\n      //\n      // Anti-alias by blending final result using the full (including optional border) coverage\n      // and the color alpha\n      float borderAlpha \x3d color.a * borderColor.a * coverage.y;\n      float colorAlpha \x3d color.a * coverage.x;\n\n      float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\n\n    ",
"\n  }\n  "],["\n    void main() {\n      // Mix between line and border coverage offsets depending on whether we need\n      // a border (based on the sidedness).\n      vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n      // Mix between border and line color based on the line coverage (conceptually the line\n      // blends on top of the border background).\n      //\n      // Anti-alias by blending final result using the full (including optional border) coverage\n      // and the color alpha\n      float borderAlpha \x3d color.a * borderColor.a * coverage.y;\n      float colorAlpha \x3d color.a * coverage.x;\n\n      float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\n\n    ",
"\n  }\n  "])),b.depthHudEnabled?f.glsl(x||(x=m(["\n      if (finalAlpha \x3c 0.01) {\n        discard;\n      }\n      "],["\n      if (finalAlpha \x3c 0.01) {\n        discard;\n      }\n      "]))):f.glsl(w||(w=m(["\n      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n      // need to divide by finalAlpha). We avoid the division here by setting the\n      // appropriate blending function in the material.\n      vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n      gl_FragColor \x3d vec4(finalRgb, finalAlpha);\n      "],
["\n      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n      // need to divide by finalAlpha). We avoid the division here by setting the\n      // appropriate blending function in the material.\n      vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n      gl_FragColor \x3d vec4(finalRgb, finalAlpha);\n      "])))));return h};(function(a){a.bindUniforms=function(a,c,b){h(a,"color",c.color);b=b.pixelRatio||1;a.setUniform1f("pixelRatio",
b);a.setUniform2f("screenOffset",c.screenOffset[0]*b,c.screenOffset[1]*b);null!==c.borderColor?(h(a,"borderColor",c.borderColor),a.setUniform1f("borderSize",b)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))}})(b.LineCallout||(b.LineCallout={}));var d,a,c,q,p,t,u,r,x,w,v})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["require","exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});
b.getGraphics3DSymbol=function(b){return b instanceof k?b.graphics3DSymbol:b instanceof m?b:null}})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./Loadable ./symbolComplexity".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){var p={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return function(c){function b(a,b,d){var e=c.call(this)||this;e._symbol=a;e._context=b;e._backgroundLayers=d;e._destroyed=!1;e.symbolLayers=[];e.referenced=0;return e}m(b,c);Object.defineProperty(b.prototype,"symbol",{get:function(){return this._symbol},set:function(a){this._symbol=a;if(this.symbolLayers)for(var c=0;c<a.symbolLayers.length;c++){var b=this.symbolLayers[c];f.isNone(b)||(b.symbol=a,b.symbolLayer=
a.symbolLayers.items[c])}},enumerable:!0,configurable:!0});b.prototype.doLoad=function(c){return g(this,void 0,void 0,function(){var b,d,h,m,q,r=this;return k(this,function(t){switch(t.label){case 0:b=this._symbol.symbolLayers;this._backgroundLayers&&(b=this._backgroundLayers.concat(b));for(d=b.length;this.symbolLayers.length<b.length;)this.symbolLayers.push(null);this.symbolLayers.length=b.length;h=function(e){var f=b.getItemAt(e);if(!1===f.enabled)return"continue";p.renderPriority=1-(1+e)/d;p.renderPriorityStep=
1/d;p.ignoreDrivers=f._ignoreDrivers;var h=a.make(m.symbol,f,m._context,p);l.onAbortOrThrow(c,function(){r.symbolLayers[e]=null;h.destroy()});m.symbolLayers[e]=h};m=this;for(q=0;q<d;q++)h(q);return[4,e.forEach(this.symbolLayers,function(a,c){return g(r,void 0,void 0,function(){return k(this,function(b){switch(b.label){case 0:if(!f.isSome(a))return[3,4];b.label=1;case 1:return b.trys.push([1,3,,4]),[4,a.load()];case 2:return b.sent(),[3,4];case 3:return b.sent(),this.symbolLayers[c]=null,[3,4];case 4:return[2]}})})})];
case 1:t.sent();l.throwIfAborted(c);if(this.symbolLayers.length&&!this.symbolLayers.some(function(a){return!!a}))throw Error();return[2]}})})};b.prototype.getSymbolLayerSize=function(a){a=this.symbolLayers[a];return f.isSome(a)?a.getCachedSize():null};b.prototype.createGraphics3DGraphic=function(a,c){for(var b=a.graphic,d=Array(this.symbolLayers.length),e=0;e<this.symbolLayers.length;e++){var l=this.symbolLayers[e];d[e]=f.isSome(l)?l.createGraphics3DGraphic(a):null}return new h(b,c||this,d,a.layer,
this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};Object.defineProperty(b.prototype,"complexity",{get:function(){return q.totalSymbolComplexities(this.symbolLayers.map(function(a){return f.isSome(a)&&a.complexity}))},enumerable:!0,configurable:!0});b.prototype.globalPropertyChanged=function(a,c){for(var b=this.symbolLayers.length,e=function(b){var e=h.symbolLayers[b],
l=function(a){a=a._graphics[b];return a instanceof d?a:null};if(f.isSome(e)&&!e.globalPropertyChanged(a,c,l))return{value:!1}},h=this,l=0;l<b;l++){var g=e(l);if("object"===typeof g)return g.value}return!0};b.prototype.applyRendererDiff=function(a,c){return 1!==this.loadStatus?!1:this.symbolLayers.reduce(function(b,d){return b&&(f.isNone(d)||d.applyRendererDiff(a,c))},!0)};b.prototype.prepareSymbolPatch=function(a){if(2!==this.loadStatus&&"partial"===a.diff.type){var c=a.diff.diff;if(c.symbolLayers&&
"partial"===c.symbolLayers.type){var b=c.symbolLayers.diff;this.symbolLayers.forEach(function(c,d){var e;if(!f.isNone(c)){var h=b[d];if(h){var l={diff:h,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};c.prepareSymbolLayerPatch(l);(e=a.symbolStatePatches).push.apply(e,l.symbolLayerStatePatches);l.graphics3DGraphicPatches.length&&a.graphics3DGraphicPatches.push(function(a,c){var b=a._graphics[d];f.isSome(b)&&l.graphics3DGraphicPatches.forEach(function(a){return a(b,c)})})}}})}}};b.prototype.updateGeometry=
function(a,c){for(var b=0;b<this.symbolLayers.length;b++){var d=this.symbolLayers[b];if(!f.isNone(d)){var e=a._graphics[b];if(f.isSome(e)&&!d.updateGeometry(e,c))return!1}}return!0};b.prototype.onRemoveGraphic=function(a){for(var c=0;c<this.symbolLayers.length;c++){var b=this.symbolLayers[c];if(!f.isNone(b)){var d=a._graphics[c];if(f.isSome(d))b.onRemoveGraphic(d)}}};b.prototype.getFastUpdateStatus=function(){var a=0,c=0,b=0;this.symbolLayers.forEach(function(d){f.isNone(d)||(0===d.loadStatus?a++:
d.isFastUpdatesEnabled()?b++:c++)});return{loading:a,slow:c,fast:b}};b.prototype.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{this.abortLoad();for(var a=0,c=this.symbolLayers;a<c.length;a++){var b=c[a];f.isSome(b)&&b.destroy()}this.symbolLayers.length=0;this._destroyed=!0}};Object.defineProperty(b.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0});return b}(c.Loadable)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./featureExpressionInfoUtils ../../support/projectionUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x){var w=new f(Array,function(a){return q.set(a,q.ZERO)},null,10,5),v=p.create();return function(){function b(a,c,b,d,f){this._labelGraphics=[];this._auxiliaryGraphics=[];for(var h=Array(2),l=0;l<h.length;l++)h[l]=Array(4);this._visibilityFlags=h;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this._extent=null;this.isElevationSource=!1;++c.referenced;this.graphics3DSymbol=c;this.graphic=a;this._graphics=b;this._featureExpressionFeature=
f?r.createFeature(f,a,d):null;a=0;for(c=this._graphics;a<c.length;a++)b=c[a],e.isSome(b)&&(this.isElevationSource=this.isElevationSource||b.isElevationSource)}Object.defineProperty(b.prototype,"labelGraphics",{get:function(){return this._labelGraphics},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"extent",{get:function(){return this._extent},enumerable:!0,configurable:!0});b.prototype.initialize=function(a,c,b){var d=this;this._layer=c;this._stage=a;this.forEachSymbolLayerGraphic(function(e){e.initialize(a,
c,b);e.setVisibility(d.isVisible())})};b.prototype.destroy=function(){this.forEachSymbolLayerGraphic(function(a){return a.destroy()});this._auxiliaryGraphics=this._graphics=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null};Object.defineProperty(b.prototype,"destroyed",{get:function(){return null==this._graphics},enumerable:!0,configurable:!0});b.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});this._labelGraphics.length=0};b.prototype.addLabelGraphic=
function(a,c,b){this._labelGraphics.push(a);a.initialize(c,b);a.setVisibility(this.isVisible(1))};b.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);this._layer&&(a.initialize(this._stage,this._layer),a.setVisibility(this.isVisible()))};Object.defineProperty(b.prototype,"isDraped",{get:function(){var a=!1;this.forEachSymbolLayerGraphic(function(c){"draped"===c.type&&(a=!0)});return a},enumerable:!0,configurable:!0});b.prototype.isVisible=function(a,c){void 0===a&&(a=0);for(var b=
0;b<=a;b++)for(var d=this._visibilityFlags[b],e=0;e<d.length;++e)if(!1===d[e]&&e!==c)return!1;return!0};b.prototype.hasVisibilityFlag=function(a,c){return null!=this._visibilityFlags[c][a]};b.prototype.setVisibilityFlag=function(a,c,b){var d=this.isVisible(b);this._visibilityFlags[b][a]=c;var e=this.isVisible(b);if(d===e)return!1;if(1===b)this.forEachLabelGraphic(function(a){return a.setVisibility(e)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(e)});var f=this.isVisible(1);
this.forEachLabelGraphic(function(a){return a.setVisibility(f)})}return!0};b.prototype.clearVisibilityFlag=function(a,c){void 0===c&&(c=0);return this.setVisibilityFlag(a,void 0,c)};b.prototype.getBSRadius=function(){var a=0;this.forEachSymbolLayerGraphic(function(c){a=Math.max(a,c.getBSRadius())});return a};b.prototype.getCenterObjectSpace=function(c){void 0===c&&(c=a.vec3f64.create());if(0===this._graphics.length)return d.vec3.set(c,0,0,0),c;var b=this._graphics[0];return e.isSome(b)?b.getCenterObjectSpace(c):
c};b.prototype.computeExtent=function(a){if(!this._extent){var c=this.graphic.geometry;if(e.isNone(c))return!1;this._extent=p.create();t.computeAABR(c,this._extent);c=c.spatialReference;if(!c.equals(a)&&!x.boundingRectToBoundingRect(this._extent,c,this._extent,a))return this._extent=null,!1}return!0};b.prototype.getAsOptimizedGeometry=function(a,c){if(this._optimizedGeometry.geometry&&this._optimizedGeometry.hasZ===a&&this._optimizedGeometry.hasM===c)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=
this._convertGraphicToOptimizedGeometry(this.graphic,a,c);this._optimizedGeometry.hasZ=a;this._optimizedGeometry.hasM=c;return this._optimizedGeometry.geometry};b.prototype._convertGraphicToOptimizedGeometry=function(a,b,d){a=a.geometry;if("mesh"===a.type||"extent"===a.type)a=c.fromExtent("mesh"===a.type?a.extent:a);return u.convertFromGeometry(a,b,d)};Object.defineProperty(b.prototype,"usedMemory",{get:function(){var a=this,c=t.estimateAttributesObjectSize(this.graphic.attributes);this.forEachSymbolLayerGraphic(function(b){var d=
b.graphics3DSymbolLayer.complexity;b="draped"===b.type?d.memory.draped:d.memory;c+=b.bytesPerFeature;b.bytesPerCoordinate&&(c+=t.numVertices(a.graphic.geometry)*b.bytesPerCoordinate)});return c},enumerable:!0,configurable:!0});b.prototype.computeAttachmentOrigin=function(){for(var c={render:{origin:a.vec3f64.create(),num:0},draped:{origin:h.vec2f64.create(),num:0}},b=0,f=this._graphics;b<f.length;b++){var g=f[b];e.isNone(g)||g.computeAttachmentOrigin(c)}c.render.num&&d.vec3.scale(c.render.origin,
c.render.origin,1/c.render.num);c.draped.num&&l.vec2.scale(c.draped.origin,c.draped.origin,1/c.draped.num);return c};b.prototype.getProjectedBoundingBox=function(a,c,b,d,f){return k(this,void 0,void 0,function(){var h=this;return m(this,function(l){switch(l.label){case 0:return f||(f={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),f.boundingBox?q.empty(f.boundingBox):f.boundingBox=q.empty(),f.requiresDrapedElevation=!1,[4,g.forEach(this._graphics,function(l){return k(h,void 0,
void 0,function(){var h,g,k;return m(this,function(p){switch(p.label){case 0:if(e.isNone(l))return[2];h="draped"===l.type?c:a;g=w.acquire();return[4,l.getProjectedBoundingBox(h,b,f.screenSpaceObjects,d,g)];case 1:return k=p.sent(),isFinite(k[2])&&isFinite(k[5])||(f.requiresDrapedElevation=!0),k&&q.expand(f.boundingBox,g),w.release(g),[2]}})})})];case 1:return l.sent(),q.allFinite(f.boundingBox)||p.allFinite(q.toRect(f.boundingBox,v))?[2,f]:[2,null]}})})};b.prototype.needsElevationUpdates=function(){for(var a=
0,c=this._graphics;a<c.length;a++){var b=c[a];if(e.isSome(b)&&("object3d"===b.type||"lod-instance"===b.type)&&b.needsElevationUpdates)return!0}a=0;for(c=this._labelGraphics;a<c.length;a++)if((b=c[a])&&b.needsElevationUpdates)return!0;return!1};b.prototype.alignWithElevation=function(a,c,b){var d=this;this.forEachRenderedGraphic(function(e){"object3d"!==e.type&&"lod-instance"!==e.type||e.alignWithElevation(a,c,d._featureExpressionFeature,b)})};b.prototype.addObjectStateSet=function(a,c){this.forEachSymbolLayerGraphic(function(b){return b.addObjectState(a,
c)})};b.prototype.removeObjectState=function(a){this.forEachSymbolLayerGraphic(function(c){return c.removeObjectState(a)})};b.prototype.forEachGraphicList=function(a,c){a.forEach(function(a){return a&&c(a)})};b.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};b.prototype.forEachLabelGraphic=function(a){this.forEachGraphicList(this._labelGraphics,a)};b.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);
this.forEachLabelGraphic(a)};return b}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,
"__esModule",{value:!0});var q=m.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");b.make=function(a,c,b,d){var e=t[a.type]&&t[a.type][c.type]||p[c.type];return e?new e(a,c,b,d):(q.error("GraphicsLayerFactory#make","unknown symbol type "+c.type),null)};var p={icon:g.default,object:l.default,line:e.default,path:h.default,fill:d.default,extrude:k.default,text:a.default,water:c.default};b.setSymbolClass=function(a,c){p[a]=c};var t={"mesh-3d":{fill:f.default}}})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/maybe ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/renderingInfoUtils ./elevationAlignmentUtils ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./polygonUtils ../support/edgeUtils ../../support/projectionUtils ../../support/buffer/BufferView ../../support/buffer/math/vec3 ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L,O){function K(a,c,b,d,e,f,h,l,g,k,m,q,r,t){var u=b.length/3,v=0;m+=2*d.count;var y=d.index,x=d.count,w=g,n=m;p.vec3.copy(R,r);var z=0<q?1:-1,y=3*y,A=w;r=3*A;for(var B=w+x,w=3*B,C=0;C<x;++C)t&&(R[0]=a[y+0],R[1]=a[y+1],R[2]=a[y+2],p.vec3.normalize(R,R)),e[r+0]=a[y+0],e[r+1]=a[y+1],e[r+2]=a[y+2],f[r+0]=c[y+0],f[r+1]=c[y+1],f[r+2]=c[y+2],h[r+0]=-z*R[0],h[r+1]=-z*R[1],h[r+2]=-z*R[2],l[A]=0,e[w+0]=a[y+0]+q*R[0],e[w+1]=a[y+1]+q*R[1],
e[w+2]=a[y+2]+q*R[2],f[w+0]=c[y+0],f[w+1]=c[y+1],f[w+2]=c[y+2],h[w+0]=z*R[0],h[w+1]=z*R[1],h[w+2]=z*R[2],l[B]=q,r+=3,w+=3,y+=3,A+=1,B+=1;y=0;r=3*n;w=3*(n+u);r=3*(n+u);w=3*n;a=aa;c=da;0>q&&(a=da,c=aa);for(C=0;C<u;++C)k[r+0]=b[y+a[0]],k[r+1]=b[y+a[1]],k[r+2]=b[y+a[2]],k[w+0]=b[y+c[0]]+x,k[w+1]=b[y+c[1]]+x,k[w+2]=b[y+c[2]]+x,r+=3,w+=3,y+=3;g+=2*d.count;m=m+2*u-(2*d.count+2*u);Q(e,f,l,h,v,d.pathLengths[0],d.count,g,k,m,q);g+=4*d.pathLengths[0];m+=2*d.pathLengths[0];v+=d.pathLengths[0];for(b=1;b<d.pathLengths.length;++b)Q(e,
f,l,h,v,d.pathLengths[b],d.count,g,k,m,q),g+=4*d.pathLengths[b],m+=2*d.pathLengths[b],v+=d.pathLengths[b]}function N(a,c,b,d,e,f,h){d[f]=d[h];h*=3;f*=3;a[f+0]=a[h+0];a[f+1]=a[h+1];a[f+2]=a[h+2];c[f+0]=c[h+0];c[f+1]=c[h+1];c[f+2]=c[h+2];b[f+0]=e[0];b[f+1]=e[1];b[f+2]=e[2]}function Q(a,c,b,d,e,f,h,l,g,k,m){var q=e,r=e+1,t=e+h,u=e+h+1,v=l,y=l+1,x=l+2*f;l=l+2*f+1;0>m&&(q=e+h+1,u=e);k*=3;for(var w=0;w<f;++w){w===f-1&&(0<m?(r=e,u=e+h):(r=e,q=e+h));var n=a,z=q,A=r,B=t,C=T,z=3*z,A=3*A,B=3*B;p.vec3.set(P,
n[z++],n[z++],n[z++]);p.vec3.set(S,n[A++],n[A++],n[A++]);p.vec3.set(V,n[B++],n[B++],n[B++]);p.vec3.subtract(J,S,P);p.vec3.subtract(U,V,P);p.vec3.cross(C,U,J);p.vec3.normalize(C,C);N(a,c,d,b,T,v,q);N(a,c,d,b,T,y,r);N(a,c,d,b,T,x,t);N(a,c,d,b,T,l,u);g[k++]=v;g[k++]=x;g[k++]=l;g[k++]=v;g[k++]=l;g[k++]=y;q++;r++;t++;u++;v+=2;y+=2;x+=2;l+=2}}function M(a,b,d,e){a=a.stageObject;ca.spatialReference=d.spatialReference;for(var f=a.geometryRecords,h=f.length,l="absolute-height"!==b.mode,g=0,k=a.objectTransformation,
m=c.mat4.invert(q.mat4f64.create(),k),r=0;r<h;r++){var t=f[r].geometry;t.invalidateBoundingInfo();for(var u=t.data.getVertexAttr(),t=u[L.VertexAttrConstants.POSITION].data,v=u[L.VertexAttrConstants.SIZE].data,u=u.mapPos.data,y=t.length/3,x=0,n=0,z=!1,A=0,B=0;B<y;B++){ca.x=u[n];ca.y=u[n+1];ca.z=u[n+2];Y[0]=t[x];Y[1]=t[x+1];Y[2]=t[x+2];var C=w.evaluateElevationAlignmentAtPoint(ca,d,b,e,l?ba:null);l&&(A+=ba.sampledElevation);p.vec3.set(X,t[x+0],t[x+1],t[x+2]);p.vec3.transformMat4(X,X,k);e.setAltitude(C+
v[x/3],X);p.vec3.transformMat4(X,X,m);t[x]=X[0];t[x+1]=X[1];t[x+2]=X[2];C=.01/e.unitInMeters;if(Math.abs(Y[0]-t[x])>C||Math.abs(Y[1]-t[x+1])>C||Math.abs(Y[2]-t[x+2])>C)z=!0;n+=3;x+=3}z&&a.geometryVertexAttrsUpdated(r);g+=A/y}return g/h}Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(a,c,d,e){a=b.call(this,a,c,d,e)||this;a.ensureDrapedStatus(!1);return a}m(e,b);e.prototype.doLoad=function(){return g(this,void 0,void 0,function(){var a,c,b,d,e,h;return k(this,function(g){if(!this._drivenProperties.size&&
(a=A.validateSymbolLayerSize(this._getSymbolSize())))throw new f("graphics3dextrudesymbollayer:invalid-size",a);c=l.get(this.symbolLayer,"material","color");b=this._getCombinedOpacityAndColor(c);d=t.vec3f64.fromArray(b);e=b[3];h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:d,ambient:d,opacity:e,transparent:1>e||this.needsDrivenTransparentPass,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};
this._material=new O(h,this._getIdHint("_3dlinemat"));this._context.stage.add(3,this._material);return[2]})})};e.prototype.destroy=function(){b.prototype.destroy.call(this);this._material&&this._context.stage.remove(3,this._material.id)};e.prototype.createGraphics3DGraphic=function(a){var c=a.graphic;if(!this._validateGeometryType(c.geometry,e.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(c.geometry))return null;var b="graphic"+c.uid,d=this._getVertexOpacityAndColor(a.renderingInfo,
Float32Array,255),f=this.getGraphicElevationContext(c);return this._createAs3DShape(c,a.renderingInfo,d,f,b,c.uid)};e.prototype.layerOpacityChanged=function(a,c){var b=this,d=l.get(this.symbolLayer,"material","color"),d=this._getCombinedOpacity(d);this._material.setParameterValues({opacity:d,transparent:1>d||this.needsDrivenTransparentPass});var e=this._getLayerOpacity();a.forEach(function(a){a=c(a);l.isSome(a)&&a.layerOpacityChanged(e,b._context.isAsync)});return!0};e.prototype.layerElevationInfoChanged=
function(a,c){return this.updateGraphics3DGraphicElevationInfo(a,c,v.needsElevationUpdates3D)};e.prototype.slicePlaneEnabledChanged=function(a,c){var b=this;this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});a.forEach(function(a){a=c(a);l.isSome(a)&&a.slicePlaneEnabledChanged(b._context.slicePlaneEnabled,b._context.isAsync)});return!0};e.prototype.physicalBasedRenderingChanged=function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0});return!0};e.prototype.pixelRatioChanged=function(){return!0};e.prototype._getExtrusionSize=function(a){a=a.size&&this._drivenProperties.size?x.getDriverAxisSizeValue(a.size,2):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};e.prototype._getSymbolSize=function(){return this.symbolLayer.size||1};e.prototype._createAs3DShape=function(b,e,f,g,k,m){var p=B.geometryAsPolygon(b.geometry);if(l.isNone(p))return null;b=[];var r=[],y=[],x=u.create(),w="global"===
this._context.renderCoordsHelper.type,n=this._getExtrusionSize(e),C=t.vec3f64.create();w||this._context.renderCoordsHelper.worldUpAtPosition(null,C);e=B.geometryToRenderInfo(p,this._context.elevationProvider,this._context.renderCoordsHelper,g);this._logGeometryCreationWarnings(e,p.rings,"rings","ExtrudeSymbol3DLayer");if(0===p.rings.length||!p.rings.some(function(a){return 0<a.length}))return null;var O=A.computeCentroid(p);if(l.isNone(O))return null;var N=q.mat4f64.create();F.computeLinearTransformation(p.spatialReference,
[O.x,O.y,0],N,this._context.renderCoordsHelper.spatialReference);p=q.mat4f64.create();c.mat4.invert(p,N);O=a.mat3f64.create();d.mat3.normalFromMat4(O,p);for(var S=e.polygons,V=e.mapPosition,L=e.position,D=L.length/3,J=new Float64Array(18*D),Q=new Float64Array(18*D),T=new Float64Array(18*D),D=new Float64Array(6*D),P=0,U=0;U<S.length;++U){var W=S[U],R=W.count;if(this._context.clippingExtent&&(u.empty(x),u.expandWithBuffer(x,W.mapPosition),!u.intersectsClippingArea(x,this._context.clippingExtent)))continue;
var ca=h.earcut(W.mapPosition,W.holeIndices,3);if(0!==ca.length){var Z=new Uint32Array(6*R+2*ca.length),Y=6*R,ba=3*J.BYTES_PER_ELEMENT,ba=new E.BufferViewVec3f64(J.buffer,P*ba,ba,(P+Y)*ba),X=3*Q.BYTES_PER_ELEMENT,X=new E.BufferViewVec3f64(Q.buffer,P*X,X,(P+Y)*X),ea=new Float64Array(T.buffer,3*P*T.BYTES_PER_ELEMENT,3*Y),Y=new Float64Array(D.buffer,1*P*D.BYTES_PER_ELEMENT,1*Y);K(L,V,ca,W,ba.typedBuffer,ea,X.typedBuffer,Y,0,Z,0,n,C,w);G.transformMat4(ba,ba,p);G.transformMat3(X,X,O);P+=6*R;W=this._createExtrudeGeometry(Z,
{positions:ba.typedBuffer,elevation:ea,normals:X.typedBuffer,heights:Y},f);W=new H(W,k+"path"+U);b.push(W);r.push(this._material);y.push(q.mat4f64.IDENTITY)}}if(0===b.length)return null;f=new I({geometries:b,materials:r,transformations:y,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:m,isElevationSource:!0},idHint:k});f.objectTransformation=N;k=this._createEdgeMaterial();k=l.isSome(k)?{baseMaterial:this._material,edgeMaterials:[k],slicePlaneEnabled:this._context.slicePlaneEnabled}:
null;b=new z(this,f,b,null,null,M,g,k);b.alignedSampledElevation=e.sampledElevation;b.needsElevationUpdates=v.needsElevationUpdates3D(g.mode);return b};e.prototype._createExtrudeGeometry=function(a,c,b){for(var d=a.length,e=new Uint32Array(d),f=0;f<d;f++)e[f]=0;d={};f={};d[L.VertexAttrConstants.POSITION]=a;d[L.VertexAttrConstants.NORMAL]=a;d[L.VertexAttrConstants.COLOR]=e;f[L.VertexAttrConstants.POSITION]={size:3,data:c.positions};f[L.VertexAttrConstants.NORMAL]={size:3,data:c.normals};f[L.VertexAttrConstants.COLOR]=
{size:4,data:b};f[L.VertexAttrConstants.SIZE]={size:1,data:c.heights};c.elevation&&(f.mapPos={size:3,data:c.elevation},d.mapPos=a);return new D.GeometryData(f,d)};e.prototype._createEdgeMaterial=function(){var a={opacity:this._getLayerOpacity()};return C.createMaterial(this.symbolLayer,a)};e.validGeometryTypes=["polygon","extent"];return e}(y.default);b.Graphics3DExtrudeSymbolLayer=n;var T=t.vec3f64.create(),P=t.vec3f64.create(),S=t.vec3f64.create(),V=t.vec3f64.create(),J=t.vec3f64.create(),U=t.vec3f64.create(),
Y=t.vec3f64.create(),X=t.vec3f64.create(),R=t.vec3f64.create(),aa=[0,2,1],da=[0,1,2],ca=r.makeDehydratedPoint(0,0,0,null),ba={verticalDistanceToGround:0,sampledElevation:0};b.default=n})},"esri/core/libs/earcut/earcut":function(){define(["require","exports"],function(n,b){function m(a,c,b,d,e){var h;if(e===0<p(a,c,b,d))for(e=c;e<b;e+=d)h=f(e,a[e],a[e+1],h);else for(e=b-d;e>=c;e-=d)h=f(e,a[e],a[e+1],h);h&&x(h,h.next)&&(l(h),h=h.next);return h}function k(a,b){void 0===b&&(b=a);if(!a)return a;var d;
do if(d=!1,a.steiner||!x(a,a.next)&&0!==c(a.prev,a,a.next))a=a.next;else{l(a);a=b=a.prev;if(a===a.next)break;d=!0}while(d||a!==b);return b}function g(b,d,f,h,p,m,r){void 0===r&&(r=0);if(b){!r&&m&&(b=a(b,h,p,m));for(var y=b;b.prev!==b.next;){var w=b.prev,n=b.next,z;if(m)z=e(b,h,p,m);else a:{z=b;var A=z.prev,B=z,C=z.next;if(0<=c(A,B,C))z=!1;else{for(var F=z.next.next,E=F,G=0;F!==z.prev&&(0===G||F!==E);){G++;if(t(A.x,A.y,B.x,B.y,C.x,C.y,F.x,F.y)&&0<=c(F.prev,F,F.next)){z=!1;break a}F=F.next}z=!0}}if(z)d.push(w.index/
f),d.push(b.index/f),d.push(n.index/f),l(b),y=b=n.next;else if(b=n,b===y){if(!r)g(k(b),d,f,h,p,m,1);else if(1===r){r=d;y=f;w=b;do n=w.prev,z=w.next.next,!x(n,z)&&q(n,w,w.next,z)&&u(n,z)&&u(z,n)&&(r.push(n.index/y),r.push(w.index/y),r.push(z.index/y),l(w),l(w.next),w=b=z),w=w.next;while(w!==b);b=w;g(b,d,f,h,p,m,2)}else if(2===r)a:{r=b;do{for(y=r.next.next;y!==r.prev;){if(w=r.index!==y.index){w=r;n=y;z=void 0;if(z=w.next.index!==n.index&&w.prev.index!==n.index){z=void 0;b:{z=w;do{if(z.index!==w.index&&
z.next.index!==w.index&&z.index!==n.index&&z.next.index!==n.index&&q(z,z.next,w,n)){z=!0;break b}z=z.next}while(z!==w);z=!1}z=!z}A=void 0;if(A=z&&u(w,n)&&u(n,w)){z=w;A=!1;B=(w.x+n.x)/2;n=(w.y+n.y)/2;do z.y>n!==z.next.y>n&&z.next.y!==z.y&&B<(z.next.x-z.x)*(n-z.y)/(z.next.y-z.y)+z.x&&(A=!A),z=z.next;while(z!==w)}w=A}if(w){b=v(r,y);r=k(r,r.next);b=k(b,b.next);g(r,d,f,h,p,m);g(b,d,f,h,p,m);break a}y=y.next}r=r.next}while(r!==b)}break}}}}function e(a,b,d,e){var f=a.prev,h=a.next;if(0<=c(f,a,h))return!1;
var l=f.x>a.x?f.x>h.x?f.x:h.x:a.x>h.x?a.x:h.x,g=f.y>a.y?f.y>h.y?f.y:h.y:a.y>h.y?a.y:h.y,k=r(f.x<a.x?f.x<h.x?f.x:h.x:a.x<h.x?a.x:h.x,f.y<a.y?f.y<h.y?f.y:h.y:a.y<h.y?a.y:h.y,b,d,e);b=r(l,g,b,d,e);d=a.prevZ;for(e=a.nextZ;d&&d.z>=k&&e&&e.z<=b;){if(d!==a.prev&&d!==a.next&&t(f.x,f.y,a.x,a.y,h.x,h.y,d.x,d.y)&&0<=c(d.prev,d,d.next))return!1;d=d.prevZ;if(e!==a.prev&&e!==a.next&&t(f.x,f.y,a.x,a.y,h.x,h.y,e.x,e.y)&&0<=c(e.prev,e,e.next))return!1;e=e.nextZ}for(;d&&d.z>=k;){if(d!==a.prev&&d!==a.next&&t(f.x,f.y,
a.x,a.y,h.x,h.y,d.x,d.y)&&0<=c(d.prev,d,d.next))return!1;d=d.prevZ}for(;e&&e.z<=b;){if(e!==a.prev&&e!==a.next&&t(f.x,f.y,a.x,a.y,h.x,h.y,e.x,e.y)&&0<=c(e.prev,e,e.next))return!1;e=e.nextZ}return!0}function f(a,c,b,d){a=new z(a,c,b);d?(a.next=d.next,a.prev=d,d.next.prev=a,d.next=a):(a.prev=a,a.next=a);return a}function l(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function h(a){var c=a,b=a;do{if(c.x<b.x||c.x===b.x&&c.y<b.y)b=c;c=c.next}while(c!==
a);return b}function d(a,c){var b=c,d=a.x,e=a.y,f=-Infinity,h;do{if(e<=b.y&&e>=b.next.y&&b.next.y!==b.y){var l=b.x+(e-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(l<=d&&l>f){f=l;if(l===d){if(e===b.y)return b;if(e===b.next.y)return b.next}h=b.x<b.next.x?b:b.next}}b=b.next}while(b!==c);if(!h)return null;if(d===f)return h.prev;c=h;for(var l=h.x,g=h.y,k=Infinity,p,b=h.next;b!==c;)d>=b.x&&b.x>=l&&d!==b.x&&t(e<g?d:f,e,l,g,e<g?f:d,e,b.x,b.y)&&(p=Math.abs(e-b.y)/(d-b.x),(p<k||p===k&&b.x>h.x)&&u(b,a)&&(h=b,k=p)),
b=b.next;return h}function a(c,b,d,e){for(var f=void 0;f!==c;f=f.next){f=f||c;null===f.z&&(f.z=r(f.x,f.y,b,d,e));if(f.prev.next!==f||f.next.prev!==f)return f.prev.next=f,f.next.prev=f,a(c,b,d,e);f.prevZ=f.prev;f.nextZ=f.next}c.prevZ.nextZ=null;c.prevZ=null;a:for(d=1;;){e=c;f=void 0;b=c=null;for(var h=0;e;){h++;for(var f=e,l=0;l<d&&f;l++)f=f.nextZ;for(var g=d;0<l||0<g&&f;){var k=void 0;0===l?(k=f,f=f.nextZ,g--):0!==g&&f?e.z<=f.z?(k=e,e=e.nextZ,l--):(k=f,f=f.nextZ,g--):(k=e,e=e.nextZ,l--);b?b.nextZ=
k:c=k;k.prevZ=b;b=k}e=f}b.nextZ=null;d*=2;if(2>h)break a}return c}function c(a,c,b){return(c.y-a.y)*(b.x-c.x)-(c.x-a.x)*(b.y-c.y)}function q(a,b,d,e){return x(a,b)&&x(d,e)||x(a,e)&&x(d,b)?!0:0<c(a,b,d)!==0<c(a,b,e)&&0<c(d,e,a)!==0<c(d,e,b)}function p(a,c,b,d){for(var e=0,f=b-d;c<b;c+=d)e+=(a[f]-a[c])*(a[c+1]+a[f+1]),f=c;return e}function t(a,c,b,d,e,f,h,l){return 0<=(e-h)*(c-l)-(a-h)*(f-l)&&0<=(a-h)*(d-l)-(b-h)*(c-l)&&0<=(b-h)*(f-l)-(e-h)*(d-l)}function u(a,b){return 0>c(a.prev,a,a.next)?0<=c(a,b,
a.next)&&0<=c(a,a.prev,b):0>c(a,b,a.prev)||0>c(a,a.next,b)}function r(a,c,b,d,e){a=32767*(a-b)*e;c=32767*(c-d)*e;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;c=(c|c<<8)&16711935;c=(c|c<<4)&252645135;c=(c|c<<2)&858993459;return(a|a<<1)&1431655765|((c|c<<1)&1431655765)<<1}function x(a,c){return a.x===c.x&&a.y===c.y}function w(a,c){return a.x-c.x}function v(a,c){var b=new z(a.index,a.x,a.y),d=new z(c.index,c.x,c.y),e=a.next,f=c.prev;a.next=c;c.prev=a;b.next=e;e.prev=b;d.next=b;b.prev=
d;f.next=d;d.prev=f;return d}Object.defineProperty(b,"__esModule",{value:!0});b.earcut=function(a,c,b){var e=c&&c.length,f=e?c[0]*b:a.length,l=m(a,0,f,b,!0),p=[];if(!l||l.next===l.prev)return p;var q,r,t;if(e){for(var e=[],u=0,x=c.length;u<x;u++){var n=m(a,c[u]*b,u<x-1?c[u+1]*b:a.length,b,!1);n===n.next&&(n.steiner=!0);e.push(h(n))}e.sort(w);for(c=0;c<e.length;c++){u=e[c];x=l;if(x=d(u,x))u=v(x,u),k(u,u.next);l=k(l,l.next)}}if(a.length>80*b){q=t=a[0];r=e=a[1];for(c=b;c<f;c+=b)u=a[c],x=a[c+1],q=Math.min(q,
u),r=Math.min(r,x),t=Math.max(t,u),e=Math.max(e,x);t=Math.max(t-q,e-r);t=0!==t?1/t:0}g(l,p,b,q,r,t);return p};b.deviation=function(a,c,b,d){var e=c&&c.length,f=Math.abs(p(a,0,e?c[0]*b:a.length,b));if(e)for(var e=0,h=c.length;e<h;e++)f-=Math.abs(p(a,c[e]*b,e<h-1?c[e+1]*b:a.length,b));for(e=c=0;e<d.length;e+=3){var h=d[e]*b,l=d[e+1]*b,g=d[e+2]*b;c+=Math.abs((a[h]-a[g])*(a[l+1]-a[h+1])-(a[h]-a[l])*(a[g+1]-a[h+1]))}return 0===f&&0===c?0:Math.abs((c-f)/f)};var z=function(){return function(a,c,b){this.index=
a;this.x=c;this.y=b;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}}()})},"esri/renderers/support/renderingInfoUtils":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Color ../../core/maybe ../visualVariables/support/visualVariableUtils".split(" "),function(n,b,m,k,g,e,f,l){function h(a,b){if(!a||a.symbol)return null;b=b&&b.renderer;return a&&f.isSome(b)&&b.getObservationRenderer?
b.getObservationRenderer(a):b}function d(a,b){if(f.isSome(a.symbol))return a.symbol;var c=h(a,b);return f.isSome(c)?c.getSymbol(a,b):null}function a(a,b){return g(this,void 0,void 0,function(){var c;return k(this,function(d){if(f.isSome(a.symbol))return[2,a.symbol];c=h(a,b);return[2,f.isSome(c)&&c.getSymbolAsync(a,m({},b,{abortOptions:{signal:b.signal}}))]})})}Object.defineProperty(b,"__esModule",{value:!0});b.getRenderer=h;b.getSymbol=d;b.getRenderingInfo=function(a,b){var c=h(a,b),e=d(a,b);if(!e)return null;
e={renderer:c,symbol:e};if(f.isNone(c)||!("visualVariables"in c)||!c.visualVariables)return e;var g=["proportional","proportional","proportional"],k=0;for(a=l.getVisualVariableValues(c,a,b);k<a.length;k++)switch(c=a[k],b=c.variable,c=c.value,b.type){case "color":e.color=c.toRgba();break;case "size":if("outline"===b.target)e.outlineSize=c;else switch(c=b.useSymbolValue?"symbol-value":c,b.axis){case "width":g[0]=c;break;case "depth":g[1]=c;break;case "height":g[2]=c;break;case "width-and-depth":g[0]=
g[1]=c;break;default:g[0]=g[1]=g[2]=c}break;case "opacity":e.opacity=c;break;case "rotation":switch(b.axis){case "tilt":e.tilt=c;break;case "roll":e.roll=c;break;default:e.heading=c}}if("proportional"!==g[0]||"proportional"!==g[1]||"proportional"!==g[2])e.size=g;return e};b.getSymbolAsync=a;b.getRenderingInfoAsync=function(c,b){return g(this,void 0,void 0,function(){var d,f,g,m,q,w,v,n,y,A,B,C;return k(this,function(k){switch(k.label){case 0:return d=h(c,b),[4,a(c,b)];case 1:f=k.sent();if(!f)return[2,
null];g={renderer:d,symbol:f};if(!(d&&"visualVariables"in d&&d.visualVariables))return[2,g];m=l.getVisualVariableValues(d,c,b);q=["proportional","proportional","proportional"];w=0;for(v=m;w<v.length;w++)n=v[w],y=n.variable,A=n.value,"color"===y.type?g.color=e.toUnitRGBA(A):"size"===y.type?"outline"===y.target?g.outlineSize=A:(B=y.axis,C=y.useSymbolValue?"symbol-value":A,"width"===B?q[0]=C:"depth"===B?q[1]=C:"height"===B?q[2]=C:q[0]="width-and-depth"===B?q[1]=C:q[1]=q[2]=C):"opacity"===y.type?g.opacity=
A:"rotation"===y.type&&"tilt"===y.axis?g.tilt=A:"rotation"===y.type&&"roll"===y.axis?g.roll=A:"rotation"===y.type&&(g.heading=A);if(isFinite(q[0])||isFinite(q[1])||isFinite(q[2]))g.size=q;return[2,g]}})})};b.getDriverAxisSizeValue=function(a,b){void 0===b&&(b=0);a=a[b];return"number"===typeof a&&isFinite(a)?a:null}})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../geometry ../../../../core/maybe ../../../../geometry/support/triangulationUtils ./elevationAlignmentUtils ../../support/projectionUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){function c(a,c,b){for(var d=[],e=0;e<a.length;e++){var f=a[e],h=f.index,f=f.count;if(!(1>=f)){var l=3*h,g=l+3*f;d.push({index:h,count:f,position:c.subarray(l,g),mapPosition:b?b.subarray(l,g):void 0})}}return d}function q(a,c,b){for(var d=[],e=function(a,e,f,h){if(1>=e)return"continue";var l=3*a,g=l+3*e;f=f.map(function(c){return c-a});d.push({index:a,count:e,holeIndices:f,pathLengths:h,position:c.subarray(l,g),mapPosition:b?b.subarray(l,g):void 0})},f=0;f<a.length;f++){var h=
a[f];e(h.index,h.count,h.holeIndices,h.pathLengths)}return d}Object.defineProperty(b,"__esModule",{value:!0});b.createColorGeometryData=function(c){var b={},e={};e[a.VertexAttrConstants.POSITION]={size:3,data:c.attributeData.position};b[a.VertexAttrConstants.POSITION]=c.indices;if(g.isSome(c.attributeData.color)){var f=new Uint32Array(c.indices.length);e[a.VertexAttrConstants.COLOR]={size:4,data:c.attributeData.color};b[a.VertexAttrConstants.COLOR]=f}g.isSome(c.attributeData.mapPosition)&&(e.mapPos=
{size:3,data:c.attributeData.mapPosition},b.mapPos=c.indices);return new d.GeometryData(e,b)};b.createWaterGeometryData=function(c){var b={},e={};e[a.VertexAttrConstants.POSITION]={size:3,data:c.attributeData.position};b[a.VertexAttrConstants.POSITION]=c.indices;e[a.VertexAttrConstants.UV0]={size:2,data:c.attributeData.uv0};b[a.VertexAttrConstants.UV0]=c.indices;g.isSome(c.attributeData.mapPosition)&&(e.mapPos={size:3,data:c.attributeData.mapPosition},b.mapPos=c.indices);return new d.GeometryData(e,
b)};b.geometryAsPolygon=function(a){switch(a.type){case "extent":if(a instanceof k.Extent)return k.Polygon.fromExtent(a);break;case "polygon":return a}return null};b.geometryToRenderInfo=function(a,b,d,h){var l=e.pathsToTriangulationInfo(a.rings,a.hasZ,1),g=new Float64Array(l.position.length);a=f.applyPerVertexElevationAlignment(l.position,a.spatialReference,0,g,0,l.position,0,l.position.length/3,b,d,h);b=null!=a;return{position:l.position,mapPosition:g,polygons:q(l.polygons,l.position,g),outlines:c(l.outlines,
l.position,g),projectionSuccess:b,sampledElevation:a}};b.geometryToRenderInfoDraped=function(a,b){var d=e.pathsToTriangulationInfo(a.rings,!1,1);a=l.bufferToBuffer(d.position,a.spatialReference,0,d.position,b,0,d.position.length/3);for(b=2;b<d.position.length;b+=3)d.position[b]=h.DRAPED_Z;return{position:d.position,polygons:q(d.polygons,d.position),outlines:c(d.outlines,d.position),projectionSuccess:a}}})},"esri/geometry/support/triangulationUtils":function(){define(["require","exports","../../core/libs/earcut/earcut",
"./coordsUtils","./meshUtils/deduplicate"],function(n,b,m,k,g){function e(b,d,a){if(1===b.length)return b[0];d=new Float64Array(d);a=new Uint32Array(a);for(var c=0,e=0,f=0,h=0;h<b.length;h++){for(var l=b[h],g=0;g<l.position.length;g++)d[c++]=l.position[g];for(g=0;g<l.faces.length;g++)a[e++]=l.faces[g]+f;f=c/3}return{position:d,faces:a}}function f(b,d,a){for(var c=b.length,e=Array(c),f=Array(c),h=Array(c),g=0,m=0,x=0,w=0,v=0;v<c;++v)w+=b[v].length;for(var w=new Float64Array(3*w),n=0,y=c-1;0<=y;y--){var A=
b[y],B=1===a?!k.isClockwise(A,!1,!1):!1;if(B&&1!==c)e[g++]=A;else{for(var C=A.length,v=0;v<g;++v)C+=e[v].length;v={index:n,pathLengths:Array(g+1),count:C,holeIndices:Array(g)};v.pathLengths[0]=A.length;0<A.length&&(h[x++]={index:n,count:A.length});n=B?l(A,A.length-1,-1,w,n,A.length,d):l(A,0,1,w,n,A.length,d);for(A=0;A<g;++A)B=e[A],v.holeIndices[A]=n,v.pathLengths[A+1]=B.length,0<B.length&&(h[x++]={index:n,count:B.length}),n=l(B,0,1,w,n,B.length,d);g=0;0<v.count&&(f[m++]=v)}}for(A=0;A<g;++A)B=e[A],
0<B.length&&(h[x++]={index:n,count:B.length}),n=l(B,0,1,w,n,B.length,d);m<c&&(f.length=m);x<c&&(h.length=x);return{position:w,polygons:f,outlines:h}}function l(b,d,a,c,e,f,l){e*=3;for(var h=0;h<f;++h){var g=b[d];c[e++]=g[0];c[e++]=g[1];c[e++]=l?g[2]:0;d+=a}return e/3}Object.defineProperty(b,"__esModule",{value:!0});b.triangulate=function(b){var d=f(b.rings,b.hasZ,1),a=[],c=0,h=0;b=function(b){var e=b.index,f=new Float64Array(d.position.buffer,3*e*d.position.BYTES_PER_ELEMENT,3*b.count);b=b.holeIndices.map(function(a){return a-
e});b=new Uint32Array(m.earcut(f,b,3));a.push({position:f,faces:b});c+=f.length;h+=b.length};for(var l=0,k=d.polygons;l<k.length;l++)b(k[l]);b=e(a,c,h);l=g.default(b.position.buffer,6,{originalIndices:b.faces});b.position=new Float64Array(l.buffer);b.faces=l.indices;return b};b.pathsToTriangulationInfo=f})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["require","exports","../../../core/mathUtils"],function(n,b,m){function k(b,f,l){var e=b.byteLength/(4*f),d=new Uint32Array(b,0,
e*f);b=new Uint32Array(e);var a=l&&l.minReduction||0,c=l&&l.originalIndices||null,k=l&&l.componentOffsets||null,p=0;if(k)for(l=0;l<k.length-1;l++){var t=k[l+1]-k[l];t>p&&(p=t)}else p=e;var u=Math.floor(1.1*p)+1;if(null==g||g.length<2*u)g=new Uint32Array(m.nextHighestPowerOfTwo(2*u));for(l=0;l<2*u;l++)g[l]=0;var p=0,r=(t=!!k&&!!c)?c.length:e,x=t?new Uint32Array(c.length):null,w=0!==a?Math.ceil(7.84*1.96/(a*a)*a*(1-a)):r,v=1,n=k?k[1]:r;for(l=0;l<r;l++){if(l===w){var y=1-p/l;if(y+1.96*Math.sqrt(y*(1-
y)/l)<a)return null;w*=2}if(l===n){for(y=0;y<2*u;y++)g[y]=0;if(c)for(y=k[v-1];y<k[v];y++)x[y]=b[c[y]];n=k[++v]}for(var A=t?c[l]:l,y=A*f,B,C=B=0;C<f;C++)B=d[y+C]+B|0,B=B+(B<<11)+(B>>>2)|0;B>>>=0;for(var C=B%u,F=p;0!==g[2*C+1];){if(g[2*C]===B){var E=g[2*C+1]-1,G=E*f;a:{for(var H=0;H<f;H++)if(d[y+H]!==d[G+H]){G=!1;break a}G=!0}if(G){F=b[E];break}}C++;C>=u&&(C-=u)}F===p&&(g[2*C]=B,g[2*C+1]=A+1,p++);b[A]=F}if(0!==a&&1-p/e<a)return null;if(t){for(l=k[v-1];l<x.length;l++)x[l]=b[c[l]];b=x}e=new Uint32Array(f*
p);for(l=p=0;l<r;l++)if(b[l]===p){y=(t?c[l]:l)*f;a=d;k=y;u=e;x=p*f;w=f;for(v=0;v<w;v++)u[x+v]=a[k+v];p++}if(c&&!t){f=new Uint32Array(c.length);for(l=0;l<f.length;l++)f[l]=b[c[l]];b=f}return{buffer:e.buffer,indices:b,uniqueCount:p}}Object.defineProperty(b,"__esModule",{value:!0});b.deduplicate=k;var g=null;b.default=k})},"esri/views/3d/terrain/OverlayRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/SetUtils ../../../core/accessorSupport/decorators/declared ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3f64 ../support/debugFlags ../webgl-engine/core/shaderTechnique/CommonUniformStore ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/AutoDisposable ../webgl-engine/lib/Camera ../webgl-engine/lib/GLMaterialRep ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/RenderContext ../webgl-engine/lib/renderStats ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/TextureTechnique ../webgl-engine/lighting/Lightsources ../webgl-engine/lighting/SceneLighting ../webgl-engine/materials/lineStippleUtils ../../webgl/FramebufferObject ../../webgl/Texture ../../webgl/Util".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I){Object.defineProperty(b,"__esModule",{value:!0});var L=g.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");n=function(d){function g(a){var e=d.call(this)||this;e._hasHighlights=!1;e._rendersOccluded=!1;e._lighting=new E.SceneLighting;e._localOrigins=new v;e._layerViewHandles=new Map;e._layerRenderers=new Map;e._sortedLayerRenderersDirty=!1;e._sortedLayerRenderers=new l;e._stats=new A.RenderStatsAggregator;e._geometries=
new Map;e._renderTargets={};e._uniqueIdx=0;e.longitudeCyclical=null;e._rctx=a.renderingContext;e._renderContext=new y(e._rctx,null,null,null,null,null);e._stippleTextureRepository=new G.StippleTextureRepository;e._shaderTechniqueRepository=new t.ShaderTechniqueRepository({rctx:e._rctx,viewingMode:1,commonUniformStore:new p.CommonUniformStore,stippleTextureRepository:e._stippleTextureRepository});e._materialRepository=new x(a.textureRepository,e._shaderTechniqueRepository);e._materialRepository.onMaterialChanged=
function(a){0<(a.renderOccluded&b.overlayRenderOccludedFlag)!==e._rendersOccluded&&e.updateRendersOccluded();e.emitContentChanged()};e._compositingHelper=a.compositingHelper;e._bindParameters={slot:null,fovY:0,highlightDepthTexture:w.createEmptyDepthTexture(e._rctx),nearFar:[N.near,N.far],origin:null,pixelRatio:null,proj:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,view:null,viewInvTransp:null,viewport:null,hasOccludees:!1};e._lighting.set({lights:[new F.AmbientLight(c.vec3f64.fromValues(1,
1,1))],groundLightingFactor:1,globalFactor:0});return e}m(g,d);g.prototype.dispose=function(){this._layerRenderers.forEach(function(a){return a.dispose()});this._layerRenderers.clear();for(var a in this._renderTargets)this._renderTargets[a].dispose();this._renderTargets=null;this._bindParameters.highlightDepthTexture.dispose();this._bindParameters.highlightDepthTexture=null};g.prototype.disposeRenderTarget=function(a){var c=this._renderTargets[a];c&&c.dispose();delete this._renderTargets[a]};Object.defineProperty(g.prototype,
"updating",{get:function(){return this._sortedLayerRenderersDirty||e.someMap(this._layerRenderers,function(a){return a.updating})},enumerable:!0,configurable:!0});g.prototype.commitChanges=function(){var a=this,c=!1;this._layerRenderers.forEach(function(b,d){b.commitChanges()&&(c=!0);b.isEmpty&&(a._layerRenderers.delete(d),a._sortedLayerRenderersDirty=!0,b=a._layerViewHandles.get(d))&&(b.remove(),a._layerViewHandles.delete(d))});this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),
c=!0);this.emitUpdatingChanged();c&&(this.emitContentChanged(),this.updateHasHighlights(),this.updateRendersOccluded())};g.prototype.getRenderTargetTexture=function(a){return(a=this._renderTargets[a])?a.colorTexture:null};g.prototype.addGeometries=function(a,c,b){for(var d=0;d<a.length;d++){var e=a[d];null==e.origin&&(e.origin=this._localOrigins.getOrigin(e.center));e.uniqueName||(e.uniqueName="ov:"+this._uniqueIdx++);this._geometries.set(e.uniqueName,e)}this.ensureLayerRenderer(c).add(a);2===b&&
this.notifyGraphicUpdate(a,c,2)};g.prototype.removeGeometries=function(a,c,b){for(var d=0;d<a.length;d++)this._geometries.delete(a[d].uniqueName);(d=this._layerRenderers.get(c))?(d.remove(a),2===b&&this.notifyGraphicUpdate(a,c,2)):L.warn("Attempted to remove geometry for nonexistent layer")};g.prototype.updateGeometries=function(a,c,b){var d=this._layerRenderers.get(c);d?(d.modify(a,b),this.notifyUpdateGeometries(a,c,b)):L.warn("Attempted to update geometry for nonexistent layer")};g.prototype.notifyUpdateGeometries=
function(a,c,b){this.notifyGraphicUpdate(a,c,4===b||2===b?2:1===b?1:0)};g.prototype.notifyGraphicUpdate=function(a,c,b){if(0!==b)for(var d=-1,e=0;e<a.length;e++){var f=a[e].data.graphicUid;f!==d&&(c.notifyGraphicUpdate(f,b),d=f)}};g.prototype.updateHighlights=function(a,c){(c=this._layerRenderers.get(c))?c.modify(a,8):L.warn("Attempted to update highlights for nonexistent layer")};g.prototype.isEmpty=function(){return 0===this._geometries.size&&!q.OVERLAY_DRAW_DEBUG_TEXTURE};Object.defineProperty(g.prototype,
"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"hasWater",{get:function(){return e.someMap(this._layerRenderers,function(a){return a.hasWater})},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"rendersOccluded",{get:function(){return this._rendersOccluded},enumerable:!0,configurable:!0});g.prototype.updateLogic=function(a){var c=!1;this._layerRenderers.forEach(function(b){b.updateLogic(a)&&(c=!0)});return c};
g.prototype.updateLayerOrder=function(){this._sortedLayerRenderersDirty=!0};g.prototype.draw=function(a,c){return this.drawPass(0,a,c)};g.prototype.drawWithoutRasterImage=function(a,c){return this.drawPass(0,a,c,2)};g.prototype.drawNormals=function(a,c){return this.drawPass(2,a,c)};g.prototype.drawHighlights=function(a,c){return this.drawPass(4,a,c)};g.prototype.drawOccluded=function(a,c){return this.drawPass(0,a,c,1)};g.prototype.drawPass=function(a,c,d,e){var h=this;void 0===e&&(e=0);if(0===d.numViews)return!1;
this._pixelRatio=d.pixelRatio*Math.abs(d.views[0].extent[2]-d.views[0].extent[0])/Math.abs(d.views[0].viewport[2]-d.views[0].viewport[0]);if(this.isEmpty()||4===a&&!this.hasHighlights||2===a&&!this.hasWater||!this.hasNonZeroSizedView(d))return!1;var l=d.width,g=d.height,k=this._renderTargets[c];if(!k)return!1;k.resize(l,g);var m=this._rctx,p=N;p.pixelRatio=d.pixelRatio||1;this._renderContext.pass=a;this._bindParameters.pixelRatio=p.pixelRatio;m.bindFramebuffer(k);m.setClearColor(0,0,0,0);m.clearSafe(16384);
this.updateLightingUniforms();1===e&&(this._renderContext.renderOccludedMask=b.overlayRenderOccludedFlag);if(q.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==e)for(c=0;c<d.numViews;c++)this.setViewParameters(d.views[c],p),this.drawDebugTexture(l,g,K[d.index%K.length]);0<this._layerRenderers.size&&this._sortedLayerRenderers.forEach(function(c){var b=c.layerView;c=c.renderer;if(2!==e||!f.isSome(b)||0!==b.drapeSourceType){var q=f.isSome(b)&&f.isSome(b.fullOpacity)&&1>b.fullOpacity&&0===a;q&&(h.bindTemporaryFramebuffer(l,
g),m.clearSafe(16384));for(var r=0;r<d.numViews;r++)h.setViewParameters(d.views[r],p),c.draw(h._renderContext,h._bindParameters,h._stats);q&&(m.bindFramebuffer(k),h._compositingHelper.composite(h.temporaryTexture,2,f.expect(f.expect(b).fullOpacity)))}});m.bindFramebuffer(null);k.colorTexture.descriptor.hasMipmap&&k.colorTexture.generateMipmap();this._renderContext.resetRenderOccludedMask();return!0};g.prototype.createRenderTarget=function(a,c){for(var b=a,d=0;this._renderTargets[b];)b=a+"_"+ ++d;
this._renderTargets[b]=new H(this._rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:c,maxAnisotropy:8,width:0,height:0});return b};g.prototype.disposeRenderTargetMemory=function(a){(a=this._renderTargets[a])&&a.resize(0,0)};g.prototype.bindTemporaryFramebuffer=function(a,c){f.isNone(this._temporaryRenderTargetId)&&(this._temporaryRenderTargetId=this.createRenderTarget("temp",!1));var b=this._renderTargets[this._temporaryRenderTargetId];
b.resize(a,c);this._rctx.bindFramebuffer(b)};Object.defineProperty(g.prototype,"temporaryTexture",{get:function(){return this._renderTargets[f.expect(this._temporaryRenderTargetId)].colorTexture},enumerable:!0,configurable:!0});g.prototype.getGpuMemoryUsage=function(){var a=0,c;for(c in this._renderTargets)a+=I.getGpuMemoryUsage(this._renderTargets[c]);return a};g.prototype.getStats=function(){return this._stats.getAggregatedStats()};g.prototype.intersect=function(a,c,b){var d=this,e=0;this._geometries.forEach(function(f){if(!b||
b(f)){d.intersectRenderGeometry(f,c,0,a,e);var h=d.longitudeCyclical;h&&(f.center[0]-f.bsRadius<h.min&&d.intersectRenderGeometry(f,c,h.range,a,e),f.center[0]+f.bsRadius>h.max&&d.intersectRenderGeometry(f,c,-h.range,a,e));e++}})};g.prototype.intersectRenderGeometry=function(a,c,b,d,e){var h=this,l=0;f.isSome(a.transformation)&&(b+=a.transformation[12],l=a.transformation[13]);Q[0]=c[0]-b;Q[1]=c[1]-l;Q[2]=1;M[0]=c[0]-b;M[1]=c[1]-l;M[2]=0;a.pixelRatio=this._pixelRatio;a.material.intersect(a,null,a.getShaderTransformation(),
d,Q,M,function(c,b,f){h.addIntersectionResult(f,a.material.renderPriority,e,d,a.data.layerUid,a.data.graphicUid)},a.calculateShaderTransformation,!0)};g.prototype.addIntersectionResult=function(a,c,b,d,e,f){var h={type:"external",metadata:{layerUid:e,graphicUid:f}};e=function(e){e.set(h,null,d.results.ground.dist,d.results.ground.normal,d.results.ground.transformation,c,null,null,a,b);e.intersector="OverlayRenderer"};(null==d.results.min.drapedLayerOrder||c>=d.results.min.drapedLayerOrder)&&(null==
d.results.min.dist||d.results.ground.dist<=d.results.min.dist)&&e(d.results.min);0!==d.options.store&&(null==d.results.max.drapedLayerOrder||c<d.results.max.drapedLayerOrder)&&(null==d.results.max.dist||d.results.ground.dist>d.results.max.dist)&&e(d.results.max);2===d.options.store&&(f=new z.IntersectorResult(d.ray),e(f),d.results.all.push(f))};g.prototype.ensureLayerRenderer=function(a){var c=this,b=this._layerRenderers.get(a);b||(b=new B.SortedRenderGeometryRenderer(this._rctx,this._materialRepository,
function(){return c.emitUpdatingChanged()}),this._layerRenderers.set(a,b),this._sortedLayerRenderersDirty=!0,this._layerViewHandles.set(a,a.watch("fullOpacity",function(){return c.emitContentChanged()})));return b};g.prototype.updateSortedLayerRenderers=function(){var a=this;if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var c=e.firstKeyOfMap(this._layerRenderers).view.allLayerViews,b=h.createSetFromValues(e.valuesOfMap(this._layerRenderers));
c.forEach(function(c){var d=a._layerRenderers.get(c);d&&(a._sortedLayerRenderers.push(new O(c,d)),b.delete(d))});b.forEach(function(c){a._sortedLayerRenderers.push(new O(null,c))})}};g.prototype.setViewParameters=function(c,b){b.viewport=c.viewport;var d=c.extent;a.mat4.ortho(b.projectionMatrix,0,d[2]-d[0],0,d[3]-d[1],b.near,b.far);a.mat4.identity(b.viewMatrix);a.mat4.translate(b.viewMatrix,b.viewMatrix,[-c.extent[0],-c.extent[1],0]);b.setGLViewport(this._rctx);this._renderContext.camera=b;this._bindParameters.view=
b.viewMatrix;this._bindParameters.proj=b.projectionMatrix;this._bindParameters.viewInvTransp=b.viewInverseTransposeMatrix;this._bindParameters.viewport=b.fullViewport;this._shaderTechniqueRepository.getProgramsUsingUniform("proj").forEach(function(a){a.setUniformMatrix4fv("proj",b.projectionMatrix)})};g.prototype.updateLightingUniforms=function(){var a=this;this._shaderTechniqueRepository.getProgramsUsingUniform("lightingMainDirection").forEach(function(c){a._lighting.setUniforms(c)})};g.prototype.hasNonZeroSizedView=
function(a){for(var c=0;c<a.numViews;c++){var b=a.views[c];if(b.extent[0]!==b.extent[2]&&b.extent[1]!==b.extent[3])return!0}return!1};g.prototype.emitContentChanged=function(){if(this.onContentChanged)this.onContentChanged()};g.prototype.emitUpdatingChanged=function(){if(this.onUpdatingChanged)this.onUpdatingChanged()};g.prototype.updateHasHighlights=function(){var a=e.someMap(this._layerRenderers,function(a){return a.hasHighlights});if(a!==this._hasHighlights&&(this._hasHighlights=a,this.onHasHighlightsChanged))this.onHasHighlightsChanged(this._hasHighlights)};
g.prototype.updateRendersOccluded=function(){var a=e.someMap(this._layerRenderers,function(a){return a.rendersOccluded});if(a!==this._rendersOccluded&&(this._rendersOccluded=a,this.onRendersOccludedChanged))this.onRendersOccludedChanged(this.rendersOccluded)};g.prototype.drawDebugTexture=function(a,c,b){var d=this._rctx;this.ensureDebugPatternResources(a,c);a=this._debugPatternProgram;d.bindProgram(a);d.setPipelineState(this._debugPatternPipelineState);a.setUniform4f("color",b[0],b[1],b[2],1);a.setUniform1i("tex",
0);d.bindTexture(this._debugPatternTexture,0);d.bindVAO(this._quadVAO);d.drawArrays(5,0,I.vertexCount(this._quadVAO,"geometry"))};g.prototype.ensureDebugPatternResources=function(a,c){if(!this._debugPatternTexture){for(var b=new Uint8Array(a*c*4),d=0,e=0;e<c;e++)for(var f=0;f<a;f++){var h=Math.floor(f/10),l=Math.floor(e/10);2>h||2>l||10*h>a-20||10*l>c-20?(b[d++]=255,b[d++]=255,b[d++]=255,b[d++]=255):(b[d++]=255,b[d++]=255,b[d++]=255,h&1&&l&1?b[d++]=f&1^e&1?0:255:b[d++]=h&1^l&1?0:128)}this._debugPatternTexture=
new D(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,height:c},b);a=new C.TextureTechniqueConfiguration;a.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquireAndReleaseExisting(C.TextureTechnique,a,this._debugTextureTechnique);this._debugPatternProgram=this._debugTextureTechnique.program;this._debugPatternPipelineState=this._debugTextureTechnique.pipeline;this._quadVAO=w.createQuadVAO(this._rctx)}};Object.defineProperty(g.prototype,"test",
{get:function(){return{layerRenderers:this._layerRenderers}},enumerable:!0,configurable:!0});k([u.autoDispose()],g.prototype,"_shaderTechniqueRepository",void 0);k([u.autoDispose()],g.prototype,"_stippleTextureRepository",void 0);return g}(d.declared(u.AutoDisposable));b.OverlayRenderer=n;var O=function(){return function(a,c){this.layerView=a;this.renderer=c}}(),K=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],N=new r.default;N.near=1;N.far=1E4;var Q=c.vec3f64.create(),M=c.vec3f64.create();b.DRAPED_Z=-2;b.overlayRenderOccludedFlag=
4})},"esri/views/3d/webgl-engine/core/shaderTechnique/CommonUniformStore":function(){define(["require","exports","../../../../../core/arrayUtils"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._uniforms={proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}b.prototype.dispose=function(){this._uniforms=null};b.prototype.getPrograms=function(b){return this._uniforms[b]||[]};b.prototype.subscribeProgram=function(b){for(var e in this._uniforms)b.hasUniform(e)&&
this._uniforms[e].push(b)};b.prototype.unsubscribeProgram=function(b){for(var e in this._uniforms)m.removeUnordered(this._uniforms[e],b)};return b}();b.CommonUniformStore=n})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define("require exports ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/maybe ../../../../../core/promiseUtils".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",
{value:!0});n=function(){function b(b){this._context=b;this._perConstructorInstances=new Map;this._frameCounter=0;this._keepAliveFrameCount=1200}Object.defineProperty(b.prototype,"viewingMode",{get:function(){return this._context.viewingMode},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"constructionContext",{get:function(){return this._context},enumerable:!0,configurable:!0});b.prototype.acquire=function(b,e){var d=e.key,a=this._perConstructorInstances.get(b);a||(a=new Map,this._perConstructorInstances.set(b,
a));var c=a.get(d);void 0===c?(c={technique:new b(this._context,e),refCount:1,refZeroFrame:0},a.set(d,c)):c.refCount+=1;return c.technique};b.prototype.acquireAndReleaseExisting=function(b,e,d){return g.isNone(d)?this.acquire(b,e):e.key===d.key&&d instanceof b?d:(this.release(d),this.acquire(b,e))};b.prototype.release=function(b){b=this._perConstructorInstances.get(b.constructor).get(b.key);--b.refCount;0===b.refCount&&(b.refZeroFrame=this._frameCounter)};b.prototype.frameUpdate=function(){var b=
this;this._frameCounter++;this._perConstructorInstances.forEach(function(e,d){e.forEach(function(a,c){0===a.refCount&&a.refZeroFrame+b._keepAliveFrameCount<b._frameCounter&&(a.technique.dispose(),e.delete(c))});0===e.size&&b._perConstructorInstances.delete(d)})};b.prototype.getProgramsUsingUniform=function(b){return this._context.commonUniformStore.getPrograms(b)};b.prototype.hotReload=function(){return m(this,void 0,void 0,function(){var b,f=this;return k(this,function(d){switch(d.label){case 0:return b=
[],this._perConstructorInstances.forEach(function(a,c){b.push(function(a,c){return m(f,void 0,void 0,function(){var b,d=this;return k(this,function(e){switch(e.label){case 0:return(b=c.shader)?[4,b.reload()]:[3,2];case 1:e.sent(),a.forEach(function(a){a.technique.reload(d._context)}),e.label=2;case 2:return[2]}})})}(a,c))}),[4,e.all(b)];case 1:return d.sent(),[2]}})})};return b}();b.ShaderTechniqueRepository=n})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define("require exports ../../../../core/Logger ../../../../core/maybe ../core/shaderLibrary/ShaderOutputOptions ./Util".split(" "),
function(n,b,m,k,g,e){var f=m.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep"),l=function(){function b(b){this.refCnt=0;this.glMaterial=b}b.prototype.incRefCnt=function(){++this.refCnt};b.prototype.decRefCnt=function(){--this.refCnt;e.assert(0<=this.refCnt)};b.prototype.getRefCnt=function(){return this.refCnt};b.prototype.getGLMaterial=function(){return this.glMaterial};return b}();return function(){function b(b,a,c){this._textureRep=b;this._techniqueRep=a;this.onMaterialChanged=c;this._id2glMaterialRef=
new Map}b.prototype.acquire=function(b,a){this.ownMaterial(b);var c=g.getShaderOutputID(b.id,a),d=this._id2glMaterialRef.get(c);null==d?(b=b.getGLMaterial({material:b,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:a}),d=new l(b),this._id2glMaterialRef.set(c,d)):b=d.getGLMaterial();d.incRefCnt();return b};b.prototype.release=function(b,a){b=g.getShaderOutputID(b.id,a);a=this._id2glMaterialRef.get(b);a.decRefCnt();0===a.getRefCnt()&&((a=a.getGLMaterial())&&a.dispose(),this._id2glMaterialRef.delete(b))};
b.prototype.materialChanged=function(b){for(var a=0,c=g.ShaderOutputTypes;a<c.length;a++){var d=c[a];5!==d.output&&6!==d.output&&(d=this._id2glMaterialRef.get(g.getShaderOutputID(b.id,d.output)))&&d.getGLMaterial()&&(d=d.getGLMaterial(),d.updateParameters&&d.updateParameters())}if(this.onMaterialChanged)this.onMaterialChanged(b)};b.prototype.ownMaterial=function(b){k.isSome(b.materialRepository)&&b.materialRepository!==this&&f.error("Material is already owned by a different material repository");
b.materialRepository=this};return b}()})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":function(){define(["require","exports","../../../../../core/arrayUtils"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.ShaderOutputTypes=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"}];b.getShaderOutputID=function(k,g){return k+"_"+
m.find(b.ShaderOutputTypes,function(b){return b.output===g}).name}})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/SpatialReference ../../support/projectionUtils ./Geometry ./GeometryData ./Layer ./localOrigin ./Object3D ./Util ../materials/RibbonLineMaterial".split(" "),function(n,b,m,k,
g,e,f,l,h,d,a,c,q,p,t){var u=0;n=function(){function b(){this.ROOT_ORIGIN_ID="rg_root_"+u++;this._origins=new Map;this._gridSize=42E5}b.prototype.getOrigin=function(a){var d=this._origins.get(this.ROOT_ORIGIN_ID);if(null==d){if(m.isSome(b.testOrigin)){var e=b.testOrigin;this._origins.set(this.ROOT_ORIGIN_ID,c.fromValues(e[0],e[1],e[2],this.ROOT_ORIGIN_ID));return this.getOrigin(a)}e=c.fromValues(a[0]+Math.random()-.5,a[1]+Math.random()-.5,a[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);this._origins.set(this.ROOT_ORIGIN_ID,
e);return e}g.vec3.subtract(r,a,d.vec3);r[0]=Math.abs(r[0]);r[1]=Math.abs(r[1]);r[2]=Math.abs(r[2]);e=this._gridSize;if(r[0]<e&&r[1]<e&&r[2]<e)return d;var d=Math.round(a[0]/e),f=Math.round(a[1]/e);a=Math.round(a[2]/e);var h="rg_"+d+"/"+f+"/"+a,l=this._origins.get(h);l||(l=c.fromValues(d*e,f*e,a*e,h),this._origins.set(h,l));return l};b.prototype._drawOriginBox=function(b){var c=window.view,e=c._stage;if(null==this._object){this._material=new t({width:2,color:[0,1,0,1]},"GridLocalOriginMaterial");
e.add(3,this._material);var g=new a("GridLocalOrigin",{isPickable:!1});e.add(0,g);this._object=new q({idHint:"GridLocalOrigin",castShadow:!1});e.add(1,this._object);g.addObject(this._object);e.addToViewContent([g.id])}for(var m=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],r=m.length,u=new Float32Array(3*r),g=new Uint32Array(2*(r-1)),x=.5*this._gridSize,w=0;w<r;w++)u[3*w+0]=b[0]+(m[w]&1?x:-x),u[3*w+1]=b[1]+(m[w]&2?x:-x),u[3*w+2]=b[2]+(m[w]&4?x:-x),0<w&&(g[2*w+0]=w-1,g[2*w+1]=w);l.bufferToBuffer(u,f.WebMercator,
0,u,c.spatialReference,0,r);c={};c[p.VertexAttrConstants.POSITION]={size:3,data:u};u={};u[p.VertexAttrConstants.POSITION]=g;g=new d.GeometryData(c,u,void 0,"line");g=new h(g,"GridLocalOriginBox");e.add(2,g);this._object.addGeometry(g,this._material,k.mat4f64.IDENTITY);console.log(this._origins.size,b)};return b}();var r=e.vec3f64.create();(n||(n={})).testOrigin=null;return n})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/arrayUtils ../../../../core/Evented ../../../../core/libs/gl-matrix-2/vec3f64 ./IdGen ./Octree".split(" "),
function(n,b,m,k,g,e,f,l){return function(b){function d(a,c,f){var h=b.call(this)||this;h._parentStages=new Map;h._objects=new Set;h.id=d._idGen.gen(a);h.apiLayerUid=f;h.name=a;c=c||{};h.group=c.group||"";h.isVisible=null!=c.isVisible?c.isVisible:!0;h.isPickable=null!=c.isPickable?c.isPickable:!0;h.isSliceable=!1;h.translation=c.translation?e.vec3f64.clone(c.translation):e.vec3f64.create();return h}m(d,b);d.prototype.addParentStage=function(a){if(!this._parentStages.has(a)){var b=this.on("dirty",
function(b){a.notifyDirty(b.origin,b.dirtyType,b.subObject)});this._parentStages.set(a,b)}};d.prototype.removeParentStage=function(a){var b=this._parentStages.get(a);b&&(b.remove(),this._parentStages.delete(a));this.invalidateSpatialQueryAccelerator()};d.prototype.getName=function(){return this.name};d.prototype.getGroup=function(){return this.group};d.prototype.getTranslation=function(){return this.translation};d.prototype.getObjectIds=function(){return k.keysOfSet(this._objects,function(a){return a.id})};
d.prototype.getObjects=function(){return k.keysOfSet(this._objects)};d.prototype.addObject=function(a){this._objects.add(a);a.parentLayer=this;this.notifyDirty("layerObjectAdded",a);this._octree&&this._octree.add(a)};d.prototype.hasObject=function(a){return this._objects.has(a)};d.prototype.removeObject=function(a){if(!this._objects.delete(a))return!1;a.parentLayer=null;this.notifyDirty("layerObjectRemoved",a);this._octree&&this._octree.remove(a);return!0};d.prototype.notifyObjectBBChanged=function(a,
b){this._octree&&this._octree.update(a,b)};d.prototype.getSpatialQueryAccelerator=function(){!this._octree&&50<this._objects.size&&this._createOctree();return this._octree};d.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)};d.prototype.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)};d.prototype.notifyDirty=function(a,b,d,e){this.emit("dirty",{origin:e||this,dirtyType:a,subObject:b})};d.prototype._createOctree=
function(){this._octree=new l({getRadius:function(a){return a.getBSRadius()},getCenter:function(a){return a.getCenter()}});this._octree.add(k.keysOfSet(this._objects))};d._idGen=new f.IdGen;return d}(g)})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("require exports ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./Util".split(" "),function(n,b,m,k,g,e,f,l){function h(a,
b,c){c=c||a;c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;return c}function d(a,b,c){return!f.frustum.intersectsSphere(c.planes,f.sphere.wrap(b,a))}function a(a,b,c){if(!D.length)for(var d=0;8>d;++d)D.push({index:0,distance:0});for(d=0;8>d;++d){var e=u[d];D.data[d].index=d;D.data[d].distance=q(a,b,e)}D.sort(function(a,b){return a.distance-b.distance});c.clear();for(d=0;8>d;++d)c.push(D.data[d].index)}function c(a,b){for(var c=Infinity,d=null,e=0;8>e;++e){var f=q(a,b,r[e]);f<c&&(c=f,d=r[e])}return d}function q(a,
b,c){return b*(a[0]*c[0]+a[1]*c[1]+a[2]*c[2])}function p(a){if(Array.isArray(a))return a;w[0]=a;return w}n=function(){function b(a,b){this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._objectCount=0;this._objectToBoundingSphere=a;b&&(void 0!==b.maximumObjectsPerNode&&(this._maximumObjectsPerNode=b.maximumObjectsPerNode),void 0!==b.maximumDepth&&(this._maximumDepth=b.maximumDepth));this._root=new t(null,e.vec3f64.fromValues(0,0,0),0)}Object.defineProperty(b.prototype,
"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maximumDepth",
{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0});b.prototype.destroy=function(){this._degenerateObjects.clear();this._root=null;t.clearPool();w[0]=null;B.prune();D.prune();I.prune()};b.prototype.add=function(a,b){a=p(a);b=null==b?a.length:b;this._objectCount+=b;this._grow(a,b);for(var c=t.acquire(),d=0;d<b;d++){var e=a[d];this._isDegenerate(e)?this._degenerateObjects.add(e):
(c.init(this._root),this._add(e,c))}t.release(c)};b.prototype.remove=function(a,b){a=p(a);this._objectCount-=a.length;for(var c=t.acquire(),d=0;d<a.length;d++){var e=a[d],f=b||this._boundingSphereFromObject(e,C);this._isValidRadius(f.radius)?(c.init(this._root),this._remove(e,f,c)):this._degenerateObjects.delete(e)}t.release(c);this._shrink()};b.prototype.update=function(a,b){if(this._isValidRadius(b.radius)||!this._isDegenerate(a))this.remove(a,b),this.add(a)};b.prototype.forEachAlongRay=function(a,
b,c){var d=this,e=f.ray.wrap(a,b);this._forEachNode(this._root,function(a){if(!d._intersectsNode(e,a))return!1;a=a.node;a.terminals.forEach(function(a){d._intersectsObject(e,a)&&c(a)});null!==a.residents&&a.residents.forEach(function(a){d._intersectsObject(e,a)&&c(a)});return!0})};b.prototype.forEachAlongRayWithVerticalOffset=function(a,b,c,d){var e=this,h=f.ray.wrap(a,b);this._forEachNode(this._root,function(a){if(!e._intersectsNodeWithOffset(h,a,d))return!1;a=a.node;a.terminals.forEach(function(a){e._intersectsObjectWithOffset(h,
a,d)&&c(a)});null!==a.residents&&a.residents.forEach(function(a){e._intersectsObjectWithOffset(h,a,d)&&c(a)});return!0})};b.prototype.forEach=function(a){this._forEachNode(this._root,function(b){b=b.node;b.terminals.forEach(a);null!==b.residents&&b.residents.forEach(a);return!0});this._degenerateObjects.forEach(a)};b.prototype.forEachDegenerateObject=function(a){this._degenerateObjects.forEach(a)};b.prototype.findClosest=function(a,b,c,d,e){return this._findClosest(a,"front-to-back"===b?1:-1,c,d,
e)};b.prototype.forEachInDepthRange=function(a,b,c,d,e,f,h,l){this._forEachInDepthRange(a,b,"front-to-back"===c?1:-1,d,e,f,h,l)};b.prototype.forEachNode=function(a){this._forEachNode(this._root,function(b){return a(b.node,b.center,2*b.halfSize)})};b.prototype._intersectsNode=function(a,b){h(b.center,2*-b.halfSize,y);h(b.center,2*b.halfSize,A);return l.rayBoxTest(a.origin,a.direction,y,A)};b.prototype._intersectsNodeWithOffset=function(a,b,c){h(b.center,2*-b.halfSize,y);h(b.center,2*b.halfSize,A);
c.applyToMinMax(y,A);return l.rayBoxTest(a.origin,a.direction,y,A)};b.prototype._intersectsObject=function(a,b){var c=this._objectToBoundingSphere.getRadius(b);return 0<c?f.sphere.intersectsRay(f.sphere.wrap(c,this._objectToBoundingSphere.getCenter(b)),a):!0};b.prototype._intersectsObjectWithOffset=function(a,b,c){var d=this._objectToBoundingSphere.getRadius(b);return 0<d?f.sphere.intersectsRay(c.applyToBoundingSphere(d,this._objectToBoundingSphere.getCenter(b)),a):!0};b.prototype._forEachNode=function(a,
b){a=t.acquire().init(a);for(var c=[a];0!==c.length;){a=c.pop();if(b(a)&&!a.isLeaf())for(var d=0;d<a.node.children.length;d++)a.node.children[d]&&c.push(t.acquire().init(a).advance(d));t.release(a)}};b.prototype._forEachNodeDepthOrdered=function(b,c,d,e){void 0===e&&(e=1);b=t.acquire().init(b);var f=[b];for(a(d,e,I);0!==f.length;){b=f.pop();if(c(b)&&!b.isLeaf())for(d=7;0<=d;--d)e=I.data[d],e>=b.node.children.length||b.node.children[e]&&f.push(t.acquire().init(b).advance(e));t.release(b)}};b.prototype._findClosest=
function(a,b,e,f,h){var l=this,k=Infinity,m=Infinity,p=null,r=c(a,b),t=0,u=function(c){++t;if(!f||f(c)){var h=l._objectToBoundingSphere.getCenter(c),g=l._objectToBoundingSphere.getRadius(c);if(!e||!d(h,g,e)){var h=q(a,b,h),r=h-g;r<k&&(k=r,m=h+g,p=c)}}};this._forEachNodeDepthOrdered(this._root,function(c){if(null!=h&&t>=h||e&&d(c.center,c.halfSize*x,e))return!1;g.vec3.scale(z,r,c.halfSize);g.vec3.add(z,z,c.center);if(q(a,b,z)>m)return!1;c=c.node;c.terminals.forEach(function(a){u(a)});null!==c.residents&&
c.residents.forEach(function(a){u(a)});return!0},a,b);return p};b.prototype._forEachInDepthRange=function(a,b,e,f,h,l,k,m){var p=this,r=-Infinity,t=Infinity,u={setRange:function(a){1===e?(r=Math.max(r,a.near),t=Math.min(t,a.far)):(r=Math.max(r,-a.far),t=Math.min(t,-a.near))}};u.setRange(f);var v=q(b,e,a),w=c(b,e),n=c(b,-1*e),y=0,A=function(a){++y;if(!k||k(a)){var c=p._objectToBoundingSphere.getCenter(a),f=p._objectToBoundingSphere.getRadius(a),g=q(b,e,c)-v;g-f>t||g+f<r||l&&d(c,f,l)||h(a,u)}};this._forEachNodeDepthOrdered(this._root,
function(a){if(null!=m&&y>=m||l&&d(a.center,a.halfSize*x,l))return!1;g.vec3.scale(z,w,a.halfSize);g.vec3.add(z,z,a.center);if(q(b,e,z)-v>t)return!1;g.vec3.scale(z,n,a.halfSize);g.vec3.add(z,z,a.center);if(q(b,e,z)-v<r)return!1;a=a.node;a.terminals.forEach(function(a){A(a)});null!==a.residents&&a.residents.forEach(function(a){A(a)});return!0},b,e)};b.prototype._remove=function(a,b,c){B.clear();b=c.advanceTo(b,function(a,b){B.push(a.node);B.push(b)})?c.node.terminals:c.node.residents;b.removeUnordered(a);
if(0===b.length)for(a=B.length-2;0<=a&&this._purge(B.data[a],B.data[a+1]);a-=2);};b.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===a.residents.length;for(var b=0;b<a.children.length;b++)if(a.children[b])return!1;return!0};b.prototype._purge=function(a,b){0<=b&&(a.children[b]=null);return this._nodeIsEmpty(a)?(null===a.residents&&(a.residents=new k({shrink:!0})),!0):!1};b.prototype._add=function(a,b){b.advanceTo(this._boundingSphereFromObject(a,
C))?b.node.terminals.push(a):(b.node.residents.push(a),b.node.residents.length>this._maximumObjectsPerNode&&b.depth<this._maximumDepth&&this._split(b))};b.prototype._split=function(a){var b=a.node.residents;a.node.residents=null;for(var c=0;c<b.length;c++){var d=t.acquire().init(a);this._add(b.data[c],d);t.release(d)}};b.prototype._grow=function(a,b){var c=this;0!==b&&(a=this._boundingSphereFromObjects(a,b,function(a,b){return c._boundingSphereFromObject(a,b)},F),this._isValidRadius(a.radius)&&!this._fitsInsideTree(a)&&
(this._nodeIsEmpty(this._root.node)?(g.vec3.copy(this._root.center,a.center),this._root.halfSize=1.25*a.radius):(b=t.acquire(),this._rootBoundsForRootAsSubNode(a,b),this._placingRootViolatesMaxDepth(b)?this._rebuildTree(a,b):this._growRootAsSubNode(b),t.release(b))))};b.prototype._rebuildTree=function(a,b){var c=this;g.vec3.copy(E.center,b.center);E.radius=b.halfSize;a=this._boundingSphereFromObjects([a,E],2,function(a){return a},G);b=t.acquire().init(this._root);this._root.initFrom(null,a.center,
1.25*a.radius);this._forEachNode(b,function(a){c.add(a.node.terminals.data,a.node.terminals.length);null!==a.node.residents&&c.add(a.node.residents.data,a.node.residents.length);return!0});t.release(b)};b.prototype._placingRootViolatesMaxDepth=function(a){var b=0;this._forEachNode(this._root,function(a){b=Math.max(b,a.depth);return!0});return b+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};b.prototype._rootBoundsForRootAsSubNode=function(a,b){var c=a.radius,d=a.center;a=
-Infinity;for(var e=this._root.center,f=this._root.halfSize,h=0;3>h;h++){var l=Math.max(0,Math.ceil((e[h]-f-(d[h]-c))/(2*f))),g=Math.max(0,Math.ceil((d[h]+c-(e[h]+f))/(2*f)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(l+g)*Math.LOG2E)));H[h].min=l;H[h].max=g}for(h=0;3>h;h++)l=H[h].min,g=H[h].max,c=(a-(l+g))/2,l+=Math.ceil(c),g+=Math.floor(c),v[h]=e[h]-f-l*f*2+(g+l)*f;return b.initFrom(null,v,a*f,0)};b.prototype._growRootAsSubNode=function(a){var b=this._root.node;g.vec3.copy(F.center,this._root.center);
F.radius=this._root.halfSize;this._root.init(a);a.advanceTo(F,null,!0);a.node.children=b.children;a.node.residents=b.residents;a.node.terminals=b.terminals};b.prototype._shrink=function(){for(;;){var a=this._findShrinkIndex();if(-1===a)break;this._root.advance(a);this._root.depth=0}};b.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,b=this._root.node.children,c=0,d=0;d<b.length&&null==a;)c=d++,a=b[c];for(;d<b.length;)if(b[d++])return-1;
return c};b.prototype._isDegenerate=function(a){a=this._objectToBoundingSphere.getRadius(a);return!this._isValidRadius(a)};b.prototype._isValidRadius=function(a){return!isNaN(a)&&-Infinity!==a&&Infinity!==a&&0<a};b.prototype._fitsInsideTree=function(a){var b=this._root.center,c=this._root.halfSize,d=a.center;return a.radius<=c&&d[0]>=b[0]-c&&d[0]<=b[0]+c&&d[1]>=b[1]-c&&d[1]<=b[1]+c&&d[2]>=b[2]-c&&d[2]<=b[2]+c};b.prototype._boundingSphereFromObject=function(a,b){g.vec3.copy(b.center,this._objectToBoundingSphere.getCenter(a));
b.radius=this._objectToBoundingSphere.getRadius(a);return b};b.prototype._boundingSphereFromObjects=function(a,b,c,d){if(1===b){var e=c(a[0],F);g.vec3.copy(d.center,e.center);d.radius=e.radius}else{y[0]=Infinity;y[1]=Infinity;y[2]=Infinity;A[0]=-Infinity;A[1]=-Infinity;A[2]=-Infinity;for(var f=0;f<b;f++)if(e=c(a[f],F),this._isValidRadius(e.radius)){var h=y,l=e.center,k=e.radius;h[0]=Math.min(h[0],l[0]-k);h[1]=Math.min(h[1],l[1]-k);h[2]=Math.min(h[2],l[2]-k);h=A;l=e.center;e=e.radius;h[0]=Math.max(h[0],
l[0]+e);h[1]=Math.max(h[1],l[1]+e);h[2]=Math.max(h[2],l[2]+e)}g.vec3.lerp(d.center,y,A,.5);d.radius=Math.max(A[0]-y[0],A[1]-y[1],A[2]-y[2])/2}return d};return b}();var t=function(){function a(a,b,c){void 0===c&&(c=0);this.center=e.vec3f64.create();this.initFrom(a,b,c,0)}a.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)};a.prototype.initFrom=function(b,c,d,e){void 0===b&&(b=null);void 0===d&&(d=this.halfSize);void 0===e&&(e=this.depth);this.node=b||a.createEmptyNode();
c&&g.vec3.copy(this.center,c);this.halfSize=d;this.depth=e;return this};a.prototype.advance=function(b){var c=this.node.children[b];c||(c=a.createEmptyNode(),this.node.children[b]=c);this.node=c;this.halfSize/=2;this.depth++;b=u[b];this.center[0]+=b[0]*this.halfSize;this.center[1]+=b[1]*this.halfSize;this.center[2]+=b[2]*this.halfSize;return this};a.prototype.advanceTo=function(a,b,c){for(void 0===c&&(c=!1);;){if(this.isTerminalFor(a))return b&&b(this,-1),!0;if(this.isLeaf()&&!c)return b&&b(this,
-1),!1;this.isLeaf()&&(this.node.residents=null);var d=this._childIndex(a);b&&b(this,d);this.advance(d)}};a.prototype.isLeaf=function(){return null!=this.node.residents};a.prototype.isTerminalFor=function(a){return a.radius>this.halfSize/2};a.prototype._childIndex=function(a){a=a.center;for(var b=this.center,c=0,d=0;3>d;d++)b[d]<a[d]&&(c|=1<<d);return c};a.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new k({shrink:!0}),residents:new k({shrink:!0})}};
a.acquire=function(){return a._pool.acquire()};a.release=function(b){a._pool.release(b)};a.clearPool=function(){a._pool.prune()};a._pool=new m(a);return a}(),u=[e.vec3f64.fromValues(-1,-1,-1),e.vec3f64.fromValues(1,-1,-1),e.vec3f64.fromValues(-1,1,-1),e.vec3f64.fromValues(1,1,-1),e.vec3f64.fromValues(-1,-1,1),e.vec3f64.fromValues(1,-1,1),e.vec3f64.fromValues(-1,1,1),e.vec3f64.fromValues(1,1,1)],r=[e.vec3f64.fromValues(-1,-1,-1),e.vec3f64.fromValues(-1,-1,1),e.vec3f64.fromValues(-1,1,-1),e.vec3f64.fromValues(-1,
1,1),e.vec3f64.fromValues(1,-1,-1),e.vec3f64.fromValues(1,-1,1),e.vec3f64.fromValues(1,1,-1),e.vec3f64.fromValues(1,1,1)],x=Math.sqrt(3),w=[null],v=e.vec3f64.create(),z=e.vec3f64.create(),y=e.vec3f64.create(),A=e.vec3f64.create(),B=new k,C={center:e.vec3f64.create(),radius:0},F={center:e.vec3f64.create(),radius:0},E={center:e.vec3f64.create(),radius:0},G={center:e.vec3f64.create(),radius:0},H=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],D=new k,I=new k;return n})},"esri/views/3d/webgl-engine/lib/localOrigin":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.fromVector=function(b,g){return{vec3:m.vec3f64.clone(b),id:g}};b.fromValues=function(b,g,e,f){return{vec3:m.vec3f64.fromValues(b,g,e),id:f}}})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./VisualVariableMaterialParameters ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/RibbonLineTechnique ../shaders/RibbonLineTechnique".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A){function B(a,b,c,d,e){for(var f=0;f<e;f++)c[d++]=a[b++];return d}var C=g.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");n=function(a){function b(b,c){c=a.call(this,c)||this;c.techniqueConfig=new A.RibbonLineTechniqueConfiguration;c.params=v.copyParameters(b,E);c.validateParams();c.params.transparent=1>c.params.color[3]||c.params.transparent;c.layout=c.createLayout();return c}m(b,a);b.prototype.dispose=function(){};b.prototype.setParameterValues=
function(a){for(var b in a)"cap"===b?C.error("cap cannot be changed after creation"):"join"===b&&"round"===this.params[b]!==("round"===a[b])?C.error("join cannot be changed after creation"):"stipplePattern"===b&&!!this.params[b]!==!!a[b]?C.error("stippledness cannot be changed after creation"):this.params[b]=a[b];this.validateParams();this.parametersChanged()};b.prototype.getParameters=function(){return this.params};b.prototype.getPassParameters=function(){return this.params};b.prototype.getTechniqueConfig=
function(a){this.techniqueConfig.output=a;a=f.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=a;this.techniqueConfig.stippleIntegerRepeatsEnabled=a&&this.params.stippleIntegerRepeats;this.techniqueConfig.stippleOffColorEnabled=a&&f.isSome(this.params.stippleOffColor);this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;this.techniqueConfig.roundJoins="round"===this.params.join;this.techniqueConfig.roundCaps=
"round"===this.params.cap;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.vvColor=this.params.vvColorEnabled;this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.innerColorEnabled=0<this.params.innerWidth&&f.isSome(this.params.innerColor);this.techniqueConfig.falloffEnabled=
0<this.params.falloff;this.techniqueConfig.occluder=8===this.renderOccluded;return this.techniqueConfig};b.prototype.intersect=function(a,b,c,d,e,f,h,l,g){g?v.intersectDrapedRenderLineGeometry(a,d,f,this.params.width,h):this.intersectLineGeometry(a,b,c,d,this.params.width,h)};b.prototype.intersectLineGeometry=function(a,b,f,l,g,k){if(l.options.selectionMode&&!p.isAllHidden(b.componentVisibilities,a.componentOffsets))if(x.isTranslationMatrix(f)){b=a.data.getVertexAttr();a=b[A.RibbonVertexAttributeConstants.POSITION].data;
this.params.vvSizeEnabled?g*=e.clamp(this.params.vvSizeOffset[0]+b[A.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0]):b[A.RibbonVertexAttributeConstants.SIZE]&&(g*=b[A.RibbonVertexAttributeConstants.SIZE].data[0]);var m=l.camera,q=N;h.vec2.copy(q,l.point);g=g*m.pixelRatio/2+4*m.pixelRatio;d.vec3.set(X[0],q[0]-g,q[1]+g,0);d.vec3.set(X[1],q[0]+g,q[1]+g,0);d.vec3.set(X[2],q[0]+g,q[1]-g,0);d.vec3.set(X[3],
q[0]-g,q[1]-g,0);for(var r=0;4>r;r++)m.unprojectPoint(X[r],R[r]);c.plane.fromPoints(m.eye,R[0],R[1],aa);c.plane.fromPoints(m.eye,R[1],R[2],da);c.plane.fromPoints(m.eye,R[2],R[3],ca);c.plane.fromPoints(m.eye,R[3],R[0],ba);b=Number.MAX_VALUE;for(var t=this.params.isClosed?a.length-2:a.length-5,r=0;r<t;r+=3){I[0]=a[r]+f[12];I[1]=a[r+1]+f[13];I[2]=a[r+2]+f[14];var u=(r+3)%a.length;L[0]=a[u]+f[12];L[1]=a[u+1]+f[13];L[2]=a[u+2]+f[14];if(!(0>c.plane.signedDistance(aa,I)&&0>c.plane.signedDistance(aa,L)||
0>c.plane.signedDistance(da,I)&&0>c.plane.signedDistance(da,L)||0>c.plane.signedDistance(ca,I)&&0>c.plane.signedDistance(ca,L)||0>c.plane.signedDistance(ba,I)&&0>c.plane.signedDistance(ba,L))){m.projectPoint(I,Q);m.projectPoint(L,M);if(0>Q[2]&&0<M[2]){d.vec3.subtract(O,I,L);var u=m.frustum,v=-c.plane.signedDistance(u.planes[4],I),u=v/d.vec3.dot(O,u.planes[4]);d.vec3.scale(O,O,u);d.vec3.add(I,I,O);m.projectPoint(I,Q)}else if(0<Q[2]&&0>M[2])d.vec3.subtract(O,L,I),u=m.frustum,v=-c.plane.signedDistance(u.planes[4],
L),u=v/d.vec3.dot(O,u.planes[4]),d.vec3.scale(O,O,u),d.vec3.add(L,L,O),m.projectPoint(L,M);else if(0>Q[2]&&0>M[2])continue;Q[2]=0;M[2]=0;u=c.lineSegment.distance2(c.lineSegment.fromPoints(Q,M,S),q);u<b&&(b=u,d.vec3.copy(T,I),d.vec3.copy(P,L))}}f=l.rayBeginPoint;l=l.rayEndPoint;b<g*g&&(a=Number.MAX_VALUE,c.lineSegment.closestLineSegmentPoint(c.lineSegment.fromPoints(T,P,S),c.lineSegment.fromPoints(f,l,V),K)&&(d.vec3.subtract(K,K,f),a=d.vec3.length(K),d.vec3.scale(K,K,1/a),a/=d.vec3.distance(f,l)),
k(a,K))}else C.error("intersection assumes a translation-only matrix")};b.prototype.computeAttachmentOrigin=function(a,b){var c=a.data;a="getVertexAttr"in c?c.getVertexAttr():"vertexAttr"in c?c.vertexAttr:null;if(!a)return null;var d=A.RibbonVertexAttributeConstants.POSITION,c="getVertexAttr"in c?c.getIndices(d):null;return t.computeAttachmentOriginLines(a[d],c,c&&this.params.isClosed,b)};b.prototype.createLayout=function(){var a=q.newLayout().vec3f(A.RibbonVertexAttributeConstants.POSITION).f32(A.RibbonVertexAttributeConstants.SUBDIVISIONFACTOR).vec2f(A.RibbonVertexAttributeConstants.UV0).vec3f(A.RibbonVertexAttributeConstants.AUXPOS1).vec3f(A.RibbonVertexAttributeConstants.AUXPOS2);
this.params.vvSizeEnabled?a.f32(A.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE):a.f32(A.RibbonVertexAttributeConstants.SIZE);this.params.vvColorEnabled?a.f32(A.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE):a.vec4f(A.RibbonVertexAttributeConstants.COLOR);this.params.vvOpacityEnabled&&a.f32(A.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE);return a};b.prototype.createBufferWriter=function(){return new G(this.layout,this.params)};b.prototype.createRenderer=function(a,b){return new z(a,
b,this,A.ribbonVertexAttributeLocations)};b.prototype.getGLMaterial=function(a){return 0===a.output||4===a.output?new F(a):void 0};b.prototype.validateParams=function(){this.params.width&&1<this.params.width&&(this.params.width=Math.round(this.params.width));"miter"!==this.params.join&&(this.params.miterLimit=0)};return b}(r.Material);var F=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}m(b,a);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(y.RibbonLineTechnique,
this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.beginSlot=function(a){return this.technique.configuration.occluder?3===a||10===a||11===a:0===this.output?(this.targetSlot=this.technique.configuration.writeDepth?5:8,a===this.targetSlot):3===a};b.prototype._updateOccludeeState=function(a){a.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};b.prototype.ensureParameters=
function(a){0===this.output&&this._updateOccludeeState(a)};b.prototype.bind=function(a,b){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getPassParameters(),b)};b.prototype.getPipelineState=function(a,b){return b?this.technique.occludeePipeline:this.technique.configuration.occluder?11===a?this.technique.occluderPipelineTransparent:10===a?this.technique.occluderPipelineOpaque:this.technique.occluderPipelineMaskWrite:this.technique.pipeline};return b}(u.GLMaterial),E=
k({width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1},w.Default),G=function(){function a(a,b){this.params=b;this.numJoinSubdivisions=this.numCapSubdivisions=0;this.vertexBufferLayout=a;if(!b.isClosed)switch(this.params.cap){case "butt":this.numCapSubdivisions=0;break;case "square":this.numCapSubdivisions=
1;break;case "round":this.numCapSubdivisions=H}switch(this.params.join){case "miter":case "bevel":this.numJoinSubdivisions=b.stipplePattern?1:0;break;case "round":this.numJoinSubdivisions=D}}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){var b=2*this.numCapSubdivisions+2,c=a.indices[A.RibbonVertexAttributeConstants.POSITION].length/2+1,d=this.params.isClosed,b=d?2:2*b,e=d?0:1,c=d?c:c-1;if(a.vertexAttr[A.RibbonVertexAttributeConstants.SUBDIVISIONS])for(a=
a.vertexAttr[A.RibbonVertexAttributeConstants.SUBDIVISIONS].data;e<c;++e)b+=4+2*a[e];else b+=(c-e)*(2*this.numJoinSubdivisions+4);return b+2};a.prototype.write=function(a,b,c,e){var f=this,h=J,l=U,g=Y,k=b.vertexAttr[A.RibbonVertexAttributeConstants.POSITION].data,m=b.indices&&b.indices[A.RibbonVertexAttributeConstants.POSITION];m&&m.length!==2*(k.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");m=null;b.vertexAttr[A.RibbonVertexAttributeConstants.SUBDIVISIONS]&&(m=b.vertexAttr[A.RibbonVertexAttributeConstants.SUBDIVISIONS].data);
var p=1,q=0;this.params.vvSizeEnabled?q=b.vertexAttr[A.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]:b.vertexAttr[A.RibbonVertexAttributeConstants.SIZE]&&(p=b.vertexAttr[A.RibbonVertexAttributeConstants.SIZE].data[0]);var r=[1,1,1,1],t=0;this.params.vvColorEnabled?t=b.vertexAttr[A.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE].data[0]:b.vertexAttr[A.RibbonVertexAttributeConstants.COLOR]&&(r=b.vertexAttr[A.RibbonVertexAttributeConstants.COLOR].data);var u=0;this.params.vvOpacityEnabled&&
(u=b.vertexAttr[A.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE].data[0]);b=k.length/3;a=a.transformation;var v=new Float32Array(c.buffer);c=this.vertexBufferLayout.stride/4;var x=e*c;e=x;var w=function(a,b,c,d,e,h){v[x++]=b[0];v[x++]=b[1];v[x++]=b[2];v[x++]=d;v[x++]=e;v[x++]=h;v[x++]=a[0];v[x++]=a[1];v[x++]=a[2];v[x++]=c[0];v[x++]=c[1];v[x++]=c[2];f.params.vvSizeEnabled?v[x++]=q:v[x++]=p;f.params.vvColorEnabled?v[x++]=t:(v[x++]=r[0],v[x++]=r[1],v[x++]=r[2],v[x++]=r[3]);f.params.vvOpacityEnabled&&
(v[x++]=u)},x=x+c;d.vec3.set(l,k[0],k[1],k[2]);a&&d.vec3.transformMat4(l,l,a);var n=this.params.isClosed;if(n){var y=k.length-3;d.vec3.set(h,k[y],k[y+1],k[y+2]);a&&d.vec3.transformMat4(h,h,a)}else{d.vec3.copy(h,l);d.vec3.set(g,k[3],k[4],k[5]);a&&d.vec3.transformMat4(g,g,a);for(y=0;y<this.numCapSubdivisions;++y){var z=1-y/this.numCapSubdivisions;w(h,l,g,z,1,-4);w(h,l,g,z,1,4)}w(h,l,g,0,0,-4);w(h,l,g,0,0,4);d.vec3.copy(h,l);d.vec3.copy(l,g)}for(var C=n?b:b-1,y=n?0:1;y<C;y++){z=(y+1)%b*3;d.vec3.set(g,
k[z+0],k[z+1],k[z+2]);a&&d.vec3.transformMat4(g,g,a);w(h,l,g,0,1,-1);w(h,l,g,0,1,1);for(var F=m?m[y]:this.numJoinSubdivisions,K=0;K<F;++K)z=(K+1)/(F+1),w(h,l,g,z,1,-2),w(h,l,g,z,1,2);w(h,l,g,1,0,-2);w(h,l,g,1,0,2);d.vec3.copy(h,l);d.vec3.copy(l,g)}if(n)x=B(v,e+c,v,x,2*c);else for(w(h,l,g,0,1,-5),w(h,l,g,0,1,5),y=0;y<this.numCapSubdivisions;++y)z=(y+1)/this.numCapSubdivisions,w(h,l,g,z,1,-5),w(h,l,g,z,1,5);B(v,e+c,v,e,c);x=B(v,x-c,v,x,c)};return a}(),H=3,D=1,I=a.vec3f64.create(),L=a.vec3f64.create(),
O=a.vec3f64.create(),K=a.vec3f64.create(),N=a.vec3f64.create(),Q=l.createRenderScreenPointArray3(),M=l.createRenderScreenPointArray3(),T=a.vec3f64.create(),P=a.vec3f64.create(),S=c.lineSegment.create(),V=c.lineSegment.create(),J=a.vec3f64.create(),U=a.vec3f64.create(),Y=a.vec3f64.create(),X=[l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3()],R=[a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create()],
aa=c.plane.create(),da=c.plane.create(),ca=c.plane.create(),ba=c.plane.create();return n})},"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat3f64","../../../../core/libs/gl-matrix-2/vec3f32"],function(n,b,m,k){var g;(g||(g={})).Default={vvSizeEnabled:!1,vvSizeMinSize:k.vec3f32.fromValues(1,1,1),vvSizeMaxSize:k.vec3f32.fromValues(100,100,100),vvSizeOffset:k.vec3f32.fromValues(0,0,0),vvSizeFactor:k.vec3f32.fromValues(1,
1,1),vvSizeValue:k.vec3f32.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:m.mat3f64.create()};return g})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../../../core/maybe ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/StencilUtils ./RibbonLine.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x){Object.defineProperty(b,"__esModule",{value:!0});b.RibbonVertexAttributeConstants={POSITION:"position",SUBDIVISIONFACTOR:"subdivisionFactor",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",SUBDIVISIONS:"subdivisions",COLOR:"color",COLORFEATUREATTRIBUTE:"colorFeatureAttribute",SIZE:"size",SIZEFEATUREATTRIBUTE:"sizeFeatureAttribute",OPACITYFEATUREATTRIBUTE:"opacityFeatureAttribute"};b.ribbonVertexAttributeLocations={position:0,subdivisionFactor:1,uv0:2,auxpos1:3,
auxpos2:4,size:6,sizeFeatureAttribute:6,color:5,colorFeatureAttribute:5,opacityFeatureAttribute:7};g=function(g){function k(a,b){b=g.call(this,a,b)||this;b.stipplePattern=null;b.stippleTextureBind=null;b.stippleTextureRepository=a.stippleTextureRepository;return b}m(k,g);k.prototype.initializeProgram=function(a){var c=k.shader.get(),d=this.configuration,c=c.build({output:d.output,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:d.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,
stippleEnabled:d.stippleEnabled,stippleOffColorEnabled:d.stippleOffColorEnabled,stippleUVMaxEnabled:d.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:d.stippleIntegerRepeatsEnabled,roundCaps:d.roundCaps,roundJoins:d.roundJoins,vvColor:d.vvColor,vvSize:d.vvSize,vvInstancingEnabled:!0,vvOpacity:d.vvOpacity,falloffEnabled:d.falloffEnabled,innerColorEnabled:d.innerColorEnabled});return new r(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),b.ribbonVertexAttributeLocations)};k.prototype.dispose=
function(){g.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};k.prototype.bindPass=function(b,c,h){4===this.configuration.output&&d.OutputHighlight.bindOutputHighlight(b,this.program,h);this.program.setUniform1f("intrinsicWidth",c.width);this.program.setUniform4fv("intrinsicColor",c.color);this.program.setUniform1f("miterLimit","miter"!==c.join?0:c.miterLimit);this.program.setUniform1f("nearPlane",h.nearFar[0]);
this.program.setUniform1f("pixelRatio",h.pixelRatio);this.program.setUniform2fv("screenSize",[h.viewport[2],h.viewport[3]]);a.VisualVariables.bindUniformsWithOpacity(this.program,c);if(this.stipplePattern!==c.stipplePattern){var l=c.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,l);this.stipplePattern=l}this.configuration.stippleEnabled&&(b=f.isSome(this.stippleTextureBind)?this.stippleTextureBind(b,0)*h.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",
0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/b),this.configuration.stippleOffColorEnabled&&(b=e.expect(c.stippleOffColor),this.program.setUniform4f("stippleOffColor",b[0],b[1],b[2],3<b.length?b[3]:1)));this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",c.falloff);this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",e.unwrapOr(c.innerColor,c.color)),this.program.setUniform1f("innerWidth",c.innerWidth*h.pixelRatio))};k.prototype.bindDraw=
function(a){h.Transform.bindUniforms(this.program,a);l.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};k.prototype.initializePipeline=function(){var a=this.configuration,b=x.separateBlendingParams(770,1,771,771),c=a.polygonOffset&&w;a.occluder&&(this._occluderPipelineTransparent=x.makePipelineState({blending:b,polygonOffset:c,depthTest:t.depthCompareAlways,depthWrite:null,colorWrite:x.defaultColorWriteParams,stencilWrite:null,stencilTest:t.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=
x.makePipelineState({polygonOffset:c,depthTest:t.depthCompareAlways,depthWrite:null,colorWrite:x.defaultColorWriteParams,stencilWrite:t.stencilWriteMaskOff,stencilTest:t.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=x.makePipelineState({polygonOffset:c,depthTest:t.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:t.stencilWriteMaskOn,stencilTest:t.stencilToolMaskBaseParams}));if(0===a.output){var d=function(d){return x.makePipelineState({blending:b,polygonOffset:c,depthTest:t.depthCompareLess,
depthWrite:!a.transparent&&a.writeDepth&&x.defaultDepthWriteParams,colorWrite:x.defaultColorWriteParams,stencilWrite:a.sceneHasOcludees?t.stencilWriteMaskOn:null,stencilTest:a.sceneHasOcludees?d?t.stencilToolMaskBaseParams:a.sceneHasOcludees?t.stencilBaseAllZerosParams:null:null})};this._occludeePipeline=d(!0);return d(!1)}return x.makePipelineState({polygonOffset:c,depthTest:t.depthCompareLess,depthWrite:!a.transparent&&a.writeDepth&&x.defaultDepthWriteParams,colorWrite:x.defaultColorWriteParams})};
Object.defineProperty(k.prototype,"occluderPipelineTransparent",{get:function(){return this._occluderPipelineTransparent},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"occluderPipelineOpaque",{get:function(){return this._occluderPipelineOpaque},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"occludeePipeline",{get:function(){return this._occludeePipeline},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"occluderPipelineMaskWrite",{get:function(){return this._occluderPipelineMaskWrite},
enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"primitiveType",{get:function(){return 5},enumerable:!0,configurable:!0});k.shader=new c.ReloadableShaderModule(u,"./RibbonLine.glsl",n);return k}(q.ShaderTechnique);b.RibbonLineTechnique=g;var w={factor:0,units:-4};g=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.occluder=!1;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.vertexColors=!1;b.transparent=!1;b.polygonOffset=!1;b.writeDepth=!1;
b.stippleEnabled=!1;b.stippleOffColorEnabled=!1;b.stippleIntegerRepeatsEnabled=!1;b.roundCaps=!1;b.roundJoins=!1;b.vvSize=!1;b.vvColor=!1;b.vvOpacity=!1;b.falloffEnabled=!1;b.innerColorEnabled=!1;b.sceneHasOcludees=!1;return b}m(b,a);k([p.parameter({count:7})],b.prototype,"output",void 0);k([p.parameter()],b.prototype,"occluder",void 0);k([p.parameter()],b.prototype,"slicePlaneEnabled",void 0);k([p.parameter()],b.prototype,"sliceHighlightDisabled",void 0);k([p.parameter()],b.prototype,"vertexColors",
void 0);k([p.parameter()],b.prototype,"transparent",void 0);k([p.parameter()],b.prototype,"polygonOffset",void 0);k([p.parameter()],b.prototype,"writeDepth",void 0);k([p.parameter()],b.prototype,"stippleEnabled",void 0);k([p.parameter()],b.prototype,"stippleOffColorEnabled",void 0);k([p.parameter()],b.prototype,"stippleIntegerRepeatsEnabled",void 0);k([p.parameter()],b.prototype,"roundCaps",void 0);k([p.parameter()],b.prototype,"roundJoins",void 0);k([p.parameter()],b.prototype,"vvSize",void 0);k([p.parameter()],
b.prototype,"vvColor",void 0);k([p.parameter()],b.prototype,"vvOpacity",void 0);k([p.parameter()],b.prototype,"falloffEnabled",void 0);k([p.parameter()],b.prototype,"innerColorEnabled",void 0);k([p.parameter()],b.prototype,"sceneHasOcludees",void 0);return b}(p.ShaderTechniqueConfiguration);b.RibbonLineTechniqueConfiguration=g})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.depthCompareLess={func:513};
b.depthCompareAlways={func:519};b.stencilWriteMaskOn={mask:255};b.stencilWriteMaskOff={mask:0};b.renderWhenBitIsNotSet=function(b){return{function:{func:517,ref:b,mask:b},operation:{fail:7680,zFail:7680,zPass:7680}}};b.replaceBitWhenDepthTestPasses=function(b){return{function:{func:519,ref:b,mask:b},operation:{fail:7680,zFail:7680,zPass:7681}}};b.stencilBaseAllZerosParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}};b.stencilToolMaskBaseParams={function:{func:519,ref:2,
mask:2},operation:{fail:7680,zFail:7680,zPass:7681}};b.stencilToolMaskOccluderParams={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}};b.stencilToolTransparentOccluderParams={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}}})},"esri/views/3d/webgl-engine/shaders/RibbonLine.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../core/shaderLibrary/shading/LineStipple.glsl ../core/shaderLibrary/shading/PiUtils.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,m,k,g,e,f,l,h){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var n=new h.ShaderBuilder;n.extensions.add("GL_OES_standard_derivatives");n.include(f.PiUtils);n.include(g.RibbonVertexPosition,b);n.include(e.LineStipple,b);n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4").add("nearPlane","float").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2");n.attributes.add("position","vec3");n.attributes.add("subdivisionFactor",
"float");n.attributes.add("uv0","vec2");n.attributes.add("auxpos1","vec3");n.attributes.add("auxpos2","vec3");n.varyings.add("vColor","vec4");n.varyings.add("vpos","vec3");var M=b.falloffEnabled,N=b.innerColorEnabled;N&&n.varyings.add("vLineDistance","float");M&&n.varyings.add("vLineDistanceNorm","float");b.falloffEnabled&&n.fragment.uniforms.add("falloff","float");b.innerColorEnabled&&(n.fragment.uniforms.add("innerColor","vec4"),n.fragment.uniforms.add("innerWidth","float"));n.vertex.code.add(l.glsl(d||
(d=m(["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y \x3e 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s \x3d sin(a);\n\t\t\tfloat c \x3d cos(a);\n\t\t\tmat2 m \x3d mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"],["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y \x3e 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s \x3d sin(a);\n\t\t\tfloat c \x3d cos(a);\n\t\t\tmat2 m \x3d mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"]))));
n.vertex.code.add(l.glsl(a||(a=m(["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc \x3d proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *\x3d screenSize / posNdc.w;\n      return posNdc;\n    }\n"],["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc \x3d proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *\x3d screenSize / posNdc.w;\n      return posNdc;\n    }\n"]))));
n.vertex.code.add(l.glsl(c||(c=m(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp \x3d nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z \x3e -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z \x3c -nearPlane) {\n            pos \x3d mix(prev, pos, interp(vnp, prev, pos));\n            next \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z \x3c -nearPlane) {\n            pos \x3d mix(pos, next, interp(vnp, pos, next));\n            prev \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z \x3e -nearPlane) {\n          prev \x3d mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z \x3e -nearPlane) {\n          next \x3d mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos \x3d projectAndScale(pos);\n      next \x3d projectAndScale(next);\n      prev \x3d projectAndScale(prev);\n    }\n"],
["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp \x3d nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z \x3e -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z \x3c -nearPlane) {\n            pos \x3d mix(prev, pos, interp(vnp, prev, pos));\n            next \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z \x3c -nearPlane) {\n            pos \x3d mix(pos, next, interp(vnp, pos, next));\n            prev \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z \x3e -nearPlane) {\n          prev \x3d mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z \x3e -nearPlane) {\n          next \x3d mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos \x3d projectAndScale(pos);\n      next \x3d projectAndScale(next);\n      prev \x3d projectAndScale(prev);\n    }\n"]))));
n.vertex.code.add(l.glsl(q||(q=m(["\n  void main(void) {\n    float coverage \x3d 1.0;\n    vpos \x3d (model * vec4(position, 1.0)).xyz;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y \x3d\x3d 0.0) {\n      // Project out of clip space\n      gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex \x3d abs(abs(uv0.y)-3.0) \x3d\x3d 1.0;\n      bool isJoin \x3d abs(uv0.y)-3.0 \x3c 0.0;\n\n      float lineWidth \x3d getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth \x3c 1.0) {\n        coverage \x3d lineWidth;\n        lineWidth \x3d 1.0;\n      }\n\n      vec4 pos  \x3d view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\n      vec4 prev \x3d view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\n      vec4 next \x3d view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left \x3d (pos.xy - prev.xy);\n      vec2 right \x3d (next.xy - pos.xy);\n\n      float leftLen \x3d length(left);\n      float rightLen \x3d length(right);\n  "],
["\n  void main(void) {\n    float coverage \x3d 1.0;\n    vpos \x3d (model * vec4(position, 1.0)).xyz;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y \x3d\x3d 0.0) {\n      // Project out of clip space\n      gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex \x3d abs(abs(uv0.y)-3.0) \x3d\x3d 1.0;\n      bool isJoin \x3d abs(uv0.y)-3.0 \x3c 0.0;\n\n      float lineWidth \x3d getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth \x3c 1.0) {\n        coverage \x3d lineWidth;\n        lineWidth \x3d 1.0;\n      }\n\n      vec4 pos  \x3d view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\n      vec4 prev \x3d view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\n      vec4 next \x3d view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left \x3d (pos.xy - prev.xy);\n      vec2 right \x3d (next.xy - pos.xy);\n\n      float leftLen \x3d length(left);\n      float rightLen \x3d length(right);\n  "]))));
b.stippleEnabled&&n.vertex.code.add(l.glsl(p||(p=m(["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos-\x3enext, otherwise use prev-\x3epos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo \x3d mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin \x3d stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection \x3d stippleSegmentInfo.zw;\n    "],
["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos-\x3enext, otherwise use prev-\x3epos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo \x3d mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin \x3d stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection \x3d stippleSegmentInfo.zw;\n    "]))));
n.vertex.code.add(l.glsl(t||(t=m(['\n    left \x3d (leftLen \x3e 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right \x3d (rightLen \x3e 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir \x3d vec2(0, 0);\n    vec2 joinDisplacementDir \x3d vec2(0, 0);\n    float displacementLen \x3d lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside \x3d ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir \x3d normalize(left + right);\n      joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n\n      // compute miter stretch\n      if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\n        float nDotSeg \x3d dot(joinDisplacementDir, left);\n        displacementLen /\x3d length(nDotSeg * left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside \x26\x26 (displacementLen \x3e miterLimit * lineWidth)) {\n    '],
['\n    left \x3d (leftLen \x3e 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right \x3d (rightLen \x3e 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir \x3d vec2(0, 0);\n    vec2 joinDisplacementDir \x3d vec2(0, 0);\n    float displacementLen \x3d lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside \x3d ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir \x3d normalize(left + right);\n      joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n\n      // compute miter stretch\n      if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\n        float nDotSeg \x3d dot(joinDisplacementDir, left);\n        displacementLen /\x3d length(nDotSeg * left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside \x26\x26 (displacementLen \x3e miterLimit * lineWidth)) {\n    ']))));
b.roundJoins?n.vertex.code.add(l.glsl(u||(u=m(["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen \x3c 0.001) {\n          startDir \x3d right;\n        }\n        else{\n          startDir \x3d left;\n        }\n        startDir \x3d normalize(startDir);\n        startDir \x3d PERPENDICULAR(startDir);\n\n        if (rightLen \x3c 0.001) {\n          endDir \x3d left;\n        }\n        else{\n          endDir \x3d right;\n        }\n        endDir \x3d normalize(endDir);\n        endDir \x3d PERPENDICULAR(endDir);\n\n        float rotationAngle \x3d acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir \x3d rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "],
["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen \x3c 0.001) {\n          startDir \x3d right;\n        }\n        else{\n          startDir \x3d left;\n        }\n        startDir \x3d normalize(startDir);\n        startDir \x3d PERPENDICULAR(startDir);\n\n        if (rightLen \x3c 0.001) {\n          endDir \x3d left;\n        }\n        else{\n          endDir \x3d right;\n        }\n        endDir \x3d normalize(endDir);\n        endDir \x3d PERPENDICULAR(endDir);\n\n        float rotationAngle \x3d acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir \x3d rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "])))):
n.vertex.code.add(l.glsl(r||(r=m(["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen \x3c 0.001) {\n          joinDisplacementDir \x3d right;\n        }\n        else if (rightLen \x3c 0.001) {\n          joinDisplacementDir \x3d left;\n        }\n        else {\n          joinDisplacementDir \x3d isStartVertex ? right : left;\n        }\n        joinDisplacementDir \x3d normalize(joinDisplacementDir);\n        joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n  "],
["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen \x3c 0.001) {\n          joinDisplacementDir \x3d right;\n        }\n        else if (rightLen \x3c 0.001) {\n          joinDisplacementDir \x3d left;\n        }\n        else {\n          joinDisplacementDir \x3d isStartVertex ? right : left;\n        }\n        joinDisplacementDir \x3d normalize(joinDisplacementDir);\n        joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n  "]))));n.vertex.code.add(l.glsl(x||
(x=m(["\n        displacementLen \x3d lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen \x3c 0.001) {\n      joinDisplacementDir \x3d right;\n    }\n    else if (rightLen \x3c 0.001) {\n      joinDisplacementDir \x3d left;\n    }\n    else {\n      joinDisplacementDir \x3d isStartVertex ? right : left;\n    }\n    joinDisplacementDir \x3d normalize(joinDisplacementDir);\n    joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n    displacementLen \x3d lineWidth;\n\n    capDisplacementDir \x3d isStartVertex ? -right : left;\n  "],
["\n        displacementLen \x3d lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen \x3c 0.001) {\n      joinDisplacementDir \x3d right;\n    }\n    else if (rightLen \x3c 0.001) {\n      joinDisplacementDir \x3d left;\n    }\n    else {\n      joinDisplacementDir \x3d isStartVertex ? right : left;\n    }\n    joinDisplacementDir \x3d normalize(joinDisplacementDir);\n    joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n    displacementLen \x3d lineWidth;\n\n    capDisplacementDir \x3d isStartVertex ? -right : left;\n  "]))));
b.roundCaps?n.vertex.code.add(l.glsl(w||(w=m(["\n    float angle \x3d subdivisionFactor*PI*0.5;\n    joinDisplacementDir *\x3d cos(angle);\n    capDisplacementDir *\x3d sin(angle);\n    "],["\n    float angle \x3d subdivisionFactor*PI*0.5;\n    joinDisplacementDir *\x3d cos(angle);\n    capDisplacementDir *\x3d sin(angle);\n    "])))):n.vertex.code.add(l.glsl(v||(v=m(["\n    capDisplacementDir *\x3d subdivisionFactor;\n    "],["\n    capDisplacementDir *\x3d subdivisionFactor;\n    "]))));n.vertex.code.add(l.glsl(B||
(B=m(["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos \x3d joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n  ","\n\n  pos.xy +\x3d dpos;\n  "],["\n  }\n\n  // Displacement (in pixels) caused by join/or cap\n  vec2 dpos \x3d joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n  ","\n\n  ","\n  ","\n\n  pos.xy +\x3d dpos;\n  "])),M||N?l.glsl(z||(z=m(["float lineDist \x3d lineWidth * sign(uv0.y) * pos.w;"],
["float lineDist \x3d lineWidth * sign(uv0.y) * pos.w;"]))):"",N?l.glsl(y||(y=m(["vLineDistance \x3d lineDist;"],["vLineDistance \x3d lineDist;"]))):"",M?l.glsl(A||(A=m(["vLineDistanceNorm \x3d lineDist / lineWidth;"],["vLineDistanceNorm \x3d lineDist / lineWidth;"]))):""));b.stippleEnabled&&(n.vertex.code.add(l.glsl(C||(C=m(["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec \x3d pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength \x3d length(stippleSegmentDirection);\n    "],
["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec \x3d pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength \x3d length(stippleSegmentDirection);\n    "])))),
b.stippleIntegerRepeatsEnabled&&n.vertex.code.add(l.glsl(F||(F=m(["\n      float numberOfPatternRepeats \x3d stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats \x3d max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax \x3d roundedNumberOfPatternRepeats;\n      "],["\n      float numberOfPatternRepeats \x3d stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats \x3d max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax \x3d roundedNumberOfPatternRepeats;\n      "])))),
n.vertex.code.add(l.glsl(E||(E=m(["\n      if (stippleSegmentDirectionLength \x3e\x3d 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength \x3d dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ","\n        stipplePatternUv \x3d projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv \x3d 1.0;\n        }\n      }\n    "],["\n      if (stippleSegmentDirectionLength \x3e\x3d 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength \x3d dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ",
"\n        stipplePatternUv \x3d projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv \x3d 1.0;\n        }\n      }\n    "])),b.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale \x3d roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale \x3d 1.0;")));n.vertex.code.add(l.glsl(G||(G=m(["\n      // Convert back into NDC\n      pos.xy \x3d pos.xy / screenSize * pos.w;\n\n      vColor \x3d getColor();\n      vColor.a *\x3d coverage;\n\n      gl_Position \x3d pos;\n    }\n  }\n  "],
["\n      // Convert back into NDC\n      pos.xy \x3d pos.xy / screenSize * pos.w;\n\n      vColor \x3d getColor();\n      vColor.a *\x3d coverage;\n\n      gl_Position \x3d pos;\n    }\n  }\n  "]))));n.include(k.Slice,b);0===b.output&&(n.fragment.uniforms.add("intrinsicColor","vec4"),n.fragment.code.add(l.glsl(H||(H=m(["\n    void main() {\n      discardBySlice(vpos);\n      float stippleAlpha \x3d getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      vec4 color \x3d intrinsicColor * vColor;\n    "],
["\n    void main() {\n      discardBySlice(vpos);\n      float stippleAlpha \x3d getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      vec4 color \x3d intrinsicColor * vColor;\n    "])))),b.innerColorEnabled&&(n.fragment.uniforms.add("pixelRatio","float"),n.fragment.code.add(l.glsl(D||(D=m(["\n      float distToInner \x3d abs(vLineDistance * gl_FragCoord.w) - innerWidth;\n      float innerAA \x3d clamp(0.5 - distToInner, 0.0, 1.0);\n      float innerAlpha \x3d innerColor.a + color.a * (1.0 - innerColor.a);\n      color \x3d mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);\n      "],
["\n      float distToInner \x3d abs(vLineDistance * gl_FragCoord.w) - innerWidth;\n      float innerAA \x3d clamp(0.5 - distToInner, 0.0, 1.0);\n      float innerAlpha \x3d innerColor.a + color.a * (1.0 - innerColor.a);\n      color \x3d mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);\n      "]))))),n.fragment.code.add(l.glsl(I||(I=m(["\n      vec4 finalColor \x3d blendStipple(color, stippleAlpha);\n    "],["\n      vec4 finalColor \x3d blendStipple(color, stippleAlpha);\n    "])))),b.falloffEnabled&&
n.fragment.code.add(l.glsl(L||(L=m(["\n      finalColor.a *\x3d pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);\n      "],["\n      finalColor.a *\x3d pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);\n      "])))),n.fragment.code.add(l.glsl(O||(O=m(["\n      gl_FragColor \x3d highlightSlice(finalColor, vpos);\n    }\n    "],["\n      gl_FragColor \x3d highlightSlice(finalColor, vpos);\n    }\n    "])))));4===b.output&&n.fragment.code.add(l.glsl(K||(K=m(["\n      void main() {\n        discardBySlice(vpos);\n        discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n        gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    "],
["\n      void main() {\n        discardBySlice(vpos);\n        discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n        gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    "]))));return n};var d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L,O,K})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,
b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.RibbonVertexPosition=function(a,b){a.vertex.uniforms.add("intrinsicWidth","float");b.vvSize?(a.attributes.add("sizeFeatureAttribute","float"),a.vertex.uniforms.add("vvSizeMinSize","vec3"),a.vertex.uniforms.add("vvSizeMaxSize","vec3"),a.vertex.uniforms.add("vvSizeOffset","vec3"),a.vertex.uniforms.add("vvSizeFactor","vec3"),a.vertex.code.add(k.glsl(g||(g=m(["\n    float getSize() {\n      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "],
["\n    float getSize() {\n      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "]))))):(a.attributes.add("size","float"),a.vertex.code.add(k.glsl(e||(e=m(["\n    float getSize(){\n      return intrinsicWidth * size;\n    }\n    "],["\n    float getSize(){\n      return intrinsicWidth * size;\n    }\n    "])))));b.vvOpacity?(a.attributes.add("opacityFeatureAttribute","float"),a.vertex.defines.addInt("VV_OPACITY_N",8),
a.vertex.code.add(k.glsl(f||(f=m(["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "],
["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "]))))):
a.vertex.code.add(k.glsl(l||(l=m(["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "],["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "]))));b.vvColor?(a.attributes.add("colorFeatureAttribute","float"),a.vertex.defines.addInt("VV_COLOR_N",8),a.vertex.code.add(k.glsl(h||(h=m(["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value \x3c\x3d vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "],
["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value \x3c\x3d vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "]))))):
(a.attributes.add("color","vec4"),a.vertex.code.add(k.glsl(d||(d=m(["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "],["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "])))))};var g,e,f,l,h,d})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",
{value:!0});b.LineStipple=function(b,d){b.defines.addFloat("STIPPLE_ALPHA_COLOR_DISCARD",.001);b.defines.addFloat("STIPPLE_ALPHA_HIGHLIGHT_DISCARD",.5);d.stippleEnabled?(b.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),d.stippleUVMaxEnabled&&b.varyings.add("stipplePatternUvMax","float"),b.varyings.add("stipplePatternUv","float"),b.fragment.uniforms.add("stipplePatternTexture","sampler2D"),d.stippleOffColorEnabled&&b.fragment.uniforms.add("stippleOffColor","vec4"),b.fragment.code.add(k.glsl(g||
(g=m(["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped \x3d stipplePatternUv * gl_FragCoord.w;\n    ","\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"],["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped \x3d stipplePatternUv * gl_FragCoord.w;\n    ","\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"])),d.stippleUVMaxEnabled?"stipplePatternUvClamped \x3d clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":
"")),d.stippleOffColorEnabled?b.fragment.code.add(k.glsl(e||(e=m(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "],["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "])))):b.fragment.code.add(k.glsl(f||(f=m(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha \x3c threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "],
["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha \x3c threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "]))))):b.fragment.code.add(k.glsl(l||(l=m(["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "],["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "]))))};
var g,e,f,l})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require","exports"],function(n,b){return function(){function b(b,g,e,f,l,h){this.camera=null;this.slot=this.pass=0;this.highlightDepthTexture=null;this.renderOccludedMask=13;this.hasOccludees=!1;this.rctx=b;this.offscreenRenderingHelper=g;this.scenelightingData=e;this.shadowMap=f;this.ssaoHelper=l;this.sliceHelper=h}b.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=13};Object.defineProperty(b.prototype,
"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!0,configurable:!0});return b}()})},"esri/views/3d/webgl-engine/lib/renderStats":function(){define(["require","exports"],function(n,b){function m(){return{triangles:0,drawCalls:0}}Object.defineProperty(b,"__esModule",{value:!0});b.makeNewRenderStats=m;n=function(){function b(){this.materialRenderStats=new Map;this.reset()}b.prototype.getMaterialRenderStatsObject=function(b){var e=this.materialRenderStats.get(b);e||(e=m(),this.materialRenderStats.set(b,
e));return e};b.prototype.getAggregatedStats=function(){var b={materialRenderers:{},total:m()};this.materialRenderStats.forEach(function(e,f){b.materialRenderers[f]=e;b.total.drawCalls+=e.drawCalls;b.total.triangles+=e.triangles});return b};b.prototype.reset=function(){this.materialRenderStats.forEach(function(b){b.drawCalls=0;b.triangles=0})};return b}();b.RenderStatsAggregator=n})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("require exports ../../../../core/MapUtils ../../../../core/PooledArray ./Material ./rendererUtils".split(" "),
function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});var f=function(){return function(){}}();n=function(){function b(b,d,a){this._rctx=b;this._materialRep=d;this.emitUpdatingChanged=a;this._pendingAddsRemoves=new Map;this._adds=new k;this._removes=new k;this._updates=new k({allocator:function(a){return a||new f},deallocator:function(a){a.renderGeometry=null;return a}});this._materialRenderers=new Map;this._sortedMaterialRenderers=new k;this._hasWater=this._hasHighlights=!1}b.prototype.dispose=
function(){this._adds.prune();this._removes.prune();this._updates.prune()};Object.defineProperty(b.prototype,"updating",{get:function(){return 0<this._pendingAddsRemoves.size||0<this._updates.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasWater",{get:function(){return this._hasWater},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"rendersOccluded",{get:function(){return m.someMap(this._materialRenderers,function(b){return b.rendersOccluded})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isEmpty",{get:function(){return!this.updating&&0===this._materialRenderers.size},enumerable:!0,configurable:!0});b.prototype.commitChanges=function(){var b=this,d=!1;if(!this.updating)return!1;this.updateAddsRemoves();var a=!1,c=!1;e.splitRenderGeometryChangeSetByMaterial({numToAdd:this._adds.length,toAdd:this._adds.data,
numToRemove:this._removes.length,toRemove:this._removes.data,numToUpdate:this._updates.length,toUpdate:this._updates.data}).forEach(function(e,f){var h=b._materialRenderers.get(f);!h&&0<e.toAdd.length&&(h=f.createRenderer(b._rctx,b._materialRep),b._materialRenderers.set(f,h),c=a=d=!0);if(h){var l=a||h.hasHighlights,g=c||h.hasWater;h.modify(e);a=a||l!==h.hasHighlights;c=c||g!==h.hasWater;h.isEmpty&&(b._materialRenderers.delete(f),h.dispose(),d=!0)}});this._adds.clear();this._removes.clear();this._updates.clear();
this._pendingAddsRemoves.clear();d&&this.updateSortedMaterialRenderers();a&&(this._hasHighlights=m.someMap(this._materialRenderers,function(a){return a.hasHighlights}));c&&(this._hasWater=m.someMap(this._materialRenderers,function(a){return a.hasWater}));this.emitUpdatingChanged();return!0};b.prototype.add=function(b){for(var d=0===this._pendingAddsRemoves.size,a=0;a<b.length;a++)this._pendingAddsRemoves.set(b[a],0);d&&0<this._pendingAddsRemoves.size&&this.emitUpdatingChanged()};b.prototype.remove=
function(b){for(var d=0===this._pendingAddsRemoves.size,a=0;a<b.length;a++){var c=b[a],e=this._pendingAddsRemoves.get(c);0===e?this._pendingAddsRemoves.set(c,2):2!==e&&this._pendingAddsRemoves.set(c,1)}d&&0<this._pendingAddsRemoves.size&&this.emitUpdatingChanged()};b.prototype.modify=function(b,d){for(var a=0===this._updates.length,c=0;c<b.length;c++){var e=b[c],f=this._updates.pushNew();f.renderGeometry=e;f.updateType=d}a&&0<this._updates.length&&this.emitUpdatingChanged()};b.prototype.updateLogic=
function(b){for(var d=!1,a=0;a<this._sortedMaterialRenderers.length;a++){var c=this._sortedMaterialRenderers.data[a].materialRenderer;c.updateLogic&&c.updateLogic(b)&&(d=!0)}return d};b.prototype.draw=function(b,d,a){for(var c=0;c<this._sortedMaterialRenderers.length;c++){var e=this._sortedMaterialRenderers.data[c];if(g.materialPredicate(e.material,b)){var f=a.getMaterialRenderStatsObject(e.materialRenderer.type);e.materialRenderer.render(null,b,d,f)}}};b.prototype.updateSortedMaterialRenderers=function(){var b=
this;this._sortedMaterialRenderers.clear();this._materialRenderers.forEach(function(d,a){b._sortedMaterialRenderers.push({material:a,materialRenderer:d})});this._sortedMaterialRenderers.sort(function(b,a){return a.material.renderPriority-b.material.renderPriority})};b.prototype.updateAddsRemoves=function(){var b=this;this._adds.clear();this._removes.clear();this._pendingAddsRemoves.forEach(function(a,c){switch(a){case 0:b._adds.push(c);break;case 1:b._removes.push(c)}});for(var d=0;d<this._updates.length;)this._pendingAddsRemoves.has(this._updates.data[d].renderGeometry)?
this._updates.removeUnorderedIndex(d):d++};Object.defineProperty(b.prototype,"test",{get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}},enumerable:!0,configurable:!0});return b}();b.SortedRenderGeometryRenderer=n})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["require","exports","./Util"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.splitRenderGeometryChangeSetByMaterial=function(b){for(var g=new Map,e=null,f=null,l=function(a){if(a===
e)return f;var b=g.get(a);b||(b={toAdd:[],numToAdd:-1,toRemove:[],numToRemove:-1,toUpdate:[],numToUpdate:-1},g.set(a,b));e=a;return f=b},h=0;h<b.numToAdd;h++){var d=b.toAdd[h];if(1<=m.getFirstObjectValue(d.data.indices).length){var a=l(d.material);a.toAdd.push(d)}}for(h=0;h<b.numToRemove;h++)d=b.toRemove[h],1<=m.getFirstObjectValue(d.data.indices).length&&(a=l(d.material),a.toRemove.push(d));for(h=0;h<b.numToUpdate;h++)d=b.toUpdate[h],1<=m.getFirstObjectValue(d.renderGeometry.data.indices).length&&
(a=l(d.renderGeometry.material),a.toUpdate.push(d));return g}})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderLibrary/util/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});g=function(b){function h(){return null!==b&&b.apply(this,arguments)||this}m(h,b);h.prototype.initializeProgram=function(b){var c=h.shader.get().build();return new a(b.rctx,c.generateSource("vertex"),c.generateSource("fragment"),d.Default3D)};h.prototype.initializePipeline=function(){return this.configuration.hasAlpha?c.makePipelineState({blending:c.separateBlendingParams(770,1,771,771),colorWrite:c.defaultColorWriteParams}):
c.makePipelineState({colorWrite:c.defaultColorWriteParams})};h.shader=new f.ReloadableShaderModule(e,"../core/shaderLibrary/util/TextureOnly.glsl",n);return h}(l.ShaderTechnique);b.TextureTechnique=g;g=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.hasAlpha=!1;return b}m(b,a);k([h.parameter()],b.prototype,"hasAlpha",void 0);return b}(h.ShaderTechniqueConfiguration);b.TextureTechniqueConfiguration=g})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureOnly.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../ScreenSpacePass ../../shaderModules/interfaces ../../shaderModules/ShaderBuilder".split(" "),
function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(){var b=new e.ShaderBuilder;b.include(k.ScreenSpacePass);b.fragment.uniforms.add("tex","sampler2D");b.fragment.uniforms.add("color","vec4");b.fragment.code.add(g.glsl(f||(f=m(["\n    void main() {\n      vec4 texColor \x3d texture2D(tex, uv);\n      gl_FragColor \x3d texColor * color;\n    }\n  "],["\n    void main() {\n      vec4 texColor \x3d texture2D(tex, uv);\n      gl_FragColor \x3d texColor * color;\n    }\n  "]))));
return b};var f})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":function(){define(["require","exports","../../../../../core/tsSupport/makeTemplateObjectHelper","../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.ScreenSpacePass=function(b){b.attributes.add("position","vec2");b.varyings.add("uv","vec2");b.vertex.code.add(k.glsl(g||(g=m(["\n    void main(void) {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      uv \x3d position * 0.5 + vec2(0.5);\n    } \n  "],
["\n    void main(void) {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      uv \x3d position * 0.5 + vec2(0.5);\n    } \n  "]))))};var g})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","./SphericalHarmonics"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});var e=k.vec3f64.create();n=function(){function b(){this._renderLighting={main:{intensity:k.vec3f64.create(),
direction:k.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}};this._shOrder=2;this._oldSunlight={direction:k.vec3f64.create(),ambient:{color:k.vec3f64.create(),intensity:0},diffuse:{color:k.vec3f64.create(),intensity:0}}}b.prototype.setLightDirectionUniform=function(b){b.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction)};b.prototype.setUniforms=function(b,e){void 0===e&&(e=!1);e?b.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*
(1-this._info.globalFactor)):b.setUniform1f("lightingFixedFactor",0);b.setUniform1f("lightingGlobalFactor",this._info.globalFactor);this.setLightDirectionUniform(b);b.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);b.setUniform1f("ambientBoostFactor",.4);e=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?b.setUniform3f("lightingAmbientSH0",e.r[0],e.g[0],e.b[0]):1===this._shOrder?(b.setUniform4f("lightingAmbientSH_R",e.r[0],e.r[1],e.r[2],e.r[3]),b.setUniform4f("lightingAmbientSH_G",
e.g[0],e.g[1],e.g[2],e.g[3]),b.setUniform4f("lightingAmbientSH_B",e.b[0],e.b[1],e.b[2],e.b[3])):2===this._shOrder&&(b.setUniform3f("lightingAmbientSH0",e.r[0],e.g[0],e.b[0]),b.setUniform4f("lightingAmbientSH_R1",e.r[1],e.r[2],e.r[3],e.r[4]),b.setUniform4f("lightingAmbientSH_G1",e.g[1],e.g[2],e.g[3],e.g[4]),b.setUniform4f("lightingAmbientSH_B1",e.b[1],e.b[2],e.b[3],e.b[4]),b.setUniform4f("lightingAmbientSH_R2",e.r[5],e.r[6],e.r[7],e.r[8]),b.setUniform4f("lightingAmbientSH_G2",e.g[5],e.g[6],e.g[7],
e.g[8]),b.setUniform4f("lightingAmbientSH_B2",e.b[5],e.b[6],e.b[7],e.b[8]))};b.prototype.set=function(b){this._info=b;g.combineLights(b.lights,this._shOrder,this._renderLighting);m.vec3.negate(this._oldSunlight.direction,this._renderLighting.main.direction);b=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*b;this._oldSunlight.ambient.color[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*b;this._oldSunlight.ambient.color[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*
b;this._oldSunlight.ambient.intensity=1;this._oldSunlight.diffuse.color[0]=this._renderLighting.main.intensity[0]*b;this._oldSunlight.diffuse.color[1]=this._renderLighting.main.intensity[1]*b;this._oldSunlight.diffuse.color[2]=this._renderLighting.main.intensity[2]*b;this._oldSunlight.diffuse.intensity=1;b=m.vec3.copy(e,this._oldSunlight.diffuse.color);m.vec3.scale(b,b,.4*this._info.globalFactor);m.vec3.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,b)};Object.defineProperty(b.prototype,
"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"old",{get:function(){return this._oldSunlight},enumerable:!0,configurable:!0});return b}();b.SceneLighting=n})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),function(n,
b,m,k,g,e,f){function l(a){return(a+1)*(a+1)}function h(a){return m.clamp(Math.floor(Math.sqrt(a)-1),0,2)}function d(a,b,c){var d=a[0],e=a[1];a=a[2];c=c||[];c.length=l(b);0<=b&&(c[0]=.28209479177);1<=b&&(c[1]=.4886025119*d,c[2]=.4886025119*a,c[3]=.4886025119*e);2<=b&&(c[4]=1.09254843059*d*e,c[5]=1.09254843059*e*a,c[6]=.31539156525*(3*a*a-1),c[7]=1.09254843059*d*a,c[8]=.54627421529*(d*d-e*e));return c}function a(a,b){a=l(a);b=b||{r:[],g:[],b:[]};b.r.length=b.g.length=b.b.length=a;for(var c=0;c<a;c++)b.r[c]=
b.g[c]=b.b[c]=0;return b}function c(a,b){for(var c=h(b.r.length),f=0;f<a.length;f++){var l=a[f];k.vec3.negate(w,l.direction);d(w,c,r);e.elementwiseProduct(r,v);e.scalarProduct(r,l.intensity[0],x);e.add(b.r,x);e.scalarProduct(r,l.intensity[1],x);e.add(b.g,x);e.scalarProduct(r,l.intensity[2],x);e.add(b.b,x)}return b}function q(a,b){d(w,0,r);for(var c=0;c<a.length;c++){var e=a[c];b.r[0]+=r[0]*v[0]*e.intensity[0]*4*Math.PI;b.g[0]+=r[0]*v[0]*e.intensity[1]*4*Math.PI;b.b[0]+=r[0]*v[0]*e.intensity[2]*4*
Math.PI}return b}Object.defineProperty(b,"__esModule",{value:!0});b.numberOfCoefficients=l;b.numberOfCoefficientsInBand=function(a){return 2*a+1};b.orderFromNumberOfCoefficients=h;b.computeCoefficients=d;b.initSHCoefficients=a;b.projectFillLights=c;b.projectAmbientLights=q;b.combineLights=function(b,d,h){a(d,h.sphericalHarmonics.sh);k.vec3.set(h.main.intensity,0,0,0);var l=!1,g=p,m=t;d=u;g.length=0;m.length=0;for(var r=d.length=0;r<b.length;r++){var v=b[r];v instanceof f.MainLight&&!l?(k.vec3.copy(h.main.direction,
v.direction),h.main.intensity[0]=v.intensity[0],h.main.intensity[1]=v.intensity[1],h.main.intensity[2]=v.intensity[2],h.main.castShadows=v.castShadows,l=!0):v instanceof f.MainLight||v instanceof f.FillLight?g.push(v):v instanceof f.AmbientLight?m.push(v):v instanceof f.SphericalHarmonicsLight&&d.push(v)}c(g,h.sphericalHarmonics.sh);q(m,h.sphericalHarmonics.sh);for(b=0;b<d.length;b++)v=d[b],e.add(h.sphericalHarmonics.sh.r,v.sh.r),e.add(h.sphericalHarmonics.sh.g,v.sh.g),e.add(h.sphericalHarmonics.sh.b,
v.sh.b)};var p=[],t=[],u=[],r=[0],x=[0],w=g.vec3f64.create(),v=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.dotProduct=function(b,k){for(var g=0,e=0;e<b.length;e++)g+=b[e]*k[e];return g};b.elementwiseProduct=function(b,k,g){g=g||b;g.length=b.length;for(var e=0;e<b.length;e++)g[e]=b[e]*k[e];return g};b.scalarProduct=
function(b,k,g){g=g||b;g.length=b.length;for(var e=0;e<b.length;e++)g[e]=b[e]*k;return g};b.add=function(b,k,g){g=g||b;g.length=b.length;for(var e=0;e<b.length;e++)g[e]=b[e]+k[e];return g}})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["require","exports","../../../../core/maybe","../../../webgl"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.cache=new Map}b.prototype.dispose=function(){this.cache.forEach(function(b){m.isSome(b.texture)&&
(b.texture.dispose(),b.texture=null)});this.cache.clear()};b.prototype.acquire=function(b){if(m.isNone(b))return null;var e=this.patternId(b),l=this.cache.get(e);if(l)return l.refCount++,l.bind;var h=this.patternToTextureData(b,2),d=h.length/2,a={refCount:1,texture:null,bind:function(b,e){m.isNone(a.texture)&&(a.texture=new k.Texture(b,{width:h.length,height:1,internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},h));b.bindTexture(a.texture,e);return d}};this.cache.set(e,a);return a.bind};
b.prototype.release=function(b){if(!m.isNone(b)){b=this.patternId(b);var e=this.cache.get(b);e&&(e.refCount--,0===e.refCount&&(m.isSome(e.texture)&&e.texture.dispose(),this.cache.delete(b)))}};b.prototype.swap=function(b,f){f=this.acquire(f);this.release(b);return f};b.prototype.bind=function(b,f,l,h,d){b=m.isSome(h)?h(b,d)*f.pixelRatio:1;l.setUniform1i("stipplePatternTexture",d);l.setUniform1f("stipplePatternPixelSizeInv",1/b)};b.prototype.patternId=function(b){return b.join(",")};b.prototype.patternToTextureData=
function(b,f){for(var e=b.reduce(function(a,b){return a+b})*f,e=new Uint8Array(e),h=!0,d=0,a=0;a<b.length;a++){for(var c=b[a],g=0;g<c*f;g++)e[d++]=h?255:0;h=!h}return e};return b}();b.StippleTextureRepository=n;b.createStipplePattern=function(b){return m.isNone(b)?b:b.slice()};b.createStipplePatternSimple=function(b){return[b,b]}})},"esri/views/webgl":function(){define("require exports ./webgl/BufferObject ./webgl/enums ./webgl/FramebufferObject ./webgl/Program ./webgl/Renderbuffer ./webgl/RenderingContext ./webgl/ShaderCompiler ./webgl/Texture ./webgl/VertexArrayObject ./webgl/ProgramCache ./webgl/programUtils ./webgl/context-util".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});b.BufferObject=m;b.enums=k;b.FramebufferObject=g;b.Program=e;b.Renderbuffer=f;b.RenderingContext=l;b.ShaderCompiler=h;b.Texture=d;b.VertexArrayObject=a;b.ProgramCache=c.ProgramCache;b.createProgram=q.createProgram;b.glslifyDefineMap=q.glslifyDefineMap;b.createContextOrErrorHTML=p.createContextOrErrorHTML})},"esri/views/webgl/enums":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",
{value:!0});b.BASE_TEXTURE_UNIT=33984})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports","../../core/has","./Renderbuffer","./Texture"],function(n,b,m,k,g){return function(){function b(e,l,h,d){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=e;this._desc={colorTarget:l.colorTarget,depthStencilTarget:l.depthStencilTarget,width:l.width,height:l.height,multisampled:l.multisampled};this._id=
b._nextId++;m("esri-webgl-debug")&&e.instanceCounter.incrementCount(4);h&&(e=void 0,h instanceof g?(this._colorAttachment=h,e=h.descriptor):(e=h,this._colorAttachment=new g(this._context,e)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),b._validateTextureDimensions(e,this._desc));d instanceof k?(2===l.depthStencilTarget?this._stencilAttachment=d:1===l.depthStencilTarget||3===l.depthStencilTarget?
this._depthAttachment=d:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),b._validateBufferDimensions(d.descriptor,this._desc)):d&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),l=void 0,d instanceof g?(this._depthStencilTexture=d,l=this._depthStencilTexture.descriptor):
(l=d,this._depthStencilTexture=new g(this._context,l)),b._validateTextureDimensions(l,this._desc))}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof
g?this._colorAttachment:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"colorAttachment",{get:function(){return this._colorAttachment},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"depthStencilAttachment",{get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});b.prototype.dispose=function(){if(this._context){var b=this._context,e=b.getBoundFramebufferObject();this._disposeColorAttachment();this._disposeDepthStencilAttachments();this._glName&&(b.gl.deleteFramebuffer(this._glName),this._glName=null);m("esri-webgl-debug")&&
b.instanceCounter.decrementCount(4);b.bindFramebuffer(e);this._context=null}};b.prototype.attachColorTexture=function(e){if(e){b._validateTextureDimensions(e.descriptor,this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);var f=this._context.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,e.glName,0)}this._colorAttachment=e}};b.prototype.detachColorTexture=function(){if(this._colorAttachment instanceof g){var b=this._colorAttachment;
if(this._initialized){this._context.bindFramebuffer(this);var e=this._context.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}this._colorAttachment=null;return b}};b.prototype.attachDepthStencilTexture=function(e){if(e){var f=e.descriptor;34041!==f.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==f.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");this._context.capabilities.depthTexture||
console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");b._validateTextureDimensions(f,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),f=this._context.gl,f.framebufferTexture2D(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.TEXTURE_2D,e.glName,0));this._depthStencilTexture=e}};b.prototype.detachDepthStencilTexture=
function(){var b=this._depthStencilTexture;if(b&&this._initialized){this._context.bindFramebuffer(this);var e=this._context.gl;this._context.gl.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return b};b.prototype.attachDepthStencilBuffer=function(e){if(e){var f=e.descriptor;34041!==f.internalFormat&&33189!==f.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");b._validateBufferDimensions(f,this._desc);
this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===f.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),f=this._context.gl,f.framebufferRenderbuffer(f.FRAMEBUFFER,1===this._desc.depthStencilTarget?f.DEPTH_ATTACHMENT:f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,e.glName));this._depthAttachment=e}};b.prototype.detachDepthStencilBuffer=function(){var b=this._context.gl,e=this._depthAttachment;e&&this._initialized&&(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,
1===this._desc.depthStencilTarget?b.DEPTH_ATTACHMENT:b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,null));this._depthAttachment=null;return e};b.prototype.copyToTexture=function(b,e,h,d,a,c,g){(0>b||0>e||0>a||0>c)&&console.error("Offsets cannot be negative!");(0>=h||0>=d)&&console.error("Copy width and height must be greater than zero!");var f=this._desc,l=g.descriptor;3553!==g.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(b+h>f.width||e+d>f.height||a+h>l.width||c+d>l.height)&&
console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");f=this._context;f.bindTexture(g);f.bindFramebuffer(this);f.gl.copyTexSubImage2D(3553,0,a,c,b,e,h,d)};b.prototype.readPixels=function(b,e,h,d,a,c,g){(0>=h||0>=d)&&console.error("Copy width and height must be greater than zero!");g||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(b,e,h,d,a,c,g)};b.prototype.resize=function(e,l){var f=
this._desc;if(f.width!==e||f.height!==l)if(this._initialized)f.width=e,f.height=l,this._colorAttachment instanceof g?(d=this._colorAttachment,f=d.descriptor,f.width=e,f.height=l,this._colorAttachment.dispose(),this._colorAttachment=new g(this._context,f),b._validateTextureDimensions(d.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?(f=this._depthStencilTexture.descriptor,f.width=e,f.height=l,this._depthStencilTexture.dispose(),this._depthStencilTexture=
new g(this._context,f)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1;else{f.width=e;f.height=l;if(this._colorAttachment instanceof g){var d=this._colorAttachment;d.resize(e,l)}this._depthStencilTexture&&this._depthStencilTexture.resize(e,l)}};b.prototype.initialize=function(){if(this._initialized)return!1;var b=this._context.gl;this._glName&&b.deleteFramebuffer(this._glName);
var e=b.createFramebuffer(),h=this._desc;b.bindFramebuffer(b.FRAMEBUFFER,e);if(!this._colorAttachment)if(0===h.colorTarget)this._colorAttachment=new g(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:h.width,height:h.height});else{var d=new k(this._context,{internalFormat:32854,width:h.width,height:h.height});b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,d.glName);this._colorAttachment=d}this._colorAttachment instanceof g&&
b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this._colorAttachment.glName,0);switch(h.depthStencilTarget){case 1:case 3:this._depthAttachment||(this._depthAttachment=new k(this._context,{internalFormat:1===h.depthStencilTarget?33189:34041,width:h.width,height:h.height}));b.framebufferRenderbuffer(b.FRAMEBUFFER,1===h.depthStencilTarget?b.DEPTH_ATTACHMENT:b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=
new k(this._context,{internalFormat:36168,width:h.width,height:h.height}));b.framebufferRenderbuffer(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:this._depthStencilTexture||(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new g(this._context,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,
wrapMode:33071,width:h.width,height:h.height})),b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,this._depthStencilTexture.glName,0)}b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=e;return this._initialized=!0};b.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof g){var b=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var e=this._context.gl;
e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}b.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(b=this._colorAttachment,e=this._context.gl,this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(b));this._colorAttachment=null};b.prototype._disposeDepthStencilAttachments=function(){var b=this._context.gl;this._depthAttachment&&(this._initialized&&
(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,1===this._desc.depthStencilTarget?b.DEPTH_ATTACHMENT:b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&
(this._context.bindFramebuffer(this),b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};b._validateBufferDimensions=function(b,e){console.assert(0<=b.width&&0<=b.height);void 0!==e.width&&0<=e.width&&void 0!==e.height&&0<=e.height?e.width===b.width&&e.height===b.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(e.width=b.width,e.height=b.height)};b._validateTextureDimensions=
function(b,e){console.assert(0<=b.width&&0<=b.height);3553!==b.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==e.width&&0<=e.width&&void 0!==e.height&&0<=e.height?e.width===b.width&&e.height===b.height||console.error("Color attachment texture must match the framebuffer's!"):(e.width=b.width,e.height=b.height)};b._nextId=0;return b}()})},"esri/views/webgl/Renderbuffer":function(){define(["require","exports","../../core/has"],function(n,b,m){return function(){function b(g,e){this._context=
g;this._desc=e;this._glName=null;this._id=-1;g=this._context.gl;m("esri-webgl-debug")&&this._context.instanceCounter.incrementCount(5);this._id=++b._nextId;this._glName=g.createRenderbuffer();this._context.bindRenderbuffer(this);g.renderbufferStorage(g.RENDERBUFFER,e.internalFormat,e.width,e.height)}Object.defineProperty(b.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});b.prototype.resize=function(b,e){var f=this._context.gl,g=this._desc;if(g.width!==b||g.height!==e)g.width=b,g.height=e,this._context.bindRenderbuffer(this),f.renderbufferStorage(f.RENDERBUFFER,g.internalFormat,g.width,g.height)};b.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null);m("esri-webgl-debug")&&this._context&&
this._context.instanceCounter.decrementCount(5);this._context=null};b._nextId=0;return b}()})},"esri/views/webgl/RenderingContext":function(){define("require exports ../../core/has ../../core/maybe ./enums ./InstanceCounter ./renderState ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(n,b,m,k,g,e,f,l,h){function d(a,b){switch(a){case 0:return 2*b;case 4:return b/3;case 5:return b-2;case 6:return b-2}return 0}return function(){function a(a,b){var c=this;this.gl=null;this._blendEnabled=
!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;
this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap={};this._numOfTriangles=this._numOfDrawCalls=
0;this.contextVersion=l.default(a)?"webgl2":"webgl";this.gl=a;a instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=h.loadCapabilities(a,b);a=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:a[0],y:a[1],width:a[2],height:a[3]};m("esri-webgl-debug")&&(this.instanceCounter=new e.InstanceCounter);this._stateTracker=new f.StateTracker({setBlending:function(a){a?(c.setBlendingEnabled(!0),c.setBlendEquationSeparate(a.opRgb,a.opAlpha),c.setBlendFunctionSeparate(a.srcRgb,
a.dstRgb,a.srcAlpha,a.dstAlpha),a=a.color,c.setBlendColor(a.r,a.g,a.b,a.a)):c.setBlendingEnabled(!1)},setCulling:function(a){a?(c.setFaceCullingEnabled(!0),c.setCullFace(a.face),c.setFrontFace(a.mode)):c.setFaceCullingEnabled(!1)},setPolygonOffset:function(a){a?(c.setPolygonOffsetFillEnabled(!0),c.setPolygonOffset(a.factor,a.units)):c.setPolygonOffsetFillEnabled(!1)},setDepthTest:function(a){a?(c.setDepthTestEnabled(!0),c.setDepthFunction(a.func)):c.setDepthTestEnabled(!1)},setStencilTest:function(a){if(a){c.setStencilTestEnabled(!0);
var b=a.function;c.setStencilFunction(b.func,b.ref,b.mask);a=a.operation;c.setStencilOp(a.fail,a.zFail,a.zPass)}else c.setStencilTestEnabled(!1)},setDepthWrite:function(a){a?(c.setDepthWriteEnabled(!0),c.setDepthRange(a.zNear,a.zFar)):c.setDepthWriteEnabled(!1)},setColorWrite:function(a){a?c.setColorMask(a.r,a.g,a.b,a.a):c.setColorMask(!1,!1,!1,!1)},setStencilWrite:function(a){a?c.setStencilWriteMask(a.mask):c.setStencilWriteMask(0)}});this.enforceState()}Object.defineProperty(a.prototype,"contextAttributes",
{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"parameters",{get:function(){if(!this._parameters){var a=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:a?this.gl.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY):
void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)}}return this._parameters},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};m("esri-webgl-debug")&&this.instanceCounter.printResourceCount();this.gl=null};a.prototype.setPipelineState=function(a){this._stateTracker.setPipeline(a)};a.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):
this.gl.disable(this.gl.BLEND),this._blendEnabled=a,this._stateTracker.invalidateBlending())};a.prototype.setBlendColor=function(a,b,d,e){if(a!==this._blendColorState.r||b!==this._blendColorState.g||d!==this._blendColorState.b||e!==this._blendColorState.a)this.gl.blendColor(a,b,d,e),this._blendColorState.r=a,this._blendColorState.g=b,this._blendColorState.b=d,this._blendColorState.a=e,this._stateTracker.invalidateBlending()};a.prototype.setBlendFunction=function(a,b){if(a!==this._blendFunctionState.srcRGB||
b!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,b),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=b,this._stateTracker.invalidateBlending()};a.prototype.setBlendFunctionSeparate=function(a,b,d,e){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==d||this._blendFunctionState.dstRGB!==b||this._blendFunctionState.dstAlpha!==e)this.gl.blendFuncSeparate(a,b,d,e),this._blendFunctionState.srcRGB=
a,this._blendFunctionState.srcAlpha=d,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=e,this._stateTracker.invalidateBlending()};a.prototype.setBlendEquation=function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=a,this._stateTracker.invalidateBlending())};a.prototype.setBlendEquationSeparate=function(a,b){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==b)this.gl.blendEquationSeparate(a,
b),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=b,this._stateTracker.invalidateBlending()};a.prototype.setColorMask=function(a,b,d,e){if(this._colorMaskState.r!==a||this._colorMaskState.g!==b||this._colorMaskState.b!==d||this._colorMaskState.a!==e)this.gl.colorMask(a,b,d,e),this._colorMaskState.r=a,this._colorMaskState.g=b,this._colorMaskState.b=d,this._colorMaskState.a=e,this._stateTracker.invalidateColorWrite()};a.prototype.setClearColor=function(a,b,d,e){if(this._clearColor.r!==
a||this._clearColor.g!==b||this._clearColor.b!==d||this._clearColor.a!==e)this.gl.clearColor(a,b,d,e),this._clearColor.r=a,this._clearColor.g=b,this._clearColor.b=d,this._clearColor.a=e};a.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a,this._stateTracker.invalidateCulling())};a.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==a&&
(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=a,this._stateTracker.invalidatePolygonOffset())};a.prototype.setPolygonOffset=function(a,b){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==b)this._polygonOffset[0]=a,this._polygonOffset[1]=b,this.gl.polygonOffset(a,b),this._stateTracker.invalidatePolygonOffset()};a.prototype.setCullFace=function(a){this._cullFace!==a&&(this.gl.cullFace(a),this._cullFace=a,this._stateTracker.invalidateCulling())};
a.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),this._frontFace=a,this._stateTracker.invalidateCulling())};a.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=a)};a.prototype.setScissorRect=function(a,b,d,e){if(this._scissorRect.x!==a||this._scissorRect.y!==b||this._scissorRect.width!==d||this._scissorRect.height!==e)this.gl.scissor(a,
b,d,e),this._scissorRect.x=a,this._scissorRect.y=b,this._scissorRect.width=d,this._scissorRect.height=e};a.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=a,this._stateTracker.invalidateDepthTest())};a.prototype.setClearDepth=function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};a.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),
this._depthFunction=a,this._stateTracker.invalidateDepthTest())};a.prototype.setDepthWriteEnabled=function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a,this._stateTracker.invalidateDepthWrite())};a.prototype.setDepthRange=function(a,b){if(this._depthRange.zNear!==a||this._depthRange.zFar!==b)this.gl.depthRange(a,b),this._depthRange.zNear=a,this._depthRange.zFar=b,this._stateTracker.invalidateDepthWrite()};a.prototype.setStencilTestEnabled=function(a){this._stencilTestEnabled!==
a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=a,this._stateTracker.invalidateStencilTest())};a.prototype.setClearStencil=function(a){a!==this._clearStencil&&(this.gl.clearStencil(a),this._clearStencil=a)};a.prototype.setStencilFunction=function(a,b,d){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==b||this._stencilFunction.mask!==d)this.gl.stencilFunc(a,b,d),this._stencilFunction.face=1032,this._stencilFunction.func=a,
this._stencilFunction.ref=b,this._stencilFunction.mask=d,this._stateTracker.invalidateStencilTest()};a.prototype.setStencilFunctionSeparate=function(a,b,d,e){if(this._stencilFunction.face!==a||this._stencilFunction.func!==b||this._stencilFunction.ref!==d||this._stencilFunction.mask!==e)this.gl.stencilFuncSeparate(a,b,d,e),this._stencilFunction.face=a,this._stencilFunction.func=b,this._stencilFunction.ref=d,this._stencilFunction.mask=e,this._stateTracker.invalidateStencilTest()};a.prototype.setStencilWriteMask=
function(a){this._stencilWriteMask!==a&&(this.gl.stencilMask(a),this._stencilWriteMask=a,this._stateTracker.invalidateStencilWrite())};a.prototype.setStencilOp=function(a,b,d){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==b||this._stencilOperation.zPass!==d)this.gl.stencilOp(a,b,d),this._stencilOperation.face=1032,this._stencilOperation.fail=a,this._stencilOperation.zFail=b,this._stencilOperation.zPass=d,this._stateTracker.invalidateStencilTest()};a.prototype.setStencilOpSeparate=
function(a,b,d,e){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==b||this._stencilOperation.zFail!==d||this._stencilOperation.zPass!==e)this.gl.stencilOpSeparate(a,b,d,e),this._stencilOperation.face=a,this._stencilOperation.face=a,this._stencilOperation.fail=b,this._stencilOperation.zFail=d,this._stencilOperation.zPass=e,this._stateTracker.invalidateStencilTest()};a.prototype.setActiveTexture=function(a){var b=this._activeTextureUnit;0<=a&&a!==this._activeTextureUnit&&(this.gl.activeTexture(g.BASE_TEXTURE_UNIT+
a),this._activeTextureUnit=a);return b};a.prototype.clear=function(a){a&&this.gl.clear(a)};a.prototype.clearSafe=function(a,b){void 0===b&&(b=255);a&&(a&16384&&this.setColorMask(!0,!0,!0,!0),a&256&&this.setDepthWriteEnabled(!0),a&1024&&this.setStencilWriteMask(b),this.gl.clear(a))};a.prototype.drawArrays=function(a,b,e){m("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=d(a,e));this.gl.drawArrays(a,b,e)};a.prototype.drawElements=function(a,b,e,f){m("esri-webgl-debug")&&(this._numOfDrawCalls++,
this._numOfTriangles+=d(a,b));5123===e?this.gl.drawElements(a,b,e,f):5125===e&&this.gl.drawElements(a,b,e,f)};a.prototype.logIno=function(){m("esri-webgl-debug")&&console.log("DrawCalls: "+this._numOfDrawCalls+", Triangles: "+this._numOfTriangles)};Object.defineProperty(a.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0});a.prototype.setViewport=function(a,b,d,e){var c=this._viewport;if(c.x!==a||c.y!==b||c.width!==d||c.height!==e)c.x=a,c.y=b,c.width=
d,c.height=e,this.gl.viewport(a,b,d,e)};a.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};a.prototype.bindProgram=function(a){a?this._activeShaderProgram!==a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),this._activeShaderProgram=null)};a.prototype.bindTexture=function(b,d){void 0===d&&(d=0);-1===a._MAX_TEXTURE_IMAGE_UNITS&&(a._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));
(d>=a._MAX_TEXTURE_IMAGE_UNITS||0>d)&&console.error("Input texture unit is out of range of available units!");var c=this._textureUnitMap[d];this.setActiveTexture(d);null==b||null==b.glName?(null!=c&&(this.gl.bindTexture(c.descriptor.target,null),c.setBoundToUnit(d,!1)),this._textureUnitMap[d]=null):c&&c.id===b.id?b.applyChanges():(c&&c.setBoundToUnit(d,!1),this.gl.bindTexture(b.descriptor.target,b.glName),b.setBoundToUnit(d,!0),b.applyChanges(),this._textureUnitMap[d]=b)};a.prototype.bindFramebuffer=
function(a){k.isNone(a)?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null):this._activeFramebuffer!==a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a)};a.prototype.bindBuffer=function(b){b&&(34962===b.bufferType?this._activeVertexBuffer=a._bindBuffer(this.gl,b,b.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=a._bindBuffer(this.gl,b,b.bufferType,this._activeIndexBuffer))};a.prototype.bindRenderbuffer=function(a){var b=
this.gl;a||(b.bindRenderbuffer(b.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==a&&(b.bindRenderbuffer(b.RENDERBUFFER,a.glName),this._activeRenderbuffer=a)};a.prototype.unbindBuffer=function(b){34962===b?this._activeVertexBuffer=a._bindBuffer(this.gl,null,b,this._activeVertexBuffer):this._activeIndexBuffer=a._bindBuffer(this.gl,null,b,this._activeIndexBuffer)};a.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===a.id||(a.bind(),
this._activeVertexArrayObject=a):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};a.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};a.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};a.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};a.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);
for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,
1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};a.prototype.enforceState=function(){var a=this.gl,b=this.capabilities.vao;b&&b.bindVertexArray(null);for(var d=0;d<this.parameters.maxVertexAttributes;d++)a.disableVertexAttribArray(d);
this._activeVertexBuffer?a.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):a.bindBuffer(34962,null);this._activeIndexBuffer?a.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):a.bindBuffer(34963,null);if(b&&this._activeVertexArrayObject){if(b=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(b)}a.bindFramebuffer(a.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:
null);a.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);a.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);a.bindRenderbuffer(a.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?a.enable(this.gl.BLEND):a.disable(this.gl.BLEND);a.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);a.blendFuncSeparate(this._blendFunctionState.srcRGB,
this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);a.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);a.clearDepth(this._clearDepth);a.clearStencil(this._clearStencil);a.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);a.cullFace(this._cullFace);a.depthFunc(this._depthFunction);a.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?
a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);a.depthMask(this._depthWriteEnabled);a.frontFace(this._frontFace);a.lineWidth(1);!0===this._polygonCullingEnabled?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE);a.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL);a.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?a.enable(a.SCISSOR_TEST):
a.disable(a.SCISSOR_TEST);a.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);a.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST);a.stencilMask(this._stencilWriteMask);for(b=0;b<this.parameters.maxTextureImageUnits;b++)a.activeTexture(g.BASE_TEXTURE_UNIT+b),a.bindTexture(3553,null),(d=this._textureUnitMap[b])&&
a.bindTexture(d.descriptor.target,d.glName);a.activeTexture(g.BASE_TEXTURE_UNIT+this._activeTextureUnit);a.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height);m("esri-webgl-debug")&&(this._numOfTriangles=this._numOfDrawCalls=0)};a._bindBuffer=function(a,b,d,e){if(!b)return a.bindBuffer(d,null),null;if(e===b)return e;a.bindBuffer(d,b.glName);return b};a._MAX_TEXTURE_IMAGE_UNITS=-1;return a}()})},"esri/views/webgl/InstanceCounter":function(){define(["require","exports"],
function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._current=new m;this._max=new m}b.prototype.incrementCount=function(b){switch(b){case 0:this._current.textures++;this._max.textures=Math.max(this._max.textures,this._current.textures);break;case 1:this._current.buffers++;this._max.buffers=Math.max(this._max.buffers,this._current.buffers);break;case 2:this._current.vaos++;this._max.vaos=Math.max(this._max.vaos,this._current.vaos);break;case 3:this._current.programs++;
this._max.programs=Math.max(this._max.programs,this._current.programs);break;case 4:this._current.frameBuffers++;this._max.frameBuffers=Math.max(this._max.frameBuffers,this._current.frameBuffers);break;case 5:this._current.renderBuffers++,this._max.renderBuffers=Math.max(this._max.renderBuffers,this._current.renderBuffers)}};b.prototype.decrementCount=function(b){switch(b){case 0:this._current.textures--;break;case 1:this._current.buffers--;break;case 2:this._current.vaos--;break;case 3:this._current.programs--;
break;case 4:this._current.frameBuffers--;break;case 5:this._current.renderBuffers--}};Object.defineProperty(b.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0});b.prototype.printResourceCount=function(){console.log("Live objects:");console.log("Textures: "+this._current.textures);console.log("Buffers: "+this._current.buffers);console.log("VAOs: "+this._current.vaos);console.log("Programs: "+this._current.programs);console.log("Framebuffers: "+this._current.frameBuffers);
console.log("Renderbuffers: "+this._current.renderBuffers)};return b}();b.InstanceCounter=n;var m=function(){return function(){this.renderBuffers=this.frameBuffers=this.programs=this.vaos=this.buffers=this.textures=0}}()})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.default=function(b){return window.WebGL2RenderingContext&&b instanceof window.WebGL2RenderingContext}})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./LoseContext ./VertexArrayObjects".split(" "),
function(n,b,m,k,g,e,f){function l(b,d,a,c,e){if(c&&g.default(b))return!0;if(d[a])return!1;for(d=0;d<e.length;d++)if(b.getExtension(e[d]))return!0;return!1}Object.defineProperty(b,"__esModule",{value:!0});b.loadCapabilities=function(b,d){var a=d&&d.disabledExtensions||{},c=d&&d.debugWebGLExtensions||{},h,p,t,u,r,x,n,v,z,y=null,A=null,B=null,C=null;return{get instancing(){h||(h=k.load(b));return h},get vao(){p||(p=f.load(b,a));return p},get compressedTextureS3TC(){if(!t)if(a.compressedTextureS3TC)t=
null;else{var c=b.getExtension("WEBGL_compressed_texture_s3tc");t=c?{COMPRESSED_RGB_S3TC_DXT1:c.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:c.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:c.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:c.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}return t},get textureFilterAnisotropic(){if(!u)if(a.textureFilterAnisotropic)u=null;else{var c=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||
b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");u=c?{MAX_TEXTURE_MAX_ANISOTROPY:c.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:c.TEXTURE_MAX_ANISOTROPY_EXT}:null}return u},get disjointTimerQuery(){r||(r=m.load(b,a));return r},get textureFloat(){if(!x)if(g.default(b))x={textureFloat:!0,textureFloatLinear:!a.textureFloatLinear&&!!b.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!a.textureHalfFloatLinear&&!!b.getExtension("OES_texture_half_float_linear"),
HALF_FLOAT:b.HALF_FLOAT};else if(b instanceof WebGLRenderingContext){var c=!a.textureHalfFloat&&b.getExtension("OES_texture_half_float");x={textureFloat:!a.textureFloat&&!!b.getExtension("OES_texture_float"),textureFloatLinear:!a.textureFloatLinear&&!!b.getExtension("OES_texture_float_linear"),textureHalfFloat:!!c,textureHalfFloatLinear:!a.textureHalfFloatLinear&&!!b.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:c?c.HALF_FLOAT_OES:void 0}}else x=null;return x},get colorBufferFloat(){if(!n)if(g.default(b)){var c=
!a.colorBufferFloat&&b.getExtension("EXT_color_buffer_half_float"),d=!a.colorBufferFloat&&b.getExtension("EXT_color_buffer_float");n=c||d?{textureFloat:!!d,textureHalfFloat:!!c,R16F:b.R16F,RG16F:b.RG16F,RGBA16F:b.RGBA16F,R32F:b.R32F,RG32F:b.RG32F,RGBA32F:b.RGBA32F,R11F_G11F_B10F:b.R11F_G11F_B10F,RGB16F:b.RGB16F}:null}else b instanceof WebGLRenderingContext?(c=!a.colorBufferFloat&&b.getExtension("EXT_color_buffer_half_float"),d=!a.colorBufferFloat&&b.getExtension("WEBGL_color_buffer_float"),n=c||d?
{textureFloat:!!d,textureHalfFloat:!!c,RGBA16F:c?c.RGBA16F_EXT:void 0,RGB16F:c?c.RGB16F_EXT:void 0,RGBA32F:d?d.RGBA32F_EXT:void 0}:null):n=null;return n},get blendMinMax(){if(!v)if(g.default(b))v={MIN:b.MIN,MAX:b.MAX};else if(a.blendMinMax)v=null;else{var c=b.getExtension("EXT_blend_minmax");v=c?{MIN:c.MIN_EXT,MAX:c.MAX_EXT}:null}return v},get depthTexture(){null===y&&(y=l(b,a,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return y},get standardDerivatives(){null===
A&&(A=l(b,a,"standardDerivatives",!0,["OES_standard_derivatives"]));return A},get shaderTextureLOD(){null===B&&(B=l(b,a,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));return B},get fragDepth(){null===C&&(C=l(b,a,"fragDepth",!0,["EXT_frag_depth"]));return C},get loseContext(){z||(z=e.load(b,c));return z}}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b,
g){if(g.disjointTimerQuery)return null;var e=b.getExtension("EXT_disjoint_timer_query")||b.getExtension("EXT_disjoint_timer_query_webgl2");return e?m.default(b)?{createQuery:function(){return b.createQuery()},resultAvailable:function(e){return b.getQueryParameter(e,b.QUERY_RESULT_AVAILABLE)},getResult:function(e){return b.getQueryParameter(e,b.QUERY_RESULT)},disjoint:function(){return b.getParameter(e.GPU_DISJOINT_EXT)},beginTimeElapsed:function(f){return b.beginQuery(e.TIME_ELAPSED_EXT,f)},endTimeElapsed:function(){return b.endQuery(e.TIME_ELAPSED_EXT)},
createTimestamp:function(b){return e.queryCounterEXT(b,e.TIMESTAMP_EXT)},timestampBits:function(){return b.getQuery(e.TIMESTAMP_EXT,e.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return e.createQueryEXT()},resultAvailable:function(b){return e.getQueryObjectEXT(b,e.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(b){return e.getQueryObjectEXT(b,e.QUERY_RESULT_EXT)},disjoint:function(){return b.getParameter(e.GPU_DISJOINT_EXT)},beginTimeElapsed:function(b){return e.beginQueryEXT(e.TIME_ELAPSED_EXT,
b)},endTimeElapsed:function(){return e.endQueryEXT(e.TIME_ELAPSED_EXT)},createTimestamp:function(b){return e.queryCounterEXT(b,e.TIMESTAMP_EXT)},timestampBits:function(){return e.getQueryEXT(e.TIMESTAMP_EXT,e.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require","exports","./isWebGL2Context"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b){return m.default(b)?{drawArraysInstanced:b.drawArraysInstanced.bind(b),
drawElementsInstanced:b.drawElementsInstanced.bind(b),vertexAttribDivisor:b.vertexAttribDivisor.bind(b)}:(b=b.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:b.drawArraysInstancedANGLE.bind(b),drawElementsInstanced:b.drawElementsInstancedANGLE.bind(b),vertexAttribDivisor:b.vertexAttribDivisorANGLE.bind(b)}:null}})},"esri/views/webgl/capabilities/LoseContext":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b,k){var g=
k.loseContext&&b.getExtension("WEBGL_lose_context");return g?{loseRenderingContext:function(){return g.loseContext()}}:null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require","exports","./isWebGL2Context"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b,g){return m.default(b)?{createVertexArray:b.createVertexArray.bind(b),deleteVertexArray:b.deleteVertexArray.bind(b),bindVertexArray:b.bindVertexArray.bind(b)}:g.vao?null:(b=b.getExtension("OES_vertex_array_object")||
b.getExtension("MOZ_OES_vertex_array_object")||b.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:b.createVertexArrayOES.bind(b),deleteVertexArray:b.deleteVertexArrayOES.bind(b),bindVertexArray:b.bindVertexArrayOES.bind(b)}:null}})},"esri/views/webgl/ShaderCompiler":function(){define(["require","exports"],function(n,b){return function(){function b(b){this.readFile=b}b.prototype.resolveIncludes=function(b){return this.resolve(b)};b.prototype.resolve=function(b,g){var e=this;void 0===
g&&(g=new Map);if(g.has(b))return g.get(b);var f=this.read(b);if(!f)throw Error("cannot find shader file "+b);for(var l=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm,h=l.exec(f),d=[];null!=h;)d.push({path:h[1],start:h.index,length:h[0].length}),h=l.exec(f);var a=0,c="";d.forEach(function(b){c+=f.slice(a,b.start);c+=g.has(b.path)?"":e.resolve(b.path,g);a=b.start+b.length});c+=f.slice(a);g.set(b,c);return c};b.prototype.read=function(b){return this.readFile(b)};return b}()})},"esri/views/webgl/ProgramCache":function(){define(["require",
"exports","./programUtils"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this._programCacheByTemplate=new Map;this._rctx=b}b.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(b){b.programs.forEach(function(b){b.dispose()})});this._programCacheByTemplate=null};b.prototype.getProgram=function(b,e){var f=this;this._programCacheByTemplate.has(b)||this.addProgramTemplate(b,function(e){return m.createProgram(f._rctx,b,e)});return this.getProgramTemplateInstance(b,
e)};b.prototype.addProgramTemplate=function(b,e){this._programCacheByTemplate.set(b,{constructor:e,programs:new Map})};b.prototype.getProgramTemplateInstance=function(b,e){if(b=this._programCacheByTemplate.get(b)){var f=e?JSON.stringify(e):"default";b.programs.has(f)||(e=b.constructor(e),b.programs.set(f,e));return b.programs.get(f)}return null};return b}();b.ProgramCache=n})},"esri/views/webgl/programUtils":function(){define(["require","exports","./Program"],function(n,b,m){Object.defineProperty(b,
"__esModule",{value:!0});b.glslifyDefineMap=function(b){var g="",e;for(e in b){var f=b[e];if("boolean"===typeof f)f&&(g+="#define "+e+"\n");else if("number"===typeof f)g+="#define "+e+" "+f.toFixed()+"\n";else if("object"===typeof f){var l=f.options,h=0,d;for(d in l)g+="#define "+l[d]+" "+(h++).toFixed()+"\n";g+="#define "+e+" "+l[f.value]+"\n"}}return g};b.createProgram=function(b,g,e,f){e=e||{};f=f||"";e="function"===typeof g.shaders?g.shaders(e):g.shaders;return new m(b,f+e.vertexShader,f+e.fragmentShader,
g.attributes)}})},"esri/views/3d/layers/support/edgeUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec4f64".split(" "),function(n,b,m,k,g,e,f,l){function h(a,b){if(e.isNone(a))return null;var h=e.isSome(a.color)?l.vec4f64.fromArray(k.toUnitRGBA(a.color)):l.vec4f64.fromValues(0,0,0,0),p=f.pt2px(a.size),r=f.pt2px(a.extensionLength);
switch(a.type){case "solid":return d(m({color:h,size:p,extensionLength:r},b));case "sketch":return m({},c,m({color:h,size:p,extensionLength:r},b),{type:"sketch"});default:g.neverReached(a)}}function d(b){return m({},a,b,{type:"solid"})}Object.defineProperty(b,"__esModule",{value:!0});b.createMaterial=function(a,b){return h(a&&a.enabled&&a.edges||null,b)};b.createMaterialFromEdges=h;b.createSolidEdgeMaterial=d;var a={color:l.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2},
c={color:l.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2}})},"esri/views/3d/support/buffer/math/vec3":function(){define(["require","exports","./common"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.transformMat4=function(b,g,e){if(b.count!==g.count)m.logger.error("source and destination buffers need to have the same number of elements");else{var f=b.count,l=e[0],h=e[1],d=e[2],a=e[4],c=e[5],k=e[6],p=e[8],t=e[9],u=e[10],r=e[12],x=e[13];e=
e[14];var n=b.typedBuffer;b=b.typedBufferStride;var v=g.typedBuffer;g=g.typedBufferStride;for(var z=0;z<f;z++){var y=z*b,A=z*g,B=v[A],C=v[A+1],A=v[A+2];n[y]=l*B+a*C+p*A+r;n[y+1]=h*B+c*C+t*A+x;n[y+2]=d*B+k*C+u*A+e}}};b.transformMat3=function(b,g,e){if(b.count!==g.count)m.logger.error("source and destination buffers need to have the same number of elements");else{var f=b.count,l=e[0],h=e[1],d=e[2],a=e[3],c=e[4],k=e[5],p=e[6],t=e[7];e=e[8];var u=b.typedBuffer;b=b.typedBufferStride;var r=g.typedBuffer;
g=g.typedBufferStride;for(var x=0;x<f;x++){var n=x*b,v=x*g,z=r[v],y=r[v+1],v=r[v+2];u[n]=l*z+a*y+p*v;u[n+1]=h*z+c*y+t*v;u[n+2]=d*z+k*y+e*v}}};b.scale=function(b,g,e){var f=Math.min(b.count,g.count),l=b.typedBuffer;b=b.typedBufferStride;var h=g.typedBuffer;g=g.typedBufferStride;for(var d=0;d<f;d++){var a=d*b,c=d*g;l[a]=e*h[c];l[a+1]=e*h[c+1];l[a+2]=e*h[c+2]}};b.shiftRight=function(b,g,e){var f=Math.min(b.count,g.count),l=b.typedBuffer;b=b.typedBufferStride;var h=g.typedBuffer;g=g.typedBufferStride;
for(var d=0;d<f;d++){var a=d*b,c=d*g;l[a]=h[c]>>e;l[a+1]=h[c+1]>>e;l[a+2]=h[c+2]>>e}}})},"esri/views/3d/support/buffer/math/common":function(){define(["require","exports","../../../../../core/Logger"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.logger=m.getLogger("esri.views.3d.support.buffer.math")})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/util/AlphaDiscard.glsl ../lib/GLMaterialTexture ../lib/intersectorUtils ../lib/Material ../lib/StencilUtils ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/DefaultMaterialTechnique ../shaders/RealisticTreeTechnique ../../../webgl/renderState ../../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z){var y=p.assert;n=function(b){function c(a,d){d=b.call(this,d)||this;d.supportsEdges=!0;d.techniqueConfig=new x.DefaultMaterialTechniqueConfiguration;d.params=u.copyParameters(a,B);d.vertexBufferLayout=c.getVertexBufferLayout(d.params);d.instanceBufferLayout=a.instanced?c.getInstanceBufferLayout(d.params):null;return d}m(c,b);c.prototype.isVisibleInPass=function(a){return 3===a?this.params.castShadows:!0};c.prototype.isVisible=function(){var a=this.params;
if(!b.prototype.isVisible.call(this)||0===a.layerOpacity)return!1;var c=a.instanced,d=a.vertexColors,e=a.symbolColors,c=!!c&&-1<c.indexOf("color"),f=a.vvColorEnabled,h="replace"===a.colorMixMode,g=0<a.opacity,a=a.externalColor&&0<a.externalColor[3];return d&&(c||f||e)?h?!0:g:d?h?a:g:c||f||e?h?!0:g:h?a:g};c.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)"instanced"===c&&y(a.instanced===b.instanced,"Can not change instanced attributes"),"textureId"===c&&y(b.textureId,"Can only change texture of material that already has a texture"),
"vertexColors"===c&&!0===a[c]&&a[c]!==b[c]&&y(b.vertexColors,"Can not enable vertex colors after DefaultMaterial creation"),b[c]=a[c];this.parametersChanged()};c.prototype.getParameters=function(){return this.params};c.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId;this.techniqueConfig.hasColorTexture=!!this.params.textureId;this.techniqueConfig.vertexTangents=this.params.vertexTangents;this.techniqueConfig.instanced=
!!this.params.instanced;this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled;this.techniqueConfig.alphaDiscardMode=
"opaque"===this.params.textureAlphaMode?1:"mask"===this.params.textureAlphaMode?2:"maskBlend"===this.params.textureAlphaMode?3:0;this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals?!0:!1;0===a&&(this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.params.treeRendering||(this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===
this.params.doubleSidedType?2:0),this.techniqueConfig.instancedColor=!!this.params.instanced&&-1<this.params.instanced.indexOf("color"),this.techniqueConfig.receiveShadows=this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=this.params.receiveSSAO,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=
!!this.params.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic);return this.techniqueConfig};c.prototype.intersect=function(b,c,d,f,h,g,l){if(null!==this.params.verticalOffset){var k=f.camera;e.vec3.set(L,
d[12],d[13],d[14]);d=null;switch(f.viewingMode){case "global":d=e.vec3.normalize(D,L);break;case "local":d=e.vec3.copy(D,H)}var m=0;if(null!==this.params.verticalOffset){var p=e.vec3.subtract(O,L,k.eye),r=e.vec3.length(p),p=e.vec3.scale(p,p,1/r),q=null;this.params.screenSizePerspective&&(q=e.vec3.dot(d,p));m+=u.verticalOffsetAtDistance(k,r,this.params.verticalOffset,q,this.params.screenSizePerspective)}e.vec3.scale(d,d,m);e.vec3.transformMat3(I,d,f.transform.inverseRotation);h=e.vec3.subtract(E,h,
I);g=e.vec3.subtract(G,g,I)}u.intersectTriangleGeometry(b,c,f,h,g,a.getVerticalOffsetObject3D(f.verticalOffset),l)};c.prototype.getGLMaterial=function(a){if(0===a.output||1===a.output||2===a.output||3===a.output||4===a.output)return new A(a)};c.prototype.createRenderer=function(a,b){return new r(a,b,this)};c.prototype.createBufferWriter=function(){return new C(this.vertexBufferLayout,this.instanceBufferLayout)};c.getVertexBufferLayout=function(a){var b=a.textureId||a.normalTextureId||a.metallicRoughnessTextureId||
a.emissiveTextureId||a.occlusionTextureId,c=l.newLayout().vec3f("position").vec3f("normal");a.vertexTangents&&c.vec4f("tangent");b&&c.vec2f("uv0");a.vertexColors&&c.vec4u8("color");a.symbolColors&&c.vec4u8("symbolColor");return c};c.getInstanceBufferLayout=function(a){var b=l.newLayout(),b=a.instancedDoublePrecision?b.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):b.mat4f("model").mat4f("modelNormal");a.instanced&&-1<a.instanced.indexOf("color")&&(b=b.vec4f("instanceColor"));
a.instanced&&-1<a.instanced.indexOf("featureAttribute")&&(b=b.vec4f("instanceFeatureAttribute"));return b};return c}(c.Material);var A=function(a){function b(b){var c=this,c=a.call(this,d.makeCtorParameters(b,b.material.getParameters()))||this;c.updateParameters();return c}m(b,a);b.prototype.updateParameters=function(){this.selectPipelines();this.selectSlot();var a=this.material.getParameters();this.updateTexture(a.textureId);this.technique=a.treeRendering?this.techniqueRep.acquireAndReleaseExisting(w.RealisticTreeTechnique,
this.material.getTechniqueConfig(this.output),this.technique):this.techniqueRep.acquireAndReleaseExisting(x.DefaultMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.selectSlot=function(){this.slot=this.material.getParameters().transparent?this.material.getParameters().writeDepth?5:8:3};b.prototype.selectPipelines=function(){var a=this.material.getParameters(),b=0===this.output?a.transparent&&v.separateBlendingParams(770,1,771,771):null,c=function(c){return z.makePipelineState({blending:b,
culling:F(a),depthTest:{func:513},depthWrite:a.writeDepth&&z.defaultDepthWriteParams,colorWrite:z.defaultColorWriteParams,stencilWrite:a.sceneHasOcludees?q.stencilWriteMaskOn:null,stencilTest:a.sceneHasOcludees?c?q.stencilToolMaskBaseParams:q.stencilBaseAllZerosParams:null})};this.pipelineState=c(!1);this.occludeePipelineState=c(!0)};b.prototype._updateShadowState=function(a){a.shadowMappingEnabled!==this.material.getParameters().shadowMappingEnabled&&(this.material.setParameterValues({shadowMappingEnabled:a.shadowMappingEnabled}),
this.updateParameters())};b.prototype._updateOccludeeState=function(a){a.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};b.prototype.ensureParameters=function(a){0===this.output&&(this._updateShadowState(a),this._updateOccludeeState(a))};b.prototype.bind=function(a,b){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getParameters(),b);this.bindTexture(a,this.technique.program)};
b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getPipelineState=function(a,b){return b?this.occludeePipelineState:this.pipelineState};return b}(d);(n||(n={})).COLOR_GAMMA=2.1;var B={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],
colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,
1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:g.mat3f64.create(),transparent:!1,writeDepth:!0,textureAlphaMode:"blend",textureAlphaCutoff:h.defaultMaskAlphaCutoff,textureAlphaPremultiplied:!1,sceneHasOcludees:!1},C=function(){function a(a,b){this.vertexBufferLayout=a;this.instanceBufferLayout=b}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};
a.prototype.elementCount=function(a){return a.indices.position.length};a.prototype.write=function(a,b,c,d){t.writeDefaultAttributes(b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,c,d)};return a}(),F=function(a){var b;b=a.cullFace?0!==a.cullFace:a.slicePlaneEnabled?!1:!a.transparent&&!a.doubleSided;return b&&{face:1===a.cullFace?1028:1029,mode:2305}},E=f.vec3f64.create(),G=f.vec3f64.create(),H=f.vec3f64.fromValues(0,0,1),D=f.vec3f64.create(),I=f.vec3f64.create(),L=f.vec3f64.create(),
O=f.vec3f64.create();return n})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/libs/gl-matrix-2/vec3f64 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../materials/internal/MaterialUtil ./DefaultMaterial.glsl ../../../webgl/Program".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y){Object.defineProperty(b,"__esModule",{value:!0});r=function(b){function k(){return null!==b&&b.apply(this,arguments)||this}m(k,b);k.prototype.initializeProgram=function(a){var b=k.shader.get(),c=this.configuration,b=b.build({output:c.output,viewingMode:a.viewingMode,receiveShadows:c.receiveShadows,slicePlaneEnabled:c.slicePlaneEnabled,sliceHighlightDisabled:c.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:c.symbolColors,vvSize:c.vvSize,
vvColor:c.vvColor,vvInstancingEnabled:!0,instanced:c.instanced,instancedColor:c.instancedColor,instancedDoublePrecision:c.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:c.usePBR?c.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:c.hasMetalnessAndRoughnessTexture,hasEmissionTexture:c.hasEmissionTexture,hasOcclusionTexture:c.hasOcclusionTexture,hasNormalTexture:c.hasNormalTexture,hasColorTexture:c.hasColorTexture,receiveAmbientOcclusion:c.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,
normalType:c.normalsTypeDerivate?3:0,doubleSidedMode:c.doubleSidedMode,vertexTangets:c.vertexTangents,attributeTextureCoordinates:c.hasMetalnessAndRoughnessTexture||c.hasEmissionTexture||c.hasOcclusionTexture||c.hasNormalTexture||c.hasColorTexture?1:0,textureAlphaPremultiplied:c.textureAlphaPremultiplied,attributeColor:c.vertexColors,screenSizePerspectiveEnabled:c.screenSizePerspective,verticalOffsetEnabled:c.verticalOffset,offsetBackfaces:c.offsetBackfaces,doublePrecisionRequiresObfuscation:t.doublePrecisionRequiresObfuscation(a.rctx),
alphaDiscardMode:c.alphaDiscardMode,supportsTextureAtlas:!1});return new y(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),w.Default3D)};k.prototype.bindPass=function(b,c,e){var f=this.configuration.output;0===f?(this.program.setUniform3fv("ambient",c.ambient),this.program.setUniform3fv("diffuse",c.diffuse),this.program.setUniform4fv("externalColor",c.externalColor),this.program.setUniform1i("colorMixMode",v.colorMixModes[c.colorMixMode]),this.program.setUniform1f("opacity",c.opacity),
this.program.setUniform1f("layerOpacity",c.layerOpacity),this.configuration.usePBR&&a.PhysicallyBasedRenderingParameters.bindUniforms(this.program,c,this.configuration.isSchematic)):1===f||3===f?this.program.setUniform2fv("nearFar",e.nearFar):4===f&&d.OutputHighlight.bindOutputHighlight(b,this.program,e);q.VisualVariables.bindUniformsForSymbols(this.program,c);h.VerticalOffset.bindUniforms(this.program,c,e);v.bindScreenSizePerspective(c.screenSizePerspective,this.program);"mask"!==c.textureAlphaMode&&
"maskBlend"!==c.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",c.textureAlphaCutoff)};k.prototype.bindDraw=function(a){var b=this.configuration.instancedDoublePrecision?g.vec3f64.fromValues(a.viewInvTransp[3],a.viewInvTransp[7],a.viewInvTransp[11]):a.origin;f.Transform.bindUniformsCustomOrigin(this.program,b,a.view);(0===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||
4===this.configuration.output&&this.configuration.screenSizePerspective)&&p.Camera.bindUniformsCustomOrigin(this.program,b,a.viewInvTransp);2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",a.viewInvTransp);this.configuration.instancedDoublePrecision&&l.InstancedDoublePrecision.bindCustomOrigin(this.program,b);e.Slice.bindUniforms(this.program,this.configuration,a.slicePlane,b);0===this.configuration.output&&c.ReadShadowMap.bindViewCustomOrigin(this.program,a,b)};k.prototype.bindInstance=
function(a){this.program.setUniformMatrix4fv("model",a.transformation);this.program.setUniformMatrix4fv("modelNormal",a.transformationNormal)};k.prototype.initializePipeline=function(){return null};k.shader=new u.ReloadableShaderModule(z,"./DefaultMaterial.glsl",n);return k}(r.ShaderTechnique);b.DefaultMaterialTechnique=r;r=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.alphaDiscardMode=1;b.doubleSidedMode=0;b.isSchematic=!1;b.vertexColors=!1;b.offsetBackfaces=
!1;b.symbolColors=!1;b.vvSize=!1;b.vvColor=!1;b.verticalOffset=!1;b.receiveShadows=!1;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.receiveAmbientOcclusion=!1;b.screenSizePerspective=!1;b.textureAlphaPremultiplied=!1;b.hasColorTexture=!1;b.usePBR=!1;b.hasMetalnessAndRoughnessTexture=!1;b.hasEmissionTexture=!1;b.hasOcclusionTexture=!1;b.hasNormalTexture=!1;b.instanced=!1;b.instancedColor=!1;b.instancedDoublePrecision=!1;b.vertexTangents=!1;b.normalsTypeDerivate=!1;return b}m(b,a);k([x.parameter({count:7})],
b.prototype,"output",void 0);k([x.parameter({count:4})],b.prototype,"alphaDiscardMode",void 0);k([x.parameter({count:3})],b.prototype,"doubleSidedMode",void 0);k([x.parameter()],b.prototype,"isSchematic",void 0);k([x.parameter()],b.prototype,"vertexColors",void 0);k([x.parameter()],b.prototype,"offsetBackfaces",void 0);k([x.parameter()],b.prototype,"symbolColors",void 0);k([x.parameter()],b.prototype,"vvSize",void 0);k([x.parameter()],b.prototype,"vvColor",void 0);k([x.parameter()],b.prototype,"verticalOffset",
void 0);k([x.parameter()],b.prototype,"receiveShadows",void 0);k([x.parameter()],b.prototype,"slicePlaneEnabled",void 0);k([x.parameter()],b.prototype,"sliceHighlightDisabled",void 0);k([x.parameter()],b.prototype,"receiveAmbientOcclusion",void 0);k([x.parameter()],b.prototype,"screenSizePerspective",void 0);k([x.parameter()],b.prototype,"textureAlphaPremultiplied",void 0);k([x.parameter()],b.prototype,"hasColorTexture",void 0);k([x.parameter()],b.prototype,"usePBR",void 0);k([x.parameter()],b.prototype,
"hasMetalnessAndRoughnessTexture",void 0);k([x.parameter()],b.prototype,"hasEmissionTexture",void 0);k([x.parameter()],b.prototype,"hasOcclusionTexture",void 0);k([x.parameter()],b.prototype,"hasNormalTexture",void 0);k([x.parameter()],b.prototype,"instanced",void 0);k([x.parameter()],b.prototype,"instancedColor",void 0);k([x.parameter()],b.prototype,"instancedDoublePrecision",void 0);k([x.parameter()],b.prototype,"vertexTangents",void 0);k([x.parameter()],b.prototype,"normalsTypeDerivate",void 0);
return b}(x.ShaderTechniqueConfiguration);b.DefaultMaterialTechniqueConfiguration=r})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../../../../core/libs/gl-matrix-2/vec3f64 ../util/DoublePrecision.glsl ../../shaderModules/interfaces ../../../lib/doublePrecisionUtils".split(" "),function(n,b,m,k,g,e,f){function l(b,d){d.instanced&&d.instancedDoublePrecision?
(b.attributes.add("modelOriginHi","vec3"),b.attributes.add("modelOriginLo","vec3"),b.attributes.add("model","mat3"),b.attributes.add("modelNormal","mat3")):(b.vertex.uniforms.add("model","mat4"),b.vertex.uniforms.add("modelNormal","mat4"));d.instancedDoublePrecision&&(b.include(g.DoublePrecision,d),b.vertex.uniforms.add("viewOriginHi","vec3"),b.vertex.uniforms.add("viewOriginLo","vec3"));var f=[e.glsl(a||(a=m(["\n    vec3 calculateVPos() {\n      ","\n    }\n    "],["\n    vec3 calculateVPos() {\n      ",
"\n    }\n    "])),d.instancedDoublePrecision?"return model * localPosition().xyz;":"return (model * localPosition()).xyz;"),e.glsl(q||(q=m(["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "],["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "])),d.instancedDoublePrecision?e.glsl(c||(c=m(["\n          vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"],["\n          vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"]))):
"return vpos;"),e.glsl(p||(p=m(["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "],["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "])),d.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize((modelNormal * _normal).xyz);"),e.glsl(t||(t=m(["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "],["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "])),d.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":
"return normalize((viewNormal * modelNormal * _normal).xyz);")];b.vertex.code.add(f[0]);b.vertex.code.add(f[1]);b.vertex.code.add(f[2]);2===d.output&&b.vertex.code.add(f[3])}Object.defineProperty(b,"__esModule",{value:!0});b.InstancedDoublePrecision=l;(function(a){var b=function(){return function(){}}();a.Uniforms=b;a.bindCustomOrigin=function(a,b){f.encodeDoubleArraySplit(b,h,d,3);a.setUniform3fv("viewOriginHi",h);a.setUniform3fv("viewOriginLo",d)}})(l=b.InstancedDoublePrecision||(b.InstancedDoublePrecision=
{}));var h=k.vec3f64.create(),d=k.vec3f64.create(),a,c,q,p,t})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../../../../core/has ../../shaderModules/interfaces ../../../lib/WebGLDriverTest".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});b.DoublePrecision=function(b,d){d.doublePrecisionRequiresObfuscation?b.vertex.code.add(g.glsl(f||(f=
m(["\n      vec3 dpPlusFrc(vec3 a, vec3 b) {\n        return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n      }\n\n      vec3 dpMinusFrc(vec3 a, vec3 b) {\n        return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n      }\n\n      // based on https://www.thasler.com/blog/blog/glsl-part2-emu\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d dpPlusFrc(hiA, hiB);\n        vec3 e \x3d dpMinusFrc(t1, hiA);\n        vec3 t2 \x3d dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n        return t1 + t2;\n      }\n    "],
["\n      vec3 dpPlusFrc(vec3 a, vec3 b) {\n        return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n      }\n\n      vec3 dpMinusFrc(vec3 a, vec3 b) {\n        return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n      }\n\n      // based on https://www.thasler.com/blog/blog/glsl-part2-emu\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d dpPlusFrc(hiA, hiB);\n        vec3 e \x3d dpMinusFrc(t1, hiA);\n        vec3 t2 \x3d dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n        return t1 + t2;\n      }\n    "])))):
b.vertex.code.add(g.glsl(l||(l=m(["\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d hiA + hiB;\n        vec3 e \x3d t1 - hiA;\n        vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n        return t1 + t2;\n      }\n    "],["\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d hiA + hiB;\n        vec3 e \x3d t1 - hiA;\n        vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n        return t1 + t2;\n      }\n    "]))))};
b.doublePrecisionRequiresObfuscation=function(b){return k("force-double-precision-obfuscation")?!0:e.testWebGLDriver(b).doublePrecisionRequiresObfuscation};var f,l})},"esri/views/3d/webgl-engine/lib/WebGLDriverTest":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3f64 ../../../webgl ./doublePrecisionUtils ./Util".split(" "),function(n,b,m,k,g,e,f){function l(a,b){var c=new g.FramebufferObject(a,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,
pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),d=g.BufferObject.createVertex(a,35044,new Uint16Array([0,0,1,0,0,1,1,1])),h=new g.VertexArrayObject(a,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:d}),l=k.vec3f64.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),m=k.vec3f64.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387);a.bindFramebuffer(c);b=new g.Program(a,"\n\n  precision highp float;\n\n  attribute vec2 a_pos;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  "+
(b?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":"")+"\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 \x3d dpPlusFrc(hiA, hiB);\n    vec3 e \x3d dpMinusFrc(t1, hiA);\n    vec3 t2 \x3d dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 \x3d hiA + hiB;\n    vec3 e \x3d t1 - hiA;\n    vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT \x3d\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat \x3d 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val \x3d dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color \x3d float2rgba(val.z / 25.0);\n\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ",
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",{a_pos:0});var n=new Float32Array(6);e.encodeDoubleArray(l,n,3);var w=new Float32Array(6);e.encodeDoubleArray(m,w,3);a.bindProgram(b);b.setUniform3f("u_highA",n[0],n[2],n[4]);b.setUniform3f("u_lowA",n[1],n[3],n[5]);b.setUniform3f("u_highB",w[0],w[2],w[4]);b.setUniform3f("u_lowB",w[1],w[3],w[5]);var v=a.getViewport(),n=v.x,w=v.y,z=v.width,v=v.height;a.setViewport(0,0,1,1);a.bindVAO(h);
a.drawArrays(5,0,4);a.setViewport(n,w,z,v);a=new Uint8Array(4);c.readPixels(0,0,1,1,6408,5121,a);b.dispose();h.dispose(!1);d.dispose();c.dispose();c=(l[2]-m[2])/25;d=f.unpackFloatRGBA(a);return Math.abs(c-d)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a){this.context=a;this._doublePrecisionRequiresObfuscation=null}Object.defineProperty(a.prototype,"doublePrecisionRequiresObfuscation",{get:function(){if(m.isNone(this._doublePrecisionRequiresObfuscation)){var a=l(this.context,
!1),b=l(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==a&&(0===b||5<a/b)}return this._doublePrecisionRequiresObfuscation},enumerable:!0,configurable:!0});return a}(),d=null;b.testWebGLDriver=function(a){if(m.isNone(d)||d.context!==a)d=new h(a);return d}})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../../../../core/libs/gl-matrix-2/vec3f32 ../attributes/VertexTextureCoordinates.glsl ../../shaderModules/interfaces".split(" "),
function(n,b,m,k,g,e){function f(b,f){var k=b.fragment,r=f.hasMetalnessAndRoughnessTexture||f.hasEmissionTexture||f.hasOcclusionTexture;1===f.pbrMode&&r&&b.include(g.VertexTextureCoordinates,f);2===f.pbrMode?k.code.add(e.glsl(l||(l=m(["\n      const vec3 mrr \x3d vec3(0.0, 0.6, 0.2);\n      const vec3 emission \x3d vec3(0.0);\n      float occlusion \x3d 1.0;\n\n      void applyPBRFactors() {}\n\n      float getBakedOcclusion() { return 1.0; }\n    "],["\n      const vec3 mrr \x3d vec3(0.0, 0.6, 0.2);\n      const vec3 emission \x3d vec3(0.0);\n      float occlusion \x3d 1.0;\n\n      void applyPBRFactors() {}\n\n      float getBakedOcclusion() { return 1.0; }\n    "])))):
(0===f.pbrMode&&k.code.add(e.glsl(h||(h=m(["\n      float getBakedOcclusion() { return 1.0; }\n  "],["\n      float getBakedOcclusion() { return 1.0; }\n  "])))),1===f.pbrMode&&(k.uniforms.add("emissionFactor","vec3"),k.uniforms.add("mrrFactors","vec3"),k.code.add(e.glsl(d||(d=m(["\n      vec3 mrr;\n      vec3 emission;\n      float occlusion;\n    "],["\n      vec3 mrr;\n      vec3 emission;\n      float occlusion;\n    "])))),f.hasMetalnessAndRoughnessTexture&&(k.uniforms.add("texMetallicRoughness",
"sampler2D"),f.supportsTextureAtlas&&k.uniforms.add("texMetallicRoughnessSize","vec2"),k.code.add(e.glsl(a||(a=m(["\n      void applyMetallnessAndRoughness(TextureLookupParameter params) {\n        vec3 metallicRoughness \x3d textureLookup(texMetallicRoughness, params).rgb;\n\n        mrr[0] *\x3d metallicRoughness.b;\n        mrr[1] *\x3d metallicRoughness.g;\n      }"],["\n      void applyMetallnessAndRoughness(TextureLookupParameter params) {\n        vec3 metallicRoughness \x3d textureLookup(texMetallicRoughness, params).rgb;\n\n        mrr[0] *\x3d metallicRoughness.b;\n        mrr[1] *\x3d metallicRoughness.g;\n      }"]))))),
f.hasEmissionTexture&&(k.uniforms.add("texEmission","sampler2D"),f.supportsTextureAtlas&&k.uniforms.add("texEmissionSize","vec2"),k.code.add(e.glsl(c||(c=m(["\n      void applyEmission(TextureLookupParameter params) {\n        emission *\x3d textureLookup(texEmission, params).rgb;\n      }"],["\n      void applyEmission(TextureLookupParameter params) {\n        emission *\x3d textureLookup(texEmission, params).rgb;\n      }"]))))),f.hasOcclusionTexture?(k.uniforms.add("texOcclusion","sampler2D"),
f.supportsTextureAtlas&&k.uniforms.add("texOcclusionSize","vec2"),k.code.add(e.glsl(q||(q=m(["\n      void applyOcclusion(TextureLookupParameter params) {\n        occlusion *\x3d textureLookup(texOcclusion, params).r;\n      }\n\n      float getBakedOcclusion() {\n        return occlusion;\n      }\n      "],["\n      void applyOcclusion(TextureLookupParameter params) {\n        occlusion *\x3d textureLookup(texOcclusion, params).r;\n      }\n\n      float getBakedOcclusion() {\n        return occlusion;\n      }\n      "]))))):
k.code.add(e.glsl(p||(p=m(["\n      float getBakedOcclusion() { return 1.0; }\n      "],["\n      float getBakedOcclusion() { return 1.0; }\n      "])))),k.code.add(e.glsl(t||(t=m(["\n    void applyPBRFactors() {\n      mrr \x3d mrrFactors;\n      emission \x3d emissionFactor;\n      occlusion \x3d 1.0;\n      ","\n      ","\n      ","\n      ","\n    }\n  "],["\n    void applyPBRFactors() {\n      mrr \x3d mrrFactors;\n      emission \x3d emissionFactor;\n      occlusion \x3d 1.0;\n      ","\n      ",
"\n      ","\n      ","\n    }\n  "])),r?"vtc.uv \x3d vuv0;":"",f.hasMetalnessAndRoughnessTexture?f.supportsTextureAtlas?"vtc.size \x3d texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":"",f.hasEmissionTexture?f.supportsTextureAtlas?"vtc.size \x3d texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":"",f.hasOcclusionTexture?f.supportsTextureAtlas?"vtc.size \x3d texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""))))}Object.defineProperty(b,
"__esModule",{value:!0});b.PBRSchematicMRRValues=k.vec3f32.fromValues(0,.6,.2);b.PhysicallyBasedRenderingParameters=f;(function(a){a.bindUniforms=function(a,b,c){void 0===c&&(c=!1);c||(a.setUniform3fv("mrrFactors",b.mrrFactors),a.setUniform3fv("emissionFactor",b.emissiveFactor))}})(f=b.PhysicallyBasedRenderingParameters||(b.PhysicallyBasedRenderingParameters={}));var l,h,d,a,c,q,p,t})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ./TextureCoordinateAttribute.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces".split(" "),
function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});b.VertexTextureCoordinates=function(b,a){b.include(k.TextureCoordinateAttribute,a);b.fragment.code.add(e.glsl(f||(f=m(["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "],["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "])),a.supportsTextureAtlas?"vec2 size;":""));1===a.attributeTextureCoordinates&&b.fragment.code.add(e.glsl(l||(l=m(["\n      vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return texture2D(tex, params.uv);\n      }\n    "],
["\n      vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return texture2D(tex, params.uv);\n      }\n    "]))));2===a.attributeTextureCoordinates&&(b.include(g.TextureAtlasLookup),b.fragment.code.add(e.glsl(h||(h=m(["\n    vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n      }\n    "],["\n    vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n      }\n    "])))))};
var f,l,h})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.TextureCoordinateAttribute=function(b,h){1===h.attributeTextureCoordinates&&(b.attributes.add("uv0","vec2"),b.varyings.add("vuv0","vec2"),b.vertex.code.add(k.glsl(g||(g=m(["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n      }\n    "],
["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n      }\n    "])))));2===h.attributeTextureCoordinates&&(b.attributes.add("uv0","vec2"),b.varyings.add("vuv0","vec2"),b.attributes.add("uvRegion","vec4"),b.varyings.add("vuvRegion","vec4"),b.vertex.code.add(k.glsl(e||(e=m(["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n        vuvRegion \x3d uvRegion;\n      }\n    "],["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n        vuvRegion \x3d uvRegion;\n      }\n    "])))));
0===h.attributeTextureCoordinates&&b.vertex.code.add(k.glsl(f||(f=m(["\n      void forwardTextureCoordinates() {}\n    "],["\n      void forwardTextureCoordinates() {}\n    "]))))};var g,e,f})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.TextureAtlasLookup=function(b){b.extensions.add("GL_EXT_shader_texture_lod");
b.extensions.add("GL_OES_standard_derivatives");b.fragment.code.add(k.glsl(g||(g=m(["\n    #ifndef GL_EXT_shader_texture_lod\n      float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n        float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\n        return max(0.0, 0.5 * log2(deltaMaxSqr));\n      }\n    #endif\n\n    vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\n      //[umin, vmin, umax, vmax]\n      vec2 atlasScale \x3d atlasRegion.zw - atlasRegion.xy;\n      vec2 uvAtlas \x3d fract(textureCoordinates) * atlasScale + atlasRegion.xy;\n\n      // calculate derivative of continuous texture coordinate\n      // to avoid mipmapping artifacts caused by manual wrapping in shader\n      vec2 dUVdx \x3d dFdx(textureCoordinates) * atlasScale;\n      vec2 dUVdy \x3d dFdy(textureCoordinates) * atlasScale;\n\n      #ifdef GL_EXT_shader_texture_lod\n        return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n      #else\n        // use bias to compensate for difference in automatic vs desired mipmap level\n        vec2 dUVdxAuto \x3d dFdx(uvAtlas);\n        vec2 dUVdyAuto \x3d dFdy(uvAtlas);\n        float mipMapLevel \x3d calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\n        float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\n\n        return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n      #endif\n    }\n  "],
["\n    #ifndef GL_EXT_shader_texture_lod\n      float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n        float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\n        return max(0.0, 0.5 * log2(deltaMaxSqr));\n      }\n    #endif\n\n    vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\n      //[umin, vmin, umax, vmax]\n      vec2 atlasScale \x3d atlasRegion.zw - atlasRegion.xy;\n      vec2 uvAtlas \x3d fract(textureCoordinates) * atlasScale + atlasRegion.xy;\n\n      // calculate derivative of continuous texture coordinate\n      // to avoid mipmapping artifacts caused by manual wrapping in shader\n      vec2 dUVdx \x3d dFdx(textureCoordinates) * atlasScale;\n      vec2 dUVdy \x3d dFdy(textureCoordinates) * atlasScale;\n\n      #ifdef GL_EXT_shader_texture_lod\n        return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n      #else\n        // use bias to compensate for difference in automatic vs desired mipmap level\n        vec2 dUVdxAuto \x3d dFdx(uvAtlas);\n        vec2 dUVdyAuto \x3d dFdy(uvAtlas);\n        float mipMapLevel \x3d calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\n        float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\n\n        return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n      #endif\n    }\n  "]))))};
var g})},"esri/views/3d/webgl-engine/shaders/DefaultMaterial.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/ForwardLinearDepth.glsl ../core/shaderLibrary/Offset.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/PositionAttribute.glsl ../core/shaderLibrary/attributes/SymbolColor.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VertexColor.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../core/shaderLibrary/shading/ComputeNormalTexture.glsl ../core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/AlphaDiscard.glsl ../core/shaderLibrary/util/MixExternalColor.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var n=new G.ShaderBuilder,U=n.vertex.code,R=n.fragment.code;n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");n.include(d.PositionAttribute);n.varyings.add("vpos","vec3");n.include(B.VisualVariables,b);n.include(l.InstancedDoublePrecision,b);n.include(t.VerticalOffset,b);0===b.output&&(n.include(h.NormalAttribute,
b),n.include(f.Transform,{linearDepth:!1}),0===b.normalType&&b.offsetBackfaces&&n.include(g.Offset),n.include(r.ComputeNormalTexture,b),n.include(p.VertexNormal,b),b.instancedColor&&n.attributes.add("instanceColor","vec4"),n.varyings.add("localvpos","vec3"),n.include(c.TextureCoordinateAttribute,b),n.include(k.ForwardLinearDepth,b),n.include(a.SymbolColor,b),n.include(q.VertexColor,b),n.vertex.uniforms.add("externalColor","vec4"),n.varyings.add("vcolorExt","vec4"),U.add(E.glsl(D||(D=m(["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt \x3d externalColor;\n        ",
"\n        vcolorExt *\x3d vvColor();\n        vcolorExt *\x3d getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a \x3c ",") {\n          gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos \x3d calculateVPos();\n          localvpos \x3d vpos - view[3].xyz;\n          vpos \x3d subtractOrigin(vpos);\n          ","\n          vpos \x3d addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          ",
"\n        }\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "],["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt \x3d externalColor;\n        ","\n        vcolorExt *\x3d vvColor();\n        vcolorExt *\x3d getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a \x3c ",") {\n          gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos \x3d calculateVPos();\n          localvpos \x3d vpos - view[3].xyz;\n          vpos \x3d subtractOrigin(vpos);\n          ",
"\n          vpos \x3d addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          ","\n        }\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "])),b.instancedColor?"vcolorExt *\x3d instanceColor;":"",E.glsl.float(C.symbolAlphaCutoff),0===b.normalType?E.glsl(H||(H=m(["\n          vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));"],["\n          vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));"]))):
"",b.vertexTangets?"transformVertexTangent(mat3(modelNormal));":"",0===b.normalType&&b.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"")),n.include(e.Slice,b),n.include(w.EvaluateSceneLighting,b),n.include(x.EvaluateAmbientOcclusion,b),n.include(C.DiscardOrAdjustAlpha,b),b.receiveShadows&&n.include(A.ReadShadowMap,b),n.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity",
"float").add("layerOpacity","float"),b.hasColorTexture&&n.fragment.uniforms.add("tex","sampler2D"),n.include(y.PhysicallyBasedRenderingParameters,b),n.include(z.PhysicallyBasedRendering,b),n.include(F.MixExternalColor,{stages:1}),n.include(v.Normals,b),R.add(E.glsl(J||(J=m(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        ","\n        ","\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ",
"\n        vec3 matColor \x3d max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        ","\n        ","\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ",
"\n        vec3 matColor \x3d max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "])),b.hasColorTexture?E.glsl(I||(I=m(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),b.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":
""):E.glsl(L||(L=m(["vec4 texColor \x3d vec4(1.0);"],["vec4 texColor \x3d vec4(1.0);"]))),3===b.normalType?E.glsl(O||(O=m(["\n        vec3 normal \x3d screenDerivativeNormal(localvpos);"],["\n        vec3 normal \x3d screenDerivativeNormal(localvpos);"]))):E.glsl(K||(K=m(["\n        shadingParams.normalView \x3d vNormalWorld;\n        vec3 normal \x3d shadingNormal(shadingParams);"],["\n        shadingParams.normalView \x3d vNormalWorld;\n        vec3 normal \x3d shadingNormal(shadingParams);"]))),
1===b.pbrMode?"applyPBRFactors();":"",b.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":0===b.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;",b.attributeColor?E.glsl(N||(N=m(["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"],
["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):E.glsl(Q||(Q=m(["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "],
["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),b.hasNormalTexture?E.glsl(M||(M=m(["\n              mat3 tangentSpace \x3d ","\n              vec3 shadedNormal \x3d computeTextureNormal(tangentSpace, vuv0);"],["\n              mat3 tangentSpace \x3d ","\n              vec3 shadedNormal \x3d computeTextureNormal(tangentSpace, vuv0);"])),
b.vertexTangets?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"):"vec3 shadedNormal \x3d normal;",1===b.pbrMode||2===b.pbrMode?0===b.viewingMode?E.glsl(T||(T=m(["vec3 normalGround \x3d normalize(vpos + localOrigin);"],["vec3 normalGround \x3d normalize(vpos + localOrigin);"]))):E.glsl(P||(P=m(["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"],["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"]))):E.glsl(S||(S=m([""],[""]))),1===b.pbrMode||2===b.pbrMode?E.glsl(V||(V=m(["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"],
["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);")));n.include(u.DefaultMaterialAuxiliaryPasses,b);return n};var H,
D,I,L,O,K,N,Q,M,T,P,S,V,J})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["require","exports","../../../../../core/tsSupport/makeTemplateObjectHelper","../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.Offset=function(b){b.vertex.code.add(k.glsl(g||(g=m(["\n    vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\n      vec3 camToVert \x3d posWorld - camPosWorld;\n\n      bool isBackface \x3d dot(camToVert, normalWorld) \x3e 0.0;\n      if (isBackface) {\n        posClip.z +\x3d 0.0000003 * posClip.w;\n      }\n      return posClip;\n    }\n  "],
["\n    vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\n      vec3 camToVert \x3d posWorld - camPosWorld;\n\n      bool isBackface \x3d dot(camToVert, normalWorld) \x3e 0.0;\n      if (isBackface) {\n        posClip.z +\x3d 0.0000003 * posClip.w;\n      }\n      return posClip;\n    }\n  "]))))};var g})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper",
"../util/DecodeNormal.glsl","../../shaderModules/interfaces"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.NormalAttribute=function(b,d){0===d.normalType&&(b.attributes.add("normal","vec3"),b.vertex.code.add(g.glsl(e||(e=m(["\n      vec3 normalModel() {\n        return normal;\n      }\n    "],["\n      vec3 normalModel() {\n        return normal;\n      }\n    "])))));1===d.normalType&&(b.include(k.DecodeNormal),b.attributes.add("normalCompressed","vec2"),b.vertex.code.add(g.glsl(f||
(f=m(["\n      vec3 normalModel() {\n        return decodeNormal(normalCompressed);\n      }\n    "],["\n      vec3 normalModel() {\n        return decodeNormal(normalCompressed);\n      }\n    "])))));3===d.normalType&&(b.extensions.add("GL_OES_standard_derivatives"),b.fragment.code.add(g.glsl(l||(l=m(["\n      vec3 screenDerivativeNormal(vec3 positionView) {\n        return normalize(cross(dFdx(positionView), dFdy(positionView)));\n      }\n    "],["\n      vec3 screenDerivativeNormal(vec3 positionView) {\n        return normalize(cross(dFdx(positionView), dFdy(positionView)));\n      }\n    "])))))};
var e,f,l})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.DecodeNormal=function(b){var e=k.glsl(g||(g=m(["\n    vec3 decodeNormal(vec2 f) {\n      float z \x3d 1.0 - abs(f.x) - abs(f.y);\n      return vec3(f + sign(f) * min(z, 0.0), z);\n    }\n  "],["\n    vec3 decodeNormal(vec2 f) {\n      float z \x3d 1.0 - abs(f.x) - abs(f.y);\n      return vec3(f + sign(f) * min(z, 0.0), z);\n    }\n  "])));
b.fragment.code.add(e);b.vertex.code.add(e)};var g})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.PositionAttribute=function(b){b.attributes.add("position","vec3");b.vertex.code.add(k.glsl(g||(g=m(["\n    vec3 positionModel() { return position; }\n  "],["\n    vec3 positionModel() { return position; }\n  "]))))};
var g})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../../collections/Component/Material/shader/DecodeSymbolColor.glsl","../../shaderModules/interfaces"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.SymbolColor=function(b,h){h.symbolColor?(b.include(k.DecodeSymbolColor),b.attributes.add("symbolColor","vec4"),b.varyings.add("colorMixMode",
"mediump float")):b.fragment.uniforms.add("colorMixMode","int");h.symbolColor?b.vertex.code.add(g.glsl(e||(e=m(["\n    int symbolColorMixMode;\n\n    vec4 getSymbolColor() {\n      return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n    }\n\n    void forwardColorMixMode() {\n      colorMixMode \x3d float(symbolColorMixMode) + 0.5;\n    }\n  "],["\n    int symbolColorMixMode;\n\n    vec4 getSymbolColor() {\n      return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n    }\n\n    void forwardColorMixMode() {\n      colorMixMode \x3d float(symbolColorMixMode) + 0.5;\n    }\n  "])))):
b.vertex.code.add(g.glsl(f||(f=m(["\n    vec4 getSymbolColor() { return vec4(1.0); }\n    void forwardColorMixMode() {}\n    "],["\n    vec4 getSymbolColor() { return vec4(1.0); }\n    void forwardColorMixMode() {}\n    "]))))};var e,f})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["require","exports","../../../../../../../core/tsSupport/makeTemplateObjectHelper","../../../../core/shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,
"__esModule",{value:!0});b.DecodeSymbolColor=function(b){b.vertex.code.add(k.glsl(g||(g=m(["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha \x3d 0.0;\n\n      const float maxTint \x3d 85.0;\n      const float maxReplace \x3d 170.0;\n      const float scaleAlpha \x3d 3.0;\n\n      if (symbolColor.a \x3e maxReplace) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a \x3e maxTint) {\n        colorMixMode \x3d ",
";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a \x3e 0.0) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "],["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha \x3d 0.0;\n\n      const float maxTint \x3d 85.0;\n      const float maxReplace \x3d 170.0;\n      const float scaleAlpha \x3d 3.0;\n\n      if (symbolColor.a \x3e maxReplace) {\n        colorMixMode \x3d ",
";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a \x3e maxTint) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a \x3e 0.0) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "])),
k.glsl.int(1),k.glsl.int(3),k.glsl.int(4),k.glsl.int(1)))};var g})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.VertexColor=function(b,h){h.attributeColor?(b.attributes.add("color","vec4"),b.varyings.add("vColor","vec4"),b.vertex.code.add(k.glsl(g||(g=m(["\n      void forwardVertexColor() { vColor \x3d color; }\n    "],
["\n      void forwardVertexColor() { vColor \x3d color; }\n    "])))),b.vertex.code.add(k.glsl(e||(e=m(["\n      void forwardNormalizedVertexColor() { vColor \x3d color * 0.003921568627451; }\n    "],["\n      void forwardNormalizedVertexColor() { vColor \x3d color * 0.003921568627451; }\n    "]))))):b.vertex.code.add(k.glsl(f||(f=m(["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "],["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "]))))};
var g,e,f})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ./NormalAttribute.glsl ./VertexPosition.glsl ../../shaderModules/interfaces".split(" "),function(n,b,m,k,g,e){function f(b,f){0===f.normalType||1===f.normalType?(b.include(k.NormalAttribute,f),b.varyings.add("vNormalWorld","vec3"),b.varyings.add("vNormalView","vec3"),b.vertex.uniforms.add("uTransformNormal_GlobalFromModel",
"mat3"),b.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),b.vertex.code.add(e.glsl(l||(l=m(["\n      void forwardNormal() {\n        vNormalWorld \x3d uTransformNormal_GlobalFromModel * normalModel();\n        vNormalView \x3d uTransformNormal_ViewFromGlobal * vNormalWorld;\n      }\n    "],["\n      void forwardNormal() {\n        vNormalWorld \x3d uTransformNormal_GlobalFromModel * normalModel();\n        vNormalView \x3d uTransformNormal_ViewFromGlobal * vNormalWorld;\n      }\n    "]))))):
2===f.normalType?(b.include(g.VertexPosition,f),b.varyings.add("vNormalWorld","vec3"),b.vertex.code.add(e.glsl(a||(a=m(["\n    void forwardNormal() {\n      vNormalWorld \x3d ","\n    }\n    "],["\n    void forwardNormal() {\n      vNormalWorld \x3d ","\n    }\n    "])),0===f.viewingMode?e.glsl(h||(h=m(["normalize(vPositionWorldCameraRelative);"],["normalize(vPositionWorldCameraRelative);"]))):e.glsl(d||(d=m(["vec3(0.0, 0.0, 1.0);"],["vec3(0.0, 0.0, 1.0);"])))))):b.vertex.code.add(e.glsl(c||(c=m(["\n      void forwardNormal() {}\n    "],
["\n      void forwardNormal() {}\n    "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.VertexNormal=f;(function(a){a.bindUniforms=function(a,b){a.setUniformMatrix4fv("viewNormal",b.viewInvTransp)}})(f=b.VertexNormal||(b.VertexNormal={}));var l,h,d,a,c})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../../core/libs/gl-matrix-2/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/interfaces".split(" "),
function(n,b,m,k,g,e,f,l,h){function d(b,d){b.include(f.PositionAttribute);b.include(l.DoublePrecision,d);b.varyings.add("vPositionWorldCameraRelative","vec3");b.varyings.add("vPosition_view","vec3");b.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3");b.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3");b.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3");b.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3");b.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3");
b.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3");b.vertex.uniforms.add("uTransform_ProjFromView","mat4");b.vertex.code.add(h.glsl(a||(a=m(["\n    // compute position in world space orientation, but relative to the camera position\n    vec3 positionWorldCameraRelative() {\n      vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * positionModel();\n\n      vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n        uTransform_WorldFromModel_TL,\n        uTransform_WorldFromModel_TH,\n        -uTransform_WorldFromView_TL,\n        -uTransform_WorldFromView_TH\n      );\n\n      return transform_CameraRelativeFromModel + rotatedModelPosition;\n    }\n\n    // position in view space, that is relative to the camera position and orientation\n    vec3 position_view() {\n      return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n    }\n\n    // compute gl_Position and forward related varyings to fragment shader\n    void forwardPosition() {\n      vPositionWorldCameraRelative \x3d positionWorldCameraRelative();\n      vPosition_view \x3d position_view();\n      gl_Position \x3d uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n    }\n\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "],
["\n    // compute position in world space orientation, but relative to the camera position\n    vec3 positionWorldCameraRelative() {\n      vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * positionModel();\n\n      vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n        uTransform_WorldFromModel_TL,\n        uTransform_WorldFromModel_TH,\n        -uTransform_WorldFromView_TL,\n        -uTransform_WorldFromView_TH\n      );\n\n      return transform_CameraRelativeFromModel + rotatedModelPosition;\n    }\n\n    // position in view space, that is relative to the camera position and orientation\n    vec3 position_view() {\n      return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n    }\n\n    // compute gl_Position and forward related varyings to fragment shader\n    void forwardPosition() {\n      vPositionWorldCameraRelative \x3d positionWorldCameraRelative();\n      vPosition_view \x3d position_view();\n      gl_Position \x3d uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n    }\n\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "]))));
b.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3");b.fragment.code.add(h.glsl(c||(c=m(["\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "],["\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.VertexPosition=d;(function(a){var b=function(){return function(){this.worldFromModel_RS=k.mat3f64.create();this.worldFromModel_TH=
e.vec3f64.create();this.worldFromModel_TL=e.vec3f64.create()}}();a.ModelTransform=b;b=function(){return function(){this.worldFromView_TH=e.vec3f64.create();this.worldFromView_TL=e.vec3f64.create();this.viewFromCameraRelative_RS=k.mat3f64.create();this.projFromView=g.mat4f64.create()}}();a.ViewProjectionTransform=b;a.bindModelTransform=function(a,b){a.setUniformMatrix3fv("uTransform_WorldFromModel_RS",b.worldFromModel_RS);a.setUniform3fv("uTransform_WorldFromModel_TH",b.worldFromModel_TH);a.setUniform3fv("uTransform_WorldFromModel_TL",
b.worldFromModel_TL)};a.bindViewProjTransform=function(a,b){a.setUniform3fv("uTransform_WorldFromView_TH",b.worldFromView_TH);a.setUniform3fv("uTransform_WorldFromView_TL",b.worldFromView_TL);a.setUniformMatrix4fv("uTransform_ProjFromView",b.projFromView);a.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",b.viewFromCameraRelative_RS)}})(d=b.VertexPosition||(b.VertexPosition={}));var a,c})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../../shaderModules/interfaces".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){Object.defineProperty(b,"__esModule",{value:!0});b.DefaultMaterialAuxiliaryPasses=function(b,n){var F=b.vertex.code,E=b.fragment.code;if(1===n.output||3===n.output)b.include(g.Transform,{linearDepth:!0}),b.include(f.TextureCoordinateAttribute,n),b.include(a.VisualVariables,n),b.include(h.OutputDepth,n),b.include(k.Slice,n),b.vertex.uniforms.add("nearFar","vec2"),b.varyings.add("depth","float"),n.hasColorTexture&&b.fragment.uniforms.add("tex","sampler2D"),F.add(q.glsl(p||
(p=m(["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        forwardTextureCoordinates();\n      }\n    "],["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        forwardTextureCoordinates();\n      }\n    "])))),
b.include(c.DiscardOrAdjustAlpha,n),E.add(q.glsl(u||(u=m(["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "],["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "])),n.hasColorTexture?q.glsl(t||(t=m(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):
""));2===n.output&&(b.include(g.Transform,{linearDepth:!1}),b.include(e.NormalAttribute,n),b.include(l.VertexNormal,n),b.include(f.TextureCoordinateAttribute,n),b.include(a.VisualVariables,n),n.hasColorTexture&&b.fragment.uniforms.add("tex","sampler2D"),b.vertex.uniforms.add("viewNormal","mat4"),b.varyings.add("vPositionView","vec3"),F.add(q.glsl(x||(x=m(["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        ","\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "],
["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        ","\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])),0===n.normalType?q.glsl(r||(r=m(["\n        vNormalWorld \x3d dpNormalView(vvLocalNormal(normalModel()));"],["\n        vNormalWorld \x3d dpNormalView(vvLocalNormal(normalModel()));"]))):"")),b.include(k.Slice,
n),b.include(c.DiscardOrAdjustAlpha,n),E.add(q.glsl(y||(y=m(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "])),n.hasColorTexture?q.glsl(w||(w=m(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"],
["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"",3===n.normalType?q.glsl(v||(v=m(["\n            vec3 normal \x3d screenDerivativeNormal(vPositionView);"],["\n            vec3 normal \x3d screenDerivativeNormal(vPositionView);"]))):q.glsl(z||(z=m(["\n            vec3 normal \x3d normalize(vNormalWorld);\n            if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;"],["\n            vec3 normal \x3d normalize(vNormalWorld);\n            if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;"]))))));
4===n.output&&(b.include(g.Transform,{linearDepth:!1}),b.include(f.TextureCoordinateAttribute,n),b.include(a.VisualVariables,n),n.hasColorTexture&&b.fragment.uniforms.add("tex","sampler2D"),F.add(q.glsl(A||(A=m(["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "],["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])))),
b.include(k.Slice,n),b.include(c.DiscardOrAdjustAlpha,n),b.include(d.OutputHighlight),E.add(q.glsl(C||(C=m(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "])),n.hasColorTexture?q.glsl(B||(B=m(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):
"")))};var p,t,u,r,x,w,v,z,y,A,B,C})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.OutputDepth=function(b,h){b.include(k.RgbaFloatEncoding);3===h.output?(b.extensions.add("GL_OES_standard_derivatives"),b.fragment.code.add(g.glsl(e||(e=m(["\n      float _calculateFragDepth(const in float depth) {\n        // calc polygon offset\n        const float SLOPE_SCALE \x3d 2.0;\n        const float BIAS \x3d 2.0 * .000015259;    // 1 / (2^16 - 1)\n        float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\n        float result \x3d depth + SLOPE_SCALE * m + BIAS;\n        return clamp(result, .0, .999999);\n      }\n\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_calculateFragDepth(_linearDepth));\n      }\n    "],
["\n      float _calculateFragDepth(const in float depth) {\n        // calc polygon offset\n        const float SLOPE_SCALE \x3d 2.0;\n        const float BIAS \x3d 2.0 * .000015259;    // 1 / (2^16 - 1)\n        float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\n        float result \x3d depth + SLOPE_SCALE * m + BIAS;\n        return clamp(result, .0, .999999);\n      }\n\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_calculateFragDepth(_linearDepth));\n      }\n    "]))))):
1===h.output&&b.fragment.code.add(g.glsl(f||(f=m(["\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_linearDepth);\n      }\n    "],["\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_linearDepth);\n      }\n    "]))))};var e,f})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../attributes/VertexTextureCoordinates.glsl",
"../../shaderModules/interfaces"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.ComputeNormalTexture=function(a,b){var c=a.fragment;c.uniforms.add("normalTexture","sampler2D");c.uniforms.add("normalTextureSize","vec2");b.vertexTangets?(a.attributes.add("tangent","vec4"),a.varyings.add("vTangent","vec4"),a.vertex.code.add(g.glsl(e||(e=m(["\n      void transformVertexTangent(mat3 modelTransformForNormals) {\n        vTangent.xyz \x3d modelTransformForNormals * tangent.xyz;\n        vTangent.w \x3d tangent.w;\n      }\n    "],
["\n      void transformVertexTangent(mat3 modelTransformForNormals) {\n        vTangent.xyz \x3d modelTransformForNormals * tangent.xyz;\n        vTangent.w \x3d tangent.w;\n      }\n    "])))),2===b.doubleSidedMode?c.code.add(g.glsl(f||(f=m(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent \x3d normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "],
["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent \x3d normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "])))):c.code.add(g.glsl(l||(l=m(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d vTangent.w;\n        vec3 tangent \x3d normalize(vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "],
["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d vTangent.w;\n        vec3 tangent \x3d normalize(vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "]))))):(a.extensions.add("GL_OES_standard_derivatives"),c.code.add(g.glsl(h||(h=m(['\n    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\n\n      vec3 Q1 \x3d dFdx(pos);\n      vec3 Q2 \x3d dFdy(pos);\n\n      vec2 stx \x3d dFdx(st);\n      vec2 sty \x3d dFdy(st);\n\n      float det \x3d stx.t * sty.s - sty.t * stx.s;\n\n      vec3 T \x3d stx.t * Q2 - sty.t * Q1; // compute tangent\n      T \x3d T - normal * dot(normal, T); // orthogonalize tangent\n      T *\x3d inversesqrt(max(dot(T,T), 1.e-10)); // "soft" normalize - goes to 0 when T goes to 0\n      vec3 B \x3d sign(det) * cross(normal, T); // assume normal is normalized, B has the same lenght as B\n      return mat3(T, B, normal); // T and B go to 0 when the tangent space is not well defined by the uv coordinates\n    }\n  '],
['\n    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\n\n      vec3 Q1 \x3d dFdx(pos);\n      vec3 Q2 \x3d dFdy(pos);\n\n      vec2 stx \x3d dFdx(st);\n      vec2 sty \x3d dFdy(st);\n\n      float det \x3d stx.t * sty.s - sty.t * stx.s;\n\n      vec3 T \x3d stx.t * Q2 - sty.t * Q1; // compute tangent\n      T \x3d T - normal * dot(normal, T); // orthogonalize tangent\n      T *\x3d inversesqrt(max(dot(T,T), 1.e-10)); // "soft" normalize - goes to 0 when T goes to 0\n      vec3 B \x3d sign(det) * cross(normal, T); // assume normal is normalized, B has the same lenght as B\n      return mat3(T, B, normal); // T and B go to 0 when the tangent space is not well defined by the uv coordinates\n    }\n  '])))));
0!==b.attributeTextureCoordinates&&(a.include(k.VertexTextureCoordinates,b),c.code.add(g.glsl(d||(d=m(["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv \x3d uv;\n      ","\n      vec3 rawNormal \x3d textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "],["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv \x3d uv;\n      ","\n      vec3 rawNormal \x3d textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "])),
b.supportsTextureAtlas?"vtc.size \x3d normalTextureSize;":"")))};var e,f,l,h,d})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.EvaluateAmbientOcclusion=function(b,l){b=b.fragment;l.receiveAmbientOcclusion?(b.uniforms.add("ssaoTex","sampler2D"),b.uniforms.add("viewportPixelSz",
"vec4"),b.code.add(k.glsl(g||(g=m(["\n      float evaluateAmbientOcclusion() {\n        return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n      }\n\n      float evaluateAmbientOcclusionInverse() {\n        float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        return viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\n      }\n    "],["\n      float evaluateAmbientOcclusion() {\n        return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n      }\n\n      float evaluateAmbientOcclusionInverse() {\n        float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        return viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\n      }\n    "]))))):
b.code.add(k.glsl(e||(e=m(["\n      float evaluateAmbientOcclusion() { return 0.0; } // no occlusion\n      float evaluateAmbientOcclusionInverse() { return 1.0; }\n    "],["\n      float evaluateAmbientOcclusion() { return 0.0; } // no occlusion\n      float evaluateAmbientOcclusionInverse() { return 1.0; }\n    "]))))};var g,e})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./EvaluateMainLighting.glsl ./PhysicallyBasedRendering.glsl ./PiUtils.glsl ./ReadShadowMap.glsl ../../shaderModules/interfaces".split(" "),
function(n,b,m,k,g,e,f,l,h,d){Object.defineProperty(b,"__esModule",{value:!0});b.EvaluateSceneLighting=function(b,n){var B=b.fragment;b.include(e.EvaluateMainLighting);b.include(g.EvaluateAmbientOcclusion,n);0!==n.pbrMode&&b.include(f.PhysicallyBasedRendering,n);b.include(k.EvaluateAmbientLighting,n);n.receiveShadows&&b.include(h.ReadShadowMap,n);B.uniforms.add("lightingGlobalFactor","float");B.uniforms.add("ambientBoostFactor","float");b.include(l.PiUtils);B.code.add(d.glsl(a||(a=m(["\n    const float GAMMA_SRGB \x3d 2.1;\n    const float INV_GAMMA_SRGB \x3d 0.4761904;\n    ",
"\n  "],["\n    const float GAMMA_SRGB \x3d 2.1;\n    const float INV_GAMMA_SRGB \x3d 0.4761904;\n    ","\n  "])),0===n.pbrMode?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"));if(n.useOldSceneLightInterface)B.code.add(d.glsl(c||(c=m(["\n    vec3 evaluateSceneLightingExt(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n      // evaluate the main light\n      #if defined(TREE_RENDERING)\n        // Special case for tree rendering:\n        // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\n        // facing away from the light. The idea is to get an effect where light is transmitted\n        // through the tree.\n        float minDot \x3d -0.5;\n        float dotRange \x3d 1.0 - minDot;\n        float dotNormalization \x3d 0.66; // guessed \x26 hand tweaked value, for an exact value we could precompute an integral over the sphere\n\n        float dotVal \x3d dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n      #else\n        float dotVal \x3d clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n      #endif\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\n      vec3 ambientLight \x3d calculateAmbientIrradiance(normal, ssao);\n\n      // inverse gamma correction on the albedo color\n      vec3 albedoGammaC \x3d pow(albedo, vec3(GAMMA_SRGB));\n\n      // physically correct BRDF normalizes by PI\n      vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\n      totalLight \x3d min(totalLight, vec3(PI));\n      vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\n\n      // apply gamma correction to the computed color\n      outColor \x3d pow(outColor, vec3(INV_GAMMA_SRGB));\n\n      return outColor;\n    }\n  "],
["\n    vec3 evaluateSceneLightingExt(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n      // evaluate the main light\n      #if defined(TREE_RENDERING)\n        // Special case for tree rendering:\n        // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\n        // facing away from the light. The idea is to get an effect where light is transmitted\n        // through the tree.\n        float minDot \x3d -0.5;\n        float dotRange \x3d 1.0 - minDot;\n        float dotNormalization \x3d 0.66; // guessed \x26 hand tweaked value, for an exact value we could precompute an integral over the sphere\n\n        float dotVal \x3d dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n      #else\n        float dotVal \x3d clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n      #endif\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\n      vec3 ambientLight \x3d calculateAmbientIrradiance(normal, ssao);\n\n      // inverse gamma correction on the albedo color\n      vec3 albedoGammaC \x3d pow(albedo, vec3(GAMMA_SRGB));\n\n      // physically correct BRDF normalizes by PI\n      vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\n      totalLight \x3d min(totalLight, vec3(PI));\n      vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\n\n      // apply gamma correction to the computed color\n      outColor \x3d pow(outColor, vec3(INV_GAMMA_SRGB));\n\n      return outColor;\n    }\n  "]))));
else if(0===n.viewingMode?B.code.add(d.glsl(q||(q=m(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        vec3 shadingNormalWorld \x3d normalize(vPosWorld);\n        float vndl \x3d -dot(shadingNormalWorld, lightingMainDirection);\n\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "],["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        vec3 shadingNormalWorld \x3d normalize(vPosWorld);\n        float vndl \x3d -dot(shadingNormalWorld, lightingMainDirection);\n\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "])))):
B.code.add(d.glsl(p||(p=m(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        float vndl \x3d -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "],["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        float vndl \x3d -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "])))),B.code.add(d.glsl(t||(t=m(["\n      vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vPosWorld);\n        return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n      }\n    "],
["\n      vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vPosWorld);\n        return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n      }\n    "])))),0===n.pbrMode||4===n.pbrMode)B.code.add(d.glsl(u||(u=m(["\n      vec3 evaluateSceneLighting(vec3 normalWorld, vec3 baseColor, float mainLightShadow, float ambientOcclusion, vec3 additionalLight)\n      {\n        vec3 mainLighting \x3d evaluateMainLighting(normalWorld, mainLightShadow);\n        vec3 ambientLighting \x3d calculateAmbientIrradiance(normalWorld, ambientOcclusion);\n        // inverse gamma correction on the base color\n        vec3 baseColorLinear \x3d pow(baseColor, vec3(GAMMA_SRGB));\n\n        // physically correct BRDF normalizes by PI\n        vec3 totalLight \x3d mainLighting + ambientLighting + additionalLight;\n        totalLight \x3d min(totalLight, vec3(PI));\n        vec3 outColor \x3d vec3((baseColorLinear / PI) * totalLight);\n\n        // apply gamma correction to the computed color\n        outColor \x3d pow(outColor, vec3(INV_GAMMA_SRGB));\n\n        return outColor;\n      }\n      "],
["\n      vec3 evaluateSceneLighting(vec3 normalWorld, vec3 baseColor, float mainLightShadow, float ambientOcclusion, vec3 additionalLight)\n      {\n        vec3 mainLighting \x3d evaluateMainLighting(normalWorld, mainLightShadow);\n        vec3 ambientLighting \x3d calculateAmbientIrradiance(normalWorld, ambientOcclusion);\n        // inverse gamma correction on the base color\n        vec3 baseColorLinear \x3d pow(baseColor, vec3(GAMMA_SRGB));\n\n        // physically correct BRDF normalizes by PI\n        vec3 totalLight \x3d mainLighting + ambientLighting + additionalLight;\n        totalLight \x3d min(totalLight, vec3(PI));\n        vec3 outColor \x3d vec3((baseColorLinear / PI) * totalLight);\n\n        // apply gamma correction to the computed color\n        outColor \x3d pow(outColor, vec3(INV_GAMMA_SRGB));\n\n        return outColor;\n      }\n      "]))));
else if(1===n.pbrMode||2===n.pbrMode)B.code.add(d.glsl(r||(r=m(["\n      const float fillLightIntensity \x3d 0.25;\n      const float horizonLightDiffusion \x3d 0.4;\n      const float additionalAmbientIrradianceFactor \x3d 0.02;\n\n      vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n      {\n        // Calculate half vector between view and light direction\n        vec3 viewDirection \x3d -viewDir;\n        vec3 mainLightDirection \x3d -lightingMainDirection;\n        vec3 h \x3d normalize(viewDirection + mainLightDirection);\n\n        PBRShadingInfo inputs;\n        inputs.NdotL \x3d clamp(dot(normal, mainLightDirection), 0.001, 1.0);\n        inputs.NdotV \x3d clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\n        inputs.NdotH \x3d clamp(dot(normal, h), 0.0, 1.0);\n        inputs.VdotH \x3d clamp(dot(viewDirection, h), 0.0, 1.0);\n        inputs.NdotNG \x3d clamp(dot(normal, normalGround), -1.0, 1.0);\n        vec3 reflectedView \x3d normalize(reflect(viewDirection, normal));\n        inputs.RdotNG \x3d clamp(dot(reflectedView, normalGround), -1.0, 1.0);\n\n        inputs.albedoLinear \x3d pow(albedo, vec3(GAMMA_SRGB));\n        inputs.ssao \x3d ssao;\n\n        inputs.metalness \x3d mrr[0];\n        inputs.roughness \x3d clamp(mrr[1] * mrr[1], 0.001, 0.99);\n      "],
["\n      const float fillLightIntensity \x3d 0.25;\n      const float horizonLightDiffusion \x3d 0.4;\n      const float additionalAmbientIrradianceFactor \x3d 0.02;\n\n      vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n      {\n        // Calculate half vector between view and light direction\n        vec3 viewDirection \x3d -viewDir;\n        vec3 mainLightDirection \x3d -lightingMainDirection;\n        vec3 h \x3d normalize(viewDirection + mainLightDirection);\n\n        PBRShadingInfo inputs;\n        inputs.NdotL \x3d clamp(dot(normal, mainLightDirection), 0.001, 1.0);\n        inputs.NdotV \x3d clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\n        inputs.NdotH \x3d clamp(dot(normal, h), 0.0, 1.0);\n        inputs.VdotH \x3d clamp(dot(viewDirection, h), 0.0, 1.0);\n        inputs.NdotNG \x3d clamp(dot(normal, normalGround), -1.0, 1.0);\n        vec3 reflectedView \x3d normalize(reflect(viewDirection, normal));\n        inputs.RdotNG \x3d clamp(dot(reflectedView, normalGround), -1.0, 1.0);\n\n        inputs.albedoLinear \x3d pow(albedo, vec3(GAMMA_SRGB));\n        inputs.ssao \x3d ssao;\n\n        inputs.metalness \x3d mrr[0];\n        inputs.roughness \x3d clamp(mrr[1] * mrr[1], 0.001, 0.99);\n      "])))),
B.code.add(d.glsl(x||(x=m(["\n        inputs.f0 \x3d (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\n        inputs.f90 \x3d vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0)); // more accurate then using  f90 \x3d 1.0\n        inputs.diffuseColor \x3d inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);\n      "],["\n        inputs.f0 \x3d (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\n        inputs.f90 \x3d vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0)); // more accurate then using  f90 \x3d 1.0\n        inputs.diffuseColor \x3d inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);\n      "])))),
B.code.add(d.glsl(w||(w=m(["\n        vec3 ambientDir \x3d vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\n        ambientDir \x3d ambientDir !\x3d vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\n\n        inputs.NdotAmbDir \x3d abs(dot(normal, ambientDir));\n\n        // Calculate the irradiance components: sun, fill lights and the sky.\n        vec3 mainLightIrradianceComponent  \x3d inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\n        vec3 fillLightsIrradianceComponent \x3d inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\n        // calculateAmbientIrradiance for localView and additionalLight for gloabalView\n        vec3 ambientLightIrradianceComponent \x3d calculateAmbientIrradiance(normal, ssao) + additionalLight;\n\n        // Assemble the overall irradiance of the sky that illuminates the surface\n        inputs.skyIrradianceToSurface    \x3d ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n        // Assemble the overall irradiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky irradiance by the groundReflectance\n        inputs.groundIrradianceToSurface \x3d GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      "],
["\n        vec3 ambientDir \x3d vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\n        ambientDir \x3d ambientDir !\x3d vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\n\n        inputs.NdotAmbDir \x3d abs(dot(normal, ambientDir));\n\n        // Calculate the irradiance components: sun, fill lights and the sky.\n        vec3 mainLightIrradianceComponent  \x3d inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\n        vec3 fillLightsIrradianceComponent \x3d inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\n        // calculateAmbientIrradiance for localView and additionalLight for gloabalView\n        vec3 ambientLightIrradianceComponent \x3d calculateAmbientIrradiance(normal, ssao) + additionalLight;\n\n        // Assemble the overall irradiance of the sky that illuminates the surface\n        inputs.skyIrradianceToSurface    \x3d ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n        // Assemble the overall irradiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky irradiance by the groundReflectance\n        inputs.groundIrradianceToSurface \x3d GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      "])))),
B.code.add(d.glsl(v||(v=m(["\n        vec3 horizonRingDir \x3d inputs.RdotNG * normalGround - reflectedView;\n        vec3 horizonRingH \x3d normalize(viewDirection + horizonRingDir);\n        inputs.NdotH_Horizon \x3d dot(normal, horizonRingH);\n\n        vec3 mainLightRadianceComponent  \x3d normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\n        vec3 horizonLightRadianceComponent \x3d normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n        vec3 ambientLightRadianceComponent \x3d calculateAmbientRadiance(ssao) + additionalLight; // calculateAmbientRadiance for localView and additionalLight for gloabalView\n\n        // Assemble the overall radiance of the sky that illuminates the surface\n        inputs.skyRadianceToSurface    \x3d  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n        // Assemble the overall radiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky radince by the groundReflectance\n        inputs.groundRadianceToSurface \x3d GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n\n        // Calculate average ambient radiance - this is used int the gamut mapping part to deduce the black level that is soft compressed\n        inputs.averageAmbientRadiance \x3d ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);\n        "],
["\n        vec3 horizonRingDir \x3d inputs.RdotNG * normalGround - reflectedView;\n        vec3 horizonRingH \x3d normalize(viewDirection + horizonRingDir);\n        inputs.NdotH_Horizon \x3d dot(normal, horizonRingH);\n\n        vec3 mainLightRadianceComponent  \x3d normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\n        vec3 horizonLightRadianceComponent \x3d normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n        vec3 ambientLightRadianceComponent \x3d calculateAmbientRadiance(ssao) + additionalLight; // calculateAmbientRadiance for localView and additionalLight for gloabalView\n\n        // Assemble the overall radiance of the sky that illuminates the surface\n        inputs.skyRadianceToSurface    \x3d  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n        // Assemble the overall radiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky radince by the groundReflectance\n        inputs.groundRadianceToSurface \x3d GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n\n        // Calculate average ambient radiance - this is used int the gamut mapping part to deduce the black level that is soft compressed\n        inputs.averageAmbientRadiance \x3d ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);\n        "])))),
B.code.add(d.glsl(A||(A=m(["\n        vec3 reflectedColorComponent \x3d evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent \x3d inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent \x3d pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear \x3d reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ","\n        return outColor;\n      }\n    "],["\n        vec3 reflectedColorComponent \x3d evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent \x3d inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent \x3d pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear \x3d reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ",
"\n        return outColor;\n      }\n    "])),2===n.pbrMode?d.glsl(z||(z=m(["vec3 outColor \x3d pow(outColorLinear - 0.005 * inputs.averageAmbientRadiance, vec3(INV_GAMMA_SRGB));"],["vec3 outColor \x3d pow(outColorLinear - 0.005 * inputs.averageAmbientRadiance, vec3(INV_GAMMA_SRGB));"]))):d.glsl(y||(y=m(["vec3 outColor \x3d pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"],["vec3 outColor \x3d pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"])))))};
var a,c,q,p,t,u,r,x,w,v,z,y,A})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.EvaluateAmbientLighting=function(b,d){b=b.fragment;var a=void 0!==d.lightingSphericalHarmonicsOrder?d.lightingSphericalHarmonicsOrder:2;0===a?(b.uniforms.add("lightingAmbientSH0","vec3"),
b.code.add(k.glsl(g||(g=m(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "],["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]))))):1===a?(b.uniforms.add("lightingAmbientSH_R",
"vec4"),b.uniforms.add("lightingAmbientSH_G","vec4"),b.uniforms.add("lightingAmbientSH_B","vec4"),b.code.add(k.glsl(e||(e=m(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec4 sh0 \x3d vec4(\n          0.282095,\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y\n        );\n        vec3 ambientLight \x3d vec3(\n          dot(lightingAmbientSH_R, sh0),\n          dot(lightingAmbientSH_G, sh0),\n          dot(lightingAmbientSH_B, sh0)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "],
["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec4 sh0 \x3d vec4(\n          0.282095,\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y\n        );\n        vec3 ambientLight \x3d vec3(\n          dot(lightingAmbientSH_R, sh0),\n          dot(lightingAmbientSH_G, sh0),\n          dot(lightingAmbientSH_B, sh0)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]))))):2===a&&(b.uniforms.add("lightingAmbientSH0",
"vec3"),b.uniforms.add("lightingAmbientSH_R1","vec4"),b.uniforms.add("lightingAmbientSH_G1","vec4"),b.uniforms.add("lightingAmbientSH_B1","vec4"),b.uniforms.add("lightingAmbientSH_R2","vec4"),b.uniforms.add("lightingAmbientSH_G2","vec4"),b.uniforms.add("lightingAmbientSH_B2","vec4"),b.code.add(k.glsl(f||(f=m(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n\n        vec4 sh1 \x3d vec4(\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y,\n          1.092548 * normal.x * normal.y\n        );\n        vec4 sh2 \x3d vec4(\n          1.092548 * normal.y * normal.z,\n          0.315392 * (3.0 * normal.z * normal.z - 1.0),\n          1.092548 * normal.x * normal.z,\n          0.546274 * (normal.x * normal.x - normal.y * normal.y)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R1, sh1),\n          dot(lightingAmbientSH_G1, sh1),\n          dot(lightingAmbientSH_B1, sh1)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R2, sh2),\n          dot(lightingAmbientSH_G2, sh2),\n          dot(lightingAmbientSH_B2, sh2)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "],
["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n\n        vec4 sh1 \x3d vec4(\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y,\n          1.092548 * normal.x * normal.y\n        );\n        vec4 sh2 \x3d vec4(\n          1.092548 * normal.y * normal.z,\n          0.315392 * (3.0 * normal.z * normal.z - 1.0),\n          1.092548 * normal.x * normal.z,\n          0.546274 * (normal.x * normal.x - normal.y * normal.y)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R1, sh1),\n          dot(lightingAmbientSH_G1, sh1),\n          dot(lightingAmbientSH_B1, sh1)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R2, sh2),\n          dot(lightingAmbientSH_G2, sh2),\n          dot(lightingAmbientSH_B2, sh2)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "])))),
1!==d.pbrMode&&2!==d.pbrMode||b.code.add(k.glsl(l||(l=m(["\n        const vec3 skyTransmittance \x3d vec3(0.9, 0.9, 1.0);\n\n        vec3 calculateAmbientRadiance(float ambientOcclusion)\n        {\n          vec3 ambientLight \x3d 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\n          return ambientLight *\x3d (1.0 - ambientOcclusion) * skyTransmittance;\n        }\n      "],["\n        const vec3 skyTransmittance \x3d vec3(0.9, 0.9, 1.0);\n\n        vec3 calculateAmbientRadiance(float ambientOcclusion)\n        {\n          vec3 ambientLight \x3d 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\n          return ambientLight *\x3d (1.0 - ambientOcclusion) * skyTransmittance;\n        }\n      "])))))};
var g,e,f,l})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.EvaluateMainLighting=function(b){b=b.fragment;b.uniforms.add("lightingMainDirection","vec3");b.uniforms.add("lightingMainIntensity","vec3");b.uniforms.add("lightingFixedFactor","float");b.code.add(k.glsl(g||
(g=m(["\n    vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\n      float dotVal \x3d clamp(-dot(normal_global, lightingMainDirection), 0.0, 1.0);\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      return lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n    }\n  "],["\n    vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\n      float dotVal \x3d clamp(-dot(normal_global, lightingMainDirection), 0.0, 1.0);\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      return lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n    }\n  "]))))};
var g})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.Normals=function(b,d){b=b.fragment;b.code.add(k.glsl(g||(g=m(["\n    struct ShadingNormalParameters {\n      vec3 normalView;\n      vec3 viewDirection;\n    } shadingParams;\n    "],["\n    struct ShadingNormalParameters {\n      vec3 normalView;\n      vec3 viewDirection;\n    } shadingParams;\n    "]))));
1===d.doubleSidedMode?b.code.add(k.glsl(e||(e=m(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return dot(params.normalView, params.viewDirection) \x3e 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n      }\n    "],["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return dot(params.normalView, params.viewDirection) \x3e 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n      }\n    "])))):2===d.doubleSidedMode?
b.code.add(k.glsl(f||(f=m(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n      }\n    "],["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n      }\n    "])))):b.code.add(k.glsl(l||(l=m(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return normalize(params.normalView);\n      }\n    "],
["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return normalize(params.normalView);\n      }\n    "]))))};var g,e,f,l})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","./ColorConversion.glsl","../../shaderModules/interfaces"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.MixExternalColor=function(b,l){b.include(k.ColorConversion,
l);var f=g.glsl(e||(e=m(["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed \x3d internalColor * textureColor;\n      vec3 allMixed \x3d internalMixed * externalColor;\n\n      if (mode \x3d\x3d ",") {\n        return allMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",
") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn \x3d rgb2v(internalMixed);\n        vec3 hsvTint \x3d rgb2hsv(externalColor);\n        vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed \x3d internalOpacity * textureOpacity;\n      float allMixed \x3d internalMixed * externalOpacity;\n\n      if (mode \x3d\x3d ",
") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "],["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed \x3d internalColor * textureColor;\n      vec3 allMixed \x3d internalMixed * externalColor;\n\n      if (mode \x3d\x3d ",
") {\n        return allMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn \x3d rgb2v(internalMixed);\n        vec3 hsvTint \x3d rgb2hsv(externalColor);\n        vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed \x3d internalOpacity * textureOpacity;\n      float allMixed \x3d internalMixed * externalOpacity;\n\n      if (mode \x3d\x3d ",
") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "])),g.glsl.int(1),g.glsl.int(2),g.glsl.int(3),g.glsl.int(2),g.glsl.int(3));switch(l.stages){case 0:b.vertex.code.add(f);break;case 1:b.fragment.code.add(f);break;default:b.vertex.code.add(f),b.fragment.code.add(f)}};var e})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../core/shaderLibrary/default/RealisticTree.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../lib/DefaultVertexAttributeLocations ./DefaultMaterialTechnique ../../../webgl/Program".split(" "),
function(n,b,m,k,g,e,f,l,h,d){Object.defineProperty(b,"__esModule",{value:!0});k=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}m(b,a);b.prototype.initializeProgram=function(a){var c=b.shader.get(),f=this.configuration,c=c.build({output:f.output,viewingMode:a.viewingMode,receiveShadows:f.receiveShadows,slicePlaneEnabled:f.slicePlaneEnabled,sliceHighlightDisabled:f.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:f.symbolColors,vvSize:f.vvSize,vvColor:f.vvColor,
vvInstancingEnabled:!0,instanced:f.instanced,instancedColor:f.instancedColor,instancedDoublePrecision:f.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:f.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:f.hasColorTexture,receiveAmbientOcclusion:f.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangets:!1,attributeTextureCoordinates:f.hasColorTexture?1:0,textureAlphaPremultiplied:f.textureAlphaPremultiplied,
attributeColor:f.vertexColors,screenSizePerspectiveEnabled:f.screenSizePerspective,verticalOffsetEnabled:f.verticalOffset,offsetBackfaces:f.offsetBackfaces,doublePrecisionRequiresObfuscation:e.doublePrecisionRequiresObfuscation(a.rctx),alphaDiscardMode:f.alphaDiscardMode,supportsTextureAtlas:!1});return new d(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),l.Default3D)};b.shader=new f.ReloadableShaderModule(g,"../core/shaderLibrary/default/RealisticTree.glsl",n);return b}(h.DefaultMaterialTechnique);
b.RealisticTreeTechnique=k})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/RealisticTree.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../ForwardLinearDepth.glsl ../Offset.glsl ../Slice.glsl ../Transform.glsl ../attributes/InstancedDoublePrecision.glsl ../attributes/NormalAttribute.glsl ../attributes/PositionAttribute.glsl ../attributes/SymbolColor.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexColor.glsl ../attributes/VerticalOffset.glsl ./DefaultMaterialAuxiliaryPasses.glsl ../shading/EvaluateAmbientOcclusion.glsl ../shading/EvaluateSceneLighting.glsl ../shading/PhysicallyBasedRendering.glsl ../shading/PhysicallyBasedRenderingParameters.glsl ../shading/ReadShadowMap.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../util/MixExternalColor.glsl ../../shaderModules/interfaces ../../shaderModules/ShaderBuilder".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var n=new C.ShaderBuilder,M=n.vertex.code,S=n.fragment.code;n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");n.include(d.PositionAttribute);n.varyings.add("vpos","vec3");n.include(z.VisualVariables,b);n.include(l.InstancedDoublePrecision,b);n.include(p.VerticalOffset,b);0===b.output&&(n.include(h.NormalAttribute,b),n.include(f.Transform,
{linearDepth:!1}),b.offsetBackfaces&&n.include(g.Offset),b.instancedColor&&n.attributes.add("instanceColor","vec4"),n.varyings.add("vNormalWorld","vec3"),n.varyings.add("localvpos","vec3"),n.include(c.TextureCoordinateAttribute,b),n.include(k.ForwardLinearDepth,b),n.include(a.SymbolColor,b),n.include(q.VertexColor,b),n.vertex.uniforms.add("externalColor","vec4"),n.varyings.add("vcolorExt","vec4"),M.add(B.glsl(F||(F=m(["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt \x3d externalColor;\n          ",
"\n          vcolorExt *\x3d vvColor();\n          vcolorExt *\x3d getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a \x3c ",") {\n            gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos \x3d calculateVPos();\n            localvpos \x3d vpos - view[3].xyz;\n            vpos \x3d subtractOrigin(vpos);\n            vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));\n            vpos \x3d addVerticalOffset(vpos, localOrigin);\n            gl_Position \x3d transformPosition(proj, view, vpos);\n            ",
"\n          }\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "],["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt \x3d externalColor;\n          ","\n          vcolorExt *\x3d vvColor();\n          vcolorExt *\x3d getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a \x3c ",") {\n            gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos \x3d calculateVPos();\n            localvpos \x3d vpos - view[3].xyz;\n            vpos \x3d subtractOrigin(vpos);\n            vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));\n            vpos \x3d addVerticalOffset(vpos, localOrigin);\n            gl_Position \x3d transformPosition(proj, view, vpos);\n            ",
"\n          }\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "])),b.instancedColor?"vcolorExt *\x3d instanceColor;":"",B.glsl.float(y.symbolAlphaCutoff),b.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"")),n.include(e.Slice,b),n.include(r.EvaluateSceneLighting,b),n.include(u.EvaluateAmbientOcclusion,b),n.include(y.DiscardOrAdjustAlpha,b),b.receiveShadows&&n.include(v.ReadShadowMap,b),n.fragment.uniforms.add("camPos",
"vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),n.fragment.uniforms.add("view","mat4"),b.hasColorTexture&&n.fragment.uniforms.add("tex","sampler2D"),n.include(w.PhysicallyBasedRenderingParameters,b),n.include(x.PhysicallyBasedRendering,b),n.include(A.MixExternalColor,{stages:1}),S.add(B.glsl(Q||(Q=m(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 viewDirection \x3d normalize(vpos - camPos);\n        ",
"\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor \x3d max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "],
["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 viewDirection \x3d normalize(vpos - camPos);\n        ","\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor \x3d max(ambient, diffuse);\n        ",
"\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "])),b.hasColorTexture?B.glsl(E||(E=m(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),b.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""):B.glsl(G||(G=m(["vec4 texColor \x3d vec4(1.0);"],
["vec4 texColor \x3d vec4(1.0);"]))),1===b.pbrMode?"applyPBRFactors();":"",b.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":0===b.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;",b.attributeColor?B.glsl(H||(H=m(["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"],
["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):B.glsl(D||(D=m(["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "],
["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),B.glsl(I||(I=m(["\n        vec3 shadedNormal \x3d normalize(vNormalWorld);\n        albedo_ *\x3d 1.2;\n        vec3 viewForward \x3d - vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView \x3d clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n        float transmittance \x3d 1.0 - clamp(dot(-viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff \x3d vColor.r;\n        float backLightFactor \x3d 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight +\x3d backLightFactor * lightingMainIntensity;"],
["\n        vec3 shadedNormal \x3d normalize(vNormalWorld);\n        albedo_ *\x3d 1.2;\n        vec3 viewForward \x3d - vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView \x3d clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n        float transmittance \x3d 1.0 - clamp(dot(-viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff \x3d vColor.r;\n        float backLightFactor \x3d 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight +\x3d backLightFactor * lightingMainIntensity;"]))),
1===b.pbrMode||2===b.pbrMode?0===b.viewingMode?B.glsl(L||(L=m(["vec3 normalGround \x3d normalize(vpos + localOrigin);"],["vec3 normalGround \x3d normalize(vpos + localOrigin);"]))):B.glsl(O||(O=m(["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"],["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"]))):B.glsl(K||(K=m([""],[""]))),1===b.pbrMode||2===b.pbrMode?B.glsl(N||(N=m(["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"],
["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);")));n.include(t.DefaultMaterialAuxiliaryPasses,b);return n};var F,E,G,H,D,I,L,O,
K,N,Q})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/compilerUtils ../../../../core/Error ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/cim/CIMSymbolRasterizer ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/utils ./constants ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./sdfPrimitives ../support/FastSymbolUpdates ../../support/projectionUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L,O,K,N,Q,M,T,P,S,V,J,U,Y){function X(a){return p.isSome(a)?"cross"===a||"x"===a:!1}Object.defineProperty(b,"__esModule",{value:!0});var R=x.mat4f64.create(),aa=v.vec3f64.fromValues(0,0,1),da=[.25,.25,.75,.75],ca=[64,64];n=function(b){function n(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._cimLayers=null;a._cimSymbolMaterials=new Map;a._cimSymbolTextures=new Map;a._cimMaterialParametersInfo=null;a._cimRequiredFields=null;a._cimScaleFactorOrFunction=
null;a._size=null;a._symbolTextureRatio=1;a._outlineSize=0;a._texture=null;a._releaseTexture=null;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return a}k(n,b);n.prototype.getCachedSize=function(){return{size:this._getIconSize()}};n.prototype.doLoad=function(a){return e(this,void 0,void 0,function(){var b,c,d,e;return g(this,function(f){switch(f.label){case 0:this._validateOrThrow();b=this._prepareMaterialParameters();c=this._getPrimitive();if(!p.isSome(c))return[3,1];this._prepareResourcesPrimitive(b,
c);return[3,5];case 1:return d=F.getIconHref(this.symbol,this.symbolLayer),(e=r.dataComponents(d))&&"application/json"===e.mediaType?[4,this._prepareResourcesCIM(b,JSON.parse(e.data),a)]:[3,3];case 2:return f.sent(),[3,5];case 3:return[4,this._prepareResourcesHref(b,d,a)];case 4:f.sent(),f.label=5;case 5:return[2]}})})};n.prototype._validateOrThrow=function(){if(!this._drivenProperties.size){var b=K.validateSymbolLayerSize(this._getIconSize());if(b)throw new a("graphics3diconsymbollayer:invalid-size",
b);}};n.prototype._getIconSize=function(){var a=this.symbolLayer,a=Math.round(null!=a.size?u.pt2px(a.size):16);return this._drivenProperties.size?Math.max(a,64):a};n.prototype._generateTextureCIM=function(a){var b=this._getGraphicHash(a),c=""===b?null:this._cimSymbolTextures.get(b);c||(a=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,a,{scaleFactor:this._cimScaleFactorOrFunction}),this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",a.anchorPosition),
c=new U(a.imageData,"symbol",{width:a.imageData.width,height:a.imageData.height,powerOfTwoResizeMode:2}),this._cimSymbolTextures.set(b,c),this._context.stage.add(4,c));return c};n.prototype._computeSize=function(a,b){a=a.width/a.height;return 1<a?[b,Math.round(b/a)]:[Math.round(b*a),b]};n.prototype._prepareMaterialParameters=function(){var a={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},b=this.symbol;if(b&&"point-3d"===b.type&&b.hasVisibleVerticalOffset()){var b=
b.verticalOffset,c=b.minWorldLength,d=b.maxWorldLength;a.verticalOffset={screenLength:u.pt2px(b.screenLength),minWorldLength:c||0,maxWorldLength:null!=d?d:Infinity}}this._context.screenSizePerspectiveEnabled&&(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);a.occlusionTest=!0;a.slicePlaneEnabled=this._context.slicePlaneEnabled;return a};n.prototype._prepareResourcesPrimitive=function(a,b){var c=this,e=this._getOutlineSize();if(X(b)&&0===e)throw Error("Nothing to render");
this._outlineSize=e;a.color=this._getFillColor();a.outlineColor=this._getOutlineColor();a.outlineSize=this._outlineSize;var f=this._context.sharedResources.textures.fromData(b,function(){var a;switch(b){case "circle":a=Q.createCircle(128,64);break;case "square":a=Q.createSquare(128,64);break;case "kite":a=Q.createKite(128,64);break;case "cross":a=Q.createCross(128,64);break;case "x":a=Q.createX(128,64);break;case "triangle":a=Q.createTriangle(128,64);break;default:d.neverReached(b)}return new U(a,
"sdf_"+b,{mipmap:!1,wrap:{s:33071,t:33071},width:128,height:128,components:4,noUnpackFlip:!0})});this._texture=f.texture;this._releaseTexture=function(){return c._context.sharedResources.textures.release(f.uid)};a.textureIsSignedDistanceField=!0;a.distanceFieldBoundingBox=da;a.textureId=this._texture.id;e=this._getIconSize();this._size=[e,e];this._symbolTextureRatio=2;this._createMaterialAndAddToStage(a,this._context.stage)};n.prototype._prepareResourcesHref=function(b,d,f){return e(this,void 0,void 0,
function(){var e,l,k,m,p,q,u,v,n=this;return g(this,function(g){switch(g.label){case 0:if(!c("esri-canvas-svg-support")&&r.isSVG(d))throw e="IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)",new a("graphics3diconsymbollayer:unsupported-image-format",e);this._outlineSize=this._getOutlineSize();b.color=this._getFillColor();b.outlineColor=this._getOutlineColor();b.outlineSize=this._outlineSize;b.textureIsSignedDistanceField=!1;l=this._getIconSize();k=l*this._context.layerView.view.pixelRatio;
return[4,h.result(this._context.sharedResources.textures.fromUrl(d,k,{signal:f}))];case 1:m=g.sent();if(!1===m.ok)throw t.throwIfAbortError(m.error),e="Failed to load (Request for icon resource failed: "+d+")",new a("graphics3diconsymbollayer:request-failed",e);p=m.value;q=p.uid;u=p.texture;this._releaseTexture=function(){return n._context.sharedResources.textures.release(q)};v=u.params;this._size=this._computeSize(v,l);b.textureId=u.id;this._createMaterialAndAddToStage(b,this._context.stage);return[2]}})})};
n.prototype._prepareResourcesCIM=function(a,b,c){return e(this,void 0,void 0,function(){var d,e,f,h,k,m,p,r,q,u,v;return g(this,function(g){switch(g.label){case 0:return d=new l.CIMSymbol({data:b}),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new B(this._context.renderCoordsHelper.spatialReference,!0)),e=this._context.layer.fields?this._context.layer.fields.map(function(a){return a.toJSON()}):null,f=this,[4,this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(d,
e,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:c})];case 1:f._cimLayers=g.sent();if(!this._context.renderer||"dictionary"!==this._context.renderer.type||!this._context.renderer.scaleExpression)return[3,4];m=this._context.renderer;if(!isNaN(m.scaleExpression))return[3,3];p=m.scaleExpression;return[4,A.createRendererExpression(p,this._context.layer.spatialReference,e)];case 2:return r=g.sent(),k=function(a,b,c){a=
E.callWithFeature(r,a,{$view:c},"esriGeometryPoint",b);return null!==a?a:1},[3,4];case 3:h=Number(m.scaleExpression),g.label=4;case 4:this._cimScaleFactorOrFunction=h||k||1;if(this._context.renderer)return[3,5];u=[];return[3,7];case 5:return[4,this._context.renderer.getRequiredFields(this._context.layer.fields)];case 6:u=g.sent(),g.label=7;case 7:return q=u,t.throwIfAborted(c),v=this._context.layer.fieldsIndex,this._cimRequiredFields=q.map(function(a){return v.get(a).name}),this._cimMaterialParametersInfo=
a,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1,[2]}})})};n.prototype._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||C.defaultPrimitive};n.prototype._getOutlineSize=function(){var a=0,a=this.symbolLayer;if(p.isSome(a.outline)&&
null!=a.outline.size)return Math.max(u.pt2px(a.outline.size),0);a=this._getPrimitive();a=X(a)?1.5:0;return Math.max(a,0)};n.prototype._getOutlineColor=function(){var a=this._getLayerOpacity(),b=p.get(this.symbolLayer,"outline","color");if(p.isSome(b)){var c=f.toUnitRGB(b);return[c[0],c[1],c[2],b.a*a]}return[0,0,0,0]};n.prototype._getFillColor=function(){if(X(this._getPrimitive()))return G.TRANSPARENT_UNIT;var a=p.isNone(this._getPrimitive()),b=p.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(b,
{hasIntrinsicColor:a})};n.prototype._getAnchorPos=function(a,b){return"relative"===a?w.vec2f64.fromValues((b.x||0)+.5,-(b.y||0)+.5):a in K.namedAnchorToHUDMaterialAnchorPos?K.namedAnchorToHUDMaterialAnchorPos[a]:K.namedAnchorToHUDMaterialAnchorPos.center};n.prototype._createMaterialAndAddToStage=function(a,b){this._fastUpdates=this._cimLayers?{enabled:!1}:M.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&q.mixin(a,this._fastUpdates.materialParameters);
if(this._cimLayers){var c=this._cimSymbolMaterials.get(a.textureId);c||(c=new Y(a,this._getIdHint("_icon")),this._cimSymbolMaterials.set(a.textureId,c),b.add(3,c));return c}this._material=new Y(a,this._getIdHint("_icon"));b.add(3,this._material);return this._material};n.prototype._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial(function(a){a.setParameterValues({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,shaderPolygonOffset:0})}),
this.layerOpacityChanged())};n.prototype.destroy=function(){var a=this;b.prototype.destroy.call(this);this._forEachMaterial(function(b){a._context.stage.remove(3,b.id)});p.isSome(this._material)&&(this._material=null);this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(function(b){a._context.stage.remove(4,b.id)});this._cimSymbolTextures.clear();this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=null)};n.prototype._getScaleFactor=function(a,b){if(this._drivenProperties.size&&
a.size){for(var c=0;3>c;c++){var d=a.size[c];d&&"symbol-value"!==d&&"proportional"!==d&&(a.size[c]=u.pt2px(d))}if("symbol-value"===a.size[0])return 1;if(isFinite(+a.size[0]))return+a.size[0]/b;if(isFinite(+a.size[2]))return+a.size[2]/b}return 1};n.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo,c=a.graphic,d,e;if(this._cimLayers){if(!this._cimLayers.length)return null;var f=this._generateTextureCIM(c);e=m({textureId:f.id},this._cimMaterialParametersInfo);e=this._createMaterialAndAddToStage(e,
this._context.stage);d=[f.params.width,f.params.height]}else d=this._size,e=p.expect(this._material);if(!this._validateGeometry(c.geometry))return null;f=N.placePointOnGeometry(c.geometry);if(p.isNone(f))return this.logger.warn("unsupported geometry type for icon symbol: "+c.geometry.type),null;var h="graphic"+c.uid,g=this._getVertexOpacityAndColor(b),l=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(l=this._getScaleFactor(b,d[0]>d[1]?d[0]:d[1]));l*=this._symbolTextureRatio;
b=[d[0]*l,d[1]*l];d=this.getGraphicElevationContext(c);this.ensureDrapedStatus("on-the-ground"===d.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(c,f,e,g,b,a.layer.uid):this._createAs3DShape(c,f,e,g,b,d,h,c.uid)};n.prototype.layerOpacityChanged=function(){var a=this._getFillColor(),b=this._getOutlineColor();this._forEachMaterial(function(c){c.setParameterValues({color:a});c.setParameterValues({outlineColor:b})});return!0};n.prototype.layerElevationInfoChanged=
function(a,b,c){var d=this._elevationContext.mode;c=D.elevationModeChangeUpdateType(n.elevationModeChangeTypes,c,d);if(c!==D.SymbolUpdateType.UPDATE)return c;var e=D.needsElevationUpdates2D(d)||"absolute-height"===d;return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};n.prototype.slicePlaneEnabledChanged=function(){var a=this;this.draped||this._forEachMaterial(function(b){b.setParameterValues({slicePlaneEnabled:a._context.slicePlaneEnabled})});return!0};n.prototype.physicalBasedRenderingChanged=
function(){return!0};n.prototype.pixelRatioChanged=function(){return this._getPrimitive()?!0:!1};n.prototype.applyRendererDiff=function(a,b){for(var c in a.diff)switch(c){case "visualVariables":if(M.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))p.isSome(this._material)&&this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};n.prototype._defaultElevationInfoNoZ=function(){return ba};n.prototype._createAs3DShape=
function(a,b,c,d,e,f,h,g){var l=this,k=this.getFastUpdateAttrValues(a);a=k?function(a){return M.evaluateModelTransform(l._fastUpdates.materialParameters,k,a)}:null;d=V.createPointGeometry(aa,null,d,e,W,null,k);d=[new S(d,h)];h=N.createStageObjectForHUD(this._context,b,d,[c],null,null,f,h,this._context.layer.uid,g,a);if(null===h)return null;var m=new L(this,h.object,d,null,null,H.perObjectElevationAligner,f);m.alignedSampledElevation=h.sampledElevation;m.needsElevationUpdates=D.needsElevationUpdates2D(f.mode)||
"absolute-height"===f.mode;m.getScreenSize=this._createScreenSizeGetter(e,a);m.calculateRelativeScreenBounds=function(a){return c.calculateRelativeScreenBounds(m.getScreenSize(),1,a)};N.extendPointGraphicElevationContext(m,b,this._context.elevationProvider);return m};n.prototype._createAsOverlay=function(a,b,c,d,e,f){var h=this;c.renderPriority=this._renderPriority;var g=v.vec3f64.create();T.pointToVector(b,g,this._context.overlaySR);g[2]=P.DRAPED_Z;b=this._context.clippingExtent;if(p.isSome(b)&&
!y.containsPoint(b,g))return null;var l=this.getFastUpdateAttrValues(a);b=l?function(a){return M.evaluateModelTransform(h._fastUpdates.materialParameters,l,a)}:null;d=V.createPointGeometry(aa,g,d,e,null,null,l);d=new J(d);d.material=c;d.center=g;d.bsRadius=0;d.data.layerUid=f;d.data.graphicUid=a.uid;d.calculateShaderTransformation=b;var k=new I(this,[d],null);k.getScreenSize=this._createScreenSizeGetter(e,b);k.calculateRelativeScreenBounds=function(a){return c.calculateRelativeScreenBounds(k.getScreenSize(),
1,a)};return k};n.prototype._createScreenSizeGetter=function(a,b){var c=this._outlineSize+2;if(this._fastUpdates.enabled){var d=a[0]/this._symbolTextureRatio,e=a[1]/this._symbolTextureRatio;return function(a){void 0===a&&(a=w.vec2f64.create());var f=b(R);a[0]=f[0]*d+c;a[1]=f[5]*e+c;return a}}var f=a[0]/this._symbolTextureRatio+c,h=a[1]/this._symbolTextureRatio+c;return function(a){void 0===a&&(a=w.vec2f64.create());a[0]=f;a[1]=h;return a}};n.prototype._fastVisualVariableConvertOptions=function(){var a=
this._size[0]>this._size[1]?this._size[0]:this._size[1],b=v.vec3f64.fromValues(a,a,a),c=u.px2pt(1),a=a*c,a=v.vec3f64.fromValues(a,a,a);return{modelSize:b,symbolSize:a,unitInMeters:c,transformation:{anchor:v.vec3f64.ZEROS,scale:v.vec3f64.ONES,rotation:v.vec3f64.ZEROS}}};n.prototype._getGraphicHash=function(a){for(var b="",c=0,d=this._cimRequiredFields;c<d.length;c++)var e=d[c],b=b+(e+a.attributes[e]);return b};n.prototype._forEachMaterial=function(a){p.isSome(this._material)&&a(this._material);this._cimSymbolMaterials.forEach(a)};
n.PRIMITIVE_SIZE=ca;n.elevationModeChangeTypes={definedChanged:D.SymbolUpdateType.UPDATE,staysOnTheGround:D.SymbolUpdateType.NONE,onTheGroundChanged:D.SymbolUpdateType.RECREATE};return n}(O.default);b.Graphics3DIconSymbolLayer=n;var ba={mode:"relative-to-ground",offset:0},W=z.vec4f64.fromValues(0,0,0,1);b.default=n})},"esri/symbols/cim/CIMSymbolRasterizer":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/promiseUtils ../../core/screenUtils ../../geometry/support/jsonUtils ./cimAnalyzer ./Rasterizer ./TextRasterizer ./utils ../support/cimSymbolUtils ../support/Symbol3DAnchorPosition2D".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){function t(a){return(a?Object.keys(a):[]).map(function(b){return{name:b,alias:b,type:"string"===typeof a[b]?"esriFieldTypeString":"esriFieldTypeDouble"}})}var u=function(a,b){return a&&a.targetSize?a.targetSize/b.referenceSize:a&&a.scaleFactor?a.scaleFactor:1};return function(){function b(b,c){this._spatialReference=b;this._avoidSDF=c;this._resourceCache=new Map;this._rasterizer=new d.default;this._textRasterizer=new a.default;this._pictureMarkerCache=new Map}
b.prototype.rasterizeCIMSymbolAsync=function(a,b,c,d,e,f,h){return k(this,void 0,void 0,function(){var g,k;return m(this,function(m){switch(m.label){case 0:return g=b?null!==b.centroid?"esriGeometryPolygon":l.getJsonType(b.geometry):null,[4,this.analyzeCIMSymbol(a,b?t(b.attributes):null,c,g,h)];case 1:return k=m.sent(),[2,this.rasterizeCIMSymbol(k,b,d,e,f)]}})})};b.prototype.analyzeCIMSymbol=function(a,b,c,d,f){return k(this,void 0,void 0,function(){var g,l,k,p,r,u,t;return m(this,function(m){switch(m.label){case 0:return[4,
q.fetchSymbol(a,f)];case 1:return g=m.sent(),l=[],b?k={geometryType:d,spatialReference:this._spatialReference,fields:b}:(g=g.clone(),g.data.primitiveOverrides=[],k=null),[4,h.analyzeCIMSymbol(g.data,c,k,l,this._avoidSDF)];case 2:m.sent();e.throwIfAborted(f);r=0;for(u=l;r<u.length;r++)t=u[r],"CIMPictureMarker"===t.cim.type&&(p||(p=[]),p.push(this.fetchPictureMarkerResource(t,f)));return p?[4,e.all(p)]:[3,4];case 3:m.sent(),m.label=4;case 4:return[2,l]}})})};b.prototype.fetchPictureMarkerResource=function(a,
b){return k(this,void 0,void 0,function(){var c,d,e;return m(this,function(f){switch(f.label){case 0:return c=a.materialHash,this._pictureMarkerCache.get(c)?[3,2]:[4,g(a.cim.url,{responseType:"image",signal:b&&b.signal})];case 1:d=f.sent(),e=d.data,this._pictureMarkerCache.set(c,e),f.label=2;case 2:return[2]}})})};b.prototype.rasterizeCIMSymbol=function(a,b,c,d,e){for(var f=[],h=0;h<a.length;h++){var g=a[h];!c||"function"!==typeof c.scaleFactor||"marker"!==g.type&&"text"!==g.type||(c.scaleFactor=
c.scaleFactor(b,d,e));var l=this._getRasterizedResource(g,b,c,d,e);null!=l&&f.push({cimLayer:g,rasterizedResource:l})}return this.getSymbolImage(f,b,c,d,e)};b.prototype.getSymbolImage=function(a,b,d,e,h){for(var g=document.createElement("canvas"),l=g.getContext("2d"),k=0,m=0,r=0,q=0,t=[],n=0;n<a.length;n++){var v=a[n],x=v.rasterizedResource;if(x){var w=v.cimLayer;if("line"!==w.type&&"fill"!==w.type){var y=u(d,w),z=x.size,Q=c.evaluateValueOrFunction(w.offsetX,b,e,h)*y,y=c.evaluateValueOrFunction(w.offsetY,
b,e,h)*y,Q=Q?Q:0,y=y?y:0,M=v.rasterizedResource.anchorX,v=v.rasterizedResource.anchorY,T=!1,P=w.type,S=void 0;"marker"===w.type&&(S=c.evaluateValueOrFunction(w.rotation,b,e,h),T=w.rotateClockwise?w.rotateClockwise:!1);if("text"===w.type){S=c.evaluateValueOrFunction(w.angle,b,e,h);if(void 0!==w.horizontalAlignment)switch(w.horizontalAlignment){case "left":M=-.5;break;case "right":M=.5;break;default:M=0}if(void 0!==w.verticalAlignment)switch(w.verticalAlignment){case "top":v=.5;break;case "bottom":v=
-.5;break;case "baseline":v=-.25;break;default:v=0}}var w=f.pt2px(Q)-z[0]*(.5+M),V=f.pt2px(y)-z[1]*(.5+v),J=w+z[0],U=V+z[1];if(S){T&&(S=-S);var Y=Math.sin(S*Math.PI/180),X=Math.cos(S*Math.PI/180),z=w*X-V*Y,R=w*Y+V*X,aa=w*X-U*Y,da=w*Y+U*X,ca=J*X-U*Y,U=J*Y+U*X,ba=J*X-V*Y,Y=J*Y+V*X,w=Math.min(z,aa,ca,ba),V=Math.min(R,da,U,Y),J=Math.max(z,aa,ca,ba),U=Math.max(R,da,U,Y)}k=w<k?w:k;m=V<m?V:m;r=J>r?J:r;q=U>q?U:q;w=l.createImageData(x.size[0],x.size[1]);w.data.set(new Uint8ClampedArray(x.image.buffer));x=
{offsetX:Q,offsetY:y,rotateClockwise:T,type:P,angle:S,rasterizedImage:w,anchorX:M,anchorY:v};t.push(x)}}}g.width=r-k;g.height=q-m;a=-k;for(n=0;n<t.length;n++)x=t[n],b=this._imageDataToCanvas(x.rasterizedImage),d=a-x.rasterizedImage.width*(.5+x.anchorX),e=q-x.rasterizedImage.height*(.5-x.anchorY),x.angle?(h=(360-x.angle)*Math.PI/180,l.save(),l.translate(f.pt2px(x.offsetX),-f.pt2px(x.offsetY)),l.translate(a,q),l.rotate(h),l.translate(-a,-q),l.drawImage(b,d,e),l.restore()):l.drawImage(b,d+f.pt2px(x.offsetX),
e-f.pt2px(x.offsetY));t=new p.default({x:a/g.width-.5,y:q/g.height-.5});return{imageData:0!==g.width&&0!==g.height?l.getImageData(0,0,g.width,g.height):l.createImageData(1,1),anchorPosition:t}};b.prototype._imageDataToCanvas=function(a){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));var b=this._imageDataCanvas,c=b.getContext("2d");b.width=a.width;b.height=a.height;c.putImageData(a,0,0);return b};b.prototype._imageTo32Array=function(a,b,c){this._imageDataCanvas||(this._imageDataCanvas=
document.createElement("canvas"));var d=this._imageDataCanvas,e=d.getContext("2d");d.width=b;d.height=c;e.drawImage(a,0,0,b,c);return new Uint32Array(e.getImageData(0,0,b,c).data.buffer)};b.prototype._getRasterizedResource=function(a,b,d,e,g){var l;if("text"===a.type)l=a.cim,a=this._rasterizeTextResource(a,b,d,e,g);else{var k=this._resourceCache,m=void 0;"function"===typeof a.materialHash?(m=a.materialHash,m=m(b,e,g),l=h.analyzeCIMResource(a.cim,a.materialOverrides)):(m=a.materialHash,d&&(m+=JSON.stringify(d)),
l=a.cim);if(k.has(m))return k.get(m);d=u(d,a);if("CIMPictureMarker"===a.cim.type){g=c.evaluateValueOrFunction(a.cim.size,b,e,g)*d;b=this._pictureMarkerCache.get(a.materialHash);if(!b)return null;d=b.height/b.width;e=1<d?f.pt2px(g):f.pt2px(g)/d;g=1<d?f.pt2px(g)*d:f.pt2px(g);a={image:this._imageTo32Array(b,e,g),size:[e,g],sdf:!1,simplePattern:!1,anchorX:a.anchorPoint?a.anchorPoint.x:0,anchorY:a.anchorPoint?a.anchorPoint.y:0}}else l.size*=d,a=this._rasterizer.rasterizeJSONResource(l,this._avoidSDF);
k.set(m,a)}return a};b.prototype._rasterizeTextResource=function(a,b,d,e,f){var h=u(d,a);d=c.evaluateValueOrFunction(a.text,b,e,f);if(!d||0===d.length)return null;var g=c.evaluateValueOrFunction(a.fontName,b,e,f),l=c.evaluateValueOrFunction(a.style,b,e,f),k=c.evaluateValueOrFunction(a.weight,b,e,f),m=c.evaluateValueOrFunction(a.decoration,b,e,f),h=c.evaluateValueOrFunction(a.size,b,e,f)*h,p=c.evaluateValueOrFunction(a.horizontalAlignment,b,e,f),r=c.evaluateValueOrFunction(a.verticalAlignment,b,e,
f),q=c.colorToArray(c.evaluateValueOrFunction(a.color,b,e,f)),t=c.colorToArray(c.evaluateValueOrFunction(a.outlineColor,b,e,f));a=c.evaluateValueOrFunction(a.outlineSize,b,e,f);return this._textRasterizer.rasterizeText(d,{color:q,size:h,horizontalAlignment:p,verticalAlignment:r,font:{family:g,style:l,weight:k,decoration:m},halo:{size:a||0,color:t,style:l},pixelRatio:1,premultiplyColors:!this._avoidSDF})};return b}()})},"esri/symbols/cim/Rasterizer":function(){define(["require","exports","./CIMSymbolHelper",
"./SDFHelper","./utils"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){}b.prototype.dispose=function(){this._rasterizationCanvas=null};b.prototype.rasterizeJSONResource=function(b,e){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));if("simple-fill"===b.type||"esriSFS"===b.type)return e=m.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,b.style),{size:[e[1],e[2]],image:new Uint32Array(e[0].buffer),sdf:!1,
simplePattern:!0,anchorX:0,anchorY:0};if("simple-line"===b.type||"esriSLS"===b.type)return e=m.SymbolHelper.rasterizeSimpleLine(b.style,b.cap),{size:[e[1],e[2]],image:new Uint32Array(e[0].buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0};var f;b="simple-marker"===b.type||"esriSMS"===b.type?m.CIMSymbolHelper.fromSimpleMarker(b):b;if((f=k.getSDFInfo(b))&&!e)return e=k.buildSDF(f),(b=e[0])?{size:[e[1],e[2]],image:new Uint32Array(b.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null;e=m.CIMSymbolHelper.rasterize(this._rasterizationCanvas,
b,!e);b=e[0];f=e[3];var d=e[4];return b?{size:[e[1],e[2]],image:new Uint32Array(b.buffer),sdf:!1,simplePattern:!1,anchorX:f,anchorY:d}:null};b.prototype.rasterizeImageResource=function(b,e){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=b.width;this._rasterizationCanvas.height=b.height;var f=this._rasterizationCanvas.getContext("2d");b instanceof ImageData?f.putImageData(b,0,0):(b.setAttribute("width",b.width.toString()),b.setAttribute("height",
b.height.toString()),f.drawImage(b,0,0,b.width,b.height));f=f.getImageData(0,0,b.width,b.height);f=new Uint8Array(f.data);if(e)for(var d=0;d<e.length;d++){var a=e[d];if(a&&a.oldColor&&4===a.oldColor.length&&a.newColor&&4===a.newColor.length){var c=a.oldColor,l=c[0],k=c[1],m=c[2],c=c[3],u=a.newColor,a=u[0],r=u[1],n=u[2],w=u[3];if(l!==a||k!==r||m!==n||c!==w)for(u=0;u<f.length;u+=4)l===f[u]&&k===f[u+1]&&m===f[u+2]&&c===f[u+3]&&(f[u]=a,f[u+1]=r,f[u+2]=n,f[u+3]=w)}}for(u=0;u<f.length;u+=4)e=f[u+3]/255,
f[u]*=e,f[u+1]*=e,f[u+2]*=e;e=b.width;d=b.height;l=f;if(512<=e||512<=d)l=b.width/b.height,1<l?(e=512,d=Math.round(512/l)):(d=512,e=Math.round(512*l)),l=new Uint8Array(4*e*d),g.resampleHermite(f,b.width,b.height,new Uint8ClampedArray(l.buffer),e,d,!1);return{size:[e,d],image:new Uint32Array(l.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}};return b}();b.default=n})},"esri/symbols/cim/utils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});
b.evaluateValueOrFunction=function(b,k,g,e){return"function"===typeof b?b(k,g,e):b};b.colorToArray=function(b){return[b.r,b.g,b.b,b.a]};b.resampleHermite=function(b,k,g,e,f,l,h){void 0===h&&(h=!0);var d=k/f;g/=l;for(var a=Math.ceil(d/2),c=Math.ceil(g/2),m=0;m<l;m++)for(var p=0;p<f;p++){for(var t=4*(p+(h?l-m-1:m)*f),u=0,r=0,n=0,w=0,v=0,z=0,y=0,A=(m+.5)*g,B=Math.floor(m*g);B<(m+1)*g;B++)for(var C=Math.abs(A-(B+.5))/c,F=(p+.5)*d,C=C*C,E=Math.floor(p*d);E<(p+1)*d;E++){var G=Math.abs(F-(E+.5))/a,u=Math.sqrt(C+
G*G);-1<=u&&1>=u&&(u=2*u*u*u-3*u*u+1,0<u&&(G=4*(E+B*k),y+=u*b[G+3],n+=u,255>b[G+3]&&(u=u*b[G+3]/250),w+=u*b[G],v+=u*b[G+1],z+=u*b[G+2],r+=u))}e[t]=w/r;e[t+1]=v/r;e[t+2]=z/r;e[t+3]=y/n}}})},"esri/symbols/cim/TextRasterizer":function(){define(["require","exports","../../core/screenUtils"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){}b.prototype.rasterizeText=function(b,e){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));
var f=this._textRasterizationCanvas,d=f.getContext("2d");this.setFontProperties(d,e);this.parameters=e;this.textLines=b.split(/\r?\n/);this.lineHeight=this.computeLineHeight();b=this.computeTextWidth(d,e);var a=this.lineHeight*this.textLines.length;f.width=b;f.height=a;this.renderedLineHeight=Math.round(this.lineHeight*e.pixelRatio);this.renderedHaloSize=e.halo.size*e.pixelRatio;this.renderedWidth=b*e.pixelRatio;this.renderedHeight=a*e.pixelRatio;f=e.color;this.fillStyle="rgba("+f.slice(0,3).toString()+
","+f[3]+")";this.haloStyle="rgb("+e.halo.color.slice(0,3).toString()+")";var f=this.renderedLineHeight,c=this.renderedHaloSize;this.setFontProperties(d,e);b=d.textAlign;var a=this.renderedWidth,g=("center"===b?.5*a:"right"===b?a:0)+c,a=b=0;0<c&&this.renderHalo(d,g,c,b,a,e);a+=c;b+=g;c=0;for(g=this.textLines;c<g.length;c++){var l=g[c];d.globalCompositeOperation="destination-out";d.fillStyle="rgb(0, 0, 0)";d.fillText(l,b,a);d.globalCompositeOperation="source-over";d.fillStyle=this.fillStyle;d.fillText(l,
b,a);a+=f}d=d.getImageData(0,0,this.renderedWidth,this.renderedHeight);d=new Uint8Array(d.data);if(e.premultiplyColors)for(e=void 0,f=0;f<d.length;f+=4)e=d[f+3]/255,d[f]*=e,d[f+1]*=e,d[f+2]*=e;return{size:[this.renderedWidth,this.renderedHeight],image:new Uint32Array(d.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}};b.prototype.renderHalo=function(b,e,h,d,a,c){var f=this.renderedWidth,g=this.renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas"));
this._haloRasterizationCanvas.width=f;this._haloRasterizationCanvas.height=g;var l=this._haloRasterizationCanvas,k=l.getContext("2d");k.clearRect(0,0,f,g);this.setFontProperties(k,c);k.fillStyle=this.haloStyle;k.strokeStyle=this.haloStyle;c=3>this.renderedHaloSize;k.lineJoin=c?"miter":"round";c?this.renderHaloEmulated(k,e,h):this.renderHaloNative(k,e,h);b.globalAlpha=this.parameters.halo.color[3];b.drawImage(l,0,0,f,g,d,a,f,g);b.globalAlpha=1};b.prototype.renderHaloEmulated=function(b,e,h){for(var d=
this.renderedLineHeight,a=this.renderedHaloSize,c=0,f=this.textLines;c<f.length;c++){for(var g=f[c],l=0,m=k;l<m.length;l++){var r=m[l];b.fillText(g,e+a*r[0],h+a*r[1])}h+=d}};b.prototype.renderHaloNative=function(b,e,h){for(var d=this.renderedLineHeight,a=this.renderedHaloSize,c=0,f=this.textLines;c<f.length;c++){for(var g=f[c],l=2*a,k=0;5>k;k++)b.lineWidth=(.6+.1*k)*l,b.strokeText(g,e,h);h+=d}};b.prototype.setFontProperties=function(b,e){var f=e.font;e=f.style+" "+f.weight+" "+m.pt2px(e.size*e.pixelRatio)+
"px "+f.family+", sans-serif";b.font=e;b.textAlign="left";b.textBaseline="top"};b.prototype.computeTextWidth=function(b,e){for(var f=0,d=0,a=this.textLines;d<a.length;d++)f=Math.max(f,b.measureText(a[d]).width);e=e.font;if("italic"===e.style||"oblique"===e.style||"string"===typeof e.weight&&("bold"===e.weight||"bolder"===e.weight)||"number"===typeof e.weight&&600<e.weight)f+=.3*b.measureText("A").width;f+=2*this.parameters.halo.size;return Math.round(f)};b.prototype.computeLineHeight=function(){return Math.round(1.275*
this.parameters.size+2*this.parameters.halo.size)};return b}();b.TextRasterizer=n;for(var k=[],g=0;360>g;g+=22.5)k.push([Math.cos(Math.PI*g/180),Math.sin(Math.PI*g/180)]);b.default=n})},"esri/symbols/support/utils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Color ../../symbols ../../core/asyncUtils ../../core/compilerUtils ../../core/has ../../core/maybe ../../core/screenUtils ../../core/libs/gl-matrix-2/vec3f64 ./gfxUtils ./Symbol3DMaterial @dojo/framework/shim/Promise".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){function t(a,b){if(null==b)return a;a=a.toRgba();a[3]*=b;return new g(a)}function u(a,b,c){if(a=a.symbolLayers){var e=function(a){a=d.isSome(a)?a:null;b=b||a||null!=c&&B;return t(b,c)};a.forEach(function(a){if("object"!==a.type||null==a.resource.href||b)if("water"===a.type)a.color=e(a.color);else{var f=d.isSome(a.material)?a.material.color:null,f=e(f);d.isNone(a.material)?a.material=new p.default({color:f}):a.material.color=f;null!=c&&"outline"in a&&d.isSome(a.outline)&&
d.isSome(a.outline.color)&&(a.outline.color=t(a.outline.color,c))}})}}function r(a,b){return k(this,void 0,void 0,function(){var c,d=this;return m(this,function(e){switch(e.label){case 0:return(c=a.symbolLayers)?[4,f.forEach(c,function(a){return k(d,void 0,void 0,function(){return m(this,function(c){return[2,x(a,b)]})})})]:[2];case 1:return e.sent(),[2]}})})}function x(a,b){return k(this,void 0,void 0,function(){var d;return m(this,function(e){switch(e.label){case 0:d=a.type;switch(d){case "icon":return[3,
1];case "line":return[3,1];case "extrude":return[3,1];case "text":return[3,1];case "path":return[3,2];case "object":return[3,3];case "fill":return[3,5];case "water":return[3,5]}return[3,6];case 1:for(e=0;e<b.length;e++){var f=b[e];if("number"===typeof f){a.size=f;break}}return[3,7];case 2:return e=v(b,c.vec3f64.ONES,[a.width,void 0,a.height]),a.width=y(b[0],a.width,1,e),a.height=y(b[2],a.height,1,e),[3,7];case 3:return[4,w(a,b)];case 4:return e.sent(),[3,7];case 5:return[3,7];case 6:l.neverReached(a),
e.label=7;case 7:return[2]}})})}function w(a,b){return k(this,void 0,void 0,function(){var c,d,e,f;return m(this,function(h){switch(h.label){case 0:return[4,z(a)];case 1:return c=h.sent(),d=c.resourceSize,e=c.symbolSize,f=v(b,d,e),a.width=y(b[0],e[0],d[0],f),a.depth=y(b[1],e[1],d[1],f),a.height=y(b[2],e[2],d[2],f),[2]}})})}function v(a,b,c){for(var d=0;3>d;d++){var e=a[d];switch(e){case "symbol-value":return null!=c[d]?c[d]/b[d]:1;case "proportional":break;default:if(e&&b[d])return e/b[d]}}return 1}
function z(a){return k(this,void 0,void 0,function(){var b,c,d,e,f,h,g,l;return m(this,function(k){switch(k.label){case 0:return[4,new Promise(function(a,b){n(["./symbolLayerUtils"],a,b)})];case 1:return b=k.sent(),[4,b.computeObjectLayerResourceSize(a,10)];case 2:c=k.sent();d=a.width;e=a.height;f=a.depth;h=[d,f,e];g=1;for(l=0;3>l;l++)if(null!=h[l]){g=h[l]/c[l];break}for(l=0;3>l;l++)null==h[l]&&(h[l]=c[l]*g);return[2,{resourceSize:c,symbolSize:h}]}})})}function y(a,b,c,d){switch(a){case "proportional":return c*
d;case "symbol-value":return null!=b?b:c;default:return a}}Object.defineProperty(b,"__esModule",{value:!0});var A=/\/resource\/(.*?)\.svg$/,B=new g("white");b.getSymbolOutlineSize=function(b){if(!b)return 0;if(e.isSymbol3D(b)){var c=b.symbolLayers&&b.symbolLayers.length;c?(b=b.symbolLayers.getItemAt(c-1),b="outline"in b?d.get(b,"outline","size"):void 0):b=void 0;return d.isSome(b)?b:0}return(b=q.getStroke(b))&&a.px2pt(b.width)||0};b.isVolumetricSymbol=function(a){if(!a||!a.symbolLayers)return!1;switch(a.type){case "point-3d":return a.symbolLayers.some(function(a){return"object"===
a.type});case "line-3d":return a.symbolLayers.some(function(a){return"path"===a.type});case "polygon-3d":return a.symbolLayers.some(function(a){return"object"===a.type||"extrude"===a.type});default:return!1}};b.getIconHref=function(a,b){b=b.resource.href;return!h("esri-canvas-svg-support")&&a.styleOrigin&&A.test(b)?b.replace(A,"/resource/png/$1.png"):b};b.applyOpacityToColor=t;b.applyColorToSymbol=function(a,b,c){if(a&&(b||null!=c))if(b&&(b=new g(b)),e.isSymbol3D(a))u(a,b,c);else if(e.isSymbol2D(a)){if(b=
b||a.color)a.color=t(b,c);null!=c&&"outline"in a&&a.outline&&a.outline.color&&(a.outline.color=t(a.outline.color,c))}};b.applySizesToSymbol=function(a,b){return k(this,void 0,void 0,function(){return m(this,function(c){if(!a||!b)return[2];if(e.isSymbol3D(a))return[2,r(a,b)];if(e.isSymbol2D(a)&&(c=b[0],"number"===typeof c))switch(a.type){case "simple-marker":a.size=c;break;case "picture-marker":var d=a.width/a.height;1<d?(a.width=c,a.height=c*d):(a.width=c*d,a.height=c);break;case "simple-line":a.width=
c;break;case "text":a.font.size=c;break;case "simple-fill":case "picture-fill":break;case "cim":break;default:l.neverReached(a)}return[2]})})};b.applyRotationToSymbol=function(a,b,c){a&&null!=b&&(e.isSymbol3D(a)?(a=a.symbolLayers)&&a.forEach(function(a){if(a&&"object"===a.type)switch(c){case "tilt":a.tilt=b;break;case "roll":a.roll=b;break;default:a.heading=b}}):!e.isSymbol2D(a)||"simple-marker"!==a.type&&"picture-marker"!==a.type&&"text"!==a.type||(a.angle=b))}})},"esri/symbols/support/gfxUtils":function(){define("require exports ../../core/tsSupport/assignHelper ../../Color ../../request ../../core/ItemCache ../../core/promiseUtils ../../core/screenUtils".split(" "),
function(n,b,m,k,g,e,f,l){function h(a){if(!a)return null;var b;switch(a.type){case "simple-fill":case "picture-fill":case "simple-marker":b=h(a.outline);break;case "simple-line":var c=l.pt2px(a.width);"none"!==a.style&&0!==c&&(b={color:a.color,style:p(a.style),width:c,cap:a.cap,join:"miter"===a.join?l.pt2px(a.miterLimit):a.join});break;default:b=null}return b}Object.defineProperty(b,"__esModule",{value:!0});var d=n.toUrl("../../symbols/patterns/"),a={left:"start",center:"middle",right:"end",justify:"start"},
c={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},q=new e(1E3);b.getSVGAlign=function(b){return b=(b=b.horizontalAlignment)&&a[b.toLowerCase()]||"middle"};b.getSVGBaseline=function(a){return(a=a.verticalAlignment)&&c[a.toLowerCase()]||"alphabetic"};b.getSVGBaselineShift=function(a){return"bottom"===a.verticalAlignment?"super":null};b.getFill=function(a){var b=a.style,c=null;if(a)switch(a.type){case "simple-marker":"cross"!==b&&"x"!==b&&(c=a.color);break;case "simple-fill":"solid"===
b?c=a.color:"none"!==b&&(c={type:"pattern",x:0,y:0,src:d+b+".png",width:8,height:8});break;case "picture-fill":c={type:"pattern",src:a.url,width:l.pt2px(a.width)*a.xscale,height:l.pt2px(a.height)*a.yscale,x:l.pt2px(a.xoffset),y:l.pt2px(a.yoffset)};break;case "text":c=a.color}return c};b.getPatternUrlWithColor=function(a,b){var c=a+"-"+b;return void 0!==q.get(c)?f.resolve(q.get(c)):g(a,{responseType:"image"}).then(function(a){a=a.data;var d=a.naturalWidth,e=a.naturalHeight,f=document.createElement("canvas");
f.width=d;f.height=e;var h=f.getContext("2d");h.fillStyle=b;h.fillRect(0,0,d,e);h.globalCompositeOperation="destination-in";h.drawImage(a,0,0);a=f.toDataURL();q.put(c,a);return a})};b.getStroke=h;var p=function(){var a={};return function(b){if(a[b])return a[b];var c=b.replace(/-/g,"");return a[b]=c}}();b.defaultThematicColor=new k([128,128,128])})},"esri/core/ItemCache":function(){define(["require","exports","./MemCache"],function(n,b,m){return function(){function b(b,e){this._storage=new m.MemCacheStorage;
this._storage.maxSize=b;e&&this._storage.registerRemoveFunc("",e)}b.prototype.put=function(b,e){this._storage.put(b,e,1,1)};b.prototype.pop=function(b){return this._storage.pop(b)};b.prototype.get=function(b){return this._storage.get(b)};b.prototype.clear=function(){this._storage.clearAll()};b.prototype.destroy=function(){this._storage.clearAll()};return b}()})},"esri/views/3d/layers/graphics/constants":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec4f64"],function(n,
b,m){Object.defineProperty(b,"__esModule",{value:!0});b.defaultIconElevationOffset=1;b.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;b.TRANSPARENT_UNIT=m.vec4f64.ZEROS;b.WHITE_UNIT=m.vec4f64.ONES})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/ComponentUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){n=function(){function b(a,b,c){this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.boundingBox=c;this.type="draped";this.stage=null;this._addedToStage=this._visible=!1;this._layerView=null;this.isElevationSource=!1}b.prototype.initialize=function(a,b,c){this.stage=a;this._layerView=c;this._overlayRenderer=this._layerView.view.basemapTerrain.overlayManager.renderer};b.prototype.setVisibility=function(b){if(null!=this.stage){if(this._visible!==b){if((this._visible=
b)&&!this._addedToStage)return this._addedToStage=!0,this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView,0),!0;if(!b&&!this._addedToStage)return!1;for(var c=0,d=this.renderGeometries;c<d.length;c++){var e=d[c],f=e.instanceParameters.componentVisibilities,f=b?a.unhideAllComponents(f):a.hideAllComponents(f);e.instanceParameters.componentVisibilities=f}this._overlayRenderer.updateGeometries(this.renderGeometries,this._layerView,1);return!0}return!1}};b.prototype.destroy=function(){this.stage&&
this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView,1);this._visible=this._addedToStage=!1;this.stage=null};b.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,b){return Math.max(a,b.bsRadius)},0)};b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=f.vec3f64.create());return e.vec3.set(a,0,0,0)};b.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=l.create());return l.empty(a)};b.prototype.addObjectState=
function(a,b){var c=this;0===a&&(this.renderGeometries.forEach(function(a){var d=a.addHighlight();b.addRenderGeometry(a,d,c)}),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView))};b.prototype.removeObjectState=function(a){this.renderGeometries.forEach(function(b){a.removeRenderGeometry(b)})};b.prototype.removeRenderGeometryObjectState=function(a,b){a.removeHighlight(b);this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView)};
b.prototype.computeAttachmentOrigin=function(a){for(var b=0,c=this.renderGeometries;b<c.length;b++)c[b].computeAttachmentOrigin(p)&&(a.draped.origin[0]+=p[0],a.draped.origin[1]+=p[1],a.draped.num++)};b.prototype.getProjectedBoundingBox=function(a,b,e,f,h){return g(this,void 0,void 0,function(){var g,m,r,q;return k(this,function(k){switch(k.label){case 0:l.empty(h);for(g=0;g<this.renderGeometries.length;g++)m=this.renderGeometries[g],this._getRenderGeometryProjectedBoundingRect(m,a,c,e),l.expand(h,
c);if(!b)return[3,5];l.center(h,p);r=void 0;q=d.demResolutionForBoundingBox(h,b);k.label=1;case 1:return k.trys.push([1,3,,4]),[4,b.service.queryElevation(p[0],p[1],f,q)];case 2:return r=k.sent(),[3,4];case 3:return k.sent(),r=null,[3,4];case 4:null!=r&&(h[2]=Math.min(h[2],r),h[5]=Math.max(h[5],r)),k.label=5;case 5:return[2,h]}})})};b.prototype._getRenderGeometryProjectedBoundingRect=function(a,b,c,d){if(this.boundingBox)l.set(q,this.boundingBox);else{var e=a.center;a=a.bsRadius;q[0]=e[0]-a;q[1]=
e[1]-a;q[2]=e[2]-a;q[3]=e[0]+a;q[4]=e[1]+a;q[5]=e[2]+a}b(q,0,2);this.calculateRelativeScreenBounds&&d.push({location:l.center(q),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return l.toRect(q,c)};return b}();var c=h.create(),q=l.create(),p=f.vec3f64.create();return n})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["require","exports","../../../../core/compilerUtils","../../webgl-engine/lib/Util"],function(n,b,m,k){function g(a,b){var c=new Uint8Array(4*a*a),d=
a/2-.5;b/=2;for(var e=0;e<a;e++)for(var f=0;f<a;f++){var h=f+a*e,g=f-d,l=e-d,g=Math.sqrt(g*g+l*l)-b,g=g/a+.5;k.packFloatRGBA(g,c,4*h)}return c}function e(b,c){return a(b,c,!1)}function f(b,c){return a(b,c,!0)}function l(a,b){return c(a,b,!1)}function h(a,b){return c(a,b,!0)}function d(a,b){for(var c=new Uint8Array(4*a*a),d=Math.sqrt(1.25),e=(a-b)/2,f=0;f<a;f++)for(var h=0;h<a;h++){var g=(h-e)/b,l=(f-e+.75)/b;k.packFloatRGBA(Math.max(-(1*g+-.5*l)/d,(1*(g-1)+-.5*-l)/d,-l)*b/a+.5,c,4*(f*a+h))}return c}
function a(a,b,c){c&&(b/=Math.SQRT2);for(var d=new Uint8Array(4*a*a),e=0;e<a;e++)for(var f=0;f<a;f++){var h=f-.5*a+.25,g=-e+.5*a-.75,l=e*a+f;if(c)var m=(h+g)/Math.SQRT2,g=(g-h)/Math.SQRT2,h=m;h=Math.max(Math.abs(h),Math.abs(g))-.5*b;h=h/a+.5;k.packFloatRGBA(h,d,4*l)}return d}function c(a,b,c){c&&(b*=Math.SQRT2);b*=.5;for(var d=new Uint8Array(4*a*a),e=0;e<a;e++)for(var f=0;f<a;f++){var h=f-.5*a,g=-e+.5*a-1,l=e*a+f;if(c)var m=(h+g)/Math.SQRT2,g=(g-h)/Math.SQRT2,h=m;m=void 0;h=Math.abs(h);g=Math.abs(g);
m=h>g?h>b?Math.sqrt((h-b)*(h-b)+g*g):g:g>b?Math.sqrt(h*h+(g-b)*(g-b)):h;m=m/a+.5;k.packFloatRGBA(m,d,4*l)}return d}Object.defineProperty(b,"__esModule",{value:!0});b.createType=function(a,b,c){switch(a){case "circle":return g(b,c);case "square":return e(b,c);case "cross":return l(b,c);case "x":return h(b,c);case "kite":return f(b,c);case "triangle":return d(b,c);default:return m.neverReached(a),g(b,c)}};b.createCircle=g;b.createSquare=e;b.createKite=f;b.createCross=l;b.createX=h;b.createTriangle=
d})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("require exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../renderers/support/utils ../../support/debugFlags".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c){function q(a){return null!==
a&&void 0!==a}function p(a){return"number"===typeof a}function t(a){return"string"===typeof a}function u(a,b){a&&a.push(b)}function r(b,c,d,e,f){var h=b.minSize,g=b.maxSize;if(b.expression)return u(f,"Could not convert size info: expression not supported"),!1;if(b.useSymbolValue)return b=e.symbolSize[d],c.minSize[d]=b,c.maxSize[d]=b,c.offset[d]=c.minSize[d],c.factor[d]=0,c.type[d]=1,!0;if(q(b.field)){if(q(b.stops)){if(2===b.stops.length&&p(b.stops[0].size)&&p(b.stops[1].size))return x(b.stops[0].size,
b.stops[1].size,b.stops[0].value,b.stops[1].value,c,d),c.type[d]=1,!0;u(f,"Could not convert size info: stops only supported with 2 elements");return!1}if(p(h)&&p(g)&&q(b.minDataValue)&&q(b.maxDataValue))return x(h,g,b.minDataValue,b.maxDataValue,c,d),c.type[d]=1,!0;if(null!=a.meterIn[b.valueUnit])return c.minSize[d]=-Infinity,c.maxSize[d]=Infinity,c.offset[d]=0,c.factor[d]=1/a.meterIn[b.valueUnit],c.type[d]=1,!0;if("unknown"===b.valueUnit)return u(f,"Could not convert size info: proportional size not supported"),
!1;u(f,"Could not convert size info: scale-dependent size not supported");return!1}if(!q(b.field)){if(b.stops&&b.stops[0]&&p(b.stops[0].size))return c.minSize[d]=b.stops[0].size,c.maxSize[d]=b.stops[0].size,c.offset[d]=c.minSize[d],c.factor[d]=0,c.type[d]=1,!0;if(p(h))return c.minSize[d]=h,c.maxSize[d]=h,c.offset[d]=h,c.factor[d]=0,c.type[d]=1,!0}u(f,"Could not convert size info: unsupported variant of sizeInfo");return!1}function x(a,b,c,d,e,f){d=0<Math.abs(d-c)?(b-a)/(d-c):0;e.minSize[f]=0<d?a:
b;e.maxSize[f]=0<d?b:a;e.offset[f]=a-c*d;e.factor[f]=d}function w(a,b,c,d){if(a.normalizationField||a.valueRepresentation)return u(d,"Could not convert size info: unsupported property"),null;var e=a.field;if(null!=e&&!t(e))return u(d,"Could not convert size info: field is not a string"),null;if(!b.size)b.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!b.size.field)b.size.field=a.field;else if(a.field!==b.size.field)return u(d,"Could not convert size info: multiple fields in use"),
null;switch(a.axis){case "width":return(e=r(a,b.size,0,c,d))?b:null;case "height":return(e=r(a,b.size,2,c,d))?b:null;case "depth":return(e=r(a,b.size,1,c,d))?b:null;case "width-and-depth":return(e=r(a,b.size,0,c,d))&&r(a,b.size,1,c,d),e?b:null;case null:case void 0:case "all":return(e=(e=(e=r(a,b.size,0,c,d))&&r(a,b.size,1,c,d))&&r(a,b.size,2,c,d))?b:null;default:return u(d,'Could not convert size info: unknown axis "'+a.axis+'""'),null}}function v(a,b,c){for(var d=0;3>d;++d){var e=b.unitInMeters;
1===a.type[d]&&(e*=b.modelSize[d],a.type[d]=2);a.minSize[d]/=e;a.maxSize[d]/=e;a.offset[d]/=e;a.factor[d]/=e}if(0!==a.type[0])b=0;else if(0!==a.type[1])b=1;else if(0!==a.type[2])b=2;else return u(c,"No size axis contains a valid size or scale"),!1;for(d=0;3>d;++d)0===a.type[d]&&(a.minSize[d]=a.minSize[b],a.maxSize[d]=a.maxSize[b],a.offset[d]=a.offset[b],a.factor[d]=a.factor[b],a.type[d]=a.type[b]);return!0}function z(a,b,c){a[4*b+0]=c.r/255;a[4*b+1]=c.g/255;a[4*b+2]=c.b/255;a[4*b+3]=c.a}function y(a,
b,c){if(a.normalizationField)return u(c,"Could not convert color info: unsupported property"),null;if(t(a.field))if(a.stops){if(8<a.stops.length)return u(c,"Could not convert color info: too many color stops"),null;b.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};c=a.stops;for(a=0;8>a;++a){var d=c[Math.min(a,c.length-1)];b.color.values[a]=d.value;z(b.color.colors,a,d.color)}}else return u(c,"Could not convert color info: missing stops or colors"),
null;else if(a.stops&&0<=a.stops.length)for(c=a.stops&&0<=a.stops.length&&a.stops[0].color,b.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},a=0;8>a;a++)b.color.values[a]=Infinity,z(b.color.colors,a,c);else return u(c,"Could not convert color info: no field and no colors/stops"),null;return b}function A(a,b,c){if(a.normalizationField)return u(c,"Could not convert opacity info: unsupported property"),null;if(t(a.field))if(a.stops){if(8<
a.stops.length)return u(c,"Could not convert opacity info: too many opacity stops"),null;b.opacity={field:a.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};c=a.stops;for(a=0;8>a;++a){var d=c[Math.min(a,c.length-1)];b.opacity.values[a]=d.value;b.opacity.opacityValues[a]=d.opacity}}else return u(c,"Could not convert opacity info: missing stops or opacities"),null;else if(a.stops&&0<=a.stops.length)for(c=a.stops&&0<=a.stops.length&&a.stops[0].opacity,b.opacity={field:null,values:[0,0,
0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},a=0;8>a;a++)b.opacity.values[a]=Infinity,b.opacity.opacityValues[a]=c;else return u(c,"Could not convert opacity info: no field and no opacities/stops"),null;return b}function B(a,b,c){a=2===c&&"arithmetic"===a.rotationType;b.offset[c]=a?90:0;b.factor[c]=a?-1:1;b.type[c]=1}function C(a,b,c){if(!t(a.field))return u(c,"Could not convert rotation info: field is not a string"),null;if(!b.rotation)b.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,
0,0]};else if(a.field)if(!b.rotation.field)b.rotation.field=a.field;else if(a.field!==b.rotation.field)return u(c,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return B(a,b.rotation,0),b;case "roll":return B(a,b.rotation,1),b;case null:case void 0:case "heading":return B(a,b.rotation,2),b;default:return u(c,'Could not convert rotation info: unknown axis "'+a.axis+'""'),null}}function F(a,b,c){if(!a)return null;var d=!b.supportedTypes||!!b.supportedTypes.size,
e=!b.supportedTypes||!!b.supportedTypes.color,f=!b.supportedTypes||!!b.supportedTypes.rotation,h=!!b.supportedTypes&&!!b.supportedTypes.opacity,g=a.reduce(function(a,g){if(!a)return a;if(g.valueExpression)return u(c,"Could not convert visual variables: arcade expressions not supported"),null;switch(g.type){case "size":return d?w(g,a,b,c):a;case "color":return e?y(g,a,c):a;case "opacity":return h?A(g,a,c):null;case "rotation":return f?C(g,a,c):a;default:return m.neverReached(g),null}},{size:null,color:null,
opacity:null,rotation:null});return 0<a.length&&g&&!g.size&&!g.color&&!g.opacity&&!g.rotation||g&&g.size&&!v(g.size,b,c)?null:g}function E(a,b,c){if(!!a!==!!b||a&&a.field!==b.field)return!1;if(a&&"rotation"===c)for(c=0;3>c;c++)if(a.type[c]!==b.type[c]||a.offset[c]!==b.offset[c]||a.factor[c]!==b.factor[c])return!1;return!0}function G(a,b){var c={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,
vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},d=a&&null!=a.size;a&&a.size?(c.vvSizeEnabled=!0,c.vvSizeMinSize=a.size.minSize,c.vvSizeMaxSize=a.size.maxSize,c.vvSizeOffset=a.size.offset,c.vvSizeFactor=a.size.factor):a&&d&&(c.vvSizeValue=b.transformation.scale);if(a&&d){c.vvSymbolAnchor=b.transformation.anchor;c.vvSymbolRotationMatrix=e.mat3f64.create();f.mat4.identity(D);var h=b.transformation.rotation[2],d=b.transformation.rotation[0],
k=b.transformation.rotation[1];b=D;void 0===b&&(b=l.mat4f64.create());h=h||0;d=d||0;k=k||0;0!==h&&f.mat4.rotateZ(b,b,-h/180*Math.PI);0!==d&&f.mat4.rotateX(b,b,d/180*Math.PI);0!==k&&f.mat4.rotateY(b,b,k/180*Math.PI);g.mat3.fromMat4(c.vvSymbolRotationMatrix,D)}a&&a.color&&(c.vvColorEnabled=!0,c.vvColorValues=a.color.values,c.vvColorColors=a.color.colors);a&&a.opacity&&(c.vvOpacityEnabled=!0,c.vvOpacityValues=a.opacity.values,c.vvOpacityOpacities=a.opacity.opacityValues);return c}Object.defineProperty(b,
"__esModule",{value:!0});b.convertVisualVariables=F;b.initFastSymbolUpdatesState=function(a,b){return!a||c.DISABLE_FAST_UPDATES?{enabled:!1}:(a=F(a.visualVariables,b))?{enabled:!0,visualVariables:a,materialParameters:G(a,b),requiresShaderTransformation:a&&null!=a.size}:{enabled:!1}};b.updateFastSymbolUpdatesState=function(a,b,c){if(!b||!a.enabled)return!1;var d=a.visualVariables;b=F(b.visualVariables,c);if(!(b&&E(d.size,b.size,"size")&&E(d.color,b.color,"color")&&E(d.rotation,b.rotation,"rotation")&&
E(d.opacity,b.opacity,"opacity")))return!1;a.visualVariables=b;a.materialParameters=G(b,c);a.requiresShaderTransformation=b&&null!=b.size;return!0};b.getMaterialParams=G;var H;(function(a){var b=l.mat4f64.create(),c=d.vec3f64.create();a.evaluateModelTransform=function(a,d,e){if(!a.vvSizeEnabled)return e;f.mat4.copy(b,e);e=a.vvSymbolRotationMatrix;f.mat4.set(D,e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1);f.mat4.multiply(b,b,D);for(e=0;3>e;++e)c[e]=k.clamp(a.vvSizeOffset[e]+d[0]*a.vvSizeFactor[e],
a.vvSizeMinSize[e],a.vvSizeMaxSize[e]);f.mat4.scale(b,b,c);f.mat4.translate(b,b,a.vvSymbolAnchor);return b};a.evaluateModelTransformScale=function(a,b,c){if(!b.vvSizeEnabled)return h.vec3.set(a,1,1,1);for(var d=0;3>d;++d)a[d]=k.clamp(b.vvSizeOffset[d]+c[0]*b.vvSizeFactor[d],b.vvSizeMinSize[d],b.vvSizeMaxSize[d]);return a}})(H||(H={}));var D=l.mat4f64.create();b.evaluateModelTransform=H.evaluateModelTransform;b.evaluateModelTransformScale=H.evaluateModelTransformScale})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/factories/mat4f64 ../../support/mathUtils ./ComponentUtils ./geometryDataUtils ./Object3DStateSet ./Util".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){return function(){function b(a,b,c,d,e,h,g){this.uniqueName=null;this.shaderTransformationDirty=!0;this.data=a.toRenderData();this.componentOffsets=a.componentOffsets;this.boundingInfo=b;this.material=c;this.origin=null;this.center=f.vec3f64.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=e;d&&this.updateTransformation(d,h);this.castShadow=g;this.instanceParameters={}}b.prototype.updateTransformation=function(a,b){this.transformation=
a;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(a,b,this.center)};b.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0};b.prototype.getBoundingSphere=function(a,b,c){b=b||h.maxScale(a);e.vec3.transformMat4(c,this.boundingInfo.getCenter(),a);return this.boundingInfo.getBSRadius()*b};Object.defineProperty(b.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"componentCount",{get:function(){return d.componentCount(this.componentOffsets)},enumerable:!0,configurable:!0});b.prototype.getShaderTransformation=function(){if(!this.calculateShaderTransformation)return m.unwrapOr(this.transformation,l.IDENTITY);this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=g.mat4f64.create()),k.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(m.unwrapOr(this.transformation,l.IDENTITY))),this.shaderTransformationDirty=
!1);return this.shaderTransformation};b.prototype.computeAttachmentOrigin=function(b){if(this.material.computeAttachmentOrigin)return this.material.computeAttachmentOrigin(this,b)?(m.isSome(this.transformation)&&e.vec3.transformMat4(b,b,this.transformation),!0):!1;var c=this.getIndices(q.VertexAttrConstants.POSITION),d=this.getAttribute(q.VertexAttrConstants.POSITION);return a.computeAttachmentOriginTriangles(d,c,b)?(m.isSome(this.transformation)&&e.vec3.transformMat4(b,b,this.transformation),!0):
!1};b.prototype.getIndices=function(a){return"indices"in this.data?this.data.indices[a]:null};b.prototype.getAttribute=function(a){return"vertexAttr"in this.data?this.data.vertexAttr[a]:null};b.prototype.addHighlight=function(){var a=c.generateObject3DStateId(0),b=this.instanceParameters;b.componentHighlights=d.addHighlight(b.componentHighlights,null,a);return a};b.prototype.removeHighlight=function(a){var b=this.instanceParameters;b.componentHighlights=d.removeHighlight(b.componentHighlights,a)};
return b}()})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Evented ../../../../core/mathUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestUtils ../../support/imageUtils ./DDSUtil ./glUtil3D ./IdGen ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A){return function(){function b(a,c,d){this.data=a;this.loadingController=this.loadingPromise=this.powerOfTwoStretchInfo=this.glTexture=null;this.events=new f;this.data=a;this.id=b.idGen.gen(c);this.params=d||{};this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.params.wrap=this.params.wrap||{s:10497,t:10497};this.params.powerOfTwoResizeMode=
this.params.powerOfTwoResizeMode||1;this.estimatedTexMemRequired=b.estimateTexMemRequired(this.data,this.params);this.startPreload()}b.prototype.startPreload=function(){var a=this.data;d.isNone(a)||(a instanceof HTMLVideoElement?this.startPreloadVideoElement(a):a instanceof HTMLImageElement&&this.startPreloadImageElement(a))};b.prototype.startPreloadVideoElement=function(a){q.isBlobProtocol(a.src)||"auto"===a.preload&&a.crossOrigin||(a.preload="auto",a.crossOrigin="anonymous",a.src=a.src)};b.prototype.startPreloadImageElement=
function(a){q.isDataProtocol(a.src)||q.isBlobProtocol(a.src)||a.crossOrigin||(a.crossOrigin="anonymous",a.src=a.src)};b.getDataDimensions=function(a){return a instanceof HTMLVideoElement?{width:a.videoWidth,height:a.videoHeight}:a};b.estimateTexMemRequired=function(a,e){if(d.isNone(a))return 0;if(c.isArrayBuffer(a)||c.isUint8Array(a))return a.byteLength;a=a instanceof Image||a instanceof ImageData||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement?b.getDataDimensions(a):e;return(e.mipmap?
4/3:1)*a.width*a.height*(e.components||4)||0};b.prototype.dispose=function(){this.data=void 0};Object.defineProperty(b.prototype,"width",{get:function(){return this.params.width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this.params.height},enumerable:!0,configurable:!0});b.prototype.createDescriptor=function(a){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?
9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.mipmap&&!this.params.disableAnisotropy?a.parameters.maxMaxAnisotropy:void 0}};b.prototype.load=function(a,e){if(d.isSome(this.glTexture))return this.glTexture;if(d.isSome(this.loadingPromise))return this.loadingPromise;var f=this.data;if(d.isNone(f))return this.glTexture=new z(a,this.createDescriptor(a),null),a.bindTexture(this.glTexture),this.glTexture;if("string"===typeof f)return this.loadFromURL(a,
e,f);if(f instanceof Image)return this.loadFromImageElement(a,e,f);if(f instanceof HTMLVideoElement)return this.loadFromVideoElement(a,e,f);if(f instanceof ImageData||f instanceof HTMLCanvasElement)return this.loadFromImage(a,f,e);if((c.isArrayBuffer(f)||c.isUint8Array(f))&&this.params.encoding===b.DDS_ENCODING)return this.loadFromDDSData(a,f);if(c.isUint8Array(f))return this.loadFromPixelData(a,f);if(c.isArrayBuffer(f))return this.loadFromPixelData(a,new Uint8Array(f));g.neverReachedSilent(f);return null};
Object.defineProperty(b.prototype,"requiresFrameUpdates",{get:function(){return this.data instanceof HTMLVideoElement},enumerable:!0,configurable:!0});b.prototype.frameUpdate=function(a,b,c){if(!(this.data instanceof HTMLVideoElement)||d.isNone(this.glTexture)||2>this.data.readyState||c===this.data.currentTime)return c;if(d.isSome(this.powerOfTwoStretchInfo)){var e=this.powerOfTwoStretchInfo;c=e.framebuffer;var f=e.vao,e=e.sourceTexture;e.setData(this.data);this.drawStretchedTexture(a,b,c,f,e,this.glTexture)}else b=
this.data,a=b.width,b=b.height,f=this.glTexture.descriptor,c=f.width,f=f.height,a!==c||b!==f?this.glTexture.updateData(0,0,0,Math.min(a,c),Math.min(b,f),this.data):this.glTexture.setData(this.data);this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap();return this.data.currentTime};b.prototype.loadFromDDSData=function(a,b){this.glTexture=u.createDDSTexture(a,this.createDescriptor(a),b,this.params.mipmap);a.bindTexture(this.glTexture);return this.glTexture};b.prototype.loadFromPixelData=
function(a,b){w.assert(0<this.params.width&&0<this.params.height);var c=this.createDescriptor(a);c.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408;c.width=this.params.width;c.height=this.params.height;this.glTexture=new z(a,c,b);a.bindTexture(this.glTexture);return this.glTexture};b.prototype.loadAsync=function(b){return k(this,void 0,void 0,function(){var c,d,e,f=this;return m(this,function(h){this.loadingController=c=a.createAbortController();this.loadingPromise=
d=b(c.signal);e=function(){f.loadingController===c&&(f.loadingController=null);f.loadingPromise===d&&(f.loadingPromise=null)};d.then(e,e);return[2,d]})})};b.prototype.loadFromURL=function(a,b,c){var d=this;return this.loadAsync(function(e){return k(d,void 0,void 0,function(){var d;return m(this,function(f){switch(f.label){case 0:return[4,t.requestImage(c,{signal:e})];case 1:return d=f.sent(),[2,this.loadFromImage(a,d,b)]}})})})};b.prototype.loadFromImageElement=function(a,b,c){var d=this;return c.complete?
this.loadFromImage(a,c,b):this.loadAsync(function(e){return k(d,void 0,void 0,function(){var d;return m(this,function(f){switch(f.label){case 0:return[4,p.loadImageAsync(c,c.src,!1,e)];case 1:return d=f.sent(),[2,this.loadFromImage(a,d,b)]}})})})};b.prototype.loadFromVideoElement=function(a,b,c){return 2<=c.readyState?this.loadFromImage(a,c,b):this.loadFromVideoElementAsync(a,b,c)};b.prototype.loadFromVideoElementAsync=function(b,c,f){var h=this;return this.loadAsync(function(g){return a.create(function(l,
k){var m=function(){f.removeEventListener("loadeddata",p);f.removeEventListener("error",r);d.isSome(q)&&q.remove()},p=function(){2<=f.readyState&&(m(),l(h.loadFromImage(b,f,c)))},r=function(a){m();k(a||new e("Failed to load video"))};f.addEventListener("loadeddata",p);f.addEventListener("error",r);var q=a.onAbort(g,function(){return r(a.createAbortError())})})})};b.prototype.loadFromImage=function(a,c,d){var e=b.getDataDimensions(c);this.params.width=e.width;this.params.height=e.height;var f=this.createDescriptor(a);
f.pixelFormat=3===this.params.components?6407:6408;if(this.requiresPowerOfTwo(a,f)&&(!h.isPowerOfTwo(e.width)||!h.isPowerOfTwo(e.height)))return this.glTexture=this.makePowerOfTwoTexture(a,c,e,f,d),a.bindTexture(this.glTexture),this.glTexture;f.width=e.width;f.height=e.height;this.glTexture=new z(a,f,c);a.bindTexture(this.glTexture);return this.glTexture};b.prototype.requiresPowerOfTwo=function(a,b){var c="number"===typeof b.wrapMode?33071===b.wrapMode:33071===b.wrapMode.s&&33071===b.wrapMode.t;return!A.default(a.gl)&&
(b.hasMipmap||!c)};b.prototype.makePowerOfTwoTexture=function(a,b,c,d,e){var f=c.width;c=c.height;var h=l.nextHighestPowerOfTwo(f),k=l.nextHighestPowerOfTwo(c);d.width=h;d.height=k;var m;switch(this.params.powerOfTwoResizeMode){case 2:d.textureCoordinateScaleFactor=[f/h,c/k];m=new z(a,d);m.updateData(0,0,0,f,c,b);break;case 1:case null:case void 0:m=this.stretchToPowerOfTwo(a,b,d,e);break;default:g.neverReached(this.params.powerOfTwoResizeMode)}d.hasMipmap&&m.generateMipmap();return m};b.prototype.stretchToPowerOfTwo=
function(a,b,c,d){var e=new z(a,c),f=new v(a,{colorTarget:0,depthStencilTarget:0},e);b=new z(a,{target:3553,pixelFormat:c.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!c.flipped,maxAnisotropy:8,preMultiplyAlpha:c.preMultiplyAlpha},b);c=r.createQuadVAO(a);this.drawStretchedTexture(a,d,f,c,b,e);this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:c,sourceTexture:b,framebuffer:f}:(c.dispose(!0),b.dispose(),f.detachColorTexture(),a.bindFramebuffer(null),f.dispose());return e};
b.prototype.drawStretchedTexture=function(a,b,c,d,e,f){a.bindFramebuffer(c);c=a.getViewport();a.setViewport(0,0,f.descriptor.width,f.descriptor.height);f=b.program;a.bindProgram(f);f.setUniform4f("color",1,1,1,1);f.setUniform1i("tex",0);a.bindTexture(e,0);a.bindVAO(d);a.setPipelineState(b.pipeline);a.drawArrays(5,0,y.vertexCount(d,"geometry"));a.bindFramebuffer(null);a.setViewport(c.x,c.y,c.width,c.height)};b.prototype.unload=function(){if(d.isSome(this.powerOfTwoStretchInfo)){var a=this.powerOfTwoStretchInfo,
b=a.framebuffer,c=a.sourceTexture;a.vao.dispose(!0);c.dispose();b.dispose();this.powerOfTwoStretchInfo=this.glTexture=null}d.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);d.isSome(this.loadingController)&&(a=this.loadingController,this.loadingPromise=this.loadingController=null,a.abort());this.events.emit("unloaded")};b.idGen=new x.IdGen;b.DDS_ENCODING="image/vnd-ms.dds";return b}()})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require","exports","../../../../core/Logger",
"../../../../core/mathUtils","../../../webgl/Texture"],function(n,b,m,k,g){function e(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function f(b,e){var c=new Int32Array(b,0,31);if(542327876!==c[0])return l.error("Invalid magic number in DDS header"),null;if(!(c[20]&4))return l.error("Unsupported format, must contain a FourCC code"),null;var f=c[21],g;switch(f){case h:f=8;g=33776;break;case d:f=16;g=33778;break;case a:f=16;g=33779;break;default:return l.error("Unsupported FourCC code:",
String.fromCharCode(f&255,f>>8&255,f>>16&255,f>>24&255)),null}var m=1,q=c[4],n=c[3];if(0!==(q&3)||0!==(n&3))l.warn("Rounding up compressed texture size to nearest multiple of 4."),q=q+3&-4,n=n+3&-4;var v=q,z=n;c[2]&131072&&!1!==e&&(m=Math.max(1,c[7]));1===m||k.isPowerOfTwo(q)&&k.isPowerOfTwo(n)||(l.warn("Ignoring mipmaps of non power of two sized compressed texture."),m=1);for(var y=c[1]+4,A=[],B=0;B<m;++B)c=(q+3>>2)*(n+3>>2)*f,e=new Uint8Array(b,y,c),A.push(e),y+=c,q=Math.max(1,q>>1),n=Math.max(1,
n>>1);return{textureData:{type:"compressed",levels:A},internalFormat:g,width:v,height:z}}Object.defineProperty(b,"__esModule",{value:!0});var l=m.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),h=e("DXT1"),d=e("DXT3"),a=e("DXT5");b.createDDSTexture=function(a,b,d,e){var c=f(d,e);d=c.textureData;e=c.internalFormat;var h=c.width,c=c.height;b.samplingMode=1<d.levels.length?9987:9729;b.hasMipmap=1<d.levels.length;b.internalFormat=e;b.width=h;b.height=c;b=new g(a,b,d);a.bindTexture(b);return b};b.createDDSTextureData=
f})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../geometry ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./lineUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function n(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._uniformSize=1;return a}m(n,b);n.prototype.doLoad=function(){return g(this,void 0,void 0,function(){var b;return k(this,function(c){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};
this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?y.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};if(!this._drivenProperties.size){b=null!=this.symbolLayer.size?this.symbolLayer.size:a.px2pt(1);if(0>b)throw new h("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=b}return[2]})})};n.prototype.getMaterialParameters=function(b){var c=
d.get(this.symbolLayer,"material","color"),c=this._getCombinedOpacityAndColor(c);b={width:1,color:c,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:this.symbolLayer.cap||"butt",transparent:1>c[3]||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:b,stipplePattern:this.symbolLayer.stipplePattern?F.createStipplePattern(this.symbolLayer.stipplePattern.map(a.pt2px)):null,stippleOffColor:this.symbolLayer.stippleOffColor?f.toUnitRGBA(this.symbolLayer.stippleOffColor):
null,stippleIntegerRepeats:!0};this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size&&(b.width=a.pt2px(1)):(c=null!=this.symbolLayer.size?this.symbolLayer.size:a.px2pt(1),b.width=a.pt2px(c));return this._fastUpdates&&this._fastUpdates.visualVariables?e({},b,this._fastUpdates.materialParameters):b};Object.defineProperty(n.prototype,"lineMaterial",{get:function(){d.isNone(this._lineMaterial)&&(this._lineMaterial=new E(this.getMaterialParameters(!1),this._getIdHint("_ribbonlinemat")),
this._context.stage.add(3,this._lineMaterial));return this._lineMaterial},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"ringMaterial",{get:function(){d.isNone(this._ringMaterial)&&(this._ringMaterial=new E(this.getMaterialParameters(!0),this._getIdHint("_ribbonlinemat")),this._context.stage.add(3,this._ringMaterial));return this._ringMaterial},enumerable:!0,configurable:!0});n.prototype.destroy=function(){b.prototype.destroy.call(this);d.isSome(this._lineMaterial)&&(this._context.stage.remove(3,
this._lineMaterial.id),this._lineMaterial=null);d.isSome(this._ringMaterial)&&(this._context.stage.remove(3,this._ringMaterial.id),this._ringMaterial=null)};n.prototype.getDrivenSize=function(b){return this._drivenProperties.size&&b.size?a.pt2px(t.getDriverAxisSizeValue(b.size)):1};n.prototype.getSizeFeatureAttributeData=function(a){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?v.getAttributeValue(this._fastUpdates.visualVariables.size.field,a):null};n.prototype.getDrivenColor=
function(a){var b=q.vec4f64.fromValues(1,1,1,1);this._drivenProperties.color&&a.color&&(b[0]=a.color[0],b[1]=a.color[1],b[2]=a.color[2],0<a.color.length&&(b[3]=a.color[3]));this._drivenProperties.opacity&&a.opacity&&(b[3]=a.opacity);return b};n.prototype.getColorFeatureAttributeData=function(a){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?v.getAttributeValue(this._fastUpdates.visualVariables.color.field,a):null};n.prototype.getOpacityFeatureAttributeData=function(a){return this._fastUpdates.enabled&&
this._fastUpdates.visualVariables.opacity?v.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,a):null};n.prototype.createGraphics3DGraphic=function(a){var b=a.graphic,c=b.geometry;if(!this._validateGeometryType(b.geometry,n.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(c))return null;var c="graphic"+b.uid,d=this.getGraphicElevationContext(b);this.ensureDrapedStatus("on-the-ground"===d.mode);return this.draped?this._createAsOverlay(a,this._context.layer.uid):this._createAs3DShape(a,
d,c,b.uid)};n.prototype.applyRendererDiff=function(a,b){for(var c in a.diff)switch(c){case "visualVariables":if(y.updateFastSymbolUpdatesState(this._fastUpdates,b,this._vvConvertOptions))d.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues(this._fastUpdates.materialParameters),d.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};n.prototype.layerOpacityChanged=function(){d.isSome(this._lineMaterial)&&
this.updateMaterialLayerOpacity(this._lineMaterial);d.isSome(this._ringMaterial)&&this.updateMaterialLayerOpacity(this._ringMaterial);return!0};n.prototype.updateMaterialLayerOpacity=function(a){var b=a.getParameters().color,c=d.get(this.symbolLayer,"material","color"),c=this._getCombinedOpacity(c);a.setParameterValues({color:[b[0],b[1],b[2],c],transparent:1>c||this.needsDrivenTransparentPass})};n.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;c=r.elevationModeChangeUpdateType(n.elevationModeChangeTypes,
c,d);if(c!==r.SymbolUpdateType.UPDATE)return c;var e=r.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};n.prototype.slicePlaneEnabledChanged=function(){d.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});d.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};n.prototype.physicalBasedRenderingChanged=function(){return!0};
n.prototype.pixelRatioChanged=function(){return!0};n.prototype._getGeometryAsPolygonOrPolyline=function(a){switch(a.type){case "extent":if(a instanceof l.Extent)return l.Polygon.fromExtent(a);break;case "polygon":case "polyline":return a}return null};n.prototype._createAs3DShape=function(a,b,e,f){var h=this._getGeometryAsPolygonOrPolyline(a.graphic.geometry),g="polygon"===h.type?h.rings:h.paths,l=[],k=[],m=[],q=p.create(),t=z.geometryToRenderInfo(h,this._context.elevationProvider,this._context.renderCoordsHelper,
b);this._logGeometryCreationWarnings(t,g,"polygon"===h.type?"rings":"paths","LineSymbol3DLayer");for(g=0;g<t.lines.length;g++){var n=t.lines[g],v=n.position,n=n.mapPosition;if(d.isSome(this._context.clippingExtent)&&(p.empty(q),p.expandWithBuffer(q,n),!p.intersectsClippingArea(q,this._context.clippingExtent)))continue;v=this._createGeometryData(a,v,n,h.type);v=new A(v,e+"path"+g);l.push(v);k.push("polygon"===h.type?this.ringMaterial:this.lineMaterial);m.push(c.mat4f64.IDENTITY)}if(0===l.length)return null;
a=new B({geometries:l,materials:k,transformations:m,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:f},idHint:e});l=new w(this,a,l,null,null,u.perVertexElevationAligner,b);l.alignedSampledElevation=t.sampledElevation;l.needsElevationUpdates=r.needsElevationUpdates2D(b.mode);return l};n.prototype._createGeometryData=function(a,b,c,d){var e=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color;return z.createGeometryData({removeDuplicateStartEnd:"polygon"===d?1:0,uniformSize:this._uniformSize,
attributeData:{position:b,mapPosition:c,size:this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?null:this.getDrivenSize(a.renderingInfo),color:e?null:this.getDrivenColor(a.renderingInfo),sizeFeature:this.getSizeFeatureAttributeData(a.graphic),colorFeature:this.getColorFeatureAttributeData(a.graphic),opacityFeature:this.getOpacityFeatureAttributeData(a.graphic)}})};n.prototype._createAsOverlay=function(a,b){var c=a.graphic,d=this._getGeometryAsPolygonOrPolyline(c.geometry),e="polygon"===
d.type?d.rings:d.paths,f="polygon"===d.type?this.ringMaterial:this.lineMaterial;f.renderPriority=this._renderPriority;var h=[],g=p.create(),l=p.empty(),k=z.geometryToRenderInfoDraped(d,this._context.overlaySR);this._logGeometryCreationWarnings(k,e,"polygon"===d.type?"rings":"paths","LineSymbol3DLayer");if(0<e.length){e=k.lines;for(k=0;k<e.length;++k){var m=e[k];p.empty(g);p.expandWithBuffer(g,m.position);p.intersectsClippingArea(g,this._context.clippingExtent)&&(p.expand(l,g),m=this._createGeometryData(a,
m.position,null,d.type),m=new C(m),m.data.layerUid=b,m.data.graphicUid=c.uid,m.material=f,m.center=[.5*(g[0]+g[3]),.5*(g[1]+g[4]),0],m.bsRadius=.5*Math.sqrt((g[3]-g[0])*(g[3]-g[0])+(g[4]-g[1])*(g[4]-g[1])),h.push(m))}return new x(this,h,l)}return null};n.validGeometryTypes=["polyline","polygon","extent"];n.elevationModeChangeTypes={definedChanged:r.SymbolUpdateType.RECREATE,staysOnTheGround:r.SymbolUpdateType.NONE,onTheGroundChanged:r.SymbolUpdateType.RECREATE};return n}(v.Graphics3DSymbolLayer);
b.Graphics3DLineSymbolLayer=n;b.default=n})},"esri/views/3d/layers/graphics/lineUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/mathUtils ../../../../core/maybe ../../../../core/typedArrayUtil ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/triangulationUtils ./constants ./elevationAlignmentUtils ../../support/projectionUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/GeometryData ../../webgl-engine/shaders/RibbonLineTechnique".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t){function u(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=a[e],h=f.count;1>=h||(f=3*f.index,h=f+3*h,d.push({position:b.subarray(f,h),mapPosition:c?c.subarray(f,h):void 0}))}return d}Object.defineProperty(b,"__esModule",{value:!0});b.createGeometryData=function(a){for(var b={},c={},h=a.attributeData.position,l=a.removeDuplicateStartEnd,m=h.length,q=h[0]===h[m-3]&&h[1]===h[m-2]&&h[2]===h[m-1]&&1===l,l=h.length/3-(q?1:0),m=new Uint32Array(2*(l-1)),h=q?e.slice(h,
0,h.length-3):h,u=q=0;u<l-1;u++)m[q++]=u,m[q++]=u+1;c[t.RibbonVertexAttributeConstants.POSITION]={size:3,data:h,offsetIdx:0,strideIdx:3};b[t.RibbonVertexAttributeConstants.POSITION]=m;l=new Uint32Array(b[t.RibbonVertexAttributeConstants.POSITION].length);m=a.attributeData.mapPosition;g.isNone(m)||(b.mapPos=b[t.RibbonVertexAttributeConstants.POSITION],c.mapPos={size:3,data:m,offsetIdx:0,strideIdx:3});g.isSome(a.attributeData.colorFeature)||(c[t.RibbonVertexAttributeConstants.COLOR]={size:4,data:g.unwrapOr(a.attributeData.color,
d.WHITE_UNIT),offsetIdx:0,strideIdx:4},b[t.RibbonVertexAttributeConstants.COLOR]=l);g.isSome(a.attributeData.sizeFeature)||(c[t.RibbonVertexAttributeConstants.SIZE]={size:1,data:new Float32Array([g.unwrapOr(a.attributeData.size,1)]),offsetIdx:0,strideIdx:1},b[t.RibbonVertexAttributeConstants.SIZE]=l);m=a.attributeData.colorFeature;g.isNone(m)||(c[t.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE]={size:1,data:new Float32Array([m]),offsetIdx:0,strideIdx:1},b[t.RibbonVertexAttributeConstants.COLOR]=
l);m=a.attributeData.sizeFeature;g.isNone(m)||(c[t.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]={size:1,data:new Float32Array([m]),offsetIdx:0,strideIdx:1},b[t.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]=l);m=a.attributeData.opacityFeature;g.isNone(m)||(c[t.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]={size:1,data:new Float32Array([m]),offsetIdx:0,strideIdx:1},b[t.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]=l);if("round"===a.join){l=c[t.RibbonVertexAttributeConstants.POSITION].data;
m=l.length/3;h=new Float32Array(m);q=r;u=x;f.vec3.set(q,0,0,0);a=g.unwrapOr(a.uniformSize,1);for(var n=-1;n<m;++n){var v=0>n?m+n:n,D=(n+1)%m;f.vec3.set(u,l[3*D+0]-l[3*v+0],l[3*D+1]-l[3*v+1],l[3*D+2]-l[3*v+2]);f.vec3.normalize(u,u);0<=n&&(v=1*(Math.PI-k.acosClamped(f.vec3.dot(q,u)))*w*(1.863798+-2.0062872/Math.pow(1+a/18.2313,.8856294)),h[n]=Math.max(Math.floor(v),0));f.vec3.scale(q,u,-1)}c[t.RibbonVertexAttributeConstants.SUBDIVISIONS]={size:1,data:h,offsetIdx:0,strideIdx:1};b[t.RibbonVertexAttributeConstants.SUBDIVISIONS]=
b[t.RibbonVertexAttributeConstants.POSITION]}return new p.GeometryData(c,b,p.GeometryData.DefaultOffsets,"line")};b.geometryToRenderInfo=function(b,c,d,e){var f=h.pathsToTriangulationInfo("polygon"===b.type?b.rings:b.paths,b.hasZ,"polygon"===b.type?1:0),g=f.position,f=f.outlines,l=new Float64Array(g.length);b=a.applyPerVertexElevationAlignment(g,b.spatialReference,0,l,0,g,0,g.length/3,c,d,e);c=null!=b;return{lines:c?u(f,g,l):[],projectionSuccess:c,sampledElevation:b}};b.geometryToRenderInfoDraped=
function(a,b){var d=h.pathsToTriangulationInfo("polygon"===a.type?a.rings:a.paths,!1,"polygon"===a.type?1:0),e=d.position,d=d.outlines;a=c.bufferToBuffer(e,a.spatialReference,0,e,b,0,e.length/3);for(b=2;b<e.length;b+=3)e[b]=q.DRAPED_Z;return{lines:a?u(d,e):[],projectionSuccess:a}};var r=l.vec3f64.create(),x=l.vec3f64.create(),w=4/Math.PI})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/webMercatorUtils ../../../../geometry/support/meshUtils/projection ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L,O,K,N,Q){Object.defineProperty(b,"__esModule",{value:!0});var M=K.VertexAttrConstants;n=function(a){function b(b,c,d,e){b=a.call(this,b,c,d,e)||this;b._materials=new Map;b._textures=new Map;b.ensureDrapedStatus(!1);return b}m(b,a);b.prototype.doLoad=function(){return g(this,void 0,void 0,function(){return k(this,function(a){G.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Q({color:[1,0,1,1]},"debugVertexNormal"),
this._debugFaceNormalMaterial=new Q({color:[0,1,1,1]},"debugFAceNormal"));return[2]})})};b.prototype.destroy=function(){var b=this;a.prototype.destroy.call(this);this._materials.forEach(function(a){b._context.stage.remove(3,a.material.id)});this._textures.forEach(function(a){b._context.stage.remove(4,a.id)});this._materials.clear();this._textures.clear()};b.prototype.createGraphics3DGraphic=function(a){var c=a.graphic;if(!this._validateGeometryType(c.geometry,b.validGeometryTypes,"fill on mesh-3d")||
!this._validateGeometry(c.geometry))return null;var d="graphic"+c.uid,e=this.getGraphicElevationContext(c);return this._createAs3DShape(c,a.renderingInfo,e,d,c.uid)};b.prototype.layerOpacityChanged=function(a,b){var c=this,d=this._getLayerOpacity();this._materials.forEach(function(a){a.material.setParameterValues({layerOpacity:d});var b=a.material.getParameters();c._setMaterialTransparentParameter(b,a);a.material.setParameterValues({transparent:b.transparent})});a.forEach(function(a){a=b(a);h.isSome(a)&&
a.layerOpacityChanged(d,c._context.isAsync)});return!0};b.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,A.needsElevationUpdates3D)};b.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;this._materials.forEach(function(a){a.material.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});a.forEach(function(a){a=b(a);h.isSome(a)&&a.slicePlaneEnabledChanged(c._context.slicePlaneEnabled,c._context.isAsync)});return!0};b.prototype.physicalBasedRenderingChanged=
function(){var a=this;this._materials.forEach(function(b){var c=b.material.getParameters().isSchematic;b.material.setParameterValues({usePBR:a._usePBR(c)})});return!0};b.prototype.pixelRatioChanged=function(){return!0};b.prototype._requiresSymbolVertexColors=function(){return this._drivenProperties.color||this._drivenProperties.opacity};b.prototype._colorOrTextureUid=function(a){return a?a instanceof f?a.toHex():a.contentHash:"-"};b.prototype._materialPropertiesDefault=function(a,b){var c=this._requiresSymbolVertexColors(),
d=!!a.vertexAttributes.color;a=!!a.vertexAttributes.tangent;return{hasSymbolVertexColors:c,hasVertexColors:d,hasVertexTangents:a,uid:"vc:"+d+",vt:"+a+",vct"+b+",svc:"+c}};b.prototype._materialProperties=function(a,b,c){a=this._materialPropertiesDefault(a,c);if(!b.material)return a;var d=b.material;c=d.color;var e=d.colorTexture,f=d.normalTexture,h=d.doubleSided,g=d.alphaCutoff,d=d.alphaMode,l=this._colorOrTextureUid(c),k=this._colorOrTextureUid(e),m=this._colorOrTextureUid(f);a.color=c;a.colorTexture=
e;a.normalTexture=f;a.uid=a.uid+",cmuid:"+l+",ctmuid:"+k+",ntmuid:"+m+",ds:"+h+",ac:"+g+",am:"+d;b.material instanceof w&&(g=b.material,b=g.metallic,c=g.roughness,e=g.metallicRoughnessTexture,f=g.emissiveColor,h=g.emissiveTexture,g=g.occlusionTexture,d=this._colorOrTextureUid(e),l=this._colorOrTextureUid(f),k=this._colorOrTextureUid(h),m=this._colorOrTextureUid(g),a.metallic=b,a.roughness=c,a.metallicRoughnessTexture=e,a.emissiveColor=f,a.emissiveTexture=h,a.occlusionTexture=g,a.uid=a.uid+",mrm:"+
b+",mrr:"+c+",mrt:"+d+",emuid:"+l+",etmuid:"+k+",otmuid:"+m);return a};b.prototype._setInternalColorValueParameters=function(a,b){b.diffuse=f.toUnitRGB(a);b.opacity=a.a};b.prototype._getLoadableTextureResource=function(a){return a.data?a.data:a.url};b.prototype._getInternalTextureId=function(a,b){var c=this._getLoadableTextureResource(a);if(c){var d=a.contentHash,e=this._textures.get(d);e||(e=new O(c,b+"_"+d+"_tex",{mipmap:!0,wrap:this._castTextureWrap(a.wrap),noUnpackFlip:!0,preMultiplyAlpha:!0}),
this._textures.set(d,e),this._context.stage.add(4,e));return e.id}};b.prototype._castTextureWrap=function(a){void 0===a&&(a="repeat");return"string"===typeof a?(a=this._castTextureWrapIndividual(a),{s:a,t:a}):{s:this._castTextureWrapIndividual(a.horizontal),t:this._castTextureWrapIndividual(a.vertical)}};b.prototype._castTextureWrapIndividual=function(a){switch(a){case "clamp":return 33071;case "mirror":return 33648;default:return 10497}};b.prototype._setInternalMaterialParameters=function(a,b,c){a.color&&
this._setInternalColorValueParameters(a.color,c);a.colorTexture&&(c.textureId=this._getInternalTextureId(a.colorTexture,b));a.normalTexture&&(c.normalTextureId=this._getInternalTextureId(a.normalTexture,b));a.emissiveColor&&(c.emissiveFactor=f.toUnitRGB(a.emissiveColor));a.emissiveTexture&&(c.emissiveTextureId=this._getInternalTextureId(a.emissiveTexture,b));a.occlusionTexture&&(c.occlusionTextureId=this._getInternalTextureId(a.occlusionTexture,b));a.metallicRoughnessTexture&&(c.metallicRoughnessTextureId=
this._getInternalTextureId(a.metallicRoughnessTexture,b))};b.prototype._setExternalMaterialParameters=function(a){var b=this._drivenProperties.color,c=h.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;b?a.externalColor=u.vec4f64.ONES:(b=h.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,h.isSome(b)?a.externalColor=f.toUnitRGBA(b):(c=null,a.externalColor=u.vec4f64.ONES));c&&(a.colorMixMode=c)};b.prototype._hasTransparentVertexColors=function(a){a=
a.vertexAttributes.color;if(!a)return!1;for(var b=3;b<a.length;b+=4)if(255!==a[b])return!0;return!1};b.prototype._getOrCreateMaterial=function(a,b){var c=b.material&&b.material.color,d=b.material&&b.material.colorTexture,e=b.material&&"blend"===b.material.alphaMode,c=!(b.material&&"opaque"===b.material.alphaMode)&&(this._hasTransparentVertexColors(a)||c&&1>c.a||d&&d.transparent||e);a=this._materialProperties(a,b,c);if(d=this._materials.get(a.uid))return d.material;var c={material:null,isComponentTransparent:c,
alphaMode:b.material?b.material.alphaMode:"opaque"},d=this._getIdHint(),e=null==a.metallicRoughnessTexture&&null==a.metallic&&null==a.roughness,f={usePBR:this._usePBR(e),isSchematic:e,vertexColors:a.hasVertexColors,symbolColors:a.hasSymbolVertexColors,vertexTangents:a.hasVertexTangents,ambient:t.vec3f64.ZEROS,diffuse:t.vec3f64.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:0,textureAlphaPremultiplied:!0,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,
initTextureTransparent:!0};e||(f.mrrFactors=[null!=a.metallic?a.metallic:1,null!=a.roughness?a.roughness:1,.5]);b.material&&(f.doubleSided=b.material.doubleSided,f.cullFace=b.material.doubleSided?0:2,f.textureAlphaCutoff=b.material.alphaCutoff);this._setInternalMaterialParameters(a,d,f);this._setExternalMaterialParameters(f);this._setMaterialTransparentParameter(f,c);b=new N(f,d+"_"+a.uid+"_mat");c.material=b;this._materials.set(a.uid,c);this._context.stage.add(3,b);return b};b.prototype._usePBR=
function(a){return a?this._context.physicalBasedRenderingEnabled:!0};b.prototype._setMaterialTransparentParameter=function(a,b){a.transparent=this.needsDrivenTransparentPass||b.isComponentTransparent||1>a.layerOpacity||1>a.opacity||a.externalColor&&1>a.externalColor[3];a.textureAlphaMode="auto"===b.alphaMode?a.transparent?"maskBlend":"opaque":b.alphaMode};b.prototype._addDebugNormals=function(a,b,c,d){var e,f,h,g,l=b.length,k=a.spatialReference.isGeographic?20015077/180:1,m=.1*Math.max(a.extent.width*
k,a.extent.height*k,a.extent.zmax-a.extent.zmin),r=[],u=[];a=[];for(var k=[],t=0;t<l;t++)for(var n=b[t],v=n.data.getAttribute(M.POSITION),w=n.data.getAttribute(M.NORMAL),x=n.data.getIndices(M.POSITION),n=n.data.getIndices(M.NORMAL),v=v.data,w=w.data,y=0;y<x.length;y++){for(var z=3*x[y],A=3*n[y],B=0;3>B;B++)r.push(v[z+B]);for(B=0;3>B;B++)r.push(v[z+B]+w[A+B]*m);u.push(u.length);u.push(u.length);if(0===y%3){this._calculateFaceNormal(v,x,y,J);this._getFaceVertices(v,x,y,P,S,V);p.vec3.add(P,P,S);p.vec3.add(P,
P,V);p.vec3.scale(P,P,1/3);for(B=0;3>B;B++)a.push(P[B]);for(B=0;3>B;B++)a.push(P[B]+J[B]*m);k.push(k.length);k.push(k.length)}}l=(e={},e[M.POSITION]={data:new Float64Array(r),size:3},e);e=(f={},f[M.POSITION]=new Uint32Array(u),f);f=new I.GeometryData(l,e,void 0,"line");f=new D(f,"debugVertexNormal");b.push(f);c.push(this._debugVertexNormalMaterial);d.push(q.mat4f64.clone(d[0]));l=(h={},h[M.POSITION]={data:new Float64Array(a),size:3},h);e=(g={},g[M.POSITION]=new Uint32Array(k),g);f=new I.GeometryData(l,
e,void 0,"line");f=new D(f,"debugFaceNormal");b.push(f);c.push(this._debugFaceNormalMaterial);d.push(q.mat4f64.clone(d[0]))};b.prototype._createAs3DShape=function(a,b,c,d,e){a=a.geometry;if("mesh"!==a.type)return null;var f=this._createGeometryInfo(a,b,d);if(!f)return null;b=f.geometries;var g=f.materials,l=f.transformations,f=f.objectTransformation;G.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(a,b,g,l);e=new L({geometries:b,materials:g,transformations:l,castShadow:!0,metadata:{layerUid:this._context.layer.uid,
graphicUid:e},idHint:d});e.objectTransformation=f;d=y.perObjectElevationAligner;l=this._createEdgeMaterial();g=h.isSome(l)?{baseMaterial:g[0],edgeMaterials:[l],addObjectSettings:{mergeGeometries:!0},slicePlaneEnabled:this._context.slicePlaneEnabled}:null;b=new B(this,e,b,null,null,d,c,g);b.needsElevationUpdates=A.needsElevationUpdates3D(c.mode);c=a.extent.center.clone();c.z=0;b.elevationContext.centerPointInElevationSR=c;b.alignedSampledElevation=d(b,b.elevationContext,this._context.elevationProvider,
this._context.renderCoordsHelper);return b};b.prototype._createComponentNormals=function(a,b,c,d){var e=c.shading||"flat";switch(e){case "source":return this._createComponentNormalsSource(a,b,c,d);case "flat":return this._createComponentNormalsFlat(a,d);case "smooth":return this._createComponentNormalsSmooth(a,d);default:l.neverReached(e)}};b.prototype._createComponentNormalsSource=function(a,b,c,d){if(!b)return this._createComponentNormalsFlat(a,d);var e=!1;if(!c.trustSourceNormals)for(c=0;c<d.length;c+=
3){this._calculateFaceNormal(a,d,c,J);for(var f=0;3>f;f++){var h=3*d[c+f];P[0]=b[h+0];P[1]=b[h+1];P[2]=b[h+2];0>p.vec3.dot(J,P)&&(b[h+0]=-b[h+0],b[h+1]=-b[h+1],b[h+2]=-b[h+2],e=!0)}}return{normals:b,indices:d,didFlipNormals:e}};b.prototype._createComponentNormalsFlat=function(a,b){for(var c=new Float32Array(b.length),d=new Uint32Array(3*b.length),e=0;e<b.length;e+=3)for(var f=this._calculateFaceNormal(a,b,e,J),h=0;3>h;h++)c[e+h]=f[h],d[e+h]=e/3;return{normals:c,indices:d,didFlipNormals:!1}};b.prototype._createComponentNormalsSmooth=
function(a,b){for(var c={},d=0;d<b.length;d+=3)for(var e=this._calculateFaceNormal(a,b,d,J),f=0;3>f;f++){var h=b[d+f],g=c[h];g||(g={normal:t.vec3f64.create(),count:0},c[h]=g);p.vec3.add(g.normal,g.normal,e);g.count++}a=new Float32Array(3*b.length);e=new Uint32Array(3*b.length);for(d=0;d<b.length;d++){h=b[d];g=c[h];1!==g.count&&(p.vec3.normalize(g.normal,g.normal),g.count=1);for(f=0;3>f;f++)a[3*d+f]=g.normal[f];e[d]=d}return{normals:a,indices:e,didFlipNormals:!1}};b.prototype._getFaceVertices=function(a,
b,c,d,e,f){var h=3*b[c+0],g=3*b[c+1];b=3*b[c+2];d[0]=a[h+0];d[1]=a[h+1];d[2]=a[h+2];e[0]=a[g+0];e[1]=a[g+1];e[2]=a[g+2];f[0]=a[b+0];f[1]=a[b+1];f[2]=a[b+2]};b.prototype._calculateFaceNormal=function(a,b,c,d){this._getFaceVertices(a,b,c,P,S,V);p.vec3.subtract(S,S,P);p.vec3.subtract(V,V,P);p.vec3.cross(P,S,V);p.vec3.normalize(d,P);return d};b.prototype._getOrCreateComponents=function(a){return a.components?a.components:R};b.prototype._createPositionBuffer=function(a){var b=a.vertexAttributes.position,
c=new Float64Array(b.length);H.bufferToBuffer(a.vertexAttributes.position,a.spatialReference,0,c,this._context.renderCoordsHelper.spatialReference,0,b.length/3);return c};b.prototype._createNormalBuffer=function(a,b){var c=a.vertexAttributes.normal;if(!c)return null;if("local"===this._context.layerView.view.viewingMode)return c;var d=a.vertexAttributes.position,e=new Float32Array(c.length);return z.projectNormalToECEF(c,d,b,a.spatialReference,e)};b.prototype._createTangentBuffer=function(a,b){var c=
a.vertexAttributes.tangent;if(!c)return null;if("local"===this._context.layerView.view.viewingMode)return c;var d=a.vertexAttributes.position,e=new Float32Array(c.length);return z.projectTangentToECEF(c,d,b,a.spatialReference,e)};b.prototype._createColorBuffer=function(a){return a.vertexAttributes.color};b.prototype._createSymbolColorBuffer=function(a){if(this._requiresSymbolVertexColors()){a=this._getVertexOpacityAndColor(a);var b=E.parseColorMixMode(h.get(this.symbolLayer,"material","colorMixMode")),
c=new Uint8Array(4);E.encodeSymbolColor(a,b,c);return c}return null};b.prototype._createColorIndices=function(a){a=new Uint32Array(a.length);for(var b=0;b<a.length;b++)a[b]=0;return a};b.prototype._createBuffers=function(a,b){var c=a.vertexAttributes&&a.vertexAttributes.position;if(!c)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var d=a.vertexAttributes.normal,e=a.vertexAttributes.uv,f=a.vertexAttributes.tangent;if(d&&d.length!==c.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),
null;if(f&&f.length/4!==c.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(e&&e.length/2!==c.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;c=this._createPositionBuffer(a);d=this._createColorBuffer(a);b=this._createSymbolColorBuffer(b);var f=this._createNormalBuffer(a,c),h=this._createTangentBuffer(a,c);a=this._transformCenterLocal(a,
c,f);return{positionBuffer:c,normalBuffer:f,tangentBuffer:h,uvBuffer:e,colorBuffer:d,symbolColorBuffer:b,objectTransformation:a}};b.prototype._transformCenterLocal=function(a,b,e){var f=a.extent.center,h=this._context.renderCoordsHelper.spatialReference;T[0]=f.x;T[1]=f.y;T[2]=0;f=q.mat4f64.create();H.computeLinearTransformation(a.spatialReference,T,f,h);c.mat4.invert(U,f);for(a=0;a<b.length;a+=3)P[0]=b[a+0],P[1]=b[a+1],P[2]=b[a+2],p.vec3.transformMat4(P,P,U),b[a+0]=P[0],b[a+1]=P[1],b[a+2]=P[2];if(e)for(d.mat3.fromMat4(Y,
f),d.mat3.transpose(Y,Y),a=0;a<e.length;a+=3)P[0]=e[a+0],P[1]=e[a+1],P[2]=e[a+2],p.vec3.transformMat3(P,P,Y),e[a+0]=P[0],e[a+1]=P[1],e[a+2]=P[2];return f};b.prototype._validateFaces=function(a,b){a=a.vertexAttributes.position.length/3;if(b=b.faces){for(var c=-1,d=0;d<b.length;d++){var e=b[d];e>c&&(c=e)}if(a<=c)return this.logger.warn("Vertex index "+c+" is out of bounds of the mesh position buffer"),!1}else if(0!==a%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),
!1;return!0};b.prototype._getOrCreateFaces=function(a,b){if(b.faces)return b.faces;a=new Uint32Array(a.vertexAttributes.position.length/3);for(b=0;b<a.length;b++)a[b]=b;return a};b.prototype._isOutsideClippingArea=function(a){if(!this._context.clippingExtent)return!1;var b=a.vertexAttributes&&a.vertexAttributes.position;if(!b)return!1;var c=this._context.elevationProvider.spatialReference,d=b.length/3;a.spatialReference.equals(c)||(b=new Float64Array(b.length),H.bufferToBuffer(a.vertexAttributes.position,
a.spatialReference,0,b,c,0,d));r.empty(X);r.expandWithBuffer(X,b,0,d);return!r.intersectsClippingArea(X,this._context.clippingExtent)};b.prototype._createGeometryInfo=function(a,b,c){var d,e;if(!v.canProject(a,this._context.layerView.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(a))return null;var f=this._createBuffers(a,b);if(!f)return null;b=f.positionBuffer;for(var h=f.uvBuffer,g=f.colorBuffer,l=
f.symbolColorBuffer,k=f.normalBuffer,m=f.tangentBuffer,f=f.objectTransformation,p=[],r=[],u=[],t=!1,n=0,w=this._getOrCreateComponents(a);n<w.length;n++){var x=w[n];if(!this._validateFaces(a,x))return null;var y=this._getOrCreateFaces(a,x);if(0!==y.length){var z=this._createComponentNormals(b,k,x,y);z.didFlipNormals&&(t=!0);var A=(d={},d[M.POSITION]={size:3,data:b},d[M.NORMAL]={size:3,data:z.normals},d),z=(e={},e[M.POSITION]=y,e[M.NORMAL]=z.indices,e);g&&(A[M.COLOR]={size:4,data:g},z[M.COLOR]=y);l&&
(A[M.SYMBOLCOLOR]={size:4,data:l},z[M.SYMBOLCOLOR]=this._createColorIndices(y));a.vertexAttributes.uv&&(A[M.UV0]={size:2,data:h},z[M.UV0]=y);a.vertexAttributes.tangent&&(A[M.TANGENT]={size:4,data:m},z[M.TANGENT]=y);y=new I.GeometryData(A,z);y=new D(y,c+"_mesh");p.push(y);r.push(q.mat4f64.create());u.push(this._getOrCreateMaterial(a,x))}}t&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:p,transformations:r,materials:u,objectTransformation:f}};b.prototype._createEdgeMaterial=function(){var a={opacity:this._getLayerOpacity()};return F.createMaterial(this.symbolLayer,a)};b.validGeometryTypes=["mesh"];return b}(C.default);b.Graphics3DMeshFillSymbolLayer=n;var T=t.vec3f64.create(),P=t.vec3f64.create(),S=t.vec3f64.create(),V=t.vec3f64.create(),J=t.vec3f64.create(),U=q.mat4f64.create(),Y=a.mat3f64.create(),X=r.create(),R=[new x];b.default=n})},"esri/geometry/support/MeshComponent":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){var q=f.getLogger("esri.geometry.support.MeshComponent");return function(b){function f(a){a=b.call(this,a)||this;a.faces=null;a.material=null;a.shading="source";a.trustSourceNormals=!1;return a}m(f,b);g=f;f.from=function(a){return h.ensureClass(g,a)};f.prototype.castFaces=function(a){return c.castArray(a,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},q)};f.prototype.castMaterial=function(b){return b&&"object"===typeof b&&("metallic"in b||"roughness"in
b||"metallicRoughnessTexture"in b)?h.ensureClass(a,b):h.ensureClass(d,b)};f.prototype.clone=function(){return new g({faces:e.clone(this.faces),shading:this.shading,material:e.clone(this.material),trustSourceNormals:this.trustSourceNormals})};f.prototype.cloneWithDeduplication=function(a,b){return new g({faces:e.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(a,b):null,trustSourceNormals:this.trustSourceNormals})};var g;k([l.property({json:{write:!0}})],
f.prototype,"faces",void 0);k([l.cast("faces")],f.prototype,"castFaces",null);k([l.property({type:d,json:{write:!0}})],f.prototype,"material",void 0);k([l.cast("material")],f.prototype,"castMaterial",null);k([l.property({type:String,json:{write:!0}})],f.prototype,"shading",void 0);k([l.property({type:Boolean})],f.prototype,"trustSourceNormals",void 0);return f=g=k([l.subclass("esri.geometry.support.MeshComponent")],f)}(l.declared(g))})},"esri/geometry/support/MeshMaterial":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/JSONSupport ../../core/lang ../../core/maybe ../../core/accessorSupport/decorators ./MeshTexture".split(" "),
function(n,b,m,k,g,e,f,l,h,d){return function(a){function b(b){b=a.call(this,b)||this;b.color=null;b.colorTexture=null;b.normalTexture=null;b.alphaMode="auto";b.alphaCutoff=.5;b.doubleSided=!0;return b}m(b,a);e=b;b.prototype.clone=function(){return this.cloneWithDeduplication(null,new Map)};b.prototype.cloneWithDeduplication=function(a,b){var c=l.isSome(a)?a.get(this):null;if(c)return c;b=new e(this.clonePropertiesWithDeduplication(b));l.isSome(a)&&a.set(this,b);return b};b.prototype.clonePropertiesWithDeduplication=
function(a){return{color:f.clone(this.color),colorTexture:this.colorTexture?this.colorTexture.cloneWithDeduplication(a):null,normalTexture:this.normalTexture?this.normalTexture.cloneWithDeduplication(a):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}};var e;k([h.property({type:g,json:{write:!0}})],b.prototype,"color",void 0);k([h.property({type:d,json:{write:!0}})],b.prototype,"colorTexture",void 0);k([h.property({type:d,json:{write:!0}})],b.prototype,"normalTexture",
void 0);k([h.property({json:{write:!0}})],b.prototype,"alphaMode",void 0);k([h.property({json:{write:!0}})],b.prototype,"alphaCutoff",void 0);k([h.property({json:{write:!0}})],b.prototype,"doubleSided",void 0);return b=e=k([h.subclass("esri.geometry.support.MeshMaterial")],b)}(h.declared(e.JSONSupport))})},"esri/geometry/support/MeshTexture":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper @dojo/framework/shim/WeakMap ../../core/compilerUtils ../../core/JSONSupport ../../core/urlUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../views/support/screenshotUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){var c=new g.default,q=0;return function(b){function f(a){a=b.call(this,a)||this;a.wrap="repeat";return a}m(f,b);g=f;Object.defineProperty(f.prototype,"url",{get:function(){return this._get("url")||null},set:function(a){this._set("url",a);a&&this._set("data",null)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"data",{get:function(){return this._get("data")||null},set:function(a){this._set("data",a);a&&this._set("url",null)},enumerable:!0,configurable:!0});
f.prototype.writeData=function(a,b,c,d){a instanceof HTMLImageElement?a={type:"image-element",src:l.toJSON(a.src,d),crossOrigin:a.crossOrigin}:a instanceof HTMLCanvasElement?(a=a.getContext("2d").getImageData(0,0,a.width,a.height),a={type:"canvas-element",imageData:this.encodeImageData(a)}):a=a instanceof HTMLVideoElement?{type:"video-element",src:l.toJSON(a.src,d),autoplay:a.autoplay,loop:a.loop,muted:a.muted,crossOrigin:a.crossOrigin,preload:a.preload}:{type:"image-data",imageData:this.encodeImageData(a)};
b[c]=a};f.prototype.readData=function(a){switch(a.type){case "image-element":var b=new Image;b.src=a.src;b.crossOrigin=a.crossOrigin;return b;case "canvas-element":return a=this.decodeImageData(a.imageData),b=document.createElement("canvas"),b.width=a.width,b.height=a.height,b.getContext("2d").putImageData(a,0,0),b;case "image-data":return this.decodeImageData(a.imageData);case "video-element":return b=document.createElement("video"),b.src=a.src,b.crossOrigin=a.crossOrigin,b.autoplay=a.autoplay,b.loop=
a.loop,b.muted=a.muted,b.preload=a.preload,b;default:e.neverReached(a)}};Object.defineProperty(f.prototype,"transparent",{get:function(){var a=this.data,b=this.url;return a instanceof HTMLCanvasElement?this.imageDataContainsTransparent(a.getContext("2d").getImageData(0,0,a.width,a.height)):a instanceof ImageData?this.imageDataContainsTransparent(a):b&&(a=b.substr(b.length-4,4).toLowerCase(),b=b.substr(0,15).toLocaleLowerCase(),".png"===a||"data:image/png;"===b)?!0:!1},set:function(a){null!=a?this._override("transparent",
a):this._clearOverride("transparent")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"contentHash",{get:function(){var a=this,b="string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?this.wrap.horizontal+"/"+this.wrap.vertical:"",d=function(c){void 0===c&&(c="");return"d:"+c+",t:"+a.transparent+",w:"+b};if(null!=this.url)return d(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return d(this.data.src);c.has(this.data)||
c.set(this.data,++q);return d(c.get(this.data))}return d()},enumerable:!0,configurable:!0});f.prototype.clone=function(){return new g({url:this.url,data:this.data,wrap:this.cloneWrap()})};f.prototype.cloneWithDeduplication=function(a){var b=a.get(this);if(b)return b;b=new g({url:this.url,data:this.data,wrap:this.cloneWrap()});a.set(this,b);return b};f.prototype.cloneWrap=function(){return"string"===typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};f.prototype.encodeImageData=
function(a){for(var b="",c=0;c<a.data.length;c++)b+=String.fromCharCode(a.data[c]);return{data:btoa(b),width:a.width,height:a.height}};f.prototype.decodeImageData=function(b){for(var c=atob(b.data),d=new Uint8ClampedArray(c.length),e=0;e<c.length;e++)d[e]=c.charCodeAt(e);return a.wrapImageData(d,b.width,b.height)};f.prototype.imageDataContainsTransparent=function(a){for(var b=3;b<a.data.length;b+=4)if(255!==a.data[b])return!0;return!1};f.from=function(a){return"string"===typeof a?new g({url:a}):a instanceof
HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData||a instanceof HTMLVideoElement?new g({data:a}):d.ensureClass(g,a)};var g;k([h.property({type:String,json:{write:l.write}})],f.prototype,"url",null);k([h.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),h.property()],f.prototype,"data",null);k([h.writer("data")],f.prototype,"writeData",null);k([h.reader("data")],f.prototype,"readData",null);k([h.property({type:Boolean,dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],
f.prototype,"transparent",null);k([h.property({json:{write:!0}})],f.prototype,"wrap",void 0);k([h.property({readOnly:!0,dependsOn:["url","data","wrap","transparent"]})],f.prototype,"contentHash",null);return f=g=k([h.subclass("esri.geometry.support.MeshTexture")],f)}(h.declared(f.JSONSupport))})},"esri/views/support/screenshotUtils":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/compilerUtils","../../core/mathUtils"],function(n,b,m,k,g){function e(b,c){var e=
b||{},f=e.format,l=e.quality,m=e.rotation,e=e.disableSlice,p=a(b,c.padding),r;r=c.width-p.left-p.right;c=c.height-p.top-p.bottom;p={x:0,y:0,width:r,height:c};if(b&&b.area){null!=b.area.x&&(p.x=Math.floor(b.area.x));null!=b.area.y&&(p.y=Math.floor(b.area.y));var q=null!=b.area.width?Math.floor(b.area.width):null,n=null!=b.area.height?Math.floor(b.area.height):null;p.width=r-p.x;p.height=c-p.y;null!=q&&null!=n?(p.width=Math.min(p.width,q),p.height=Math.min(p.height,n)):null==q&&null!=n?(q=Math.min(p.width,
q),p.height*=q/p.width,p.width=q):null!=q&&null==n&&(q=Math.min(p.height,n),p.width*=q/p.height,p.height=q)}p=d(p,b);q=Math.floor(Math.max(p.x,0));n=Math.floor(Math.max(p.y,0));r={x:q,y:n,width:Math.floor(Math.min(p.width,r-q)),height:Math.floor(Math.min(p.height,c-n))};c=r.width/r.height;p=p.width/p.height;p!==c&&(p>c?(c=Math.floor(r.width/p),r={x:r.x,y:Math.floor(r.y+(r.height-c)/2),width:r.width,height:c}):(c=Math.floor(r.height*p),r={x:Math.floor(r.x+(r.width-c)/2),y:r.y,width:c,height:r.height}));
p=h(b,r);c=p.width;p=p.height;a:switch(f){case "png":case "jpg":case "jpeg":break a;case null:case void 0:f=t;break a;default:k.neverReached(f),f=t}q=u[f];l=g.clamp(null!=l?l:q,0,100);return{format:f,quality:l,area:r,width:c,height:p,rotation:m,disableSlice:!!e,ignoreBackground:!(!b||!b.ignoreBackground),ignorePadding:!(!b||!b.ignorePadding)}}function f(a,b){return a.toDataURL(p[b.format],b.quality/100)}function l(a,b,d){d||(c||(c=document.createElement("canvas"),c.width=1,c.height=1),d=c);return d.getContext("2d").createImageData(a,
b)}function h(a,b){if(!a)return b;var c=a.width;a=a.height;if(null!=c&&null!=a)return{width:Math.floor(c),height:Math.floor(a)};if(null==c&&null==a)return b;b=b.width/b.height;return null==a?{width:Math.floor(c),height:Math.floor(c/b)}:{width:Math.floor(a*b),height:Math.floor(a)}}function d(a,b){if(!b||null==b.width||null==b.height)return a;b=b.width/b.height;var c=a.width/a.height;if(c===b)return a;if(c<b)return b=Math.floor(a.height*b),a.x-=(b-a.width)/2,a.width=b,a;b=Math.floor(a.width/b);a.y-=
(b-a.height)/2;a.height=b;return a}function a(a,b){return!b||a&&a.ignorePadding?r:b}Object.defineProperty(b,"__esModule",{value:!0});b.completeUserSettings=e;b.toRenderSettings=function(b,c){var d=e(b,c),f=d.area,h=d.width/f.width,g=a(d,c.padding),l=g.left+g.right,k=g.top+g.bottom;return{framebufferWidth:Math.floor((c.width-l)*h+l),framebufferHeight:Math.floor((c.height-k)*h+k),region:{x:Math.floor(f.x*h)+g.left,y:Math.floor(f.y*h)+g.top,width:d.width,height:d.height},format:d.format,quality:d.quality,
rotation:d.rotation,pixelRatio:h,layers:b&&b.layers?b.layers:[],disableSlice:d.disableSlice,ignoreBackground:d.ignoreBackground,ignorePadding:d.ignorePadding}};b.encodeResult=function(a,b,c,d){if(d.premultipliedAlpha)for(var e=a.data,h=e.length,g=0;g<h;g+=4){var l=e[g+3];0<l&&(l/=255,e[g+0]/=l,e[g+1]/=l,e[g+2]/=l)}c.width=a.width;c.height=a.height;e=c.getContext("2d");e.putImageData(a,0,0);d.flipY&&(e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,
0,0),e.restore());a=e.getImageData(0,0,a.width,a.height);b=f(c,b);c.width=0;c.height=0;return{dataUrl:b,data:a}};b.toDataUrl=f;b.createEmptyImageData=function(a,b,c){if(!a||!b)throw Error("Cannot construct image data without dimensions");if(q)try{return new ImageData(a,b)}catch(z){q=!1}return l(a,b,c)};b.wrapImageData=function(a,b,c,d){if(!b||!c)throw Error("Cannot construct image data without dimensions");if(q)try{return new ImageData(a,b,c)}catch(y){q=!1}b=l(b,c,d);b.data.set(a,0);return b};b.resampleHermite=
function(a,b,c,d,e,f,h,g){void 0===d&&(d=0);void 0===e&&(e=0);void 0===f&&(f=a.width-d);void 0===h&&(h=a.height-e);void 0===g&&(g=!1);var l=a.data,k=b.width,m=b.height,p=b.data;f/=k;h/=m;var r=Math.ceil(f/2),q=Math.ceil(h/2);a=a.width;for(var u=0;u<m;u++)for(var t=0;t<k;t++){for(var n=4*(t+(g?m-u-1:u)*k),v=0,w=0,x=0,y=0,z=0,A=0,B=(u+.5)*h,C=Math.floor(u*h);C<(u+1)*h;C++)for(var U=Math.abs(B-(C+.5))/q,Y=(t+.5)*f,U=U*U,X=Math.floor(t*f);X<(t+1)*f;X++){var R=Math.abs(Y-(X+.5))/r,R=Math.sqrt(U+R*R);if(!(1<=
R)){var R=2*R*R*R-3*R*R+1,aa=4*(d+X+(e+C)*a),A=A+R*l[aa+3],w=w+R;!c&&255>l[aa+3]&&(R=R*l[aa+3]/255);x+=R*l[aa];y+=R*l[aa+1];z+=R*l[aa+2];v+=R}}p[n]=x/v;p[n+1]=y/v;p[n+2]=z/v;p[n+3]=A/w}return b};b.screenshotSuperSampleSettings=function(b,c,d){if(!c)return b;c=b.framebufferWidth;var e=b.framebufferHeight,f=b.pixelRatio,h=b.region;d=a(b,d);var g=d.left+d.right,l=d.top+d.bottom,k=c-g,p=e-l,r=Math.min(8,Math.min((2048-g)/k,(2048-l)/p));return 1.5>r?b:m({},b,{framebufferWidth:Math.round(k*r)+g,framebufferHeight:Math.round(p*
r)+l,pixelRatio:f*r,resample:{region:{x:Math.round((h.x-d.left)*r)+d.left,y:Math.round((h.y-d.top)*r)+d.top,width:Math.round(h.width*r),height:Math.round(h.height*r)},width:c,height:e}})};var c=null,q=!0,p={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},t="jpg",u={png:100,jpg:98,jpeg:98},r={top:0,right:0,bottom:0,left:0}})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/maybe ../../core/accessorSupport/decorators ./MeshMaterial ./MeshTexture".split(" "),
function(n,b,m,k,g,e,f,l,h,d){return function(a){function b(b){b=a.call(this,b)||this;b.emissiveColor=null;b.emissiveTexture=null;b.occlusionTexture=null;b.metallic=1;b.roughness=1;b.metallicRoughnessTexture=null;return b}m(b,a);h=b;b.prototype.clone=function(){return this.cloneWithDeduplication(null,new Map)};b.prototype.cloneWithDeduplication=function(a,b){var c=f.isSome(a)?a.get(this):null;if(c)return c;b=new h(this.clonePropertiesWithDeduplication(b));f.isSome(a)&&a.set(this,b);return b};b.prototype.clonePropertiesWithDeduplication=
function(a){return g({},this.inherited(arguments),{emissiveColor:this.emissiveColor?this.emissiveColor.clone():null,emissiveTexture:this.emissiveTexture?this.emissiveTexture.cloneWithDeduplication(a):null,occlusionTexture:this.occlusionTexture?this.occlusionTexture.cloneWithDeduplication(a):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?this.metallicRoughnessTexture.cloneWithDeduplication(a):null})};var h;k([l.property({type:e,json:{write:!0}})],
b.prototype,"emissiveColor",void 0);k([l.property({type:d,json:{write:!0}})],b.prototype,"emissiveTexture",void 0);k([l.property({type:d,json:{write:!0}})],b.prototype,"occlusionTexture",void 0);k([l.property({type:Number,json:{write:!0},range:{min:0,max:1}})],b.prototype,"metallic",void 0);k([l.property({type:Number,json:{write:!0},range:{min:0,max:1}})],b.prototype,"roughness",void 0);k([l.property({type:d,json:{write:!0}})],b.prototype,"metallicRoughnessTexture",void 0);return b=h=k([l.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],
b)}(l.declared(h))})},"esri/geometry/support/MeshVertexAttributes":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),function(n,b,m,k,g,e,f,l){function h(a,b,c,d){var e=b.loggerTag;b=b.stride;return 0!==a.length%b?(d.error(e,"Invalid array length, expected a multiple of "+b),new c([])):a}function d(a,b,c,d,e){if(!a)return a;if(a instanceof
b)return h(a,d,b,e);for(var f=0;f<c.length;f++)if(a instanceof c[f])return h(new b(a),d,b,e);if(Array.isArray(a))return h(new b(a),d,b,e);c=c.map(function(a){return"'"+a.name+"'"});e.error("Failed to set property, expected one of "+c+", but got "+a.constructor.name);return new b([])}function a(a,b,c){for(var d=Array(a.length),e=0;e<a.length;e++)d[e]=a[e];b[c]=d}Object.defineProperty(b,"__esModule",{value:!0});var c=f.getLogger("esri.geometry.support.MeshVertexAttributes");n=function(b){function f(a){a=
b.call(this,a)||this;a.color=null;a.position=new Float64Array(0);a.uv=null;a.normal=null;a.tangent=null;return a}m(f,b);h=f;f.prototype.castColor=function(a){return d(a,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},c)};f.prototype.castPosition=function(a){a&&a instanceof Float32Array&&c.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return d(a,Float64Array,[Float32Array],
{loggerTag:".position\x3d",stride:3},c)};f.prototype.castUv=function(a){return d(a,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},c)};f.prototype.castNormal=function(a){return d(a,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},c)};f.prototype.castTangent=function(a){return d(a,Float32Array,[Float64Array],{loggerTag:".tangent\x3d",stride:4},c)};f.prototype.clone=function(){var a={position:e.clone(this.position),uv:e.clone(this.uv),normal:e.clone(this.normal),tangent:e.clone(this.tangent),
color:e.clone(this.color)};return new h(a)};var h;k([l.property({json:{write:a}})],f.prototype,"color",void 0);k([l.cast("color")],f.prototype,"castColor",null);k([l.property({nonNullable:!0,json:{write:a}})],f.prototype,"position",void 0);k([l.cast("position")],f.prototype,"castPosition",null);k([l.property({json:{write:a}})],f.prototype,"uv",void 0);k([l.cast("uv")],f.prototype,"castUv",null);k([l.property({json:{write:a}})],f.prototype,"normal",void 0);k([l.cast("normal")],f.prototype,"castNormal",
null);k([l.property({json:{write:a}})],f.prototype,"tangent",void 0);k([l.cast("tangent")],f.prototype,"castTangent",null);return f=h=k([l.subclass("esri.geometry.support.MeshVertexAttributes")],f)}(l.declared(g.JSONSupport));b.MeshVertexAttributes=n;b.castArray=d;b.default=n})},"esri/geometry/support/meshUtils/projection":function(){define("require exports ../../../core/Logger ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../views/3d/support/projectionUtils ../../../views/3d/support/buffer/BufferView".split(" "),
function(n,b,m,k,g,e,f,l,h,d){function a(a,b,c,d,e,g){if(b){var l=c.count;if(e.isWGS84)for(e=0;e<l;e++)d.getVec(e,q),b.getVec(e,p),h.computeLinearTransformation(h.SphericalECEFSpatialReference,q,t,h.SphericalECEFSpatialReference),k.mat3.fromMat4(u,t),1===a&&k.mat3.transpose(u,u),f.vec3.transformMat3(p,p,u),g.setVec(e,p);else for(e=0;e<l;e++){d.getVec(e,q);b.getVec(e,p);h.computeLinearTransformation(h.SphericalECEFSpatialReference,q,t,h.SphericalECEFSpatialReference);k.mat3.fromMat4(u,t);var m=h.webMercator.y2lat(c.get(e,
1)),m=Math.cos(m);0===a&&(m=1/m);u[0]*=m;u[1]*=m;u[2]*=m;u[3]*=m;u[4]*=m;u[5]*=m;1===a&&k.mat3.transpose(u,u);f.vec3.transformMat3(p,p,u);f.vec3.normalize(p,p);g.setVec(e,p)}return g}}Object.defineProperty(b,"__esModule",{value:!0});var c=m.getLogger("esri.geometry.support.meshUtils.normalProjection");b.projectNormalToECEF=function(b,e,f,h,g){if(!h.isWebMercator&&!h.isWGS84)return c.error("Cannot convert PCS spatial reference buffer to ECEF"),g;a(0,d.BufferViewVec3f.fromTypedArray(b),d.BufferViewVec3f64.fromTypedArray(e),
d.BufferViewVec3f64.fromTypedArray(f),h,d.BufferViewVec3f.fromTypedArray(g));return g};b.projectNormalFromECEF=function(b,e,f,h,g){if(!h.isWebMercator&&!h.isWGS84)return c.error("Cannot convert to PCS spatial reference buffer from ECEF"),g;a(1,d.BufferViewVec3f.fromTypedArray(b),d.BufferViewVec3f64.fromTypedArray(e),d.BufferViewVec3f64.fromTypedArray(f),h,d.BufferViewVec3f.fromTypedArray(g));return g};b.projectToECEF=function(a,b,c){h.bufferToBuffer(a,b,0,c,h.SphericalECEFSpatialReference,0,a.length/
3);return c};b.projectFromECEF=function(a,b,c){h.bufferToBuffer(a,h.SphericalECEFSpatialReference,0,b,c,0,a.length/3);return b};b.transformBufferInPlace=function(a,b,c){void 0===c&&(c=!1);if(a)for(var d=0;d<a.length;d+=3){for(var e=0;3>e;e++)q[e]=a[d+e];f.vec3.transformMat4(q,q,b);c&&f.vec3.normalize(q,q);for(e=0;3>e;e++)a[d+e]=q[e]}};b.projectTangentToECEF=function(b,e,f,h,g){if(!h.isWebMercator&&!h.isWGS84)return c.error("Cannot convert PCS spatial reference buffer to ECEF"),g;a(0,d.BufferViewVec3f.fromTypedArray(b,
4*Float32Array.BYTES_PER_ELEMENT),d.BufferViewVec3f64.fromTypedArray(e),d.BufferViewVec3f64.fromTypedArray(f),h,d.BufferViewVec3f.fromTypedArray(g,4*Float32Array.BYTES_PER_ELEMENT));for(e=3;e<b.length;e+=4)g[e]=b[e];return g};b.projectTangentFromECEF=function(b,e,f,h,g){if(!h.isWebMercator&&!h.isWGS84)return c.error("Cannot convert to PCS spatial reference buffer from ECEF"),g;a(1,d.BufferViewVec3f.fromTypedArray(b,16),d.BufferViewVec3f64.fromTypedArray(e),d.BufferViewVec3f64.fromTypedArray(f),h,
d.BufferViewVec3f.fromTypedArray(g,16));for(e=3;e<b.length;e+=4)g[e]=b[e];return g};var q=l.vec3f64.create(),p=l.vec3f64.create(),t=e.mat4f64.create(),u=g.mat3f64.create()})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/maybe"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.parseColorMixMode=function(b){switch(b){case "multiply":return 1;case "ignore":return 2;case "replace":return 3;case "tint":return 4;
default:return 1}};b.encodeSymbolColor=function(b,d,a){if(k.isNone(b)||2===d)a[0]=255,a[1]=255,a[2]=255,a[3]=255;else{var c=m.clamp(Math.round(b[3]*e),0,e);d=0===c||4===d?0:3===d?f:l;a[0]=m.clamp(Math.round(b[0]*g),0,g);a[1]=m.clamp(Math.round(b[1]*g),0,g);a[2]=m.clamp(Math.round(b[2]*g),0,g);a[3]=c+d}};var g=255,e=85,f=e,l=2*e})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/BufferView ../lib/ComponentUtils ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/NativeLineTechnique".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y){var A=g.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");n=function(b){function c(a,c){c=b.call(this,c)||this;c.techniqueConfig=new y.NativeLineTechniqueConfiguration;c.params=v.copyParameters(a,F);return c}m(c,b);c.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)b[c]=a[c];this.parametersChanged()};c.prototype.getParameters=function(){return this.params};c.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=
a;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.transparent=1>this.params.color[3]||1>this.params.width;a=e.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=a;this.techniqueConfig.stippleOffColorEnabled=a&&e.isSome(this.params.stippleOffColor);this.techniqueConfig.stippleIntegerRepeatsEnabled=a&&this.params.stippleIntegerRepeats;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;
return this.techniqueConfig};c.prototype.getPassParameters=function(){return this.params};c.prototype.intersect=function(a,b,c,d,e,f,h,g,l){l?v.intersectDrapedRenderLineGeometry(a,d,f,1,h):this.intersectLineGeometry(a,b,c,d,h)};c.prototype.intersectLineGeometry=function(b,c,d,e,f){if(e.options.selectionMode&&!q.isAllHidden(c.componentVisibilities,b.componentOffsets))if(r.isTranslationMatrix(d)){c=b.data.getVertexAttr().position.data;var g=e.camera,k=M;l.vec2.copy(k,e.point);h.vec3.set(T[0],k[0]-2,
k[1]+2,0);h.vec3.set(T[1],k[0]+2,k[1]+2,0);h.vec3.set(T[2],k[0]+2,k[1]-2,0);h.vec3.set(T[3],k[0]-2,k[1]-2,0);for(var m=0;4>m;m++)g.unprojectPoint(T[m],P[m]);a.plane.fromPoints(g.eye,P[0],P[1],S);a.plane.fromPoints(g.eye,P[1],P[2],V);a.plane.fromPoints(g.eye,P[2],P[3],J);a.plane.fromPoints(g.eye,P[3],P[0],U);b=Number.MAX_VALUE;for(m=0;m<c.length-5;m+=3)if(E[0]=c[m]+d[12],E[1]=c[m+1]+d[13],E[2]=c[m+2]+d[14],G[0]=c[m+3]+d[12],G[1]=c[m+4]+d[13],G[2]=c[m+5]+d[14],!(0>a.plane.signedDistance(S,E)&&0>a.plane.signedDistance(S,
G)||0>a.plane.signedDistance(V,E)&&0>a.plane.signedDistance(V,G)||0>a.plane.signedDistance(J,E)&&0>a.plane.signedDistance(J,G)||0>a.plane.signedDistance(U,E)&&0>a.plane.signedDistance(U,G))){g.projectPoint(E,I);g.projectPoint(G,L);if(0>I[2]&&0<L[2]){h.vec3.subtract(H,E,G);var p=g.frustum,u=-a.plane.signedDistance(p.planes[4],E),p=u/h.vec3.dot(H,p.planes[4]);h.vec3.scale(H,H,p);h.vec3.add(E,E,H);g.projectPoint(E,I)}else if(0<I[2]&&0>L[2])h.vec3.subtract(H,G,E),p=g.frustum,u=-a.plane.signedDistance(p.planes[4],
G),p=u/h.vec3.dot(H,p.planes[4]),h.vec3.scale(H,H,p),h.vec3.add(G,G,H),g.projectPoint(G,L);else if(0>I[2]&&0>L[2])continue;I[2]=0;L[2]=0;p=a.lineSegment.distance2(a.lineSegment.fromPoints(I,L,N),k);p<b&&(b=p,h.vec3.copy(O,E),h.vec3.copy(K,G))}d=e.rayBeginPoint;e=e.rayEndPoint;4>b&&(b=Number.MAX_VALUE,a.lineSegment.closestLineSegmentPoint(a.lineSegment.fromPoints(O,K,N),a.lineSegment.fromPoints(d,e,Q),D)&&(h.vec3.subtract(D,D,d),b=h.vec3.length(D),h.vec3.scale(D,D,1/b),b/=h.vec3.distance(d,e)),f(b,
D))}else A.error("intersection assumes a translation-only matrix")};c.prototype.computeAttachmentOrigin=function(a,b){a=a.data;return(a="getVertexAttr"in a?a.getVertexAttr():"vertexAttr"in a?a.vertexAttr:null)?p.computeAttachmentOriginLines(a[r.VertexAttrConstants.POSITION],null,!1,b):null};c.prototype.createBufferWriter=function(){var a=this.params.vertexColors?w.PositionColorLayout:w.PositionLayout;return e.isNone(this.params.stipplePattern)?new w.DefaultBufferWriter(a):new C(a.clone().vec3f(r.VertexAttrConstants.AUXPOS1))};
c.prototype.createRenderer=function(a,b){return new z(a,b,this)};c.prototype.getGLMaterial=function(a){return 0===a.output||4===a.output?new B(a):void 0};return c}(u.Material);var B=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}m(b,a);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(y.NativeLineTechnique,this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.beginSlot=function(a){return 3===a};b.prototype._updateOccludeeState=
function(a){a.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};b.prototype.ensureParameters=function(a){0===this.output&&this._updateOccludeeState(a)};b.prototype.bind=function(a,b){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getPassParameters(),b)};b.prototype.getPipelineState=function(a,b){return b?this.technique.opaqueOccludeeState:this.technique.pipeline};
return b}(t.GLMaterial),C=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[r.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d){x.writeDefaultAttributes(b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,c,d);this.writeAuxpos1(a,b,c,d)};a.prototype.writeAuxpos1=function(a,b,d,e){var f=d.getField(r.VertexAttrConstants.AUXPOS1,
c.BufferViewVec3f);d=b.indices[r.VertexAttrConstants.POSITION];b=b.vertexAttr[r.VertexAttrConstants.POSITION].data;a=a.transformation;var h=f.typedBufferStride,f=f.typedBuffer;e*=h;for(var g=0;g<d.length;g+=2)for(var l=3*d[g],k=b[l],m=b[l+1],p=b[l+2],l=a[0]*k+a[4]*m+a[8]*p+a[12],q=a[1]*k+a[5]*m+a[9]*p+a[13],k=a[2]*k+a[6]*m+a[10]*p+a[14],m=0;2>m;++m)f[e]=l,f[e+1]=q,f[e+2]=k,e+=h};return a}(),F={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,
stippleOffColor:null,sceneHasOcludees:!1},E=d.vec3f64.create(),G=d.vec3f64.create(),H=d.vec3f64.create(),D=d.vec3f64.create(),I=f.createRenderScreenPointArray3(),L=f.createRenderScreenPointArray3(),O=d.vec3f64.create(),K=d.vec3f64.create(),N=a.lineSegment.create(),Q=a.lineSegment.create(),M=d.vec3f64.create(),T=[f.createRenderScreenPointArray3(),f.createRenderScreenPointArray3(),f.createRenderScreenPointArray3(),f.createRenderScreenPointArray3()],P=[d.vec3f64.create(),d.vec3f64.create(),d.vec3f64.create(),
d.vec3f64.create()],S=a.plane.create(),V=a.plane.create(),J=a.plane.create(),U=a.plane.create();return n})},"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":function(){define(["require","exports","../../../support/buffer/InterleavedLayout","../../lib/Util","./bufferWriterUtils"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.PositionLayout=m.newLayout().vec3f(k.VertexAttrConstants.POSITION);b.PositionUVLayout=m.newLayout().vec3f(k.VertexAttrConstants.POSITION).vec2f(k.VertexAttrConstants.UV0);
b.PositionColorLayout=m.newLayout().vec3f(k.VertexAttrConstants.POSITION).vec4u8(k.VertexAttrConstants.COLOR);n=function(){function b(b){this.vertexBufferLayout=b}b.prototype.allocate=function(b){return this.vertexBufferLayout.createBuffer(b)};b.prototype.elementCount=function(b){return b.indices[k.VertexAttrConstants.POSITION].length};b.prototype.write=function(b,e,h,d){g.writeDefaultAttributes(e,this.vertexBufferLayout,b.transformation,b.invTranspTransformation,h,d)};return b}();b.DefaultBufferWriter=
n})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/StencilUtils ./NativeLine.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r){Object.defineProperty(b,"__esModule",{value:!0});g=function(a){function b(b,c){c=a.call(this,b,c)||this;c.stipplePattern=null;c.stippleTextureBind=null;c.stippleTextureRepository=b.stippleTextureRepository;return c}m(b,a);b.prototype.initializeProgram=function(a){var c=b.shader.get(),d=this.configuration,c=c.build({output:d.output,attributeColor:d.vertexColors,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:d.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,
stippleEnabled:d.stippleEnabled,stippleOffColorEnabled:d.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:d.stippleIntegerRepeatsEnabled});return new u(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),q.Default3D)};b.prototype.dispose=function(){a.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};b.prototype.bindPass=function(a,b,c){if(this.stipplePattern!==b.stipplePattern){var d=
b.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,d);this.stipplePattern=d}this.configuration.stippleEnabled&&(d=e.isSome(this.stippleTextureBind)?this.stippleTextureBind(a,0)*c.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/d),this.program.setUniform2f("ndcToPixel",c.viewport[2]/2,c.viewport[3]/2));0===this.configuration.output?(this.program.setUniform4fv("constantColor",b.color),
this.program.setUniform1f("alphaCoverage",Math.min(1,b.width*c.pixelRatio)),this.configuration.stippleOffColorEnabled&&(a=e.expect(b.stippleOffColor),this.program.setUniform4f("stippleOffColor",a[0],a[1],a[2],3<a.length?a[3]:1))):h.OutputHighlight.bindOutputHighlight(a,this.program,c)};b.prototype.bindDraw=function(a){l.Transform.bindUniforms(this.program,a);f.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};b.prototype.initializePipeline=function(){var a=this.configuration,b=r.separateBlendingParams(770,
1,771,771),c=function(b,c,d){void 0===c&&(c=null);void 0===d&&(d=null);return r.makePipelineState({blending:c,depthTest:p.depthCompareLess,depthWrite:d,colorWrite:r.defaultColorWriteParams,stencilWrite:a.sceneHasOcludees?p.stencilWriteMaskOn:null,stencilTest:a.sceneHasOcludees?b?p.stencilToolMaskBaseParams:p.stencilBaseAllZerosParams:null})};return 0===a.output?(this._occludeeState=c(!0,a.transparent||a.stippleEnabled?b:null,r.defaultDepthWriteParams),c(!1,a.transparent||a.stippleEnabled?b:null,r.defaultDepthWriteParams)):
c(!1)};Object.defineProperty(b.prototype,"primitiveType",{get:function(){return 1},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!0,configurable:!0});b.shader=new d.ReloadableShaderModule(t,"./NativeLine.glsl",n);return b}(a.ShaderTechnique);b.NativeLineTechnique=g;g=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.vertexColors=
!1;b.transparent=!1;b.stippleEnabled=!1;b.stippleOffColorEnabled=!1;b.stippleIntegerRepeatsEnabled=!1;b.sceneHasOcludees=!1;return b}m(b,a);k([c.parameter({count:7})],b.prototype,"output",void 0);k([c.parameter()],b.prototype,"slicePlaneEnabled",void 0);k([c.parameter()],b.prototype,"sliceHighlightDisabled",void 0);k([c.parameter()],b.prototype,"vertexColors",void 0);k([c.parameter()],b.prototype,"transparent",void 0);k([c.parameter()],b.prototype,"stippleEnabled",void 0);k([c.parameter()],b.prototype,
"stippleOffColorEnabled",void 0);k([c.parameter()],b.prototype,"stippleIntegerRepeatsEnabled",void 0);k([c.parameter()],b.prototype,"sceneHasOcludees",void 0);return b}(c.ShaderTechniqueConfiguration);b.NativeLineTechniqueConfiguration=g})},"esri/views/3d/webgl-engine/shaders/NativeLine.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/VertexColor.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/LineStipple.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,m,k,g,e,f,l,h,d){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var r=new d.ShaderBuilder;r.include(g.Transform,{linearDepth:!1});r.include(e.VertexColor,b);r.include(l.LineStipple,b);r.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4");r.attributes.add("position","vec3");r.varyings.add("vpos","vec3");r.vertex.code.add(h.glsl(a||(a=m(["\n    void main(void) {\n      vpos \x3d (model * vec4(position, 1.0)).xyz;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n  "],
["\n    void main(void) {\n      vpos \x3d (model * vec4(position, 1.0)).xyz;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n  "]))));b.stippleEnabled&&(r.attributes.add("auxpos1","vec3"),r.vertex.uniforms.add("ndcToPixel","vec2"),r.vertex.code.add(h.glsl(c||(c=m(["\n    vec4 vpos2 \x3d transformPosition(proj, view, (model * vec4(auxpos1, 1.0)).xyz);\n    float lineSegmentPixelSize \x3d length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv \x3d lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ",
"\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *\x3d gl_Position.w;\n    "],["\n    vec4 vpos2 \x3d transformPosition(proj, view, (model * vec4(auxpos1, 1.0)).xyz);\n    float lineSegmentPixelSize \x3d length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv \x3d lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ","\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *\x3d gl_Position.w;\n    "])),
b.stippleIntegerRepeatsEnabled?"stipplePatternUv \x3d floor(stipplePatternUv + 0.5);":"")));r.vertex.code.add(h.glsl(q||(q=m(["\n  }\n  "],["\n  }\n  "]))));0===b.output&&(r.include(k.Slice,b),r.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),r.fragment.code.add(h.glsl(p||(p=m(["\n    void main() {\n      discardBySlice(vpos);\n\n      vec4 color \x3d ",";\n\n      float stippleAlpha \x3d getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      gl_FragColor \x3d highlightSlice(blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha), vpos);\n    }\n    "],
["\n    void main() {\n      discardBySlice(vpos);\n\n      vec4 color \x3d ",";\n\n      float stippleAlpha \x3d getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      gl_FragColor \x3d highlightSlice(blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha), vpos);\n    }\n    "])),b.attributeColor?"vcolor":"constantColor")));4===b.output&&(r.include(k.Slice,b),r.include(f.OutputHighlight),r.fragment.code.add(h.glsl(t||(t=m(["\n    void main() {\n      discardBySlice(vpos);\n      discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n      outputHighlight();\n    }\n    "],
["\n    void main() {\n      discardBySlice(vpos);\n      discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n      outputHighlight();\n    }\n    "])))));return r};var a,c,q,p,t})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/lang ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L,O){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._removeResource=null;a._optionalFields=[];a._instanceIndexToGraphicUid=new Map;a.ensureDrapedStatus(!1);return a}m(c,b);c.prototype.getCachedSize=function(){var a=this._symbolSize;return{width:a[0],depth:a[1],height:a[2]}};c.prototype.doLoad=function(a){return g(this,void 0,void 0,function(){var b,c,d,e;return k(this,
function(f){switch(f.label){case 0:b=this._getIdHint("_objectmat");if(!this._drivenProperties.size&&(c=y.validateSymbolLayerSize(this.symbolLayer)))throw Error();d=this.symbolLayer;return this.isByResource?[4,this._prepareModelResources(d.resource.href,a)]:[3,2];case 1:return f.sent(),[3,3];case 2:e=d.resource?d.resource.primitive:r.defaultPrimitive,this._preparePrimitiveResources(e,b),f.label=3;case 3:return[2]}})})};Object.defineProperty(c.prototype,"isByResource",{get:function(){return!(!this.symbolLayer.resource||
!this.symbolLayer.resource.href)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"lodRenderer",{get:function(){return this._lodRenderer},enumerable:!0,configurable:!0});c.prototype.setMaterialTransparencyParams=function(a,b){void 0===b&&(b=h.get(this.symbolLayer,"material","color"));b=this._getCombinedOpacity(b);a.transparent=1>b||this.needsDrivenTransparentPass;a.opacity=b;return a};c.prototype._preparePrimitiveResources=function(a,b){if(!F.isValidPrimitive(a))throw Error("Unknown object symbol primitive: "+
a);var c=this.symbolLayer;this._resourceBoundingBox=u.create(F.primitiveBoundingBox(a));this._resourceSize=p.vec3f64.fromArray(u.size(this._resourceBoundingBox));this._symbolSize=p.vec3f64.fromArray(y.computeSizeWithResourceSize(this._resourceSize,c));this._isWosr=this._isEsriSymbolResource=!1;var e={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:["transformation"],ambient:p.vec3f64.ONES,diffuse:p.vec3f64.ONES,slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,
castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:this.symbolLayer.isPrimitive};this._physicalBasedRenderingEnabled=e.usePBR;this.setMaterialTransparencyParams(e);var g=this.symbol;if("point-3d"===g.type&&g.verticalOffset){var g=g.verticalOffset,k=g.minWorldLength,m=g.maxWorldLength;e.verticalOffset={screenLength:d.pt2px(g.screenLength),minWorldLength:k||0,maxWorldLength:null!=m?m:Infinity};e.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);
this._drivenProperties.color?e.externalColor=t.vec4f64.ONES:(c=h.isSome(c.material)&&c.material.color,c=h.isSome(c)?f.toUnitRGBA(c):t.vec4f64.ONES,e.externalColor=c);this._fastUpdates=G.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(l.mixin(e,this._fastUpdates.materialParameters),e.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(e.instanced.push("color"),this._optionalFields.push("color"));
e=new O(e,b);this._lodResources=F.primitiveLodResources(a,e,b);this._originalOpacities=L.materialsFromLodResources(this._lodResources).map(function(){return 1});if(!this._lodResources)throw Error("Unknown object symbol primitive: "+a);this._finalizeSymbolResources();this._initializeLodRenderer();this.complexity=this.computeComplexity()};c.prototype._prepareModelResources=function(a,b){return g(this,void 0,void 0,function(){var c,e,f,g,m,r,q,t,n,v,w,x,z,C,K,F,M,J=this;return k(this,function(k){switch(k.label){case 0:return c=
["transformation"],e={instanced:c,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},f={materialParamsMixin:e,streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache},this._fastUpdates=G.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled?(l.mixin(f.materialParamsMixin,this._fastUpdates.materialParameters),c.push("featureAttribute"),this._optionalFields.push("featureAttribute")):
this._hasPerInstanceColor()&&(c.push("color"),this._optionalFields.push("color")),g=this.symbol,"point-3d"===g.type&&g.verticalOffset&&(m=g.verticalOffset,r=m.screenLength,q=m.minWorldLength,t=m.maxWorldLength,f.materialParamsMixin.verticalOffset={screenLength:d.pt2px(r),minWorldLength:q||0,maxWorldLength:null!=t?t:Infinity},f.materialParamsMixin.castShadows=!1),f.signal=b,f.usePBR=this._context.physicalBasedRenderingEnabled,this._physicalBasedRenderingEnabled=f.usePBR,[4,B.fetch(a,f)];case 1:return n=
k.sent(),this._isEsriSymbolResource=n.isEsriSymbolResource,this._isWosr=n.isWosr,this._removeResource=n.remove,v=A.makeLodResources(n.lods),A.fillEstimatedMinScreenSpaceRadius(v),v.levels.sort(function(a,b){return a.minScreenSpaceRadius-b.minScreenSpaceRadius}),v.levels[0].minScreenSpaceRadius=Math.min(2,v.levels[0].minScreenSpaceRadius),this._lodResources=v,w=this._context,x=this.symbolLayer.material,z=this._getExternalColorParameters(x),C=h.get(this.symbolLayer,"material","color"),K=this._getCombinedOpacity(C,
{hasIntrinsicColor:!0}),F=this.needsDrivenTransparentPass,M=L.materialsFromLodResources(this._lodResources),this._originalOpacities=M.map(function(a){return a.getParameters().opacity||1}),M.forEach(function(a){var b=a.getParameters();a.setParameterValues(z);var c=b.opacity*K;a.setParameterValues({opacity:c,transparent:1>c||F||b.transparent});w.screenSizePerspectiveEnabled&&a.setParameterValues({screenSizePerspective:w.sharedResources.screenSizePerspectiveSettings})}),this._resourceBoundingBox=n.referenceBoundingBox,
this._resourceSize=p.vec3f64.fromArray(u.size(this._resourceBoundingBox)),this._pivotOffset=p.vec3f64.fromArray(this._lodResources.levels[0].pivotOffset),this._symbolSize=p.vec3f64.fromArray(y.computeSizeWithResourceSize(this._resourceSize,this.symbolLayer)),G.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions())&&M.forEach(function(a){return a.setParameterValues(J._fastUpdates.materialParameters)}),this._finalizeSymbolResources(),this._initializeLodRenderer(),
this.complexity=this.computeComplexity(),[2]}})})};c.prototype._finalizeSymbolResources=function(){var a=this._context.stage;this._materials=L.materialsFromLodResources(this._lodResources);this._physicalBasedRenderingEnabled!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();this._materials.forEach(function(b){a.add(3,b)});this._textures=L.texturesFromLodResources(this._lodResources);this._textures.forEach(function(b){a.add(4,b)});this._geometries=L.geometriesFromLodResources(this._lodResources);
this._geometries.forEach(function(b){a.add(2,b)})};c.prototype._initializeLodRenderer=function(){var b=this,c=this._context.stage;this._lodRenderer=new I.LodRenderer(this._lodResources,this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:function(a){return b._instanceIndexToGraphicUid.get(a)},notifyGraphicUpdate:function(a,c){return b._context.notifyGraphicUpdate(b._instanceIndexToGraphicUid.get(a),c)}},this._fastUpdates.enabled?{applyTransform:function(c,d,e){c.getFeatureAttribute(d,
M);a.mat4.copy(e,G.evaluateModelTransform(b._fastUpdates.materialParameters,M,e))},scaleFactor:function(a,c,d){c.getFeatureAttribute(d,M);return G.evaluateModelTransformScale(a,b._fastUpdates.materialParameters,M)}}:null);this._lodRenderer.slicePlane=this._context.slicePlaneEnabled;c.addRenderPlugin(this._lodRenderer.slots,this._lodRenderer)};c.prototype._getExternalColorParameters=function(a){var b={};this._drivenProperties.color?b.externalColor=t.vec4f64.ONES:h.isSome(a)&&h.isSome(a.color)?b.externalColor=
f.toUnitRGBA(a.color):(b.externalColor=t.vec4f64.ONES,b.colorMixMode="ignore");return b};c.prototype.destroy=function(){b.prototype.destroy.call(this);var a=this._context.stage;this._lodRenderer&&(a.removeRenderPlugin(this._lodRenderer),this._lodRenderer.destroy());this._materials&&this._materials.forEach(function(b){return a.remove(3,b.id)});this._textures&&this._textures.forEach(function(b){return a.remove(4,b.id)});this._geometries&&this._geometries.forEach(function(b){return a.remove(2,b.id)});
h.isSome(this._removeResource)&&this._removeResource()};c.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometry(b.geometry))return null;var c=C.placePointOnGeometry(b.geometry);if(h.isNone(c))return this.logger.warn("unsupported geometry type for icon symbol: "+b.geometry.type),null;var d=this.getGraphicElevationContext(b);return this._createAs3DShape(b,c,a.renderingInfo,d,b.uid)};c.prototype.notifyDestroyGraphicLayer=function(a){this._instanceIndexToGraphicUid.delete(a.instanceIndex)};
c.prototype.graphicLayerToGraphicId=function(){return 0};c.prototype.layerOpacityChanged=function(){var a=this,b=this._drivenProperties.opacity,c=this.isByResource;this._materials.forEach(function(d,e){var f=h.get(a.symbolLayer,"material","color");e=a._getCombinedOpacity(f,{hasIntrinsicColor:c})*a._originalOpacities[e];d.setParameterValues({opacity:e,transparent:1>e||b})});return!0};c.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,w.needsElevationUpdates3D)};
c.prototype.slicePlaneEnabledChanged=function(){var a=this;this._lodRenderer.slicePlane=this._context.slicePlaneEnabled;this._materials.forEach(function(b){b.setParameterValues({slicePlaneEnabled:a._context.slicePlaneEnabled})});return!0};c.prototype.physicalBasedRenderingChanged=function(){var a=this;this._materials&&this._materials.forEach(function(b){a.isByResource?a._isEsriSymbolResource&&!a._isWosr&&b.setParameterValues({usePBR:a._context.physicalBasedRenderingEnabled,isSchematic:!1}):b.setParameterValues({usePBR:a._context.physicalBasedRenderingEnabled,
isSchematic:!0})});return!0};c.prototype.pixelRatioChanged=function(){return!0};c.prototype.applyRendererDiff=function(a,b){var c=this,d;for(d in a.diff)switch(d){case "visualVariables":if(G.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._materials.forEach(function(a){return a.setParameterValues(c._fastUpdates.materialParameters)}),this._lodRenderer.notifyShaderTransformationChanged();else return!1;break;default:return!1}return!0};c.prototype.computeComplexity=
function(){if(!this._lodResources)return b.prototype.computeComplexity.call(this);var a=L.geometriesFromLodLevelResources(this._lodResources.levels[0]).reduce(function(a,b){return a+b.data.getIndices(D.VertexAttrConstants.POSITION).length},0)/3,c=E.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer);return{primitivesPerFeature:a,primitivesPerCoordinate:0,estimated:!1,memory:c}};c.prototype._createAs3DShape=function(a,b,c,d,e){a=this.getFastUpdateAttrValues(a);var f=!this._fastUpdates.enabled&&
this._hasPerInstanceColor()?y.mixinColorAndOpacity(c.color,c.opacity):null,g=this._context.clippingExtent;H.pointToVector(b,K,this._context.elevationProvider.spatialReference);if(h.isSome(g)&&!u.containsPoint(g,K))return null;var g=this._requiresTerrainElevation(d),l=this._computeGlobalTransform(b,d,Q,g?T:null);c=this._computeLocalTransform(this.symbolLayer,c,N);var k=this._lodRenderer.instanceData,m=k.addInstance();this._instanceIndexToGraphicUid.set(m,e);k.setLocalTransform(m,c,!1);k.setGlobalTransform(m,
l);a&&k.setFeatureAttribute(m,a);f&&k.setColor(m,f);e=new v(this,m,x.perLodInstanceElevationAligner,d);g&&(e.alignedSampledElevation=T.sampledElevation);e.needsElevationUpdates=w.needsElevationUpdates3D(d.mode);C.extendPointGraphicElevationContext(e,b,this._context.elevationProvider);return e};c.prototype._computeGlobalTransform=function(a,b,c,d){b=w.evaluateElevationAlignmentAtPoint(a,this._context.elevationProvider,b,this._context.renderCoordsHelper,d);K[0]=a.x;K[1]=a.y;K[2]=b;H.computeLinearTransformation(a.spatialReference,
K,c,this._context.renderCoordsHelper.spatialReference);return c};c.prototype._computeLocalTransform=function(b,c,d){a.mat4.identity(d);this._applyObjectRotation(c,!1,d);this._applyObjectRotation(b,!0,d);this._applyObjectScale(c,d);this._applyAnchor(b,d);return d};c.prototype._applyObjectScale=function(b,c){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(b=y.computeObjectScale(this._drivenProperties.size&&b.size?b.size:this._symbolSize,this._symbolSize,this._resourceSize,
this._context.renderCoordsHelper.unitInMeters),1===b[0]&&1===b[1]&&1===b[2]||a.mat4.scale(c,c,b))};c.prototype.prepareSymbolLayerPatch=function(a){if("partial"===a.diff.type){var b=a.diff.diff;this._preparePatchTransform(a,b);this._preparePatchColor(a,b)}};c.prototype.updateGeometry=function(a,b){var c=b&&C.placePointOnGeometry(b);if(h.isNone(c))return!1;b=this.getGeometryElevationMode(b);if(a.elevationContext.mode!==b)return!1;b=this._requiresTerrainElevation(a.elevationContext);this._computeGlobalTransform(c,
a.elevationContext,Q,b?T:null);b&&(a.alignedSampledElevation=T.sampledElevation);this._lodRenderer.instanceData.setGlobalTransform(a.instanceIndex,Q,!0);C.extendPointGraphicElevationContext(a,c,this._context.elevationProvider);return!0};c.prototype._preparePatchTransform=function(a,b){var c=this;if(b.heading||b.tilt||b.roll||b.width||b.height||b.depth||b.anchor||b.anchorPosition){var d=function(a,b,c){return h.unwrapOr(null!=a&&"complete"===a.type?a.newValue:b,c)},e=d(b.heading,this.symbolLayer.heading,
0),f=d(b.tilt,this.symbolLayer.tilt,0),g=d(b.roll,this.symbolLayer.roll,0),l=d(b.width,this.symbolLayer.width,void 0),k=d(b.height,this.symbolLayer.height,void 0),m=d(b.depth,this.symbolLayer.depth,void 0),r=d(b.anchor,this.symbolLayer.anchor,void 0),d=d(b.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete b.heading;delete b.tilt;delete b.roll;delete b.width;delete b.height;delete b.depth;delete b.anchor;delete b.anchorPosition;var q={heading:e,tilt:f,roll:g,anchor:r,anchorPosition:d};
1===this.loadStatus&&a.symbolLayerStatePatches.push(function(){c._symbolSize=p.vec3f64.fromArray(y.computeSizeWithResourceSize(c._resourceSize,{width:l,height:k,depth:m,isPrimitive:c.symbolLayer.isPrimitive}))});a.graphics3DGraphicPatches.push(function(a,b){b=c._computeLocalTransform(q,b,N);c._lodRenderer.instanceData.setLocalTransform(a.instanceIndex,b,!0)})}};c.prototype._preparePatchColor=function(a,b){var c=this;if(b.material&&"partial"===b.material.type&&(b=b.material.diff,b.color&&"complete"===
b.color.type&&null!=b.color.newValue&&null!=b.color.oldValue)){var d=b.color.newValue,e=h.isSome(d)?f.toUnitRGBA(d):t.vec4f64.ONES;delete b.color;a.graphics3DGraphicPatches.push(function(a){c._hasPerInstanceColor()?(c._lodRenderer.instanceData.setColor(a.instanceIndex,e),a=c.setMaterialTransparencyParams({},d)):a=c.setMaterialTransparencyParams({externalColor:e},d);for(var b=0,f=c._materials;b<f.length;b++)f[b].setParameterValues(a)})}};c.prototype._requiresTerrainElevation=function(a){return"absolute-height"!==
a.mode};c.prototype._applyObjectRotation=function(a,b,c){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&b))return y.computeObjectRotation(a.heading,a.tilt,a.roll,c)};c.prototype._computeAnchor=function(a){var b=p.vec3f64.create();switch(a.anchor){case "center":q.vec3.copy(b,u.center(this._resourceBoundingBox));q.vec3.negate(b,b);break;case "top":var c=u.center(this._resourceBoundingBox);q.vec3.set(b,-c[0],-c[1],-this._resourceBoundingBox[5]);break;case "bottom":c=
u.center(this._resourceBoundingBox);q.vec3.set(b,-c[0],-c[1],-this._resourceBoundingBox[2]);break;case "relative":var c=u.center(this._resourceBoundingBox),d=u.size(this._resourceBoundingBox);a=(a=a.anchorPosition)?p.vec3f64.fromValues(a.x,a.y,a.z):p.vec3f64.ZEROS;q.vec3.multiply(b,d,a);q.vec3.add(b,b,c);q.vec3.negate(b,b);break;default:this._pivotOffset?q.vec3.negate(b,this._pivotOffset):q.vec3.copy(b,p.vec3f64.ZEROS)}return b};c.prototype._applyAnchor=function(b,c){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||
(b=this._computeAnchor(b))&&a.mat4.translate(c,c,b)};c.prototype._hasPerInstanceColor=function(){return this._drivenProperties.color||this._drivenProperties.opacity};c.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?p.vec3f64.fromArray(u.size(this._resourceBoundingBox)):p.vec3f64.ONES,b=this._resourceBoundingBox?this._computeAnchor(this.symbolLayer):p.vec3f64.ZEROS,c=this._context.renderCoordsHelper.unitInMeters,d=y.computeObjectScale(this._symbolSize,this._symbolSize,
this._resourceSize,c),e=p.vec3f64.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:a,symbolSize:this._symbolSize||p.vec3f64.ONES,unitInMeters:c,transformation:{anchor:b,scale:d,rotation:e}}};return c}(z.default);b.Graphics3DObjectSymbolLayer=n;var K=p.vec3f64.create(),N=c.mat4f64.create(),Q=c.mat4f64.create(),M=t.vec4f64.create(),T={verticalDistanceToGround:0,sampledElevation:0};b.default=n})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../webgl-engine/lib/Object3DStateSet".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){n=function(){function b(b,c,d,e){this.graphics3DSymbolLayer=b;this.instanceIndex=c;this.elevationAligner=d;this.type="lod-instance";this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1;this.elevationContext=new a(e)}b.prototype.initialize=function(){};b.prototype.setVisibility=function(a){var b=this.lodRenderer.instanceData;return a!==b.getVisible(this.instanceIndex)?(b.setVisible(this.instanceIndex,a),!0):!1};b.prototype.destroy=
function(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};b.prototype.alignWithElevation=function(a,b,c){this.elevationAligner&&(d.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedSampledElevation=a))};b.prototype.getBSRadius=function(){var a=this.lodRenderer;return a.baseBoundingSphere.radius*
a.instanceData.getCombinedMaxScaleFactor(this.instanceIndex)};b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=l.vec3f64.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,x);return f.vec3.transformMat4(a,this.lodRenderer.baseBoundingSphere.center,x)};b.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=h.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,x);var b=this.lodRenderer.baseBoundingBox;h.empty(a);
for(var c=0;8>c;++c)f.vec3.set(t,0===(c&1)?b[0]:b[3],0===(c&2)?b[1]:b[4],0===(c&4)?b[2]:b[5]),f.vec3.transformMat4(t,t,x),h.expandPointInPlace(a,t);return a};b.prototype.computeAttachmentOrigin=function(a){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,x);a.render.origin[0]+=x[12];a.render.origin[1]+=x[13];a.render.origin[2]+=x[14];a.render.num++};b.prototype.getProjectedBoundingBox=function(a,b,d,e,l){return g(this,void 0,void 0,function(){var g,m,q,n,v,w,y,z,A;return k(this,
function(k){switch(k.label){case 0:g=this.getBoundingBoxObjectSpace(l);m=r;q=h.isPoint(g)?1:m.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,x);for(n=0;n<q;n++)v=m[n],t[0]=g[v[0]],t[1]=g[v[1]],t[2]=g[v[2]],f.vec3.transformMat4(t,t,x),p[3*n+0]=t[0],p[3*n+1]=t[1],p[3*n+2]=t[2];if(!a(p,0,q))return[2,null];h.empty(g);w=null;this.calculateRelativeScreenBounds&&(w=this.calculateRelativeScreenBounds());for(n=0;n<3*q;n+=3){for(y=0;3>y;y++)g[y]=Math.min(g[y],p[n+y]),g[y+3]=Math.max(g[y+
3],p[n+y]);w&&d.push({location:p.slice(n,n+3),screenSpaceBoundingRect:w})}if(!b)return[3,5];h.center(g,u);if("absolute-height"===this.elevationContext.mode)return[3,5];z=void 0;A=c.demResolutionForBoundingBox(g,b);k.label=1;case 1:return k.trys.push([1,3,,4]),[4,b.service.queryElevation(u[0],u[1],e,A)];case 2:return z=k.sent(),[3,4];case 3:return k.sent(),z=null,[3,4];case 4:null!=z&&h.offset(g,0,0,-this.alignedSampledElevation+z),k.label=5;case 5:return[2,g]}})})};b.prototype.addObjectState=function(a,
b){var c=this;0===a&&(a=q.generateObject3DStateId(a),this.addHighlightId(a),b.addExternal(function(a){c.removeHighlightId(a)},a))};b.prototype.removeObjectState=function(a){this.highlights&&this.highlights.forEach(function(b){return a.remove(b)})};b.prototype.addHighlightId=function(a){this.highlights=this.highlights||new Set;this.highlights.add(a);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};b.prototype.removeHighlightId=function(a){this.highlights&&(this.highlights.delete(a),
this.lodRenderer.instanceData.setHighlight(this.instanceIndex,0<this.highlights.size),0===this.highlights.size&&(this.highlights=null))};Object.defineProperty(b.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},enumerable:!0,configurable:!0});return b}();var p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=l.vec3f64.create(),u=l.vec3f64.create(),r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],x=e.mat4f64.create();return n})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["require",
"exports","../../../../core/tsSupport/generatorHelper","../../../../core/tsSupport/awaiterHelper","../../webgl-engine/lib/lodRendering/LodResources"],function(n,b,m,k,g){function e(b){var d=[];b.stageResources.geometries.forEach(function(a,c){d.push({material:b.stageResources.materials[c],geometry:a,textures:b.stageResources.textures})});return{components:d,minScreenSpaceRadius:b.lodThreshold,pivotOffset:b.pivotOffset}}function f(b,d){void 0===d&&(d=l);b=g.computeFaceCount(b);return Math.sqrt(b/(d*
Math.PI))}Object.defineProperty(b,"__esModule",{value:!0});b.makeLodLevelResources=e;b.makeLodResources=function(b){return{levels:b.map(function(b){return e(b)})}};b.estimateMinScreenSpaceRadius=f;b.fillEstimatedMinScreenSpaceRadius=function(b){b.levels.forEach(function(b){b.minScreenSpaceRadius||(b.minScreenSpaceRadius=f(b))})};var l=.05})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../core/devEnvironmentUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../support/buffer/BufferView ../../support/buffer/math ../../support/buffer/utils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F){function E(a){var b=a.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return b?{fileType:"gltf",url:b[1],specifiedLodIndex:null!=b[4]?Number(b[4]):null}:a.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:a,specifiedLodIndex:null}:{fileType:"unknown",url:a,specifiedLodIndex:null}}function G(a,b,c,f){var g=a.model,k=d.mat3f64.create(),m=[],p=new Map,r=new Map;g.lods.forEach(function(a,d){if(void 0===f||d===f){var q=0,u={name:a.name,stageResources:{textures:[],
materials:[],geometries:[]},lodThreshold:l.isSome(a.lodThreshold)?a.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:t.empty()};m.push(u);a.parts.forEach(function(d){var f=d.material+(d.attributes.normal?"_normal":"")+(d.attributes.color?"_color":"")+(d.attributes.texCoord0?"_texCoord0":"")+(d.attributes.tangent?"_tangent":""),m=g.materials.get(d.material),n=l.isSome(d.attributes.texCoord0),w=l.isSome(d.attributes.normal);if(!p.has(f)){if(n){if(l.isSome(m.textureColor)&&!r.has(m.textureColor)){var K=
g.textures.get(m.textureColor),M=e({},K.parameters,{preMultiplyAlpha:!0});r.set(m.textureColor,new C(K.data,m.textureColor,M))}l.isSome(m.textureNormal)&&!r.has(m.textureNormal)&&(K=g.textures.get(m.textureNormal),M=e({},K.parameters,{preMultiplyAlpha:!0}),r.set(m.textureNormal,new C(K.data,m.textureNormal,M)));l.isSome(m.textureOcclusion)&&!r.has(m.textureOcclusion)&&(K=g.textures.get(m.textureOcclusion),M=e({},K.parameters,{preMultiplyAlpha:!0}),r.set(m.textureOcclusion,new C(K.data,m.textureOcclusion,
M)));l.isSome(m.textureEmissive)&&!r.has(m.textureEmissive)&&(K=g.textures.get(m.textureEmissive),M=e({},K.parameters,{preMultiplyAlpha:!0}),r.set(m.textureEmissive,new C(K.data,m.textureEmissive,M)));l.isSome(m.textureMetallicRoughness)&&!r.has(m.textureMetallicRoughness)&&(K=g.textures.get(m.textureMetallicRoughness),M=e({},K.parameters,{preMultiplyAlpha:!0}),r.set(m.textureMetallicRoughness,new C(K.data,m.textureMetallicRoughness,M)))}var D=F.COLOR_GAMMA,K=Math.pow(m.color[0],1/D),M=Math.pow(m.color[1],
1/D),S=Math.pow(m.color[2],1/D),N=Math.pow(m.emissiveFactor[0],1/D),E=Math.pow(m.emissiveFactor[1],1/D),D=Math.pow(m.emissiveFactor[2],1/D);p.set(f,new F(e({},b,{transparent:"BLEND"===m.alphaMode,textureAlphaMode:H(m.alphaMode),textureAlphaCutoff:m.alphaCutoff,diffuse:[K,M,S],ambient:[K,M,S],opacity:m.opacity,doubleSided:m.doubleSided,doubleSidedType:"winding-order",cullFace:m.doubleSided?0:2,vertexColors:!!d.attributes.color,vertexTangents:!!d.attributes.tangent,normals:w?"default":"screenDerivative",
castShadows:!0,receiveSSAO:!0,textureId:l.isSome(m.textureColor)&&n?r.get(m.textureColor).id:void 0,colorMixMode:m.colorMixMode,normalTextureId:l.isSome(m.textureNormal)&&n?r.get(m.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:l.isSome(m.textureOcclusion)&&n?r.get(m.textureOcclusion).id:void 0,emissiveTextureId:l.isSome(m.textureEmissive)&&n?r.get(m.textureEmissive).id:void 0,metallicRoughnessTextureId:l.isSome(m.textureMetallicRoughness)&&n?r.get(m.textureMetallicRoughness).id:
void 0,emissiveFactor:[N,E,D],mrrFactors:[m.metallicFactor,m.roughnessFactor,b.mrrFactors[2]],isSchematic:!1},c),f))}a:{w=d.indices||d.attributes.position.count;switch(d.primitiveType){case 4:K=x.trianglesToTriangles(w);break a;case 5:K=x.triangleStripToTriangles(w);break a;case 6:K=x.triangleFanToTriangles(w);break a}K=void 0}M={};S={};w=d.attributes.position.count;N=y.createBuffer(v.BufferViewVec3f,w);z.vec3.transformMat4(N,d.attributes.position,d.transform);S.position={data:N.typedBuffer,size:N.elementCount};
M.position=K;l.isSome(d.attributes.normal)&&(N=y.createBuffer(v.BufferViewVec3f,w),h.mat3.normalFromMat4(k,d.transform),z.vec3.transformMat3(N,d.attributes.normal,k),S.normal={data:N.typedBuffer,size:N.elementCount},M.normal=K);l.isSome(d.attributes.tangent)&&(N=y.createBuffer(v.BufferViewVec4f,w),h.mat3.normalFromMat4(k,d.transform),z.vec4.transformMat3(N,d.attributes.tangent,k),S.tangent={data:N.typedBuffer,size:N.elementCount},M.tangent=K);l.isSome(d.attributes.texCoord0)&&(N=y.createBuffer(v.BufferViewVec2f,
w),y.vec2.normalizeIntegerBuffer(N,d.attributes.texCoord0),S.uv0={data:N.typedBuffer,size:N.elementCount},M.uv0=K);l.isSome(d.attributes.color)&&(N=y.createBuffer(v.BufferViewVec4u8,w),4===d.attributes.color.elementCount?d.attributes.color instanceof v.BufferViewVec4f?z.vec4.scale(N,d.attributes.color,255):d.attributes.color instanceof v.BufferViewVec4u8?y.vec4.copy(N,d.attributes.color):d.attributes.color instanceof v.BufferViewVec4u16&&z.vec4.scale(N,d.attributes.color,1/256):(y.vec4.fill(N,255,
255,255,255),E=new v.BufferViewVec3u8(N.buffer,0,4),d.attributes.color instanceof v.BufferViewVec3f?z.vec3.scale(E,d.attributes.color,255):d.attributes.color instanceof v.BufferViewVec3u8?y.vec3.copy(E,d.attributes.color):d.attributes.color instanceof v.BufferViewVec3u16&&z.vec3.scale(E,d.attributes.color,1/256)),S.color={data:N.typedBuffer,size:N.elementCount},M.color=K);d=new A(new B.GeometryData(S,M),"gltf_"+a.name+"_"+q++);u.stageResources.geometries.push(d);u.stageResources.materials.push(p.get(f));
n&&(l.isSome(m.textureColor)&&u.stageResources.textures.push(r.get(m.textureColor)),l.isSome(m.textureNormal)&&u.stageResources.textures.push(r.get(m.textureNormal)),l.isSome(m.textureOcclusion)&&u.stageResources.textures.push(r.get(m.textureOcclusion)),l.isSome(m.textureEmissive)&&u.stageResources.textures.push(r.get(m.textureEmissive)),l.isSome(m.textureMetallicRoughness)&&u.stageResources.textures.push(r.get(m.textureMetallicRoughness)));u.numberOfVertices+=w;f=d.boundingInfo;t.expand(u.boundingBox,
f.getBBMin());t.expand(u.boundingBox,f.getBBMax())})}});return m}function H(a){switch(a){case "BLEND":return"blend";case "MASK":return"mask";case "OPAQUE":return"opaque";default:return"blend"}}Object.defineProperty(b,"__esModule",{value:!0});b.fetch=function(b,d){return g(this,void 0,void 0,function(){var h,g,m,t,n,x,z,A,B,C,F,D;return k(this,function(k){switch(k.label){case 0:return h=E(f.adjustStaticAGOUrl(b)),"wosr"!==h.fileType?[3,2]:[4,d.cache?d.cache.loadWOSR(h.url,d):w.load(h.url,d)];case 1:return g=
k.sent(),m=w.processLoadResult(g,d),[2,{lods:[m],referenceBoundingBox:m.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:g.remove}];case 2:return[4,d.cache?d.cache.loadGLTF(h.url,d):r.load(new u.DefaultLoadingContext(d.streamDataRequester),h.url,d)];case 3:t=k.sent();n=l.get(t.model.meta,"ESRI_proxyEllipsoid");if(t.meta.isEsriSymbolResource&&l.isSome(n)&&-1!==t.meta.uri.indexOf("/RealisticTrees/"))a:{k=t;for(var K=n,M=0;M<k.model.lods.length;++M){var N=k.model.lods[M];k.customMeta.esriTreeRendering=
!0;for(var S=0,N=N.parts;S<N.length;S++){var T=N[S],J=T.attributes.normal;if(l.isNone(J))break a;for(var I=T.attributes.position,V=I.count,P=p.vec3f64.create(),H=p.vec3f64.create(),Q=p.vec3f64.create(),O=y.createBuffer(v.BufferViewVec4u8,V),L=y.createBuffer(v.BufferViewVec3f,V),U=a.mat4.invert(c.mat4f64.create(),T.transform),Y=0;Y<V;Y++){I.getVec(Y,H);J.getVec(Y,P);q.vec3.transformMat4(H,H,T.transform);q.vec3.subtract(Q,H,K.center);q.vec3.divide(Q,Q,K.radius);var ia=Q[2],ga=q.vec3.length(Q),ga=Math.min(.45+
.55*ga*ga,1);q.vec3.divide(Q,Q,K.radius);q.vec3.transformMat4(Q,Q,U);q.vec3.normalize(Q,Q);M+1!==k.model.lods.length&&1<k.model.lods.length&&(-1<ia?q.vec3.lerp(Q,Q,P,.2):q.vec3.lerp(Q,Q,P,Math.min(-4*ia-3.8,1)));L.setVec(Y,Q);O.set(Y,0,255*ga);O.set(Y,1,255*ga);O.set(Y,2,255*ga);O.set(Y,3,255)}T.attributes.normal=L;T.attributes.color=O}}}x=t.meta.isEsriSymbolResource?{usePBR:d.usePBR,isSchematic:!1,treeRendering:t.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:!0,isSchematic:!1,mrrFactors:[0,
1,.5]};z=e({},d.materialParamsMixin,{treeRendering:t.customMeta.esriTreeRendering});if(null!=h.specifiedLodIndex)return A=G(t,x,z,h.specifiedLodIndex),B=A[0].boundingBox,0!==h.specifiedLodIndex&&(C=G(t,x,z,0),B=C[0].boundingBox),[2,{lods:A,referenceBoundingBox:B,isEsriSymbolResource:t.meta.isEsriSymbolResource,isWosr:!1,remove:t.remove}];F=G(t,x,z);D=F[0].boundingBox;return[2,{lods:F,referenceBoundingBox:D,isEsriSymbolResource:t.meta.isEsriSymbolResource,isWosr:!1,remove:t.remove}]}})})};b.parseUrl=
E;b.gltfToEngineResources=G})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils".split(" "),function(n,b,m,k,g,e,f,l,h,d,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.streamDataRequester=
a}b.prototype.loadJSON=function(a,b){return m(this,void 0,void 0,function(){return k(this,function(c){return[2,this.load("json",a,b)]})})};b.prototype.loadBinary=function(b,c){return m(this,void 0,void 0,function(){return k(this,function(e){return a.isDataProtocol(b)?(d.throwIfAborted(c),[2,a.dataToArrayBuffer(b)]):[2,this.load("binary",b,c)]})})};b.prototype.loadImage=function(a,b){return m(this,void 0,void 0,function(){return k(this,function(c){return[2,this.load("image",a,b)]})})};b.prototype.load=
function(a,b,g){return m(this,void 0,void 0,function(){var m;return k(this,function(k){switch(k.label){case 0:return h.isNone(this.streamDataRequester)?[4,e(b,{responseType:c[a]})]:[3,2];case 1:return[2,k.sent().data];case 2:return[4,f.result(this.streamDataRequester.request(b,a,g))];case 3:m=k.sent();if(!0===m.ok)return[2,m.value];d.throwIfAbortError(m.error);throw new l("","Request for resource failed: "+m.error);}})})};return b}();b.DefaultLoadingContext=n;var c={image:"image",binary:"array-buffer",
json:"json"}})},"esri/views/3d/glTF/loader":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper ../../../core/maybe ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource".split(" "),function(n,b,m,k,g,e,f,l,h,d,a){function c(a){var b=null;a.json.nodes.forEach(function(a){a=a.extras;e.isSome(a)&&(a.ESRI_proxyEllipsoid||a.ESRI_lod)&&(b=
a)});return b}function q(a,b){return m(this,void 0,void 0,function(){function c(e,f){return m(this,void 0,void 0,function(){var h,g,l,m,p,q,u,t,n;return k(this,function(k){switch(k.label){case 0:h=d.nodes[e];g=a.getNodeTransform(e);r.warnUnsupportedIf(null!=h.weights,"Morph targets are not supported.");if(null==h.mesh)return[3,4];l=d.meshes[h.mesh];m=0;p=l.primitives;k.label=1;case 1:if(!(m<p.length))return[3,4];q=p[m];return[4,b(q,g,f,l.name)];case 2:k.sent(),k.label=3;case 3:return m++,[3,1];case 4:u=
0,t=h.children||[],k.label=5;case 5:if(!(u<t.length))return[3,8];n=t[u];return[4,c(n,f)];case 6:k.sent(),k.label=7;case 7:return u++,[3,5];case 8:return[2]}})})}var d,e,h,g,l,p,q,u,t,n;return k(this,function(b){switch(b.label){case 0:d=a.json,e=d.scenes[d.scene||0],h=e.nodes,g=1<h.length,l=0,p=h,b.label=1;case 1:if(!(l<p.length))return[3,4];q=p[l];u=d.nodes[q];t=[c(q,0)];u.extensions&&u.extensions.MSFT_lod&&Array.isArray(u.extensions.MSFT_lod.ids)&&!g&&(n=u.extensions.MSFT_lod.ids,t.push.apply(t,
n.map(function(a,b){return c(a,b+1)})));return[4,f.all(t)];case 2:b.sent(),b.label=3;case 3:return l++,[3,1];case 4:return[2]}})})}function p(a,b,c){var e=function(b){var e=c+"_tex_"+(b&&b.id)+(b&&b.name?"_"+b.name:"");if(b&&!a.textures.has(e)){var f=d.makeTextureSource(b.data,{wrap:{s:t(b.wrapS),t:t(b.wrapT)},mipmap:x.some(function(a){return a===b.minFilter}),noUnpackFlip:!0});a.textures.set(e,f)}return e},f=c+"_mat_"+b.id+"_"+b.name;a.materials.has(f)||(b=d.makeMaterialParameters({color:[b.color[0],
b.color[1],b.color[2]],opacity:b.color[3],alphaMode:b.alphaMode,alphaCutoff:b.alphaCutoff,doubleSided:b.doubleSided,colorMixMode:b.ESRI_externalColorMixMode,textureColor:b.colorTexture?e(b.colorTexture):void 0,textureNormal:b.normalTexture?e(b.normalTexture):void 0,textureOcclusion:b.occlusionTexture?e(b.occlusionTexture):void 0,textureEmissive:b.emissiveTexture?e(b.emissiveTexture):void 0,textureMetallicRoughness:b.metallicRoughnessTexture?e(b.metallicRoughnessTexture):void 0,emissiveFactor:[b.emissiveFactor[0],
b.emissiveFactor[1],b.emissiveFactor[2]],metallicFactor:b.metallicFactor,roughnessFactor:b.roughnessFactor}),a.materials.set(f,b));return f}function t(a){if(33071===a||33648===a||10497===a)return a;r.error("Unexpected TextureSampler WrapMode: "+a)}Object.defineProperty(b,"__esModule",{value:!0});var u=0;b.load=function(b,d,f){void 0===f&&(f={});return m(this,void 0,void 0,function(){var h,g,t,n,v=this;return k(this,function(x){switch(x.label){case 0:return[4,a.Resource.load(b,r,d,f)];case 1:return h=
x.sent(),g="gltf_"+u++,t={lods:[],materials:new Map,textures:new Map,meta:c(h)},n=!(!h.json.asset.extras||"symbolResource"!==h.json.asset.extras.ESRI_type),[4,q(h,function(a,b,c,d){return m(v,void 0,void 0,function(){var m,q,u,n,v,x,y,z,A,B,C;return k(this,function(k){switch(k.label){case 0:m=void 0!==a.mode?a.mode:4;a:switch(m){case 4:case 5:case 6:q=m;break a;default:q=null}return e.isNone(q)?(r.warnUnsupported("Unsupported primitive mode ("+w[m]+"). Skipping primitive."),[2]):h.hasPositions(a)?
[4,h.getMaterial(a,f)]:(r.warn("Skipping primitive without POSITION vertex attribute."),[2]);case 1:return u=k.sent(),v={transform:l.mat4f64.clone(b)},x={},[4,h.getPositionData(a,f)];case 2:return v.attributes=(x.position=k.sent(),x.normal=null,x.texCoord0=null,x.color=null,x.tangent=null,x),[4,h.getIndexData(a,f)];case 3:n=(v.indices=k.sent(),v.primitiveType=q,v.material=p(t,u,g),v);if(!h.hasNormals(a))return[3,5];y=n.attributes;return[4,h.getNormalData(a,f)];case 4:y.normal=k.sent(),k.label=5;case 5:if(!h.hasTangents(a))return[3,
7];z=n.attributes;return[4,h.getTangentData(a,f)];case 6:z.tangent=k.sent(),k.label=7;case 7:if(!h.hasTextureCoordinates(a))return[3,9];A=n.attributes;return[4,h.getTextureCoordinates(a,f)];case 8:A.texCoord0=k.sent(),k.label=9;case 9:if(!h.hasVertexColors(a))return[3,11];B=n.attributes;return[4,h.getVertexColors(a,f)];case 10:B.color=k.sent(),k.label=11;case 11:return C=null,e.isSome(t.meta)&&e.isSome(t.meta.ESRI_lod)&&"screenSpaceRadius"===t.meta.ESRI_lod.metric&&(C=t.meta.ESRI_lod.thresholds[c]),
t.lods[c]=t.lods[c]||{parts:[],name:d,lodThreshold:C},t.lods[c].parts.push(n),[2]}})})})];case 2:return x.sent(),[2,{model:t,meta:{isEsriSymbolResource:n,uri:h.uri},customMeta:{}}]}})})};var r=new h.DefaultErrorContext,x=[9987,9985],w="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ")})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["require","exports","../../../core/Error","../../../core/Logger"],function(n,b,m,k){Object.defineProperty(b,"__esModule",
{value:!0});var g=k.getLogger("esri.views.3d.glTF");n=function(){function b(){}b.prototype.error=function(b){throw new m("gltf-loader-error",b);};b.prototype.errorUnsupported=function(b){throw new m("gltf-loader-unsupported-feature",b);};b.prototype.errorUnsupportedIf=function(b,e){b&&this.errorUnsupported(e)};b.prototype.assert=function(b,e){b||this.error(e)};b.prototype.warn=function(b){g.warn(b)};b.prototype.warnUnsupported=function(b){this.warn("[Unsupported Feature] "+b)};b.prototype.warnUnsupportedIf=
function(b,e){b&&this.warnUnsupported(e)};return b}();b.DefaultErrorContext=n})},"esri/views/3d/glTF/LoaderResult":function(){define(["require","exports","../../../core/tsSupport/assignHelper"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.makeMaterialParameters=function(b){void 0===b&&(b={});return m({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,
textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},b)};b.makeTextureSource=function(b,g){void 0===g&&(g={});return{data:b,parameters:m({wrap:m({s:10497,t:10497},g.wrap),noUnpackFlip:!0,mipmap:!1},g)}}})},"esri/views/3d/glTF/internal/Resource":function(){define("require exports ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/assignHelper ../../../../core/compilerUtils ../../../../core/promiseUtils ../../../../core/string ../../../../core/urlUtils ../../../../core/urlUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf64 ./BinaryStreamReader ./fillDefaults ./pathUtils ../../support/buffer/BufferView ../../support/buffer/utils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v){function z(a){switch(a.componentType){case 5120:return new w.BufferViewVec2i8(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5121:return new w.BufferViewVec2u8(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5122:return new w.BufferViewVec2i16(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5123:return new w.BufferViewVec2u16(a.raw,a.byteOffset,a.byteStride,a.byteOffset+
a.byteStride*a.entryCount);case 5125:return new w.BufferViewVec2u32(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5126:return new w.BufferViewVec2f(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);default:e.neverReached(a.componentType)}}function y(a){return m(this,void 0,void 0,function(){return k(this,function(b){return[2,f.create(function(b,c){var d=new Blob([a]),e=new FileReader;e.onload=function(){b(JSON.parse(e.result))};e.onerror=function(a){c(a)};
e.readAsText(d)})]})})}function A(a,b){return m(this,void 0,void 0,function(){return k(this,function(c){return[2,f.create(function(c,d){var e=new Blob([a],{type:b}),f=URL.createObjectURL(e),h=new Image;h.addEventListener("load",function(){URL.revokeObjectURL(f);"decode"in h?h.decode().then(function(){return c(h)},function(){return c(h)}):c(h)});h.addEventListener("error",function(a){URL.revokeObjectURL(f);d(a)});h.src=f})]})})}Object.defineProperty(b,"__esModule",{value:!0});var B;n=function(){function b(a,
b,c,d,e){this.context=a;this.errorContext=b;this.uri=c;this.json=d;this.glbBuffer=e;this.bufferCache=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=x.splitURI(this.uri).dirPart;this.checkVersionSupported();this.checkRequiredExtensionsSupported();b.errorUnsupportedIf(null==d.scenes,"Scenes must be defined.");b.errorUnsupportedIf(null==d.meshes,"Meshes must be defined");b.errorUnsupportedIf(null==d.nodes,"Nodes must be defined.");
this.computeNodeParents()}b.load=function(a,c,e,f){return m(this,void 0,void 0,function(){var h,g,m,p,r,q;return k(this,function(k){switch(k.label){case 0:if(d.isDataProtocol(e)){h=d.dataComponents(e);if("model/gltf-binary"!==h.mediaType)try{return g=JSON.parse(h.isBase64?atob(h.data):h.data),[2,new b(a,c,e,g)]}catch(U){}m=d.dataToArrayBuffer(e);if(b.isGLBData(m))return[2,this.fromGLBData(a,c,e,m)]}return l.endsWith(e,".gltf")?[4,a.loadJSON(e,f)]:[3,2];case 1:return p=k.sent(),[2,new b(a,c,e,p)];
case 2:return[4,a.loadBinary(e,f)];case 3:return r=k.sent(),b.isGLBData(r)?[2,this.fromGLBData(a,c,e,r)]:[4,a.loadJSON(e,f)];case 4:return q=k.sent(),[2,new b(a,c,e,q)]}})})};b.isGLBData=function(a){a=new u.BinaryStreamReader(a);return 4<=a.remainingBytes()&&1179937895===a.readUint32()};b.fromGLBData=function(a,c,d,e){return m(this,void 0,void 0,function(){var f;return k(this,function(h){switch(h.label){case 0:return[4,b.parseGLBData(c,e)];case 1:return f=h.sent(),[2,new b(a,c,d,f.json,f.binaryData)]}})})};
b.parseGLBData=function(a,b){return m(this,void 0,void 0,function(){var c,d,e,f,h,g,l,m,p;return k(this,function(k){switch(k.label){case 0:c=new u.BinaryStreamReader(b),a.assert(12<=c.remainingBytes(),"GLB binary data is insufficiently large."),d=c.readUint32(),e=c.readUint32(),f=c.readUint32(),a.assert(1179937895===d,"Magic first 4 bytes do not fit to expected GLB value."),a.assert(b.byteLength>=f,"GLB binary data is smaller than header specifies."),a.errorUnsupportedIf(2!==e,"An unsupported GLB container version was detected. Only version 2 is supported."),
h=0,k.label=1;case 1:if(!(8<=c.remainingBytes()))return[3,5];m=c.readUint32();p=c.readUint32();if(0!==h)return[3,3];a.assert(1313821514===p,"First GLB chunk must be JSON.");a.assert(0<=m,"No JSON data found.");return[4,y(c.readUint8Array(m))];case 2:return g=k.sent(),[3,4];case 3:1===h?(a.errorUnsupportedIf(5130562!==p,"Second GLB chunk expected to be BIN."),l=c.readUint8Array(m)):a.warnUnsupported("More than 2 GLB chunks detected. Skipping."),k.label=4;case 4:return h+=1,[3,1];case 5:return g||a.error("No GLB JSON chunk detected."),
[2,{json:g,binaryData:l}]}})})};b.prototype.getBuffer=function(a,b){return m(this,void 0,void 0,function(){var c,d,e,f;return k(this,function(h){switch(h.label){case 0:return c=this.json.buffers[a],d=this.errorContext,null==c.uri?(d.assert(null!=this.glbBuffer,"GLB buffer not present"),[2,this.glbBuffer]):(e=this.bufferCache.get(a))?[3,2]:[4,this.context.loadBinary(this.resolveUri(c.uri),b)];case 1:f=h.sent(),e=new Uint8Array(f),this.bufferCache.set(a,e),d.assert(e.byteLength===c.byteLength,"Buffer byte lengths should match."),
h.label=2;case 2:return[2,e]}})})};b.prototype.getAccessor=function(a,b){return m(this,void 0,void 0,function(){var c,d,e,f,h,g,l,m;return k(this,function(k){switch(k.label){case 0:return c=this.json.accessors[a],d=this.errorContext,d.errorUnsupportedIf(null==c.bufferView,"Some accessor does not specify a bufferView."),d.errorUnsupportedIf(c.type in["MAT2","MAT3","MAT4"],"AttributeType "+c.type+" is not supported"),e=this.json.bufferViews[c.bufferView],[4,this.getBuffer(e.buffer,b)];case 1:return f=
k.sent(),h=G[c.type],g=H[c.componentType],l=h*g,m=e.byteStride||l,[2,{raw:f.buffer,byteStride:m,byteOffset:f.byteOffset+(e.byteOffset||0)+(c.byteOffset||0),entryCount:c.count,isDenselyPacked:m===l,componentCount:h,componentByteSize:g,componentType:c.componentType,min:c.min,max:c.max,normalized:!!c.normalized}]}})})};b.prototype.getIndexData=function(a,b){return m(this,void 0,void 0,function(){var c;return k(this,function(d){switch(d.label){case 0:return null==a.indices?[2,null]:[4,this.getAccessor(a.indices,
b)];case 1:c=d.sent();if(c.isDenselyPacked)switch(c.componentType){case 5121:return[2,new Uint8Array(c.raw,c.byteOffset,c.entryCount)];case 5123:return[2,new Uint16Array(c.raw,c.byteOffset,c.entryCount)];case 5125:return[2,new Uint32Array(c.raw,c.byteOffset,c.entryCount)]}else switch(c.componentType){case 5121:return[2,v.scalar.makeDense(this.wrapAccessor(w.BufferViewUint8,c))];case 5123:return[2,v.scalar.makeDense(this.wrapAccessor(w.BufferViewUint16,c))];case 5125:return[2,v.scalar.makeDense(this.wrapAccessor(w.BufferViewUint32,
c))]}return[2,void 0]}})})};b.prototype.getPositionData=function(a,b){return m(this,void 0,void 0,function(){var c,d;return k(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.errorUnsupportedIf(null==a.attributes.POSITION,"No POSITION vertex data found."),[4,this.getAccessor(a.attributes.POSITION,b)];case 1:return d=e.sent(),c.errorUnsupportedIf(5126!==d.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+D[d.componentType]),c.errorUnsupportedIf(3!==d.componentCount,
"POSITION vertex attribute must have 3 components, but found "+d.componentCount.toFixed()),[2,this.wrapAccessor(w.BufferViewVec3f,d)]}})})};b.prototype.getNormalData=function(a,b){return m(this,void 0,void 0,function(){var c,d;return k(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.assert(null!=a.attributes.NORMAL,"No NORMAL vertex data found."),[4,this.getAccessor(a.attributes.NORMAL,b)];case 1:return d=e.sent(),c.errorUnsupportedIf(5126!==d.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+
D[d.componentType]),c.errorUnsupportedIf(3!==d.componentCount,"NORMAL vertex attribute must have 3 components, but found "+d.componentCount.toFixed()),[2,this.wrapAccessor(w.BufferViewVec3f,d)]}})})};b.prototype.getTangentData=function(a,b){return m(this,void 0,void 0,function(){var c,d;return k(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.assert(null!=a.attributes.TANGENT,"No TANGENT vertex data found."),[4,this.getAccessor(a.attributes.TANGENT,b)];case 1:return d=e.sent(),
c.errorUnsupportedIf(5126!==d.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+D[d.componentType]),c.errorUnsupportedIf(4!==d.componentCount,"TANGENT vertex attribute must have 4 components, but found "+d.componentCount.toFixed()),[2,new w.BufferViewVec4f(d.raw,d.byteOffset,d.byteStride,d.byteOffset+d.byteStride*d.entryCount)]}})})};b.prototype.getTextureCoordinates=function(a,b){return m(this,void 0,void 0,function(){var c,d;return k(this,function(e){switch(e.label){case 0:return c=
this.errorContext,c.assert(null!=a.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found."),[4,this.getAccessor(a.attributes.TEXCOORD_0,b)];case 1:d=e.sent();c.errorUnsupportedIf(2!==d.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+d.componentCount.toFixed());if(5126===d.componentType)return[2,this.wrapAccessor(w.BufferViewVec2f,d)];c.errorUnsupportedIf(!d.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return[2,
z(d)]}})})};b.prototype.getVertexColors=function(a,b){return m(this,void 0,void 0,function(){var c,d;return k(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.assert(null!=a.attributes.COLOR_0,"No COLOR_0 vertex data found."),[4,this.getAccessor(a.attributes.COLOR_0,b)];case 1:d=e.sent();c.errorUnsupportedIf(4!==d.componentCount&&3!==d.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+d.componentCount.toFixed());if(4===d.componentCount){if(5126===d.componentType)return[2,
this.wrapAccessor(w.BufferViewVec4f,d)];if(5121===d.componentType)return[2,this.wrapAccessor(w.BufferViewVec4u8,d)];if(5123===d.componentType)return[2,this.wrapAccessor(w.BufferViewVec4u16,d)]}else if(3===d.componentCount){if(5126===d.componentType)return[2,this.wrapAccessor(w.BufferViewVec3f,d)];if(5121===d.componentType)return[2,this.wrapAccessor(w.BufferViewVec3u8,d)];if(5123===d.componentType)return[2,this.wrapAccessor(w.BufferViewVec3u16,d)]}c.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+
D[d.componentType]);return[2,void 0]}})})};b.prototype.hasPositions=function(a){return void 0!==a.attributes.POSITION};b.prototype.hasNormals=function(a){return void 0!==a.attributes.NORMAL};b.prototype.hasVertexColors=function(a){return void 0!==a.attributes.COLOR_0};b.prototype.hasTextureCoordinates=function(a){return void 0!==a.attributes.TEXCOORD_0};b.prototype.hasTangents=function(a){return void 0!==a.attributes.TANGENT};b.prototype.getMaterial=function(a,b){return m(this,void 0,void 0,function(){var c,
d,e,f,h,g,l,m,p,q,u;return k(this,function(k){switch(k.label){case 0:c=this.errorContext;if(d=this.materialCache.get(a.material))return[3,15];e=null!=a.material?r.material(this.json.materials[a.material]):r.material();f=e.pbrMetallicRoughness;h=this.hasVertexColors(a);g=void 0;if(!f.baseColorTexture)return[3,2];c.errorUnsupportedIf(0!==(f.baseColorTexture.texCoord||0),"Only TEXCOORD with index 0 is supported.");return[4,this.getTexture(f.baseColorTexture.index,b)];case 1:g=k.sent(),k.label=2;case 2:l=
void 0;if(!e.normalTexture)return[3,5];if(0===(e.normalTexture.texCoord||0))return[3,3];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the normal map texture.");return[3,5];case 3:return[4,this.getTexture(e.normalTexture.index,b)];case 4:l=k.sent(),k.label=5;case 5:m=void 0;if(!e.occlusionTexture)return[3,8];if(0===(e.occlusionTexture.texCoord||0))return[3,6];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the occlusion texture.");return[3,8];case 6:return[4,this.getTexture(e.occlusionTexture.index,
b)];case 7:m=k.sent(),k.label=8;case 8:p=void 0;if(!e.emissiveTexture)return[3,11];if(0===(e.emissiveTexture.texCoord||0))return[3,9];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the emissive texture.");return[3,11];case 9:return[4,this.getTexture(e.emissiveTexture.index,b)];case 10:p=k.sent(),k.label=11;case 11:q=void 0;if(!f.metallicRoughnessTexture)return[3,14];if(0===(f.metallicRoughnessTexture.texCoord||0))return[3,12];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the metallicRoughness texture.");
return[3,14];case 12:return[4,this.getTexture(f.metallicRoughnessTexture.index,b)];case 13:q=k.sent(),k.label=14;case 14:u=null!=a.material?a.material:-1,d={alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,color:f.baseColorFactor,doubleSided:!!e.doubleSided,colorTexture:g,normalTexture:l,name:e.name,id:u,occlusionTexture:m,emissiveTexture:p,emissiveFactor:e.emissiveFactor,metallicFactor:f.metallicFactor,roughnessFactor:f.roughnessFactor,metallicRoughnessTexture:q,vertexColors:h,ESRI_externalColorMixMode:e.extras.ESRI_externalColorMixMode},
k.label=15;case 15:return[2,d]}})})};b.prototype.getTexture=function(a,b){return m(this,void 0,void 0,function(){var c,d,e,f,h,g,l,m;return k(this,function(k){switch(k.label){case 0:c=this.errorContext;d=this.json.textures[a];e=r.textureSampler(null!=d.sampler?this.json.samplers[d.sampler]:{});c.errorUnsupportedIf(null==d.source,"Source is expected to be defined for a texture.");f=this.json.images[d.source];if(h=this.textureCache.get(a))return[3,6];g=void 0;return f.uri?[4,this.context.loadImage(this.resolveUri(f.uri),
b)]:[3,2];case 1:return g=k.sent(),[3,5];case 2:return c.errorUnsupportedIf(null==f.bufferView,"Image bufferView must be defined."),c.errorUnsupportedIf(null==f.mimeType,"Image mimeType must be defined."),l=this.json.bufferViews[f.bufferView],[4,this.getBuffer(l.buffer,b)];case 3:return m=k.sent(),c.errorUnsupportedIf(null!=l.byteStride,"byteStride not supported for image buffer"),[4,A(new Uint8Array(m.buffer,m.byteOffset+(l.byteOffset||0),l.byteLength),f.mimeType)];case 4:g=k.sent(),k.label=5;case 5:h=
{data:g,wrapS:e.wrapS,wrapT:e.wrapT,minFilter:e.minFilter,name:f.name,id:a},this.textureCache.set(a,h),k.label=6;case 6:return[2,h]}})})};b.prototype.getNodeTransform=function(a){if(void 0===a)return F;var b=this.nodeTransformCache.get(a);if(!b){var b=this.getNodeTransform(this.getNodeParent(a)),d=this.json.nodes[a];if(d.matrix)b=c.mat4.multiply(q.mat4f64.create(),b,d.matrix);else if(d.translation||d.rotation||d.scale)b=q.mat4f64.clone(b),d.translation&&c.mat4.translate(b,b,d.translation),d.rotation&&
(E[3]=p.quat.getAxisAngle(E,d.rotation),c.mat4.rotate(b,b,E[3],E)),d.scale&&c.mat4.scale(b,b,d.scale);this.nodeTransformCache.set(a,b)}return b};b.prototype.wrapAccessor=function(a,b){return new a(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*(b.entryCount-1)+b.componentByteSize*b.componentCount)};b.prototype.resolveUri=function(a){return h.makeAbsolute(a,this.baseUri)};b.prototype.getNodeParent=function(a){return this.nodeParentMap.get(a)};b.prototype.checkVersionSupported=function(){var b=
a.Version.parse(this.json.asset.version,"glTF");C.validate(b)};b.prototype.checkRequiredExtensionsSupported=function(){var a=this.json,b=this.errorContext;a.extensionsRequired&&0!==a.extensionsRequired.length&&b.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+a.extensionsRequired.join(", "))};b.prototype.computeNodeParents=function(){var a=this;this.json.nodes.forEach(function(b,c){b.children&&b.children.forEach(function(b){a.nodeParentMap.set(b,c)})})};
return b}();b.Resource=n;var C=new a.Version(2,0,"glTF"),F=c.mat4.fromXRotation(q.mat4f64.create(),Math.PI/2),E=t.quatf64.create(),G={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},H=(B={},B[5120]=1,B[5121]=1,B[5122]=2,B[5123]=2,B[5126]=4,B[5125]=4,B),D={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"}})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.data=
b;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}b.prototype.readUint32=function(){var b=this.offset4;this.offset4+=1;return this.dataUint32[b]};b.prototype.readUint8Array=function(b){var g=4*this.offset4;this.offset4+=b/4;return new Uint8Array(this.data,g,b)};b.prototype.remainingBytes=function(){return this.data.byteLength-4*this.offset4};return b}();b.BinaryStreamReader=n})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["require",
"exports","../../../../core/tsSupport/assignHelper","../../../../core/compilerUtils"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});var g={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},e={pbrMetallicRoughness:g,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},f={ESRI_externalColorMixMode:"tint"};b.material=function(b){void 0===b&&(b={});var d=m({},g,b.pbrMetallicRoughness),a=m({},f,b.extras);switch(a.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;
default:k.neverReached(a.ESRI_externalColorMixMode),a.ESRI_externalColorMixMode="tint"}return m({},e,b,{pbrMetallicRoughness:d,extras:a})};var l={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};b.textureSampler=function(b){return m({},l,b)}})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.splitURI=function(b){var k,g;b.replace(/^(.*\/)?([^/]*)$/,function(b,f,l){k=f||"";g=l||"";return""});return{dirPart:k,
filePart:g}}})},"esri/views/3d/support/buffer/utils":function(){define("require exports ./types ./utils/mat3 ./utils/mat4 ./utils/scalar ./utils/vec2 ./utils/vec3 ./utils/vec4".split(" "),function(n,b,m,k,g,e,f,l,h){Object.defineProperty(b,"__esModule",{value:!0});b.mat3=k;b.mat4=g;b.scalar=e;b.vec2=f;b.vec3=l;b.vec4=h;b.createBuffer=function(b,a){return new b(new ArrayBuffer(a*b.ElementCount*m.elementTypeSize(b.ElementType)))}})},"esri/views/3d/support/buffer/utils/mat3":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,k,g){var e=b.typedBuffer;b=b.typedBufferStride;var f=k.typedBuffer,l=k.typedBufferStride;k=g?g.count:k.count;var h=(g&&g.dstIndex?g.dstIndex:0)*b;g=(g&&g.srcIndex?g.srcIndex:0)*l;for(var d=0;d<k;++d){for(var a=0;9>a;++a)e[h+a]=f[g+a];h+=b;g+=l}}})},"esri/views/3d/support/buffer/utils/mat4":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,
k,g){var e=b.typedBuffer;b=b.typedBufferStride;var f=k.typedBuffer,l=k.typedBufferStride;k=g?g.count:k.count;var h=(g&&g.dstIndex?g.dstIndex:0)*b;g=(g&&g.srcIndex?g.srcIndex:0)*l;for(var d=0;d<k;++d){for(var a=0;16>a;++a)e[h+a]=f[g+a];h+=b;g+=l}}})},"esri/views/3d/support/buffer/utils/scalar":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,k,g){var e=b.typedBuffer;b=b.typedBufferStride;var f=k.typedBuffer,l=k.typedBufferStride;
k=g?g.count:k.count;var h=(g&&g.dstIndex?g.dstIndex:0)*b;g=(g&&g.srcIndex?g.srcIndex:0)*l;for(var d=0;d<k;++d)e[h]=f[g],h+=b,g+=l};b.makeDense=function(b,k){var g=b.count;k||(k=new b.TypedArrayConstructor(g));for(var e=0;e<g;e++)k[e]=b.get(e);return k}})},"esri/views/3d/support/buffer/utils/vec2":function(){define(["require","exports","../types"],function(n,b,m){function k(b,e,f){var g=b.typedBuffer;b=b.typedBufferStride;var h=e.typedBuffer,d=e.typedBufferStride;e=f?f.count:e.count;var a=(f&&f.dstIndex?
f.dstIndex:0)*b;f=(f&&f.srcIndex?f.srcIndex:0)*d;for(var c=0;c<e;++c)g[a]=h[f],g[a+1]=h[f+1],a+=b,f+=d}Object.defineProperty(b,"__esModule",{value:!0});b.copy=k;b.normalizeIntegerBuffer=function(b,e,f){var g=b.typedBuffer,h=b.typedBufferStride,d=e.typedBuffer,a=e.typedBufferStride,c=f?f.count:e.count,q=(f&&f.dstIndex?f.dstIndex:0)*h,p=(f&&f.srcIndex?f.srcIndex:0)*a;if(m.isInteger(e.elementType))if(f=m.maximumValue(e.elementType),m.isSigned(e.elementType))for(e=0;e<c;++e)g[q]=Math.max(d[p]/f,-1),g[q+
1]=Math.max(d[p+1]/f,-1),q+=h,p+=a;else for(e=0;e<c;++e)g[q]=d[p]/f,g[q+1]=d[p+1]/f,q+=h,p+=a;else k(b,e,f);return b}})},"esri/views/3d/support/buffer/utils/vec3":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,k,g){var e=b.typedBuffer;b=b.typedBufferStride;var f=k.typedBuffer,l=k.typedBufferStride;k=g?g.count:k.count;var h=(g&&g.dstIndex?g.dstIndex:0)*b;g=(g&&g.srcIndex?g.srcIndex:0)*l;for(var d=0;d<k;++d)e[h]=f[g],e[h+1]=f[g+
1],e[h+2]=f[g+2],h+=b,g+=l}})},"esri/views/3d/support/buffer/utils/vec4":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,k,g){var e=b.typedBuffer;b=b.typedBufferStride;var f=k.typedBuffer,l=k.typedBufferStride;k=g?g.count:k.count;var h=(g&&g.dstIndex?g.dstIndex:0)*b;g=(g&&g.srcIndex?g.srcIndex:0)*l;for(var d=0;d<k;++d)e[h]=f[g],e[h+1]=f[g+1],e[h+2]=f[g+2],e[h+3]=f[g+3],h+=b,g+=l};b.fill=function(b,k,g,e,f,l){var h=b.typedBuffer,
d=b.typedBufferStride;b=l?l.count:b.count;l=(l&&l.dstIndex?l.dstIndex:0)*d;for(var a=0;a<b;++a)h[l]=k,h[l+1]=g,h[l+2]=e,h[l+3]=f,l+=d}})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["require","exports","../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(n,b,m,k){function g(b){return k.generateDefaultIndexArray(b)}Object.defineProperty(b,"__esModule",{value:!0});b.linearIndexArray=g;b.trianglesToTriangles=function(b){return"number"===typeof b?g(b):
m.isUint16Array(b)||m.isUint8Array(b)?new Uint32Array(b):b};b.triangleStripToTriangles=function(b){var e="number"===typeof b?b:b.length;if(3>e)return new Uint32Array(0);var e=e-2,g=new Uint32Array(3*e);if("number"===typeof b)for(var h=0,d=0;d<e;d+=1)0===d%2?(g[h++]=d,g[h++]=d+1):(g[h++]=d+1,g[h++]=d),g[h++]=d+2;else for(d=h=0;d<e;d+=1){if(0===d%2)var a=b[d],c=b[d+1],k=b[d+2];else a=b[d+1],c=b[d],k=b[d+2];g[h++]=a;g[h++]=c;g[h++]=k}return g};b.triangleFanToTriangles=function(b){var e="number"===typeof b?
b:b.length;if(3>e)return new Uint32Array(0);var e=e-2,g=new Uint32Array(3*e);if("number"===typeof b){for(var h=0,d=0;d<e;++d)g[h++]=0,g[h++]=d+1,g[h++]=d+2;return g}for(var a=b[0],c=b[1],d=h=0;d<e;++d){var k=b[d+2];g[h++]=a;g[h++]=c;c=g[h++]=k}return g}})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/lang ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../support/imageUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v){function z(b,d){return g(this,void 0,void 0,function(){var h,g;return k(this,function(l){switch(l.label){case 0:return(h=a.isSome(d)&&d.streamDataRequester)?[2,y(b,h,d)]:[4,f.result(e(b,a.unwrap(d)))];case 1:g=l.sent();if(!0===g.ok)return[2,g.value.data];c.throwIfAbortError(g.error);A(g.error);return[2,void 0]}})})}function y(a,b,d){return g(this,void 0,void 0,function(){var e;return k(this,function(h){switch(h.label){case 0:return[4,f.result(b.request(a,
"json",d))];case 1:e=h.sent();if(!0===e.ok)return[2,e.value];c.throwIfAbortError(e.error);A(e.error.details.url);return[2,void 0]}})})}function A(a){throw new l("","Request for object resource failed: "+a);}function B(a){var b=t.empty();a.forEach(function(a){a=a.boundingInfo;t.expand(b,a.getBBMin());t.expand(b,a.getBBMax())});return b}function C(b,d){return g(this,void 0,void 0,function(){var e,f,h,g,l,m,p,r;return k(this,function(k){switch(k.label){case 0:e=[];f=function(f){var h=b[f],g=h.images[0].data;
if(!g)return E.warn("Externally referenced texture data is not yet supported"),"continue";var g=h.encoding+";base64,"+g,l="/textureDefinitions/"+f,k={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0};f=a.isSome(d)&&d.disableTextures?c.resolve(null):u.requestImage(g,d);e.push(f.then(function(a){return{refId:l,image:a,params:k,alphaChannelUsage:"rgba"===h.channels?h.alphaChannelUsage||"transparency":"none"}}))};for(h in b)f(h);return[4,c.all(e)];case 1:g=k.sent();l={};m=0;for(p=g;m<p.length;m++)r=
p[m],l[r.refId]=r;return[2,l]}})})}function F(a){switch(a){case "mask":return"mask";case "maskAndTransparency":return"maskBlend";case "none":return"opaque";case "transparency":return"blend";default:return"blend"}}Object.defineProperty(b,"__esModule",{value:!0});var E=d.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");b.load=function(a,b){return g(this,void 0,void 0,function(){var c,d;return k(this,function(e){switch(e.label){case 0:return[4,z(a,b)];case 1:return c=e.sent(),[4,C(c.textureDefinitions,
b)];case 2:return d=e.sent(),[2,{resource:c,textures:d}]}})})};b.processLoadResult=function(b,c){var d,e,f=[],g=[],l=[],k=[],m=b.resource,u=q.Version.parse(m.version||"1.0","wosr");G.validate(u);var u=m.model.name,t=m.model.geometries,n=m.materialDefinitions;b=b.textures;for(var y=0,z=new Map,A=0;A<t.length;A++){var C=t[A];e=C;var D=e.params,R=D.topology;d=!0;D.vertexAttributes||(E.warn("Geometry must specify vertex attributes"),d=!1);switch(D.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:R=
D.faces;if(!R)E.warn("Indexed geometries must specify faces"),d=!1;else if(D.vertexAttributes){var H=void 0;for(H in D.vertexAttributes)(D=R[H])&&D.values?(null!=D.valueType&&"UInt32"!==D.valueType&&(E.warn("Unsupported indexed geometry indices type '"+D.valueType+"', only UInt32 is currently supported"),d=!1),null!=D.valuesPerElement&&1!==D.valuesPerElement&&(E.warn("Unsupported indexed geometry values per element '"+D.valuesPerElement+"', only 1 is currently supported"),d=!1)):(E.warn("Indexed geometry does not specify face indices for '"+
H+"' attribute"),d=!1)}break;default:E.warn("Unsupported topology '"+R+"'"),d=!1}e.params.material||(E.warn("Geometry requires material"),d=!1);e=e.params.vertexAttributes;D=void 0;for(D in e)e[D].values||(E.warn("Geometries with externally defined attributes are not yet supported"),d=!1);if(d){e=C.params;d=e.material;e=e.texture;var R=C.params.vertexAttributes,D={},da;for(da in R)H=R[da],D[da]={data:H.values,size:H.valuesPerElement};R={};if("PerAttributeArray"===C.params.topology){for(var C=D.position.data.length/
D.position.size,H=new Uint32Array(C),ca=0;ca<C;ca++)H[ca]=ca;var C=H,ba;for(ba in D)R[ba]=C}else{var C=C.params.faces,W;for(W in C)R[W]=new Uint32Array(C[W].values)}(C=b&&b[e])&&!z.has(e)&&(H=new w(C.image,u,C.params),k.push(H),z.set(e,H));H=(H=z.get(e))?H.id:void 0;ca=l[d]?l[d][e]:null;if(!ca){ca=d.substring(d.lastIndexOf("/")+1);ca=n[ca].params;1===ca.transparency&&(ca.transparency=0);var Z=C&&C.alphaChannelUsage,Z=0<ca.transparency||"transparency"===Z||"maskAndTransparency"===Z,C={ambient:p.vec3f64.fromArray(ca.diffuse),
diffuse:p.vec3f64.fromArray(ca.diffuse),opacity:1-(ca.transparency||0),transparent:Z,textureAlphaMode:C?F(C.alphaChannelUsage):void 0,textureAlphaCutoff:.33,textureId:H,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:ca.externalColorMixMode||"tint",textureAlphaPremultiplied:!0};a.isSome(c)&&c.materialParamsMixin&&h.mixin(C,c.materialParamsMixin);ca=new v(C,u);l[d]||(l[d]={});l[d][e]=ca}g.push(ca);d=new r(new x.GeometryData(D,R),u);y+=R.position?R.position.length:0;f.push(d)}}return{name:u,
stageResources:{textures:k,materials:g,geometries:f},pivotOffset:m.model.pivotOffset,boundingBox:B(f),numberOfVertices:y,lodThreshold:null}};b.createTextureResources=C;var G=new q.Version(1,2,"wosr")})},"esri/views/3d/support/buffer/math":function(){define(["require","exports","./math/vec3","./math/vec4"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.vec3=m;b.vec4=k})},"esri/views/3d/support/buffer/math/vec4":function(){define(["require","exports","./common"],function(n,b,m){Object.defineProperty(b,
"__esModule",{value:!0});b.transformMat4=function(b,g,e){if(b.count!==g.count)m.logger.error("source and destination buffers need to have the same number of elements");else{var f=b.count,l=e[0],h=e[1],d=e[2],a=e[3],c=e[4],k=e[5],p=e[6],t=e[7],u=e[8],r=e[9],n=e[10],w=e[11],v=e[12],z=e[13],y=e[14];e=e[15];var A=b.typedBuffer;b=b.typedBufferStride;var B=g.typedBuffer;g=g.typedBufferStride;for(var C=0;C<f;C++){var F=C*b,E=C*g,G=B[E],H=B[E+1],D=B[E+2],E=B[E+3];A[F]=l*G+c*H+u*D+v*E;A[F+1]=h*G+k*H+r*D+z*
E;A[F+2]=d*G+p*H+n*D+y*E;A[F+3]=a*G+t*H+w*D+e*E}}};b.transformMat3=function(b,g,e){if(b.count!==g.count)m.logger.error("source and destination buffers need to have the same number of elements");else{var f=b.count,l=e[0],h=e[1],d=e[2],a=e[3],c=e[4],k=e[5],p=e[6],t=e[7];e=e[8];var u=b.typedBuffer;b=b.typedBufferStride;var r=g.typedBuffer;g=g.typedBufferStride;for(var n=0;n<f;n++){var w=n*b,v=n*g,z=r[v],y=r[v+1],A=r[v+2],v=r[v+3];u[w]=l*z+a*y+p*A;u[w+1]=h*z+c*y+t*A;u[w+2]=d*z+k*y+e*A;u[w+3]=v}}};b.scale=
function(b,g,e){var f=Math.min(b.count,g.count),l=b.typedBuffer;b=b.typedBufferStride;var h=g.typedBuffer;g=g.typedBufferStride;for(var d=0;d<f;d++){var a=d*b,c=d*g;l[a]=e*h[c];l[a+1]=e*h[c+1];l[a+2]=e*h[c+2];l[a+3]=e*h[c+3]}};b.shiftRight=function(b,g,e){var f=Math.min(b.count,g.count),l=b.typedBuffer;b=b.typedBufferStride;var h=g.typedBuffer;g=g.typedBufferStride;for(var d=0;d<f;d++){var a=d*b,c=d*g;l[a]=h[c]>>e;l[a+1]=h[c+1]>>e;l[a+2]=h[c+2]>>e;l[a+3]=h[c+3]>>e}}})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../../../geometry/support/aaBoundingBox ../../../support/debugFlags ../../../support/buffer/glUtil ../../core/shaderLibrary/output/OutputHighlight.glsl ../Camera ../DefaultVertexAttributeLocations ../intersectorUtils ../Util ./InstanceData ./InstanceOctree ./LevelSelector ./RenderInstanceData ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C){function F(a,b,c,d){y.encodeDoubleVec3(a.modelOrigin,b,c.modelOriginHi,c.modelOriginLo,d);c.model.copyFrom(d,a.model,b);c.modelNormal.copyFrom(d,a.modelNormal,b);a.color&&c.color&&c.color.copyFrom(d,a.color,b);a.featureAttribute&&c.featureAttribute&&c.featureAttribute.copyFrom(d,a.featureAttribute,b)}Object.defineProperty(b,"__esModule",{value:!0});var E=function(a){var b=a.baseBoundingSphere.radius;a=a.levels.map(function(a){return a.minScreenSpaceRadius});
return new x.LevelSelector(b,a)};b.setLevelSelectorFactory=function(a){E=a};var G=function(){function a(a,b){var c=a.rctx,e=b.geometry;b=b.material;var f=e.data.toRenderData();this.materialRep=a.materialRep;b.setParameterValues({instancedDoublePrecision:!0});a=b.createBufferWriter();var h=a.vertexBufferLayout,g=a.elementCount(f),l=a.allocate(g);a.write({},f,l,0);this.geometry=e;this.material=b;this.glMaterials=y.acquireMaterials(b,this.materialRep);this.vertexBufferLayout=h;this.vbo=A.createVertex(c,
35044,l.buffer);this.vao=new C(c,q.Default3D,{geometry:d.glLayout(h)},{geometry:this.vbo});this.vertexCount=g}a.prototype.destroy=function(){y.releaseMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};Object.defineProperty(a.prototype,"boundingInfo",{get:function(){return this.geometry.boundingInfo},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!0,configurable:!0});a.prototype.intersect=
function(a,b,c,d,e,f){var h=this.geometry.id,g=e.toString();this.material.intersect(this.geometry,null,a.transform.transform,a,c,d,function(c,d,l,k){if(0<=c&&(null==b||b(a.rayBeginPoint,a.rayEndPoint,c))){var m={type:"external",metadata:{layerUid:f.layerUid,graphicUid:f.graphicUid(e)}};if(null==a.results.min.drapedLayerOrder||k>=a.results.min.drapedLayerOrder)if(null==a.results.min.dist||c<a.results.min.dist)a.results.min.set(m,g,c,d,a.transform.transform,k,null,h,l),a.results.min.intersector="LodRenderer";
0!==a.options.store&&(null==a.results.max.drapedLayerOrder||k>=a.results.max.drapedLayerOrder)&&(null==a.results.max.dist||c>a.results.max.dist)&&(a.results.max.set(m,g,c,d,a.transform.transform,k,null,h,l),a.results.min.intersector="LodRenderer");if(2===a.options.store){var r=new p.IntersectorResult(a.results.min.ray);r.set(m,g,c,d,a.transform.transform,k,null,h,l);r.intersector="LodRenderer";a.results.all.push(r)}}})};return a}();b.LodComponentData=G;var H=function(){function a(a,b){var c=this;
this.components=[];this.minScreenSpaceRadius=b.minScreenSpaceRadius;b.components.forEach(function(b){c.components.push(new G(a,b))})}a.prototype.destroy=function(){this.components.forEach(function(a){a.destroy()})};a.prototype.intersect=function(a,b,c,d,e,f){this.components.forEach(function(h){h.intersect(a,b,c,d,e,f)})};Object.defineProperty(a.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var a=l.empty();this.components.forEach(function(b){l.expand(a,b.boundingInfo.bbMin);l.expand(a,
b.boundingInfo.bbMax)});this._boundingBox=a}return this._boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var a=this.boundingBox,b=e.vec3f64.create();l.center(a,b);this._boundingSphere={center:b,radius:.5*l.diameter(a)}}return this._boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",{get:function(){return this.components.reduce(function(a,b){return a+b.triangleCount},
0)},enumerable:!0,configurable:!0});return a}();b.LodLevelData=H;n=function(){function f(a,e,f,h){var g=this;this.type="Lod";this.isGround=!1;this._levels=[];this._renderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlane=!1;this._enableLevelSelection=!0;this._lastCamera=new c.default;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.canRender=!0;this._symbol=a;this._optionalFields=e;this._metadata=f;this._instanceBufferLayout=v.getInstanceBufferLayout({instancedDoublePrecision:!0,
instanced:e});this._glInstanceBufferLayout=d.glLayout(this._instanceBufferLayout,{divisor:1});this._instanceData=new u.InstanceData(this._optionalFields,h);this._instanceData.on("instance-added",function(){g.requestUpdateCycle()});this._instanceData.on("instance-removed",function(){g.requestUpdateCycle()});this._instanceData.on("instance-transform-changed",function(a){g.requestUpdateCycle();g._metadata.notifyGraphicUpdate(a.index,2)});this._instanceData.on("instance-visibility-changed",function(a){g.requestUpdateCycle(!0);
g._metadata.notifyGraphicUpdate(a.index,1)});this._instanceData.on("instance-highlight-changed",function(){g.requestUpdateCycle(!0)});this._enableLevelSelection=1<this._symbol.levels.length;b.lodRenderers.push(this)}f.prototype.destroy=function(){b.lodRenderers.splice(b.lodRenderers.indexOf(this),1)};Object.defineProperty(f.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"baseBoundingBox",{get:function(){return this._levels[this._levels.length-
1].boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"baseBoundingSphere",{get:function(){return this._levels[this._levels.length-1].boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"baseMaterial",{get:function(){return this._levels[this._levels.length-1].components[0].material},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"slicePlane",{get:function(){return this._slicePlane},set:function(a){this._slicePlane=a},enumerable:!0,
configurable:!0});Object.defineProperty(f.prototype,"intersectionHandlerId",{get:function(){return this._metadata.layerUid},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"instanceData",{get:function(){return this._instanceData},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"memoryUsage",{get:function(){var a={cpu:0,gpu:0};this._renderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});this._highlightRenderInstanceData.forEach(function(b){b=
b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});return a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"renderStats",{get:function(){var a=this,b=this._instanceData.size,c=[];this._levels.forEach(function(b,d){d=a._renderInstanceData[d].size+a._highlightRenderInstanceData[d].size;b=b.triangleCount;c.push({renderedInstances:d,renderedTriangles:d*b,trianglesPerInstance:b})});return{totalInstances:b,renderedInstances:c.reduce(function(a,b){return a+b.renderedInstances},0),renderedTriangles:c.reduce(function(a,
b){return a+b.renderedTriangles},0),levels:c}},enumerable:!0,configurable:!0});f.prototype.initializeRenderContext=function(a){var b=this;this._initContext=a;var c=a.rctx;this._symbol.levels.forEach(function(d){b._levels.push(new H(a,d));b._renderInstanceData.push(new w.RenderInstanceData(c,b._instanceBufferLayout));b._highlightRenderInstanceData.push(new w.RenderInstanceData(c,b._instanceBufferLayout))});this._levelSelector=E(this)};f.prototype.uninitializeRenderContext=function(){this.invalidateOctree();
this._levels.forEach(function(a){a.destroy()});this._renderInstanceData.forEach(function(a){a.destroy()});this._highlightRenderInstanceData.forEach(function(a){a.destroy()})};Object.defineProperty(f.prototype,"slots",{get:function(){return[4,6]},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"needsHighlight",{get:function(){return 0<this._highlightRenderInstanceData.reduce(function(a,b){return a+b.size},0)},enumerable:!0,configurable:!0});f.prototype.prepareRender=function(a){this.runUpdates(a)};
f.prototype.render=function(a){var b=this,c=a.rctx,d=4===a.slot?3:6===a.slot?5:null;if(d){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(a.pass))return!1;var e=a.camera,f={slot:d,view:e.viewMatrix,proj:e.projectionMatrix,origin:[0,0,0],viewInvTransp:e.viewInverseTransposeMatrix,viewport:e.fullViewport,fovY:e.fovY,nearFar:[e.near,e.far],shadowMap:a.shadowMap,shadowMappingEnabled:!!a.shadowMap&&a.shadowMap.enabled,ssaoEnabled:!!a.ssaoHelper&&a.ssaoHelper.enabled,pixelRatio:e.pixelRatio,
slicePlane:a.sliceHelper&&a.sliceHelper.plane,cameraAboveGround:e.aboveGround,hudVisibilityTexture:a.offscreenRenderingHelper?a.offscreenRenderingHelper.hudVisibilityTexture:null,highlightDepthTexture:a.offscreenRenderingHelper?a.offscreenRenderingHelper.depthTexture:null,hasOccludees:!1};c.bindVAO();for(var c=function(c){var e=a.isHighlightPass?h._highlightRenderInstanceData[c]:h._renderInstanceData[c];h._levels[c].components.forEach(function(h){b.renderComponent(a,d,f,e,h,c)})},h=this,e=0;e<this._levels.length;++e)c(e);
return!0}};f.prototype.intersect=function(a,b,c,d){var f=this;if(this.baseMaterial.isVisible()){var h=e.vec3f64.create();g.vec3.subtract(h,d,c);var l=function(e){f._instanceData.getCombinedModelTransform(e,L);a.transform.set(L);g.vec3.transformMat4(O,c,a.transform.inverse);g.vec3.transformMat4(K,d,a.transform.inverse);var h=f._instanceData.getState(e),l=f._instanceData.getLodLevel(e);t.assert(h&u.StateFlags.ACTIVE,"invalid instance state");t.assert(0<=l&&l<f._levels.length,"invaid lod level");f._levels[l].intersect(a,
b,O,K,e,f._metadata)};this.baseMaterial.getParameters().verticalOffset?this.octree.forEach(l):this.octree.forEachAlongRay(c,h,l)}};f.prototype.queryDepthRange=function(a){return this.queryDepthRangeOctree(a)};f.prototype.notifyShaderTransformationChanged=function(){this.invalidateOctree()};f.prototype.requestUpdateCycle=function(a){void 0===a&&(a=!1);this._updateCyclesWithStaticCamera=-1;a&&(this._needFullCycle=!0);this.needsUpdates&&this._initContext.requestRender()};Object.defineProperty(f.prototype,
"needsUpdates",{get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera},enumerable:!0,configurable:!0});f.prototype.runUpdates=function(a){if(!h.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var b=a.equals(this._lastCamera);this._lastCamera.copyFrom(a);b||this.requestUpdateCycle()}b=this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this.updateInstances(a,b);this.needsUpdates&&this._initContext.requestRender()}};Object.defineProperty(f.prototype,
"octree",{get:function(){this._octree||(this._octree=this.buildOctree());return this._octree},enumerable:!0,configurable:!0});f.prototype.invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};f.prototype.buildOctree=function(){for(var a=new r.InstanceOctree(this._instanceData,this.baseBoundingSphere),b=this._instanceData,b=b.view?b.view.state:null,c=0;c<this._instanceData.capacity;++c)b.get(c)&u.StateFlags.ACTIVE&&a.addInstance(c);return a};f.prototype.queryDepthRangeOctree=
function(a){var b=a.eye,c=a.viewForward,d=this.octree.findClosest(c,"front-to-back",a.frustum),e=this.octree.findClosest(c,"back-to-front",a.frustum);return null!=d&&null!=e?(this._instanceData.view.boundingSphere.getVec(d,I),g.vec3.subtract(I,I,b),d=g.vec3.dot(I,c)-I[3],this._instanceData.view.boundingSphere.getVec(e,I),g.vec3.subtract(I,I,b),b=g.vec3.dot(I,c)+I[3],{near:Math.max(a.near,d),far:Math.min(a.far,b)}):{near:Infinity,far:-Infinity}};f.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;
this._renderInstanceData.forEach(function(a){a.startUpdateCylce()});this._highlightRenderInstanceData.forEach(function(a){a.startUpdateCylce()});this.needsUpdates&&this._initContext.requestRender()};f.prototype.updateInstances=function(a,b){var c=this._enableLevelSelection,d=this._levelSelector;d.updateCamera(a);this._renderInstanceData.forEach(function(a){a.beginUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.beginUpdate()});a=this._instanceData;var e=this._instanceData.view,f=
a.capacity,h=this._instanceIndex;b=Math.min(a.size,b);for(var g=0;g<b;++g){0===h&&this.startUpdateCycle();var l=e.state.get(h),k=0;if(l&u.StateFlags.ALLOCATED){var m=e.lodLevel.get(h);l&u.StateFlags.ACTIVE&&this._renderInstanceData[m].freeTail();l&u.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[m].freeTail();if(l&u.StateFlags.REMOVE)a.freeInstance(h);else if(l&u.StateFlags.VISIBLE){m=0;c&&(e.modelOrigin.getVec(h,D),m=d.selectLevel(D,a.getCombinedMedianScaleFactor(h)));k=l&~(u.StateFlags.ACTIVE|
u.StateFlags.HIGHLIGHT_ACTIVE|u.StateFlags.TRANSFORM_CHANGED);if(0<=m){var p=this._renderInstanceData[m],r=p.allocateHead();F(e,h,p.view,r);k|=u.StateFlags.ACTIVE;l&u.StateFlags.HIGHLIGHT&&(p=this._highlightRenderInstanceData[m],r=p.allocateHead(),F(e,h,p.view,r),k|=u.StateFlags.HIGHLIGHT_ACTIVE)}e.state.set(h,k);e.lodLevel.set(h,m)}else k=l&~(u.StateFlags.ACTIVE|u.StateFlags.HIGHLIGHT_ACTIVE|u.StateFlags.TRANSFORM_CHANGED),e.state.set(h,k);this._octree&&(m=!!(l&u.StateFlags.ACTIVE),k=!!(k&u.StateFlags.ACTIVE),
!m&&k?this._octree.addInstance(h):m&&!k?this._octree.removeInstance(h):m&&k&&l&u.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(h),this._octree.addInstance(h)));h=(h+1)%f}else h=(h+1)%f,b++}this._instanceIndex=h;this._renderInstanceData.forEach(function(a){a.endUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.endUpdate()})};f.prototype.renderComponent=function(b,c,d,e,f,g){var l=f.glMaterials.get(b.pass);if(l&&l.beginSlot(c)&&0!==e.size){var k=b.rctx,m=k.capabilities.instancing;
l.ensureParameters(d);var p=l.getTechnique();c=l.getPipelineState(c);k.setPipelineState(c);l.bind(k,d);k.bindVAO(f.vao);p.ensureAttributeLocations(f.vao);l=p.program;b.isHighlightPass&&a.OutputHighlight.bindOutputHighlight(k,l,d);p.bindDraw(d);h.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===b.pass&&(l.setUniform4fv("externalColor",N[Math.min(g,N.length-1)]),l.setUniform1i("colorMixMode",z.colorMixModes.replace));b=e.capacity;d=e.headIndex;g=e.tailIndex;var l=e.firstIndex,r=this._glInstanceBufferLayout;
c=function(a,b){B.bindVertexBufferLayout(k,q.Default3D,e.buffer,r,a);m.drawArraysInstanced(p.primitiveType,0,f.vertexCount,b-a);B.unbindVertexBufferLayout(k,q.Default3D,e.buffer,r)};f.material.getParameters().transparent&&null!=l?d>g?(t.assert(l>=g&&l<=d,"invalid firstIndex"),c(l,d),c(g,l)):d<g&&(l<=d?(t.assert(0<=l&&l<=d,"invalid firstIndex"),c(l,d),c(g,b),c(0,l)):(t.assert(l>=g&&l<=b,"invalid firstIndex"),c(l,b),c(0,d),c(g,l))):d>g?c(g,d):d<g&&(c(0,d),c(g,b));k.bindVAO(null)}};return f}();b.LodRenderer=
n;b.lodRenderers=[];var D=e.vec3f64.create(),I=f.vec4f64.create(),L=k.mat4f64.create(),O=e.vec3f64.create(),K=e.vec3f64.create(),N=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]]})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/Evented ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils ../../../support/buffer/BufferView ../../../support/buffer/InterleavedLayout ../Util".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});var t;(function(a){a[a.ALLOCATED=1]="ALLOCATED";a[a.ACTIVE=2]="ACTIVE";a[a.VISIBLE=4]="VISIBLE";a[a.HIGHLIGHT=8]="HIGHLIGHT";a[a.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";a[a.REMOVE=32]="REMOVE";a[a.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"})(t=b.StateFlags||(b.StateFlags={}));var u=function(){return function(a){this.localTransform=a.getField("localTransform",c.BufferViewMat4f64);this.globalTransform=a.getField("globalTransform",
c.BufferViewMat4f64);this.modelOrigin=a.getField("modelOrigin",c.BufferViewVec3f64);this.model=a.getField("model",c.BufferViewMat3f);this.modelNormal=a.getField("modelNormal",c.BufferViewMat3f);this.modelScaleFactors=a.getField("modelScaleFactors",c.BufferViewVec2f);this.boundingSphere=a.getField("boundingSphere",c.BufferViewVec4f64);this.color=a.getField("color",c.BufferViewVec4f);this.featureAttribute=a.getField("featureAttribute",c.BufferViewVec4f);this.state=a.getField("state",c.BufferViewUint8);
this.lodLevel=a.getField("lodLevel",c.BufferViewUint8)}}();b.View=u;n=function(b){function c(a,c){var d=b.call(this)||this;d._capacity=0;d._size=0;d._next=0;var e=q.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");0<=a.indexOf("color")&&(e=e.vec4f("color"));0<=a.indexOf("featureAttribute")&&(e=e.vec4f("featureAttribute"));e=e.u8("state").u8("lodLevel").alignTo(8);d._layout=
e;d._shaderTransformation=c;return d}m(c,b);Object.defineProperty(c.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});c.prototype.addInstance=
function(){this._size+1>this._capacity&&this.grow();var a=this.findSlot();this._view.state.set(a,t.ALLOCATED);this._size++;this.emit("instance-added",{index:a});return a};c.prototype.removeInstance=function(a){var b=this._view.state;p.assert(0<=a&&a<this._capacity&&b.get(a)&t.ALLOCATED,"invalid instance handle");this.getStateFlag(a,t.ACTIVE)?this.setStateFlags(a,t.REMOVE):this.freeInstance(a);this.emit("instance-removed",{index:a})};c.prototype.freeInstance=function(a){var b=this._view.state;p.assert(0<=
a&&a<this._capacity&&b.get(a)&t.ALLOCATED,"invalid instance handle");b.set(a,0);this._size--};c.prototype.setLocalTransform=function(a,b,c){void 0===c&&(c=!0);this._view.localTransform.setMat(a,b);c&&this.updateModelTransform(a)};c.prototype.getLocalTransform=function(a,b){this._view.localTransform.getMat(a,b)};c.prototype.setGlobalTransform=function(a,b,c){void 0===c&&(c=!0);this._view.globalTransform.setMat(a,b);c&&this.updateModelTransform(a)};c.prototype.getGlobalTransform=function(a,b){this._view.globalTransform.getMat(a,
b)};c.prototype.updateModelTransform=function(b){var c=this._view,d=w,e=v;c.localTransform.getMat(b,z);c.globalTransform.getMat(b,y);var l=f.mat4.multiply(y,y,z);h.vec3.set(d,l[12],l[13],l[14]);c.modelOrigin.setVec(b,d);g.mat3.fromMat4(e,l);c.model.setMat(b,e);d=a.scaleFromMatrix(w,l);d.sort();c.modelScaleFactors.set(b,0,d[1]);c.modelScaleFactors.set(b,1,d[2]);g.mat3.invert(e,e);g.mat3.transpose(e,e);c.modelNormal.setMat(b,e);this.setStateFlags(b,t.TRANSFORM_CHANGED);this.emit("instance-transform-changed",
{index:b})};c.prototype.getModelTransform=function(a,b){var c=this._view;c.model.getMat(a,v);c.modelOrigin.getVec(a,w);b[0]=v[0];b[1]=v[1];b[2]=v[2];b[3]=0;b[4]=v[3];b[5]=v[4];b[6]=v[5];b[7]=0;b[8]=v[6];b[9]=v[7];b[10]=v[8];b[11]=0;b[12]=w[0];b[13]=w[1];b[14]=w[2];b[15]=1};c.prototype.applyShaderTransformation=function(a,b){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,b)};c.prototype.getCombinedModelTransform=function(a,b){this.getModelTransform(a,b);this._shaderTransformation&&
this._shaderTransformation.applyTransform(this,a,b);return b};c.prototype.getCombinedLocalTransform=function(a,b){this._view.localTransform.getMat(a,b);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,b);return b};c.prototype.getCombinedMaxScaleFactor=function(a){var b=this._view.modelScaleFactors.get(a,1);this._shaderTransformation&&(a=this._shaderTransformation.scaleFactor(w,this,a),b*=Math.max(a[0],a[1],a[2]));return b};c.prototype.getCombinedMedianScaleFactor=function(a){var b=
this._view.modelScaleFactors.get(a,0);this._shaderTransformation&&(a=this._shaderTransformation.scaleFactor(w,this,a),a.sort(),b*=a[1]);return b};c.prototype.getModel=function(a,b){this._view.model.getMat(a,b)};c.prototype.setFeatureAttribute=function(a,b){this._view.featureAttribute.setVec(a,b)};c.prototype.getFeatureAttribute=function(a,b){this._view.featureAttribute.getVec(a,b)};c.prototype.setColor=function(a,b){this._view.color.setVec(a,b)};c.prototype.getColor=function(a,b){this._view.color.getVec(a,
b)};c.prototype.setVisible=function(a,b){b!==this.getVisible(a)&&(this.setStateFlag(a,t.VISIBLE,b),this.emit("instance-visibility-changed",{index:a}))};c.prototype.getVisible=function(a){return this.getStateFlag(a,t.VISIBLE)};c.prototype.setHighlight=function(a,b){b!==this.getHighlight(a)&&(this.setStateFlag(a,t.HIGHLIGHT,b),this.emit("instance-highlight-changed",{index:a}))};c.prototype.getHighlight=function(a){return this.getStateFlag(a,t.HIGHLIGHT)};c.prototype.getState=function(a){return this._view.state.get(a)};
c.prototype.getLodLevel=function(a){return this._view.lodLevel.get(a)};c.prototype.countFlags=function(a){for(var b=0,c=0;c<this._capacity;++c)this.getState(c)&a&&++b;return b};c.prototype.setStateFlags=function(a,b){var c=this._view.state;b|=c.get(a);c.set(a,b)};c.prototype.clearStateFlags=function(a,b){var c=this._view.state;b=c.get(a)&~b;c.set(a,b)};c.prototype.setStateFlag=function(a,b,c){c?this.setStateFlags(a,b):this.clearStateFlags(a,b)};c.prototype.getStateFlag=function(a,b){return!!(this._view.state.get(a)&
b)};c.prototype.grow=function(){var a=Math.max(r,Math.floor(this._capacity*x)),b=this._layout.createBuffer(a);if(this._buffer){var c=new Uint8Array(this._buffer.buffer);(new Uint8Array(b.buffer)).set(c)}this._capacity=a;this._buffer=b;this._view=new u(this._buffer)};c.prototype.findSlot=function(){for(var a=this._view.state,b=this._next;a.get(b)&t.ALLOCATED;)b=(b+1)%this._capacity;this._next=(b+1)%this._capacity;return b};return c}(k);b.InstanceData=n;var r=1024,x=2,w=d.vec3f64.create(),v=e.mat3f64.create(),
z=l.mat4f64.create(),y=l.mat4f64.create()})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils ../Octree".split(" "),function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,c){var d=b.call(this,{getCenter:function(a){var b=
d._instanceData.view.boundingSphere,c=d._tmpCenter;c[0]=b.get(a,0);c[1]=b.get(a,1);c[2]=b.get(a,2);return c},getRadius:function(a){return d._instanceData.view.boundingSphere.get(a,3)}},{maximumDepth:25})||this;d._tmpCenter=e.vec3f64.create();d._tmpMat4=k.mat4f64.create();d._instanceData=a;d._boundingSphere=c;return d}m(d,b);d.prototype.addInstance=function(a){var b=this._instanceData.view.boundingSphere,d=this._instanceData.getCombinedModelTransform(a,this._tmpMat4),e=g.vec3.transformMat4(this._tmpCenter,
this._boundingSphere.center,d),d=this._boundingSphere.radius*f.maxScale(d);b.set(a,0,e[0]);b.set(a,1,e[1]);b.set(a,2,e[2]);b.set(a,3,d);this.add(a)};d.prototype.removeInstance=function(a){this.remove(a)};return d}(l);b.InstanceOctree=n})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["require","exports","../Camera"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e){this.thresholdScale=1;this._camera=new m.default;this._worldSpaceRadius=
b;this._thresholds=e.map(function(b){return b})}b.prototype.updateCamera=function(b){this._camera.copyFrom(b)};b.prototype.selectLevel=function(b,e){b=this._camera.computeScreenPixelSizeAt(b);e=this._worldSpaceRadius*e/b;b=this._thresholds;for(var f=-1,g=0;g<b.length;++g)e>=b[g]*this.thresholdScale&&(f=g);return f};return b}();b.LevelSelector=n})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["require","exports","../../../support/buffer/BufferView","../Util",
"./BackedBufferObject"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});var e=function(){return function(a){this.modelOriginHi=a.getField("modelOriginHi",m.BufferViewVec3f);this.modelOriginLo=a.getField("modelOriginLo",m.BufferViewVec3f);this.model=a.getField("model",m.BufferViewMat3f);this.modelNormal=a.getField("modelNormal",m.BufferViewMat3f);this.color=a.getField("instanceColor",m.BufferViewVec4f);this.featureAttribute=a.getField("instanceFeatureAttribute",m.BufferViewVec4f)}}();
b.View=e;n=function(){function b(a,b){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=a;this._instanceBufferLayout=b;this._elementSize=b.stride;this._capacity=1}b.prototype.destroy=function(){this._buffer&&this._buffer.destroy()};Object.defineProperty(b.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"view",{get:function(){return this._view},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){var a=this._headIndex,b=this._tailIndex;return a>=b?a-b:a+this._capacity-b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isEmpty",{get:function(){return this._headIndex===this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isFull",{get:function(){return this._tailIndex===
(this._headIndex+1)%this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"headIndex",{get:function(){return this._headIndex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"firstIndex",{get:function(){return this._firstIndex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"memoryUsage",{get:function(){return this._buffer?
this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!0,configurable:!0});b.prototype.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};b.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0};b.prototype.beginUpdate=function(){k.assert(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};b.prototype.endUpdate=function(){k.assert(this._updating,"not updating");this.size<h*this.capacity&&this.shrink();this._resized?(this._buffer.transferAll(),
this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};b.prototype.allocateHead=function(){k.assert(this._updating,"not updating");this.isFull&&this.grow();var a=this.headIndex;this._captureFirstIndex&&(this._firstIndex=a,this._captureFirstIndex=!1);this.incrementHead();k.assert(this._headIndex!==this._tailIndex,"invalid pointers");return a};b.prototype.freeTail=function(){k.assert(this._updating,"not updating");k.assert(0<this.size,"invalid size");var a=this._tailIndex===
this._firstIndex;this.incrementTail();a&&(this._firstIndex=this._tailIndex)};b.prototype.grow=function(){this.resize(Math.max(f,Math.floor(this._capacity*l)))};b.prototype.shrink=function(){a&&this.resize(Math.max(f,Math.floor(this._capacity*d)))};b.prototype.resize=function(a){k.assert(this._updating,"not updating");if(a!==this._capacity){var b=new g(this._rctx,34962,35044,this._elementSize,a);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%
this._capacity);var c=this.size,d=this.compactInstances(b);k.assert(d===c,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=d;this._prevHeadIndex=0}this._resized=!0;this._capacity=a;this._buffer=b;this._view=new e(this._instanceBufferLayout.createView(this._buffer.array))}};b.prototype.compactInstances=function(a){var b=this._headIndex,c=this._tailIndex;return c<b?(this._buffer.copyRange(c,b,a),b-c):c>b?(this._buffer.copyRange(c,this._capacity,a),0<b&&this._buffer.copyRange(0,
b,a,this._capacity-c),b+(this._capacity-c)):0};b.prototype.incrementHead=function(a){void 0===a&&(a=1);this._headIndex=(this._headIndex+a)%this._capacity};b.prototype.incrementTail=function(a){void 0===a&&(a=1);this._tailIndex=(this._tailIndex+a)%this._capacity};b.prototype.transferRange=function(a,b){a<b?this._buffer.transferRange(a,b):a>b&&(0<b&&this._buffer.transferRange(0,b),this._buffer.transferRange(a,this._capacity))};return b}();b.RenderInstanceData=n;var f=1024,l=2,h=.3,d=.5,a=!0})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["require",
"exports","../../../../webgl/BufferObject"],function(n,b,m){return function(){function b(b,e,f,l,h){this._elementSize=l;this._buffer=new m(b,e,f);this.resize(h)}b.prototype.destroy=function(){this._buffer.dispose()};Object.defineProperty(b.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"array",{get:function(){return this._array},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}},enumerable:!0,configurable:!0});b.prototype.copyRange=function(b,e,f,l){void 0===l&&(l=0);b=new Uint8Array(this.array,b*this.elementSize,(e-b)*this.elementSize);(new Uint8Array(f.array,l*this.elementSize)).set(b)};
b.prototype.transferAll=function(){this._buffer.setData(this._array)};b.prototype.transferRange=function(b,e){b*=this._elementSize;this._buffer.setSubData(this._array,b,b,e*this._elementSize)};b.prototype.resize=function(b){var e=b*this._elementSize,f=new ArrayBuffer(e);this._array&&(b>=this._capacity?(new Uint8Array(f)).set(new Uint8Array(this._array)):(new Uint8Array(f)).set((new Uint8Array(this._array)).subarray(0,b*this._elementSize)));this._array=f;this._buffer.setData(e);this._capacity=b};return b}()})},
"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/lang ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat2 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D){function I(b,c,d){switch(c){case "world":for(var e=0,f=b.vertices;e<f.length;e++)c=f[e],p.vec3.add(T,c.pos,b.offset),d.worldUpAtPosition(T,M),c.setFrameFromUpVector(M),c.computeRotationAxisAndAngleFromUpVector();break;case "path":for(p.vec3.add(T,b.vertices[0].pos,b.offset),d.worldUpAtPosition(T,M),G.computeMinimumRotationTangentFrame(b,M),d=0,b=b.vertices;d<b.length;d++){c=b[d];e=h.sign(p.vec3.dot(c.frame.right,c.vRight));p.vec3.cross(c.rotationFrame.up,
c.vRight,c.vLeft);p.vec3.scale(c.rotationFrame.up,c.rotationFrame.up,e);p.vec3.normalize(c.rotationFrame.up,c.rotationFrame.up);var f=p.vec3.dot(c.rotationFrame.up,c.frame.up),g=p.vec3.dot(c.rotationFrame.up,c.frame.right);p.vec3.scale(T,c.frame.up,-g);p.vec3.scale(P,c.frame.right,f);p.vec3.add(T,T,P);p.vec3.normalize(c.rotationFrame.right,T);G.vertexSpaceToProfileSpace(c.rotationRight,c.frame,c.rotationFrame.right);p.vec3.negate(T,c.vLeft);c.rotationAngle=-e*(Math.PI-h.acosClamped(p.vec3.dot(T,c.vRight)));
0<Math.abs(c.rotationAngle)&&(e=h.reciprocalClamped(Math.cos(.5*c.rotationAngle)),a.mat2.set(c.miterStretch,1+(e-1)*c.rotationRight[0]*c.rotationRight[0],(e-1)*c.rotationRight[0]*c.rotationRight[1],(e-1)*c.rotationRight[0]*c.rotationRight[1],1+(e-1)*c.rotationRight[1]*c.rotationRight[1]));c.maxStretchDistance=Math.abs(Math.min(c.vLeftLength,c.vRightLength)*h.reciprocalClamped(Math.cos(.5*(Math.PI-c.rotationAngle))))}}}function L(a,b,c){switch(a){case "symbol-value":return c;case "proportional":return b;
default:return a}}function O(a,b,c,d){a=a.stageObject;var e=a.geometryRecords,f=e.length,h=0;N.spatialReference=c.spatialReference;K.spatialReference=d.spatialReference;for(var g=0;g<f;g++){var l=e[g].geometry,k=l.metadata,m=k.pathGeometry,r=m.builder.path;Q.spatialReference=k.geometrySR;for(var q=r,u=b,t=c,n=d,v=0,x=0,y=q.vertices;x<y.length;x++){var z=y[x];N.x=z.posES[0];N.y=z.posES[1];N.z=z.posES[2];var A=w.evaluateElevationAlignmentAtPoint(N,t,u,n,S),v=v+S.sampledElevation;p.vec3.add(M,z.pos,
q.offset);n.setAltitude(A,M);p.vec3.subtract(z.pos,M,q.offset)}q.updatePathVertexInformation();h+=v/q.vertices.length;"world"!==r.upVector&&I(r,k.upVectorAlignment,d);m.onPathChanged();l.invalidateBoundingInfo();a.geometryVertexAttrsUpdated(g)}return h/f}Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function h(b,c,d,e){b=a.call(this,b,c,d,e)||this;b._intrinsicSize=q.vec2f64.fromValues(1,1);b.upVectorAlignment="path";b.stencilWidth=.1;b.ensureDrapedStatus(!1);return b}m(h,a);h.prototype.doLoad=
function(){return e(this,void 0,void 0,function(){var a,e,h,k,m,p,r,q,t,n,v,w,x,y;return g(this,function(g){a=d.isSome(this.symbolLayer.width)?this.symbolLayer.width:d.isSome(this.symbolLayer.height)?this.symbolLayer.height:this.symbolLayer.size;e=d.isSome(this.symbolLayer.height)?this.symbolLayer.height:a;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[a,1,e],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,
color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?B.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};h=this.symbolLayer.anchor||"center";this.upVectorAlignment="path";"heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");k=this.symbolLayer.profile||"circle";switch(k){default:this._profile=G.Profile.circle(b.NUM_CIRCLE_PROFILE_SUBDIVISIONS);
break;case "quad":this._profile=G.Profile.rect()}m=[0,0];"center"!==h&&(m={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[h],this._profile.translate(m[0],m[1]));p=this.symbolLayer.join||"simple";switch(p){case "round":this._extruder=new G.MiterExtruder(0,b.NUM_ROUND_JOIN_SUBDIVISIONS);break;case "bevel":this._extruder=new G.MiterExtruder(0,1);break;case "miter":this._extruder=new G.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new G.SimpleExtruder}r=this.symbolLayer.cap||"butt";switch(r){case "none":this._startCap=
new G.NoCapBuilder;this._endCap=new G.NoCapBuilder;break;default:this._startCap=new G.TriangulationCapBuilder(this._profile,0);this._endCap=new G.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new G.TriangulationCapBuilder(this._profile,-.5);this._endCap=new G.TriangulationCapBuilder(this._profile,.5,!0);break;case "round":q="quad"===k?!0:!1,this._startCap=new G.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:q,subdivisions:b.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS}),
this._endCap=new G.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:q,subdivisions:b.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS})}t=this._getIdHint();n=d.get(this.symbolLayer,"material","color");v=this._getCombinedOpacityAndColor(n);w=u.vec3f64.fromArray(v);x=v[3];y={diffuse:w,ambient:w,opacity:x,transparent:1>x||this.needsDrivenTransparentPass,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:"none"===r?0:void 0,offsetTransparentBackfaces:!0};
if(!this._drivenProperties.size&&(c.vec2.set(this._intrinsicSize,a,e),!A.isValidSize(this._intrinsicSize[0])||!A.isValidSize(this._intrinsicSize[1])))throw new f("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||c.vec2.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);this._fastUpdates.enabled?(l.mixin(y,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],
this._intrinsicSize[1],0]}),this._material=new D(y,t+"_pathmat")):(y.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new H(y,t+"_pathmat"));this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._context.stage.add(3,this._material);return[2]})})};h.prototype.destroy=function(){a.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null)};h.prototype.createGraphics3DGraphic=
function(a){var b=a.graphic;if(!this._validateGeometryType(b.geometry,h.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid,d=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,d,c,b.uid)};h.prototype.layerOpacityChanged=function(){var a=d.get(this.symbolLayer,"material","color"),a=this._getCombinedOpacity(a);this._material.setParameterValues({opacity:a,transparent:1>a||this.needsDrivenTransparentPass});return!0};
h.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,v.needsElevationUpdates3D)};h.prototype.slicePlaneEnabledChanged=function(){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};h.prototype.physicalBasedRenderingChanged=function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};h.prototype.pixelRatioChanged=function(){return!0};h.prototype.applyRendererDiff=
function(a,b){for(var c in a.diff)switch(c){case "visualVariables":if(B.updateFastSymbolUpdatesState(this._fastUpdates,b,this._vvConvertOptions))this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};h.prototype.getVertexData=function(a){for(var b=0,c=a.paths,d=[],e=a.spatialReference,f=this._context.elevationProvider.spatialReference,h=this._context.renderCoordsHelper.spatialReference,g=0;g<c.length;g++)var l=c[g],b=b+l.length;for(var g=
new Float64Array(3*b),k=new Float64Array(3*b),m=new Float64Array(3*b),p=0,r=0;r<c.length;r++){l=c[r];d.push({index:p,numVertices:l.length});for(var q=0;q<l.length;q++){var u=l[q];g[p++]=u[0];g[p++]=u[1];g[p++]=a.hasZ?u[2]:0}}a=!0;e.equals(f)?this._copyVertices(g,0,k,0,b):a=C.bufferToBuffer(g,e,0,k,f,0,b);f.equals(h)?this._copyVertices(k,0,m,0,b):C.bufferToBuffer(k,f,0,m,h,0,b);return{pathVertexDataInfos:d,vertexDataGS:g,vertexDataES:k,vertexDataRS:m,projectionSuccess:a,terrainElevation:0}};h.prototype._copyVertices=
function(a,b,c,d,e){b*=3;d*=3;for(var f=0;f<e;++f)c[d++]=a[b++],c[d++]=a[b++],c[d++]=a[b++]};h.prototype._createAs3DShape=function(a,b,c,e,f){var h=a.geometry,g=[],l=[],k=[],m=h.spatialReference,q=this._context.elevationProvider.spatialReference,u=r.create(),t=this._context.renderCoordsHelper;Q.spatialReference=m;N.spatialReference=q;h=this.getVertexData(h);if(!h.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),
null;if(0<h.pathVertexDataInfos.length){for(q=0;q<h.pathVertexDataInfos.length;++q){var n=h.pathVertexDataInfos[q],x=n.index,n=n.numVertices;if(2>n)this.logger.warn("PathSymbol3DLayer geometry failed to be created (paths should contain at least 2 vertices)");else{if(d.isSome(this._context.clippingExtent)&&(r.empty(u),r.expandWithBuffer(u,h.vertexDataES,3*x,n),!r.intersectsClippingArea(u,this._context.clippingExtent)))continue;for(var A=[],B=x;B<x+3*n;){var C=B++,K=B++,D=B++,S=new G.PathVertex;p.vec3.set(S.posGS,
h.vertexDataGS[C],h.vertexDataGS[K],h.vertexDataGS[D]);p.vec3.set(S.posES,h.vertexDataES[C],h.vertexDataES[K],h.vertexDataES[D]);N.x=S.posES[0];N.y=S.posES[1];N.z=S.posES[2];var H=w.evaluateElevationAlignmentAtPoint(N,this._context.elevationProvider,c,t,null);p.vec3.set(M,h.vertexDataRS[C],h.vertexDataRS[K],h.vertexDataRS[D]);t.setAltitude(H,M);p.vec3.set(S.pos,M[0],M[1],M[2]);A.push(S)}x=new G.Path(A);I(x,this.upVectorAlignment,this._context.renderCoordsHelper);x=new G.Builder(x,this._profile,this._extruder,
this._startCap,this._endCap);n=null;this._fastUpdates.enabled?(B=this._fastUpdates.visualVariables,n=B.size?y.getAttributeValue(B.size.field,a):0,A=B.color?y.getAttributeValue(B.color.field,a):0,B=B.opacity?y.getAttributeValue(B.opacity.field,a):0,n=new G.FastUpdatePathGeometry(x,n,A,B)):(n=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(n[0]*=L(b.size[0],"symbol-value"===b.size[2]?this.symbolLayer.height||0:b.size[2],this.symbolLayer.width||0),n[1]*=L(b.size[2],"symbol-value"===
b.size[0]?this.symbolLayer.width||0:b.size[0],this.symbolLayer.height||0)),A=null,this._drivenProperties.color&&(A=b.color),this._drivenProperties.opacity&&null!=b.opacity&&(A=A?[A[0],A[1],A[2],b.opacity]:[1,1,1,b.opacity]),x=new G.StaticPathGeometry(x),x.bake(n),A&&x.bakeVertexColors(A),n=x);x=n.createGeometryData();x=new F(x,e+"path"+q);x.metadata={pathGeometry:n,geometrySR:m,upVectorAlignment:this.upVectorAlignment,stencilWidth:this.stencilWidth};g.push(x);l.push(this._material);k.push(n.xform)}}a=
{layerUid:this._context.layer.uid,graphicUid:f};if(0<g.length)return e=new E({geometries:g,materials:l,transformations:k,castShadow:!0,metadata:a,idHint:e}),g=new z(this,e,g,null,null,O,c),g.alignedSampledElevation=h.terrainElevation,g.needsElevationUpdates=v.needsElevationUpdates3D(c.mode),g}else this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null};h.validGeometryTypes=["polyline"];return h}(y.Graphics3DSymbolLayer);b.Graphics3DPathSymbolLayer=
n;var K=x.makeDehydratedPoint(0,0,0,null),N=x.makeDehydratedPoint(0,0,0,null),Q=x.makeDehydratedPoint(0,0,0,null),M=u.vec3f64.create(),T=t.vec3f32.create(),P=t.vec3f32.create();b.NUM_ROUND_JOIN_SUBDIVISIONS=3;b.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;b.NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;var S={verticalDistanceToGround:0,sampledElevation:0};b.default=n})},"esri/core/libs/gl-matrix-2/mat2":function(){define(["require","exports","./math/mat2"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});
b.mat2=m})},"esri/core/libs/gl-matrix-2/math/mat2":function(){define(["require","exports","./common"],function(n,b,m){function k(b,f,g){var e=f[0],d=f[1],a=f[2];f=f[3];var c=g[0],l=g[1],k=g[2];g=g[3];b[0]=e*c+a*l;b[1]=d*c+f*l;b[2]=e*k+a*g;b[3]=d*k+f*g;return b}function g(b,f,g){b[0]=f[0]-g[0];b[1]=f[1]-g[1];b[2]=f[2]-g[2];b[3]=f[3]-g[3];return b}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,f){b[0]=f[0];b[1]=f[1];b[2]=f[2];b[3]=f[3];return b};b.identity=function(b){b[0]=1;b[1]=
0;b[2]=0;b[3]=1;return b};b.set=function(b,f,g,h,d){b[0]=f;b[1]=g;b[2]=h;b[3]=d;return b};b.transpose=function(b,f){if(b===f){var e=f[1];b[1]=f[2];b[2]=e}else b[0]=f[0],b[1]=f[2],b[2]=f[1],b[3]=f[3];return b};b.invert=function(b,f){var e=f[0],h=f[1],d=f[2];f=f[3];var a=e*f-d*h;if(!a)return null;a=1/a;b[0]=f*a;b[1]=-h*a;b[2]=-d*a;b[3]=e*a;return b};b.adjoint=function(b,f){var e=f[0];b[0]=f[3];b[1]=-f[1];b[2]=-f[2];b[3]=e;return b};b.determinant=function(b){return b[0]*b[3]-b[2]*b[1]};b.multiply=k;
b.rotate=function(b,f,g){var e=f[0],d=f[1],a=f[2];f=f[3];var c=Math.sin(g);g=Math.cos(g);b[0]=e*g+a*c;b[1]=d*g+f*c;b[2]=e*-c+a*g;b[3]=d*-c+f*g;return b};b.scale=function(b,f,g){var e=f[1],d=f[2],a=f[3],c=g[0];g=g[1];b[0]=f[0]*c;b[1]=e*c;b[2]=d*g;b[3]=a*g;return b};b.fromRotation=function(b,f){var e=Math.sin(f);f=Math.cos(f);b[0]=f;b[1]=e;b[2]=-e;b[3]=f;return b};b.fromScaling=function(b,f){b[0]=f[0];b[1]=0;b[2]=0;b[3]=f[1];return b};b.str=function(b){return"mat2("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+
")"};b.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2))};b.LDU=function(b,f,g,h){b[2]=h[2]/h[0];g[0]=h[0];g[1]=h[1];g[3]=h[3]-b[2]*g[1];return[b,f,g]};b.add=function(b,f,g){b[0]=f[0]+g[0];b[1]=f[1]+g[1];b[2]=f[2]+g[2];b[3]=f[3]+g[3];return b};b.subtract=g;b.exactEquals=function(b,f){return b[0]===f[0]&&b[1]===f[1]&&b[2]===f[2]&&b[3]===f[3]};b.equals=function(b,f){var e=b[0],h=b[1],d=b[2];b=b[3];var a=f[0],c=f[1],g=f[2];f=f[3];return Math.abs(e-
a)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(a))&&Math.abs(h-c)<=m.EPSILON*Math.max(1,Math.abs(h),Math.abs(c))&&Math.abs(d-g)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(b-f)<=m.EPSILON*Math.max(1,Math.abs(b),Math.abs(f))};b.multiplyScalar=function(b,f,g){b[0]=f[0]*g;b[1]=f[1]*g;b[2]=f[2]*g;b[3]=f[3]*g;return b};b.multiplyScalarAndAdd=function(b,f,g,h){b[0]=f[0]+g[0]*h;b[1]=f[1]+g[1]*h;b[2]=f[2]+g[2]*h;b[3]=f[3]+g[3]*h;return b};b.mul=k;b.sub=g})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat2 ../../../../core/libs/gl-matrix-2/mat2f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./GeometryData ./GeometryUtil ./Util ../materials/PathTechnique ../materials/internal/MaterialUtil".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w){var v;(function(b){function m(){return{up:q.vec3f64.create(),right:q.vec3f64.create()}}b.makeFrame=m;b.profileSpaceToVertexSpace=function(a,b,c){a[0]=c[0]*b.right[0]+c[1]*b.up[0];a[1]=c[0]*b.right[1]+c[1]*b.up[1];a[2]=c[0]*b.right[2]+c[1]*b.up[2]};b.vertexSpaceToProfileSpace=function(a,b,e){d.vec2.set(a,c.vec3.dot(e,b.right),c.vec3.dot(e,b.up))};var n=function(){function b(){this.pos=q.vec3f64.create();this.posES=q.vec3f64.create();this.posGS=q.vec3f64.create();
this.vRight=q.vec3f64.create();this.vLeft=q.vec3f64.create();this.frame=m();this.rotationFrame=m();this.rotationRight=a.vec2f64.create();this.rotationAngle=0;this.miterStretch=f.mat2f64.create()}b.prototype.setFrameFromUpVector=function(a){c.vec3.copy(this.frame.up,a);c.vec3.add(F,this.vLeft,this.vRight);c.vec3.normalize(F,F);c.vec3.scale(C,this.frame.up,c.vec3.dot(F,this.frame.up));c.vec3.subtract(H,F,C);c.vec3.normalize(H,H);c.vec3.cross(this.frame.right,H,this.frame.up)};b.prototype.computeRotationAxisAndAngleFromUpVector=
function(){c.vec3.copy(this.rotationFrame.up,this.frame.up);c.vec3.copy(this.rotationFrame.right,this.frame.right);d.vec2.set(this.rotationRight,1,0);c.vec3.scale(C,this.frame.up,c.vec3.dot(this.frame.up,this.vLeft));c.vec3.subtract(C,this.vLeft,C);c.vec3.negate(C,C);c.vec3.normalize(C,C);c.vec3.scale(F,this.frame.up,c.vec3.dot(this.frame.up,this.vRight));c.vec3.subtract(F,this.vRight,F);c.vec3.normalize(F,F);c.vec3.cross(E,this.rotationFrame.up,this.vLeft);this.rotationAngle=g.sign(c.vec3.dot(E,
this.vRight))*(Math.PI-g.acosClamped(c.vec3.dot(C,F)));if(0<Math.abs(this.rotationAngle)){var a=g.reciprocalClamped(Math.cos(.5*this.rotationAngle));e.mat2.set(this.miterStretch,1+(a-1),0,0,1)}this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return b}();b.PathVertex=n;n=function(){function b(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=[];this.uvIndices=this.uvs=null}b.prototype.addVertex=
function(b,c){this.vertices.push(a.vec2f64.clone(b));this.vertexNormals.push(a.vec2f64.clone(c));return this.vertices.length-1};b.prototype.addUV=function(a){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(a);return this.uvs.length-1};b.prototype.addPole=function(b,c){void 0===c&&(c=null);this.poles.push({position:a.vec2f64.clone(b),normal:c?a.vec2f64.clone(c):null});return this.poles.length-1};b.prototype.addSegment=function(a,b,c){void 0===b&&(b=null);void 0===c&&(c=null);this.vertexIndices.push(a.v0);
this.vertexIndices.push(a.v1);b&&(this.uvIndices.push(b.v0),this.uvIndices.push(b.v1));c&&(this.poleIndices.push(c.v0),this.poleIndices.push(c.v1))};Object.defineProperty(b.prototype,"numSegments",{get:function(){return this.vertexIndices.length/2},enumerable:!0,configurable:!0});b.prototype.hasUV=function(){return null!=this.uvs};b.prototype.translate=function(a,b){for(var c=0,d=this.vertices;c<d.length;c++){var e=d[c];e[0]+=a;e[1]+=b}c=0;for(d=this.poles;c<d.length;c++)e=d[c],e.position[0]+=a,e.position[1]+=
b};b.circle=function(c){void 0===c&&(c=20);var d=new b,e={v0:0,v1:0};d.addPole(a.vec2f64.fromValues(0,0));for(var f=0;f<c;++f){var h=2*f*Math.PI/c,g=Math.cos(h),l=Math.sin(h),h=a.vec2f64.fromValues(.5*g,.5*l),g=a.vec2f64.fromValues(g,l);d.addVertex(h,g);d.addUV(f/c)}d.addUV(1);for(f=0;f<c-1;++f)g={v0:f,v1:f+1},d.addSegment(g,g,e);d.addSegment({v0:c-1,v1:0},{v0:c-1,v1:c},e);return d};b.rect=function(){var c=new b,d=a.vec2f64.fromValues(-.5,-.5),e=a.vec2f64.fromValues(.5,-.5),f=a.vec2f64.fromValues(.5,
.5),h=a.vec2f64.fromValues(-.5,.5),g=a.vec2f64.fromValues(0,-1),l=a.vec2f64.fromValues(1,0),k=a.vec2f64.fromValues(0,1),m=a.vec2f64.fromValues(-1,0);c.addUV(0);c.addUV(1);c.addPole(a.vec2f64.fromValues(0,.5),k);c.addPole(a.vec2f64.fromValues(0,.5));c.addPole(a.vec2f64.fromValues(0,-.5));c.addPole(a.vec2f64.fromValues(0,-.5),g);var p={v0:0,v1:1};c.addVertex(d,g);c.addVertex(e,g);c.addSegment({v0:0,v1:1},p,{v0:3,v1:3});c.addVertex(e,l);c.addVertex(f,l);c.addSegment({v0:2,v1:3},p,{v0:2,v1:1});c.addVertex(f,
k);c.addVertex(h,k);c.addSegment({v0:4,v1:5},p,{v0:0,v1:0});c.addVertex(h,m);c.addVertex(d,m);c.addSegment({v0:6,v1:7},p,{v0:1,v1:2});return c};return b}();b.Profile=n;n=function(){function a(a){this.vertices=[];this.offset=q.vec3f64.create();this.xform=h.mat4f64.create();this.vertices=a;c.vec3.copy(this.offset,this.vertices[Math.floor((a.length-1)/2)].pos);a=0;for(var b=this.vertices;a<b.length;a++){var d=b[a];c.vec3.subtract(d.pos,d.pos,this.offset)}l.mat4.translate(this.xform,this.xform,this.offset);
this.updatePathVertexInformation()}a.prototype.updatePathVertexInformation=function(){var a=this.vertices.length,b=this.vertices[0];b.index=0;c.vec3.set(b.vLeft,0,0,0);b.vLeftLength=0;c.vec3.subtract(b.vRight,this.vertices[1].pos,b.pos);b.vRightLength=c.vec3.length(b.vRight);c.vec3.normalize(b.vRight,b.vRight);for(var d=b,e=1;e<a;++e)b=this.vertices[e],b.index=e,c.vec3.copy(b.vLeft,d.vRight),b.vLeftLength=d.vRightLength,e<a-1?(c.vec3.subtract(b.vRight,this.vertices[e+1].pos,b.pos),b.vRightLength=
c.vec3.length(b.vRight),c.vec3.normalize(b.vRight,b.vRight)):(c.vec3.copy(b.vRight,b.vLeft),b.vRightLength=b.vLeftLength),d=b};return a}();b.Path=n;b.computeMinimumRotationTangentFrame=function(a,b){var d=null,e=a.vertices.length,f=q.vec3f64.create(),h=q.vec3f64.create(),g=q.vec3f64.create(),l=q.vec3f64.create(),k=q.vec3f64.create(),m=q.vec3f64.create(),r=p.plane.create(),n=a.vertices[0];c.vec3.copy(h,b);c.vec3.set(f,0,1,0);u.makeOrthoBasisDirUpFallback(n.vRight,h,f,f,g,h,.99619469809);c.vec3.copy(n.frame.up,
h);c.vec3.copy(n.frame.right,g);d=n;for(b=1;b<e;++b){n=a.vertices[b];c.vec3.add(k,n.vLeft,n.vRight);var t=c.vec3.length(k);0<t?(t=1/Math.sqrt(t),k[0]*=t,k[1]*=t,k[2]*=t):(k[0]=n.vRight[0],k[1]=n.vRight[1],k[2]=n.vRight[2]);c.vec3.add(m,d.pos,d.frame.up);p.plane.fromPositionAndNormal(n.pos,k,r);p.plane.intersectRay(r,p.ray.wrap(m,n.vLeft),l)?(c.vec3.subtract(l,l,n.pos),c.vec3.normalize(h,l),c.vec3.cross(g,k,h),c.vec3.normalize(g,g)):u.makeOrthoBasisDirUpFallback(k,d.frame.up,d.frame.right,f,g,h,.99619469809);
c.vec3.copy(n.frame.up,h);c.vec3.copy(n.frame.right,g);d=n}};n=function(){return function(){}}();b.Extruder=n;n=function(){function a(){}a.prototype.numProfilesPerJoin=function(){return 1};a.prototype.extrude=function(a,b,c){for(var d=0;d<b.vertices.length;++d)c(a.index,a.frame,b.vertices[d],b.vertexNormals[d],!1)};return a}();b.SimpleExtruder=n;n=function(){function a(a,b){void 0===a&&(a=.8*Math.PI);void 0===b&&(b=1);this.cutoffAngle=a;this.numBendSubdivisions=b}a.prototype.numProfilesPerJoin=function(){return this.numBendSubdivisions+
1};a.prototype.extrude=function(a,b,e){var f=D;if(Math.abs(a.rotationAngle)>=this.cutoffAngle)for(var h=0;h<this.numBendSubdivisions+1;++h){l.mat4.identity(I);l.mat4.rotate(I,I,.5*-a.rotationAngle+h*a.rotationAngle/this.numBendSubdivisions,a.rotationFrame.up);var g=f,k=a.frame,m=I;c.vec3.transformMat4(g.up,k.up,m);c.vec3.transformMat4(g.right,k.right,m);for(g=0;g<b.vertices.length;++g)k=d.vec2.dot(b.vertices[g],a.rotationRight),(k=0<=k*a.rotationAngle)?e(a.index,f,b.vertices[g],b.vertexNormals[g],
!1):(d.vec2.transformMat2(y,b.vertices[g],a.miterStretch),e(a.index,a.frame,y,b.vertexNormals[g],!0))}else for(h=0;h<this.numBendSubdivisions+1;++h)for(g=0;g<b.vertices.length;++g)k=d.vec2.dot(b.vertices[g],a.rotationRight),k=0<=k*a.rotationAngle,d.vec2.transformMat2(y,b.vertices[g],a.miterStretch),e(a.index,a.frame,y,b.vertexNormals[g],k?!1:!0)};return a}();b.MiterExtruder=n;var v={generateUV:!1},n=function(){function a(){}a.prototype.rebuildConnectingProfileGeometry=function(a,b,c){for(var d=0;d<
b.vertices.length;++d)c(a.index,a.frame,b.vertices[d],b.vertexNormals[d],0,0)};return a}();b.CapBuilder=n;var Q=function(a){function b(){return a.call(this)||this}k(b,a);b.prototype.getNumVertices=function(){return 0};b.prototype.getNumIndices=function(){return 0};b.prototype.rebuildCapGeometry=function(){};b.prototype.buildTopology=function(){};return b}(n);b.NoCapBuilder=Q;Q=function(a){function b(b,c,d){void 0===c&&(c=0);void 0===d&&(d=!1);var e=a.call(this)||this;e.profile=b;e.profilePlaneOffset=
c;e.flip=d;return e}k(b,a);b.prototype.getNumVertices=function(){return this.profile.vertices.length};b.prototype.getNumIndices=function(){return 3*this.profile.numSegments};b.prototype.rebuildConnectingProfileGeometry=function(a,b,c){for(var d=0;d<b.vertices.length;++d)c(a.index,a.frame,b.vertices[d],b.vertexNormals[d],this.profilePlaneOffset,0)};b.prototype.rebuildCapGeometry=function(a,b){var c=A;d.vec2.set(c,0,0);for(var e=this.flip?1:-1,f=0;f<this.profile.vertices.length;++f)b(a.index,a.frame,
this.profile.vertices[f],c,this.profilePlaneOffset,e)};b.prototype.buildTopology=function(a,b){a=this.vertexBufferStart+this.profile.vertexIndices[0];for(var c=1;c<this.profile.numSegments;++c){var d=this.vertexBufferStart+this.profile.vertexIndices[2*c+0],e=this.vertexBufferStart+this.profile.vertexIndices[2*c+1];this.flip?b(e,d,a):b(a,d,e)}};return b}(n);b.TriangulationCapBuilder=Q;n=function(a){function b(b){var c=a.call(this)||this;c.flip=!1;c.sign=0;c.breakNormals=!1;c.numSegments=3;c.profile=
b.profile;c.flip=b.flip;c.sign=c.flip?1:-1;c.breakNormals=b.breakNormals;c.numSegments=b.subdivisions;return c}k(b,a);b.prototype.getNumVertices=function(){var a=0,a=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(a+=this.profile.vertices.length);return a+=this.profile.poles.length};b.prototype.getNumIndices=function(){var a;a=0+2*this.profile.numSegments*(this.numSegments-1);for(var b=0;b<this.profile.numSegments;++b)a=this.profile.poleIndices[this.profile.vertexIndices[2*b+
0]]===this.profile.poleIndices[this.profile.vertexIndices[2*b+1]]?a+1:a+2;return 3*a};b.prototype.rebuildCapGeometry=function(a,b){var c=a.frame,e=.5*this.sign,f=y,h=A;d.vec2.set(h,0,0);for(var g=0;g<this.profile.poles.length;++g){var l=this.profile.poles[g];l.normal?b(a.index,c,l.position,l.normal,e,0):b(a.index,c,l.position,h,e,this.sign)}if(this.breakNormals)for(g=0;g<this.profile.vertices.length;++g)b(a.index,c,this.profile.vertices[g],this.profile.vertexNormals[g],0,0);for(g=0;g<this.numSegments-
1;++g)for(var l=(1-(g+1)/this.numSegments)*Math.PI*.5,k=Math.sin(l),m=Math.cos(l),p=0;p<this.profile.vertices.length;++p)l=this.profile.poles[this.profile.poleIndices[p]],d.vec2.subtract(f,this.profile.vertices[p],l.position),d.vec2.scale(f,f,k),l.normal?(d.vec2.add(f,f,l.position),b(a.index,c,f,l.normal,e*m,0)):(d.vec2.normalize(h,f),d.vec2.scale(h,h,k),d.vec2.add(f,f,l.position),b(a.index,c,f,h,e*m,this.sign*m))};b.prototype.buildTopology=function(a,b){a=this.breakNormals?this.vertexBufferStart+
this.profile.poles.length:this.firstProfileVertexIndex;for(var c=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length,d=0;d<this.profile.numSegments;++d){for(var e=this.profile.vertexIndices[2*d+0],f=this.profile.vertexIndices[2*d+1],h=this.vertexBufferStart+this.profile.poleIndices[e],g=this.vertexBufferStart+this.profile.poleIndices[f],l=a+e,k=a+f,m=0;m<this.numSegments-1;++m){var p=c+m*this.profile.vertices.length+
e,r=c+m*this.profile.vertices.length+f;this.flip?(b(p,k,l),b(k,p,r)):(b(l,k,p),b(r,p,k));l=p;k=r}this.flip?(b(h,k,l),h!==g&&b(h,g,k)):(b(l,k,h),h!==g&&b(k,g,h))}};return b}(n);b.RoundCapBuilder=n;n=function(){function a(a,b,c,d,e,f){void 0===f&&(f=v);this.options=f;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=this._triangleCount=this._extrusionVertexCount=0;this.profile=b;this.path=a;this.extruder=c;this.startCap=d;this.endCap=e;a=this.path.vertices.length-
2;this.numExtrusionProfiles=c.numProfilesPerJoin()*a+2;this.numNormalsTotal=this.numVerticesTotal=b.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;b=this.startCap.getNumVertices();this.numVerticesTotal+=b;this.numNormalsTotal+=b;this.endCap.vertexBufferStart=this.numVerticesTotal;b=this.endCap.getNumVertices();this.numVerticesTotal+=b;this.numNormalsTotal+=b;this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*
this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.originData=new Float32Array(3*this.path.vertices.length);this.rebuildGeometry();this.buildTopology()}a.prototype.emitVertex=function(a,b,c,d,e){this.profileRightAxisData[4*this._extrusionVertexCount+
0]=b.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=b.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=b.right[2];this.profileUpAxisData[4*this._extrusionVertexCount+0]=b.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=b.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=b.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=c[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=c[1];this.profileVertexAndNormalData[4*
this._extrusionVertexCount+2]=d[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=d[1];this.pathVertexData[this._extrusionVertexCount]=a;e?(a=this.path.vertices[a],this.profileRightAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[0]*a.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[1]*a.maxStretchDistance):(this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};
a.prototype.emitCapVertex=function(a,b,c,d,e,f){this.profileRightAxisData[4*this._extrusionVertexCount+0]=b.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=b.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=b.right[2];this.profileUpAxisData[4*this._extrusionVertexCount+0]=b.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=b.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=b.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount+
0]=c[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=c[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=d[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=d[1];this.pathVertexData[this._extrusionVertexCount]=a;this.profileRightAxisData[4*this._extrusionVertexCount+3]=e;this.profileUpAxisData[4*this._extrusionVertexCount+3]=f;++this._extrusionVertexCount};a.prototype.emitTriangle=function(a,b,c){this.vertexIndices[3*this._triangleCount+0]=a;this.vertexIndices[3*
this._triangleCount+1]=b;this.vertexIndices[3*this._triangleCount+2]=c;this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[a];this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[b];this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[c];this.normalIndices[3*this._triangleCount+0]=a;this.normalIndices[3*this._triangleCount+1]=b;this.normalIndices[3*this._triangleCount+2]=c;++this._triangleCount};a.prototype.rebuildGeometry=function(){for(var a=this,b=
function(b,c,d,e,f){return a.emitVertex(b,c,d,e,f)},c=function(b,c,d,e,f,h){return a.emitCapVertex(b,c,d,e,f,h)},d=this._extrusionVertexCount=0,e=this.path.vertices;d<e.length;d++){var f=e[d];this.originData[3*f.index+0]=f.pos[0];this.originData[3*f.index+1]=f.pos[1];this.originData[3*f.index+2]=f.pos[2]}this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,c);for(d=1;d<this.path.vertices.length-1;++d)this.extruder.extrude(this.path.vertices[d],this.profile,b);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-
1],this.profile,c);this.startCap.rebuildCapGeometry(this.path.vertices[0],c);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],c);if(this.profile.hasUV()&&this.options.generateUV)for(d=0;d<this.profile.uvs.length;++d)this.uvData[2*d+0]=this.profile.uvs[d],this.uvData[2*d+1]=0};a.prototype.buildTopology=function(){var a=this,b=function(b,c,d){return a.emitTriangle(b,c,d)};this._triangleCount=0;var c=this.profile.vertices.length,d=this.profile.numSegments,e=this.numExtrusionProfiles-
1,f=d*e*6;this.startCap.indexBufferStart=f;this.startCap.firstProfileVertexIndex=0;f+=this.startCap.getNumIndices();this.endCap.indexBufferStart=f;this.endCap.firstProfileVertexIndex=c*(this.numExtrusionProfiles-1);f+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(f);this.normalIndices=new Uint32Array(f);this.pathVertexIndices=new Uint32Array(f);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(f));for(f=0;f<d;++f)for(var h=this.profile.vertexIndices[2*
f],g=this.profile.vertexIndices[2*f+1],l=0;l<e;++l){var k=l*c+h,m=(l+1)*c+g,p=l*c+g;b(k,(l+1)*c+h,m);b(k,m,p)}this.startCap.buildTopology(this.path.vertices[0],b);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],b)};a.prototype.onPathChanged=function(){this.rebuildGeometry()};return a}();b.Builder=n;n=function(){function a(a){this.builder=a}Object.defineProperty(a.prototype,"xform",{get:function(){return this.builder.path.xform},enumerable:!0,configurable:!0});a.prototype.onPathChanged=
function(){this.builder.onPathChanged()};return a}();b.PathGeometry=n;var M=function(a){function b(b){b=a.call(this,b)||this;b.vertexAttributePosition=null;b.vertexAttributeNormal=null;b.vertexAttributeColor=null;b.vertexAttributePosition=new Float32Array(3*b.builder.numVerticesTotal);b.vertexAttributeNormal=new Float32Array(3*b.builder.numNormalsTotal);b.vertexAttributeColor=new Uint8Array(4);b.vertexAttributeColor[0]=255;b.vertexAttributeColor[1]=255;b.vertexAttributeColor[2]=255;b.vertexAttributeColor[3]=
255;return b}k(b,a);b.prototype.bakeVertexColors=function(a){this.vertexAttributeColor[0]=255*a[0];this.vertexAttributeColor[1]=255*a[1];this.vertexAttributeColor[2]=255*a[2];this.vertexAttributeColor[3]=255*(3<a.length?a[3]:1)};b.prototype.bake=function(a){this.size=a;for(var b=0;b<this.builder.numVerticesTotal;++b){var e=this.builder.pathVertexData[b],f=0===e||e===this.builder.path.vertices.length-1,h=z;c.vec3.set(h,this.builder.originData[3*e+0],this.builder.originData[3*e+1],this.builder.originData[3*
e+2]);var l=C,k=y,e=F,m=E,p=G,r=0,q=0;c.vec3.set(m,this.builder.profileRightAxisData[4*b+0],this.builder.profileRightAxisData[4*b+1],this.builder.profileRightAxisData[4*b+2]);c.vec3.set(p,this.builder.profileUpAxisData[4*b+0],this.builder.profileUpAxisData[4*b+1],this.builder.profileUpAxisData[4*b+2]);d.vec2.set(k,this.builder.profileVertexAndNormalData[4*b+0]*a[0],this.builder.profileVertexAndNormalData[4*b+1]*a[1]);if(f)c.vec3.cross(e,p,m),r=this.builder.profileRightAxisData[4*b+3]*a[0],q=this.builder.profileUpAxisData[4*
b+3];else{var f=A,u=B;d.vec2.set(f,this.builder.profileRightAxisData[4*b+3],this.builder.profileUpAxisData[4*b+3]);var n=d.vec2.length(f);d.vec2.normalize(f,f);var t=d.vec2.dot(k,f);if(Math.abs(t)>n){d.vec2.set(u,-f[1],f[0]);var v=d.vec2.dot(k,u);d.vec2.scale(f,f,n*g.sign(t));d.vec2.scale(u,u,v);d.vec2.add(k,f,u)}c.vec3.set(e,0,0,0)}c.vec3.set(l,m[0]*k[0]+p[0]*k[1],m[1]*k[0]+p[1]*k[1],m[2]*k[0]+p[2]*k[1]);this.vertexAttributePosition[3*b+0]=h[0]+l[0]+e[0]*r;this.vertexAttributePosition[3*b+1]=h[1]+
l[1]+e[1]*r;this.vertexAttributePosition[3*b+2]=h[2]+l[2]+e[2]*r;h=y;d.vec2.set(h,this.builder.profileVertexAndNormalData[4*b+2],this.builder.profileVertexAndNormalData[4*b+3]);this.vertexAttributeNormal[3*b+0]=m[0]*h[0]+p[0]*h[1]+e[0]*q;this.vertexAttributeNormal[3*b+1]=m[1]*h[0]+p[1]*h[1]+e[1]*q;this.vertexAttributeNormal[3*b+2]=m[2]*h[0]+p[2]*h[1]+e[2]*q}};b.prototype.createGeometryData=function(){var a={};a[r.VertexAttrConstants.POSITION]=this.builder.vertexIndices;a[r.VertexAttrConstants.NORMAL]=
this.builder.normalIndices;this.vertexAttributeColor&&(a[r.VertexAttrConstants.COLOR]=new Uint32Array(a[r.VertexAttrConstants.POSITION].length));var b={};b[r.VertexAttrConstants.POSITION]={size:3,data:this.vertexAttributePosition};b[r.VertexAttrConstants.NORMAL]={size:3,data:this.vertexAttributeNormal};this.vertexAttributeColor&&(b[r.VertexAttrConstants.COLOR]={size:4,data:this.vertexAttributeColor});return new t.GeometryData(b,a,t.GeometryData.DefaultOffsets,"triangle")};b.prototype.onPathChanged=
function(){a.prototype.onPathChanged.call(this);this.bake(this.size)};b.prototype.intersect=function(a,b,c){var d=this.builder.vertexIndices;w.intersectTriangles(a,b,0,d.length/3,d,{size:3,offsetIdx:0,strideIdx:3,data:this.vertexAttributePosition},void 0,void 0,c)};return b}(n);b.StaticPathGeometry=M;n=function(a){function b(b,c,d,e){var f=a.call(this,b)||this;f.sizeAttributeValue=c;f.colorAttributeValue=d;f.opacityAttributeValue=e;f.vvData=null;f.baked=new M(b);f.vvData=new Float32Array(4*f.builder.path.vertices.length);
for(b=0;b<f.builder.path.vertices.length;++b)f.vvData[4*b+0]=c,f.vvData[4*b+1]=d,f.vvData[4*b+2]=e,f.vvData[4*b+3]=0===b||b===f.builder.path.vertices.length-1?1:0;return f}k(b,a);b.prototype.createGeometryData=function(){var a={};a[x.PathVertexAttrConstants.POSITION]=this.builder.pathVertexIndices;a[x.PathVertexAttrConstants.PROFILERIGHT]=this.builder.vertexIndices;a[x.PathVertexAttrConstants.PROFILEUP]=this.builder.vertexIndices;a[x.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL]=this.builder.vertexIndices;
a[x.PathVertexAttrConstants.FEATUREVALUE]=this.builder.pathVertexIndices;var b={};b[x.PathVertexAttrConstants.POSITION]={size:3,data:this.builder.originData};b[x.PathVertexAttrConstants.PROFILERIGHT]={size:4,data:this.builder.profileRightAxisData};b[x.PathVertexAttrConstants.PROFILEUP]={size:4,data:this.builder.profileUpAxisData};b[x.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL]={size:4,data:this.builder.profileVertexAndNormalData};b[x.PathVertexAttrConstants.FEATUREVALUE]={size:4,data:this.vvData};
return new t.GeometryData(b,a,t.GeometryData.DefaultOffsets,"triangle")};return b}(n);b.FastUpdatePathGeometry=n})(v||(v={}));var z=q.vec3f64.create(),y=a.vec2f64.create(),A=a.vec2f64.create(),B=a.vec2f64.create(),C=q.vec3f64.create(),F=q.vec3f64.create(),E=q.vec3f64.create(),G=q.vec3f64.create(),H=q.vec3f64.create(),D=v.makeFrame(),I=h.mat4f64.create();return v})},"esri/core/libs/gl-matrix-2/mat2f64":function(){define(["require","exports","./factories/mat2f64"],function(n,b,m){Object.defineProperty(b,
"__esModule",{value:!0});b.mat2f64=m})},"esri/core/libs/gl-matrix-2/factories/mat2f64":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[1,0,0,1]};b.clone=function(b){return[b[0],b[1],b[2],b[3]]};b.fromValues=function(b,k,g,e){return[b,k,g,e]};b.createView=function(b,k){return new Float64Array(b,k,4)}})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/output/ReadLinearDepth.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/StencilUtils ../shaders/Path.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w){Object.defineProperty(b,"__esModule",{value:!0});b.PathVertexAttrConstants={POSITION:"position",PROFILERIGHT:"profileRight",PROFILEUP:"profileUp",PROFILEVERTEXANDNORMAL:"profileVertexAndNormal",FEATUREVALUE:"featureValue"};b.pathVertexAttributeLocations={position:0,profileRight:1,profileUp:2,profileVertexAndNormal:3,featureValue:4};g=function(g){function k(){return null!==g&&g.apply(this,arguments)||this}m(k,g);k.prototype.initializeProgram=function(a){var c=
k.shader.get(),d=this.configuration,c=c.build({output:d.output,viewingMode:a.viewingMode,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:d.receiveShadows,vvSize:d.vvSize,vvColor:d.vvColor,vvInstancingEnabled:!0,vvOpacity:d.vvOpacity,useOldSceneLightInterface:!1,pbrMode:0,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:d.receiveSSAO,doubleSidedMode:d.doubleSidedMode});return new x(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),
b.pathVertexAttributeLocations)};k.prototype.bindPass=function(a,b,c){this.program.setUniform3fv("size",b.size);0===this.configuration.output?(this.program.setUniform3fv("size",b.size),this.program.setUniform3fv("ambient",b.ambient),this.program.setUniform3fv("diffuse",b.diffuse),this.program.setUniform3fv("specular",b.specular),this.program.setUniform1f("opacity",b.opacity)):1!==this.configuration.output&&3!==this.configuration.output||d.ReadLinearDepth.bindUniforms(this.program,c);l.setVVUniforms(this.program,
b)};k.prototype.bindDraw=function(b){f.Transform.bindUniforms(this.program,b);e.Slice.bindUniformsWithOrigin(this.program,this.configuration,b);0===this.configuration.output&&(c.Camera.bindUniforms(this.program,b),a.ReadShadowMap.bindView(this.program,b));2===this.configuration.output&&h.VertexNormal.bindUniforms(this.program,b)};k.prototype.initializePipeline=function(){var a=this.configuration,b=function(b){return w.makePipelineState({blending:b,culling:(a.slicePlaneEnabled?!1:!a.transparent&&0!==
a.doubleSidedMode)&&{face:1028,mode:2305},depthTest:{func:513},depthWrite:w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams,stencilWrite:a.sceneHasOcludees?u.stencilWriteMaskOn:null,stencilTest:a.sceneHasOcludees?u.stencilBaseAllZerosParams:null})};return 0===a.output?b(a.transparent&&w.separateBlendingParams(770,1,771,771)):b(null)};k.shader=new q.ReloadableShaderModule(r,"../shaders/Path.glsl",n);return k}(p.ShaderTechnique);b.PathTechnique=g;g=function(a){function b(){var b=null!==
a&&a.apply(this,arguments)||this;b.output=0;b.doubleSidedMode=0;b.receiveShadows=!1;b.receiveSSAO=!1;b.vvSize=!1;b.vvColor=!1;b.vvOpacity=!1;b.slicePlaneEnabled=!1;b.shadowMap=!1;b.transparent=!1;b.sceneHasOcludees=!1;return b}m(b,a);k([t.parameter({count:7})],b.prototype,"output",void 0);k([t.parameter({count:3})],b.prototype,"doubleSidedMode",void 0);k([t.parameter()],b.prototype,"receiveShadows",void 0);k([t.parameter()],b.prototype,"receiveSSAO",void 0);k([t.parameter()],b.prototype,"vvSize",
void 0);k([t.parameter()],b.prototype,"vvColor",void 0);k([t.parameter()],b.prototype,"vvOpacity",void 0);k([t.parameter()],b.prototype,"slicePlaneEnabled",void 0);k([t.parameter()],b.prototype,"shadowMap",void 0);k([t.parameter()],b.prototype,"transparent",void 0);k([t.parameter()],b.prototype,"sceneHasOcludees",void 0);return b}(t.ShaderTechniqueConfiguration);b.PathTechniqueConfiguration=g})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","./PositionAttribute.glsl","../../shaderModules/interfaces"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.PathVertexPosition=function(b,n){b.attributes.add("featureValue","vec4");b.vertex.code.add(g.glsl(e||(e=m(["\n  bool isCapVertex() {\n    return featureValue.w \x3d\x3d 1.0;\n  }\n  "],["\n  bool isCapVertex() {\n    return featureValue.w \x3d\x3d 1.0;\n  }\n  "]))));b.vertex.uniforms.add("size","vec3");
n.vvSize?(b.vertex.uniforms.add("vvSizeMinSize","vec3"),b.vertex.uniforms.add("vvSizeMaxSize","vec3"),b.vertex.uniforms.add("vvSizeOffset","vec3"),b.vertex.uniforms.add("vvSizeFactor","vec3"),b.vertex.code.add(g.glsl(f||(f=m(["\n    vec2 getSize() {\n      return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;\n    }\n    "],["\n    vec2 getSize() {\n      return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;\n    }\n    "]))))):
b.vertex.code.add(g.glsl(l||(l=m(["\n    vec2 getSize(){\n      return size.xy;\n    }\n    "],["\n    vec2 getSize(){\n      return size.xy;\n    }\n    "]))));n.vvOpacity?(b.vertex.defines.addInt("VV_OPACITY_N",8),b.vertex.code.add(g.glsl(h||(h=m(["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    vec4 applyOpacity(vec4 color) {\n      float value \x3d featureValue.z;\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vec4( color.xyz, vvOpacityOpacities[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));\n        }\n      }\n\n      return vec4( color.xyz, vvOpacityOpacities[VV_OPACITY_N - 1]);\n    }\n    "],
["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    vec4 applyOpacity(vec4 color) {\n      float value \x3d featureValue.z;\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vec4( color.xyz, vvOpacityOpacities[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));\n        }\n      }\n\n      return vec4( color.xyz, vvOpacityOpacities[VV_OPACITY_N - 1]);\n    }\n    "]))))):
b.vertex.code.add(g.glsl(d||(d=m(["\n    vec4 applyOpacity(vec4 color){\n      return color;\n    }\n    "],["\n    vec4 applyOpacity(vec4 color){\n      return color;\n    }\n    "]))));n.vvColor?(b.vertex.defines.addInt("VV_COLOR_N",8),b.vertex.code.add(g.glsl(a||(a=m(["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 getColor() {\n      float value \x3d featureValue.y;\n      if (value \x3c\x3d vvColorValues[0]) {\n        return applyOpacity(vvColorColors[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));\n        }\n      }\n\n      return applyOpacity(vvColorColors[VV_COLOR_N - 1]);\n    }\n    "],
["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 getColor() {\n      float value \x3d featureValue.y;\n      if (value \x3c\x3d vvColorValues[0]) {\n        return applyOpacity(vvColorColors[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));\n        }\n      }\n\n      return applyOpacity(vvColorColors[VV_COLOR_N - 1]);\n    }\n    "]))))):
b.vertex.code.add(g.glsl(c||(c=m(["\n    vec4 getColor(){\n      return applyOpacity(vec4(1, 1, 1, 1));\n    }\n    "],["\n    vec4 getColor(){\n      return applyOpacity(vec4(1, 1, 1, 1));\n    }\n    "]))));b.include(k.PositionAttribute);b.attributes.add("profileRight","vec4");b.attributes.add("profileUp","vec4");b.attributes.add("profileVertexAndNormal","vec4");b.vertex.code.add(g.glsl(q||(q=m(["\n  vec3 calculateVPos() {\n    vec2 size \x3d getSize();\n    vec3 origin \x3d position;\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileVertex \x3d profileVertexAndNormal.xy * size;\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n    float positionOffsetAlongProfilePlaneNormal \x3d 0.0;\n    float normalOffsetAlongProfilePlaneNormal \x3d 0.0;\n    "],
["\n  vec3 calculateVPos() {\n    vec2 size \x3d getSize();\n    vec3 origin \x3d position;\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileVertex \x3d profileVertexAndNormal.xy * size;\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n    float positionOffsetAlongProfilePlaneNormal \x3d 0.0;\n    float normalOffsetAlongProfilePlaneNormal \x3d 0.0;\n    "]))));b.vertex.code.add(g.glsl(p||(p=m(["\n    if(!isCapVertex()) {\n      vec2 rotationRight \x3d vec2(profileRight.w, profileUp.w);\n      float maxDistance \x3d length(rotationRight);\n  "],
["\n    if(!isCapVertex()) {\n      vec2 rotationRight \x3d vec2(profileRight.w, profileUp.w);\n      float maxDistance \x3d length(rotationRight);\n  "]))));b.vertex.code.add(g.glsl(t||(t=m(["\n      rotationRight \x3d maxDistance \x3e 0.0 ? normalize(rotationRight) : vec2(0, 0);\n\n      // decompose vertex into rotationRight and rotationUp\n      // limit rotation right component to maxDistance\n      // and reassemble profile vertex from rotationRight and rotationUp\n      float rx \x3d dot(profileVertex, rotationRight);\n      if (abs(rx) \x3e maxDistance) {\n        // NB: we do the tangent by x\x3d-y and y\x3dx\n        vec2 rotationUp \x3d vec2(-rotationRight.y, rotationRight.x);\n        float ry \x3d dot(profileVertex, rotationUp);\n        profileVertex \x3d rotationRight * maxDistance * sign(rx) + rotationUp * ry;\n      }\n    }else{\n       positionOffsetAlongProfilePlaneNormal \x3d profileRight.w * size[0];\n       normalOffsetAlongProfilePlaneNormal \x3d profileUp.w;\n    }\n\n    vec3 offset \x3d right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;\n\n    vec4 localPosition \x3d vec4(origin + offset, 1.0);\n    return (model * localPosition).xyz;\n  }\n  "],
["\n      rotationRight \x3d maxDistance \x3e 0.0 ? normalize(rotationRight) : vec2(0, 0);\n\n      // decompose vertex into rotationRight and rotationUp\n      // limit rotation right component to maxDistance\n      // and reassemble profile vertex from rotationRight and rotationUp\n      float rx \x3d dot(profileVertex, rotationRight);\n      if (abs(rx) \x3e maxDistance) {\n        // NB: we do the tangent by x\x3d-y and y\x3dx\n        vec2 rotationUp \x3d vec2(-rotationRight.y, rotationRight.x);\n        float ry \x3d dot(profileVertex, rotationUp);\n        profileVertex \x3d rotationRight * maxDistance * sign(rx) + rotationUp * ry;\n      }\n    }else{\n       positionOffsetAlongProfilePlaneNormal \x3d profileRight.w * size[0];\n       normalOffsetAlongProfilePlaneNormal \x3d profileUp.w;\n    }\n\n    vec3 offset \x3d right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;\n\n    vec4 localPosition \x3d vec4(origin + offset, 1.0);\n    return (model * localPosition).xyz;\n  }\n  "]))));
b.vertex.code.add(g.glsl(u||(u=m(["\n  vec4 localNormal() {\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n\n    vec3 normal \x3d right * profileNormal.x + up * profileNormal.y;\n\n    if(isCapVertex()) {\n      normal +\x3d forward * profileUp.w;\n    }\n\n    return vec4(normal, 1.0);\n  }\n  "],["\n  vec4 localNormal() {\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n\n    vec3 normal \x3d right * profileNormal.x + up * profileNormal.y;\n\n    if(isCapVertex()) {\n      normal +\x3d forward * profileUp.w;\n    }\n\n    return vec4(normal, 1.0);\n  }\n  "]))))};
b.setVVUniforms=function(a,b){b.vvSizeEnabled&&(a.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",b.vvSizeOffset),a.setUniform3fv("vvSizeFactor",b.vvSizeFactor));b.vvColorEnabled&&(a.setUniform1fv("vvColorValues",b.vvColorValues),a.setUniform4fv("vvColorColors",b.vvColorColors));b.vvOpacityEnabled&&(a.setUniform1fv("vvOpacityValues",b.vvOpacityValues),a.setUniform1fv("vvOpacityOpacities",b.vvOpacityOpacities))};var e,f,
l,h,d,a,c,q,p,t,u})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(n,b,m,k,g){function e(b){b.include(k.RgbaFloatEncoding);b.fragment.code.add(g.glsl(f||(f=m(["\n    float linearDepth(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "],
["\n    float linearDepth(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.ReadLinearDepth=e;(function(b){b.bindUniforms=function(b,d){b.setUniform2fv("nearFar",d.nearFar)}})(e=b.ReadLinearDepth||(b.ReadLinearDepth={}));var f})},"esri/views/3d/webgl-engine/shaders/Path.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/ForwardLinearDepth.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/output/OutputDepth.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/NormalUtils.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var n=new u.ShaderBuilder;n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4").add("modelNormal","mat4").add("camPos","vec3").add("localOrigin","vec3");n.varyings.add("vpos","vec3");n.include(f.PathVertexPosition,b);0===b.output&&(n.include(e.Transform,{linearDepth:!1}),b.receiveShadows&&n.include(p.ReadShadowMap,b),n.include(k.ForwardLinearDepth,b),n.varyings.add("vnormal",
"vec3"),n.varyings.add("vcolor","vec4"),n.vertex.code.add(t.glsl(r||(r=m(["\n      void main() {\n        vpos \x3d calculateVPos();\n\n        vnormal \x3d normalize((modelNormal * localNormal()).xyz);\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n\n        forwardLinearDepth();\n\n        vcolor \x3d getColor();\n      }\n    "],["\n      void main() {\n        vpos \x3d calculateVPos();\n\n        vnormal \x3d normalize((modelNormal * localNormal()).xyz);\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n\n        forwardLinearDepth();\n\n        vcolor \x3d getColor();\n      }\n    "])))),
n.include(g.Slice,b),n.include(a.EvaluateSceneLighting,b),n.include(d.EvaluateAmbientOcclusion,b),b.receiveShadows&&n.include(p.ReadShadowMap,b),n.include(c.Normals,b),n.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),n.fragment.code.add(t.glsl(x||(x=m(["\n      void main() {\n        discardBySlice(vpos);\n\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        shadingParams.normalView \x3d vnormal;\n        vec3 normal \x3d shadingNormal(shadingParams);\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n    "],
["\n      void main() {\n        discardBySlice(vpos);\n\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        shadingParams.normalView \x3d vnormal;\n        vec3 normal \x3d shadingNormal(shadingParams);\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n    "])))),
b.receiveShadows?n.fragment.code.add(t.glsl(w||(w=m(["\n        float shadow \x3d readShadowMap(vpos, linearDepth);\n      "],["\n        float shadow \x3d readShadowMap(vpos, linearDepth);\n      "])))):0===b.viewingMode?n.fragment.code.add(t.glsl(v||(v=m(["\n        float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n      "],["\n        float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n      "])))):n.fragment.code.add(t.glsl(z||(z=m(["\n        float shadow \x3d 0.0;\n      "],
["\n        float shadow \x3d 0.0;\n      "])))),n.fragment.code.add(t.glsl(y||(y=m(["\n        vec3 albedo \x3d vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one\n        float combinedOpacity \x3d vcolor.a * opacity;\n        albedo +\x3d 0.25 * specular; // don't completely ignore specular for now\n\n        vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);\n        gl_FragColor \x3d vec4(shadedColor, combinedOpacity);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "],
["\n        vec3 albedo \x3d vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one\n        float combinedOpacity \x3d vcolor.a * opacity;\n        albedo +\x3d 0.25 * specular; // don't completely ignore specular for now\n\n        vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);\n        gl_FragColor \x3d vec4(shadedColor, combinedOpacity);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "])))));
if(1===b.output||3===b.output)n.include(e.Transform,{linearDepth:!0}),n.vertex.uniforms.add("nearFar","vec2"),n.varyings.add("depth","float"),n.vertex.code.add(t.glsl(A||(A=m(["\n        void main() {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        }\n    "],["\n        void main() {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        }\n    "])))),
n.include(g.Slice,b),n.include(l.OutputDepth,b),n.fragment.uniforms.add("timeElapsed","float"),n.fragment.code.add(t.glsl(B||(B=m(["\n        void main() {\n          discardBySlice(vpos);\n          outputDepth(depth);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n          outputDepth(depth);\n        }\n    "]))));2===b.output&&(n.include(e.Transform,{linearDepth:!1}),n.include(q.NormalUtils,b),n.vertex.uniforms.add("viewNormal","mat4"),n.varyings.add("vnormal",
"vec3"),n.vertex.code.add(t.glsl(C||(C=m(["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])))),
n.include(g.Slice,b),n.fragment.uniforms.add("waterColor","vec4"),n.fragment.code.add(t.glsl(F||(F=m(["\n        void main() {\n          discardBySlice(vpos);\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n        }\n    "])))));
4===b.output&&(n.include(e.Transform,{linearDepth:!1}),n.include(q.NormalUtils,b),n.vertex.uniforms.add("viewNormal","mat4"),n.varyings.add("vnormal","vec3"),n.vertex.code.add(t.glsl(E||(E=m(["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])))),n.include(g.Slice,
b),n.include(h.OutputHighlight),n.fragment.code.add(t.glsl(G||(G=m(["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "])))));return n};var r,x,w,v,z,y,A,B,C,F,E,G})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/mathUtils ../../../../geometry/support/aaBoundingBox ../../support/buffer/BufferView ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./PathTechnique ./VisualVariableMaterialParameters ./internal/bufferWriterUtils ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/MergedRenderer".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x){var w=c.assert;n=function(a){function b(c,d){d=a.call(this,d)||this;d.supportsEdges=!0;d.techniqueConfig=new q.PathTechniqueConfiguration;d.params=r.copyParameters(c,z);d.vertexBufferLayout=b.getVertexBufferLayout(d.params);return d}k(b,a);b.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.vvColor=this.params.vvColorEnabled;this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled;
this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;0===a&&(this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.receiveShadows=this.params.receiveShadows,this.techniqueConfig.receiveSSAO=this.params.receiveSSAO);return this.techniqueConfig};
b.prototype.getPassParameters=function(){return this.params};b.prototype.isVisibleInPass=function(a){return 3===a?this.params.castShadows:!0};b.prototype.isVisible=function(){var b=this.params;return a.prototype.isVisible.call(this)?0<b.opacity:!1};b.prototype.setParameterValues=function(a){u.updateParameters(this.params,a)&&this.parametersChanged()};b.prototype.getParameters=function(){return this.params};b.prototype.intersect=function(a,b,c,d,f,h,l){if(a.metadata){b=a.metadata.pathGeometry;c=[this.params.size[0],
this.params.size[1]];if(this.params.vvSizeEnabled){var k=this.params.vvSizeOffset,m=this.params.vvSizeFactor,p=this.params.vvSizeMinSize,q=this.params.vvSizeMaxSize,u=b.sizeAttributeValue;c[0]*=g.clamp(k[0]+u*m[0],p[0],q[0]);c[1]*=g.clamp(k[2]+u*m[2],p[2],q[2])}k=Math.max(c[0],c[1]);a=e.fromValues(a.boundingInfo.bbMin[0]-k,a.boundingInfo.bbMin[1]-k,a.boundingInfo.bbMin[2]-k,a.boundingInfo.bbMax[0]+k,a.boundingInfo.bbMax[1]+k,a.boundingInfo.bbMax[2]+k);k=[h[0]-f[0],h[1]-f[1],h[2]-f[2]];m=Math.sqrt(k[0]*
k[0]+k[1]*k[1]+k[2]*k[2]);r.intersectAabbInvDir(a,f,[m/k[0],m/k[1],m/k[2]],d.tolerance)&&(b.baked.size&&b.baked.size[0]===c[0]&&b.baked.size[1]===c[1]||b.baked.bake(c),b.baked.intersect(f,h,l))}};b.prototype.computeAttachmentOrigin=function(a,b){a=a.data;return(a="getVertexAttr"in a?a.getVertexAttr():"vertexAttr"in a?a.vertexAttr:null)?h.computeAttachmentOriginLines(a[q.PathVertexAttrConstants.POSITION],null,!1,b):null};b.prototype.createBufferWriter=function(){return new y(this.vertexBufferLayout)};
b.prototype.createRenderer=function(a,b){return new x(a,b,this,q.pathVertexAttributeLocations)};b.prototype.getGLMaterial=function(a){if(0===a.output||1===a.output||2===a.output||4===a.output||3===a.output&&this.params.castShadows)return new v(a)};b.getVertexBufferLayout=function(a){var b=l.newLayout().vec3f(q.PathVertexAttrConstants.POSITION).vec4f(q.PathVertexAttrConstants.PROFILERIGHT).vec4f(q.PathVertexAttrConstants.PROFILEUP).vec4f(q.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL);if(a.vvColorEnabled||
a.vvSizeEnabled||a.vvOpacityEnabled)b=b.vec4f(q.PathVertexAttrConstants.FEATUREVALUE);return b};return b}(a.Material);var v=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}k(b,a);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(q.PathTechnique,this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.beginSlot=function(a){return a===(this.technique.configuration.transparent?5:3)};b.prototype._updateOccludeeState=
function(a){a.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};b.prototype._updateShadowState=function(a){a.shadowMappingEnabled!==this.technique.configuration.receiveShadows&&(this.material.setParameterValues({receiveShadows:a.shadowMappingEnabled}),this.updateParameters())};b.prototype.ensureParameters=function(a){0===this.output&&(this._updateShadowState(a),this._updateOccludeeState(a))};
b.prototype.bind=function(a,b){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getPassParameters(),b)};return b}(d.GLMaterial),z=m({size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],opacity:1,doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1},p.Default),y=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};
a.prototype.elementCount=function(a){return a.indices[q.PathVertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d){var e=function(a){if(a in b.vertexAttr){var e=b.vertexAttr[a],h=b.indices[a];w(4===e.size);var g=c.getField(a,f.BufferViewVec4f);if(g)t.writeBufferVec4(h,e.data,g,d);else throw Error("unable to acquire view for "+a);}};e(q.PathVertexAttrConstants.PROFILERIGHT);e(q.PathVertexAttrConstants.PROFILEUP);e(q.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL);this.vertexBufferLayout.hasField(q.PathVertexAttrConstants.FEATUREVALUE)&&
e(q.PathVertexAttrConstants.FEATUREVALUE);t.writeDefaultAttributes(b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,c,d)};return a}();return n})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../geometry/support/aaBoundingBox ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Util ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function r(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._hasOutline=!1;return a}m(r,b);r.prototype.doLoad=function(){return g(this,void 0,void 0,function(){return k(this,function(a){return[2]})})};r.prototype.ensureMaterials=function(){this.ensureFillMaterial();this.ensureOutlineMaterial()};r.prototype.ensureFillMaterial=function(){if(!l.isSome(this._material)){var a=l.get(this.symbolLayer,
"material","color"),a=this._getCombinedOpacityAndColor(a);this._material=new C({color:a,transparent:1>a[3]||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},this._getIdHint("_colormat"));this._context.stage.add(3,this._material)}};r.prototype.ensureOutlineMaterial=function(){var a=this.symbolLayer.outline;if(!l.isSome(this._outlineMaterial)&&this._isValidOutline(a)){this._hasOutline=!0;var b;b=h.pt2px(a.size);var c=a.stipplePattern?
F.createStipplePattern(a.stipplePattern.map(h.pt2px)):null,a=a.stippleOffColor?f.toUnitRGBA(a.stippleOffColor):null;b=1.5<b?new G({width:b,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:c,stippleIntegerRepeats:!0,stippleOffColor:a},this._getIdHint("_outline_ribbonlinemat")):new E({color:this._getOutlineColor(),slicePlaneEnabled:this._context.slicePlaneEnabled,width:b,stipplePattern:c,stippleIntegerRepeats:!0,stippleOffColor:a},
this._getIdHint("_outline_nativelinemat"));this._outlineMaterial=b;this._context.stage.add(3,this._outlineMaterial)}};r.prototype._isValidOutline=function(a){return l.isSome(a)&&a.size&&0<a.size&&l.isSome(a.color)};r.prototype.destroy=function(){b.prototype.destroy.call(this);l.isSome(this._material)&&(this._context.stage.remove(3,this._material.id),this._material=null);l.isSome(this._outlineMaterial)&&(this._context.stage.remove(3,this._outlineMaterial.id),this._outlineMaterial=null)};r.prototype.createGraphics3DGraphic=
function(a){var b=a.graphic;if(!this._validateGeometryType(b.geometry,r.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid;a=this._getVertexOpacityAndColor(a.renderingInfo,Uint8Array,255);var d=this.getGraphicElevationContext(b);this.ensureDrapedStatus("on-the-ground"===d.mode);this.ensureMaterials();return this.draped?this._createAsOverlay(b,a,c):this._createAs3DShape(b,a,d,c)};r.prototype.layerOpacityChanged=function(){if(l.isSome(this._material)){var a=
this._material.getParameters().color,b=l.get(this.symbolLayer,"material","color"),b=this._getCombinedOpacity(b);this._material.setParameterValues({color:[a[0],a[1],a[2],b],transparent:1>b||this.needsDrivenTransparentPass})}l.isSome(this._outlineMaterial)&&(a=this._outlineMaterial.getParameters().color,this._outlineMaterial.setParameterValues({color:[a[0],a[1],a[2],this._getOutlineOpacity()]}));return!0};r.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;c=p.elevationModeChangeUpdateType(r.elevationModeChangeTypes,
c,d);if(c!==p.SymbolUpdateType.UPDATE)return c;var e=p.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};r.prototype.slicePlaneEnabledChanged=function(){l.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});l.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};r.prototype.physicalBasedRenderingChanged=function(){return!0};
r.prototype.pixelRatioChanged=function(){return!0};r.prototype._createAs3DShape=function(a,b,c,d){var e=v.geometryAsPolygon(a.geometry);if(l.isNone(e))return null;D.renderData=v.geometryToRenderInfo(e,this._context.elevationProvider,this._context.renderCoordsHelper,c);D.idHint=d;D.color=b;D.outNum=0;D.outGeometries=[];D.outTransforms=[];D.outMaterials=[];this._createAs3DShapeFill(D);this._hasOutline&&this._createAs3DShapeOutline(D);this._logGeometryCreationWarnings(D.renderData,e.rings,"rings","FillSymbol3DLayer");
if(0===D.outNum)return null;a=new y({geometries:D.outGeometries,materials:D.outMaterials,transformations:D.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:a.uid},idHint:d});a=new u(this,a,D.outGeometries,null,null,q.perVertexElevationAligner,c);a.alignedSampledElevation=D.renderData.sampledElevation;a.needsElevationUpdates=p.needsElevationUpdates2D(c.mode);return a};r.prototype._createAs3DShapeFill=function(b){for(var e=b.renderData.polygons,f=0;f<e.length;++f){var h=
e[f],g=h.position,k=h.mapPosition,h=h.holeIndices;if(l.isSome(this._context.clippingExtent)&&(c.empty(H),c.expandWithBuffer(H,k),!c.intersectsClippingArea(H,this._context.clippingExtent)))continue;h=d.earcut(k,h,3);0!==h.length&&(h=new Uint32Array(h),g=v.createColorGeometryData({indices:h,attributeData:{position:g,color:b.color,mapPosition:k}}),g=new z(g,b.idHint),b.outGeometries.push(g),b.outMaterials.push(l.expect(this._material)),b.outTransforms.push(a.mat4f64.IDENTITY),b.outNum++)}};r.prototype._createAs3DShapeOutline=
function(b){if(this._hasOutline)for(var d=b.renderData.outlines,e=this._outlineMaterial instanceof E,f=0;f<d.length;++f){var h=d[f],g=h.mapPosition,h=h.position;if(l.isSome(this._context.clippingExtent)&&(c.empty(H),c.expandWithBuffer(H,g),!c.intersectsClippingArea(H,this._context.clippingExtent)))continue;var g=w.createGeometryData({removeDuplicateStartEnd:e?0:1,attributeData:{position:h,mapPosition:g}}),k=g.vertexAttributes[B.VertexAttrConstants.POSITION];k.data===h&&(k.data=new Float64Array(h));
h=new z(g,b.idHint+"outline"+f);b.outGeometries.push(h);b.outMaterials.push(l.expect(this._outlineMaterial));b.outTransforms.push(a.mat4f64.IDENTITY);b.outNum++}};r.prototype._createAsOverlay=function(a,b,d){var e=v.geometryAsPolygon(a.geometry);if(l.isNone(e))return null;l.expect(this._material).renderPriority=this._renderPriority+this._renderPriorityDelta/2;l.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);I.renderData=v.geometryToRenderInfoDraped(e,this._context.overlaySR);
I.idHint=d;I.color=b;I.outNum=0;I.outGeometries=[];I.outBoundingBox=c.empty();I.layerUid=this._context.layer.uid;I.graphicsUid=a.uid;this._createAsOverlayFill(I);this._hasOutline&&this._createAsOverlayOutline(I);this._logGeometryCreationWarnings(I.renderData,e.rings,"rings","FillSymbol3DLayer");return 0<I.outNum?new t(this,I.outGeometries,I.outBoundingBox):null};r.prototype._createAsOverlayFill=function(a){for(var b=a.renderData.polygons,e=0;e<b.length;++e){var f=b[e],h=f.position,f=f.holeIndices;
c.empty(H);c.expandWithBuffer(H,h);c.intersectsClippingArea(H,this._context.clippingExtent)&&(f=d.earcut(h,f,3),0!==f.length&&(c.expand(a.outBoundingBox,H),f=new Uint32Array(f),h=v.createColorGeometryData({indices:f,attributeData:{position:h,color:a.color}}),h=new A(h),h.data.layerUid=a.layerUid,h.data.graphicUid=a.graphicsUid,h.material=l.expect(this._material),f=H,h.center=[.5*(f[0]+f[3]),.5*(f[1]+f[4]),0],h.bsRadius=.5*Math.sqrt((f[3]-f[0])*(f[3]-f[0])+(f[4]-f[1])*(f[4]-f[1])),a.outGeometries.push(h),
a.outNum++))}};r.prototype._createAsOverlayOutline=function(a){if(this._hasOutline)for(var b=a.renderData.outlines,d=0;d<b.length;++d){var e=b[d].position;c.empty(H);c.expandWithBuffer(H,e);if(c.intersectsClippingArea(H,this._context.clippingExtent)){c.expand(a.outBoundingBox,H);e=w.createGeometryData({removeDuplicateStartEnd:this._outlineMaterial instanceof E?0:1,attributeData:{position:e}});e=new A(e);e.data.layerUid=a.layerUid;e.data.graphicUid=a.graphicsUid;e.material=l.expect(this._outlineMaterial);
var f=H;e.center=[.5*(f[0]+f[3]),.5*(f[1]+f[4]),0];e.bsRadius=.5*Math.sqrt((f[3]-f[0])*(f[3]-f[0])+(f[4]-f[1])*(f[4]-f[1]));a.outGeometries.push(e);a.outNum++}}};r.prototype._getOutlineOpacity=function(){var a=l.get(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(l.isSome(a)?a.a:0)};r.prototype._getOutlineColor=function(){var a=l.get(this.symbolLayer,"outline","color"),b=this._getOutlineOpacity();return x.mixinColorAndOpacity(l.isSome(a)?e.toUnitRGB(a):null,b)};
Object.defineProperty(r.prototype,"test",{get:function(){var a=this;return{createAsOverlay:function(b,c,d){return a._createAsOverlay(b,c,d)},createAs3DShape:function(b,c,d,e){return a._createAs3DShape(b,c,d,e)}}},enumerable:!0,configurable:!0});r.validGeometryTypes=["polyline","polygon","extent"];r.elevationModeChangeTypes={definedChanged:p.SymbolUpdateType.RECREATE,staysOnTheGround:p.SymbolUpdateType.NONE,onTheGroundChanged:p.SymbolUpdateType.RECREATE};return r}(r.default);b.Graphics3DPolygonFillSymbolLayer=
n;var H=c.create(),D={idHint:null,renderData:null,color:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},I={idHint:null,renderData:null,color:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};b.default=n})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../lib/GLMaterial ../lib/Material ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/ColorMaterialTechnique".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){n=function(b){function e(c,d){d=b.call(this,d)||this;d.supportsEdges=!0;d.techniqueConfig=new a.ColorMaterialTechniqueConfiguration;d.params=h.copyParameters(c,q);return d}k(e,b);e.prototype.setParameterValues=function(a){l.updateParameters(this.params,a)&&this.parametersChanged()};e.prototype.getParameters=function(){return this.params};e.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.cullFace=this.params.cullFace;this.techniqueConfig.vertexColors=
this.params.vertexColors;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;return this.techniqueConfig};e.prototype.getPassParameters=function(){return this.params};e.prototype.intersect=function(a,b,c,d,e,f,g){h.intersectTriangleGeometry(a,b,
d,e,f,void 0,g)};e.prototype.getGLMaterial=function(a){return 0===a.output||4===a.output?new c(a):void 0};e.prototype.createBufferWriter=function(){return new f.DefaultBufferWriter(f.PositionColorLayout)};e.prototype.createRenderer=function(a,b){return new d(a,b,this)};return e}(e.Material);var c=function(b){function c(a){a=b.call(this,a)||this;a.updateParameters();return a}k(c,b);c.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(a.ColorMaterialTechnique,
this.material.getTechniqueConfig(this.output),this.technique)};c.prototype.beginSlot=function(a){return 4===this.output?3===a:a===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)};c.prototype._updateOccludeeState=function(a){a.hasOccludees!==this.material.getParameters().sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:a.hasOccludees}),this.updateParameters())};c.prototype.ensureParameters=function(a){0===this.output&&this._updateOccludeeState(a)};
c.prototype.bind=function(a,b){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getPassParameters(),b)};c.prototype.getPipelineState=function(a,b){return b?this.technique.opaqueOccludeeState:this.technique.pipeline};return c}(g.GLMaterial),q={color:[1,1,1,1],transparent:!1,writeDepth:!0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1};return n})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/StencilUtils ./ColorMaterial.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t){Object.defineProperty(b,"__esModule",{value:!0});g=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}m(d,b);d.prototype.initializeProgram=function(b){var c=d.shader.get(),e=this.configuration,c=c.build({attributeColor:e.vertexColors,slicePlaneEnabled:e.slicePlaneEnabled,sliceHighlightDisabled:e.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1});return new p(b.rctx,c.generateSource("vertex"),c.generateSource("fragment"),a.Default3D)};
d.prototype.bindPass=function(a,b,c){this.program.setUniform4fv("eColor",b.color)};d.prototype.bindDraw=function(a){f.Transform.bindUniforms(this.program,a);e.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};d.prototype.initializePipeline=function(){var a=function(a){return 0!==a&&{face:1===a?1028:1029,mode:2305}},b=this.configuration,d=t.separateBlendingParams(770,1,771,771),e=0===b.output?b.transparent&&d:null,d=function(d){return t.makePipelineState({blending:e,polygonOffset:b.polygonOffset&&
u,culling:a(b.cullFace),depthTest:c.depthCompareLess,depthWrite:b.writeDepth&&t.defaultDepthWriteParams,colorWrite:t.defaultColorWriteParams,stencilWrite:b.sceneHasOcludees?c.stencilWriteMaskOn:null,stencilTest:b.sceneHasOcludees?d?c.stencilToolMaskBaseParams:c.stencilBaseAllZerosParams:null})};this._occludeeState=d(!0);return d(!1)};Object.defineProperty(d.prototype,"opaqueOccludeeState",{get:function(){return this._occludeeState},enumerable:!0,configurable:!0});d.shader=new l.ReloadableShaderModule(q,
"./ColorMaterial.glsl",n);return d}(h.ShaderTechnique);b.ColorMaterialTechnique=g;var u={factor:1,units:1};g=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.cullFace=0;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.vertexColors=!1;b.transparent=!1;b.polygonOffset=!1;b.writeDepth=!0;b.sceneHasOcludees=!1;return b}m(b,a);k([d.parameter({count:7})],b.prototype,"output",void 0);k([d.parameter({count:3})],b.prototype,"cullFace",void 0);k([d.parameter()],b.prototype,
"slicePlaneEnabled",void 0);k([d.parameter()],b.prototype,"sliceHighlightDisabled",void 0);k([d.parameter()],b.prototype,"vertexColors",void 0);k([d.parameter()],b.prototype,"transparent",void 0);k([d.parameter()],b.prototype,"polygonOffset",void 0);k([d.parameter()],b.prototype,"writeDepth",void 0);k([d.parameter()],b.prototype,"sceneHasOcludees",void 0);return b}(d.ShaderTechniqueConfiguration);b.ColorMaterialTechniqueConfiguration=g})},"esri/views/3d/webgl-engine/shaders/ColorMaterial.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/VertexColor.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(a){var b=new l.ShaderBuilder;b.include(g.Transform,{linearDepth:!1});b.include(e.VertexColor,a);b.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4");b.attributes.add("position","vec3");b.varyings.add("vpos","vec3");b.vertex.code.add(f.glsl(h||(h=m(["\n    void main(void) {\n      vpos \x3d (model * vec4(position, 1.0)).xyz;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n    }\n  "],
["\n    void main(void) {\n      vpos \x3d (model * vec4(position, 1.0)).xyz;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n    }\n  "]))));b.include(k.Slice,a);b.fragment.uniforms.add("eColor","vec4");b.fragment.code.add(f.glsl(d||(d=m(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n    }\n    "],["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n    }\n    "])),
a.attributeColor?"gl_FragColor \x3d vColor * eColor;":"gl_FragColor \x3d eColor;"));return b};var h,d})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A){function B(a,b,c){a&&a.forEach(function(a){var d=b(a);f.isSome(d)&&c(d,a.graphic)})}Object.defineProperty(b,"__esModule",{value:!0});var C=[0,0,1];n=function(b){function n(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._geometryDataPool=new l(w.GeometryData,function(a,b,c){var d=b.translation;c=f.isSome(c)?[c.displayWidth,c.displayHeight]:[0,0];b=b.centerOffset;0===a.indexCount?v.createPointGeometry(C,d,null,c,b,[0,0],null,a):v.updatePointGeometry(null,
d,null,c,b,null,null,a)});a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};a.ensureDrapedStatus(!1);return a}m(n,b);n.prototype.doLoad=function(){return g(this,void 0,void 0,function(){var a;return k(this,function(b){if(!this._drivenProperties.size&&(a=u.validateSymbolLayerSize(this.symbolLayer.size)))throw new e("graphics3dtextsymbollayer:invalid-size",a);this._createTextRenderParameters();return[2]})})};n.prototype._createTextRenderParameters=function(){this._textRenderParameters=
z.default.fromSymbol(this.symbolLayer,this._context.layerView.view.pixelRatio)};n.prototype.destroy=function(){b.prototype.destroy.call(this);this._geometryDataPool.destroy()};n.prototype.createGraphics3DGraphic=function(b){b=b.graphic;var c=r.placePointOnGeometry(b.geometry);if(f.isNone(c))return this.logger.warn("unsupported geometry type for text symbol: "+b.geometry.type),null;var d=this.symbolLayer.text;if(!d)return null;var e=a.isCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?
this.symbol:null;return this._createAs3DShape(b,c,d,e)};n.prototype.onRemoveGraphic=function(a){this._geometryDataPool.release(a.stageObject.geometries[0].data)};n.prototype.createLabel=function(a,b,c,d){a=a.graphic;var e=r.placePointOnGeometry(a.geometry);if(f.isNone(e))return this.logger.warn("unsupported geometry type for label: "+a.geometry.type),null;var h=b.text;return h?this._createAs3DShape(a,e,h,b,b,c,d):null};n.prototype.getGraphicElevationContext=function(a,c){void 0===c&&(c=0);a=b.prototype.getGraphicElevationContext.call(this,
a);a.addOffsetRenderUnits(c);return a};n.prototype.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1};n.prototype.layerElevationInfoChanged=function(a,b){var c=this;B(a,b,function(a,b){c.updateGraphicElevationContext(b,a)});return q.SymbolUpdateType.UPDATE};n.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;B(a,b,function(a){var b=0;for(a=a.stageObject.geometryRecords;b<a.length;b++)a[b].material.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});
return!0};n.prototype.physicalBasedRenderingChanged=function(){return!0};n.prototype.pixelRatioChanged=function(){return!1};n.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=q.needsElevationUpdates2D(a.mode)||"absolute-height"===a.mode};n.prototype._defaultElevationInfoNoZ=function(){return F};n.prototype._createAs3DShape=function(a,b,e,g,l,k,m){void 0===l&&(l=E);var n=this.getGraphicElevationContext(a,
l.elevationOffset),t=this._context.layer.id+"_label_"+a.uid,v="polyline"===f.get(a.geometry,"type"),w=a.uid;a=this._context.stage.renderView.renderingContext;var z=u.namedAnchorToHUDMaterialAnchorPos[l.anchor in u.namedAnchorToHUDMaterialAnchorPos?l.anchor:"center"];a=f.isNone(m)?new y(a,e,this._textRenderParameters,t):null;z={occlusionTest:!0,screenOffset:l.screenOffset,anchorPos:z,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:l.centerOffsetUnits,debugDrawBorder:l.debugDrawBorder,drawInSecondSlot:!0};
f.isSome(a)&&(z.textureId=a.id,z.texCoordScale=a.texcoordScale);f.isSome(m)&&(z.textureId=m.textureId);if(f.isSome(g)&&f.isSome(g.verticalOffset)){g=g.verticalOffset;m=g.minWorldLength;var B=g.maxWorldLength;z.verticalOffset={screenLength:h.pt2px(g.screenLength),minWorldLength:m||0,maxWorldLength:null!=B?B:Infinity}}this._context.screenSizePerspectiveEnabled&&(g=this._context.sharedResources,m=g.screenSizePerspectiveSettings,z.screenSizePerspective=g.screenSizePerspectiveSettingsLabels.overridePadding(this._textRenderParameters.haloSize),
z.screenSizePerspectiveAlignment=m);v&&(z.shaderPolygonOffset=1E-4);z.slicePlaneEnabled=this._context.slicePlaneEnabled;v=null;f.isSome(k)?(g=JSON.stringify(z),v=k.getMaterial(g),null==v&&(v=new A(z,t),k.addMaterial(g,v))):v=new A(z,t);v=[v];z=this._geometryDataPool.acquire(l,a);z=[new x(z,t)];t=r.createStageObjectForHUD(this._context,b,z,v,null,null,n,t,this._context.layer.uid,w);if(null===t)return null;w=c.perObjectElevationAligner;k=new p(this,t.object,z,f.isNone(k)?v:null,f.isSome(a)?[a]:null,
w,n);k.alignedSampledElevation=t.sampledElevation;k.needsElevationUpdates=q.needsElevationUpdates2D(n.mode)||"absolute-height"===n.mode;var n=f.isSome(a)?a:l,C=n.displayWidth,F=n.displayHeight;k.getScreenSize=function(a){void 0===a&&(a=d.vec2f64.create());a[0]=C;a[1]=F;return a};k.metadata={labelText:e,elevationOffset:l.elevationOffset};r.extendPointGraphicElevationContext(k,b,this._context.elevationProvider);return k};return n}(t.default);b.Graphics3DTextSymbolLayer=n;var F={mode:"relative-to-ground",
offset:0},E={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};b.default=n})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("require exports ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",
{value:!0});n=function(){function b(b){this.definition=b;this.key=JSON.stringify(b);this.haloSize=Math.round(b.halo.size);this.fillStyle=this.colorToRGBA(b.color);this.haloStyle=this.colorToRGB(b.halo.color)}b.prototype.colorToRGB=function(b){return"rgb("+b.slice(0,3).map(function(b){return Math.floor(255*b)}).toString()+")"};b.prototype.colorToRGBA=function(b){return"rgba("+b.slice(0,3).map(function(b){return Math.floor(255*b)}).toString()+","+b[3]+")"};b.fromSymbol=function(f,h){void 0===h&&(h=
1);var d=k.get(f,"material","color"),d=k.isSome(d)?m.toUnitRGBA(d):e.ZEROS,a=f.halo,c=null!=f.size?g.pt2px(f.size):12;f={family:f.font&&f.font.family?f.font.family:"sans-serif",weight:f.font&&f.font.weight?f.font.weight:"normal",style:f.font&&f.font.style?f.font.style:"normal"};a=k.isSome(a)&&k.isSome(a.color)&&0<a.size?{size:g.pt2px(a.size),color:m.toUnitRGBA(a.color)}:{size:0,color:e.ZEROS};return new b({size:c,color:d,font:f,halo:a,pixelRatio:h})};return b}();b.TextRenderParameters=n;b.default=
n})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("require exports ../../../../core/Evented ../../../../core/mathUtils ../../../../core/maybe ./TextRenderer ./Texture ../../../webgl/Texture ../../../webgl/capabilities/isWebGL2Context".split(" "),function(n,b,m,k,g,e,f,l,h){var d={canvas:null};return function(){function a(a,b,d,f){this._idHint=f;this._glTexture=null;this.events=new m;this._requiresPowerOfTwo=!h.default(a.gl);this._renderer=new e.default(b,d)}Object.defineProperty(a.prototype,
"id",{get:function(){null==this._id&&(this._id=f.idGen.gen(this._idHint));return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._renderer.renderedWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._renderer.renderedHeight},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"textureWidth",{get:function(){var a=this.width;return this._requiresPowerOfTwo?k.nextHighestPowerOfTwo(a):
a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"textureHeight",{get:function(){var a=this.height;return this._requiresPowerOfTwo?k.nextHighestPowerOfTwo(a):a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"displayWidth",{get:function(){return this._renderer.displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"displayHeight",{get:function(){return this._renderer.displayHeight},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"texcoordScale",{get:function(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"requiresFrameUpdates",{get:function(){return!1},enumerable:!0,configurable:!0});a.prototype.createDescriptor=function(a){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:a.parameters.maxMaxAnisotropy}};a.prototype.load=
function(a){if(g.isSome(this._glTexture))return this._glTexture;var b=e.getTextHelperCanvas(d,this.textureWidth,this.textureHeight),c=b.getContext("2d");c.save();this._renderer.render(c,0,this.textureHeight-this._renderer.renderedHeight);this._glTexture=new l(a,this.createDescriptor(a),b);c.restore();return this._glTexture};a.prototype.unload=function(){g.isSome(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null);this.events.emit("unloaded")};return a}()})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["require",
"exports","../../../../core/maybe","./TextRenderParameters"],function(n,b,m,k){function g(a,b,d){a.canvas||(a.canvas=document.createElement("canvas"));a.canvas.width=b;a.canvas.height=d;return a.canvas}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a,b,d){void 0===d&&(d=2048);this.text=a;this.maxSize=d;this._displayWidth=this._renderPixelRatio=null;this.parameters=b instanceof k.default?b:new k.default(b);this.key=this.parameters.key+"--"+a;this.textLines=a.split(/\r?\n/);
this.lineHeight=this.computeLineHeight()}Object.defineProperty(a.prototype,"displayWidth",{get:function(){m.isNone(this._displayWidth)&&(this._displayWidth=this.computeTextWidth());return this._displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"displayHeight",{get:function(){return this.lineHeight*this.textLines.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderedWidth",{get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderedHeight",{get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderedLineHeight",{get:function(){return Math.round(this.lineHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderedFontSize",{get:function(){return this.parameters.definition.size*this.renderPixelRatio},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"renderedHaloSize",{get:function(){return this.parameters.haloSize*this.renderPixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderPixelRatio",{get:function(){if(m.isNone(this._renderPixelRatio)){var a=this.parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(a,Math.min(this.maxSize/(this.displayWidth*a),this.maxSize/(this.displayHeight*a))):a}return this._renderPixelRatio},enumerable:!0,configurable:!0});
a.prototype.render=function(a,b,d){void 0===b&&(b=0);void 0===d&&(d=0);var c=this.renderedLineHeight,f=this.renderedHaloSize,h=a.textAlign,g=this.renderedWidth,h=("center"===h?.5*g:"right"===h?g:0)+f,g=f+e;a.save();0<f&&this.renderHalo(a,h,g,b,d);this.setFontProperties(a,this.renderedFontSize);d+=g;b+=h;f=0;for(h=this.textLines;f<h.length;f++)g=h[f],a.globalCompositeOperation="destination-out",a.fillStyle="rgb(0, 0, 0)",a.fillText(g,b,d),a.globalCompositeOperation="source-over",a.fillStyle=this.parameters.fillStyle,
a.fillText(g,b,d),d+=c;a.restore()};a.prototype.renderHalo=function(a,b,e,f,l){var c=this.renderedWidth,k=this.renderedHeight,m=g(h,Math.max(c,d),Math.max(k,d)),p=m.getContext("2d");p.clearRect(0,0,c,k);this.setFontProperties(p,this.renderedFontSize);p.fillStyle=this.parameters.haloStyle;p.strokeStyle=this.parameters.haloStyle;var q=3>this.renderedHaloSize;p.lineJoin=q?"miter":"round";q?this.renderHaloEmulated(p,b,e):this.renderHaloNative(p,b,e);a.globalAlpha=this.parameters.definition.halo.color[3];
a.drawImage(m,0,0,c,k,f,l,c,k);a.globalAlpha=1};a.prototype.renderHaloEmulated=function(a,b,d){for(var c=this.renderedLineHeight,e=this.renderedHaloSize,h=0,g=this.textLines;h<g.length;h++){for(var l=g[h],k=0,m=f;k<m.length;k++){var p=m[k];a.fillText(l,b+e*p[0],d+e*p[1])}d+=c}};a.prototype.renderHaloNative=function(a,b,d){for(var c=this.renderedLineHeight,e=this.renderedHaloSize,f=0,h=this.textLines;f<h.length;f++){for(var g=h[f],l=2*e,k=0;5>k;k++)a.lineWidth=(.6+.1*k)*l,a.strokeText(g,b,d);d+=c}};
a.prototype.setFontProperties=function(a,b){var c=this.parameters.definition.font;a.font=c.style+" "+c.weight+" "+b+"px "+c.family+", sans-serif";a.textAlign="left";a.textBaseline="top"};a.prototype.computeTextWidth=function(){var a=g(h,d,d).getContext("2d");this.setFontProperties(a,this.parameters.definition.size);for(var b=0,e=0,f=this.textLines;e<f.length;e++)b=Math.max(b,a.measureText(f[e]).width);e=this.parameters.definition.font;if("italic"===e.style||"oblique"===e.style||"string"===typeof e.weight&&
("bold"===e.weight||"bolder"===e.weight)||"number"===typeof e.weight&&600<e.weight)b+=.3*a.measureText("A").width;b+=2*this.parameters.haloSize;return Math.round(b)};a.prototype.computeLineHeight=function(){return Math.ceil(1.275*this.parameters.definition.size+2*this.parameters.haloSize)+e};return a}();b.TextRenderer=n;for(var e=1,f=[],l=0;360>l;l+=22.5)f.push([Math.cos(Math.PI*l/180),Math.sin(Math.PI*l/180)]);b.getTextHelperCanvas=g;var h={canvas:null},d=512;b.default=n})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../core/maybe ../../../../core/unitUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/math/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function n(a,c,d,e){return b.call(this,a,c,d,e)||this}k(n,b);n.prototype.doLoad=function(){return e(this,void 0,void 0,function(){return g(this,function(a){return[2]})})};n.prototype.destroy=function(){b.prototype.destroy.call(this);l.isSome(this._material)&&(this._context.stage.remove(3,this._material.id),this._material=null)};n.prototype.createGraphics3DGraphic=function(a){a=
a.graphic;if(!this._validateGeometryType(a.geometry,n.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(a.geometry))return null;var b="graphic"+a.uid,c=this.getGraphicElevationContext(a);this.ensureDrapedStatus("on-the-ground"===c.mode);this.ensureMaterial();return this.draped?this._createAsOverlay(a,b):this._createAs3DShape(a,c,b,a.uid)};n.prototype.ensureMaterial=function(){if(!l.isSome(this._material)){var a=m({},G.defaultWaterMaterialParameters),b=this.symbolLayer.color;l.isSome(b)&&
(a.color=f.toUnitRGBA(b));b=this._getCombinedOpacity(b,{hasIntrinsicColor:!0});a.color=[a.color[0],a.color[1],a.color[2],b];a.transparent=1>b||this.needsDrivenTransparentPass;a.waveDirection=l.isSome(this.symbolLayer.waveDirection)?n.headingVectorFromAngle(this.symbolLayer.waveDirection):q.vec2f64.fromValues(0,0);b=G.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];a.waveStrength=b.waveStrength;a.waveTextureRepeat=b.textureRepeat;a.waveVelocity=b.waveVelocity;a.flowStrength=
b.perturbationStrength;a.slicePlaneEnabled=this._context.slicePlaneEnabled;a.isDraped=this.draped;this._material=new E.WaterMaterial(a,"water");this._context.stage.add(3,this._material)}};n.prototype.layerOpacityChanged=function(){if(l.isNone(this._material))return!0;var a=this._material.getParameters().color,b=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameterValues({color:[a[0],a[1],a[2],b],transparent:1>b||this.needsDrivenTransparentPass});return!0};
n.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;c=w.elevationModeChangeUpdateType(n.elevationModeChangeTypes,c,d);if(c!==w.SymbolUpdateType.UPDATE)return c;var e=w.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};n.prototype.slicePlaneEnabledChanged=function(){l.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};n.prototype.physicalBasedRenderingChanged=
function(){return!0};n.prototype.pixelRatioChanged=function(){return!0};n.prototype._createAs3DShape=function(a,b,c,d){a=A.geometryAsPolygon(a.geometry);if(l.isNone(a))return null;O.renderData=A.geometryToRenderInfo(a,this._context.elevationProvider,this._context.renderCoordsHelper,b);var e=O.renderData.position.length/3;O.uvCoords=new Float64Array(2*e);O.idHint=c;O.outNum=0;O.outGeometries=[];O.outTransforms=[];O.outMaterials=[];this._create3DShapeGeometries(O);this._logGeometryCreationWarnings(O.renderData,
a.rings,"rings","WaterSymbol3DLayer");if(0===O.outNum)return null;this._createUVCoordsFromVertices(O.uvCoords,O.renderData.mapPosition,e,this._context.elevationProvider.spatialReference);c=new C({geometries:O.outGeometries,materials:O.outMaterials,transformations:O.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:d},idHint:c});c=new z(this,c,O.outGeometries,null,null,x.perVertexElevationAligner,b);c.alignedSampledElevation=O.renderData.sampledElevation;c.needsElevationUpdates=
w.needsElevationUpdates2D(b.mode);return c};n.prototype._createUVCoordsFromVertices=function(a,b,d,e){e=h.getMetersPerUnitForSR(e);r.empty(D);for(var f=0;f<d;f++)c.vec2.set(I,b[3*f+0],b[3*f+1]),r.expandPointInPlace(D,I);p.vec4.scale(D,D,e);f=D[1]%n.unitSizeOfTexture;H[0]=D[0]-D[0]%n.unitSizeOfTexture;H[1]=D[1]-f;for(f=0;f<d;f++)a[2*f+0]=(b[3*f+0]*e-H[0])/n.unitSizeOfTexture,a[2*f+1]=(b[3*f+1]*e-H[1])/n.unitSizeOfTexture};n.prototype._create3DShapeGeometries=function(b){for(var c=b.uvCoords,e=0,f=
b.renderData.polygons;e<f.length;e++){var h=f[e],g=h.count,k=h.index,m=h.position,p=h.mapPosition,h=h.holeIndices;if(l.isSome(this._context.clippingExtent)&&(u.empty(L),u.expandWithBuffer(L,p),!u.intersectsClippingArea(L,this._context.clippingExtent)))continue;h=d.earcut(p,h,3);0!==h.length&&(h=new Uint32Array(h),g=new Float64Array(c.buffer,2*k*c.BYTES_PER_ELEMENT,2*g),m=A.createWaterGeometryData({indices:h,attributeData:{position:m,uv0:g,mapPosition:p}}),m=new B(m,b.idHint),b.outGeometries.push(m),
b.outMaterials.push(l.expect(this._material)),b.outTransforms.push(a.mat4f64.IDENTITY),b.outNum++)}};n.prototype._createAsOverlay=function(a,b){var c=A.geometryAsPolygon(a.geometry);if(l.isNone(c))return null;l.expect(this._material).renderPriority=this._renderPriority+this._renderPriorityDelta/2;K.renderData=A.geometryToRenderInfoDraped(c,this._context.overlaySR);K.idHint=b;b=K.renderData.position.length/3;K.uvCoords=new Float64Array(2*b);K.outNum=0;K.outGeometries=[];K.outBoundingBox=u.empty();
K.layerUid=this._context.layer.uid;K.graphicsUid=a.uid;this._createAsOverlayWater(K);this._logGeometryCreationWarnings(K.renderData,c.rings,"rings","WaterSymbol3DLayer");if(0===K.outNum)return null;this._createUVCoordsFromVertices(K.uvCoords,K.renderData.position,b,c.spatialReference);return 0<K.outNum?new v(this,K.outGeometries,K.outBoundingBox):null};n.prototype._createAsOverlayWater=function(a){for(var b=a.uvCoords,c=0,e=a.renderData.polygons;c<e.length;c++){var f=e[c],h=f.position,g=f.holeIndices,
k=f.index,f=f.count;u.empty(L);u.expandWithBuffer(L,h);u.intersectsClippingArea(L,this._context.clippingExtent)&&(u.expand(a.outBoundingBox,L),g=d.earcut(h,g,3),0!==g.length&&(g=new Uint32Array(g),k=new Float64Array(b.buffer,2*k*b.BYTES_PER_ELEMENT,2*f),h=A.createWaterGeometryData({indices:g,attributeData:{position:h,uv0:k}}),h=new F(h),h.data.layerUid=a.layerUid,h.data.graphicUid=a.graphicsUid,h.material=l.expect(this._material),k=L,h.center=[.5*(k[0]+k[3]),.5*(k[1]+k[4]),0],h.bsRadius=.5*Math.sqrt((k[3]-
k[0])*(k[3]-k[0])+(k[4]-k[1])*(k[4]-k[1])),a.outGeometries.push(h),a.outNum++))}};n.headingVectorFromAngle=function(a){var b=q.vec2f64.create();a=t.toRadian(a);b[0]=Math.sin(a);b[1]=Math.cos(a);return b};Object.defineProperty(n.prototype,"test",{get:function(){var a=this;return{create3DShape:function(b){return a._createAs3DShape(b.graphic,b.elevationContext,b.idHint,b.graphicUid)},ensureMaterial:function(){return a.ensureMaterial()}}},enumerable:!0,configurable:!0});n.validGeometryTypes=["polyline",
"polygon","extent"];n.unitSizeOfTexture=100;n.elevationModeChangeTypes={definedChanged:w.SymbolUpdateType.RECREATE,staysOnTheGround:w.SymbolUpdateType.NONE,onTheGroundChanged:w.SymbolUpdateType.RECREATE};return n}(y.default);b.Graphics3DWaterSymbolLayer=n;var H=q.vec2f64.create(),D=r.create(),I=q.vec2f64.create(),L=u.create(),O={idHint:null,renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},K={idHint:null,renderData:null,uvCoords:null,
outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};b.default=n})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../lib/AnimationTimer ../lib/Material ./WaterGLMaterial ./WaterTechnique ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/waterMaterialUtils ./renderers/MergedRenderer".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,
"__esModule",{value:!0});n=function(b){function e(c,e){e=b.call(this,e)||this;e.animation=new g.AnimationTimer;e.techniqueConfig=new l.WaterTechniqueConfiguration;e.params=d.copyParameters(c,a.defaultWaterMaterialParameters);return e}m(e,b);e.prototype.setParameterValues=function(a){this.params=k({},this.params,a);this.parametersChanged()};e.prototype.getParameters=function(){return this.params};e.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.writeDepth=
this.params.writeDepth;this.techniqueConfig.receiveShadows=this.params.receiveShadows;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;return this.techniqueConfig};e.prototype.update=function(a){this.animation.enabled=Math.sqrt(this.params.waveTextureRepeat/this.params.waveStrength)*Math.min(a.camera.relativeElevation,a.camera.distance)<q;this.animation.advance(a.dt);return this.animation.enabled};e.prototype.intersect=function(a,
b,c,e,f,h,g){d.intersectTriangleGeometry(a,b,e,f,h,void 0,g)};e.prototype.getGLMaterial=function(a){if(2===a.output)return new f.WaterGLMaterial(a);if(0===a.output)return this.params.isDraped&&(a.output=5),new f.WaterGLMaterial(a)};e.prototype.createBufferWriter=function(){return new h.DefaultBufferWriter(h.PositionUVLayout)};e.prototype.createRenderer=function(a,b){return new c(a,b,this)};return e}(e.Material);b.WaterMaterial=n;var q=35E3})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["require",
"exports","../../../../core/maybe","../../../../layers/support/timeUtils"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){void 0===b&&(b=!0);this.enabled=b;this._time=0}Object.defineProperty(b.prototype,"time",{get:function(){return m.isSome(this._forcedTime)?this._forcedTime:k.Milliseconds(this._time)},enumerable:!0,configurable:!0});b.prototype.advance=function(b){this.enabled&&(this._time+=b)};b.prototype.forceTime=function(b){this._forcedTime=b};
return b}();b.AnimationTimer=n})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./Loadable ./symbolComplexity".split(" "),function(n,b,m,k,g,e,f){return function(b){function e(d,a){var c=b.call(this)||this;c.symbol=d;c.convert=a;c.graphics3DSymbol=null;c.referenced=0;return c}m(e,b);e.prototype.getSymbolLayerSize=function(b){return this.graphics3DSymbol?
this.graphics3DSymbol.getSymbolLayerSize(b):null};e.prototype.doLoad=function(b){return g(this,void 0,void 0,function(){var a;return k(this,function(c){switch(c.label){case 0:return[4,this.symbol.fetchSymbol({signal:b})];case 1:return a=c.sent(),a.id=this.symbol.id,this.graphics3DSymbol=this.convert(a),[4,this.graphics3DSymbol.load()];case 2:return c.sent(),[2]}})})};e.prototype.createGraphics3DGraphic=function(b){return this.graphics3DSymbol.createGraphics3DGraphic(b,this)};Object.defineProperty(e.prototype,
"complexity",{get:function(){return this.graphics3DSymbol?this.graphics3DSymbol.complexity:f.emptySymbolComplexity},enumerable:!0,configurable:!0});e.prototype.globalPropertyChanged=function(b,a){return this.graphics3DSymbol.globalPropertyChanged(b,a)};e.prototype.applyRendererDiff=function(b,a){return this.graphics3DSymbol.applyRendererDiff(b,a)};e.prototype.prepareSymbolPatch=function(b){this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(b)};e.prototype.updateGeometry=function(b,a){return this.graphics3DSymbol?
this.graphics3DSymbol.updateGeometry(b,a):!1};e.prototype.onRemoveGraphic=function(){};e.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};e.prototype.destroy=function(){this.graphics3DSymbol&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;this.abortLoad()};Object.defineProperty(e.prototype,"destroyed",{get:function(){return void 0===this.graphics3DSymbol},enumerable:!0,configurable:!0});return e}(e.Loadable)})},
"esri/views/3d/layers/graphics/labelPlacement":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c){function q(b){return a.getGraphics3DSymbol(b.graphics3DGraphic.graphics3DSymbol).symbol.symbolLayers.getItemAt(0)}
function p(a,b){var c=b.graphics3DGraphic.graphic.geometry;if(g.isNone(c))return null;if(g.isSome(b.disablePlacement))return(c=b.labelClass.labelPlacement)?(v.warnOncePerTick(t(a.placement,b.disablePlacement.logEntityDescription)),u(b)):a;var d=c.type;switch(d){case "polyline":case "polygon":case "extent":case "multipoint":if(c=b.labelClass.labelPlacement)return v.warnOncePerTick(t(a.placement,"'"+d+"' geometries")),u(b);break;case "point":case "mesh":break;default:m.neverReached(d)}return a}function t(a,
b){return"the requested label placement '"+a+"' is currently unsupported for "+b+" in SceneView"}function u(a){var b=a.graphics3DGraphic.graphic.geometry;if(g.isNone(b))return null;b=b.type;switch(b){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return a=q(a),g.isSome(a)&&"extrude"===a.type?z["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};case "point":return z["above-center"];
case "mesh":return z["above-center"];default:m.neverReached(b)}}function r(a,b,c){c=c.graphics3DGraphic._graphics[0];c=g.isSome(c)?c.getBoundingBoxObjectSpace(F):F;c=l.vec3f64.fromValues(c[3]-c[0],c[4]-c[1],c[5]-c[2]);a.centerOffset[0]=1.1*Math.sqrt(c[0]*c[0]+c[1]*c[1])/2*b.normalizedOffset[0];var d=a.translation[2],e=c[2]/2*b.normalizedOffset[1];a.translation[2]=e*(1.1-1);a.elevationOffset=d+e;c=f.vec3.length(c);a.centerOffset[2]=1.1*c/2*b.normalizedOffset[2]}function x(b){var c=b.labelClass.labelPlacement,
d=b.labelSymbol,e=b.graphics3DGraphic,f=a.getGraphics3DSymbol(e.graphics3DSymbol).symbol;b=z[c]||u(b);if("point-3d"===f.type&&f.supportsCallout()&&f.hasVisibleVerticalOffset()&&!e.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:w(f.verticalOffset),anchor:null,normalizedOffset:null};if(d&&d.hasVisibleVerticalOffset()&&("point-3d"!==f.type||!f.supportsCallout()||!f.verticalOffset||e.isDraped)){a:switch(b.placement){case "above-center":e=!0;break a;default:e=!1}return e?{placement:"above-center",
verticalOffset:w(d.verticalOffset),anchor:"bottom",normalizedOffset:[0,b.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(v.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+c+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function w(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,maxWorldLength:a.maxWorldLength}}Object.defineProperty(b,
"__esModule",{value:!0});var v=k.getLogger("esri.views.3d.layers.graphics.labelPlacement");b.get=function(a){var b=x(a);if(g.isNone(b))return null;var f;if(b.anchor)f=b;else{f=a.labelClass.labelPlacement;var k=z[f],m=k||u(a);f&&!k&&v.warnOncePerTick("the requested label placement '"+f+"' is not currently supported in SceneView");f=p(m,a)}if(g.isNone(f))return null;k=!!b.hasLabelVerticalOffset;b={anchor:f.anchor,verticalOffset:b.verticalOffset,screenOffset:e.vec2f64.create(),centerOffset:h.vec4f64.fromValues(0,
0,0,-1),centerOffsetUnits:"world",translation:l.vec3f64.create(),elevationOffset:0,hasLabelVerticalOffset:k};k=a.graphics3DGraphic.graphic.geometry;if(g.isNone(k))a=null;else{switch(k.type){case "point":k=q(a);if(!g.isNone(k))switch(a.graphics3DGraphic.getCenterObjectSpace(b.translation),k.type){case "icon":case "text":m=a.graphics3DGraphic;k=m._graphics[0];k=g.isSome(k)?k.getScreenSize():null;!m.isDraped&&g.isSome(k)?(m=void 0,void 0===m&&(m=C),a=a.graphics3DGraphic._graphics[0],(a=g.isSome(a)?a.stageObject.geometryRecords[0].material:
null)&&a instanceof c?(a=a.getParameters().anchorPos,m[0]=2*(a[0]-.5),m[1]=2*(a[1]-.5)):(m[0]=0,m[1]=0),a=m,B[0]=k[0]/2*(f.normalizedOffset[0]-a[0]),B[1]=k[1]/2*(f.normalizedOffset[1]-a[1]),b.screenOffset[0]=B[0],b.hasLabelVerticalOffset?(b.centerOffset[1]=B[1],b.centerOffsetUnits="screen"):b.screenOffset[1]=B[1]):b.hasLabelVerticalOffset||"center"===b.anchor||(z[a.labelClass.labelPlacement]&&v.warnOncePerTick("the requested placement '"+f.placement+"' is currently unsupported for draped graphics"),
b.anchor="center");break;case "object":r(b,f,a)}break;case "polygon":k=q(a);if(!g.isNone(k))switch(k.type){case "extrude":k=a.graphics3DGraphic._graphics[0],g.isSome(k)&&k.getBoundingBoxObjectSpace(F),d.center(F,b.translation),b.translation[2]=d.height(F)/2,r(b,f,a)}break;case "mesh":r(b,f,a)}a=b}return a};var z={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",
normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",
normalizedOffset:[1,0,0],anchor:"left"}},y={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],
"center-right":["esriServerPointLabelPlacementCenterRight"]};n=function(a){var b=z[a];y[a].forEach(function(a){z[a]=b})};for(var A in y)n(A);Object.freeze&&(Object.freeze(z),Object.keys(z).forEach(function(a){Object.freeze(z[a]);Object.freeze(z[a].normalizedOffset)}));var B=[0,0],C=[0,0],F=d.create()})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["require","exports"],function(n,b){return function(){function b(b){this.materials={};this.stage=b}b.prototype.getMaterial=function(b){return this.materials[b]};
b.prototype.addMaterial=function(b,g){this.materials[b]=g;this.stage.add(3,g)};b.prototype.dispose=function(){for(var b in this.materials)this.stage.remove(3,this.materials[b].id);this.materials={}};return b}()})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators ./Texture ../../../support/Scheduler ../../../webgl/Texture".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function g(a){a=b.call(this,a)||this;a.events=new e;a.glTexture=null;a.dirty=!1;a.needsClear=!1;a.elementsToAddOrUpdate=new Map;a.elementsToRemove=new Map;a.elementsToRender=new Map;a.elements=new Map;a.stageObjects=new Map;return a}m(g,b);r=g;g.prototype.initialize=function(){this.id=a.idGen.gen(this.idHint);this.stage=this.view._stage;this.canvas=this.create2DCanvas();this.ctx=this.canvas.getContext("2d");
this.stage.add(4,this);var b=this.computeAtlasResolution(this.view.width,this.view.height);this.createAtlasRegion(b);this.update2DCanvasSize();this.resetAtlasCursor()};g.prototype.unload=function(){h.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);this.events.emit("unloaded")};Object.defineProperty(g.prototype,"width",{get:function(){return this.atlas.size.width},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"height",{get:function(){return this.atlas.size.height},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"requiresFrameUpdates",{get:function(){return!1},enumerable:!0,configurable:!0});g.prototype.createDescriptor=function(a){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:a.parameters.maxMaxAnisotropy}};g.prototype.load=function(a){var b=this;if(h.isSome(this.glTexture))return this.glTexture;this.glTexture=new q(a,this.createDescriptor(a),this.canvas);
this.frameWorker=this.view.resourceController.scheduler.registerTask(c.Task.TEXT_TEXTURE_ATLAS,function(a){return b.run(b.makeRunContext(a))},function(){return b.dirty});this.setDirty();return this.glTexture};g.prototype.dispose=function(){this.elementsToRender=this.elementsToRemove=this.elementsToAddOrUpdate=this.elements=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.glTexture&&(this.glTexture=null,this.stage.remove(4,this.id));this.canvas.width=0;this.canvas.height=
0;this.ctx=this.canvas=null};g.prototype.create2DCanvas=function(){var a=document.createElement("canvas");a.setAttribute("id","canvas2d");a.setAttribute("style","display:none");a.setAttribute("width",(512).toString());a.setAttribute("height",(512).toString());return a};g.prototype.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};g.prototype.createAtlasRegion=function(a){void 0===a&&
(a=512);this.atlas={size:{width:a,height:a},cursor:{x:0,y:0},lineHeight:0}};g.prototype.computeAtlasResolution=function(a,b){a=Math.max(a,b);a=l.nextHighestPowerOfTwo(a+256);return a=Math.min(a,4096)};g.prototype.resizeAtlas=function(a,b){b=b||a;var c=this.atlas;c.size.width=a;c.size.height=b;h.isSome(this.glTexture)&&this.glTexture.resize(a,b);this.update2DCanvasSize()};g.prototype.resetAtlasCursor=function(){var a=this.atlas;a.cursor.x=p;a.cursor.y=p+t;a.lineHeight=0;this.needsClear=!0};g.prototype.getAtlasUsage=
function(){var a=this.atlas;return(a.cursor.x+a.cursor.y*a.size.width)/(a.size.width*a.size.height)};g.prototype.getExpectedAtlasUsage=function(){var a=this.elementsToRemove.size,b=this.elementsToAddOrUpdate.size,c=this.elements.size;return this.getAtlasUsage()/c*(c+b-a)};g.prototype.addAtlasElement=function(a,b,c,d){var e=this.atlas,f=a.textRenderer,h=f.renderedWidth,g=f.renderedHeight,l=f.displayWidth,f=f.displayHeight;a.placement.offset.x=e.cursor.x;a.placement.offset.y=e.cursor.y;a.placement.size.width=
h;a.placement.size.height=g;a.placement.size.displayWidth=l;a.placement.size.displayHeight=f;a.placement.uvMinMax=[a.placement.offset.x/e.size.width,1-(a.placement.offset.y+g)/e.size.height,(a.placement.offset.x+h)/e.size.width,1-a.placement.offset.y/e.size.height];e.cursor.x+=c;e.lineHeight=Math.max(e.lineHeight,d);this.elements.set(b,a)};g.prototype.removeAtlasElement=function(a){if(a&&this.elements.has(a.textId)){var b=a.placement.offset,c=a.placement.size;this.ctx.clearRect(b.x,b.y,c.width,c.height);
this.elements.delete(a.textId)}};g.prototype.ensureStageObjects=function(a){var b=this.stageObjects.get(a);if(b)return b;b=new Set;this.stageObjects.set(a,b);return b};g.prototype.addStageObject=function(a,b){this.ensureStageObjects(a).add(b)};g.prototype.removeStageObject=function(a,b){(a=this.stageObjects.get(a))&&a.delete(b)&&(b.geometries[0].data.vertexAttributes.size.data=new Float32Array([0,0]),b.geometryVertexAttrsUpdated(0))};g.prototype.processAdditionRequest=function(a,b){var c=this.atlas,
d=a.textId,e=a.textRenderer.renderedWidth+p,f=a.textRenderer.renderedHeight+p+t;b=b.repackingEnabled;if(c.cursor.x+e<c.size.width&&c.cursor.y+f<c.size.height)this.addAtlasElement(a,d,e,f),this.elementsToRender.set(d,a),this.elementsToAddOrUpdate.delete(d);else if(c.cursor.y+f+c.lineHeight<c.size.height)c.cursor.x=p,c.cursor.y+=c.lineHeight,c.lineHeight=0,this.addAtlasElement(a,d,e,f),this.elementsToRender.set(d,a),this.elementsToAddOrUpdate.delete(d);else{a=this.getExpectedAtlasUsage();(d=.85<a&&
4096>c.size.width)&&this.resizeAtlas(2*c.size.width,2*c.size.height);if(!b||!d&&.95<a&&4096===c.size.width)return this.processRemovals(),0;this.repack();return 1}return 0};g.prototype.processRemovals=function(){var a=this;this.elementsToRemove.forEach(function(b,c){var d=a.stageObjects.get(c);d&&0!==d.size||a.removeAtlasElement(b);d&&0===d.size&&a.stageObjects.delete(c)});this.elementsToRemove.clear()};g.prototype.repack=function(){var a=this;this.processRemovals();this.elements.forEach(function(b,
c){b.rendered=!1;a.elementsToAddOrUpdate.set(c,b)});this.elements.clear();this.resetAtlasCursor();this.elementsToRender.clear()};g.prototype.processRenderingRequest=function(a){this.ctx.clearRect(a.placement.offset.x,a.placement.offset.y,a.placement.size.width,a.placement.size.height);a.textRenderer.render(this.ctx,a.placement.offset.x,a.placement.offset.y);var b=this.stageObjects.get(a.textId);b&&b.forEach(function(b){b.geometries[0].data.vertexAttributes.uv0.data=new Float32Array(a.placement.uvMinMax);
b.geometries[0].data.vertexAttributes.size.data=new Float32Array([a.placement.size.displayWidth,a.placement.size.displayHeight]);b.geometryVertexAttrsUpdated(0)});a.rendered=!0};g.prototype.run=function(a){var b=this;if(this.glTexture){var c=a.budget,d=!1;f.someMap(this.elementsToAddOrUpdate,function(c,e){return(c=b.elements.get(e))&&c.rendered?((c=b.stageObjects.get(e))&&c.forEach(function(a){var c=a.geometries[0].data.vertexAttributes,d=b.elements.get(e);c.uv0.data=new Float32Array(d.placement.uvMinMax);
c.size.data=new Float32Array([d.placement.size.displayWidth,d.placement.size.displayHeight]);a.geometryVertexAttrsUpdated(0)}),b.elementsToAddOrUpdate.delete(e),!1):1===b.processAdditionRequest(b.elementsToAddOrUpdate.get(e),a)?d=!0:!1});if(d)a.budget=null,a.repackingEnabled=!1,this.run(a);else{var e=!1;0<this.elementsToRender.size&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1);f.someMap(this.elementsToRender,function(a,d){b.processRenderingRequest(a);
b.elementsToRender.delete(d);e=!0;return c&&(c.madeProgress(),c.done)?!0:!1});e&&h.isSome(this.glTexture)&&this.glTexture.setData(this.canvas);this.dirty=0<this.elementsToRender.size;this.dirty||(r.test.orderedRepackingEnabled&&this.repackOrdered(),this.notifyChange("updating"))}}};g.prototype.makeRunContext=function(a){void 0===a&&(a=null);u.budget=a;u.repackingEnabled=!0;return u};g.prototype.addTextTexture=function(a,b){var c=a.key;this.elementsToAddOrUpdate.has(c)||this.elementsToAddOrUpdate.set(c,
{textId:c,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:a,rendered:!1});this.addStageObject(c,b);this.elementsToRemove.delete(c);this.setDirty()};g.prototype.removeTextTexture=function(a,b){a=a.key;this.elementsToRemove.set(a,this.elements.get(a));this.removeStageObject(a,b)};Object.defineProperty(g.prototype,"textureId",{get:function(){return this.id},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isDirty",{get:function(){return this.dirty},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){return this.dirty&&!!this.frameWorker},enumerable:!0,configurable:!0});g.prototype.setDirty=function(){this.dirty||(this.dirty=!0,this.notifyChange("updating"))};Object.defineProperty(g.prototype,"test",{get:function(){var a=this;return{elements:this.elements,stageObjects:this.stageObjects,elementsToRemove:this.elementsToRemove,atlas:this.atlas,resizeAtlas:function(b,c){return a.resizeAtlas(b,c)},run:function(b){return a.run(b)}}},
enumerable:!0,configurable:!0});g.prototype.repackOrdered=function(){if(0!==this.elements.size){var a=[];this.elements.forEach(function(b,c){return a.push({element:b,key:c})});for(var b=!0,c=0;c<a.length-1;c++)if(0<a[c].key.localeCompare(a[c+1].key)){b=!1;break}if(!b){a.sort(function(a,b){return a.key.localeCompare(b.key)});this.elements.clear();for(b=0;b<a.length;b++)c=a[b],this.elements.set(c.key,c.element);this.repack();this.setDirty()}}};var r;g.test={orderedRepackingEnabled:!1};k([d.property({constructOnly:!0})],
g.prototype,"idHint",void 0);k([d.property({constructOnly:!0})],g.prototype,"view",void 0);k([d.property({type:Boolean,readOnly:!0})],g.prototype,"updating",null);return g=r=k([d.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],g)}(d.declared(g));b.TextTextureAtlas=n;var p=2,t=2,u={budget:null,repackingEnabled:!0};b.default=n})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../core/Handles ../../../../core/handleUtils ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.gltfCache=new Map;this.wosrCache=new Map;this.evictHandles=new e}b.prototype.loadGLTF=function(b,c){return this.fromCache(this.gltfCache,"gltf:"+b,function(c){return a.load(new d.DefaultLoadingContext(c.streamDataRequester),b,c)},c)};b.prototype.loadWOSR=function(a,b){return this.fromCache(this.wosrCache,"wosr:"+a+":"+b.disableTextures,function(b){return c.load(a,b)},b)};b.prototype.destroy=
function(){this.evictHandles.destroy();this.gltfCache.clear();this.wosrCache.clear()};Object.defineProperty(b.prototype,"size",{get:function(){return this.wosrCache.size+this.gltfCache.size},enumerable:!0,configurable:!0});b.prototype.fromCache=function(a,b,c,d){var e=this;return h.create(function(f,k){if(h.isAborted(d))k(h.createAbortError());else{var m=h.onAbort(d,function(){e.remove(a,b);k(h.createAbortError())}),p=a.get(b);if(p)e.evictHandles.remove(b),p.refCount++,p.item.then(f,k);else{var p=
h.createAbortController(),r=g({},d,{signal:p.signal}),q={refCount:1,abortController:p,item:c(r).then(function(c){q.abortController=null;c.remove=function(){return e.remove(a,b)};return c})};a.set(b,q);q.item.then(function(a){l.isSome(m)&&m.remove();f(a)},function(a){l.isSome(m)&&m.remove();k(a)})}}})};b.prototype.remove=function(a,b){var c=a.get(b);c&&(c.refCount--,0===c.refCount&&this.evictHandles.add(f.timeoutHandle(function(){a.delete(b);l.isSome(c.abortController)&&c.abortController.abort()},
q),b))};return b}();b.ObjectResourceCache=n;var q=1E4;b.test={overrideEvictDelay:function(a){q=a;return{remove:function(){q=1E4}}}}})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/projectionUtils ../../../support/Scheduler".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u){Object.defineProperty(b,"__esModule",{value:!0});var r=l.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");n=function(b){function g(a){a=b.call(this,a)||this;a.tiles=new e;a.tileSize=512;a._idToTile=new Map;a._handles=new f;a._clients=new Set;a._dirty=!1;a._newTiles=new h;return a}m(g,b);Object.defineProperty(g.prototype,"tilingScheme",{get:function(){var a=this.tilingSchemeOwner.tilingScheme;return a?a.clone():null},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"filterExtent",{set:function(a){if(a&&!a.spatialReference.equals(this.viewState.spatialReference))r.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this._setDirty())}},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"filterExtentRect",{get:function(){if(!this.filterExtent||!this.tilingScheme)return null;
var a=c.create();t.extentToBoundingRect(this.filterExtent,a,this.tilingScheme.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"rootTileIds",{get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"suspended",{set:function(a){a!==this._get("suspended")&&(this._set("suspended",a),this._setDirty())},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"updating",{get:function(){return this._dirty||!!this._pendingTiles},enumerable:!0,configurable:!0});g.prototype.initialize=function(){var a=this;this._handles.add(this.watch(["tilingScheme","tileSize"],function(){return a._reset()},!0));this._handles.add(d.init(this,["tileSize","cameraOnSurface.location","tilingScheme","viewState.camera","focus.locationOnSurface"],function(){return a._setDirty()},!0));this.scheduler&&(this._frameWorker=this.scheduler.registerTask(u.Task.FEATURE_TILE_TREE,
function(b){return a._update(b)},function(){return a.updating}))};g.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this._handles&&(this._handles.destroy(),this._handles=null)};g.prototype.addClient=function(){var a=this,b=x++;this._clients.add(b);1===this._clients.size&&this._setDirty();return{remove:function(){return a._removeClient(b)}}};g.prototype._removeClient=function(a){this._clients.delete(a);this._hasClients||this._clear()};Object.defineProperty(g.prototype,
"_hasClients",{get:function(){return 0<this._clients.size},enumerable:!0,configurable:!0});g.prototype._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this._update(u.noBudget))};g.prototype._clear=function(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};g.prototype._update=function(a){this._dirty=!1;this._pendingTiles||(this._startUpdate(),this._frameWorker&&
(this._frameWorker.task=u.Task.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(a);!this._pendingTiles&&this._frameWorker&&(this._frameWorker.task=u.Task.FEATURE_TILE_TREE);this.notifyChange("updating")};g.prototype._startUpdate=function(){if(!this.suspended)if(this.tilingScheme){this._tileMeasurements||(this._tileMeasurements=new p.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:v}));var a=this.cameraOnSurface.location;
this._tileMeasurements.begin(this.viewState.camera,this.focus?this.focus.locationOnSurface:a,a.z);this._pendingTiles=this._getRootTiles()}else this._clear()};g.prototype._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};g.prototype._getRootTiles=function(){var a=this;return this.rootTileIds.map(function(b){return new q.FeatureTileDescriptor3D(b[0],b[1],b[2],a.tilingScheme)})};g.prototype._purgeHorizonTiles=function(a){a.sort(function(a,b){a=
a.measures.screenRect;b=b.measures.screenRect;return a[1]+a[3]-(b[1]+b[3])});c.empty(w);for(var b=0;b<a.length;b++)if(c.expand(w,a.data[b].measures.screenRect),c.height(w)>v)return a.data.slice(b,a.length);return[]};g.prototype._subdivideTilesForView=function(a){var b;if(this._pendingTiles){for(;0<this._pendingTiles.length&&!a.done;){var d=this._pendingTiles.pop();a.madeProgress();if(!this.filterExtentRect||c.intersects(this.filterExtentRect,d.extent))this._tileMeasurements.updateTile(d),0!==d.measures.visibility&&
(d.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(d.lij[0]+1),(b=this._pendingTiles).push.apply(b,d.getChildren())):this._newTiles.push(d))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};g.prototype._updateTiles=function(a){for(var b=this,c=0,d=this.tiles.items;c<d.length;c++)d[c].used=!1;a=a.filter(function(a){var c=b._idToTile.get(a.id);c?(c.copyMeasurementsFrom(a),c.used=
!0):b._idToTile.set(a.id,a);return!c});c=this.tiles.items.filter(function(a){return a.used?!1:(b._idToTile.delete(a.id),!0)});this.tiles.removeMany(c);this.tiles.addMany(a);this.sortTiles()};g.prototype.sortTiles=function(){this.tiles.sort(function(a,b){return a.measures.visibility!==b.measures.visibility?2===a.measures.visibility?-1:1:a.measures.distance-b.measures.distance});this.tiles.forEach(function(a,b){return a.loadPriority=b})};k([a.property({constructOnly:!0})],g.prototype,"scheduler",void 0);
k([a.property({constructOnly:!0})],g.prototype,"renderCoordsHelper",void 0);k([a.property({constructOnly:!0})],g.prototype,"tilingSchemeOwner",void 0);k([a.property({constructOnly:!0})],g.prototype,"cameraOnSurface",void 0);k([a.property({constructOnly:!0})],g.prototype,"focus",void 0);k([a.property({constructOnly:!0})],g.prototype,"viewState",void 0);k([a.property()],g.prototype,"tiles",void 0);k([a.property()],g.prototype,"tileSize",void 0);k([a.property({readOnly:!0,dependsOn:["tilingSchemeOwner.tilingScheme"]})],
g.prototype,"tilingScheme",null);k([a.property()],g.prototype,"filterExtent",null);k([a.property({readOnly:!0,dependsOn:["filterExtent","tilingScheme"]})],g.prototype,"filterExtentRect",null);k([a.property({readOnly:!0,dependsOn:["filterExtentRect"]})],g.prototype,"rootTileIds",null);k([a.property({value:!1})],g.prototype,"suspended",null);k([a.property({readOnly:!0})],g.prototype,"updating",null);return g=k([a.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],g)}(a.declared(g));b.FeatureTileTree3D=
n;var x=0,w=c.create(),v=10;b.default=n})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["require","exports","../../../../geometry/support/aaBoundingRect"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e,f,l){void 0===l&&(l=null);this.lij=[0,0,0];this.extent=m.create();this.loadPriority=this.resolution=0;this.measures={visibility:2,screenRect:m.create(),distance:0,shouldSplit:!1};this.used=!1;l&&this.acquire(b,e,f,l)}b.prototype.acquire=
function(g,e,f,l){this.tilingScheme=l;this.id=b.id(g,e,f);this.lij[0]=g;this.lij[1]=e;this.lij[2]=f;l.getExtent(g,e,f,this.extent);this.resolution=l.resolutionAtLevel(g)};b.prototype.release=function(){this.tilingScheme=null};b.prototype.getChildren=function(g){var e=this.lij[0]+1,f=2*this.lij[1],l=2*this.lij[2];if(!g)return[new b(e,f,l,this.tilingScheme),new b(e,f+1,l,this.tilingScheme),new b(e,f,l+1,this.tilingScheme),new b(e,f+1,l+1,this.tilingScheme)];g[0].acquire(e,f,l,this.tilingScheme);g[1].acquire(e,
f+1,l,this.tilingScheme);g[2].acquire(e,f,l+1,this.tilingScheme);g[3].acquire(e,f+1,l+1,this.tilingScheme);return g};b.prototype.copyMeasurementsFrom=function(b){this.measures.visibility=b.measures.visibility;this.measures.shouldSplit=b.measures.shouldSplit;this.measures.distance=b.measures.distance;m.set(b.measures.screenRect,this.measures.screenRect)};b.id=function(b,e,f){return b+"/"+e+"/"+f};return b}();b.FeatureTileDescriptor3D=n;b.default=n})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("require exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ./FeatureTileVisibility3D ../../support/geometryUtils ../../webgl-engine/lib/Camera".split(" "),
function(n,b,m,k,g,e,f,l,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.camera=new h.default;this.pointOfInterestInMap=[0,0];this.screenRect=e.create();this.tileSize=a.tileSize;this.maxVerticalScreenSize=a.maxVerticalScreenSize;this.renderCoordsHelper=a.renderCoordsHelper;this.tilingScheme=a.tilingScheme;this.visibility=new f.FeatureTileVisibility3D({renderCoordsHelper:a.renderCoordsHelper})}b.prototype.begin=function(a,b,c){this.camera.copyFrom(a);this.z=c;this.pointOfInterestInMap[0]=
b.x;this.pointOfInterestInMap[1]=b.y;e.fromValues(0,0,a.fullWidth,a.fullHeight,this.screenRect);this.visibility.begin(this.camera,c)};b.prototype.end=function(){this.visibility.end()};b.prototype.updateTile=function(a){a.measures.visibility=this.visibility.calculate(a);0!==a.measures.visibility&&this.updateScreenMeasure(a);this.updateDistanceMeasure(a)};b.prototype.updateDistanceMeasure=function(a){a.measures.distance=e.distance(a.extent,this.pointOfInterestInMap)};b.prototype.updateScreenMeasure=
function(a){var b=c,d=1<<b,f=a.measures.screenRect;e.empty(f);for(var h=0,g=a.lij[0]+b,l=a.lij[1]<<b,b=a.lij[2]<<b,k=this.tileSizeWithBias(a),k=k*k,m=!1,p=0;p<d;p++){for(var r=0;r<d&&!(m=this.computeScreenArea(a,g,l+p,b+r,f),h+=m.area,m=h>k&&e.height(f)>this.maxVerticalScreenSize);r++);if(m)break}a.measures.shouldSplit=h>k};b.prototype.tileSizeWithBias=function(a){return 1===a.measures.visibility?this.tileSize*q:this.tileSize};b.prototype.computeScreenArea=function(b,c,f,h,g){var k=p.points;this.projectToScreen(c,
f,h,1===b.measures.visibility,k);e.empty(d);for(b=0;4>b;b++)e.expandPointInPlace(d,k[b]);e.expand(g,d);e.intersection(d,this.screenRect,a);p.screenOverlap=e.area(a)/e.area(d);p.area=l.triangle.areaPoints2d(k[0],k[1],k[2])+l.triangle.areaPoints2d(k[0],k[2],k[3]);return p};b.prototype.projectToScreen=function(a,b,c,d,e){this.tilingScheme.ensureMaxLod(a);this.tilingScheme.getExtent(a,b,c,t);this.toRenderCoords(t,0,3,r[0]);this.toRenderCoords(t,2,3,r[1]);this.toRenderCoords(t,2,1,r[2]);this.toRenderCoords(t,
0,1,r[3]);d&&(this.projectToPlane(r,this.camera.frustum.planes[4]),this.projectToPlane(r,this.camera.frustum.planes[3]),this.projectToPlane(r,this.camera.frustum.planes[2]));for(a=0;4>a;a++)this.camera.projectPoint(r[a],w),this.camera.renderToScreen(w,e[a])};b.prototype.projectToPlane=function(a,b){for(var c=0;4>c;c++)x[c]=l.plane.signedDistance(b,a[c]);c=Math.max(x[0],x[1],x[2],x[3]);if(0<c)for(b=k.vec3.scale(u,b,-c),c=0;4>c;c++)k.vec3.add(a[c],a[c],b)};b.prototype.toRenderCoords=function(a,b,c,
d){u[0]=a[b];u[1]=a[c];u[2]=this.z;this.renderCoordsHelper.toRenderCoords(u,this.tilingScheme.spatialReference,d);return d};return b}();b.FeatureTileMeasurements3D=n;var d=e.create(),a=e.create(),c=2,q=5,p={points:[m.createScreenPointArray(),m.createScreenPointArray(),m.createScreenPointArray(),m.createScreenPointArray()],area:0,screenOverlap:0},t=e.create(),u=g.vec3f64.create(),r=[g.vec3f64.create(),g.vec3f64.create(),g.vec3f64.create(),g.vec3f64.create()],x=[0,0,0,0],w=m.createRenderScreenPointArray3();
b.default=n})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("require exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection ../../support/geometryUtils".split(" "),function(n,b,m,k,g,e,f,l,h,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a){this.surfaceElevation=0;this.cache=
new Map;a=a.renderCoordsHelper;this.frustum=new l.Frustum({renderCoordsHelper:a});this.extendedFrustum=new l.Frustum({renderCoordsHelper:a});this.intersector=new h.FrustumExtentIntersection({renderCoordsHelper:a});this.renderCoordsHelper=a}b.prototype.begin=function(a,b){this.surfaceElevation=b;this.aboveGround=this.renderCoordsHelper.getAltitude(a.eye)>b;this.frustum.update(a);this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(a,b)};b.prototype.end=function(){this.cache.clear()};
b.prototype.calculate=function(b){if(this.allTilesInvisible)return 0;var d="global"===this.renderCoordsHelper.type&&b.lij[0]>=a&&b.lij[0]<c,e=this.getOrCalculateSingleTileVisibility(b,!d);return 0!==e&&d?this.calculateAggregatedChildrenVisibility(b):e};b.prototype.shortenFrustumFarPlane=function(a){for(var b=a.mutablePoints,c=0,d=l.Frustum.nearFarLineIndices;c<d.length;c++){var e=d[c],f=e[1],e=b[e[0]];g.vec3.subtract(t,b[f],e);g.vec3.scale(t,t,p);g.vec3.add(b[f],e,t)}a.updatePoints(b)};b.prototype.calculateAggregatedChildrenVisibility=
function(a){var b=0,c=this.cache.get(a.id);if(null!=c)return c;c=x.acquire();a.getChildren(c);for(var d=0;d<c.length;d++){var e=this.calculate(c[d]);if(0!==e&&(b=e,2===e))break}x.release(c);this.cache.set(a.id,b);return b};b.prototype.getOrCalculateSingleTileVisibility=function(a,b){var c=this.cache.get(a.id);if(null!=c)return c;c=this.calculateSingleTileVisibility(a);b&&this.cache.set(a.id,c);return c};b.prototype.calculateSingleTileVisibility=function(a){if(!this.aboveGround&&"global"===this.renderCoordsHelper.type&&
a.lij[0]<q){if(0===this.calculateSingleTileVisibilitySided(a,!1))return this.calculateSingleTileVisibilitySided(a,!0)}else return this.calculateSingleTileVisibilitySided(a,this.aboveGround)};b.prototype.calculateSingleTileVisibilitySided=function(a,b){this.intersector.update(a.extent,a.tilingScheme.spatialReference,this.surfaceElevation,b);return this.intersector.isVisibleInFrustum(this.extendedFrustum)?this.intersector.isVisibleInFrustum(this.frustum,!0)?2:1:0};b.prototype.updateExtendedFrustum=
function(a,b){var c=this.renderCoordsHelper;this.extendedFrustum.update(a);this.shortenFrustumFarPlane(this.extendedFrustum);var e=this.renderCoordsHelper.worldUpAtPosition(a.eye,t);this.aboveGround||g.vec3.negate(e,e);e=m.acosClamped(-g.vec3.dot(e,a.viewForward));this.allTilesInvisible=e>(Math.PI+a.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=e>a.fovY/2)){a=this.extendedFrustumParameters(b);b=this.extendedFrustum.mutablePoints;for(e=0;4>e;e++){var f=a.pointIndices[e],h=b[f],l=c.getAltitude(h);
if(a.needsAltitudeAdjustment(l)){this.renderCoordsHelper.worldUpAtPosition(h,t);switch(f){case 4:case 7:case 0:case 3:d.plane.projectVector(this.extendedFrustum.planes[0],t,t);break;case 5:case 6:case 1:case 2:d.plane.projectVector(this.extendedFrustum.planes[1],t,t)}g.vec3.scale(t,t,a.direction);this.renderCoordsHelper.intersectInfiniteManifold(d.ray.wrap(h,t),a.zWithMargin,h)}}this.extendedFrustum.updatePoints(b);d.plane.fromPoints(b[0],b[1],b[2],u);d.plane.fromPoints(b[1],b[2],b[3],r);0>g.vec3.dot(u,
r)&&(c=this.extendedFrustum.mutablePoints,this.aboveGround?(a=[c[1],c[0]],c[0]=a[0],c[1]=a[1]):(a=[c[2],c[3]],c[3]=a[0],c[2]=a[1]),this.extendedFrustum.updatePoints(c))}};b.prototype.extendedFrustumParameters=function(a){return this.aboveGround?this.extendedFrustumParametersAboveSurface(a,1):this.extendedFrustumParametersBelowSurface(a,1)};b.prototype.extendedFrustumParametersAboveSurface=function(a,b){var c=a-b;return{zWithMargin:c,pointIndices:l.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:function(a){return a>
c}}};b.prototype.extendedFrustumParametersBelowSurface=function(a,b){var c=a+b;return{zWithMargin:c,pointIndices:l.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment:function(a){return a<c}}};return b}();b.FeatureTileVisibility3D=n;var a=2,c=6,q=12,p=.95,t=e.vec3f64.create(),u=d.plane.create(),r=d.plane.create(),x=new k(Array,function(a){4!==a.length&&(a[0]=new f.FeatureTileDescriptor3D,a[1]=new f.FeatureTileDescriptor3D,a[2]=new f.FeatureTileDescriptor3D,a[3]=new f.FeatureTileDescriptor3D)},
function(a){a[0].release();a[1].release();a[2].release();a[3].release()});b.default=n})},"esri/views/3d/state/Frustum":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/mathUtils ../support/geometryUtils/frustum".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.frustum=e.create();this.lines=Array(12);this.origin=k.vec3f64.create();this.direction=k.vec3f64.create();
this._altitude=null;this.renderCoordsHelper=b?b.renderCoordsHelper:null;for(b=0;12>b;b++)this.lines[b]={origin:null,direction:k.vec3f64.create(),endpoint:null}}Object.defineProperty(b.prototype,"planes",{get:function(){return this.frustum.planes},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"points",{get:function(){return this.frustum.points},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"mutablePoints",{get:function(){return this.frustum.points},enumerable:!0,
configurable:!0});b.prototype.update=function(b){e.fromMatrix(b.viewMatrix,b.projectionMatrix,this.frustum);m.vec3.copy(this.origin,b.eye);m.vec3.copy(this.direction,b.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this.origin);this.updateLines()};b.prototype.updatePoints=function(b){for(var f=0;f<this.frustum.points.length;f++)m.vec3.copy(this.frustum.points[f],b[f]);e.recomputePlanes(this.frustum);this.updateLines()};Object.defineProperty(b.prototype,"altitude",{get:function(){return this._altitude},
enumerable:!0,configurable:!0});b.prototype.intersectsSphere=function(b){return e.intersectsSphere(this.frustum.planes,b)};b.prototype.intersectsRay=function(b){return e.intersectsRay(this.frustum.planes,b)};b.prototype.intersectsLineSegment=function(b,f){return e.intersectsLineSegment(this.frustum.planes,b,f)};b.prototype.intersectsPoint=function(b){return e.intersectsPoint(this.frustum.planes,b)};b.prototype.updateLines=function(){for(var b=this.frustum.points,e=0;4>e;e++){var d=e,a=e+4;this.updateLine(this.lines[e],
b[d],b[a]);this.updateLine(this.lines[e+4],b[d],3===e?b[0]:b[d+1]);this.updateLine(this.lines[e+8],b[a],3===e?b[4]:b[a+1])}};b.prototype.updateLine=function(b,e,d){b.origin=e;b.endpoint=d;g.directionFromTo(b.direction,e,d)};b.planePointIndices=e.planePointIndices;b.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];return b}();b.Frustum=n;b.default=n})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("require exports ../../../core/compilerUtils ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./earthUtils ./geometryUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t){Object.defineProperty(b,"__esModule",{value:!0});n=.5*Math.PI;var u=n/Math.PI*180,r=n*a.earthRadius,x=.9*a.earthRadius;a=function(){function a(a){this.renderCoordsHelper=a.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:l.vec3f64.create(),direction:l.vec3f64.create()};for(a=0;4>a;a++)this.extent[a]={origin:l.vec3f64.create(),direction:l.vec3f64.create(),cap:{next:null,direction:l.vec3f64.create()}},this.planes[a]=
c.plane.create();this.planes[4]=c.plane.create();this.planes[5]=c.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}a.prototype.update=function(a,b,d,e){void 0===e&&(e=!0);var h=this.extent;this.toRenderBoundingExtent(a,b,d);f.vec3.add(this.center.origin,h[0].origin,h[2].origin);f.vec3.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);e||f.vec3.scale(this.center.direction,this.center.direction,-1);for(d=0;4>
d;d++){var g=h[d];this.renderCoordsHelper.worldUpAtPosition(g.origin,g.direction);var l=h[3===d?0:d+1];g.cap.next=l.origin;p.directionFromTo(g.cap.direction,g.origin,l.origin);c.plane.fromVectorsAndPoint(g.direction,g.cap.direction,g.origin,this.planes[d]);e||f.vec3.scale(g.direction,g.direction,-1)}c.plane.fromVectorsAndPoint(h[0].cap.direction,h[1].cap.direction,h[0].origin,this.planes[4]);e?c.plane.negate(this.planes[4],this.planes[5]):(c.plane.copy(this.planes[4],this.planes[5]),c.plane.negate(this.planes[4],
this.planes[4]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]));this.maxSpanSpatialReference=b};a.prototype.isVisibleInFrustum=function(a,b){void 0===b&&(b=!1);if(null==a)return!1;if("global"===this.renderCoordsHelper.type){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?u:r))return!0;if(a.altitude>=x)return this.isVisibleInFrustumGlobal(a)}if(0===this.maxSpan){var d=this.extent[0];return!b&&a.intersectsRay(c.ray.wrap(d.origin,d.direction))?!0:!1}for(var e=0;e<this.extent.length;e++)if(d=
this.extent[e],!b&&a.intersectsRay(c.ray.wrap(d.origin,d.direction))||a.intersectsLineSegment(c.lineSegment.fromPoints(d.origin,d.cap.next,B),d.cap.direction))return!0;b=b?this.planes:this.planesWithoutFar;for(e=0;e<a.lines.length;e++)if(d=a.lines[e],q.frustumLineSegment(b,d.origin,d.endpoint,d.direction))return!0;return!1};a.prototype.toRenderBoundingExtentGlobal=function(a,b,c){d.center(a,v);v[2]=c;t.computeLinearTransformation(b,v,z,this.renderCoordsHelper.spatialReference);g.mat4.invert(y,z);
h.empty(A);for(var e=0,l=w;e<l.length;e++)for(var m=l[e],p=m.x0,r=m.x1,q=m.y0,m=m.y1,n=0;5>n;n++){var u=n/4;v[0]=k.lerp(a[p],a[r],u);v[1]=k.lerp(a[q],a[m],u);v[2]=c;t.vectorToVector(v,b,v,this.renderCoordsHelper.spatialReference);f.vec3.transformMat4(v,v,y);h.expandPointInPlace(A,v)}f.vec3.set(this.extent[0].origin,A[0],A[1],A[2]);f.vec3.set(this.extent[1].origin,A[3],A[1],A[2]);f.vec3.set(this.extent[2].origin,A[3],A[4],A[2]);f.vec3.set(this.extent[3].origin,A[0],A[4],A[2]);for(n=0;4>n;++n)f.vec3.transformMat4(this.extent[n].origin,
this.extent[n].origin,z)};a.prototype.toRenderBoundingExtentLocal=function(a,b){f.vec3.set(this.extent[0].origin,a[0],a[1],b);f.vec3.set(this.extent[1].origin,a[2],a[1],b);f.vec3.set(this.extent[2].origin,a[2],a[3],b);f.vec3.set(this.extent[3].origin,a[0],a[3],b)};a.prototype.toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.type){case "global":this.toRenderBoundingExtentGlobal(a,b,c);break;case "local":this.toRenderBoundingExtentLocal(a,c);break;default:m.neverReached(this.renderCoordsHelper.type)}};
a.prototype.isVisibleInFrustumGlobal=function(a){if(0>f.vec3.dot(this.center.direction,a.direction))return!0;for(var b=0;4>b;b++)if(0>f.vec3.dot(this.extent[b].direction,a.direction))return!0;return!1};return a}();b.FrustumExtentIntersection=a;var w=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],v=l.vec3f64.create(),z=e.mat4f64.create(),y=e.mat4f64.create(),A=h.create(),B=c.lineSegment.create();b.default=a})},"esri/views/3d/state/ViewState":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3f64 ../../ViewAnimation ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/earthUtils ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function g(a){a=b.call(this,a)||this;a.propertiesPool=new t.default({camera:u.default},a);a.lastSeenCameraProjectionValues=new u.default;a.events=new e;a.updateQueue=[];a.processingUpdates=!1;return a}m(g,b);g.prototype.destroy=function(){this.cameraController=null;this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};g.prototype.normalizeCtorArgs=function(b){return{camera:this.createInitialCamera(b.viewingMode),
mode:b.viewingMode,spatialReference:b.spatialReference,constraints:new a.default({mode:b.viewingMode})}};Object.defineProperty(g.prototype,"animation",{get:function(){return this.cameraController instanceof c.AnimationController&&f.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){a!==r&&r.copyFrom(a);r.markViewDirty();r.computeUp(this.mode);
x.camera=r;this.events.emit("before-camera-change",x);a=this._get("camera");this.cameraProjectionChanged(this.lastSeenCameraProjectionValues,r)&&(this.lastSeenCameraProjectionValues.copyFrom(r),w.camera=this.lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",w));a&&a.equals(r)||this._set("camera",this.propertiesPool.get("camera").copyFrom(r))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"isLocal",{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"navigating",{get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(a){var b=this;this.stopActiveCameraController()?(a&&(a.watch("state",function(c){if(c===q.State.Finished||
c===q.State.Stopped)b._set("cameraController",null),b.updateCamera(function(b){return a.onControllerEnd(b)})},!0),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=q.State.Rejected)},enumerable:!0,configurable:!0});g.prototype.switchCameraController=function(a){this.cameraController=a;return a.state!==q.State.Rejected};g.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};g.prototype.cameraChanged=
function(){this.updateCamera(function(){})};g.prototype.updateCamera=function(a){this.updateQueue.push(a);this.processUpdateQueue()};g.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.shift();r.copyFrom(this._get("camera"));a(r);this.camera=r;this.processingUpdates=!1;this.processUpdateQueue()}};g.prototype.createInitialCamera=function(a){return"global"===a?new u.default(h.vec3f64.fromValues(4*p.earthRadius,
0,0),h.vec3f64.fromValues(p.earthRadius,0,0),h.vec3f64.fromValues(0,0,1)):new u.default(h.vec3f64.fromValues(0,0,100),h.vec3f64.fromValues(0,0,0),h.vec3f64.fromValues(0,1,0))};g.prototype.cameraProjectionChanged=function(a,b){return a.fov!==b.fov||a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||a.fullViewport[2]!==b.fullViewport[2]||a.fullViewport[3]!==b.fullViewport[3]||a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||a.padding[2]!==b.padding[2]||a.padding[3]!==
b.padding[3]?!0:!1};k([l.property({readOnly:!0,type:d,dependsOn:["cameraController"]})],g.prototype,"animation",null);k([l.property({type:u.default})],g.prototype,"camera",null);k([l.property({constructOnly:!0})],g.prototype,"constraints",void 0);k([l.property({readOnly:!0})],g.prototype,"events",void 0);k([l.property({readOnly:!0,dependsOn:["isLocal"]})],g.prototype,"isGlobal",null);k([l.property({readOnly:!0,dependsOn:["mode"]})],g.prototype,"isLocal",null);k([l.property({constructOnly:!0})],g.prototype,
"mode",void 0);k([l.property({constructOnly:!0})],g.prototype,"spatialReference",void 0);k([l.property({readOnly:!0,dependsOn:["cameraController"]})],g.prototype,"navigating",null);k([l.property()],g.prototype,"cameraController",null);return g=k([l.subclass("esri.views.3d.state.ViewState")],g)}(l.declared(g));b.ViewState=n;var r=new u.default,x={camera:null},w={camera:null};b.default=n})},"esri/views/3d/support/PropertiesPool":function(){define(["require","exports","../../../core/ReentrantObjectPool",
"../../../core/accessorSupport/watch"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,f){var e=this;this.owner=f;this.properties={};this.afterDispatchHandle=null;for(var h in b)f=new m.ReentrantObjectPool(b[h],null,null,2,2),this.properties[h]={pool:f,acquired:[]};this.afterDispatchHandle=k.afterDispatch(function(){return e.release()})}b.prototype.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=
null);for(var b in this.properties){for(var f=this.properties[b],g=0,h=f.acquired;g<h.length;g++){var d=h[g];k.isValueInUse(d)||f.pool.release(d)}f.pool.destroy();f.pool=null;f.acquired=null}this.owner=this.properties=null};b.prototype.get=function(b){var e=this.owner._get(b);b=this.properties[b];var g=b.pool.acquire();for(b.acquired.push(g);g===e;)b.acquired.push(g),g=b.pool.acquire();return g};b.prototype.release=function(){for(var b in this.properties){for(var f=this.properties[b],g=0,h=0,d=f.acquired;h<
d.length;h++){var a=d[h];k.isValueInUse(a)?f.acquired[g++]=a:f.pool.release(a)}f.acquired.length=g}};return b}();b.PropertiesPool=n;b.default=n})},"esri/views/3d/state/ViewStateManager":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../../animation/easing".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L,O,K,N){Object.defineProperty(b,"__esModule",{value:!0});var Q=q.getLogger("esri.views.3d.state.ViewStateManager");n=function(b){function d(a){a=b.call(this,a)||this;a.propertiesPool=new L.default({frustum:G.default},a);a.handles=new c;a.cameraSetByUser=!1;a.internalSetOrder=[];a.immediateGoToController=null;a.animatedGoToController=null;a.ready=!1;a.updateDevicePixelRatio=null;return a}k(d,b);Object.defineProperty(d.prototype,
"camera",{get:function(){if(!this.ready)return this._get("camera");var a=I.internalToExternal(this.view,this.view.state.camera),b=this._get("camera");return a&&b&&a.equals(b)?b:a},set:function(a){this.updatePropertyBeforeReady("camera",a)||this.setStateCamera(I.externalToInternal(this.view,a),{applyConstraints:!1})||Q.error("#camera\x3d","Invalid camera",a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:
this._get("center")},set:function(a){this.updatePropertyBeforeReady("center",a)||(a?this.isCompatible(a)?this.setStateCamera(this.centerToCamera(a),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.update():Q.error("#center\x3d","Invalid center",a):Q.error("#center\x3d","Center has an incompatible spatial reference (center: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):Q.error("#center\x3d","Center may not be null or undefined"))},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"extent",{get:function(){return this.ready?I.toExtent(this.view,this.view.state.camera,this.view.pointsOfInterest.centerOnContent.renderLocation):this._get("extent")},set:function(a){this.updatePropertyBeforeReady("extent",a)||(a?this.isCompatible(a)?this.setStateCamera(this.extentToCamera(a),{applyConstraints:!0})||Q.error("#extent\x3d","Invalid extent",a):Q.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+
(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):Q.error("#extent\x3d","Extent may not be null or undefined"))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"frustum",{get:function(){var a=this.propertiesPool.get("frustum");a.renderCoordsHelper=this.view.renderCoordsHelper;a.update(this.view.state.camera);return a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"scale",{get:function(){if(!this.ready)return this._get("scale");var a=this.view.pointsOfInterest.centerOnContent;return I.distanceToScale(this.view,a.distance,a.location.latitude)},set:function(a){this.updatePropertyBeforeReady("scale",a)||this.setStateCamera(this.scaleToCamera(a),{applyConstraints:!0})||Q.error("#scale\x3d","Invalid scale",a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");
var a=this.view.state.camera,b=a.padding,c=a.pixelRatio,a=this._get("padding"),d=Math.round(b[0]/c),e=Math.round(b[1]/c),f=Math.round(b[2]/c),b=Math.round(b[3]/c);return null!=a&&a.top===d&&a.right===e&&a.bottom===f&&a.left===b?a:{top:d,right:e,bottom:f,left:b}},set:function(a){this.updatePropertyBeforeReady("padding",a)||(this.paddingToArray(a,this.view.state.camera.pixelRatio,J),this.view.state.updateCamera(function(a){return a.padding=J}))},enumerable:!0,configurable:!0});d.prototype.paddingToArray=
function(a,b,c){a?v.vec4.set(c,a.top||0,a.right||0,a.bottom||0,a.left||0):v.vec4.set(c,0,0,0,0);for(a=0;4>a;a++)c[a]=Math.round(c[a]*b)};Object.defineProperty(d.prototype,"screenCenter",{get:function(){var a=this.padding;return r.createScreenPoint((this.view.width-(a.left+a.right))/2+a.left,(this.view.height-(a.top+a.bottom))/2+a.top)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewpoint",{get:function(){return this.ready?O.fromCamera(this.view,this.camera):this._get("viewpoint")},
set:function(a){if(!this.updatePropertyBeforeReady("viewpoint",a))if(a)if(this.isCompatible(a))this.setStateCamera(this.viewpointToCamera(a),{applyConstraints:!a.camera})||Q.error("#viewpoint\x3d","Invalid viewpoint",a);else{var b=a.camera?a.camera.position:a.targetGeometry,b=b&&b.spatialReference;Q.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(b?b.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a)}else Q.error("#viewpoint\x3d","Viewpoint may not be null or undefined")},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"zoom",{get:function(){return this.ready?I.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(a){this.updatePropertyBeforeReady("zoom",a)||this.setStateCamera(this.zoomToCamera(a),{applyConstraints:!0})||Q.error("#zoom\x3d","Invalid zoom",a)},enumerable:!0,configurable:!0});d.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch("state.camera",function(b){return a.cameraChangedSync(b)},!0),x.on(this.view,
"state.events","before-camera-change",function(b){return a.updateElevation(b.camera)})]);x.once(this.view,"state.camera",function(b){return a.updateElevation(b)},!0);this.handles.add(u.addFrameTask({prepare:function(){return a.prepareFrame()}}));this.handles.add(this.view.watch("state.cameraController",function(){a.cameraSetByUser=!0;a.handles.remove(U);a.cancelImmediateGoTo()}));this.handles.add(x.on(this.view,"state.events","camera-projection-changed",function(){return a.notifyChange("scale")}))};
d.prototype.destroy=function(){this.deinit();this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};d.prototype.init=function(){var a=this;this.constraintsManager=new E.default({view:this.view});this.prepareFrame();var b=this.getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(var c=0;c<b.length;c++){var d=b[c];this.set(d.name,d.value)}this.cameraSetByUser||((b=this.view.get("map.initialViewProperties.viewpoint")||
this.view.initialExtent)&&this.isCompatible(b)?this.setInitialView(b):"local"===this.view.state.mode&&this.handles.add(x.whenOnce(this.view.basemapTerrain,"ready",function(){a.handles.remove(U);a.setInitialView(a.view.groundExtent)}),U))};d.prototype.deinit=function(){this.ready&&(this._override("padding",this.padding),this.cancelImmediateGoTo(),this.cancelAnimatedGoTo(),this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(U),
this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};d.prototype.goTo=function(a,b){return f(this,void 0,void 0,function(){var c;return e(this,function(d){c=m({animate:!0},b);return c.animate?[2,this.goToAnimated(a,c)]:[2,this.goToImmediate(a,c)]})})};d.prototype.debugSetCameraOnContent=function(){this.setStateCamera(F.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};d.prototype.step=function(a){var b=this.view.state,c=b&&this.view.state.cameraController;
c&&(b.updateCamera(function(b){c.stepController(a,b)}),c.steppingFinished&&c.finishController())};d.prototype.cancelImmediateGoTo=function(){var a=this.immediateGoToController;p.isSome(a)&&(this.immediateGoToController=null,a.abort())};d.prototype.cancelAnimatedGoTo=function(){var a=this.animatedGoToController;p.isSome(a)&&(this.animatedGoToController=null,a.abort())};d.prototype.getInitialProperties=function(){for(var a=new Set,b=[],c=0,d=T;c<d.length;c++){var e=d[c],f=e.propertyName,e=e.overrides,
g=a.has(f),h=this._isOverridden(f);!g&&h&&b.push({name:f,value:this._get(f)});this._clearOverride(f);(g||h)&&e.forEach(function(b){return a.add(b)})}return b};d.prototype.setInitialView=function(a){if(a&&!this.cameraSetByUser)if(a instanceof l)this.setStateCamera(I.externalToInternal(this.view,a),{applyConstraints:!1});else if(a instanceof h)if(a.targetGeometry instanceof y){var b=I.fromExtent(this.view,a.targetGeometry,0,.5,0);this.setStateCamera(I.externalToInternal(this.view,b),{applyConstraints:!0})}else b=
{applyConstraints:!a.camera},a=this.viewpointToCamera(a),this.setStateCamera(a,b);else b=I.fromExtent(this.view,a,0,.5,0),this.setStateCamera(I.externalToInternal(this.view,b),{applyConstraints:!0})};d.prototype.updatePropertyBeforeReady=function(a,b){if(!this.ready){this._override(a,b);var c=this.internalSetOrder.indexOf(a);-1!==c&&(this.internalSetOrder=this.internalSetOrder.splice(c,1));b&&(this.internalSetOrder.push(a),-1!==M.indexOf(a)&&this._override("hasInitialView",!0));return!0}return!1};
d.prototype.isCompatible=function(a){return a?a instanceof h?a.camera?this.isCompatible(a.camera):this.isCompatible(a.targetGeometry):a instanceof l?this.isCompatible(a.position):a.spatialReference&&B.canProject(a.spatialReference,this.view.spatialReference):!1};d.prototype.getPreservingHeadingTilt=function(a){void 0===a&&(a=P);this.cameraSetByUser?(a.heading=this.camera.heading,a.tilt=this.camera.tilt):(a.heading=0,a.tilt=.5);return a};d.prototype.centerPointAtDistanceToCamera=function(a,b,c){void 0===
c&&(c=V);var d=this.getPreservingHeadingTilt();return(a=I.getObserverForPointAtDistance(this.view,d.heading,d.tilt,a,b,1))?(c.copyFrom(this.view.state.camera),c.eye=a.eye,c.center=a.center,c.up=a.up,c):null};d.prototype.centerToCamera=function(a){var b=this.view.pointsOfInterest.centerOnContent;b.update();return this.centerPointAtDistanceToCamera(a,b.distance)};d.prototype.extentToCamera=function(a){var b=this.getPreservingHeadingTilt();a=I.fromExtent(this.view,a,b.heading,b.tilt,1,S);return I.externalToInternal(this.view,
a)};d.prototype.scaleToCamera=function(a){if(null==a)return null;var b=this.view.pointsOfInterest.centerOnContent;b.update();var c=b.renderLocation;a=I.scaleToDistance(this.view,a,b.location.latitude);return this.centerPointAtDistanceToCamera(c,a)};d.prototype.zoomToCamera=function(a){return this.scaleToCamera(I.zoomToScale(this.view,a))};d.prototype.viewpointToCamera=function(a){return(a=O.toCamera(this.view,a))?I.externalToInternal(this.view,a):null};d.prototype.setStateCamera=function(a,b){var c=
this;if(!a||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;this.cancelImmediateGoTo();this.view.state.updateCamera(function(d){b.positionAndOrientationOnly?(d.eye=a.eye,d.center=a.center,d.up=a.up):d.copyFrom(a);b.applyConstraints&&C.applyAll(c.view,d)});b.applyConstraints||(this.view.state.cameraController=new D.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a}));return!0};d.prototype.prepareFrame=function(){var a=this.view,b=a.container,c=a.canvas;
if(b&&c){p.isSome(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();var a=this.view.pixelRatio,d=Math.round(b.clientWidth*a),b=Math.round(b.clientHeight*a);0!==d&&0!==b&&(c.width=d,c.height=b,this.view.state&&(c=this.view.state.camera,c.fullWidth!==d||c.fullHeight!==b||c.pixelRatio!==a))&&(V.copyFrom(c),V.pixelRatio!==a&&(this.paddingToArray(this.padding,a,J),V.padding=J),V.fullWidth=d,V.fullHeight=b,V.pixelRatio=a,this.view.state.camera=V)}};d.prototype.updateElevation=function(a){var b=
this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,c=this.view.renderCoordsHelper.getAltitude(a.eye),b=b?F.surfaceElevationBelowEye(this.view,a):0;a.relativeElevation=c-b};d.prototype.cameraChangedSync=function(a){a&&this.view._stage&&this.view._stage.setCamera(a)};d.prototype.createGoToCamera=function(b,c){return f(this,void 0,void 0,function(){var d,f,g,k,m,p,r,q;return e(this,function(e){switch(e.label){case 0:return[4,x.whenOnce(this,"ready",c.signal,!0)];case 1:return e.sent(),
t.throwIfAborted(c),[4,O.create(this.view,b,c.signal)];case 2:d=e.sent();f=!!(b instanceof h&&b.camera||b instanceof l);g=d.camera;if(!this.isCompatible(g))throw p=(m=(k=g.position)&&k.spatialReference)?m.wkid:"none",r=this.view.spatialReference.wkid,new a("goto:incompatible-spatialreference","Resulting camera has an incompatible spatial reference (camera: "+p+", view: "+r+")",{camera:g});q=I.externalToInternal(this.view,g);if(!q)throw new a("goto:invalid-camera","Resulting camera is invalid");return[2,
{viewpoint:d,camera:q,isFullySpecified:f}]}})})};d.prototype.cancellableGoTo=function(a,b){var c=this,d,e=function(){c.view.state.cameraController===a&&a.active&&a.asyncResult===d&&a.stopController()};return t.create(function(c,f){d={resolve:c,reject:f};a.asyncResult=d;t.onAbort(b,e)},e)};d.prototype.goToImmediate=function(b,c){return f(this,void 0,void 0,function(){var d,f,g,h=this;return e(this,function(e){this.cancelAnimatedGoTo();this.cancelImmediateGoTo();d=t.createAbortController();t.onAbort(c,
function(){return d.abort()});f=this.createGoToCamera(b,m({},c,{signal:d.signal}));g=function(){h.immediateGoToController===d&&(h.immediateGoToController=null)};this.immediateGoToController=d;return[2,f.then(function(a){g();h.setStateCamera(a.camera,{applyConstraints:!a.isFullySpecified,positionAndOrientationOnly:!0})}).catch(function(b){g();!t.isAbortError(b)&&b instanceof a&&b.message&&Q.error("#goTo()","Failed to create camera from target, "+b.message[0].toLowerCase()+b.message.slice(1));throw b;
})]})})};d.prototype.goToAnimatedBeforeReady=function(a,b){return f(this,void 0,void 0,function(){var c;return e(this,function(d){switch(d.label){case 0:return this.cancelAnimatedGoTo(),c=t.createAbortController(),t.onAbort(b,function(){return c.abort()}),this.animatedGoToController=c,b=m({},b,{signal:c.signal}),[4,x.whenOnce(this.view,"ready",c.signal)];case 1:return d.sent(),this.animatedGoToController=null,[2,this.goToAnimated(a,b)]}})})};d.prototype.goToAnimated=function(b,c){return f(this,void 0,
void 0,function(){var d,g,h,l,k,m,r=this;return e(this,function(q){this.cancelAnimatedGoTo();if(!this.ready)return[2,this.goToAnimatedBeforeReady(b,c)];d=this.view.state.cameraController;d instanceof H.PointToPointAnimationController&&(d.updateStateFromViewAnimation(),d.active&&(g=d));null==g&&(g=new H.PointToPointAnimationController(this.view.state,this.view.sceneIntersectionHelper,"animation"));h=g.viewAnimation;if(p.isNone(h))return Q.warn("Unreachable code in ViewStateManager"),[2];l=this.createGoToCamera(b,
c);h.update(l.then(function(a){return a.viewpoint}));if(g!==d&&!this.view.state.switchCameraController(g))return h.stop(),Q.error("#goTo()","Cannot start an animation while interacting"),[2,t.reject(new a("view:goto-cannot-interrupt","Cannot start an animation while interacting"))];k=h.target;m=function(){return r.view.state.cameraController===g&&p.isSome(g.viewAnimation)&&g.viewAnimation.target===k&&g.active};l.then(function(a){var b=a.viewpoint,d=a.camera,l=a.isFullySpecified;return f(r,void 0,
void 0,function(){var a,f,r=this;return e(this,function(e){switch(e.label){case 0:if(!m())return[2];p.isSome(g.viewAnimation)&&(g.viewAnimation.update(b),k=g.viewAnimation.target);l?(a=new D.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:d}),C.applySurfaceCollisionConstraint(this.view,d,1)):C.applyAll(this.view,d);g.begin(d,this.internalAnimateOptions(c));f=function(){var b=r.view.state.cameraController;a&&(b&&b.active?b instanceof H.PointToPointAnimationController&&p.isSome(b.viewAnimation)&&
b.viewAnimation.target===k&&(r.view.state.cameraController=a):p.isSome(g.viewAnimation)&&g.viewAnimation.target===k&&"finished"===g.state&&(r.view.state.cameraController=a))};return[4,h.when(f,f)];case 1:return e.sent(),[2]}})})}).catch(function(b){!t.isAbortError(b)&&b instanceof a&&b.message&&Q.error("#goTo()","Failed to create camera from target, "+b.message[0].toLowerCase()+b.message.slice(1));if(m())throw r.view.state.cameraController.stopController(),b;});return[2,this.cancellableGoTo(g,c)]})})};
d.prototype.internalAnimateOptions=function(a){var b={};a&&(null!=a.speedFactor&&(b.speedFactor=a.speedFactor),null!=a.duration&&(b.duration=a.duration/1E3),null!=a.maxDuration&&(b.maxDuration=a.maxDuration/1E3),null!=a.easing&&(b.easing="string"===typeof a.easing?N.named[a.easing]:a.easing));return b};g([w.property({type:l,dependsOn:["view.state.camera","ready"]})],d.prototype,"camera",null);g([w.property({type:A,dependsOn:["view.pointsOfInterest.centerOnContent.location","ready"]})],d.prototype,
"center",null);g([w.property({type:y,dependsOn:["view.state.camera","ready","view.pointsOfInterest.centerOnContent.location"]})],d.prototype,"extent",null);g([w.property({readOnly:!0,dependsOn:["view.state.camera","ready"]})],d.prototype,"frustum",null);g([w.property({readOnly:!0,dependsOn:["view.map.initialViewProperties?.viewpoint"]})],d.prototype,"hasInitialView",null);g([w.property({readOnly:!0,type:Boolean})],d.prototype,"ready",void 0);g([w.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance",
"ready"],type:Number})],d.prototype,"scale",null);g([w.property({dependsOn:["view.state.camera","ready"]})],d.prototype,"padding",null);g([w.property({readOnly:!0,dependsOn:["view.width","view.height","padding"]})],d.prototype,"screenCenter",null);g([w.property({constructOnly:!0})],d.prototype,"view",void 0);g([w.property({type:h,dependsOn:["camera","ready"]})],d.prototype,"viewpoint",null);g([w.property({type:Number,dependsOn:["scale"]})],d.prototype,"zoom",null);g([w.property({constructOnly:!0})],
d.prototype,"updateDevicePixelRatio",void 0);return d=g([w.subclass("esri.views.3d.state.ViewStateManager")],d)}(w.declared(d));b.ViewStateManager=n;var M="camera viewpoint extent scale center zoom".split(" "),T=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],
P={heading:0,tilt:0},S=new l,V=new K.default,J=z.vec4f64.create(),U="pending-initial-view";b.default=n})},"esri/views/3d/state/ConstraintsManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function g(a){var d=b.call(this,a)||this;d.handles=new e;d.nearFarHeuristic=c.createNearFarHeuristic(a.view.state.mode,a.view.basemapTerrain,a.view.renderCoordsHelper.spatialReference);return d}m(g,b);g.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],function(){return a.handleClipDistanceNearFarChanged()}),
this.view.watch("constraints.clipDistance.mode",function(){return a.handleClipDistanceModeChanged()}),this.view.state.events.on("before-camera-change",function(b){return a.cameraUpdateNearFar(b.camera)}),this.view.watch("dataExtent",function(){return a.updateNearFar()},!0)]);this.handles.add([this.view.watch(["constraints.altitude.min","constraints.altitude.max"],function(){return a.handleAltitudeMinMaxChanged()},!0)]);this.handles.add([this.view.watch("constraints.tilt.max",function(){return a.handleTiltMaxChanged()},
!0),this.view.watch("constraints.tilt.mode",function(){return a.handleTiltModeChanged()},!0),this.view.watch("state.camera",function(){return a.tiltAutoUpdateMax()},!0)]);this.handles.add(this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],function(){return a.updateCollision()},!0));this.view.state.isLocal&&this.handles.add(l.init(this.view,"dataExtent",function(b){return a.updateLocalSurfaceDistance(b)}));this.updateNearFar();"local"!==this.view.state.mode&&this.updateAltitude();
this.updateTilt();this.updateCollision();this._set("surfaceCollisionConstraint",new q.default({view:this.view}))};g.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};g.prototype.handleClipDistanceNearFarChanged=function(){var a=this,b=this.view.constraints&&this.view.constraints.clipDistance;b&&"auto"!==b.mode&&this.view.state.updateCamera(function(c){a.cameraUpdateNearFarManual(c,
b);return!0})};g.prototype.handleClipDistanceModeChanged=function(){this.updateNearFar()};g.prototype.updateNearFar=function(){var a=this;this.view.state.updateCamera(function(b){a.cameraUpdateNearFar(b);return!0})};g.prototype.cameraUpdateNearFar=function(a){var b=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(b?b.mode:"auto")?this.cameraUpdateNearFarManual(a,b):this.cameraUpdateNearFarAuto(a,b)};g.prototype.cameraUpdateNearFarAuto=function(b,c){this.nearFarHeuristic.compute(b.eye,
b.center,this.view.dataExtent,a.surfaceElevationBelowEye(this.view,b),b);c&&c.autoUpdate(b.near,b.far)};g.prototype.cameraUpdateNearFarManual=function(a,b){b&&(a.near=b.near,a.far=b.far)};g.prototype.updateCollision=function(){var a=this.view.map&&this.view.map.ground&&this.view.map.ground.navigationConstraint,b=this.view.constraints&&this.view.constraints.collision.enabled,a=a?"stay-above"===a.type:b,b=this.view.state.constraints.collision;a!==b.enabled&&((b.enabled=a)&&this.reapplyConstraints(8),
(a=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==a.mode||this.updateTiltAuto())};g.prototype.handleAltitudeMinMaxChanged=function(){this.updateAltitude()};g.prototype.updateAltitude=function(){var a=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=a&&"local"!==this.view.state.mode?{min:a.min,max:a.max}:null;this.reapplyConstraints()};g.prototype.handleTiltModeChanged=function(){this.updateTilt()};g.prototype.handleTiltMaxChanged=function(){var a=
this.view.constraints&&this.view.constraints.tilt;a&&"auto"!==a.mode&&(this.updateTiltManual(a),this.reapplyConstraints())};g.prototype.updateTilt=function(){var a=this.view.constraints&&this.view.constraints.tilt;"manual"===(a?a.mode:"auto")?this.updateTiltManual(a):this.updateTiltAuto();this.reapplyConstraints()};g.prototype.updateTiltManual=function(a){var b=this.view.state.constraints;b.tilt=b.createConstantMaxTilt(f.deg2rad(a.max))};g.prototype.updateTiltAuto=function(){var a=this.view.state.constraints;
a.tilt=a.createDefaultTilt();this.tiltAutoUpdateMax()};g.prototype.tiltAutoUpdateMax=function(){var a=this.view.constraints&&this.view.constraints.tilt;if(a&&"auto"===a.mode){var b=this.view.state.constraints;b.tilt&&(b=b.tilt(this.view.state.camera.distance).max,a.autoUpdate(f.rad2deg(b)))}};g.prototype.updateLocalSurfaceDistance=function(a){var b=Math.max(a.width,a.height);0>=b||(a.hasZ&&(b=Math.max(b,a.zmax-a.zmin)),a=this.view.state,b=3*b/Math.atan(a.camera.fov/2),b!==a.constraints.distance&&
(a.constraints.distance=b))};g.prototype.reapplyConstraints=function(a){var b=this;void 0===a&&(a=15);this.view.state.updateCamera(function(c){return d.applyAll(b.view,c,{selection:a,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0})})};k([h.property({constructOnly:!0})],g.prototype,"view",void 0);k([h.property({readOnly:!0})],g.prototype,"surfaceCollisionConstraint",void 0);return g=k([h.subclass("esri.views.3d.state.ConstraintsManager")],
g)}(h.declared(g));b.ConstraintsManager=n;b.default=n})},"esri/views/3d/state/NearFarHeuristic":function(){define("require exports ../../../core/mathUtils ../../../core/mathUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/earthUtils".split(" "),function(n,b,m,k,g,e,f,l){function h(a,b,c,d){c=q/c;a/b>c?(d.far=a,d.near=d.far/b):(d.near=c,d.far=d.near*b);return d}Object.defineProperty(b,"__esModule",{value:!0});b.createNearFarHeuristic=
function(b,c,e){return"global"===b?new a:new d(c,e)};var d=function(){function a(a,b){this.elevationProvider=a;this.unitInMeters=g.getMetersPerUnitForSR(b)}a.prototype.compute=function(a,b,d,f,g){g||(g={near:0,far:0});var q=l.earthRadius,n=a[2]*this.unitInMeters,w=n;f=n-f;var v=this.elevationProvider?this.elevationProvider.elevationBounds:null;v&&(n=0<=f?w-this.unitInMeters*v.min:this.unitInMeters*v.max-w);w=Math.max(d.xmax-d.xmin,d.ymax-d.ymin,4*Math.max(d.xmax-d.xmin,d.ymax-d.ymin));e.vec3.subtract(r,
b,a);u[0]=0<r[0]?d.xmax:d.xmin;u[1]=0<r[1]?d.ymax:d.ymin;u[2]=0<r[2]?w/2:-w/2;e.vec3.subtract(u,u,a);e.vec3.normalize(r,r);a=1.1*e.vec3.dot(u,r)*this.unitInMeters;q=Math.sqrt(n*(n+2*q));d=Math.max(d.xmax-d.xmin,d.ymax-d.ymin);b=d*t*this.unitInMeters;n=m.clamp((n-b)/(d*p*this.unitInMeters-b),0,1);n=k.lerp(q,a,n*n*n);n*=Math.max(Math.log(Math.abs(f)),1);n=Math.min(n,Math.max(34064E4,w));n/=this.unitInMeters;return h(n,c,this.unitInMeters,g)};return a}(),a=function(){function a(){}a.prototype.compute=
function(a,b,c,d,f){f||(f={near:0,far:0});b=l.earthRadius;a=e.vec3.length(a)-b;a=Math.max(Math.abs(a-d),Math.abs(a));d=Math.sqrt(a*(a+2*(b+Math.min(0,d))));a=m.clamp(2E4-(Math.log(a)-7.983)/9.011*19E3,1E3,2E4);return h(1.2*d,a,1,f)};return a}(),c=2E4,q=2,p=.001,t=1E-4,u=f.vec3f64.create(),r=f.vec3f64.create()})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils".split(" "),
function(n,b,m,k,g,e,f,l,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function a(a){a=b.call(this,a)||this;a.handles=new e;return a}m(a,b);a.prototype.initialize=function(){var a=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}))};a.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};a.prototype.handleElevationChangeEvent=function(a){this.view.state.cameraController||h.eyeWithinExtent(this.view,
this.view.state.camera,a.extent,a.spatialReference)&&this.applyToCurrentCamera()};a.prototype.applyToCurrentCamera=function(){var a=this;this.view.state.updateCamera(function(b){l.applySurfaceCollisionConstraint(a.view,b,1)})};k([f.property({constructOnly:!0})],a.prototype,"view",void 0);return a=k([f.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a)}(f.declared(g));b.SurfaceCollisionConstraint=n;b.default=n})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController".split(" "),
function(n,b,m,k,g,e,f,l,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function a(a){a=b.call(this,a)||this;a.handles=new g;return a}m(a,b);Object.defineProperty(a.prototype,"desiredCamera",{set:function(a){this._set("desiredCamera",a.clone())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},
enumerable:!0,configurable:!0});a.prototype.onControllerStart=function(){var a=this;this.state=h.State.Running;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}));this.applyCorrection()};a.prototype.onControllerEnd=function(){this.handles.removeAll()};a.prototype.stepController=function(){};a.prototype.handleElevationChangeEvent=function(a){l.eyeWithinExtent(this.view,this.desiredCamera,a.extent,a.spatialReference)&&this.applyCorrection()};
a.prototype.applyCorrection=function(){var a=this;this.view.state.updateCamera(function(b){b.copyViewFrom(a.desiredCamera);f.applySurfaceCollisionConstraint(a.view,b,1)||a.constraintEnabled||(a.state=h.State.Stopped)})};k([e.property({constructOnly:!0})],a.prototype,"view",void 0);k([e.property({constructOnly:!0})],a.prototype,"desiredCamera",null);return a=k([e.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],a)}(e.declared(h.CameraController));b.SurfaceCollisionCorrectionController=
n})},"esri/views/3d/support/viewpointUtils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/compilerUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ./geometryUtils ./mathUtils ./projectionUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E){function G(a){return 360-F.cyclicalDeg.normalize(a)}function H(a){return F.cyclicalDeg.normalize(360-a)}function D(a,b){a&&a.resolver&&(null==b?a.resolver.reject():a.resolver.resolve(b));return b}function I(a,b,c,d){if(!b)return D(d);var f=a.spatialReference||e.SpatialReference.WGS84;if(b.camera){a=b.get("camera.position.spatialReference");if(!z.canProject(a,f))return D(d);b=b.camera.clone();a.equals(f)||(b.position=z.project(b.position,
f));return D(d,b)}var g=b.get("targetGeometry.spatialReference");if(g&&!z.canProject(g,f))return D(d);f=A.internalToExternal(a,a.state.camera);g=1;null!=b.rotation&&(f.heading=G(b.rotation),g=0);null!=c&&(f.tilt=c);if("point"===b.targetGeometry.type){c=b.targetGeometry;var h=void 0,l=b.targetGeometry.clone(),h=null!=b.scale?A.scaleToDistance(a,b.scale,c.latitude):a.state.camera.distance;return A.fromCenterDistance(a,l,h,f,g,d)}return A.fromExtent(a,b.targetGeometry.extent,f.heading,f.tilt,g,d)}function L(a,
b){return null==b.scale&&null!=b.zoom?A.zoomToScale(a,b.zoom):b.scale}function O(a,b){var c=!1;null!=b.heading?(a.heading=b.heading,c=!0):null!=b.rotation&&(a.heading=G(b.rotation),c=!0);null!=b.tilt&&(a.tilt=b.tilt,c=!0);null!=b.fov&&(a.fov=b.fov);return c}function K(a,b,c){var d=a.spatialReference||e.SpatialReference.WGS84;b=b||A.externalToInternal(a,c.camera);c.targetGeometry=E.vectorToPoint(b.center,a.renderSpatialReference,d);c.scale=A.computeScale(a,b);c.rotation=H(c.camera.heading);return c}
function N(b,c,e){if(c){if(!z.canProject(c.spatialReference,b.spatialReference))throw new a("viewpointutils:incompatible-spatialreference","Spatial reference ("+(c.spatialReference?c.spatialReference.wkid:"unknown")+") is incompatible with the view ("+b.spatialReference.wkid+")",{geometry:c});var f=[];if(!c.hasZ&&b.basemapTerrain){var g=void 0;switch(c.type){case "point":g=c;break;case "multipoint":case "polyline":case "mesh":g=c.extent.center;break;case "extent":g=c.center;break;case "polygon":g=
c.centroid;break;default:d.neverReached(c)}g&&z.canProject(g,b.basemapTerrain.spatialReference)?X[2]=B.getElevationAtPoint(b.elevationProvider,g)||0:X[2]=0}(0,na[c.type])(c,function(a){f.push(a[0],a[1],a[2])},X);var h=f.length/3;if(0!==h&&(g=Array(f.length),E.bufferToBuffer(f,c.spatialReference,0,g,b.spatialReference,0,h)))for(c.hasZ&&(e.hasZ=!0),b=0;b<g.length;b+=3)c.hasZ?(X[0]=g[b+0],X[1]=g[b+1],X[2]=g[b+2]):(X[0]=g[b+0],X[1]=g[b+1]),w.expand(e.boundingBox,X)}}function Q(a,b,d,e){return k(this,
void 0,void 0,function(){var f,g,l,k,p,r;return m(this,function(m){switch(m.label){case 0:return[4,h.result(a.whenViewForGraphic(b))];case 1:f=m.sent();if(!1===f.ok||c.isNone(f.value)||!("whenGraphicBounds"in f.value))return N(a,b.geometry,e),[2];g=f.value;return[4,h.result(g.whenGraphicBounds(b,{minDemResolution:d}))];case 2:l=m.sent();if(!1===l.ok)return N(a,b.geometry,e),[2];k=l.value;p=k.screenSpaceObjects;r=k.boundingBox;w.expand(e.boundingBox,r);p&&p.forEach(function(a){e.screenSpaceObjects.push(a)});
isFinite(r[2])&&(e.hasZ=!0);return[2]}})})}function M(a,b,c,d){return k(this,void 0,void 0,function(){var g,h;return m(this,function(l){switch(l.label){case 0:return Array.isArray(b)&&2===b.length&&(g=b[0],h=b[1],"number"===typeof g&&"number"===typeof h)?(fa.x=g,fa.y=h,fa.z=void 0,fa.spatialReference=a.spatialReference.isGeographic?a.spatialReference:e.SpatialReference.WGS84,N(a,fa,d),[2]):b&&"function"===typeof b.map?[4,q.eachAlways(b.map(function(b){return M(a,b,c,d)}))]:[3,2];case 1:return l.sent(),
[2];case 2:if(!(b instanceof e.BaseGeometry))return[3,3];N(a,b,d);return[3,5];case 3:return b instanceof f?[4,Q(a,b,c,d)]:[3,5];case 4:l.sent(),l.label=5;case 5:return[2]}})})}function T(a,b,c,d,e){return k(this,void 0,void 0,function(){var f,g,h;return m(this,function(l){switch(l.label){case 0:if(b.camera)return[2,P(a,b.camera,e)];e.scale=b.scale;e.rotation=b.rotation;e.targetGeometry=b.targetGeometry?b.targetGeometry.clone():null;e.camera=null;null!=c.heading?e.rotation=H(c.heading):null!=c.rotation&&
(e.rotation=c.rotation);f=L(a,c);null!=f&&(e.scale=f);g=A.createAsyncContext(d);I(a,e,c.tilt,g);h=e;return[4,g.resolver.promise];case 1:return h.camera=l.sent(),[2,e]}})})}function P(a,b,c){c.camera=b.clone();c.camera.fov=a.camera.fov;b=a.spatialReference;var d=c.camera.position.spatialReference;if(!z.canProject(d,b))return null;d.equals(b)||(c.camera.position=z.project(c.camera.position,b));return K(a,null,c)}function S(b,c,d,f,g){return k(this,void 0,void 0,function(){var h,l,k,p,q,n;return m(this,
function(m){switch(m.label){case 0:if(!d)throw new a("createfromcenter","invalid point");g.targetGeometry=d.clone();h=y.cameraOnContentAlongViewDirection(b);if(c.position){m=g.targetGeometry;var u=h,t=b.renderSpatialReference;E.pointToVector(c.position,W,t);E.pointToVector(m,Z,t);g.targetGeometry=new e.Point(m);g.camera.position=new e.Point(c.position);r.vec3.subtract(ba,Z,W);A.directionToHeadingTilt(b,W,ba,u.up,g.camera);g.scale=A.distanceToScale(b,r.vec3.distance(W,Z),g.targetGeometry.latitude);
g.rotation=H(g.camera.heading);return[2,g]}c.zoomFactor&&(l=h.distance/c.zoomFactor,k=r.vec3.scale(X,h.viewForward,-l),r.vec3.add(h.eye,h.center,k),h.markViewDirty(),g.scale=A.distanceToScale(b,l,d.latitude));A.internalToExternal(b,h,g.camera);p=O(g.camera,c)?0:1;if(c.zoomFactor)return[3,2];g.scale=L(b,c);null==g.scale&&(E.pointToVector(d,X,b.renderSpatialReference),C.frustum.intersectsPoint(h.frustum.planes,X)?g.scale=A.distanceToScale(b,r.vec3.distance(h.eye,X),d.latitude):g.scale=A.computeScale(b,
h));q=A.createAsyncContext(f);A.fromCenterScale(b,g.targetGeometry,g.scale,g.camera,p,q);n=g;return[4,q.resolver.promise];case 1:n.camera=m.sent(),m.label=2;case 2:return[2,g]}})})}function V(a,b,c,d){return k(this,void 0,void 0,function(){var e,f;return m(this,function(g){e=y.cameraOnContentAlongViewDirection(a);f=E.vectorToPoint(e.center,a.renderSpatialReference,fa,a.spatialReference);return[2,S(a,b,f,c,d)]})})}function J(a,b,c,d,e){return k(this,void 0,void 0,function(){var f,g,h,l;return m(this,
function(k){switch(k.label){case 0:return e.targetGeometry=c.clone(),f=y.cameraOnContentAlongViewDirection(a),A.internalToExternal(a,f,e.camera),g=O(e.camera,b)?0:1,h=A.createAsyncContext(d),A.fromExtent(a,c,e.camera.heading,e.camera.tilt,g,h),l=e,[4,h.resolver.promise];case 1:return l.camera=k.sent(),[2,e]}})})}function U(a,b,c,d,e,f,g){return k(this,void 0,void 0,function(){var h,l,k,q,n;return m(this,function(m){switch(m.label){case 0:g.targetGeometry=c.clone();m=h=y.cameraOnContentAlongViewDirection(a);
var u=0;c.hasZ?u=c.z:a.basemapTerrain&&(u=B.getElevationAtPoint(a.elevationProvider,c));r.vec3.set(X,c.x,c.y,u);E.computeLinearTransformation(a.spatialReference,X,R,a.renderSpatialReference);p.mat3.fromMat4(aa,R);p.mat3.transpose(aa,aa);w.empty(da);for(var t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],v=0;v<t.length;v++){var x=t[v],z=d[x[2]];isFinite(z)||(z=u);r.vec3.set(X,d[x[0]],d[x[1]],z);E.vectorToVector(X,a.spatialReference,X,a.renderSpatialReference);w.expand(da,r.vec3.transformMat3(X,
X,aa))}u=w.width(da);t=w.height(da);v=w.depth(da);x=1/Math.tan(m.fovY/2);l=Math.max(.5*Math.sqrt(u*u+v*v)*Math.max(x,1/Math.tan(m.fovX/2))+.5*t,.5*t*x+.5*Math.max(u,v))/e;A.internalToExternal(a,h,g.camera);k=O(g.camera,b)?0:1;g.scale=A.distanceToScale(a,l,g.targetGeometry.latitude);q=A.createAsyncContext(f);A.fromCenterScale(a,g.targetGeometry,g.scale,g.camera,k,q);n=g;return[4,q.resolver.promise];case 1:return n.camera=m.sent(),[2,g]}})})}function Y(a){a&&(a.rotation=H(a.camera.heading));return a}
Object.defineProperty(b,"__esModule",{value:!0});b.DEFAULT_FRAME_COVERAGE=.66;b.rotationToHeading=G;b.headingToRotation=H;b.toCamera=I;b.fromInternalCamera=function(a,b,c){c||(c=new l({camera:new g}));A.internalToExternal(a,b,c.camera);return K(a,b,c)};b.fromCamera=function(a,b,c){c||(c=new l);c.camera=b.clone();return K(a,null,c)};b.create=function(c,d,f){return k(this,void 0,void 0,function(){var h,k,p,q,n,u,t,x,z,B,C,F,D;return m(this,function(m){switch(m.label){case 0:if(d&&c.spatialReference){m=
{target:null};if("declaredClass"in d||Array.isArray(d))m.target=d;else{for(var G in d)m[G]=d[G];d.center&&!m.target&&(m.target=d.center)}h=m}else h=null;if(!h)throw new a("viewpointutils-create:no-target","Missing target for creating viewpoint");k=new l({camera:new g({fov:c.camera.fov})});return h.target instanceof l?[4,T(c,h.target,h,f,k)]:[3,2];case 1:return p=m.sent(),[2,Y(p)];case 2:if(h.target instanceof g)return[2,Y(P(c,h.target,k))];q=null!=h.scale||null!=h.zoom;if(!(h.target instanceof e.Extent))return[3,
6];n=h.target.xmin===h.target.xmax||h.target.ymin===h.target.ymax;if(!q&&!n)return[3,4];u=Y;return[4,S(c,h,h.target.center,f,k)];case 3:return[2,u.apply(void 0,[m.sent()])];case 4:return t=Y,[4,J(c,h,h.target,f,k)];case 5:return[2,t.apply(void 0,[m.sent()])];case 6:return x={boundingBox:w.empty(),hasZ:!1,screenSpaceObjects:[]},z=q?A.scaleToResolution(c,L(c,h)):void 0,[4,M(c,h.target,z,x)];case 7:m.sent();if(!isFinite(x.boundingBox[0]))return[3,11];w.center(x.boundingBox,X);fa.x=X[0];fa.y=X[1];fa.z=
X[2];fa.spatialReference=c.spatialReference;n=void 0;isFinite(fa.z)&&x.hasZ?n=w.isPoint(x.boundingBox):(fa.z=void 0,n=v.isPoint(w.toRect(x.boundingBox,ca)));if(!q&&!n)return[3,9];B=Y;return[4,S(c,h,fa,f,k)];case 8:return[2,B.apply(void 0,[m.sent()])];case 9:G=x.screenSpaceObjects;m=b.DEFAULT_FRAME_COVERAGE;if(G.length){for(var E=Number.NEGATIVE_INFINITY,N=0;N<G.length;N++)var W=G[N].screenSpaceBoundingRect,E=Math.max(E,Math.abs(W[0]),Math.abs(W[1]),Math.abs(W[2]),Math.abs(W[3]));C=m-E/Math.min(c.width,
c.height)*2}else C=m;F=Y;return[4,U(c,h,fa,x.boundingBox,C,f,k)];case 10:return[2,F.apply(void 0,[m.sent()])];case 11:if(h.position)return G=h,m=k,E=y.cameraOnContentAlongViewDirection(c),r.vec3.copy(ba,E.viewForward),A.directionToHeadingTilt(c,E.eye,ba,E.up,ea),m.camera.position=new e.Point(G.position),m.camera.heading=null!=G.heading?G.heading:ea.heading,m.camera.tilt=null!=G.tilt?G.tilt:ea.tilt,G=K(c,null,m),[2,Y(G)];D=Y;return[4,V(c,h,f,k)];case 12:return[2,D.apply(void 0,[m.sent()])]}})})};var X=
x.vec3f64.create(),R=u.mat4f64.create(),aa=t.mat3f64.create(),da=w.create(),ca=v.create(),ba=x.vec3f64.create(),W=x.vec3f64.create(),Z=x.vec3f64.create(),ea={heading:0,tilt:0},fa=new e.Point,na={point:function(a,b,c){c[0]=a.x;c[1]=a.y;a.hasZ&&(c[2]=a.z);b(c)},polygon:function(a,b,c){for(var d=a.hasZ,e=0;e<a.rings.length;e++)for(var f=a.rings[e],g=0;g<f.length;g++)c[0]=f[g][0],c[1]=f[g][1],d&&(c[2]=f[g][2]),b(c)},polyline:function(a,b,c){for(var d=a.hasZ,e=0;e<a.paths.length;e++)for(var f=a.paths[e],
g=0;g<f.length;g++)c[0]=f[g][0],c[1]=f[g][1],d&&(c[2]=f[g][2]),b(c)},multipoint:function(a,b,c){var d=a.points;a=a.hasZ;for(var e=0;e<d.length;e++)c[0]=d[e][0],c[1]=d[e][1],a&&(c[2]=d[e][2]),b(c)},extent:function(a,b,c){a.hasZ?(b(r.vec3.set(c,a.xmin,a.ymin,a.zmin)),b(r.vec3.set(c,a.xmax,a.ymin,a.zmin)),b(r.vec3.set(c,a.xmin,a.ymax,a.zmin)),b(r.vec3.set(c,a.xmax,a.ymax,a.zmin)),b(r.vec3.set(c,a.xmin,a.ymin,a.zmax)),b(r.vec3.set(c,a.xmax,a.ymin,a.zmax)),b(r.vec3.set(c,a.xmin,a.ymax,a.zmax)),b(r.vec3.set(c,
a.xmax,a.ymax,a.zmax))):(b(r.vec3.set(c,a.xmin,a.ymin,c[2])),b(r.vec3.set(c,a.xmax,a.ymin,c[2])),b(r.vec3.set(c,a.xmin,a.ymax,c[2])),b(r.vec3.set(c,a.xmax,a.ymax,c[2])))},mesh:function(a,b,c){if(a=a.vertexAttributes&&a.vertexAttributes.position)for(var d=0;d<a.length;d+=3)b(r.vec3.set(c,a[d+0],a[d+1],a[d+2]))}}})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("require exports ../../../../core/maybe ../../../../core/PooledArray ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/stack ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){function c(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];b&&!b(e)||c.push(e)}return c}function q(a){p||(p=new d.Intersector(a));p.viewingMode=a;return p}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,c){this.viewingMode=a;this.layerProvider=b;this.view=c;this.externalIntersectionHandlers=new k;this.tolerance=d.Intersector.DEFAULT_TOLERANCE;this.tmpRay=l.ray.create();this.validateHUDIntersector=new d.Intersector(this.viewingMode);this.validateHUDIntersector.options.hud=
!1}b.prototype.intersectScreen=function(a,b){return this.intersectRay(this.getPickRay(a,this.tmpRay),q(this.viewingMode),b)};b.prototype.intersectScreenFreePointFallback=function(a,b){return this.intersectRayFreePointFallback(this.getPickRay(a,this.tmpRay),b)};b.prototype.intersectRayFreePointFallback=function(a,b){return this.intersectRay(a,q(this.viewingMode),b)||this.intersectRayFreePointLocal(a,b)};b.prototype.intersectRay=function(a,b,c,d){b.options.selectionMode=!1;b.options.store=0;this.computeIntersection(a,
b,d);return b.results.min?b.results.min.getIntersectionPoint(c):!1};b.prototype.getCenterRayWithSubpixelOffset=function(a,b,c,d){void 0===c&&(c=.5);void 0===d&&(d=.5);a.getRenderCenter(r,c,d);r[0]+=.0466;r[1]-=.0123;return l.ray.fromRenderAtEye(a,r,b)};b.prototype.intersectIntersectorScreen=function(a,b,c){this.computeIntersection(this.getPickRay(a,this.tmpRay),b,c)};b.prototype.intersectToolIntersectorScreen=function(a,b,c){a=this.getPickRay(a,this.tmpRay);this.intersectToolIntersectorRay(a,b,c)};
b.prototype.intersectToolIntersectorRay=function(a,b,c){b.options.selectionMode=!0;this.computeIntersection(a,b,c);var d=b.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.isOpaque()||d.hasIntersectionPoint&&"TerrainRenderer"!==d.intersector||(b.options.selectionMode=!1,this.computeIntersection(a,b,c))};b.prototype.setTolerance=function(a){void 0===a&&(a=d.Intersector.DEFAULT_TOLERANCE);this.tolerance=a};b.prototype.addIntersectionHandler=function(a){this.externalIntersectionHandlers.push(a);
this.externalIntersectionHandlers.sort(function(a,b){return"Terrain"===a.type?1:"Terrain"===b.type?-1:0})};b.prototype.removeIntersectionHandler=function(a){this.externalIntersectionHandlers.removeUnordered(a);this.externalIntersectionHandlers.sort(function(a,b){return"Terrain"===a.type?1:"Terrain"===b.type?-1:0})};b.prototype.getPickRay=function(a,b){void 0===b&&(b=l.ray.create());return l.ray.fromScreen(this.view.state.camera,a,b)};b.prototype.intersectRayFreePointLocal=function(a,b){if("local"!==
this.viewingMode)return!1;var c=this.view.dataExtent,d=Math.max(c.xmax-c.xmin,c.ymax-c.ymin,8*Math.max(c.xmax-c.xmin,c.ymax-c.ymin));if(0===d)return e.vec3.add(b,a.origin,e.vec3.normalize(h.sv3d.get(),a.direction)),!0;var f=this.view.state.camera,g=Math.max(0,c.xmin-f.eye[0],f.eye[0]-c.xmax),c=Math.max(0,c.ymin-f.eye[1],f.eye[1]-c.ymax),f=d/Math.max(1,Math.pow(Math.max(0,Math.log(d/(Math.abs(f.relativeElevation)+Number.MIN_VALUE))),2)),f=Math.max(f,Math.min(Math.sqrt(g*g+c*c),d)),d=e.vec3.scale(h.sv3d.get(),
a.direction,f/e.vec3.length(a.direction));e.vec3.add(b,a.origin,d);return!0};b.prototype.intersectElevationFromScreen=function(a,b,c){void 0===c&&(c=0);return this.intersectElevation(this.getPickRay(a,this.tmpRay),b,c)};b.prototype.intersectElevation=function(b,c,f){void 0===f&&(f=0);var l=m.isSome(c)?c.mode:"absolute-height",k=m.isSome(c)?m.unwrapOr(c.offset,0):0,p="on-the-ground"!==l?k+f:0;c=p/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===l)return this.view.renderCoordsHelper.intersectManifold(b,
p,u)?(f=this.view.computeMapPointFromVec3d(u),f.z-=k,f):null;var k=this.view.state.camera,r=g.castRenderScreenPointArray3(h.sv3d.get());k.projectPoint(b.origin,r);var p=this.prepareFilters(null,t),q=this.view.slicePlane,n=q?a.sliceFilterPredicate(q):null,w=new d.Intersector(this.viewingMode);w.options.store=0;w.options.verticalOffset=c;c=b.origin;b=e.vec3.add(h.sv3d.get(),c,b.direction);w.reset(c,b);w.point=r;w.camera=k;w.filterPredicate=null;switch(l){case "relative-to-scene":w.intersect(p.layers,
r,k,this.tolerance,null,function(a){return a.metadata&&a.metadata.isElevationSource});this.externalIntersectionHandlers.forEach(function(a){"I3S"!==a.type&&"Terrain"!==a.type||a.intersect(w,a.slicePlane?n:null,w.rayBeginPoint,w.rayEndPoint,r)});break;case "on-the-ground":case "relative-to-ground":this.externalIntersectionHandlers.forEach(function(a){a.isGround&&a.intersect(w,a.slicePlane?n:null,w.rayBeginPoint,w.rayEndPoint,r)})}return w.results.min.getIntersectionPoint(u)?(l=this.view.computeMapPointFromVec3d(u),
l.z=f,l):null};b.prototype.computeIntersection=function(b,c,d){var f=this,l=this.view.state.camera,k=g.castRenderScreenPointArray3(h.sv3d.get());l.projectPoint(b.origin,k);var m=this.prepareFilters(d,t);c.options.storeTerrainResults=m.filterLayerUid(a.TERRAIN_ID);c.options.selectOpaqueTerrainOnly=!d||!("include"in d||"exclude"in d);var p=b.origin,r=e.vec3.add(h.sv3d.get(),b.origin,b.direction);c.reset(p,r);c.intersect(m.layers,k,l,this.tolerance);var q=(b=this.view.slicePlane)?a.sliceFilterPredicate(b):
null;c.intersect(m.sliceableLayers,k,l,this.tolerance,q);var n=d&&(d.terrainLocationFeedbackEnabled||d.enableDraped);this.externalIntersectionHandlers.forEach(function(b){if(b.intersectionHandlerId===a.TERRAIN_ID){if(!n&&!m.filterLayerUid(a.TERRAIN_ID))return}else if(!m.filterLayerUid(b.intersectionHandlerId))return;b.intersect(c,b.slicePlane?q:null,p,r,k)});b=h.sv3d.get();if(d&&d.enableDraped&&c.results.ground.getIntersectionPoint(b)){d=this.view.basemapTerrain.overlayManager.renderer;var u=this.view.renderCoordsHelper.spatialReference,
w=h.sv3d.get();this.view.renderCoordsHelper.fromRenderCoords(b,w,this.view.spatialReference);w[2]=this.view.elevationProvider.getElevation(b[0],b[1],b[2],u)||0;d.intersect(c,w,m.filterRenderGeometry)}c.sortResults();b=c.results.hud;if(b.hasIntersectionPoint){var v=g.castRenderScreenPointArray3(h.sv3d.get()),x=h.sv3d.get(),z=h.sv3d.get();this.unprojectHUDResultRay(b.center,v,x,z);d=e.vec3.distance(b.center,x)/e.vec3.distance(x,z)*.99;this.validateHUDIntersector.reset(x,z);this.validateHUDIntersector.intersect(m.layers,
v,l,this.tolerance);this.validateHUDIntersector.intersect(m.sliceableLayers,v,l,this.tolerance,q);this.externalIntersectionHandlers.forEach(function(a){m.filterLayerUid(a.intersectionHandlerId)&&a.intersect(f.validateHUDIntersector,a.slicePlane?q:null,x,z,v)});l=this.validateHUDIntersector.results.min;if(null==l.dist||d<=l.dist)c.results.min.copyFrom(b),c.results.all.splice(0,0,b)}};b.prototype.prepareFilters=function(a,b){var d=[],e=[];this.layerProvider.forEachLayer(function(a){a.isPickable&&(a.isSliceable?
e:d).push(a)});b.include=a&&a.include;b.exclude=a&&a.exclude;b.layers.length=0;b.sliceableLayers.length=0;c(d,b.filterLayer,b.layers);c(e,b.filterLayer,b.sliceableLayers);return b};b.prototype.unprojectHUDResultRay=function(a,b,c,d){var e=this.view.state.camera;e.projectPoint(a,b);a=g.castRenderScreenPointArray3(h.sv3d.get());a[0]=b[0];a[1]=b[1];a[2]=0;e.unprojectPoint(a,c);a[2]=1;e.unprojectPoint(a,d)};return b}();b.SceneIntersectionHelper=n;var p,t={include:null,exclude:null,layers:[],sliceableLayers:[],
filterLayer:function(a){return t.filterLayerUid(a.apiLayerUid)},filterLayerUid:function(a){var b=t.include,c=t.exclude;return m.isNone(a)?null==b&&null==c:(null==b||b.has(a))&&(null==c||!c.has(a))},filterRenderGeometry:function(a){return t.filterLayerUid(a.data.layerUid)}},u=f.vec3f64.create(),r=g.createRenderScreenPointArray()})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/Accessor ../../../core/Evented ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../layers/graphics/ElevationQuery".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function c(a){a=b.call(this,a)||this;a.providers={im:[],ground:[],scene:[]};a.handles=new Map;return a}m(c,b);c.prototype.getElevation=function(a,b,c,d,e){var f;f=this._updateElevation(null,this.providers.im,a,b,c,d,e);null==f&&(f=this._updateElevation(f,this.providers.ground,a,b,c,d,e));"scene"===e&&(f=this._updateElevation(f,this.providers.scene,a,b,c,d,e));return f};c.prototype._updateElevation=function(a,
b,c,d,e,f,g){for(var h=0;h<b.length;h++){var l=b[h].getElevation(c,d,e,f,g);null!=l&&(a=null!=a?Math.max(l,a):l)}return a};c.prototype.queryElevation=function(b,c,d,e,f,g,l){var k=this;void 0===f&&(f=null);void 0===g&&(g=0);this._elevationService||(this._elevationService=new a.ElevationQuery(this.view.spatialReference,function(){return k.view.map&&k.view.map.ground},{maximumAutoTileRequests:4}));var m=h.createResolver();this._elevationService.queryElevation(b,c,f,g).then(function(a){"scene"===l&&
(a=k._updateElevation(a,k.providers.scene,b,c,d,e,l));m.resolve(a)}).catch(function(a){h.isAbortError(a)?m.reject(a):m.resolve(k.getElevation(b,c,d,e,l))});return m.promise};c.prototype.register=function(a,b){var c=this;this.handles.set(b,b.on("elevation-change",function(a){return c.emit("elevation-change",a)}));this.providers[a].push(b)};c.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,c=Object.keys(this.providers);b<c.length;b++){var d=
c[b],e=this.providers[d].indexOf(a);-1<e&&this.providers[d].splice(e,1)}};k([d.property({constructOnly:!0})],c.prototype,"view",void 0);k([d.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],c.prototype,"spatialReference",void 0);return c=k([d.subclass("esri.views.3d.support.CombinedElevationProvider")],c)}(d.declared(l.EventedMixin(f)));b.CombinedElevationProvider=n})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../geometry ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/scheduling".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a,b){this.spatialReference=a;this.view=b}a.prototype.getElevation=function(a,b,c){return this.view.elevationProvider.getElevation(a,b,0,this.spatialReference,c)};a.prototype.queryElevation=function(a,b,c,d,e){return k(this,void 0,void 0,function(){return m(this,function(f){return[2,this.view.elevationProvider.queryElevation(a,b,0,this.spatialReference,c,d,e)]})})};return a}();b.ViewElevationProvider=
n;n=function(){function b(a,b,c){this.spatialReference=a;this._getElevationQueryProvider=b;this._queries=[];this._isScheduled=!1;this._queryOptions=g({},c,{ignoreInvisibleLayers:!0})}b.prototype.queryElevation=function(a,b,c,e){void 0===e&&(e=0);return k(this,void 0,void 0,function(){var g=this;return m(this,function(h){return[2,d.create(function(h,l){var k={x:a,y:b,minDemResolution:e,result:{resolve:h,reject:l},signal:c};g._queries.push(k);d.onAbort(c,function(){f.remove(g._queries,k);l(d.createAbortError())});
g._scheduleDoQuery()})]})})};b.prototype._scheduleDoQuery=function(){var b=this;this._isScheduled||(a.schedule(function(){return b._doQuery()}),this._isScheduled=!0)};b.prototype._doQuery=function(){return k(this,void 0,void 0,function(){var a,b,c,f,k,n,w,v,z,y,A,B;return m(this,function(m){switch(m.label){case 0:this._isScheduled=!1;a=this._queries;this._queries=[];if(0===a.length)return[2];b=a.map(function(a){return[a.x,a.y]});c=a.reduce(function(a,b){return Math.min(a,b.minDemResolution)},Infinity);
f=new e.Multipoint({points:b,spatialReference:this.spatialReference});k=this._getElevationQueryProvider();if(!k)return a.forEach(function(a){return a.result.reject()}),[2];n=1<a.length&&a.some(function(a){return!!a.signal})?d.createAbortController():null;w=h.isSome(n)?n.signal:a[0].signal;h.isSome(n)&&(v=0,a.forEach(function(b){return d.onAbort(b.signal,function(){v++;b.result.reject(d.createAbortError());v===a.length&&n.abort()})}));z=g({},this._queryOptions,{minDemResolution:c,signal:w});return[4,
l.result(k.queryElevation(f,z))];case 1:y=m.sent();for(A=0;A<a.length;A++)B=a[A],h.isSome(B.signal)&&B.signal.aborted?B.result.reject(d.createAbortError()):!1===y.ok?B.result.reject(y.error):B.result.resolve(y.value.geometry.points[A][2]);return[2]}})})};return b}();b.ElevationQuery=n})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require","exports","../../../core/has"],function(n,b,m){function k(){var b=!!m("esri-mobile");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,
maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1},sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,
maxTotalNumberOfPrimitives:17E5,polygonLodFactor:b?.8:1,polylineLodFactor:b?1.2:1.5},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:b},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!m("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!1,memoryLimit:b?600:750,additionalCacheMemory:b?0:150,frameRate:0,maximumRenderResolution:null,
maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:b?1.2:2,polylineLodFactor:b?1.2:2},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!m("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,
memoryLimit:b?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:b?null:4096,maximumPixelRatio:b?1:null}}}n=function(){function b(){}b.isValidProfile=function(e){return e in b.profiles};b.getDefaultProfile=function(){return m("esri-iPhone")?"low":"medium"};b.apply=function(e,f){e=b.profiles[e];f.graphics3D.maxTotalNumberOfFeatures=e.graphics3D.maxTotalNumberOfFeatures;f.graphics3D.maxTotalNumberOfPrimitives=e.graphics3D.maxTotalNumberOfPrimitives;f.graphics3D.polygonLodFactor=e.graphics3D.polygonLodFactor;
f.graphics3D.polylineLodFactor=e.graphics3D.polylineLodFactor;f.sceneService["3dObject"].lodFactor=e.sceneService["3dObject"].lodFactor;f.sceneService.point.lodFactor=e.sceneService.point.lodFactor;f.sceneService.integratedMesh.lodFactor=e.sceneService.integratedMesh.lodFactor;f.sceneService.pointCloud.lodFactor=e.sceneService.pointCloud.lodFactor;f.sceneService.uncompressedTextureDownsamplingEnabled=e.sceneService.uncompressedTextureDownsamplingEnabled;f.tiledSurface.lodBias=e.tiledSurface.lodBias;
f.tiledSurface.angledSplitBias=e.tiledSurface.angledSplitBias;f.tiledSurface.reduceTileLevelDifferences=e.tiledSurface.reduceTileLevelDifferences;f.tiledSurface.textureFadeDuration=e.tiledSurface.textureFadeDuration;f.antialiasingEnabled=e.antialiasingEnabled;f.physicallyBasedRenderingEnabled=e.physicalBasedRenderingEnabled;f.memoryLimit=e.memoryLimit;f.additionalCacheMemory=e.additionalCacheMemory;f.frameRate=e.frameRate;f.maximumRenderResolution=e.maximumRenderResolution;f.maximumPixelRatio=e.maximumPixelRatio};
b.debug={reset:function(){var e=k(),f;for(f in e)b.profiles[f]=e[f]}};return b}();(n||(n={})).profiles=k();return n})},"esri/views/3d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4f32".split(" "),function(n,b,m,k,g,e,f,l,h){return function(b){function a(){var a=null!==
b&&b.apply(this,arguments)||this;a.color=new g([0,255,255]);a.haloColor=null;a.haloOpacity=1;a.fillOpacity=.25;return a}m(a,b);a.toEngineOptions=function(a){var b=g.toUnitRGBA(a.color),c=f.isSome(a.haloColor)?g.toUnitRGBA(a.haloColor):b;return{color:h.vec4f32.fromValues(b[0],b[1],b[2],b[3]),haloColor:h.vec4f32.fromValues(c[0],c[1],c[2],c[3]),haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};k([l.property({type:g})],a.prototype,
"color",void 0);k([l.property({type:g})],a.prototype,"haloColor",void 0);k([l.property()],a.prototype,"haloOpacity",void 0);k([l.property()],a.prototype,"fillOpacity",void 0);return a=k([l.subclass("esri.views.3d.support.HighlightOptions")],a)}(l.declared(e))})},"esri/core/libs/gl-matrix-2/vec4f32":function(){define(["require","exports","./factories/vec4f32"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.vec4f32=m})},"esri/core/libs/gl-matrix-2/factories/vec4f32":function(){define(["require",
"exports"],function(n,b){function m(){return new Float32Array(4)}function k(b,a,c,e){var d=new Float32Array(4);d[0]=b;d[1]=a;d[2]=c;d[3]=e;return d}function g(){return k(1,1,1,1)}function e(){return k(1,0,0,0)}function f(){return k(0,1,0,0)}function l(){return k(0,0,1,0)}function h(){return k(0,0,0,1)}Object.defineProperty(b,"__esModule",{value:!0});b.create=m;b.clone=function(b){var a=new Float32Array(4);a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};b.fromValues=k;b.createView=function(b,a){return new Float32Array(b,
a,4)};b.zeros=function(){return m()};b.ones=g;b.unitX=e;b.unitY=f;b.unitZ=l;b.unitW=h;b.ZEROS=m();b.ONES=g();b.UNIT_X=e();b.UNIT_Y=f();b.UNIT_Z=l();b.UNIT_W=h()})},"esri/views/3d/support/index":function(){define(["require","exports","../../../core/MapUtils","./ResourceController","./MemoryController"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.ResourceControllerMaster=k.ResourceControllerMaster;b.newResourceController=k.newResourceController;b.newMemoryController=g.newMemoryController;
b.downloadSlotsPerClient=m.MapFromValues([[0,15],[1,15],[2,20],[3,5]]);b.maxDownloadSlots=30})},"esri/views/3d/support/ResourceController":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/Handles ../../../core/now ../../../core/scheduling ../../../core/accessorSupport/decorators ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,
q){Object.defineProperty(b,"__esModule",{value:!0});var p=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.updating=!1;return b}k(b,a);m([h.property({readOnly:!0})],b.prototype,"updating",void 0);return b=m([h.subclass("esri.views.3d.support.ResourceController")],b)}(h.declared(g));b.ResourceControllerMaster=p;b.newResourceController=function(a,b){void 0===b&&(b=f);return new t.ResourceController({view:a,now:b})};var t;(function(b){var f=function(b){function f(){var a=null!==
b&&b.apply(this,arguments)||this;a._scheduler=null;a._memoryController=null;a._streamDataLoader=null;a._cameraChangeTime=0;a._handles=new e;a._frameTask=null;return a}k(f,b);f.prototype.initialize=function(){var b=this;this._cameraChangeTime=this.now();this._scheduler=q.newScheduler(this.now);this._memoryController=a.newMemoryController(this.view);this._streamDataLoader=new c.default;this._streamDataLoader.setup(d.maxDownloadSlots,d.downloadSlotsPerClient,this._scheduler);this._handles.add([this.view.watch("state.camera",
function(){return b._cameraChangedHandler()},!0),this.view.watch("stationary",function(){return b._stationaryChangedHandler()}),this._memoryController.events.on("updating-changed",function(){return b.notifyChange("updating")})]);this._frameTask=l.addFrameTask({update:function(a){return b.frame(a)}})};f.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=
null);this._memoryController.destroy();this._memoryController=null;this._scheduler.destroy();this._scheduler=null};Object.defineProperty(f.prototype,"updating",{get:function(){return!!(this._memoryController&&this._memoryController.updating||this._streamDataLoader&&this._streamDataLoader.updating)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"scheduler",{get:function(){return this._scheduler},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"memoryController",
{get:function(){return this._memoryController},enumerable:!0,configurable:!0});f.prototype.createStreamDataRequester=function(a){var b=this._streamDataLoader;return{request:function(c,d,e){return b.request(c,d,a,e)},get busy(){return b.busy}}};f.prototype.frame=function(a){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(a.deltaTime/1E3),!this._scheduler))return;this._scheduler.state=this.state;this._scheduler.updateBudget(a)?(this._memoryController.update(),this._scheduler.frame()):
this._memoryController.updating&&this._memoryController.update()}};f.prototype._cameraChangedHandler=function(){this._cameraChangeTime=this._scheduler.now;this._scheduler.state=this.state};f.prototype._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};Object.defineProperty(f.prototype,"state",{get:function(){var a=this.view;return a.animation?0:a.interacting||this._scheduler.now-this._cameraChangeTime<=g?1:2},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"test",{get:function(){var a=this;return{getQueueStats:function(b){return a._streamDataLoader.test.loadQueue.getStatsForType(b)},state:this.state}},enumerable:!0,configurable:!0});m([h.property({constructOnly:!0})],f.prototype,"view",void 0);m([h.property({constructOnly:!0})],f.prototype,"now",void 0);m([h.property()],f.prototype,"_streamDataLoader",void 0);m([h.property({readOnly:!0,dependsOn:["_streamDataLoader.updating"]})],f.prototype,"updating",null);return f=m([h.subclass("esri.views.3d.support.ResourceController")],
f)}(h.declared(p));b.ResourceController=f;var g=300})(t||(t={}))})},"esri/views/3d/support/MemoryController":function(){define("require exports ../../../core/Evented ../../../core/Logger ../../../core/MemCache ../layers/support/MemoryManagedLayerView".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});var f=k.getLogger("esri.views.3d.support.MemoryController");b.newMemoryController=function(b){return new l(b)};var l=function(){function b(b){this._view=b;this.events=
new m;this.minQuality=.1;this._maxMemory=500;this._additionalCacheMemory=100;this._quality=1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=this._memoryUsed=0;this._cacheStorage=new g.MemCacheStorage;this._numQualityChanges=0;this._updating=!1}b.prototype.destroy=function(){this.events=null};b.prototype.getMemCache=function(b,a){return new g.MemCache(b,this._cacheStorage,a)};Object.defineProperty(b.prototype,"maxMemory",{get:function(){return this._maxMemory},
set:function(b){null!=b&&0<b&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<b&&this._updateQuality(1),this._maxMemory=b)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"additionalCacheMemory",{set:function(b){null!=b&&0<=b&&(this._additionalCacheMemory=b)},enumerable:!0,configurable:!0});b.prototype.disableMemCache=function(){this._additionalCacheMemory=-4096};Object.defineProperty(b.prototype,"memoryFactor",{get:function(){return this._quality},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return this._updating},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"usedMemory",{get:function(){return this._memoryUsed},enumerable:!0,configurable:!0});b.prototype.resetStableQuality=function(){this._stableQuality=0};b.prototype.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var b=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=
this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(b){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=
!1,b=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._memoryUsed&&1>this._quality?(this._stableQuality=this._quality,b=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this.updating!==b&&(this._updating=b,this.events.emit("updating-changed",this.updating))}};b.prototype._updateQuality=function(b){b=Math.min(Math.max(b,this.minQuality),1);if(b===this._quality)return!1;this._quality=
b;this.events.emit("quality-changed",this._quality);++this._numQualityChanges;return!0};b.prototype._layersUpdating=function(){return this._view.allLayerViews.some(function(b){return!!b.updating})};b.prototype._updateMemory=function(){var b=this,a=0,c=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(a+=this._view.basemapTerrain.getUsedMemory());var g=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;g&&(a+=g.getUsedMemory());this._view.allLayerViews&&
this._view.allLayerViews.forEach(function(d){if(e.isMemoryManagedLayerView(d)){var f=d.ignoresMemoryFactor()?b._quality:1;a+=d.getUsedMemory()*f;c+=d.getUnloadedMemory()*f}});var h=null==this._warnMemoryUsage||Math.round(10*a)!==Math.round(10*this._warnMemoryUsage),g=1048576*this._maxMemory;if(a>g&&h){this._warnMemoryUsage=a;var h=function(a){return(a/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB"},l=Math.round(100*this._quality);f.warn("Memory Limit exceeded! Limit: "+h(g)+" Current: "+
h(a)+" Projected: "+h(a+c)+" Quality: "+l+"%")}this._memoryUsed=a/g;this._memoryPredicted=(a+c)/g;this._cacheStorage.maxSize=Math.max(0,g-a+1048576*this._additionalCacheMemory);this.events.emit("memory-used",this._memoryUsed)};Object.defineProperty(b.prototype,"test",{get:function(){return{cacheStorage:this._cacheStorage,numQualityChanges:this._numQualityChanges}},enumerable:!0,configurable:!0});return b}()})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["require","exports"],
function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.isMemoryManagedLayerView=function(b){return"function"===typeof b.getUsedMemory}})},"esri/views/3d/support/StreamDataLoader":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/now ../../../core/promiseUtils ../../../core/accessorSupport/decorators ./AsyncWorkerQueue ./StreamDataLoaderTask ../webgl-engine/lib/Util ../../../views/support/Scheduler".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x){function w(a){if(2>a.byteLength)return"unknown";a=new Uint8Array(a,0,a.byteLength);return 137===a[0]&&80===a[1]?"image/png":71===a[0]&&73===a[1]?"image/gif":66===a[0]&&77===a[1]?"image/bmp":255===a[0]&&216===a[1]?"image/jpeg":"unknown"}Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function f(){var a=null!==b&&b.apply(this,arguments)||this;a.tasks=new Map;a.onLoadQueue=[];a.doneQueue=[];a.updating=!1;return a}k(f,b);f.prototype.setup=function(a,
b,c){var d=this;this.loadQueue=new t.AsyncWorkerQueue(function(a,b){return d.startLoading(a,b)},function(a,b){return d.doneLoadingCallback(a,b)},a,b);c&&(this.taskHandle=c.registerTask(x.Task.STREAM_DATA_LOADER,function(a){return d.update(a)},function(){return 0<d.doneQueue.length||0<d.onLoadQueue.length}))};f.prototype.destroy=function(){this.taskHandle&&(this.taskHandle.remove(),this.taskHandle=null);this.tasks.forEach(function(a){a.abortController&&a.abortController.abort()});this.loadQueue.clear();
this.tasks=this.doneQueue=this.onLoadQueue=this.loadQueue=null};Object.defineProperty(f.prototype,"busy",{get:function(){return this.loadQueue.busy},enumerable:!0,configurable:!0});f.prototype.request=function(b,c,d,e){var f=this;void 0===e&&(e={});var g=q.createResolver();g.__signal=a.isSome(e)?e.signal:null;var h=this.createOrUpdateTask(b,c,d,e,g);q.onAbort(e,function(){return f.cancelRequest(h,g)});return g.promise};f.prototype.createTask=function(a,b,c,d,e,f){a=new u.default(a,b,c,d,e);this.updateTask(a,
f);this.tasks.set(e,a);1===this.tasks.size&&this._set("updating",!0);this.loadQueue.push(a);return a};f.prototype.cancelRequest=function(a,b){l.removeUnordered(a.resolvers,b);b.reject(q.createAbortError());0===a.resolvers.length&&(2===a.status&&(a.status=4,this.loadQueue.cancel(a),a.abortController.abort(),a.request=null,a.abortController=null),a.status=4,this.tasks.delete(a.key),0===this.tasks.size&&this._set("updating",!1))};f.prototype.taskKey=function(a,b,c){return a+":"+b+":"+c};f.prototype.updateTask=
function(a,b){a.resolvers.push(b)};f.prototype.createOrUpdateTask=function(b,c,d,e,f){var g=a.isSome(e)&&e.uid||b,g=this.taskKey(g,c,d),h=this.tasks.get(g);return h?(this.updateTask(h,f),h):this.createTask(b,e,c,d,g,f)};f.prototype.doneLoadingCallback=function(a,b){this.loadQueue&&(r.assert(2===a.status),a.status=3,this.taskHandle?this.doneQueue.push({task:a,err:b}):this.doneLoading(a,b))};f.prototype.update=function(a){for(;!a.done&&0<this.onLoadQueue.length;){var b=this.onLoadQueue.shift();q.throwIfAborted(b.task.abortController);
b.task.abortController=null;b.callback(b.task);a.madeProgress()}for(;!a.done&&0<this.doneQueue.length;)b=this.doneQueue.shift(),3!==b.task.status&&(b.err=b.err||q.createAbortError()),this.doneLoading(b.task,b.err),a.madeProgress()};f.prototype.doneLoading=function(a,b){for(var c=a.result instanceof HTMLImageElement?0:a.resolvers.length,e=0,f=a.resolvers;e<f.length;e++){var g=f[e];if(b)q.isAbortError(b)?g.reject(b):g.reject(new h("stream-data-loader:request-error","Failed to request resource at '"+
a.url+"'. "+b,{url:a.url,error:b}));else{--c;var l=0>=c?a.result:d.clone(a.result);g.resolve(l)}}this.tasks.delete(a.key);0===this.tasks.size&&this._set("updating",!1)};f.prototype.startLoading=function(a,b){var d=this;if(4===a.status)return!1;a.startTime=c();a.status=2;var f,h;switch(a.docType){case "binary":h="array-buffer";f=0;break;case "image":h="image";break;case "image+type":h="array-buffer";break;default:h="json"}a.abortController=q.createAbortController();var l=a.abortController.signal;a.request=
e(a.url,g({},a.options,{responseType:h,timeout:f,signal:l}));var k=function(){},m=function(e){a.duration=c()-a.startTime;a.size=e instanceof ArrayBuffer?e.byteLength:a.size||0;a.result=e;d.taskHandle?d.onLoadQueue.push({callback:b,task:a}):(a.abortController=null,b(a))},p=function(c){2===a.status&&b(a,c);k()};if("image+type"!==a.docType)return a.request.then(function(a){return m(a.data)},p),!0;a.request.then(function(b){b=b.data;var c=w(b);h="image";a.size=b.byteLength;if("unknown"===c)a.request=
e(a.url,{responseType:h,timeout:f,signal:l}),a.request.then(function(a){return m(a.data)},p);else{b=new Blob([b],{type:c});var d=window.URL.createObjectURL(b);k=function(){return window.URL.revokeObjectURL(d)};a.request=e(d,{responseType:h,timeout:f,signal:l});a.request.then(function(a){return m(new v(a.data,c,k))},p)}},p);return!0};Object.defineProperty(f.prototype,"test",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,configurable:!0});m([p.property({readOnly:!0})],f.prototype,"updating",
void 0);return f=m([p.subclass("esri.views.3d.support.StreamDataLoader")],f)}(p.declared(f));b.StreamDataLoader=n;var v=function(){return function(a,b,c){this.image=a;this.type=b;this.release=c}}();b.ImageWithType=v;b.default=n})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["require","exports","../webgl-engine/lib/Util"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(b){this.clientType=b;this._cancelled=!1;this.duration=this.size=0}}();
b.BaseTask=n;n=function(){function b(b,e,f,l){var g=this;this._workerFunc=b;this._callbackFunc=e;this._maxTotalNumWorkers=f;this._type2id=new Map;this._tasks=[];this._typeNumWorkers=[];this._typeWorkerQuota=[];this._typeStatistics=[];this._totalNumWorkers=0;l.forEach(function(b,a){g._type2id.set(a,g._tasks.length);g._tasks.push([]);g._typeNumWorkers.push(0);g._typeStatistics.push({requests:0,size:0,duration:0,speed:0});g._typeWorkerQuota.push(b)})}Object.defineProperty(b.prototype,"numTypes",{get:function(){return this._tasks.length},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"busy",{get:function(){return this._totalNumWorkers>=this._maxTotalNumWorkers},enumerable:!0,configurable:!0});b.prototype.push=function(b){var e=this,f=this._type2id.get(b.clientType);this._totalNumWorkers<this._maxTotalNumWorkers?(this._typeNumWorkers[f]++,this._totalNumWorkers++,this._workerFunc(b,function(b,f){return e._taskCallback(b,f)})):this._tasks[f].push(b)};b.prototype.getStatsForType=function(b){b=this._type2id.get(b);return{quota:this._typeWorkerQuota[b],
workers:this._typeNumWorkers[b],queueSize:this._tasks[b].length,requestStats:this._typeStatistics[b]}};b.prototype.cancel=function(b){this._taskFinished(b);b._cancelled=!0};b.prototype.clear=function(){for(var b=0;b<this._tasks.length;b++)this._tasks[b]=[]};b.prototype._taskFinished=function(b){var e=this._type2id.get(b.clientType);this._typeNumWorkers[e]--;this._totalNumWorkers--;this._typeStatistics[e].requests++;this._typeStatistics[e].size+=b.size||0;this._typeStatistics[e].duration+=b.duration||
0;this._typeStatistics[e].speed=0<this._typeStatistics[e].duration?this._typeStatistics[e].size/this._typeStatistics[e].duration:0;m.assert(0<=this._typeNumWorkers[e]);this._next()};b.prototype._next=function(){for(var b=0;b<this.numTypes;++b){if(this._typeNumWorkers[b]<this._typeWorkerQuota[b]&&this._processQueue(b))return;++b}for(b=0;b<this.numTypes&&!this._processQueue(b);++b);};b.prototype._processQueue=function(b){for(var e=this;0<this._tasks[b].length;)if(this._workerFunc(this._tasks[b].shift(),
function(b,g){return e._taskCallback(b,g)}))return this._typeNumWorkers[b]++,this._totalNumWorkers++,!0;return!1};b.prototype._taskCallback=function(b,e){b._cancelled||(this._callbackFunc(b,e),this._taskFinished(b))};Object.defineProperty(b.prototype,"test",{get:function(){var b=this;return{set workerFunc(e){b._workerFunc=e}}},enumerable:!0,configurable:!0});return b}();b.AsyncWorkerQueue=n})},"esri/views/3d/support/StreamDataLoaderTask":function(){define(["require","exports","../../../core/tsSupport/extendsHelper",
"./AsyncWorkerQueue"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(e,g,h,d,a){d=b.call(this,d)||this;d.url=e;d.options=g;d.docType=h;d.key=a;d.result=null;d.status=1;d.request=null;d.abortController=null;d.resolvers=[];d.startTime=0;return d}m(e,b);return e}(k.BaseTask);b.default=n})},"esri/views/3d/support/MapCoordsHelper":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters".split(" "),
function(n,b,m,k,g,e,f,l,h){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,d){void 0===d&&(d=null);this.spatialReference=b;this.unitInMeters=f.getMetersPerUnitForSR(this.spatialReference);this._geometryServicePromise=this.loadGeometryService(a,d)}b.prototype.loadGeometryService=function(a,b){return k(this,void 0,void 0,function(){return m(this,function(c){switch(c.label){case 0:if(b)return[2,b];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,l.create(a&&a.get("portalItem"))];
case 2:return[2,c.sent()];case 3:throw c.sent(),new e("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");case 4:return[2]}})})};b.prototype.toGeographic=function(a){return k(this,void 0,void 0,function(){var b,d,e,f,l,k,n,w=this;return m(this,function(c){switch(c.label){case 0:return[4,this._geometryServicePromise];case 1:return b=c.sent(),d=!0,Array.isArray(a[0])&&"number"!==typeof a[0]?e=a:(e=[a],d=!1),f=e.map(function(a){return a instanceof g.Point?a:new g.Point(a,
w.spatialReference)}),l=new h({geometries:f,outSpatialReference:g.SpatialReference.WGS84}),[4,b.project(l)];case 2:return k=c.sent(),n=k.map(function(a){return"point"===a.type?[a.x,a.y]:void 0}),[2,d?n:n[0]]}})})};return b}();b.MapCoordsHelper=n;b.default=n})},"esri/portal/support/geometryServiceUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../config ../../core/Error ../Portal ../../tasks/GeometryService ../../tasks/support/ProjectParameters @dojo/framework/shim/Promise".split(" "),
function(n,b,m,k,g,e,f,l,h){function d(a,b){void 0===a&&(a=null);return k(this,void 0,void 0,function(){var c;return m(this,function(d){switch(d.label){case 0:if(g.geometryServiceUrl)return[2,new l({url:g.geometryServiceUrl})];if(!a)throw new e("internal:geometry-service-url-not-configured");c="portal"in a?a.portal||f.getDefault():a;return[4,c.load({signal:b})];case 1:d.sent();if(c.helperServices&&c.helperServices.geometry&&c.helperServices.geometry.url)return[2,new l({url:c.helperServices.geometry.url})];
throw new e("internal:geometry-service-url-not-configured");}})})}Object.defineProperty(b,"__esModule",{value:!0});b.create=d;b.projectGeometry=function(a,b,f,g){void 0===f&&(f=null);return k(this,void 0,void 0,function(){var c,l,k;return m(this,function(m){switch(m.label){case 0:return[4,d(f,g)];case 1:return c=m.sent(),l=new h,l.geometries=[a],l.outSpatialReference=b,[4,c.project(l,{signal:g})];case 2:if((k=m.sent())&&Array.isArray(k)&&1===k.length)return[2,k[0]];throw new e("internal:geometry-service-projection-failed");
}})})}})},"esri/views/3d/support/QualitySettings":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(n,b,m,k,g,e){var f=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.minTotalNumberOfFeatures=2E3;b.maxTotalNumberOfFeatures=5E4;b.maxTotalNumberOfPrimitives=17E5;b.polygonLodFactor=1;b.polylineLodFactor=1;return b}m(b,a);k([e.property()],
b.prototype,"minTotalNumberOfFeatures",void 0);k([e.property()],b.prototype,"maxTotalNumberOfFeatures",void 0);k([e.property()],b.prototype,"maxTotalNumberOfPrimitives",void 0);k([e.property()],b.prototype,"polygonLodFactor",void 0);k([e.property()],b.prototype,"polylineLodFactor",void 0);return b=k([e.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],b)}(e.declared(g)),l=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.lodFactor=1;return b}m(b,a);k([e.property()],
b.prototype,"lodFactor",void 0);return b=k([e.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],b)}(e.declared(g)),h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b["3dObject"]=new l;b.point=new l;b.integratedMesh=new l;b.pointCloud=new l;b.uncompressedTextureDownsamplingEnabled=!1;return b}m(b,a);k([e.property({type:l})],b.prototype,"3dObject",void 0);k([e.property({type:l})],b.prototype,"point",void 0);k([e.property({type:l})],b.prototype,"integratedMesh",
void 0);k([e.property({type:l})],b.prototype,"pointCloud",void 0);k([e.property()],b.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return b=k([e.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],b)}(e.declared(g)),d=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.lodBias=0;b.angledSplitBias=1;b.reduceTileLevelDifferences=!0;b.textureFadeDuration=500;return b}m(b,a);k([e.property()],b.prototype,"lodBias",void 0);k([e.property()],b.prototype,
"angledSplitBias",void 0);k([e.property()],b.prototype,"reduceTileLevelDifferences",void 0);k([e.property()],b.prototype,"textureFadeDuration",void 0);return b=k([e.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],b)}(e.declared(g));return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.graphics3D=new f;b.sceneService=new h;b.tiledSurface=new d;b.antialiasingEnabled=!0;return b}m(b,a);k([e.property({type:f})],b.prototype,"graphics3D",void 0);k([e.property({type:h})],
b.prototype,"sceneService",void 0);k([e.property({type:d})],b.prototype,"tiledSurface",void 0);k([e.property()],b.prototype,"antialiasingEnabled",void 0);k([e.property()],b.prototype,"physicallyBasedRenderingEnabled",void 0);k([e.property()],b.prototype,"memoryLimit",void 0);k([e.property()],b.prototype,"additionalCacheMemory",void 0);k([e.property()],b.prototype,"frameRate",void 0);k([e.property()],b.prototype,"maximumRenderResolution",void 0);k([e.property()],b.prototype,"maximumPixelRatio",void 0);
return b=k([e.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],b)}(e.declared(g))})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/compilerUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../geometry/SpatialReference ../../../layers/graphics/dehydratedFeatures ./earthUtils ./geometryUtils ./projectionUtils ./stack ./geometryUtils/coordinateSystem".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,c,d){this.type=a;this.spatialReference=b;this.unitInMeters=c;this.coordinateSystem=d;this.tmpCoordinateSystem=p.create(d)}Object.defineProperty(b.prototype,"extent",{set:function(a){a&&p.setExtent(this.coordinateSystem,a,this.coordinateSystem)},enumerable:!0,configurable:!0});b.prototype.getAltitude=function(a){return p.altitudeAt(this.coordinateSystem,a)};b.prototype.setAltitude=function(a,
b){p.setAltitudeAt(this.coordinateSystem,b,a,b)};b.prototype.setAltitudeOfTransformation=function(a,b){p.setAltitudeOfTransformation(this.coordinateSystem,b,a,b)};b.prototype.worldUpAtPosition=function(a,b){return p.normalAt(this.coordinateSystem,a,b)};b.prototype.worldBasisAtPosition=function(a,b,c){return p.axisAt(this.coordinateSystem,a,b,c)};b.prototype.basisMatrixAtPosition=function(a,b){var c=this.worldBasisAtPosition(a,0,q.sv3d.get()),d=this.worldBasisAtPosition(a,1,q.sv3d.get());a=this.worldBasisAtPosition(a,
2,q.sv3d.get());e.mat4.set(b,c[0],c[1],c[2],0,d[0],d[1],d[2],0,a[0],a[1],a[2],0,0,0,0,1);return b};b.prototype.intersectManifoldClosestSilhouette=function(a,b,c){p.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);p.intersectRayClosestSilhouette(this.tmpCoordinateSystem,a,c);return c};b.prototype.intersectManifold=function(a,b,c){p.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);b=q.sv3d.get();return p.intersectRay(this.tmpCoordinateSystem,a,b)?(f.vec3.copy(c,b),!0):!1};b.prototype.intersectInfiniteManifold=
function(b,c,d){if("global"===this.type)return this.intersectManifold(b,c,d);p.elevate(this.coordinateSystem,c,this.tmpCoordinateSystem);c=this.tmpCoordinateSystem.value;var e=q.sv3d.get();return a.plane.intersectRay(c.plane,b,e)?(f.vec3.copy(d,e),!0):!1};b.prototype.toRenderCoords=function(a,b,d){return h.isPoint(a)?c.pointToVector(a,b,this.spatialReference):c.vectorToVector(a,b,d,this.spatialReference)};b.prototype.fromRenderCoords=function(a,b,d){return h.isPoint(b)?c.vectorToPoint(a,this.spatialReference,
b,d):b instanceof l?c.vectorToPoint(a,this.spatialReference,b):c.vectorToVector(a,this.spatialReference,b,d)};b.createGlobal=function(c){var e=p.fromValues(a.sphere,a.sphere.fromValues(d.earthRadius,[0,0,0]));return new b("global",c,1,e)};b.createLocal=function(c){var d=p.fromValues(a.boundedPlane,a.boundedPlane.fromValues([0,0,0],[t,0,0],[0,t,0])),e=g.getMetersPerUnitForSR(c);return new b("local",c,e,d)};b.createMode=function(a,c){switch(a){case "local":return b.createLocal(c);case "global":return b.createGlobal(c);
default:k.neverReached(a)}};return b}();b.RenderCoordsHelper=n;var t=Math.pow(2,50)})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["require","exports","../layers/support/MemoryManagedLayerView","./LayerPerformanceInfo","../terrain/terrainUtils"],function(n,b,m,k,g){return function(){return function(b){var e=this;this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];var l=b.resourceController.memoryController;
this.totalMemory=1048576*l.maxMemory;this.usedMemory=Math.round(l.usedMemory*this.totalMemory);this.quality=l.memoryFactor;this.load=b.resourceController.scheduler.load;this.terrainMemory=b.basemapTerrain?b.basemapTerrain.getUsedMemory():0;this.edgesMemory=(l=b._stage&&b._stage.renderView&&b._stage.renderView.edgeView)?l.getUsedMemory():0;b.allLayerViews.items.forEach(function(f){(m.isMemoryManagedLayerView(f)||g.isSurfaceLayerView(f))&&e.layerPerformanceInfos.push(new k(f,b))});this.layerPerformanceInfos.sort(function(b,
d){return d.memory-b.memory})}}()})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(["require","exports","../layers/support/PerformanceInfoLayerView","../terrain/terrainUtils"],function(n,b,m,k){return function(){return function(b,e){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=b.layer;this.memory=k.isSurfaceLayerView(b)?e.basemapTerrain.getUsedMemoryForLayerView(b):b.getUsedMemory();m.isPerformanceInfoLayerView(b)&&
(b=b.performanceInfo,this.displayedNumberOfFeatures=b.displayedNumberOfFeatures,this.maximumNumberOfFeatures=b.maximumNumberOfFeatures,this.totalNumberOfFeatures=b.totalNumberOfFeatures)}}()})},"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.isPerformanceInfoLayerView=function(b){return"performanceInfo"in b}})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ../../../layers/ElevationLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ./terrainUtilsPlanar ./terrainUtilsSpherical".split(" "),
function(n,b,m,k,g,e,f){function l(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function h(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}function d(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function a(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function c(a,b,c,d){return q["local"===d||"planar"===d?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,c,b)}Object.defineProperty(b,
"__esModule",{value:!0});var q={planar:e,spherical:f};b.weakAssert=function(a,b){a||console.warn("Terrain: "+b)};b.autoUpdateSkirtsVisibility=function(a,b,c,d){var e=q[a.manifold],f=e.isInsideExtent(a,b);f?c=a.getElevation(b[0],b[1],b[1],c):(c=a.elevationBounds,c=.5*(c.min+c.max));c=b[2]-c;d=Math.abs(c)<d?0:0>c?-1:1;f||(e.isInsideExtent(a,b,a.hideSkirtsDistanceFromExtentMargin)?(b=e.tiltToExtentEdge(a,b),b>a.hideSkirtsMinimumCameraTilt&&b<a.hideSkirtsMaximumCameraTilt&&(d=0)):d=0);a.skirtScale=d};
b.isVectorTileLayer=function(a){return a&&a instanceof g};b.isTileLayerView=l;b.isVectorTileLayerView=h;b.isWMTSLayerView=d;b.isElevationLayerView=a;b.isSurfaceLayerView=function(b){return b&&(l(b)||a(b)||h(b)||d(b))};b.useFetchTileForLayer=function(a){return a.fetchTile&&!(a.fetchTile===k.prototype.fetchTile||a.fetchTile===m.prototype.fetchTile)};b.checkIfTileInfoSupportedForView=c;b.getTiledLayerInfo=function(a,d,e){var f,g;if("wmts"===a.type){if(a=a.activeLayer){var h=a.tileMatrixSet;if(h)f=h.tileInfo,
g=h.fullExtent;else if(a=a.tileMatrixSets)if(a=a.find(function(a){return null==c(a.tileInfo,a.fullExtent,d,e)}))return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}else f="vector-tile"!==a.type||b.test.force512VTL?a.tileInfo:a.compatibleTileInfo256,g=a.fullExtent;return f&&g&&null==c(f,g,d,e)?{tileInfo:f,fullExtent:g}:{tileInfo:null,fullExtent:null}};b.test={force512VTL:!1}})},"esri/layers/ElevationLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../request ../core/deprecate ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/HeightModelInfo ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./support/commonProperties ./support/LercWorker".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B){var C=a.getLogger("esri.layers.ElevationLayer");return function(a){function b(b){b=a.call(this,b)||this;b.copyright=null;b.heightModelInfo=null;b.path=null;b.opacity=1;b.operationalLayerType="ArcGISTiledElevationServiceLayer";b.sourceJSON=null;b.type="elevation";b.url=null;b.version=null;b._lercWorker=B.acquireInstance();return b}k(b,a);b.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?m({url:a},b):a};b.prototype.destroy=
function(){B.releaseInstance(this._lercWorker);this._lercWorker=null};Object.defineProperty(b.prototype,"minScale",{get:function(){},set:function(a){this.constructed&&C.warn(this.declaredClass+".minScale support has been removed (since 4.5)")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxScale",{get:function(){},set:function(a){this.constructed&&C.warn(this.declaredClass+".maxScale support has been removed (since 4.5)")},enumerable:!0,configurable:!0});b.prototype.readVersion=
function(a,b){(a=b.currentVersion)||(a=9.3);return a};b.prototype.load=function(a){var b=this,e=c.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(a){for(var b=0;b<a.typeKeywords.length;b++)if("elevation 3d layer"===a.typeKeywords[b].toLowerCase())return!0;throw new d("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"});
}},a).then(function(){return b._fetchImageService(e)},function(){return b._fetchImageService(e)}));return p.resolve(this)};b.prototype.fetchTile=function(a,b,c,d){var e=this;void 0===d&&(d={});null!=d&&"number"===typeof d&&(h.deprecated(C,"Passing 'noDataValue' directly as a parameter",{replacement:"use { noDataValue } options object instead",version:"4.12"}),d={noDataValue:d});var f={responseType:"array-buffer",signal:d.signal},g={noDataValue:d.noDataValue,returnFileInfo:!0};return this.load().then(function(){return e._fetchTileAvailability(a,
b,c,d)}).then(function(){return l(e.getTileUrl(a,b,c),f)}).then(function(a){return e._lercWorker.decode(a.data,g,d.signal)}).then(function(a){return{values:a.pixelData,width:a.width,height:a.height,maxZError:a.fileInfo.maxZError,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue}})};b.prototype.getTileUrl=function(a,b,c){var d=t.objectToQuery(m({},this.parsedUrl.query,{blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null}));return this.parsedUrl.path+"/tile/"+a+"/"+b+"/"+c+
(d?"?"+d:"")};b.prototype.queryElevation=function(a,b){var c=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).query(c,a,b)})};b.prototype.createElevationSampler=function(a,b){var c=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).createSampler(c,a,b)})};b.prototype._fetchTileAvailability=function(a,b,c,d){return this.tilemapCache?this.tilemapCache.fetchAvailability(a,b,c,d):p.resolve("unknown")};b.prototype._fetchImageService=
function(a){return f(this,void 0,void 0,function(){var b,c;return e(this,function(d){switch(d.label){case 0:if(this.sourceJSON)return[2,this.sourceJSON];b={query:m({f:"json"},this.parsedUrl.query),responseType:"json",signal:a};return[4,l(this.parsedUrl.path,b)];case 1:return c=d.sent(),c.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=c.data,this.read(c.data,{origin:"service",url:this.parsedUrl}),[2]}})})};b.prototype._importElevationQuery=function(){return p.create(function(a){n(["./support/ElevationQuery"],
a)})};g([u.property({json:{read:{source:"copyrightText"}}})],b.prototype,"copyright",void 0);g([u.property({readOnly:!0,type:r})],b.prototype,"heightModelInfo",void 0);g([u.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],b.prototype,"path",void 0);g([u.property({type:["show","hide"]})],b.prototype,"listMode",void 0);g([u.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],b.prototype,
"minScale",null);g([u.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],b.prototype,"maxScale",null);g([u.property({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],b.prototype,"opacity",void 0);g([u.property({type:["ArcGISTiledElevationServiceLayer"]})],b.prototype,"operationalLayerType",void 0);g([u.property()],b.prototype,"sourceJSON",void 0);g([u.property({json:{read:!1},value:"elevation",
readOnly:!0})],b.prototype,"type",void 0);g([u.property(A.url)],b.prototype,"url",void 0);g([u.property()],b.prototype,"version",void 0);g([u.reader("version",["currentVersion"])],b.prototype,"readVersion",null);return b=g([u.subclass("esri.layers.ElevationLayer")],b)}(u.declared(w.ArcGISCachedService(v.ArcGISService(z.OperationalLayer(y.PortalLayer(q.MultiOriginJSONMixin(x)))))))})},"esri/layers/support/LercWorker":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/extendsHelper ../../core/promiseUtils ../../core/workers".split(" "),
function(n,b,m,k,g,e){function f(){return g.create(function(a){return n(["./rasterFormats/LercCodec"],a)})}Object.defineProperty(b,"__esModule",{value:!0});var l=function(){function a(){}a.prototype._decode=function(a){return f().then(function(b){b=b.decode;b=b(a.buffer,a.options);return{result:b,transferList:[b.pixelData.buffer]}})};return a}(),h=function(a){function b(b){var c=a.call(this)||this;c.scheduler=b;c._threadInitialized=g.create(function(a){e.open("LercWorker",{strategy:"dedicated",scheduler:b}).then(function(b){void 0===
c._thread?c._thread=b:b.close();a()},function(){return a()})});return c}k(b,a);b.prototype.destroy=function(){this._thread&&this._thread.close();this._thread=null};Object.defineProperty(b.prototype,"test",{get:function(){return{threadInitialized:this._threadInitialized}},enumerable:!0,configurable:!0});b.prototype.decode=function(a,b,c){return a&&0!==a.byteLength?this._thread?this._thread.invoke("_decode",{buffer:a,options:b},{transferList:[a],signal:c}):f().then(function(d){d=d.decode;g.throwIfAborted(c);
return d(a,b)}):g.resolve(null)};return b}(l);b.LercWorkerMaster=h;var d=new Map;b.acquireInstance=function(a){var b=d.get(a);b||(b={instance:new h(a),ref:0},d.set(a,b));++b.ref;return b.instance};b.releaseInstance=function(a){if(null!=a){a=a.scheduler;var b=d.get(a);b&&0>=--b.ref&&(b.instance.destroy(),d.delete(a))}};b.default=function(){return new l}})},"esri/layers/VectorTileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../request ../core/Error ../core/global ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/SpriteSource ./support/TileInfo ./support/TilemapCache ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/2d/engine/vectorTiles/SchemaHelper ../views/2d/engine/vectorTiles/tileInfoUtils ../views/2d/engine/vectorTiles/style/StyleRepository".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I){return function(a){function b(b,c){b=a.call(this,b)||this;b._spriteSourceMap=new Map;b.currentStyleInfo=null;b.style=null;b.isReference=null;b.operationalLayerType="VectorTileLayer";b.type="vector-tile";b.url=null;return b}k(b,a);b.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?m({url:a},b):a};b.prototype.prefetchResources=function(a){return f(this,void 0,void 0,function(){return e(this,function(b){switch(b.label){case 0:return[4,
this.loadSpriteSource(d.devicePixelRatio||1,a)];case 1:return b.sent(),[2]}})})};b.prototype.load=function(a){var b=this,d=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},a).then(function(){return f(b,void 0,void 0,function(){var b,c;return e(this,function(d){switch(d.label){case 0:if(!this.portalItem||!this.portalItem.id)return[2];b=this.portalItem.itemUrl+"/resources/styles/root.json";return[4,l(b,m({},a,{query:{f:"json"}}))];case 1:return c=d.sent(),c.data&&this.read({url:b},
G.createForItem(this.portalItem)),[2]}})})}).then(function(){return b._loadStyle(a)},function(){return b._loadStyle(a)});this.addResolvingPromise(d);return c.resolve(this)};Object.defineProperty(b.prototype,"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&p.urlToObject(a.serviceUrl))?this._getDefaultAttribution(a.path):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"capabilities",{get:function(){var a=this._getPrimarySource();return a?
a.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullExtent",{get:function(){var a=this._getPrimarySource();return a?a.fullExtent:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"parsedUrl",{get:function(){return this.serviceUrl?q.urlToObject(this.serviceUrl):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"serviceUrl",{get:function(){return this.currentStyleInfo&&
this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,configurable:!0});b.prototype.writeStyleUrl=function(a,b){a&&p.isProtocolRelative(a)&&(a="https:"+a);b.styleUrl=a};Object.defineProperty(b.prototype,
"tileIndexType",{get:function(){var a=this._getPrimarySource();return a?a.type:""},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tileIndexUrl",{get:function(){var a=this._getPrimarySource();return a?a.tileMapURL:""},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tileInfo",{get:function(){var a=[],b;for(b in this.sourceNameToSource)a.push(this.sourceNameToSource[b]);b=this._getPrimarySource().tileInfo;if(1<a.length)for(var c=0;c<a.length;c++)D.areSchemasOverlapping(b,
a[c].tileInfo)&&(b=D.unionTileInfos(b,a[c].tileInfo));return b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tilemapCache",{get:function(){var a=this._getPrimarySource();return a?a.capabilities.operations.supportsTileMap?a.tilemapCache:null:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tileServers",{get:function(){var a=this._getPrimarySource();return a?a.tileServers:[]},enumerable:!0,configurable:!0});b.prototype.readVersion=function(a,b){return b.version?
parseFloat(b.version):parseFloat(b.currentVersion)};Object.defineProperty(b.prototype,"compatibleTileInfo256",{get:function(){return H.create256x256CompatibleTileInfo(this.tileInfo)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"compatibleTileInfo512",{get:function(){return H.create512x512CompatibleTileInfo(this.tileInfo)},enumerable:!0,configurable:!0});b.prototype.loadSpriteSource=function(a,b){void 0===a&&(a=1);return f(this,void 0,void 0,function(){var d,f;return e(this,function(e){this._spriteSourceMap.has(a)||
(d=new B.default(this.styleRepository.sprite,a),this._spriteSourceMap.set(a,d.load()));f=this._spriteSourceMap.get(a);return[2,c.create(function(a,d){f.then(a,d);c.onAbortOrThrow(b,d)})]})})};b.prototype.loadStyle=function(a,b){return f(this,void 0,void 0,function(){var d,f,g,h=this;return e(this,function(e){d=a||this.style||this.url;if(this._loadingPromise&&"string"===typeof d&&this.url===d&&!c.isAborted(this._abortController))return[2,this._loadingPromise];(f=this._abortController)&&f.abort();g=
c.createAbortController();this._loadingPromise=c.create(function(a,e){var f={signal:g.signal};h._spriteSourceMap.clear();h._getSourceAndStyle(d,f).then(a,e);c.onAbort(b,function(){g.abort()})});this._abortController=g;return[2,this._loadingPromise]})})};b.prototype.getStyleLayerId=function(a){return this.styleRepository.getStyleLayerId(a)};b.prototype.getPaintProperties=function(a){return this.styleRepository.getPaintProperties(a)};b.prototype.setPaintProperties=function(a,b){var c=this.styleRepository.isPainterDataDriven(a),
d=this.styleRepository.setPaintProperties(a,b),e=this.styleRepository.isPainterDataDriven(a);this.emit("paint-change",{layer:d,paint:b});(c||e)&&this.emit("layout-change",{layer:d,layout:this.styleRepository.getLayoutProperties(a)})};b.prototype.getLayoutProperties=function(a){return this.styleRepository.getLayoutProperties(a)};b.prototype.setLayoutProperties=function(a,b){a=this.styleRepository.setLayoutProperties(a,b);this.emit("layout-change",{layer:a,layout:b})};b.prototype.getTileUrl=function(a,
b,c){var d=this.tileServers[b%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,c.toString())};b.prototype.write=function(a,b){return b&&b.origin&&!this.styleUrl?(b.messages&&b.messages.push(new h("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+this.id+") with style defined by JSON only are not supported",{layer:this})),null):this.inherited(arguments,[a,b])};b.prototype._getSourceAndStyle=function(a,b){return f(this,
void 0,void 0,function(){var c;return e(this,function(d){switch(d.label){case 0:if(!a)throw Error("invalid style!");return[4,E.loadMetadata(a,b)];case 1:return c=d.sent(),this._set("currentStyleInfo",{serviceUrl:c.serviceUrl,styleUrl:c.styleUrl,spriteUrl:c.spriteUrl,glyphsUrl:c.glyphsUrl,style:c.style,layerDefinition:c.layerDefinition}),"string"===typeof a?(this.url=a,this.style=null):(this.url=null,this.style=a),this._set("sourceNameToSource",c.sourceNameToSource),this._set("primarySourceName",c.primarySourceName),
this._set("styleRepository",new I(c.style,c)),this.read(c.layerDefinition,{origin:"service"}),[2]}})})};b.prototype._getDefaultAttribution=function(a){var b=a.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);if(b&&(a=b[3]&&b[3].toLowerCase()))for(var b=b[2]||"",c=0,d="OpenStreetMap_v2 OpenStreetMap_Export_v2 OpenStreetMap_FTS_v2 OpenStreetMap_GCS_v2 World_Basemap World_Basemap_v2 World_Basemap_Export_v2 World_Basemap_GCS_v2 World_Basemap_WGS84".split(" ");c<
d.length;c++){var e=d[c];if(-1<e.toLowerCase().indexOf(a))return p.normalize("//static.arcgis.com/attribution/Vector"+b+"/"+e)}};b.prototype._getPrimarySource=function(){return this.sourceNameToSource&&this.primarySourceName in this.sourceNameToSource?this.sourceNameToSource[this.primarySourceName]:null};b.prototype._loadStyle=function(a){return f(this,void 0,void 0,function(){return e(this,function(b){return this._loadingPromise?[2,this._loadingPromise]:[2,this.loadStyle(null,a)]})})};g([t.property({readOnly:!0,
dependsOn:["currentStyleInfo"]})],b.prototype,"attributionDataUrl",null);g([t.property({type:["show","hide"]})],b.prototype,"listMode",void 0);g([t.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],b.prototype,"capabilities",null);g([t.property({readOnly:!0})],b.prototype,"currentStyleInfo",void 0);g([t.property({json:{read:!1},readOnly:!0,type:u,dependsOn:["sourceNameToSource","primarySourceName"]})],b.prototype,"fullExtent",null);g([t.property()],b.prototype,
"style",void 0);g([t.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],b.prototype,"isReference",void 0);g([t.property({type:["VectorTileLayer"]})],b.prototype,"operationalLayerType",void 0);g([t.property({readOnly:!0,dependsOn:["serviceUrl"]})],b.prototype,"parsedUrl",null);g([t.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],b.prototype,"serviceUrl",null);g([t.property({type:r,dependsOn:["tileInfo"],readOnly:!0})],b.prototype,"spatialReference",
null);g([t.property({readOnly:!0})],b.prototype,"styleRepository",void 0);g([t.property({readOnly:!0})],b.prototype,"sourceNameToSource",void 0);g([t.property({readOnly:!0})],b.prototype,"primarySourceName",void 0);g([t.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],b.prototype,"styleUrl",null);g([t.writer(["portal-item","web-document"],"styleUrl")],b.prototype,"writeStyleUrl",null);
g([t.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],b.prototype,"tileIndexType",null);g([t.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],b.prototype,"tileIndexUrl",null);g([t.property({json:{read:!1,origins:{service:{read:!1}}},readOnly:!0,type:C,dependsOn:["sourceNameToSource","primarySourceName"]})],b.prototype,"tileInfo",null);g([t.property({json:{read:!1},readOnly:!0,type:F.TilemapCache,dependsOn:["sourceNameToSource",
"primarySourceName"]})],b.prototype,"tilemapCache",null);g([t.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],b.prototype,"tileServers",null);g([t.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],b.prototype,"type",void 0);g([t.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],b.prototype,"url",void 0);g([t.property({readOnly:!0})],b.prototype,"version",void 0);g([t.reader("version",
["version","currentVersion"])],b.prototype,"readVersion",null);g([t.property({readOnly:!0,dependsOn:["tileInfo"]})],b.prototype,"compatibleTileInfo256",null);g([t.property({readOnly:!0,dependsOn:["tileInfo"]})],b.prototype,"compatibleTileInfo512",null);return b=g([t.subclass("esri.layers.VectorTileLayer")],b)}(t.declared(A.ScaleRangeLayer(w.ArcGISCachedService(v.ArcGISService(z.OperationalLayer(y.PortalLayer(a.MultiOriginJSONMixin(x))))))))})},"esri/layers/support/SpriteSource":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Error ../../core/has ../../core/Logger ../../core/promiseUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});var q=a.getLogger("esri.layers.support.SpriteSource");n=function(){function a(a,b){this.baseURL=a;this.devicePixelRatio=b;this._isRetina=!1;this._spritesData={};this.height=this.width=this.image=null;this.loadStatus="not-loaded"}Object.defineProperty(a.prototype,"spriteNames",{get:function(){var a=[],b;for(b in this._spritesData)a.push(b);a.sort();return a},enumerable:!0,configurable:!0});a.prototype.getSpriteInfo=
function(a){return this._spritesData[a]};a.prototype.load=function(a){return f(this,void 0,void 0,function(){return e(this,function(b){switch(b.label){case 0:c.throwIfAborted(a);this.loadStatus="loading";if(!this.baseURL)return[2,c.resolve(this)];b.label=1;case 1:return b.trys.push([1,3,,4]),[4,this._loadSprites(a)];case 2:return b.sent(),this.loadStatus="loaded",[3,4];case 3:return b.sent(),this.loadStatus="failed",[3,4];case 4:return[2,this]}})})};a.prototype._loadSprites=function(a){var b=this;
this._isRetina=1.15<this.devicePixelRatio?!0:!1;var e=this.baseURL,f=this._isRetina?"@2x":"",k=""+e+f+".png";return c.all([l(e+f+".json",a),l(k,g({responseType:"image"},a))]).then(function(a){var f=a[0];a=a[1];var g=Object.keys(f.data);if(!g||0===g.length||1===g.length&&"_ssl"===g[0]||!a||!a.data)return b._spritesData=b.image=null,b.width=b.height=0,c.resolve(null);b._spritesData=f.data;f=a.data;a=Math.max(d("esri-webgl-max-texture-size"),4096);if(f.width>a||f.height>a)throw f="Sprite resource for style "+
e+" is bigger than the maximum allowed of "+a+" pixels}",q.error(f),new h("SpriteSource",f);b.width=f.width;b.height=f.height;a=document.createElement("canvas");g=a.getContext("2d");a.width=f.width;a.height=f.height;g.drawImage(f,0,0,f.width,f.height);f=g.getImageData(0,0,f.width,f.height);f=new Uint8Array(f.data);for(g=0;g<f.length;g+=4)a=f[g+3]/255,f[g]*=a,f[g+1]*=a,f[g+2]*=a;b.image=f})};return a}();b.default=n})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../config ../../request ../../core/promiseUtils ../../core/urlUtils ../../views/2d/engine/vectorTiles/style/VectorTileSource".split(" "),
function(n,b,m,k,g,e,f,l,h,d){function a(a){a&&(a=h.getOrigin(a),u&&-1===u.indexOf(a)&&u.push(a))}function c(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var b=void 0,c=0;c<a.length;++c)h.isProtocolRelative(a[c])?b&&(b=b.split("://")[0]+":"+a[c].trim()):b=h.isAbsolute(a[c])?a[c]:h.join(b,a[c]);return h.removeTrailingSlash(b)}function q(b,c,d,e,n){return g(this,void 0,void 0,function(){var g,r,q,u,w,v;return k(this,function(k){switch(k.label){case 0:l.throwIfAborted(n);if("string"!==
typeof d)return[3,2];u=h.normalize(d);a(u);w=h.urlToObject(u);return[4,f(w.path,m({query:{f:"json"},responseType:"json"},n))];case 1:return q=k.sent(),r=g=u,[3,3];case 2:q={data:d},g=d.jsonUrl||null,r=e,k.label=3;case 3:return v=q.data,q.ssl&&(g&&(g=g.replace(/^http:/i,"https:")),r&&(r=r.replace(/^http:/i,"https:"))),v.sources?(b.styleUrl=g||null,[2,p(b,v,r,n)]):v.sources?[2,l.reject("You must specify the URL or the JSON for a service or for a style.")]:b.sourceUrl?[2,t(b,v,r,!1,c,n)]:(b.sourceUrl=
g||null,[2,t(b,v,r,!0,c,n)])}})})}function p(b,d,e,f){return g(this,void 0,void 0,function(){var g,m,p,n,r,u;return k(this,function(k){switch(k.label){case 0:g=e?h.removeFile(e):h.appBaseUrl;b.styleBase=g;b.style=d;b.styleUrl&&a(b.styleUrl);m=[];if(!d.sources||!d.sources.esri)return[3,3];p=d.sources.esri;return p.url?[4,q(b,"esri",c(g,p.url),void 0,f)]:[3,2];case 1:return k.sent(),[3,3];case 2:m.push(q(b,"esri",p,g,f)),k.label=3;case 3:n=0;for(r=Object.keys(d.sources);n<r.length;n++)u=r[n],"esri"!==
u&&"vector"===d.sources[u].type&&(d.sources[u].url?m.push(q(b,u,c(g,d.sources[u].url),void 0,f)):m.push(q(b,u,d.sources[u],g,f)));return[4,l.all(m)];case 4:return k.sent(),[2]}})})}function t(b,e,f,m,p,n){return g(this,void 0,void 0,function(){var g,r,u,t;return k(this,function(k){g=f?h.removeTrailingSlash(f)+"/":h.appBaseUrl;k=g;if(e.hasOwnProperty("tileInfo"))r=e;else{for(var w={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},
v=78271.51696400007,x=2.958287637957775E8,y=[],z=e.hasOwnProperty("minzoom")?parseFloat(e.minzoom):0,A=e.hasOwnProperty("maxzoom")?parseFloat(e.maxzoom):22,B=0;B<=A;B++)B>=z&&y.push({level:B,scale:x,resolution:v}),v/=2,x/=2;v=0;for(x=e.tiles;v<x.length;v++)a(c(k,x[v]));r={capabilities:"TilesOnly",initialExtent:w,fullExtent:w,minScale:0,maxScale:0,tiles:e.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:y,spatialReference:{wkid:102100}}}}u=
new d(p,g,r);if(!m&&b.primarySourceName in b.sourceNameToSource){t=b.sourceNameToSource[b.primarySourceName];if(!t.isCompatibleWith(u))return[2,l.resolve()];null!=u.fullExtent&&(null!=t.fullExtent?t.fullExtent.union(u.fullExtent):t.fullExtent=u.fullExtent.clone());t.tileInfo.lods.length<u.tileInfo.lods.length&&(t.tileInfo=u.tileInfo)}m?(b.sourceBase=g,b.source=e,b.validatedSource=r,b.primarySourceName=p,b.sourceUrl&&a(b.sourceUrl)):a(g);b.sourceNameToSource[p]=u;return b.style?[2]:null==e.defaultStyles?
[2,l.reject()]:"string"===typeof e.defaultStyles?[2,q(b,"",c(g,e.defaultStyles,"root.json"),void 0,n)]:[2,q(b,"",e.defaultStyles,c(g,"root.json"),n)]})})}Object.defineProperty(b,"__esModule",{value:!0});var u=e.defaults&&e.defaults.io.corsEnabledServers;b.loadMetadata=function(b,d){return g(this,void 0,void 0,function(){var e,f,g,l,m,p;return k(this,function(k){switch(k.label){case 0:return e={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,
sourceNameToSource:{},primarySourceName:""},f="string"===typeof b?[b,null]:[null,b.jsonUrl],g=f[0],l=f[1],m=g?h.urlToObject(g):null,[4,q(e,"esri",b,l,d)];case 1:return k.sent(),p={layerDefinition:e.validatedSource,url:g,parsedUrl:m,serviceUrl:e.sourceUrl,style:e.style,styleUrl:e.styleUrl,spriteUrl:e.style.sprite&&c(e.styleBase,e.style.sprite),glyphsUrl:e.style.glyphs&&c(e.styleBase,e.style.glyphs),sourceNameToSource:e.sourceNameToSource,primarySourceName:e.primarySourceName},a(p.spriteUrl),a(p.glyphsUrl),
[2,p]}})})}})},"esri/views/2d/engine/vectorTiles/style/VectorTileSource":function(){define("require exports ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/lang ../../../../../core/urlUtils ../../../../../geometry/Extent ../../../../../layers/support/serviceTileInfoProperty ../../../../../layers/support/TilemapCache ../TileIndex".split(" "),function(n,b,m,k,g,e,f,l,h,d){return function(){function a(a,b,k){this.tileMapURL="";this.fullExtent=
this.tileIndex=this.capabilities=this.tileInfo=this.parsedUrl=this.tilemapCache=null;this.name=a;if(this.sourceUrl=b)this.parsedUrl=e.urlToObject(this.sourceUrl);a=g.clone(k);var c=a.tiles;b&&c.forEach(function(a,d){e.isAbsolute(a)||(c[d]=e.join(b,a))});this.tileServers=c;k.tileMap&&(this.tileMapURL=e.join(b,k.tileMap));var m=k.capabilities&&k.capabilities.split(",").map(function(a){return a.toLowerCase().trim()}),p=!!k.exportTilesAllowed,m=!!m&&-1!==m.indexOf("tilemap"),n=p&&k.hasOwnProperty("maxExportTilesCount")?
k.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:p,supportsTileMap:m},exportTiles:p?{maxExportTilesCount:+n}:null};this.tileInfo=l.readServiceTileInfo(a.tileInfo,a,null,{ignoreMinMaxLOD:!0});m&&(this.type="vector-tile",this.tilemapCache=new h.TilemapCache({layer:this}),this.tileIndex=new d(this.tilemapCache));this.fullExtent=f.fromJSON(k.fullExtent)}a.prototype.getRefKey=function(a,b){return k(this,void 0,void 0,function(){return m(this,function(c){return this.tileIndex?
[2,this.tileIndex.dataKey(a,b)]:[2,a]})})};a.prototype.getSourceTileUrl=function(a,b,d){var c=this.tileServers[b%this.tileServers.length];return c=c.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,d.toString())};a.prototype.isCompatibleWith=function(a){var b=this.tileInfo;a=a.tileInfo;if(!b.spatialReference.equals(a.spatialReference)||!b.origin.equals(a.origin)||Math.round(b.dpi)!==Math.round(a.dpi))return!1;b=b.lods;a=a.lods;for(var c=Math.min(b.length,a.length),
d=0;d<c;d++){var e=b[d],f=a[d];if(e.level!==f.level||Math.round(e.scale)!==Math.round(f.scale))return!1}return!0};return a}()})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["require","exports","../../../../core/promiseUtils","../../../../layers/support/TilemapCache","../../tiling/TileKey"],function(n,b,m,k,g){return function(){function b(b){if(b instanceof k.TilemapCache)this._tilemapCache=b;else if(b&&"index"in b)this._tilemap=b.index;else throw Error("Invalid tilemap!");}b.prototype.dataKey=
function(b,e){if(this._tilemapCache){var f=b.level,d=b.row,a=b.col,c=new g(b);return this._tilemapCache.fetchAvailabilityUpsample(f,d,a,c,e).then(function(){return c}).catch(function(b){if(m.isAbortError(b))throw b;c.level=f;c.row=d;c.col=a;return c})}return this._getIndexedDataKey(b)};b.prototype.forEach=function(b,e,g,d,a){this._callback=a;this._maxLevel=e+b;this._forEach(this._tilemap,e,g,d)};b.prototype._forEach=function(b,e,g,d){0!==b&&(this._callback(e,g,d),e!==this._maxLevel&&"object"===typeof b&&
(this._forEach(b[0],e+1,2*g,2*d),this._forEach(b[1],e+1,2*g,2*d+1),this._forEach(b[2],e+1,2*g+1,2*d),this._forEach(b[3],e+1,2*g+1,2*d+1)))};b.prototype._getIndexedDataKey=function(b){var e=[b];if(0>b.level||0>b.row||0>b.col||0<b.row>>b.level||0<b.col>>b.level)return m.resolve(null);for(;0!==b.level;)b=new g(b.level-1,b.row>>1,b.col>>1,b.world),e.push(b);b=this._tilemap;var f=e.pop(),d,a;if(1===b)return m.resolve(f);for(;e.length;)if(d=e.pop(),a=(d.col&1)+((d.row&1)<<1),b){if(0===b[a]){f=null;break}if(1===
b[a]){f=d;break}f=d;b=b[a]}return m.resolve(f)};return b}()})},"esri/views/2d/tiling/TileKey":function(){define(["require","exports","../../../core/ObjectPool"],function(n,b,m){return function(){function b(b,e,f,l){this.set(b,e,f,l)}b.getId=function(b,e,f,l){return"object"===typeof b?b.level+"/"+b.row+"/"+b.col+"/"+b.world:b+"/"+e+"/"+f+"/"+l};Object.defineProperty(b.prototype,"key",{get:function(){return this},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"id",{get:function(){return this.toString()},
enumerable:!0,configurable:!0});b.prototype.equals=function(b){return this.level===b.level&&this.row===b.row&&this.col===b.col&&this.world===b.world};b.prototype.release=function(){this.world=this.col=this.row=this.level=0};b.prototype.set=function(b,e,f,l){null==b?this.world=this.col=this.row=this.level=0:"object"===typeof b?(this.level=b.level||0,this.row=b.row||0,this.col=b.col||0,this.world=b.world||0):"string"===typeof b?(b=b.split("/"),e=b[1],f=b[2],l=b[3],this.level=parseFloat(b[0]),this.row=
parseFloat(e),this.col=parseFloat(f),this.world=parseFloat(l)):(this.level=+b,this.row=+e,this.col=+f,this.world=+l||0);return this};b.prototype.toString=function(){return this.level+"/"+this.row+"/"+this.col+"/"+this.world};b.prototype.getChildKeys=function(){var g=this.level+1,e=this.row<<1,f=this.col<<1,l=this.world;return[new b(g,e,f,l),new b(g,e,f+1,l),new b(g,e+1,f,l),new b(g,e+1,f+1,l)]};b.prototype.compareRowMajor=function(b){return this.row<b.row?-1:this.row>b.row?1:this.col<b.col?-1:this.col>
b.col?1:0};b.pool=new m(b,!0,null,25,50);return b}()})},"esri/portal/support/jsonContext":function(){define(["require","exports","../../core/urlUtils","../Portal"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.createForItem=function(b){return{origin:"portal-item",url:m.urlToObject(b.itemUrl),portal:b.portal||k.getDefault()}}})},"esri/views/2d/engine/vectorTiles/SchemaHelper":function(){define(["require","exports","../../../../layers/support/LOD","../../../../layers/support/TileInfo"],
function(n,b,m,k){return function(){function b(b,f){this.lockedSchemaPixelSize=b;this.isGCS=f}b.prototype.getLevelRowColumn=function(b){return this.isGCS?[b[0],b[1]>>1,b[2]>>1]:256===this.lockedSchemaPixelSize&&0<b[0]?[b[0]-1,b[1]>>1,b[2]>>1]:b};b.prototype.adjustLevel=function(b){return this.isGCS?b:256===this.lockedSchemaPixelSize?0<b?b-1:0:b};b.prototype.getShift=function(b,f){var e=0,g=0;if(256===this.lockedSchemaPixelSize||this.isGCS)b[2]%2&&(e=f),b[1]%2&&(g=f);return[e,g]};b.prototype.getScale=
function(b){if(this.isGCS){if(512===this.lockedSchemaPixelSize)return 4}else if(256===this.lockedSchemaPixelSize&&0===b)return 1;return 2};b.create256x256CompatibleTileInfo=function(b){if(!b)return null;if(256===b.size[0]&&256===b.size[1])return b;for(var e=b.spatialReference.isGeographic,g=[],h=b.lods.length,d=0;d<h;d++){var a=b.lods[d];g.push(new m({level:a.level,scale:a.scale,resolution:e?a.resolution:2*a.resolution}))}return new k({size:[256,256],dpi:b.dpi,format:b.format,compressionQuality:b.compressionQuality,
origin:b.origin,spatialReference:b.spatialReference,lods:g})};b.create512x512CompatibleTileInfo=function(b){if(!b||256===b.size[0]||256===b.size[1])return null;for(var e=[],g=b.lods.length,h=0;h<g;h++){var d=b.lods[h];e.push(new m({level:d.level,scale:d.scale,resolution:.5*d.resolution}))}return new k({size:[512,512],dpi:b.dpi,format:b.format,compressionQuality:b.compressionQuality,origin:b.origin,spatialReference:b.spatialReference,lods:e})};return b}()})},"esri/views/2d/engine/vectorTiles/tileInfoUtils":function(){define(["require",
"exports","../../../../layers/support/TileInfo"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.areSchemasOverlapping=function(b,g){if(b===g)return!0;if(!b&&null!=g||null!=b&&!g||!b.spatialReference.equals(g.spatialReference)||b.dpi!==g.dpi)return!1;var e=b.origin,f=g.origin;if(1E-6<=Math.abs(e.x-f.x)||1E-6<=Math.abs(e.y-f.y))return!1;b.lods[0].scale>g.lods[0].scale?(e=b,b=g):e=g;for(g=e.lods[0].scale;g>=b.lods[b.lods.length-1].scale-1E-6;g/=2)if(1E-6>Math.abs(g-b.lods[0].scale))return!0;
return!1};b.unionTileInfos=function(b,g){if(b===g)return b;if(!b&&null!=g)return g;if(null!=b&&!g)return b;var e=b.size[0],f=b.format,l=b.dpi,h={x:b.origin.x,y:b.origin.y},d=b.spatialReference.toJSON(),a=b.lods[0].scale>g.lods[0].scale?b.lods[0]:g.lods[0];b=(b.lods[b.lods.length-1].scale<=g.lods[g.lods.length-1].scale?b.lods[b.lods.length-1]:g.lods[g.lods.length-1]).scale;g=[];for(var c=a.scale,a=a.resolution,k=0;c>b;)g.push({level:k,resolution:a,scale:c}),k++,c/=2,a/=2;return new m({size:[e,e],dpi:l,
format:f||"pbf",origin:h,lods:g,spatialReference:d})}})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["require","exports","../../../../../core/has","./StyleLayer"],function(n,b,m,k){return function(){function b(e,f){this.backgroundBucketIds=[];this._layerByName={};this.styleJSON=e;this.version=parseFloat(e.version);this.sprite=f?f.spriteUrl:e.sprite;this.glyphs=f?f.glyphsUrl:e.glyphs;if(m("stable-symbol-rendering")){var g=(e.layers||[]).filter(function(b){return b.layout&&
b.layout["text-font"]})[0];g&&(e.layers||[]).forEach(function(b){b.layout&&b.layout["text-font"]&&(b.layout["text-font"]=g.layout["text-font"])})}if(this.layers=(e.layers||[]).map(b._create))for(e=void 0,f=0;f<this.layers.length;f++)e=this.layers[f],this._layerByName[e.id.toLowerCase()]=e,0===e.type&&this.backgroundBucketIds.push(f);this._identifyRefLayers()}b.prototype.isPainterDataDriven=function(b){return(b=this._layerByName[b.toLowerCase()])?b.isPainterDataDriven():!1};b.prototype.getStyleLayerId=
function(b){return b>=this.layers.length?null:this.layers[b].id};b.prototype.getLayoutProperties=function(b){return(b=this._layerByName[b.toLowerCase()])?b.layout:null};b.prototype.getPaintProperties=function(b){return(b=this._layerByName[b.toLowerCase()])?b.paint:null};b.prototype.setPaintProperties=function(e,f){e=this._layerByName[e.toLowerCase()];if(!e)return"";var g=this.layers.indexOf(e);this.styleJSON.layers[g].paint=f;f=b._recreateLayer({id:e.id,type:e.typeName,source:e.source,sourceLayer:e["source-layer"],
minzoom:e.minzoom,maxzoom:e.maxzoom,filter:e.filter,layout:e.layout,paint:f},e);this.layers[g]=f;this._layerByName[e.id.toLowerCase()]=f;return e.id};b.prototype.setLayoutProperties=function(e,f){e=this._layerByName[e.toLowerCase()];if(!e)return"";var g=this.layers.indexOf(e);this.styleJSON.layers[g].layout=f;f=b._recreateLayer({id:e.id,type:e.typeName,source:e.source,sourceLayer:e["source-layer"],minzoom:e.minzoom,maxzoom:e.maxzoom,filter:e.filter,layout:f,paint:e.paint},e);this.layers[g]=f;this._layerByName[e.id.toLowerCase()]=
f;return e.id};b.prototype._identifyRefLayers=function(){for(var b=[],f=[],g=0,h=0,d=this.layers;h<d.length;h++){var a=d[h];if(1===a.type){var c=a,k=a.source+"|"+a.sourceLayer,k=k+("|"+JSON.stringify(a.layout&&a.layout.visibility)),k=k+("|"+JSON.stringify(a.minzoom)),k=k+("|"+JSON.stringify(a.maxzoom)),k=k+("|"+JSON.stringify(a.filter));if(c.hasDataDrivenFill||c.hasDataDrivenOutline)k+="|"+JSON.stringify(g);b.push({key:k,layer:a})}2===a.type&&(c=a,k=a.source+"|"+a.sourceLayer,k+="|"+JSON.stringify(a.layout&&
a.layout.visibility),k+="|"+JSON.stringify(a.minzoom),k+="|"+JSON.stringify(a.maxzoom),k+="|"+JSON.stringify(a.filter),k+="|"+JSON.stringify(a.layout&&a.layout["line-cap"]),k+="|"+JSON.stringify(a.layout&&a.layout["line-join"]),c.hasDataDrivenLine&&(k+="|"+JSON.stringify(g)),f.push({key:k,layer:a}));++g}this._assignRefLayers(b);this._assignRefLayers(f)};b.prototype._assignRefLayers=function(b){b.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var e,g,h=b.length,d=0;d<h;d++){var a=b[d];
if(a.key===e)a.layer.refLayerId=g;else if(e=a.key,g=a.layer.id,1===a.layer.type&&!a.layer.getPaintProperty("fill-outline-color"))for(var c=d+1;c<h;c++){var k=b[c];if(k.key===e){if(k.layer.getPaintProperty("fill-outline-color")){b[d]=k;b[c]=a;g=k.layer.id;break}}else break}}};b._create=function(b,f,g){f=1-1/(g.length+1)*(1+f);switch(b.type){case "background":return new k.BackgroundStyleLayer(0,b,f);case "fill":return new k.FillStyleLayer(1,b,f);case "line":return new k.LineStyleLayer(2,b,f);case "symbol":return new k.SymbolStyleLayer(3,
b,f);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new k.CircleStyleLayer(4,b,f)}throw Error("Unknown vector tile layer");};b._recreateLayer=function(b,f){switch(b.type){case "background":return new k.BackgroundStyleLayer(0,b,f.z);case "fill":return new k.FillStyleLayer(1,b,f.z);case "line":return new k.LineStyleLayer(2,b,f.z);case "symbol":return new k.SymbolStyleLayer(3,b,f.z);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new k.CircleStyleLayer(4,
b,f.z)}};return b}()})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),function(n,b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,a,c){this.type=b;this.typeName=a.type;this.id=a.id;this.source=a.source;this.sourceLayer=a["source-layer"];this.minzoom=a.minzoom;this.maxzoom=a.maxzoom;this.filter=a.filter;
this.layout=a.layout;this.paint=a.paint;this.z=c;switch(b){case 0:this._layoutDefinition=g.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=g.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=g.StyleDefinition.fillLayoutDefinition;this._paintDefinition=g.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=g.StyleDefinition.lineLayoutDefinition;this._paintDefinition=g.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=
g.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=g.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=g.StyleDefinition.circleLayoutDefinition,this._paintDefinition=g.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}b.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=k.createFilter(this.filter)};b.prototype.getLayoutProperty=
function(b){var a=this._layoutProperties;if(a)return a[b]};b.prototype.getPaintProperty=function(b){var a=this._paintProperties;if(a)return a[b]};b.prototype.getLayoutValue=function(b,a,c){var d,e=this._layoutProperties;e&&(e=e[b])&&(d=e.getValue(a,c));b=this._layoutDefinition[b];void 0===d&&(d=b["default"]);"enum"===b.type&&(d=b.values.indexOf(d));return d};b.prototype.getPaintValue=function(b,a,c){var d,e=this._paintProperties;e&&(e=e[b])&&(d=e.getValue(a,c));b=this._paintDefinition[b];void 0===
d&&(d=b["default"]);"enum"===b.type&&(d=b.values.indexOf(d));return d};b.prototype.isPainterDataDriven=function(){var b=this._paintProperties;if(b)for(var a in b)if(b[a].isDataDriven)return!0;return!1};b.prototype._parseLayout=function(b){var a={},c;for(c in b){var d=this._layoutDefinition[c];d&&(a[c]=new e(d,b[c]))}return a};b.prototype._parsePaint=function(b){var a={},c;for(c in b){var d=this._paintDefinition[c];d&&(a[c]=new e(d,b[c]))}return a};return b}();b.StyleLayer=n;var l=function(b){function d(a,
c,d){return b.call(this,a,c,d)||this}m(d,b);return d}(n);b.BackgroundStyleLayer=l;l=function(b){function d(a,c,d){a=b.call(this,a,c,d)||this;c=a.getPaintProperty("fill-color");a.hasDataDrivenColor=c?c.isDataDriven:!1;c=a.getPaintProperty("fill-opacity");a.hasDataDrivenOpacity=c?c.isDataDriven:!1;a.hasDataDrivenFill=a.hasDataDrivenColor||a.hasDataDrivenOpacity;c=a.getPaintProperty("fill-outline-color");a.outlineUsesFillColor=!c;a.hasDataDrivenOutlineColor=c?c.isDataDriven:!1;a.hasDataDrivenOutline=
(c?a.hasDataDrivenOutlineColor:a.hasDataDrivenColor)||a.hasDataDrivenOpacity;return a}m(d,b);return d}(n);b.FillStyleLayer=l;l=function(b){function d(a,c,d){a=b.call(this,a,c,d)||this;d=a.getPaintProperty("line-color");a.hasDataDrivenColor=d?d.isDataDriven:!1;d=a.getPaintProperty("line-opacity");a.hasDataDrivenOpacity=d?d.isDataDriven:!1;d=a.getPaintProperty("line-width");a.hasDataDrivenWidth=d?d.isDataDriven:!1;a.hasDataDrivenLine=a.hasDataDrivenColor||a.hasDataDrivenOpacity||a.hasDataDrivenWidth;
c=c.paint["line-width"];c||(c=g.StyleDefinition.linePaintDefinition["line-width"].default);a.isThinLine=!a.hasDataDrivenWidth&&"number"===typeof c&&c<f.THIN_LINE_THRESHOLD;return a}m(d,b);return d}(n);b.LineStyleLayer=l;l=function(b){function d(a,c,d){a=b.call(this,a,c,d)||this;c=a.getPaintProperty("icon-color");a.hasDataDrivenIconColor=c?c.isDataDriven:!1;c=a.getPaintProperty("icon-opacity");a.hasDataDrivenIconOpacity=c?c.isDataDriven:!1;c=a.getLayoutProperty("icon-size");a.hasDataDrivenIconSize=
c?c.isDataDriven:!1;a.hasDataDrivenIcon=a.hasDataDrivenIconColor||a.hasDataDrivenIconOpacity||a.hasDataDrivenIconSize;c=a.getPaintProperty("text-color");a.hasDataDrivenTextColor=c?c.isDataDriven:!1;c=a.getPaintProperty("text-opacity");a.hasDataDrivenTextOpacity=c?c.isDataDriven:!1;c=a.getLayoutProperty("text-size");a.hasDataDrivenTextSize=c?c.isDataDriven:!1;a.hasDataDrivenText=a.hasDataDrivenTextColor||a.hasDataDrivenTextOpacity||a.hasDataDrivenTextSize;return a}m(d,b);return d}(n);b.SymbolStyleLayer=
l;n=function(b){function d(a,c,d){a=b.call(this,a,c,d)||this;c=a.getPaintProperty("circle-radius");a.hasDataDrivenRadius=c?c.isDataDriven:!1;c=a.getPaintProperty("circle-color");a.hasDataDrivenColor=c?c.isDataDriven:!1;c=a.getPaintProperty("circle-opacity");a.hasDataDrivenOpacity=c?c.isDataDriven:!1;c=a.getPaintProperty("circle-stroke-width");a.hasDataDrivenStrokeWidth=c?c.isDataDriven:!1;c=a.getPaintProperty("circle-stroke-color");a.hasDataDrivenStrokeColor=c?c.isDataDriven:!1;c=a.getPaintProperty("circle-stroke-opacity");
a.hasDataDrivenStrokeOpacity=c?c.isDataDriven:!1;c=a.getPaintProperty("circle-blur");a.hasDataDrivenBlur=c?c.isDataDriven:!1;return a}m(d,b);return d}(n);b.CircleStyleLayer=n;n=function(){return function(b,d,a){this.cap=b.getLayoutValue("line-cap",d,a);this.join=b.getLayoutValue("line-join",d,a);this.miterLimit=b.getLayoutValue("line-miter-limit",d,a);this.roundLimit=b.getLayoutValue("line-round-limit",d,a)}}();b.LineLayout=n;n=function(){return function(b,d,a,c){this.allowOverlap=b.getLayoutValue("icon-allow-overlap",
d,c);this.ignorePlacement=b.getLayoutValue("icon-ignore-placement",d,c);this.optional=b.getLayoutValue("icon-optional",d,c);this.rotationAlignment=b.getLayoutValue("icon-rotation-alignment",d,c);this.size=b.getLayoutValue("icon-size",d,c);this.rotate=b.getLayoutValue("icon-rotate",d,c);this.padding=b.getLayoutValue("icon-padding",d,c);this.keepUpright=b.getLayoutValue("icon-keep-upright",d,c);this.offset=b.getLayoutValue("icon-offset",d,c);2===this.rotationAlignment&&(this.rotationAlignment=a?0:1)}}();
b.IconLayout=n;n=function(){return function(b,d,a,c){this.allowOverlap=b.getLayoutValue("text-allow-overlap",d,c);this.ignorePlacement=b.getLayoutValue("text-ignore-placement",d,c);this.optional=b.getLayoutValue("text-optional",d,c);this.rotationAlignment=b.getLayoutValue("text-rotation-alignment",d,c);this.fontArray=b.getLayoutValue("text-font",d,c);this.maxWidth=b.getLayoutValue("text-max-width",d,c);this.lineHeight=b.getLayoutValue("text-line-height",d,c);this.letterSpacing=b.getLayoutValue("text-letter-spacing",
d,c);this.justify=b.getLayoutValue("text-justify",d,c);this.anchor=b.getLayoutValue("text-anchor",d,c);this.maxAngle=b.getLayoutValue("text-max-angle",d,c);this.size=b.getLayoutValue("text-size",d,c);this.rotate=b.getLayoutValue("text-rotate",d,c);this.padding=b.getLayoutValue("text-padding",d,c);this.keepUpright=b.getLayoutValue("text-keep-upright",d,c);this.transform=b.getLayoutValue("text-transform",d,c);this.offset=b.getLayoutValue("text-offset",d,c);2===this.rotationAlignment&&(this.rotationAlignment=
a?0:1)}}();b.TextLayout=n})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["require","exports"],function(n,b){return function(){function b(k,g,e){this._op=k;"$type"===g?(this._val=e instanceof Array?e.map(function(e){return b._types.indexOf(e)}):b._types.indexOf(e),this._op+=11):(this._key=g,this._val=e)}b.prototype.filter=function(b){switch(this._op){case 0:return this._val;case 1:return b.values[this._key]===this._val;case 2:return b.values[this._key]!==this._val;case 3:return b.values[this._key]<
this._val;case 4:return b.values[this._key]>this._val;case 5:return b.values[this._key]<=this._val;case 6:return b.values[this._key]>=this._val;case 7:return-1!==this._val.indexOf(b.values[this._key]);case 8:return-1===this._val.indexOf(b.values[this._key]);case 9:for(var g=0,e=this._val;g<e.length;g++){var f=e[g];if(f.filter(b))return!0}return!1;case 10:g=0;for(e=this._val;g<e.length;g++)if(f=e[g],!f.filter(b))return!1;return!0;case 11:g=0;for(e=this._val;g<e.length;g++)if(f=e[g],f.filter(b))return!1;
return!0;case 12:return b.type===this._val;case 13:return b.type!==this._val;case 14:return b.type<this._val;case 15:return b.type>this._val;case 16:return b.type>=this._val;case 17:return b.type<=this._val;case 18:return-1!==this._val.indexOf(b.type);case 19:return-1===this._val.indexOf(b.type);case 20:return void 0!==b.values[this._key];case 21:return void 0===b.values[this._key]}};b.createFilter=function(k){if(!k)return new b(0,void 0,!0);var g=k[0];if(1>=k.length)return new b(0,void 0,"any"!==
g);switch(g){case "\x3d\x3d":return new b(1,k[1],k[2]);case "!\x3d":return new b(2,k[1],k[2]);case "\x3e":return new b(4,k[1],k[2]);case "\x3c":return new b(3,k[1],k[2]);case "\x3e\x3d":return new b(6,k[1],k[2]);case "\x3c\x3d":return new b(5,k[1],k[2]);case "in":return new b(7,k[1],k.slice(2));case "!in":return new b(8,k[1],k.slice(2));case "any":return new b(9,void 0,k.slice(1).map(b.createFilter.bind(this)));case "all":return new b(10,void 0,k.slice(1).map(b.createFilter.bind(this)));case "none":return new b(11,
void 0,k.slice(1).map(b.createFilter.bind(this)));case "has":return new b(20,k[1],void 0);case "!has":return new b(21,k[1],void 0);default:throw Error("invalid operator: "+g);}};b._types=["Unknown","Point","LineString","Polygon"];return b}()})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){}b.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible",
"none"],default:"visible"}};b.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};b.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",values:["bevel","round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};b.symbolLayoutDefinition={visibility:{type:"enum",
values:["visible","none"],default:"visible"},"symbol-placement":{type:"enum",values:["point","line"],default:"point"},"symbol-spacing":{type:"number",minimum:1,default:250},"symbol-avoid-edges":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-allow-overlap":{type:"boolean",default:!1},"icon-ignore-placement":{type:"boolean",default:!1},"icon-optional":{type:"boolean",default:!1},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",
minimum:0,default:1},"icon-rotate":{type:"number",default:0},"icon-padding":{type:"number",minimum:0,default:2},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-field":{type:"string"},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-size":{type:"number",minimum:0,default:16},"text-max-width":{type:"number",
minimum:0,default:10},"text-line-height":{type:"number",default:1.2},"text-letter-spacing":{type:"number",default:0},"text-justify":{type:"enum",values:["left","center","right"],default:"center"},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},"text-max-angle":{type:"number",minimum:0,default:45},"text-rotate":{type:"number",default:0},"text-padding":{type:"number",minimum:0,default:2},"text-keep-upright":{type:"boolean",
default:!0},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-allow-overlap":{type:"boolean",default:!1},"text-ignore-placement":{type:"boolean",default:!1},"text-optional":{type:"boolean",default:!1}};b.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};b.backgroundPaintDefinition={"background-opacity":{type:"number",minimum:0,maximum:1,default:1},
"background-color":{type:"color",default:[0,0,0,1]},"background-pattern":{type:"string"}};b.fillPaintDefinition={"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"fill-pattern":{type:"string"}};b.linePaintDefinition=
{"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-color":{type:"color",default:[0,0,0,1]},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-blur":{type:"number",minimum:0,default:0},"line-dasharray":{type:"array",value:"number",default:[]},
"line-pattern":{type:"string"}};b.symbolPaintDefinition={"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"text-opacity":{type:"number",minimum:0,
maximum:1,default:1},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-halo-blur":{type:"number",minimum:0,default:0},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};b.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},
"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};b.circlePaintDefinition={"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-color":{type:"color",
default:[0,0,0,1]},"circle-blur":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1}};return b}();b.StyleDefinition=n})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["require",
"exports","../../../../../Color","../GeometryUtils"],function(n,b,m,k){return function(){function b(e,f){this.isDataDriven=!1;var g;switch(e.type){case "number":g=!0;break;case "color":g=!0;f=b._parseColor(f);break;case "array":g="number"===e.value;break;default:g=!1}null==f&&(f=e.default);g&&"interval"===f.type&&(g=!1);var h=f&&f.stops&&0<f.stops.length;if(h)for(var d=0,a=f.stops;d<a.length;d++){var c=a[d];c[1]=this._validate(c[1],e)}if(this.isDataDriven=f?!!f.property:!1)if(void 0!==f.default&&
(f.default=this._validate(f.default,e)),h)switch(f.type){case "identity":this.getValue=this._buildIdentity(f,e);break;case "categorical":this.getValue=this._buildCategorical(f,e);break;default:this.getValue=g?this._buildInterpolate(f,e):this._buildInterval(f,e)}else this.getValue=this._buildIdentity(f,e);else h?this.getValue=g?this._buildZoomInterpolate(f):this._buildZoomInterval(f):(f=this._validate(f,e),this.getValue=this._buildSimple(f))}b.prototype._validate=function(b,f){if("number"===f.type){if(b<
f.minimum)return f.minimum;if(b>f.maximum)return f.maximum}return b};b.prototype._buildSimple=function(b){return function(){return b}};b.prototype._buildIdentity=function(e,f){var g=this;return function(h,d){var a;d&&(a=d.values[e.property],"color"===f.type&&(a=b._parseColor(a)));void 0===a&&(a=e.default);return void 0!==a?g._validate(a,f):f.default}};b.prototype._buildCategorical=function(b,f){var e=this;return function(g,d){var a;d&&(a=d.values[b.property]);a=e._categorical(a,b.stops);return void 0!==
a?a:void 0!==b.default?b.default:f.default}};b.prototype._buildInterval=function(b,f){var e=this;return function(g,d){var a;d&&(a=d.values[b.property]);return"number"===typeof a?e._interval(a,b.stops):void 0!==b.default?b.default:f.default}};b.prototype._buildInterpolate=function(b,f){var e=this;return function(g,d){var a;d&&(a=d.values[b.property]);return"number"===typeof a?e._interpolate(a,b.stops,b.base||1):void 0!==b.default?b.default:f.default}};b.prototype._buildZoomInterpolate=function(b){var e=
this;return function(f){return e._interpolate(f,b.stops,b.base||1)}};b.prototype._buildZoomInterval=function(b){var e=this;return function(f){return e._interval(f,b.stops)}};b.prototype._categorical=function(b,f){for(var e=f.length,g=0;g<e;g++)if(f[g][0]===b)return f[g][1]};b.prototype._interval=function(b,f){for(var e=f.length,g=0,d=0;d<e;d++)if(f[d][0]<=b)g=d;else break;return f[g][1]};b.prototype._interpolate=function(b,f,g){for(var e,d,a=f.length,c=0;c<a;c++){var l=f[c];if(l[0]<=b)e=l;else{d=
l;break}}if(e&&d){c=d[0]-e[0];b-=e[0];g=1===g?b/c:(Math.pow(g,b)-1)/(Math.pow(g,c)-1);if(Array.isArray(e[1])){e=e[1];d=d[1];b=[];for(c=0;c<e.length;c++)b.push(k.interpolate(e[c],d[c],g));return b}return k.interpolate(e[1],d[1],g)}if(e)return e[1];if(d)return d[1]};b._isEmpty=function(b){for(var e in b)if(b.hasOwnProperty(e))return!1;return!0};b._parseColor=function(e){if(Array.isArray(e))return e;if("string"===typeof e){if(e=new m(e),!this._isEmpty(e))return m.toUnitRGBA(e)}else return e&&e.default&&
(e.default=b._parseColor(e.default)),e&&e.stops&&(e.stops=e.stops.map(function(e){return[e[0],b._parseColor(e[1])]})),e};return b}()})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(n,b){function m(b,e){b%=e;return 0<=b?b:b+e}Object.defineProperty(b,"__esModule",{value:!0});b.C_INFINITY=Number.POSITIVE_INFINITY;b.C_PI=Math.PI;b.C_2PI=2*b.C_PI;b.C_PI_BY_2=b.C_PI/2;b.C_RAD_TO_256=128/b.C_PI;b.C_256_TO_RAD=b.C_PI/128;b.C_DEG_TO_256=256/360;b.C_DEG_TO_RAD=
b.C_PI/180;b.C_SQRT2=1.414213562;b.C_SQRT2_INV=1/b.C_SQRT2;var k=1/Math.LN2;b.positiveMod=m;b.radToByte=function(g){return m(g*b.C_RAD_TO_256,256)};b.degToByte=function(g){return m(g*b.C_DEG_TO_256,256)};b.log2=function(b){return Math.log(b)*k};b.sqr=function(b){return b*b};b.interpolate=function(b,e,f){return b*(1-f)+e*f};b.between=function(b,e,f){return b>=e&&b<=f||b>=f&&b<=e}})},"esri/views/2d/engine/webgl/definitions":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,
"__esModule",{value:!0});b.WEBGL_MAX_STOPS=8;b.WEBGL_MAX_INNER_STOPS=b.WEBGL_MAX_STOPS-2;b.NAN_MAGIC_NUMBER=1E-30;b.EXTRUDE_SCALE=64;b.PICTURE_FILL_COLOR=4294967295;b.TILE_SIZE=512;b.RASTER_TILE_SIZE=256;b.ANGLE_FACTOR_256=256/360;b.DEBUG_LABELS=!1;b.COLLISION_BUCKET_SIZE=128;b.DOT_DENSITY_MAX_FIELDS=8;b.MAGIC_LABEL_LINE_HEIGHT=29;b.COLLISION_MAX_ZOOM_DELTA=1;b.COLLISION_EARLY_REJECT_BUCKET_SIZE=16;b.COLLISION_BOX_PADDING=16;b.COLLISION_TILE_BOX_SIZE=b.TILE_SIZE/b.COLLISION_BUCKET_SIZE;b.COLLISION_PLACEMENT_PADDING=
8;b.HEURISTIC_GLYPHS_PER_LINE=50;b.HEURISTIC_GLYPHS_PER_FEATURE=10;b.GLYPH_SIZE=24;b.TEXT_PLACEMENT_PADDING=8;b.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}};b.ATTRIBUTE_STORE_TEXTURE_SIZE=1024;b.TEXTURE_BINDING_SPRITE_ATLAS=0;b.TEXTURE_BINDING_GLYPH_ATLAS=0;b.TEXTURE_BINDING_BITMAP=0;b.TEXTURE_BINDING_ATTRIBUTE_DATA_0=1;b.TEXTURE_BINDING_ATTRIBUTE_DATA_1=2;b.TEXTURE_BINDING_ATTRIBUTE_DATA_2=3;b.TEXTURE_BINDING_ATTRIBUTE_DATA_3=4;b.TEXTURE_BINDING_HIGHLIGHT_0=5;
b.TEXTURE_BINDING_HIGHLIGHT_1=6;b.TEXTURE_BINDING_RENDERER_0=5;b.TEXTURE_BINDING_RENDERER_1=6;b.ATTRIBUTE_DATA_FILTER_FLAGS=0;b.ATTRIBUTE_DATA_ANIMATION=1;b.ATTRIBUTE_DATA_VV=2;b.ATTRIBUTE_DATA_DD0=3;b.ATTRIBUTE_DATA_DD1=3;b.MAX_FILTERS=2;b.HIGHLIGHT_FLAG=1;b.FILTER_FLAG_0=2;b.EFFECT_FLAG_0=4;b.THIN_LINE_THRESHOLD=2.5;b.HITTEST_SEARCH_SIZE=24;b.MAX_ANIMATION_TIME_MS=2E3;b.VTL_TEXTURE_BINDING_UNIT_SPRITES=5;b.VTL_TEXTURE_BINDING_UNIT_GLYPHS=6;b.VTL_HIGH_RES_CUTOFF=1.15;b.MAX_GPU_UPLOADS_PER_FRAME=
2})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ../../../core/Error ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ./TerrainConst ./TilingScheme".split(" "),function(n,b,m,k,g,e,f,l){function h(b,c,e,f){k.vec3.copy(d,e);d[f]=c[f];f=k.vec3.subtract(d,d,c);var g=k.vec3.subtract(a,b,c),g=k.vec3.dot(g,f),h=k.vec3.dot(f,f);c=0>=g?c:h<=g?e:k.vec3.add(d,c,k.vec3.scale(f,f,g/h));b=k.vec3.subtract(d,b,c);
return Math.PI/2-Math.atan(b[2]/Math.sqrt(b[0]*b[0]+b[1]*b[1]))}Object.defineProperty(b,"__esModule",{value:!0});var d=g.vec3f64.create(),a=g.vec3f64.create(),c=g.vec3f64.create(),q=g.vec3f64.create();b.isInsideExtent=function(a,b,c){void 0===c&&(c=0);a=a.extent;return 0===c?e.containsPoint(a,b):e.containsPointWithMargin(a,b,c*Math.min(a[2]-a[0],a[3]-a[1]))};b.tiltOnEdge=h;b.tiltToExtentEdge=function(a,b){var d=a.elevationBounds;a=a.extent;d=.5*(d.min+d.max);c[0]=a[0];c[1]=a[1];c[2]=d;q[0]=a[2];q[1]=
a[3];q[2]=d;a=d=Infinity;b[0]<c[0]?d=h(b,c,q,0):b[0]>q[0]&&(d=h(b,q,c,0));b[1]<c[1]?a=h(b,c,q,1):b[1]>q[1]&&(a=h(b,q,c,1));return Math.min(d,a)};b.checkIfTileInfoSupportedForViewSR=function(a,b,c){if(a.spatialReference.isGeographic)return new m("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var d=l.checkUnsupported(a);if(d)return d;var g=a.lods,d=g[0].resolution*Math.pow(2,g[0].level),h=[d*a.size[0],d*a.size[1]],k=[a.origin.x,a.origin.y];
c=e.fromExtent(c);var p=e.create();l.computeRowColExtent(c,h,k,p);h=(p[2]-p[0])*(p[3]-p[1]);h>f.MAX_ROOT_TILES?(g=g[0].scale*Math.pow(2,g[0].level),d=Math.max((c[3]-c[1])/a.size[1],(c[2]-c[0])/a.size[0])*g/d,c=Math.floor(Math.log(d)/Math.log(10)),d=Math.ceil(d/Math.pow(10,c))*Math.pow(10,c),d=new m("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(g).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+d.toLocaleString()+".",{level0Scale:g,
suggestedLevel0Scale:d,requiredNumRootTiles:h,allowedNumRootTiles:f.MAX_ROOT_TILES})):d=null;return d?d:b&&!a.spatialReference.equals(b)?new m("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/terrainUtilsSpherical":function(){define(["require","exports","../../../core/Error","../support/projectionUtils","./TilingScheme"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.isInsideExtent=
function(){return!0};b.tiltToExtentEdge=function(){return 0};b.checkIfTileInfoSupportedForViewSR=function(b,f){var e=b.lods.length-1;if(b.spatialReference.isWebMercator){if(!g.makeWebMercatorAuxiliarySphere(e).compatibleWith(b))return new m("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(k.canProjectToWGS84ComparableLonLat(b.spatialReference)){if(!g.makeGCSWithTileSize(b.spatialReference,b.size[0],e).compatibleWith(b))return b.spatialReference.isWGS84?
new m("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new m("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new m("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(f&&!b.spatialReference.equals(f))return new m("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}})},
"esri/views/3d/support/SharedSymbolResources":function(){define("require exports ../../../core/arrayUtils ../../../core/Handles ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.streamDataRequester=this.textures=null;this.graphicsOwners=[];this.cimSymbolRasterizer=this.screenSizePerspectiveHandles=null;this.viewState=b.viewState;this.stage=b.stage;this.pointsOfInterest=
b.pointsOfInterest;this.resourceController=b.resourceController;this.objectResourceCache=b.objectResourceCache;this.streamDataRequester=this.resourceController.createStreamDataRequester(3);this.textures=new g.default(this.streamDataRequester,b.stage,{preMultiplyAlpha:!0,wrap:{s:33071,t:33071}});this.screenSizePerspectiveSettings=e.getSettings(b.viewingMode);this.screenSizePerspectiveSettingsLabels=e.getLabelSettings(b.viewingMode)}b.prototype.destroy=function(){this.textures.destroy();this.streamDataRequester=
this.textures=null};b.prototype.addGraphicsOwner=function(b){var d=this;if(!b)return{remove:function(){}};this.graphicsOwners.push(b);var a="layer"in b?b.watch("layer.screenSizePerspectiveEnabled",function(){return d.updateScreenSizePerspectiveEnabled()}):null;this.updateScreenSizePerspectiveEnabled();return{remove:function(){a&&(a.remove(),m.removeUnordered(d.graphicsOwners,b),d.updateScreenSizePerspectiveEnabled())}}};b.prototype.updateScreenSizePerspectiveEnabled=function(){var b=this,d=this.graphicsOwners.some(function(a){return!0===
a.get("layer.screenSizePerspectiveEnabled")});d&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new k,d=function(){return b.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",d,!0),this.viewState.events.on("camera-projection-changed",d)]),this.updateScreenSizePerspectiveSettings()):!d&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=
null)};b.prototype.updateScreenSizePerspectiveSettings=function(){f.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;f.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(f);this.screenSizePerspectiveSettingsLabels.update(f);this.stage.renderView.setNeedsRender()};return b}();b.SharedSymbolResources=n;var f={distance:0,fovY:0};b.default=n})},"esri/views/3d/support/TextureCollection":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/urlUtils ../webgl-engine/lib/Texture".split(" "),
function(n,b,m,k,g,e,f,l,h,d){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function a(a,b,d,e){void 0===e&&(e=l.schedule);this._streamDataRequester=a;this._stage=b;this._textureOptions=d;this._schedule=e;this._textureRequests=new Map}a.prototype.destroy=function(){var a=this;this._textureRequests.forEach(function(b){return a.releaseTextureRequest(b)});this._textureRequests=null};a.prototype.fromUrl=function(a,b,d){return g(this,void 0,void 0,function(){var c,g,h,l,m,p=this;return k(this,
function(k){f.throwIfAborted(d);c=e.isSome(d)&&d.signal;g=this.makeUid(a,b);h=this._textureRequests.get(g);h||(l=f.createAbortController(),m=this._streamDataRequester.request(a,"image",{uid:g,signal:l.signal}),h={referenceCount:0,texture:null,textureAsync:null,abortController:l},this._textureRequests.set(g,h),h.textureAsync=m.then(function(c){c=p.createTexture(a,c,b);h.texture=c;h.abortController=null;p.addToStage(c);return{uid:g,texture:c}},function(a){h.abortController=null;throw a;}));h.referenceCount++;
return[2,f.create(function(a,b){f.onAbort(c,function(){b(f.createAbortError())});h.textureAsync.then(a,b)}).catch(function(a){p.release(g);throw a;})]})})};a.prototype.fromData=function(a,b){a=this.makeUid(a);var c=this._textureRequests.get(a);c||(c={referenceCount:0,texture:b(),textureAsync:null,abortController:null},this.addToStage(c.texture),this._textureRequests.set(a,c));c.referenceCount++;return{uid:a,texture:c.texture}};a.prototype.release=function(a){var b=this;if(this._textureRequests){var c=
this._textureRequests.get(a);c?(1>c.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),c.referenceCount--,1>c.referenceCount&&this._schedule(function(){return b.releaseNow(a)})):console.warn("TextureCollection: texture doesn't exist: '"+a+"'")}};Object.defineProperty(a.prototype,"test",{get:function(){return{textureRequests:this._textureRequests}},enumerable:!0,configurable:!0});a.prototype.releaseNow=function(a){if(this._textureRequests){var b=this._textureRequests.get(a);
!b||0<b.referenceCount||(this.releaseTextureRequest(b),this._textureRequests.delete(a))}};a.prototype.releaseTextureRequest=function(a){a.texture?this.removeFromStage(a.texture):a.abortController&&(a.abortController.abort(),a.abortController=null)};a.prototype.createTexture=function(a,b,e){h.isSVG(a)&&(e||0===b.width&&0===b.height)&&(a=b.width?b.height/b.width:1,e=e||64,1<a?(b.width=Math.round(e/a),b.height=e):(b.width=e,b.height=Math.round(e*a)));e=m({},this._textureOptions,{width:b.width,height:b.height,
powerOfTwoResizeMode:2});return new d(b,"symbol",e)};a.prototype.addToStage=function(a){this._stage.add(4,a)};a.prototype.removeFromStage=function(a){this._stage.remove(4,a.id)};a.prototype.makeUid=function(a,b){return null!=b?a+"."+b+"px":a};return a}();b.TextureCollection=n;b.default=n})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/SetUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./disposeMembers ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils ../../../support/Scheduler".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(d){d=b.call(this,d)||this;d.handles=new f;d.surfaceAltitudeAtCenter=0;d.surfaceAltitudeAtCenterDirty=!0;d.surfaceAltitudeAtCenterWithContent=0;d.surfaceAltitudeAtCenterWithContentDirty=!0;d.propertiesPool=new c.PropertiesPool({renderPointOfView:B},d);d.renderPointOfView=a.vec3f64.create();return d}m(e,b);e.prototype.initialize=function(){var a=this,b=this.view,c=b.state,
d=b.basemapTerrain,e=b.renderCoordsHelper,b=b.map;this.surfaceIntersector=new z.Intersector(c.mode);this.surfaceIntersector.options.backfacesTerrain=c.isGlobal?!1:!0;this.surfaceIntersector.options.invisibleTerrain=!1;this.contentIntersector=new z.Intersector(c.mode);this.contentIntersectorOptions={exclude:l.createSetFromValues([y.TERRAIN_ID])};var f=function(){return a.estimateSurfaceAltitudeAtCenter()},h={state:c,scheduler:this.view.resourceController.scheduler,surface:d,renderCoordsHelper:e};this._set("centerOnSurfaceInfrequent",
new t.default(g({},h,{task:A.Task.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:f})));this._set("centerOnSurfaceFrequent",new t.default(g({},h,{task:A.Task.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:f})));this._set("centerOnContent",new t.default(g({},h,{task:A.Task.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:function(){return a.estimateSurfaceAltitudeAtCenterWithContent()}})));this._set("cameraOnSurface",new p.default(g({},h,{task:A.Task.POINT_OF_INTEREST_INFREQUENT,
map:b})));this._set("surfaceGeometryUpdates",new v.default(g({},h,{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})));this._set("contentGeometryUpdates",new u.default({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:e}));this._set("surfaceOrigin",new w.default({view:this.view}));this._set("focus",new x.default({state:c,surface:d,renderCoordsHelper:e,centerOnSurface:this.centerOnSurfaceFrequent}));this.handles.add([c.watch("camera",
function(b){return a.cameraChanged(b)},!0),d.watch("extent",function(){return a.updateCenterPointsOfInterest()}),this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}),this.contentGeometryUpdates.events.on("request-update",function(){return a.updateCenterOnContent()})]);this.cameraChanged(this.view.state.camera);this.centerOnContent.update();this.centerOnSurfaceFrequent.update();this.centerOnSurfaceInfrequent.update();this.cameraOnSurface.update()};
e.prototype.destroy=function(){r.default(this,"handles","centerOnSurfaceInfrequent","centerOnSurfaceFrequent","cameraOnSurface","centerOnContent","surfaceOrigin","focus","propertiesPool")};Object.defineProperty(e.prototype,"updating",{get:function(){return!!(this.surfaceGeometryUpdates&&this.surfaceGeometryUpdates.updating||this.centerOnContent&&this.centerOnContent.updating||this.centerOnSurfaceInfrequent&&this.centerOnSurfaceInfrequent.updating||this.centerOnSurfaceFrequent&&this.centerOnSurfaceFrequent.updating||
this.cameraOnSurface&&this.cameraOnSurface.updating||this.focus&&this.focus.updating)},enumerable:!0,configurable:!0});e.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;var a=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,F);this.view.sceneIntersectionHelper.intersectRay(a,this.contentIntersector,C,
this.contentIntersectorOptions)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(C):this.surfaceAltitudeAtCenterWithContent=this.estimateSurfaceAltitudeAtCenter(a);return this.surfaceAltitudeAtCenterWithContent};e.prototype.estimateSurfaceAltitudeAtCenter=function(a){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=!1;var b=this.view.state.camera;a||(a=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(b,
F));var c=a.origin,e=d.vec3.add(C,a.origin,a.direction);this.surfaceIntersector.resetWithRay(a);this.surfaceIntersector.intersect(null,null,b);this.view.basemapTerrain.intersect(this.surfaceIntersector,null,c,e);this.surfaceIntersector.results.min.getIntersectionPoint(C)&&(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(C));return this.surfaceAltitudeAtCenter};e.prototype.cameraChanged=function(a){this.updateCenterPointsOfInterest();a=a.eye;d.vec3.exactEquals(this.renderPointOfView,
a)||this._set("renderPointOfView",d.vec3.copy(this.propertiesPool.get("renderPointOfView"),a))};e.prototype.updateCenterPointsOfInterest=function(){this.surfaceAltitudeAtCenterWithContentDirty=this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.updateRenderLocation();this.centerOnSurfaceInfrequent.updateRenderLocation();this.cameraOnSurface.updateRenderLocation();this.focus.updateRenderLocation();this.centerOnContent.updateRenderLocation()};e.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=
!0;this.centerOnContent.updateRenderLocation()};Object.defineProperty(e.prototype,"test",{get:function(){var a=this;return{update:function(){a.surfaceGeometryUpdates.update();a.centerOnSurfaceFrequent.update();a.centerOnSurfaceInfrequent.update()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}},enumerable:!0,configurable:!0});k([h.property({readOnly:!0})],e.prototype,"centerOnContent",void 0);k([h.property({readOnly:!0})],e.prototype,"centerOnSurfaceFrequent",void 0);k([h.property({readOnly:!0})],
e.prototype,"centerOnSurfaceInfrequent",void 0);k([h.property({readOnly:!0})],e.prototype,"cameraOnSurface",void 0);k([h.property({readOnly:!0})],e.prototype,"focus",void 0);k([h.property({readOnly:!0})],e.prototype,"renderPointOfView",void 0);k([h.property({readOnly:!0})],e.prototype,"surfaceOrigin",void 0);k([h.property({readOnly:!0})],e.prototype,"contentGeometryUpdates",void 0);k([h.property({readOnly:!0})],e.prototype,"surfaceGeometryUpdates",void 0);k([h.property({constructOnly:!0})],e.prototype,
"view",void 0);k([h.property({readOnly:!0,dependsOn:"surfaceGeometryUpdates.updating centerOnContent.updating centerOnSurfaceInfrequent.updating centerOnSurfaceFrequent.updating cameraOnSurface.updating focus.updating".split(" ")})],e.prototype,"updating",null);return e=k([h.subclass("esri.views.3d.support.PointsOfInterest")],e)}(h.declared(e));b.PointsOfInterest=n;var B=Array,C=a.vec3f64.create(),F=q.create();b.default=n})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../PropertiesPool ./PointOfInterest".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});var q=Array;n=function(b){function c(c){c=b.call(this,c)||this;c._dirty=!1;c._propertiesPool=new a.default({location:d,renderLocation:q},c);c._estimatedSurfaceAltitude=0;c._pendingElevationQueryController=null;c.renderLocation=h.vec3f64.create();return c}m(c,b);c.prototype.initialize=function(){var a=this;this.handles.add(this.scheduler.registerTask(this.task,function(){return a._measureSurfaceAltitude()},function(){return a._needsUpdate()}));
this._measureSurfaceAltitude();if(this.map){var b=function(){return a._setDirty()};this.handles.add([e.on(this.map,"ground.layers","change",b,b,b)])}};c.prototype.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};Object.defineProperty(c.prototype,"location",{get:function(){var a=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"updating",{get:function(){return this._dirty||null!=this._pendingElevationQueryController},enumerable:!0,configurable:!0});c.prototype.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};c.prototype.update=function(){this._measureSurfaceAltitude();this._updateRenderLocation()};c.prototype._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};c.prototype._needsUpdate=function(){return!this._pendingElevationQueryController&&
this._dirty};c.prototype._cancelPendingRequest=function(){var a=this._pendingElevationQueryController;a&&(this._pendingElevationQueryController=null,a.abort(),this.notifyChange("updating"))};c.prototype._measureSurfaceAltitude=function(){var a=this;this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,t,this.state.spatialReference);var b=g.createAbortController();this.map.ground.queryElevation(t,
{signal:b.signal}).then(function(b){return a._updateSurfaceAltitude(b.geometry.z)}).catch(function(b){g.isAbortError(b)||a._updateSurfaceAltitude(0)}).catch(function(){}).then(function(){a._pendingElevationQueryController===b&&(a._pendingElevationQueryController=null,a.notifyChange("updating"));b=null});this._pendingElevationQueryController=b}else this._updateSurfaceAltitude(0)};c.prototype._updateSurfaceAltitude=function(a){this._estimatedSurfaceAltitude!==a&&(this._estimatedSurfaceAltitude=a,this._updateRenderLocation())};
c.prototype._updateRenderLocation=function(){l.vec3.copy(p,this.state.camera.eye);this.renderCoordsHelper.setAltitude(this._estimatedSurfaceAltitude,p);l.vec3.exactEquals(this._get("renderLocation"),p)||this._set("renderLocation",l.vec3.copy(this._propertiesPool.get("renderLocation"),p))};k([f.property({constructOnly:!0})],c.prototype,"scheduler",void 0);k([f.property({constructOnly:!0})],c.prototype,"task",void 0);k([f.property({readOnly:!0,dependsOn:["renderLocation"]})],c.prototype,"location",
null);k([f.property({constructOnly:!0})],c.prototype,"map",void 0);k([f.property({readOnly:!0})],c.prototype,"renderLocation",void 0);k([f.property({readOnly:!0})],c.prototype,"updating",null);return c=k([f.subclass("esri.views.3d.support.CameraOnSurface")],c)}(f.declared(c.PointOfInterest));b.CameraOnSurface=n;var p=h.vec3f64.create(),t=new d;b.default=n})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ./disposeMembers".split(" "),
function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a){a=b.call(this,a)||this;a.handles=new e;return a}m(d,b);d.prototype.destroy=function(){l.default(this,"handles")};k([f.property({constructOnly:!0})],d.prototype,"renderCoordsHelper",void 0);k([f.property({constructOnly:!0})],d.prototype,"surface",void 0);k([f.property({constructOnly:!0})],d.prototype,"state",void 0);return d=k([f.subclass("esri.views.3d.support.PointOfInterest")],d)}(f.declared(g));
b.PointOfInterest=n;b.default=n})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require","exports","../../../../core/Accessor"],function(n,b,m){function k(b){for(var e=[],f=1;f<arguments.length;f++)e[f-1]=arguments[f];if(b instanceof m&&b.destroyed)try{throw Error("instance is already destroyed");}catch(d){console.warn(d.stack)}else for(f=0;f<e.length;f++){var g=e[f];if(!(g in b))throw Error("Property '"+g+"' does not exist and cannot be disposed");var h=b[g];h&&("function"===
typeof h.destroy?h.destroy():"function"===typeof h.dispose?h.dispose():"function"===typeof h.remove&&h.remove());b instanceof m&&g in b.__accessor__.metadatas?b._set(g,null):b[g]=null}}Object.defineProperty(b,"__esModule",{value:!0});b.disposeMembers=k;b.default=k})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/mathUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../debugFlags ../earthUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){Object.defineProperty(b,"__esModule",{value:!0});var p=Array;n=function(b){function n(a){a=b.call(this,a)||this;a.propertiesPool=new c.default({location:h,renderLocation:p},a);a.currentSurfaceAltitude=0;a.latestSurfaceAltitude=0;a.distance=0;a.renderLocation=l.vec3f64.create();a.updating=!1;return a}m(n,b);n.prototype.initialize=function(){var a=this;this._frameWorker=this.scheduler.registerTask(this.task,function(){return a._measureSurfaceAltitude()},function(){return a.updating});
this._measureSurfaceAltitude()};n.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(n.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});n.prototype.updateRenderLocation=function(){this._set("updating",!0);this._updateRenderLocation()};
n.prototype.update=function(){this._measureSurfaceAltitude();this._updateRenderLocation()};Object.defineProperty(n.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0});n.prototype._measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this._set("updating",!1)};n.prototype._updateRenderLocation=function(){var a=u,b=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,
a),c=this.currentSurfaceAltitude!==this.latestSurfaceAltitude;!b&&c&&(b=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,a))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);c=r;b&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,c)&&(f.vec3.copy(a,c),this.currentSurfaceAltitude=this.latestSurfaceAltitude);b?(b=f.vec3.distance(this.state.camera.eye,a),b!==this._get("distance")&&this._set("distance",b)):(b=this.state.camera,f.vec3.scale(a,b.viewForward,this._get("distance")),
f.vec3.add(a,a,b.eye));f.vec3.exactEquals(this._get("renderLocation"),a)||this._set("renderLocation",f.vec3.copy(this.propertiesPool.get("renderLocation"),a))};n.prototype.calculateSurfaceIntersection=function(b,c){var d=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(d.ray,b,c))return!1;if(this.state.isGlobal){b=a.earthRadius+b;var e=f.vec3.squaredLength(d.eye),h=e<b*b,l=f.vec3.distance(d.eye,c);h&&l>a.earthRadius/4&&(f.vec3.scale(c,d.viewForward,b-Math.sqrt(e)),f.vec3.add(c,c,d.eye))}else if(d=
this.surface.ready&&this.surface.extent)c[0]=g.clamp(c[0],d[0],d[2]),c[1]=g.clamp(c[1],d[1],d[3]);return!0};n.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,b){if(this.latestSurfaceAltitude===this.currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,b)){var c=this.state.camera.eye;a=f.vec3.distance(c,a);b=f.vec3.distance(c,b);if(d.TESTS_DISABLE_UPDATE_THRESHOLDS||Math.abs(b-a)/a>t)return!0}return!1};k([e.property({constructOnly:!0})],
n.prototype,"scheduler",void 0);k([e.property({constructOnly:!0})],n.prototype,"task",void 0);k([e.property({readOnly:!0})],n.prototype,"distance",void 0);k([e.property({constructOnly:!0})],n.prototype,"estimateSurfaceAltitudeAtCenter",void 0);k([e.property({readOnly:!0,dependsOn:["renderLocation"]})],n.prototype,"location",null);k([e.property({readOnly:!0})],n.prototype,"renderLocation",void 0);k([e.property({readOnly:!0})],n.prototype,"updating",void 0);return n=k([e.subclass("esri.views.3d.support.CenterOnSurface")],
n)}(e.declared(q.PointOfInterest));b.CenterOnSurface=n;var t=.05,u=l.vec3f64.create(),r=l.vec3f64.create();b.default=n})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["require","exports","../../../../core/Evented","../../../../core/Handles"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){var e=this;this.handles=new k;this.events=new m;this.contentLayerViews=b.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",
function(b){return e.layerViewsChanged(b)}));this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};b.prototype.layerViewsChanged=function(b){var e=this;b.added.forEach(function(b){"esri.views.3d.layers.SceneLayerView3D"===b.declaredClass&&e.handles.add(b.on("visible-geometry-changed",function(){return e.contentChanged()}),b.uid)});b.removed.forEach(function(b){return e.handles.remove(b.uid)})};
b.prototype.contentChanged=function(){this.events.emit("request-update",g)};return b}();b.ContentGeometryUpdates=n;var g={};b.default=n})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../geometryUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){Object.defineProperty(b,"__esModule",{value:!0});var p=Array;n=function(b){function h(a){a=b.call(this,a)||this;a.propertiesPool=new c.default({locationOnSurface:d,renderLocationOnSurface:p},a);a.centerOnSurface=null;return a}m(h,b);h.prototype.destroy=function(){this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(h.prototype,"locationOnSurface",{get:function(){var a=this.propertiesPool.get("locationOnSurface");this.renderCoordsHelper.fromRenderCoords(this.renderLocationOnSurface,
a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"renderLocationOnSurface",{get:function(){var a=this.centerOnSurface.renderLocation,b=this.renderCoordsHelper,c=this.calculateScreenHorizontalEdgeOnSurface(x);l.vec3.subtract(t,a,this.state.camera.eye);l.vec3.normalize(t,t);b.worldUpAtPosition(a,u);var d=Math.abs(Math.acos(l.vec3.dot(u,t))-.5*Math.PI),b=this.propertiesPool.get("renderLocationOnSurface"),d=1-g.clamp(d/(.5*Math.PI),0,1);l.vec3.lerp(b,
a,c,d*d*d);return b},enumerable:!0,configurable:!0});h.prototype.calculateScreenHorizontalEdgeOnSurface=function(b){var c=this.state.camera,d=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation),f=this.renderCoordsHelper.getAltitude(c.eye)>=d,g=c.getRenderCenter(e.createRenderScreenPointArray3());g[1]=f?c.padding[2]:c.fullHeight-c.padding[0];c.unprojectPoint(g,r);l.vec3.subtract(r,r,c.eye);f=l.vec3.normalize(r,r);if(this.renderCoordsHelper.intersectManifold(a.ray.wrap(c.eye,f),
d,b))return b;l.vec3.copy(b,c.eye);this.renderCoordsHelper.setAltitude(d,b);return b};h.prototype.updateRenderLocation=function(){};k([f.property({constructOnly:!0})],h.prototype,"centerOnSurface",void 0);k([f.property({readOnly:!0,dependsOn:["renderLocationOnSurface"]})],h.prototype,"locationOnSurface",null);k([f.property({readOnly:!0,dependsOn:["centerOnSurface.renderLocation"]})],h.prototype,"renderLocationOnSurface",null);k([f.property({readOnly:!0,aliasOf:"centerOnSurface.updating"})],h.prototype,
"updating",void 0);return h=k([f.subclass("esri.views.3d.support.CenterOnSurface")],h)}(f.declared(q.PointOfInterest));b.Focus=n;var t=h.vec3f64.create(),u=h.vec3f64.create(),r=h.vec3f64.create(),x=h.vec3f64.create();b.default=n})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function g(a){a=b.call(this,a)||this;a.location=null;a._updateController=null;a._handles=new e;return a}m(g,b);Object.defineProperty(g.prototype,"renderLocation",{get:function(){if(!this.location)return null;var a=d.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(this.location,a);return a},enumerable:!0,configurable:!0});g.prototype.initialize=function(){var a=this;this.view.state.isLocal&&
(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],function(){return a._update()}),l.on(this,"surface.layers","change",function(){return a._update()})]),this._update())};g.prototype.destroy=function(){this._handles.destroy()};g.prototype._update=function(){var b=this;this._updateController&&(this._updateController.abort(),this._updateController=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var d=c.center(this.surfaceView.extent),
d=new a({x:d[0],y:d[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=f.createAbortController(),this.surface.queryElevation(d,{noDataValue:0,signal:this._updateController.signal}).then(function(a){b._updateController=null;b._set("location",a.geometry)}).catch(function(a){f.isAbortError(a)||a&&"elevation-query:invalid-layer"===a.name||console.error("StableSurfaceCenter failed to update: ",a)})):
this._set("location",d)}else this._set("location",null)};k([h.property({constructOnly:!0})],g.prototype,"view",void 0);k([h.property({readOnly:!0,aliasOf:"view.map.ground"})],g.prototype,"surface",void 0);k([h.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],g.prototype,"surfaceView",void 0);k([h.property({readOnly:!0})],g.prototype,"location",void 0);k([h.property({readOnly:!0,dependsOn:["location"]})],g.prototype,"renderLocation",null);return g=k([h.subclass("esri.views.3d.terrain.StableSurfaceCenter")],
g)}(h.declared(g));b.StableSurfaceCenter=n;b.default=n})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),function(n,
b,m,k,g,e,f,l,h,d,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a.handles=new f;a._tileGeometryUpdateExtent=d.empty();a._tileGeometryUpdateSpatialReference=null;a.events=new e;a.updating=!1;return a}k(g,b);g.prototype.initialize=function(){var b=this;this.handles.add([this.surface.on("elevation-change",function(a){return b._tileGeometryChanged(a)}),this.scheduler.registerTask(a.Task.SURFACE_GEOMETRY_UPDATES,function(){return b.update()},
function(){return b.updating})])};g.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};g.prototype.update=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",c),d.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};g.prototype._tileGeometryChanged=function(a){this._tileGeometryUpdateSpatialReference=a.spatialReference;d.expand(this._tileGeometryUpdateExtent,
a.tile.extent);this._set("updating",!0)};g.prototype._furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaces[0],b=1;b<this.centerOnSurfaces.length;b++){var c=this.centerOnSurfaces[b];c.distance>a.distance&&(a=c)}return a};g.prototype._centerIntersectsExtent=function(a,b){var c=this.state.camera.eye,e=t,f=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(c,q,b);this.renderCoordsHelper.fromRenderCoords(f.renderLocation,p,b);q[0]<p[0]?(e[0]=q[0],e[2]=p[0]):(e[0]=p[0],
e[2]=q[0]);q[1]<p[1]?(e[1]=q[1],e[3]=p[1]):(e[1]=p[1],e[3]=q[1]);return d.intersects(e,a)};m([l.property({constructOnly:!0})],g.prototype,"state",void 0);m([l.property({constructOnly:!0})],g.prototype,"centerOnSurfaces",void 0);m([l.property({constructOnly:!0})],g.prototype,"renderCoordsHelper",void 0);m([l.property({constructOnly:!0})],g.prototype,"scheduler",void 0);m([l.property({constructOnly:!0})],g.prototype,"surface",void 0);m([l.property({readOnly:!0})],g.prototype,"updating",void 0);return g=
m([l.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],g)}(l.declared(g));b.SurfaceGeometryUpdates=n;var c={},q=h.vec3f64.create(),p=h.vec3f64.create(),t=d.empty();b.default=n})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/scheduling ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../../../layers/support/LercWorker ../../../layers/support/TilemapCache ../layers/ElevationLayerView3D ../support/debugFlags ../support/geometryUtils ../support/projectionUtils ./ElevationBounds ./ElevationData ./ElevationTileAgent ./MapTileAgent ./OverlayManager ./PlanarPatch ./SphericalPatch ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./Tile ./TilemapOnlyTile ./tileUtils ./tileUtils ./UpsampleInfo ../../support/Scheduler @dojo/framework/shim/Promise".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L,O,K,N,Q,M,T,P,S,V,J,U,Y,X,R,aa,da,ca,ba){function W(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function Z(a){return a.isLeaf?!1:a.children[0].shouldRender||a.children[1].shouldRender||a.children[2].shouldRender||a.children[3].shouldRender||Z(a.children[0])||Z(a.children[1])||Z(a.children[2])||Z(a.children[3])}var ea=c.getLogger("esri.views.3d.terrain.TerrainSurface");b=function(b){function c(c){c=b.call(this,c)||this;
c.defaultTileBackground=J.DEFAULT_TILE_BACKGROUND;c.hideSkirtsDistanceFromExtentMargin=fa;c.hideSkirtsMinimumCameraTilt=na;c.hideSkirtsMaximumCameraTilt=la;c._clippingExtent=null;c._dataExtent=null;c._elevationBounds=new O.ElevationBounds;c._rootExtent=F.create();c._iteratorPool=new t(da.IteratorPreorder);c._postorderIterator=new da.IteratorPostorder;c._visible=!1;c._pendingUpdates=!1;c._asyncWorkItems=0;c._usedMemory=ma;c._isFrameProcessing=!1;c._viewChangeUpdateDirty=!1;c._overlayOpacity=1;c._eyePosRenderSR=
B.vec3f64.create();c._eyePosSurfaceSR=B.vec3f64.create();c._splitLimits=new X.SplitLimits;c._snapLevel=Infinity;c._frustum=I.frustum.create();c._viewProjectionMatrix=y.mat4f64.create();c._layerViews=[[],[]];c._layerIndexByLayerViewId=[new Map,new Map];c._basemapLayerViewHandles=new Map;c._handles=new a;c._allTiles=new u;c._topLevelTilemapOnlyTiles=[];c._upsampleInfoPool=new t(ca);c._visibleLevels=new u({deallocator:null});c._getElevationData={spatialReference:null,rootTiles:null};c.maxTextureScale=
1.2;c.rootTiles=null;c.backgroundImage=J.DEFAULT_TILE_BACKGROUND;c.backgroundColor=null;c._scheduledLayerViewChangesHandle=null;return c}k(c,b);c.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this._lercWorker=E.acquireInstance(this.view.resourceController.scheduler);this._tilePool="planar"===this.manifold?new t(T.PlanarPatch):new t(P.SphericalPatch);this._upsampleMapCache=this.view.resourceController.memoryController.getMemCache("esri.views.3d.terrain.upsample",function(a){return a.unloadMapData()});
this._set("overlayManager",new M.OverlayManager({terrainSurface:this,view:this.view}));this._handles.add([this.watch("overlayManager.hasHighlights",function(b){return a._renderer.setNeedsHighlight(b)}),this.watch("overlayManager.rendersOccluded",function(b){return a._renderer.setRenderOccludedOverlay(b)})],"overlayManager");this._renderer=new U({manifold:this.manifold,overlayRenderer:this.overlayManager.renderer});this._renderer.install(this.view._stage);this._handles.add([w.init(this,"baseOpacity",
function(b){return a._updateBaseOpacity(b)},!0),w.init(this,"_background",function(){return a._renderer.setTileBackground(a._background)},!0),this.view.watch("pointsOfInterest",function(b){return a._renderer.pointsOfInterest=b}),w.whenTrue(D,"TERRAIN_DEBUG_POPUP",function(){(new Promise(function(a,b){n(["./support/TerrainDebugPopupOpener"],a,b)})).then(function(b){var c=new b.TerrainDebugPopupOpener({surface:a});w.whenFalseOnce(D,"TERRAIN_DEBUG_POPUP",function(){return c.destroy()})})})]);var b={layers:this.view.map.allLayers,
layerViews:this.view.allLayerViews,spatialReference:this.view.spatialReference};this.extentHelper="spherical"===this.manifold?new S.SurfaceExtentHelperGlobal(b):new S.SurfaceExtentHelperLocal(b);this._handles.add(w.init(this.extentHelper,"stencilEnabledExtents",function(b){return a._renderer.setStencilEnabledLayerExtents(b)}),"extentHelper");b=this.view.defaultsFromMap?new h({root:this.view.map,rootCollectionNames:this.view.defaultsFromMap.mapCollectionPaths,getChildrenFunction:function(a){return a.layers}}):
this.view.map.allLayers;b=new V({layers:b,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",b);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",function(){return a._updateTilingSchemeAndExtent()},!0),this.tilingSchemeLogic.watch("extent",function(){return a._updateTilingSchemeAndExtent()},!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(0);
this._mapDataRequester=this.view.resourceController.createStreamDataRequester(1);this._handles.add(this.view.resourceController.scheduler.registerTask(ba.Task.TERRAIN_SURFACE,function(b){return a._frame(b)},function(){return a.updating}));this.view.resourceController.memoryController.events.on("quality-changed",function(){return a._viewChangeUpdate()});this._handles.add([this.view.on("resize",function(){return a._viewChangeUpdate()}),this.view.watch("state.camera",function(){return a._viewChangeUpdate()},
!0),this.view.watch("qualitySettings.tiledSurface.lodBias",function(){return a._viewChangeUpdate()}),w.init(this.view,"qualitySettings.tiledSurface.textureFadeDuration",function(b){return a._renderer.textureFadingEnabled=0<b}),this.view.watch("lodSnapping",function(){return a._viewChangeUpdate()}),this.view.watch("clippingArea",function(){return a._clippingChanged()})]);this._handles.add(this.view.allLayerViews.on("after-changes",function(){return a._scheduleLayerViewChangesUpdate()}));this._handleLayerViewChanges();
this._updateClippingExtent();this.notifyChange("extent")};c.prototype.destroy=function(){var a=this;this._handles.destroy();E.releaseInstance(this._lercWorker);this._lercWorker=null;this._removeAllTiles();this._upsampleMapCache.destroy();this._upsampleMapCache=null;this.tilingSchemeLogic.destroy();this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;this._basemapLayerViewHandles.forEach(function(b,c){return a._unregisterTiledLayerView(c)});this._mapDataRequester=
this._elevationDataRequester=null;this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._tilePool.destroy();this._tilePool=null;N.Pool.prune(0);Q.Pool.prune(0);this._renderer.uninstall(this._stage);this._renderer.destroy();this._renderer=null;this._iteratorPool.destroy();this._iteratorPool=null;this._set("view",null);this._stage=null;this._upsampleInfoPool.destroy();this._upsampleInfoPool=null};Object.defineProperty(c.prototype,"renderer",{get:function(){return this._renderer},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"frustum",{get:function(){return this._frustum},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"snapLevel",{get:function(){return Math.round(this._snapLevel)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"upsampleInfoPool",{get:function(){return this._upsampleInfoPool},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"upsampleMapCache",{get:function(){return this._upsampleMapCache},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"cullBackFaces",{set:function(a){this._renderer.cullBackFaces=a;this._set("cullBackFaces",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"updating",{get:function(){return!(!(this._pendingUpdates||this._renderer.updating||this.overlayManager.updating||this._scheduledLayerViewChangesHandle)||
!this.ready||this.suspended)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderOrder",{set:function(a){this._renderer.renderOrder=a;this._set("renderOrder",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"skirtScale",{set:function(a){this._renderer.skirtScale=a;this._set("skirtScale",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"spatialReference",{get:function(){var a=this.tilingScheme&&this.tilingScheme.spatialReference||null;return this._getElevationData.spatialReference=a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_background",{get:function(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"slicePlaneEnabled",{set:function(a){this._renderer.slicePlane=a;this._set("slicePlaneEnabled",a)},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"velvetOverground",{set:function(a){a!==this.velvetOverground&&(this._renderer.velvetOverground=a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"wireframe",{set:function(a){this._renderer.setWireframe(a);this._set("wireframe",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"visible",{set:function(a){a!==this._visible&&(this._visible=a,this._renderer.setVisibility(a),this.suspended=
!a)},enumerable:!0,configurable:!0});c.prototype.isOpaque=function(){return this._renderer.opaque};Object.defineProperty(c.prototype,"suspended",{set:function(a){this._set("suspended",a);this._viewChangeUpdate()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"lodSnapping",{get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?0:1},enumerable:!0,configurable:!0});c.prototype.intersect=function(a,b,c,d){this._renderer.intersect(a,b,c,d)};c.prototype.getElevation=
function(a,b,c,d){var e=this._getElevationData.rootTiles;if(!e||!e.length||0===e[0].layerInfo[0].length)return null;var f=oa;f[0]=a;f[1]=b;f[2]=c;if(!L.vectorToVector(f,d,f,this._getElevationData.spatialReference))return ea.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(b=0;b<e.length;b++)if(a=e[b],a.containsPoint(f)){for(;a&&!a.rendered&&!a.isLeaf;)e=0,f[0]>.5*(a.extent[0]+a.extent[2])&&(e+=1),f[1]<.5*(a.extent[1]+a.extent[3])&&(e+=
2),a=a.children[e];if(e=(e=a.renderData)&&e.geometryState?e.geometryState.samplerData:null)return K.ElevationData.sample(f[0],f[1],e);break}return null};Object.defineProperty(c.prototype,"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!0,configurable:!0});c.prototype.getScale=function(a){if(this.tilingScheme){if(!L.pointToVector(a,oa,this.spatialReference))return ea.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),
null;var b=this.rootTiles;if(b)for(var c=0;c<b.length;c++)if(a=b[c],a.containsPoint(oa)){for(;null!=a.children[0];)b=0,oa[0]>a.children[0].extent[2]&&(b+=1),oa[1]<a.children[0].extent[1]&&(b+=2),a=a.children[b];return this._getLodBiasCorrectedScale(a.level)}}return 1E100};c.prototype.queryVisibleScaleRange=function(a,b,c,d){b=b?this.tilingScheme.levelAtScale(b):0;c=c?this.tilingScheme.levelAtScale(c):Infinity;var e=this.lodBias;this._renderer.queryVisibleLevelRange(a,b+e,c+e,d)};c.prototype._updateBaseOpacity=
function(a){var b=this._renderer.opaque;this._renderer.opaque=1<=a;this._updateTileTextures(b!==this._renderer.opaque)};c.prototype._updateTilingSchemeAndExtent=function(){var a=this.tilingSchemeLogic.extent,b=a&&!F.equals(a,this._dataExtent);b&&(this._dataExtent?F.set(this._dataExtent,a):this._dataExtent=F.create(a));var a=this.tilingSchemeLogic.tilingScheme,c=a!==this.tilingScheme;c&&(Y.weakAssert(!!a,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",
a),this._updateClippingExtent(),a&&(this._updateTiledLayers(),this._renderer.setTileSize(a.pixelSize),this.overlayManager.setSpatialReference(a.spatialReference,"spherical"===this.manifold)));(b||c)&&this._updateRootTiles()};c.prototype._acquireTile=function(a,b,c,d){var e=this._tilePool.acquire();ia[0]=a;ia[1]=b;ia[2]=c;e.init(ia,d,this);return e};c.prototype._updateRootTiles=function(){var a=this,b=this._clippingExtent||this._dataExtent,c=this.tilingScheme;if(b&&c){var d=ka,e=c.rootTilesInExtent(b,
d,5*J.MAX_ROOT_TILES),f=function(b){b=a._acquireTile(0,b[1],b[2],null);2===b.shouldSplit(a._splitLimits,a._eyePosRenderSR,a.lodSnapping)&&b.setPendingUpdate(2);a._loadTile(b);return b};if(this.rootTiles){if(e.length>J.MAX_ROOT_TILES){ea.warn(J.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}var b=this.rootTiles.map(function(a){return a.lij}),g=l.difference(b,e,W);if(0<g.removed.length||0<g.added.length){var h=this.rootTiles.filter(function(b){return-1<l.findIndex(g.removed,W.bind(null,b.lij))?(a._purgeTile(b),
!1):!0});g.added.forEach(function(a){return h.push(f(a))});this._setRootTiles(h)}}else e.length>J.MAX_ROOT_TILES&&(ea.warn(J.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),e=c.rootTilesInExtent(b,d,J.MAX_ROOT_TILES)),this._setRootTiles(e.map(function(a){return f(a)}));F.equals(d,this._rootExtent)||(this._rootExtent=F.create(d),this._hasFixedExtent()||this.notifyChange("extent"));this.visible=!0;this._viewChangeUpdate();this.overlayManager.setOverlayPlacementDirty();this.notifyChange("ready")}};c.prototype._setRootTiles=
function(a){this._set("rootTiles",a);this._allTiles.clear();a&&this._allTiles.pushArray(a);this._getElevationData.rootTiles=a;this._renderer.setRootTiles(this.rootTiles);this._updateTiles(a)};c.prototype._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};c.prototype._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this._visible&&(this._isFrameProcessing?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=
!1,this._updateViewDependentParameters(),this._updateSkirts(),this.updateOverlayOpacity(),this._updateTiles(this.rootTiles)))};c.prototype._updateClippingStatus=function(a){a.updateClippingStatus(this._clippingExtent)&&a.resetPendingUpdate(32)&&this._updateTileGeometry(a)};c.prototype._updateTiles=function(a){if(a){var b=this._iteratorPool.acquire();b.reset(a);var c;aa.hasVisibleSiblings(a)?(a=this._elevationBounds.min,c=this._elevationBounds.max):(a=Infinity,c=-Infinity);for(;!b.done;){var d=b.next();
this._updateClippingStatus(d);d.updateVisibility();d.setPendingUpdate(16);if(d.visible){d.updateScreenDepth(this._viewProjectionMatrix);d.renderData&&(a=Math.min(d.elevationBounds[0],a),c=Math.max(d.elevationBounds[1],c));var e=d.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(2===e){d.resetPendingUpdate(8);d.isLeaf&&(d.setPendingUpdate(2),b.skipSubtree());this._pendingUpdates=this._pendingUpdates||d.updating;continue}d.resetPendingUpdate(2)&&d.updateAgentSuspension();4===
e&&d.updateAgents(0)}b.skipSubtree();if(!d.isLeaf){d.setPendingUpdate(8);d.resetPendingUpdate(2);e=this._iteratorPool.acquire();for(e.resetOne(d);!e.done;){var f=e.next();this._updateClippingStatus(f);f.updateVisibility();f.visible&&f.updateScreenDepth(this._viewProjectionMatrix)}this._iteratorPool.release(e)}this._pendingUpdates=this._pendingUpdates||d.updating}this._iteratorPool.release(b);isFinite(a)&&isFinite(c)&&(this._elevationBounds.min!==a||this._elevationBounds.max!==c)&&(this._elevationBounds.min=
a,this._elevationBounds.max=c,this.emit("elevation-bounds-change",null))}};c.prototype._updateViewDependentParameters=function(){var a=this.view.state.camera,b=Math.tan(.5*a.fovX),c=Math.tan(.5*a.fovY),d=this.tilingScheme.pixelSize,e=Math.pow(2,-this.lodBias)*a.pixelRatio;this._splitLimits.aboveGround=a.aboveGround;this._splitLimits.fovX=b;this._splitLimits.fovY=c;this._splitLimits.relativeWidthLimit=d/a.width*this.maxTextureScale*e;this._splitLimits.relativeHeightLimit=d/a.height*this.maxTextureScale*
e;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;I.frustum.copy(a.frustum,this._frustum);z.mat4.multiply(this._viewProjectionMatrix,a.projectionMatrix,a.viewMatrix);A.vec3.copy(this._eyePosRenderSR,a.eye);L.vectorToVector(this._eyePosRenderSR,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};c.prototype._updateSnapLevel=function(){if(1!==this.lodSnapping){var a=D.TESTS_DISABLE_UPDATE_THRESHOLDS?
0:.1,b=this._findSnapLevel();Math.abs(this._snapLevel-b)<a||(a=this.snapLevel,this._snapLevel=b,a!==this.snapLevel&&this._updateTiles(this.rootTiles))}};c.prototype._findSnapLevel=function(){if(0>=this._visibleLevels.length)return this._snapLevel;var a=this._visibleLevels,b=Math.round(a.length*(Math.abs(this.view.camera.tilt-90)/90*.4+.3));if(b>=a.length)return this._snapLevel;a.sort(function(a,b){return a-b});for(var c=0,d=b;d<a.length;++d)c+=a.getItemAt(d);d=a.getItemAt(Math.round(.95*a.length)-
1);return q.clamp(c/(a.length-b),d-1,this._splitLimits.maxLod)};c.prototype._updateSkirts=function(){var a=this.view.state.camera;Y.autoUpdateSkirtsVisibility(this,this._eyePosSurfaceSR,this.spatialReference,this.view.state.constraints.collision.enabled?0:1.11*a.near)};c.prototype._updateRender=function(a){a.rendered&&!a.shouldRender&&(Z(a)?this._loadChildren(a):a.isLeaf&&a.parent&&a.parent.shouldRender&&this._loadParent(a))};c.prototype._updateTileGeometry=function(a){a.updateVisibility();this._renderer.updateTileGeometry(a);
this._elevationUpdate(a);this._usedMemory=ma};c.prototype._elevationUpdate=function(a){ja.spatialReference=this.spatialReference;ja.tile=a;ja.extent=a.extent;this.emit("elevation-change",ja);F.containsPoint(a.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};c.prototype._frame=function(a){var b=this;this._isFrameProcessing=!0;this._frameTraversal(a);a.run(function(){return b._processElevation(a)});a.run(function(){return b._processTextures(a)});0!==this._asyncWorkItems&&(this._pendingUpdates=!0);
this._isFrameProcessing=!1;this._runViewChangeUpdateIfDirty();this.notifyChange("updating")};c.prototype._frameTraversal=function(a){var b=this;if(!this.suspended&&this._pendingUpdates){var c=this._eyePosRenderSR,d=0,e=!1;this._pendingUpdates=!1;this._visibleLevels.clear();for(var f=function(){},g=0===this.lodSnapping?function(a){var d=a.shouldSplit(b._splitLimits,c,1);a.visible&&2!==d&&a.parent&&2===a.parent.shouldSplit(b._splitLimits,c,1)&&(1===d?b._visibleLevels.fill(a.level+1,4):b._visibleLevels.push(a.level))}:
f;!a.done;){var h=!this._allTiles.some(function(c){d+=c.usedMemory;g(c);c.resetPendingUpdate(8)?(b._mergeTile(c),e=!0,a.madeProgress()):c.resetPendingUpdate(2)&&(b._splitTile(c),e=!0,a.madeProgress());c.resetPendingUpdate(16)&&(b._updateRender(c),a.madeProgress());b._pendingUpdates=b._pendingUpdates||c.updating;return a.done});this._pendingUpdates=this._pendingUpdates||!h;h&&g!==f&&this._updateSnapLevel();g=f;if(e)this._pendingUpdates=!0,e=!1,aa.sortTiles(this._renderer.renderOrder,this._allTiles);
else if(h){this._usedMemory=d;break}}this._visibleLevels.clear()}};c.prototype._processElevation=function(a){var b=this;this._allTiles.some(function(c){c.resetPendingUpdate(32)&&(b._updateTileGeometry(c),a.madeProgress());return a.done});return a.hasProgressed};c.prototype._processTextures=function(a){var b=this;this._allTiles.some(function(c){c.resetPendingUpdate(64)&&(b._renderer.updateTileTexture(c),b._usedMemory=ma,a.madeProgress());return a.done});return a.hasProgressed};c.prototype._updateClippingExtent=
function(){if(!this.spatialReference)return!1;var a=F.create(),b=null;L.extentToBoundingRect(this.view.clippingArea,a,this.spatialReference)&&(b=a);if(F.equals(b,this._clippingExtent))return!1;this._clippingExtent=b;this._renderer.clippingExtent=b;this.notifyChange("extent");this.updateTileOverlayParams();this.overlayManager.setOverlayPlacementDirty();return!0};c.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};Object.defineProperty(c.prototype,"lodBias",
{get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*J.MAX_MEMORY_LOD_BIAS},enumerable:!0,configurable:!0});c.prototype._getLodBiasCorrectedScale=function(a){var b=this.tilingScheme.levels;a=q.clamp(a-this.lodBias,0,b.length-1);var c=a-Math.floor(a);return b[Math.floor(a)].scale*(1-c)+b[Math.ceil(a)].scale*c};c.prototype._cancelTilemapRequests=function(a){var b=0;for(a=a.layerInfo;b<a.length;b++){var c=a[b];if(c)for(var d=
0;d<c.length;d++)c[d].abortTilemapRequest()}};c.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(b){return a._purgeTile(b)}),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();for(var b=0,c=this._topLevelTilemapOnlyTiles;b<c.length;b++){var d=c[b];p.isSome(d)&&this._cancelTilemapRequests(d)}this.visible=!1};c.prototype._purgeChildTiles=function(a){if(a.isLeaf)return!1;var b=this._purgeTile(a.children[0]),b=this._purgeTile(a.children[1])||
b,b=this._purgeTile(a.children[2])||b,b=this._purgeTile(a.children[3])||b;a.unsetChildren();return b};c.prototype._purgeTile=function(a){var b=this._purgeChildTiles(a)||a.rendered;this._allTiles.removeUnordered(a);a.unload(this._renderer);this._cancelTilemapRequests(a);this._tilePool.release(a);return b};c.prototype._splitTile=function(a){Y.weakAssert(a.isLeaf,"tile that is already split should not be split again!");var b=a.level+1,c=2*a.lij[1],d=2*a.lij[2];a.setChildren(this._createTile(b,c,d,a),
this._createTile(b,c,d+1,a),this._createTile(b,c+1,d,a),this._createTile(b,c+1,d+1,a));a.setPendingUpdate(16);a.updateAgentSuspension();this._allTiles.pushArray(a.children);this._pendingUpdates=!0;this._emitTileScaleChange(a,b);return a.children[0].hasPendingUpdate(2)||a.children[1].hasPendingUpdate(2)||a.children[2].hasPendingUpdate(2)||a.children[3].hasPendingUpdate(2)};c.prototype._emitTileScaleChange=function(a,b){void 0===b&&(b=a.level);ha.spatialReference=this.spatialReference;ha.extent=a.extent;
ha.scale=this._getLodBiasCorrectedScale(b);this.emit("scale-change",ha)};c.prototype._createTile=function(a,b,c,d){Y.weakAssert(!!d,"_createTile sanity check");a=this._acquireTile(a,b,c,d);a.updateClippingStatus(this._clippingExtent);a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),2===a.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&a.setPendingUpdate(2));return a};c.prototype._mergeTile=function(a){Y.weakAssert(!a.hasPendingUpdate(2),"_mergeTile sanity check");
this._purgeChildTiles(a)&&(Y.weakAssert(!a.renderData,"_mergeTile sanity check"),this._loadTile(a));this._pendingUpdates=!0;this._emitTileScaleChange(a)};c.prototype._loadChildren=function(a){Y.weakAssert(a.rendered,"parent should be rendered");a.unload(this._renderer);this._loadTile(a.children[0]);this._loadTile(a.children[1]);this._loadTile(a.children[2]);this._loadTile(a.children[3])};c.prototype._loadParent=function(a){a=a.parent;this._unloadChildren(a);this._loadTile(a)};c.prototype._unloadChildren=
function(a){a.isLeaf||(this._unloadChildren(a.children[0]),a.children[0].unload(this._renderer),this._unloadChildren(a.children[1]),a.children[1].unload(this._renderer),this._unloadChildren(a.children[2]),a.children[2].unload(this._renderer),this._unloadChildren(a.children[3]),a.children[3].unload(this._renderer))};c.prototype._loadTile=function(a){a.load(this._renderer);a.setPendingUpdate(16);this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setTileParameters(a,a.renderData,
this._overlayOpacity);this._elevationUpdate(a)};c.prototype._elevationDataArrived=function(a,b,c){c=new K.ElevationData(a.lij,a.extent,c);a.dataArrived(b,0,c);c=[a];a=a.level;var d=this._iteratorPool.acquire();for(d.reset(c);!d.done;){var e=d.next();e.findElevationBoundsForLayer(b,a);e.computeElevationBounds()}this._iteratorPool.release(d);this._updateTiles(c)};c.prototype._scheduleLayerViewChangesUpdate=function(){var a=this;this._scheduledLayerViewChangesHandle||(this._scheduledLayerViewChangesHandle=
x.schedule(function(){return a._handleLayerViewChanges()}),this._handles.add(this._scheduledLayerViewChangesHandle,"scheduledLayerViewChangesHandle"))};c.prototype._handleLayerViewChanges=function(){var a=this;this._handles.remove("scheduledLayerViewChangesHandle");this._scheduledLayerViewChangesHandle=null;for(var b=!1,c=new Set,d=-1,e=0,f=this.view.allLayerViews.items;e<f.length;e++){var g=f[e];c.add(g.uid);if(Y.isSurfaceLayerView(g))if(this._basemapLayerViewHandles.has(g.uid)){var h=this.layerClassFromLayerView(g),
g=this._layerIndexByLayerViewId[h].get(g.uid);g<d&&(b=!0);d=g}else this._registerTiledLayerView(g),g.layer.loaded&&(b=!0)}this._basemapLayerViewHandles.forEach(function(d,e){c.has(e)||(a._unregisterTiledLayerView(e),b=!0)});this.overlayManager&&this.overlayManager.updateLayerViews(c);b&&this._updateTiledLayers()};c.prototype.layerClassFromLayerView=function(a){return Y.isElevationLayerView(a)?0:1};c.prototype._registerTiledLayerView=function(a){var b=this,c=[],d=this.layerClassFromLayerView(a);c.push(a.watch("suspended",
function(){return b._updateTiledLayers()}));c.push(a.watch("fullOpacity",function(){return b._updateTileTextures(!1)}));c.push(a.layer.watch("scaleRangeId",function(){return b._restartAllAgents(d)}));a.on("data-changed",function(){var c=b._layerIndexByLayerViewId[d].get(a.uid);null!=c&&b._invalidateLayerData(c,d)});this._basemapLayerViewHandles.set(a.uid,c)};c.prototype._unregisterTiledLayerView=function(a){var b=this._basemapLayerViewHandles.get(a);if(b){for(var c=0;c<b.length;c++)b[c].remove();
this._basemapLayerViewHandles.delete(a)}};c.prototype._updateTiledLayers=function(){var a=this;if(this.tilingScheme&&!this.view.suspended){var b=this.view.allLayerViews,c=[[],[]],d=null,e=F.empty();b.forEach(function(b){var f=b.layer;if(f&&!b.suspended&&Y.isSurfaceLayerView(b)){var g=b.fullExtent;g?a.tilingScheme.compatibleWith(b.tileInfo)?(F.expand(e,g),f=a.layerClassFromLayerView(b),1===f&&(g=b.displayLevelRange,Infinity!==g.maxLevel&&(null===d||g.maxLevel>d)&&(d=g.maxLevel)),c[f].push(b)):ea.warn("Terrain: tiling scheme of layer "+
f.id+" is incompatible with other tiled layers, will not be drawn"):ea.warn("Terrain: Map or elevation layer does not have fullExtent: "+f.id)}});for(b=0;2>b;b++){var f=this._layerViews[b],g=c[b];g.reverse();var h=g.length,l=f.length!==h,k=Array(h),m=Array(f.length);this._layerIndexByLayerViewId[b].clear();for(var n=0;n<h;n++){this._layerIndexByLayerViewId[b].set(g[n].uid,n);var r=f.indexOf(g[n]);k[n]=r;n!==r&&(l=!0);-1<r&&(m[r]=n)}if(l){f=0;for(h=this._topLevelTilemapOnlyTiles;f<h.length;f++)l=h[f],
p.isSome(l)&&l.modifyLayers(m,k,b);f=this._postorderIterator;for(f.reset(this.rootTiles);!f.done;)f.next().modifyLayers(m,k,b);this._layerViews[b]=g;this._restartAllAgents(b);this._updateTiles(this.rootTiles)}}this.tilingScheme.ensureMaxLod(d)&&this._viewChangeUpdate()}};c.prototype._restartAllAgents=function(a){var b=this._postorderIterator;for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.restartAgents(a);0===a&&c.computeElevationBounds()}};c.prototype._hasFixedExtent=function(){return!!this._clippingExtent};
c.prototype.layerViewByIndex=function(a,b){return this._layerViews[b][a]};c.prototype.numLayers=function(a){return this._layerViews[a].length};c.prototype._updateTileTextures=function(a){var b=this;this._allTiles.forEach(function(c){c.updateAgents(1);a?b.renderer.updateTileTexture(c):c.updateRenderData(1)})};c.prototype._invalidateLayerData=function(a,b){this._allTiles.forEach(function(c){return c.removeLayerAgent(a,b)});this._allTiles.forEach(function(c){return c.invalidateLayerData(a,b)})};c.prototype.requestRender=
function(a){void 0===a&&(a=1);this.renderer.setNeedsRender(a)};c.prototype.setPendingUpdates=function(){this._pendingUpdates||(this._pendingUpdates=!0,this.notifyChange("updating"))};c.prototype.requestTileData=function(a,b,c,d){var e=this,f=this.layerViewByIndex(b,c),g=f.layer;if(g.tilemapCache&&!Y.isVectorTileLayerView(f)){var h=this.getTilemapTile(a),l=h.layerInfo[c][b];if(l.tilemap){if(!h.hasDataAvailable(a,b,c))return this._dataMissing(a,c,f,{notInTilemap:!0}),r.reject()}else return l.tilemapRequestPromise||
(l.tilemapRequestAbort=r.createAbortController(),l.tilemapRequestPromise=this.requestTilemap(h,b,c,f,g,{signal:l.tilemapRequestAbort.signal})),++this._asyncWorkItems,l.tilemapRequestPromise.catch(function(){}).then(function(){--e._asyncWorkItems;l.tilemapRequestPromise=null;l.tilemapRequestAbort=null;r.throwIfAborted(d);var b=e._layerIndexByLayerViewId[c].get(f.uid);if(null!=b){if(h.hasDataAvailable(a,b,c))return e._requestTileData(a,c,f,d);e._dataMissing(a,c,f,{notInTilemap:!0});return r.reject()}})}return this._requestTileData(a,
c,f,d)};c.prototype._requestTileData=function(a,b,c,d){return 0===b?this._requestElevationTileData(a,c,d):this._requestMapTileData(a,c,d)};c.prototype._requestElevationTileData=function(a,b,c){var d=this;if(Y.isElevationLayerView(b)){var e=function(e){--d._asyncWorkItems;if(!r.isAborted(c)){var f=d._layerIndexByLayerViewId[0].get(b.uid);null==f?ea.warn("TerrainSurface: received data from unknown layer %d %s",0,a.lij.toString()):(d._usedMemory=ma,d._pendingUpdates=!0,d._elevationDataArrived(a,f,e))}},
f=function(c){--d._asyncWorkItems;r.isAbortError(c)||d._dataMissing(a,0,b,c)};++this._asyncWorkItems;if(Y.useFetchTileForLayer(b.layer))return b.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2],{noDataValue:J.ELEVATION_NODATA_VALUE,signal:c.signal}).then(function(a){r.isAborted(c)?(ea.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),f(r.createAbortError())):e(a)},f);var g=b.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);
return this._elevationDataRequester.request(g,"binary",c).then(function(a){return d._lercWorker.decode(a,{noDataValue:J.ELEVATION_NODATA_VALUE},c.signal)}).then(function(a){e({values:a.pixelData,width:a.width,height:a.height,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue})},f)}Y.weakAssert(!1,"_requestElevationTileData can only be called for elevation layer views")};c.prototype._requestMapTileData=function(a,b,c){var d=this;if(b instanceof H)return r.reject();++this._asyncWorkItems;
var e=function(e){--d._asyncWorkItems;r.isAborted(c)||d._dataArrived(a,1,b,e)},f=function(e){--d._asyncWorkItems;r.isAborted(c)||d._dataMissing(a,1,b,e)};if(Y.isVectorTileLayerView(b)){var g=b.schemaHelper.getLevelRowColumn(a.lij);return b.tileHandler.getVectorTile(g[0],g[1],g[2],c).then(e,f)}if(Y.useFetchTileForLayer(b.layer)&&Y.isTileLayerView(b))return b.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2],c).then(function(a){r.isAborted(c)?(ea.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),
f(r.createAbortError())):e(a)},f);g=b.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);null!=b.refreshInterval&&b.refreshTimestamp&&(g+=(-1<g.indexOf("?")?"\x26":"?")+"_ts\x3d"+b.refreshTimestamp);return this._mapDataRequester.request(g,b.hasMixedImageFormats?"image+type":"image",c).then(e,f)};c.prototype.requestTilemap=function(a,b,c,d,e,f){var g=this;return e.tilemapCache.fetchTilemap(a.lij[0]+G.TILEMAP_SIZE_EXP,Math.round(a.lij[1]*Math.pow(2,G.TILEMAP_SIZE_EXP)),Math.round(a.lij[2]*Math.pow(2,G.TILEMAP_SIZE_EXP)),
m({},f,{timeout:6E3})).then(function(e){b=g._layerIndexByLayerViewId[c].get(d.uid);null!=b&&(a.layerInfo[c][b].tilemap=e)}).catch(function(){})};c.prototype.getTilemapTile=function(a){var b=a.level;if(b>G.TILEMAP_SIZE_EXP)return aa.getTileNLevelsUp(a,G.TILEMAP_SIZE_EXP);var c=this._topLevelTilemapOnlyTiles[b];if(p.isSome(c))return c;a=aa.getRootTile(a);c=G.TILEMAP_SIZE_EXP-b+a.level;c=new R([b-G.TILEMAP_SIZE_EXP,a.lij[1]/Math.pow(2,c),a.lij[2]/Math.pow(2,c)],this._upsampleInfoPool,[this._layerViews[0].length,
this._layerViews[1].length]);return this._topLevelTilemapOnlyTiles[b]=c};c.prototype._dataArrived=function(a,b,c,d){c=this._layerIndexByLayerViewId[b].get(c.uid);null!=c?a.dataArrived(c,b,d):ea.warn("TerrainSurface: received data from unknown layer")};c.prototype._dataMissing=function(a,b,c,d){c=this._layerIndexByLayerViewId[b].get(c.uid);null!=c?a.dataMissing(c,b,d):ea.warn("TerrainSurface: received data from unknown layer")};c.prototype.updateTileOverlayParams=function(){var a=this;this.rootTiles&&
(this._allTiles.forEach(function(b){b.renderData&&a.overlayManager&&a.overlayManager.setTileParameters(b,b.renderData,a._overlayOpacity)}),this._renderer.setNeedsRender())};c.prototype.updateOverlayOpacity=function(){if(this.overlayManager){var a=this.overlayManager.updateOpacity(this._eyePosSurfaceSR[2]);isNaN(a)||a===this._overlayOpacity||(this._allTiles.forEach(function(b){return b.renderData&&(b.renderData.overlayOpacity=a)}),this._overlayOpacity=a,this._renderer.setNeedsRender())}};c.prototype.getStats=
function(){var a={numNodes:this._allTiles.length,numLeaves:0,numVisible:0,numRendered:0,numRenderedPerLevel:[],numLoadedPerLevel:[]};this._allTiles.forEach(function(b){b.isLeaf&&a.numLeaves++;var c=b.level;b.renderData&&(a.numLoadedPerLevel[c]=(a.numLoadedPerLevel[c]||0)+1);b.visible&&(a.numVisible++,b.rendered&&(a.numRenderedPerLevel[c]=(a.numRenderedPerLevel[c]||0)+1,a.numRendered++))});return a};c.prototype.getUsedMemory=function(){var a=this;if(!this.tilingScheme)return 0;this._usedMemory===ma&&
(this._usedMemory=0,this._allTiles.forEach(function(b){return a._usedMemory+=b.usedMemory}));return this._usedMemory};c.prototype.getUsedMemoryForLayerView=function(a){var b=0,c=this.layerClassFromLayerView(a),d=this._layerIndexByLayerViewId[c].get(a.uid);this._allTiles.forEach(function(a){return b+=a.getUsedMemoryForLayer(c,d)});return b};c.prototype.getTile=function(a){var b=a.split("/").map(function(a){return+a});if(0===b[0])return l.find(this.rootTiles,function(a){return a.lij[1]===b[1]&&a.lij[2]===
b[2]});var c=Math.pow(2,b[0]),d=Math.floor(b[1]/c),e=Math.floor(b[2]/c),f;this.rootTiles.some(function(a){return a.lij[1]===d&&a.lij[2]===e?(f=a,!0):!1});if(f){for(c=1<<b[0]-1;f.lij[0]<b[0];){var g=b[1]&c?2:0;0<(b[2]&c)&&g++;if(!f.children[g])return console.log("Tile "+a+" doesn't exist, smallest ancestor is "+aa.tile2str(f)),null;f=f.children[g];c>>=1}Y.weakAssert(f.lij[0]===b[0]&&f.lij[1]===b[1]&&f.lij[2]===b[2],"not the right tile?");return f}return null};c.prototype.setBorders=function(a){this._renderer.renderPatchBorders=
a};c.prototype.setDisableRendering=function(a){this._renderer.renderingDisabled=a};c.prototype.getRenderedTiles=function(){ga.clear();this._allTiles.forEach(function(a){a.visible&&a.rendered&&ga.push(a)});aa.sortTiles(this.renderOrder,ga);return ga.toArray()};Object.defineProperty(c.prototype,"test",{get:function(){var a=this;return{renderer:this._renderer,lercWorker:this._lercWorker,mergeTile:function(b){return a._mergeTile(b)},updateTiles:function(b){return a._updateTiles(b)},getTiles:function(){return a._allTiles.toArray()}}},
enumerable:!0,configurable:!0});g([v.property()],c.prototype,"_renderer",void 0);g([v.property({constructOnly:!0})],c.prototype,"view",void 0);g([v.property({value:!1})],c.prototype,"cullBackFaces",null);g([v.property({readOnly:!0})],c.prototype,"extent",null);g([v.property({readOnly:!0,dependsOn:["ready","_renderer.updating","_scheduledLayerViewChangesHandle","overlayManager.updating"]})],c.prototype,"updating",null);g([v.property({aliasOf:"view.map.ground.opacity"})],c.prototype,"baseOpacity",void 0);
g([v.property({readOnly:!0})],c.prototype,"overlayManager",void 0);g([v.property({constructOnly:!0})],c.prototype,"manifold",void 0);g([v.property()],c.prototype,"maxTextureScale",void 0);g([v.property({readOnly:!0})],c.prototype,"ready",null);g([v.property({value:1})],c.prototype,"renderOrder",null);g([v.property({readOnly:!0})],c.prototype,"rootTiles",void 0);g([v.property({value:!0})],c.prototype,"skirtScale",null);g([v.property({readOnly:!0,dependsOn:["tilingScheme.spatialReference"]})],c.prototype,
"spatialReference",null);g([v.property()],c.prototype,"backgroundImage",void 0);g([v.property({type:e,aliasOf:"view.map.ground.surfaceColor"})],c.prototype,"backgroundColor",void 0);g([v.property({dependsOn:["backgroundColor","backgroundImage"]})],c.prototype,"_background",null);g([v.property({value:!1})],c.prototype,"slicePlaneEnabled",null);g([v.property({readOnly:!0})],c.prototype,"tilingScheme",void 0);g([v.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],c.prototype,"tilingSchemeLocked",
void 0);g([v.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],c.prototype,"tilingSchemeDone",void 0);g([v.property({readOnly:!0})],c.prototype,"tilingSchemeLogic",void 0);g([v.property({value:!0})],c.prototype,"velvetOverground",null);g([v.property({value:!1})],c.prototype,"wireframe",null);g([v.property({value:!1})],c.prototype,"suspended",null);g([v.property({readOnly:!0,dependsOn:["view.qualitySettings.tiledSurface.reduceTileLevelDifferences"]})],c.prototype,"lodSnapping",
null);g([v.property({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],c.prototype,"textureFadeDuration",void 0);g([v.property()],c.prototype,"_scheduledLayerViewChangesHandle",void 0);return c=g([v.subclass("esri.views.3d.terrain.TerrainSurface")],c)}(v.declared(d.EventedMixin(f)));var fa=1.2,na=80/180*Math.PI,la=110/180*Math.PI,ma=-1,oa=C.vec4f64.create(),ka=F.create(),ia=[0,0,0],ga=new u,ja={spatialReference:null,tile:null,extent:null,context:"ground"},ha={spatialReference:null,
extent:null,scale:0};return b})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/promiseUtils ../../../core/accessorSupport/decorators ./LayerView3D ./TiledLayerView3D ./support/tiledLayerUtils ../../layers/LayerView".split(" "),function(n,b,m,k,g,e,f,l,h,d,a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}m(b,a);b.prototype.initialize=
function(){var a=this.get("view.map.allLayers"),a=a&&a.includes(this.layer),b=this.get("view.map.ground.layers"),b=b&&b.includes(this.layer);a&&!b&&(a=new g("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(e.reject(a)));this._addTilingSchemeMatchPromise();this.addResolvingPromise(d.checkArcGISServiceVersionCompatibility(this.layer))};k([f.property({readOnly:!0,aliasOf:"layer.fullExtent"})],b.prototype,"fullExtent",
void 0);k([f.property()],b.prototype,"layer",void 0);k([f.property({readOnly:!0,aliasOf:"layer.tileInfo"})],b.prototype,"tileInfo",void 0);return b=k([f.subclass("esri.views.3d.layers.ElevationLayerView3D")],b)}(f.declared(h.TiledLayerView3D(l.LayerView3D(a))))})},"esri/views/3d/layers/LayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/heightModelInfoUtils".split(" "),
function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});b.LayerView3D=function(b){return function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a.slicePlaneEnabled=!1;a.supportsHeightUnitConversion=!1;return a}m(a,b);a.prototype.destroy=function(){this.view=null};a.prototype.postscript=function(a){this.inherited(arguments);l.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};a.prototype._validateHeightModelInfo=function(){var a=
this;return g.create(function(b,c){e.whenFalseOnce(a.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var d=l.rejectLayerError(a.layer,a.view.heightModelInfo,a.supportsHeightUnitConversion);d?c(d):b()})})};k([f.property()],a.prototype,"view",void 0);k([f.property()],a.prototype,"slicePlaneEnabled",void 0);return a=k([f.subclass("esri.views.3d.layers.LayerView3D")],a)}(f.declared(b))}})},"esri/views/3d/layers/TiledLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./support/layerViewUpdatingProperties ../terrain/terrainUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){Object.defineProperty(b,"__esModule",{value:!0});b.TiledLayerView3D=function(b){return function(b){function c(){return null!==b&&b.apply(this,arguments)||this}m(c,b);Object.defineProperty(c.prototype,"imageFormatIsOpaque",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"isOpaque",{get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"dataLevelRange",
{get:function(){var a=this.tileInfo.lods;return this.levelRangeFromScaleRange(a[0].scale,a[a.length-1].scale)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"displayLevelRange",{get:function(){var a=this.tileInfo.lods,a=this.levelRangeFromScaleRange(this.layer.minScale||a[0].scale,this.layer.maxScale||a[a.length-1].scale);this.layer.maxScale&&a.maxLevel++;return a},enumerable:!0,configurable:!0});c.prototype.getTileUrl=function(a,b,c){return this.layer.getTileUrl(a,b,c)};c.prototype._addTilingSchemeMatchPromise=
function(){var a=this,b=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent);b?this.addResolvingPromise(f.reject(b)):(b=l.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){var b=a._getTileInfoCompatibilityError(a.tileInfo,a.view.basemapTerrain.tilingScheme);if(b)throw b;}),this.addResolvingPromise(b))};c.prototype._getTileInfoSupportError=function(b,c){if(b=a.checkIfTileInfoSupportedForView(b,c,this.view.spatialReference,this.view.basemapTerrain.manifold)){c=
{layer:this.layer,error:b};var d=void 0;switch(b.name){case "tilingscheme:local-gcs-not-supported":d=new e("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",c);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":d=new e("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",c);break;default:d=new e("layerview:tiling-scheme-unsupported",
"The tiling scheme of this layer is not supported by SceneView",c)}return d}return null};c.prototype._getTileInfoCompatibilityError=function(a,b){return b.compatibleWith(a)?null:new e("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};c.prototype.levelRangeFromScaleRange=function(a,b){var c={minLevel:0,maxLevel:Infinity},d=this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!d)return c;var e=d.levels[0],d=
function(a){a=Math.log(e.scale/a)/Math.LN2;return 1E-9>.5-Math.abs(.5-a%1)?Math.round(a):Math.ceil(a)};null!=a&&0<a&&(c.minLevel=Math.max(0,d(a)));null!=b&&0<b&&(c.maxLevel=Math.max(0,d(b)));return c};c.prototype.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};k([h.property({readOnly:!0})],c.prototype,"imageFormatIsOpaque",null);k([h.property({readOnly:!0,dependsOn:["view.basemapTerrain.updating"]})],c.prototype,"updating",void 0);k([h.property(d.updatingProgress)],
c.prototype,"updatingProgress",void 0);k([h.property(d.updatingProgressValue)],c.prototype,"updatingProgressValue",void 0);k([h.property({readOnly:!0})],c.prototype,"fullExtent",void 0);k([h.property({readOnly:!0,dependsOn:["fullOpacity","imageFormatIsOpaque"]})],c.prototype,"isOpaque",null);k([h.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme"]})],c.prototype,"dataLevelRange",null);k([h.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme","layer.minScale",
"layer.maxScale"]})],c.prototype,"displayLevelRange",null);k([h.property()],c.prototype,"layer",void 0);k([h.property({readOnly:!0})],c.prototype,"tileInfo",void 0);return c=k([h.subclass("esri.views.3d.layers.TiledLayerView3D")],c)}(h.declared(b))}})},"esri/views/3d/layers/support/layerViewUpdatingProperties":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.updatingProgressValue={value:.5,readOnly:!0};b.updatingProgress={dependsOn:["updating",
"updatingProgressValue"],readOnly:!0,value:.5,get:function(){return this.updating?this.updatingProgressValue:1}}})},"esri/views/3d/layers/support/tiledLayerUtils":function(){define("require exports ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../layers/support/arcgisLayerUrl".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});var f=k.getLogger("esri.views.3d.layers.support.tiledLayerUtils");b.checkArcGISServiceVersionCompatibility=
function(b){if(!e.isHostedAgolService(b.url)){if(10.22>b.version)return b=new m("layerview:service-version-too-old","Tiled Map Layers on servers prior to 10.2.2 are not supported. Detected version: "+b.version,{minVersion:10.22,detectedVersion:b.version}),g.reject(b);10.22!==b.version||e.isHostedSecuredProxyService(b.url,b.get("portalItem.id"))||f.warnOnce("ArcGIS server version 10.2.2 needs the following patch installed in order for map layers to work properly: https://support.esri.com/en/download/2146");
return g.resolve()}}})},"esri/views/3d/terrain/ElevationBounds":function(){define(["require","exports","../../../core/tsSupport/extendsHelper"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e){void 0===b&&(b=0);void 0===e&&(e=0);this.min=b;this.max=e;this.level=0;this.hasNoDataValues=!1}b.prototype.copyFrom=function(b){this.min=b.min;this.max=b.max;this.level=b.level;this.hasNoDataValues=b.hasNoDataValues};return b}();b.ElevationBounds=n})},"esri/views/3d/terrain/ElevationData":function(){define(["require",
"exports","../../../core/mathUtils","../support/mathUtils","./TerrainConst"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e,g){this.samplerData=null;this.level=b[0];this.i=b[1];this.j=b[2];this.extent=e;b=g.noDataValue;for(var d=g.values,a=Infinity,c=-Infinity,f=!0,h=!1,l=0;l<d.length;l++){var k=d[l];k!==b?(a=k<a?k:a,c=k>c?k:c,f=!1):h=!0}f&&(c=a=0);this.samplerData={pixelData:g.values,width:g.width,height:g.height,noDataValue:b,safeWidth:.99999999*
(g.width-1),dx:(g.width-1)/(e[2]-e[0]),dy:(g.width-1)/(e[3]-e[1]),x0:e[0],y1:e[3]};this.bounds=[a,-3E38<c?c:0];this.hasNoDataValues=h}b.prototype.release=function(){this.bounds=this.samplerData=null};b.prototype.computeMinMaxValue=function(b,e,h,d){d.min=Infinity;d.max=-Infinity;d.hasNoDataValues=!1;b-=this.level;if(0>=b)return d;var a=Math.pow(2,b);if(Math.floor(e/a)!==this.i||Math.floor(h/a)!==this.j)return d;var c=Infinity,f=-Infinity,l=this.samplerData.width,m=this.samplerData.pixelData,n=.5*
g.ELEVATION_NODATA_VALUE;b=(l-1)/a;h=(h-this.j*a)*b;var r=(e-this.i*a)*b;if(1>b){var x=Math.floor(h),w=Math.floor(r),v=x+w*l;e=m[v];var a=m[v+1],z=m[v+l],v=m[v+l+1];if(e+a+z+v<n)return c=h-x,n=r-w,f=k.bilerp(e,a,z,v,c,n),l=k.bilerp(e,a,z,v,c+b,n),m=k.bilerp(e,a,z,v,c,n+b),b=k.bilerp(e,a,z,v,c+b,n+b),d.min=Math.min(f,l,m,b),d.max=Math.max(f,l,m,b),d;h=x;r=w;b=1}else h=Math.floor(h),r=Math.floor(r),b=Math.ceil(b);for(e=h;e<=h+b;e++)for(a=r;a<=r+b;a++)v=e+a*l,z=m[v],z<n?(c=Math.min(c,z),f=Math.max(f,
z)):d.hasNoDataValues=!0;d.min=c;d.max=f;return d};b.sample=function(b,e,h){for(var d=0;d<h.length;d++){var a=h[d];if(a){var c=a.safeWidth,f=a.width,l=a.pixelData,k=m.clamp(a.dy*(a.y1-e),0,c),a=m.clamp(a.dx*(b-a.x0),0,c),c=Math.floor(k),n=Math.floor(a),r=c*f+n,x=r+f,w=l[r],f=l[x],r=l[r+1],l=l[x+1];if(w+f+r+l<.5*g.ELEVATION_NODATA_VALUE)return k-=c,a-=n,b=w+(r-w)*a,b+(f+(l-f)*a-b)*k}}return null};return b}();b.ElevationData=n})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TerrainConst ./TileAgent".split(" "),
function(n,b,m,k,g,e){return function(b){function e(){var e=null!==b&&b.apply(this,arguments)||this;e._scaleRangeEnabled=!1;return e}m(e,b);Object.defineProperty(e.prototype,"_desiredMinLevelDelta",{get:function(){return g.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"_loadingLevelDelta",{get:function(){return 0},enumerable:!0,configurable:!0});e.Pool=new k(e);return e}(e.TileAgent)})},"esri/views/3d/terrain/TileAgent":function(){define(["require",
"exports","../../../core/tsSupport/extendsHelper","./TerrainConst","./tileUtils"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});var e=Error("Abstract method called on TileAgent");n=function(){function b(){}Object.defineProperty(b.prototype,"updating",{get:function(){return!!this._tileRequested},enumerable:!0,configurable:!0});b.prototype.init=function(b,e,d,a){this.tile=b;this._layerIdx=e;this._layerClass=d;this._suspended=a;this._tileLayerInfo=b.getLayerInfo(e,d);this._tileRequested=
null;b=this._findAncestorWithData();this._setUpsampleTile(b)};b.prototype.startLoading=function(){return this._requestNext()};b.prototype.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=null};b.prototype.setSuspension=function(b){b!==this._suspended&&((this._suspended=b)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=
null):this._tileLayerInfo.data||this.update())};b.prototype.update=function(){var b=this._findAncestorWithData();this._setUpsampleTile(b);return this._requestNext()};b.prototype.dataArrived=function(b){this._setUpsampleTile(b);this._tileRequested=null;b===this.tile?this.tile.updateRenderData(this._layerClass):this._requestNext()};b.prototype.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};b.prototype._agentDone=function(){this.tile.agentDone(this._layerIdx,
this._layerClass);this.dispose()};b.prototype._requestNext=function(){if(this._suspended)return!0;var b=this._findNextDownload();k.TILE_LOADING_DEBUGLOG&&console.log(g.tile2str(this.tile),"next",g.tile2str(b));if(this._tileRequested){if(b===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}b?b.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=b):this._agentDone();return!!this._tileRequested};
b.prototype._findNextDownload=function(){for(var b=this._layerIdx,e=this._layerClass,d=this.tile.surface.layerViewByIndex(b,e),a=d.layer,c=d.dataLevelRange,d=c.minLevel,c=c.maxLevel,f=this._desiredMinLevelDelta,m=this._loadingLevelDelta+f,n=this._scaleRangeEnabled?g.fallsWithinLayer:function(){return!0},u,r=this.tile,x=0,w=this._tileLayerInfo.upsampleInfo,w=w?w.tile.level:-1,v=this.tile.surface,z=v.getTilemapTile(r);r&&n(r,a,!1)&&r.level>=d;){var y=r.level,A=r.layerInfo[e][b];if(A.data&&x>=f){y>w&&
this._setUpsampleTile(r);A.dataInvalidated&&(u=r);break}if((!z||z.hasDataAvailable(r,b,e))&&y<=c&&!A.data&&!A.dataMissing){if(!u||0===y%k.LOADING_LEVEL_MODULO||this.tile.level-u.level<f)u=r;if(x>=m)break}(r=r.parent)&&z&&(z=z.parent||v.getTilemapTile(r));x++}u&&this.tile.level-u.level<f&&this._tileLayerInfo.upsampleInfo&&(u=null);return u};b.prototype._findAncestorWithData=function(){for(var b=this.tile.vlevel,e=this._desiredMinLevelDelta,d,a=this.tile;a;a=a.parent)if(a.hasLayerData(this._layerIdx,
this._layerClass)){if(b-a.level>=e)return a;d=a}return d};b.prototype._setUpsampleTile=function(b){this._tileLayerInfo.setUpsampleInfo(this.tile,b);this.tile.updateRenderData(this._layerClass)};Object.defineProperty(b.prototype,"test",{get:function(){var b=this;return{findNextDownload:function(){return b._findNextDownload()},tileLayerInfo:this._tileLayerInfo}},enumerable:!0,configurable:!0});return b}();b.TileAgent=n;n=function(b){function f(){return null!==b&&b.apply(this,arguments)||this}m(f,b);
Object.defineProperty(f.prototype,"_desiredMinLevelDelta",{get:function(){throw e;},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"_loadingLevelDelta",{get:function(){throw e;},enumerable:!0,configurable:!0});return f}(n);b.TILE_AGENT_DONE=new n})},"esri/views/3d/terrain/tileUtils":function(){define(["require","exports","../../../core/PooledArray"],function(n,b,m){function k(b){return b?b[0]+"/"+b[1]+"/"+b[2]:"null"}function g(b,e){e(b);if(!b.isLeaf){var f=0;for(b=b.children;f<
b.length;f++)g(b[f],e)}}function e(b,e,g){b=b.screenDepth;e=e.screenDepth;return b<e?-g:b>e?g:0}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.q=new m;this._last=null}Object.defineProperty(b.prototype,"done",{get:function(){return 0===this.q.length&&(!this._last||this._last.isLeaf)},enumerable:!0,configurable:!0});b.prototype.resetOne=function(b){this.q.clear();this.q.push(b);this._last=null};b.prototype.reset=function(b){this.q.clear();b&&this.q.pushArray(b);this._last=
null};b.prototype.skipSubtree=function(){this._last=null};b.prototype.next=function(){this._last&&!this._last.isLeaf&&this.q.pushArray(this._last.children);return this._last=this.q.pop()};return b}();b.IteratorPreorder=n;n=function(){function b(){this.q=new m}Object.defineProperty(b.prototype,"done",{get:function(){return 0===this.q.length},enumerable:!0,configurable:!0});b.prototype.reset=function(b){this.q.clear();if(b)for(this.q.pushArray(b),b=0;b<this.q.length;++b){var e=this.q.data[b];e.isLeaf||
this.q.pushArray(e.children)}};b.prototype.next=function(){return this.q.pop()};return b}();b.IteratorPostorder=n;b.lij2str=k;b.tile2str=function(b){return b?k(b.lij):"null"};b.traverseTilesPreorder=function(b,e){if(Array.isArray(b))for(var f=0;f<b.length;f++)g(b[f],e);else g(b,e)};b.fallsWithinLayer=function(b,e,g){if(!e)return!1;var d=e.fullExtent,a=b.extent;if(g){if(a[0]<d.xmin||a[1]<d.ymin||a[2]>d.xmax||a[3]>d.ymax)return!1}else if(d.xmin>a[2]||d.ymin>a[3]||d.xmax<a[0]||d.ymax<a[1])return!1;b=
b.surface.tilingScheme.levels[b.lij[0]].scale;return 0<e.minScale&&b>1.00000001*e.minScale||0<e.maxScale&&b<.99999999*e.maxScale?!1:!0};b.getTileNLevelsUp=function(b,e){for(;e--;)b=b.parent;return b};b.getRootTile=function(b){for(;b.parent;)b=b.parent;return b};b.nextTileInAncestry=function(b,e){var f=b.lij[0]-e.lij[0]-1,d=b.lij[2]>>f,a=0;b.lij[1]>>f&1&&(a+=2);d&1&&(a+=1);return e.children[a]};b.sortTiles=function(b,g){g.sort(function(f,d){return e(f,d,b)})};b.compareTiles=e;b.computeUpsampleInfo=
function(b,e,g){for(var d=1,a=0,c=0;b!==e;)if(d*=.5,a*=.5,c*=.5,b.lij[2]&1&&(a+=.5),0===(b.lij[1]&1)&&(c+=.5),b=b.parent,null==b)throw Error("tile was not a descendant of upsampleTile");g.init(e,a,c,d)};b.hasVisibleSiblings=function(b){for(var e=0;e<b.length;e++){var f=b[e],d=f.parent;if(d)for(var a=0;4>a;a++){var c=d.children[a];if(c&&c!==f&&c.visible)return!0}}return!1};b.tilesAreRelated=function(b,e){if(!b||!e)return!1;var f=b[0]<e[0],d=f?b:e;b=f?e:b;e=b[0]-d[0];if(0===e)return!1;e=1<<e;return Math.floor(b[1]/
e)===d[1]&&Math.floor(b[2]/e)===d[2]}})},"esri/views/3d/terrain/MapTileAgent":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/ObjectPool","./TileAgent"],function(n,b,m,k,g){return function(b){function e(){var e=b.call(this)||this;e._scaleRangeEnabled=!0;return e}m(e,b);Object.defineProperty(e.prototype,"_desiredMinLevelDelta",{get:function(){return 0},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"_loadingLevelDelta",{get:function(){return 8},
enumerable:!0,configurable:!0});e.Pool=new k(e);return e}(g.TileAgent)})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Graphic ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/mathUtils ../../../core/now ../../../core/scheduling ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../layers/support/timeUtils ../../../symbols/SimpleMarkerSymbol ../state/utils/viewUtils ../support/animationUtils ../support/debugFlags ../support/debugFlags ../support/earthUtils ../support/geometryUtils ../support/mathUtils ../support/projectionUtils ./OverlayRenderer ../webgl-engine/lib/Intersector ../webgl-engine/lib/localOrigin ../../support/Scheduler".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L,O,K){function N(a,b){for(var c=C.TESTS_DISABLE_UPDATE_THRESHOLDS?0:1E-5*Math.max(a[2]-a[0],a[3]-a[1],b[2]-b[0],b[3]-b[1]),d=0;4>d;d++)if(Math.abs(b[d]-a[d])>c)return!0;return!1}function Q(a){a=a.renderTargets;return+a.color.valid|+a.colorWithoutRasterImage.valid<<1|+a.highlight.valid<<2|+a.water.valid<<3|+a.occluded.valid<<4}Object.defineProperty(b,"__esModule",{value:!0});var M=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],
[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],T;n=function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a._handles=new f;a._overlaySR=null;a._renderSR=null;a._overlaySREqualsRenderSR=!0;a._drapeSources=new Map;a._drapeTargets=new Set;a._overlays=null;a._drapeSourceTypes=[0,0];a._drapeTargetTypes=[0,0];a._renderedAltitude=0;a._placementDirty=!1;a._drawTexturesDirty=!1;a._drawTexturesAnimateDirty=!1;a._hasUnusedRenderTargets=!1;a._isSpherical=
!1;a._longitudeCyclical=null;a._latestOriginId=0;a._maxResolution=l("esri-mobile")?2048:4096;a._animationTimeLast=0;a._forceAnimation=!1;return a}m(e,b);Object.defineProperty(e.prototype,"updating",{get:function(){return this.needsUpdate()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"rendersOccluded",{get:function(){return this._renderer.rendersOccluded},
enumerable:!0,configurable:!0});e.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this._renderer=new I.OverlayRenderer(this._stage.renderView);this._stage.renderView.updateLogicClients.add(this._renderer);this._drapeTargetTypes[0]++;this._renderer.onHasHighlightsChanged=function(){a.setDrawTexturesDirty();a.notifyChange("hasHighlights")};this._renderer.onRendersOccludedChanged=function(){a.setDrawTexturesDirty();a.notifyChange("rendersOccluded")};this._renderer.onContentChanged=
function(){return a.setDrawTexturesDirty()};this.groundIntersector=new L.Intersector(this.view.viewingMode);this.groundIntersector.options.backfacesTerrain=!0;this.groundIntersector.options.invisibleTerrain=!0;this.groundIntersector.options.hud=!1;this._handles.add([this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],function(){return a.setOverlayPlacementDirty()}),this.terrainSurface.on("elevation-change",function(){return a.setOverlayPlacementDirty()}),
this.view.on("resize",function(){return a.setOverlayPlacementDirty()}),c.addFrameTask({preRender:function(b){a._renderer.commitChanges();a.hasOverlays()&&(a._dispatchRendererUpdate(b),a._drawOverlayTextures());a._hasUnusedRenderTargets&&a._collectUnusedRenderTargetMemory()}}),this.view.resourceController.scheduler.registerTask(K.Task.OVERLAY_MANAGER,function(){return a.updateOverlays()},function(){return a.needsUpdate()}),this.view._stage.renderView.events.on("force-camera-for-screenshot",function(b){a.updateOverlays(b);
a._drawOverlayTextures()})])};e.prototype.destroy=function(){var a=this;this._drapeSources.forEach(function(b,c){return a._unregisterDrapeSource(c)});this._drapeTargets.forEach(function(b,c){return a._unregisterDrapeTarget(c)});this._drapeTargetTypes[0]--;this._disposeOverlays();this._stage.renderView.updateLogicClients.remove(this._renderer);this._renderer.dispose();this._handles&&(this._handles.destroy(),this._handles=null)};Object.defineProperty(e.prototype,"renderer",{get:function(){return this._renderer},
enumerable:!0,configurable:!0});e.prototype.onHasHighlightsChanged=function(){this.setOverlayContentDirty();this.notifyChange("hasHighlights")};e.prototype.hasOverlays=function(){return!!this._overlays};e.prototype.setSpatialReference=function(a,b){this._overlaySR=a;this._longitudeCyclical=null;if(a){if(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._isSpherical=b)this._longitudeCyclical=a.isWebMercator?new H.Cyclical(-2.0037508342787E7,
2.0037508342787E7):new H.Cyclical(-180,180),this._renderer.longitudeCyclical=this._longitudeCyclical}else this._disposeOverlays();this.notifyChange("updating")};e.prototype.getGpuMemoryUsage=function(){return this._renderer.getGpuMemoryUsage()};e.prototype.updateLayerViews=function(a){for(var b=this,c=0,d=this.view.allLayerViews.items;c<d.length;c++){var e=d[c];"drapeSourceType"in e&&!this._drapeSources.has(e)&&this._registerDrapeSource(e);"drapeTargetType"in e&&!this._drapeTargets.has(e)&&this._registerDrapeTarget(e)}this._drapeSources.forEach(function(c,
d){a.has(d.uid)||b._unregisterDrapeSource(d)});this._drapeTargets.forEach(function(c){a.has(c.uid)||b._unregisterDrapeTarget(c)});this._renderer.updateLayerOrder();this.setDrawTexturesDirty()};e.prototype._registerDrapeSource=function(a){var b=this,c=a.on("draped-data-change",function(){return b.setOverlayContentDirty()});this._drapeSourceTypes[a.drapeSourceType]++;this._drapeSources.set(a,[c]);this._overlays&&a.setDrapingExtent&&this._overlays.forEach(function(c,d){return b._updateDrapeSource(a,
d,c)});this.setOverlayContentDirty()};e.prototype._updateDrapeSource=function(a,b,c){a.setDrapingExtent&&a.setDrapingExtent(b,c.extent,this._overlaySR,c.resolution,c.renderLocalOrigin,c.pixelRatio)};e.prototype._unregisterDrapeSource=function(a){if(this._drapeSources.has(a)){var b=this._drapeSources.get(a);b&&b.forEach(function(a){return a.remove()});this._drapeSourceTypes[a.drapeSourceType]--;this._drapeSources.delete(a);this.setOverlayContentDirty()}};e.prototype._registerDrapeTarget=function(a){this._drapeTargets.add(a);
this._updateDrapeTarget(a);this._drapeTargetTypes[a.drapeTargetType]++};e.prototype._updateDrapeTarget=function(a){var b=this;this._overlays&&this._overlays.forEach(function(c,d){var e=c.renderTargets,f=b.needsColorWithoutRasterImage()?e.colorWithoutRasterImage:b.hasDrapedFeatures()?e.color:null,g=e.highlight,e=e.water;a.setDrapingTextures(d,c.extent,f&&f.valid?b.renderer.getRenderTargetTexture(f.id):null,g.valid?b.renderer.getRenderTargetTexture(g.id):null,e.valid?b.renderer.getRenderTargetTexture(e.id):
null)})};e.prototype._unregisterDrapeTarget=function(a){this._drapeTargets.delete(a);this._drapeTargetTypes[a.drapeTargetType]--};e.prototype.setOverlayContentDirty=function(){this.setOverlayPlacementDirty();this.setDrawTexturesDirty()};e.prototype.setOverlayPlacementDirty=function(){this._placementDirty=!0;this.notifyChange("updating")};e.prototype.updateOverlays=function(a){void 0===a&&(a=this.view.state.camera);if(this._overlaySR){var b;b=h.nextHighestPowerOfTwo(Math.max(a.fullWidth,a.fullHeight)+
256);var c=Math.min(b,this._maxResolution);this._computeOverlayExtents(a,b,U);b=v.width(U.inner)/v.width(U.outer);this._initOverlays();a=this._updateOverlay(0,U.inner,c,1);c=this._updateOverlay(1,U.outer,c,b);if(a||c)this.terrainSurface.updateTileOverlayParams(),this.setDrawTexturesDirty();this._placementDirty=!1;this.terrainSurface.updateOverlayOpacity();this.notifyChange("updating")}};e.prototype._updateOverlay=function(a,b,c,d){var e=this,f=this._overlays[a];if(!N(b,f.extent)&&c===f.resolution&&
f.pixelRatio===d)return!1;v.set(f.extent,b);f.resolution=c;f.pixelRatio=d;b=v.center(f.extent);f.renderLocalOrigin=O.fromValues(b[0],b[1],0,"OV_"+this._latestOriginId++);this._drapeSources.forEach(function(b,c){return e._updateDrapeSource(c,a,f)});return!0};e.prototype.needsUpdate=function(){return this._placementDirty&&(0<this._drapeSources.size||0<this.view.graphics.length||F.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._overlaySR&&!this._get("suspended")&&this.terrainSurface.ready};e.prototype.updateOpacity=
function(a){return this._overlays?this._getAltitudeBasedOpacity(a,this._renderedAltitude):1};e.prototype._getAltitudeBasedOpacity=function(a,b){return 3.5*a<b?Math.sqrt(h.clamp((a-b/10)/(b/3.5-b/10),0,1)):1};e.prototype.setTileParameters=function(a,b,c){if(this._overlays){var d=this._overlays[0],e=this._overlays[1];a=v.intersection(a.extent,a.surface.extent,Y);this._rectInsideRect(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1])):this._rectanglesOverlap(a,
d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._setTileOverlayData(a,e,b.overlays[1])):(this._rectanglesOverlap(a,e.extent)?this._setTileOverlayData(a,e,b.overlays[0]):this._invalidateTileOverlayData(b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1]))}else this._invalidateTileOverlayData(b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1]);b.overlayOpacity=void 0!==c?c:1};e.prototype.overlayPixelSizeInMapUnits=function(a){if(!this._overlays)return 0;var b=this._overlays[0],
c=this._overlays[1];a=this._pointIsInExtent(a,b.extent)?b:c;return(a.extent[2]-a.extent[0])/a.resolution};e.prototype._setTileOverlayData=function(a,b,c){var d=b.extent;c.texScale[0]=(a[2]-a[0])/(d[2]-d[0]);c.texScale[1]=(a[3]-a[1])/(d[3]-d[1]);var e=a[0];if(this._longitudeCyclical){var e=this._longitudeCyclical.minimalMonotonic(d[0],e),f=this._longitudeCyclical.minimalMonotonic(d[0],a[2]);e>f&&(e=f-(a[2]-a[0]))}c.texOffset[0]=(e-d[0])/(d[2]-d[0]);c.texOffset[1]=(a[1]-d[1])/(d[3]-d[1]);a=b.renderTargets;
c.renderTargetIds.color=a.color.valid?a.color.id:null;c.renderTargetIds.highlight=a.highlight.valid?a.highlight.id:null;c.renderTargetIds.water=a.water.valid?a.water.id:null;c.renderTargetIds.occluded=a.occluded.valid?a.occluded.id:null};e.prototype._invalidateTileOverlayData=function(a){a.renderTargetIds.color=null;a.renderTargetIds.highlight=null;a.renderTargetIds.water=null;a.renderTargetIds.occluded=null};e.prototype._createEmptyOverlay=function(a){return{extent:v.create(),resolution:0,renderTargets:{color:{id:this._renderer.createRenderTarget("overlay"+
a,!0),valid:!1,lastUsed:Infinity},colorWithoutRasterImage:{id:this._renderer.createRenderTarget("overlayWithoutRasterImage"+a,!0),valid:!1,lastUsed:Infinity},highlight:{id:this._renderer.createRenderTarget("overlayHighlight"+a,!1),valid:!1,lastUsed:Infinity},water:{id:this._renderer.createRenderTarget("overlayWaterMask"+a,!0),valid:!1,lastUsed:Infinity},occluded:{id:this._renderer.createRenderTarget("overlayOccluded"+a,!0),valid:!1,lastUsed:Infinity}},renderLocalOrigin:O.fromValues(0,0,0,"O"),pixelRatio:1}};
e.prototype._initOverlays=function(){this._overlays||(this._overlays=[this._createEmptyOverlay(0),this._createEmptyOverlay(1)])};e.prototype._disposeOverlays=function(){var a=this;this._overlays&&(this._overlays.forEach(function(b){a._renderer.disposeRenderTarget(b.renderTargets.color.id);a._renderer.disposeRenderTarget(b.renderTargets.colorWithoutRasterImage.id);a._renderer.disposeRenderTarget(b.renderTargets.highlight.id);a._renderer.disposeRenderTarget(b.renderTargets.water.id);a._renderer.disposeRenderTarget(b.renderTargets.occluded.id)}),
this._overlays=null)};e.prototype.forceAnimation=function(){this._forceAnimation=!0};e.prototype._dispatchRendererUpdate=function(a){var b=z.Milliseconds(a.time-this._animationTimeLast);b<B.DESIRED_DRAPED_ANIMATION_MS&&!this._forceAnimation||(this._forceAnimation=!1,this._animationTimeLast=a.time,this._renderer.updateLogic({dt:b,camera:this._stage.getCamera()})&&(this._drawTexturesAnimateDirty=!0))};e.prototype.setDrawTexturesDirty=function(){this._overlays?this._drawTexturesDirty=!0:this.setOverlayPlacementDirty()};
e.prototype._intersectGroundFromView=function(a,b,c,d){c=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(a,R,b,c);b=c.origin;c=t.vec3.add(J,c.origin,c.direction);this.groundIntersector.reset(b,c);this.groundIntersector.intersect([],null,a);this.view.basemapTerrain.intersect(this.groundIntersector,null,b,c);return this.groundIntersector.results.min.getIntersectionPoint(d)};e.prototype._findHorizonBasedPointOfInterest=function(a,b,c){var d=.5;if("global"===this.view.viewingMode){d=
u.vec3f64.clone(a.eye);t.vec3.normalize(d,d);t.vec3.negate(d,d);b=t.vec3.length(b);b=Math.asin(b/t.vec3.length(a.eye));var e=Math.acos(t.vec3.dot(a.viewForward,d)),d=h.clamp((b-(e-.5*a.fovY))/a.fovY,0,1);b=h.clamp((-b-(e-.5*a.fovY))/a.fovY,0,1);d=1===d&&0===b?.5:b+.55*(d-b)}else d=x.vec4f64.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0),d=r.vec4.transformMat4(d,d,a.projectionMatrix)[1],d=h.clamp(.5+.5*d,0,1),d=1===d||0===d?.5:0<a.eye[2]?.55*d:1-.55*(1-d);return this._intersectGroundFromView(a,
.5,d,c)?!0:!1};e.prototype._computeOverlayExtents=function(a,b,c){var e=this.terrainSurface.extent,f=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,h=u.vec3f64.create();this._findHorizonBasedPointOfInterest(a,f,h)||t.vec3.copy(h,f);this._renderedAltitude=this.view.renderCoordsHelper.getAltitude(a.eye);var l=t.vec3.distance(a.eye,h),f=A.viewAngle(this.view.renderCoordsHelper,f,a.eye),f=Math.PI/2-Math.abs(f-Math.PI/2);if(F.OVERLAY_SHOW_CENTER){var k=new y({color:[255,0,0],outline:{color:[255,
255,255],width:2}}),m=new w;D.vectorToPoint(h,this._renderSR,m,this._overlaySR);k=new g({geometry:m,symbol:k});void 0!==T&&this.view.graphics.remove(T);this.view.graphics.add(k);T=k}this._overlaySREqualsRenderSR||D.vectorToVector(h,this._renderSR,h,this._overlaySR);var l=b*a.perRenderPixelRatio*l/2,n=!1,k=Infinity;this._isSpherical&&(this._overlaySR.isWebMercator?(l/=Math.cos(D.webMercator.y2lat(h[1])),k=this.terrainSurface.extent[3]):(n=!0,l/=E.metersPerDegree,k=90),l>=k&&(l=k,h[1]=0,this._overlaySR.isWebMercator&&
(h[0]=0)));m=1;n&&(m=1/Math.max(.2,Math.cos(Math.abs(d.deg2rad(h[1])))),180<l*m&&(m=180/l));var n=Math.log(2)/12,l=Math.exp(Math.round(Math.log(l)/n)*n),n=l*m,q=.5*b/(32*n);b=.5*b/(32*l);h[0]=Math.round(h[0]*q)/q;h[1]=Math.round(h[1]*b)/b;b=c.inner;b[0]=h[0]-n;b[1]=h[1]-l;b[2]=h[0]+n;b[3]=h[1]+l;this._isSpherical&&this._shiftExtentToFitBounds(b,Infinity,k);c=c.outer;v.set(c,b);6*n>e[2]-e[0]?v.set(c,e):f<=.25*Math.PI?(c[0]-=n,c[1]-=l,c[2]+=n,c[3]+=l):(D.vectorToVector(a.eye,this._renderSR,J,this._overlaySR),
p.vec2.subtract(V,h,J),a=-Math.atan2(V[1],V[0])+.125*Math.PI,0>a&&(a+=2*Math.PI),r.vec4.scale(V,M[Math.floor(a/(.25*Math.PI))],2*l),V[0]*=m,V[2]*=m,r.vec4.add(c,c,V));this._isSpherical&&(c[0]=this._longitudeCyclical.clamp(c[0]),c[2]=this._longitudeCyclical.clamp(c[2]),c[1]=Math.max(c[1],-k),c[3]=Math.min(c[3],k));!this._isSpherical&&e&&(a=v.intersection(b,e,Y),e=v.intersection(c,e,X),v.contains(a,e)&&(c[2]=c[0],c[3]=c[1]))};e.prototype._drawOverlayTextures=function(){var a=this;if(this._drawTexturesDirty||
this._drawTexturesAnimateDirty){var b=this._drawOverlay(0),c=this._drawOverlay(1);0!==b&&0!==c||this.terrainSurface.updateTileOverlayParams();this._collectUnusedRenderTargetMemory();this._drapeTargets.forEach(function(b){return a._updateDrapeTarget(b)});this._drawTexturesDirty?(this._drawTexturesAnimateDirty=this._drawTexturesDirty=!1,this.terrainSurface.requestRender(),this.terrainSurface.setPendingUpdates()):(this._drawTexturesAnimateDirty=!1,this.terrainSurface.requestRender(0))}};e.prototype._setupGeometryViewsCyclical=
function(a,b,c){this._setupGeometryViewsDirect(a,b,c);var d=.001*this._longitudeCyclical.range;if(b[0]-d<=this._longitudeCyclical.min){var e=a.views[a.numViews++];r.vec4.set(e.viewport,0,0,c,c);v.offset(b,this._longitudeCyclical.range,0,e.extent)}b[2]+d>=this._longitudeCyclical.max&&(e=a.views[a.numViews++],r.vec4.set(e.viewport,0,0,c,c),v.offset(b,-this._longitudeCyclical.range,0,e.extent))};e.prototype._setupGeometryViewsDirect=function(a,b,c){a.numViews=1;a=a.views[0];v.set(a.extent,b);r.vec4.set(a.viewport,
0,0,c,c)};e.prototype._drawOverlay=function(a){var b=this._overlays[a],c=Q(b),d=b.extent,e=b.resolution,f=b.pixelRatio;this._longitudeCyclical?this._setupGeometryViewsCyclical(S,d,e):this._setupGeometryViewsDirect(S,d,e);S.width=e;S.height=e;S.pixelRatio=f*this.view.state.camera.pixelRatio;S.index=a;a=this._renderer;d=b.renderTargets;d.color.valid=a.draw(d.color.id,S);d.highlight.valid=a.drawHighlights(d.highlight.id,S);d.water.valid=a.drawNormals(d.water.id,S);d.occluded.valid=a.drawOccluded(d.occluded.id,
S);d.colorWithoutRasterImage.valid=this.needsColorWithoutRasterImage()&&a.drawWithoutRasterImage(d.colorWithoutRasterImage.id,S);b=Q(b);return c^b?0:1};e.prototype.needsColorWithoutRasterImage=function(){return 0<this._drapeSourceTypes[0]&&0<this._drapeSourceTypes[1]&&0<this._drapeTargetTypes[1]};e.prototype.hasDrapedFeatures=function(){return 0<this._drapeSourceTypes[1]};e.prototype._collectUnusedRenderTargetMemory=function(){var b=a();this._hasUnusedRenderTargets=!1;for(var c=0,d=this._overlays;c<
d.length;c++){var e=d[c],f;for(f in e.renderTargets){var g=e.renderTargets[f];g.valid?g.lastUsedTimestamp=b:b-g.lastUsedTimestamp>P?(this._renderer.disposeRenderTargetMemory(g.id),g.lastUsedTimestamp=Infinity):Infinity>g.lastUsedTimestamp&&(this._hasUnusedRenderTargets=!0)}}};e.prototype._rectanglesOverlap=function(a,b){return this._longitudeCyclical?(this._longitudeCyclical.contains(b[0],b[2],a[0])||this._longitudeCyclical.contains(b[0],b[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],b[0]))&&
!(a[1]>b[3]||a[3]<b[1]):v.intersects(a,b)};e.prototype._rectInsideRect=function(a,b){return this._longitudeCyclical?this._longitudeCyclical.contains(b[0],b[2],a[0])&&this._longitudeCyclical.contains(b[0],b[2],a[2])&&a[1]>b[1]&&a[3]<b[3]:v.contains(b,a)};e.prototype._pointIsInExtent=function(a,b){if(this._longitudeCyclical)return this._longitudeCyclical.contains(b[0],b[2],a.x)&&a.y>=b[1]&&a.y<=b[3];var c=a.x;a=a.y;return c>b[0]&&c<b[2]&&a>b[1]&&a<b[3]};e.prototype._shiftExtentToFitBounds=function(a,
b,c){var d=0,e=0;a[0]<-b?d=a[0]+b:a[2]>b&&(d=b-a[2]);a[1]<-c?e=a[1]+c:a[3]>c&&(e=c-a[3]);v.offset(a,d,e)};Object.defineProperty(e.prototype,"test",{get:function(){return{overlays:this._overlays,renderer:this._renderer}},enumerable:!0,configurable:!0});k([q.property()],e.prototype,"view",void 0);k([q.property()],e.prototype,"terrainSurface",void 0);k([q.property({readOnly:!0,aliasOf:"terrainSurface.suspended"})],e.prototype,"suspended",void 0);k([q.property({readOnly:!0,dependsOn:["terrainSurface.ready",
"suspended"]})],e.prototype,"updating",null);k([q.property({type:Boolean})],e.prototype,"hasHighlights",null);k([q.property({type:Boolean})],e.prototype,"rendersOccluded",null);return e=k([q.subclass("esri.views.3d.terrain.OverlayManager")],e)}(q.declared(e));b.OverlayManager=n;var P=1E3,S={width:0,height:0,pixelRatio:0,views:[{viewport:v.create(),extent:v.create()},{viewport:v.create(),extent:v.create()},{viewport:v.create(),extent:v.create()}],numViews:0,index:0},V=x.vec4f64.create(),J=u.vec3f64.create(),
U={inner:v.create(),outer:v.create()},Y=v.create(),X=v.create(),R=G.ray.create()})},"esri/views/3d/support/animationUtils":function(){define(["require","exports","../../../layers/support/timeUtils"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.DESIRED_ANIMATION_FPS=25;b.DESIRED_ANIMATION_MS=m.Milliseconds(1E3/b.DESIRED_ANIMATION_FPS);b.DESIRED_DRAPED_ANIMATION_FPS=20;b.DESIRED_DRAPED_ANIMATION_MS=m.Milliseconds(1E3/b.DESIRED_DRAPED_ANIMATION_FPS)})},"esri/views/3d/terrain/PlanarPatch":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/mathUtils ../../../geometry/support/aaBoundingBox ../support/geometryUtils ./PatchGeometryFactory ./Tile".split(" "),
function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,c,e){var f=b.call(this,d.NumSubdivisionsAtLevel)||this;void 0!==a&&f.init(a,c,e);return f}m(d,b);d.prototype.init=function(a,c,d){b.prototype.init.call(this,a,c,d);this._edgeLen=this.extent[2]-this.extent[0];this._edgeLen2=this._edgeLen*this._edgeLen;this.centerAtSeaLevel[0]=k.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=k.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=
0;this.updateRadiusAndCenter()};d.prototype.updateRadiusAndCenter=function(){this._updateCenter();var a=(this.extent[2]-this.extent[0])*Math.SQRT1_2,b=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this._radius=Math.sqrt(a*a+b*b)};d.prototype._isVisible=function(){return this.intersectsClippingArea&&e.frustum.intersectsAABB(this.surface.frustum.planes,g.wrap(this.extent[0],this.extent[1],this.elevationBounds[0],this.extent[2],this.extent[3],this.elevationBounds[1]))};d.prototype.createGeometry=
function(a,b){f.createPlanarGlobePatch(a,this.extent,b,this.renderData);this.setMemoryDirty()};d.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];return d}(l.Tile);b.PlanarPatch=n})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../geometry/support/aaBoundingBox ../support/earthUtils ../support/buffer/BufferPool ../support/buffer/InterleavedLayout ./ElevationData ./TerrainConst ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t){function u(a,b,c,d){var e=0<(c&2),f=b+(d?1024:0)+(e?2048:0),g=y.get(f);if(!g){var g=b-1,h=b-1,l=b*b,k=2*g+2*h,m=g*h*6,p=6*k,n=6*(2*g+h-1);d&&(m*=2,p*=2,n*=2);for(var k=65536<l+k?new Uint32Array(m+p):new Uint16Array(m+p),r=0,q=0,u=m,t,v,x,z,A=0,B=0;B<=h;B++){e&&(A=0===B?n:B===h?-n:0);for(var u=u+A,C=0;C<=g;C++)x=w(C,B,g,h),-1<x&&(z=0===B&&C!==g?1:C===g&&B!==h?g+1:B===h&&0!==C?-1:0===C&&0!==B?-(g+1):0,0!==z&&(t=r,v=l+x,x=l+(0===C&&1===B?0:x+1),z=r+z,d?(k[u+0]=
t,k[u+1]=v,k[u+2]=v,k[u+3]=x,k[u+4]=x,k[u+5]=t,k[u+6]=x,k[u+7]=z,k[u+8]=z,k[u+9]=t,k[u+10]=t,k[u+11]=x,u+=12):(k[u+0]=t,k[u+1]=v,k[u+2]=x,k[u+3]=x,k[u+4]=z,k[u+5]=t,u+=6))),++r,C<g&&B<h&&(t=B*(g+1)+C,v=t+1,x=v+(g+1),z=x-1,d?(k[q+0]=t,k[q+1]=v,k[q+2]=v,k[q+3]=x,k[q+4]=x,k[q+5]=t,k[q+6]=x,k[q+7]=z,k[q+8]=z,k[q+9]=t,k[q+10]=t,k[q+11]=x,q+=12):(k[q+0]=t,k[q+1]=v,k[q+2]=x,k[q+3]=x,k[q+4]=z,k[q+5]=t,q+=6));u-=A}g={values:k,numSurfaceIndices:m,numSkirtIndices:p};y.set(f,g)}a.indices=g.values;a.numSurfaceIndices=
g.numSurfaceIndices;a.numSkirtIndices=g.numSkirtIndices;a.numWithoutSkirtIndices=a.numSurfaceIndices+(c?6*(b-1)*(d?2:1):0)}function r(a,b,c,d){a<d[0]&&(d[0]=a);a>d[3]&&(d[3]=a);b<d[1]&&(d[1]=b);b>d[4]&&(d[4]=b);c<d[2]&&(d[2]=c);c>d[5]&&(d[5]=c)}function x(a,b){var c=b>a?1:0;return 2+4*c+(1-2*c)*(a+b)}function w(a,b,c,d){return 0===b?a:a===c?c+b:b===d?c+d+(c-a):0===a&&0<b?2*c+d+(d-b):-1}Object.defineProperty(b,"__esModule",{value:!0});var v=a.newLayout().vec3f(p.VertexAttrConstants.POSITION).vec2f(p.VertexAttrConstants.UV0),
z=new d.BufferPool(function(a){return v.createBuffer(a)},function(a){return a.count});b.clearCaches=function(){z.clear();y.clear()};b.releaseGeometry=function(a){z.release(a.vertexAttributes);a.vertexAttributes=null;a.indices=null};b.createSphericalGlobePatch=function(a,b,d,e,g,k,p){var n=g[0],t=g[1],v=g[2];g=g[3];var y=.1*h.earthRadius*(g-t),A=a.numVertsPerRow-1,K=a.numVertsPerRow-1,D=a.numVertsPerRow*a.numVertsPerRow,G=z.acquire(D+(2*A+2*K)),N=G.position.typedBuffer,H=G.uv0.typedBuffer,I=e.geometryInfo.boundingBox;
l.empty(I);var Q=b[2]-b[0],O=b[3]-b[1],L=v-n,v=d[0],W=d[1];d=d[2];for(var Z=0;Z<=A;Z++){var ea=Z/A,fa=n+ea*L;B[Z]=Math.sin(fa);C[Z]=Math.cos(fa);F[Z]=ea;E[Z]=b[0]+ea*Q}n=k&&!!(p&1);Q=k&&!!(p&2);for(fa=L=0;fa<=K;fa++){var na=fa/K,Z=m.lerp(t,g,na),la=Math.cos(Z),ma=Math.sin(Z),oa=void 0;k?(oa=h.halfEarthRadius*Math.log((1+ma)/(1-ma)),na=(oa-b[1])/O):oa=180*Z/Math.PI;for(Z=0;Z<=A;Z++){var ea=F[Z],ka=B[Z],ia=C[Z],ga=h.earthRadius;a.samplerData&&(ga+=c.ElevationData.sample(E[Z],oa,a.samplerData)||0);ia=
ia*la*ga-v;ka=ka*la*ga-W;ga=ma*ga-d;r(ia,ka,ga,I);var ja=q.GEOMETRY_VERTEX_STRIDE*L;N[ja+0]=ia;N[ja+1]=ka;N[ja+2]=ga;H[ja+0]=ea;H[ja+1]=na;ja=w(Z,fa,A,K);if(-1<ja){var ja=q.GEOMETRY_VERTEX_STRIDE*(D+ja),ha=n&&0===fa?-1:Q&&fa===K?1:0,ia=0===ha?ia:-v,ka=0===ha?ka:-W,ga=0===ha?ga:h.earthRadius*ha-d;N[ja+0]=ia;N[ja+1]=ka;N[ja+2]=ga;H[ja+0]=0===ha?x(ea,na):ea;H[ja+1]=0===ha?y:na;0!==ha&&r(ia,ka,ga,I)}++L}}e.geometryInfo.numVertsPerRow=a.numVertsPerRow;e.geometryInfo.vertexAttributes=G;e.geometryInfo.skirtLength=
y;f.vec4.set(e.geometryInfo.uvOffsetAndScale,0,0,1,1);u(e.geometryInfo,a.numVertsPerRow,k?p:0,a.wireframe)};b.createPlanarGlobePatch=function(a,b,d,e){var g=b[0],h=b[1],k=b[2]-g,m=b[3]-h,p=a.clippingArea,n=p?Math.max(0,(p[0]-b[0])/k):0,t=p?Math.max(0,(p[1]-b[1])/m):0,v=p?Math.min(1,(p[2]-b[0])/k):1;b=p?Math.min(1,(p[3]-b[1])/m):1;var y=v>n?1/(v-n):1,A=b>t?1/(b-t):1,B=-n*y,C=-t*A,F=.1*k,D=a.numVertsPerRow-1,E=a.numVertsPerRow-1,G=a.numVertsPerRow*a.numVertsPerRow,H=z.acquire(G+(2*D+2*E)),W=H.position.typedBuffer,
I=H.uv0.typedBuffer,O=e.geometryInfo.boundingBox;l.empty(O);for(var L=0,na=0;na<=E;na++){var la=na/E,ma=C+la*A,la=h+la*m;p&&(la<p[1]?(la=p[1],ma=0):la>p[3]&&(la=p[3],ma=1));for(var oa=0;oa<=D;oa++){var ka=oa/D,ia=B+ka*y,ka=g+ka*k;p&&(ka<p[0]?(ka=p[0],ia=0):ka>p[2]&&(ka=p[2],ia=1));var ga=a.samplerData?c.ElevationData.sample(ka,la,a.samplerData)||0:0,ka=ka-d[0],ja=la-d[1],ga=ga-d[2];r(ka,ja,ga,O);var ha=q.GEOMETRY_VERTEX_STRIDE*L;W[ha+0]=ka;W[ha+1]=ja;W[ha+2]=ga;I[ha+0]=ia;I[ha+1]=ma;ha=w(oa,na,D,
D);-1<ha&&(ha=q.GEOMETRY_VERTEX_STRIDE*(G+ha),W[ha+0]=ka,W[ha+1]=ja,W[ha+2]=ga,I[ha+0]=x(ia,ma),I[ha+1]=F);++L}}e.geometryInfo.numVertsPerRow=a.numVertsPerRow;e.geometryInfo.vertexAttributes=H;e.geometryInfo.skirtLength=F;f.vec4.set(e.geometryInfo.uvOffsetAndScale,n,t,v-n,b-t);u(e.geometryInfo,a.numVertsPerRow,0,a.wireframe)};var y=new Map,A=Math.pow(2,-52);b.intersectSkirts=function(a,b,c,d,e,f,h,l,m){var p,n,r,q=f.position;f=f.uv0;var u=a[0],w=a[1];a=a[2];var v=b[0]-u,x=b[1]-w;b=b[2]-a;d*=3;for(c*=
3;c<d;c+=3){var y=e[c],z=e[c+1],B=e[c+2],C=q.get(y,0),F=q.get(y,1);p=q.get(y,2);var K=q.get(z,0),D=q.get(z,1);n=q.get(z,2);var E=q.get(B,0),N=q.get(B,1);r=q.get(B,2);y=f.get(y,0);z=f.get(z,0);B=f.get(B,0);2<=y&&(g.vec3.set(G,C,F,p),h(G),C+=G[0],F+=G[1],p+=G[2]);2<=z&&(g.vec3.set(G,K,D,n),h(G),K+=G[0],D+=G[1],n+=G[2]);2<=B&&(g.vec3.set(G,E,N,r),h(G),E+=G[0],N+=G[1],r+=G[2]);k.isSome(l)&&(p=l.applyToVertex(C,F,p),C=p[0],F=p[1],p=p[2],n=l.applyToVertex(K,D,n),K=n[0],D=n[1],n=n[2],r=l.applyToVertex(E,
N,r),E=r[0],N=r[1],r=r[2]);K-=C;D-=F;n-=p;E-=C;N-=F;r-=p;var y=x*r-N*b,z=b*E-r*v,M=v*N-E*x,B=K*y+D*z+n*M,C=u-C,I=w-F,T=a-p,F=I*n-D*T;p=T*K-n*C;var Q=C*D-K*I;if(B>A){C=C*y+I*z+T*M;if(0>C||C>B)continue;y=v*F+x*p+b*Q;if(0>y||C+y>B)continue}else if(B<-A){C=C*y+I*z+T*M;if(0<C||C<B)continue;y=v*F+x*p+b*Q;if(0<y||C+y<B)continue}else continue;F=(E*F+N*p+r*Q)/B;0<=F&&(p=t.computeNormal(K,D,n,E,N,r,H),m(F,p))}};var B=Array(q.MAX_PATCH_TESSELATION+1),C=Array(q.MAX_PATCH_TESSELATION+1),F=Array(q.MAX_PATCH_TESSELATION+
1),E=Array(q.MAX_PATCH_TESSELATION+1),G=e.vec3f64.create(),H=e.vec3f64.create()})},"esri/views/3d/support/buffer/BufferPool":function(){define(["require","exports","../../../../core/PooledArray"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e){this._factoryCallback=b;this._lengthCallback=e;this._pool=new Map}b.prototype.acquire=function(g){if(!b.test.disabled){var e=this._pool.get(g);if(e&&0!==e.length)return e.pop()}try{return this._factoryCallback(g)}catch(l){var e=
window.performance&&window.performance.memory,f="";e&&(f="\n  totalJSHeapSize: "+e.totalJSHeapSize+", usedJSHeapSize: "+e.usedJSHeapSize+", jsHeapSizeLimit: "+e.jsHeapSizeLimit);console.log("Array allocation of size "+g+" failed: "+l+f);throw l;}};b.prototype.release=function(g){if(!b.test.disabled){var e=this._lengthCallback(g),f=this._pool.get(e);f||(f=new m({shrink:!0}),this._pool.set(e,f));f.push(g)}};b.prototype.clear=function(){this._pool.clear()};Object.defineProperty(b.prototype,"test",{get:function(){return{size:this._pool.size}},
enumerable:!0,configurable:!0});b.test={disabled:!1};return b}();b.BufferPool=n})},"esri/views/3d/terrain/Tile":function(){define("require exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./MapTileAgent ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./tileUtils ../../webgl/Util".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B){function C(a){a.dispose();a instanceof u?u.Pool.release(a):a instanceof r&&r.Pool.release(a)}Object.defineProperty(b,"__esModule",{value:!0});var F=w.weakAssert,E=h.vec3f64.create(),G=h.vec3f64.create(),H=h.vec3f64.create(),D=a.vec4f64.create();n=function(){return function(){this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0}}();b.SplitLimits=n;n=function(){function a(a){this._numSubdivisionAtLevel=
a;this.lij=[0,0,0];this._children=[null,null,null,null];this._dirty=!0;this._previouslyRendered=!1;this.extent=c.create();this._elevationBounds=f.vec2f64.create();this.layerInfo=Array(2);this.extentInRadians=c.create();this.centerAtSeaLevel=h.vec3f64.create();this._center=[h.vec3f64.create(),h.vec3f64.create(),h.vec3f64.create()];this.up=h.vec3f64.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._maxTesselation=0;this._usedMemory=L;this._curvatureHeight=
this._radius=this._edgeLen2=this._edgeLen=this.renderOrder=this._screenDepth=this._mapDataRefCount=this._mapTileMemory=0}Object.defineProperty(a.prototype,"usedMemory",{get:function(){this._usedMemory===L&&this._updateMemoryUsed();return this._usedMemory+(this.isCached?0:this.mapTileMemory)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"cachedMemory",{get:function(){return this.isCached?this.mapTileMemory:0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"mapTileMemory",
{get:function(){this._usedMemory===L&&this._updateMemoryUsed();for(var a=this._mapTileMemory,b=0,c=this.layerInfo[1];b<c.length;b++){var d=c[b].data;d instanceof q.VectorTile&&(a+=d.getMemoryUsage())}return a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isCached",{get:function(){return!this.shouldRender&&0>=this._mapDataRefCount},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxTesselation",{get:function(){return this._maxTesselation},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"numSubdivisionsAtLevel",{get:function(){return this._numSubdivisionAtLevel},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isWithinClippingArea",{get:function(){return this._isWithinClippingArea},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"intersectsClippingArea",{get:function(){return this._intersectsClippingArea},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"clippingArea",{get:function(){return this._clippingArea},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"surface",{get:function(){return this._surface},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"level",{get:function(){return this.lij[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"edgeLen",{get:function(){return this._edgeLen},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"screenDepth",{get:function(){return this._screenDepth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"visible",
{get:function(){if(this._dirty){var a=this._isVisible();a!==this._visible&&(this._visible=a,this.updateAgentSuspension(),this.surface.emit("tiles-visibility-changed"));this._dirty=!1}return this._visible},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rendered",{get:function(){var a=!!this.renderData;a!==this._previouslyRendered&&(this.surface.emit("tiles-visibility-changed"),this._previouslyRendered=a);return a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"shouldRender",{get:function(){if(!this.visible)return!1;if(0===this.surface.lodSnapping){var a=this.level-this._surface.snapLevel;if(0===a)return!0;if(1===a)return!1}return this.isLeaf},enumerable:!0,configurable:!0});a.prototype.init=function(a,b,c){this.lij[0]=a[0];this.lij[1]=a[1];this.lij[2]=a[2];c.tilingScheme.getExtent(a[0],a[1],a[2],this.extent,this.extentInRadians);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;c.upsampleMapCache.pop(A.tile2str(this));
this._radius=this._edgeLen2=this._edgeLen=0;this.vlevel=a?a[0]:0;b&&b._elevationBounds?e.vec2.copy(this._elevationBounds,b.elevationBounds):e.vec2.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this._screenDepth=0;this._previouslyRendered=this._visible=!1;this._parent=b;this.unsetChildren();this._surface=c;this.updateVisibility();for(a=0;2>a;a++){b=c.numLayers(a);var d=this.layerInfo[a];this.layerInfo[a]?d.length=b:(d=Array(b),this.layerInfo[a]=d);for(var f=0;f<b;f++)d[f]=
z.TilePerLayerInfo.makeEmptyLayerInfo(a,this._surface.upsampleInfoPool,d[f]),0===a&&this.findElevationBoundsForLayer(f,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(c.tilingScheme.pixelSize,x.MAX_PATCH_TESSELATION)};a.prototype.release=function(){F(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(A.tile2str(this));for(var a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++)c[b].dispose();this._surface=this._parent=null;this._usedMemory=
L};a.prototype.refMapData=function(){++this._mapDataRefCount;this.isCached||this._surface.upsampleMapCache.pop(A.tile2str(this))};a.prototype.unrefMapData=function(){--this._mapDataRefCount;if(this.isCached){var a=this.cachedMemory;0<a&&(this._surface.upsampleMapCache.put(A.tile2str(this),this,a),this.setMemoryDirty())}};a.prototype.setMemoryDirty=function(){this._usedMemory=L};Object.defineProperty(a.prototype,"cpuImageMemorySize",{get:function(){var a=this._surface.tilingScheme.pixelSize;return a*
a*4},enumerable:!0,configurable:!0});a.prototype._updateMemoryUsed=function(){this._mapTileMemory=this._usedMemory=0;for(var a=this.cpuImageMemorySize,b=0,c=this.layerInfo[1];b<c.length;b++){var d=c[b],d=d.data;if(d instanceof y.TileTexture)this._mapTileMemory+=B.getGpuMemoryUsage(d.texture);else if(d instanceof HTMLImageElement||d instanceof p.ImageWithType)this._mapTileMemory+=a}b=0;for(c=this.layerInfo[0];b<c.length;b++)d=c[b],this._usedMemory+=d.data?a:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,
a=this.renderData.textureDescriptor)&&(this._mapTileMemory+=B.getGpuMemoryUsage(a));this.isCached&&this._surface.upsampleMapCache.updateSize(A.tile2str(this),this,this.cachedMemory)};a.prototype.getUsedMemoryForLayer=function(a,b){b=this.layerInfo[a][b];if(!b||!b.data)return 0;if(1===a&&!this.isCached){a=b.data;if(a instanceof y.TileTexture)return B.getGpuMemoryUsage(a.texture);if(a instanceof HTMLImageElement||a instanceof p.ImageWithType)return this.cpuImageMemorySize;if(a instanceof q.VectorTile)return a.getMemoryUsage()}else if(0===
a)return this.cpuImageMemorySize;return 0};a.prototype.updateScreenDepth=function(a){l.vec3.copy(D,this._center[0]);D[3]=1;d.vec4.transformMat4(D,D,a);this._screenDepth=0>D[2]?0:D[2]/D[3]};a.prototype.shouldSplit=function(a,b,c){var d=this.level;l.vec3.subtract(E,this._center[0],b);var e=l.vec3.squaredLength(E),f=0;l.vec3.subtract(G,this._center[1],b);var g=l.vec3.squaredLength(G);g<e&&(e=g,f=1);l.vec3.subtract(G,this._center[2],b);g=l.vec3.squaredLength(G);g<e&&(e=g,f=2);if(this._edgeLen2>e&&d<a.maxLod||
0===c&&1===this._surface.snapLevel-d)return 2;c=Math.sqrt(e);var g=l.vec3.dot(this.up,E),e=this._elevationBounds[1]-this._elevationBounds[0],h=e/this.edgeLen;if(a.aboveGround&&0<g&&.001>h&&0<g/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-h)return 0;h=this._edgeLen/(a.fovX*c*2);return h<a.relativeWidthLimit?this.vlevel!==this.level?(this.vlevel=this.level,4):0:d>=a.maxLod?(a=d+Math.ceil(-k.log2(a.relativeWidthLimit/h)),a!==this.vlevel?(this.vlevel=a,4):1):6<d&&(l.vec3.subtract(G,
this._center[f],b),l.vec3.scale(H,this.up,g),l.vec3.subtract(H,H,G),d=l.vec3.squaredLength(H),d>this._radius*this._radius&&(l.vec3.scale(H,H,this._radius/Math.sqrt(d)),l.vec3.add(H,H,this._center[f]),l.vec3.subtract(H,b,H),Math.min(1,(Math.abs(l.vec3.dot(H,this.up))+.5*e+this._curvatureHeight)/l.vec3.length(H))*(this._edgeLen/(a.fovY*c*2))<.1/a.angledSplitBias*a.relativeHeightLimit))?0:2};a.prototype.setChildren=function(a,b,c,d){F(!!(a&&b&&c&&d),"Null child passed");this._children[0]=a;this._children[1]=
b;this._children[2]=c;this._children[3]=d};a.prototype.unsetChildren=function(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=null};a.prototype.load=function(a){this.refMapData();for(var b=0;2>b;b++)this.layerInfo[b]&&this._createOrUpdateAgents(0,b);a.loadTile(this)};a.prototype.unload=function(a){a.unloadTile(this);for(a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++){var d=c[b];d.loadingAgent&&d.loadingAgent!==v.TILE_AGENT_DONE&&(C(d.loadingAgent),
d.loadingAgent=null);d.pendingUpdates=0}this.resetPendingUpdate(32);this.resetPendingUpdate(64);this.unrefMapData()};a.prototype.unloadMapData=function(){for(var a=0,b=this.layerInfo[1];a<b.length;a++){var c=b[a];c.loadingAgent&&c.loadingAgent!==v.TILE_AGENT_DONE&&(C(c.loadingAgent),c.loadingAgent=null);c.pendingUpdates=0}this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()};a.prototype.updateClippingStatus=function(a){if(c.equals(a,this._clippingArea))return!1;var b=this._intersectsClippingArea,
d=this._isWithinClippingArea;a?(this._intersectsClippingArea=this.intersectsExtent(a),this._isWithinClippingArea=this.isWithinExtent(a)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=a;this.updateVisibility();a=d&&this._isWithinClippingArea;b=!d&&!b&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||a||b||this.setPendingUpdate(32);return!0};a.prototype.updateVisibility=function(){this._dirty=!0;this._surface.setPendingUpdates()};a.prototype.getLayerInfo=
function(a,b){return this.layerInfo[b][a]};a.prototype.hasLayerData=function(a,b){a=this.layerInfo[b][a];return!(!a||!a.data||a.dataInvalidated)};a.prototype.hasDataAvailable=function(a,b,c){return(b=this.layerInfo[c][b].tilemap)?"unavailable"!==b.getAvailability(a.lij[1],a.lij[2]):!0};Object.defineProperty(a.prototype,"updating",{get:function(){if(this.hasPendingUpdates)return!0;for(var a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++){var d=c[b];if(d.loadingAgent&&d.loadingAgent!==v.TILE_AGENT_DONE&&
d.loadingAgent.updating)return!0}return!1},enumerable:!0,configurable:!0});a.prototype.isSuspended=function(a){return this.hasPendingUpdate(2)?!0:0===a?!1:!this.visible};Object.defineProperty(a.prototype,"hasPendingUpdates",{get:function(){return 0!==this._pendingUpdates},enumerable:!0,configurable:!0});a.prototype.hasPendingUpdate=function(a){return(this._pendingUpdates&a)===a};a.prototype.setPendingUpdate=function(a){this._pendingUpdates|=a;this._surface.setPendingUpdates()};a.prototype.resetPendingUpdate=
function(a){return this.hasPendingUpdate(a)?(this._pendingUpdates&=~a,!0):!1};a.prototype.requestLayerData=function(a,b,c){x.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a];if(-1<d.waitingAgents.indexOf(c))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),!0;d.waitingAgents.push(c);if(d.data&&
!d.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),c.dataArrived(this),!0;if(d.requestPromise)return!0;d.requestAbort=g.createAbortController();var e=this._surface.requestTileData(this,a,b,d.requestAbort);if(!e)return d.requestAbort=null,!1;a=function(){d.requestPromise===e&&(d.requestPromise=null,d.requestAbort=null)};d.requestPromise=e;e.then(a,a);return!!d.requestPromise};Object.defineProperty(a.prototype,
"isLeaf",{get:function(){return null==this._children[0]},enumerable:!0,configurable:!0});a.prototype.hasLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]===a[2]};a.prototype.findByLij=function(a){return this.hasLij(a)?this:this.isLeaf?null:(a=this._children[0].findByLij(a)||this._children[1].findByLij(a)||this._children[2].findByLij(a)||this._children[3].findByLij(a))?a:null};a.prototype.distanceToSquared=function(a){return l.vec3.squaredLength(l.vec3.subtract(H,this._center[0],
a))};a.prototype.containsPoint=function(a){var b=this.extent;return a[0]>=b[0]&&a[1]>=b[1]&&a[0]<=b[2]&&a[1]<=b[3]};a.prototype.unrequestLayerData=function(a,b,c){x.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a],e=d.waitingAgents;c=null!=m.removeUnordered(e,c);F(c,"agent has not requested this piece of map data");1>e.length&&(d.abortRequest(),x.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",
this.lij.toString(),b,a),this._updateMemoryUsed())};a.prototype.dataArrived=function(a,b,c){a=this.layerInfo[b][a];a.data=c;a.dataInvalidated=!1;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataArrived(this);a.waitingAgents.length=0;this._updateMemoryUsed()};a.prototype.dataMissing=function(a,b,c){c.notInTilemap||console.error("Tile "+this.lij.toString()+" layer "+b+"/"+a+" error "+c);a=this.layerInfo[b][a];a.dataMissing=!0;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataMissing();
a.waitingAgents.length=0;this._updateMemoryUsed()};a.prototype.updateRenderData=function(a){switch(a){case 1:return this.updateTexture();case 0:return this.updateGeometry()}};a.prototype.updateTexture=function(){this.renderData&&this.setPendingUpdate(64)};a.prototype.updateGeometry=function(){this.setPendingUpdate(32);for(var a=0,b=this.layerInfo[0];a<b.length;a++)b[a].pendingUpdates|=32};a.prototype.invalidateLayerData=function(a,b){this.layerInfo[b][a].invalidateSourceData();this.restartAgents(b)};
a.prototype.computeElevationBounds=function(){e.vec2.set(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);for(var a=!0,b=0,c=this.layerInfo[0];b<c.length;b++){var d=c[b];d.elevationBounds&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],d.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],d.elevationBounds.max),d.elevationBounds.hasNoDataValues||(a=!1))}a&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=Math.max(this._elevationBounds[1],
0));this.updateRadiusAndCenter()};a.prototype._updateCenter=function(){l.vec3.scale(H,this.up,.5*(this._elevationBounds[0]+this._elevationBounds[1]));l.vec3.add(this._center[0],this.centerAtSeaLevel,H);l.vec3.scale(H,this.up,this._elevationBounds[0]);l.vec3.add(this._center[1],this.centerAtSeaLevel,H);l.vec3.scale(H,this.up,this._elevationBounds[1]);l.vec3.add(this._center[2],this.centerAtSeaLevel,H)};a.prototype.findElevationBoundsForLayer=function(a,b){var c=this.layerInfo[0][a];if(!c.elevationBounds||
c.elevationBounds.level<b)if(b=this._surface.layerViewByIndex(a,0),A.fallsWithinLayer(this,b.layer,!1)){b=I;var d=!1;if(c.data){var e=c.data;b.min=e.bounds[0];b.max=e.bounds[1];b.hasNoDataValues=e.hasNoDataValues;b.level=this.lij[0];d=!0}else{for(var f=0,g=void 0,e=void 0,h=this._parent;h&&(!e||f<x.ELEVATION_DESIRED_RESOLUTION_LEVEL)&&!(f=this.vlevel-h.level,g=e||g,e=h.layerInfo[0][a].data,!e&&g&&f>=x.ELEVATION_DESIRED_RESOLUTION_LEVEL);h=h._parent);if(e=e||g)e.computeMinMaxValue(this.lij[0],this.lij[1],
this.lij[2],b),Infinity!==b.min&&(b.level=e.level,d=!0)}d&&(c.elevationBounds||(c.elevationBounds=new t.ElevationBounds),c.elevationBounds.copyFrom(b))}};a.prototype.modifyLayers=function(a,b,c){for(var d=this.layerInfo[c],e=0;e<d.length;e++){var f=d[e];f.loadingAgent&&f.loadingAgent!==v.TILE_AGENT_DONE&&(C(f.loadingAgent),f.loadingAgent=null);f.waitingAgents.length=0}if(1===c)for(e=0;e<d.length;++e)void 0===a[e]&&d[e].dispose();a=b.length;f=Array(a);for(e=0;e<a;e++){var g=b[e];f[e]=-1<g?d[g]:z.TilePerLayerInfo.makeEmptyLayerInfo(c,
this._surface.upsampleInfoPool)}this.layerInfo[c]=f;this._updateMemoryUsed()};a.prototype.restartAgents=function(a){this.renderData&&(this._createOrUpdateAgents(0,a),this.updateRenderData(a))};a.prototype.updateAgents=function(a){if(this.renderData){for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent===v.TILE_AGENT_DONE&&(d.loadingAgent=null)}this._createOrUpdateAgents(0,a)}};a.prototype.updateAgentSuspension=function(){for(var a=0;2>a;a++)for(var b=this.isSuspended(a),c=0,d=
this.layerInfo[a];c<d.length;c++){var e=d[c];e.loadingAgent&&e.loadingAgent!==v.TILE_AGENT_DONE&&(e.loadingAgent.setSuspension(b),e.loadingAgent===v.TILE_AGENT_DONE&&this.updateRenderData(a))}};a.prototype.removeLayerAgent=function(a,b){a=this.layerInfo[b][a];a.loadingAgent&&a.loadingAgent!==v.TILE_AGENT_DONE&&a.loadingAgent.dispose();a.loadingAgent=null};a.prototype.agentDone=function(a,b){var c=this.layerInfo[b][a];c.loadingAgent=v.TILE_AGENT_DONE;c.data||c.upsampleInfo||this._createOrUpdateAgents(a+
1,b)};a.prototype._createOrUpdateAgents=function(a,b){for(var c=this.isSuspended(b),d=this.layerInfo[b];a<d.length;++a){var e=d[a],f=!1,g=this._surface.layerViewByIndex(a,b);if(e.loadingAgent)A.fallsWithinLayer(this,g.layer,!1)?(e.loadingAgent!==v.TILE_AGENT_DONE&&(x.TILE_LOADING_DEBUGLOG&&console.log(A.tile2str(this),"update suspended",c),e.loadingAgent.setSuspension(c)),e.loadingAgent!==v.TILE_AGENT_DONE&&(f=e.loadingAgent.update(),x.TILE_LOADING_DEBUGLOG&&console.log(A.tile2str(this),"update"))):
e.dispose();else if(A.fallsWithinLayer(this,g.layer,!1)){var f=e,h=a,l=b,k=c,m=0===l?u.Pool.acquire():r.Pool.acquire();m.init(this,h,l,k);f.loadingAgent=m;f=e.loadingAgent.startLoading();x.TILE_LOADING_DEBUGLOG&&console.log(A.tile2str(this),"start");f?e.loadingAgent===v.TILE_AGENT_DONE&&(x.TILE_LOADING_DEBUGLOG&&console.log(A.tile2str(this),"done"),this.setPendingUpdate(32)):(C(e.loadingAgent),e.loadingAgent=v.TILE_AGENT_DONE,x.TILE_LOADING_DEBUGLOG&&console.log(A.tile2str(this),"done"))}e.loadingAgent===
v.TILE_AGENT_DONE&&this.updateRenderData(b);if(f&&g.isOpaque)break}};a.prototype.isWithinExtent=function(a){var b=this.extent;return b[0]>=a[0]&&a[2]>=b[2]&&b[1]>=a[1]&&a[3]>=b[3]};a.prototype.intersectsExtent=function(a){var b=this.extent;return b[2]>=a[0]&&a[2]>=b[0]&&b[3]>=a[1]&&a[3]>=b[1]};Object.defineProperty(a.prototype,"test",{get:function(){return{cachedMemory:this.cachedMemory}},enumerable:!0,configurable:!0});return a}();b.Tile=n;var I=new t.ElevationBounds,L=-1})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/now ../../../webgl ./RenderBucket ../webgl/TiledDisplayObject".split(" "),
function(n,b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function a(a,d,e,f,g,h){e=b.call(this,a,e,f,[4096,4096])||this;e._referenced=0;e._symbolFadeHold=null;e._vectorTileData=null;e._setData=!1;e._symbolUpdateData=null;e._memoryUsed=l;e.rotation=0;e.layerData={};e.status="loading";e._referenced=1;e.styleLayers=d;e.id=a.id;e.rotation=g;e._cacheWorkerTiles=h;return e}m(a,b);Object.defineProperty(a.prototype,"hasSymbolBuckets",{get:function(){return!1},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"isHoldingForFade",{get:function(){return null!==this._symbolFadeHold},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isSymbolFadeDone",{get:function(){return!this._symbolFadeHold||this._symbolFadeHold<k()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"wasRequested",{get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status},enumerable:!0,configurable:!0});a.prototype.setData=function(a,
b,d){this._vectorTileData=a;this.client=b;this.refKeys=d;this._memoryUsed=l;this.ready();this._setData=!0};a.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};a.prototype.updateTileData=function(a){this._vectorTileData=a;this.stage.requestRender();this._memoryUsed=l};a.prototype.clearSymbolFadeHold=function(){this._symbolFadeHold=null};a.prototype.setSymbolHoldDuration=function(a){this._symbolFadeHold=k()+a};a.prototype.hasData=function(){return 0<Object.keys(this.layerData).length};
a.prototype.dispose=function(){this._cacheWorkerTiles&&this.client&&this.client.invoke("destructTileData",this.id).catch(function(){});this._deleteBufferMemory();this.destroy();this._memoryUsed=l};a.prototype.release=function(){return 0===--this._referenced?(this.dispose(),this.attached=!1,this.stage=null,!0):!1};a.prototype.reference=function(){++this._referenced};Object.defineProperty(a.prototype,"referenced",{get:function(){return this._referenced},enumerable:!0,configurable:!0});a.prototype.getMemoryUsage=
function(){var a=this;this._memoryUsed===l&&(this._memoryUsed=h.reduce(function(b,c){return a[c]?b+a[c].size:b},0),this.texture&&(this._memoryUsed+=this.texture.descriptor.width*this.texture.descriptor.height*4),this._vectorTileData&&this._vectorTileData.bufferData&&(this._memoryUsed+=this._vectorTileData.bufferData.reduce(function(a,b){return a+b.byteLength},this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength)));return this._memoryUsed/(this._referenced||
1)};a.prototype.commitChanges=function(){if(this._vectorTileData||this._symbolUpdateData)this._vectorTileData?(this._deleteBufferMemory(),this._createRenderBuckets(),this._createBufferObjects(),this._vectorTileData=null):this._symbolUpdateData&&(this._updateSymbolData(this._symbolUpdateData),this._symbolUpdateData=null)};a.prototype._deleteBufferMemory=function(){for(var a=0,b="fillVertexArrayObject fillDDVertexArrayObject outlineVertexArrayObject lineVertexArrayObject lineDDVertexArrayObject iconVertexArrayObject iconDDVertexArrayObject textVertexArrayObject textDDVertexArrayObject circleVertexArrayObject fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer texture".split(" ");a<
b.length;a++){var d=b[a];this[d]&&(this[d].dispose(),this[d]=null)}this.layerData={};this.triangleCount=0};a.prototype._createRenderBuckets=function(){for(var a=new Uint32Array(this._vectorTileData.bucketDataInfo),b=a.length,d=0;d<b;){var f=a[d];switch(a[d+1]){case 0:(new e.BackgroundRenderBucket).layerID=f;d+=2;break;case 1:var g=new e.FillRenderBucket;g.layerID=f;g.triangleElementStart=a[d+2];g.triangleElementCount=a[d+3];g.outlineElementStart=a[d+4];g.outlineElementCount=a[d+5];if(0!==g.triangleElementCount||
0!==g.outlineElementCount)this.layerData[f]=g;d+=6;break;case 2:g=new e.LineRenderBucket;g.layerID=f;g.triangleElementStart=a[d+2];g.triangleElementCount=a[d+3];0<g.triangleElementCount&&(this.layerData[f]=g);d+=4;break;case 3:g=new e.SymbolRenderBucket;g.layerID=f;g.isSDF=0!==a[d+2];var h=d+3,l=a[h];h++;for(var k=0;k<l;k++){var m=a[h],n=a[h+1],y=a[h+2];g.iconPerPageElementsMap.set(m,[n,y]);h+=3}var A=a[h];h++;for(k=0;k<A;k++)m=a[h],n=a[h+1],y=a[h+2],g.glyphPerPageElementsMap.set(m,[n,y]),h+=3;if(0<
g.iconPerPageElementsMap.size||0<g.glyphPerPageElementsMap.size)this.layerData[f]=g;d+=5+3*l+3*A;break;case 4:g=new e.CircleRenderBucket;g.layerID=f;g.triangleElementStart=a[d+2];g.triangleElementCount=a[d+3];0<g.triangleElementCount&&(this.layerData[f]=g);d+=4;break;default:console.error("Bad bucket type!"),d+=2}}};a.prototype.attach=function(){return this._setData};a.prototype.attachWithContext=function(a){this.stage={context:a};this.attached=this.attach()};a.prototype._updateSymbolData=function(a){if(!a||
!a.bucketDataInfo)return!0;var b=new Uint32Array(a.bucketDataInfo),c=b.length;if(0===c)return!0;if(!this.isReady)return this.requestRender(),!1;for(var d=this.stage.context,f=new Uint32Array(a.bufferDataInfo),h=f.length,l=0,k=0;k<h;k+=2,l++)switch(f[k]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=g.BufferObject.createVertex(d,35044,a.bufferData[l]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=
null);this.iconDDVertexBuffer=g.BufferObject.createVertex(d,35044,a.bufferData[l]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=g.BufferObject.createIndex(d,35044,a.bufferData[l]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=g.BufferObject.createVertex(d,35044,a.bufferData[l]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=
null);this.textDDVertexBuffer=g.BufferObject.createVertex(d,35044,a.bufferData[l]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=g.BufferObject.createIndex(d,35044,a.bufferData[l])}a={};for(var m in this.layerData)3!==this.layerData[m].type&&(a[m]=this.layerData[m]);this.layerData=a;d=this.styleLayers.layers;for(f=0;f<c;){m=b[f];h=new e.SymbolRenderBucket;h.layerID=m;h.isSDF=0!==b[f+2];d.length>h.layerID&&d[h.layerID].type===h.type&&
(a[h.layerID]=h);var n=f+3;m=b[n];n++;for(l=0;l<m;l++){var k=b[n],y=b[n+1],A=b[n+2];h.iconPerPageElementsMap.set(k,[y,A]);n+=3}var B=b[n];n++;for(l=0;l<B;l++)k=b[n],y=b[n+1],A=b[n+2],h.glyphPerPageElementsMap.set(k,[y,A]),n+=3;f+=5+3*m+3*B}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),
this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);return!0};a._createBufferToObject=function(){var a=[];a[1]={create:g.BufferObject.createVertex,var:"fillVertexBuffer"};a[2]={create:g.BufferObject.createVertex,var:"fillDDVertexBuffer"};a[3]={create:g.BufferObject.createIndex,var:"fillIndexBuffer"};a[4]={create:g.BufferObject.createVertex,var:"outlineVertexBuffer"};a[5]={create:g.BufferObject.createVertex,var:"outlineDDVertexBuffer"};
a[6]={create:g.BufferObject.createIndex,var:"outlineIndexBuffer"};a[7]={create:g.BufferObject.createVertex,var:"lineVertexBuffer"};a[8]={create:g.BufferObject.createVertex,var:"lineDDVertexBuffer"};a[9]={create:g.BufferObject.createIndex,var:"lineIndexBuffer"};a[10]={create:g.BufferObject.createVertex,var:"iconVertexBuffer"};a[11]={create:g.BufferObject.createVertex,var:"iconDDVertexBuffer"};a[12]={create:g.BufferObject.createIndex,var:"iconIndexBuffer"};a[13]={create:g.BufferObject.createVertex,
var:"textVertexBuffer"};a[14]={create:g.BufferObject.createVertex,var:"textDDVertexBuffer"};a[15]={create:g.BufferObject.createIndex,var:"textIndexBuffer"};a[16]={create:g.BufferObject.createVertex,var:"circleVertexBuffer"};a[17]={create:g.BufferObject.createIndex,var:"circleIndexBuffer"};return a};a.prototype._createBufferObjects=function(){for(var b=this.stage.context,d=new Uint32Array(this._vectorTileData.bufferDataInfo),e=d.length,f=0;f<e;f+=2){var g=f/2;if(!(0>=d[f+1]||0===this._vectorTileData.bufferData[g].byteLength)){var h=
d[f],l=a.bufferToObject[h];l?this[l.var]?this[l.var].setData(this._vectorTileData.bufferData[g]):this[l.var]=l.create(b,35044,this._vectorTileData.bufferData[g]):console.error("Bad buffer type "+h)}}};a.bufferToObject=a._createBufferToObject();return a}(f.TiledDisplayObject);b.VectorTile=n;var l=-1,h="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ")})},
"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(b){this.type=b}}();b.RenderBucket=n;var k=function(b){function e(){var e=b.call(this,2)||this;e.triangleElementStart=0;e.triangleElementCount=0;return e}m(e,b);e.prototype.hasData=function(){return 0<this.triangleElementCount};e.prototype.triangleCount=function(){return this.triangleElementCount/
3};return e}(n);b.LineRenderBucket=k;k=function(b){function e(){var e=b.call(this,1)||this;e.triangleElementStart=0;e.triangleElementCount=0;e.outlineElementStart=0;e.outlineElementCount=0;return e}m(e,b);e.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};e.prototype.triangleCount=function(){return(this.triangleElementCount+this.outlineElementCount)/3};return e}(n);b.FillRenderBucket=k;k=function(b){function e(){var e=b.call(this,3)||this;e.iconPerPageElementsMap=
new Map;e.glyphPerPageElementsMap=new Map;e.isSDF=!1;return e}m(e,b);e.prototype.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};e.prototype.triangleCount=function(){var b=0;this.iconPerPageElementsMap.forEach(function(e){b+=e[1]});this.glyphPerPageElementsMap.forEach(function(e){b+=e[1]});return b/3};return e}(n);b.SymbolRenderBucket=k;k=function(b){function e(){var e=b.call(this,4)||this;e.triangleElementStart=0;e.triangleElementCount=0;return e}
m(e,b);e.prototype.hasData=function(){return 0<this.triangleElementCount};e.prototype.triangleCount=function(){return this.triangleElementCount/3};return e}(n);b.CircleRenderBucket=k;n=function(b){function e(){return b.call(this,0)||this}m(e,b);e.prototype.hasData=function(){return!0};e.prototype.triangleCount=function(){return 2};return e}(n);b.BackgroundRenderBucket=n})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/has ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f32 ../DisplayObject ../../tiling/TileKey".split(" "),
function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,c,d,f){void 0===f&&(f=d);var g=b.call(this)||this;g.transforms={dvs:e.mat3f32.create(),tileMat3:e.mat3f32.create()};g.triangleCount=0;g.key=l.pool.acquire(a);g.bounds=c;g.size=d;g.coordRange=f;return g}m(d,b);d.prototype.destroy=function(){l.pool.release(this.key);this.key=null;this.texture&&(this.texture.dispose(),this.texture=null)};Object.defineProperty(d.prototype,"coords",{get:function(){return this._coords},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"bounds",{get:function(){return this._bounds},set:function(a){this._coords=[a[0],a[3]];this._bounds=a},enumerable:!0,configurable:!0});d.prototype.setTransform=function(a,b){k("esri-2d-debug")&&null==b&&console.debug("Tried to set tile transform but lod resolution was null");b/=a.resolution*a.pixelRatio;var c=this.transforms.tileMat3,d=a.toScreenNoRotation([0,0],this.coords);g.mat3.set(c,this.size[0]/this.coordRange[0]*b,0,0,0,this.size[1]/
this.coordRange[1]*b,0,d[0],d[1],1);g.mat3.multiply(this.transforms.dvs,a.displayViewMat3,c)};return d}(f.DisplayObject);b.TiledDisplayObject=n})},"esri/core/libs/gl-matrix-2/mat3f32":function(){define(["require","exports","./factories/mat3f32"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.mat3f32=m})},"esri/core/libs/gl-matrix-2/factories/mat3f32":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var b=
new Float32Array(9);b[0]=1;b[4]=1;b[8]=1;return b};b.clone=function(b){var k=new Float32Array(9);k[0]=b[0];k[1]=b[1];k[2]=b[2];k[3]=b[3];k[4]=b[4];k[5]=b[5];k[6]=b[6];k[7]=b[7];k[8]=b[8];return k};b.fromValues=function(b,k,g,e,f,l,h,d,a){var c=new Float32Array(9);c[0]=b;c[1]=k;c[2]=g;c[3]=e;c[4]=f;c[5]=l;c[6]=h;c[7]=d;c[8]=a;return c};b.createView=function(b,k){return new Float32Array(b,k,9)}})},"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","../../../core/tsSupport/extendsHelper",
"../../../core/Evented"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){var e=null!==b&&b.apply(this,arguments)||this;e._renderRequestedCalled=!1;e._attached=!1;e._isReady=!1;e._opacity=1;e.renderRequested=!1;e._visible=!0;return e}m(e,b);Object.defineProperty(e.prototype,"attached",{get:function(){return this._attached},set:function(b){this._attached!==b&&((this._attached=b)?this.hasEventListener("attach")&&this.emit("attach"):this.hasEventListener("detach")&&
this.emit("detach"))},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"isReady",{get:function(){return this._attached&&this._isReady},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"opacity",{get:function(){return this._opacity},set:function(b){this._opacity!==b&&(this._opacity=b,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"visible",{get:function(){return this._visible},set:function(b){this._visible!==b&&(this._visible=
b,this.requestRender())},enumerable:!0,configurable:!0});e.prototype.attach=function(){this.ready();return!0};e.prototype.setTransform=function(b){};e.prototype.detach=function(){};e.prototype.processRender=function(b){this.visible&&this.attached&&(this._renderRequestedCalled=!1,this.doRender(b),this._renderRequestedCalled||(this.renderRequested=!1),this.hasEventListener("post-render")&&this.emit("post-render"))};e.prototype.requestRender=function(){var b=this.renderRequested;this.renderRequested=
this._renderRequestedCalled=!0;this.parent&&this.parent.requestRender();b!==this.renderRequested&&this.hasEventListener("will-render")&&this.emit("will-render")};e.prototype.dispose=function(){};e.prototype.doRender=function(b){};e.prototype.ready=function(){this._isReady=!0;this.emit("isReady")};return e}(k);b.DisplayObject=n})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define(["require","exports","./TileAgent","./tileUtils"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});
n=function(){function b(b,f){this._pool=f;this.waitingAgents=[];this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=this.tilemapRequestAbort=this.tilemapRequestPromise=this.tilemap=this.data=null;this.pendingUpdates=0;this.elevationBounds=void 0;this.init(b)}b.prototype.init=function(b){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this.tilemapRequestAbort=this.tilemapRequestPromise=this.tilemap=null;this._unsetUpsampleInfo();this.requestAbort=
this.requestPromise=this.loadingAgent=null;this.pendingUpdates=0;0===b&&(this.elevationBounds=null)};b.prototype.invalidateSourceData=function(){this.tilemap=null;this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};b.prototype.abortRequest=function(){this.requestPromise&&(this.requestAbort.abort(),this.requestAbort=this.requestPromise=null)};b.prototype.abortTilemapRequest=function(){this.tilemapRequestPromise&&(this.tilemapRequestAbort.abort(),this.tilemapRequestAbort=this.tilemapRequestPromise=
null)};b.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==m.TILE_AGENT_DONE&&this.loadingAgent.dispose();this.loadingAgent=null;this.abortRequest();this.abortTilemapRequest();this.tilemap=null;this._unsetUpsampleInfo();this.pendingUpdates=0;this.disposeData()};b.prototype.disposeData=function(){!this.data||this.data instanceof HTMLImageElement||this.data instanceof HTMLCanvasElement||this.data.release();this.data=null};Object.defineProperty(b.prototype,"upsampleInfo",{get:function(){return this._upsampleInfo},
enumerable:!0,configurable:!0});b.prototype._unsetUpsampleInfo=function(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};b.prototype.setUpsampleInfo=function(b,f){if(b===f||null==f)this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===f)return;this._upsampleInfo.tile.unrefMapData()}f.refMapData();k.computeUpsampleInfo(b,f,this._upsampleInfo)}};
b.makeEmptyLayerInfo=function(e,f,g){return g?(g.init(e),g):new b(e,f)};return b}();b.TilePerLayerInfo=n})},"esri/views/3d/terrain/TileTexture":function(){define(["require","exports","../../webgl","../../webgl/Texture"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,f,g){this._refCount=1;this._texture=b instanceof m.RenderingContext?new k(b,f,g):b}b.prototype.retain=function(){++this._refCount};b.prototype.release=function(){--this._refCount;0===this._refCount&&
this._texture.dispose()};Object.defineProperty(b.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0});b.prototype.generateMipmap=function(){this._texture.generateMipmap()};Object.defineProperty(b.prototype,"descriptor",{get:function(){return this._texture.descriptor},enumerable:!0,configurable:!0});return b}();b.TileTexture=n})},"esri/views/3d/terrain/SphericalPatch":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/mathUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/earthUtils ../support/geometryUtils ../support/projectionUtils ./PatchGeometryFactory ./Tile".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(c,d,f){var g=a.call(this,b.NumSubdivisionsAtLevel)||this;g.obb=Array(8);g.isWebMercator=!1;for(var h=0;8>h;h++)g.obb[h]=e.vec3f64.create();void 0!==c&&g.init(c,d,f);return g}m(b,a);b.prototype.init=function(b,c,d){a.prototype.init.call(this,b,c,d);this.isWebMercator=d.tilingScheme.spatialReference.isWebMercator;c=this.extentInRadians[0];d=this.extentInRadians[1];var l=this.extentInRadians[2],
m=this.extentInRadians[3];b=b[0];var p=k.lerp(d,m,.5),n=k.lerp(c,l,.5);this._edgeLen=(l-c)*Math.cos(0===b?0:Math.min(Math.abs(d),Math.abs(m)))*f.earthRadius;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=f.earthRadius-Math.sqrt(f.earthRadius*f.earthRadius-this._edgeLen2/4);h.wgs84ComparableLonLatToECEF(this.centerAtSeaLevel,n,p,0);c=e.vec3f64.fromArray(this.centerAtSeaLevel);g.vec3.normalize(c,c);this.up=c;this._updateOBB();this.updateRadiusAndCenter()};b.prototype.updateRadiusAndCenter=
function(){if(0===this.lij[0])g.vec3.set(this._center[0],0,0,0),g.vec3.set(this._center[1],0,0,0),g.vec3.set(this._center[2],0,0,0),this._radius=f.earthRadius+this.elevationBounds[1];else{this._updateCenter();var a=Math.max(g.vec3.squaredDistance(this._center[0],this.obb[0]),g.vec3.squaredDistance(this._center[0],this.obb[1]));this._radius=Math.sqrt(a)}};b.prototype._isVisible=function(){if(!this.intersectsClippingArea)return!1;var a=this.surface.frustum.planes;if(10>this.lij[0])return l.frustum.intersectsSphere(a,
l.sphere.wrap(this._radius,this._center[0]));for(var b=this.obb,c=0;6>c;c++){for(var d=void 0,d=0;8>d&&!l.plane.isPointOutside(a[c],b[d]);d++);if(8===d)return!1}return!0};b.prototype.computeElevationBounds=function(){a.prototype.computeElevationBounds.call(this);this._updateOBB()};b.prototype.createGeometry=function(a,b){var c=this._isPole(this.lij[1],this.lij[0]);d.createSphericalGlobePatch(a,this.extent,b,this.renderData,this.extentInRadians,this.isWebMercator,c);this.setMemoryDirty()};b.prototype._updateOBB=
function(){for(var a=this.extentInRadians,b=this.obb,c=0;2>c;c++){var d=this.elevationBounds[c],e=4*c;h.wgs84ComparableLonLatToECEF(b[e++],a[0],a[1],d);h.wgs84ComparableLonLatToECEF(b[e++],a[0],a[3],d);h.wgs84ComparableLonLatToECEF(b[e++],a[2],a[3],d);h.wgs84ComparableLonLatToECEF(b[e++],a[2],a[1],d)}this.isWebMercator&&(a=this._isPole(this.lij[1],this.lij[0]),2===a?(g.vec3.set(b[1],0,0,f.earthRadius),g.vec3.set(b[2],0,0,f.earthRadius),g.vec3.set(b[5],0,0,f.earthRadius),g.vec3.set(b[6],0,0,f.earthRadius)):
1===a&&(g.vec3.set(b[0],0,0,-f.earthRadius),g.vec3.set(b[3],0,0,-f.earthRadius),g.vec3.set(b[4],0,0,-f.earthRadius),g.vec3.set(b[7],0,0,-f.earthRadius)))};b.prototype._isPole=function(a,b){var c=0;a===(1<<b)-1&&(c+=1);0===a&&(c+=2);return c};b.NumSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];return b}(a.Tile);b.SphericalPatch=n})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../../../layers/support/layerUtils ./TerrainConst ./terrainUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){function p(a,b){a&&!a.spatialReference.equals(b)&&(a=d.canProject(a.spatialReference,b)?d.project(a,b):null);return a}Object.defineProperty(b,"__esModule",{value:!0});n=function(a){function b(b){b=a.call(this,b)||this;b._handles=new e;return b}m(b,a);b.prototype.initialize=function(){var a=this;this._handles.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};b.prototype.destroy=function(){this._handles.destroy();this._handles=
null};Object.defineProperty(b.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});b.prototype._computeStencilEnabledExtents=function(a,b){var c=[],d=0;for(a=a.items;d<a.length;d++){var e=a[d].layer;"IntegratedMeshLayer"===e.operationalLayerType&&null!=b&&(e=p(e.fullExtent,b),null!=e&&c.push(h.fromExtent(e)))}return c};
k([l.property({readOnly:!0})],b.prototype,"layerViewsExtent",null);k([l.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],b.prototype,"tiledLayersExtent",null);k([l.property({readOnly:!0,dependsOn:["spatialReference"]})],b.prototype,"stencilEnabledExtents",null);k([l.property()],b.prototype,"spatialReference",null);k([l.property()],b.prototype,"tilingScheme",null);k([l.property()],b.prototype,"defaultTiledLayersExtent",void 0);k([l.property({constructOnly:!0})],b.prototype,"layers",
void 0);k([l.property({constructOnly:!0})],b.prototype,"layerViews",void 0);return b=k([l.subclass("esri.views.3d.terrain.SurfaceExtentHelperBase")],b)}(l.declared(g));g=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}m(b,a);b.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};b.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};b.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?c.WEBMERCATOR_WORLD_EXTENT:
c.GEOGRAPHIC_WORLD_EXTENT};k([l.property({dependsOn:["spatialReference"]})],b.prototype,"layerViewsExtent",void 0);return b=k([l.subclass("esri.views.3d.terrain.SurfaceExtentHelperGlobal")],b)}(l.declared(n));b.SurfaceExtentHelperGlobal=g;n=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}m(c,b);c.prototype.initialize=function(){var a=this;this._handles.add([this.layers.on("change",function(b){return a._handleLayersChanged(b)}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};
c.prototype._handleLayersChanged=function(a){for(var b=this,c=0,d=a.removed;c<d.length;c++)this._handles.remove(d[c].uid);c=0;for(a=a.added;c<a.length;c++)d=a[c],this._handles.add(f.init(d,"loaded",function(){return b.notifyChange("tiledLayersExtent")}),d.uid)};c.prototype._computeLayerViewsExtent=function(){var a=h.empty(),b=this.spatialReference;this.layerViews.forEach(function(c){c.isResolved()&&(c=c.fullExtentInLocalViewSpatialReference||c.layer.fullExtent,(c=p(c,b))&&h.expand(a,c))});var c=h.allFinite(a)?
a:null,d=this._get("layerViewsExtent");return h.equals(c,d)?d:c};c.prototype._computeTiledLayersExtent=function(){var b=this.tilingScheme;if(!b)return null;var c=this.spatialReference,d=h.empty();this.layers.forEach(function(e){if(e.loaded&&a.isTiledLayer(e)){var f=q.getTiledLayerInfo(e,c,"local");e=f.tileInfo;f=f.fullExtent;e&&b.compatibleWith(e)&&f&&f.spatialReference.equals(c)&&h.expand(d,f)}});this.defaultTiledLayersExtent&&h.expand(d,this.defaultTiledLayersExtent);var e=h.allFinite(d)?d:null,
f=this._get("tiledLayersExtent");return h.equals(e,f)?f:e};return c=k([l.subclass("esri.views.3d.terrain.SurfaceExtentHelperLocal")],c)}(l.declared(n));b.SurfaceExtentHelperLocal=n})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../../../layers/support/layerUtils ../support/projectionUtils ./terrainUtils ./TilingScheme".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){return function(b){function c(a){a=b.call(this,a)||this;a._changeHandles=new e;return a}m(c,b);c.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};c.prototype.destroy=function(){this._changeHandles.destroy();this._changeHandles=
null};c.prototype._update=function(){var b=this;this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var c;this.layers.some(function(a){return!l.isTiledLayer(a)||a.isRejected()?!1:!a.isFulfilled()||d.getTiledLayerInfo(a,b.viewSpatialReference,b.manifold).tileInfo?(c=a,"vector-tile"!==a.type):!1});if(c)if(c.isResolved()){var e=d.getTiledLayerInfo(c,this.viewSpatialReference,this.manifold).tileInfo,e=new a(e);this._set("tilingSchemeDone",!0);this._lockTilingScheme(e)}else this._updateWhen(c);
else this._set("tilingSchemeDone",!0)}};c.prototype._updateWhen=function(a){var b=this,c=a.when().catch(function(a){return a}).then(function(){c===b._waitTask&&b._update()});this._waitTask=c};c.prototype._lockTilingScheme=function(b){var c=this;if("spherical"===this.manifold){var d=b.levels.length-1;b.spatialReference.isWebMercator?b=a.makeWebMercatorAuxiliarySphere(d):h.canProjectToWGS84ComparableLonLat(b.spatialReference)&&(b=a.makeGCSWithTileSize(b.spatialReference,b.pixelSize,d))}this.tilingSchemeLocked=
!0;this.tilingScheme=b;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",function(){return c._updateTiledLayerExtent()}))};c.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};c.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold){var b=this.extentHelper.spatialReference;b.isWebMercator?this.tilingScheme=
a.WebMercatorAuxiliarySphere:h.canProjectToWGS84ComparableLonLat(b)&&(this.tilingScheme=a.makeGCSWithTileSize(b,256));this.extent=this.extentHelper.layerViewsExtent}else if(b=this.extentHelper.layerViewsExtent)this.tilingScheme=a.fromExtent(b,this.extentHelper.spatialReference),this.extent=b};k([f.property()],c.prototype,"tilingScheme",void 0);k([f.property()],c.prototype,"extent",void 0);k([f.property({value:!1})],c.prototype,"tilingSchemeLocked",void 0);k([f.property({readOnly:!0,value:!1})],c.prototype,
"tilingSchemeDone",void 0);k([f.property({constructOnly:!0})],c.prototype,"viewSpatialReference",void 0);k([f.property({constructOnly:!0})],c.prototype,"layers",void 0);k([f.property({constructOnly:!0})],c.prototype,"extentHelper",void 0);k([f.property({constructOnly:!0})],c.prototype,"manifold",void 0);return c=k([f.subclass("esri.views.3d.terrain.SurfaceTilingSchemeLogic")],c)}(f.declared(g))})},"esri/views/3d/terrain/TerrainRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/compilerUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../support/imageUtils ../support/buffer/BufferView ./OverlayRenderer ./PatchGeometryFactory ./PatchRenderData ./TileRenderer ./tileUtils ../webgl-engine/core/shaderLibrary/Slice.glsl ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/tracer ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L,O,K){function N(a,b,c){x.vec4.set(c,a[0]*b[2]+b[0],a[1]*b[3]+b[1],a[2]*b[2],a[3]*b[3])}var Q=t.vec2f64.create(),M=v.create(),T=w.vec4f64.create(),P=w.vec4f64.create(),S=w.vec4f64.create(),V=function(){return function(){this.extent=w.vec4f64.create();this.maxLevel=this.minLevel=0;this.callback=null}}();n=function(b){function f(c){c=b.call(this,c)||this;c.type="Terrain";c.isGround=!0;c.tileSize=256;c.rctx=null;c.renderDataPool=
new d(C.PatchRenderData);c.patchGroups=new a({allocator:function(b){return b||{root:null,origin:null,patches:new a}},deallocator:function(a){a.root=null;a.origin=null;a.patches.clear();return a}});c.patchGroupsDirty=!0;c.patchGroupsMap=new Map;c.tileIterator=new E.IteratorPreorder;c.highestVisibleLODTile=null;c.visible=!0;c._opaque=!0;c._skirtScale=1;c._renderingDisabled=!1;c._renderOrder=1;c._velvetOverground=!0;c._wireframe=!1;c.castShadows=!0;c.emptyTex=null;c.tileRenderer=null;c.tileBackgroundInitialized=
!1;c.tileBackgroundUpdating=!1;c.stencilEnabledLayerExtents=[];c.numTrianglesRendered=0;c.numTilesRendered=0;c.numTilesCulled=0;c.numOriginsRendered=0;c.clippingExtent=null;c.needsHighlight=!1;c.renderOccludedFlags=1;c.visibleScaleRangeQueries=new a({initialSize:10});c.visibleScaleRangeQueriesInvPtr=0;c.visibleScaleRangeQueryQueue=new a({initialSize:30});c.visibleScaleRangeQueryPool=new d(V,!1);return c}m(f,b);f.prototype.destroy=function(){B.clearCaches()};f.prototype.install=function(a){a.addRenderPlugin([2,
7,9],this)};f.prototype.uninstall=function(a){a.removeRenderPlugin(this)};Object.defineProperty(f.prototype,"updating",{get:function(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"canRender",{get:function(){return this.visible&&!!this.rootTiles&&this.tileBackgroundInitialized&&!this._renderingDisabled},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"overlayEnabled",{get:function(){return this.shaderTechniqueConfig.overlayEnabled},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"renderingDisabled",{set:function(a){this._renderingDisabled=!!a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"opaque",{get:function(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled},set:function(a){this._opaque!==a&&(this._opaque=a,this.setNeedsRender())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"skirtScale",{set:function(a){this._skirtScale=a;
this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"renderPatchBorders",{set:function(a){this.shaderTechniqueConfig.tileBorders!==a&&(this.shaderTechniqueConfig.tileBorders=a,this.setNeedsRender())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"cullBackFaces",{set:function(a){this.shaderTechniqueConfig.backfaceCullingEnabled!==a&&(this.shaderTechniqueConfig.backfaceCullingEnabled=a,this.setNeedsRender())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"renderOrder",{get:function(){return this._renderOrder},set:function(a){this._renderOrder=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"velvetOverground",{set:function(a){this._velvetOverground!==a&&(this._velvetOverground=a,this.setNeedsRender())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"intersectionHandlerId",{get:function(){return D.TERRAIN_ID},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"slicePlane",
{get:function(){return this.shaderTechniqueConfig.slicePlaneEnabled},set:function(a){this.shaderTechniqueConfig.slicePlaneEnabled!==a&&(this.shaderTechniqueConfig.slicePlaneEnabled=a,this.setNeedsRender())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"textureFadingEnabled",{set:function(a){this.shaderTechniqueConfig.textureFadingEnabled!==a&&(this.shaderTechniqueConfig.textureFadingEnabled=a,this.setNeedsRender())},enumerable:!0,configurable:!0});f.prototype.setDebugScreenSizePerspective=
function(a){this.shaderTechniqueConfig.screenSizePerspective!==a&&(this.shaderTechniqueConfig.screenSizePerspective=a,this.setNeedsRender())};f.prototype.setRootTiles=function(a){this.rootTiles=a;this.setNeedsRender()};f.prototype.setNeedsHighlight=function(a){this.needsHighlight=a;this.setNeedsRender()};f.prototype.setRenderOccludedOverlay=function(a){this.renderOccludedFlags=a?A.overlayRenderOccludedFlag:1;this.setNeedsRender()};f.prototype.setStencilEnabledLayerExtents=function(a){this.stencilEnabledLayerExtents=
a;this.setNeedsRender()};f.prototype.setTileSize=function(a){this.tileSize=a;this.tileRenderer&&(this.tileRenderer.tileSize=a);this.setNeedsRender()};f.prototype.loadTile=function(a){a.renderData||(a.renderData=this.renderDataPool.acquire(),a.renderData.init(a),a.renderData.localOrigin=this._getLocalOriginOfTile(a));this.updateTileGeometry(a);this.updateTileTexture(a)};f.prototype.queryVisibleLevelRange=function(a,b,c,d){var e=this.visibleScaleRangeQueryPool.acquire();x.vec4.copy(e.extent,a);e.minLevel=
b?b:-Number.MAX_VALUE;e.maxLevel=null!=c?c:Number.MAX_VALUE;e.callback=d;this.visibleScaleRangeQueryQueue.push(e);this.setNeedsRender()};f.prototype.updateTileTexture=function(a){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(a),a.resetPendingUpdate(64))};f.prototype.updateTileGeometry=function(a){for(var b=0,c=a.layerInfo[0];b<c.length;b++)c[b].pendingUpdates&=-33;a.resetPendingUpdate(32);a.renderData.updateGeometry(this.rctx,this._wireframe)&&this.setNeedsRender()};
f.prototype.unloadTile=function(a){a.renderData&&(a.renderData.releaseTexture(),this.releaseTileGeometry(a.renderData),a.renderData=null,a.setMemoryDirty(),this.setNeedsRender())};f.prototype._getLocalOriginOfTile=function(a){var b=Math.max(0,7*Math.floor((a.lij[0]-3)/7));if("spherical"===this.manifold&&0===b)return r.vec3f64.ZEROS;for(;a.parent&&a.lij[0]>b;)a=a.parent;return a.centerAtSeaLevel};f.prototype.setVisibility=function(a){this.visible=a;this.setNeedsRender()};f.prototype.getStats=function(){return{numTilesRendered:this.numTilesRendered,
numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}};f.prototype.setWireframe=function(a){var b=this;this._wireframe!==a&&(this._wireframe=a,this.rootTiles&&(E.traverseTilesPreorder(this.rootTiles,function(c){c.renderData&&c.renderData.updateGeometry(b.rctx,a)}),this.setNeedsRender()))};f.prototype.setNeedsRender=function(a){void 0===a&&(a=1);this.patchGroupsDirty=!0;this.initContext.requestRender(a)};f.prototype.setTileBackground=
function(a){this.tileBackground=a;this._updateTileBackground()};f.prototype.initializeRenderContext=function(a){var b=this;this.initContext=a;this.rctx=a.rctx;this.shaderTechniques=a.shaderTechniqueRep;this.shaderTechniqueConfig=new K.TerrainTechniqueConfiguration;this.tileRenderer=new F(this.rctx,this.tileSize,this.shaderTechniques,function(){return b.setNeedsRender()});this.tileBackground&&this._updateTileBackground();this.emptyTex=H.createEmptyTexture(this.rctx)};f.prototype.uninitializeRenderContext=
function(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};f.prototype.intersect=function(a,b,c,d){if(this.rootTiles&&(!a.options.selectOpaqueTerrainOnly||!a.options.selectionMode||this._opaque)){var e=Y,f=X;u.vec3.subtract(e,d,c);u.vec3.set(f,1/e[0],1/e[1],1/e[2]);var g=a.results.min,l=a.results.max,k=a.results.ground,m=0===a.options.store,n=!!a.results.ground.target,r=null,q=this.clippingExtent,t=this.tileIterator;
t.reset(this.rootTiles);for(var w=D.getVerticalOffsetTerrain(a.verticalOffset),x=function(){var x=t.next();if(null===x.renderData||n&&z._useStencilForTile(x))return"continue";if(a.options.invisibleTerrain){if(!x.visible&&q&&!x.intersectsExtent(q))return"continue"}else if(!x.visible)return"continue";var A=x.renderData.geometryInfo,C=x.renderData.localOrigin,F=-z._skirtScale*A.skirtLength;v.set(M,A.boundingBox);h.isSome(w)&&(w.localOrigin=C,w.applyToAABB(M));if(0!==F){var G=x.up;v.expandWithOffset(M,
F*G[0],F*G[1],F*G[2])}u.vec3.subtract(R,c,C);if(!O.intersectAabbInvDirBefore(M,R,f,a.tolerance,m&&null!=g.dist?g.dist:Infinity))return"continue";var H=function(a,b,c,d){a.set(void 0,E.tile2str(b),c,d,p.mat4f64.IDENTITY,void 0);a.intersector=da;a.target={type:"external",metadata:{tile:b}}},G=function(f,m){0<=f&&(a.options.backfacesTerrain||0>u.vec3.dot(m,e))&&(a.options.invisibleTerrain||!a.options.selectionMode||null==b||b(c,d,f))&&((null==k.dist||f<k.dist)&&H(k,x,f,m),a.options.storeTerrainResults&&
(2===a.options.store&&(h.isNone(r)?(r=new D.IntersectorResult(a.ray),H(r,x,f,m),a.results.all.push(r)):f<r.dist&&H(r,x,f,m)),(null==g.dist||f<g.dist)&&H(g,x,f,m),0!==a.options.store&&(null==l.dist||f>l.dist)&&H(l,x,f,m)))},S=aa;u.vec3.subtract(S,d,C);var C=A.indices,J=A.vertexAttributes,I={data:J.getField("position",y.BufferViewVec3f).typedBuffer,size:3,offsetIdx:0,strideIdx:J.stride/4},A=A.numWithoutSkirtIndices/3;O.intersectTriangles(R,S,0,A,C,I,null,w,G);0!==F&&B.intersectSkirts(R,S,A,C.length/
3,C,J,"spherical"===z.manifold?function(a){return u.vec3.scale(a,a,F/u.vec3.length(a))}:function(a){return u.vec3.set(a,0,0,F)},w,G)},z=this;!t.done;)x()}};f.prototype.render=function(a){if(9===a.slot){if(0===(a.renderOccludedMask&A.overlayRenderOccludedFlag))return!1}else if(a.slot!==(this.opaque?2:7))return!1;L.trace("# BEGIN RENDER TERRAIN");var b=a.pass,c=1===a.scenelightingData.globalFactor,d=this._updatePatchGroups();switch(b){case 0:b=a.shadowMap&&a.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==
b&&(this.shaderTechniqueConfig.receiveShadows=b);b=!this.overlayRenderer.isEmpty();this.shaderTechniqueConfig.overlayEnabled!==b&&(this.shaderTechniqueConfig.overlayEnabled=b);this._renderMaterialPass(a,0,d,9===a.slot?"occluded":"colorAndWater");break;case 3:this.castShadows&&c&&this._renderAuxiliaryPass(a,3,d,"none");break;case 1:this._renderAuxiliaryPass(a,1,d,"none");break;case 2:this._renderAuxiliaryPass(a,2,d,"none");break;case 4:this.needsHighlight&&(this._renderAuxiliaryPass(a,4,d,"highlight"),
a.rctx.clearSafe(256))}L.trace("# END RENDER TERRAIN");0!==this.visibleScaleRangeQueryQueue.length&&this.setNeedsRender();return!0};f.prototype._renderMaterialPass=function(a,b,c,d){var e=this,f=a.rctx,g=a.camera;this._setTerrainTechnique(b,"occluded"===d);var h=this.shaderTechnique.program;a.rctx.bindProgram(h);f.bindProgram(h);a.shadowMap&&a.shadowMap.bind(h,7);a.ssaoHelper&&a.ssaoHelper.setUniforms(h,6);h.setUniform1i("tex",0);h.setUniform1i("texOld",1);this._bindOverlayUniforms(h);h.setUniformMatrix4fv("viewNormal",
g.viewInverseTransposeMatrix);h.setUniformMatrix4fv("proj",g.projectionMatrix);a.scenelightingData.setUniforms(h,!0);b=g.viewMatrix;u.vec3.set(U,b[12],b[13],b[14]);u.vec3.normalize(U,U);h.setUniform3fv("viewDirection",U);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=0;this._prepareScaleRangeQueries();this.opaque?this._renderPatchGroups(a,h,c,d):a.offscreenRenderingHelper.renderToTargets(function(){return e._renderPatchGroups(a,h,c,d)},a.offscreenRenderingHelper.tmpColor,
a.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._processScaleRangeQueries()};f.prototype._renderAuxiliaryPass=function(a,b,c,d){this._setTerrainTechnique(b,"occluded"===d);b=this.shaderTechnique.program;a.rctx.bindProgram(b);if(4===a.pass){var e=a.offscreenRenderingHelper;a.rctx.bindTexture(e.depthTexture,6);b.setUniform1i("depthTex",6);b.setUniform4f("highlightViewportPixelSz",0,0,1/e.width,1/e.height)}else if(b.setUniformMatrix4fv("viewNormal",a.camera.viewInverseTransposeMatrix),1===a.pass||
3===a.pass)Q[0]=a.camera.near,Q[1]=a.camera.far,b.setUniform2fv("nearFar",Q);this._renderPatchGroupsAuxiliary(a,b,c,d)};f.prototype._updateTileBackground=function(){var a=this;if(this.tileRenderer){this.tileBackgroundUpdating=!0;var b=function(){a.tileBackgroundInitialized=!0;a.tileBackgroundUpdating=!1;a.rootTiles&&E.traverseTilesPreorder(a.rootTiles,function(b){return a.tileRenderer.updateTileTexture(b)});a.setNeedsRender()};if("string"===typeof this.tileBackground){var c=this.tileBackground;z.requestImage(c).then(function(d){c===
a.tileBackground&&a.tileRenderer&&(a.tileRenderer.setBackground(d),b())})}else{var d=this.tileBackground?e.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(d);b()}}};f.prototype._updatePatchGroups=function(){var a=this,b=this.patchGroups;if(!this.patchGroupsDirty)return b;this.highestVisibleLODTile=null;this._renderCollectOrigins(b);if(0!==this.renderOrder){for(var c=0;c<b.length;c++)E.sortTiles(this.renderOrder,b.data[c].patches);b.sort(function(b,c){var d=a.renderOrder;
b=0===b.patches.length?-d:0===c.patches.length?d:E.compareTiles(b.patches.data[0],c.patches.data[0],d);return b})}this.patchGroupsDirty=!1;return b};f.prototype._renderCollectOrigins=function(a){var b=this.rootTiles,c="spherical"===this.manifold;a.clear();for(var d=0;d<b.length;d++){var e=b[d],f=a.pushNew();f.root=e;f.origin=c?r.vec3f64.ZEROS:e.centerAtSeaLevel;f.patches.clear();this._renderCollectOriginsForRoot(a,f)}a.filterInPlace(function(a){return 0<a.patches.length})};f.prototype._renderCollectOriginsForRoot=
function(a,b){var c=this.tileIterator;c.resetOne(b.root);var d=this.patchGroupsMap;d.clear();for(d.set(b.origin,b);!c.done;){b=c.next();var e=b.renderData;if(e&&!b.visible)this.numTilesCulled++,c.skipSubtree();else{if(0===b.lij[0]%7){var f=a.pushNew();f.root=b;f.origin=b.centerAtSeaLevel;d.set(b.centerAtSeaLevel,f);f.patches.clear()}if(!b.rendered)this.numTilesCulled++;else if(e){(f=d.get(e.localOrigin))&&f.patches.push(b);if(!this.highestVisibleLODTile||b.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=
b;c.skipSubtree()}}}};f.prototype._scaleQueriesForTile=function(a){var b=a.extent;a=a.lij[0];for(var c=0;c<this.visibleScaleRangeQueriesInvPtr;){var d=this.visibleScaleRangeQueries.data[c],e=d.extent;a>=d.minLevel&&a<=d.maxLevel&&e[0]<=b[2]&&e[2]>=b[0]&&e[1]<=b[3]&&e[3]>=b[1]?(this.visibleScaleRangeQueries.swapElements(c,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):c++}};f.prototype._useStencilForTile=function(a){for(var b=0,c=this.stencilEnabledLayerExtents;b<c.length;b++)if(a.intersectsExtent(c[b]))return!0;
return!1};f.prototype._renderPatchGroupsAuxiliary=function(a,b,c,d){this.shaderTechnique.bindPipelineState(a.rctx);var e=0<this.stencilEnabledLayerExtents.length;b.setUniformMatrix4fv("proj",a.camera.projectionMatrix);b.setUniform1f("skirtScale",this._skirtScale);"none"!==d&&this._bindOverlayUniforms(b);for(var f=0;f<c.length;f++){var g=c.data[f];this._bindViewForPatchGroup(b,g,a.camera.eye,a.camera.viewMatrix);for(var h=0;h<g.patches.length;h++)this._renderPatch(a.rctx,b,g.patches.data[h],4,e,d)}a.rctx.bindVAO(null)};
f.prototype._renderPatchGroups=function(a,b,c,d){var e=a.rctx,f=a.camera,g=f.viewMatrix;this.shaderTechnique.bindPipelineState(e);if(this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){var l=I.getSettings("spherical"===this.manifold?"global":"local");l.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:f.fovY});O.bindScreenSizePerspective(l,b,"screenSizePerspective")}var l=0<this.stencilEnabledLayerExtents.length,k="occluded"===d;k&&(e.bindTexture(this.emptyTex,
0),b.setUniform1f("blend",1),b.setUniform4fv("texOffsetAndScale",w.vec4f64.ZEROS));b.setUniform1f("skirtScale",k?0:this._skirtScale);for(var m=this._wireframe?1:4,p=0;p<c.length;p++){var n=c.data[p],r=n.patches;if(0!==r.length)for(this._bindViewForPatchGroup(b,n,f.eye,g),G.Slice.bindUniforms(b,this.shaderTechnique.configuration,a.sliceHelper&&a.sliceHelper.plane,n.origin),a.shadowMap&&a.shadowMap.bindView(b,n.origin),this.numOriginsRendered++,n=0;n<r.length;n++){var q=r.data[n];if(!h.isNone(q.renderData.textureReference)){L.trace("# RENDER TILE "+
E.tile2str(q)+", screenDepth:"+q.screenDepth);if(!k){this._scaleQueriesForTile(q);N(q.renderData.geometryInfo.uvOffsetAndScale,q.renderData.texOffsetAndScale,S);b.setUniform4fv("texOffsetAndScale",S);e.bindTexture(q.renderData.textureReference.texture,0);var u=q.renderData.oldTextureReference;if(this.shaderTechniqueConfig.textureFadingEnabled&&h.isSome(u)){this.setNeedsRender();var t=q.renderData.textureFadeFactor;N(q.renderData.geometryInfo.uvOffsetAndScale,q.renderData.oldTexOffsetAndScale,S);b.setUniform1f("textureFadeFactor",
t);b.setUniform4fv("oldTexOffsetAndScale",S);e.bindTexture(u.texture,1)}else b.setUniform1f("textureFadeFactor",1),e.bindTexture(this.emptyTex,1);b.setUniform1f("opacity",q.renderData.opacity)}u=this._renderPatch(e,b,q,m,l,d);q.renderOrder=this.numTilesRendered;this.numTilesRendered++;this.numTrianglesRendered+=u/3}}}e.bindVAO(null)};f.prototype._renderPatch=function(a,b,c,d,e,f){"none"!==f&&(this._bindOverlayTextures(b,c.renderData.overlays,f),b.setUniform1f("overlayOpacity",c.renderData.overlayOpacity));
e&&(this._useStencilForTile(c)?this.stencilShaderTechnique.bindPipelineState(a):this.shaderTechnique.bindPipelineState(a));e=0===this._skirtScale?c.renderData.geometryInfo.numWithoutSkirtIndices:c.renderData.vao.indexBuffer.size;a.bindVAO(c.renderData.vao);b.assertCompatibleVertexAttributeLocations(c.renderData.vao);a.drawElements(d,e,c.renderData.vao.indexBuffer.indexType,0);return e};f.prototype._bindViewForPatchGroup=function(a,b,c,d){a.setUniform3fv("origin",b.origin);q.mat4.translate(J,d,b.origin);
a.setUniformMatrix4fv("view",J);a.setUniform3f("camPos",c[0]-b.origin[0],c[1]-b.origin[1],c[2]-b.origin[2])};f.prototype._bindOverlayUniforms=function(a){a.setUniform1i("ovInnerColorTex",2);a.setUniform1i("ovOuterColorTex",3);a.setUniform1i("ovInnerWaterTex",4);a.setUniform1i("ovOuterWaterTex",5)};f.prototype._bindOverlayTextures=function(a,b,c){for(var d=0;2>d;d++){var e=2*d,f=b[d],g=void 0,h=void 0;switch(c){case "colorAndWater":g=f.renderTargetIds.color;h=f.renderTargetIds.water;break;case "highlight":g=
f.renderTargetIds.highlight;break;case "occluded":g=f.renderTargetIds.occluded;break;case "none":break;default:l.neverReached(c)}g?(T[e]=f.texOffset[0],T[e+1]=f.texOffset[1],P[e]=f.texScale[0],P[e+1]=f.texScale[1],e=this.overlayRenderer.getRenderTargetTexture(g),this.rctx.bindTexture(e,2+d),h?(h=this.overlayRenderer.getRenderTargetTexture(h),this.rctx.bindTexture(h,4+d)):this.rctx.bindTexture(this.emptyTex,4+d)):(T[e]=0,T[e+1]=0,P[e]=0,P[e+1]=0,this.rctx.bindTexture(this.emptyTex,2+d),this.rctx.bindTexture(this.emptyTex,
4+d))}a.setUniform4fv("overlayTexOffset",T);a.setUniform4fv("overlayTexScale",P)};f.prototype._setTerrainTechnique=function(a,b){this.shaderTechniqueConfig.output=a;0===a&&(a="spherical"===this.manifold,this.shaderTechniqueConfig.overlayEnabled=this.overlayEnabled,this.shaderTechniqueConfig.atmosphere=a&&this._velvetOverground);this.shaderTechniqueConfig.renderOccluded=b;this.shaderTechniqueConfig.stencilEnabled=!1;this.shaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(K.TerrainTechnique,
this.shaderTechniqueConfig,this.shaderTechnique);this.shaderTechniqueConfig.stencilEnabled=!0;this.stencilShaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(K.TerrainTechnique,this.shaderTechniqueConfig,this.stencilShaderTechnique)};f.prototype.releaseTileGeometry=function(a){a.releaseGeometry()&&this.setNeedsRender();this.renderDataPool.release(a)};f.prototype._prepareScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryQueue;a.length<a.data.length&&
0<b.length;){var c=b.pop();a.push(c)}this.visibleScaleRangeQueriesInvPtr=a.length};f.prototype._processScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryPool,c=0;c<a.length;c++){var d=a.data[c];b.release(d);d.callback(c>=this.visibleScaleRangeQueriesInvPtr);d.callback=null}a.clear()};Object.defineProperty(f.prototype,"test",{get:function(){return{tileRenderer:this.tileRenderer}},enumerable:!0,configurable:!0});g([c.property()],f.prototype,"tileBackgroundInitialized",
void 0);g([c.property()],f.prototype,"tileBackgroundUpdating",void 0);g([c.property({constructOnly:!0})],f.prototype,"manifold",void 0);g([c.property({constructOnly:!0})],f.prototype,"overlayRenderer",void 0);g([c.property({readOnly:!0,dependsOn:["tileBackgroundInitialized","tileBackgroundUpdating"]})],f.prototype,"updating",null);return f=g([c.subclass("esri.views.3d.terrain.TerrainRenderer")],f)}(c.declared(f));var J=p.mat4f64.create(),U=r.vec3f64.create(),Y=r.vec3f64.create(),X=r.vec3f64.create(),
R=r.vec3f64.create(),aa=r.vec3f64.create(),da="TerrainRenderer";return n})},"esri/views/3d/terrain/PatchRenderData":function(){define("require exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/maybe ../../../core/now ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../support/buffer/glUtil ./PatchGeometryFactory ./TerrainConst ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this.overlayTexOffset=l.vec2f64.create();this.geometryInfo={indices:null,vertexAttributes:null,boundingBox:d.empty(),numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0,skirtLength:0,uvOffsetAndScale:h.vec4f64.create()};this._textureReferences=[]}b.prototype.init=function(a){this.tile=a;a=this.geometryInfo;a.indices=null;a.vertexAttributes=null;d.empty(a.boundingBox);
a.numSurfaceIndices=0;a.numSkirtIndices=0;a.numWithoutSkirtIndices=0;a.numVertsPerRow=0;this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1};for(this._vao=null;0<this._textureReferences.length;)this._textureReferences.pop().texture.release();this.opacity=1;if(this.overlays){a=0;for(var b=this.overlays;a<b.length;a++){var c=b[a];c.renderTargetIds.color=null;c.renderTargetIds.highlight=null;c.renderTargetIds.water=null;c.renderTargetIds.occluded=null;f.vec2.set(c.texScale,
1,1);f.vec2.set(c.texOffset,0,0)}}else for(this.overlays=[null,null],a=0;2>a;a++)this.overlays[a]={renderTargetIds:{color:null,highlight:null,water:null,occluded:null},texScale:[1,1],texOffset:[0,0]};this.overlayOpacity=1;this.localOrigin=null};b.prototype.updateGeometry=function(a,b){if(!this._updateGeometryState(b))return!1;this._releaseGeometry();this._createGeometry(a);return!0};b.prototype.releaseGeometry=function(){return this._releaseGeometry()?(this.geometryState={numVertsPerRow:0,samplerData:null,
clippingArea:null,wireframe:!1},!0):!1};b.prototype.ensureTexture=function(a,b){g.isSome(this._texture)&&this._texture.descriptor.width!==a&&this.releaseTexture();this._texture||(this._texture=b(),this.tile.setMemoryDirty());return this._texture};b.prototype.releaseTexture=function(){this._expireTextureReference();g.isSome(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())};b.prototype._expireTextureReference=function(){if(0!==this._textureReferences.length)if(0>=
this.tile.surface.textureFadeDuration)for(;0<this._textureReferences.length;)this._textureReferences.pop().texture.release();else{for(;2<this._textureReferences.length;)this._textureReferences.pop().texture.release();var a=this._textureReferences[this._textureReferences.length-1];0===a.age&&(a.age=e())}};b.prototype._updateGeometryState=function(a){var b=this._getElevationInfo(),c=this.tile.level,d=8>c?this.tile.numSubdivisionsAtLevel[c]+1:2;b.samplerData&&(d=this.tile.maxTesselation,d=k.clamp((d>>
Math.max(c-b.maxTileLevel,q.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-c)))+1,2,d+1));c=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)c=null;var e=this.geometryState,f=!1;e.numVertsPerRow!==d&&(e.numVertsPerRow=d,f=!0);b.changed&&(e.samplerData=b.samplerData,f=!0);m.equals(e.clippingArea,c)||(e.clippingArea=c,f=!0);e.wireframe!==a&&(e.wireframe=a,f=!0);return f};b.prototype._createGeometry=function(b){this.tile.createGeometry(this.geometryState,
this.localOrigin);var c=this.geometryInfo.vertexAttributes,d=this.geometryInfo.indices,e=b.gl;this._vao=new r(b,t.Default3D,{geometry:a.glLayout(c.layout)},{geometry:u.createVertex(b,e.STATIC_DRAW,c.buffer)},u.createIndex(b,e.STATIC_DRAW,d))};b.prototype._releaseGeometry=function(){if(!this._vao)return!1;this._vao.dispose();this._vao=null;c.releaseGeometry(this.geometryInfo);return!0};Object.defineProperty(b.prototype,"vao",{get:function(){return this._vao},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"textureReference",{get:function(){if(0===this._textureReferences.length)return null;var a=this._textureReferences[0];0<a.age&&e()-a.age>this._fadeDuration&&(a.texture.release(),this._textureReferences.shift(),(a=this._textureReferences[0])&&0<a.age&&(a.age=e()));switch(this._textureReferences.length){case 0:return null;case 1:return this._textureReferences[0].texture;default:return this._textureReferences[1].texture}},enumerable:!0,configurable:!0});b.prototype.setTextureReference=function(a,b,c,
d){this._expireTextureReference();g.isSome(a)&&this._textureReferences.push(new x(a,b,c,d))};Object.defineProperty(b.prototype,"texOffsetAndScale",{get:function(){switch(this._textureReferences.length){case 0:return w;case 1:return this._textureReferences[0].offsetAndScale;default:return this._textureReferences[1].offsetAndScale}},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"oldTextureReference",{get:function(){return 2>this._textureReferences.length?null:this._textureReferences[0].texture},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"oldTexOffsetAndScale",{get:function(){return 2>this._textureReferences.length?w:this._textureReferences[0].offsetAndScale},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureFadeFactor",{get:function(){if(2>this._textureReferences.length)return 1;var a=e()-this._textureReferences[0].age,b=this._fadeDuration;return a>b?1:a/b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"_fadeDuration",{get:function(){switch(this._textureReferences.length){case 0:case 1:case 2:return this.tile.surface.textureFadeDuration;
default:return.5*this.tile.surface.textureFadeDuration}},enumerable:!0,configurable:!0});b.prototype._getElevationInfo=function(){for(var a=this.geometryState.samplerData,b=this.tile.layerInfo[0],c=b.length,d=Array(c),e=0,f=0,g=!1,h=0;h<c;h++){var l=b[h];if(l.upsampleInfo){var l=l.upsampleInfo.tile,k=l.layerInfo[0][h].data,k=k&&k.samplerData;a&&a[e]===k||(g=!0);d[e++]=k;f=Math.max(f,l.lij[0])}else l.data&&(k=this.tile.surface.layerViewByIndex(h,0),p.fallsWithinLayer(this.tile,k.layer,!1)&&(k=l.data,
a&&a[e]===k.samplerData||(g=!0),d[e++]=k.samplerData,f=this.tile.lij[0]))}a&&a.length!==e&&(g=!0);0<e?d.length=e:d=null;return{changed:g,samplerData:d,maxTileLevel:f}};Object.defineProperty(b.prototype,"estimatedGeometryMemoryUsage",{get:function(){return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureDescriptor",{get:function(){return g.isSome(this._texture)?this._texture.descriptor:null},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"test",{get:function(){return{hasTexture:null!=this._texture}},enumerable:!0,configurable:!0});return b}();b.PatchRenderData=n;var x=function(){return function(a,b,c,d){this.texture=a;this.age=0;a.retain();this.offsetAndScale=h.vec4f64.fromValues(b,c,d,d)}}(),w=h.vec4f64.fromValues(0,0,1,1)})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../2d/engine/vectorTiles/tileRendererHelper3D ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./BlendLayersTechnique ./terrainUtils ./TileTexture ./support/FBOPool ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/Util".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u){function r(a,b,c){c.layerIndex=b;var d=a.layerInfo[1][b];return d.data?(g.vec2.set(c.offset,0,0),c.tile=a,c.scale=1,c.sourceLod=a.lij,c.sourceLayerInfo=d,c):(a=d.upsampleInfo)?(b=a.tile.layerInfo[1][b],c.tile=a.tile,g.vec2.copy(c.offset,a.offset),c.scale=a.scale,c.sourceLod=a.tile.lij,c.sourceLayerInfo=b,c):null}var x=[],w={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0};return function(){function b(a,b,e,f){this._context=
a;this.tileSize=b;this._setNeedsRender=f;this._blackTex=this._backgroundTexture=null;this._context.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=this._context.parameters.maxMaxAnisotropy);this._vaoQuad=t.createQuadVAO(this._context,p.Pos2Tex);a=new d.BlendLayersTechniqueConfiguration;a.mode=2;this._blendLayersTechnique=e.acquireAndReleaseExisting(d.BlendLayersTechnique,a,this._blendLayersTechnique);a.mode=1;this._applyOpacityTechnique=e.acquireAndReleaseExisting(d.BlendLayersTechnique,
a,this._applyOpacityTechnique);this._blackTex=new c.TileTexture(t.createColorTexture(this._context,[0,0,0,1]));this._fboPool=new q.FBOPool(this._context)}b.prototype.dispose=function(){this._fboPool&&(this._fboPool.clear(),this._fboPool=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);k.isSome(this._backgroundTexture)&&(this._backgroundTexture.release(),this._backgroundTexture=null);this._blackTex&&(this._blackTex.release(),this._blackTex=null);this._blendLayersTechnique&&(this._blendLayersTechnique.dispose(),
this._blendLayersTechnique=null);this._applyOpacityTechnique&&(this._applyOpacityTechnique.dispose(),this._applyOpacityTechnique=null)};b.prototype.updateTileTexture=function(b){for(var c=b.layerInfo[1],d=0;d<c.length;d++)c[d].pendingUpdates&=-65;if(b.renderData){for(var e=b.surface,f=e.baseOpacity,d=0,g=this.tileSize,h=!1,l=1,p=c.length,n=0;n<c.length&&!h;n++){var q=e.layerViewByIndex(n,1),u=q.fullOpacity,l=q.view.pixelRatio;x[n]=u;this._isBaseLayer(q.layer)&&p>=c.length&&(p=n);if(0!==u){var t=r(b,
n,w);t&&(a.isVectorTileLayerView(q)?g=Math.max(g,this.tileSize*q.view.pixelRatio):1===f&&1===u&&(q.isOpaque||this._dataToTexture(t)&&k.isSome(t.sourceLayerInfo.data)&&t.sourceLayerInfo.data.descriptor.isOpaque)&&(h=!0),d++)}}this._cleanupFBOPool(l,c.length);f=g;g=m.nextHighestPowerOfTwo(f);c=g*g;e=f*f;c===e?g=f:(f=g/2,g=c-e<e-f*f?g:f);c=g/this.tileSize;--n;0===d&&this._backgroundTexture?this._useBackgroundTexture(b):1===d&&h?this._useLayerTexture(b,n):this._composeMapLayers(b,n,p,h,x,g,c);this._setNeedsRender()}};
b.prototype.setBackground=function(a){k.isSome(this._backgroundTexture)&&this._backgroundTexture.release();this._backgroundTexture=a instanceof HTMLImageElement?this._buildTexture(a):new c.TileTexture(t.createColorTexture(this._context,a))};b.prototype._buildTexture=function(a){if(k.isNone(a))return null;var b={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},d=this._context,e;if("number"===typeof a)b.width=b.height=
a,e=new c.TileTexture(d,b);else if(a instanceof h.ImageWithType)b.isOpaque="image/jpeg"===a.type,e=new c.TileTexture(d,b,a.image),a.release();else try{e=new c.TileTexture(d,b,a)}catch(C){e=new c.TileTexture(t.createEmptyTexture(d)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}d.bindTexture(e.texture);e.generateMipmap();return e};b.prototype._drawRasterData=function(a,b,c,d,e){void 0===e&&(e=1);if(!k.isNone(b)){var f=this._context,g=a.program,
h=this._vaoQuad;f.setPipelineState(a.pipeline);f.bindProgram(g);f.bindVAO(h);g.assertCompatibleVertexAttributeLocations(h);f.bindTexture(b,0);g.setUniform1i("tex",0);g.setUniform1f("scale",c);g.setUniform2f("offset",d[0],d[1]);g.setUniform1f("opacity",e);f.drawArrays(5,0,u.vertexCount(h,"geometry"))}};b.prototype._drawVectorData=function(a,b,c,d,e,g,h){var l=b.sourceLayerInfo.data;if(k.isNone(l))return h;var m=this._context,p=b.tile.surface.layerViewByIndex(b.layerIndex,1),n;m.setPipelineState(a.pipeline);
var q=1>d;q?(n=this._fboPool.acquire(e),m.bindFramebuffer(n),m.setClearColor(1,1,1,0),m.clearSafe(16640)):h&&m.clearSafe(256);f.renderVectorTile(m,b.sourceLod,l,p.painter,p.layer.styleRepository,p.schemaHelper,Math.round(1/b.scale),b.offset,this.tileSize,c);return q?(m.bindFramebuffer(g),this._drawRasterData(a,n.colorTexture,1,[0,0],d),this._fboPool.release(n),h):!0};b.prototype._useBackgroundTexture=function(a){a.renderData.releaseTexture();a.renderData.opacity=a.surface.baseOpacity;a.renderData.setTextureReference(this._backgroundTexture,
0,0,1)};b.prototype._useLayerTexture=function(a,b){a.renderData.releaseTexture();b=r(a,b,w);if(this._dataToTexture(b)){var c=b.offset;a.renderData.setTextureReference(b.sourceLayerInfo.data,c[0],c[1],b.scale)}a.renderData.opacity=a.surface.baseOpacity};b.prototype._composeMapLayers=function(a,b,c,d,f,g,h){var m=this;a.renderData.releaseTexture();var p=a.renderData.ensureTexture(g,function(){return m._buildTexture(g)});if(!k.isNone(p)){var n=this._context,q=this._fboPool.acquire(g);n.bindFramebuffer(q);
n.setViewport(0,0,g,g);n.setClearColor(0,0,0,0);n.setClearDepth(1);n.clearSafe(16640);var u=!1;!d&&k.isSome(this._backgroundTexture)&&this._drawRasterData(this._blendLayersTechnique,this._backgroundTexture.texture,1,e.vec2f64.ZEROS);d=a.surface.baseOpacity;for(var t=!1;0<=b;b--){var v=r(a,b,w);v&&(b<c&&1>d&&!t&&(this._drawRasterData(this._applyOpacityTechnique,this._blackTex.texture,1,e.vec2f64.ZEROS,d),t=!0),0!==f[b]&&(v&&v.sourceLayerInfo&&v.sourceLayerInfo.data instanceof l.VectorTile?u=this._drawVectorData(this._blendLayersTechnique,
v,h,f[b],g,q,u):this._dataToTexture(v)&&k.isSome(v.sourceLayerInfo.data)&&this._drawRasterData(this._blendLayersTechnique,v.sourceLayerInfo.data.texture,v.scale,v.offset,f[b])))}n.bindTexture(p.texture);c=p.descriptor;n.gl.copyTexImage2D(n.gl.TEXTURE_2D,0,c.pixelFormat,0,0,c.width,c.height,0);p.generateMipmap();n.bindFramebuffer(null);this._fboPool.release(q);a.renderData.opacity=t?1:d;a.renderData.setTextureReference(p,0,0,1)}};b.prototype._dataToTexture=function(a){var b=a&&a.sourceLayerInfo&&a.sourceLayerInfo.data;
(b instanceof HTMLImageElement||b instanceof h.ImageWithType||b instanceof HTMLCanvasElement)&&this._rasterDataToTexture(a);return a&&a.sourceLayerInfo&&a.sourceLayerInfo.data instanceof c.TileTexture};b.prototype._rasterDataToTexture=function(a){var b=a.sourceLayerInfo;b.data=this._buildTexture(b.data);a.tile.setMemoryDirty()};b.prototype._isBaseLayer=function(a){return a.parent&&"esri.Basemap"===a.parent.declaredClass&&-1<a.parent.baseLayers.indexOf(a)};b.prototype._cleanupFBOPool=function(a,b){if(a!==
this._lastPixelRatio||b!==this._lastNumLayers)this._fboPool.clear(),this._lastPixelRatio=a,this._lastNumLayers=b};return b}()})},"esri/views/2d/engine/vectorTiles/tileRendererHelper3D":function(){define(["require","exports","../../../../geometry","../../../../Viewpoint","../../ViewState"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});var e={context:null,drawPhase:1,state:null,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",
styleLayer:null,styleLayerId:-1,painter:null,glyphMosaic:null,spriteMosaic:null,fadeRecorder:null,driverTestResult:null,profiler:null,renderingOptions:null,timeDelta:-1,timeline:null,hasClipping:!1};b.renderVectorTile=function(b,g,d,a,c,k,m,n,u,r){var h=k.adjustLevel(g[0]);e.context=b;e.state=f;e.painter=a;e.glyphMosaic=a.glyphMosaic;e.spriteMosaic=a.spriteMosaic;e.fadeRecorder=a.fadeRecorder;e.pixelRatio=r;e.displayLevel=h;e.requiredLevel=h;a.setContext(b);r=k.getScale(g[0]);k=k.getShift(g,m*r);
g=k[0];k=k[1];r=.125*m*r/u;h=d.transforms.dvs;h[0]=r;h[4]=-r;h[6]=-1-g-n[0]*m*2;h[7]=1+k+(1-n[1])*m*2-2;e.state.size[0]=u;e.state.size[1]=u;d.attached||d.attachWithContext(b);d.triangleCount=0;a.drawTile(e,d,c)};var f=new g({viewpoint:new k({targetGeometry:new m.Point(0,0),scale:1,rotation:0}),size:[256,256]})})},"esri/views/2d/ViewState":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df32 ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/mat3 ../../core/libs/gl-matrix-2/mat3f32 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f32 ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w){var v=[0,0];return function(b){function f(){for(var d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];d=b.apply(this,d)||this;d._viewpoint2D={center:r.vec2f64.create(),rotation:0,scale:0,spatialReference:null};d.center=[0,0];d.extent=new g.Extent;d.id=0;d.inverseTransform=c.mat2df64.create();d.resolution=0;d.rotation=0;d.scale=0;d.transform=c.mat2df64.create();d.transformNoRotation=c.mat2df64.create();d.displayMat3=p.mat3f32.create();d.displayViewMat3=
p.mat3f32.create();d.viewMat3=p.mat3f32.create();d.viewMat2d=a.mat2df32.create();d.worldScreenWidth=0;d.size=[0,0];return d}m(f,b);n=f;Object.defineProperty(f.prototype,"pixelRatio",{set:function(a){this._set("pixelRatio",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"size",{set:function(a){this._set("size",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"viewpoint",{set:function(a){if(a){var b=this._viewpoint2D,c=a.targetGeometry;
b.center[0]=c.x;b.center[1]=c.y;b.rotation=a.rotation;b.scale=a.scale;b.spatialReference=c.spatialReference}this._update()},enumerable:!0,configurable:!0});f.prototype.copy=function(a){var b=this.size,c=this.viewpoint;c&&b?(this.viewpoint=w.copy(c,a.viewpoint),this._set("size",t.vec2.copy(b,a.size))):(this.viewpoint=a.viewpoint.clone(),this._set("size",[a.size[0],a.size[1]]));this._set("pixelRatio",a.pixelRatio);return this};f.prototype.clone=function(){return new n({size:this.size,viewpoint:this.viewpoint.clone(),
pixelRatio:this.pixelRatio})};f.prototype.toMap=function(a,b,c){if(x.isVec2(b))return t.vec2.transformMat2d(a,b,this.inverseTransform);v[0]=b;v[1]=c;return t.vec2.transformMat2d(a,v,this.inverseTransform)};f.prototype.toScreen=function(a,b,c){if(x.isVec2(b))return t.vec2.transformMat2d(a,b,this.transform);v[0]=b;v[1]=c;return t.vec2.transformMat2d(a,v,this.transform)};f.prototype.toScreenNoRotation=function(a,b,c){if(x.isVec2(b))return t.vec2.transformMat2d(a,b,this.transformNoRotation);v[0]=b;v[1]=
c;return t.vec2.transformMat2d(a,v,this.transformNoRotation)};f.prototype.getScreenTransform=function(a,b){var c=this._viewpoint2D.center,d=this._get("pixelRatio")||1,e=this._get("size");w.getMatrix(a,c,e,b,0,d);return a};f.prototype._update=function(){var a=this._viewpoint2D,b=a.center,c=a.spatialReference,f=a.scale,l=a.rotation,a=this._get("pixelRatio")||1,k=this._get("size"),m=new e({targetGeometry:new g.Point(b[0],b[1],c),scale:f,rotation:l});this._set("viewpoint",m);if(k&&c&&f)return this.resolution=
w.getResolution(m),this.rotation=l,this.scale=f,this.spatialReference=c,t.vec2.copy(this.center,b),q.mat3.set(this.displayMat3,0!==k[0]?2/k[0]:0,0,0,0,0!==k[1]?-2/k[1]:0,0,-1,1,1),f=q.mat3.identity(this.viewMat3),b=u.vec2f32.fromValues(k[0]/2,k[1]/2),c=u.vec2f32.fromValues(-k[0]/2,-k[1]/2),l=h.common.toRadian(l),q.mat3.translate(f,f,b),q.mat3.rotate(f,f,l),q.mat3.translate(f,f,c),q.mat3.multiply(this.displayViewMat3,this.displayMat3,f),f=d.mat2d.identity(this.viewMat2d),d.mat2d.translate(f,f,b),d.mat2d.rotate(f,
f,l),d.mat2d.translate(f,f,c),w.getExtent(this.extent,m,k),w.getTransform(this.transform,m,k,a),d.mat2d.invert(this.inverseTransform,this.transform),w.getTransformNoRotation(this.transformNoRotation,m,k,a),this.worldScreenWidth=w.getWorldScreenWidth(this.spatialReference,this.resolution),this._set("id",this.id+1),this};var n;k([l.property({readOnly:!0})],f.prototype,"id",void 0);k([l.property({value:1,json:{write:!0}})],f.prototype,"pixelRatio",null);k([l.property({json:{write:!0}})],f.prototype,
"size",null);k([l.property({type:e,json:{write:!0}})],f.prototype,"viewpoint",null);return f=n=k([l.subclass("esri.views.2d.ViewState")],f)}(l.declared(f.JSONSupport))})},"esri/core/libs/gl-matrix-2/common":function(){define(["require","exports","./math/common"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.common=m})},"esri/core/libs/gl-matrix-2/mat2d":function(){define(["require","exports","./math/mat2d"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.mat2d=
m})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["require","exports","./common"],function(n,b,m){function k(b,f,g){var e=f[0],d=f[1],a=f[2],c=f[3],l=f[4];f=f[5];var k=g[0],m=g[1],n=g[2],r=g[3],x=g[4];g=g[5];b[0]=e*k+a*m;b[1]=d*k+c*m;b[2]=e*n+a*r;b[3]=d*n+c*r;b[4]=e*x+a*g+l;b[5]=d*x+c*g+f;return b}function g(b,f,g){b[0]=f[0]-g[0];b[1]=f[1]-g[1];b[2]=f[2]-g[2];b[3]=f[3]-g[3];b[4]=f[4]-g[4];b[5]=f[5]-g[5];return b}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,f){b[0]=
f[0];b[1]=f[1];b[2]=f[2];b[3]=f[3];b[4]=f[4];b[5]=f[5];return b};b.identity=function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=0;b[5]=0;return b};b.set=function(b,f,g,h,d,a,c){b[0]=f;b[1]=g;b[2]=h;b[3]=d;b[4]=a;b[5]=c;return b};b.invert=function(b,f){var e=f[0],g=f[1],d=f[2],a=f[3],c=f[4];f=f[5];var k=e*a-g*d;if(!k)return null;k=1/k;b[0]=a*k;b[1]=-g*k;b[2]=-d*k;b[3]=e*k;b[4]=(d*f-a*c)*k;b[5]=(g*c-e*f)*k;return b};b.determinant=function(b){return b[0]*b[3]-b[1]*b[2]};b.multiply=k;b.rotate=function(b,f,g){var e=
f[0],d=f[1],a=f[2],c=f[3],l=f[4];f=f[5];var k=Math.sin(g);g=Math.cos(g);b[0]=e*g+a*k;b[1]=d*g+c*k;b[2]=e*-k+a*g;b[3]=d*-k+c*g;b[4]=l;b[5]=f;return b};b.scale=function(b,f,g){var e=f[1],d=f[2],a=f[3],c=f[4],l=f[5],k=g[0];g=g[1];b[0]=f[0]*k;b[1]=e*k;b[2]=d*g;b[3]=a*g;b[4]=c;b[5]=l;return b};b.translate=function(b,f,g){var e=f[0],d=f[1],a=f[2],c=f[3],l=f[4];f=f[5];var k=g[0];g=g[1];b[0]=e;b[1]=d;b[2]=a;b[3]=c;b[4]=e*k+a*g+l;b[5]=d*k+c*g+f;return b};b.fromRotation=function(b,f){var e=Math.sin(f);f=Math.cos(f);
b[0]=f;b[1]=e;b[2]=-e;b[3]=f;b[4]=0;b[5]=0;return b};b.fromScaling=function(b,f){b[0]=f[0];b[1]=0;b[2]=0;b[3]=f[1];b[4]=0;b[5]=0;return b};b.fromTranslation=function(b,f){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=f[0];b[5]=f[1];return b};b.str=function(b){return"mat2d("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+")"};b.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+1)};b.add=function(b,f,g){b[0]=f[0]+g[0];
b[1]=f[1]+g[1];b[2]=f[2]+g[2];b[3]=f[3]+g[3];b[4]=f[4]+g[4];b[5]=f[5]+g[5];return b};b.subtract=g;b.multiplyScalar=function(b,f,g){b[0]=f[0]*g;b[1]=f[1]*g;b[2]=f[2]*g;b[3]=f[3]*g;b[4]=f[4]*g;b[5]=f[5]*g;return b};b.multiplyScalarAndAdd=function(b,f,g,h){b[0]=f[0]+g[0]*h;b[1]=f[1]+g[1]*h;b[2]=f[2]+g[2]*h;b[3]=f[3]+g[3]*h;b[4]=f[4]+g[4]*h;b[5]=f[5]+g[5]*h;return b};b.exactEquals=function(b,f){return b[0]===f[0]&&b[1]===f[1]&&b[2]===f[2]&&b[3]===f[3]&&b[4]===f[4]&&b[5]===f[5]};b.equals=function(b,f){var e=
b[0],g=b[1],d=b[2],a=b[3],c=b[4];b=b[5];var k=f[0],p=f[1],n=f[2],u=f[3],r=f[4];f=f[5];return Math.abs(e-k)<=m.EPSILON*Math.max(1,Math.abs(e),Math.abs(k))&&Math.abs(g-p)<=m.EPSILON*Math.max(1,Math.abs(g),Math.abs(p))&&Math.abs(d-n)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(n))&&Math.abs(a-u)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(c-r)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(r))&&Math.abs(b-f)<=m.EPSILON*Math.max(1,Math.abs(b),Math.abs(f))};b.mul=k;b.sub=g})},"esri/core/libs/gl-matrix-2/mat2df32":function(){define(["require",
"exports","./factories/mat2df32"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.mat2df32=m})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["require","exports"],function(n,b){function m(b,g,e,f){var l=g[f];g=g[f+1];b[f]=e[0]*l+e[2]*g+e[4];b[f+1]=e[1]*l+e[3]*g+e[5]}Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var b=new Float32Array(6);b[0]=1;b[3]=1;return b};b.clone=function(b){var g=new Float32Array(6);g[0]=b[0];g[1]=b[1];g[2]=b[2];
g[3]=b[3];g[4]=b[4];g[5]=b[5];return g};b.fromValues=function(b,g,e,f,l,h){var d=new Float32Array(6);d[0]=b;d[1]=g;d[2]=e;d[3]=f;d[4]=l;d[5]=h;return d};b.createView=function(b,g){return new Float32Array(b,g,6)};b.transform=m;b.transformMany=function(b,g,e,f,l,h){void 0===f&&(f=0);void 0===l&&(l=0);void 0===h&&(h=2);for(l=l||g.length/h;f<l;f++)m(b,g,e,f*h)}})},"esri/core/libs/gl-matrix-2/mat2df64":function(){define(["require","exports","./factories/mat2df64"],function(n,b,m){Object.defineProperty(b,
"__esModule",{value:!0});b.mat2df64=m})},"esri/core/libs/gl-matrix-2/factories/mat2df64":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[1,0,0,1,0,0]};b.clone=function(b){return[b[0],b[1],b[2],b[3],b[4],b[5]]};b.fromValues=function(b,k,g,e,f,l){return[b,k,g,e,f,l]};b.createView=function(b,k){return new Float64Array(b,k,6)}})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["require","exports"],function(n,
b){function m(b){return b instanceof Float32Array&&2<=b.length}function k(b){return Array.isArray(b)&&2<=b.length}Object.defineProperty(b,"__esModule",{value:!0});b.isVec2f32=m;b.isVec2f64=k;b.isVec2=function(b){return m(b)||k(b)}})},"esri/views/2d/viewpointUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Viewpoint ../../core/Collection ../../core/maybe ../../core/promiseUtils ../../core/unitUtils ../../core/wgs84Constants ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../../geometry/support/webMercatorUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y){function A(b,c,d,e){return e&&d&&!e.equals(d)&&z.canProject(e,d)&&e.isWebMercator?(e.isWebMercator?(d=c[1],89.99999<d?d=89.99999:-89.99999>d&&(d=-89.99999),d=Math.sin(a.common.toRadian(d)),b=p.vec2.set(b,a.common.toRadian(c[0])*T,.5*T*Math.log((1+d)/(1-d)))):(d=a.common.toDegree(c[0]/T),b=p.vec2.set(b,d-360*Math.floor((d+180)/360),a.common.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-1*c[1]/T))))),b):p.vec2.copy(b,c)}function B(a){return a.wkid?a:
a.spatialReference||w.WGS84}function C(a,b){return b.type?p.vec2.set(a,b.x,b.y):p.vec2.copy(a,b)}function F(a,b){return Math.max(a.width/b[0],a.height/b[1])*Q(a.spatialReference)}function E(a,b,c,d){return k(this,void 0,void 0,function(){var g,h,k,p,n,q,t,w,v,y,A,B,C,F,D,G,J,H,I,M,S,N,K,T,L,V,U,Q;return m(this,function(m){switch(m.label){case 0:if(!a||Array.isArray(a)&&!a.length)return[2,null];e.isCollection(a)&&(a=a.toArray());if(!Array.isArray(a)||!a.length||"object"!==typeof a[0])return[3,7];h=
a.every(function(a){return"attributes"in a});k=a.some(function(a){return!a.geometry});p=a;if(!(h&&k&&b&&b.allLayerViews))return[3,2];n=new Map;q=0;for(t=a;q<t.length;q++)w=t[q],v=w.layer,y=n.get(v)||[],A=w.attributes[v.objectIdField],null!=A&&y.push(A),n.set(v,y);B=[];n.forEach(function(a,c){var d=b.allLayerViews.find(function(a){return a.layer.id===c.id});if("queryFeatures"in d){var e=c.createQuery();e.objectIds=a;e.returnGeometry=!0;B.push(d.queryFeatures(e))}});return[4,l.all(B)];case 1:C=m.sent();
F=[];D=0;for(G=C;D<G.length;D++)if((J=G[D])&&J.features&&J.features.length)for(H=0,I=J.features;H<I.length;H++)w=I[H],f.isSome(w.geometry)&&F.push(w.geometry);p=F;m.label=2;case 2:M=0,S=p,m.label=3;case 3:if(!(M<S.length))return[3,6];N=S[M];return[4,E(N,b,c,d)];case 4:d=m.sent(),m.label=5;case 5:return M++,[3,3];case 6:return[2,d];case 7:if(!Array.isArray(a)||2!==a.length||"number"!==typeof a[0]||"number"!==typeof a[1])return[3,8];g=new x(a);return[3,12];case 8:if(!(a instanceof r))return[3,9];g=
a;return[3,12];case 9:if(!("geometry"in a))return[3,12];if(!a.geometry)return[3,10];g=a.geometry;return[3,12];case 10:if(!a.layer)return[3,12];K=a.layer;T=b.allLayerViews.find(function(a){return a.layer.id===K.id});if(!("queryFeatures"in T))return[3,12];L=K.createQuery();L.objectIds=[a.attributes[K.objectIdField]];L.returnGeometry=!0;return[4,T.queryFeatures(L)];case 11:V=m.sent(),g=f.get(V,"features",0,"geometry"),m.label=12;case 12:if(f.isNone(g))return[2,null];U="point"===g.type?new u({xmin:g.x,
ymin:g.y,xmax:g.x,ymax:g.y,spatialReference:g.spatialReference}):g.extent;if(!U)return[2,null];Q=z.canProject(U,c);if(!U.spatialReference.equals(c)&&Q)U=z.project(U,c);else if(!Q)return[2,null];d=d?d.union(U):U.clone();return[2,d]}})})}function G(a){if(a&&(!Array.isArray(a)||"number"!==typeof a[0])&&("object"===typeof a||Array.isArray(a)&&"object"===typeof a[0])){if("layer"in a&&a.layer&&a.layer.minScale&&a.layer.maxScale){var b=a.layer;return{min:b.minScale,max:b.maxScale}}if(Array.isArray(a)&&a.length&&
a.every(function(a){return"layer"in a})){for(var c=0,d=0,e=0;e<a.length;e++)(b=a[e].layer)&&b.minScale&&b.maxScale&&(c=b.minScale<c?b.minScale:c,d=b.maxScale>d?b.maxScale:d);return c&&d?{min:c,max:d}:null}}}function H(a,b){return k(this,void 0,void 0,function(){var c,d,e,f,h,l,k,p,n,r,q,w,v,D,H,I,M,N,K,S;return m(this,function(m){switch(m.label){case 0:if(!a||!b)return[2,new g({targetGeometry:new x,scale:0,rotation:0})];c=b.spatialReference;d=b.constraints;e=b.padding;f=b.viewpoint;h=b.size;l=e?h[0]-
e.left-e.right:h[0];k=e?h[1]-e.top-e.bottom:h[1];p=[l,k];n=null;a instanceof g?n=a:a.viewpoint?n=a.viewpoint:a.target&&"esri.Viewpoint"===a.target.declaredClass&&(n=a.target);r=null;if(!n||!n.targetGeometry)return[3,1];r=n.targetGeometry;return[3,10];case 1:if(!(a instanceof u))return[3,2];r=a;return[3,10];case 2:return a||a&&("center"in a||"extent"in a||"target"in a)?[4,E(a.center,b,c)]:[3,10];case 3:return(v=m.sent())?[3,5]:[4,E(a.extent,b,c)];case 4:v=m.sent(),m.label=5;case 5:return(w=v)?[3,7]:
[4,E(a.target,b,c)];case 6:w=m.sent(),m.label=7;case 7:return(q=w)?[3,9]:[4,E(a,b,c)];case 8:q=m.sent(),m.label=9;case 9:r=q,m.label=10;case 10:!r&&f&&f.targetGeometry?r=f.targetGeometry:!r&&b.extent&&(r=b.extent);D=B(r);c||(c=B(b.spatialReference||b.extent||r));if(!y.canProject(r,c)&&D&&!D.equals(c))return[2,null];H=C(t.vec2f64.create(),r.center?r.center:r);I=new x(A(H,H,D,c),c);M=null;M=n&&n.targetGeometry&&"point"===n.targetGeometry.type?n.scale:a.hasOwnProperty("scale")&&a.scale?a.scale:a.hasOwnProperty("zoom")&&
-1!==a.zoom&&d&&d.effectiveLODs?d.zoomToScale(a.zoom):Array.isArray(r)||"point"===r.type||"extent"===r.type&&0===r.width&&0===r.height?b.extent&&z.canProject(b.extent,c)?F(z.project(b.extent,c),p):b.extent?F(b.extent,p):f.scale:z.canProject(r.extent,c)?F(z.project(r.extent,c),p):F(r.extent,p);if(N=G(a))N.min&&N.min>M?M=N.min:N.max&&N.max<M&&(M=N.max);K=0;n?K=n.rotation:a.hasOwnProperty("rotation")?K=a.rotation:f&&(K=f.rotation);S=new g({targetGeometry:I,scale:M,rotation:K});d&&(S=d.fit(S),d.rotationEnabled||
(S.rotation=K));return[2,S]}})})}function D(a,b){var c=a.targetGeometry,d=b.targetGeometry;c.x=d.x;c.y=d.y;c.spatialReference=d.spatialReference;a.scale=b.scale;a.rotation=b.rotation;return a}function I(a,b,c){return c?p.vec2.set(a,.5*(b[0]-c.right+c.left),.5*(b[1]-c.bottom+c.top)):p.vec2.scale(a,b,.5)}function L(a,d,e,f){b.getTransform(a,d,e,f);return c.mat2d.invert(a,a)}function O(a,b,c){var d=N(b);b=Math.abs(Math.cos(d));d=Math.abs(Math.sin(d));return p.vec2.set(a,Math.round(c[1]*d+c[0]*b),Math.round(c[1]*
b+c[0]*d))}function K(a){var b=a.scale;a=a.targetGeometry.spatialReference;a=v.isValid(a)?1/(39.37*h.getMetersPerUnitForSR(a)*96):1;return b*a}function N(b){return a.common.toRadian(b.rotation)||0}function Q(a){return v.isValid(a)?39.37*h.getMetersPerUnitForSR(a)*96:1}function M(a){return a.isWrappable?(a=v.getInfo(a),a.valid[1]-a.valid[0]):0}Object.defineProperty(b,"__esModule",{value:!0});var T=d.wgs84Radius,P=180/Math.PI;b.extentToScale=F;b.create=H;b.copy=D;b.getAnchor=I;b.getExtent=function(){var a=
t.vec2f64.create();return function(b,c,d){var e=c.targetGeometry;C(a,e);c=.5*K(c);b.xmin=a[0]-c*d[0];b.ymin=a[1]-c*d[1];b.xmax=a[0]+c*d[0];b.ymax=a[1]+c*d[1];b.spatialReference=e.spatialReference;return b}}();b.setExtent=function(a,c,d,e,f){b.centerAt(a,c,d.center);a.scale=F(d,e);f&&f.constraints&&f.constraints.constrain(a);return a};b.getOuterExtent=function(){var a=t.vec2f64.create(),b=t.vec2f64.create();return function(c,d,e){C(a,d.targetGeometry);O(b,d,e);e=.5*K(d);c.set({xmin:a[0]-e*b[0],ymin:a[1]-
e*b[1],xmax:a[0]+e*b[0],ymax:a[1]+e*b[1],spatialReference:d.targetGeometry.spatialReference});return c}}();b.getOuterSize=O;b.getPaddingScreenTranslation=function(){var a=t.vec2f64.create();return function(b,c,d){return p.vec2.sub(b,p.vec2.scale(b,c,.5),I(a,c,d))}}();b.getPaddingMapTranslation=function(){var a=q.mat2df64.create(),d=t.vec2f64.create();return function(e,f,g,h){var l=K(f);f=N(f);p.vec2.set(d,l,l);c.mat2d.fromScaling(a,d);c.mat2d.rotate(a,a,f);c.mat2d.translate(a,a,b.getPaddingScreenTranslation(d,
g,h));c.mat2d.translate(a,a,[0,h.top-h.bottom]);return p.vec2.set(e,a[4],a[5])}}();b.getResolution=K;b.getResolutionToScaleFactor=Q;b.getMatrix=function(){var a=t.vec2f64.create(),b=t.vec2f64.create(),d=t.vec2f64.create();return function(e,f,g,h,l,k){p.vec2.negate(a,f);p.vec2.scale(b,g,.5*k);p.vec2.set(d,1/h*k,-1/h*k);c.mat2d.identity(e);c.mat2d.translate(e,e,b);l&&c.mat2d.rotate(e,e,l);c.mat2d.scale(e,e,d);c.mat2d.translate(e,e,a);return e}}();b.getTransform=function(){var a=t.vec2f64.create();return function(c,
d,e,f){var g=K(d),h=N(d);C(a,d.targetGeometry);return b.getMatrix(c,a,e,g,h,f)}}();b.getTransformNoRotation=function(){var a=t.vec2f64.create();return function(c,d,e,f){var g=K(d);C(a,d.targetGeometry);return b.getMatrix(c,a,e,g,0,f)}}();b.getWorldWidth=M;b.getWorldScreenWidth=function(a,b){return Math.round(M(a)/b)};b.createAsync=function(a,b){return H(a,b)};b.angleBetween=function(){var a=t.vec2f64.create(),b=t.vec2f64.create(),c=[0,0,0];return function(d,e,f){p.vec2.subtract(a,d,e);p.vec2.normalize(a,
a);p.vec2.subtract(b,d,f);p.vec2.normalize(b,b);p.vec2.cross(c,a,b);d=Math.acos(p.vec2.dot(a,b)/(p.vec2.length(a)*p.vec2.length(b)))*P;0>c[2]&&(d=-d);isNaN(d)&&(d=0);return d}}();b.addPadding=function(){var a=t.vec2f64.create();return function(c,d,e,f){var g=c.targetGeometry;D(c,d);b.getPaddingMapTranslation(a,d,e,f);g.x+=a[0];g.y+=a[1];return c}}();b.removePadding=function(){var a=t.vec2f64.create();return function(c,d,e,f){var g=c.targetGeometry;D(c,d);b.getPaddingMapTranslation(a,d,e,f);g.x-=a[0];
g.y-=a[1];return c}}();b.centerAt=function(){var a=t.vec2f64.create();return function(b,c,d){D(b,c);c=b.targetGeometry;var e=B(d),f=B(c);C(a,d);A(a,a,e,f);c.x=a[0];c.y=a[1];return b}}();b.pixelSize=function(a){return K(a)};b.resize=function(){var a=t.vec2f64.create();return function(c,d,e,f,g){g||(g="center");p.vec2.sub(a,e,f);p.vec2.scale(a,a,.5);e=a[0];f=a[1];switch(g){case "center":p.vec2.set(a,0,0);break;case "left":p.vec2.set(a,-e,0);break;case "top":p.vec2.set(a,0,f);break;case "right":p.vec2.set(a,
e,0);break;case "bottom":p.vec2.set(a,0,-f);break;case "top-left":p.vec2.set(a,-e,f);break;case "bottom-left":p.vec2.set(a,-e,-f);break;case "top-right":p.vec2.set(a,e,f);break;case "bottom-right":p.vec2.set(a,e,-f)}b.translateBy(c,d,a);return c}}();b.rotateBy=function(a,b,c){D(a,b);a.rotation+=c;return a};b.rotateTo=function(a,b,c){D(a,b);a.rotation=c;return a};b.scaleBy=function(){var a=t.vec2f64.create();return function(c,d,e,f,g){D(c,d);isNaN(e)||0===e||(b.toMap(a,f,d,g),c.scale=d.scale*e,b.toScreen(a,
a,c,g),b.translateBy(c,c,p.vec2.set(a,a[0]-f[0],f[1]-a[1])));return c}}();b.scaleTo=function(a,b,c){D(a,b);a.scale=c;return a};b.scaleAndRotateBy=function(){var a=t.vec2f64.create();return function(c,d,e,f,g,h){D(c,d);isNaN(e)||0===e||(b.toMap(a,g,d,h),c.scale=d.scale*e,c.rotation+=f,b.toScreen(a,a,c,h),b.translateBy(c,c,p.vec2.set(a,a[0]-g[0],g[1]-a[1])));return c}}();b.padAndScaleAndRotateBy=function(){var a=t.vec2f64.create(),c=t.vec2f64.create();return function(d,e,f,g,h,l,k){b.getPaddingScreenTranslation(c,
l,k);p.vec2.add(a,h,c);return g?b.scaleAndRotateBy(d,e,f,g,a,l):b.scaleBy(d,e,f,a,l)}}();b.toMap=function(){var a=q.mat2df64.create();return function(b,c,d,e){return p.vec2.transformMat2d(b,c,L(a,d,e,1))}}();b.toScreen=function(){var a=q.mat2df64.create();return function(c,d,e,f){return p.vec2.transformMat2d(c,d,b.getTransform(a,e,f,1))}}();b.translateBy=function(){var a=t.vec2f64.create(),b=q.mat2df64.create();return function(d,e,f){D(d,e);var g=K(e),h=d.targetGeometry;c.mat2d.fromRotation(b,N(e));
c.mat2d.scale(b,b,t.vec2f64.fromValues(g,g));p.vec2.transformMat2d(a,f,b);h.x+=a[0];h.y+=a[1];return d}}()})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});g=function(b){function g(){return null!==b&&b.apply(this,arguments)||this}m(g,b);g.prototype.initializeProgram=function(b){var c=g.shader.get().build();return new a(b.rctx,c.generateSource("vertex"),c.generateSource("fragment"),d.Default3D)};g.prototype.initializePipeline=function(){switch(this.configuration.mode){case 2:return c.makePipelineState({blending:c.simpleBlendingParams(1,771),colorWrite:c.defaultColorWriteParams});
case 1:return c.makePipelineState({blending:c.simpleBlendingParams(0,770),colorWrite:c.defaultColorWriteParams});default:return c.makePipelineState({colorWrite:c.defaultColorWriteParams})}};g.shader=new f.ReloadableShaderModule(e,"../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl",n);return g}(l.ShaderTechnique);b.BlendLayersTechnique=g;g=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.mode=0;return b}m(b,a);k([h.parameter({count:3})],b.prototype,"mode",void 0);return b}(h.ShaderTechniqueConfiguration);
b.BlendLayersTechniqueConfiguration=g})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendLayers.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces","../../shaderModules/ShaderBuilder"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(){var b=new g.ShaderBuilder;b.attributes.add("position","vec2");b.attributes.add("uv0","vec2");b.vertex.uniforms.add("scale","float");b.vertex.uniforms.add("offset",
"vec2");b.varyings.add("uv","vec2");b.vertex.code.add(k.glsl(e||(e=m(["\n    void main(void) {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      uv \x3d uv0 * scale + offset;\n    }\n  "],["\n    void main(void) {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      uv \x3d uv0 * scale + offset;\n    }\n  "]))));b.fragment.uniforms.add("tex","sampler2D");b.fragment.uniforms.add("opacity","float");b.fragment.code.add(k.glsl(f||(f=m(["\n    void main() {\n      vec4 color \x3d texture2D(tex, uv);\n\n      // Note: output in pre-multiplied alpha for correct alpha compositing\n      gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\n    }\n  "],
["\n    void main() {\n      vec4 color \x3d texture2D(tex, uv);\n\n      // Note: output in pre-multiplied alpha for correct alpha compositing\n      gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\n    }\n  "]))));return b};var e,f})},"esri/views/3d/terrain/support/FBOPool":function(){define(["require","exports","../../../../core/ObjectPool","../../../webgl/FramebufferObject"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.renderingContext=
b;this._pools=new Map}b.prototype.acquire=function(b){return this.getPool(b).acquire()};b.prototype.release=function(b){this.getPool(b.width).release(b)};b.prototype.clear=function(){this._pools.forEach(function(b){b.destroy()});this._pools.clear()};b.prototype.getPool=function(b){var e=this._pools.get(b);e||(e=k.bind(k,this.renderingContext,{colorTarget:0,depthStencilTarget:1,width:b,height:b}),e=new m(e),this._pools.set(b,e));return e};return b}();b.FBOPool=n})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require",
"exports","./webgl-debug","../../../webgl/capabilities/isWebGL2Context"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});var g=null,e=[];b.enabled=!1;b.setEnabled=function(e){b.enabled=e};b.begin=function(){b.enabled&&(g=[])};b.trace=function(e){b.enabled&&null!=g&&g.push(e)};b.end=function(){if(b.enabled){var f=g;g=null;f&&(e.forEach(function(b){return b(f)}),e.length=0);return f}return null};b.instrumentContext=function(e){return b.enabled?k.default(e)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),
e):m.makeDebugContext(e,void 0,function(e,f){b.enabled&&g&&g.push("gl."+e+"("+m.glFunctionArgsToString(e,f)+")")}):e};b.request=function(b){e.push(b)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function n(a){if(null==h){h={};d={};for(var b in a)"number"==typeof a[b]&&(h[a[b]]=b,d[b]=a[b])}}function b(){if(null==h)throw"WebGLDebugUtils.init(ctx) not called";}function m(a){b();var c=h[a];return void 0!==c?"gl."+c:"/*UNKNOWN WebGL ENUM*/ 0x"+a.toString(16)+""}function k(a,
b,e,f){a=l[a];if(void 0!==a&&(a=a[b],void 0!==a&&a[e])){if("object"===typeof a[e]&&void 0!==a[e].enumBitwiseOr){b=a[e].enumBitwiseOr;e=0;a=[];for(var c=0;c<b.length;++c){var g=d[b[c]];0!==(f&g)&&(e|=g,a.push(m(g)))}return e===f?a.join(" | "):m(f)}return m(f)}return null===f?"null":void 0===f?"undefined":f.toString()}function g(a,b,d){a.__defineGetter__(d,function(){return b[d]});a.__defineSetter__(d,function(a){b[d]=a})}function e(a,b,d,f){function c(a,c){return function(){d&&d(c,arguments);var e=
a[c].apply(a,arguments),g=f.getError();0!=g&&(h[g]=!0,b(g,c,arguments));return e}}f=f||a;n(a);b=b||function(a,b,c){for(var d="",e=c.length,f=0;f<e;++f)d+=(0==f?"":", ")+k(b,e,f,c[f]);a="WebGL error "+m(a)+" in "+b+"("+d+")";window.console&&window.console.error?window.console.error(a):window.console&&window.console.log&&window.console.log(a)};var h={},l={},p;for(p in a)if("function"==typeof a[p])if("getExtension"!=p)l[p]=c(a,p);else{var q=c(a,p);l[p]=function(){var c=q.apply(a,arguments);return e(c,
b,d,f)}}else g(l,a,p);l.getError=function(){for(var b in h)if(h.hasOwnProperty(b)&&h[b])return h[b]=!1,b;return a.NO_ERROR};return l}function f(a){var b=a.getParameter(a.MAX_VERTEX_ATTRIBS),d=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d);for(var e=0;e<b;++e)a.disableVertexAttribArray(e),a.vertexAttribPointer(e,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(e,0);a.deleteBuffer(d);b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(e=0;e<b;++e)a.activeTexture(a.TEXTURE0+e),a.bindTexture(a.TEXTURE_CUBE_MAP,null),
a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);
a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);
a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var l={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},
vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},
bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},
depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},h=null,d=null;return{init:n,mightBeEnum:function(a){b();
return void 0!==h[a]},glEnumToString:m,glFunctionArgToString:k,glFunctionArgsToString:function(a,b){for(var c="",d=b.length,e=0;e<d;++e)c+=(0==e?"":", ")+k(a,d,e,b[e]);return c},makeDebugContext:e,makeLostContextSimulatingCanvas:function(a){function b(a){return"function"==typeof a?a:function(b){a.handleEvent(b)}}function d(){for(var a=Object.keys(H),b=0;b<a.length;++b)delete H[a]}function e(){++F;A||C==F&&a.loseContext()}function h(a,b){var c=a[b];return function(){e();if(!A)return c.apply(a,arguments)}}
function l(a){return{statusMessage:a,preventDefault:function(){E=!0}}}function k(a){for(var b in a)"function"==typeof a[b]?n[b]=h(a,b):g(n,a,b);n.getError=function(){e();if(!A)for(var a;a=m.getError();)H[a]=!0;for(a in H)if(H[a])return delete H[a],a;return n.NO_ERROR};var c="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(b=0;b<c.length;++b){var d=c[b];n[d]=function(b){return function(){e();if(A)return null;var c=b.apply(a,arguments);c.__webglDebugContextLostId__=
y;B.push(c);return c}}(a[d])}c="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");for(b=0;b<c.length;++b)d=c[b],n[d]=function(b){return function(){e();return A?null:b.apply(a,arguments)}}(n[d]);c="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");
for(b=0;b<c.length;++b)d=c[b],n[d]=function(b){return function(){e();return A?!1:b.apply(a,arguments)}}(n[d]);n.checkFramebufferStatus=function(b){return function(){e();return A?n.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(n.checkFramebufferStatus);n.getAttribLocation=function(b){return function(){e();return A?-1:b.apply(a,arguments)}}(n.getAttribLocation);n.getVertexAttribOffset=function(b){return function(){e();return A?0:b.apply(a,arguments)}}(n.getVertexAttribOffset);n.isContextLost=function(){return A};
return n}var m,n,v=[],z=[];n={};var y=1,A=!1,B=[],C=0,F=0,E=!1,G=0,H={};a.getContext=function(b){return function(){var c=b.apply(a,arguments);if(c instanceof WebGLRenderingContext){if(c!=m){if(m)throw"got different context";m=c;n=k(m)}return n}return c}}(a.getContext);(function(a){var c=a.addEventListener;a.addEventListener=function(d,e,f){switch(d){case "webglcontextlost":v.push(b(e));break;case "webglcontextrestored":z.push(b(e));break;default:c.apply(a,arguments)}}})(a);a.loseContext=function(){if(!A){A=
!0;C=0;for(++y;m.getError(););d();H[m.CONTEXT_LOST_WEBGL]=!0;var b=l("context lost"),c=v.slice();setTimeout(function(){for(var d=0;d<c.length;++d)c[d](b);0<=G&&setTimeout(function(){a.restoreContext()},G)},0)}};a.restoreContext=function(){A&&z.length&&setTimeout(function(){if(!E)throw"can not restore. webglcontestlost listener did not call event.preventDefault";for(var a=0;a<B.length;++a){var b=B[a];b instanceof WebGLBuffer?m.deleteBuffer(b):b instanceof WebGLFramebuffer?m.deleteFramebuffer(b):b instanceof
WebGLProgram?m.deleteProgram(b):b instanceof WebGLRenderbuffer?m.deleteRenderbuffer(b):b instanceof WebGLShader?m.deleteShader(b):b instanceof WebGLTexture&&m.deleteTexture(b)}f(m);A=!1;F=0;E=!1;for(var a=z.slice(),b=l("context restored"),c=0;c<a.length;++c)a[c](b)},0)};a.loseContextInNCalls=function(a){if(A)throw"You can not ask a lost contet to be lost";C=F+a};a.getNumCalls=function(){return F};a.setRestoreTimeout=function(a){G=a};return a},resetToInitialState:f}})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/StencilUtils ./Terrain.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){Object.defineProperty(b,"__esModule",{value:!0});g=function(b){function f(){return null!==b&&b.apply(this,arguments)||this}m(f,b);f.prototype.initializeProgram=function(a){var b=f.shader.get(),d=this.configuration,b=b.build({overlayEnabled:d.overlayEnabled,output:d.output,viewingMode:a.viewingMode,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,textureFadingEnabled:d.textureFadingEnabled&&!d.renderOccluded,receiveShadows:d.receiveShadows&&
!d.renderOccluded,receiveAmbientOcclusion:!1,useOldSceneLightInterface:!0,atmosphere:d.atmosphere,tileBorders:d.tileBorders,screenSizePerspective:d.screenSizePerspective,pbrMode:0});return new c(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),h.Default3D)};f.prototype.initializePipeline=function(){var a=this.configuration,b=a.backfaceCullingEnabled&&!a.renderOccluded;return q.makePipelineState({blending:a.renderOccluded?q.simpleBlendingParams(1,771):null,culling:b&&q.backFaceCullingParams,
depthTest:!a.renderOccluded&&{func:513},depthWrite:!a.renderOccluded&&q.defaultDepthWriteParams,colorWrite:q.defaultColorWriteParams,stencilTest:a.stencilEnabled?d.renderWhenBitIsNotSet(1):null})};f.shader=new e.ReloadableShaderModule(a,"./Terrain.glsl",n);return f}(f.ShaderTechnique);b.TerrainTechnique=g;g=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.overlayEnabled=!1;b.atmosphere=!1;b.receiveShadows=!1;b.slicePlaneEnabled=!1;b.backfaceCullingEnabled=!1;b.stencilEnabled=
!1;b.textureFadingEnabled=!1;b.renderOccluded=!1;b.tileBorders=!1;b.screenSizePerspective=!1;return b}m(b,a);k([l.parameter({count:7})],b.prototype,"output",void 0);k([l.parameter()],b.prototype,"overlayEnabled",void 0);k([l.parameter()],b.prototype,"atmosphere",void 0);k([l.parameter()],b.prototype,"receiveShadows",void 0);k([l.parameter()],b.prototype,"slicePlaneEnabled",void 0);k([l.parameter()],b.prototype,"backfaceCullingEnabled",void 0);k([l.parameter()],b.prototype,"stencilEnabled",void 0);
k([l.parameter()],b.prototype,"textureFadingEnabled",void 0);k([l.parameter()],b.prototype,"renderOccluded",void 0);k([l.parameter()],b.prototype,"tileBorders",void 0);k([l.parameter()],b.prototype,"screenSizePerspective",void 0);return b}(l.ShaderTechniqueConfiguration);b.TerrainTechniqueConfiguration=g})},"esri/views/3d/webgl-engine/shaders/Terrain.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/output/OutputDepth.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../core/shaderLibrary/shading/NormalUtils.glsl ../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder ./Overlay.glsl ./Skirts.glsl".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var n=new c.ShaderBuilder;n.include(p.Skirts);n.attributes.add("position","vec3");n.attributes.add("uv0","vec2");n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("origin","vec3").add("skirtScale","float");0===b.output&&(n.include(g.Transform,{linearDepth:!1}),n.include(h.NormalUtils,b),b.overlayEnabled&&n.include(q.Overlay,{pbrMode:3,useCustomDTRExponentForWater:!1}),n.varyings.add("vnormal",
"vec3"),n.varyings.add("vpos","vec3"),n.varyings.add("vtc","vec2"),n.vertex.uniforms.add("viewNormal","mat4"),n.vertex.uniforms.add("texOffsetAndScale","vec4"),n.vertex.uniforms.add("oldTexOffsetAndScale","vec4"),b.receiveShadows&&n.varyings.add("linearDepth","float"),b.tileBorders&&n.varyings.add("vuv","vec2"),b.atmosphere&&(n.vertex.uniforms.add("lightingMainDirection","vec3"),n.varyings.add("wnormal","vec3"),n.varyings.add("wlight","vec3")),b.overlayEnabled&&(n.varyings.add("tbnTangent","vec3"),
n.varyings.add("tbnBiTangent","vec3")),b.textureFadingEnabled&&n.varyings.add("ovtc","vec2"),b.screenSizePerspective&&(n.vertex.uniforms.add("screenSizePerspective","vec4"),n.varyings.add("screenSizeDistanceToCamera","float"),n.varyings.add("screenSizeCosAngle","float")),n.vertex.code.add(a.glsl(A||(A=m(["\n      void main(void) {\n        vpos \x3d position;\n        vnormal \x3d getLocalUp(vpos, origin);\n\n        vec2 uv \x3d uv0;\n        vpos \x3d applySkirts(uv, vpos, vnormal, skirtScale);\n        ",
"\n        ","\n        ","\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        ","\n        vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n        ","\n        ","\n      }\n    "],["\n      void main(void) {\n        vpos \x3d position;\n        vnormal \x3d getLocalUp(vpos, origin);\n\n        vec2 uv \x3d uv0;\n        vpos \x3d applySkirts(uv, vpos, vnormal, skirtScale);\n        ","\n        ","\n        ","\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        ",
"\n        vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n        ","\n        ","\n      }\n    "])),b.atmosphere?a.glsl(t||(t=m(["\n        wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n        wlight \x3d (view  * vec4(-lightingMainDirection, 1.0)).xyz;"],["\n        wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n        wlight \x3d (view  * vec4(-lightingMainDirection, 1.0)).xyz;"]))):"",b.tileBorders?a.glsl(u||(u=m(["vuv \x3d uv;"],["vuv \x3d uv;"]))):
"",b.screenSizePerspective?a.glsl(r||(r=m(["\n        vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\n        screenSizeDistanceToCamera \x3d length(viewPos);\n        vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n        screenSizeCosAngle \x3d abs(viewSpaceNormal.z);"],["\n        vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\n        screenSizeDistanceToCamera \x3d length(viewPos);\n        vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n        screenSizeCosAngle \x3d abs(viewSpaceNormal.z);"]))):
"",b.receiveShadows?a.glsl(x||(x=m(["linearDepth \x3d gl_Position.w;"],["linearDepth \x3d gl_Position.w;"]))):"",b.overlayEnabled?a.glsl(z||(z=m(["\n        setOverlayVTC(uv);\n        ","\n        "],["\n        setOverlayVTC(uv);\n        ","\n        "])),0===b.viewingMode?a.glsl(w||(w=m(["\n        tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), vnormal));\n        tbnBiTangent \x3d normalize(cross(vnormal, tbnTangent));"],["\n        tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), vnormal));\n        tbnBiTangent \x3d normalize(cross(vnormal, tbnTangent));"]))):
a.glsl(v||(v=m(["\n        tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n        tbnBiTangent \x3d normalize(cross(vnormal, tbnTangent));"],["\n        tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n        tbnBiTangent \x3d normalize(cross(vnormal, tbnTangent));"])))):"",b.textureFadingEnabled?a.glsl(y||(y=m(["\n        ovtc \x3d uv * oldTexOffsetAndScale.zw + oldTexOffsetAndScale.xy;"],["\n        ovtc \x3d uv * oldTexOffsetAndScale.zw + oldTexOffsetAndScale.xy;"]))):"")),n.extensions.add("GL_OES_standard_derivatives"),
n.extensions.add("GL_EXT_shader_texture_lod"),n.include(k.Slice,b),n.include(l.EvaluateSceneLighting,b),n.fragment.uniforms.add("camPos","vec3").add("viewDirection","vec3").add("ssaoTex","sampler2D").add("viewportPixelSz","vec4").add("tex","sampler2D").add("opacity","float"),b.screenSizePerspective&&n.fragment.uniforms.add("screenSizePerspective","vec4"),b.overlayEnabled&&(n.fragment.uniforms.add("ovInnerWaterTex","sampler2D"),n.fragment.uniforms.add("ovOuterWaterTex","sampler2D")),b.textureFadingEnabled&&
n.fragment.uniforms.add("texOld","sampler2D").add("textureFadeFactor","float"),n.fragment.code.add(a.glsl(B||(B=m(["\n      const vec3 ambient \x3d vec3(0.2, 0.2, 0.2);\n      const vec3 diffuse \x3d vec3(0.8, 0.8, 0.8);\n      const float diffuseHardness \x3d 2.5;\n      const float sliceOpacity \x3d 0.2;\n\n      float lum(vec3 c) {\n        float max \x3d max(max(c.r, c.g), c.b);\n        float min \x3d min(min(c.r, c.g), c.b);\n        return (min + max) * 0.5;\n      }\n      "],["\n      const vec3 ambient \x3d vec3(0.2, 0.2, 0.2);\n      const vec3 diffuse \x3d vec3(0.8, 0.8, 0.8);\n      const float diffuseHardness \x3d 2.5;\n      const float sliceOpacity \x3d 0.2;\n\n      float lum(vec3 c) {\n        float max \x3d max(max(c.r, c.g), c.b);\n        float min \x3d min(min(c.r, c.g), c.b);\n        return (min + max) * 0.5;\n      }\n      "])))),
b.atmosphere&&n.fragment.code.add(a.glsl(C||(C=m(["\n      vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n        vec3 surfaceColor   \x3d vec3(0.0);\n        vec3 fuzzySpecColor \x3d vec3(1.0);\n        vec3 subColor       \x3d vec3(0.0);\n        float rollOff       \x3d 1.0;\n\n        vec3 Ln \x3d normalize(lightPos);\n        vec3 Nn \x3d normalize(normal);\n        vec3 Hn \x3d normalize(view + Ln);\n\n        float ldn \x3d dot(Ln, Nn);\n        float diffComp \x3d max(0.0, ldn);\n        // clamp necessary here because values might cause flickering: #21549\n        float vdn \x3d clamp(1.0 - dot(view, Nn), 0.0, 1.0);\n        float ndv \x3d dot(view, Ln);\n\n        vec3 diffContrib \x3d surfaceColor * diffComp;\n        float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n\n        vec3 subContrib \x3d subLamb * subColor;\n        vec3 vecColor \x3d vec3(vdn);\n\n        vec3 diffuseContrib \x3d (subContrib + diffContrib);\n        vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\n\n        return (diffContrib + specularContrib) * rollOff;\n      }\n      "],
["\n      vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n        vec3 surfaceColor   \x3d vec3(0.0);\n        vec3 fuzzySpecColor \x3d vec3(1.0);\n        vec3 subColor       \x3d vec3(0.0);\n        float rollOff       \x3d 1.0;\n\n        vec3 Ln \x3d normalize(lightPos);\n        vec3 Nn \x3d normalize(normal);\n        vec3 Hn \x3d normalize(view + Ln);\n\n        float ldn \x3d dot(Ln, Nn);\n        float diffComp \x3d max(0.0, ldn);\n        // clamp necessary here because values might cause flickering: #21549\n        float vdn \x3d clamp(1.0 - dot(view, Nn), 0.0, 1.0);\n        float ndv \x3d dot(view, Ln);\n\n        vec3 diffContrib \x3d surfaceColor * diffComp;\n        float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n\n        vec3 subContrib \x3d subLamb * subColor;\n        vec3 vecColor \x3d vec3(vdn);\n\n        vec3 diffuseContrib \x3d (subContrib + diffContrib);\n        vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\n\n        return (diffContrib + specularContrib) * rollOff;\n      }\n      "])))),
n.fragment.code.add(a.glsl(N||(N=m(["\n      void main() {\n        ","\n        float vndl \x3d dot(normalize(vnormal), -lightingMainDirection);\n        float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n        vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\n\n        float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        ","\n        ","\n        if (rejectBySlice(vpos)) {\n          tileColor *\x3d sliceOpacity;\n        }\n        vec3 atm \x3d vec3(0.0);\n        ",
"\n        vec3 albedo \x3d atm + tileColor.rgb;\n        vec3 normal \x3d normalize(vnormal);\n\n        // heuristic shading function used in the old terrain, now used to add ambient lighting\n        float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n        gl_FragColor \x3d vec4(evaluateSceneLightingExt(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\n        ",
"\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "],["\n      void main() {\n        ","\n        float vndl \x3d dot(normalize(vnormal), -lightingMainDirection);\n        float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n        vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\n\n        float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        ",
"\n        ","\n        if (rejectBySlice(vpos)) {\n          tileColor *\x3d sliceOpacity;\n        }\n        vec3 atm \x3d vec3(0.0);\n        ","\n        vec3 albedo \x3d atm + tileColor.rgb;\n        vec3 normal \x3d normalize(vnormal);\n\n        // heuristic shading function used in the old terrain, now used to add ambient lighting\n        float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n        gl_FragColor \x3d vec4(evaluateSceneLightingExt(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\n        ",
"\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "])),b.receiveShadows?a.glsl(F||(F=m(["float shadow \x3d readShadowMap(vpos, linearDepth);"],["float shadow \x3d readShadowMap(vpos, linearDepth);"]))):a.glsl(E||(E=m(["float shadow \x3d 0.0;"],["float shadow \x3d 0.0;"]))),b.textureFadingEnabled?a.glsl(G||(G=m(["vec4 tileColor \x3d (textureFadeFactor \x3c 1.0 ? mix(texture2D(texOld, ovtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc)) * opacity;"],
["vec4 tileColor \x3d (textureFadeFactor \x3c 1.0 ? mix(texture2D(texOld, ovtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc)) * opacity;"]))):a.glsl(H||(H=m(["vec4 tileColor \x3d texture2D(tex, vtc) * opacity;"],["vec4 tileColor \x3d texture2D(tex, vtc) * opacity;"]))),b.overlayEnabled?a.glsl(D||(D=m(["vec4 overlayColor \x3d getCombinedOverlayColor();\n            tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;"],["vec4 overlayColor \x3d getCombinedOverlayColor();\n            tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;"]))):
"",b.atmosphere?a.glsl(I||(I=m(["\n            float ndotl \x3d max(0.0, min(1.0, vndl));\n            atm \x3d atmosphere(wlight, wnormal, -viewDirection);\n            atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\n            atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\n            atm *\x3d tileColor.a; // premultiply with tile alpha"],["\n            float ndotl \x3d max(0.0, min(1.0, vndl));\n            atm \x3d atmosphere(wlight, wnormal, -viewDirection);\n            atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\n            atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\n            atm *\x3d tileColor.a; // premultiply with tile alpha"]))):
"",b.overlayEnabled?a.glsl(L||(L=m(["\n            vec4 overlayWaterMask \x3d getOverlayColor(ovInnerWaterTex, ovOuterWaterTex, vtcOverlay);\n            float waterNormalLength \x3d length(overlayWaterMask);\n            if (waterNormalLength \x3e 0.95) {\n              mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, vnormal);\n              vec4 waterColor \x3d overlayOpacity * getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vpos - camPos), shadow, vnormal, tbnMatrix);\n              // un-gamma the ground color to mix in linear space\n              vec4 groundColor \x3d vec4(pow(gl_FragColor.rgb, vec3(2.2)), gl_FragColor.w);\n              waterColor \x3d mix(groundColor, waterColor, waterColor.a);\n              gl_FragColor \x3d delinearizeGamma(waterColor);\n            }"],
["\n            vec4 overlayWaterMask \x3d getOverlayColor(ovInnerWaterTex, ovOuterWaterTex, vtcOverlay);\n            float waterNormalLength \x3d length(overlayWaterMask);\n            if (waterNormalLength \x3e 0.95) {\n              mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, vnormal);\n              vec4 waterColor \x3d overlayOpacity * getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vpos - camPos), shadow, vnormal, tbnMatrix);\n              // un-gamma the ground color to mix in linear space\n              vec4 groundColor \x3d vec4(pow(gl_FragColor.rgb, vec3(2.2)), gl_FragColor.w);\n              waterColor \x3d mix(groundColor, waterColor, waterColor.a);\n              gl_FragColor \x3d delinearizeGamma(waterColor);\n            }"]))):
"",b.screenSizePerspective?a.glsl(O||(O=m(["\n          float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n          if (perspectiveScale \x3c\x3d 0.25) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\n          }\n          else if (perspectiveScale \x3c\x3d 0.5) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\n          }\n          else if (perspectiveScale \x3e\x3d 0.99) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\n          }\n          else {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\n          }"],
["\n          float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n          if (perspectiveScale \x3c\x3d 0.25) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\n          }\n          else if (perspectiveScale \x3c\x3d 0.5) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\n          }\n          else if (perspectiveScale \x3e\x3d 0.99) {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\n          }\n          else {\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\n          }"]))):
"",b.tileBorders?a.glsl(K||(K=m(["\n            vec2 dVuv \x3d fwidth(vuv);\n            vec2 edgeFactors \x3d smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));\n            float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);"],["\n            vec2 dVuv \x3d fwidth(vuv);\n            vec2 edgeFactors \x3d smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));\n            float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\n            gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);"]))):
"")));if(1===b.output||3===b.output)n.include(g.Transform,{linearDepth:!0}),n.include(d.RgbaFloatEncoding),n.include(e.OutputDepth,{output:b.output}),n.include(h.NormalUtils,b),n.varyings.add("linearDepth","float"),n.vertex.uniforms.add("nearFar","vec2"),n.vertex.code.add(a.glsl(Q||(Q=m(["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vec3 vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\n\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);\n        }\n    "],
["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vec3 vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\n\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);\n        }\n    "])))),n.fragment.code.add(a.glsl(M||(M=m(["\n        void main() {\n          outputDepth(linearDepth);\n        }\n    "],["\n        void main() {\n          outputDepth(linearDepth);\n        }\n    "]))));
2===b.output&&(n.include(g.Transform,{linearDepth:!1}),n.include(h.NormalUtils,b),n.varyings.add("vnormal","vec3"),n.varyings.add("vpos","vec3"),n.vertex.uniforms.add("viewNormal","mat4"),n.vertex.code.add(a.glsl(T||(T=m(["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vpos \x3d applySkirts(uv, position, normal, skirtScale);\n\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          vnormal \x3d normalize((viewNormal * vec4(normal, 1.0)).xyz);\n        }\n    "],
["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vpos \x3d applySkirts(uv, position, normal, skirtScale);\n\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          vnormal \x3d normalize((viewNormal * vec4(normal, 1.0)).xyz);\n        }\n    "])))),n.fragment.code.add(a.glsl(P||(P=m(["\n        void main() {\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) {\n            normal \x3d -normal;\n          }\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 0.0);\n        }\n    "],
["\n        void main() {\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) {\n            normal \x3d -normal;\n          }\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 0.0);\n        }\n    "])))));4===b.output&&(n.include(g.Transform,{linearDepth:!1}),n.include(h.NormalUtils,b),n.include(q.Overlay,{pbrMode:0}),n.vertex.code.add(a.glsl(S||(S=m(["\n          void main() {\n            vec3 vnormal \x3d getLocalUp(position, origin);\n            vec2 uv \x3d uv0;\n            vec3 vpos \x3d applySkirts(uv, position, vnormal, skirtScale);\n            setOverlayVTC(uv);\n\n            gl_Position \x3d transformPosition(proj, view, vpos);\n          }\n      "],
["\n          void main() {\n            vec3 vnormal \x3d getLocalUp(position, origin);\n            vec2 uv \x3d uv0;\n            vec3 vpos \x3d applySkirts(uv, position, vnormal, skirtScale);\n            setOverlayVTC(uv);\n\n            gl_Position \x3d transformPosition(proj, view, vpos);\n          }\n      "])))),n.include(f.OutputHighlight),n.fragment.code.add(a.glsl(V||(V=m(["\n        void main() {\n          vec4 overlayColor \x3d getCombinedOverlayColor();\n\n          if (overlayColor.a \x3d\x3d 0.0) {\n            gl_FragColor \x3d vec4(0.0);\n            return;\n          }\n\n          outputHighlight();\n        }\n      "],
["\n        void main() {\n          vec4 overlayColor \x3d getCombinedOverlayColor();\n\n          if (overlayColor.a \x3d\x3d 0.0) {\n            gl_FragColor \x3d vec4(0.0);\n            return;\n          }\n\n          outputHighlight();\n        }\n      "])))));return n};var t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L,O,K,N,Q,M,T,P,S,V})},"esri/views/3d/webgl-engine/shaders/Overlay.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/shading/EvaluateMainLighting.glsl ../core/shaderLibrary/shading/Water.glsl ../core/shaderModules/interfaces".split(" "),
function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});b.Overlay=function(a,b){3!==b.pbrMode&&4!==b.pbrMode||a.include(g.Water,b);a.vertex.uniforms.add("overlayTexOffset","vec4");a.vertex.uniforms.add("overlayTexScale","vec4");a.varyings.add("vtcOverlay","vec4");a.vertex.code.add(e.glsl(f||(f=m(["\n    void setOverlayVTC(in vec2 uv) {\n      vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n    }\n  "],["\n    void setOverlayVTC(in vec2 uv) {\n      vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n    }\n  "]))));
a.fragment.uniforms.add("ovInnerColorTex","sampler2D");a.fragment.uniforms.add("ovOuterColorTex","sampler2D");a.fragment.uniforms.add("overlayOpacity","float");a.fragment.code.add(e.glsl(l||(l=m(["\n    vec4 getOverlayColor(sampler2D ov0Tex, sampler2D ov1Tex, vec4 texCoords) {\n      vec4 color \x3d vec4(0.0);\n\n      // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:\n      // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control\n      // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657\n      vec4 color0 \x3d texture2D(ov0Tex, texCoords.xy);\n      vec4 color1 \x3d texture2D(ov1Tex, texCoords.zw);\n\n      if ((texCoords.x \x3e\x3d 0.0) \x26\x26 (texCoords.x \x3c\x3d 1.0) \x26\x26 (texCoords.y \x3e\x3d 0.0) \x26\x26 (texCoords.y \x3c\x3d 1.0)) {\n        color \x3d color0;\n      } else if ((texCoords.z \x3e\x3d 0.0) \x26\x26 (texCoords.z \x3c\x3d 1.0) \x26\x26 (texCoords.w \x3e\x3d 0.0) \x26\x26 (texCoords.w \x3c\x3d 1.0)) {\n        color \x3d color1;\n      }\n\n      return color;\n    }\n  "],
["\n    vec4 getOverlayColor(sampler2D ov0Tex, sampler2D ov1Tex, vec4 texCoords) {\n      vec4 color \x3d vec4(0.0);\n\n      // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:\n      // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control\n      // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657\n      vec4 color0 \x3d texture2D(ov0Tex, texCoords.xy);\n      vec4 color1 \x3d texture2D(ov1Tex, texCoords.zw);\n\n      if ((texCoords.x \x3e\x3d 0.0) \x26\x26 (texCoords.x \x3c\x3d 1.0) \x26\x26 (texCoords.y \x3e\x3d 0.0) \x26\x26 (texCoords.y \x3c\x3d 1.0)) {\n        color \x3d color0;\n      } else if ((texCoords.z \x3e\x3d 0.0) \x26\x26 (texCoords.z \x3c\x3d 1.0) \x26\x26 (texCoords.w \x3e\x3d 0.0) \x26\x26 (texCoords.w \x3c\x3d 1.0)) {\n        color \x3d color1;\n      }\n\n      return color;\n    }\n  "]))));
a.fragment.code.add(e.glsl(h||(h=m(["\n    vec4 getCombinedOverlayColor() {\n      return overlayOpacity * getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n    }\n  "],["\n    vec4 getCombinedOverlayColor() {\n      return overlayOpacity * getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n    }\n  "]))));if(3===b.pbrMode||4===b.pbrMode)a.include(k.EvaluateMainLighting),a.fragment.code.add(e.glsl(d||(d=m(["\n    vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,\n       float shadow, vec3 localUp, mat3 tbn) {\n\n      // reproject normal from 0...1 \x3d\x3e -1...1\n      // and project it to worldspace.\n      vec3 n \x3d normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\n      vec3 v \x3d vposEyeDir;\n      vec3 l \x3d normalize(-lightingMainDirection);\n      vec3 final \x3d getSeaColor(n, v, l, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow);\n\n      // the terrain renderer assumes a premultiplied color output without gamma.\n      return vec4(final * colorInput.w, colorInput.w);\n    }\n    "],
["\n    vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,\n       float shadow, vec3 localUp, mat3 tbn) {\n\n      // reproject normal from 0...1 \x3d\x3e -1...1\n      // and project it to worldspace.\n      vec3 n \x3d normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\n      vec3 v \x3d vposEyeDir;\n      vec3 l \x3d normalize(-lightingMainDirection);\n      vec3 final \x3d getSeaColor(n, v, l, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow);\n\n      // the terrain renderer assumes a premultiplied color output without gamma.\n      return vec4(final * colorInput.w, colorInput.w);\n    }\n    "]))))};
var f,l,h,d})},"esri/views/3d/webgl-engine/shaders/Skirts.glsl":function(){define(["require","exports","../../../../core/tsSupport/makeTemplateObjectHelper","../core/shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.Skirts=function(b){b.vertex.code.add(k.glsl(g||(g=m(['\n    vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\n      float skirtLength \x3d 0.0;\n\n      if (uv.x \x3e\x3d 2.0) {\n        skirtLength \x3d uv.y * skirtScale;\n        // decode original uv-coordinates (see "encodeSkirtPos")\n        vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\n        uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n      }\n\n      return vpos - vnormal * skirtLength;\n    }\n    '],
['\n    vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\n      float skirtLength \x3d 0.0;\n\n      if (uv.x \x3e\x3d 2.0) {\n        skirtLength \x3d uv.y * skirtScale;\n        // decode original uv-coordinates (see "encodeSkirtPos")\n        vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\n        uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n      }\n\n      return vpos - vnormal * skirtLength;\n    }\n    ']))))};var g})},"esri/views/3d/terrain/TilemapOnlyTile":function(){define(["require",
"exports","./TilePerLayerInfo"],function(n,b,m){return function(){function b(b,e,f){this.lij=b;this._pool=e;this.layerInfo=Array(2);this.parent=null;for(b=0;2>b;b++)if(e=f[b],0<e){this.layerInfo[b]=[];for(var g=0;g<e;++g)this.layerInfo[b][g]=m.TilePerLayerInfo.makeEmptyLayerInfo(b,this._pool)}}b.prototype.hasDataAvailable=function(b,e,f){return(e=this.layerInfo[f][e].tilemap)?"unavailable"!==e.getAvailability(b.lij[1],b.lij[2]):!0};b.prototype.modifyLayers=function(b,e,f){b=this.layerInfo[f];for(var g=
e.length,h=Array(g),d=0;d<g;d++){var a=e[d];h[d]=-1<a?b[a]:m.TilePerLayerInfo.makeEmptyLayerInfo(f,this._pool)}this.layerInfo[f]=h};return b}()})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2f64"],function(n,b,m){return function(){function b(){this.offset=m.vec2f64.create();this.scale=0;this.tile=null}b.prototype.init=function(b,e,f,l){this.tile=b;this.offset[0]=e;this.offset[1]=f;this.scale=l};b.prototype.dispose=function(){this.tile=
null;this.offset[0]=0;this.scale=this.offset[1]=0};return b}()})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./lib/AutoDisposable ./lib/GeometryRecord ./lighting/Lightsources ./parts/Model ./parts/RenderView".split(" "),function(n,
b,m,k,g,e,f,l,h,d,a,c,q,p){function t(a){return"function"===typeof a.addParentStage&&"function"===typeof a.removeParentStage}Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a.model=new q.Model;a._viewContent=[];a._mainLightDirection=h.vec3f64.fromValues(0,1,0);return a}k(g,b);n=g;g.prototype.initialize=function(){this._set("renderView",new p.RenderView(this.container,this,this.options));this.setLighting({lights:[new c.MainLight(h.vec3f64.fromValues(.7,
.7,.7)),new c.AmbientLight(h.vec3f64.fromValues(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})};g.prototype.destroy=function(){a.pool.prune(0);this.dispose()};Object.defineProperty(g.prototype,"dirty",{get:function(){return this.model.getDirtySet().hasDirtyGeometryRecords()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"mainLightDirection",{get:function(){return this._mainLightDirection},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"lighting",{get:function(){return this._lighting},
enumerable:!0,configurable:!0});g.prototype.setLighting=function(a){l.vec3.set(this._mainLightDirection,0,0,0);for(var b=0,d=a.lights;b<d.length;b++){var e=d[b];if(e instanceof c.MainLight){l.vec3.negate(this._mainLightDirection,e.direction);break}}this._lighting=a;this.renderView.setNeedsRender()};g.prototype.forceAllAnimations=function(a){this.getAll(3).forEach(function(b){e.applySome(b.animation,function(b){return b.forceTime(a)})});this.renderView.setNeedsRender()};g.prototype.add=function(a,
b){this.model.add(a,b);t(b)&&b.addParentStage(this);this.renderView.setNeedsRender()};g.prototype.remove=function(a,b){this.renderView.setNeedsRender();a=this.model.remove(a,b);t(a)&&a.removeParentStage(this);return a};g.prototype.notifyDirty=function(a,b,c){this.model.notifyDirty(a,b,c);this.renderView.setNeedsRender()};g.prototype.processDirty=function(){var a=this.model.getDirtySet();if(a.hasDirtyGeometryRecords()){n.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));
var b=a.commitLayers(this._viewContent);0<b[0].length+b[1].length+b[2].length&&this.renderView.modify(b[0],b[1],b[2]);n.DebugSettings.logDirtySet&&(console.log("RGs add: "+b[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+b[1].map(function(a){return a.uniqueName})));a.commit();this.renderView.setNeedsRender()}};g.prototype.processDirtyLayer=function(a){a=this.model.getDirtySet().commitLayers([a]);0<a[0].length+a[1].length+a[2].length&&this.renderView.modify(a[0],a[1],a[2]);this.renderView.setNeedsRender()};
g.prototype.getContent=function(a,b){return this.model.get(a,b)};g.prototype.getAll=function(a){return this.model.getAll(a)};g.prototype.getCount=function(a){return this.model.getAll(a).size};g.prototype.getCamera=function(){return this.renderView.getCamera()};g.prototype.setCamera=function(a){this.renderView.setCamera(a)};g.prototype.getLayers=function(){return this.model.getAll(0)};g.prototype.getViewContent=function(){return this._viewContent.slice(0)};g.prototype.addToViewContent=function(a){for(var b=
[],c=0;c<a.length;c++)-1===this._viewContent.indexOf(a[c])&&b.push(a[c]);0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(b),this.renderView.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,b))};g.prototype.removeFromViewContent=function(a){this.processDirty();for(var b=this.model.getDirtySet(),c=this._viewContent,d=[],e=0;e<a.length;e++){var f=c.indexOf(a[e]);-1<f&&(c[f]=c[c.length-1],c.pop(),d.push(a[e]))}a=b.getResidentRenderGeometriesFilteredByLayers(d);
this.renderView.modify([],a,[])};g.prototype.addRenderPlugin=function(a,b){"intersect"in b&&this.sceneIntersectionHelper.addIntersectionHandler(b);this.renderView.renderPlugins.add(a,b)};g.prototype.removeRenderPlugin=function(a){"intersect"in a&&this.sceneIntersectionHelper.removeIntersectionHandler(a);this.renderView.renderPlugins.remove(a)};g.prototype.getContentDebugStrings=function(a){return this.model.formatDebugInfo(a)};var n;g.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};m([f.property({constructOnly:!0})],
g.prototype,"options",void 0);m([f.property({constructOnly:!0})],g.prototype,"sceneIntersectionHelper",void 0);m([f.property({constructOnly:!0})],g.prototype,"viewingMode",void 0);m([f.property({constructOnly:!0})],g.prototype,"container",void 0);m([d.autoDispose(),f.property()],g.prototype,"renderView",void 0);return g=n=m([f.subclass("esri.views.3d.webgl-engine.Stage")],g)}(f.declared(d.AutoDisposableMixin(g)));b.Stage=n})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports ../../../../core/string ../../support/mathUtils ../lib/localOrigin ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util".split(" "),
function(n,b,m,k,g,e,f,l,h){Object.defineProperty(b,"__esModule",{value:!0});var d=h.assert,a=h.logWithBase;n=function(){function b(){var a=this;this.dirtySet=new f(this);this._id2origin={};this._content=new Map;e.allModelContentTypes.forEach(function(b){return a._content.set(b,new Map)})}b.prototype.getAll=function(a){a=this._content.get(a);d(void 0!==a);return a};b.prototype.get=function(a,b){return this.getAll(a).get(b)};b.prototype.add=function(a,b){var c=this._content.get(a);d(void 0!==c);var e=
b.id;d(!c.has(e),"Model/Stage already contains object to be added");c.set(e,b);0===a&&this.notifyDirty(b,"layerAdded")};b.prototype.remove=function(a,b){var c=this._content.get(a);d(void 0!==c);var e=c.get(b);d(void 0!==e,"Model/Stage doesn't contain object to be removed");c.delete(b);4===a&&e.unload();0===a&&this.notifyDirty(e,"layerRemoved");return e};b.prototype.getDirtySet=function(){return this.dirtySet};b.prototype.notifyDirty=function(a,b,c){this.dirtySet.handleUpdate(a,b,c)};b.prototype.getOrigin=
function(b,c,d){void 0===d&&(d=10);var e=0;c=c*d/1E4;1<c&&(e=Math.ceil(a(c,2)));c=1E4*Math.pow(2,e);d=Math.round(b[0]/c);var f=Math.round(b[1]/c);b=Math.round(b[2]/c);var e=e+"_"+d+"_"+f+"_"+b,h=this._id2origin[e];null==h&&(h=g.fromValues(d*c,f*c,b*c,e),this._id2origin[e]=h);return h};b.prototype.getGeometryRenderGeometries=function(a,b,c){var d=b.geometry,e=a.getCombinedStaticTransformation(b),f=k.maxScale(e),g=b.origin;a=new l(d.data,d.boundingInfo,b.material,e,b.shaderTransformation,f,a.castShadow);
a.uniqueName=b.id;a.origin=g||this.getOrigin(a.center,a.bsRadius);a.instanceParameters=b.instanceParameters;c.push(a)};b.prototype.updateRenderGeometryTransformation=function(a,b,c){a=a.getCombinedStaticTransformation(b,c.transformation);c.updateTransformation(a);a=this.getOrigin(c.center,c.bsRadius);return c.origin!==a};b.prototype.formatDebugInfo=function(a){var b=[];if(a){b[0]="\x3ctable\x3e";for(var c=0,d=e.allModelContentTypes;c<d.length;c++)a=d[c],b[0]+="\x3ctr\x3e\x3ctd\x3e"+a+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+
this.getAll(a).size+"\x3c/td\x3e\x3c/tr\x3e";b[0]+="\x3c/table\x3e";b[1]=this.dirtySet.formatDebugInfo(!0)}else{b[0]="";c=0;for(d=e.allModelContentTypes;c<d.length;c++)a=d[c],b[0]+=m.padStart(String(this.getAll(a).size),6," ")+" "+a+", ";b[1]=this.dirtySet.formatDebugInfo(!1)}return b};b.prototype.validateObject=function(a){a=a.geometryRecords;for(var b=0;b<a.length;++b){var c=a[b];d(null!=this.get(2,c.geometry.id));d(null!=this.get(3,c.material.id))}};b.prototype.validateLayer=function(a){a=a.getObjects();
for(var b=0;b<a.length;++b){var c=this.get(1,a[b].id);d(null!=c)}};return b}();b.Model=n})},"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.allModelContentTypes=[0,1,2,3,4];b.modelContentTypes={LAYER:0,OBJECT:1,GEOMETRY:2,MATERIAL:3,TEXTURE:4}})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define(["require","exports","../../../../core/arrayUtils","../../../../core/MapUtils","./Util"],
function(n,b,m,k,g){return function(){function b(b){this._residentGeomRecords=new Map;this._dirtyGeomRecords=new Map;this._model=b}Object.defineProperty(b.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"residentObjectCount",{get:function(){var b=0;this._residentGeomRecords.forEach(function(e){b+=e.size});return b},enumerable:!0,configurable:!0});b.prototype.hasDirtyGeometryRecords=function(){return k.someMap(this._dirtyGeomRecords,
function(b){return k.someMap(b,function(b){return b&&0<b.size})})};b.prototype.handleUpdate=function(b,e,h){g.assert(this[e],"ModelDirtySet doesn't know how to process "+e);return this[e](b,h)};b.prototype.shaderTransformationChanged=function(b){var e=this;(b=this._residentGeomRecords.get(b.id))&&b.forEach(function(b,d){(d=e._model.get(1,d))&&d.hasVolativeTransformation()&&b.forEach(function(a){var b=0;for(a=a[1];b<a.length;b++)a[b].shaderTransformationChanged()})})};b.prototype.commit=function(){return this.commitLayers(m.keysOfMap(this._dirtyGeomRecords))};
b.prototype.commitLayers=function(b){for(var e=this,f=[],d=[],a=[],c=function(c){var h=b[c];c=k._dirtyGeomRecords.get(h);if(!c)return"continue";c.forEach(function(b,c){var l=e._ensureGeomRecord(h,c);b.forEach(function(b,h){var k=b[0],m=b[1];b=b[2];var n=!1;if(m&2){var p=l.get(h);if(p){p=p[1];if(b&4)for(var r=e._model.get(1,c),q=0;q<p.length;q++){var u=p[q];if(e._model.updateRenderGeometryTransformation(r,k,u)){n=!0;break}}if(!n)for(r=0;r<p.length;r++)u=p[r],a.push({renderGeometry:u,updateType:b})}else g.assert(!1,
"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(m&4||n)(p=l.get(h))?d.push.apply(d,p[1]):4===m&&g.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),p&&l.delete(h);if(m&1||n)m=[k,[]],r=e._model.get(1,c),e._model.getGeometryRenderGeometries(r,k,m[1]),f.push.apply(f,m[1]),l.set(h,m)});0===l.size&&e._residentGeomRecords.get(h).delete(c)});0===k._residentGeomRecords.get(h).size&&k._residentGeomRecords.delete(h);k._dirtyGeomRecords.delete(h)},k=this,m=0;m<
b.length;m++)c(m);return[f,d,a]};b.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(m.keysOfMap(this._residentGeomRecords))};b.prototype.getResidentRenderGeometriesFilteredByLayers=function(b){for(var e=[],f=0;f<b.length;f++){var d=this._residentGeomRecords.get(b[f]);d&&d.forEach(function(a){a.forEach(function(a){e.push.apply(e,a[1])})})}return e};b.prototype._objectStateChanged=function(b,e,g,d){if(null!=g)this._componentPropertyChanged(e,g,
d,b);else{g=0;for(var a=e.geometryRecords;g<a.length;g++)this._componentPropertyChanged(e,a[g],d,b)}};b.prototype.visibilityChanged=function(b,e,g){this._objectStateChanged(1,b,e,g)};b.prototype.highlightChanged=function(b,e,g){this._objectStateChanged(8,b,e,g)};b.prototype.occlusionChanged=function(b,e,g){this._objectStateChanged(16,b,e,g)};b.prototype.vertexAttrsUpdated=function(b,e,g){this._updateOrCreateDirtyRecord(b,e,g,2,0,0,2,5,2)};b.prototype.layerAdded=function(b){for(var e=b.getObjects(),
f=0;f<e.length;f++)this.layerObjectAdded(b,e[f])};b.prototype.layerRemoved=function(b){for(var e=b.getObjects(),f=0;f<e.length;f++)this.layerObjectRemoved(b,e[f])};b.prototype.layerObjectAdded=function(b,e){b=b.id;for(var f=e.geometryRecords,d=0;d<f.length;d++)this.objGeometryAdded(e,f[d],b)};b.prototype.layerObjectRemoved=function(b,e){b=b.id;for(var f=e.geometryRecords,d=0;d<f.length;d++)this.objGeometryRemoved(e,f[d],b)};b.prototype.layObjectReplaced=function(b,e){this.layerObjectRemoved(b,e[0]);
this.layerObjectAdded(b,e[1])};b.prototype.objTransformation=function(b,e){var f=this;e=e||this._getParentLayerId(b);this._ensureGeomRecord(e,b.id).forEach(function(d){f._updateOrCreateDirtyRecord(b,d[0],e,2,0,0,2,5,4)})};b.prototype.objGeometryAdded=function(b,e,g){this._updateOrCreateDirtyRecord(b,e,g,1,4,0,0,0)};b.prototype.objGeometryRemoved=function(b,e,g){this._updateOrCreateDirtyRecord(b,e,g,4,1,2,0,0)};b.prototype.objGeometryReplaced=function(b,e){this.objGeometryRemoved(b,e[0]);this.objGeometryAdded(b,
e[1])};b.prototype.objGeometryTransformation=function(b,e){this.objGeometryReplaced(b,e)};b.prototype._componentPropertyChanged=function(b,e,g,d){this._updateOrCreateDirtyRecord(b,e,g,2,0,0,2,5,d)};b.prototype._updateOrCreateDirtyRecord=function(b,e,h,d,a,c,k,m,n){h=h||this._getParentLayerId(b);var f=e.id;b=this._ensureDirtyRecord(h,b.id);(h=b.get(f))?(e=h[1],e&a?b.delete(f):e&c?(h[1]=d,h[2]=n):e&k?h[2]|=n:e&m||g.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):b.set(f,[e,d,n])};b.prototype._ensureGeomRecord=
function(b,e){var f=this._residentGeomRecords.get(b);f||(f=new Map,this._residentGeomRecords.set(b,f));b=f.get(e);b||(b=new Map,f.set(e,b));return b};b.prototype._ensureDirtyRecord=function(b,e){var f=this._dirtyGeomRecords.get(b);f||(f=new Map,this._dirtyGeomRecords.set(b,f));b=f.get(e);b||(b=new Map,f.set(e,b));return b};b.prototype._getParentLayerId=function(b){return b.parentLayer.id};b.prototype.formatDebugInfo=function(b){if(b)return"";var e=["ADD","UPD",void 0,"REM"],f="";this._dirtyGeomRecords.forEach(function(b,
a){b.forEach(function(b,d){0<f.length&&(f+="\n");f+=a+"."+d;var c=[];b.forEach(function(a){var b=a[1];c[b]||(c[b]=[]);c[b].push(a[0].geometry.id)});for(b=0;b<c.length;b++)if(c[b])for(f+=" "+e[b-1]+": ",d=0;d<c[b].length;d++)f+=c[b][d]+", "})});return f};return b}()})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../core/Accessor ../../../../core/Collection ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/now ../../../../core/scheduling ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../layers/support/timeUtils ../../support/animationUtils ../collections/Component/interface ../core/renderPasses/RenderPassManager ../core/shaderTechnique/CommonUniformStore ../core/shaderTechnique/ShaderTechniqueRepository ../lib/AutoDisposable ../lib/Camera ../lib/CompositingHelper ../lib/GLMaterialRep ../lib/Renderer ../lib/TextureRepository ../lib/tracer ../materials/lineStippleUtils ./ScreenshotManager ../../../webgl/context-util ../../../webgl/RenderingContext".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L,O,K){Object.defineProperty(b,"__esModule",{value:!0});var N=c.getLogger("esri.views.3d.webgl-engine.parts.View");n=function(b){function c(a,c,e){var f=b.call(this)||this;f._stage=c;f.events=new d;f.updateLogicClients=new h;f._camera=new C.default(r.vec3f64.fromValues(0,100,-100));f._stippleTextureRepository=new I.StippleTextureRepository;f._commonUniformStore=new y.CommonUniformStore;f._componentObjectCollection=null;f._needsUpdate=
!0;f._needsRender=!0;f._idleSuspend=!0;f._logicUpdateLast=0;f._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,renderTimeTotal:0,renderTimeLast:0,frameCount:0};f._container=a;f._initializeContext(e);f._shaderTechniqueRepository=new A.ShaderTechniqueRepository({rctx:f._rctx,viewingMode:"local"===e.viewingMode?1:0,commonUniformStore:f._commonUniformStore,stippleTextureRepository:f._stippleTextureRepository});f._textureRepository=new H.TextureRepository(f._stage.getAll(4),f._shaderTechniqueRepository,
f._rctx);f._textureRepository.events.on("changed",function(a){return f.setNeedsRender(a.requestType)});f._materialRepository=new E(f._textureRepository,f._shaderTechniqueRepository,function(){return f.setNeedsRender()});f._compositingHelper=new F.default(f._rctx,f._shaderTechniqueRepository);f._initializeViewportCamera();f._renderer=new G(f._materialRepository,f._textureRepository,f._shaderTechniqueRepository,f._rctx,f._compositingHelper,function(a){void 0===a&&(a=1);return f.setNeedsRender(a)},f._stage);
f.updateLogicClients.add(f._renderer);f._screenshotManager=new L.ScreenshotManager(f._rctx,function(a,b,c){return f._render(a,b,c)},function(){return f.setNeedsRender()},e.screenshot.renderOverlay,function(a){return f.events.emit("force-camera-for-screenshot",a)});f._renderPassManager=new z.RenderPassManager(f,f._rctx,f._shaderTechniqueRepository);f.renderPlugins.add(f._renderPassManager.slots(),f._renderPassManager);f._registerFrameTask();return f}k(c,b);c.prototype.dispose=function(){this._container.contains(this._canvas)&&
this._container.removeChild(this._canvas);this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this.inherited(arguments)};c.prototype.getCombinedStats=function(){var a=this._rctx.gl,b={};b.scene=this._renderer.getStats();b.renderGeometriesTotal=this._stats.renderGeometriesTotal;b.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==a.getUsedTextureMemory&&(b.textureMemory=a.getUsedTextureMemory());void 0!==a.getUsedRenderbufferMemory&&(b.renderbufferMemory=a.getUsedRenderbufferMemory());
void 0!==a.getUsedVBOMemory&&(b.VBOMemory=a.getUsedVBOMemory());if(void 0!==a.getUsedTextureMemoryStats){var a=a.getUsedTextureMemoryStats(),c;for(c in a)b["texMem type: "+c]=a[c]}return b};c.prototype.setNeedsRender=function(a){void 0===a&&(a=1);1===a?this._needsUpdate||(this._needsUpdate=!0,this.notifyChange("updating")):this._needsRender=!0};Object.defineProperty(c.prototype,"canRender",{get:function(){var a=this._camera;return 0<a.fullWidth&&0<a.fullHeight&&this._renderer.canRender},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"needsUpdate",{get:function(){return this._needsUpdate},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"updating",{get:function(){return this.needsUpdate||this._renderer.updating||0<this._textureRepository.loadingCount||this._stage.dirty},enumerable:!0,configurable:!0});c.prototype.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};Object.defineProperty(c.prototype,"edgeView",{get:function(){return this._renderer.edgeView},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"textureRepository",{get:function(){return this._textureRepository},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"compositingHelper",{get:function(){return this._compositingHelper},enumerable:!0,configurable:!0});c.prototype.setRenderParameters=function(a){this.setNeedsRender();void 0!==a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);void 0!==a.shadowMap&&(this._renderPassManager.shadowCastingEnabled=a.shadowMap);
this._renderer.setRenderParams(a)};c.prototype.getRenderParameters=function(){var a=this._renderer.getRenderParams();a.anisotropicFiltering=this._rctx.parameters.maxMaxAnisotropy;a.idleSuspend=this._idleSuspend;return a};Object.defineProperty(c.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0});c.prototype.has=function(a){return"s3tc"===a?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===a?!!this._rctx.capabilities.shaderTextureLOD:!1};
c.prototype.modify=function(a,b,c){this._renderer.modify(a,a.length,b,b.length,c,c.length)};c.prototype.setCamera=function(a){this._camera.copyFrom(a);this.setNeedsRender()};c.prototype.getCamera=function(){return this._camera};c.prototype.getCanvas=function(){return this._canvas};c.prototype.takeScreenshot=function(a){return this._screenshotManager.takeScreenshot(a)};Object.defineProperty(c.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"test",{get:function(){return{renderer:this._renderer}},enumerable:!0,configurable:!0});c.prototype.getGpuMemoryUsage=function(){return this._renderer.getGpuMemoryUsage()};c.prototype.hotReloadShaders=function(){return e(this,void 0,void 0,function(){return f(this,function(a){switch(a.label){case 0:return[4,this._shaderTechniqueRepository.hotReload()];case 1:return a.sent(),this.setNeedsRender(),[2]}})})};c.prototype._registerFrameTask=function(){var a=this,b={viewCamera:this._camera,
frameHasSlicePlane:!1};this._frameTask=t.addFrameTask({preRender:function(b){D.begin();var c=!1;a._stage.processDirty();var d=x.Milliseconds(b.time-a._logicUpdateLast);if(d>w.DESIRED_ANIMATION_MS){var e={camera:a._stage.getCamera(),dt:d};a.updateLogicClients.forEach(function(a){a.updateLogic(e)&&(c=!0)});a._logicUpdateLast=b.time}c&&a.setNeedsRender(0)},render:function(){(a.needsUpdate||a._needsRender||!a._idleSuspend)&&a.canRender&&(a._needsRender=!1,a._needsUpdate=!1,a._render(null,a._camera,!1))},
postRender:function(){a.notifyChange("updating");D.end()},update:function(){b.viewCamera=a._camera;b.frameHasSlicePlane=a._renderer.hasSlicePlane;a._textureRepository.update();a._screenshotManager.update(b)}})};c.prototype._initializeViewportCamera=function(){var a=this._container.getBoundingClientRect(),b=this.getCamera();b.viewport[2]=a.width;b.viewport[3]=a.height;this.setCamera(b)};c.prototype._initializeContext=function(b){this._canvas=b.canvas;this._canvas||(this._canvas=document.createElement("canvas"));
this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var c=D.instrumentContext(O.createContextOrErrorHTML(this._canvas,{alpha:b.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==b.stencil?!0:b.stencil,powerPreference:"high-performance"},b.renderContext));this._rctx=new K(c,{disabledExtensions:b.deactivatedWebGLExtensions||{},debugWebGLExtensions:b.debugWebGLExtensions||{}});null!=this._rctx.parameters.maxMaxAnisotropy&&(this._rctx.parameters.maxMaxAnisotropy=
Math.min(this._rctx.parameters.maxMaxAnisotropy,8));this._loadShaderOnlyExtensions(this._rctx);!b.alpha&&this._rctx.contextAttributes.alpha&&N.error("WebGL context has alpha channel even though no alpha channel was requested");!this._rctx.contextAttributes.alpha&&11<=a("safari")&&(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas)};c.prototype._render=function(a,b,c){this._renderer.setLighting(this._stage.lighting);this._rctx.bindFramebuffer(a);b.setGLViewport(this._rctx);
this._renderer.render({fbo:a,camera:b,disableSlice:c,lightDirection:this._stage.mainLightDirection})};c.prototype._loadShaderOnlyExtensions=function(a){a=a.capabilities;a.standardDerivatives;a.shaderTextureLOD};Object.defineProperty(c.prototype,"componentObjectCollection",{get:function(){q.isNone(this._componentObjectCollection)&&(this._componentObjectCollection=v.createComponentObjectCollection(this._renderPassManager));return this._componentObjectCollection},enumerable:!0,configurable:!0});g([u.property({type:Boolean,
readOnly:!0})],c.prototype,"updating",null);g([B.autoDispose()],c.prototype,"_rctx",void 0);g([B.autoDispose()],c.prototype,"_container",void 0);g([B.autoDispose()],c.prototype,"_canvas",void 0);g([B.autoDispose()],c.prototype,"_stippleTextureRepository",void 0);g([B.autoDispose()],c.prototype,"_textureRepository",void 0);g([B.autoDispose()],c.prototype,"_commonUniformStore",void 0);g([B.autoDispose()],c.prototype,"_compositingHelper",void 0);g([B.autoDispose()],c.prototype,"_renderer",void 0);g([B.autoDispose()],
c.prototype,"_screenshotManager",void 0);g([B.autoDispose()],c.prototype,"componentObjectCollection",null);g([B.autoDispose()],c.prototype,"_componentObjectCollection",void 0);return c=g([u.subclass("esri.views.3d.webgl-engine.parts.RenderView")],c)}(u.declared(B.AutoDisposableMixin(l)));b.RenderView=n})},"esri/views/3d/webgl-engine/collections/Component/interface":function(){define(["require","exports","./ComponentObjectCollection"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});
b.createComponentObjectCollection=function(b){return new m.ComponentObjectCollection(b)};b.isVaryingComponentParameters=function(b){return"function"===typeof b}})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/typedArrayUtil ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../../geometry/support/aaBoundingBox ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/BufferView ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./interface ./RenderSubmitSystem ./SourceGeometry ./IndexRange/ComponentRangeRunLengthEncoded ./Material/ComponentMaterial ./Material/ComponentTechnique ../../core/util/BucketedObjectStore ../../core/util/TwoVectorPosition ../../lib/AutoDisposable ../../lib/ComponentUtils ../../lib/geometryDataUtils ../../lib/Util ../../lib/TextureBackedBuffer/BufferManager ../../materials/internal/MaterialUtil ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L,O,K,N,Q){function M(a,b,c){var d=[],e=c.length;b.forEachComponent(function(b){0<a[b]&&(e!==b-1&&(d.length&&d.push(c[e+1]-d[d.length-1]),d.push(c[b])),e=b);return!0});d.length&&d.push(c[e+1]-d[d.length-1]);return d}Object.defineProperty(b,"__esModule",{value:!0});var T=e.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");n=function(){function b(a){this._renderManager=a;this._objects=new E.BucketedObjectStore;
this._renderSubmit=new y.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);this._componentBufferManager=new O.BufferManager(a.rctx)}b.prototype.dispose=function(){L.assert(0===this.count,"ObjectCollection should be empty upon disposal")};b.prototype.createObject=function(a){var b=new Y;b.toMapSpace=a.toMapSpace.slice();b.transform=a.transform;b.obb=r.clone(a.obb);b.components=new P(this._componentBufferManager,a.geometry.componentOffsets);b.renderable=this._createRenderable(a,
b.components);b.intersectionGeometry=new S(a.geometry.positionData,b.components);this._objects.add(a.visible?ba:0,b);return b};b.prototype.destroyObject=function(a){this._objects.remove(a);a.dispose();this._notifyDirty()};b.prototype.setObjectVisibility=function(a,b){b!==a.visible&&(this._objects.updateKey(a,b?a.bucketKey|ba:a.bucketKey&~ba),this._notifyDirty())};Object.defineProperty(b.prototype,"count",{get:function(){return this._objects.count},enumerable:!0,configurable:!0});b.prototype.preSubmit=
function(b){var c=b.camera.eye;this._objects.forEach(function(b,d){d&ba&&b.forEach(function(b){var d=a.vec3.squaredDistance(c,b.obb.center);b.renderable.meta.cameraDepthSquared=d})})};b.prototype.updateMaterial=function(a,b){a=a.renderable.material;b(a);a.dirty&&this._notifyDirty()};b.prototype.setAllComponentVisibilities=function(a,b){a.components.visibility.reset(b);a.components.visibilityDirty();this._notifyDirty()};b.prototype.forEachVisibleComponent=function(a,b){return a.components.visibility.forEachComponent(b)};
b.prototype.getComponentCount=function(a){var b=a.components.visibility.componentCount();return{visible:b,invisible:a.components.count-b}};b.prototype.setComponentData=function(a,b){var c=a.renderable.material;if(z.isVaryingComponentParameters(b)){a=a.components;for(var d=a.materialDataBuffer,e=a.materialDataIndices,f={castShadows:!0,pickable:!0,externalColor:p.vec4f32.create(),externalColorMixMode:1},d=d.textureBuffer,g=new Uint8Array(4),h=new Uint32Array(g.buffer),l=0,k=0,m=0,n=0,r=!1,q=0,t=0;t<
a.count;t++)b(t,f),l+=+(1>f.externalColor[3]),k+=+(3===f.externalColorMixMode&&1===f.externalColor[3]),m+=+(0<f.externalColor[3]),n+=+f.castShadows,u.encodeSymbolColor(f.externalColor,f.externalColorMixMode,g),g[2]=g[2]&254|+f.castShadows,d.setData(e[t],0,g[0],g[1],g[2],g[3]),r=r||0<t&&q!==h[0],q=h[0],f.pickable!==D.getVisibility(a.pickability,t)&&(a.pickability=D.updateVisibilityWithCount(a.pickability,a.count,t,f.pickable));r?(c.componentParameters=new C.ComponentParametersVarying,c.componentParameters.castShadows=
n===a.count?0:0===n?2:1,c.componentParameters.transparent=l===a.count?0:0===l?2:1,c.componentParameters.opaqueOverride=k===a.count?0:0===k?2:1,c.componentParameters.visible=m===a.count?0:0===m?2:1,c.componentParameters.texture=d,d.updateTexture()):(c.componentParameters=new C.ComponentParametersUniform,c.componentParameters.castShadows=f.castShadows?0:2,c.componentParameters.externalColor=f.externalColor,c.componentParameters.externalColorMixMode=f.externalColorMixMode)}else c.componentParameters=
new C.ComponentParametersUniform,c.componentParameters.castShadows=b.castShadows?0:2,c.componentParameters.externalColor=b.externalColor,c.componentParameters.externalColorMixMode=b.externalColorMixMode;this._notifyDirty()};b.prototype.getComponentAABB=function(a,b,c){return a.intersectionGeometry.getComponentAABB(b,c)};b.prototype.getObjectTransform=function(a){return a.transform};b.prototype.getComponentPositions=function(a,b,c){return a.intersectionGeometry.getComponentPositions(b,c)};b.prototype.intersect=
function(b,c,d,e,g,l){f.isSome(g)&&(g.localOrigin=b.transform.position);var k=h.mat3.invert(X,b.transform.rotationScale);a.vec3.sub(aa,c,b.transform.position);a.vec3.sub(da,d,b.transform.position);a.vec3.transformMat3(aa,aa,k);a.vec3.transformMat3(da,da,k);c=h.mat3.transpose(X,k);return b.intersectionGeometry.intersect(aa,da,e,c,g,l)};b.prototype.addEdges=function(a,b,c,d){var e=a.intersectionGeometry;return b.addComponentObject(a,a.transform,a.obb.center,e.positions,e.indices,a.components.offsets,
c,d)};b.prototype.addComponentHighlight=function(a,b){a=a.components;f.isNone(a.highlightCounts)&&(a.highlightCounts=new Uint32Array(a.count+1));0===a.highlightCounts[b]++&&(a.highlightsDirty(),this._notifyDirty());a.highlightCounts[a.count]++};b.prototype.removeComponentHighlight=function(a,b){a=a.components;if(f.isNone(a.highlightCounts))T.warn("Removing non-existing highlight.");else{var c=a.highlightCounts[b],d=a.highlightCounts[a.count];0===c?T.warn("Removing non-existing highlight."):1<c?(a.highlightCounts[b]=
c-1,a.highlightCounts[a.count]=d-1):(a.highlightCounts[b]=0,a.highlightsDirty(),this._notifyDirty(),1===d?a.highlightCounts=null:a.highlightCounts[a.count]=d-1)}};b.prototype.clearHighlights=function(a){a=a.components;f.isSome(a.highlightCounts)&&(a.highlightCounts=null,a.highlightsDirty(),this._notifyDirty())};b.prototype.getObjectMemoryUsageGPU=function(a){return a.renderable.meta.gpuMemoryEstimate};Object.defineProperty(b.prototype,"visibleObjects",{get:function(){return this._objects.getBucket(ba)},
enumerable:!0,configurable:!0});b.prototype._createRenderable=function(b,c){for(var e=this._renderManager.rctx,g=b.geometry,l=g.vertices.layoutParameters,k=N.createVertex(e,35044,g.vertices.data),m=f.applySome(g.indices,function(a){return N.createIndex(e,35044,a)}),n=w.glLayout(A.createVertexBufferLayout(l)),p=new Uint16Array(g.vertices.count),r=0;r<c.count;r++){var u=c.offsets[r],t=c.offsets[r+1],v=c.materialDataIndices[r];if(f.isSome(g.indices))for(;u<t;u++)p[g.indices[u]]=v;else for(;u<t;u++)p[u]=
v}c=N.createVertex(e,35044,p.buffer);r=new G.TwoVectorPosition(b.transform.position);t=d.mat3f32.clone(b.transform.rotationScale);h.mat3.invert(t,t);h.mat3.transpose(t,t);p=new F.ComponentDrawParameters;a.vec3.copy(p.worldFromModel_TL,r.low);a.vec3.copy(p.worldFromModel_TH,r.high);h.mat3.copy(p.worldFromModel_RS,b.transform.rotationScale);h.mat3.copy(p.transformNormal_GlobalFromModel,t);q.vec4.copy(p.toMapSpace,b.toMapSpace);b=new C.ComponentMaterial;n=new Q(e,b.attributeLocations,{data:n,componentIndices:U},
{data:k,componentIndices:c},f.unwrap(m));r=new J;r.material=b;r.drawParameters=p;r.geometry=new V(n,g.primitiveType,l,f.isSome(m));r.meta.cameraDepthSquared=.5;r.meta.gpuMemoryEstimate=k.byteSize+c.byteSize+(f.isSome(m)?m.byteSize:0);return r};b.prototype._notifyDirty=function(){this._renderManager.notifyDirty()};return b}();b.ComponentObjectCollection=n;var P=function(a){function b(b,c){var d=a.call(this)||this;d.pickability=null;d.highlightCounts=null;d.cachedGeometryRanges=null;d.cachedHighlightRanges=
null;d.offsets=l.slice(c);c=d.count;d.visibility=new B.ComponentRangeRunLengthEncoded(c);d.materialDataBuffer=b.getBuffer(c);d.materialDataIndices=new Uint16Array(c);for(b=0;b<c;b++)d.materialDataIndices[b]=d.materialDataBuffer.acquireIndex();return d}k(b,a);b.prototype.dispose=function(){a.prototype.dispose.call(this);for(var b=0;b<this.count;b++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[b])};Object.defineProperty(b.prototype,"count",{get:function(){return this.offsets.length-
1},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"geometryRanges",{get:function(){f.isNone(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"highlightRanges",{get:function(){if(f.isNone(this.highlightCounts))return null;f.isNone(this.cachedHighlightRanges)&&(this.cachedHighlightRanges=M(this.highlightCounts,this.visibility,
this.offsets));return this.cachedHighlightRanges},enumerable:!0,configurable:!0});b.prototype.highlightsDirty=function(){this.cachedHighlightRanges=null};b.prototype.visibilityDirty=function(){this.cachedHighlightRanges=this.cachedGeometryRanges=null};return b}(H.AutoDisposable),S=function(){function b(a,b){this._indices=f.isSome(a.indices)?a.indices:I.generateDefaultIndexArray(a.positions.length/3);this._positions=new x.BufferViewVec3f(a.positions);this._components=b}b.prototype.getComponentAABB=
function(a,b){if(f.isSome(this._perComponentAABBs)){for(var c=0;6>c;c++)b[c]=this._perComponentAABBs[6*a+c];return b}this._computePerComponentAABBs();return this.getComponentAABB(a,b)};b.prototype.getComponentPositions=function(a,b){b.indices=this._indices;b.data=this._positions.typedBuffer;b.stride=this._positions.typedBufferStride;b.startIndex=this._components.offsets[a];b.endIndex=this._components.offsets[a+1]};b.prototype.intersect=function(b,c,d,e,g,h){var l=this,k={data:this._positions.typedBuffer,
strideIdx:this._positions.typedBufferStride,offsetIdx:0,size:3},m=this._indices,n=this._components.offsets,p=K.computeInvDir(b,c,R);this._components.visibility.forEachComponent(function(r){if(!D.getVisibility(l._components.pickability,r))return!0;var q=l.getComponentAABB(r,ca);f.isSome(g)&&g.applyToAABB(q);if(!K.intersectAabbInvDir(q,b,p,d))return!0;K.intersectTriangles(b,c,n[r]/3,n[r+1]/3,m,k,void 0,g,function(b,c,d){return h(r,b,a.vec3.transformMat3(c,c,e),d)});return!0})};b.prototype._computePerComponentAABBs=
function(){var a=this._components.count;this._perComponentAABBs=new Float32Array(6*a);for(var b=0;b<a;b++)this._computeAABB(b)};b.prototype._computeAABB=function(b){for(var c=this._indices,d=this._positions,e=this._components.offsets,f=e[b+1],g=[0,0,0],h=[Infinity,Infinity,Infinity],l=[-Infinity,-Infinity,-Infinity],e=e[b];e<f;e++)d.getVec(c[e],g),a.vec3.min(h,h,g),a.vec3.max(l,l,g);b*=6;this._perComponentAABBs[b++]=h[0];this._perComponentAABBs[b++]=h[1];this._perComponentAABBs[b++]=h[2];this._perComponentAABBs[b++]=
l[0];this._perComponentAABBs[b++]=l[1];this._perComponentAABBs[b]=l[2]};Object.defineProperty(b.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});return b}(),V=function(a){function b(b,c,d,e){var f=a.call(this)||this;f.vao=b;f.primitiveType=c;f.parameters=d;f.indexed=e;return f}k(b,a);g([H.autoDispose()],b.prototype,"vao",void 0);return b}(H.AutoDisposable);
b.RenderGeometry=V;var J=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.meta={cameraDepthSquared:0,gpuMemoryEstimate:0};return b}k(b,a);g([H.autoDispose()],b.prototype,"geometry",void 0);return b}(H.AutoDisposable);b.Renderable=J;var U=w.glLayout(v.newLayout().u16("componentIndex")),Y=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}k(b,a);Object.defineProperty(b.prototype,"visible",{get:function(){return!!(this.bucketKey&ba)},enumerable:!0,configurable:!0});
g([H.autoDispose()],b.prototype,"renderable",void 0);g([H.autoDispose()],b.prototype,"components",void 0);return b}(E.BucketStorable);b.ComponentObject=Y;var X=d.mat3f32.create(),R=c.vec3f64.create(),aa=c.vec3f64.create(),da=c.vec3f64.create(),ca=t.create(),ba=1})},"esri/views/3d/support/orientedBoundingBox":function(){define("require exports ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf32 ../../../core/libs/gl-matrix-2/quatf64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ./dito ./geometryUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t){function u(a,b,c){return{center:d.vec3f64.clone(a),halfSize:h.vec3f32.clone(b),quaternion:e.quatf32.clone(c)}}function r(a,b){var c=t.plane.signedDistance(b,a.center);a=x(a,b);return c>a?1:c<-a?-1:0}function x(a,b){g.quat.conjugate(w,a.quaternion);l.vec3.transformQuat(v,b,w);a=a.halfSize;return Math.abs(v[0]*a[0])+Math.abs(v[1]*a[1])+Math.abs(v[2]*a[2])}Object.defineProperty(b,"__esModule",{value:!0});var w=f.quatf64.create(),v=d.vec3f64.create(),z=d.vec3f64.create(),
y=c.vec4f64.create(),A=k.mat3f64.create();n=function(){return function(a){this.buffer=new ArrayBuffer(56*a);this.obbs=Array(a);for(var b=0;b<a;b++)this.obbs[b]={center:d.vec3f64.createView(this.buffer,56*b+0),halfSize:h.vec3f32.createView(this.buffer,56*b+24),quaternion:e.quatf32.createView(this.buffer,56*b+36)}}}();b.ObbArray=n;b.create=u;b.clone=function(a){return u(a.center,a.halfSize,a.quaternion)};b.set=function(a,b){l.vec3.copy(b.center,a.center);l.vec3.copy(b.halfSize,a.halfSize);g.quat.copy(b.quaternion,
a.quaternion)};b.compute=function(a,b){b||(b=u([0,0,0],[-1,-1,-1],[0,0,0,1]));p.computeOBB(a,b);return b};b.intersectPlane=r;b.toAaBoundingBox=function(a,b){b||(b=q.create());var c=m.mat3.fromQuat(A,a.quaternion),d=a.halfSize[0]*Math.abs(c[0])+a.halfSize[1]*Math.abs(c[3])+a.halfSize[2]*Math.abs(c[6]),e=a.halfSize[0]*Math.abs(c[1])+a.halfSize[1]*Math.abs(c[4])+a.halfSize[2]*Math.abs(c[7]),c=a.halfSize[0]*Math.abs(c[2])+a.halfSize[1]*Math.abs(c[5])+a.halfSize[2]*Math.abs(c[8]);b[0]=a.center[0]-d;b[1]=
a.center[1]-e;b[2]=a.center[2]-c;b[3]=a.center[0]+d;b[4]=a.center[1]+e;b[5]=a.center[2]+c;return b};b.minimumDistancePlane=function(a,b){var c=t.plane.signedDistance(b,a.center);a=x(a,b);return c-a};b.maximumDistancePlane=function(a,b){var c=t.plane.signedDistance(b,a.center);a=x(a,b);return c+a};b.isVisible=function(a,b){return 0>=r(a,b.planes[0])&&0>=r(a,b.planes[1])&&0>=r(a,b.planes[2])&&0>=r(a,b.planes[3])&&0>=r(a,b.planes[4])&&0>=r(a,b.planes[5])};b.intersectLine=function(a,b,c,d){void 0===d&&
(d=0);g.quat.conjugate(w,a.quaternion);l.vec3.subtract(v,b,a.center);b=l.vec3.transformQuat(v,v,w);c=l.vec3.transformQuat(z,c,w);for(var e=-Infinity,f=Infinity,h=0;3>h;h++)if(1E-6<Math.abs(c[h]))var k=(d+a.halfSize[h]-b[h])/c[h],m=(-d-a.halfSize[h]-b[h])/c[h],e=Math.max(e,Math.min(k,m)),f=Math.min(f,Math.max(k,m));else if(b[h]>a.halfSize[h]+d||b[h]<-a.halfSize[h]-d)return!1;return e<=f};b.projectedArea=function(b,c,d,e,f){g.quat.conjugate(w,b.quaternion);l.vec3.sub(v,c,b.center);l.vec3.transformQuat(v,
v,w);var h=v[0]<-b.halfSize[0]?-1:v[0]>b.halfSize[0]?1:0,k=v[1]<-b.halfSize[1]?-1:v[1]>b.halfSize[1]?1:0,n=v[2]<-b.halfSize[2]?-1:v[2]>b.halfSize[2]?1:0;c=Math.abs(h)+Math.abs(k)+Math.abs(n);if(0===c)return Infinity;c=1===c?4:6;k=6*(h+3*k+9*n+13);m.mat3.fromQuat(A,b.quaternion);m.mat3.scale(A,A,b.halfSize);for(h=0;h<c;h++)n=C[k+h],l.vec3.set(v,((n&1)<<1)-1,(n&2)-1,((n&4)>>1)-1),l.vec3.transformMat3(v,v,A),l.vec3.add(y,b.center,v),y[3]=1,a.vec4.transformMat4(y,y,d),n=1/Math.max(1E-6,y[3]),B[2*h]=y[0]*
n,B[2*h+1]=y[1]*n;b=2*c-2;d=B[0]*(B[3]-B[b+1])+B[b]*(B[1]-B[b-1]);for(h=2;h<b;h+=2)d+=B[h]*(B[h+3]-B[h-1]);return Math.abs(d)*e*f*.125};var B=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],C=function(){var a=new Int8Array(162),b=0,c=function(c){for(var d=0;d<c.length;d++)a[b+d]=c[d];b+=6};c([6,2,3,1,5,4]);c([0,2,3,1,5,4]);c([0,2,3,7,5,4]);c([0,1,3,2,6,4]);c([0,1,3,2,0,0]);c([0,1,5,7,3,2]);c([0,1,3,7,6,4]);c([0,1,3,7,6,2]);c([0,1,5,7,6,2]);c([0,1,5,4,6,2]);c([0,1,5,4,0,0]);c([0,1,3,7,5,4]);c([0,2,6,4,0,0]);
c([0,0,0,0,0,0]);c([1,3,7,5,0,0]);c([2,3,7,6,4,0]);c([2,3,7,6,0,0]);c([2,3,1,5,7,6]);c([0,1,5,7,6,2]);c([0,1,5,7,6,4]);c([0,1,3,7,6,4]);c([4,5,7,6,2,0]);c([4,5,7,6,0,0]);c([4,5,1,3,7,6]);c([0,2,3,7,5,4]);c([6,2,3,7,5,4]);c([6,2,3,1,5,4]);return a}();b.projectedRadius=x})},"esri/core/libs/gl-matrix-2/quatf32":function(){define(["require","exports","./factories/quatf32"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.quatf32=m})},"esri/core/libs/gl-matrix-2/factories/quatf32":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var b=new Float32Array(4);b[3]=1;return b};b.clone=function(b){var k=new Float32Array(4);k[0]=b[0];k[1]=b[1];k[2]=b[2];k[3]=b[3];return k};b.fromValues=function(b,k,g,e){var f=new Float32Array(4);f[0]=b;f[1]=k;f[2]=g;f[3]=e;return f};b.createView=function(b,k){return new Float32Array(b,k,4)}})},"esri/views/3d/support/dito":function(){define(["require","exports"],function(n,b){function m(a,b,d,e,f,g){if(!(1E-6>
b[0]*b[0]+b[1]*b[1]+b[2]*b[2]))for(q(G,d,b),q(H,e,b),q(D,f,b),k(a,b,E),L[1]=E[0],I[1]=E[1],O[1]=I[1]-L[1],d=[d,e,f],e=[G,H,D],f=0;3>f;++f){k(a,d[f],E);L[0]=E[0];I[0]=E[1];k(a,e[f],E);L[2]=E[0];I[2]=E[1];O[0]=I[0]-L[0];O[2]=I[2]-L[2];var h=l(O);h<g.quality&&(c(g.b0,d[f]),c(g.b1,b),c(g.b2,e[f]),g.quality=h)}}function k(a,b,c){var d=a.data,e=a.offsetIdx;a=a.strideIdx;c[0]=Number.POSITIVE_INFINITY;for(c[1]=Number.NEGATIVE_INFINITY;e<d.length;e+=a){var f=d[e]*b[0]+d[e+1]*b[1]+d[e+2]*b[2];c[0]=Math.min(c[0],
f);c[1]=Math.max(c[1],f)}}function g(b,d,e){c(e.center,b);a(e.halfSize,d,.5);e.quaternion[0]=0;e.quaternion[1]=0;e.quaternion[2]=0;e.quaternion[3]=1}function e(a,b,c,d,e,f){k(a,b,E);e[0]=E[0];f[0]=E[1];k(a,c,E);e[1]=E[0];f[1]=E[1];k(a,d,E);e[2]=E[0];f[2]=E[1]}function f(b,c,d,e,f,g,l){J[0]=b[0];J[1]=b[1];J[2]=b[2];J[3]=c[0];J[4]=c[1];J[5]=c[2];J[6]=d[0];J[7]=d[1];J[8]=d[2];var k=l.quaternion,m=J,n=m[0]+m[4]+m[8];if(0<n)n=Math.sqrt(n+1),k[3]=.5*n,n=.5/n,k[0]=(m[5]-m[7])*n,k[1]=(m[6]-m[2])*n,k[2]=(m[1]-
m[3])*n;else{var p=0;m[4]>m[0]&&(p=1);m[8]>m[3*p+p]&&(p=2);var r=(p+1)%3,q=(p+2)%3,n=Math.sqrt(m[3*p+p]-m[3*r+r]-m[3*q+q]+1);k[p]=.5*n;n=.5/n;k[3]=(m[3*r+q]-m[3*q+r])*n;k[r]=(m[3*r+p]+m[3*p+r])*n;k[q]=(m[3*q+p]+m[3*p+q])*n}h(U,e,f);a(U,U,.5);a(l.center,b,U[0]);a(V,c,U[1]);h(l.center,l.center,V);a(V,d,U[2]);h(l.center,l.center,V);a(l.halfSize,g,.5)}function l(a){return a[0]*a[1]+a[0]*a[2]+a[1]*a[2]}function h(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2]}function d(a,b,c){a[0]=b[0]-c[0];a[1]=
b[1]-c[1];a[2]=b[2]-c[2]}function a(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c}function c(a,b,c){void 0===c&&(c=0);a[0]=b[c+0];a[1]=b[c+1];a[2]=b[c+2]}function q(a,b,c){var d=b[0],e=b[1];b=b[2];var f=c[0],g=c[1];c=c[2];a[0]=e*c-b*g;a[1]=b*f-d*c;a[2]=d*g-e*f}function p(a,b){var c=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];0<c&&(c=1/Math.sqrt(c),a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c)}function t(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a}Object.defineProperty(b,"__esModule",{value:!0});var u=[0,
0,0],r=[0,0,0];b.computeOBB=function(b,k){var n=b.data.length/b.strideIdx;if(!(0>=n)){var D=new Y(b);h(u,D.minProj,D.maxProj);a(u,u,.5);d(r,D.maxProj,D.minProj);var G=l(r),H=new X;H.quality=G;14>n&&(b={data:new Float64Array(D.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var I=[0,0,0],L=[0,0,0],J=[0,0,0],n=[0,0,0],O=[0,0,0],R=[0,0,0],U=[0,0,0],V;V=b;for(var aa=t(D.maxVert[0],D.minVert[0]),ia=0,ga=1;7>ga;++ga){var ja=t(D.maxVert[ga],D.minVert[ga]);ja>aa&&(aa=ja,ia=ga)}c(I,D.minVert[ia]);c(L,D.maxVert[ia]);
if(1E-6>t(I,L))V=1;else{d(n,I,L);p(n,n);D=V.data;aa=V.strideIdx;ia=Number.NEGATIVE_INFINITY;ga=0;for(ja=V.offsetIdx;ja<D.length;ja+=aa){F[0]=D[ja]-I[0];F[1]=D[ja+1]-I[1];F[2]=D[ja+2]-I[2];var ha=n[0]*F[0]+n[1]*F[1]+n[2]*F[2],ha=F[0]*F[0]+F[1]*F[1]+F[2]*F[2]-ha*ha/(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);ha>ia&&(ia=ha,ga=ja)}c(J,D,ga);1E-6>ia?V=2:(d(O,L,J),p(O,O),d(R,J,I),p(R,R),q(U,O,n),p(U,U),m(V,U,n,O,R,H),V=0)}switch(V){case 1:g(u,r,k);return;case 2:G=b;c(N,n);Math.abs(n[0])>Math.abs(n[1])&&Math.abs(n[0])>
Math.abs(n[2])?N[0]=0:Math.abs(n[1])>Math.abs(n[2])?N[1]=0:N[2]=0;1E-6>N[0]*N[0]+N[1]*N[1]+N[2]*N[2]&&(N[0]=N[1]=N[2]=1);q(Q,n,N);p(Q,Q);q(M,n,Q);p(M,M);e(G,n,Q,M,T,P);d(S,P,T);f(n,Q,M,T,P,S,k);return}V=b;D=x;aa=w;ia=E;ga=V.data;ha=V.offsetIdx;ja=V.strideIdx;c(aa,ga,ha);c(D,aa);ia[0]=K[0]*U[0]+K[1]*U[1]+K[2]*U[2];ia[1]=ia[0];for(ha+=ja;ha<ga.length;ha+=ja){var qa=ga[ha]*U[0]+ga[ha+1]*U[1]+ga[ha+2]*U[2];qa<ia[0]&&(ia[0]=qa,c(aa,ga,ha));qa>ia[1]&&(ia[1]=qa,c(D,ga,ha))}U=I[0]*U[0]+I[1]*U[1]+I[2]*U[2];
E[1]-1E-6<=U&&(D[0]=void 0);E[0]+1E-6>=U&&(aa[0]=void 0);void 0!==x[0]&&(d(v,x,I),p(v,v),d(z,x,L),p(z,z),d(y,x,J),p(y,y),q(A,z,n),p(A,A),q(B,y,O),p(B,B),q(C,v,R),p(C,C),m(V,A,n,z,v,H),m(V,B,O,y,z,H),m(V,C,R,v,y,H));void 0!==w[0]&&(d(v,w,I),p(v,v),d(z,w,L),p(z,z),d(y,w,J),p(y,y),q(A,z,n),p(A,A),q(B,y,O),p(B,B),q(C,v,R),p(C,C),m(V,A,n,z,v,H),m(V,B,O,y,z,H),m(V,C,R,v,y,H));e(b,H.b0,H.b1,H.b2,T,P);b=[0,0,0];d(b,P,T);H.quality=l(b);H.quality<G?f(H.b0,H.b1,H.b2,T,P,b,k):g(u,r,k)}};var x=[0,0,0],w=[0,0,
0],v=[0,0,0],z=[0,0,0],y=[0,0,0],A=[0,0,0],B=[0,0,0],C=[0,0,0],F=[0,0,0],E=[0,0],G=[0,0,0],H=[0,0,0],D=[0,0,0],I=[0,0,0],L=[0,0,0],O=[0,0,0],K=[0,0,0],N=[0,0,0],Q=[0,0,0],M=[0,0,0],T=[0,0,0],P=[0,0,0],S=[0,0,0],V=[0,0,0],J=[1,0,0,0,1,0,0,0,1],U=[0,0,0],Y=function(){return function(a){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var b=0;this.minProj=new Float64Array(this.buffer,b,7);b+=56;this.maxProj=new Float64Array(this.buffer,b,7);for(var b=b+56,d=0;7>d;++d)this.minVert[d]=
new Float64Array(this.buffer,b,3),b+=24;for(d=0;7>d;++d)this.maxVert[d]=new Float64Array(this.buffer,b,3),b+=24;for(d=0;7>d;++d)this.minProj[d]=Number.POSITIVE_INFINITY,this.maxProj[d]=Number.NEGATIVE_INFINITY;for(var b=Array(7),e=Array(7),f=a.data,g=a.strideIdx,d=a.offsetIdx;d<f.length;d+=g)a=f[d],a<this.minProj[0]&&(this.minProj[0]=a,b[0]=d),a>this.maxProj[0]&&(this.maxProj[0]=a,e[0]=d),a=f[d+1],a<this.minProj[1]&&(this.minProj[1]=a,b[1]=d),a>this.maxProj[1]&&(this.maxProj[1]=a,e[1]=d),a=f[d+2],
a<this.minProj[2]&&(this.minProj[2]=a,b[2]=d),a>this.maxProj[2]&&(this.maxProj[2]=a,e[2]=d),a=f[d]+f[d+1]+f[d+2],a<this.minProj[3]&&(this.minProj[3]=a,b[3]=d),a>this.maxProj[3]&&(this.maxProj[3]=a,e[3]=d),a=f[d]+f[d+1]-f[d+2],a<this.minProj[4]&&(this.minProj[4]=a,b[4]=d),a>this.maxProj[4]&&(this.maxProj[4]=a,e[4]=d),a=f[d]-f[d+1]+f[d+2],a<this.minProj[5]&&(this.minProj[5]=a,b[5]=d),a>this.maxProj[5]&&(this.maxProj[5]=a,e[5]=d),a=f[d]-f[d+1]-f[d+2],a<this.minProj[6]&&(this.minProj[6]=a,b[6]=d),a>this.maxProj[6]&&
(this.maxProj[6]=a,e[6]=d);for(d=0;7>d;++d)a=b[d],c(this.minVert[d],f,a),a=e[d],c(this.maxVert[d],f,a)}}(),X=function(){return function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0}}()})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["require","exports","./DepthRange"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this._objects=b}b.prototype.submit=function(b,e){this._objects.preSubmit(e);
e=this._objects.visibleObjects;for(var f=0;f<e.length;f++){var g=e[f];g.renderable.material.submit(b,g)}};b.prototype.queryShadowCasterDepthRange=function(b){return this._objects.visibleObjects.length?m.computeDepthRange(b,this._objects.visibleObjects):null};return b}();b.RenderSubmitSystem=n})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("require exports ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/quat ../../../../../core/libs/gl-matrix-2/quatf64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/orientedBoundingBox ../../../support/geometryUtils/plane ../../lib/depthRange".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){function q(a,b,c){return l.vec3.set(a,b.data[c+0],b.data[c+1],b.data[c+2])}function p(a,b){a.push(b[0]);a.push(b[1]);a.push(b[2])}function t(a,b,c,d){e.quat.conjugate(F,a.quaternion);l.vec3.sub(E,b,a.center);l.vec3.transformQuat(E,E,F);var f=8*((E[0]<-a.halfSize[0]?-1:E[0]>a.halfSize[0]?1:0)+3*(E[1]<-a.halfSize[1]?-1:E[1]>a.halfSize[1]?1:0)+9*(E[2]<-a.halfSize[2]?-1:E[2]>a.halfSize[2]?1:0)+13);b=A[f];if(0===b)return b;k.mat3.fromQuat(C,a.quaternion);k.mat3.scale(C,
C,a.halfSize);var g=function(b,c){c=A[f+c+1];l.vec3.set(b,((c&1)<<1)-1,(c&2)-1,((c&4)>>1)-1);l.vec3.transformMat3(b,b,C);return l.vec3.add(b,a.center,b)};c.length=0;p(c,g(G,0));p(c,g(H,1));p(c,g(E,2));p(c,g(D,3));d(c);if(1===b)return b;c.length=0;p(c,G);p(c,D);p(c,g(E,4));p(c,g(I,5));d(c);if(2===b)return b;c.length=0;p(c,G);p(c,I);p(c,g(E,6));p(c,H);d(c);return b}function u(a,b){for(var c=0,e=0;e<B;e++){var f=d.intersectPlane(a,b[e]);if(0<f)return-1;0===f&&(c|=1<<e)}return c}Object.defineProperty(b,
"__esModule",{value:!0});b.computeDepthRange=function(b,e){var f=c.empty(),g=b.eye,h=b.viewForward,k=b.frustum.planes;for(b=0;b<e.length;b++){var m=e[b].obb,n=l.vec3.dot(l.vec3.sub(E,m.center,g),h),A=d.projectedRadius(m,h);if(!c.within(f,n-A)||!c.within(f,n+A))if(m=u(m,k),-1!==m)if(0===m)x.far=n+A,x.near=n-A,c.union(f,x);else{var C=r.pushNew();C.near=n-A;C.far=n+A;C.mask=m;C.object=e[b]}}e=function(b){var d=r.data[b];if(c.within(f,d.near)&&c.within(f,d.far))return"continue";x.far=d.far;x.near=Infinity;
0===t(d.object.obb,g,z,function(b){for(var c=y,e=0;e<B&&0<b.length;e++)if(0!==(d.mask&1<<e)){var f=k[e],m=b,n=c;n.length=0;var r=m.length-3;q(w,m,r);var u=a.signedDistance(f,w);0>=u&&(n.push(w[0]),n.push(w[1]),n.push(w[2]));var t=0,A=u;for(t;t<r;t+=3){q(v,m,t);var z=a.signedDistance(f,v);0>A*z&&(l.vec3.lerp(w,v,w,z/(z-A)),p(n,w));0>=z&&p(n,v);A=z;l.vec3.copy(w,v)}0>A*u&&(q(v,m,r),l.vec3.lerp(w,v,w,u/(u-A)),p(n,w));f=b;b=c;c=f}for(c=0;c<b.length;c+=3)l.vec3.set(w,b.data[c+0],b.data[c+1],b.data[c+2]),
e=l.vec3.dot(l.vec3.sub(w,w,g),h),x.near=Math.min(x.near,e)})&&(x.near=0);c.union(f,x)};for(b=0;b<r.length;b++)e(b);r.length=0;return f};var r=new m({allocator:function(a){return a||{near:Infinity,far:-Infinity,mask:0,object:null}},deallocator:function(a){a.object=null;return a}}),x=c.empty(),w=h.vec3f64.create(),v=h.vec3f64.create(),z=new m({deallocator:null}),y=new m({deallocator:null}),A=function(){var a=new Int8Array(216),b=0,c=function(c){for(var d=0;d<c.length;d++)a[b+d]=c[d];b+=8};c([3,0,6,
2,3,1,5,4]);c([2,0,2,3,1,5,4,0]);c([3,1,0,2,3,7,5,4]);c([2,0,1,3,2,6,4,0]);c([1,0,1,3,2,0,0,0]);c([2,1,5,7,3,2,0,0]);c([3,2,0,1,3,7,6,4]);c([2,2,0,1,3,7,6,0]);c([3,3,0,1,5,7,6,2]);c([2,0,1,5,4,6,2,0]);c([1,0,1,5,4,0,0,0]);c([2,1,3,7,5,4,0,0]);c([1,0,2,6,4,0,0,0]);c([0,0,0,0,0,0,0,0]);c([1,1,3,7,5,0,0,0]);c([2,2,3,7,6,4,0,0]);c([1,2,3,7,6,0,0,0]);c([2,3,1,5,7,6,2,0]);c([3,4,0,1,5,7,6,2]);c([2,5,7,6,4,0,1,0]);c([3,5,0,1,3,7,6,4]);c([2,4,5,7,6,2,0,0]);c([1,4,5,7,6,0,0,0]);c([2,5,1,3,7,6,4,0]);c([3,6,
0,2,3,7,5,4]);c([2,6,2,3,7,5,4,0]);c([3,7,6,2,3,1,5,4]);return a}(),B=4,C=g.mat3f64.create(),F=f.quatf64.create(),E=h.vec3f64.create(),G=h.vec3f64.create(),H=h.vec3f64.create(),D=h.vec3f64.create(),I=h.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["require","exports"],function(n,b){function m(b,e){return{near:b,far:e}}function k(b,e,f){b.near=e;b.far=f;return b}Object.defineProperty(b,"__esModule",{value:!0});b.create=m;b.empty=function(b){return b?k(b,Infinity,
-Infinity):m(Infinity,-Infinity)};b.set=k;b.union=function(b,e,f){void 0===f&&(f=b);f.near=Math.min(b.near,e.near);f.far=Math.max(b.far,e.far);return f};b.within=function(b,e){return b.near<=e&&e<=b.far}})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["require","exports","../../../support/buffer/InterleavedLayout"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});b.createVertexBufferLayout=function(b){var g=m.newLayout().vec3f("position");b.normals&&
g.vec2i16("normalCompressed",{glNormalized:!0});1===b.textureCoordinates?g.vec2f("uv0"):2===b.textureCoordinates&&(g.vec2f("uv0"),g.vec4u16("uvRegion",{glNormalized:!0}));b.colors&&g.vec4u8("color",{glNormalized:!0});return g.alignTo(4)}})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this._totalCount=b;this._indexRanges=
[0,b]}b.prototype.componentCount=function(){for(var b=this._indexRanges,g=0,e=0;e<b.length;e+=2)g+=b[e+1];return g};b.prototype.reset=function(b){if("all"===b||b.length===this._totalCount)this._indexRanges=[0,this._totalCount];else{var g=[];if(0!==b.length){for(var e=b[0],f=1,l=1;l<b.length;l++){var h=b[l];e+f===h?f+=1:(g.push(e),g.push(f),e=h,f=1)}g.push(e);g.push(f)}this._indexRanges=g}};b.prototype.forEachComponent=function(b){for(var g=this._indexRanges,e=0;e<g.length;e+=2)for(var f=g[e],l=f+
g[e+1];f<l;f++)if(!b(f))return!1;return!0};b.prototype.forEachComponentRange=function(b){for(var g=this._indexRanges,e=0;e<g.length;e+=2){var f=g[e];if(!b(f,f+g[e+1]))return!1}return!0};b.prototype.computeOffsetRanges=function(b){for(var g=Array(this._indexRanges.length),e=this._indexRanges,f=0;f<e.length;f+=2){var l=e[f],h=b[l],l=b[l+e[f+1]];g[f]=h;g[f+1]=l-h}return g};return b}();b.ComponentRangeRunLengthEncoded=n})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/tsSupport/decorateHelper ../../../../../../core/maybe ../../../../../../core/libs/gl-matrix-2/vec3 ../../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../../core/libs/gl-matrix-2/vec4 ../../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../../../core/libs/gl-matrix-2/vec4f64 ./ComponentTechnique ./shader/ComponentShader.glsl ../../../core/material/MaterialBase ../../../core/shaderLibrary/util/AlphaDiscard.glsl".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){function t(a){switch(a){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 7}}Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function n(){var c=b.call(this)||this;c.baseColor=h.vec4f32.fromValues(1,1,1,1);c.usePBR=!1;c.mrrFactors=f.vec3f32.fromValues(1,1,.5);c.emissiveFactor=f.vec3f32.fromValues(0,0,0);c.baseColorTexture=null;c.metallicRoughnessTexture=null;c.emissionTexture=null;c.occlusionTexture=null;c.normalTexture=null;c.overlayTexOffset=
d.vec4f64.fromValues(-1,-1,-1,-1);c.overlayTexScale=d.vec4f64.fromValues(0,0,0,0);c.overlayColorInner=null;c.overlayColorOuter=null;c.overlayHighlightInner=null;c.overlayHighlightOuter=null;c.overlayNormalInner=null;c.overlayNormalOuter=null;c.objectOpacity=1;c.commonMaterialParameters=new u;c.componentParameters=new r;c.alphaCutoff=p.defaultMaskAlphaCutoff;c.alphaDiscardMode=1;c.isIntegratedMesh=!1;c.polygonOffsetEnabled=!1;c.sceneHasOcludees=!1;c._techniqueConfig=new a.ComponentTechniqueConfiguration;
return c}m(n,b);n.prototype.dispose=function(a){this._technique&&(a.release(this._technique),this._technique=void 0);this.baseColorTexture=null};Object.defineProperty(n.prototype,"hasTransparency",{get:function(){return 0!==this._computeWhichMaterialPass()},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"hasVisibleComponents",{get:function(){return 0===this.objectOpacity?!1:2!==this.componentParameters.visible},enumerable:!0,configurable:!0});n.prototype.getTechnique=function(b,
c,d){var e=this._techniqueConfig;e.hasVertexColors=d.colors;e.hasNormals=d.normals;e.vertexTextureCoordinates=d.textureCoordinates;e.usePBR=this.usePBR;e.hasMetalnessAndRoughnessTexture=g.isSome(this.metallicRoughnessTexture);e.hasEmissionTexture=g.isSome(this.emissionTexture);e.hasOcclusionTexture=g.isSome(this.occlusionTexture);e.hasNormalTexture=g.isSome(this.normalTexture);this.dirty&&(e.componentData=this.componentParameters.type,e.cullFace=this.commonMaterialParameters.cullFace,e.doubleSidedMode=
this.commonMaterialParameters.doubleSided?1:0,e.baseColorTexture=g.isSome(this.baseColorTexture),d=this._computeWhichMaterialPass(),e.blendingEnabled=1===d||2===d,e.alphaDiscardMode=this.alphaDiscardMode,e.integratedMeshMode=this.isIntegratedMesh?this.overlayColorInner||this.overlayColorOuter?this.overlayNormalInner||this.overlayNormalOuter?3:2:1:0,e.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean());e.slicePlaneEnabled=c.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled;
1===c.identifier?(e.output=3,e.vertexDiscardMode=0):2===c.identifier?(e.output=4,e.vertexDiscardMode=0):(2===this._computeWhichMaterialPass()?e.vertexDiscardMode=c.transparent?2:1:e.vertexDiscardMode=0,e.output=t(c.subPass),0===c.subPass?(e.receiveAmbientOcclusion=c.ambientOcclusionEnabled,e.sceneHasOcludees=c.sceneHasOcludees,e.receiveShadows=c.shadowsEnabled):(e.receiveAmbientOcclusion=!1,e.receiveShadows=!1));return this._technique=b.repository.acquireAndReleaseExisting(a.ComponentTechnique,e,
this._technique)};n.prototype.submit=function(a,b){var c=b.renderable.geometry,d=b.components,e=b.renderable.drawParameters;b=b.renderable.meta.cameraDepthSquared;var f=d.geometryRanges,d=d.highlightRanges;switch(this._computeWhichMaterialPass()){case 0:a.materialOpaque.submitDraw(this,c,f,e,b);break;case 1:a.materialTransparent.submitDraw(this,c,f,e,b);break;case 2:a.materialOpaque.submitDraw(this,c,f,e,b);a.materialTransparent.submitDraw(this,c,f,e,b);break;case 3:a.materialIntegratedMesh.submitDraw(this,
c,f,e,b),(this.overlayHighlightInner||this.overlayHighlightOuter)&&a.highlightIntegratedMesh.submitDraw(this,c,f,e,b)}g.isSome(a.shadowMap)&&2!==this.componentParameters.castShadows&&a.shadowMap.submitDraw(this,c,f,e,b);g.isSome(a.highlight)&&g.isSome(d)&&a.highlight.submitDraw(this,c,d,e,b)};Object.defineProperty(n.prototype,"attributeLocations",{get:function(){return c.attributeLocations},enumerable:!0,configurable:!0});n.prototype._computeWhichMaterialPass=function(){return this.isIntegratedMesh?
3:1>this.objectOpacity?1:0===this.componentParameters.opaqueOverride?0:1>this.baseColor[3]||0===this.alphaDiscardMode||3===this.alphaDiscardMode?1:2===this.componentParameters.transparent?0:0===this.componentParameters.transparent?1:2};k([q.parameter({vectorOps:l.vec4})],n.prototype,"baseColor",void 0);k([q.parameter()],n.prototype,"usePBR",void 0);k([q.parameter({vectorOps:e.vec3})],n.prototype,"mrrFactors",void 0);k([q.parameter({vectorOps:e.vec3})],n.prototype,"emissiveFactor",void 0);k([q.parameter({dispose:!0})],
n.prototype,"baseColorTexture",void 0);k([q.parameter({dispose:!0})],n.prototype,"metallicRoughnessTexture",void 0);k([q.parameter({dispose:!0})],n.prototype,"emissionTexture",void 0);k([q.parameter({dispose:!0})],n.prototype,"occlusionTexture",void 0);k([q.parameter({dispose:!0})],n.prototype,"normalTexture",void 0);k([q.parameter({vectorOps:{equals:l.vec4.exactEquals,copy:l.vec4.copy}})],n.prototype,"overlayTexOffset",void 0);k([q.parameter({vectorOps:{equals:l.vec4.exactEquals,copy:l.vec4.copy}})],
n.prototype,"overlayTexScale",void 0);k([q.parameter()],n.prototype,"overlayColorInner",void 0);k([q.parameter()],n.prototype,"overlayColorOuter",void 0);k([q.parameter()],n.prototype,"overlayHighlightInner",void 0);k([q.parameter()],n.prototype,"overlayHighlightOuter",void 0);k([q.parameter()],n.prototype,"overlayNormalInner",void 0);k([q.parameter()],n.prototype,"overlayNormalOuter",void 0);k([q.parameter()],n.prototype,"objectOpacity",void 0);k([q.parameterBlock()],n.prototype,"commonMaterialParameters",
void 0);k([q.parameterBlock()],n.prototype,"componentParameters",void 0);k([q.parameter()],n.prototype,"alphaCutoff",void 0);k([q.parameter()],n.prototype,"alphaDiscardMode",void 0);k([q.parameter()],n.prototype,"isIntegratedMesh",void 0);k([q.parameter()],n.prototype,"polygonOffsetEnabled",void 0);k([q.parameter()],n.prototype,"sceneHasOcludees",void 0);return n}(q.MaterialBase);b.ComponentMaterial=n;var u=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.doubleSided=!1;b.cullFace=
2;b.slicePlaneEnabled=!0;return b}m(b,a);k([q.parameter()],b.prototype,"doubleSided",void 0);k([q.parameter()],b.prototype,"cullFace",void 0);k([q.parameter()],b.prototype,"slicePlaneEnabled",void 0);return b}(q.MaterialParameterBlock);b.CommonMaterialParameters=u;var r=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.externalColor=h.vec4f32.fromValues(1,1,1,1);b.externalColorMixMode=1;b.castShadows=0;return b}m(b,a);Object.defineProperty(b.prototype,"transparent",{get:function(){return 1>
this.externalColor[3]?0:2},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"opaqueOverride",{get:function(){return 3===this.externalColorMixMode&&1===this.externalColor[3]?0:2},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{get:function(){return 0<this.externalColor[3]?0:2},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"type",{get:function(){return 0},enumerable:!0,configurable:!0});k([q.parameter({vectorOps:l.vec4})],b.prototype,
"externalColor",void 0);k([q.parameter()],b.prototype,"externalColorMixMode",void 0);k([q.parameter()],b.prototype,"castShadows",void 0);return b}(q.MaterialParameterBlock);b.ComponentParametersUniform=r;n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.texture=null;b.transparent=2;b.opaqueOverride=2;b.castShadows=2;b.visible=2;return b}m(b,a);Object.defineProperty(b.prototype,"type",{get:function(){return 1},enumerable:!0,configurable:!0});k([q.parameter()],b.prototype,"texture",
void 0);k([q.parameter()],b.prototype,"transparent",void 0);k([q.parameter()],b.prototype,"opaqueOverride",void 0);k([q.parameter()],b.prototype,"castShadows",void 0);k([q.parameter()],b.prototype,"visible",void 0);return b}(q.MaterialParameterBlock);b.ComponentParametersVarying=n})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../../core/tsSupport/assignHelper ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/tsSupport/decorateHelper ../../../../../../core/maybe ../../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../../core/libs/gl-matrix-2/vec4f64 ./shader/ComponentShader.glsl ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/StencilUtils ../../../../../webgl/Program ../../../../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v){Object.defineProperty(b,"__esModule",{value:!0});b.TextureUnits={DIFFUSE:0,COMPONENT_COLOR:1,NORMAL:2,EMISSION:3,OCCLUSION:4,METALLIC_ROUGHNESS:5,OVERLAY0_COLOR:2,OVERLAY1_COLOR:3,OVERLAY0_NORMAL:4,OVERLAY1_NORMAL:5,SSAO:6,SHADOW_MAP:7};m=function(f){function g(){return null!==f&&f.apply(this,arguments)||this}k(g,f);g.prototype.bindPass=function(e,f){var g=this.program;a.VertexPosition.bindViewProjTransform(g,f.viewTransform);d.Slice.bindUniforms(this.program,
this.configuration,f.slicePlane);0===f.identifier&&(g.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",f.transformNormal_ViewFromGlobal),1===f.subPass&&g.setUniform2fv("uCameraNearFar",f.cameraNearFar),0===f.subPass&&(f.ambientOcclusionEnabled&&f.ambientOcclusion.bind(g,b.TextureUnits.SSAO),f.shadowsEnabled&&f.shadowMap.bind(g,b.TextureUnits.SHADOW_MAP),f.lighting.setUniforms(this.program,f.integratedMesh)));1===f.identifier&&this.program.setUniform2fv("uCameraNearFar",f.cameraNearFar);2===f.identifier&&
c.OutputHighlight.bindOutputHighlight(e,this.program,f)};g.prototype.bindDraw=function(b,c){a.VertexPosition.bindModelTransform(this.program,b);this.program.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",b.transformNormal_GlobalFromModel);if(c.isIntegratedMesh){var d=c.overlayTexScale;c=c.overlayTexOffset;this.program.setUniform4fv("overlayTexOffset",[b.toMapSpace[0]*d[0]+c[0],b.toMapSpace[1]*d[1]+c[1],b.toMapSpace[0]*d[2]+c[2],b.toMapSpace[1]*d[3]+c[3]]);this.program.setUniform4fv("overlayTexScale",
[b.toMapSpace[2]*d[0],b.toMapSpace[3]*d[1],b.toMapSpace[2]*d[2],b.toMapSpace[3]*d[3]])}};g.prototype.bindMaterial=function(a,c,d){var f=this.program;f.setUniform4fv("uBaseColor",c.baseColor);f.setUniform1f("uObjectOpacity",c.objectOpacity);f.setUniform1f("textureAlphaCutoff",c.alphaCutoff);1===c.componentParameters.type?c.componentParameters.texture.bind(f,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:b.TextureUnits.COMPONENT_COLOR}):(f.setUniform4fv("uExternalColor",c.componentParameters.externalColor),
f.setUniform1i("uExternalColorMixMode",c.componentParameters.externalColorMixMode));e.isSome(c.baseColorTexture)&&c.baseColorTexture.bind(a,f,"uBaseColorTexture",b.TextureUnits.DIFFUSE,"uBaseColorTextureSize");0===this.configuration.output&&(q.PhysicallyBasedRenderingParameters.bindUniforms(this.program,c),e.isSome(c.metallicRoughnessTexture)&&c.metallicRoughnessTexture.bind(a,f,"texMetallicRoughness",b.TextureUnits.METALLIC_ROUGHNESS,"texMetallicRoughnessSize"),e.isSome(c.emissionTexture)&&c.emissionTexture.bind(a,
f,"texEmission",b.TextureUnits.EMISSION,"texEmissionSize"),e.isSome(c.occlusionTexture)&&c.occlusionTexture.bind(a,f,"texOcclusion",b.TextureUnits.OCCLUSION,"texOcclusionSize"),e.isSome(c.normalTexture)&&c.normalTexture.bind(a,f,"normalTexture",b.TextureUnits.NORMAL,"normalTextureSize"));c.isIntegratedMesh&&(0===d.identifier&&0===d.subPass?(a.bindTexture(e.unwrap(c.overlayColorInner),b.TextureUnits.OVERLAY0_COLOR),a.bindTexture(e.unwrap(c.overlayColorOuter),b.TextureUnits.OVERLAY1_COLOR),a.bindTexture(e.unwrap(c.overlayNormalInner),
b.TextureUnits.OVERLAY0_NORMAL),a.bindTexture(e.unwrap(c.overlayNormalOuter),b.TextureUnits.OVERLAY1_NORMAL),f.setUniform1i("ovInnerNormalTex",b.TextureUnits.OVERLAY0_NORMAL),f.setUniform1i("ovOuterNormalTex",b.TextureUnits.OVERLAY1_NORMAL)):2===d.identifier&&(a.bindTexture(e.unwrap(c.overlayHighlightInner),b.TextureUnits.OVERLAY0_COLOR),a.bindTexture(e.unwrap(c.overlayHighlightOuter),b.TextureUnits.OVERLAY1_COLOR)),f.setUniform1i("ovInnerColorTex",b.TextureUnits.OVERLAY0_COLOR),f.setUniform1i("ovOuterColorTex",
b.TextureUnits.OVERLAY1_COLOR),f.setUniform1f("overlayOpacity",1))};g.prototype.initializeProgram=function(a){var b=g.shader.get(),c=this.configuration,c=b.build({output:c.output,normalType:0===c.integratedMeshMode?c.hasNormals?1:3:2,attributeColor:c.hasVertexColors,attributeTextureCoordinates:c.vertexTextureCoordinates,componentData:c.componentData,alphaDiscardMode:c.alphaDiscardMode,baseColorTexture:c.baseColorTexture,doubleSidedMode:c.doubleSidedMode,receiveAmbientOcclusion:c.receiveAmbientOcclusion,
receiveShadows:c.receiveShadows,slicePlaneEnabled:c.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:a.viewingMode,vertexDiscardMode:c.vertexDiscardMode,pbrMode:3===c.integratedMeshMode?4:c.usePBR?1:0,hasMetalnessAndRoughnessTexture:c.hasMetalnessAndRoughnessTexture,hasEmissionTexture:c.hasEmissionTexture,hasOcclusionTexture:c.hasOcclusionTexture,hasNormalTexture:c.hasNormalTexture,vertexTangets:!1,useOldSceneLightInterface:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:p.doublePrecisionRequiresObfuscation(a.rctx),
overlayEnabled:2===c.integratedMeshMode||3===c.integratedMeshMode});return new w(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),b.attributeLocations)};g.prototype.initializePipeline=function(){var a=this.configuration,b=0!==a.integratedMeshMode;return v.makePipelineState({blending:0===a.output&&a.blendingEnabled?z:null,culling:A[a.cullFace],depthTest:{func:513},depthWrite:v.defaultDepthWriteParams,colorWrite:v.defaultColorWriteParams,stencilWrite:b||a.sceneHasOcludees?x.stencilWriteMaskOn:
null,stencilTest:b?x.replaceBitWhenDepthTestPasses(1):a.sceneHasOcludees?x.stencilBaseAllZerosParams:null,polygonOffset:a.polygonOffsetEnabled?y:null})};g.shader=new t.ReloadableShaderModule(h,"./shader/ComponentShader.glsl",n);return g}(u.ShaderTechnique);b.ComponentTechnique=m;var z=v.separateBlendingParams(770,1,771,771),y={factor:2,units:2},A=[null,{face:1028,mode:2305},{face:1029,mode:2305}];m=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.transformNormal_GlobalFromModel=
f.mat3f64.create();b.toMapSpace=l.vec4f64.create();return b}k(b,a);return b}(a.VertexPosition.ModelTransform);b.ComponentDrawParameters=m;m=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.hasVertexColors=!1;b.hasNormals=!1;b.vertexTextureCoordinates=0;b.componentData=0;b.slicePlaneEnabled=!1;b.cullFace=2;b.baseColorTexture=!1;b.receiveAmbientOcclusion=!0;b.receiveShadows=!0;b.vertexDiscardMode=0;b.doubleSidedMode=2;b.blendingEnabled=!0;b.alphaDiscardMode=1;b.integratedMeshMode=
0;b.overlayEnabled=!1;b.polygonOffsetEnabled=!1;b.usePBR=!1;b.hasMetalnessAndRoughnessTexture=!1;b.hasEmissionTexture=!1;b.hasOcclusionTexture=!1;b.hasNormalTexture=!1;b.sceneHasOcludees=!1;return b}k(b,a);g([r.parameter({count:7})],b.prototype,"output",void 0);g([r.parameter()],b.prototype,"hasVertexColors",void 0);g([r.parameter()],b.prototype,"hasNormals",void 0);g([r.parameter({count:3})],b.prototype,"vertexTextureCoordinates",void 0);g([r.parameter({count:2})],b.prototype,"componentData",void 0);
g([r.parameter()],b.prototype,"slicePlaneEnabled",void 0);g([r.parameter({count:3})],b.prototype,"cullFace",void 0);g([r.parameter()],b.prototype,"baseColorTexture",void 0);g([r.parameter()],b.prototype,"receiveAmbientOcclusion",void 0);g([r.parameter()],b.prototype,"receiveShadows",void 0);g([r.parameter({count:3})],b.prototype,"vertexDiscardMode",void 0);g([r.parameter({count:3})],b.prototype,"doubleSidedMode",void 0);g([r.parameter()],b.prototype,"blendingEnabled",void 0);g([r.parameter({count:4})],
b.prototype,"alphaDiscardMode",void 0);g([r.parameter({count:4})],b.prototype,"integratedMeshMode",void 0);g([r.parameter()],b.prototype,"overlayEnabled",void 0);g([r.parameter()],b.prototype,"polygonOffsetEnabled",void 0);g([r.parameter()],b.prototype,"usePBR",void 0);g([r.parameter()],b.prototype,"hasMetalnessAndRoughnessTexture",void 0);g([r.parameter()],b.prototype,"hasEmissionTexture",void 0);g([r.parameter()],b.prototype,"hasOcclusionTexture",void 0);g([r.parameter()],b.prototype,"hasNormalTexture",
void 0);g([r.parameter()],b.prototype,"sceneHasOcludees",void 0);return b}(r.ShaderTechniqueConfiguration);b.ComponentTechniqueConfiguration=m})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentShader.glsl":function(){define("require exports ../../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../../../support/earthUtils ./ComponentData.glsl ./VertexDiscardByOpacity.glsl ../../../../core/shaderLibrary/ForwardLinearDepth.glsl ../../../../core/shaderLibrary/Slice.glsl ../../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../../core/shaderLibrary/attributes/VertexColor.glsl ../../../../core/shaderLibrary/attributes/VertexNormal.glsl ../../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../../core/shaderLibrary/output/OutputDepth.glsl ../../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../../core/shaderLibrary/shading/ComputeMaterialColor.glsl ../../../../core/shaderLibrary/shading/ComputeNormalTexture.glsl ../../../../core/shaderLibrary/shading/ComputeShadingNormal.glsl ../../../../core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../../core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../../../../core/shaderLibrary/shading/ReadShadowMap.glsl ../../../../core/shaderLibrary/util/AlphaDiscard.glsl ../../../../core/shaderModules/interfaces ../../../../core/shaderModules/ShaderBuilder ../../../../shaders/Overlay.glsl".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C){Object.defineProperty(b,"__esModule",{value:!0});b.attributeLocations={position:0,normal:1,normalCompressed:1,color:2,uv0:3,uvRegion:4,componentIndex:5};b.build=function(b){var n=new B.ShaderBuilder;n.include(c.VertexPosition,b);n.include(a.VertexNormal,b);n.include(d.VertexColor,b);n.include(h.TextureCoordinateAttribute,b);n.include(f.ForwardLinearDepth,b);n.include(g.ComponentData,b);n.include(y.DiscardOrAdjustAlpha,b);n.include(l.Slice,
b);n.include(v.ReadBaseColorTexture,b);n.include(e.VertexDiscardByOpacity,b);if(1===b.pbrMode||2===b.pbrMode)n.include(w.PhysicallyBasedRenderingParameters,b),n.include(u.ComputeNormalTexture,b);3===b.output&&1===b.componentData?n.vertex.code.add(A.glsl(F||(F=m(["\n      #define discardShadows(castShadows) { if(!castShadows) { gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n    "],["\n      #define discardShadows(castShadows) { if(!castShadows) { gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n    "])))):
n.vertex.code.add(A.glsl(E||(E=m(["\n      #define discardShadows(castShadows) {}\n    "],["\n      #define discardShadows(castShadows) {}\n    "]))));var ka=b.overlayEnabled&&0===b.output&&4===b.pbrMode;b.overlayEnabled&&(n.include(C.Overlay,b),0===b.viewingMode?n.vertex.code.add(A.glsl(G||(G=m(["\n      const float invEarthRadius \x3d ",";\n      vec2 projectOverlay(vec3 pos) {\n        return pos.xy / (1.0 + invEarthRadius * pos.z);\n      }\n      "],["\n      const float invEarthRadius \x3d ",
";\n      vec2 projectOverlay(vec3 pos) {\n        return pos.xy / (1.0 + invEarthRadius * pos.z);\n      }\n      "])),A.glsl.float(1/k.earthRadius))):n.vertex.code.add(A.glsl(H||(H=m(["\n      vec2 projectOverlay(vec3 pos) { return pos.xy; }\n      "],["\n      vec2 projectOverlay(vec3 pos) { return pos.xy; }\n      "])))));ka&&(n.varyings.add("tbnTangent","vec3"),n.varyings.add("tbnBiTangent","vec3"),n.varyings.add("groundNormal","vec3"));n.vertex.code.add(A.glsl(K||(K=m(["\n    void main() {\n      bool castShadows;\n      vec4 externalColor \x3d forwardExternalColor(castShadows);\n      discardShadows(castShadows);\n\n      vertexDiscardByOpacity(externalColor.a);\n\n      if (externalColor.a \x3c ",
") {\n        // Discard this vertex\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n      forwardPosition();\n      forwardNormal();\n      ","\n\n      ","\n      forwardTextureCoordinates();\n      forwardVertexColor();\n      forwardLinearDepth(); // depends on forwardPosition()\n    }\n  "],["\n    void main() {\n      bool castShadows;\n      vec4 externalColor \x3d forwardExternalColor(castShadows);\n      discardShadows(castShadows);\n\n      vertexDiscardByOpacity(externalColor.a);\n\n      if (externalColor.a \x3c ",
") {\n        // Discard this vertex\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n      forwardPosition();\n      forwardNormal();\n      ","\n\n      ","\n      forwardTextureCoordinates();\n      forwardVertexColor();\n      forwardLinearDepth(); // depends on forwardPosition()\n    }\n  "])),A.glsl.float(y.symbolAlphaCutoff),ka?A.glsl(L||(L=m(["\n        ","\n        "],["\n        ","\n        "])),0===b.viewingMode?A.glsl(D||(D=m(["\n        groundNormal \x3d normalize(positionWorld());\n        tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));\n        tbnBiTangent \x3d normalize(cross(groundNormal, tbnTangent));"],
["\n        groundNormal \x3d normalize(positionWorld());\n        tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));\n        tbnBiTangent \x3d normalize(cross(groundNormal, tbnTangent));"]))):A.glsl(I||(I=m(["\n        groundNormal \x3d vec3(0.0, 0.0, 1.0);\n        tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n        tbnBiTangent \x3d normalize(cross(groundNormal, tbnTangent));"],["\n        groundNormal \x3d vec3(0.0, 0.0, 1.0);\n        tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n        tbnBiTangent \x3d normalize(cross(groundNormal, tbnTangent));"])))):
"",b.overlayEnabled?A.glsl(O||(O=m(["setOverlayVTC(projectOverlay(position));"],["setOverlayVTC(projectOverlay(position));"]))):""));0===b.output&&(n.include(t.ComputeMaterialColor,b),n.include(r.ComputeShadingNormal,b),n.include(x.EvaluateSceneLighting,b),ka&&(n.fragment.uniforms.add("ovInnerNormalTex","sampler2D"),n.fragment.uniforms.add("ovOuterNormalTex","sampler2D")),b.receiveShadows?(n.include(z.ReadShadowMap,b),n.fragment.code.add(A.glsl(N||(N=m(["\n        float evaluateShadow() {\n          return readShadowMap(vPositionWorldCameraRelative, linearDepth);\n        }\n      "],
["\n        float evaluateShadow() {\n          return readShadowMap(vPositionWorldCameraRelative, linearDepth);\n        }\n      "]))))):n.fragment.code.add(A.glsl(Q||(Q=m(["\n        float evaluateShadow() { return 0.0; }\n      "],["\n        float evaluateShadow() { return 0.0; }\n      "])))),n.fragment.code.add(A.glsl(T||(T=m(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        vec4 externalColor;\n        int externalColorMixMode;\n        readExternalColor(externalColor, externalColorMixMode);\n\n        vec4 materialColor \x3d computeMaterialColor(\n          textureColor,\n          externalColor,\n          externalColorMixMode\n        );\n        ",
"\n    "],["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        vec4 externalColor;\n        int externalColorMixMode;\n        readExternalColor(externalColor, externalColorMixMode);\n\n        vec4 materialColor \x3d computeMaterialColor(\n          textureColor,\n          externalColor,\n          externalColorMixMode\n        );\n        ","\n    "])),b.overlayEnabled?
A.glsl(M||(M=m(["\n        vec4 overlayColor \x3d getCombinedOverlayColor();\n        materialColor \x3d materialColor * (1.0 - overlayColor.a) + overlayColor;"],["\n        vec4 overlayColor \x3d getCombinedOverlayColor();\n        materialColor \x3d materialColor * (1.0 - overlayColor.a) + overlayColor;"]))):"")),1===b.pbrMode||2===b.pbrMode?(n.fragment.code.add(A.glsl(S||(S=m(["\n        ","\n        vec3 normalVertex \x3d shadingNormalWorld();\n        float additionalIrradiance \x3d 0.02 * lightingMainIntensity[2];\n      "],
["\n        ","\n        vec3 normalVertex \x3d shadingNormalWorld();\n        float additionalIrradiance \x3d 0.02 * lightingMainIntensity[2];\n      "])),1===b.pbrMode?A.glsl(P||(P=m(["\n        applyPBRFactors();\n        if (int(externalColorMixMode) \x3d\x3d 3) {\n          mrr \x3d vec3(0.0, 0.6, 0.2);\n        }"],["\n        applyPBRFactors();\n        if (int(externalColorMixMode) \x3d\x3d 3) {\n          mrr \x3d vec3(0.0, 0.6, 0.2);\n        }"]))):"")),b.hasNormalTexture?n.fragment.code.add(A.glsl(V||
(V=m(["\n        mat3 tangentSpace \x3d computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);\n        vec3 shadingNormal \x3d computeTextureNormal(tangentSpace, vuv0);\n        "],["\n        mat3 tangentSpace \x3d computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);\n        vec3 shadingNormal \x3d computeTextureNormal(tangentSpace, vuv0);\n        "])))):n.fragment.code.add(A.glsl(J||(J=m(["\n        vec3 shadingNormal \x3d normalVertex;\n        "],["\n        vec3 shadingNormal \x3d normalVertex;\n        "])))),
n.fragment.code.add(A.glsl(X||(X=m(["","\n      "],["","\n      "])),0===b.viewingMode?A.glsl(U||(U=m(["vec3 normalGround \x3d normalize(positionWorld());"],["vec3 normalGround \x3d normalize(positionWorld());"]))):A.glsl(Y||(Y=m(["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"],["vec3 normalGround \x3d vec3(0.0, 0.0, 1.0);"]))))),n.fragment.code.add(A.glsl(R||(R=m(["\n        vec3 viewDir \x3d normalize(vPositionWorldCameraRelative);\n        float ssao \x3d 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());\n        vec3 additionalLight \x3d evaluateAdditionalLighting(ssao, positionWorld());\n        vec4 shadedColor \x3d vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);\n        "],
["\n        vec3 viewDir \x3d normalize(vPositionWorldCameraRelative);\n        float ssao \x3d 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());\n        vec3 additionalLight \x3d evaluateAdditionalLighting(ssao, positionWorld());\n        vec4 shadedColor \x3d vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);\n        "]))))):(b.receiveShadows?n.fragment.code.add(A.glsl(aa||
(aa=m(["\n      float shadow \x3d evaluateShadow();\n        "],["\n      float shadow \x3d evaluateShadow();\n        "])))):0===b.viewingMode?n.fragment.code.add(A.glsl(da||(da=m(["\n      float additionalAmbientScale \x3d _oldHeuristicLighting(positionWorld());\n      float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n        "],["\n      float additionalAmbientScale \x3d _oldHeuristicLighting(positionWorld());\n      float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n        "])))):
n.fragment.code.add(A.glsl(ca||(ca=m(["\n      float shadow \x3d 0.0;\n      "],["\n      float shadow \x3d 0.0;\n      "])))),n.fragment.code.add(A.glsl(W||(W=m(["\n      float ambientOcclusion \x3d evaluateAmbientOcclusion();\n      // At global scale we create some additional ambient light based on the main light to simulate global illumination\n      vec3 additionalLight \x3d evaluateAdditionalLighting(ambientOcclusion, positionWorld());\n      vec4 shadedColor \x3d vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);\n      ",
"\n      "],["\n      float ambientOcclusion \x3d evaluateAmbientOcclusion();\n      // At global scale we create some additional ambient light based on the main light to simulate global illumination\n      vec3 additionalLight \x3d evaluateAdditionalLighting(ambientOcclusion, positionWorld());\n      vec4 shadedColor \x3d vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);\n      ","\n      "])),ka?A.glsl(ba||(ba=m(["\n          vec4 overlayWaterMask \x3d getOverlayColor(ovInnerNormalTex, ovOuterNormalTex, vtcOverlay);\n          float waterNormalLength \x3d length(overlayWaterMask);\n          if (waterNormalLength \x3e 0.95) {\n            mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, groundNormal);\n            vec4 waterColor \x3d getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix);\n            // un-gamma the ground color to mix in linear space\n            vec4 groundColor \x3d vec4(pow(shadedColor.rgb, vec3(2.2)), shadedColor.w);\n            waterColor \x3d mix(groundColor, waterColor, waterColor.a);\n            shadedColor \x3d vec4(delinearizeGamma(waterColor).rgb, materialColor.a);\n          }"],
["\n          vec4 overlayWaterMask \x3d getOverlayColor(ovInnerNormalTex, ovOuterNormalTex, vtcOverlay);\n          float waterNormalLength \x3d length(overlayWaterMask);\n          if (waterNormalLength \x3e 0.95) {\n            mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, groundNormal);\n            vec4 waterColor \x3d getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix);\n            // un-gamma the ground color to mix in linear space\n            vec4 groundColor \x3d vec4(pow(shadedColor.rgb, vec3(2.2)), shadedColor.w);\n            waterColor \x3d mix(groundColor, waterColor, waterColor.a);\n            shadedColor \x3d vec4(delinearizeGamma(waterColor).rgb, materialColor.a);\n          }"]))):
""))),n.fragment.code.add(A.glsl(Z||(Z=m(["\n        gl_FragColor \x3d highlightSlice(shadedColor, vPositionWorldCameraRelative);\n      }\n    "],["\n        gl_FragColor \x3d highlightSlice(shadedColor, vPositionWorldCameraRelative);\n      }\n    "])))));if(1===b.output||3===b.output)n.include(q.OutputDepth,b),n.fragment.code.add(A.glsl(ea||(ea=m(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        outputDepth(linearDepth);\n      }\n    "],
["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        outputDepth(linearDepth);\n      }\n    "]))));2===b.output&&(n.include(r.ComputeShadingNormal,b),n.fragment.code.add(A.glsl(fa||(fa=m(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        // note: the alpha component needs to be 1.0 in order for this material\n        // to influence ambient occlusion, see the ssao fragment shader\n        float alpha \x3d ",
";\n        gl_FragColor \x3d vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);\n      }\n    "],["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        // note: the alpha component needs to be 1.0 in order for this material\n        // to influence ambient occlusion, see the ssao fragment shader\n        float alpha \x3d ",";\n        gl_FragColor \x3d vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);\n      }\n    "])),
2===b.normalType?"0.0":"1.0")));4===b.output&&(n.include(p.OutputHighlight),n.fragment.code.add(A.glsl(la||(la=m(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        ","\n\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        ",
"\n\n        outputHighlight();\n      }\n    "])),b.overlayEnabled?A.glsl(na||(na=m(["\n        vec4 overlayColor \x3d getCombinedOverlayColor();\n\n        if (overlayColor.a \x3d\x3d 0.0) {\n          gl_FragColor \x3d vec4(0.0);\n          return;\n        }"],["\n        vec4 overlayColor \x3d getCombinedOverlayColor();\n\n        if (overlayColor.a \x3d\x3d 0.0) {\n          gl_FragColor \x3d vec4(0.0);\n          return;\n        }"]))):"")));return n};var F,E,G,H,D,I,L,O,K,N,Q,M,T,P,S,V,J,
U,Y,X,R,aa,da,ca,ba,W,Z,ea,fa,na,la})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define(["require","exports","../../../../../../../core/tsSupport/makeTemplateObjectHelper","./DecodeSymbolColor.glsl","../../../../core/shaderModules/interfaces"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.ComponentData=function(b,a){1===a.componentData&&(b.vertex.uniforms.add("uComponentColorTex","sampler2D"),b.vertex.uniforms.add("uComponentColorTexInvDim",
"vec2"),b.attributes.add("componentIndex","float"),b.varyings.add("vExternalColorMixMode","mediump float"),b.varyings.add("vExternalColor","vec4"),b.include(k.DecodeSymbolColor),b.vertex.code.add(g.glsl(e||(e=m(["\n      vec4 _readComponentColor() {\n        float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n        vec2 indexCoord \x3d vec2(\n          mod(normalizedIndex, 1.0),\n          (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n        );\n        return texture2D(uComponentColorTex, indexCoord);\n       }\n\n      vec4 forwardExternalColor(out bool castShadows) {\n        vec4 componentColor \x3d _readComponentColor() * 255.0;\n\n        float shadowFlag \x3d mod(componentColor.b * 255.0, 2.0);\n        componentColor.b -\x3d shadowFlag;\n        castShadows \x3d shadowFlag \x3e\x3d 1.0;\n\n        int decodedColorMixMode;\n        vExternalColor \x3d decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // \x3d 1/255;\n        vExternalColorMixMode \x3d float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n\n        return vExternalColor;\n      }\n    "],
["\n      vec4 _readComponentColor() {\n        float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n        vec2 indexCoord \x3d vec2(\n          mod(normalizedIndex, 1.0),\n          (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n        );\n        return texture2D(uComponentColorTex, indexCoord);\n       }\n\n      vec4 forwardExternalColor(out bool castShadows) {\n        vec4 componentColor \x3d _readComponentColor() * 255.0;\n\n        float shadowFlag \x3d mod(componentColor.b * 255.0, 2.0);\n        componentColor.b -\x3d shadowFlag;\n        castShadows \x3d shadowFlag \x3e\x3d 1.0;\n\n        int decodedColorMixMode;\n        vExternalColor \x3d decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // \x3d 1/255;\n        vExternalColorMixMode \x3d float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n\n        return vExternalColor;\n      }\n    "])))),
b.fragment.code.add(g.glsl(f||(f=m(["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d int(vExternalColorMixMode);\n      }\n    "],["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d int(vExternalColorMixMode);\n      }\n    "])))));0===a.componentData&&(b.vertex.uniforms.add("uExternalColor",
"vec4"),b.fragment.uniforms.add("uExternalColorMixMode","int"),b.varyings.add("vExternalColor","vec4"),b.vertex.code.add(g.glsl(l||(l=m(["\n      vec4 forwardExternalColor(out bool castShadows) {\n        vExternalColor \x3d uExternalColor;\n        castShadows \x3d true;\n        return uExternalColor;\n      }\n    "],["\n      vec4 forwardExternalColor(out bool castShadows) {\n        vExternalColor \x3d uExternalColor;\n        castShadows \x3d true;\n        return uExternalColor;\n      }\n    "])))),
b.fragment.code.add(g.glsl(h||(h=m(["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d uExternalColorMixMode;\n      }\n    "],["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d uExternalColorMixMode;\n      }\n    "])))))};var e,f,l,h})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["require",
"exports","../../../../../../../core/tsSupport/makeTemplateObjectHelper","../../../../core/shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.VertexDiscardByOpacity=function(b,d){b=b.vertex;b.code.add(k.glsl(g||(g=m(["\n  #define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)\n  "],["\n  #define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)\n  "]))));switch(d.vertexDiscardMode){case 0:b.code.add(k.glsl(e||(e=m(["\n        #define vertexDiscardByOpacity(_opacity_) {}\n      "],
["\n        #define vertexDiscardByOpacity(_opacity_) {}\n      "]))));break;case 2:b.code.add(k.glsl(f||(f=m(["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3e  VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "],["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3e  VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "]))));break;case 1:b.code.add(k.glsl(l||(l=m(["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3c\x3d VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "],
["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3c\x3d VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "]))))}};var g,e,f,l})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../attributes/VertexColor.glsl ../util/MixExternalColor.glsl ../../shaderModules/interfaces".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,
"__esModule",{value:!0});b.ComputeMaterialColor=function(b,a){b.include(k.VertexColor,a);b.include(g.MixExternalColor,{stages:1});b=b.fragment;b.uniforms.add("uBaseColor","vec4");b.uniforms.add("uObjectOpacity","float");a.attributeColor?b.code.add(e.glsl(f||(f=m(["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb * vColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a * vColor.a;\n      }\n    "],
["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb * vColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a * vColor.a;\n      }\n    "])))):b.code.add(e.glsl(l||(l=m(["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a;\n      }\n    "],["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a;\n      }\n    "]))));
b.code.add(e.glsl(h||(h=m(["\n    vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {\n      vec3 baseColor \x3d _baseColor();\n      float baseOpacity \x3d _baseOpacity();\n\n      vec3 color \x3d mixExternalColor(\n        baseColor,\n        textureColor.rgb,\n        externalColor.rgb,\n        externalColorMixMode\n      );\n      float opacity \x3d uObjectOpacity * mixExternalOpacity(\n        baseOpacity,\n        textureColor.a,\n        externalColor.a,\n        externalColorMixMode\n      );\n\n      return vec4(color, opacity);\n    }\n  "],
["\n    vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {\n      vec3 baseColor \x3d _baseColor();\n      float baseOpacity \x3d _baseOpacity();\n\n      vec3 color \x3d mixExternalColor(\n        baseColor,\n        textureColor.rgb,\n        externalColor.rgb,\n        externalColorMixMode\n      );\n      float opacity \x3d uObjectOpacity * mixExternalOpacity(\n        baseOpacity,\n        textureColor.a,\n        externalColor.a,\n        externalColorMixMode\n      );\n\n      return vec4(color, opacity);\n    }\n  "]))))};
var f,l,h})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ../../shaderModules/interfaces".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});b.ComputeShadingNormal=function(b,n){var r=b.fragment;0===n.doubleSidedMode?r.code.add(e.glsl(f||(f=m(["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return normal;\n      }\n    "],
["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return normal;\n      }\n    "])))):1===n.doubleSidedMode?(b.include(g.VertexPosition,n),r.uniforms.add("uTransform_ViewFromCameraLocal_T","vec3"),r.code.add(e.glsl(l||(l=m(["\n      vec3 _adjustDoublesided(vec3 normal) {\n        vec3 viewDir \x3d vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;\n        return dot(normal, viewDir) \x3e 0.0 ? -normal : normal;\n      }\n    "],["\n      vec3 _adjustDoublesided(vec3 normal) {\n        vec3 viewDir \x3d vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;\n        return dot(normal, viewDir) \x3e 0.0 ? -normal : normal;\n      }\n    "]))))):
2===n.doubleSidedMode&&r.code.add(e.glsl(h||(h=m(["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "],["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "]))));0===n.normalType||1===n.normalType?(b.include(k.VertexNormal,n),r.code.add(e.glsl(d||(d=m(["\n      vec3 shadingNormalWorld() {\n        return _adjustDoublesided(normalize(vNormalWorld));\n      }\n\n      vec3 shadingNormal_view() {\n        vec3 normal \x3d normalize(vNormalView);\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "],
["\n      vec3 shadingNormalWorld() {\n        return _adjustDoublesided(normalize(vNormalWorld));\n      }\n\n      vec3 shadingNormal_view() {\n        vec3 normal \x3d normalize(vNormalView);\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "]))))):3===n.normalType?(b.extensions.add("GL_OES_standard_derivatives"),b.include(g.VertexPosition,n),r.code.add(e.glsl(a||(a=m(["\n      vec3 shadingNormalWorld() {\n        return normalize(cross(\n          dFdx(vPositionWorldCameraRelative),\n          dFdy(vPositionWorldCameraRelative)\n        ));\n      }\n\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));\n      }\n    "],
["\n      vec3 shadingNormalWorld() {\n        return normalize(cross(\n          dFdx(vPositionWorldCameraRelative),\n          dFdy(vPositionWorldCameraRelative)\n        ));\n      }\n\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));\n      }\n    "]))))):2===n.normalType&&(0===n.viewingMode?(b.include(g.VertexPosition,n),r.code.add(e.glsl(c||(c=m(["\n        vec3 shadingNormalWorld() {\n          return normalize(positionWorld());\n        }\n      "],
["\n        vec3 shadingNormalWorld() {\n          return normalize(positionWorld());\n        }\n      "]))))):1===n.viewingMode&&r.code.add(e.glsl(q||(q=m(["\n        vec3 shadingNormalWorld() {\n          return vec3(0.0, 0.0, 1.0);\n        }\n      "],["\n        vec3 shadingNormalWorld() {\n          return vec3(0.0, 0.0, 1.0);\n        }\n      "])))),b.extensions.add("GL_OES_standard_derivatives"),r.code.add(e.glsl(p||(p=m(["\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;\n      }\n    "],
["\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;\n      }\n    "])))))};var f,l,h,d,a,c,q,p})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../attributes/VertexTextureCoordinates.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,
"__esModule",{value:!0});b.ReadBaseColorTexture=function(b,a){var c=b.fragment;a.baseColorTexture?(b.include(k.VertexTextureCoordinates,a),c.uniforms.add("uBaseColorTexture","sampler2D"),c.uniforms.add("uBaseColorTextureSize","vec2"),2===a.attributeTextureCoordinates?(b.include(g.TextureAtlasLookup),c.code.add(e.glsl(f||(f=m(["\n        vec4 readBaseColorTexture() {\n          return textureAtlasLookup(\n            uBaseColorTexture,\n            uBaseColorTextureSize,\n            vuv0,\n            vuvRegion\n          );\n        }\n      "],
["\n        vec4 readBaseColorTexture() {\n          return textureAtlasLookup(\n            uBaseColorTexture,\n            uBaseColorTextureSize,\n            vuv0,\n            vuvRegion\n          );\n        }\n      "]))))):c.code.add(e.glsl(l||(l=m(["\n        vec4 readBaseColorTexture() {\n          return texture2D(uBaseColorTexture, vuv0);\n        }\n      "],["\n        vec4 readBaseColorTexture() {\n          return texture2D(uBaseColorTexture, vuv0);\n        }\n      "]))))):c.code.add(e.glsl(h||
(h=m(["\n      vec4 readBaseColorTexture() { return vec4(1.0); }\n    "],["\n      vec4 readBaseColorTexture() { return vec4(1.0); }\n    "]))))};var f,l,h})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(){this._dirty=!0}b.prototype._setDirty=function(){this._dirty=!0};b.prototype._setClean=function(){this._dirty=!1;for(var b=0,g=this.__proto__.__parameterBlocks||
[];b<g.length;b++)this[g[b]]._setClean()};Object.defineProperty(b.prototype,"dirty",{get:function(){return this._dirty||this._checkParameterBlocksDirty()},enumerable:!0,configurable:!0});b.prototype._checkParameterBlocksDirty=function(){for(var b=0,g=this.__proto__.__parameterBlocks||[];b<g.length;b++)if(this[g[b]].dirty)return!0;return!1};return b}();b.MaterialBase=n;n=function(){function b(){this._dirty=!0}b.prototype._setDirty=function(){this._dirty=!0};b.prototype._setClean=function(){this._dirty=
!1};Object.defineProperty(b.prototype,"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0});return b}();b.MaterialParameterBlock=n;b.parameter=function(b){void 0===b&&(b={});return function(k,g){k.__materialParameters=k.__materialParameters||[];k.__materialParameters.push(g);var e="_"+g;if(b.vectorOps){var f=b.vectorOps;Object.defineProperty(k,g,{get:function(){return this[e]},set:function(b){if(this[e]){if(f.equals(this[e],b))return;f.copy(this[e],b)}else this[e]=b;this._setDirty()}})}else Object.defineProperty(k,
g,{get:function(){return this[e]},set:function(f){this[e]!==f&&(b.dispose&&this[e]&&this[e].dispose(),this[e]=f,this._setDirty())}})}};b.parameterBlock=function(){return function(b,k){b.__parameterBlocks=b.__parameterBlocks||[];b.__parameterBlocks.push(k);var g="_"+k;Object.defineProperty(b,k,{get:function(){return this[g]},set:function(b){this[g]!==b&&(this[g]=b,this._setDirty())}})}}})},"esri/views/3d/webgl-engine/core/util/BucketedObjectStore":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper",
"../../lib/AutoDisposable"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function e(){return null!==b&&b.apply(this,arguments)||this}m(e,b);Object.defineProperty(e.prototype,"bucketKey",{get:function(){return this._bucket.key},enumerable:!0,configurable:!0});return e}(k.AutoDisposable);b.BucketStorable=n;n=function(){function b(){this._buckets=new Map;this._count=0}b.prototype.add=function(b,e){b=this._getBucket(b);e._bucket=b;e._bucketIndex=b.count;b._data.push(e);
this._count++};b.prototype.remove=function(b){var e=b._bucket._data,f=e[e.length-1];e[b._bucketIndex]=f;f._bucketIndex=b._bucketIndex;e.pop();this._count--};b.prototype.updateKey=function(b,e){this.remove(b);this.add(e,b)};b.prototype.getBucket=function(b){return this._getBucket(b).data};b.prototype.forEach=function(b){this._buckets.forEach(function(e){b(e.data,e.key)})};Object.defineProperty(b.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0});b.prototype._getBucket=
function(b){var e=this._buckets.get(b);if(e)return e;e=new g(b);this._buckets.set(b,e);return e};return b}();b.BucketedObjectStore=n;var g=function(){function b(b){this.key=b;this._data=[]}Object.defineProperty(b.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"count",{get:function(){return this._data.length},enumerable:!0,configurable:!0});return b}()})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["require",
"exports","../../../../../core/libs/gl-matrix-2/vec3","../../../../../core/libs/gl-matrix-2/vec3f32","../../../../../core/libs/gl-matrix-2/vec3f64"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this._low=k.vec3f32.create();this._high=k.vec3f32.create();b&&this.set(b)}Object.defineProperty(b.prototype,"low",{get:function(){return this._low},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"high",{get:function(){return this._high},
enumerable:!0,configurable:!0});b.prototype.set=function(b){var e=this._low,d=this._high;m.vec3.copy(e,b);m.vec3.sub(d,b,e)};b.prototype.setElements=function(b,f,d){m.vec3.set(e,b,f,d);this.set(e)};b.prototype.get=function(b){return m.vec3.add(b,this._low,this._high)};b.prototype.getLowScaled=function(b){return m.vec3.scale(b,this._low,1)};return b}();b.TwoVectorPosition=n;var e=g.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["require","exports",
"./ManagedTextureBackedBuffer"],function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,e){void 0===e&&(e=1);this.rctx=b;this.fieldCount=e;this.buffers=[]}b.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(b){return 0===b.activeCount?(b.dispose(),!1):!0})};b.prototype.getBuffer=function(b){for(var e=0,f=this.buffers;e<f.length;e++){var g=f[e];if(g.availableCount>=b)return g}if(b>m.MAX_INDEX_COUNT)return null;b=new m.ManagedTextureBackedBuffer(this.rctx,
this.fieldCount);this.buffers.push(b);return b};b.prototype.updateTextures=function(){for(var b=0,e=this.buffers;b<e.length;b++)e[b].textureBuffer.updateTexture()};return b}();b.BufferManager=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["require","exports","./SimpleIndexManager","./TextureBackedBuffer"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.MAX_INDEX_COUNT=65536;n=function(){function g(e,f){void 0===f&&(f=1);
this.textureBuffer=new k.TextureBackedBuffer(e,f);this.indexManager=new m.SimpleIndexManager(b.MAX_INDEX_COUNT)}g.prototype.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};Object.defineProperty(g.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0});g.prototype.acquireIndex=function(){var b=
this.indexManager.acquire();this.textureBuffer.resizeToFit(b);return b};g.prototype.releaseIndex=function(b){this.indexManager.release(b)};return g}();b.ManagedTextureBackedBuffer=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.maxCount=b;this._nextIndex=0;this.recycledIndices=[]}Object.defineProperty(b.prototype,"activeCount",{get:function(){return this._nextIndex-
this.recycledIndices.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0});b.prototype.acquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();if(this.availableCount)return this._nextIndex++};b.prototype.release=function(b){this.recycledIndices.push(b)};return b}();b.SimpleIndexManager=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["require",
"exports","../../../support/buffer/BufferView","../../../../webgl/Texture"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,f){void 0===f&&(f=1);this.rctx=b;this.fieldCount=f;this.textureWidth=4096;this.dirty=!0;this.texture=new k(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new m.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}b.prototype.dispose=function(){this.texture.dispose();
this.data=this.texture=void 0};b.prototype.setData=function(b,f,g,h,d,a){b=b*this.fieldCount+f;this.dirty=!0;this.data.set(b,0,g);this.data.set(b,1,h);this.data.set(b,2,d);this.data.set(b,3,a)};b.prototype.setDataElement=function(b,f,g,h){b=b*this.fieldCount+f;this.dirty=!0;this.data.set(b,g,h)};b.prototype.resizeToFit=function(b){b*=this.fieldCount;b>=this.data.count&&(b=new m.BufferViewVec4u8(new ArrayBuffer(Math.ceil((b+1)/this.textureWidth)*this.textureWidth*4)),b.typedBuffer.set(this.data.typedBuffer),
this.data=b)};b.prototype.updateTexture=function(){if(this.dirty){var b=this.texture.descriptor.width;this.data.count>b*this.texture.descriptor.height&&this.texture.resize(b,this.data.count/b);this.texture.setData(this.data.typedBuffer);this.dirty=!1}};b.prototype.bind=function(b,f){this.rctx.bindTexture(this.texture,f.unit);b.setUniform1i(f.texName,f.unit);b.setUniform2f(f.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return b}();b.TextureBackedBuffer=n})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("require exports ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4 ../../../support/geometryUtils ./AllRenderPasses ./RenderPass ../util/TwoVectorPosition ../../lib/depthRange".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,d){this._renderView=a;this.rctx=b;this.shaderTechniqueRepository=d;this.canRender=!0;this._materialPassParams=new c.MaterialPassesParameters;this._shadowPassParams=new c.ShadowMapPassParameters;this._highlightPassParams=new c.HighlightPassParameters;this._systems=new Set;this._passes=[];this._shadowMapPass=this._registerPass(new q.RenderPass(b,this.shaderTechniqueRepository));this.passes=
{materialOpaque:this._registerPass(new q.RenderPass(b,this.shaderTechniqueRepository)),materialTransparent:this._registerPass(new q.RenderPass(b,this.shaderTechniqueRepository,1)),materialIntegratedMesh:this._registerPass(new q.RenderPass(b,this.shaderTechniqueRepository)),shadowMap:this._shadowMapPass,highlight:this._registerPass(new q.RenderPass(b,this.shaderTechniqueRepository)),highlightIntegratedMesh:this._registerPass(new q.RenderPass(b,this.shaderTechniqueRepository))}}b.prototype.register=
function(a){this._systems.add(a)};b.prototype.prepareRender=function(){var a=this;this._passes.forEach(function(a){return a.prepareSubmit()});var b={camera:this._renderView.getCamera()};this._systems.forEach(function(c){c.submit(a.passes,b)});this._passes.forEach(function(a){return a.finishSubmit()});this.shaderTechniqueRepository.frameUpdate()};b.prototype.render=function(a){if(4===a.slot)switch(this._configure(a),a.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(a);
this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=1;this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2;this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 4:this.passes.highlight.dispatch(this._highlightPassParams);break;case 3:this._shadowMapPass.dispatch(this._shadowPassParams)}if(6===a.slot)switch(this._configure(a),a.pass){case 0:this._materialPassParams.subPass=
0;this._configureMaterialColorPass(a);this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=1;this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2,this.passes.materialTransparent.dispatch(this._materialPassParams)}if(1===a.slot)switch(this._configure(a),a.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(a);this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);
break;case 1:this._materialPassParams.subPass=1;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 4:this.passes.highlightIntegratedMesh.dispatch(this._highlightPassParams)}return!0};b.prototype.notifyDirty=function(){this._renderView.setNeedsRender()};b.prototype.slots=function(){return[4,6,1]};b.prototype.initializeRenderContext=function(){};b.prototype.uninitializeRenderContext=
function(){};b.prototype.queryDepthRange=function(a){var b={near:Infinity,far:-Infinity};this._systems.forEach(function(c){c=c.queryShadowCasterDepthRange(a);m.isSome(c)&&t.union(b,c,b)});return b};Object.defineProperty(b.prototype,"shadowCastingEnabled",{get:function(){return m.isSome(this.passes.shadowMap)},set:function(a){a?(this._materialPassParams.shadowsEnabled=!0,this.passes.shadowMap=this._shadowMapPass):(this._materialPassParams.shadowsEnabled=!1,this.passes.shadowMap=null)},enumerable:!0,
configurable:!0});b.prototype._configureMaterialColorPass=function(a){var b=this;this._materialPassParams.shadowMap={bind:function(c,d){a.shadowMap.bind(c,d);d=b._materialPassParams.viewTransform;l.vec3.add(u,d.worldFromView_TL,d.worldFromView_TH);a.shadowMap.bindView(c,u)}};this._materialPassParams.ambientOcclusion={bind:function(b,c){a.ssaoHelper.setUniforms(b,c)}};this._materialPassParams.ambientOcclusionEnabled=a.ssaoHelper.enabled;this._materialPassParams.sceneHasOcludees=a.hasOccludees};b.prototype._configure=
function(a){this._updateParameters(a,3===a.pass?this._shadowPassParams:4===a.pass?this._highlightPassParams:this._materialPassParams)};b.prototype._updateParameters=function(b,c){var g=b.camera,h=g.viewInverseTransposeMatrix;l.vec3.set(u,h[3],h[7],h[11]);x.set(u);l.vec3.copy(c.viewTransform.worldFromView_TH,x.high);l.vec3.copy(c.viewTransform.worldFromView_TL,x.low);k.mat3.fromMat4(c.viewTransform.viewFromCameraRelative_RS,g.viewMatrix);e.mat4.copy(c.viewTransform.projFromView,g.projectionMatrix);
0===c.identifier?(this._materialPassParams.transparent=6===b.slot,this._materialPassParams.integratedMesh=1===b.slot,this._materialPassParams.lighting=b.scenelightingData,k.mat3.transpose(r,c.viewTransform.viewFromCameraRelative_RS),k.mat3.invert(c.transformNormal_ViewFromGlobal,r),f.vec2.set(c.cameraNearFar,g.near,g.far)):1===c.identifier?f.vec2.set(c.cameraNearFar,g.near,g.far):2===c.identifier&&(c.highlightDepthTexture=b.highlightDepthTexture,d.vec4.copy(c.viewport,g.fullViewport));a.boundedPlane.copy(b.sliceHelper.plane,
c.slicePlane);l.vec3.subtract(c.slicePlane.origin,c.slicePlane.origin,u);c.slicePlaneEnabled=b.sliceHelper.isEnabled};b.prototype._registerPass=function(a){this._passes.push(a);return a};Object.defineProperty(b.prototype,"needsHighlight",{get:function(){return 0<this.passes.highlight.count||0<this.passes.highlightIntegratedMesh.count},enumerable:!0,configurable:!0});return b}();b.RenderPassManager=n;var u=h.vec3f64.create(),r=g.mat3f64.create(),x=new p.TwoVectorPosition})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../support/geometryUtils ../shaderLibrary/attributes/VertexPosition.glsl".split(" "),
function(n,b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});n=function(){return function(){this.identifier=0;this.integratedMesh=this.transparent=!1;this.viewTransform=new f.VertexPosition.ViewProjectionTransform;this.transformNormal_ViewFromGlobal=m.mat3f64.create();this.cameraNearFar=k.vec2f64.create();this.slicePlane=e.boundedPlane.create();this.shadowsEnabled=this.ambientOcclusionEnabled=this.slicePlaneEnabled=!0;this.sceneHasOcludees=!1}}();b.MaterialPassesParameters=n;n=function(){return function(){this.identifier=
1;this.viewTransform=new f.VertexPosition.ViewProjectionTransform;this.cameraNearFar=k.vec2f64.create();this.slicePlane=e.boundedPlane.create()}}();b.ShadowMapPassParameters=n;n=function(){return function(){this.identifier=2;this.viewTransform=new f.VertexPosition.ViewProjectionTransform;this.slicePlane=e.boundedPlane.create();this.viewport=g.vec4f64.create()}}();b.HighlightPassParameters=n})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define(["require","exports","../../../../../core/PooledArray"],
function(n,b,m){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,f,g){void 0===g&&(g=0);this._rctx=b;this._techniqueRepository=f;this._sorting=g;this._draws=new m({initialSize:32,allocator:function(b){return b||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}});this._passBoundTechniques=new Set;this._previouslyBoundMaterials=new Map;this._previouslyBoundDraw=new Map}b.prototype.submitDraw=function(b,f,g,h,d){var a=this._draws.pushNew();
a.geometry=f;a.geometryRanges=g;a.material=b;a.bindDrawParams=h;a.depthSquaredHint=d;a.indexType=f.indexed?f.vao.indexBuffer.indexType:0};b.prototype.dispatch=function(b){var e=this._rctx;this._passBoundTechniques.clear();this._previouslyBoundMaterials.clear();this._previouslyBoundDraw.clear();for(var g=null,h={repository:this._techniqueRepository},d=this._draws.length,a=0;a<d;a++){var c=this._draws.data[a],m=c.geometry,n=c.material.getTechnique(h,b,m.parameters);this._passBoundTechniques.has(n)||
(n.bindPass(e,b),this._passBoundTechniques.add(n));e.bindVAO(m.vao);n!==g&&(e.bindProgram(n.program),e.setPipelineState(n.pipeline),g=n);this._previouslyBoundMaterials.get(n)!==c.material&&(n.bindMaterial(e,c.material,b),this._previouslyBoundMaterials.set(n,c.material));this._previouslyBoundDraw.get(n)!==c.bindDrawParams&&(n.bindDraw(c.bindDrawParams,c.material,b),this._previouslyBoundMaterials.set(n,c.material));if(0!==c.indexType)for(var n=k.get(c.indexType),t=0;t<c.geometryRanges.length;t+=2){var u=
c.geometryRanges[t],r=c.geometryRanges[t+1];e.drawElements(m.primitiveType,r,c.indexType,u*n)}else for(t=0;t<c.geometryRanges.length;t+=2)u=c.geometryRanges[t],r=c.geometryRanges[t+1],e.drawArrays(m.primitiveType,u,r)}};b.prototype.prepareSubmit=function(){this._draws.clear()};b.prototype.finishSubmit=function(){var b=0===this._sorting?1:-1;this._draws.sort(function(e,g){var f=b*(e.depthSquaredHint-g.depthSquaredHint);return 0!==f?f:e.geometry.vao.size-g.geometry.vao.size})};Object.defineProperty(b.prototype,
"count",{get:function(){return this._draws.length},enumerable:!0,configurable:!0});return b}();b.RenderPass=n;var k=new Map;k.set(5121,1);k.set(5123,2);k.set(5125,4)})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define("require exports ../../../../core/maybe ./glUtil3D ../shaders/CompositingTechnique ../../../webgl/Util".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b,d){this._rctx=b;this._techniqueRepository=d;this._techniques=
new Set}b.prototype.dispose=function(){var b=this;this._techniques.forEach(function(d){return b._techniqueRepository.release(d)});this._techniques.clear();m.isSome(this._vao)&&(this._vao.dispose(),this._vao=null)};b.prototype.composite=function(b,d,a){void 0===d&&(d=0);void 0===a&&(a=1);this.compositeInternal(b,d,a,0)};b.prototype.compositeSpecial=function(b,d){this.compositeInternal(b,0,1,d)};b.prototype.compositeInternal=function(b,d,a,c){var h=this._rctx;f.alphaMode=d;f.function=c;f.hasOpacityFactor=
1!==a;d=this._techniqueRepository.acquire(g.CompositingTechnique,f);h.bindProgram(d.program);d.bindPipelineState(h);d.program.setUniform1i("tex",1);f.hasOpacityFactor&&d.program.setUniform1f("opacity",a);h.bindTexture(b,1);b=this.ensureVAO();h.bindVAO(b);h.drawArrays(5,0,e.vertexCount(b,"geometry"));h.bindVAO(null);this._techniqueRepository.release(d)};b.prototype.ensureVAO=function(){m.isNone(this._vao)&&(this._vao=k.createQuadVAO(this._rctx));return this._vao};return b}();b.default=n;var f=new g.CompositingTechniqueConfiguration})},
"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./Compositing.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){Object.defineProperty(b,"__esModule",{value:!0});g=function(b){function f(){return null!==b&&b.apply(this,arguments)||this}m(f,b);f.prototype.initializeProgram=function(b){var c=f.shader.get().build(this.configuration);return new a(b.rctx,c.generateSource("vertex"),c.generateSource("fragment"),h.Default3D)};f.prototype.initializePipeline=function(){if(2===this.configuration.function)return q.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case 0:return q.makePipelineState({colorWrite:q.defaultColorWriteParams});
case 1:return q.makePipelineState({blending:c.separateBlendingParams(770,1,771,771),colorWrite:q.defaultColorWriteParams});default:return q.makePipelineState({blending:c.simpleBlendingParams(1,771),colorWrite:q.defaultColorWriteParams})}};f.shader=new e.ReloadableShaderModule(d,"./Compositing.glsl",n);return f}(f.ShaderTechnique);b.CompositingTechnique=g;g=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.function=0;b.alphaMode=0;b.hasOpacityFactor=!1;return b}m(b,a);k([l.parameter({count:3})],
b.prototype,"function",void 0);k([l.parameter({count:3})],b.prototype,"alphaMode",void 0);k([l.parameter()],b.prototype,"hasOpacityFactor",void 0);return b}(l.ShaderTechniqueConfiguration);b.CompositingTechniqueConfiguration=g})},"esri/views/3d/webgl-engine/shaders/Compositing.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/ScreenSpacePass ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),function(n,
b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var a=new e.ShaderBuilder;a.include(k.ScreenSpacePass);a.fragment.uniforms.add("tex","sampler2D");0===b.function&&(b.hasOpacityFactor?(a.fragment.uniforms.add("opacity","float"),a.fragment.code.add(g.glsl(f||(f=m(["\n      void main() {\n        gl_FragColor \x3d texture2D(tex, uv) * opacity;\n      }"],["\n      void main() {\n        gl_FragColor \x3d texture2D(tex, uv) * opacity;\n      }"]))))):a.fragment.code.add(g.glsl(l||
(l=m(["\n      void main() {\n        gl_FragColor \x3d texture2D(tex, uv);\n      }"],["\n      void main() {\n        gl_FragColor \x3d texture2D(tex, uv);\n      }"])))));2===b.function&&a.fragment.code.add(g.glsl(h||(h=m(["\n    void main() {\n      gl_FragColor \x3d vec4(1.0 - texture2D(tex, uv).a);\n    }"],["\n    void main() {\n      gl_FragColor \x3d vec4(1.0 - texture2D(tex, uv).a);\n    }"]))));return a};var f,l,h})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/TimeProfiler ../../../../core/watchUtils ../../../../core/libs/gl-matrix-2/vec2f64 ../../support/debugFlags ../core/shaderLibrary/hud/HUD.glsl ./BoundingInfo ./depthRange ./depthRangeUtils ./FxaaRenderPass ./glUtil3D ./HighlightHelper ./Material ./OffscreenRenderingHelper ./RenderContext ./rendererUtils ./RenderPluginManager ./renderStats ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/HUDMaterial ../materials/internal/waterMaterialUtils ../../../webgl/Profiling".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L){n=function(){function b(a,b,c,e,f,g,h){var m=this;this._materialRep=a;this._rctx=e;this._compositingHelper=f;this.requestRender=g;this._stage=h;this._materialRenderers=new Map;this._hasOccludees=this._hasHighlights=!1;this._lighting=new H.SceneLighting;this._content=new Map;this._isRendering=!1;this._fallbackDepthStencilTexture=null;this._stats=new A.RenderStatsAggregator;this._antialiasing=1;this._edgeView=null;this._handles=
new k;this.renderHiddenTransparentEdges=function(){};this._shaderTechniqueRepository=c;this._fxaaPass=new t(this._rctx);this._smaaPass=new F(this._rctx);this._bindParameters={slot:null,view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,viewport:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null,highlightDepthTexture:null,hasOccludees:!1};this._offscreenRendering=new w(this._rctx,this._compositingHelper);this._sliceHelper=new C;this._shadowMap=new B(this._rctx);
this._ssaoHelper=new E(c,this._rctx,function(){return m.requestRender()});this._highlightHelper=new r(c,this._rctx);this._renderPlugins=new y.RenderPluginManager({rctx:this._rctx,shaderTechniqueRep:c,textureRep:b,materialRep:this._materialRep,requestRender:this.requestRender});this._renderContext=new v(this._rctx,this._offscreenRendering,this._lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper);this._handles.add(l.init(d,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",function(a){m.renderHiddenTransparentEdges=
a?function(){return m.renderEdges(1)}:function(){};m.requestRender()}))}b.prototype.dispose=function(){this._handles.destroy();this._materialRenderers.forEach(function(a){a.dispose()});this._materialRenderers=null;this._edgeView&&(this._edgeView.destroy(),this._edgeView=null);this._offscreenRendering.enabled=!1;this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null);this._shadowMap&&(this._shadowMap.enabled=!1,this._shadowMap.dispose());
this._ssaoHelper&&(this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose());this._highlightHelper&&(this._highlightHelper.enabled=!1);c.tmpIndices.prune();this._content.clear();this._content=null};Object.defineProperty(b.prototype,"updating",{get:function(){return 1===this._antialiasing&&this._smaaPass.isLoadingResources||I.waterTextureRepo.loading()},enumerable:!0,configurable:!0});b.prototype.ensureEdgeView=function(){var a=this;null==this._edgeView&&(this._edgeView=new G.EdgeView(this._rctx,this._shaderTechniqueRepository,
{setNeedsRender:function(){return a.requestRender()}}),this._edgeView.initialize());return this._edgeView};Object.defineProperty(b.prototype,"edgeView",{get:function(){return this._edgeView},enumerable:!0,configurable:!0});b.prototype.setLighting=function(a){this._lighting.set(a)};b.prototype.setRenderParams=function(a){void 0!==a.shadowMapResolution&&!1===this._shadowMap.enabled&&(this._shadowMap.textureResolution=a.shadowMapResolution);void 0!==a.shadowMap&&(this._shadowMap.enabled=a.shadowMap);
void 0!==a.shadowMapMaxCascades&&(this._shadowMap.maxCascades=a.shadowMapMaxCascades);this._highlightHelper.enabled=!0;void 0!==a.ssao&&(this._ssaoHelper.enabled=a.ssao);void 0!==a.ssaoAttenuation&&(this._ssaoHelper.attenuation=a.ssaoAttenuation);void 0!==a.ssaoRadius&&(this._ssaoHelper.radius=a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&(this._ssaoHelper.samples=a.ssaoSamples);a.background&&
(this._offscreenRendering.background=a.background);void 0!==a.antialiasingEnabled&&(this._antialiasing=a.antialiasingEnabled?1:0);void 0!==a.defaultHighlightOptions&&this._highlightHelper.setDefaultOptions(a.defaultHighlightOptions);void 0!==a.slicePlane&&(this._sliceHelper.plane=a.slicePlane);this.requestRender()};Object.defineProperty(b.prototype,"hasSlicePlane",{get:function(){return!!this._sliceHelper.plane},enumerable:!0,configurable:!0});b.prototype.getRenderParams=function(){var a={};this._shadowMap&&
(a.shadowMap=this._shadowMap.enabled,a.shadowMapResolution=this._shadowMap.textureResolution,a.shadowMapMaxCascades=this._shadowMap.maxCascades);this._ssaoHelper&&this._ssaoHelper.isSupported&&(a.ssao=this._ssaoHelper.enabled,a.ssaoAttenuation=this._ssaoHelper.attenuation,a.ssaoRadius=this._ssaoHelper.radius,a.ssaoFilterRadius=this._ssaoHelper.filterRadius,a.ssaoSamples=this._ssaoHelper.samples);return a};Object.defineProperty(b.prototype,"renderPlugins",{get:function(){return this._renderPlugins},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"canRender",{get:function(){return!0},enumerable:!0,configurable:!0});b.prototype.getStats=function(){return this._stats.getAggregatedStats()};b.prototype.getFramebufferTexture=function(a){switch(a){case "color":return this._offscreenRendering.colorTexture;case "hudVisibility":return this._offscreenRendering.hudVisibilityTexture;case "shadowMap":return this._shadowMap&&this._shadowMap.getDepthTexture();case "linearDepth":return this._offscreenRendering.linearDepthTexture;
case "normals":return this._offscreenRendering.normalTexture;case "highlight":return this._offscreenRendering.highlightTexture;default:return m.neverReached(a),null}};b.prototype.isEmpty=function(){return 0===this._materialRenderers.size};b.prototype.modify=function(a,b,c,d,e,f){var h=this;void 0===b&&(b=a?a.length:0);void 0===d&&(d=c?c.length:0);void 0===f&&(f=e?e.length:0);this._isRendering&&console.warn("Renderer.modify called while rendering");for(var k=0;k<d;++k)this._content.delete(c[k].uniqueName);
for(k=0;k<b;++k)this._content.set(a[k].uniqueName,a[k]);if(b||d||f){var l=!1;z.splitRenderGeometryChangeSetByMaterial({toAdd:a,numToAdd:b,toRemove:c,numToRemove:d,toUpdate:e,numToUpdate:f}).forEach(function(a,b){var c=h._materialRenderers.get(b);!c&&0<a.toAdd.length&&(c=b.createRenderer(h._rctx,h._materialRep),h._materialRenderers.set(b,c));c&&(c.modify(a),c.isEmpty&&(l=!0))});l&&this._materialRenderers.forEach(function(a,b){a.isEmpty&&(h._materialRenderers.delete(b),a.dispose())});this._hasHighlights=
g.someMap(this._materialRenderers,function(a){return a.hasHighlights});this._hasOccludees=g.someMap(this._materialRenderers,function(a){return a.hasOccludees});this.requestRender()}};b.prototype.updateLogic=function(a){var b=!1;this._materialRenderers.forEach(function(c){c.updateLogic&&(b=c.updateLogic(a)||b)});return b};b.prototype.render=function(a){this.renderScene(a);if(this.onPostRender)this.onPostRender()};b.prototype.renderScene=function(b){var c=this;this._isRendering=!0;var d=this._rctx,
e=this._offscreenRendering,f=b.camera,g=b.fbo,h=this._sliceHelper.plane;b.disableSlice&&(this._sliceHelper.plane=null);this._renderPlugins.prepareRender(f);this.renderShadowMap(b);e.enabled=!0;e.initializeFrame(f);this.renderLinearDepth(f);this.renderNormal(f);this._ssaoHelper.enabled&&this._ssaoHelper.computeSSAO(f,e.linearDepthTexture,e.normalTexture);this._ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository);this._stats.reset();this.updateGlobalUniforms(f.projectionMatrix);this._renderContext.pass=
0;this._renderContext.camera=f;this._renderContext.hasOccludees=this._hasOccludees;e.bindFramebuffer();this._renderPlugins.render(0,this._renderContext);this.renderOpaqueGeometry(this._renderContext);this.renderEdges(2);this.renderHiddenTransparentEdges();this.renderTransparentGeometry(this._renderContext);this.renderEdges(1);var k=b=!1;b=this.renderHUDVisibility(this._renderContext);this.renderInternalSlot(20,this._renderContext);(k=this.renderTransparentTerrain(this._renderContext))&&b&&(e.compositeTransparentTerrainOntoHUDVisibility(),
e.renderToTargets(function(){return c.renderHUD(a.HUD.TransparentRenderStyle.OCCLUDED)},e.mainColor,e.tmpDepth,void 0,!0,!0));k&&e.compositeTransparentTerrainOntoMain();e.renderToTargets(function(){c.renderInternalSlot(8,c._renderContext);c._renderPlugins.render(15,c._renderContext);c._renderPlugins.render(16,c._renderContext)},e.mainColor,e.mainDepth);this._renderPlugins.needsLaserlineWithContrastControl&&e.renderAndComposite(function(){c._renderPlugins.render(17,c._renderContext)},2);this.renderOccluded();
this.renderAntiAliasing(g,this._antialiasing);d.bindFramebuffer(g);d.clearSafe(256);this.renderHUD(a.HUD.TransparentRenderStyle.NOTOCCLUDED);this.renderHighlights(f,g);this._sliceHelper.plane=h;this._isRendering=!1};b.prototype.renderEdges=function(a){var b=this,c=this._edgeView;c&&c.shouldRender()&&this._offscreenRendering.renderAndComposite(function(){return c.render(b._bindParameters,a)},1)};b.prototype.renderShadowMap=function(a){var b=this._shadowMap;if(b.enabled){d.ENABLE_PROFILE_DEPTH_RANGE&&
f.begin("depthRange");var c=a.camera,e=a.fbo,g=a.lightDirection,h=this.computeDepthRange(c);d.ENABLE_PROFILE_DEPTH_RANGE&&f.end("depthRange");b.prepare(c,g,h);g=b.getCascades();for(h=0;h<g.length;++h){var k=g[h];k.camera.setGLViewport(this._rctx);this.renderGeometryPass(3,k.camera)}a.camera=c;b.finish(e);c.setGLViewport(this._rctx)}b.bindToAllPrograms(this._shaderTechniqueRepository)};b.prototype.renderLinearDepth=function(a){var b=this;this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth?
this._offscreenRendering.renderToTargets(function(){return b.renderGeometryPass(1,a)},this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth)};b.prototype.renderNormal=function(a){var b=this;this._ssaoHelper.enabled?this._offscreenRendering.renderToTargets(function(){b.renderGeometryPass(2,a)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)};
b.prototype.computeDepthRange=function(a){var b=p.depthRangeFromScene(a,this._content,this._stage.getLayers());q.union(b,this.renderPlugins.queryDepthRange(a));b.near=Math.max(a.near,b.near);b.far=Math.min(a.far,b.far);return b};b.prototype.renderGeometryPass=function(a,b){this.updateGlobalUniforms(b.projectionMatrix);this._renderContext.pass=a;this._renderContext.camera=b;this.renderOpaqueGeometry(this._renderContext);this.renderTransparentGeometry(this._renderContext);this.renderTransparentTerrain(this._renderContext)};
b.prototype.renderOpaqueGeometry=function(a){this._renderPlugins.render(1,a);this._renderPlugins.render(2,a);this.renderInternalSlot(3,a);this._renderPlugins.render(4,a);a.ssaoHelper&&a.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository);this._renderPlugins.render(14,this._renderContext)};b.prototype.renderTransparentGeometry=function(a){this.renderInternalSlot(5,a);this._renderPlugins.render(6,a);a.ssaoHelper&&a.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository)};b.prototype.renderTransparentTerrain=
function(a){return this._renderPlugins.render(7,a)};b.prototype.renderHUDVisibility=function(a){var b=this,c=D.shouldRenderVisibilityDuringRenderPass(a.pass),d=a.offscreenRenderingHelper&&a.offscreenRenderingHelper.enabled,e=!1;c&&d&&a.offscreenRenderingHelper.renderHUDVisibility(function(){e=b.renderInternalSlot(12,a)});return e};b.prototype.renderHUD=function(a){this._bindParameters.renderTransparentlyOccludedHUD=a;this.renderInternalSlot(21,this._renderContext);this.renderInternalSlot(18,this._renderContext);
this.renderInternalSlot(19,this._renderContext)};b.prototype.renderHighlights=function(b,c){var d=this,e=this._highlightHelper;if(e&&e.enabled&&(this._hasHighlights||this._renderPlugins.needsHighlight)){var f=null;e.profilingCallback&&(f=L.startMeasurement(this._renderContext.rctx));var g=this._offscreenRendering;this._renderContext.highlightDepthTexture=this._bindParameters.highlightDepthTexture;g=g.renderToTargets(function(){d.renderGeometryPass(4,b);d._rctx.clearSafe(256);d.renderHUD(a.HUD.TransparentRenderStyle.BOTH)},
g.highlight,g.tmpDepth,[0,0,0,0],!0,!0);e.render(b,g,c);null!==f&&e.profilingCallback&&f.stop(function(a){e.profilingCallback&&e.profilingCallback(a)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};b.prototype.renderOccluded=function(){var a=this,b=0;this._materialRenderers.forEach(function(a,c){c&&c.isVisible()&&8===c.renderOccluded&&(b|=c.renderOccluded,N.push(c))});var c=this._offscreenRendering,d=this._renderContext,e=function(a,d,e,f,h){void 0===e&&(e=function(){return g(d)});
void 0===f&&(f=!0);void 0===h&&(h=!0);0!==(b&d)&&(c.renderToTargets(e,c.tmpColor,c.mainDepth,[0,0,0,0],f,h),c.compositeOccludedOntoMain(a))};0!==N.length&&(this.renderInternalSlot(10,d,N),e(.2,8,function(){return a.renderInternalSlot(11,d,N)},!1,!1),N.length=0);this._materialRenderers.forEach(function(a,c){c&&c.isVisible()&&(4===c.renderOccluded||2===c.renderOccluded||32===c.renderOccluded||16===c.renderOccluded)&&(b|=c.renderOccluded,K.push(c))});var f=this._renderPlugins.renderOccludedFlags;if(b|=
f){var g=function(b){d.renderOccludedMask=b;1<f&&a._renderPlugins.render(9,d);a.renderInternalSlot(3,d,K);a.renderInternalSlot(5,d,K);a.renderInternalSlot(8,d,K);d.resetRenderOccludedMask()};d.pass=0;e(.5,4,function(){return g(4)},!0,2);e(.5,2,function(){return g(2)},!0,2);e(1,48,function(){g(16);g(32)},!0,2);K.length=0}};b.prototype.renderAntiAliasing=function(a,b){var c=this;switch(b){case 1:this._smaaPass.loadResources(function(){return c.requestRender()});this._smaaPass.enable()?(this._fxaaPass.disable(),
this._smaaPass.render({colorTexture:this._offscreenRendering.colorTexture},a)):(this._rctx.bindFramebuffer(a),this._offscreenRendering.composite());break;case 2:this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:this._offscreenRendering.colorTexture},a)):(this._rctx.bindFramebuffer(a),this._offscreenRendering.composite());break;default:this._rctx.bindFramebuffer(a),this._offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable()}};b.prototype.renderInternalSlot=
function(a,b,c){this._bindParameters.slot=a;this._bindParameters.view=b.camera.viewMatrix;this._bindParameters.proj=b.camera.projectionMatrix;this._bindParameters.viewInvTransp=b.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=b.camera.aboveGround;this._bindParameters.fovY=b.camera.fovY;O[0]=b.camera.near;O[1]=b.camera.far;var d=this._renderContext.offscreenRenderingHelper;this._bindParameters.nearFar=O;this._bindParameters.viewport=b.camera.fullViewport;this._bindParameters.shadowMap=
b.shadowMap;this._bindParameters.shadowMappingEnabled=!!b.shadowMap&&b.shadowMap.enabled;this._bindParameters.ssaoEnabled=!!b.ssaoHelper&&b.ssaoHelper.enabled;this._bindParameters.pixelRatio=b.camera.pixelRatio;this._bindParameters.slicePlane=b.sliceHelper&&b.sliceHelper.plane;this._bindParameters.hasOccludees=b.hasOccludees;this._bindParameters.hudVisibilityTexture=d?d.hudVisibilityTexture:null;this._bindParameters.highlightDepthTexture=d&&d.depthTexture||this.getFallbackDepthTexture();return this.renderInternalSlotMaterials(a,
b,c)};b.prototype.renderInternalSlotMaterials=function(a,b,c){var d=this,f=0===b.pass?this._stats:null,g=!1;e.isSome(c)?c.forEach(function(c){x.materialPredicate(c,b)&&(c=d._materialRenderers.get(c),e.isSome(c)&&(g=c.render(a,b,d._bindParameters)||g))}):this._materialRenderers.forEach(function(c,e){x.materialPredicate(e,b)&&(e=f?f.getMaterialRenderStatsObject(c.type):null,g=c.render(a,b,d._bindParameters,e)||g)});return g};b.prototype.updateGlobalUniforms=function(a){for(var b=this._shaderTechniqueRepository.getProgramsUsingUniform("proj"),
c=0;c<b.length;c++)b[c].setUniformMatrix4fv("proj",a);if(this._lighting)for(b=this._shaderTechniqueRepository.getProgramsUsingUniform("lightingMainDirection"),c=0;c<b.length;c++)this._lighting.setUniforms(b[c])};b.prototype.getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=u.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};b.prototype.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():
0,highlights:this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0,shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.getGpuMemoryUsage():0}};Object.defineProperty(b.prototype,"test",{get:function(){return{antialiasing:this._antialiasing}},enumerable:!0,configurable:!0});return b}();var O=h.vec2f64.create(),K=[],N=[];return n})},"esri/core/TimeProfiler":function(){define(["require","exports"],function(n,b){n=function(){function b(b,g){void 0===
g&&(g=.9);this._alpha=.9;this._name=b;this._alpha=g;this.reset()}b.prototype.reset=function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};Object.defineProperty(b.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"average",{get:function(){return 0<this._count?this._sum/this._count:0},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0});b.prototype.begin=function(){this._startTime=performance.now()};b.prototype.end=function(){var b=performance.now()-this._startTime;this._count+=1;this._sum+=b;
this._smooth=this._alpha*b+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,b);this._max=Math.max(this._max,b)};b.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};return b}();(function(b){function k(f){f in e||(e[f]=new b(f));return e[f]}function g(b){console.log(k(b).toJSON())}var e={},f={};b.get=k;b.begin=function(b){k(b).begin()};b.end=function(b,e){void 0===e&&(e=!0);k(b).end();var d=performance.now();
!e||b in f&&!(d>=f[b]+1E3)||(g(b),f[b]=d)};b.log=g;b.logAll=function(){for(var b in e)g(b)}})(n||(n={}));return n})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ./ComponentUtils ./depthRange ./Util".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){function t(a,b){if(b.isVisible){var c=q.empty(),d=b.getObjects();b.getSpatialQueryAccelerator()?u(c,a,b.getSpatialQueryAccelerator()):r(c,a,d);return c}}function u(a,b,c){var d=b.eye,e=b.viewForward,f=b.frustum,g=function(a){return!a.isHidden()},h=c.objectCount;500>h?(q.set(C,b.near,Math.min(a.near,b.far)),c.forEachInDepthRange(d,e,"front-to-back",C,function(c,d){x(a,b,c);C.far=a.near;d.setRange(C)},f,g),q.set(C,Math.max(a.far,b.near),b.far),c.forEachInDepthRange(d,
e,"back-to-front",C,function(c,d){x(a,b,c);C.near=a.far;d.setRange(C)},f,g)):(h=Math.max(Math.min(h,500),Math.ceil(.1*h)),d=c.findClosest(e,"front-to-back",f,g,h),c=c.findClosest(e,"back-to-front",f,g,h),d&&c&&(v(a,b,d.getCenter(),d.getBSRadius()),v(a,b,c.getCenter(),c.getBSRadius())))}function r(a,b,c){F.clear();c.forEach(function(a){a.isHidden()||F.add(a)});F.empty||(F.sort(b),q.set(C,b.near,Math.min(a.near,b.far)),F.forEachInDepthRange(C,"front-to-back",function(c,d){d<a.near&&x(a,b,c)}),q.set(C,
Math.max(a.far,b.near),b.far),F.forEachInDepthRange(C,"back-to-front",function(b,c,d){a.far=Math.max(a.far,d)}))}function x(b,c,e){if(!e.isHidden()&&d.frustum.intersectsSphere(c.frustum.planes,d.sphere.wrap(e.getBSRadius(),e.getCenter()))){var f=e.objectTransformation,g=B;e.geometryRecords.forEach(function(d){k.mat4.multiply(g,f,d.getShaderTransformation());var e=a.maxScale(g);w(b,c,d.geometry.boundingInfo,g,e)})}}function w(a,b,c,f,g){var h=b.eye,k=b.viewForward;e.vec3.transformMat4(A,c.center,f);
h=k[0]*(A[0]-h[0])+k[1]*(A[1]-h[1])+k[2]*(A[2]-h[2]);k=c.bsRadius*g;if(!(h-k>a.near&&h+k<a.far)&&d.frustum.intersectsSphere(b.frustum.planes,d.sphere.wrap(k,A)))if(100<c.bsRadius&&c.getChildren())for(c=c.getChildren(),h=0;8>h;++h)c[h]&&w(a,b,c[h],f,g);else G.unionDepthRangeWithAABB(a,b.viewProjectionMatrix,f,c.bbMin,c.bbMax)}function v(a,b,c,d){var e=b.eye;b=b.viewForward;c=(c[0]-e[0])*b[0]+(c[1]-e[1])*b[1]+(c[2]-e[2])*b[2];a.near=Math.min(a.near,c-d);a.far=Math.max(a.far,c+d)}Object.defineProperty(b,
"__esModule",{value:!0});b.depthRangeFromScene=function(a,b,c){if(1E4>b.size)return E.compute(a,b);var d=q.empty();c.forEach(function(b){b.isVisible&&q.union(d,t(a,b))});return d};b.depthRangeFromLayer=t;n=function(){function a(){this._items=new m({allocator:function(a){return a||{obj:null,distance:0,near:0,far:0}},deallocator:function(a){a.obj=null;a.distance=0;a.near=0;a.far=0;return a}})}Object.defineProperty(a.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this._items.clear()};a.prototype.add=function(a){this._items.pushNew().obj=a};a.prototype.sort=function(a){var b=a.eye,c=a.viewForward;this._items.forEach(function(a){var d=a.obj,e=d.getCenter(),d=d.getBSRadius(),e=(e[0]-b[0])*c[0]+(e[1]-b[1])*c[1]+(e[2]-b[2])*c[2];a.distance=e;a.near=e-d;a.far=e+d});this._items.sort(function(a,b){return a.distance-
b.distance})};a.prototype.forEachInDepthRange=function(a,b,c){if("front-to-back"===b)for(b=0;b<this._items.length;++b){var d=this._items.data[b];d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)}else for(b=this._items.length-1;0<=b;--b)d=this._items.data[b],d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)};return a}();var z=function(){function b(){this.view=g.mat4f64.create();this.viewProj=g.mat4f64.create();this.frustum=d.frustum.create();this.geometries=[];this.near=[];this.far=[];this.nearCandidates=
[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}b.prototype.compute=function(a,b){var e=this;this.reset();k.mat4.copy(this.view,a.viewMatrix);k.mat4.multiply(this.viewProj,a.projectionMatrix,this.view);d.frustum.copy(a.frustum,this.frustum);a=this.view;var f=a[2],g=a[6],h=a[10],l=a[14];a=this.range;var m=0;b.forEach(function(a){if(!c.isAllHidden(a.instanceParameters.componentVisibilities,a.componentOffsets)&&a.castShadow){var b,d;a.hasShaderTransformation?(b=a.getBoundingSphere(a.getShaderTransformation(),
1,A),d=A):(b=a.bsRadius,d=a.center);d=f*d[0]+g*d[1]+h*d[2]+l;e.geometries[m]=a;e.near[m]=-(d+b);e.far[m]=-(d-b);++m}});if(0===this.geometries.length)return a;for(b=0;b<this.geometries.length;++b)this.near[b]>a.far&&(a.far=this.near[b]),2<this.near[b]&&this.far[b]<a.near&&(a.near=this.far[b]);var n=this.looseRange;n.near=Math.max(.5*a.near,2);n.far=2*a.far;var p=0,r=0;for(b=0;b<this.geometries.length;++b)this.near[b]<a.near&&(this.near[b]>=n.near?a.near=this.near[b]:this.nearCandidates[p++]=b),this.far[b]>
a.far&&(this.far[b]<=n.far?a.far=this.far[b]:this.farCandidates[r++]=b);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return a;this.nearCandidates.sort(function(a,b){return e.near[a]<e.near[b]?-1:e.near[a]>e.near[b]?1:0});this.farCandidates.sort(function(a,b){return e.far[a]<e.far[b]?1:e.far[a]>e.far[b]?-1:0});for(b=0;b<this.nearCandidates.length;++b)n=this.nearCandidates[b],this.near[n]<a.near&&(n=this.geometries[n],p=n.boundingInfo,this.includeNearBoundingInfoRec(p,n.getShaderTransformation()));
for(b=0;b<this.farCandidates.length;++b)n=this.farCandidates[b],this.far[n]>a.far&&(n=this.geometries[n],p=n.boundingInfo,this.includeFarBoundingInfoRec(p,n.getShaderTransformation()));return a};b.prototype.reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};b.prototype.includeNearBoundingInfoRec=function(b,c){var d=b.getBSRadius(),f=b.getCenter();
e.vec3.transformMat4(A,f,c);var g=a.maxScale(c),f=A[0],h=A[1],k=A[2],d=d*g,g=this.frustum.planes;if(!(g[0][0]*f+g[0][1]*h+g[0][2]*k+g[0][3]>d||g[1][0]*f+g[1][1]*h+g[1][2]*k+g[1][3]>d||g[2][0]*f+g[2][1]*h+g[2][2]*k+g[2][3]>d||g[3][0]*f+g[3][1]*h+g[3][2]*k+g[3][3]>d||(f=this.view[2]*f+this.view[6]*h+this.view[10]*k+this.view[14],h=f+d,2>-(f-d)||-h>=this.range.near)))if(-h>this.looseRange.near)this.range.near=-h;else{if(100<d&&(d=b.getChildren(),void 0!==d)){for(b=0;8>b;++b)void 0!==d[b]&&this.includeNearBoundingInfoRec(d[b],
c);return}G.unionDepthRangeWithAABB(this.range,this.viewProj,c,b.getBBMin(),b.getBBMax())}};b.prototype.includeFarBoundingInfoRec=function(b,c){var d=b.getBSRadius(),f=b.getCenter();e.vec3.transformMat4(A,f,c);var g=a.maxScale(c),f=A[0],h=A[1],k=A[2],d=d*g,g=this.frustum.planes;if(!(g[0][0]*f+g[0][1]*h+g[0][2]*k+g[0][3]>d||g[1][0]*f+g[1][1]*h+g[1][2]*k+g[1][3]>d||g[2][0]*f+g[2][1]*h+g[2][2]*k+g[2][3]>d||g[3][0]*f+g[3][1]*h+g[3][2]*k+g[3][3]>d||(f=this.view[2]*f+this.view[6]*h+this.view[10]*k+this.view[14]-
d,-f<=this.range.far)))if(-f<this.looseRange.far)this.range.far=-f;else{if(100<d&&(d=b.getChildren(),void 0!==d)){for(b=0;8>b;++b)void 0!==d[b]&&this.includeFarBoundingInfoRec(d[b],c);return}G.unionDepthRangeWithAABB(this.range,this.viewProj,c,b.getBBMin(),b.getBBMax())}};return b}();b.DepthRangeFromRenderGeometries=z;b=function(){function a(){this.modelViewProj=g.mat4f64.create();this.clipPosition=[h.vec4f64.create(),h.vec4f64.create(),h.vec4f64.create(),h.vec4f64.create(),h.vec4f64.create(),h.vec4f64.create(),
h.vec4f64.create(),h.vec4f64.create()]}a.prototype.unionDepthRangeWithAABB=function(a,b,c,d,e){var f=this.modelViewProj;k.mat4.multiply(f,b,c);b=!1;for(c=0;8>c;++c){var g=this.clipPosition[c],h=0===c||3===c||4===c||7===c?d[0]:e[0],l=0===c||1===c||4===c||5===c?d[1]:e[1],m=4>c?d[2]:e[2];g[0]=f[0]*h+f[4]*l+f[8]*m+f[12];g[1]=f[1]*h+f[5]*l+f[9]*m+f[13];g[2]=f[2]*h+f[6]*l+f[10]*m+f[14];g[3]=f[3]*h+f[7]*l+f[11]*m+f[15]}for(c=0;12>c;++c){d=this.clipTriangle(this.clipPosition[y[c][0]],this.clipPosition[y[c][1]],
this.clipPosition[y[c][2]]);e=!0;for(f=0;f<d.length;++f)if(g=d[f][3],2<=g){e=!1;break}if(!e)for(b=!0,f=0;f<d.length;++f)g=d[f][3],g<a.near&&(a.near=g),g>a.far&&(a.far=g)}return b};a.prototype.inside=function(a,b){if(0===b)return a[0]>=-a[3];if(1===b)return a[1]>=-a[3];if(2===b)return a[0]<=a[3];if(3===b)return a[1]<=a[3];p.assert(!1)};a.prototype.intersect=function(a,b,c){var d=0;0===c?d=(-a[3]-a[0])/(b[0]-a[0]+b[3]-a[3]):1===c?d=(-a[3]-a[1])/(b[1]-a[1]+b[3]-a[3]):2===c?d=(a[3]-a[0])/(b[0]-a[0]-b[3]+
a[3]):3===c&&(d=(a[3]-a[1])/(b[1]-a[1]-b[3]+a[3]));return l.vec4.lerp(h.vec4f64.create(),a,b,d)};a.prototype.clipTriangle=function(a,b,c){a=[a,b,c];for(b=0;4>b;++b){c=a;a=[];for(var d=0;d<c.length;++d){var e=c[d],f=c[(d+1)%c.length];this.inside(f,b)?(this.inside(e,b)||a.push(this.intersect(e,f,b)),a.push(f)):this.inside(e,b)&&a.push(this.intersect(e,f,b))}}return a};return a}();var y=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],A=f.vec3f64.create(),
B=g.mat4f64.create(),C=q.empty(),F=new n,E=new z,G=new b})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define("require exports ../../../../core/maybe ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/VertexArrayObject".split(" "),function(n,b,m,k,g,e,f,l){return function(){function b(b){this.isEnabled=!1;this.vertexAttributeLocations={position:0};this.rctx=b}b.prototype.enable=function(){if(this.isEnabled)return!0;
var b=this.rctx;this.program=new e(b,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }","\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);this.pipelineState=f.makePipelineState({colorWrite:f.defaultColorWriteParams});var a=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new l(b,this.vertexAttributeLocations,{geometry:k.Pos2},{geometry:new g(b,34962,35044,a)});return this.isEnabled=!0};b.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};b.prototype.render=function(b,a){this.enable();var c=this.rctx;c.bindVAO(this.vao);
c.bindFramebuffer(a);var d=0,e=0;m.isSome(a)?(d=a.descriptor.width,e=a.descriptor.height):(d=c.gl.canvas.width,e=c.gl.canvas.height);c.bindProgram(this.program);c.setPipelineState(this.pipelineState);c.bindTexture(b.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/d,1/e);c.drawArrays(4,0,3)};return b}()})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f32 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/HighlightTechnique ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t){return function(){function b(b,c){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=c;this.viewportToRestore=g.vec4f64.create();this.defaultOptions={color:k.vec4f32.fromValues(1,0,1,1),haloColor:k.vec4f32.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05};c=new a.HighlightCompositionTechniqueConfiguration;
c.highlightStage=0;c.gridOptimization=!1;this.blurTechnique=b.acquireAndReleaseExisting(a.HighlightCompositionTechnique,c,this.blurTechnique);c.highlightStage=0;c.gridOptimization=!0;this.blurGridTechnique=b.acquireAndReleaseExisting(a.HighlightCompositionTechnique,c,this.blurGridTechnique);c.highlightStage=1;c.gridOptimization=!1;this.applyTechnique=b.acquireAndReleaseExisting(a.HighlightCompositionTechnique,c,this.applyTechnique);c.highlightStage=1;c.gridOptimization=!0;this.applyGridTechnique=
b.acquireAndReleaseExisting(a.HighlightCompositionTechnique,c,this.applyGridTechnique);c.highlightStage=2;c.gridOptimization=!1;this.downsampleTechnique=b.acquireAndReleaseExisting(a.HighlightCompositionTechnique,c,this.downsampleTechnique)}Object.defineProperty(b.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"profilingCallback",{get:function(){return e.HIGHLIGHTS_PROFILE_TO_CONSOLE?
function(a){return console.log(a)}:null},enumerable:!0,configurable:!0});b.prototype.setDefaultOptions=function(a){this.defaultOptions=a};b.prototype.render=function(a,b,c){var f=a.pixelRatio,g=!e.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,h=this._rctx;d.assert(this.enabled);m.vec4.copy(this.viewportToRestore,a.fullViewport);var k=Math.ceil(a.fullWidth/f),f=Math.ceil(a.fullHeight/f);this.blur0Fbo.resize(k,f);this.blur1Fbo.resize(k,f);h.bindVAO(this.quadVAO);var l=a=null;g&&(this._gridUpdateResources(b,
32),this._gridComputeMipmap());g?(a=this._grid.vao,l=this.blurGridTechnique,h.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,1),l.program.setUniform1i("coverageTex",1)):(a=this.quadVAO,l=this.blurTechnique);l.bindPipelineState(h);h.bindProgram(l.program);h.bindVAO(a);h.bindFramebuffer(this.blur0Fbo);h.setViewport(0,0,k,f);h.setClearColor(0,0,0,0);h.clear(16384);l.program.setUniform1i("tex",0);h.bindTexture(b.colorTexture,0);l.program.setUniform2f("blurSize",1/k,0);h.drawArrays(l.primitiveType,
0,p.vertexCount(a,"geometry"));h.bindFramebuffer(this.blur1Fbo);h.clear(16384);h.bindTexture(this.blur0Fbo.colorTexture,0);l.program.setUniform2f("blurSize",0,1/f);h.drawArrays(l.primitiveType,0,p.vertexCount(a,"geometry"));k=g?this.applyGridTechnique:this.applyTechnique;h.bindFramebuffer(c);k.bindPipelineState(h);h.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);h.bindProgram(k.program);h.bindTexture(this.blur1Fbo.colorTexture,
0);h.bindTexture(b.colorTexture,1);g&&h.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2);k.bindApplyPass(this.defaultOptions);h.drawArrays(k.primitiveType,0,p.vertexCount(a,"geometry"));h.bindVAO(null)};b.prototype.enable=function(){if(!this.enabled){this.quadVAO=h.createQuadVAO(this._rctx);var a={colorTarget:0,depthStencilTarget:0,width:0,height:0},b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=new q(this._rctx,
a,b);this.blur1Fbo=new q(this._rctx,a,b)}};b.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};b.prototype._gridUpdateResources=function(a,b){var d=this._rctx,e=this._grid,g=!1;null===e.coverageMipmap&&(e.coverageMipmap=[a],g=!0);if(e.viewportWidth!==a.width||e.viewportHeight!==a.height)g=!0,e.viewportWidth=a.width,e.viewportHeight=a.height;e.coverageMipmap[0]=a;e.cellPixelSize!==b&&
(e.cellPixelSize=b,g=!0);if(g){for(b=1;b<e.coverageMipmap.length;b++)e.coverageMipmap[b].dispose();e.mipmapLevels=Math.ceil(Math.log(e.cellPixelSize)*Math.LOG2E);e.coverageMipmap.length=e.mipmapLevels+1;for(b=0;b<e.mipmapLevels;b++)g=e.coverageMipmap[b],g=new q(d,{colorTarget:0,depthStencilTarget:0,width:Math.ceil(g.width/2),height:Math.ceil(g.height/2)},{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(g.width/2),height:Math.ceil(g.height/2)}),e.coverageMipmap[b+
1]=g}var g=Math.ceil(a.height/e.cellPixelSize),h=Math.ceil(a.width/e.cellPixelSize);if(!e.vao||e.verticalCellCount!==g||e.horizontalCellCount!==h){e.verticalCellCount=g;e.horizontalCellCount=h;a=g+1;b=h+1;for(var g=1/g,h=1/h,k=new Float32Array(24*a*b),m=0,n=0;n<a;n++)for(var p=0;p<b;p++)k[m+0]=(p-.5)*h*2-1,k[m+1]=(n-.5)*g*2-1,k[m+2]=p*h,k[m+3]=n*g,k[m+4]=(p+.5)*h*2-1,k[m+5]=(n-.5)*g*2-1,k[m+6]=p*h,k[m+7]=n*g,k[m+8]=(p-.5)*h*2-1,k[m+9]=(n+.5)*g*2-1,k[m+10]=p*h,k[m+11]=n*g,k[m+12]=(p-.5)*h*2-1,k[m+
13]=(n+.5)*g*2-1,k[m+14]=p*h,k[m+15]=n*g,k[m+16]=(p+.5)*h*2-1,k[m+17]=(n-.5)*g*2-1,k[m+18]=p*h,k[m+19]=n*g,k[m+20]=(p+.5)*h*2-1,k[m+21]=(n+.5)*g*2-1,k[m+22]=p*h,k[m+23]=n*g,m+=24;e.vao&&e.vao.dispose(!0);e.vao=new t(d,f.Default3D,{geometry:l.Pos2Tex},{geometry:c.createVertex(d,35044,k)})}};b.prototype._gridComputeMipmap=function(){var a=this._rctx,b=this._grid,c=this.downsampleTechnique.program;this.downsampleTechnique.bindPipelineState(a);a.bindVAO(this.quadVAO);for(var d=0;d<b.mipmapLevels;d++){a.bindFramebuffer(b.coverageMipmap[d+
1]);a.bindTexture(b.coverageMipmap[d].colorTexture,0);var e=b.coverageMipmap[d+1].width,f=b.coverageMipmap[d+1].height;a.bindProgram(c);c.setUniform1i("tex",0);c.setUniform2f("invFramebufferDim",1/e,1/f);a.setViewport(0,0,e,f);a.drawArrays(5,0,p.vertexCount(this.quadVAO,"geometry"))}};b.prototype.getGpuMemoryUsage=function(){var a=p.getGpuMemoryUsage(this.blur0Fbo)+p.getGpuMemoryUsage(this.blur1Fbo);if(this._grid&&this._grid.coverageMipmap)for(var b=0,c=this._grid.coverageMipmap;b<c.length;b++)a+=
p.getGpuMemoryUsage(c[b]);return a};return b}()})},"esri/views/3d/webgl-engine/shaders/HighlightTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./HighlightComposition.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){Object.defineProperty(b,"__esModule",{value:!0});g=function(b){function f(){return null!==b&&b.apply(this,arguments)||this}m(f,b);f.prototype.initializeProgram=function(b){var c=f.shader.get().build(this.configuration);return new a(b.rctx,c.generateSource("vertex"),c.generateSource("fragment"),h.Default3D)};f.prototype.bindApplyPass=function(a){this.program.setUniform1i("tex",0);this.program.setUniform1i("origin",1);this.configuration.gridOptimization&&this.program.setUniform1i("coverageTex",
2);this.program.setUniform4fv("color",a.color);this.program.setUniform4fv("haloColor",a.haloColor);this.program.setUniform1f("outlineSize",8.6);this.program.setUniform1f("blurSize",.4);this.program.setUniform4f("opacities",a.haloOpacity,a.haloOpacityOccluded,a.fillOpacity,a.fillOpacityOccluded)};f.prototype.initializePipeline=function(){return 1===this.configuration.highlightStage?q.makePipelineState({blending:c.separateBlendingParams(770,1,771,771),colorWrite:q.defaultColorWriteParams}):q.makePipelineState({colorWrite:q.defaultColorWriteParams})};
Object.defineProperty(f.prototype,"primitiveType",{get:function(){return this.configuration.gridOptimization?4:5},enumerable:!0,configurable:!0});f.shader=new e.ReloadableShaderModule(d,"./HighlightComposition.glsl",n);return f}(f.ShaderTechnique);b.HighlightCompositionTechnique=g;g=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.highlightStage=0;b.gridOptimization=!1;return b}m(b,a);k([l.parameter({count:3})],b.prototype,"highlightStage",void 0);k([l.parameter()],b.prototype,
"gridOptimization",void 0);return b}(l.ShaderTechniqueConfiguration);b.HighlightCompositionTechniqueConfiguration=g})},"esri/views/3d/webgl-engine/shaders/HighlightComposition.glsl":function(){define(["require","exports","../../../../core/tsSupport/makeTemplateObjectHelper","../core/shaderModules/interfaces","../core/shaderModules/ShaderBuilder"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var n=new g.ShaderBuilder,r=n.vertex.code,v=n.fragment.code;n.attributes.add("position",
"vec2");2===b.highlightStage&&(r.add(k.glsl(e||(e=m(["\n    void main() {\n      gl_Position \x3d vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);\n    }"],["\n    void main() {\n      gl_Position \x3d vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);\n    }"])))),n.fragment.uniforms.add("tex","sampler2D"),n.fragment.uniforms.add("invFramebufferDim","vec2"),v.add(k.glsl(f||(f=m(["\n      void main() {\n        vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\n        vec4 value \x3d texture2D(tex, coord);\n        float mx \x3d floor(max(value.g, value.b));\n        gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\n      }"],
["\n      void main() {\n        vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\n        vec4 value \x3d texture2D(tex, coord);\n        float mx \x3d floor(max(value.g, value.b));\n        gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\n      }"])))));0===b.highlightStage&&(n.attributes.add("uv0","vec2"),b.gridOptimization?(n.vertex.uniforms.add("coverageTex","sampler2D"),n.fragment.uniforms.add("blurSize","vec2"),n.varyings.add("blurCoordinate","vec3")):(n.vertex.uniforms.add("blurSize",
"vec2"),n.varyings.add("blurCoordinates[5]","vec2")),r.add(k.glsl(d||(d=m(["\n    void main() {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      ","\n    }"],["\n    void main() {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      ","\n    }"])),b.gridOptimization?k.glsl(l||(l=m(["\n      vec4 cov \x3d texture2D(coverageTex, uv0);\n      if (cov.r \x3d\x3d 0.0) {\n        gl_Position \x3d vec4(0.0);\n      }\n      blurCoordinate \x3d vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));\n      "],
["\n      vec4 cov \x3d texture2D(coverageTex, uv0);\n      if (cov.r \x3d\x3d 0.0) {\n        gl_Position \x3d vec4(0.0);\n      }\n      blurCoordinate \x3d vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));\n      "]))):k.glsl(h||(h=m(["\n      vec2 uv \x3d position.xy * 0.5 + vec2(0.5);\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n          "],
["\n      vec2 uv \x3d position.xy * 0.5 + vec2(0.5);\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n          "]))))),n.fragment.uniforms.add("tex","sampler2D"),v.add(k.glsl(q||(q=m(["\n    void main() {\n      ","\n    }"],["\n    void main() {\n      ","\n    }"])),b.gridOptimization?
k.glsl(a||(a=m(["\n          vec2 uv \x3d blurCoordinate.xy;\n          vec4 center \x3d texture2D(tex, uv);\n\n          // do not blur if no pixel or all pixels in neighborhood are set\n          if (blurCoordinate.z \x3d\x3d 1.0) {\n            gl_FragColor \x3d center;\n          } else {\n            vec4 sum \x3d vec4(0.0);\n            sum +\x3d center * 0.204164;\n            sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n            sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n            gl_FragColor \x3d sum;\n          }"],
["\n          vec2 uv \x3d blurCoordinate.xy;\n          vec4 center \x3d texture2D(tex, uv);\n\n          // do not blur if no pixel or all pixels in neighborhood are set\n          if (blurCoordinate.z \x3d\x3d 1.0) {\n            gl_FragColor \x3d center;\n          } else {\n            vec4 sum \x3d vec4(0.0);\n            sum +\x3d center * 0.204164;\n            sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n            sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n            gl_FragColor \x3d sum;\n          }"]))):
k.glsl(c||(c=m(["\n          vec4 sum \x3d vec4(0.0);\n          sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n          sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n          sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n          gl_FragColor \x3d sum;"],["\n          vec4 sum \x3d vec4(0.0);\n          sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n          sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n          sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n          gl_FragColor \x3d sum;"]))))));
1===b.highlightStage&&(n.varyings.add("uv","vec2"),b.gridOptimization&&(n.attributes.add("uv0","vec2"),n.vertex.uniforms.add("coverageTex","sampler2D")),r.add(k.glsl(t||(t=m(["\n      void main() {\n        ","\n        gl_Position \x3d vec4(position, 0.0, 1.0);\n        uv \x3d position.xy * 0.5 + vec2(0.5);\n      }"],["\n      void main() {\n        ","\n        gl_Position \x3d vec4(position, 0.0, 1.0);\n        uv \x3d position.xy * 0.5 + vec2(0.5);\n      }"])),b.gridOptimization?k.glsl(p||
(p=m(["\n            vec4 cov \x3d texture2D(coverageTex, uv0);\n            // if no highlight pixel set in this block, hide block\n            if (cov.r \x3d\x3d 0.0) {\n              gl_Position \x3d vec4(0.0);\n              return;\n            }"],["\n            vec4 cov \x3d texture2D(coverageTex, uv0);\n            // if no highlight pixel set in this block, hide block\n            if (cov.r \x3d\x3d 0.0) {\n              gl_Position \x3d vec4(0.0);\n              return;\n            }"]))):
"")),n.fragment.uniforms.add("tex","sampler2D"),n.fragment.uniforms.add("origin","sampler2D"),n.fragment.uniforms.add("color","vec4"),n.fragment.uniforms.add("haloColor","vec4"),n.fragment.uniforms.add("outlineSize","float"),n.fragment.uniforms.add("blurSize","float"),n.fragment.uniforms.add("opacities","vec4"),v.add(k.glsl(u||(u=m(["\n      void main() {\n        // Read the highlight intensity from the blurred highlight image\n        vec4 blurredHighlightValue \x3d texture2D(tex, uv);\n        float highlightIntensity \x3d blurredHighlightValue.a;\n\n        // Discard all pixels which are not affected by highlight\n        if (highlightIntensity \x3d\x3d 0.0) {\n          discard;\n        }\n\n        vec4 origin_color \x3d texture2D(origin, uv);\n\n        float outlineIntensity;\n        float fillIntensity;\n\n        // if occluded\n        if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\n          outlineIntensity \x3d haloColor.w * opacities[1];\n          fillIntensity \x3d color.w * opacities[3];\n        }\n        // if unoccluded\n        else {\n          outlineIntensity \x3d haloColor.w * opacities[0];\n          fillIntensity \x3d color.w * opacities[2];\n        }\n\n        float inner \x3d 1.0 - outlineSize / 9.0;\n        float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\n\n        float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\n        //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\n        float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n        float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n        // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n        // I.e., color should not be premultiplied with alpha\n        gl_FragColor \x3d vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);\n      }"],
["\n      void main() {\n        // Read the highlight intensity from the blurred highlight image\n        vec4 blurredHighlightValue \x3d texture2D(tex, uv);\n        float highlightIntensity \x3d blurredHighlightValue.a;\n\n        // Discard all pixels which are not affected by highlight\n        if (highlightIntensity \x3d\x3d 0.0) {\n          discard;\n        }\n\n        vec4 origin_color \x3d texture2D(origin, uv);\n\n        float outlineIntensity;\n        float fillIntensity;\n\n        // if occluded\n        if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\n          outlineIntensity \x3d haloColor.w * opacities[1];\n          fillIntensity \x3d color.w * opacities[3];\n        }\n        // if unoccluded\n        else {\n          outlineIntensity \x3d haloColor.w * opacities[0];\n          fillIntensity \x3d color.w * opacities[2];\n        }\n\n        float inner \x3d 1.0 - outlineSize / 9.0;\n        float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\n\n        float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\n        //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\n        float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n        float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n        // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n        // I.e., color should not be premultiplied with alpha\n        gl_FragColor \x3d vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);\n      }"])))));
return n};var e,f,l,h,d,a,c,q,p,t,u})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define(["require","exports","./RenderTargetHelper","./Util"],function(n,b,m,k){var g=[0,0,0,0],e=[0,1,0,1];return function(){function b(b,e){this._rctx=b;this._compositingHelper=e;this.dimensions={width:4,height:4};this._enabled=!1;this._background={type:"color",color:[0,0,0,1]};b=this.renderTargetHelper=new m.RenderTargetHelper(this._rctx);this.mainColor=b.registerColorTarget({name:"mainColor"});
this.mainDepth=b.registerDepthTarget({name:"mainDepth"});this.linearDepth=b.registerColorTarget({name:"linearDepth",samplingMode:9728});this.normal=b.registerColorTarget({name:"normal"});this.highlight=b.registerColorTarget({name:"highlight",dataType:32819});this.hudVisibility=b.registerColorTarget({name:"hudVisibility",dataType:32819});this.tmpColor=b.registerColorTarget({name:"tmpColor"});this.tmpDepth=b.registerDepthTarget({name:"tmpDepth"})}Object.defineProperty(b.prototype,"width",{get:function(){return this.dimensions.width},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"enabled",{get:function(){return this._enabled},set:function(b){b?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"background",{get:function(){return this._background},set:function(b){this._background=b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"depthTexture",{get:function(){return this.framebuffer.depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"linearDepthTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"normalTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"highlightTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"tmpColorTexture",{get:function(){return this.getColorTexture(this.tmpColor)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"mainColorTexture",{get:function(){return this.getColorTexture(this.mainColor)},enumerable:!0,configurable:!0});b.prototype.initializeFrame=function(b){k.assert(this.enabled);var e=this._rctx;this.dimensions.width=b.fullWidth;this.dimensions.height=b.fullHeight;this.bindTarget(this.mainColor,this.mainDepth);
e.setClearStencil(0);b=this._background.color;e.setClearColor(b[0]*b[3],b[1]*b[3],b[2]*b[3],b[3]);e.clearSafe(17664)};b.prototype.composite=function(){this._compositingHelper.composite(this.colorTexture,0)};b.prototype.renderAndComposite=function(b,e){this.renderToTargets(b,this.tmpColor,this.mainDepth,g);this._compositingHelper.composite(this.getColorTexture(this.tmpColor),e)};b.prototype.renderHUDVisibility=function(b){this.renderToTargets(b,this.hudVisibility,this.mainDepth,e)};b.prototype.compositeTransparentTerrainOntoHUDVisibility=
function(){var b=this;this.renderToTargets(function(){b._compositingHelper.compositeSpecial(b.getColorTexture(b.tmpColor),2)},this.hudVisibility,this.mainDepth)};b.prototype.compositeTransparentTerrainOntoMain=function(){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2)};b.prototype.compositeOccludedOntoMain=function(b){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2,b)};b.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};
b.prototype.renderDepthDetached=function(b){var e=this.bindTarget(this.mainColor);b(e);this.bindTarget(this.mainColor,this.mainDepth)};b.prototype.disposeTarget=function(b){this.renderTargetHelper.disposeTargetResource(b)};b.prototype.enable=function(){this.enabled||(this._enabled=!0)};b.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource())};b.prototype.renderToTargets=function(b,e,d,a,c,f){var g=this._rctx;e=this.bindTarget(e,d);d=0;a&&(g.setClearColor(a[0],
a[1],a[2],Math.max(1E-13,a[3])),d|=16384);c&&(d|=256);f&&(d|=1024);g.clearSafe(d,!0===f?255:!1===f?0:f);b(e);g.gl.flush();this.bindTarget(this.mainColor,this.mainDepth);return e};b.prototype.bindTarget=function(b,e){b=this.renderTargetHelper.getFramebuffer(this.dimensions,b,e);this._rctx.bindFramebuffer(b);return b};b.prototype.getColorTexture=function(b){return this.renderTargetHelper.getColorTexture(b,this.dimensions)};b.prototype.getGpuMemoryUsage=function(){var b=0;this.renderTargetHelper&&(b+=
this.renderTargetHelper.getGpuMemoryUsage());return b};return b}()})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture ../../../webgl/Util".split(" "),function(n,b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});var l={dataType:5121},h={};n=function(){function b(a){this.rctx=a;this.activeTargets=new Set;this.depthTextures=new Map;
this.depthBuffers=new Map;this.colorTextures=new Map;this.framebuffers=new Map;this.nextId=1;this.depthTextureSupported=a.capabilities.depthTexture}b.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(a){return a.dispose()});this.depthBuffers.clear();this.depthTextures.forEach(function(a){return a.dispose()});this.depthTextures.clear();this.colorTextures.forEach(function(a){return a.dispose()});this.colorTextures.clear()};b.prototype.disposeTargetResource=function(a){a=a.id;
this.activeTargets.has(a)&&(this.activeTargets.delete(a),this.depthTextures.has(a)&&(this.depthTextures.get(a).dispose(),this.depthTextures.delete(a)),this.depthBuffers.has(a)&&(this.depthBuffers.get(a).dispose(),this.depthBuffers.delete(a)),this.colorTextures.has(a)&&(this.colorTextures.get(a).dispose(),this.colorTextures.delete(a)))};b.prototype.getDepthTexture=function(a,b){if(this.depthTextureSupported){var c=this.depthTextures.get(a.id);!c||c.descriptor.width===b.width&&c.descriptor.height===
b.height||(c.dispose(),c=void 0);c||(c=new e(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:b.width,height:b.height}),this.depthTextures.set(a.id,c),this.activeTargets.add(a.id));return c}};b.prototype.getDepthBuffer=function(a,b){if(!this.depthTextureSupported){var c=this.depthBuffers.get(a.id);c?c.descriptor.width===b.width&&c.descriptor.height===b.height||c.resize(b.width,b.height):(c=new g(this.rctx,m({internalFormat:34041},b)),this.depthBuffers.set(a.id,
c),this.activeTargets.add(a.id));return c}};b.prototype.getColorTexture=function(a,b){var c=this.colorTextures.get(a.id);!c||c.descriptor.width===b.width&&c.descriptor.height===b.height||(c.dispose(),c=void 0);c||(c=new e(this.rctx,{target:3553,pixelFormat:6408,dataType:a.dataType,samplingMode:null!=a.samplingMode?a.samplingMode:9729,wrapMode:33071,width:b.width,height:b.height}),this.colorTextures.set(a.id,c),this.activeTargets.add(a.id));return c};b.prototype.getAllocatedColorTexture=function(a){return this.colorTextures.get(a.id)};
b.prototype.registerDepthTarget=function(a){void 0===a&&(a={});var b=this.nextId++;return m({id:b},h,a)};b.prototype.registerColorTarget=function(a){void 0===a&&(a={});var b=this.nextId++;return m({id:b},l,a)};b.prototype.getFramebuffer=function(a,b,d){var c=this.getKey(b,d),e=this.framebuffers.get(c);b=this.getColorTexture(b,a);if(this.depthTextureSupported){var f=d?this.getDepthTexture(d,a):void 0;if(!e)return e=d?new k(this.rctx,{colorTarget:0,depthStencilTarget:4},b,f):new k(this.rctx,{colorTarget:0,
depthStencilTarget:0},b),this.framebuffers.set(c,e),e;if(d=e.width!==a.width||e.height!==a.height||e.colorTexture!==b||e.depthStencilTexture!==f)e.detachColorTexture(),e.detachDepthStencilTexture(),e.resize(a.width,a.height),e.attachColorTexture(b),e.attachDepthStencilTexture(f);return e}f=d?this.getDepthBuffer(d,a):void 0;if(!e)return e=new k(this.rctx,{colorTarget:0,depthStencilTarget:d?3:0},b,f),this.framebuffers.set(c,e),e;if(d=e.width!==a.width||e.height!==a.height||e.colorTexture!==b)e.detachColorTexture(),
e.detachDepthStencilBuffer(),e.resize(a.width,a.height),e.attachColorTexture(b),e.attachDepthStencilBuffer(f);return e};b.prototype.getKey=function(a,b){return a.id+"_"+(b?b.id:"X")+"_"+a.name+(b?"_"+b.name:"")};b.prototype.getGpuMemoryUsage=function(){var a=0,b=new Set,d=function(c){b.has(c)||(b.add(c),a+=f.getGpuMemoryUsage(c))};this.depthTextures.forEach(d);this.colorTextures.forEach(d);this.depthBuffers.forEach(d);this.framebuffers.forEach(d);return a};return b}();b.RenderTargetHelper=n})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define(["require",
"exports","./depthRange","./Util"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.pluginContext=b;this.renderPlugins=[];this.slots=[];for(b=0;23>b;++b)this.slots[b]=[]}b.prototype.add=function(b,e){this.renderPlugins.push(e);for(var f=0;f<b.length;++f)this.slots[b[f]].push(e);e.initializeRenderContext(this.pluginContext);this.pluginContext.requestRender()};b.prototype.remove=function(b){var e=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter(function(e){return e!==
b});k.assert(this.renderPlugins.length<e,"Removing non-added render plugin");for(e=0;e<this.slots.length;++e)this.slots[e]=this.slots[e].filter(function(e){return e!==b});b.uninitializeRenderContext();this.pluginContext.requestRender()};b.prototype.prepareRender=function(b){for(var e=0,f=this.renderPlugins;e<f.length;e++){var d=f[e];d.prepareRender&&d.prepareRender(b)}};b.prototype.render=function(b,e){e.slot=b;var f=!1,d=0;for(b=this.slots[b];d<b.length;d++){var a=b[d];a.canRender&&a.render(e)&&
(f=!0)}return f};b.prototype.queryDepthRange=function(b){var e=g;e.near=Infinity;e.far=-Infinity;for(var f=0,d=this.renderPlugins;f<d.length;f++){var a=d[f];a.queryDepthRange&&(a=a.queryDepthRange(b))&&m.union(e,a,e)}return e};Object.defineProperty(b.prototype,"needsHighlight",{get:function(){return this.renderPlugins.some(function(b){return b.needsHighlight})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"needsLinearDepth",{get:function(){return this.renderPlugins.some(function(b){return b.needsLinearDepth})},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"needsLaserlineWithContrastControl",{get:function(){var b=this.slots[17];return!!b&&0<b.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderOccludedFlags",{get:function(){var b=0;this.renderPlugins.forEach(function(e){e.renderOccludedFlags&&(b|=e.renderOccludedFlags)});return b},enumerable:!0,configurable:!0});return b}();b.RenderPluginManager=n;var g={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ./Camera ./DefaultTextureUnits ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w){function v(a,b){f.vec2.set(ca,a[b],a[b+3]);return ca}var z=function(){return function(){this.camera=new q.default;this.lightMat=e.mat4f64.create()}}();n=function(){function b(a){this.doShadowMapMipmapsWork=!1;this.textureRes=4096;this.numCascades=1;this.maxNumCascades=2;this.splitSchemeLambda=.1;this.warp=!0;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.rctx=a;this.emptyTexture=t.createEmptyTexture(a);for(a=0;4>a;++a)this.cascades.push(new z)}
b.prototype.dispose=function(){this.emptyTexture.dispose();this.emptyTexture=null};Object.defineProperty(b.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(a){this.textureRes=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(a){this.maxNumCascades=m.clamp(Math.floor(a),1,4)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"enabled",{get:function(){return!!this.depthTexture},
set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});b.prototype.getDepthTexture=function(){return this.depthTexture};b.prototype.getCascades=function(){for(var a=0;a<this.numCascades;++a)Q[a]=this.cascades[a];Q.length=this.numCascades;return Q};b.prototype.prepare=function(b,c,d){u.assert(this.enabled);g.mat4.multiply(A,b.projectionMatrix,b.viewMatrix);var e=d.near;d=d.far;2>e&&(e=2);2>d&&(d=2);e>=d&&(e=2,d=4);this.numCascades=Math.min(1+Math.floor(u.logWithBase(d/e,4)),
this.maxNumCascades);for(var k=(d-e)/this.numCascades,l=Math.pow(d/e,1/this.numCascades),n=e,p=0;p<this.numCascades+1;++p)this.cascadeDistances[p]=m.lerp(n,e,this.splitSchemeLambda),n*=l,e+=k;g.mat4.invert(B,A);g.mat4.lookAt(K,[0,0,0],[-c[0],-c[1],-c[2]],b.up);k=b.viewMatrix;b=b.projectionMatrix;for(p=0;p<this.numCascades;++p){l=this.cascades[p];e=-this.cascadeDistances[p];n=-this.cascadeDistances[p+1];e=(b[10]*e+b[14])/Math.abs(b[11]*e+b[15]);n=(b[10]*n+b[14])/Math.abs(b[11]*n+b[15]);u.assert(e<
n);for(var r=0;8>r;++r){a.vec4.set(C,0===r%4||3===r%4?-1:1,0===r%4||1===r%4?-1:1,4>r?e:n,1);a.vec4.transformMat4(F[r],C,B);for(var q=0;3>q;++q)F[r][q]/=F[r][3]}h.vec3.negate(N,F[0]);g.mat4.translate(y,K,N);l.camera.viewMatrix=y;for(r=0;8>r;++r)h.vec3.transformMat4(F[r],F[r],l.camera.viewMatrix);h.vec3.copy(E,F[0]);h.vec3.copy(G,F[0]);for(r=1;8>r;++r)for(q=0;3>q;++q)E[q]=Math.min(E[q],F[r][q]),G[q]=Math.max(G[q],F[r][q]);E[2]-=200;G[2]+=200;l.camera.near=-G[2];l.camera.far=-E[2];if(this.warp){e=1/
F[0][3];d=1/F[4][3];u.assert(e<d);var r=e+Math.sqrt(e*d),n=Math.sin(m.acosClamped(k[2]*c[0]+k[6]*c[1]+k[10]*c[2])),r=r/n,e=F,t=r,w=n,n=H,x=D,z=I,q=L,r=O;f.vec2.set(P,0,0);for(var M=0;4>M;++M)f.vec2.add(P,P,e[M]);f.vec2.scale(P,P,.25);f.vec2.set(S,0,0);for(M=4;8>M;++M)f.vec2.add(S,S,e[M]);f.vec2.scale(S,S,.25);f.vec2.lerp(V[0],e[4],e[5],.5);f.vec2.lerp(V[1],e[5],e[6],.5);f.vec2.lerp(V[2],e[6],e[7],.5);f.vec2.lerp(V[3],e[7],e[4],.5);for(var Q=0,T=f.vec2.squaredDistance(V[0],P),M=1;4>M;++M){var Z=f.vec2.squaredDistance(V[M],
P);Z<T&&(T=Z,Q=M)}f.vec2.subtract(J,V[Q],e[Q+4]);M=J[0];J[0]=-J[1];J[1]=M;f.vec2.subtract(U,S,P);f.vec2.lerp(J,J,U,w);f.vec2.normalize(J,J);Q=w=void 0;w=Q=f.vec2.dot(f.vec2.subtract(Y,e[0],P),J);for(M=1;8>M;++M)T=f.vec2.dot(f.vec2.subtract(Y,e[M],P),J),T<w?w=T:T>Q&&(Q=T);f.vec2.copy(n,P);f.vec2.scale(Y,J,w-t);f.vec2.add(n,n,Y);for(var Z=-1,ca=1,M=t=T=0;8>M;++M){f.vec2.subtract(X,e[M],n);f.vec2.normalize(X,X);var ea=J[0]*X[1]-J[1]*X[0];0<ea?ea>Z&&(Z=ea,T=M):ea<ca&&(ca=ea,t=M)}u.verify(0<Z,"leftArea");
u.verify(0>ca,"rightArea");f.vec2.scale(R,J,w);f.vec2.add(R,R,P);f.vec2.scale(aa,J,Q);f.vec2.add(aa,aa,P);da[0]=-J[1];da[1]=J[0];x=u.rayRay2D(n,e[t],aa,f.vec2.add(Y,aa,da),1,x);z=u.rayRay2D(n,e[T],aa,Y,1,z);q=u.rayRay2D(n,e[T],R,f.vec2.add(Y,R,da),1,q);e=u.rayRay2D(n,e[t],R,Y,1,r);u.verify(x,"rayRay");u.verify(z,"rayRay");u.verify(q,"rayRay");u.verify(e,"rayRay");z=H;e=D;n=L;q=O;r=l.camera.projectionMatrix;f.vec2.subtract(ba,n,q);f.vec2.scale(ba,ba,.5);W[0]=ba[0];W[1]=ba[1];W[2]=0;W[3]=ba[1];W[4]=
-ba[0];W[5]=0;W[6]=ba[0]*ba[0]+ba[1]*ba[1];W[7]=ba[0]*ba[1]-ba[1]*ba[0];W[8]=1;W[6]=-f.vec2.dot(v(W,0),z);W[7]=-f.vec2.dot(v(W,1),z);z=f.vec2.dot(v(W,0),n)+W[6];x=f.vec2.dot(v(W,1),n)+W[7];M=f.vec2.dot(v(W,0),q)+W[6];q=f.vec2.dot(v(W,1),q)+W[7];z=-(z+M)/(x+q);W[0]+=W[1]*z;W[3]+=W[4]*z;W[6]+=W[7]*z;z=1/(f.vec2.dot(v(W,0),n)+W[6]);x=1/(f.vec2.dot(v(W,1),n)+W[7]);W[0]*=z;W[3]*=z;W[6]*=z;W[1]*=x;W[4]*=x;W[7]*=x;W[2]=W[1];W[5]=W[4];W[8]=W[7];W[7]+=1;z=f.vec2.dot(v(W,1),e)+W[7];x=f.vec2.dot(v(W,2),e)+W[8];
M=f.vec2.dot(v(W,1),n)+W[7];q=f.vec2.dot(v(W,2),n)+W[8];z=-.5*(z/x+M/q);W[1]+=W[2]*z;W[4]+=W[5]*z;W[7]+=W[8]*z;z=f.vec2.dot(v(W,1),e)+W[7];x=f.vec2.dot(v(W,2),e)+W[8];M=-x/z;W[1]*=M;W[4]*=M;W[7]*=M;r[0]=W[0];r[1]=W[1];r[2]=0;r[3]=W[2];r[4]=W[3];r[5]=W[4];r[6]=0;r[7]=W[5];r[8]=0;r[9]=0;r[10]=1;r[11]=0;r[12]=W[6];r[13]=W[7];r[14]=0;r[15]=W[8];l.camera.projectionMatrix[10]=2/(E[2]-G[2]);l.camera.projectionMatrix[14]=-(E[2]+G[2])/(E[2]-G[2])}else g.mat4.ortho(l.camera.projectionMatrix,E[0],G[0],E[1],
G[1],l.camera.near,l.camera.far);g.mat4.multiply(l.lightMat,l.camera.projectionMatrix,l.camera.viewMatrix);e=this.textureRes/2;l.camera.viewport[0]=0===p%2?0:e;l.camera.viewport[1]=0===Math.floor(p/2)?0:e;l.camera.viewport[2]=e;l.camera.viewport[3]=e}this.lastOrigin=null;this.cascadeDistances[this.numCascades]=100*d;c=this.rctx;c.bindFramebuffer(this.fbo);c.bindTexture(null,7);c.setClearColor(1,1,1,1);c.clearSafe(16640)};b.prototype.finish=function(a){u.assert(this.enabled);this.rctx.bindFramebuffer(a);
this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()};b.prototype.bind=function(a,b){var c=this.rctx,d=this.enabled;c.bindTexture(d?this.depthTexture:this.emptyTexture,b);c.bindProgram(a);a.setUniform1i("depthTex",b);a.setUniform1f("depthHalfPixelSz",d?.5/this.textureRes:-1);a.setUniform1i("shadowMapNum",this.numCascades);a.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])};b.prototype.bindToAllPrograms=
function(a){a=a.getProgramsUsingUniform("shadowMapDistance");for(var b=0;b<a.length;b++)this.bind(a[b],p.DefaultTextureUnits.SHADOW_MAP)};b.prototype.bindView=function(a,b){if(this.enabled){var c=this.lastOrigin;if(!c||c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2])for(this.lastOrigin=this.lastOrigin||d.vec3f64.create(),h.vec3.copy(this.lastOrigin,b),c=0;c<this.numCascades;++c){g.mat4.translate(M,this.cascades[c].lightMat,b);for(var e=0;16>e;++e)T[16*c+e]=M[e]}a.setUniformMatrix4fv("shadowMapMatrix",T)}};
b.prototype.enable=function(){this.enabled||(this.depthTexture=new x(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureRes,height:this.textureRes}),this.fbo=new r(this.rctx,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes},this.depthTexture))};b.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.depthTexture=this.fbo=null)};b.prototype.getGpuMemoryUsage=function(){return w.getGpuMemoryUsage(this.fbo)};
return b}();var y=e.mat4f64.create(),A=e.mat4f64.create(),B=e.mat4f64.create(),C=c.vec4f64.create(),F=[];for(b=0;8>b;++b)F.push(c.vec4f64.create());var E=d.vec3f64.create(),G=d.vec3f64.create(),H=l.vec2f64.create(),D=l.vec2f64.create(),I=l.vec2f64.create(),L=l.vec2f64.create(),O=l.vec2f64.create(),K=e.mat4f64.create(),N=d.vec3f64.create(),Q=[],M=e.mat4f64.create(),T=new Float32Array(64),P=l.vec2f64.create(),S=l.vec2f64.create(),V=[l.vec2f64.create(),l.vec2f64.create(),l.vec2f64.create(),l.vec2f64.create()],
J=l.vec2f64.create(),U=l.vec2f64.create(),Y=l.vec2f64.create(),X=l.vec2f64.create(),R=l.vec2f64.create(),aa=l.vec2f64.create(),da=l.vec2f64.create(),ca=l.vec2f64.create(),ba=l.vec2f64.create(),W=k.mat3f64.create();return n})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["require","exports","../../support/geometryUtils"],function(n,b,m){var k=m.boundedPlane.create();return function(){function b(){this._worldPlane=k}Object.defineProperty(b.prototype,"isEnabled",{get:function(){return this.plane!==
k},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"plane",{get:function(){return this._worldPlane},set:function(b){this._worldPlane=b?b:k},enumerable:!0,configurable:!0});return b}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../core/maybe ../../../../core/promiseUtils ../../support/imageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){return function(){function b(a){this.resourceLoadingPromise=null;this.isEnabled=!1;this.vertexAttributeLocations={vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}b.prototype.loadResources=function(a){var b=this;if(!this.data||!this.textureArea||!this.textureSearch){var c=this.resourceLoadingPromise||this.loadDataModule().then(function(){return b.loadTextures()});a&&c.then(a);this.resourceLoadingPromise||
(this.resourceLoadingPromise=c,c.then(function(){return b.resourceLoadingPromise=null}));return!1}return!0};b.prototype.loadDataModule=function(){var a=this;return this.data?k.resolve():k.create(function(b){return n(["./SmaaRenderPassData"],function(c){a.data=c;b()})})};b.prototype.loadTextures=function(){var a=this;return k.all([this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.loadTextureFromBase64(this.data.searchTexure,9728,6409)]).then(function(b){var c=b[1];a.textureArea=b[0];
a.textureSearch=c})};Object.defineProperty(b.prototype,"isLoadingResources",{get:function(){return null!=this.resourceLoadingPromise},enumerable:!0,configurable:!0});b.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var b=this.rctx;this.programEdgeDetect=new l(b,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations);this.programBlendWeights=new l(b,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,
this.vertexAttributeLocations);this.programBlur=new l(b,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);this.pipelineState=h.makePipelineState({colorWrite:h.defaultColorWriteParams});var c=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new a(b,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new e(b,34962,35044,c)});this.tmpFramebufferEdges=new f(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6407,dataType:5121,
samplingMode:9729,wrapMode:33071,width:4,height:4});this.tmpFramebufferBlend=new f(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4});return this.isEnabled=!0};b.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=
null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};b.prototype.render=function(a,b){this.enable();var c=this.rctx,d=0,e=0;m.isSome(b)?(d=b.descriptor.width,e=b.descriptor.height):(d=c.gl.canvas.width,e=c.gl.canvas.height);c.bindVAO(this.vao);c.setPipelineState(this.pipelineState);c.setViewport(0,
0,d,e);this.tmpFramebufferEdges.resize(d,e);c.bindFramebuffer(this.tmpFramebufferEdges);c.setClearColor(0,0,0,1);c.clear(16384);c.bindProgram(this.programEdgeDetect);c.bindTexture(a.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/d,1/e,d,e);c.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(d,e);c.bindFramebuffer(this.tmpFramebufferBlend);c.setClearColor(0,0,1,1);c.clear(16384);c.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",
1/d,1/e,d,e);c.bindTexture(this.textureSearch,1);this.programBlendWeights.setUniform1i("tSearch",1);c.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",2);c.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);c.drawArrays(4,0,3);c.bindFramebuffer(b);c.setClearColor(0,1,0,1);c.clear(16384);c.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/d,1/e,d,e);c.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",
0);c.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",1);c.drawArrays(4,0,3)};b.prototype.loadTextureFromBase64=function(a,b,c){var e=new d(this.rctx,{pixelFormat:c,dataType:5121,wrapMode:33071,samplingMode:b},null);return g.requestImage(a).then(function(a){e.resize(a.width,a.height);e.setData(a);return e})};return b}()})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../core/Logger ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/imageUtils ./DefaultTextureUnits ./glUtil3D ./SSAOTechnique ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t){var u=m.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper");b=function(){function b(b,c,e){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=f.vec4f64.create();this._rctx=c;this._techniqueRep=b;this._requestRender=e;this._ssaoTechniqueConfig=new a.SSAOTechniqueConfiguration;this._emptyTexture=d.createColorTexture(c,[1,1,1,1])}b.prototype.dispose=function(){this._emptyTexture.dispose();this._emptyTexture=
null};Object.defineProperty(b.prototype,"isSupported",{get:function(){var a=this._rctx,b=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),a=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return!(b||a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"attenuation",{get:function(){return this._attenuation},set:function(a){this._attenuation=
a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"samples",{get:function(){return this._samples},set:function(a){this._samples=a;this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0});b.prototype.computeSSAO=function(a,
b,f){if(this._noiseTexture){c.assert(this.enabled);var h=this._rctx,k=a.fullViewport,l=k[2],m=k[3],k=l/this._BLUR_F,n=m/this._BLUR_F;this._ssaoFBO.resize(l,m);this._blur0FBO.resize(k,n);this._blur1FBO.resize(k,n);k=1*l;n=1*m;h.bindFramebuffer(this._ssaoFBO);e.vec4.copy(this._viewportToRestore,a.fullViewport);h.setViewport(0,0,l,m);var p=this._ssaoTechnique.program,q=this._blurTechnique.program;h.bindProgram(p);h.setPipelineState(this._ssaoTechnique.pipeline);p.setUniform2f("rnmScale",l/this._noiseTexture.descriptor.width,
m/this._noiseTexture.descriptor.height);p.setUniform3fv("pSphere",8>=this._samples?this._data.random8:16>=this._samples?this._data.random16:32>=this._samples?this._data.random32:this._data.random64);l=this._data.minDiscrepancy;p.setUniform1f("numSpiralTurns",this._samples<l.length?l[this._samples]:5779);l=x;m=r;c.inverseProjectionInfo(a.projectionMatrix,a.fullWidth,a.fullHeight,l,m);p.setUniform4fv("projInfo",l);p.setUniform2fv("zScale",m);p.setUniform2f("nearFar",a.near,a.far);l=1/a.computeRenderPixelSizeAtDist(1);
p.setUniform1f("projScale",1*l);p.setUniform2f("screenDimensions",k,n);var u=2*this._radius,m=g.vec3.distance(a.eye,a.center),u=20*a.computeRenderPixelSizeAtDist(m),u=Math.max(.1,u);p.setUniform1f("radius",u);p.setUniform1f("intensity",4*this._attenuation/Math.pow(u,6));p.setUniform1i("rnm",0);p.setUniform1i("normalMap",1);p.setUniform1i("depthMap",2);h.bindTexture(this._noiseTexture,0);h.bindTexture(f,1);h.bindTexture(b,2);b=d.createQuadVAO(this._rctx);h.bindVAO(b);h.drawArrays(5,0,t.vertexCount(b,
"geometry"));h.bindTexture(this._ssaoFBO.colorTexture,0);h.setViewport(0,0,k/this._BLUR_F,n/this._BLUR_F);h.bindFramebuffer(this._blur0FBO);h.bindProgram(q);q.setUniform2f("screenDimensions",k,n);q.setUniform1i("tex",0);q.setUniform1i("normalMap",1);q.setUniform1i("depthMap",2);q.setUniform2f("blurSize",0,1*this._BLUR_F/n);q.setUniform1i("radius",4);q.setUniform1f("g_BlurFalloff",.08);q.setUniform2f("nearFar",a.near,a.far);5E4<m&&(l=Math.max(0,l-(m-5E4)));q.setUniform1f("projScale",l);q.setUniform2f("zScale",
1,0);h.drawArrays(5,0,t.vertexCount(b,"geometry"));q.setUniform2f("blurSize",1*this._BLUR_F/k,0);h.bindFramebuffer(this._blur1FBO);h.bindTexture(this._blur0FBO.colorTexture,0);h.drawArrays(5,0,t.vertexCount(b,"geometry"));h.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};b.prototype.setUniforms=function(a,b){var c=this.enabled&&this._noiseTexture,d=this._rctx;d.bindTexture(c?this._blur1FBO.colorTexture:this._emptyTexture,b);
d.setActiveTexture(0);a.setUniform1i("ssaoTex",b);c?a.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};b.prototype.bindToAllPrograms=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var b=0;b<a.length;b++)this.setUniforms(a[b],h.DefaultTextureUnits.SSAO)};b.prototype.selectPrograms=function(){this._ssaoTechniqueConfig.samples=8>=this._samples?8:16>=this._samples?
16:32>=this._samples?32:64;this._ssaoTechniqueConfig.radius=4;this._ssaoTechniqueConfig.output=0;this._ssaoTechnique=this._techniqueRep.acquireAndReleaseExisting(a.SSAOTechnique,this._ssaoTechniqueConfig,this._ssaoTechnique);this._ssaoTechniqueConfig.output=1;this._blurTechnique=this._techniqueRep.acquireAndReleaseExisting(a.SSAOTechnique,this._ssaoTechniqueConfig,this._blurTechnique)};b.prototype.enable=function(){var a=this;this.enabled||(this.isSupported?(this._enabled=!0,this.loadResources(function(){a._enabled&&
a.initialize()})):u.warn("SSAO is not supported for this browser or hardware"))};b.prototype.loadResources=function(a){var b=this;this._data?a():n(["./SSAOHelperData"],function(c){b._data=c;a()})};b.prototype.initialize=function(){var a=this,b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},c={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=new q(this._rctx,c,b);this._blur0FBO=new q(this._rctx,c,b);this._blur1FBO=new q(this._rctx,c,b);l.requestImage(this._data.noiseTexture).then(function(b){a._enabled&&
(a._noiseTexture=new p(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:b.width,height:b.height},b),a._requestRender())});this.selectPrograms()};b.prototype.disable=function(){this.enabled&&(this._enabled=!1,this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))};b.prototype.getGpuMemoryUsage=
function(){return t.getGpuMemoryUsage(this._blur0FBO)+t.getGpuMemoryUsage(this._blur1FBO)+t.getGpuMemoryUsage(this._ssaoFBO)};return b}();var r=k.vec2f64.create(),x=f.vec4f64.create();return b})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../shaders/SSAO.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});g=function(b){function f(){return null!==b&&b.apply(this,arguments)||this}m(f,b);f.prototype.initializeProgram=function(b){var c=f.shader.get(),d=this.configuration,c=c.build({output:d.output,samples:d.samples,radius:d.radius});return new a(b.rctx,c.generateSource("vertex"),c.generateSource("fragment"),h.Default3D)};f.prototype.initializePipeline=function(){return c.makePipelineState({colorWrite:c.defaultColorWriteParams})};
f.shader=new e.ReloadableShaderModule(d,"../shaders/SSAO.glsl",n);return f}(f.ShaderTechnique);b.SSAOTechnique=g;g=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.samples=64;b.radius=4;return b}m(b,a);k([l.parameter({count:2})],b.prototype,"output",void 0);k([l.parameter()],b.prototype,"samples",void 0);k([l.parameter()],b.prototype,"radius",void 0);return b}(l.ShaderTechniqueConfiguration);b.SSAOTechniqueConfiguration=g})},"esri/views/3d/webgl-engine/shaders/SSAO.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/ScreenSpacePass ../core/shaderLibrary/output/ReadLinearDepth.glsl ../core/shaderLibrary/util/CameraSpace.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(n,b,m,k,g,e,f,l){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var n=new l.ShaderBuilder;n.include(k.ScreenSpacePass);1===b.output&&(n.include(g.ReadLinearDepth),n.fragment.code.add(f.glsl(h||(h=m([" \n      #ifndef RADIUS\n        #define RADIUS "],[" \n      #ifndef RADIUS\n        #define RADIUS "])))+b.radius+"\n      #endif\n    "),n.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("tex","sampler2D").add("blurSize","vec2").add("g_BlurFalloff",
"float").add("projScale","float").add("nearFar","vec2").add("zScale","vec2"),n.fragment.code.add(f.glsl(d||(d=m(["\n      float blurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\n        float c \x3d texture2D(tex, uv).r;\n        float d \x3d linearDepth(depthMap, uv, nearFar);\n\n        float ddiff \x3d d - center_d;\n\n        float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n        w_total +\x3d w;\n\n        return w*c;\n      }\n\n      void main(void) {\n        float b \x3d 0.0;\n        float w_total \x3d 0.0;\n\n        float center_d \x3d linearDepth(depthMap, uv, nearFar);\n\n        float sharpness \x3d -0.05 * projScale/(center_d*zScale.x+zScale.y);\n        for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r) {\n          float rf \x3d float(r);\n          vec2 uvOffset \x3d uv + rf*blurSize;\n          b +\x3d blurFunction(uvOffset, rf, center_d, w_total, sharpness);\n        }\n\n        gl_FragColor \x3d vec4(b/w_total);\n      }\n    "],
["\n      float blurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\n        float c \x3d texture2D(tex, uv).r;\n        float d \x3d linearDepth(depthMap, uv, nearFar);\n\n        float ddiff \x3d d - center_d;\n\n        float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n        w_total +\x3d w;\n\n        return w*c;\n      }\n\n      void main(void) {\n        float b \x3d 0.0;\n        float w_total \x3d 0.0;\n\n        float center_d \x3d linearDepth(depthMap, uv, nearFar);\n\n        float sharpness \x3d -0.05 * projScale/(center_d*zScale.x+zScale.y);\n        for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r) {\n          float rf \x3d float(r);\n          vec2 uvOffset \x3d uv + rf*blurSize;\n          b +\x3d blurFunction(uvOffset, rf, center_d, w_total, sharpness);\n        }\n\n        gl_FragColor \x3d vec4(b/w_total);\n      }\n    "])))));
0===b.output&&(n.include(g.ReadLinearDepth),n.include(e.CameraSpace),n.fragment.uniforms.add("projMatrixInv","mat4").add("normalMap","sampler2D").add("depthMap","sampler2D").add("intensity","float").add("projScale","float").add("radius","float").add("nearFar","vec2").add("screenDimensions","vec2").add("rnmScale","vec2").add("rnm","sampler2D"),n.fragment.code.add(f.glsl(a||(a=m([" \n      #ifndef SAMPLES\n        #define SAMPLES "],[" \n      #ifndef SAMPLES\n        #define SAMPLES "])))+b.samples+
"\n      #endif\n      uniform vec3 pSphere[SAMPLES]; //tap position\n    "),n.fragment.code.add(f.glsl(c||(c=m(["\n      float fallOffFunction(float vv, float vn, float bias) {\n        float radius2 \x3d radius * radius;\n\n        // A: From the HPG12 paper\n        // Note large epsilon to avoid overdarkening within cracks\n        // return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n        // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n        float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n        // C: Medium contrast (which looks better at high radii), no division.  Note that the\n        // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\n        // more computationally efficient and happens to be aesthetically pleasing.\n        // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n        // D: Low contrast, no division operation\n        // return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\n      }\n    "],
["\n      float fallOffFunction(float vv, float vn, float bias) {\n        float radius2 \x3d radius * radius;\n\n        // A: From the HPG12 paper\n        // Note large epsilon to avoid overdarkening within cracks\n        // return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n        // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n        float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n        // C: Medium contrast (which looks better at high radii), no division.  Note that the\n        // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\n        // more computationally efficient and happens to be aesthetically pleasing.\n        // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n        // D: Low contrast, no division operation\n        // return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\n      }\n    "])))),
n.fragment.code.add(f.glsl(q||(q=m(["\n      float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n        vec3 v \x3d Q - C;\n        float vv \x3d dot(v, v);\n        float vn \x3d dot(normalize(v), n_C);\n        return fallOffFunction(vv, vn, 0.1);\n      }\n    "],["\n      float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n        vec3 v \x3d Q - C;\n        float vv \x3d dot(v, v);\n        float vn \x3d dot(normalize(v), n_C);\n        return fallOffFunction(vv, vn, 0.1);\n      }\n    "])))),
n.fragment.code.add(f.glsl(p||(p=m(["\n      void main(void) {\n        //Hash function used in the HPG12 AlchemyAO paper\n        //Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\n        //ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\n        //float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n        vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n        float currentPixelDepth \x3d linearDepth(depthMap, uv, nearFar);\n\n        if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\n          gl_FragColor \x3d vec4(0.0);\n          return;\n        }\n\n        vec3 currentPixelPos \x3d reconstructPosition(gl_FragCoord.xy,currentPixelDepth);\n\n        // get the normal of current fragment\n        vec4 norm4 \x3d texture2D(normalMap, uv);\n        vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\n        bool isTerrain \x3d norm4.w\x3c0.5;\n\n        float sum \x3d .0;\n\n        vec4 occluderFragment;\n        vec3 ray;\n\n        vec3 tapPixelPos;\n\n        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n        // bug or deviation from CE somewhere else?\n        float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n        for(int i \x3d 0; i \x3c SAMPLES; ++i) {\n          // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n          //float ssR;\n          //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\n          // get the depth of the occluder fragment\n          //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\n\n          vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\n          vec2 offset \x3d vec2(-unitOffset*radius*ps);\n\n          //don't use current or very nearby samples\n          if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\n\n          vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\n          if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\n          vec2 tcTap \x3d tc/screenDimensions;\n          float occluderFragmentDepth \x3d linearDepth(depthMap, tcTap, nearFar);\n\n          if (isTerrain) {\n            bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\n            if (isTerrainTap) {\n              continue;\n            }\n          }\n\n          tapPixelPos \x3d reconstructPosition(tc, occluderFragmentDepth);\n\n          sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n        }\n\n        // output the result\n\n        float A \x3d max(1.0-sum*intensity/float(SAMPLES),0.0);\n\n        // Anti-tone map to reduce contrast and drag dark region farther\n        // (x^0.2 + 1.2 * x^4)/2.2\n        A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n        //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\n        //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\n        //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\n        gl_FragColor \x3d vec4(A);\n      }\n    "],
["\n      void main(void) {\n        //Hash function used in the HPG12 AlchemyAO paper\n        //Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\n        //ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\n        //float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n        vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n        float currentPixelDepth \x3d linearDepth(depthMap, uv, nearFar);\n\n        if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\n          gl_FragColor \x3d vec4(0.0);\n          return;\n        }\n\n        vec3 currentPixelPos \x3d reconstructPosition(gl_FragCoord.xy,currentPixelDepth);\n\n        // get the normal of current fragment\n        vec4 norm4 \x3d texture2D(normalMap, uv);\n        vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\n        bool isTerrain \x3d norm4.w\x3c0.5;\n\n        float sum \x3d .0;\n\n        vec4 occluderFragment;\n        vec3 ray;\n\n        vec3 tapPixelPos;\n\n        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n        // bug or deviation from CE somewhere else?\n        float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n        for(int i \x3d 0; i \x3c SAMPLES; ++i) {\n          // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n          //float ssR;\n          //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\n          // get the depth of the occluder fragment\n          //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\n\n          vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\n          vec2 offset \x3d vec2(-unitOffset*radius*ps);\n\n          //don't use current or very nearby samples\n          if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\n\n          vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\n          if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\n          vec2 tcTap \x3d tc/screenDimensions;\n          float occluderFragmentDepth \x3d linearDepth(depthMap, tcTap, nearFar);\n\n          if (isTerrain) {\n            bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\n            if (isTerrainTap) {\n              continue;\n            }\n          }\n\n          tapPixelPos \x3d reconstructPosition(tc, occluderFragmentDepth);\n\n          sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n        }\n\n        // output the result\n\n        float A \x3d max(1.0-sum*intensity/float(SAMPLES),0.0);\n\n        // Anti-tone map to reduce contrast and drag dark region farther\n        // (x^0.2 + 1.2 * x^4)/2.2\n        A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n        //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\n        //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\n        //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\n        gl_FragColor \x3d vec4(A);\n      }\n    "])))));
return n};var h,d,a,c,q,p})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.CameraSpace=function(b){b.fragment.uniforms.add("projInfo","vec4");b.fragment.uniforms.add("zScale","vec2");b.fragment.code.add(k.glsl(g||(g=m(["\n    vec3 reconstructPosition(vec2 fragCoord, float depth) {\n      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n    }\n  "],
["\n    vec3 reconstructPosition(vec2 fragCoord, float depth) {\n      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n    }\n  "]))))};var g})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/promiseUtils ../../../../../core/typedArrayUtil ../../../../../core/workers ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/buffer/utils ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/util/TwoVectorPosition ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ../TextureBackedBuffer/BufferManager ./bufferLayouts ./edgeBufferWriters ./EdgeProcessingWorker ./EdgeRenderer ./strokes ./util ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B,C,F,E,G,H,D,I,L){function O(a){for(var b=null,c=null,d=0;d<a.geometries.length;d++){var f=a.geometryRecords[d];if(f.material.supportsEdges){if(!b)b=f.transformation;else if(!e.equals(b,f.transformation))return!1;if(!c&&f.origin)c=f;else if(c&&f.origin&&c.origin.id!==f.origin.id)return!1}}return!0}Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(a,b,c){this.rctx=a;this.techniqueRepository=b;this.callbacks=c;this.profilingCallback=
null;this.perObjectData=new Map;this.renderers=new Map;this.localOrigins=new y.LocalOriginManager(new v);this.gpuMemoryUsage=this.numberOfRenderedEdges=0;this.worker=new E;this.workerThread=null;this.destroyed=!1;this.tmpModelPosition=u.vec3f64.create();this.tmpCameraPosition=u.vec3f64.create();this.componentColorManager=new B.BufferManager(this.rctx,2)}b.prototype.initialize=function(){var a=this;d.open("EdgeProcessingWorker").then(function(b){a.destroyed?b.close():a.workerThread=b});for(var b=C.VertexLayout.createBuffer(4),
c=0;4>c;c++)b.sideness.set(c,0,0===c||3===c?0:1),b.sideness.set(c,1,0===c||1===c?0:1);this.verticesBufferObject=I.createVertex(this.rctx,35044,b.buffer)};b.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.perObjectData.clear(),this.renderers.clear(),this.destroyed=!0)};b.prototype.getUsedMemory=function(){return this.gpuMemoryUsage};
Object.defineProperty(b.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0});b.prototype.shouldRender=function(){return 0<this.renderers.size};b.prototype.addComponentObject=function(a,b,c,d,e,f,h,m){return k(this,void 0,void 0,function(){var k,n;return g(this,function(g){switch(g.label){case 0:if(this.hasObject(a))return[2];n={loaded:l.create(function(a){return k=a}),renderables:[],center:c};this.perObjectData.set(a,n);return[4,
this.addComponentGeometry(b,n,d,e,f,h,m)];case 1:return g.sent(),this.callbacks.setNeedsRender(),k(),[2]}})})};b.prototype.addOrUpdateObject=function(a,b,c,d,e){return k(this,void 0,void 0,function(){var f,h,k,m,n,p,r,q,u=this;return g(this,function(g){switch(g.label){case 0:f=[];k={loaded:l.create(function(a){return h=a}),renderables:[]};m=this.perObjectData.get(a);this.perObjectData.set(a,k);if(e&&e.mergeGeometries&&1<a.geometries.length&&O(a))f.push(this.addObjectMergedGeometries(a,k,b,c));else for(n=
0;n<a.geometries.length;n++)p=a.geometries[n],r=a.geometryRecords[n],q=r.material,q.supportsEdges&&f.push(this.addGeometryData(a,k,p.data,r,b[0],c,d));return[4,l.all(f)];case 1:return g.sent(),m&&m.loaded.then(function(){m.renderables.forEach(function(a){return u.removeRenderable(a)});u.callbacks.setNeedsRender()}),this.callbacks.setNeedsRender(),h(),[2]}})})};b.prototype.hasObject=function(a){return this.perObjectData.has(a)};b.prototype.updateAllComponentOpacities=function(a,b){return k(this,void 0,
void 0,function(){var c,d,e=this;return g(this,function(f){switch(f.label){case 0:return c=b instanceof Array?function(a){return b[a]}:function(){return b},[4,this.getObjectEntry(a)];case 1:return d=f.sent(),d.renderables.forEach(function(a){for(var b=a.components.meta.length,d=0;d<b;d++){var f=c(d),g=a.components.meta[d],h=g.index;g.material.opacity=f;a.components.buffer.textureBuffer.setDataElement(h,1,3,255*f)}e.updateTransparency(a)}),this.callbacks.setNeedsRender(),[2]}})})};b.prototype.updateAllComponentMaterials=
function(a,b,c,d){return k(this,void 0,void 0,function(){var e,f,h,k,l,m=this;return g(this,function(g){switch(g.label){case 0:return e=a instanceof A,f=!!c.slicePlaneEnabled,h=D.determineRendererType(b),k=G.EdgeRenderer.getKey(h,f,e),[4,this.getObjectEntry(a)];case 1:return l=g.sent(),l.renderables.forEach(function(c){if(k!==c.rendererKey){var e=m.renderers.get(c.rendererKey),g=m.acquireRenderer(h,f,a instanceof A);e.removeRenderable(c);e.refCount.decrement();c.rendererKey=k;g.addRenderable(c)}for(e=
0;e<b.length;e++)c.components.meta[e].material=b[e];d&&m.updateComponentBuffer(c.components);m.updateTransparency(c)}),this.callbacks.setNeedsRender(),[2]}})})};b.prototype.updateObjectVisibility=function(a,b){return k(this,void 0,void 0,function(){var c;return g(this,function(d){switch(d.label){case 0:return[4,this.getObjectEntry(a)];case 1:return c=d.sent(),c.renderables.forEach(function(a){return a.visible=b}),this.callbacks.setNeedsRender(),[2]}})})};b.prototype.removeObject=function(a){var b=
this,c=this.perObjectData.get(a);c&&(this.perObjectData.delete(a),c.loaded.then(function(){c.renderables.forEach(function(a){return b.removeRenderable(a)});b.callbacks.setNeedsRender()}))};b.prototype.getObjectEntry=function(a){return k(this,void 0,void 0,function(){var b;return g(this,function(c){switch(c.label){case 0:b=this.perObjectData.get(a);if(!b)throw"no object";return[4,b.loaded];case 1:return c.sent(),[2,b]}})})};b.prototype.removeAll=function(){var a=this;this.perObjectData.forEach(function(b,
c){a.removeObject(c)})};b.prototype.render=function(b,d){var e=this;this.localOrigins.updateViewMatrices(b.view);var f=b.viewInvTransp,g=u.vec3f64.create(),h=new w.TwoVectorPosition,k=new x.VertexPosition.ViewProjectionTransform,l=c.mat3f64.create();t.vec3.set(g,f[3],f[7],f[11]);h.set(g);t.vec3.copy(k.worldFromView_TH,h.high);t.vec3.copy(k.worldFromView_TL,h.low);a.mat3.fromMat4(k.viewFromCameraRelative_RS,b.view);q.mat4.copy(k.projFromView,b.proj);f=c.mat3f64.create();a.mat3.transpose(f,k.viewFromCameraRelative_RS);
a.mat3.invert(l,f);this.renderers.forEach(function(a){0===a.refCount.value&&(e.renderers.delete(a.key),a.dispose())});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();var m=0,n=0;this.renderers.forEach(function(a){return a.forEachRenderable(function(a){m+=a.statistics.averageEdgeLength;n++},d)});if(0!==n){var f=b.view,g=40*m/n,h=D.estimateLengthAtDistance(b.viewport[3],b.fovY,1,3.5*b.pixelRatio),p={distanceFalloffFactor:g,minimumEdgeLength:h,transparency:d,viewProjectionTransform:k,
transformNormal_ViewFromGlobal:l};this.updateObjectCameraDistances(b);this.numberOfRenderedEdges=0;this.renderers.forEach(function(a){e.renderRegularEdges(a,b,p);e.renderSilhouetteEdges(a,b,p)});b.view=f}};b.prototype.updateTransparency=function(a){var b=D.determineEdgeTransparency(a.components.meta),c=D.determineObjectTransparency(a.components.meta);if(b!==a.edgeTransparency||c!==a.objectTransparency)a.edgeTransparency=b,a.objectTransparency=c,this.renderers.get(a.rendererKey).setRenderablesDirty()};
b.prototype.computeModelTransformWithLocalOrigin=function(a,b,c){a.getCombinedStaticTransformation(b,c);b.origin?this.localOrigins.register(b.origin):(a=t.vec3.set(this.tmpModelPosition,c[12],c[13],c[14]),b.origin=this.localOrigins.acquire(a));z.applyToModelMatrix(b.origin.vec3,c);return c};b.prototype.updateComponentBuffer=function(a){var b=a.meta;a=a.buffer;for(var c=0;c<b.length;c++){var d=b[c].material,e=b[c].index,g=f.clamp(Math.round(d.size*G.LINE_WIDTH_FRACTION_FACTOR),0,255),h=f.clamp(d.extensionLength,
-G.EXTENSION_LENGTH_OFFSET,255-G.EXTENSION_LENGTH_OFFSET)+G.EXTENSION_LENGTH_OFFSET,k="solid"===d.type?0:1,l=255*d.opacity,d=d.color;a.textureBuffer.setData(e,0,255*d[0],255*d[1],255*d[2],255*d[3]);a.textureBuffer.setData(e,1,g,h,k,l)}};b.prototype.createComponentBuffers=function(a){for(var b=[],c=this.componentColorManager.getBuffer(a.length),d=0;d<a.length;d++){var e=a[d],f=c.acquireIndex();b.push({index:f,material:e})}a={meta:b,buffer:c};this.updateComponentBuffer(a);return a};b.prototype.extractEdges=
function(a,b,c,d,e){return this.worker.process({data:b,originalIndices:e,writerSettings:a,skipDeduplicate:c},d?null:this.workerThread)};b.prototype.createEdgeResources=function(a){var b={};if(0<a.regular.lodInfo.lengths.length){var c=new L(this.rctx,C.EdgeShaderAttributeLocations,{vertices:C.glVertexLayout,instances:F.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:I.createVertex(this.rctx,35044,a.regular.instancesData.buffer)});b.regular={vao:c,lod:a.regular.lodInfo}}0<
a.silhouette.lodInfo.lengths.length&&(c=new L(this.rctx,C.EdgeShaderAttributeLocations,{vertices:C.glVertexLayout,instances:F.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:I.createVertex(this.rctx,35044,a.silhouette.instancesData.buffer)}),b.silhouette={vao:c,lod:a.silhouette.lodInfo});return b};b.prototype.addGeometryData=function(a,b,c,d,e,f,h){return k(this,void 0,void 0,function(){var k,l,m,n;return g(this,function(g){k=c.getAttribute("position");l=this.computeModelTransformWithLocalOrigin(a,
d,p.mat4f64.create());m=d.origin;n={position:k,indices:c.getIndices("position"),modelTransform:l,origin:m};return[2,this.addPositionData(b,n,e,f,h)]})})};b.prototype.addPositionData=function(a,b,c,d,e){void 0===e&&(e=!1);return k(this,void 0,void 0,function(){var f,h,k,l,m,n,p,r,q,u,t,w,x,v,y;return g(this,function(g){switch(g.label){case 0:f=this.acquireRenderer(c.type,d.slicePlaneEnabled||!1);h=b.modelTransform;k=b.origin;l=b.indices;m=b.position;n=m.data.length/m.strideIdx;p=C.EdgeInputBufferLayout.createBuffer(n);
for(r=0;r<n;r++)p.position.set(r,0,m.data[m.offsetIdx+r*m.strideIdx+0]),p.position.set(r,1,m.data[m.offsetIdx+r*m.strideIdx+1]),p.position.set(r,2,m.data[m.offsetIdx+r*m.strideIdx+2]);q=this.createComponentBuffers([c]);D.fillComponenBufferIndices(q.meta,[0,p.componentIndex.count],p.componentIndex);return[4,this.extractEdges(f.writerSettings,p,!1,e,l)];case 1:return u=g.sent(),t=this.createEdgeResources(u),w=t.regular,x=t.silhouette,v=(w?w.vao.size:0)+(x?x.vao.size:0),y={regular:w,silhouette:x,transform:{modelMatrix:h,
origin:k},statistics:{gpuMemoryUsage:v,averageEdgeLength:u.averageEdgeLength},components:q,visible:!0,edgeTransparency:D.determineEdgeTransparency(q.meta),objectTransparency:D.determineObjectTransparency(q.meta),distanceToCamera:0,rendererKey:f.key},a.renderables.push(y),f.addRenderable(y),this.gpuMemoryUsage+=v,[2]}})})};b.prototype.addComponentGeometry=function(a,b,c,d,e,f,h){return k(this,void 0,void 0,function(){var k,l,m,n,p,q,u,t,w,x,v;return g(this,function(g){switch(g.label){case 0:return k=
D.determineRendererType(f),l=this.acquireRenderer(k,h.slicePlaneEnabled||!1,!1),m=C.EdgeInputBufferLayout.createBuffer(c.count),r.vec3.copy(m.position,c),n=this.createComponentBuffers(f),D.fillComponenBufferIndices(n.meta,e,m.componentIndex,d),p=l.writerSettings,[4,this.extractEdges(p,m,!0,!1,d)];case 1:return q=g.sent(),u=this.createEdgeResources(q),t=u.regular,w=u.silhouette,x=(t?t.vao.size:0)+(w?w.vao.size:0),v={regular:t,silhouette:w,transform:a,statistics:{gpuMemoryUsage:x,averageEdgeLength:q.averageEdgeLength},
components:n,visible:!0,edgeTransparency:D.determineEdgeTransparency(n.meta),objectTransparency:D.determineObjectTransparency(n.meta),distanceToCamera:0,rendererKey:l.key},b.renderables.push(v),l.addRenderable(v),this.gpuMemoryUsage+=x,[2]}})})};b.prototype.addObjectMergedGeometries=function(a,b,c,d){return k(this,void 0,void 0,function(){var e,f,k,l,m,n,r,q,u,t,w,x,v,y,A,z,B,C,G,F,E;return g(this,function(g){switch(g.label){case 0:e=new Map;f=0;l=k=null;for(m=0;m<a.geometries.length;m++)if(n=a.geometries[m],
r=a.geometryRecords[m],q=r.material,q.supportsEdges&&(!l&&r.origin&&(l=r),u=n.data.getIndices("position"),f+=u?u.length:0,u&&null==k||k===Uint16Array))k=h.isUint16Array(u)?Uint16Array:Uint32Array;t=f?new k(f):null;w=[];for(m=x=0;m<a.geometries.length;m++)if(n=a.geometries[m],v=a.geometryRecords[m],q=v.material,q.supportsEdges){y=n.data.getAttribute("position");u=n.data.getIndices("position");A=e.get(y.data);if(null==A){A=w.length/3;for(z=y.offsetIdx;z<y.data.length;z+=y.strideIdx)w.push(y.data[z+
0]),w.push(y.data[z+1]),w.push(y.data[z+2]);e.set(y.data,A)}if(u)for(B=0;B<u.length;B++)t[x++]=A+u[B]}C=l||a.geometryRecords[0];G=this.computeModelTransformWithLocalOrigin(a,C,p.mat4f64.create());F=C.origin;for(m=0;m<a.geometryRecords.length;m++)a.geometryRecords[m].origin=F;E={position:{data:w,offsetIdx:0,strideIdx:3},indices:t,modelTransform:G,origin:F};return[4,this.addPositionData(b,E,c[0],d)];case 1:return g.sent(),[2]}})})};b.prototype.acquireRenderer=function(a,b,c){void 0===c&&(c=!0);var d=
G.EdgeRenderer.getKey(a,b,c),e=this.renderers.get(d);this.strokesTexture||(this.strokesTexture=H.generateStrokesTexture(this.rctx));e||(e=new G.EdgeRenderer(this.rctx,this.techniqueRepository,{type:a,slicePlaneEnabled:b,strokesTexture:this.strokesTexture,legacy:c}),this.renderers.set(d,e));e.refCount.increment();return e};b.prototype.removeRenderable=function(a){var b=this.renderers.get(a.rendererKey);if(b){b.removeRenderable(a);b.refCount.decrement();a.regular&&(a.regular.vao.vertexBuffers.instances.dispose(),
a.regular.vao.dispose(!1),a.regular.vao=null);a.silhouette&&(a.silhouette.vao.vertexBuffers.instances.dispose(),a.silhouette.vao.dispose(!1),a.silhouette.vao=null);"origin"in a.transform&&this.localOrigins.release(a.transform.origin);this.gpuMemoryUsage-=a.statistics.gpuMemoryUsage;for(var b=0,c=a.components.meta;b<c.length;b++)a.components.buffer.releaseIndex(c[b].index)}};b.prototype.updateObjectCameraDistances=function(a){var b=this;a=a.viewInvTransp;t.vec3.set(this.tmpCameraPosition,a[3],a[7],
a[11]);this.perObjectData.forEach(function(a,c){c="getCenter"in c?c.getCenter():a.center;var d=t.vec3.distance(c,b.tmpCameraPosition);a.renderables.forEach(function(a){return a.distanceToCamera=d})})};b.prototype.renderRegularEdges=function(a,b,c){var d=this;a.bindRegularEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&e.regular){var f=D.computeEdgeCount(e.regular.lod.lengths,e.distanceToCamera,c);"origin"in e.transform&&(b.view=d.localOrigins.getViewMatrix(e.transform.origin));a.renderRegularEdges(e,
b,f);d.numberOfRenderedEdges+=f}},c.transparency)};b.prototype.renderSilhouetteEdges=function(a,b,c){var d=this;a.bindSilhouetteEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&e.silhouette){var f=D.computeEdgeCount(e.silhouette.lod.lengths,e.distanceToCamera,c);"origin"in e.transform&&(b.view=d.localOrigins.getViewMatrix(e.transform.origin));a.renderSilhouetteEdges(e,b,f);d.numberOfRenderedEdges+=f}},c.transparency)};return b}();b.EdgeView=n})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["require",
"exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.applyToModelMatrix=function(b,k){var g=-b[0],e=-b[1];b=-b[2];var f=k[3],l=k[7],h=k[11],d=k[15];k[0]+=f*g;k[1]+=f*e;k[2]+=f*b;k[4]+=l*g;k[5]+=l*e;k[6]+=l*b;k[8]+=h*g;k[9]+=h*e;k[10]+=h*b;k[12]+=d*g;k[13]+=d*e;k[14]+=d*b};b.applyToViewMatrix=function(b,k){var g=b[0],e=b[1];b=b[2];k[12]+=g*k[0]+e*k[4]+b*k[8];k[13]+=g*k[1]+e*k[5]+b*k[9];k[14]+=g*k[2]+e*k[6]+b*k[10];k[14]+=g*k[3]+e*k[7]+b*k[11]}})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/mat4f64","./localOriginHelper"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});n=function(){function b(b){this.factory=b;this.originData=new Map}b.prototype.acquire=function(b){return this.register(this.factory.getOrigin(b))};b.prototype.register=function(b){var e=this.originData.get(b.id);if(e)return e.refCount++,e.origin;this.originData.set(b.id,{refCount:1,viewMatrix:k.mat4f64.create(),origin:b});
return b};b.prototype.release=function(b){var e=this.originData.get(b.id);e&&(e.refCount--,0===e.refCount&&this.originData.delete(b.id))};b.prototype.updateViewMatrices=function(b){this.originData.forEach(function(e){m.mat4.copy(e.viewMatrix,b);g.applyToViewMatrix(e.origin.vec3,e.viewMatrix)})};b.prototype.getViewMatrix=function(b){return this.originData.get(b.id).viewMatrix};return b}();b.LocalOriginManager=n})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["require",
"exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.EdgeInputBufferLayout=k.newLayout().vec3f("position").u16("componentIndex").u16("_padding");b.VertexLayout=k.newLayout().vec2u8("sideness");b.glVertexLayout=m.glLayout(b.VertexLayout);b.CommonInstancesLayout=k.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",
{glNormalized:!0}).u8("_padding",{glPadding:!0}).u16("_padding2",{glPadding:!0});b.RegularEdgeInstancesLayout=b.CommonInstancesLayout.clone().vec3f("normal");b.SilhouetteEdgeInstancesLayout=b.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB");b.EdgeShaderAttributeLocations={position0:0,position1:1,componentIndex:2,variantOffset:4,variantStroke:5,variantExtension:6,normal:7,normalA:7,normalB:8,sideness:9}})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/RandomLCG ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(n,b,m,k,g,e,f,l,h){Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function b(){}b.prototype.updateSettings=function(a){this.settings=a};b.prototype.write=function(b,d,e){var f=a;f[0]=e.position0[0];f[1]=e.position0[1];f[2]=e.position0[2];f[3]=e.position1[0];f[4]=e.position1[1];f[5]=e.position1[2];q[0]=5381;for(f=0;f<c.length;f++)q[0]=31*q[0]+c[f];p.seed=q[0];var f=p.getIntRange(0,255),g=p.getIntRange(0,this.settings.variants-1),h=p.getFloat(),h=-(1-Math.min(h/.7,1))+Math.max(0,
h-.7)/(1-.7),h=255*(Math.pow(Math.abs(h),1.2)*(0>h?-1:1)*.5+.5);b.position0.setVec(d,e.position0);b.position1.setVec(d,e.position1);b.componentIndex.set(d,e.componentIndex);b.variantOffset.set(d,f);b.variantStroke.set(d,g);b.variantExtension.set(d,h)};b.prototype.trim=function(a,b){return a.slice(0,b)};return b}();b.CommonBufferWriter=d;var a=new Float32Array(6),c=new Uint32Array(a.buffer),q=new Uint32Array(1),p=new g;n=function(){function a(){this.commonWriter=new d}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};
a.prototype.allocate=function(a){return h.RegularEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);e.vec3.add(t,c.faceNormal0,c.faceNormal1);e.vec3.normalize(t,t);a.normal.setVec(b,t)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=h.RegularEdgeInstancesLayout;a.glLayout=l.glLayout(h.RegularEdgeInstancesLayout,{divisor:1});return a}();b.RegularEdgeBufferWriter=n;n=function(){function a(){this.commonWriter=new d}a.prototype.updateSettings=
function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return h.SilhouetteEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);a.normalA.setVec(b,c.faceNormal0);a.normalB.setVec(b,c.faceNormal1)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=h.SilhouetteEdgeInstancesLayout;a.glLayout=l.glLayout(h.SilhouetteEdgeInstancesLayout,{divisor:1});return a}();b.SilhouetteEdgeBufferWriter=n;var t=f.vec3f64.create()})},
"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("require exports ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/typedArrayUtil ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),function(n,b,m,k,g,e,f,l,h,d,a){return function(){function b(){this.regularWriter=
new d.RegularEdgeBufferWriter;this.silhouetteWriter=new d.SilhouetteEdgeBufferWriter}b.prototype.process=function(a,b){return m(this,void 0,void 0,function(){var c,d,e;return k(this,function(f){switch(f.label){case 0:if(!b)return[3,2];c=[];d=this.packInput(a,c);this.wrappedWork;return[4,b.invoke("wrappedWork",d,{transferList:c})];case 1:return e=f.sent(),[2,this.unpackOutput(e)];case 2:return[2,this.work(a)]}})})};b.prototype.wrappedWork=function(a){return m(this,void 0,void 0,function(){var b,c,
d,e;return k(this,function(f){b=this.unpackInput(a);c=this.work(b);d=[];this.packInputTransferables(b,d);e=this.packOutput(c,d);return[2,{result:e,transferList:d}]})})};b.prototype.work=function(b){var c=this.extractEdgeInformation(b.data,b.skipDeduplicate,b.originalIndices);this.regularWriter.updateSettings(b.writerSettings);this.silhouetteWriter.updateSettings(b.writerSettings);return a.extractEdges(c,this.regularWriter,this.silhouetteWriter)};b.prototype.packInputTransferables=function(a,b){b.push(a.data.buffer)};
b.prototype.packInput=function(a,b){this.packInputTransferables(a,b);b={dataBuffer:a.data.buffer,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate};a.originalIndices&&(b.originalIndicesBuffer=a.originalIndices.buffer,b.originalIndicesType=g.isUint32Array(a.originalIndices)?"Uint32Array":"Uint16Array");return b};b.prototype.unpackInput=function(a){return{data:h.EdgeInputBufferLayout.createView(a.dataBuffer),originalIndices:"Uint32Array"===a.originalIndicesType?new Uint32Array(a.originalIndicesBuffer):
"Uint16Array"===a.originalIndicesType?new Uint16Array(a.originalIndicesBuffer):void 0,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate}};b.prototype.packOutput=function(a,b){b.push(a.regular.lodInfo.lengths.buffer);b.push(a.silhouette.lodInfo.lengths.buffer);return{regular:{instancesData:l.packInterleavedBuffer(a.regular.instancesData,b),lodInfo:{lengths:a.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:l.packInterleavedBuffer(a.silhouette.instancesData,b),lodInfo:{lengths:a.silhouette.lodInfo.lengths.buffer}},
averageEdgeLength:a.averageEdgeLength}};b.prototype.unpackOutput=function(a){return{regular:{instancesData:l.unpackInterleavedBuffer(a.regular.instancesData),lodInfo:{lengths:new Float32Array(a.regular.lodInfo.lengths)}},silhouette:{instancesData:l.unpackInterleavedBuffer(a.silhouette.instancesData),lodInfo:{lengths:new Float32Array(a.silhouette.lodInfo.lengths)}},averageEdgeLength:a.averageEdgeLength}};b.prototype.extractEdgeInformation=function(a,b,c){if(b&&c)return b=f.computeNeighbors(c,a.count),
{faces:c,neighbors:b,vertices:a};a=e.default(a.buffer,a.stride/4,{originalIndices:c});b=f.computeNeighbors(a.indices,a.uniqueCount);return{faces:a.indices,neighbors:b,vertices:h.EdgeInputBufferLayout.createView(a.buffer)}};return b}()})},"esri/views/3d/support/meshProcessing":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.computeNeighbors=function(b,k){for(var g=b.length/3,e=new Uint32Array(k+1),f=new Uint32Array(k+1),l=function(a,b){a<b?e[a+
1]++:f[b+1]++},h=0;h<g;h++){var d=b[3*h],a=b[3*h+1],c=b[3*h+2];l(d,a);l(a,c);l(c,d)}for(h=a=d=0;h<k;h++)c=e[h+1],l=f[h+1],e[h+1]=d,f[h+1]=a,d+=c,a+=l;for(var m=new Uint32Array(6*g),n=e[k],l=function(a,b,c){if(a<b){var d=e[a+1]++;m[2*d]=b;m[2*d+1]=c}else d=f[b+1]++,m[2*n+2*d]=a,m[2*n+2*d+1]=c},h=0;h<g;h++)d=b[3*h],a=b[3*h+1],c=b[3*h+2],l(d,a,h),l(a,c,h),l(c,d,h);d=function(a,b){var c=2*a;a=b-a;for(b=1;b<a;b++){var d=m[c+2*b],e=m[c+2*b+1],f=b-1;for(f;0<=f&&m[c+2*f]>d;f--)m[c+2*f+2]=m[c+2*f],m[c+2*f+
3]=m[c+2*f+1];m[c+2*f+2]=d;m[c+2*f+3]=e}};for(h=0;h<k;h++)d(e[h],e[h+1]),d(n+f[h],n+f[h+1]);for(var t=new Int32Array(3*g),u=function(a,c){return a===b[3*c]?0:a===b[3*c+1]?1:a===b[3*c+2]?2:-1},g=function(a,b){a=u(a,b);t[3*b+a]=-1},d=function(a,b,c,d){a=u(a,b);t[3*b+a]=d;c=u(c,d);t[3*d+c]=b},h=0;h<k;h++){for(var a=e[h],c=e[h+1],l=f[h],r=f[h+1];a<c&&l<r;){var x=m[2*a],w=m[2*n+2*l];x===w?(d(h,m[2*a+1],w,m[2*n+2*l+1]),a++,l++):x<w?(g(h,m[2*a+1]),a++):(g(w,m[2*n+2*l+1]),l++)}for(;a<c;)g(h,m[2*a+1]),a++;
for(;l<r;)w=m[2*n+2*l],g(w,m[2*n+2*l+1]),l++}return t}})},"esri/views/3d/support/buffer/workerHelper":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","./BufferView","./InterleavedLayout"],function(n,b,m,k,g){function e(b){var d=[];b.fields.forEach(function(a,b){var c=a.constructor;a=m({},a,{constructor:c.ElementType+"_"+c.ElementCount});d.push([b,a])});return{stride:b.stride,fields:d,fieldNames:b.fieldNames}}function f(b){var d=g.newLayout();d.stride=b.stride;d.fieldNames=
b.fieldNames;b.fields.forEach(function(a){return d.fields.set(a[0],m({},a[1],{constructor:l.get(a[1].constructor)}))});return d}Object.defineProperty(b,"__esModule",{value:!0});b.packInterleavedBuffer=function(b,d){d.push(b.buffer);return{buffer:b.buffer,layout:e(b.layout)}};b.unpackInterleavedBuffer=function(b){return f(b.layout).createView(b.buffer)};b.packLayout=e;b.unpackLayout=f;n=[k.BufferViewFloat,k.BufferViewVec2f,k.BufferViewVec3f,k.BufferViewVec4f,k.BufferViewMat3f,k.BufferViewMat4f,k.BufferViewFloat64,
k.BufferViewVec2f64,k.BufferViewVec3f64,k.BufferViewVec4f64,k.BufferViewMat3f64,k.BufferViewMat4f64,k.BufferViewUint8,k.BufferViewVec2u8,k.BufferViewVec3u8,k.BufferViewVec4u8,k.BufferViewUint16,k.BufferViewVec2u16,k.BufferViewVec3u16,k.BufferViewVec4u16,k.BufferViewUint32,k.BufferViewVec2u32,k.BufferViewVec3u32,k.BufferViewVec4u32,k.BufferViewInt8,k.BufferViewVec2i8,k.BufferViewVec3i8,k.BufferViewVec4i8,k.BufferViewInt16,k.BufferViewVec2i16,k.BufferViewVec3i16,k.BufferViewVec4i16,k.BufferViewInt32,
k.BufferViewVec2i32,k.BufferViewVec3i32,k.BufferViewVec4i32];var l=new Map;n.forEach(function(b){return l.set(b.ElementType+"_"+b.ElementCount,b)})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("require exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/typedArrayUtil ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils".split(" "),function(n,b,m,k,g,e,f,l){function h(a,
b){var d=k.acosClamped(a.cosAngle),f=c.fwd,g=c.ortho;l.directionFromTo(f,a.position1,a.position0);a=0<e.vec3.dot(e.vec3.cross(g,a.faceNormal0,a.faceNormal1),f)?-1:1;return d*a>b}function d(a){var b=a.faces.length/3,c=a.faces;a=a.neighbors;for(var d=0,e=0;e<b;e++)var f=a[3*e+0],g=a[3*e+1],h=a[3*e+2],k=c[3*e+0],l=c[3*e+1],m=c[3*e+2],d=d+(-1===f||k<l?1:0),d=d+(-1===g||l<m?1:0),d=d+(-1===h||m<k?1:0);for(var d=new Int32Array(4*d),n=0,e=0;e<b;e++){f=a[3*e+0];g=a[3*e+1];h=a[3*e+2];k=c[3*e+0];l=c[3*e+1];
m=c[3*e+2];if(-1===f||k<l)d[n++]=k,d[n++]=l,d[n++]=e,d[n++]=f;if(-1===g||l<m)d[n++]=l,d[n++]=m,d[n++]=e,d[n++]=g;if(-1===h||m<k)d[n++]=m,d[n++]=k,d[n++]=e,d[n++]=h}return d}function a(a){var b=a.faces.length/3,c=a.vertices.position;a=a.faces;for(var d=q.v0,f=q.v1,g=q.v2,h=new Float32Array(3*b),k=0;k<b;k++){var l=a[3*k+1],m=a[3*k+2];c.getVec(a[3*k+0],d);c.getVec(l,f);c.getVec(m,g);e.vec3.subtract(f,f,d);e.vec3.subtract(g,g,d);e.vec3.cross(d,f,g);e.vec3.normalize(d,d);h[3*k+0]=d[0];h[3*k+1]=d[1];h[3*
k+2]=d[2]}return h}Object.defineProperty(b,"__esModule",{value:!0});b.extractEdges=function(b,f,l,n){void 0===n&&(n=p);var r=b.vertices.position,q=b.vertices.componentIndex,u=k.deg2rad(n.anglePlanar);n=k.deg2rad(n.angleSignificantEdge);var t=Math.cos(n),x=Math.cos(u),B=c.edge,C=B.position0,F=B.position1,E=B.faceNormal0,G=B.faceNormal1,H=a(b),D=d(b),I=D.length/4;b=f.allocate(I);n=0;var L=l.allocate(I),O=0,K=0,N=0,Q=m.range(0,I),M=new Float32Array(I);g.forEach(M,function(a,b,c){r.getVec(D[4*b+0],C);
r.getVec(D[4*b+1],F);c[b]=e.vec3.distance(C,F)});Q.sort(function(a,b){return M[b]-M[a]});for(var T=[],P=[],S=0;S<I;S++){var V=Q[S],J=M[V],U=D[4*V+0],Y=D[4*V+1],X=D[4*V+2],V=D[4*V+3],R=-1===V;r.getVec(U,C);r.getVec(Y,F);if(R)e.vec3.set(E,H[3*X+0],H[3*X+1],H[3*X+2]),e.vec3.copy(G,E),B.componentIndex=q.get(U),B.cosAngle=e.vec3.dot(E,G);else{e.vec3.set(E,H[3*X+0],H[3*X+1],H[3*X+2]);e.vec3.set(G,H[3*V+0],H[3*V+1],H[3*V+2]);B.componentIndex=q.get(U);B.cosAngle=e.vec3.dot(E,G);if(B.cosAngle>x)continue;-.9999>
B.cosAngle&&e.vec3.copy(G,E)}K+=J;N++;R||B.cosAngle<t?(f.write(b,n++,B),T.push(J)):h(B,u)&&(l.write(L,O++,B),P.push(J))}q=new Float32Array(T.reverse());u=new Float32Array(P.reverse());return{regular:{instancesData:f.trim(b,n),lodInfo:{lengths:q}},silhouette:{instancesData:l.trim(L,O),lodInfo:{lengths:u}},averageEdgeLength:K/N}};var c={edge:{position0:f.vec3f64.create(),position1:f.vec3f64.create(),faceNormal0:f.vec3f64.create(),faceNormal1:f.vec3f64.create(),componentIndex:0,cosAngle:0},ortho:f.vec3f64.create(),
fwd:f.vec3f64.create()},q={v0:f.vec3f64.create(),v1:f.vec3f64.create(),v2:f.vec3f64.create()},p={anglePlanar:4,angleSignificantEdge:35}})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../collections/Component/Material/ComponentTechnique ../../core/shaderLibrary/Slice.glsl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/util/TwoVectorPosition ./EdgeShaderTechnique".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u){Object.defineProperty(b,"__esModule",{value:!0});b.LINE_WIDTH_FRACTION_FACTOR=8;b.EXTENSION_LENGTH_OFFSET=128;var r={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0},x=function(){function a(){this._value=0}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.increment=function(){this._value++};a.prototype.decrement=function(){this._value--};return a}(),
w={solid:0,sketch:1,uber:2};n=function(){function d(a,b,c){var f,g,h;this.rctx=a;this.shaderTechniqueRepository=b;this.config=new u.EdgeShaderTechnique.Configuration;this.technique=null;this.refCount=new x;this.renderables=new Set;this.sortedRenderables=(f={},f[1]=(g={},g[1]=new e,g[2]=new e,g),f[2]=(h={},h[1]=new e,h[2]=new e,h),f);this.renderablesDirty=!1;this.settings=m({},r,c);this.key=d.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);this.writerSettings={variants:this.settings.strokesTexture.variants};
this.config.legacy=this.settings.legacy;this.config.mode=w[this.settings.type];this.config.silhouette=!1;this.config.antialiasing=!!this.rctx.capabilities.blendMinMax;this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled;this.config.doublePrecisionRequiresObfuscation=p.doublePrecisionRequiresObfuscation(a)}d.prototype.dispose=function(){this.technique&&(this.shaderTechniqueRepository.release(this.technique),this.technique=null)};d.prototype.addRenderable=function(a){this.renderables.add(a);
this.renderablesDirty=!0};d.prototype.removeRenderable=function(a){this.renderables.delete(a);this.renderablesDirty=!0};d.prototype.setRenderablesDirty=function(){this.renderablesDirty=!0};d.prototype.forEachRenderable=function(a,b){this.renderablesDirty&&this.sortRenderables();this.sortedRenderables[b][1].forEach(a);this.sortedRenderables[b][2].forEach(a)};d.prototype.bindRegularEdges=function(a,b){this.config.silhouette=!1;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(u.EdgeShaderTechnique,
this.config,this.technique);this.technique.bindPass(this.rctx,{renderParameters:a,edgeRenderParameters:b});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.bindProgram(this.technique.program)};d.prototype.bindSilhouetteEdges=function(a,b){this.config.silhouette=!0;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(u.EdgeShaderTechnique,this.config,this.technique);this.technique.bindPass(this.rctx,{renderParameters:a,edgeRenderParameters:b});this.rctx.setPipelineState(this.technique.pipeline);
this.rctx.bindProgram(this.technique.program)};d.prototype.renderRegularEdges=function(a,b,c){this.render(this.technique.program,a,a.regular.vao,b,c)};d.prototype.renderSilhouetteEdges=function(a,b,c){this.render(this.technique.program,a,a.silhouette.vao,b,c)};d.prototype.render=function(a,b,c,d,e){this.setUniforms(a,b,d);this.rctx.bindVAO(c);this.rctx.capabilities.instancing.drawArraysInstanced(6,0,4,e)};d.prototype.setUniforms=function(d,e,g){e.components.buffer.textureBuffer.bind(d,b.componentDataBindParameters);
if("origin"in e.transform)d.setUniformMatrix4fv("uView",g.view),d.setUniformMatrix4fv("uModel",e.transform.modelMatrix),c.Slice.bindUniforms(d,this.settings,g.slicePlane,e.transform.origin.vec3);else{var k=new t.TwoVectorPosition(e.transform.position),l=f.mat3.transpose(v,f.mat3.invert(v,e.transform.rotationScale)),m=new a.ComponentDrawParameters;h.vec3.copy(m.worldFromModel_TL,k.low);h.vec3.copy(m.worldFromModel_TH,k.high);f.mat3.copy(m.worldFromModel_RS,e.transform.rotationScale);f.mat3.copy(m.transformNormal_GlobalFromModel,
l);q.VertexPosition.bindModelTransform(d,m);d.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",m.transformNormal_GlobalFromModel);e=g.viewInvTransp;e=h.vec3.set(z,e[3],e[7],e[11]);c.Slice.bindUniforms(d,this.settings,g.slicePlane,e)}"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(d);d.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(g.fovY/2)/(g.viewport[3]/2))};d.prototype.setSketchUniforms=function(a){var b=this.settings.strokesTexture,c=b.texture;this.rctx.bindTexture(c,
0);a.setUniform1i("uStrokesTexture",0);a.setUniform2f("uStrokesTextureScale",1/c.descriptor.width,1/c.descriptor.height);a.setUniform1f("uStrokesLog2Resolution",g.log2(b.resolution));a.setUniform1f("uStrokesNormalizationScale",b.normalizationScale);a.setUniform1f("uStrokesAmplitude",b.amplitude);a.setUniform1f("uStrokeVariants",b.variants)};d.prototype.sortRenderables=function(){var a=this;this.renderablesDirty=!1;this.sortedRenderables[1][1].clear();this.sortedRenderables[1][2].clear();this.sortedRenderables[2][1].clear();
this.sortedRenderables[2][2].clear();this.renderables.forEach(function(b){0!==b.objectTransparency&&0!==b.edgeTransparency&&a.sortedRenderables[b.objectTransparency][b.edgeTransparency].push(b)});var b=function(a,b){return"origin"in a.transform&&"origin"in b.transform?a.transform.origin.id<b.transform.origin.id?-1:a.transform.origin.id>b.transform.origin.id?1:0:0};this.sortedRenderables[1][1].sort(b);this.sortedRenderables[1][2].sort(b);this.sortedRenderables[2][1].sort(b);this.sortedRenderables[2][2].sort(b)};
d.getKey=function(a,b,c){return"edges-t:"+a+":"+b+":"+c};return d}();b.EdgeRenderer=n;b.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2};var v=l.mat3f32.create(),z=d.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../webgl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../core/shaderTechnique/ShaderTechniqueConfiguration ../../shaders/sources/edgeRenderer/EdgeShaderProgram.glsl ../../../../webgl/renderState".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){Object.defineProperty(b,"__esModule",{value:!0});l=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}m(c,b);c.prototype.bindPass=function(a,b){a=this.program;var c=b.edgeRenderParameters;b=b.renderParameters;e.VertexPosition.bindViewProjTransform(a,c.viewProjectionTransform);a.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",c.transformNormal_ViewFromGlobal);a.setUniformMatrix4fv("uProj",b.proj);a.setUniform2f("uDepthBias",.5,-4E-4);a.setUniform2f("uPixelToNDC",
2/b.viewport[2],2/b.viewport[3]);a.setUniform2f("uNDCToPixel",b.viewport[2]/2,b.viewport[3]/2);a.setUniform1f("uDistanceFalloffFactor",c.distanceFalloffFactor);a.setUniform2f("uViewportDimInv",1/b.viewport[2],1/b.viewport[3]);a.setUniform1f("uPixelRatio",b.pixelRatio||1)};c.prototype.initializeProgram=function(a){var b=c.shader.get(),d=this.configuration,d=b.build({slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:d.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,silhouette:d.silhouette,
legacy:d.legacy,antialiasing:d.antialiasing,mode:d.mode,doublePrecisionRequiresObfuscation:d.doublePrecisionRequiresObfuscation});return new g.Program(a.rctx,d.generateSource("vertex"),d.generateSource("fragment"),b.attributeLocations)};c.prototype.initializePipeline=function(b){return(b=b.rctx.capabilities.blendMinMax)?a.makePipelineState({blending:a.separateBlendingParams(1,1,0,1,32774,b.MAX),depthTest:{func:515},colorWrite:a.defaultColorWriteParams}):a.makePipelineState({depthTest:{func:515},depthWrite:a.defaultDepthWriteParams,
colorWrite:a.defaultColorWriteParams})};c.shader=new f.ReloadableShaderModule(d,"../../shaders/sources/edgeRenderer/EdgeShaderProgram.glsl",n);return c}(l.ShaderTechnique);b.EdgeShaderTechnique=l;(function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.silhouette=!1;b.legacy=!1;b.antialiasing=!1;b.mode=0;b.doublePrecisionRequiresObfuscation=!1;return b}m(b,a);k([h.parameter()],b.prototype,"slicePlaneEnabled",void 0);
k([h.parameter()],b.prototype,"sliceHighlightDisabled",void 0);k([h.parameter()],b.prototype,"silhouette",void 0);k([h.parameter()],b.prototype,"legacy",void 0);k([h.parameter()],b.prototype,"antialiasing",void 0);k([h.parameter({count:3})],b.prototype,"mode",void 0);k([h.parameter()],b.prototype,"doublePrecisionRequiresObfuscation",void 0);return b}(h.ShaderTechniqueConfiguration);a.Configuration=b})(l=b.EdgeShaderTechnique||(b.EdgeShaderTechnique={}));b.EdgeShaderTechnique=l})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeShaderProgram.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderModules/interfaces ../../../core/shaderModules/ShaderBuilder ./AdjustProjectedPosition.glsl ./DiscardByCoverage.glsl ./DiscardNonSilhouetteEdges.glsl ./DiscardShortEdges.glsl ./EdgeUtil.glsl ./LineAmplitude.glsl ./LineOffset.glsl ./UnpackAttributes.glsl".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){Object.defineProperty(b,"__esModule",{value:!0});b.attributeLocations={position0:0,position1:1,componentIndex:2,packedAttributes:3,variantOffset:4,variantStroke:5,variantExtension:6,normal:7,normalA:7,normalB:8,sideness:9};b.build=function(b){var n=new e.ShaderBuilder,w=n.vertex,y=n.fragment;b.legacy&&w.uniforms.add("uModel","mat4");b.antialiasing&&(w.code.add(g.glsl(t||(t=m(["\n      #define ANTIALIASING 1\n    "],["\n      #define ANTIALIASING 1\n    "])))),
y.code.add(g.glsl(u||(u=m(["\n      #define ANTIALIASING 1\n    "],["\n      #define ANTIALIASING 1\n    "])))));n.include(f.AdjustProjectedPosition,b);n.include(c.LineAmplitude,b);n.include(a.EdgeUtil,b);n.include(p.UnpackAttributes,b);n.include(q.LineOffset,b);n.include(k.Slice,b);n.include(h.DiscardNonSilhouetteEdges,b);n.include(l.DiscardByCoverage,b);n.include(d.DiscardShortEdges,b);n.varyings.add("vColor","vec4");n.varyings.add("vRadius","float");n.varyings.add("vPosition","vec3");n.varyings.add("vWorldPosition",
"vec3");n.varyings.add("vLineLengthPixels","float");n.varyings.add("vSizeFalloffFactor","float");w.uniforms.add("uPixelToNDC","vec2");w.uniforms.add("uNDCToPixel","vec2");w.uniforms.add("uPixelRatio","float");n.attributes.add("position0","vec3");n.attributes.add("position1","vec3");n.attributes.add("variantOffset","float");n.attributes.add("variantStroke","float");n.attributes.add("variantExtension","float");w.code.add(g.glsl(r||(r=m(["\n    const float opaqueCutoff \x3d 1.0 / 255.0;\n\n    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n      vec2 sideness \x3d unpackedAttributes.sideness;\n      vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n      vWorldPosition \x3d mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\n\n      vec3 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\n\n      vec4 projPosV0 \x3d projFromViewPosition(viewPosV0);\n      vec4 projPosV1 \x3d projFromViewPosition(viewPosV1);\n      vec4 projPos \x3d projFromViewPosition(viewPos);\n\n      vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n      vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\n      float lineLengthPixels \x3d length(screenSpaceLinePixels);\n\n      float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\n      vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n      float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\n      float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\n\n      float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n      float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\n\n      vSizeFalloffFactor \x3d falloffFactor;\n\n      float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n      float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n    #ifdef ANTIALIASING\n      const float aaPaddingPixels \x3d 1.0;\n\n      // Line size with padding\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n      float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\n    #else /* ANTIALIASING */\n\n      // Even if there is no AA, we still want to do proper \x3c1px rendering,\n      // so we effectively clamp the pixel sizes to minimum of 1px and compute\n      // coverage in the fragment shader\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n      float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\n    #endif /* ANTIALIASING */\n\n      // Half line width in NDC including padding for anti aliasing\n      vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n      vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\n      vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\n\n      // Compute screen space position of vertex, offsetting for line size and end caps\n      vec2 ndcOffset \x3d (\n          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n      );\n\n      projPos.xy +\x3d ndcOffset * projPos.w;\n      projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n      projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n      // Line length with end caps\n      float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n      float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n      // Position in pixels with origin at first vertex of line segment\n      vPosition \x3d vec3(\n        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n        pixelPositionAlongLine,\n        pixelPositionAlongLine / extendedLineLengthPixels\n      );\n\n      // The line width radius in pixels\n      vRadius \x3d lineWidthPixels * 0.5;\n      vLineLengthPixels \x3d extendedLineLengthPixels;\n\n      // discard edges below a certain length threshold\n      discardShortEdges(unpackedAttributes, lineLengthPixels);\n\n      gl_Position \x3d projPos;\n    }\n\n    void main() {\n      ComponentData component \x3d readComponentData();\n      UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\n\n      vec3 worldPosV0 \x3d worldFromModelPosition(position0);\n      vec3 worldPosV1 \x3d worldFromModelPosition(position1);\n      vec3 viewPosV0 \x3d viewFromModelPosition(position0);\n      vec3 viewPosV1 \x3d viewFromModelPosition(position1);\n\n      // Component color\n      vColor \x3d component.color;\n\n      // Discard fully transparent edges\n      if (vColor.a \x3c opaqueCutoff) {\n        gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n        return;\n      }\n\n      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {\n        return;\n      }\n\n      // General geometric computation for all types of edges\n      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);\n\n      // Specific computation for different edge styles\n      calculateStyleOutputs(unpackedAttributes);\n    }\n  "],
["\n    const float opaqueCutoff \x3d 1.0 / 255.0;\n\n    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n      vec2 sideness \x3d unpackedAttributes.sideness;\n      vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n      vWorldPosition \x3d mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\n\n      vec3 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\n\n      vec4 projPosV0 \x3d projFromViewPosition(viewPosV0);\n      vec4 projPosV1 \x3d projFromViewPosition(viewPosV1);\n      vec4 projPos \x3d projFromViewPosition(viewPos);\n\n      vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n      vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\n      float lineLengthPixels \x3d length(screenSpaceLinePixels);\n\n      float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\n      vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n      float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\n      float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\n\n      float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n      float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\n\n      vSizeFalloffFactor \x3d falloffFactor;\n\n      float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n      float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n    #ifdef ANTIALIASING\n      const float aaPaddingPixels \x3d 1.0;\n\n      // Line size with padding\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n      float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\n    #else /* ANTIALIASING */\n\n      // Even if there is no AA, we still want to do proper \x3c1px rendering,\n      // so we effectively clamp the pixel sizes to minimum of 1px and compute\n      // coverage in the fragment shader\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n      float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\n    #endif /* ANTIALIASING */\n\n      // Half line width in NDC including padding for anti aliasing\n      vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n      vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\n      vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\n\n      // Compute screen space position of vertex, offsetting for line size and end caps\n      vec2 ndcOffset \x3d (\n          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n      );\n\n      projPos.xy +\x3d ndcOffset * projPos.w;\n      projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n      projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n      // Line length with end caps\n      float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n      float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n      // Position in pixels with origin at first vertex of line segment\n      vPosition \x3d vec3(\n        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n        pixelPositionAlongLine,\n        pixelPositionAlongLine / extendedLineLengthPixels\n      );\n\n      // The line width radius in pixels\n      vRadius \x3d lineWidthPixels * 0.5;\n      vLineLengthPixels \x3d extendedLineLengthPixels;\n\n      // discard edges below a certain length threshold\n      discardShortEdges(unpackedAttributes, lineLengthPixels);\n\n      gl_Position \x3d projPos;\n    }\n\n    void main() {\n      ComponentData component \x3d readComponentData();\n      UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\n\n      vec3 worldPosV0 \x3d worldFromModelPosition(position0);\n      vec3 worldPosV1 \x3d worldFromModelPosition(position1);\n      vec3 viewPosV0 \x3d viewFromModelPosition(position0);\n      vec3 viewPosV1 \x3d viewFromModelPosition(position1);\n\n      // Component color\n      vColor \x3d component.color;\n\n      // Discard fully transparent edges\n      if (vColor.a \x3c opaqueCutoff) {\n        gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n        return;\n      }\n\n      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {\n        return;\n      }\n\n      // General geometric computation for all types of edges\n      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);\n\n      // Specific computation for different edge styles\n      calculateStyleOutputs(unpackedAttributes);\n    }\n  "]))));
n.fragment.code.add(g.glsl(x||(x=m(["\n    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n      float lineOffset \x3d calculateLineOffset();\n      float positionX \x3d position.x - lineOffset;\n\n      if (radius \x3c 1.0) {\n        // Handle this specifically for subpixel sizes:\n        // 1. Compute correct coverage (note coverage is computed by\n        //    0.5 - dist, so we make sure that that will lead to correct\n        //    subpixel coverage\n        // 2. Ignore rounded caps\n        float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n        float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n        float coverage \x3d min(coverageX, coverageY);\n\n        return vec2(0.5 - coverage, 0.0);\n      }\n      else {\n        // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\n        float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\n\n        vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\n        return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n      }\n    }\n\n    void main() {\n      float radius \x3d vRadius * calculateLinePressure();\n\n      vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n      float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\n\n      discardByCoverage(radius, coverage);\n      discardBySlice(vWorldPosition);\n\n      float alpha \x3d vColor.a * coverage;\n\n      gl_FragColor \x3d vec4(vColor.rgb, alpha);\n\n    }\n  "],
["\n    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n      float lineOffset \x3d calculateLineOffset();\n      float positionX \x3d position.x - lineOffset;\n\n      if (radius \x3c 1.0) {\n        // Handle this specifically for subpixel sizes:\n        // 1. Compute correct coverage (note coverage is computed by\n        //    0.5 - dist, so we make sure that that will lead to correct\n        //    subpixel coverage\n        // 2. Ignore rounded caps\n        float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n        float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n        float coverage \x3d min(coverageX, coverageY);\n\n        return vec2(0.5 - coverage, 0.0);\n      }\n      else {\n        // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\n        float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\n\n        vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\n        return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n      }\n    }\n\n    void main() {\n      float radius \x3d vRadius * calculateLinePressure();\n\n      vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n      float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\n\n      discardByCoverage(radius, coverage);\n      discardBySlice(vWorldPosition);\n\n      float alpha \x3d vColor.a * coverage;\n\n      gl_FragColor \x3d vec4(vColor.rgb, alpha);\n\n    }\n  "]))));
return n};var t,u,r,x})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../core/shaderLibrary/util/IsNaN.glsl ../../../core/shaderModules/interfaces".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});b.AdjustProjectedPosition=function(b,a){b.include(g.IsNaN);b.include(k.VertexPosition,
a);b=b.vertex;b.uniforms.add("uDepthBias","vec2");b.uniforms.add("uViewportDimInv","vec2");a.legacy?(b.uniforms.add("uView","mat4"),b.uniforms.add("uProj","mat4")):b.uniforms.add("uTransformNormal_ViewFromGlobal","mat3");a.legacy?b.code.add(e.glsl(f||(f=m(["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uProj * uView * vec4(globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "],
["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uProj * uView * vec4(globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "])))):
b.code.add(e.glsl(l||(l=m(["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "],
["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "]))));
b.code.add(e.glsl(h||(h=m(["\n    // A z-offset, using a depth based heuristic.\n    float _calculateProjectedBiasZ(vec4 projPos) {\n      float offsetZ \x3d uDepthBias.y;\n      return sqrt(projPos.z) * offsetZ;\n    }\n\n    vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n      vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\n\n      // we currently have to do this check because some geometries come with 0 length edge normals.\n      // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n      if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\n        projPos.xy +\x3d offsetXY;\n      }\n\n      projPos.z +\x3d _calculateProjectedBiasZ(projPos);\n\n      return projPos;\n    }\n  "],
["\n    // A z-offset, using a depth based heuristic.\n    float _calculateProjectedBiasZ(vec4 projPos) {\n      float offsetZ \x3d uDepthBias.y;\n      return sqrt(projPos.z) * offsetZ;\n    }\n\n    vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n      vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\n\n      // we currently have to do this check because some geometries come with 0 length edge normals.\n      // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n      if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\n        projPos.xy +\x3d offsetXY;\n      }\n\n      projPos.z +\x3d _calculateProjectedBiasZ(projPos);\n\n      return projPos;\n    }\n  "]))))};
var f,l,h})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.IsNaN=function(b){var e=k.glsl(g||(g=m(["\n    bool isNaN( float val )\n    {\n      return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\n      // important: some nVidias failed to cope with version below.\n      // Probably wrong optimization.\n      /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\n    }\n  "],
["\n    bool isNaN( float val )\n    {\n      return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\n      // important: some nVidias failed to cope with version below.\n      // Probably wrong optimization.\n      /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\n    }\n  "])));b.fragment.code.add(e);b.vertex.code.add(e)};var g})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper",
"../../../core/shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.DiscardByCoverage=function(b,l){b=b.fragment;b.defines.addFloat("COVERAGE_TEST_THRESHOLD",.01);l.antialiasing?b.code.add(k.glsl(g||(g=m(["\n      #define discardByCoverage(radius, coverage) { if (coverage \x3c COVERAGE_TEST_THRESHOLD) discard; }\n    "],["\n      #define discardByCoverage(radius, coverage) { if (coverage \x3c COVERAGE_TEST_THRESHOLD) discard; }\n    "])))):b.code.add(k.glsl(e||
(e=m(["\n      #define discardByCoverage(radius, coverage) { float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75; if (coverage \x3c coverageLimit) discard; }\n    "],["\n      #define discardByCoverage(radius, coverage) { float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75; if (coverage \x3c coverageLimit) discard; }\n    "]))))};var g,e})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../../core/shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.DiscardNonSilhouetteEdges=function(b,d){b=b.vertex;d.silhouette?(b.code.add(k.glsl(g||(g=m(["\n      bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {\n        float faceAVisible \x3d dot(viewDir, normalA);\n        float faceBVisible \x3d dot(viewDir, normalB);\n        return faceAVisible * faceBVisible \x3c 0.0;\n      }\n    "],
["\n      bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {\n        float faceAVisible \x3d dot(viewDir, normalA);\n        float faceBVisible \x3d dot(viewDir, normalB);\n        return faceAVisible * faceBVisible \x3c 0.0;\n      }\n    "])))),d.legacy?b.code.add(k.glsl(e||(e=m(["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 viewNormalA \x3d _modelToViewNormal(normalA);\n          vec3 viewNormalB \x3d _modelToViewNormal(normalB);\n          vec3 viewDir \x3d -viewPos;\n\n          if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "],
["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 viewNormalA \x3d _modelToViewNormal(normalA);\n          vec3 viewNormalB \x3d _modelToViewNormal(normalB);\n          vec3 viewDir \x3d -viewPos;\n\n          if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "])))):b.code.add(k.glsl(f||(f=m(["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 worldNormalA \x3d _modelToWorldNormal(normalA);\n          vec3 worldNormalB \x3d _modelToWorldNormal(normalB);\n          vec3 viewDir \x3d -worldPos;\n\n          if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "],
["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 worldNormalA \x3d _modelToWorldNormal(normalA);\n          vec3 worldNormalB \x3d _modelToWorldNormal(normalB);\n          vec3 viewDir \x3d -worldPos;\n\n          if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "]))))):b.code.add(k.glsl(l||(l=m(["\n      bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n        return false;\n      }\n    "],
["\n      bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n        return false;\n      }\n    "]))))};var g,e,f,l})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../../core/shaderModules/interfaces"],function(n,b,m,k){Object.defineProperty(b,"__esModule",{value:!0});b.DiscardShortEdges=function(b,h){b=b.vertex;switch(h.mode){case 1:b.code.add(k.glsl(g||
(g=m(["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "],["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "]))));break;case 2:b.code.add(k.glsl(e||(e=m(["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "],
["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "]))));break;case 0:b.code.add(k.glsl(f||(f=m(["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) {}\n      "],["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) {}\n      "]))))}};var g,e,f})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../../core/shaderLibrary/util/DoublePrecision.glsl","../../../core/shaderModules/interfaces"],function(n,b,m,k,g){function e(b,e){var n=b.vertex;n.uniforms.add("uDistanceFalloffFactor","float");n.code.add(g.glsl(f||(f=m(["\n    float distanceBasedPerspectiveFactor(float distance) {\n      return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n    }\n  "],["\n    float distanceBasedPerspectiveFactor(float distance) {\n      return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n    }\n  "]))));
n.uniforms.add("uComponentDataTex","sampler2D");n.uniforms.add("uComponentDataTexInvDim","vec2");b.attributes.add("componentIndex","float");n.defines.addFloat("COMPONENT_COLOR_FIELD_OFFSET",0);n.defines.addFloat("COMPONENT_OTHER_FIELDS_OFFSET",1);n.defines.addFloat("COMPONENT_FIELD_COUNT",2);n.defines.addFloat("LINE_WIDTH_FRACTION_FACTOR",8);n.defines.addFloat("EXTENSION_LENGTH_OFFSET",128);n.defines.addFloat("COMPONENT_TEX_WIDTH",4096);n.code.add(g.glsl(l||(l=m(["\n    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {\n      float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n      float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\n      float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n      vec2 linearIndex \x3d vec2(\n        (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n        (rowIndex + 0.5) * uComponentDataTexInvDim.y\n      );\n\n      return linearIndex;\n    }\n\n    struct ComponentData {\n      vec4 color;\n      float lineWidth;\n      float extensionLength;\n      float type;\n    };\n\n    ComponentData readComponentData() {\n      vec2 colorIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n      vec2 otherIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n      vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\n      vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\n\n      return ComponentData(\n        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n        otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n        otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n        -(otherValue.z * 255.0) + 0.5 // SOLID (\x3d0/255) needs to be \x3e 0.0, SKETCHY (\x3d1/255) needs to be \x3c\x3d 0;\n      );\n    }\n  "],
["\n    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {\n      float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n      float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\n      float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n      vec2 linearIndex \x3d vec2(\n        (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n        (rowIndex + 0.5) * uComponentDataTexInvDim.y\n      );\n\n      return linearIndex;\n    }\n\n    struct ComponentData {\n      vec4 color;\n      float lineWidth;\n      float extensionLength;\n      float type;\n    };\n\n    ComponentData readComponentData() {\n      vec2 colorIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n      vec2 otherIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n      vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\n      vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\n\n      return ComponentData(\n        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n        otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n        otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n        -(otherValue.z * 255.0) + 0.5 // SOLID (\x3d0/255) needs to be \x3e 0.0, SKETCHY (\x3d1/255) needs to be \x3c\x3d 0;\n      );\n    }\n  "]))));
e.legacy?n.code.add(g.glsl(h||(h=m(["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return (uModel * vec4(normal, 0.0)).xyz;\n      }\n\n      vec3 _modelToViewNormal(vec3 normal) {\n        return (uView * uModel * vec4(normal, 0.0)).xyz;\n      }\n    "],["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return (uModel * vec4(normal, 0.0)).xyz;\n      }\n\n      vec3 _modelToViewNormal(vec3 normal) {\n        return (uView * uModel * vec4(normal, 0.0)).xyz;\n      }\n    "])))):
(n.uniforms.add("uTransformNormal_GlobalFromModel ","mat3"),n.code.add(g.glsl(d||(d=m(["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return uTransformNormal_GlobalFromModel * normal;\n      }\n    "],["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return uTransformNormal_GlobalFromModel * normal;\n      }\n    "])))));e.silhouette?(b.attributes.add("normalA","vec3"),b.attributes.add("normalB","vec3"),n.code.add(g.glsl(a||(a=m(["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normalize(normalA + normalB));\n      }\n    "],
["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normalize(normalA + normalB));\n      }\n    "]))))):(b.attributes.add("normal","vec3"),n.code.add(g.glsl(c||(c=m(["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normal);\n      }\n    "],["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normal);\n      }\n    "])))));e.legacy?n.code.add(g.glsl(q||(q=m(["\n      vec3 worldFromModelPosition(vec3 position) {\n        return (uModel * vec4(position, 1.0)).xyz;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uProj * vec4(position, 1.0);\n      }\n    "],
["\n      vec3 worldFromModelPosition(vec3 position) {\n        return (uModel * vec4(position, 1.0)).xyz;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uProj * vec4(position, 1.0);\n      }\n    "])))):(b.include(k.DoublePrecision,e),n.code.add(g.glsl(p||(p=m(["\n      vec3 worldFromModelPosition(vec3 position) {\n        vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * position;\n\n        vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n          uTransform_WorldFromModel_TL,\n          uTransform_WorldFromModel_TH,\n          -uTransform_WorldFromView_TL,\n          -uTransform_WorldFromView_TH\n        );\n\n        return transform_CameraRelativeFromModel + rotatedModelPosition;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uTransform_ProjFromView * vec4(position, 1.0);\n      }\n    "],
["\n      vec3 worldFromModelPosition(vec3 position) {\n        vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * position;\n\n        vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n          uTransform_WorldFromModel_TL,\n          uTransform_WorldFromModel_TH,\n          -uTransform_WorldFromView_TL,\n          -uTransform_WorldFromView_TH\n        );\n\n        return transform_CameraRelativeFromModel + rotatedModelPosition;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uTransform_ProjFromView * vec4(position, 1.0);\n      }\n    "])))));
n.code.add(g.glsl(t||(t=m(["\n    float calculateExtensionLength(float extensionLength, float lineLength) {\n      return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n    }\n  "],["\n    float calculateExtensionLength(float extensionLength, float lineLength) {\n      return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n    }\n  "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.EdgeUtil=e;(function(a){a.usesSketchLogic=function(a){return 1===a.mode||
2===a.mode};a.usesSolidLogic=function(a){return 0===a.mode||2===a.mode}})(e=b.EdgeUtil||(b.EdgeUtil={}));var f,l,h,d,a,c,q,p,t})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../core/shaderModules/interfaces ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),function(n,b,m,k,g,e){Object.defineProperty(b,"__esModule",{value:!0});b.LineAmplitude=function(b,a){var c=b.vertex;
b.include(e.UnpackAttributes,a);g.EdgeUtil.usesSketchLogic(a)&&c.uniforms.add("uStrokesAmplitude","float");switch(a.mode){case 0:c.code.add(k.glsl(f||(f=m(["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return 0.0;\n        }\n      "],["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return 0.0;\n        }\n      "]))));break;case 1:c.code.add(k.glsl(l||(l=m(["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return uStrokesAmplitude;\n        }\n      "],
["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return uStrokesAmplitude;\n        }\n      "]))));break;case 2:c.code.add(k.glsl(h||(h=m(["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          float type \x3d unpackedAttributes.type;\n\n          if (type \x3c\x3d 0.0) {\n            return uStrokesAmplitude;\n          }\n          else {\n            return 0.0;\n          }\n        }\n      "],["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          float type \x3d unpackedAttributes.type;\n\n          if (type \x3c\x3d 0.0) {\n            return uStrokesAmplitude;\n          }\n          else {\n            return 0.0;\n          }\n        }\n      "]))))}};
var f,l,h})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../../core/shaderModules/interfaces","./EdgeUtil.glsl"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});b.UnpackAttributes=function(a,b){var c=a.vertex;a.include(g.EdgeUtil,b);a.attributes.add("sideness","vec2");2===b.mode?c.code.add(k.glsl(e||(e=m(["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n        float type;\n      };\n    "],
["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n        float type;\n      };\n    "])))):c.code.add(k.glsl(f||(f=m(["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n      };\n  "],["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n      };\n  "]))));
switch(b.mode){case 2:c.code.add(k.glsl(l||(l=m(["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float fType \x3d component.type;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          if (fType \x3c\x3d 0.0) {\n            extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          }\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n        }\n      "],
["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float fType \x3d component.type;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          if (fType \x3c\x3d 0.0) {\n            extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          }\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n        }\n      "]))));
break;case 1:c.code.add(k.glsl(h||(h=m(["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "],
["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "]))));break;case 0:c.code.add(k.glsl(d||
(d=m(["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "],["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "]))))}};
var e,f,l,h,d})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/interfaces ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),function(n,b,m,k,g,e,f){Object.defineProperty(b,"__esModule",{value:!0});b.LineOffset=function(b,n){var r=b.vertex;b.include(f.UnpackAttributes,n);var u=b.fragment;b.include(k.RgbaFloatEncoding);
e.EdgeUtil.usesSketchLogic(n)&&(r.uniforms.add("uStrokesTextureScale","vec2"),r.uniforms.add("uStrokesLog2Resolution","float"),r.uniforms.add("uStrokeVariants","float"),b.varyings.add("vStrokeUV","vec2"),u.uniforms.add("uStrokesTexture","sampler2D"),u.uniforms.add("uStrokesNormalizationScale","float"),r.code.add(g.glsl(l||(l=m(["\n      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n        vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n        float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n        vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;\n        vStrokeUV.x +\x3d variantOffset;\n      }\n    "],
["\n      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n        vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n        float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n        vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;\n        vStrokeUV.x +\x3d variantOffset;\n      }\n    "])))),u.code.add(g.glsl(h||(h=m(["\n      float calculateLineOffsetSketch() {\n        float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n        return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n      }\n\n      float calculateLinePressureSketch() {\n        return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\n      }\n    "],
["\n      float calculateLineOffsetSketch() {\n        float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n        return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n      }\n\n      float calculateLinePressureSketch() {\n        return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\n      }\n    "])))));switch(n.mode){case 0:r.code.add(g.glsl(d||(d=m(["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}\n      "],["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}\n      "]))));
u.code.add(g.glsl(a||(a=m(["\n        float calculateLineOffset() {\n          return 0.0;\n        }\n\n        float calculateLinePressure() {\n          return 1.0;\n        }\n      "],["\n        float calculateLineOffset() {\n          return 0.0;\n        }\n\n        float calculateLinePressure() {\n          return 1.0;\n        }\n      "]))));break;case 1:r.code.add(g.glsl(c||(c=m(["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n        }\n      "],
["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n        }\n      "]))));u.code.add(g.glsl(q||(q=m(["\n        float calculateLineOffset() {\n          return calculateLineOffsetSketch();\n        }\n\n        float calculateLinePressure() {\n          return calculateLinePressureSketch();\n        }\n      "],["\n        float calculateLineOffset() {\n          return calculateLineOffsetSketch();\n        }\n\n        float calculateLinePressure() {\n          return calculateLinePressureSketch();\n        }\n      "]))));
break;case 2:b.varyings.add("vType","float"),r.code.add(g.glsl(p||(p=m(["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          vType \x3d unpackedAttributes.type;\n\n          if (unpackedAttributes.type \x3c\x3d 0.0) {\n            calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n          }\n        }\n      "],["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          vType \x3d unpackedAttributes.type;\n\n          if (unpackedAttributes.type \x3c\x3d 0.0) {\n            calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n          }\n        }\n      "])))),
u.code.add(g.glsl(t||(t=m(["\n        float calculateLineOffset() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLineOffsetSketch();\n          }\n          else {\n            return 0.0;\n          }\n        }\n\n        float calculateLinePressure() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLinePressureSketch();\n          }\n          else {\n            return 1.0;\n          }\n        }\n      "],["\n        float calculateLineOffset() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLineOffsetSketch();\n          }\n          else {\n            return 0.0;\n          }\n        }\n\n        float calculateLinePressure() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLinePressureSketch();\n          }\n          else {\n            return 1.0;\n          }\n        }\n      "]))))}};
var l,h,d,a,c,q,p,t})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/mathUtils ../Util ../../../../webgl/Texture".split(" "),function(n,b,m,k,g,e){function f(b,a){if(!b)return null;var c=b.length/2,d=l*c,c=Array(c),e=0;a=1===a;for(var f=0;f<b.length;f+=2){var g=(b[f]+b[f+1])/2;a?c[e++]=Math.min(d,1-(1-g)*h):c[e++]=Math.min(d,g*h)}return c}Object.defineProperty(b,"__esModule",{value:!0});b.generateStrokesTexture=
function(d){for(var a=b.strokesDefinition.resolution,c=a/2,h=new Uint8Array(4*a*a),l=4*a*c,c=b.strokesDefinition.amplitude,m=2*c,n=4*a,r=k.log2(a)+1,x=b.strokesDefinition.strokes.length,w=(r-1)*x*n,v=0,z=b.strokesDefinition.strokes;v<z.length;v++){for(var y=z[v],A=y.distance,y=y.pressure,B=w,C=0;C<r;C++){0!==C&&(A=f(A,0),y=f(y,1));for(var F=0;F<b.strokesDefinition.resolution;F++){var E=y?y[F%y.length]:1;g.packFloatRGBA((A?A[F%A.length]/m:0)+.5,h,B);g.packFloatRGBA(E,h,B+l);B+=4}B-=n*(x+1)}w+=n}d=
new e(d,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:a,height:a,wrapMode:10497},h);return{resolution:a,texture:d,normalizationScale:m,amplitude:c,variants:x}};b.rasterizeStrokes=function(){for(var d=b.strokesDefinition.resolution,a=k.log2(d)+1,c=b.strokesDefinition.strokes.length,e=b.strokesDefinition.amplitude,g=Math.ceil(2*e+.5),h=0;1<=d;)h+=d,d/=2;var h=h+6*(a+1),c=c*g,d=new Uint8ClampedArray(4*h*c),l=4*h;d.fill(255);for(var m=24,n=0,w=b.strokesDefinition.strokes;n<w.length;n++){for(var v=
w[n],z=v.distance,v=v.pressure,y=m,A=0;A<a;A++){0!==A&&(z=f(z,0),v=f(v,1));for(var B=0;B<z.length;B++){for(var C=z?z[B]:0,F=v?k.clamp(v[B],0,1):1,E=y,G=-e;G<g-e;G++){var H=255-255*k.clamp(1-(Math.abs(G-C+.5)-.5*F),0,1);d[E+0]=H;d[E+1]=H;d[E+2]=H;d[E+3]=255;E+=l}y+=4}y+=24}m+=g*l}return new ImageData(d,h,c)};var l=.1,h=.5;b.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,
-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,
.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,
.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,
-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,
.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,
.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,
.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,
-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,
-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,
1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,
.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,
-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,
.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,
.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,
.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,
.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,
4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,
3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,
.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,
.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,
.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,
.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,
.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,
1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,
-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,
.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,
2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,
.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,
.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,
.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,
-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,
1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,
.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,
-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,
.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,
.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,
.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,
.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,
4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,
.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,
-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],
pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,
.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,
.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,
.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["require","exports","../../../../../core/arrayUtils","../../../../../core/maybe","../../../../../core/typedArrayUtil"],function(n,b,m,k,g){function e(b){return 0<
b.size*b.color[3]*b.opacity}function f(b,e){var d=m.binaryIndexOf(b,e,!0);return-1===d?e<b[0]?0:b.length:d}Object.defineProperty(b,"__esModule",{value:!0});b.determineRendererType=function(b){for(var f=null,d=0;d<b.length;d++){var a=b[d],c=a.type;if(e(a))if(k.isNone(f))f=c;else if(f!==c)return"uber"}return k.isSome(f)?f:"solid"};b.determineEdgeTransparency=function(b){for(var f=0,d=0;d<b.length;d++){var a=b[d].material;if(e(a)){if(1>a.color[3]*a.opacity)return 1;f=2}}return f};b.determineObjectTransparency=
function(b){for(var f=0,d=0;d<b.length;d++){var a=b[d].material;if(e(a)){switch(a.objectTransparency){case 1:case 0:return 1}f=2}}return f};b.cloneIndices=function(b){if(Uint16Array.from)return g.isUint16Array(b)?Uint16Array.from(b):Uint32Array.from(b);for(var e=g.isUint16Array(b)?new Uint16Array(b.length):new Uint32Array(b.length),d=0;d<b.length;d++)e[d]=b[d];return e};b.estimateLengthAtDistance=function(b,e,d,a){return a/b*d*2*Math.tan(.5*e)};b.findLowerBoundIndex=f;b.computeEdgeCount=function(b,
e,d){return b.length-f(b,e*d.minimumEdgeLength)};b.fillComponenBufferIndices=function(b,e,d,a){for(var c=0;c<b.length;c++){var f=b[c].index,g=e[c],h=e[c+1];if(a)for(;g<h;g++)d.set(a[g],f);else for(;g<h;g++)d.set(g,f)}}})},"esri/views/webgl/Profiling":function(){define(["require","exports"],function(n,b){Object.defineProperty(b,"__esModule",{value:!0});b.startMeasurement=function(b){return(b=b.capabilities.disjointTimerQuery)?new m(b):null};b.getTimestamp=function(b,g,e){void 0===e&&(e=50);var f=b.capabilities.disjointTimerQuery;
if(!f||0>=f.timestampBits())return!1;var k=f.createQuery();f.createTimestamp(k);var h=function(){var b=f.resultAvailable(k),a=f.disjoint();b&&!a?(b=f.getResult(k),g(b/1E6)):a?g():setTimeout(h,e)};h();return!0};b.supportsTimestamps=function(b){b=b.capabilities.disjointTimerQuery;if(!b)return!1;b=b.timestampBits();console.log({bits:b});return 0<b};var m=function(){function b(b){this.timer=b;this.query=b.createQuery();this.timer.beginTimeElapsed(this.query)}b.prototype.stop=function(b,e){void 0===e&&
(e=50);this.cb=b;this.checkInterval=e;this.timer.endTimeElapsed();this.checkQueryResult()};b.prototype.checkQueryResult=function(){var b=this.timer.resultAvailable(this.query),e=this.timer.disjoint();b&&!e?(b=this.timer.getResult(this.query),this.cb(b/1E6)):e?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval)};return b}()})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("require exports ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/scheduling ./TextureTechnique ./Util ../../../webgl/Texture".split(" "),
function(n,b,m,k,g,e,f,l,h,d){Object.defineProperty(b,"__esModule",{value:!0});var a=k.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");n=function(){function b(a,b,c){this.textures=a;this.rctx=c;this._loadingCount=0;this.frameUpdates=new Map;this._unloadDeferredHandle=this._fallbackTextureTransparent=this._fallbackTexture=null;this._texturesToUnload=[];this.events=new m;this.textureTechniqueConfig=new l.TextureTechniqueConfiguration;this.textureTechnique=b.acquireAndReleaseExisting(l.TextureTechnique,
this.textureTechniqueConfig,this.textureTechnique);this.rctx=c;this.idToRefCountedTexture=new Map;this.initializeFallbackTextures()}b.prototype.dispose=function(){g.isSome(this._unloadDeferredHandle)&&(this._unloadDeferredHandle.remove(),this._unloadDeferredHandle=null);this.textures.forEach(function(a){a.unload()})};b.prototype.initializeFallbackTextures=function(){this.fallbackTextureData=new Uint8Array(256);this.fallbackTextureTransparentData=new Uint8Array(256);for(var a=0;a<this.fallbackTextureData.length;++a)this.fallbackTextureData[a]=
255,this.fallbackTextureTransparentData[a]=0!==(a+1)%4?255:0;this.fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:this.rctx.parameters.maxMaxAnisotropy}};b.prototype.acquire=function(a,b,c){a=this.getOrCreateRef(a,b,c);a.ref();return a};b.prototype.update=function(){var a=this,b=!1;this.frameUpdates.forEach(function(c){var d=c.texture.frameUpdate(a.rctx,a.textureTechnique,c.previousToken);0<=d&&d!==c.previousToken&&(c.previousToken=
d,b=!0)});b&&this.events.emit("changed",{requestType:0})};b.prototype.getOrCreateRef=function(a,b,c){var d=this.idToRefCountedTexture.get(a);return d?d:this.createNewRef(a,b,c)};b.prototype.createNewRef=function(b,d,f){var g=this,k=this.textures.get(b);h.assert(void 0!==k);var l=k.events.on("unloaded",function(){l.remove();g._onTextureUnloaded(b)});d=!0===d;var m=new c;this.idToRefCountedTexture.set(b,m);var n=k.load(this.rctx,this.textureTechnique);this._loadingCount++;var p=function(a){g._loadingCount--;
g.updateGLTexture(m,a);f&&f(m);k.requiresFrameUpdates&&g.frameUpdates.set(b,{texture:k,previousToken:-1});return m},q=function(b){g._loadingCount--;e.isAbortError(b)||a.error(b)};e.isThenable(n)?(this.updateGLTexture(m,d?this.fallbackTextureTransparent:this.fallbackTexture),n.then(p,q)):p(n);return m};b.prototype.updateGLTexture=function(a,b){a.glTexture=b;this.events.emit("changed",{requestType:1})};b.prototype.release=function(a){var b=this,c=this.idToRefCountedTexture.get(a);c&&(c.unref(),c.isUnreferenced&&
(this._texturesToUnload.push(a),g.isNone(this._unloadDeferredHandle)&&(this._unloadDeferredHandle=f.schedule(function(){return b.unloadDeferred()}))))};b.prototype.unloadDeferred=function(){for(var a=this._texturesToUnload,b=this._texturesToUnload.length=0;b<a.length;b++){var c=a[b],d=this.textures.get(c),c=this.idToRefCountedTexture.get(c);d&&c&&c.isUnreferenced&&d.unload()}};b.prototype.getTexture=function(a){return this.textures.get(a)};Object.defineProperty(b.prototype,"loadingCount",{get:function(){return this._loadingCount},
enumerable:!0,configurable:!0});b.prototype._onTextureUnloaded=function(a){this.idToRefCountedTexture.delete(a);this.frameUpdates.delete(a)};Object.defineProperty(b.prototype,"fallbackTexture",{get:function(){this._fallbackTexture||(this._fallbackTexture=new d(this.rctx,this.fallbackTextureDesc,this.fallbackTextureData));return this._fallbackTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fallbackTextureTransparent",{get:function(){this._fallbackTextureTransparent||(this._fallbackTextureTransparent=
new d(this.rctx,this.fallbackTextureDesc,this.fallbackTextureTransparentData));return this._fallbackTextureTransparent},enumerable:!0,configurable:!0});return b}();b.TextureRepository=n;var c=function(){function b(){this._refCount=0;this.glTexture=null}Object.defineProperty(b.prototype,"isUnreferenced",{get:function(){return 0===this._refCount},enumerable:!0,configurable:!0});b.prototype.ref=function(){++this._refCount};b.prototype.unref=function(){0===this._refCount?a.error("Cannot dereference texture that has no references!"):
--this._refCount};return b}();b.RefCountedTexture=c})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec4f64 ../lib/AutoDisposable ../../../support/screenshotUtils ../../../webgl/FramebufferObject".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){Object.defineProperty(b,"__esModule",{value:!0});n=function(b){function d(a,c,d,e,f,g){void 0===e&&(e=null);void 0===g&&(g=!0);var h=b.call(this)||this;h._rctx=a;h._renderScene=c;h._requestRenderScene=d;h._renderOverlay=e;h.forceCameraHook=f;h.supersample=g;h._screenshotQueue=[];return h}k(d,b);d.prototype.dispose=function(){this._rctx=null};d.prototype.takeScreenshot=function(a){var b=this;this._requestRenderScene();var c=f.createResolver(function(){b._screenshotQueue=
b._screenshotQueue.filter(function(a){return a.resolver!==c})});this._screenshotQueue.push({settings:a,resolver:c});return c.promise};d.prototype.update=function(b){if(0!==this._screenshotQueue.length){for(var c=0,d=this._screenshotQueue;c<d.length;c++){var e=d[c];if(this.isDisposed)e.resolver.reject();else{var f=m({},e.settings,{pixelRatio:e.settings.pixelRatio*b.viewCamera.pixelRatio}),g=this._ensureScreenshotEncodeCanvas(),h=this._renderScreenshot(b,f),f=a.encodeResult(h,f,g,{flipY:!0,premultipliedAlpha:!0});
e.resolver(f)}}this._screenshotQueue=[]}};d.prototype._renderScreenshotOverlay=function(a,b,c){if(!e.isNone(this._renderOverlay)){a.width=b.width;a.height=b.height;var d=a.getContext("2d"),f=c.pixelRatio;d.save();d.translate(0,b.height);d.scale(1,-1);c.region&&d.translate(-c.region.x,-c.region.y);d.scale(f,f);this._renderOverlay(a,b);d.restore()}};d.prototype._readbackScreenshot=function(a){return a.resample?this._readbackScreenshotResampled(a):this._readbackScreenshotImmediate(a)};d.prototype._readbackScreenshotResampled=
function(b){var c=b.framebufferWidth,d=b.framebufferHeight,e=b.region,f=b.resample,g=this._ensureScreenshotEncodeCanvas(),h=a.createEmptyImageData(c,d,g);this._rctx.gl.readPixels(0,0,c,d,6408,5121,new Uint8Array(h.data.buffer));this._renderScreenshotOverlay(g,h,m({},b,{region:null}));b=a.createEmptyImageData(e.width,e.height,g);return a.resampleHermite(h,b,!0,f.region.x,d-(f.region.y+f.region.height),f.region.width,f.region.height)};d.prototype._readbackScreenshotImmediate=function(b){var c=b.framebufferHeight,
d=b.region,e=this._ensureScreenshotEncodeCanvas(),f=a.createEmptyImageData(d.width,d.height,e);this._rctx.gl.readPixels(d.x,c-(d.y+d.height),d.width,d.height,6408,5121,new Uint8Array(f.data.buffer));this._renderScreenshotOverlay(e,f,b);return f};d.prototype._renderScreenshot=function(a,b){var d=null,e=a.viewCamera,f=b.framebufferWidth,g=b.framebufferHeight,k=!1;a=a.frameHasSlicePlane&&b.disableSlice;var l=b.ignorePadding&&e.pixelRatio!==b.pixelRatio;if(a=f!==e.fullWidth||g!==e.fullHeight||a||l){l=
e.clone();if(b.ignorePadding){for(var d=h.vec4f64.clone(l.padding),m=0;4>m;m++)d[m]=Math.round(d[m]/l.pixelRatio*b.pixelRatio);l.padding=d}l.fullWidth=f;l.fullHeight=g;l.pixelRatio=b.pixelRatio;d=e.fovX-l.fovX;f=e.fovY-l.fovY;0>d&&d<f?l.fovX=e.fovX:0>f&&f<d&&(l.fovY=e.fovY);this.forceCameraHook(l);k=!0;d=new c(this._rctx,{width:l.fullWidth,height:l.fullHeight,colorTarget:0,depthStencilTarget:3});this._renderScene(d,l,b.disableSlice)}b=this._readbackScreenshot(b);if(a&&!this._rctx.contextAttributes.alpha)for(m=
3;m<b.data.length;m+=4)b.data[m]=255;d&&d.dispose();this._rctx.bindFramebuffer(null);k&&this.forceCameraHook(e);return b};d.prototype._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return d=g([l.subclass("esri.views.3d.webgl-engine.parts.ScreenshotManager")],d)}(l.declared(d.AutoDisposable));b.ScreenshotManager=n})},"esri/views/support/WebGLRequirements":function(){define(["require",
"exports","../../core/tsSupport/assignHelper","../../core/Error","../../core/has"],function(n,b,m,k,g){Object.defineProperty(b,"__esModule",{value:!0});var e={supportsMajorWebPerformanceCaveat:!1};b.check=function(b){b=m({},e,b);return g("esri-webgl")?!b.supportsMajorWebPerformanceCaveat&&g("esri-webgl-major-performance-caveat")?new k("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is blacklisted."):
g("esri-webgl-high-precision-fragment")?g("esri-webgl-vertex-shader-samplers")?g("esri-webgl-element-index-uint")?g("esri-webgl-standard-derivatives")?g("esri-webgl-instanced-arrays")?null:new k("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new k("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new k("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):
new k("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new k("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new k("webgl:required","WebGL is required but not supported.")}})},"esri/views/ui/3d/DefaultUI3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI".split(" "),
function(n,b,m,k,g,e){return function(b){function e(e){e=b.call(this,e)||this;e.components=["attribution","zoom","navigation-toggle","compass"];return e}m(e,b);k([g.property()],e.prototype,"components",void 0);return e=k([g.subclass("esri.views.ui.3d.DefaultUI3D")],e)}(g.declared(e))})},"esri/views/ui/DefaultUI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){return function(b){function l(a){a=b.call(this,a)||this;a._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"};a.components=[];return a}m(l,b);l.prototype.initialize=function(){this._handles.add([g.init(this,"components",this._componentsWatcher.bind(this)),g.init(this,"view",this._updateViewAwareWidgets.bind(this))])};l.prototype._removeComponents=function(a){var b=this;a.forEach(function(a){if(a=
b._find(a))b.remove(a),a.destroy()})};l.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(c){(c=(c=b._find(c))&&c.widget)&&void 0!==c.view&&(c.view=a)})};l.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a);this._adjustPadding(a)};l.prototype._adjustPadding=function(a){-1!==a.indexOf("attribution")||this._isOverridden("padding")||(this.padding=this.padding.top)};l.prototype._addComponents=function(a){var b=this;this.initialized&&
a.forEach(function(a){return b.add(b._createComponent(a),b._defaultPositionLookup[a])})};l.prototype._createComponent=function(a){var b=this._createWidget(a);if(b)return new f({id:a,node:b})};l.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();if("compass"===a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};l.prototype._createAttribution=function(){return new h({view:this.view})};
l.prototype._createCompass=function(){return new d({view:this.view})};l.prototype._createNavigationToggle=function(){return new a({view:this.view})};l.prototype._createZoom=function(){return new c({view:this.view})};k([e.property()],l.prototype,"components",void 0);return l=k([e.subclass("esri.views.ui.DefaultUI")],l)}(e.declared(l))})},"esri/views/ui/Component":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators".split(" "),
function(n,b,m,k,g,e,f){return function(b){function g(){var d=null!==b&&b.apply(this,arguments)||this;d.widget=null;return d}m(g,b);g.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null};Object.defineProperty(g.prototype,"id",{get:function(){return this.get("widget.id")||this.get("node.id")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"node",{set:function(b){var a=this._get("node");b!==a&&(b&&b.classList.add("esri-component"),a&&a.classList.remove("esri-component"),
this._set("node",b))},enumerable:!0,configurable:!0});g.prototype.castNode=function(b){if(!b)return this._set("widget",null),null;if("string"===typeof b||b&&"nodeType"in b)return this._set("widget",null),e.byId(b);b&&"function"===typeof b.render&&!b.domNode&&(b.domNode=document.createElement("div"));this._set("widget",b);return b.domNode};k([f.property()],g.prototype,"id",null);k([f.property()],g.prototype,"node",null);k([f.cast("node")],g.prototype,"castNode",null);k([f.property({readOnly:!0})],
g.prototype,"widget",void 0);return g=k([f.subclass("esri.views.ui.Component")],g)}(f.declared(g))})},"esri/views/ui/UI":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ../../widgets/support/widgetUtils".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c){function q(b){return"object"!==
typeof b||b instanceof a||"declaredClass"in b||!("component"in b||"index"in b||"position"in b)?null:b}function p(a,b){var c=b.bottom,d=b.left,e=b.right;a.style.top=b.top;a.style.bottom=c;a.style.left=d;a.style.right=e}var t={left:0,top:0,bottom:0,right:0},u={bottom:30,top:15,right:15,left:15};return function(b){function f(a){a=b.call(this,a)||this;a._cornerNameToContainerLookup={};a._positionNameToContainerLookup={};a._components=[];a._componentToKey=new Map;a._handles=new l;a.view=null;a._initContainers();
return a}k(f,b);f.prototype.initialize=function(){this._handles.add([h.init(this,"view.padding, container",this._applyViewPadding.bind(this)),h.init(this,"padding",this._applyUIPadding.bind(this))])};f.prototype.destroy=function(){this.container=null;for(var a=0,b=this._components;a<b.length;a++)b[a].destroy();this._components.length=0;this._handles.destroy();this._componentToKey.clear()};Object.defineProperty(f.prototype,"container",{set:function(a){var b=this._get("container");a!==b&&(a&&(a.classList.add("esri-ui"),
this._attachContainers(a)),b&&(b.classList.remove("esri-ui"),p(b,{top:"",bottom:"",left:"",right:""}),e.empty(b)),this._set("container",a))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"padding",{get:function(){return this._get("padding")},set:function(a){a?this._override("padding",
a):this._clearOverride("padding")},enumerable:!0,configurable:!0});f.prototype.castPadding=function(a){return"number"===typeof a?{bottom:a,top:a,right:a,left:a}:m({},u,a)};Object.defineProperty(f.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.left+b.right),0)},enumerable:!0,configurable:!0});f.prototype.add=function(b,c){var d=this,e,f;if(Array.isArray(b))b.forEach(function(a){return d.add(a,c)});else{var g=q(b);
g&&(e=g.index,c=g.position,b=g.component,f=g.key);c&&"object"===typeof c&&(e=c.index,f=c.key,c=c.position);!b||c&&!this._isValidPosition(c)||(b instanceof a||(b=new a({node:b})),this._place({component:b,position:c,index:e}),this._components.push(b),f&&this._componentToKey.set(b,f))}};f.prototype.remove=function(a,b){var c=this;if(a){if(Array.isArray(a))return a.map(function(a){return c.remove(a,b)});var d=this._find(a);if(d){var e=this._componentToKey;if(!e.has(a)||e.get(a)===b)return e=this._components.indexOf(d),
d.node.parentNode&&d.node.parentNode.removeChild(d.node),this._componentToKey.delete(a),this._components.splice(e,1)[0]}}};f.prototype.empty=function(a){var b=this;if(Array.isArray(a))return a.map(function(a){return b.empty(a)}).reduce(function(a,b){return a.concat(b)});a=a||"manual";return"manual"===a?Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!a.classList.contains("esri-ui-corner")}).map(function(a){return b.remove(a)}):this._isValidPosition(a)?Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,
this):null};f.prototype.move=function(a,b){var c=this;Array.isArray(a)&&a.forEach(function(a){return c.move(a,b)});if(a){var d,e=q(a)||q(b);e&&(d=e.index,b=e.position,a=e.component||a);(!b||this._isValidPosition(b))&&(a=this.remove(a))&&this.add(a,{position:b,index:d})}};f.prototype.find=function(a){return a?(a=this._findById(a))&&(a.widget||a.node):null};f.prototype._find=function(b){return b?b instanceof a?this._findByComponent(b):"string"===typeof b?this._findById(b):this._findByNode(b.domNode||
b):null};f.prototype._getViewPadding=function(){return this.get("view.padding")||t};f.prototype._attachContainers=function(a){a.appendChild(this._innerContainer);a.appendChild(this._manualContainer)};f.prototype._initContainers=function(){var a=document.createElement("div");a.classList.add("esri-ui-inner-container");a.classList.add("esri-ui-corner-container");var b=document.createElement("div");b.classList.add("esri-ui-inner-container");b.classList.add("esri-ui-manual-container");var d=document.createElement("div");
d.classList.add("esri-ui-top-left");d.classList.add("esri-ui-corner");a.appendChild(d);var e=document.createElement("div");e.classList.add("esri-ui-top-right");e.classList.add("esri-ui-corner");a.appendChild(e);var f=document.createElement("div");f.classList.add("esri-ui-bottom-left");f.classList.add("esri-ui-corner");a.appendChild(f);var g=document.createElement("div");g.classList.add("esri-ui-bottom-right");g.classList.add("esri-ui-corner");a.appendChild(g);this._innerContainer=a;this._manualContainer=
b;a=c.isRTL();this._cornerNameToContainerLookup={"top-left":d,"top-right":e,"bottom-left":f,"bottom-right":g,"top-leading":a?e:d,"top-trailing":a?d:e,"bottom-leading":a?g:f,"bottom-trailing":a?f:g};this._positionNameToContainerLookup=m({manual:b},this._cornerNameToContainerLookup)};f.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};f.prototype._place=function(a){var b=a.component,c=a.index;a=this._positionNameToContainerLookup[a.position||"manual"];var d=-1<c,
f=b.widget;f&&!f._started&&"function"===typeof f.postMixInProperties&&"function"===typeof f.buildRendering&&"function"===typeof f.postCreate&&"function"===typeof f.startup&&b.widget.startup();d?(d=Array.prototype.slice.call(a.children),0===c?a.firstChild?e.insertBefore(b.node,a.firstChild):a.appendChild(b.node):c>=d.length?a.appendChild(b.node):e.insertBefore(b.node,d[c])):a.appendChild(b.node)};f.prototype._applyViewPadding=function(){var a=this.container;a&&p(a,this._toPxPosition(this._getViewPadding()))};
f.prototype._applyUIPadding=function(){var a=this._innerContainer;a&&p(a,this._toPxPosition(this.padding))};f.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};f.prototype._toPxUnit=function(a){return 0===a?"0":a+"px"};f.prototype._findByComponent=function(a){var b=null,c;this._components.some(function(d){(c=d===a)&&(b=d);return c});return b};f.prototype._findById=function(a){var b=null,
c;this._components.some(function(d){(c=d.id===a)&&(b=d);return c});return b};f.prototype._findByNode=function(a){var b=null,c;this._components.some(function(d){(c=d.node===a)&&(b=d);return c});return b};g([d.property()],f.prototype,"container",null);g([d.property({dependsOn:["view.height"]})],f.prototype,"height",null);g([d.property({value:u})],f.prototype,"padding",null);g([d.cast("padding")],f.prototype,"castPadding",null);g([d.property()],f.prototype,"view",void 0);g([d.property({dependsOn:["view.width"]})],
f.prototype,"width",null);return f=g([d.subclass("esri.views.ui.UI")],f)}(d.declared(f.EventedAccessor))})},"esri/widgets/Attribution":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Attribution/nls/Attribution ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attribution/AttributionViewModel ./support/widget".split(" "),function(n,b,m,k,g,e,f,l,h,d){return function(a){function b(b){b=a.call(this,b)||this;b._isOpen=
!1;b._attributionTextOverflowed=!1;b._prevSourceNodeHeight=0;b.iconClass="esri-icon-description";b.itemDelimiter=" | ";b.label=g.widgetLabel;b.view=null;b.viewModel=new h;return b}m(b,a);b.prototype.postInitialize=function(){var a=this;this.own(e.on(this,"viewModel.items","change",function(){return a.scheduleRender()}))};Object.defineProperty(b.prototype,"attributionText",{get:function(){return this.viewModel.items.reduce(function(a,b){-1===a.indexOf(b.text)&&a.push(b.text);return a},[]).join(this.itemDelimiter)},
enumerable:!0,configurable:!0});b.prototype.render=function(){var a,b=(a={},a["esri-attribution--open"]=this._isOpen,a);return d.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",b),onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),d.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",d.tsx("a",{class:this.classes("esri-attribution__link","esri-widget__anchor"),href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri")))};
b.prototype._renderSourcesNode=function(){var a,b=this._isOpen,c=this._isInteractive(),e=c?0:-1,f=this.attributionText,g=c?"button":void 0,b=(a={},a["esri-attribution__sources--open"]=b,a["esri-interactive"]=c,a);return d.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",b),innerHTML:f,role:g,tabIndex:e})};b.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=a.clientWidth};b.prototype._afterSourcesNodeUpdate=
function(a){var b=!1,c=a.clientHeight;a=a.scrollWidth>=a.clientWidth;var d=this._attributionTextOverflowed!==a;this._attributionTextOverflowed=a;d&&(b=!0);this._isOpen&&(a=c<this._prevSourceNodeHeight,this._prevSourceNodeHeight=c,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};b.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};b.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};k([f.property({dependsOn:["viewModel.items.length",
"itemDelimiter"],readOnly:!0}),d.renderable()],b.prototype,"attributionText",null);k([f.property()],b.prototype,"iconClass",void 0);k([f.property(),d.renderable()],b.prototype,"itemDelimiter",void 0);k([f.property()],b.prototype,"label",void 0);k([f.aliasOf("viewModel.view")],b.prototype,"view",void 0);k([f.property({type:h}),d.renderable(["state","view.size"])],b.prototype,"viewModel",void 0);k([d.accessibleHandler()],b.prototype,"_toggleState",null);return b=k([f.subclass("esri.widgets.Attribution")],
b)}(f.declared(l))})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/generatorHelper ../../geometry ../../core/arrayUtils ../../core/asyncUtils ../../core/Collection ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t){function u(a,b){return a.length!==b.length||a.some(function(a,c){return a.text!==b[c].text})}function r(a,b,c){c&&b&&(l.find(a,function(a){return a.layerView===b&&a.text===c})||a.push({text:c,layerView:b}))}var x=[];return function(a){function b(b){var e=a.call(this,b)||this;e.clear=function(){e._fetchedAttributionData.clear();e._pendingAttributions.clear();e.handles.remove("suspension");e.notifyChange("state")};e._pendingAttributions=new Set;e._fetchedAttributionData=
new Map;e.items=new d;e.view=null;e._allLayerViewsChange=function(a){e.handles.remove("suspension");var b=e.get("view.allLayerViews");b&&e.handles.add(b.map(function(a){return a.watch(["suspended","attributionVisible"],e._updateAttributionItems)}),"suspension");a&&a.removed&&a.removed.forEach(function(a){e._pendingAttributions.delete(a);e._fetchedAttributionData.delete(a)});e._updateAttributionItems()};e._updateAttributionItems=function(){var a=e.get("view.allLayerViews");x.length=0;a?(a.forEach(function(a){if(!a.suspended&&
a.get("layer.attributionVisible")){var b=a.layer;if(b&&"copyright"in b&&"function"===typeof b.originOf&&"user"===b.originOf("copyright"))r(x,a,b.copyright);else if(b.hasAttributionData)if(e._fetchedAttributionData.has(a)){var c=e._fetchedAttributionData.get(a);c&&r(x,a,e._getDynamicAttribution(c,e.view,b))}else e._fetchAttributionData(a);else(c=b.get("portalItem.accessInformation"))?r(x,a,c):r(x,a,b.copyright)}}),u(e.items,x)&&(e.items.removeAll(),e.items.addMany(x)),e.notifyChange("state")):e.clear()};
e.handles.add([c.on(e,"view.allLayerViews","change",e._allLayerViewsChange,e._allLayerViewsChange,e.clear),c.whenTrue(e,"view.stationary",function(){return e._updateAttributionItems()})]);return e}m(b,a);b.prototype.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear()};Object.defineProperty(b.prototype,"state",{get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":"disabled"},enumerable:!0,configurable:!0});
b.prototype._fetchAttributionData=function(a){return g(this,void 0,void 0,function(){var b,c;return e(this,function(d){switch(d.label){case 0:if(this._pendingAttributions.has(a))return[2];this._pendingAttributions.add(a);return[4,h.result(a.layer.fetchAttributionData())];case 1:return b=d.sent(),this._pendingAttributions.has(a)&&(c=b.ok?this._createContributionIndex(b.value,"bing-maps"===a.layer.type):null,this._pendingAttributions.delete(a),this._fetchedAttributionData.set(a,c)),this._updateAttributionItems(),
[2]}})})};b.prototype._createContributionIndex=function(a,b){a=a.contributors;var c={};if(!a)return c;for(var d=0;d<a.length;d++){var e=a[d],g=e.coverageAreas;if(!g)return;for(var h=0;h<g.length;h++)for(var k=g[h],l=k.bbox,m=k.zoomMin-(b&&k.zoomMin?1:0),n=k.zoomMax-(b&&k.zoomMax?1:0),k={extent:t.geographicToWebMercator({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:f.SpatialReference.WGS84}),attribution:e.attribution||"",score:null!=k.score?k.score:100,id:d};m<=n;m++)c[m]=c[m]||[],c[m].push(k)}c.maxKey=
Math.max.apply(null,Object.keys(c));return c};b.prototype._getDynamicAttribution=function(a,b,c){var d=b.extent;c=c.tileInfo.scaleToZoom(b.scale);c=Math.min(a.maxKey,Math.round(c));if(!d||null==c||-1>=c)return"";a=a[c];var e=t.project(d.center.clone().normalize(),b.spatialReference),f={};return a?a.filter(function(a){var b=!f[a.id]&&e&&p.extentContainsPoint(a.extent,e);b&&(f[a.id]=!0);return b}).sort(function(a,b){return b.score-a.score||a.objectId-b.objectId}).map(function(a){return a.attribution}).join(", "):
""};k([q.property({readOnly:!0,type:d})],b.prototype,"items",void 0);k([q.property({dependsOn:["view.ready"],readOnly:!0})],b.prototype,"state",null);k([q.property()],b.prototype,"view",void 0);return b=k([q.subclass("esri.widgets.Attribution.AttributionViewModel")],b)}(q.declared(a.HandleOwner))})},"esri/widgets/Compass":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Compass/nls/Compass ../core/accessorSupport/decorators ./Widget ./Compass/CompassViewModel ./support/widget".split(" "),
function(n,b,m,k,g,e,f,l,h){return function(b){function a(a){a=b.call(this,a)||this;a.goToOverride=null;a.iconClass="esri-icon-locate-circled";a.label=g.widgetLabel;a.view=null;a.viewModel=new l;return a}m(a,b);a.prototype.reset=function(){};a.prototype.render=function(){var a,b,d=this.viewModel,e=d.orientation,d=d.state,f="disabled"===d,k="compass"===("rotation"===d?"rotation":"compass"),d=f?-1:0,f=(a={},a["esri-disabled"]=f,a["esri-interactive"]=!f,a);a=(b={},b["esri-icon-compass"]=k,b["esri-icon-dial"]=
!k,b);return h.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",f),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:d,"aria-label":g.reset,title:g.reset},h.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",a),styles:this._toRotationTransform(e)}),h.tsx("span",{class:"esri-icon-font-fallback-text"},g.reset))};a.prototype._reset=function(){this.viewModel.reset()};a.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+
a.z+"deg)"}};k([e.aliasOf("viewModel.goToOverride")],a.prototype,"goToOverride",void 0);k([e.property()],a.prototype,"iconClass",void 0);k([e.property()],a.prototype,"label",void 0);k([e.aliasOf("viewModel.view")],a.prototype,"view",void 0);k([e.property({type:l}),h.renderable(["viewModel.orientation","viewModel.state"])],a.prototype,"viewModel",void 0);k([e.aliasOf("viewModel.reset")],a.prototype,"reset",null);k([h.accessibleHandler()],a.prototype,"_reset",null);return a=k([e.subclass("esri.widgets.Compass")],
a)}(e.declared(f))})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../support/GoTo".split(" "),function(n,b,m,k,g,e,f,l,h){return function(b){function a(a){a=b.call(this,a)||this;a._handles=new e;a.orientation={x:0,y:0,z:0};a.view=null;a._updateForCamera=a._updateForCamera.bind(a);a._updateForRotation=
a._updateForRotation.bind(a);a._updateRotationWatcher=a._updateRotationWatcher.bind(a);a.view;return a}m(a,b);a.prototype.initialize=function(){this._handles.add(f.init(this,"view",this._updateRotationWatcher))};a.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(a.prototype,"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return!(!a||!a.isWebMercator&&!a.isGeographic)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"state",{get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!0,configurable:!0});a.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.callGoTo({target:a})}};a.prototype._updateForRotation=function(a){void 0!==a&&null!==a&&(this.orientation={z:a})};a.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};a.prototype._updateRotationWatcher=function(a){this._handles.removeAll();
a&&("2d"===a.type?this._handles.add(f.init(this,"view.rotation",this._updateForRotation)):this._handles.add(f.init(this,"view.camera",this._updateForCamera)))};k([l.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],a.prototype,"canShowNorth",null);k([l.property()],a.prototype,"orientation",void 0);k([l.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],a.prototype,"state",null);k([l.property()],a.prototype,"view",void 0);k([l.property()],
a.prototype,"reset",null);return a=k([l.subclass("esri.widgets.CompassViewModel")],a)}(l.declared(h.GoToMixin(g)))})},"esri/widgets/NavigationToggle":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./NavigationToggle/nls/NavigationToggle ../core/accessorSupport/decorators ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/widget".split(" "),function(n,b,m,k,g,e,f,l,h){return function(b){function a(a){a=b.call(this,a)||
this;a.iconClass="esri-icon-pan2";a.label=g.widgetLabel;a.view=null;a.viewModel=new l;return a}m(a,b);Object.defineProperty(a.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});a.prototype.toggle=function(){};a.prototype.render=function(){var a,b,d,e="disabled"===this.get("viewModel.state"),f="pan"===this.get("viewModel.navigationMode"),k=(a={},a["esri-disabled"]=e,a["esri-navigation-toggle--horizontal"]="horizontal"===this.layout,
a);a=(b={},b["esri-navigation-toggle__button--active"]=f,b);b=(d={},d["esri-navigation-toggle__button--active"]=!f,d);d=e?-1:0;return h.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",k),onclick:this._toggle,onkeydown:this._toggle,tabIndex:d,"aria-label":g.toggle,title:g.toggle},h.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",a)},h.tsx("span",{class:"esri-icon-pan"})),h.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button",
"esri-navigation-toggle__button--rotate",b)},h.tsx("span",{class:"esri-icon-rotate"})))};a.prototype._toggle=function(){this.toggle()};k([e.property()],a.prototype,"iconClass",void 0);k([e.property()],a.prototype,"label",void 0);k([e.property({value:"vertical"}),h.renderable()],a.prototype,"layout",null);k([e.aliasOf("viewModel.view"),h.renderable()],a.prototype,"view",void 0);k([e.property({type:l}),h.renderable(["viewModel.state","viewModel.navigationMode"])],a.prototype,"viewModel",void 0);k([e.aliasOf("viewModel.toggle")],
a.prototype,"toggle",null);k([h.accessibleHandler()],a.prototype,"_toggle",null);return a=k([e.subclass("esri.widgets.NavigationToggle")],a)}(e.declared(f))})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),function(n,b,m,k,g,e,f,l){return function(b){function d(a){a=
b.call(this,a)||this;a._handles=new e;a.navigationMode="pan";a.view=null;a.toggle=a.toggle.bind(a);return a}m(d,b);d.prototype.initialize=function(){this._handles.add(f.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};d.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(d.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"},enumerable:!0,configurable:!0});d.prototype.toggle=
function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};d.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};k([l.property({dependsOn:["view.ready"],readOnly:!0})],d.prototype,"state",null);k([l.property()],d.prototype,"navigationMode",void 0);k([l.property()],d.prototype,"view",void 0);k([l.property()],d.prototype,"toggle",null);return d=k([l.subclass("esri.widgets.NavigationToggleViewModel")],
d)}(l.declared(g))})},"esri/widgets/Zoom":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Zoom/nls/Zoom ../core/accessorSupport/decorators ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel ./support/widget".split(" "),function(n,b,m,k,g,e,f,l,h,d){return function(a){function b(b){b=a.call(this,b)||this;b.iconClass="esri-icon-zoom-in-magnifying-glass";b.label=g.widgetLabel;b.view=null;b.viewModel=new h;return b}m(b,a);b.prototype.postInitialize=
function(){this._zoomInButton=new l({action:this.zoomIn,iconClass:"esri-icon-plus",title:g.zoomIn});this._zoomOutButton=new l({action:this.zoomOut,iconClass:"esri-icon-minus",title:g.zoomOut})};Object.defineProperty(b.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});b.prototype.render=function(){var a,b=this.viewModel,c=(a={},a["esri-zoom--horizontal"]="horizontal"===this.layout,a);this._zoomInButton.enabled="ready"===b.state&&
b.canZoomIn;this._zoomOutButton.enabled="ready"===b.state&&b.canZoomOut;return d.tsx("div",{class:this.classes("esri-zoom esri-widget",c)},this._zoomInButton.render(),this._zoomOutButton.render())};b.prototype.zoomIn=function(){};b.prototype.zoomOut=function(){};k([e.property()],b.prototype,"iconClass",void 0);k([e.property()],b.prototype,"label",void 0);k([e.property({value:"vertical"}),d.renderable()],b.prototype,"layout",null);k([e.aliasOf("viewModel.view"),d.renderable()],b.prototype,"view",void 0);
k([e.property({type:h}),d.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],b.prototype,"viewModel",void 0);k([e.aliasOf("viewModel.zoomIn")],b.prototype,"zoomIn",null);k([e.aliasOf("viewModel.zoomOut")],b.prototype,"zoomOut",null);return b=k([e.subclass("esri.widgets.Zoom")],b)}(e.declared(f))})},"esri/widgets/Zoom/IconButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../Widget ../support/widget".split(" "),
function(n,b,m,k,g,e,f){return function(b){function e(){var d=null!==b&&b.apply(this,arguments)||this;d.enabled=!0;d.iconClass="";d.title="";return d}m(e,b);e.prototype.render=function(){var b,a,c=this.enabled?0:-1,e=(b={},b["esri-disabled"]=!this.enabled,b["esri-interactive"]=this.enabled,b);b=(a={},a[this.iconClass]=!!this.iconClass,a);return f.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",e),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:c,
title:this.title},f.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",b)}),f.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};e.prototype._triggerAction=function(){this.action.call(this)};k([g.property()],e.prototype,"action",void 0);k([g.property(),f.renderable()],e.prototype,"enabled",void 0);k([g.property(),f.renderable()],e.prototype,"iconClass",void 0);k([g.property(),f.renderable()],e.prototype,"title",void 0);k([f.accessibleHandler()],e.prototype,
"_triggerAction",null);return e=k([g.subclass("esri.widgets.IconButton")],e)}(g.declared(e))})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(n,b,m,k,g,e,f,l,h){return function(b){function a(a){a=b.call(this,a)||this;a.canZoomIn=!1;a.canZoomOut=!1;a.zoomIn=a.zoomIn.bind(a);
a.zoomOut=a.zoomOut.bind(a);return a}m(a,b);a.prototype.destroy=function(){this.view=null};Object.defineProperty(a.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new l({view:a}):"3d"===a.type&&(this._zoomConditions=new h({view:a})):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0});a.prototype.zoomIn=function(){if(this.canZoomIn){var a=
this.view;"2d"===a.type?a.mapViewNavigation.zoomIn():e.ignoreAbortErrors(a.goTo({zoomFactor:2}))}};a.prototype.zoomOut=function(){if(this.canZoomOut){var a=this.view;"2d"===a.type?a.mapViewNavigation.zoomOut():e.ignoreAbortErrors(a.goTo({zoomFactor:.5}))}};k([f.property()],a.prototype,"_zoomConditions",void 0);k([f.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],a.prototype,"canZoomIn",void 0);k([f.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],a.prototype,"canZoomOut",
void 0);k([f.property({dependsOn:["view.ready"],readOnly:!0})],a.prototype,"state",null);k([f.property()],a.prototype,"view",null);k([f.property()],a.prototype,"zoomIn",null);k([f.property()],a.prototype,"zoomOut",null);return a=k([f.subclass("esri.widgets.Zoom.ZoomViewModel")],a)}(f.declared(g))})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(n,b,m,k,g,e){return function(b){function f(){return null!==b&&b.apply(this,arguments)||this}m(f,b);Object.defineProperty(f.prototype,"canZoomIn",{get:function(){if(!this.get("view.ready"))return!1;var b=this.get("view.animation.target.scale")||this.get("view.scale"),d=this.get("view.constraints.effectiveMaxScale");return 0===d||b>d},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"canZoomOut",{get:function(){if(!this.get("view.ready"))return!1;var b=this.get("view.animation.target.scale")||
this.get("view.scale"),d=this.get("view.constraints.effectiveMinScale");return 0===d||b<d},enumerable:!0,configurable:!0});k([e.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMaxScale"],readOnly:!0})],f.prototype,"canZoomIn",null);k([e.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMinScale"],readOnly:!0})],f.prototype,"canZoomOut",null);k([e.property()],f.prototype,"view",void 0);return f=
k([e.subclass("esri.widgets.Zoom.ZoomConditions2D")],f)}(e.declared(g))})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(n,b,m,k,g,e){return function(b){function f(){return null!==b&&b.apply(this,arguments)||this}m(f,b);Object.defineProperty(f.prototype,"canZoomIn",{get:function(){return!!this.get("view.ready")},enumerable:!0,
configurable:!0});Object.defineProperty(f.prototype,"canZoomOut",{get:function(){return!!this.get("view.ready")},enumerable:!0,configurable:!0});k([e.property({dependsOn:["view.ready"],readOnly:!0})],f.prototype,"canZoomIn",null);k([e.property({dependsOn:["view.ready"],readOnly:!0})],f.prototype,"canZoomOut",null);k([e.property()],f.prototype,"view",void 0);return f=k([e.subclass("esri.widgets.Zoom.ZoomConditions3D")],f)}(e.declared(g))})},"jimu/DataManager":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/topic","./WidgetManager"],function(n,b,m,k){var g=null,e;e=n(null,{constructor:function(){m.subscribe("publishData",b.hitch(this,this.onDataPublished));m.subscribe("fetchData",b.hitch(this,this.onFetchData));m.subscribe("clearAllData",b.hitch(this,this.onClearAllData));m.subscribe("removeData",b.hitch(this,this.onRemoveData));m.subscribe("clearDataHistory",b.hitch(this,this.onClearDataHistory));this.widgetManager=k.getInstance()},_dataStore:{},onDataPublished:function(b,e,
g,d){"undefined"===typeof d&&(d=!1);this._dataStore[e]?(this._dataStore[e].current=g,d&&(this._dataStore[e].history?this._dataStore[e].history.push(g):this._dataStore[e].history=[g])):(this._dataStore[e]={current:g},d&&(this._dataStore[e].history=[g]))},onFetchData:function(b){var e;if(b)"framework"===b?this._dataStore[b]?m.publish("dataFetched","framework","framework",this._dataStore[b].current,this._dataStore[b].history):m.publish("noData","framework","framework"):(e=this.widgetManager.getWidgetById(b))?
this._dataStore[b]?m.publish("dataFetched",e.name,b,this._dataStore[b].current,this._dataStore[b].history):m.publish("noData",e.name,b):m.publish("noData",void 0,b);else for(var f in this._dataStore)(e=this.widgetManager.getWidgetById(f))&&m.publish("dataFetched",e.name,f,this._dataStore[f].current,this._dataStore[f].history)},onClearAllData:function(){this._dataStore={};m.publish("allDataCleared")},onRemoveData:function(b){delete this._dataStore[b];m.publish("dataRemoved",b)},onClearDataHistory:function(b){this._dataStore[b]&&
(this._dataStore[b].history=[]);m.publish("dataHistoryCleared",b)}});e.getInstance=function(){null===g&&(g=new e);return g};return e})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(n,b,m,k,g,e,f,l,h){return n([e,f],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,sceneView:null,appConfig:null,
folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(g.subscribe("publishData",b.hitch(this,this._onReceiveData)));this.own(g.subscribe("dataFetched",b.hitch(this,this._onReceiveData)));this.own(g.subscribe("noData",b.hitch(this,this._onNoData)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},
onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(b){},onSignOut:function(){},onPositionChange:function(b){this.setPosition(b)},setPosition:function(b,a){this.position=b;var c=l.getPositionStyle(this.position);c.position="absolute";a||(a="map"===b.relativeTo?this.sceneView.map.id:window.jimuConfig.layoutId);k.place(this.domNode,a);k.setStyle(this.domNode,c);this.started&&this.resize()},getPosition:function(){return this.position},
getMarginBox:function(){return k.getMarginBox(this.domNode)},setState:function(b){this.state=b},setWindowState:function(b){this.windowState=b},resize:function(){},onConfigChanged:function(b){},onAppConfigChanged:function(b,a,c){},onAction:function(b,a){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return h.getInstance().getPanelById(this.id+"_panel");var b=h.getInstance().getPanelById(this.gid+"_panel");return b?b:h.getInstance().getPanelById(this.id+
"_panel")},publishData:function(b,a){"undefined"===typeof a&&(a=!1);g.publish("publishData",this.name,this.id,b,a)},fetchData:function(b){b?g.publish("fetchData",b):0!==this.listenWidgetIds.length?m.forEach(this.listenWidgetIds,function(a){g.publish("fetchData",a)},this):g.publish("fetchData")},fetchDataByName:function(b){b=this.widgetManager.getWidgetsByName(b);m.forEach(b,function(a){this.fetchData(a.id)},this)},openWidgetById:function(b){return this.widgetManager.triggerWidgetOpen(b)},_onReceiveData:function(b,
a,c,e){if(a!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(a)))this.onReceiveData(b,a,c,e)},onReceiveData:function(b,a,c,e){},_onNoData:function(b,a){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(a)))this.onNoData(b,a)},onNoData:function(b,a){}})})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){var p,t=null;p=n(null,{constructor:function(){this.panels=[];this.widgetManager=q.getInstance();l(window,"resize",b.hitch(this,this.onWindowResize));this.activePanel=null;h.subscribe("/dnd/move/start",b.hitch(this,this._onMoveStart));h.subscribe("widgetActived",b.hitch(this,this._onWidgetActived))},showPanel:function(a){var d=new e,g=this.getPanelById(a.id+"_panel");g?("closed"===g.state&&this.openPanel(g),d.resolve(g)):f({Panel:this._loadPanelClass(a.panel.uri),
nls:this._loadThemeI18N(a.panel.uri)}).then(b.hitch(this,function(e){var f=a.id+"_panel",g=this.getPanelById(f),h={label:a.label,config:a,uri:a.panel.uri,position:a.panel.position,sceneView:this.sceneView,widgetManager:this.widgetManager,panelManager:this,id:f,gid:a.gid,nls:e.nls};b.mixin(h,a.panel.options);try{g=new e.Panel(h),console.log("panel ["+f+"] created.")}catch(A){console.log("create panel error: "+A+", panelId: "+f);d.reject(A);return}g.setPosition(a.panel.position);c.setVerticalCenter(g.domNode);
this.openPanel(g);this.panels.push(g);l(g.domNode,"click",b.hitch(this,this._onPanelClick,g));d.resolve(g)}));return d},setSceneView:function(a){this.sceneView=a;l(this.sceneView,"resize",b.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===
a&&this.closePanel(this.panels[b])},openPanel:function(a){var c=new e;if("string"===typeof a&&(a=this.getPanelById(a),!a))return c.reject(),c;if(!a.started)try{a.started=!0,a.startup()}catch(x){console.error("fail to startup panel "+a.id+". "+x.stack)}if("opened"===a.state)return c.resolve(a),c;a.setState("opened");return this.playOpenPanelAnimation(a).then(b.hitch(this,function(){k.setStyle(a.domNode,"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var b=new e;return"string"===
typeof a&&(a=this.getPanelById(a),!a)||"closed"===a.state?(b.resolve(),b):this.playClosePanelAnimation(a).then(function(){this.activePanel&&this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&k.setStyle(a.domNode,"display","none")})},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(r){console.log(console.error("fail to minimize panel "+
a.id+". "+r.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(r){console.log(console.error("fail to maximize panel "+a.id+". "+r.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(r){console.log(console.error("fail to noralize panel "+
a.id+". "+r.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&
this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(r){console.log(console.error("fail to destroy panel "+a.id+". "+r.stack))}}},destroyAllPanels:function(){var a=m.map(this.panels,function(a){return a.id});
m.forEach(a,function(a){this.destroyPanel(a)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return d();var b=new e;"string"===typeof a.openAnimation?"fadeIn"===a.openAnimation?(k.setStyle(a.domNode,{opacity:0,display:""}),g.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play()):b.resolve():b.resolve();return b},playClosePanelAnimation:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return d();var b=new e;"string"===typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?g.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play():b.resolve());return b},getPositionOnMobile:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return{};var b=k.getMarginBox(window.jimuConfig.layoutId),c=b.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?
{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:b.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?b.h>b.w?{left:0,right:0,top:"auto",bottom:0,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:"auto",bottom:0,width:b.w/
2,height:a.titleHeight,contentHeight:b.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}:b.h>b.w?{left:0,right:0,top:c,bottom:0,width:"auto",height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:
{left:b.w-b.w/2,right:0,top:0,bottom:0,width:b.w/2,height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&
k.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),k.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var b=this.widgetManager.activeWidget;b&&"active"===b.state&&b.getPanel()!==a&&(b.setState("opened"),!1===b.inPanel&&k.setStyle(b.domNode,"zIndex","undefined"!==typeof b.position.zIndex?b.position.zIndex:
"auto"),b.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&k.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var b=this.panels.indexOf(a);-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=null)},_onMoveStart:function(a){m.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},
this)},_onWidgetActived:function(a){this.activePanel&&"active"===this.activePanel.state&&a.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),k.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(b){var c=new e;a([b],function(a){c.resolve(a)});return c},_loadThemeI18N:function(b){var c=new e;b.startWith("themes")?(b=b.split("/"),
a(["dojo/i18n!"+(b[0]+"/"+b[1]+"/nls/strings")],function(a){c.resolve(a)})):c.resolve({});return c}});p.getInstance=function(){null===t&&(t=new p,window._panelManager=t);return t};return p})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(n,b,m,k){return n([k],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);
this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&"closed"!==this.widget.state&&b.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(b){this.loading=b;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(b){this.widget=b;this.loading&&this.loading.destroy();m.place(b.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&
this.widget.domNode)try{this.widget.destroy()}catch(g){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+g.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),function(n,b,m,k,g,e,f,l,h){return n([g,e],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",
windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var d=this.getAllWidgetConfigs(),d=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];m.forEach(d,function(a){var c,d;!1!==a.visible&&(d=new f,c=this.createFrame(a),this.addChild(c),c.setLoading(d),this.widgetManager.loadWidget(a).then(b.hitch(this,function(a){c.setWidget(a);
a.startup()})))},this)},getAllWidgetConfigs:function(){var b=[];return b=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(b){for(var a=this.getChildren(),c=0;c<a.length;c++)if(a[c].getWidget()&&a[c].getWidget().id===b)return a[c].getWidget()},createFrame:function(b){return new l},setPosition:function(b,a){this.position=b;var c=h.getPositionStyle(this.position);c.position="absolute";a||(a="map"===b.relativeTo?this.sceneView.map.id:window.jimuConfig.layoutId);
this.started?this.resize():this.openAnimation&&(c.display="none");k.place(this.domNode,a);k.setStyle(this.domNode,c)},getPosition:function(){return this.position},setState:function(b){this.state=b},setWindowState:function(b){this.windowState=b},resize:function(){this.getChildren().forEach(function(b){b.resize()})},onPositionChange:function(b){this.setPosition(b)},onOpen:function(){m.forEach(this.getChildren(),function(b){b.getWidget()&&this.widgetManager.openWidget(b.getWidget())},this)},onClose:function(){m.forEach(this.getChildren(),
function(b){b.getWidget()&&this.widgetManager.closeWidget(b.getWidget())},this)},onMaximize:function(){m.forEach(this.getChildren(),function(b){b.getWidget()&&this.widgetManager.maximizeWidget(b.getWidget())},this)},onMinimize:function(){m.forEach(this.getChildren(),function(b){b.getWidget()&&this.widgetManager.minimizeWidget(b.getWidget())},this)},onNormalize:function(){m.forEach(this.getChildren(),function(b){b.getWidget()&&this.widgetManager.normalizeWidget(b.getWidget())},this)},onActive:function(){},
onDeActive:function(){},updateConfig:function(b){this._updateConfig(b)},reloadWidget:function(d){this.isWidgetInPanel(d)&&(this._updateConfig(d),this.getChildren().forEach(function(a){a.getWidget()&&a.getWidget().id===d.id&&(a.getWidget().destroy(),a.setLoading(new f),this.widgetManager.loadWidget(d).then(b.hitch(this,function(b){a.setWidget(b);b.startup();"closed"===this.state&&this.widgetManager.closeWidget(b)})))},this))},isWidgetInPanel:function(b){return m.some(this.getAllWidgetConfigs(),function(a){if(b.id===
a.id)return!0})?!0:!1},_updateConfig:function(b){if(Array.isArray(this.config.widgets)){for(var a=-1,c=0;c<this.config.widgets.length;c++)this.config.widgets[c].id===b.id&&(a=c);0<a&&(this.config.widgets[a]=b)}else this.config=b},destroy:function(){this.getChildren().forEach(function(b){try{b.domNode&&b.destroy()}catch(a){console.error("destroy widget frame error."+a.stack)}});this.inherited(arguments)}})})},"dijit/_Container":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct",
"dojo/_base/kernel"],function(n,b,m,k){return b("dijit._Container",null,{buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode)},addChild:function(b,e){var f=this.containerNode;if(0<e){for(f=f.firstChild;0<e;)1==f.nodeType&&e--,f=f.nextSibling;f?e="before":(f=this.containerNode,e="last")}m.place(b.domNode,f,e);this._started&&!b._started&&b.startup()},removeChild:function(b){"number"==typeof b&&(b=this.getChildren()[b]);b&&(b=b.domNode)&&b.parentNode&&
b.parentNode.removeChild(b)},hasChildren:function(){return 0<this.getChildren().length},_getSiblingOfChild:function(b,e){var f=this.getChildren();b=n.indexOf(f,b);return f[b+e]},getIndexOfChild:function(b){return n.indexOf(this.getChildren(),b)}})})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(n,b,m,k){return n(b,{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);
(this.hidden=!0===this.hidden)&&m.set(this.domNode,{display:"none"});m.set(this.domNode,{width:"100%",height:"100%"});k.place(' \x3cdiv class\x3d"loading-container"\x3e\x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\x3c/div\x3e\x3c/div\x3e',this.domNode)},show:function(){this.domNode&&m.set(this.domNode,"display","block")},hide:function(){this.domNode&&m.set(this.domNode,"display","none")}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(n,b,m,k,g){return n([k,g],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(m(window,"resize",b.hitch(this,this._onWindowResize)))},getConfig:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(n,b,m){return n(null,{constructor:function(){this.panelManager=m.getInstance()},
postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(b){},getConfigById:function(b){for(var g=this.getAllConfigs(),e=0;e<g.length;e++)if(g[e].id===b)return g[e]},getAllConfigs:function(){var k=[],k=k.concat(this.getWidgetConfigs(),this.getGroupConfigs()),k=b.filter(k,function(b){return b.visible});return k.sort(function(b,e){return b.index-e.index})},getAllConfigsIncludeInvisible:function(){var b=
[],b=b.concat(this.getWidgetConfigs(),this.getGroupConfigs());return b.sort(function(b,e){return b.index-e.index})},isControlled:function(k){return b.some(this.getAllConfigsIncludeInvisible(),function(b){return b.id===k})},widgetIsControlled:function(k){return b.some(this.getAllConfigsIncludeInvisible(),function(g){return g.id===k?!0:b.some(g.widgets,function(b){return b.id===k})})},getGroupConfigs:function(){var k=[];if(!this.appConfig.widgetPool)return k;this.appConfig.widgetPool.groups&&b.forEach(this.appConfig.widgetPool.groups,
function(b){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(b.id)&&k.push(b):"all"===this.controlledGroups&&k.push(b))},this);return k},getWidgetConfigs:function(){var k=[];if(!this.appConfig.widgetPool)return k;this.appConfig.widgetPool.widgets&&b.forEach(this.appConfig.widgetPool.widgets,function(b){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(b.id)&&k.push(b):"all"===this.controlledWidgets&&k.push(b))},
this);return k}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/geometry/SpatialReference ./unitUtils".split(" "),function(n,b,m,k,g,e,f,l){var h=null,d=null,a=!1;n=n(null,function(){});var c=require.toUrl("jimu"),q=e(c+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),p=e(c+"/SpatialReference/transform.json",{handleAs:"json"});n.loadResource=function(){var b=new k;if(h&&d)return b.resolve(),
b;g([q,p]).then(function(c){h=c[0];d=c[1];a=!0;b.resolve()},function(c){console.error(c);a=!1;b.reject(c)});return b};n.getAllCSUnits=function(){if(a){var c=[];m.forEach(h.wkids,b.hitch(this,function(a){a=this.getCSUnit(a);-1===m.indexOf(c,a)&&c.push(a)}));return c}};n.convertUnit=function(b,c,d){if(a)return l.convertUnit(b,c,d)};n.getUnitRate=function(b,c){if(a)return l.getUnitRate(b,c)};n.isProjectUnit=function(b){if(a)return l.isProjectUnit(b)};n.isGeographicUnit=function(b){if(a)return l.isGeographicUnit(b)};
n.getGeographicUnits=function(){if(a)return l.getGeographicUnits()};n.getProjectUnits=function(){if(a)return l.getProjectUnits()};n.getCSUnit=function(b){if(a){b=this.getCSStr(b);var c=0,d=0,c=b.lastIndexOf("UNIT"),d=b.indexOf(",",c);return b.slice(c+6,d-1)}};n.isSameSR=function(b,c){if(a)return b=this.indexOfWkid(b),c=this.indexOfWkid(c),h.labels[b]===h.labels[c]};n.isValidWkid=function(b){if(a)return-1<this.indexOfWkid(b)};n.getSRLabel=function(b){if(a&&this.isValidWkid(b))return b=this.indexOfWkid(b),
h.labels[b]};n.indexOfWkid=function(b){if(a)return m.indexOf(h.wkids,b)};n.isWebMercator=function(a){return f.prototype._isWebMercator?f.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new f(parseInt(a,10))).isWebMercator};n.standardizeWkid=function(a){return this.isWebMercator(a)?3857:parseInt(a,10)};n.isValidTfWkid=function(b){if(a)return-1<this.indexOfTfWkid(b)};n.getTransformationLabel=function(b){if(a)return this.isValidTfWkid(b)?(b=this.indexOfTfWkid(b),d.labels[b]):""};n.indexOfTfWkid=
function(b){if(a)return m.indexOf(d.tfWkids,b)};n.isGeographicCS=function(b){if(a)return this.isValidWkid(b)?h.details[this.indexOfWkid(b)].startWith("GEOGCS"):!1};n.isProjectedCS=function(b){if(a)return this.isValidWkid(b)?h.details[this.indexOfWkid(b)].startWith("PROJCS"):!1};n.getGeoCSByProj=function(b){if(a&&this.isProjectedCS(b))return b=this.getSpheroidStr(b),b=m.indexOf(h.details,b),h.wkids[b]};n.getSpheroidStr=function(b){if(a){if(this.isGeographicCS(b))return h.details[this.indexOfWkid(b)];
if(this.isProjectedCS(b)){b=h.details[this.indexOfWkid(b)];var c=b.indexOf("GEOGCS"),d=b.indexOf("PROJECTION")-1;return b.slice(c,d)}return null}};n.getCSStr=function(b){if(a)return h.details[this.indexOfWkid(b)]};n.isSameSpheroid=function(b,c){if(a)return b=this.getSpheroidStr(b),c=this.getSpheroidStr(c),b&&c&&b===c?!0:!1};return n})},"dojo/request":function(){define(["./request/default!"],function(n){return n})},"dojo/request/default":function(){define(["exports","require","../has"],function(n,
b,m){var k=m("config-requestProvider"),g;if(m("host-browser")||m("host-webworker"))g="./xhr";k||(k=g);n.getPlatformDefaultId=function(){return g};n.load=function(e,f,l,h){b(["platform"==e?g:k],function(b){l(b)})}})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(n,b){var m="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),
k="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),g={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:.001,CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,
YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897};n=n(null,function(){});n.convertUnit=function(b,f,k){return g[b.toUpperCase()]/g[f.toUpperCase()]*k};n.getUnitRate=function(b,f){return g[b.toUpperCase()]/g[f.toUpperCase()]};n.isProjectUnit=function(e){return-1<b.indexOf(m,e.toUpperCase())};n.isGeographicUnit=function(e){return-1<
b.indexOf(k,e.toUpperCase())};n.getGeographicUnits=function(){return k};n.getProjectUnits=function(){return m};return n})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),function(n,b,m,k,g,e,f,l,h){return n([f,e],{baseClass:"jimu-panel jimu-on-screen-widget-panel",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,
templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(b){b.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(b){b.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(m.removeClass(this.foldableNode,"fold-up"),m.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(m.removeClass(this.foldableNode,"fold-down"),m.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(b){this.panelManager.closePanel(this);b.stopPropagation()},_normalizePositionObj:function(d){var a=this._getLayoutBox();d.left=
isFinite(d.left)?d.left:a.w-d.right;d.top=isFinite(d.top)?d.top:a.h-d.bottom;delete d.right;delete d.bottom;this.position=b.mixin(b.clone(this.position),d)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new h({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(d,a){this.disableMoveable();var c=m.getMarginBox(jimuConfig.layoutId);c.l=c.l-d+a;c.w+=2*(d-a);this.moveable=new g.boxConstrainedMoveable(this.domNode,{box:c,handle:this.titleNode,within:!0});this.own(k(this.moveable,
"Moving",b.hitch(this,this.onMoving)));this.own(k(this.moveable,"MoveStop",b.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);this.inherited(arguments)},_switchToMobileUI:function(){m.removeClass(this.titleNode,"title-normal");m.addClass(this.titleNode,"title-full");m.setStyle(this.foldableNode,"display",
"block");m.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(m.removeClass(this.foldableNode,"fold-up"),m.addClass(this.foldableNode,"fold-down")):(m.removeClass(this.foldableNode,"fold-down"),m.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){m.removeClass(this.titleNode,"title-full");m.addClass(this.titleNode,"title-normal");m.setStyle(this.foldableNode,"display","none");m.setStyle(this.maxNode,"display","none")},resize:function(d){var a=this._getPositionInfo(),
c={left:a.position.left,top:a.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};d&&(d.t=this.domNode.offsetTop,c.left=isFinite(d.l)?d.l:c.left,c.top=isFinite(d.t)?d.t:c.top,c.width=isFinite(d.w)?d.w:c.width,c.height=isFinite(d.h)?d.h:c.height,this._normalizePositionObj(b.clone(c)),this.makePositionInfoBox(),c.width=this._positionInfoBox.w,c.height=this._positionInfoBox.h);a.position=c;this._onResponsible(a);this.inherited(arguments)},_onResponsible:function(b){b.isRunInMobile?
(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(b.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(b){this._normalizePositionObj(b);this.makePositionInfoBox();b=this._getPositionInfo();this._onResponsible(b)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var b=jimuConfig.layoutId,
b="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return m.getMarginBox(b)},_getPositionInfo:function(){var b={isRunInMobile:!1,position:{left:0,top:5}},a=this._getLayoutBox(),c=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return b.isRunInMobile=!0,b;b.position.left=window.isRTL?a.w-c:c;var c=this._positionInfoBox.t,e=a.h-c;c>=e?c>=this._positionInfoBox.h&&(b.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):e>=this._positionInfoBox.h&&(b.position.top=
this._positionInfoBox.t+40+3);!b.isRunInMobile&&b.position.left+this._positionInfoBox.w>a.w&&(b.position.left-=this._positionInfoBox.w);return b},_setMobilePosition:function(){m.place(this.domNode,jimuConfig.layoutId);var d=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(d.zIndex=this.position.zIndex);var a=l.getPositionStyle(d);b.mixin(a,d.borderRadiusStyle);m.setStyle(this.domNode,a)},_setDesktopPosition:function(b){m.place(this.domNode,jimuConfig.mapId);m.setStyle(this.domNode,
{left:b.left+"px",right:"auto",top:b.top+"px",width:(b.width||this.position.width||this._originalBox.w)+"px",height:(b.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(b){m.setStyle(b.node,"opacity",.9)},onMoveStop:function(d){m.setStyle(d.node,"opacity",1);d=m.getMarginBox(d.node);this._normalizePositionObj(b.clone({left:d.l,top:d.t,width:d.w,height:d.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r){n.experimental("dojox.layout.ResizeHandle");var x=q("dojox.layout._ResizeHelper",u,{show:function(){c.set(this.domNode,"display","")},hide:function(){c.set(this.domNode,"display","none")},resize:function(b){a.setMarginBox(this.domNode,b)}});return q("dojox.layout.ResizeHandle",[u,r],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,
minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,p.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=t.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new x({id:"dojoxGlobalResizeHelper"})).placeAt(f.body()),
d.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var a=b.partial(d.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;a("dojoxResizeNW");break;case "x":this._resizeX=!0;a("dojoxResizeW");break;case "y":this._resizeY=!0,a("dojoxResizeN")}},_beginSizing:function(b){if(!this._isSizing&&
(m.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=t.byId(this.targetId))?this.targetWidget.domNode:h.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var d=a.position(this.targetDomNode,!0);this._resizeHelper.resize({l:d.x,t:d.y,w:d.w,h:d.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:d.x,t:d.y})}this._isSizing=!0;this.startPoint={x:b.clientX,y:b.clientY};
var d=c.getComputedStyle(this.targetDomNode),e="border-model"===a.boxModel?{w:0,h:0}:a.getPadBorderExtents(this.targetDomNode,d),k=a.getMarginExtents(this.targetDomNode,d);this.startSize={w:c.get(this.targetDomNode,"width",d),h:c.get(this.targetDomNode,"height",d),pbw:e.w,pbh:e.h,mw:k.w,mh:k.h};this.isLeftToRight()||"absolute"!=c.get(this.targetDomNode,"position")||(d=a.position(this.targetDomNode,!0),this.startPosition={l:d.x,t:d.y});this._pconnects=[m.connect(f.doc,p.move,this,"_updateSizing"),
m.connect(f.doc,p.release,this,"_endSizing")];g.stop(b)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var b=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===b)return;this._resizeHelper.resize(b)}a.preventDefault()},_getNewCoords:function(a,b,c){try{if(!a.clientX||!a.clientY)return!1}catch(B){return!1}this._activeResizeLastEvent=a;var d=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),e=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?
d:0);e=this._checkConstraints(a,this.startSize.h-(this._resizeY?e:0));(c=c||this.startPosition)&&this._resizeX&&(e.l=c.l+d,e.w!=a&&(e.l+=a-e.w),e.t=c.t);switch(b){case "margin":e.w+=this.startSize.mw,e.h+=this.startSize.mh;case "border":e.w+=this.startSize.pbw,e.h+=this.startSize.pbh}return e},_checkConstraints:function(a,b){if(this.minSize){var c=this.minSize;a<c.w&&(a=c.w);b<c.h&&(b=c.h)}this.constrainMax&&this.maxSize&&(c=this.maxSize,a>c.w&&(a=c.w),b>c.h&&(b=c.h));if(this.fixedAspect){var c=this.startSize.w,
d=this.startSize.h,e=c*b-d*a;0>e?a=b*c/d:0<e&&(b=a*d/c)}return{w:a,h:b}},_changeSizing:function(a){var d=this.targetWidget&&b.isFunction(this.targetWidget.resize),f=this._getNewCoords(a,d&&"margin");if(!1!==f&&(d?this.targetWidget.resize(f):this.animateSizing?l[this.animateMethod]([e.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:f.w}},duration:this.animateDuration}),e.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:f.h}},
duration:this.animateDuration})]).play():c.set(this.targetDomNode,{width:f.w+"px",height:f.h+"px"}),this.intermediateChanges))this.onResize(a)},_endSizing:function(a){k.forEach(this._pconnects,m.disconnect);var c=b.partial(m.publish,this.endTopic,[this]);this.activeResize?c():(this._resizeHelper.hide(),this._changeSizing(a),setTimeout(c,this.animateDuration+15));this._isSizing=!1;this.onResize(a)},onResize:function(a){}})})},"dojo/fx":function(){define("./_base/lang ./Evented ./_base/kernel ./_base/array ./aspect ./_base/fx ./dom ./dom-style ./dom-geometry ./ready require".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){m.isAsync||d(0,function(){a(["./fx/Toggler"])});m=m.fx={};d={_fire:function(a,b){this[a]&&this[a].apply(this,b||[]);return this}};var c=function(a){this._index=-1;this._animations=a||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;k.forEach(this._animations,function(a){a&&("undefined"!=typeof a.duration&&(this.duration+=a.duration),a.delay&&(this.duration+=a.delay))},this)};c.prototype=new b;n.extend(c,{_onAnimate:function(){this._fire("onAnimate",
arguments)},_onEnd:function(){this._onAnimateCtx.remove();this._onEndCtx.remove();this._onAnimateCtx=this._onEndCtx=null;this._index+1==this._animations.length?this._fire("onEnd"):(this._current=this._animations[++this._index],this._onAnimateCtx=g.after(this._current,"onAnimate",n.hitch(this,"_onAnimate"),!0),this._onEndCtx=g.after(this._current,"onEnd",n.hitch(this,"_onEnd"),!0),this._current.play(0,!0))},play:function(a,b){this._current||(this._current=this._animations[this._index=0]);if(!b&&"playing"==
this._current.status())return this;var c=g.after(this._current,"beforeBegin",n.hitch(this,function(){this._fire("beforeBegin")}),!0),d=g.after(this._current,"onBegin",n.hitch(this,function(a){this._fire("onBegin",arguments)}),!0),e=g.after(this._current,"onPlay",n.hitch(this,function(a){this._fire("onPlay",arguments);c.remove();d.remove();e.remove()}));this._onAnimateCtx&&this._onAnimateCtx.remove();this._onAnimateCtx=g.after(this._current,"onAnimate",n.hitch(this,"_onAnimate"),!0);this._onEndCtx&&
this._onEndCtx.remove();this._onEndCtx=g.after(this._current,"onEnd",n.hitch(this,"_onEnd"),!0);this._current.play.apply(this._current,arguments);return this},pause:function(){if(this._current){var a=g.after(this._current,"onPause",n.hitch(this,function(b){this._fire("onPause",arguments);a.remove()}),!0);this._current.pause()}return this},gotoPercent:function(a,b){this.pause();var c=this.duration*a;this._current=null;k.some(this._animations,function(a,b){if(c<=a.duration)return this._current=a,this._index=
b,!0;c-=a.duration;return!1},this);this._current&&this._current.gotoPercent(c/this._current.duration);b&&this.play();return this},stop:function(a){if(this._current){if(a){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var b=g.after(this._current,"onStop",n.hitch(this,function(a){this._fire("onStop",arguments);b.remove()}),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():
"stopped"},destroy:function(){this.stop();this._onAnimateCtx&&this._onAnimateCtx.remove();this._onEndCtx&&this._onEndCtx.remove()}});n.extend(c,d);m.chain=function(a){return new c(n.isArray(a)?a:Array.prototype.slice.call(a,0))};var q=function(a){this._animations=a||[];this._connects=[];this.duration=this._finished=0;k.forEach(a,function(a){var b=a.duration;a.delay&&(b+=a.delay);this.duration<b&&(this.duration=b);this._connects.push(g.after(a,"onEnd",n.hitch(this,"_onEnd"),!0))},this);this._pseudoAnimation=
new e.Animation({curve:[0,1],duration:this.duration});var b=this;k.forEach("beforeBegin onBegin onPlay onAnimate onPause onStop onEnd".split(" "),function(a){b._connects.push(g.after(b._pseudoAnimation,a,function(){b._fire(a,arguments)},!0))})};n.extend(q,{_doAction:function(a,b){k.forEach(this._animations,function(c){c[a].apply(c,b)});return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(a,b){var c=this._pseudoAnimation;c[a].apply(c,b)},play:function(a,
b){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this},gotoPercent:function(a,b){var c=this.duration*a;k.forEach(this._animations,function(a){a.gotoPercent(a.duration<c?1:c/a.duration,b)});this._call("gotoPercent",arguments);return this},stop:function(a){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},
destroy:function(){this.stop();k.forEach(this._connects,function(a){a.remove()})}});n.extend(q,d);m.combine=function(a){return new q(n.isArray(a)?a:Array.prototype.slice.call(a,0))};m.wipeIn=function(a){var b=a.node=f.byId(a.node),c=b.style,d;a=e.animateProperty(n.mixin({properties:{height:{start:function(){d=c.overflow;c.overflow="hidden";if("hidden"==c.visibility||"none"==c.display)return c.height="1px",c.display="",c.visibility="",1;var a=l.get(b,"height");return Math.max(a,1)},end:function(){return b.scrollHeight}}}},
a));var h=function(){c.height="auto";c.overflow=d};g.after(a,"onStop",h,!0);g.after(a,"onEnd",h,!0);return a};m.wipeOut=function(a){var b=(a.node=f.byId(a.node)).style,c;a=e.animateProperty(n.mixin({properties:{height:{end:1}}},a));g.after(a,"beforeBegin",function(){c=b.overflow;b.overflow="hidden";b.display=""},!0);var d=function(){b.overflow=c;b.height="auto";b.display="none"};g.after(a,"onStop",d,!0);g.after(a,"onEnd",d,!0);return a};m.slideTo=function(a){var b=null,c=null,d=function(a){return function(){var d=
l.getComputedStyle(a),e=d.position;b="absolute"==e?a.offsetTop:parseInt(d.top)||0;c="absolute"==e?a.offsetLeft:parseInt(d.left)||0;"absolute"!=e&&"relative"!=e&&(d=h.position(a,!0),b=d.y,c=d.x,a.style.position="absolute",a.style.top=b+"px",a.style.left=c+"px")}}(a.node=f.byId(a.node));d();a=e.animateProperty(n.mixin({properties:{top:a.top||0,left:a.left||0}},a));g.after(a,"beforeBegin",d,!0);return a};return m})},"dijit/_base/manager":function(){define(["dojo/_base/array","dojo/_base/config","dojo/_base/lang",
"../registry","../main"],function(n,b,m,k,g){var e={};n.forEach("byId getUniqueId findWidgets _destroyAll byNode getEnclosingWidget".split(" "),function(b){e[b]=k[b]});m.mixin(e,{defaultDuration:b.defaultDuration||200});m.mixin(g,e);return g})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){function p(){}function t(a){return function(b,c,d,e){return b&&"string"==typeof c&&b[c]==p?b.on(c.substring(2).toLowerCase(),f.hitch(d,e)):a.apply(m,arguments)}}n.around(m,"connect",t);e.connect&&n.around(e,"connect",t);n=k("dijit._Widget",[a,c,q],{onClick:p,onDblClick:p,onKeyDown:p,onKeyPress:p,onKeyUp:p,onMouseDown:p,onMouseMove:p,onMouseOut:p,onMouseOver:p,onMouseLeave:p,onMouseEnter:p,onMouseUp:p,constructor:function(a){this._toConnect={};for(var b in a)this[b]===
p&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===p?m.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,b){e.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(a,b)},attr:function(a,b){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){e.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?l("[widgetId]",this.containerNode).map(d.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});g("dijit-legacy-requires")&&h(0,function(){require(["dijit/_base"])});
return n})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(n,b,m,k,g,e){n=k("dijit._OnDijitClickMixin",null,{connect:function(b,g,h){return this.inherited(arguments,[b,"ondijitclick"==g?e:g,h])}});n.a11yclick=e;return n})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(n,b,m,k){function g(b){if((b.keyCode===n.ENTER||b.keyCode===n.SPACE)&&!/input|button|textarea/i.test(b.target.nodeName))for(b=
b.target;b;b=b.parentNode)if(b.dojoClick)return!0}var e;m(document,"keydown",function(b){g(b)?(e=b.target,b.preventDefault()):e=null});m(document,"keyup",function(b){g(b)&&b.target==e&&(e=null,m.emit(b.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:b.ctrlKey,shiftKey:b.shiftKey,metaKey:b.metaKey,altKey:b.altKey,_origType:b.type}))});var f=function(b,e){b.dojoClick=!0;return m(b,"click",e)};f.click=f;f.press=function(e,f){var d=m(e,k.press,function(a){("mousedown"!=a.type||b.isLeft(a))&&f(a)}),a=
m(e,"keydown",function(a){a.keyCode!==n.ENTER&&a.keyCode!==n.SPACE||f(a)});return{remove:function(){d.remove();a.remove()}}};f.release=function(e,f){var d=m(e,k.release,function(a){("mouseup"!=a.type||b.isLeft(a))&&f(a)}),a=m(e,"keyup",function(a){a.keyCode!==n.ENTER&&a.keyCode!==n.SPACE||f(a)});return{remove:function(){d.remove();a.remove()}}};f.move=k.move;return f})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(n,b,m,k){k.extend(b,
{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return m("dijit._FocusMixin",null,{_focusManager:n})})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r){var x,w,v=new (b([c,
f],{curNode:null,activeStack:[],constructor:function(){var a=l.hitch(this,function(a){m.isDescendant(this.curNode,a)&&this.set("curNode",null);m.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});n.before(e,"empty",a);n.before(e,"destroy",a)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,b){var c=this,d=a.document&&a.document.body;if(d){var e=h(a.document,"pointerdown",function(a){a&&a.target&&null==a.target.parentNode||c._onTouchNode(b||a.target,
"mouse")}),f=h(d,"focusin",function(a){if(a.target.tagName){var d=a.target.tagName.toLowerCase();"#document"!=d&&"body"!=d&&(t.isFocusable(a.target)?c._onFocusNode(b||a.target):c._onTouchNode(b||a.target))}}),g=h(d,"focusout",function(a){c._onBlurNode(b||a.target)});return{remove:function(){e.remove();f.remove();g.remove();d=e=f=g=null}}}},_onBlurNode:function(a){a=(new Date).getTime();a<x+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(l.hitch(this,
function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),a<w+100||(this._clearActiveWidgetsTimer=setTimeout(l.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(a,b){w=(new Date).getTime();this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);g.contains(a,"dijitPopup")&&(a=a.firstChild);var c=
[];try{for(;a;){var d=k.get(a,"dijitPopupParent");if(d)a=u.byId(d).domNode;else if(a.tagName&&"body"==a.tagName.toLowerCase()){if(a===q.body())break;a=p.get(a.ownerDocument).frameElement}else{var e=a.getAttribute&&a.getAttribute("widgetId"),f=e&&u.byId(e);!f||"mouse"==b&&f.get("disabled")||c.unshift(e);a=a.parentNode}}}catch(G){}this._setStack(c,b)},_onFocusNode:function(a){a&&9!=a.nodeType&&(x=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),
this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(a,b){var c=this.activeStack,d=c.length-1,e=a.length-1;if(a[e]!=c[d]){this.set("activeStack",a);var f;for(f=d;0<=f&&c[f]!=a[f];f--)if(d=u.byId(c[f]))d._hasBeenBlurred=!0,d.set("focused",!1),d._focusManager==this&&d._onBlur(b),this.emit("widget-blur",d,b);for(f++;f<=e;f++)if(d=u.byId(a[f]))d.set("focused",!0),d._focusManager==this&&d._onFocus(b),this.emit("widget-focus",d,b)}},focus:function(a){if(a)try{a.focus()}catch(A){}}}));
d(function(){var b=v.registerWin(p.get(document));a("ie")&&h(window,"unload",function(){b&&(b.remove(),b=null)})});r.focus=function(a){v.focus(a)};for(var z in v)/^_/.test(z)||(r.focus[z]="function"==typeof v[z]?l.hitch(v,z):v[z]);v.watch(function(a,b,c){r.focus[a]=c});return v})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(n,b,m,k,g,e,f){var l={_isElementShown:function(b){var d=k.get(b);return"hidden"!=
d.visibility&&"collapsed"!=d.visibility&&"none"!=d.display&&"hidden"!=m.get(b,"type")},hasDefaultTabStop:function(b){switch(b.nodeName.toLowerCase()){case "a":return m.has(b,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":var d;try{var a=b.contentDocument;if("designMode"in a&&"on"==a.designMode)return!0;d=a.body}catch(c){try{d=b.contentWindow.document.body}catch(q){return!1}}return d&&("true"==d.contentEditable||d.firstChild&&"true"==
d.firstChild.contentEditable);default:return"true"==b.contentEditable}},effectiveTabIndex:function(b){if(!m.get(b,"disabled"))return m.has(b,"tabIndex")?+m.get(b,"tabIndex"):l.hasDefaultTabStop(b)?0:void 0},isTabNavigable:function(b){return 0<=l.effectiveTabIndex(b)},isFocusable:function(b){return-1<=l.effectiveTabIndex(b)},_getTabNavigable:function(b){function d(a){return a&&"input"==a.tagName.toLowerCase()&&a.type&&"radio"==a.type.toLowerCase()&&a.name&&a.name.toLowerCase()}function a(a){return x[d(a)]||
a}var c,f,g,h,k,n,x={},w=l._isElementShown,v=l.effectiveTabIndex,z=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(!(1!=a.nodeType||9>=e("ie")&&"HTML"!==a.scopeName)&&w(a)){var b=v(a);if(0<=b){if(0==b)c||(c=a),f=a;else if(0<b){if(!g||b<h)h=b,g=a;if(!k||b>=n)n=b,k=a}b=d(a);m.get(a,"checked")&&b&&(x[b]=a)}"SELECT"!=a.nodeName.toUpperCase()&&z(a)}};w(b)&&z(b);return{first:a(c),last:a(f),lowest:a(g),highest:a(k)}},getFirstInTabbingOrder:function(e,d){e=l._getTabNavigable(b.byId(e,d));return e.lowest?
e.lowest:e.first},getLastInTabbingOrder:function(e,d){e=l._getTabNavigable(b.byId(e,d));return e.last?e.last:e.highest}};g.mixin(f,l);return l})},"dojo/uacss":function(){define(["./dom-geometry","./_base/lang","./domReady","./sniff","./_base/window"],function(n,b,m,k,g){var e=g.doc.documentElement;g=k("ie");var f=k("opera"),l=Math.floor,h=n.boxModel.replace(/-/,""),f={dj_quirks:0,dj_opera:f,dj_khtml:0,dj_webkit:k("webkit"),dj_safari:k("safari"),dj_chrome:k("chrome"),dj_edge:1,dj_gecko:1,dj_ios:k("ios"),
dj_android:0};g&&(f.dj_ie=!0,f["dj_ie"+l(g)]=!0,f.dj_iequirks=0);f["dj_ff"+l(1)]=!0;f["dj_"+h]=!0;var d="",a;for(a in f)f[a]&&(d+=a+" ");e.className=b.trim(e.className+" "+d);m(function(){if(!n.isBodyLtr()){var a="dj_rtl dijitRtl "+d.replace(/ /g,"-rtl ");e.className=b.trim(e.className+" "+a+"dj_rtl dijitRtl "+d.replace(/ /g,"-rtl "))}});return k})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(n,b,m,k){m(function(){b("highcontrast")&&
n.add(k.body(),"dijit_a11y")});return b})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(n,b,m,k,g,e,f){g.add("highcontrast",function(){var e=f.doc.createElement("div");try{e.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(b.blankGif||n.toUrl("./resources/blank.gif"))+'");';f.body().appendChild(e);var h=k.getComputedStyle(e),d=h.backgroundImage;
return h.borderTopColor==h.borderRightColor||d&&("none"==d||"url(invalid-url:)"==d)}catch(a){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+a.toString()),!1}finally{8>=g("ie")?e.outerHTML="":f.body().removeChild(e)}});e(function(){g("highcontrast")&&m.add(f.body(),"dj_a11y")});return g})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),
function(n,b,m,k,g,e,f,l,h){return e("dijit.layout._LayoutWidget",[b,m,k],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);f.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var b=this.getParent&&this.getParent();b&&b.isLayoutContainer||(this.resize(),this.own(g.on("resize",n.hitch(this,"resize"))))}},resize:function(b,a){var c=this.domNode;b&&l.setMarginBox(c,b);a=a||{};
n.mixin(a,b||{});"h"in a&&"w"in a||(a=n.mixin(l.getMarginBox(c),a));b=h.getComputedStyle(c);var d=l.getMarginExtents(c,b),e=l.getBorderExtents(c,b);a=this._borderBox={w:a.w-(d.w+e.w),h:a.h-(d.h+e.h)};d=l.getPadExtents(c,b);this._contentBox={l:h.toPixelValue(c,b.paddingLeft),t:h.toPixelValue(c,b.paddingTop),w:a.w-d.w,h:a.h-d.h};this.layout()},layout:function(){},_setupChild:function(b){f.add(b.domNode,this.baseClass+"-child "+(b.baseClass?this.baseClass+"-"+b.baseClass:""))},addChild:function(b,a){this.inherited(arguments);
this._started&&this._setupChild(b)},removeChild:function(b){f.remove(b.domNode,this.baseClass+"-child"+(b.baseClass?" "+this.baseClass+"-"+b.baseClass:""));this.inherited(arguments)}})})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(n,b){return n("dijit._Contained",null,{_getSibling:function(b){var k=this.getParent();return k&&k._getSiblingOfChild&&k._getSiblingOfChild(this,"previous"==b?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},
getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var b=this.getParent();return b&&b.getIndexOfChild?b.getIndexOfChild(this):-1}})})},"dijit/Viewport":function(){define(["dojo/Evented","dojo/on","dojo/domReady","dojo/sniff","dojo/window"],function(n,b,m,k,g){var e=new n,f;m(function(){var l=g.getBox();e._rlh=b(window,"resize",function(){var b=g.getBox();if(l.h!=b.h||l.w!=b.w)l=b,e.emit("resize")});if(8==k("ie")){var h=screen.deviceXDPI;setInterval(function(){screen.deviceXDPI!=
h&&(h=screen.deviceXDPI,e.emit("resize"))},500)}k("ios")&&(b(document,"focusin",function(b){f=b.target}),b(document,"focusout",function(b){f=null}))});e.getEffectiveBox=function(b){b=g.getBox(b);var e=f&&f.tagName&&f.tagName.toLowerCase();k("ios")&&f&&!f.readOnly&&("textarea"==e||"input"==e&&/^(color|email|number|password|search|tel|text|url)$/.test(f.type))&&(b.h*=0==orientation||180==orientation?.66:.4,e=f.getBoundingClientRect(),b.h=Math.max(b.h,e.top+e.height));return b};return e})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u){a("dijit-legacy-requires")&&u(0,function(){n(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return m("dijit.Menu",t,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):b.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return q.get(this._iframeContentDocument(a))||
this._iframeContentDocument(a).__parent__||a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(a){a=k.byId(a,this.ownerDocument);var b;if("iframe"==a.tagName.toLowerCase()){var e=a;b=this._iframeContentWindow(e);b=c.body(b.document)}else b=a==c.body(this.ownerDocument)?this.ownerDocument.documentElement:a;var f={node:a,
iframe:e};g.set(a,"_dijitMenu"+this.id,this._bindings.push(f));var m=h.hitch(this,function(a){var b=this.selector,c=b?function(a){return d.selector(b,a)}:function(a){return a},f=this;return[d(a,c(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<f._lastKeyDown+500||f._scheduleOpen(this,e,{x:a.pageX,y:a.pageY},a.target)}),d(a,c("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==l.F10||f.leftClickToOpen&&a.keyCode==l.SPACE)a.stopPropagation(),
a.preventDefault(),f._scheduleOpen(this,e,null,a.target),f._lastKeyDown=(new Date).getTime()})]});f.connects=b?m(b):[];e&&(f.onloadHandler=h.hitch(this,function(){var a=this._iframeContentWindow(e),a=c.body(a.document);f.connects=m(a)}),e.addEventListener?e.addEventListener("load",f.onloadHandler,!1):e.attachEvent("onload",f.onloadHandler))},unBindDomNode:function(a){var b;try{b=k.byId(a,this.ownerDocument)}catch(y){return}a="_dijitMenu"+this.id;if(b&&g.has(b,a)){for(var c=g.get(b,a)-1,d=this._bindings[c],
e;e=d.connects.pop();)e.remove();(e=d.iframe)&&(e.removeEventListener?e.removeEventListener("load",d.onloadHandler,!1):e.detachEvent("onload",d.onloadHandler));g.remove(b,a);delete this._bindings[c]}},_scheduleOpen:function(a,b,c,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(b){function c(){q.refocus&&t&&t.focus();p.close(q)}var d=b.target,g=b.iframe,h=b.coords,l=!h;this.currentTarget=
b.delegatedTarget;if(h){if(g){b=e.position(g,!0);var d=this._iframeContentWindow(g),d=e.docScroll(d.document),m=f.getComputedStyle(g),n=f.toPixelValue,r=(a("ie"),n(g,m.paddingLeft))+(a("ie"),0),g=(a("ie"),n(g,m.paddingTop))+(a("ie"),0);h.x+=b.x+r-d.x;h.y+=b.y+g-d.y}}else h=e.position(d,!0),h.x+=10,h.y+=10;var q=this,g=this._focusManager.get("prevNode");b=this._focusManager.get("curNode");var t=!b||k.isDescendant(b,this.domNode)?g:b;p.open({popup:this,x:h.x,y:h.y,onExecute:c,onCancel:c,orient:this.isLeftToRight()?
"L":"R"});this.focus();l||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);p.close(this)}},destroy:function(){b.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dijit/popup":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on ./place ./BackgroundIframe ./Viewport ./main dojo/touch".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u){function r(){this._popupWrapper&&(e.destroy(this._popupWrapper),delete this._popupWrapper)}m=m(null,{_stack:[],_beginZIndex:1E3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var b=this._firstAroundPosition,c=f.position(this._firstAroundNode,!0),d=c.x-b.x,b=c.y-b.y;if(d||b)for(this._firstAroundPosition=c,c=0;c<this._stack.length;c++){var e=this._stack[c].wrapper.style;e.top=parseFloat(e.top)+b+"px";"auto"==e.right?e.left=parseFloat(e.left)+d+
"px":e.right=parseFloat(e.right)-d+"px"}this._aroundMoveListener=setTimeout(a.hitch(this,"_repositionAll"),d||b?10:50)}},_createWrapper:function(a){var d=a._popupWrapper,f=a.domNode;d||(d=e.create("div",{"class":"dijitPopup",style:{display:"none"},role:"region","aria-label":a["aria-label"]||a.label||a.name||a.id},a.ownerDocumentBody),d.appendChild(f),f=f.style,f.display="",f.visibility="",f.position="",f.top="0px",a._popupWrapper=d,b.after(a,"destroy",r,!0),"ontouchend"in document&&c(d,"touchend",
function(a){/^(input|button|textarea)$/i.test(a.target.tagName)||a.preventDefault()}),d.dojoClick=!0);return d},moveOffScreen:function(a){var b=this._createWrapper(a);a=f.isBodyLtr(a.ownerDocument);var c={visibility:"hidden",top:"-9999px",display:""};c[a?"left":"right"]="-9999px";c[a?"right":"left"]="auto";l.set(b,c);return b},hide:function(a){var b=this._createWrapper(a);l.set(b,{display:"none",height:"auto",overflowY:"visible",border:""});a=a.domNode;"_originalStyle"in a&&(a.style.cssText=a._originalStyle)},
getTopPopup:function(){for(var a=this._stack,b=a.length-1;0<b&&a[b].parent===a[b-1].widget;b--);return a[b]},open:function(b){for(var e=this._stack,m=b.popup,n=m.domNode,r=b.orient||["below","below-alt","above","above-alt"],u=b.parent?b.parent.isLeftToRight():f.isBodyLtr(m.ownerDocument),x=b.around,C=b.around&&b.around.id?b.around.id+"_dropdown":"popup_"+this._idGen++;e.length&&(!b.parent||!k.isDescendant(b.parent.domNode,e[e.length-1].widget.domNode));)this.close(e[e.length-1].widget);var F=this.moveOffScreen(m);
m.startup&&!m._started&&m.startup();var E,G=f.position(n);if("maxHeight"in b&&-1!=b.maxHeight)E=b.maxHeight||Infinity;else{E=t.getEffectiveBox(this.ownerDocument);var H=x?f.position(x,!1):{y:b.y-(b.padding||0),h:2*(b.padding||0)};E=Math.floor(Math.max(H.y,E.h-(H.y+H.h)))}G.h>E&&(G=l.getComputedStyle(n),l.set(F,{overflowY:"scroll",height:E+"px",border:G.borderLeftWidth+" "+G.borderLeftStyle+" "+G.borderLeftColor}),n._originalStyle=n.style.cssText,n.style.border="none");g.set(F,{id:C,style:{zIndex:this._beginZIndex+
e.length},"class":"dijitPopup "+(m.baseClass||m["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:b.parent?b.parent.id:""});0==e.length&&x&&(this._firstAroundNode=x,this._firstAroundPosition=f.position(x,!0),this._aroundMoveListener=setTimeout(a.hitch(this,"_repositionAll"),50));h("config-bgIframe")&&!m.bgIframe&&(m.bgIframe=new p(F));C=m.orient?a.hitch(m,"orient"):null;r=x?q.around(F,x,r,u,C):q.at(F,b,"R"==r?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],b.padding,C);F.style.visibility="visible";
n.style.visibility="visible";n=[];n.push(c(F,"keydown",a.hitch(this,function(a){if(a.keyCode==d.ESCAPE&&b.onCancel)a.stopPropagation(),a.preventDefault(),b.onCancel();else if(a.keyCode==d.TAB&&(a.stopPropagation(),a.preventDefault(),(a=this.getTopPopup())&&a.onCancel))a.onCancel()})));m.onCancel&&b.onCancel&&n.push(m.on("cancel",b.onCancel));n.push(m.on(m.onExecute?"execute":"change",a.hitch(this,function(){var a=this.getTopPopup();if(a&&a.onExecute)a.onExecute()})));e.push({widget:m,wrapper:F,parent:b.parent,
onExecute:b.onExecute,onCancel:b.onCancel,onClose:b.onClose,handlers:n});if(m.onOpen)m.onOpen(r);return r},close:function(a){for(var b=this._stack;a&&n.some(b,function(b){return b.widget==a})||!a&&b.length;){var c=b.pop(),d=c.widget,e=c.onClose;d.bgIframe&&(d.bgIframe.destroy(),delete d.bgIframe);if(d.onClose)d.onClose();for(var f;f=c.handlers.pop();)f.remove();d&&d.domNode&&this.hide(d);e&&e()}0==b.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=
this._aroundMoveListener=null)}});return u.popup=new m})},"dijit/place":function(){define("dojo/_base/array dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/_base/window ./Viewport ./main".split(" "),function(n,b,m,k,g,e,f){function l(d,a,c,f){var h=e.getEffectiveBox(d.ownerDocument);d.parentNode&&"body"==String(d.parentNode.tagName).toLowerCase()||g.body(d.ownerDocument).appendChild(d);var k=null;n.some(a,function(a){var e=a.corner,g=a.pos,l=0,m={w:{L:h.l+h.w-g.x,R:g.x-h.l,M:h.w}[e.charAt(1)],
h:{T:h.t+h.h-g.y,B:g.y-h.t,M:h.h}[e.charAt(0)]},n=d.style;n.left=n.right="auto";c&&(l=c(d,a.aroundCorner,e,m,f),l="undefined"==typeof l?0:l);var p=d.style,r=p.display,q=p.visibility;"none"==p.display&&(p.visibility="hidden",p.display="");n=b.position(d);p.display=r;p.visibility=q;r={L:g.x,R:g.x-n.w,M:Math.max(h.l,Math.min(h.l+h.w,g.x+(n.w>>1))-n.w)}[e.charAt(1)];q={T:g.y,B:g.y-n.h,M:Math.max(h.t,Math.min(h.t+h.h,g.y+(n.h>>1))-n.h)}[e.charAt(0)];g=Math.max(h.l,r);p=Math.max(h.t,q);r=Math.min(h.l+h.w,
r+n.w)-g;q=Math.min(h.t+h.h,q+n.h)-p;l+=n.w-r+(n.h-q);if(null==k||l<k.overflow)k={corner:e,aroundCorner:a.aroundCorner,x:g,y:p,w:r,h:q,overflow:l,spaceAvailable:m};return!l});k.overflow&&c&&c(d,k.aroundCorner,k.corner,k.spaceAvailable,f);a=k.y;var l=k.x,r=g.body(d.ownerDocument);/relative|absolute/.test(m.get(r,"position"))&&(a-=m.get(r,"marginTop"),l-=m.get(r,"marginLeft"));r=d.style;r.top=a+"px";r.left=l+"px";r.right="auto";return k}var h={TL:"BR",TR:"BL",BL:"TR",BR:"TL"};return f.place={at:function(b,
a,c,e,f){c=n.map(c,function(b){var c={corner:b,aroundCorner:h[b],pos:{x:a.x,y:a.y}};e&&(c.pos.x+="L"==b.charAt(1)?e.x:-e.x,c.pos.y+="T"==b.charAt(0)?e.y:-e.y);return c});return l(b,c,f)},around:function(d,a,c,e,f){function g(a,b){F.push({aroundCorner:a,corner:b,pos:{x:{L:y,R:y+B,M:y+(B>>1)}[a.charAt(1)],y:{T:A,B:A+C,M:A+(C>>1)}[a.charAt(0)]}})}var h;if("string"==typeof a||"offsetWidth"in a||"ownerSVGElement"in a){if(h=b.position(a,!0),/^(above|below)/.test(c[0])){var p=b.getBorderExtents(a),q=a.firstChild?
b.getBorderExtents(a.firstChild):{t:0,l:0,b:0,r:0},w=b.getBorderExtents(d),v=d.firstChild?b.getBorderExtents(d.firstChild):{t:0,l:0,b:0,r:0};h.y+=Math.min(p.t+q.t,w.t+v.t);h.h-=Math.min(p.t+q.t,w.t+v.t)+Math.min(p.b+q.b,w.b+v.b)}}else h=a;if(a.parentNode)for(p="absolute"==m.getComputedStyle(a).position,a=a.parentNode;a&&1==a.nodeType&&"BODY"!=a.nodeName;){q=b.position(a,!0);w=m.getComputedStyle(a);/relative|absolute/.test(w.position)&&(p=!1);if(!p&&/hidden|auto|scroll/.test(w.overflow)){var v=Math.min(h.y+
h.h,q.y+q.h),z=Math.min(h.x+h.w,q.x+q.w);h.x=Math.max(h.x,q.x);h.y=Math.max(h.y,q.y);h.h=v-h.y;h.w=z-h.x}"absolute"==w.position&&(p=!0);a=a.parentNode}var y=h.x,A=h.y,B="w"in h?h.w:h.w=h.width,C="h"in h?h.h:(k.deprecated("place.around: dijit/place.__Rectangle: { x:"+y+", y:"+A+", height:"+h.height+", width:"+B+" } has been deprecated.  Please use { x:"+y+", y:"+A+", h:"+h.height+", w:"+B+" }","","2.0"),h.h=h.height),F=[];n.forEach(c,function(a){var b=e;switch(a){case "above-centered":g("TM","BM");
break;case "below-centered":g("BM","TM");break;case "after-centered":b=!b;case "before-centered":g(b?"ML":"MR",b?"MR":"ML");break;case "after":b=!b;case "before":g(b?"TL":"TR",b?"TR":"TL");g(b?"BL":"BR",b?"BR":"BL");break;case "below-alt":b=!b;case "below":g(b?"BL":"BR",b?"TL":"TR");g(b?"BR":"BL",b?"TR":"TL");break;case "above-alt":b=!b;case "above":g(b?"TL":"TR",b?"BL":"BR");g(b?"TR":"TL",b?"BR":"BL");break;default:g(a.aroundCorner,a.corner)}});d=l(d,F,f,{w:B,h:C});d.aroundNodePos=h;return d}}})},
"dijit/BackgroundIframe":function(){define("require ./main dojo/_base/config dojo/dom-construct dojo/dom-style dojo/_base/lang dojo/on dojo/sniff".split(" "),function(n,b,m,k,g,e,f,l){l.add("config-bgIframe",(l("ie")||0)&&!/IEMobile\/10\.0/.test(navigator.userAgent));var h=new function(){var b=[];this.pop=function(){var a;b.length?(a=b.pop(),a.style.display=""):(9>l("ie")?(a=m.dojoBlankHtmlUrl||n.toUrl("dojo/resources/blank.html")||'javascript:""',a=document.createElement("\x3ciframe src\x3d'"+a+
"' role\x3d'presentation' style\x3d'position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity\x3d\"0\");'\x3e")):(a=k.create("iframe"),a.src='javascript:""',a.className="dijitBackgroundIframe",a.setAttribute("role","presentation"),g.set(a,"opacity",.1)),a.tabIndex=-1);return a};this.push=function(a){a.style.display="none";b.push(a)}};b.BackgroundIframe=function(b){if(!b.id)throw Error("no id");if(l("config-bgIframe")){var a=this.iframe=h.pop();b.appendChild(a);7>l("ie")?(this.resize(b),
this._conn=f(b,"resize",e.hitch(this,"resize",b))):g.set(a,{width:"100%",height:"100%"})}};e.extend(b.BackgroundIframe,{resize:function(b){this.iframe&&g.set(this.iframe,{width:b.offsetWidth+"px",height:b.offsetHeight+"px"})},destroy:function(){this._conn&&(this._conn.remove(),this._conn=null);this.iframe&&(this.iframe.parentNode.removeChild(this.iframe),h.push(this.iframe),delete this.iframe)}});return b.BackgroundIframe})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys",
"dojo/text!./templates/Menu.html","./_MenuBase"],function(n,b,m,k){return n("dijit.DropDownMenu",k,{templateString:m,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(b){this._moveToPopup(b);b.stopPropagation();b.preventDefault()},_onLeftArrow:function(b){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else b.stopPropagation(),b.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t){return b("dijit._MenuBase",[c,t,p,q],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){g.toggle(this.domNode,"dijitMenuActive",a);g.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(b){var c=a.byNode(b);return b.parentNode==this.containerNode&&c&&c.focus},postCreate:function(){var b=this,c="string"==typeof this.childSelector?this.childSelector:e.hitch(this,"childSelector");this.own(l(this.containerNode,l.selector(c,f.enter),function(){b.onItemHover(a.byNode(this))}),l(this.containerNode,l.selector(c,f.leave),function(){b.onItemUnhover(a.byNode(this))}),l(this.containerNode,l.selector(c,d),function(c){b.onItemClick(a.byNode(this),c);c.stopPropagation()}),
l(this.containerNode,l.selector(c,"focusin"),function(){b._onItemFocus(a.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,b,c,d){this.inherited(arguments);if(a&&(-1==d||a.popup&&1==d))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;a.popup?(this.set("selected",a),this.set("activated",!0),b=/^key/.test(b._origType||
b.type)||0==b.clientX&&0==b.clientY,this._openItemPopup(a,b)):(this.onExecute(),a._onClick?a._onClick(b):a.onClick(b))},_openItemPopup:function(a,b){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var c=a.popup;c.parentMenu=this;this.own(this._mouseoverHandle=l.once(c.domNode,"mouseover",e.hitch(this,"_onPopupHover")));var d=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){b&&
d.focusChild(a);d._cleanUp()},onExecute:e.hitch(this,"_cleanUp",!0),onClose:function(){d._mouseoverHandle&&(d._mouseoverHandle.remove(),delete d._mouseoverHandle)}},b);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(k.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_CssStateMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-class dojo/has dojo/_base/lang dojo/on dojo/domReady dojo/touch dojo/_base/window ./a11yclick ./registry".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){b=b("dijit._CssStateMixin",[],{hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);n.forEach("disabled readOnly checked selected focused state hovering active _opened".split(" "),function(a){this.watch(a,e.hitch(this,"_setStateClass"))},this);for(var a in this.cssStateNodes||{})this._trackMouseState(this[a],this.cssStateNodes[a]);this._trackMouseState(this.domNode,this.baseClass);this._setStateClass()},_cssMouseEvent:function(a){if(!this.disabled)switch(a.type){case "mouseover":case "MSPointerOver":case "pointerover":this._set("hovering",
!0);this._set("active",this._mouseDown);break;case "mouseout":case "MSPointerOut":case "pointerout":this._set("hovering",!1);this._set("active",!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":this._set("active",!0);break;case "mouseup":case "dojotouchend":case "MSPointerUp":case "pointerup":case "keyup":this._set("active",!1)}},_setStateClass:function(){function a(a){b=b.concat(n.map(b,function(b){return b+a}),"dijit"+a)}var b=this.baseClass.split(" ");
this.isLeftToRight()||a("Rtl");var c="mixed"==this.checked?"Mixed":this.checked?"Checked":"";this.checked&&a(c);this.state&&a(this.state);this.selected&&a("Selected");this._opened&&a("Opened");this.disabled?a("Disabled"):this.readOnly?a("ReadOnly"):this.active?a("Active"):this.hovering&&a("Hover");this.focused&&a("Focused");var c=this.stateNode||this.domNode,d={};n.forEach(c.className.split(" "),function(a){d[a]=!0});"_stateClasses"in this&&n.forEach(this._stateClasses,function(a){delete d[a]});n.forEach(b,
function(a){d[a]=!0});var e=[],f;for(f in d)e.push(f);c.className=e.join(" ");this._stateClasses=b},_subnodeCssMouseEvent:function(a,b,c){function d(c){k.toggle(a,b+"Active",c)}if(!this.disabled&&!this.readOnly)switch(c.type){case "mouseover":case "MSPointerOver":case "pointerover":k.toggle(a,b+"Hover",!0);break;case "mouseout":case "MSPointerOut":case "pointerout":k.toggle(a,b+"Hover",!1);d(!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":d(!0);
break;case "mouseup":case "MSPointerUp":case "pointerup":case "dojotouchend":case "keyup":d(!1);break;case "focus":case "focusin":k.toggle(a,b+"Focused",!0);break;case "blur":case "focusout":k.toggle(a,b+"Focused",!1)}},_trackMouseState:function(a,b){a._cssState=b}});l(function(){function b(a,b,d){if(!d||!m.isDescendant(d,b))for(;b&&b!=d;b=b.parentNode)if(b._cssState){var e=c.getEnclosingWidget(b);e&&(b==e.domNode?e._cssMouseEvent(a):e._subnodeCssMouseEvent(b,b._cssState,a))}}var e=d.body(),g;f(e,
h.over,function(a){b(a,a.target,a.relatedTarget)});f(e,h.out,function(a){b(a,a.target,a.relatedTarget)});f(e,a.press,function(a){g=a.target;b(a,g)});f(e,a.release,function(a){b(a,g);g=null});f(e,"focusin, focusout",function(a){var b=a.target;if(b._cssState&&!b.getAttribute("widgetId")){var d=c.getEnclosingWidget(b);d&&d._subnodeCssMouseEvent(b,b._cssState,a)}})});return b})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(n,b,m,k,g,e,f,l,h,d){return b("dijit._KeyNavContainer",[h,d,l],{connectKeyNavHandlers:function(a,b){var c=this._keyNavCodes={},d=e.hitch(this,"focusPrev"),f=e.hitch(this,"focusNext");n.forEach(a,function(a){c[a]=d});n.forEach(b,function(a){c[a]=f});c[g.HOME]=e.hitch(this,"focusFirstChild");c[g.END]=e.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){k.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);n.forEach(this.getChildren(),
e.hitch(this,"_startupChild"))},addChild:function(a,b){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=
f.byNode(a))&&a.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(n,b,m,k,g,e,f,l){return b("dijit._KeyNavMixin",l,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);m.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var b=this._keyNavCodes={};b[k.HOME]=g.hitch(this,"focusFirstChild");b[k.END]=g.hitch(this,
"focusLastChild");b[this.isLeftToRight()?k.LEFT_ARROW:k.RIGHT_ARROW]=g.hitch(this,"_onLeftArrow");b[this.isLeftToRight()?k.RIGHT_ARROW:k.LEFT_ARROW]=g.hitch(this,"_onRightArrow");b[k.UP_ARROW]=g.hitch(this,"_onUpArrow");b[k.DOWN_ARROW]=g.hitch(this,"_onDownArrow")}var d=this,b="string"==typeof this.childSelector?this.childSelector:g.hitch(this,"childSelector");this.own(e(this.domNode,"keypress",g.hitch(this,"_onContainerKeypress")),e(this.domNode,"keydown",g.hitch(this,"_onContainerKeydown")),e(this.domNode,
"focus",g.hitch(this,"_onContainerFocus")),e(this.containerNode,e.selector(b,"focusin"),function(a){d._onChildFocus(f.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(b,d){b&&(this.focusedChild&&b!==this.focusedChild&&this._onChildBlur(this.focusedChild),b.set("tabIndex",this.tabIndex),b.focus(d?"end":"start"))},_onContainerFocus:function(b){b.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){m.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(b){m.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(b){b&&b!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),b.set("tabIndex",this.tabIndex),this.lastFocused=b,this._set("focusedChild",b))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(b,d,a,c){b&&this.focusChild(b)},_keyboardSearchCompare:function(b,d){var a=b.domNode;b=(b.label||(a.focusNode?
a.focusNode.label:"")||a.innerText||a.textContent||"").replace(/^\s+/,"").substr(0,d.length).toLowerCase();return d.length&&b==d?-1:0},_isFormElement:function(b){return"INPUT"===b.tagName||"TEXTAREA"===b.tagName||"SELECT"===b.tagName||"BUTTON"===b.tagName},_onContainerKeydown:function(b){if(!this._isFormElement(document.activeElement)){var d=this._keyNavCodes[b.keyCode];d?(d(b,this.focusedChild),b.stopPropagation(),b.preventDefault(),this._searchString=""):b.keyCode!=k.SPACE||!this._searchTimer||
b.ctrlKey||b.altKey||b.metaKey||(b.stopImmediatePropagation(),b.preventDefault(),this._keyboardSearch(b," "))}},_onContainerKeypress:function(b){this._isFormElement(document.activeElement)||b.charCode<=k.SPACE||b.ctrlKey||b.altKey||b.metaKey||(b.preventDefault(),b.stopPropagation(),this._keyboardSearch(b,String.fromCharCode(b.charCode).toLowerCase()))},_keyboardSearch:function(b,d){var a=null,c,e=0;g.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=d;var b=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;c=this._searchString.substr(0,b);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var f=this.focusedChild||null;if(1==b||!f)if(f=this._getNextFocusableChild(f,1),!f)return;b=f;do{var g=this._keyboardSearchCompare(f,c);g&&0==e++&&(a=f);if(-1==g){e=-1;break}f=this._getNextFocusableChild(f,1)}while(f&&f!=b)})();this.onKeyboardSearch(a,b,c,e)},_onChildBlur:function(){},_getNextFocusableChild:function(b,d){var a=
b;do{if(b)b=this._getNext(b,d);else if(b=this[0<d?"_getFirst":"_getLast"](),!b)break;if(null!=b&&b!=a&&b.isFocusable())return b}while(b!=a);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(b,d){if(b)for(b=b.domNode;b;)if((b=b[0>d?"previousSibling":"nextSibling"])&&"getAttribute"in b){var a=f.byNode(b);if(a)return a}return null}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],
function(n,b,m){return n([b,m],{})})},"dgrid/Grid":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/has ./List ./util/misc dojo/_base/sniff".split(" "),function(n,b,m,k,g,e,f,l){function h(b,a){a&&a.nodeType&&b.appendChild(a)}n=n(f,{columns:null,hasNeutralSort:!1,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(b){return"object"!==typeof b?this.columns[b]:this.cell(b).column},listType:"grid",cell:function(b,a){if(b.column&&b.element)return b;
b.target&&b.target.nodeType&&(b=b.target);var c;if(b.nodeType){do{if(this._rowIdToObject[b.id])break;var d=b.columnId;if(d){a=d;c=b;break}b=b.parentNode}while(b&&b!==this.domNode)}if(!c&&"undefined"!==typeof a){var e=this.row(b);if(d=e&&e.element)for(var d=d.getElementsByTagName("td"),f=0;f<d.length;f++)if(d[f].columnId===a){c=d[f];break}}if(null!=b)return{row:e||this.row(b),column:a&&this.column(a),element:c}},createRowCells:function(b,a,c,f,g){var d=m.create("table",{className:"dgrid-row-table",
role:"presentation"}),h=9>e("ie")?m.create("tbody",null,d):d,k,n,p,q,z,y,A,B,C,F;c=c||this.subRows;n=0;for(p=c.length;n<p;n++)for(y=c[n],k=m.create("tr",null,h),y.className&&(k.className=y.className),q=0,z=y.length;q<z;q++){A=y[q];B=A.id;C=A.field?" field-"+l.escapeCssIdentifier(A.field,"-"):"";(F="function"===typeof A.className?A.className(f):A.className)&&(C+=" "+F);C=m.create(b,{className:"dgrid-cell"+(B?" dgrid-column-"+l.escapeCssIdentifier(B,"-"):"")+C,role:"th"===b?"columnheader":"gridcell"});
C.columnId=B;if(B=A.colSpan)C.colSpan=B;if(B=A.rowSpan)C.rowSpan=B;a(C,A,f,g);k.appendChild(C)}return d},_createBodyRowCell:function(b,a,c,e){var d=c;a.get?d=a.get(c):"field"in a&&"_item"!==a.field&&(d=c[a.field]);a.renderCell?h(b,a.renderCell(c,d,b,e)):this._defaultRenderCell.call(a,c,d,b,e)},_createHeaderRowCell:function(b,a){var c=a.headerNode=b,d=a.field;d&&(b.field=d);a.renderHeaderCell?h(c,a.renderHeaderCell(c)):("label"in a||a.field)&&c.appendChild(document.createTextNode("label"in a?a.label:
a.field));!1!==a.sortable&&d&&"_item"!==d&&(b.sortable=!0,b.className+=" dgrid-sortable")},left:function(b,a){b.element||(b=this.cell(b));return this.cell(this._move(b,-(a||1),"dgrid-cell"))},right:function(b,a){b.element||(b=this.cell(b));return this.cell(this._move(b,a||1,"dgrid-cell"))},_defaultRenderCell:function(b,a,c){if(this.formatter){var d=this.formatter,e=this.grid.formatterScope;c.innerHTML="string"===typeof d&&e?e[d](a,b):this.formatter(a,b)}else null!=a&&c.appendChild(document.createTextNode(a))},
renderRow:function(d,a){d=this.createRowCells("td",b.hitch(this,"_createBodyRowCell"),a&&a.subRows,d,a);a=m.create("div",{role:"row"});a.appendChild(d);return a},renderHeader:function(){var d=this,a=this.headerNode;a.setAttribute("role","row");m.empty(a);var c=this.createRowCells("th",b.hitch(this,"_createHeaderRowCell"),this.subRows&&this.subRows.headerRows);this._rowIdToObject[c.id=this.id+"-header"]=this.columns;a.appendChild(c);this._sortListener&&this._sortListener.remove();this._sortListener=
g(c,"click,keydown",function(b){if("click"===b.type||32===b.keyCode||!e("opera")&&13===b.keyCode){var c=b.target,f,h;do if(c.sortable){f=c.field||c.columnId;h=d.sort[0];f=d.hasNeutralSort&&h&&h.property===f&&h.descending?[]:[{property:f,descending:h&&h.property===f&&!h.descending}];h={bubbles:!0,cancelable:!0,grid:d,parentType:b.type,sort:f};g.emit(b.target,"dgrid-sort",h)&&(d._sortNode=c,d.set("sort",f));break}while((c=c.parentNode)&&c!==a)}})},resize:function(){var b=this.headerNode.firstChild,
a=this.contentNode,c;this.inherited(arguments);a.style.width="";a&&b&&(c=b.offsetWidth)>a.offsetWidth&&(a.style.width=c+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(){this.inherited(arguments);this.updateSortArrow(this.sort)},_findSortArrowParent:function(b){var a=this.columns,c;for(c in a){var d=a[c];if(d.field===b)return d.headerNode}},updateSortArrow:function(b,a){this._lastSortedArrow&&(k.remove(this._lastSortedArrow.parentNode,
"dgrid-sort-up dgrid-sort-down"),m.destroy(this._lastSortedArrow),delete this._lastSortedArrow);a&&(this.sort=b);b[0]&&(a=b[0].property,b=b[0].descending,a=this._sortNode||this._findSortArrowParent(a),delete this._sortNode,a&&(a=a.contents||a,this._lastSortedArrow=m.create("div",{className:"dgrid-sort-arrow ui-icon",innerHTML:"\x26nbsp;",role:"presentation"},a,"first"),k.add(a,"dgrid-sort-"+(b?"down":"up")),this.resize()))},styleColumn:function(b,a){return this.addCssRule("#"+l.escapeCssIdentifier(this.domNode.id)+
" .dgrid-column-"+l.escapeCssIdentifier(b,"-"),a)},_configColumns:function(b,a){var c=[],d=a instanceof Array;l.each(a,function(e,f){"string"===typeof e&&(a[f]=e={label:e});d||e.field||(e.field=f);f=e.id=e.id||(isNaN(f)?f:b+f);this._configColumn&&(this._configColumn(e,a,b),f=e.id);d&&(this.columns[f]=e);e.grid=this;c.push(e)},this);return d?a:c},_destroyColumns:function(){this.cleanup()},configStructure:function(){var b=this.subRows,a=this._columns=this.columns;this.columns=!a||a instanceof Array?
{}:a;if(b)for(a=0;a<b.length;a++)b[a]=this._configColumns(a+"-",b[a]);else this.subRows=[this._configColumns("",a)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(b){this._destroyColumns();this.subRows=null;this.columns=b;this._updateColumns()},_setSubRows:function(b){this._destroyColumns();this.subRows=b;this._updateColumns()},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);
this._started&&(this.sort.length?(this._lastSortedArrow=null,this.updateSortArrow(this.sort)):this.resize())}});n.appendIfNode=h;return n})},"dgrid/List":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/has ./util/misc dojo/_base/sniff".split(" "),function(n,b,m,k,g,e,f){function l(a,b){a.className="dgrid-scrollbar-measure";document.body.appendChild(a);b=a["offset"+b]-a["client"+b];a.className="";a.parentNode&&document.body.removeChild(a);return b}
function h(a){k.replace(this.domNode,a,this._class||"");this._class=a}function d(){return this._class}var a=[];a.push("has-mozilla");e("touch")&&a.push("has-touch");k.add(document.documentElement,a);e.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});var c,q;e.add("dom-scrollbar-width",function(a,b,c){return l(c,"Width")});e.add("dom-scrollbar-height",function(a,b,c){return l(c,"Height")});e.add("dom-rtl-scrollbar-left",function(a,b,c){a=document.createElement("div");
c.className="dgrid-scrollbar-measure";c.setAttribute("dir","rtl");c.appendChild(a);document.body.appendChild(c);b=!!e("ie")||!1||/\bEdge\//.test(navigator.userAgent)||a.offsetLeft>=e("dom-scrollbar-width");c.className="";c.parentNode&&document.body.removeChild(c);m.destroy(a);c.removeAttribute("dir");return b});var p=0,t=function(){this._started&&this.resize()},u=n(null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,addUiClasses:!0,highlightDuration:250,resizeThrottleDelay:f.defaultDelay,
resizeThrottleMethod:"throttleDelayed",postscript:function(a,b){var c=this;(this._Row=function(a,b,c){this.id=a;this.data=b;this.element=c}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,b){b=this.domNode=b||document.createElement("div");var c;a&&(this.params=a,n.safeMixin(this,a),c=a["class"]||a.className||b.className);this.sort=this.sort||[];this._listeners=[];this._rowIdToObject=
{};this.postMixInProperties&&this.postMixInProperties();this.id=b.id=b.id||this.id||u.autoIdPrefix+p++;this.buildRendering();c&&h.call(this,c);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var a=this.domNode,c=this.addUiClasses,d=this,h,l,n;n=this.isRTL="rtl"===(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();a.className="";a.setAttribute("role","grid");k.add(a,"dgrid dgrid-"+this.listType+
(c?" ui-widget":""));h=this.headerNode=m.create("div",{className:"dgrid-header dgrid-header-row"+(c?" ui-widget-header":"")+(this.showHeader?"":" dgrid-header-hidden")},a);l=this.bodyNode=m.create("div",{className:"dgrid-scroller"},a);l.tabIndex=-1;this.headerScrollNode=m.create("div",{className:"dgrid-header dgrid-header-scroll dgrid-scrollbar-width"+(c?" ui-widget-header":"")},a);this.footerNode=m.create("div",{className:"dgrid-footer"+(this.showFooter?"":" dgrid-footer-hidden")},a);n&&(a.className+=
" dgrid-rtl"+(e("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));g(l,"scroll",function(b){d.showHeader&&(h.scrollLeft=b.scrollLeft||l.scrollLeft);b.stopPropagation();g.emit(a,"scroll",{scrollTarget:l})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=m.create("div",{className:"dgrid-content"+(c?" ui-widget-content":"")},this.bodyNode);"string"===typeof this.resizeThrottleMethod&&f[this.resizeThrottleMethod]?c=f[this.resizeThrottleMethod](t,this,this.resizeThrottleDelay):
"function"===typeof this.resizeThrottleMethod?c=this.resizeThrottleMethod(b.hitch(this,t),this.resizeThrottleDelay):(console.warn("Invalid value specified for resizeThrottleMethod:  "+this.resizeThrottleMethod),c=f.throttleDelayed(t,this,this.resizeThrottleDelay));this._resizeHandle=g(window,"resize",c);this._listeners.push(this._resizeHandle)},postCreate:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this.sort))},configStructure:function(){},
resize:function(){var a=this.bodyNode,b=this.footerNode,b=this.showFooter?b.offsetHeight:0;this.headerScrollNode.style.height=a.style.marginTop=this.headerNode.offsetHeight+"px";a.style.marginBottom=b+"px";c||(c=e("dom-scrollbar-width"),q=e("dom-scrollbar-height"),e("ie")&&(c++,q++),f.addCssRule(".dgrid-scrollbar-width","width: "+c+"px"),f.addCssRule(".dgrid-scrollbar-height","height: "+q+"px"),17!==c&&(f.addCssRule(".dgrid-header-row","right: "+c+"px"),f.addCssRule(".dgrid-rtl-swap .dgrid-header-row",
"left: "+c+"px")))},addCssRule:function(a,b){a=f.addCssRule(a,b);this.cleanAddedRules&&this._listeners.push(a);return a},on:function(a,b){return g(this.domNode,a,b)},cleanup:function(){for(var a in this._rowIdToObject)if(this._rowIdToObject[a]!==this.columns){var b=document.getElementById(a);b&&this.removeRow(b,!0)}},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();this._listeners=null}this._started=!1;this.cleanup();m.destroy(this.domNode)},
refresh:function(){this.cleanup();this._rowIdToObject={};this._autoRowId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},highlightRow:function(a,b){var c="dgrid-highlight"+(this.addUiClasses?" ui-state-highlight":"");a=a.element||a;k.add(a,c);setTimeout(function(){k.remove(a,c)},b||this.highlightDuration)},adjustRowIndices:function(a){var b=a.rowIndex;if(-1<b){do-1<a.rowIndex&&(this.maintainOddEven&&k.contains(a,"dgrid-row")&&k.replace(a,1===b%2?"dgrid-row-odd":"dgrid-row-even",0===b%2?
"dgrid-row-odd":"dgrid-row-even"),a.rowIndex=b++);while((a=a.nextSibling)&&a.rowIndex!==b)}},renderArray:function(a,b,c){c=c||{};var d=c.start||0,e=document.createDocumentFragment(),f=[],g=0,h=a.length;b||(this._lastCollection=a);for(;g<h;)f[g]=this.insertRow(a[g],e,null,d++,c),g++;(a=b?b.parentNode:this.contentNode)&&a.parentNode&&(a!==this.contentNode||h)&&(a.insertBefore(e,b||null),h&&this.adjustRowIndices(f[h-1]));return f},renderHeader:function(){},_autoRowId:0,insertRow:function(a,b,c,d,e){var f=
this.id+"-row-"+(this.collection&&this.collection.getIdentity?this.collection.getIdentity(a):this._autoRowId++),g=document.getElementById(f),h=g&&g.previousSibling;g&&(g===c&&(c=(c.connected||c).nextSibling),this.removeRow(g,!1,e));g=this.renderRow(a,e);g.className=(g.className||"")+" dgrid-row "+(1===d%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[g.id=f]=a;b.insertBefore(g,c||null);g.rowIndex=d;h&&h.rowIndex!==g.rowIndex-1&&this.adjustRowIndices(h);
return g},renderRow:function(a){var b=document.createElement("div");b.appendChild(document.createTextNode(a));return b},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||m.destroy(a)},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!==this.domNode)}else return"object"===typeof a?b=this.collection.getIdentity(a):
(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var e,f;f=e=a.element;b=b||1;do if(a=e[0>b?"previousSibling":"nextSibling"]){do if((e=a)&&-1<(e.className+" ").indexOf(c+" ")){f=e;b+=0>b?1:-1;break}while(a=(!d||!e.hidden)&&e[0>b?"lastChild":"firstChild"])}else if(e=e.parentNode,!e||e===this.bodyNode||e===this.headerNode)break;while(b);return f},up:function(a,b,c){a.element||
(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:function(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&(this.bodyNode.scrollTop=a.y)},getScrollPosition:function(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}},get:function(a){var b="_get"+a.charAt(0).toUpperCase()+a.slice(1);return"function"===typeof this[b]?this[b].apply(this,
[].slice.call(arguments,1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:d,_setClass:h,_getClassName:d,_setClassName:h,_setSort:function(a,b){this.sort="string"!==typeof a?a:[{property:a,descending:b}];this._applySort()},_applySort:function(){this.refresh();if(this._lastCollection){var a=this.sort;if(a&&
0<a.length){var b=a[0].property,c=!!a[0].descending;this._lastCollection.sort(function(a,d){a=a[b];d=d[b];void 0===a&&(a="");void 0===d&&(d="");return a===d?0:a>d!==c?1:-1})}this.renderArray(this._lastCollection)}},_setShowHeader:function(a){var b=this.headerNode;this.showHeader=a;k.toggle(b,"dgrid-header-hidden",!a);this.renderHeader();this.resize();a&&(b.scrollLeft=this.getScrollPosition().x)},_setShowFooter:function(a){this.showFooter=a;k.toggle(this.footerNode,"dgrid-footer-hidden",!a);this.resize()}});
u.autoIdPrefix="dgrid_";return u})},"dgrid/util/misc":function(){define(["dojo/has"],function(n){var b=[],m,k,g,e=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,f=setTimeout,l=clearTimeout;n.add("requestidlecallback",function(b){return"function"===typeof b.requestIdleCallback});var h={defaultDelay:15,throttle:function(b,a,c){var d=!1;c=c||h.defaultDelay;return function(){d||(d=!0,b.apply(a,arguments),f(function(){d=!1},c))}},throttleDelayed:function(b,a,c){var d=!1;c=c||h.defaultDelay;return function(){if(!d){d=
!0;var e=arguments;f(function(){d=!1;b.apply(a,e)},c)}}},debounce:function(b,a,c){var d;c=c||h.defaultDelay;return function(){d&&(l(d),d=null);var e=arguments;d=f(function(){d=null;b.apply(a,e)},c)}},each:function(b,a,c){var d,e;if(b)if("number"===typeof b.length)for(d=0,e=b.length;d<e;d++)a.call(c,b[d],d,b);else for(d in b)a.call(c,b[d],d,b)},addCssRule:function(d,a){m||(m=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(m),m=m.sheet||m.styleSheet,k=m.deleteRule?
"deleteRule":"removeRule",g=m.cssRules?"cssRules":"rules");var c=b.length;b[c]=(m.cssRules||m.rules).length;m.addRule?m.addRule(d,a):m.insertRule(d+"{"+a+"}",b[c]);return{get:function(a){return m[g][b[c]].style[a]},set:function(a,d){"undefined"!==typeof b[c]&&(m[g][b[c]].style[a]=d)},remove:function(){var a=b[c],d,e;if(void 0!==a)for(m[k](a),b[c]=void 0,d=c+1,e=b.length;d<e;d++)b[d]>a&&b[d]--}}},escapeCssIdentifier:function(b,a){return"string"===typeof b?b.replace(e,a||"\\$1"):b}};return h})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/on dojo/when dojo/query ./util/misc".split(" "),
function(n,b,m,k,g,e,f,l,h){function d(a){return a&&(0<=a.className.indexOf("dgrid-row")||0<=a.className.indexOf("dgrid-loading"))}function a(a){return a&&0<=a.className.indexOf("dgrid-preload")}var c=0;return m([n,b],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:h.defaultDelay,keepScrollPosition:!1,rowHeight:0,_deleteQueue:[],postCreate:function(){this.inherited(arguments);var a=this;e(this.bodyNode,
"scroll",h[this.pagingMethod](function(b){a._processScroll(b)},null,this.pagingDelay))},renderQuery:function(a,b){var d=this,e=b&&b.container||this.contentNode,h,l,m,n,p=0,q=b&&b.start||0;"level"in a&&(p=n=a.level);h={query:a,count:0,level:p,top:!1};var A={node:g.create("div",{className:"dgrid-preload",style:{height:"0"}},e),count:0,query:a,next:h,level:p,top:!0};l=A.node;l.rowIndex=0;h.previous=A;m=h.node=g.create("div",{className:"dgrid-preload",style:{height:"0"}},e);A.id=c++;l.setAttribute("data-preloadid",
A.id);h.id=c++;m.setAttribute("data-preloadid",h.id);m.rowIndex=this.minRowsPerPage;d._insertPreload(A);var B=g.create("div",{className:"dgrid-loading"},m,"before");g.create("div",{className:"dgrid-below"},B).innerHTML=this.loadingMessage;b=k.mixin({start:0,count:this.minRowsPerPage},b);null!=n&&(b.queryLevel=n);return this._trackError(function(){var c=a(b);return d.renderQueryResults(c,m,b).then(function(a){return c.totalLength.then(function(c){var e=a.length,k=m.parentNode;!d._rows||"queryLevel"in
b||(d._rows.min=0,d._rows.max=e===c?Infinity:e-1);g.destroy(B);"queryLevel"in b||(d._total=c);0===c&&k&&(d.noDataNode&&g.destroy(d.noDataNode),d._insertNoDataNode(k));A.count=q;h.count=c-e-q;m.rowIndex=q+e;c?d._updatePreloadRowHeights(A):(m.style.display="none",l.style.display="none");d._previousScrollPosition&&k.offsetHeight&&(d.scrollTo(d._previousScrollPosition),delete d._previousScrollPosition);return f(d._processScroll()).then(function(){return a})})}).otherwise(function(a){g.destroy(B);throw a;
})})},_insertPreload:function(a){var b=this.preload;if(b){for(;b.node.compareDocumentPosition(a.node)&Node.DOCUMENT_POSITION_PRECEDING;)if(b=b.previous,null==b)return;for(;b.node.compareDocumentPosition(a.node)&Node.DOCUMENT_POSITION_FOLLOWING&&b.next;)b=b.next;b.previous.next=a;a.previous=b.previous;a=a.next;a.next=b;b.previous=a}else this.preload=a},refresh:function(a){var b=this,c=a&&a.keepScrollPosition;"undefined"===typeof c&&(c=this.keepScrollPosition);c&&(this._previousScrollPosition=this.getScrollPosition());
this.inherited(arguments);if(this._renderedCollection)return this.renderQuery(function(a){return b._renderedCollection.fetchRange({start:a.start,end:a.start+a.count})}).then(function(){b._emitRefreshComplete()})},resize:function(){this.inherited(arguments);this._processScroll()},cleanup:function(){this.inherited(arguments);this.preload=null},renderQueryResults:function(a){var b=this.inherited(arguments),c=this._getRenderedCollection(this.preload);c&&c.releaseRange&&b.then(function(b){b[0]&&!b[0].parentNode.tagName&&
a.totalLength.then(function(){c.releaseRange(b[0].rowIndex,b[b.length-1].rowIndex+1)})});return b},_getFirstRowSibling:function(a){return a.lastChild},_calcRowHeight:function(a){var b=a.nextSibling;return b&&!/\bdgrid-preload\b/.test(b.className)?b.offsetTop-a.offsetTop:a.offsetHeight},_calcAverageRowHeight:function(a){for(var b=a.length,c=0,d=0;d<b;d++)c+=this._calcRowHeight(a[d]);return b&&c?c/b:0},_updatePreloadRowHeights:function(){var a=this.preload;if(a){for(;a.previous;)a=a.previous;for(;a;)a.rowHeight||
(a.rowHeight=this.rowHeight||this._calcAverageRowHeight(a.node.parentNode.querySelectorAll(".dgrid-row")),this._adjustPreloadHeight(a)),a=a.next}},lastScrollTop:0,_processScroll:function(b){function c(a,b){b=b?"next":"previous";for(var c;c=a[b];)a=c;return a}function e(b,e){function f(){var c;a:{c=!e;for(var d=b;d=d[e?"previous":"next"];)if(c===d.top){c=d;break a}c=void 0}if(c&&k!==c&&!a(c.top?c.node.nextSibling:c.node.previousSibling))return h(),b=c,r=b.node,m=e?b.node.offsetTop-q:n-(b.node.offsetTop+
b.node.offsetHeight),x=(c=g(r))&&c.rowIndex,w=void 0,c}function g(b){var c=a(b);(b=b[t])&&!d(b)&&(b=c&&a(b)?null:(c=f())?c:g(b));return b}function h(){b.count+=u;e&&(r.rowIndex-=u);l._adjustPreloadHeight(b);u=0;l._releaseRange(b,e,x,w)}var k=b;b=c(b,e);var m=e?b.node.offsetTop-q:n-(b.node.offsetTop+b.node.offsetHeight),p=l.farOffRemoval,r=b.node,t=e?"previousSibling":"nextSibling",u=0,v=0,x,w;if(m>2*p){var y;x=(y=g(r))&&y.rowIndex;for(w=void 0;y&&k!==b;){var A=l._calcRowHeight(y);v+A+p>m||!d(y)?y=
f():(v+=A,u+=y.count||1,l._pruneRow(y,e),"rowIndex"in y&&(w=y.rowIndex),y=g(y))}h();l._deleteNodeQueue()}}function f(a,b){do a=b?a.next:a.previous;while(a&&!a.node.offsetWidth);return a}var h=this.preload,k;this._updatePreloadRowHeights();if(k=h&&h.rowHeight){var l=this,m=l.bodyNode,n=b&&b.scrollTop||this.getScrollPosition().y,q=m.offsetHeight+n,A;b=l.lastScrollTop;var m=l.bufferRows*k,B=m-k,C,F=!0;for(l.lastScrollTop=n;h&&!h.node.offsetWidth;)h=h.previous;for(;h&&h!==A;){A=l.preload;l.preload=h;
k=h.node;var E=k.offsetTop;if(q+1+B<E)h=f(h,F=!1);else if(n-1-B>E+k.offsetHeight)h=f(h,F=!0);else{var E=((k.top?n-m:q)-E)/h.rowHeight,G=(q-n+2*m)/h.rowHeight,G=G+Math.min(Math.abs(Math.max(Math.min((n-b)*h.rowHeight,l.maxRowsPerPage/2),l.maxRowsPerPage/-2)),10);k.top&&(E-=G);E=Math.max(E,0);10>E&&0<E&&G+E<l.maxRowsPerPage&&(G+=Math.max(0,E),E=0);G=Math.min(Math.max(G,l.minRowsPerPage),l.maxRowsPerPage,h.count);if(0===G)h=f(h,F);else{var G=Math.ceil(G),E=Math.min(Math.floor(E),h.count-G),H={};h.count-=
G;var D=k,I,L=l.queryRowsOverlap,O=!h.top&&h;O?(h.previous&&(e(h),0<E&&a(k.previousSibling)?(E=Math.min(h.count,E),h.previous.count+=E,l._adjustPreloadHeight(h.previous,!0),k.rowIndex+=E,L=0):G+=E,h.count-=E),H.start=k.rowIndex-L,H.count=Math.min(G+L,l.maxRowsPerPage),k.rowIndex=H.start+H.count):(h.next&&(D=k.nextSibling,e(h,!0),a(k.nextSibling)?(h.next.count+=h.count-E,h.next.node.rowIndex=E+G,l._adjustPreloadHeight(h.next),h.count=E,L=0,D=h.next.node):I=!0),H.start=h.count,H.count=Math.min(G+L,
l.maxRowsPerPage),H.scrollingUp=!0);I&&D&&D.offsetWidth&&(I=D.offsetTop);l._adjustPreloadHeight(h);"level"in h.query&&(H.queryLevel=h.query.level);if("queryLevel"in H||!(H.start>l._total||0>H.count)){var K=g.create("div",{className:"dgrid-loading",style:{height:G*h.rowHeight+"px"}},D,"before");g.create("div",{className:"dgrid-"+(O?"below":"above"),innerHTML:l.loadingMessage},K);K.count=G;l._trackError(function(){(function(a,b,c){var d=h.query(H);C=l.renderQueryResults(d,a,H).then(function(e){var f=
l._rows;!f||"queryLevel"in H||!e.length||(b?(f.max<=f.min&&(f.min=e[0].rowIndex),f.max=e[e.length-1].rowIndex):(f.max<=f.min&&(f.max=e[e.length-1].rowIndex),f.min=e[0].rowIndex));D=a.nextSibling;g.destroy(a);c&&D&&D.offsetWidth&&l.scrollTo({y:l.bodyNode.scrollTop+D.offsetTop-c});d.totalLength.then(function(a){"queryLevel"in H||(l._total=a,l._rows&&l._rows.max>=l._total-1&&(l._rows.max=Infinity));b&&(b.count=a-b.node.rowIndex,l._adjustPreloadHeight(b))});l._processScroll();return e},function(b){g.destroy(a);
throw b;})})(K,O,I)});h=h.previous}}}}return C}},_adjustPreloadHeight:function(a,b){a.node.style.height=this._calculatePreloadHeight(a,b)+"px"},_calculatePreloadHeight:function(a,b){return Math.min(a.count*a.rowHeight,b?Infinity:this.maxEmptySpace)},_pruneRow:function(a,b,c){this.removeRow(a,!0,c);this._queueNodeForDeletion(a)},_queueNodeForDeletion:function(a){this._deleteQueue.push(a)},_deleteNodeQueue:function(){for(var a=document.createElement("div"),b=this._deleteQueue,c=b.length;c--;)a.appendChild(b[c]);
this._deleteQueue=[];setTimeout(function(){g.destroy(a)},1)},_removePreloads:function(a){if(a&&a.length){var b=this,c=this._getHeadPreload();a.forEach(function(a){if(a=b._findPreload(a,c))a.previous&&(a.previous.next=a.next),a.next&&(a.next.previous=a.previous)})}},_getHeadPreload:function(){var a=this.preload;if(a)for(;a.previous;)a=a.previous;return a},_findPreload:function(a,b){for(b||(b=this._getHeadPreload());b;){if(b.node===a)return b;b=b.next}},_getRenderedCollection:function(){return this._renderedCollection},
_releaseRange:function(a,b,c,d){if(a){var e=a.level;a=this._getRenderedCollection(a);null!=d&&a.releaseRange&&"number"===typeof c&&"number"===typeof d&&(b?a.releaseRange(d,c+1):a.releaseRange(c,d+1),this._rows&&!e&&(this._rows[b?"max":"min"]=d,this._rows.max>=this._total-1&&(this._rows.max=Infinity)))}}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/aspect dojo/dom-construct dojo/has dojo/on dojo/when".split(" "),function(n,b,m,k,g,e,f,l){function h(b){if("object"!==
typeof b)b=Error(b);else if("cancel"===b.dojoType)return;f.emit(this.domNode,"dgrid-error",{grid:this,error:b,cancelable:!0,bubbles:!0})&&console.error(b)}return n(null,{collection:null,_renderedCollection:null,_rows:null,_observerHandle:null,shouldTrackCollection:!0,getBeforePut:!0,noDataMessage:"",loadingMessage:"",_total:0,constructor:function(){this.dirty={};this._updating={};this._columnsWithSet={};k.before(this,"configStructure",b.hitch(this,function(){this._columnsWithSet={}}))},destroy:function(){this.inherited(arguments);
this._renderedCollection&&this._cleanupCollection();this._refreshTimeout&&clearTimeout(this._refreshTimeout)},_configColumn:function(b){b.set&&(this._columnsWithSet[b.field]=b);this.inherited(arguments)},_setCollection:function(b){this._renderedCollection&&(this.cleanup(),this._cleanupCollection({shouldRevert:!b||b.storage!==this._renderedCollection.storage}));this.collection=b;if(this._started){if(b){var a=b;this.sort&&0<this.sort.length&&(a=b.sort(this.sort));a.track&&this.shouldTrackCollection&&
(a=a.track(),this._rows=[],this._observerHandle=this._observeCollection(a,this.contentNode,{rows:this._rows}));this._renderedCollection=a}this.refresh()}},_setStore:function(){this.collection||console.debug("set('store') call detected, but you probably meant set('collection')")},_getTotal:function(){return this._total},_cleanupCollection:function(b){b=b||{};this._renderedCollection.tracking&&this._renderedCollection.tracking.remove();this._observerHandle&&(this._observerHandle.remove(),this._observerHandle=
this._rows=null);!1!==b.shouldRevert&&(this.dirty={});this._renderedCollection=this.collection=null},_applySort:function(){this.collection?this.set("collection",this.collection):this.store&&console.debug("_StoreMixin found store property but not collection; this is often the sign of a mistake during migration from 0.3 to 0.4")},_emitRefreshComplete:function(){var b=this;this._refreshTimeout=setTimeout(function(){f.emit(b.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:b});b._refreshTimeout=
null},0)},_insertNoDataNode:function(b){this._removeNoDataNode();b=b||this.contentNode;var a=this.noDataNode=g.create("div",{className:"dgrid-no-data",innerHTML:this.noDataMessage});b.insertBefore(a,this._getFirstRowSibling?this._getFirstRowSibling(b):null);return a},_removeNoDataNode:function(){return this.noDataNode?(g.destroy(this.noDataNode),delete this.noDataNode,!0):!1},row:function(){var b=this.inherited(arguments);b&&b.data&&"undefined"!==typeof b.id&&(b.id=this.collection.getIdentity(b.data));
return b},refresh:function(){var b=this.inherited(arguments);this.collection||this._insertNoDataNode();return b},refreshCell:function(d){if(!this.collection||!this._createBodyRowCell)throw Error("refreshCell requires a Grid with a collection.");this.inherited(arguments);return this.collection.get(d.row.id).then(b.hitch(this,"_refreshCellFromItem",d))},_refreshCellFromItem:function(d,a,c){var e=d.element;g.empty(e);var f=this.dirty&&this.dirty[d.row.id];f&&(a=b.delegate(a,f));this._createBodyRowCell(e,
d.column,a,c)},renderArray:function(){var b=this.inherited(arguments);this.collection||b.length&&this.noDataNode&&g.destroy(this.noDataNode);return b},insertRow:function(d,a,c,e,f){var h=this.collection,k=this.dirty,h=h&&h.getIdentity(d),l;h in k&&!(h in this._updating)&&(l=k[h]);l&&(d=b.delegate(d,l));k=this.inherited(arguments);f&&f.rows&&(f.rows[e]=k);this.noDataNode&&(g.destroy(this.noDataNode),this.noDataNode=null);return k},updateDirty:function(b,a,c){var d=this.dirty,e=d[b];e||(e=d[b]={});
e[a]=c},save:function(){function b(b,d){return function(f){var h=a._columnsWithSet,k=a._updating,l,m;if("function"===typeof f.set)f.set(d);else for(l in d)f[l]=d[l];for(l in h)m=h[l].set(f),void 0!==m&&(f[l]=m);k[b]=!0;return c.put(f).then(function(a){delete e[b];delete k[b];g[b]=a;return g})}}var a=this,c=this.collection,e=this.dirty,f=new m,g={},h=function(b){var d;return a.getBeforePut||!(d=a.row(b).data)?function(){return c.get(b)}:function(){return d}},k=f.then(function(){return g}),l;for(l in e)var n=
b(l,e[l]),k=k.then(h(l)).then(n);f.resolve();return k},revert:function(){this.dirty={};this.refresh()},_trackError:function(d){"string"===typeof d&&(d=b.hitch(this,d));var a=this,c;try{c=l(d())}catch(q){d=new m,d.reject(q),c=d.promise}c.otherwise(function(b){h.call(a,b)});return c},removeRow:function(b,a,c){var d={element:b};a||this.up(d).element!==b||this.down(d).element!==b||this._insertNoDataNode();(d=c&&c.rows||this._rows)&&delete d[b.rowIndex];return this.inherited(arguments)},renderQueryResults:function(d,
a,c){c=b.mixin({rows:this._rows},c);var e=this;return d.then(function(b){b=e.renderArray(b,a,c);delete e._lastCollection;return b})},_observeCollection:function(b,a,c){var d=this,e=c.rows,f,g=[b.on("delete, update",function(b){var g=b.previousIndex,h=b.index;void 0!==g&&e[g]&&("max"in e&&(void 0===h||h<e.min||h>e.max)&&e.max--,f=e[g],f.parentNode===a&&d.removeRow(f,!1,c),e.splice(g,1),("delete"===b.type||"update"===b.type&&(g<h||void 0===h))&&e[g]&&e[g].rowIndex--);"delete"===b.type&&(f=null)}),b.on("add, update",
function(b){var g=b.previousIndex,h=b.index;if(void 0!==h&&(!("max"in e)||h>=e.min&&h<=e.max)){"max"in e&&(void 0===g||g<e.min||g>e.max)&&e.max++;if(e.length){if(g=e[h],!g&&(g=e[h-1]))g=(g.connected||g).nextSibling}else g=d._getFirstRowSibling&&d._getFirstRowSibling(a);f&&g&&f.id===g.id&&(g=(g.connected||g).nextSibling);g&&!g.parentNode&&(g=document.getElementById(g.id));e.splice(h,0,void 0);f=d.insertRow(b.target,a,g,h,c);d.highlightRow(f)}f=null}),b.on("add, delete, update",function(a){var c="undefined"!==
typeof a.previousIndex?a.previousIndex:Infinity,f="undefined"!==typeof a.index?a.index:Infinity,g=Math.min(c,f);c!==f&&e[g]&&d.adjustRowIndices(e[g]);Infinity!==c&&d._processScroll&&(e[c]||e[c-1])&&d._processScroll();d._onNotification(e,a,b);b===d._renderedCollection&&"totalLength"in a&&(d._total=a.totalLength)})];return{remove:function(){for(;0<g.length;)g.pop().remove()}}},_onNotification:function(){}})})},"dgrid/Selection":function(){define("dojo/_base/declare dojo/dom-class dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch dojo/query dojo/_base/sniff dojo/dom".split(" "),
function(n,b,m,k,g,e,f){function l(a,b){b=a.unselectable=b?"on":"";a=a.getElementsByTagName("*");for(var c=a.length;--c;)"INPUT"!==a[c].tagName&&"TEXTAREA"!==a[c].tagName&&(a[c].unselectable=b)}function h(a,b){var c=a.bodyNode,e=b?"text":"-moz-none";d&&"msUserSelect"!==d?c.style[d]=e:k("dom-selectstart")?b||a._selectstartHandle?b&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):a._selectstartHandle=m(c,"selectstart",function(a){var b=a.target&&a.target.tagName;"INPUT"!==
b&&"TEXTAREA"!==b&&a.preventDefault()}):(l(c,!b),b||a._unselectableHandle)?b&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle):a._unselectableHandle=g.after(a,"renderRow",function(a){l(a,!0);return a})}k.add("dom-comparedocumentposition",function(a,b,c){return!!c.compareDocumentPosition});k.add("dom-selectstart","undefined"!==typeof document.onselectstart);var d=k("css-user-select"),a=(e=k("pointer"))&&"MS"===e.slice(0,2),c=e?e+(a?"Down":"down"):"mousedown",q=e?
e+(a?"Up":"up"):"mouseup";"WebkitUserSelect"===d&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(d=!1);return n(null,{selectionDelegate:".dgrid-row",selectionEvents:c+","+q+",dgrid-cellfocusin",selectionTouchEvents:k("touch")?f.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!==this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},
_setAllowTextSelection:function(a){"undefined"!==typeof a?h(this,a):h(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,b){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(b))&&("dgrid-cellfocusin"!==a.type||"mousedown"!==a.parentType)&&(a.type!==q||b===this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32===a.keyCode)if(!a.shiftKey&&a.type===c&&this.isSelected(b))this._waitForMouseUp=b;else this[this._selectionHandlerName](a,
b);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,b){a=a.keyCode?a.ctrlKey:a.metaKey;this._lastSelected===b?this.select(b,null,!a||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var c=this._lastSelected,d=a.keyCode?a.ctrlKey:a.metaKey,e;a.shiftKey||(e=d?null:!0,c=null);this.select(b,c,e);c||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?this.isSelected(b):a.keyCode?a.ctrlKey:
a.metaKey)||this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var a=this,b=this.contentNode,c=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};k("touch")&&!k("pointer")&&this.selectionTouchEvents?(m(b,f.selector(c,this.selectionTouchEvents),function(b){a._handleSelect(b,this);a._ignoreMouseSelect=this}),m(b,m.selector(c,this.selectionEvents),function(b){a._ignoreMouseSelect!==
this?a._handleSelect(b,this):b.type===q&&(a._ignoreMouseSelect=null)})):m(b,m.selector(c,this.selectionEvents),function(b){a._handleSelect(b,this)});this.addKeyHandler&&this.addKeyHandler(32,function(b){a._handleSelect(b,b.target)});if(this.allowSelectAll)this.on("keydown",function(b){b.metaKey&&65===b.keyCode&&!/\bdgrid-input\b/.test(b.target.className)&&(b.preventDefault(),a[a.allSelected?"clearSelection":"selectAll"]())});this._setCollection&&g.before(this,"_setCollection",function(b){a._updateDeselectionAspect(b)});
this._updateDeselectionAspect()},_updateDeselectionAspect:function(a){function b(a,b){if((a=c.row(a))&&c.selection[a.id])c[b](a)}var c=this,d;this._removeDeselectSignals&&this._removeDeselectSignals();d=a&&a.track&&this._observeCollection?[g.before(this,"_observeCollection",function(a){d.push(a.on("delete",function(a){"undefined"===typeof a.index&&b(a.id,"deselect")}))}),g.after(this,"_observeCollection",function(a){d.push(a.on("update",function(c){"undefined"!==typeof c.index&&b(a.getIdentity(c.target),
"select")}))},!0)]:[g.before(this,"removeRow",function(a,b){b||(a=this.row(a))&&a.id in this.selection&&this.deselect(a)})];this._removeDeselectSignals=function(){for(var a=d.length;a--;)d[a].remove();d=[]}},allowSelect:function(){return!0},_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],c=this._selectionTriggerEvent,d;d={bubbles:!0,grid:this};c&&(d.parentType=c.type);d[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];m.emit(this.contentNode,"dgrid-"+a,d)},_fireSelectionEvents:function(){var a=
this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},_select:function(a,c,d){var e,f,g;"undefined"===typeof d&&(d=!0);a.element||(a=this.row(a));if(!1===d||this.allowSelect(a))if(e=this.selection,f=!!e[a.id],null===d&&(d=!f),g=a.element,d||this.allSelected?e[a.id]=d:delete this.selection[a.id],g&&(d?b.add(g,"dgrid-selected"+(this.addUiClasses?" ui-state-active":"")):b.remove(g,"dgrid-selected ui-state-active")),d!==f&&g&&this._selectionEventQueues[(d?"":"de")+"select"].push(a),
c)if(c.element||(c=this.row(c)),c){if(c=c.element)for(e=this._determineSelectionDirection(g,c),e||(c=document.getElementById(c.id),e=this._determineSelectionDirection(g,c));a.element!==c&&(a=this[e](a));)this._select(a,null,d)}else this._lastSelected=g,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},
_determineSelectionDirection:k("dom-comparedocumentposition")?function(a,b){a=b.compareDocumentPosition(a);return a&1?!1:2===a?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,c){this._select(a,b,c);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},
selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},
renderArray:function(){var a=this.inherited(arguments),b=this.selection,c,d,e;for(c=0;c<a.length;c++)d=this.row(a[c]),(e=d.id in b?b[d.id]:this.allSelected)&&this.select(d,null,e);this._fireSelectionEvents();return a}})})},"dojo/store/Memory":function(){define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(n,b,m){return n("dojo.store.Memory",null,{constructor:function(b){for(var g in b)this[g]=b[g];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:m,
get:function(b){return this.data[this.index[b]]},getIdentity:function(b){return b[this.idProperty]},put:function(b,g){var e=this.data,f=this.index,k=this.idProperty,k=b[k]=g&&"id"in g?g.id:k in b?b[k]:Math.random();if(k in f){if(g&&!1===g.overwrite)throw Error("Object already exists");e[f[k]]=b}else f[k]=e.push(b)-1;return k},add:function(b,g){(g=g||{}).overwrite=!1;return this.put(b,g)},remove:function(b){var g=this.index,e=this.data;if(b in g)return e.splice(g[b],1),this.setData(e),!0},query:function(k,
g){return b(this.queryEngine(k,g)(this.data))},setData:function(b){b.items?(this.idProperty=b.identifier||this.idProperty,b=this.data=b.items):this.data=b;this.index={};for(var g=0,e=b.length;g<e;g++)this.index[b[g][this.idProperty]]=g}})})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(n,b,m){var k=function(g){function e(b){g[b]=function(){var e=arguments,d=m(g,function(a){Array.prototype.unshift.call(e,a);return k(n[b].apply(n,e))});
if("forEach"!==b||f)return d}}if(!g)return g;var f=!!g.then;f&&(g=b.delegate(g));e("forEach");e("filter");e("map");null==g.total&&(g.total=m(g,function(b){return b.length}));return g};b.setObject("dojo.store.util.QueryResults",k);return k})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],function(n){return function(b,m){function k(e){e=n.filter(e,b);var f=m&&m.sort;f&&e.sort("function"==typeof f?f:function(b,d){for(var a,c=0;a=f[c];c++){var e=b[a.attribute],g=d[a.attribute],
e=null!=e?e.valueOf():e,g=null!=g?g.valueOf():g;if(e!=g)return!!a.descending==(null==e||e>g)?-1:1}return 0});if(m&&(m.start||m.count)){var g=e.length;e=e.slice(m.start||0,(m.start||0)+(m.count||Infinity));e.total=g}return e}switch(typeof b){default:throw Error("Can not query with a "+typeof b);case "object":case "undefined":var g=b;b=function(b){for(var e in g){var k=g[e];if(k&&k.test){if(!k.test(b[e],b))return!1}else if(k!=b[e])return!1}return!0};break;case "string":if(!this[b])throw Error("No filter function "+
b+" was found in store");b=this[b];case "function":}k.matches=b;return k}})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c){m.isAsync||l(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var q=b("dojo.dnd.Source",a,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,
autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(a,b){k.mixin(this,k.mixin({},b));a=this.accept;if(a.length)for(this.accept={},b=0;b<a.length;++b)this.accept[a[b]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&g.add(this.node,"dojoDndSource");this.targetState="";this.accept&&g.add(this.node,"dojoDndTarget");this.horizontal&&g.add(this.node,"dojoDndHorizontal");this.topics=
[h.subscribe("/dnd/source/over",k.hitch(this,"onDndSourceOver")),h.subscribe("/dnd/start",k.hitch(this,"onDndStart")),h.subscribe("/dnd/drop",k.hitch(this,"onDndDrop")),h.subscribe("/dnd/cancel",k.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==a)return!this.copyOnly||this.selfAccept;for(var c=0;c<b.length;++c){for(var d=a.getItem(b[c].id).type,e=!1,f=0;f<d.length;++f)if(d[f]in this.accept){e=!0;break}if(!e)return!1}return!0},copyState:function(a,b){if(a)return!0;2>arguments.length&&
(b=this==c.manager().target);if(b){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){q.superclass.destroy.call(this);n.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(a){if(!this.isDragging||"Disabled"!=this.targetState){q.superclass.onMouseMove.call(this,a);var b=c.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)){var f=
this.getSelectedNodes();f.length&&b.startDrag(this,f,this.copyState(d.getCopyKeyState(a),!0))}this.isDragging&&(f=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=e.position(this.current,!0)),f=this.horizontal?a.pageX-this.targetBox.x<this.targetBox.w/2==e.isBodyLtr(this.current.ownerDocument):a.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||f!=this.before)&&(this._markTargetAnchor(f),b.canDrop(!this.current||b.source!=this||!(this.current.id in
this.selection)))}},onMouseDown:function(a){this.mouseDown||!this._legalMouseDown(a)||this.skipForm&&d.isFormElement(a)||(this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,q.superclass.onMouseDown.call(this,a))},onMouseUp:function(a){this.mouseDown&&(this.mouseDown=!1,q.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=c.manager(),a.canDrop("Disabled"!=this.targetState&&(!this.current||
a.source!=this||!(this.current.id in this.selection))))},onDndStart:function(a,b,d){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?d?"Copied":"Moved":"");b=this.accept&&this.checkAcceptance(a,b);this._changeState("Target",b?"":"Disabled");this==a&&c.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,b,c,d){if(this==d)this.onDrop(a,b,c);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=
!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,c){if(this!=a)this.onDropExternal(a,b,c);else this.onDropInternal(b,c)},onDropExternal:function(a,b,c){var e=this._normalizedCreator;this._normalizedCreator=this.creator?function(b,c){return e.call(this,a.getItem(b.id).data,c)}:c?function(b){var c=a.getItem(b.id);b=b.cloneNode(!0);b.id=d.getUniqueId();return{node:b,data:c.data,type:c.type}}:function(b){var c=a.getItem(b.id);a.delItem(b.id);
return{node:b,data:c.data,type:c.type}};this.selectNone();c||this.creator||a.selectNone();this.insertNodes(!0,b,this.before,this.current);!c&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=e},onDropInternal:function(a,b){var c=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(b)this._normalizedCreator=this.creator?function(a,b){return c.call(this,this.getItem(a.id).data,b)}:function(a){var b=this.getItem(a.id);a=a.cloneNode(!0);a.id=d.getUniqueId();return{node:a,
data:b.data,type:b.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=c}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){q.superclass.onOverEvent.call(this);c.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){q.superclass.onOutEvent.call(this);
c.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){if(this.current!=this.targetAnchor||this.before!=a)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!f.isLeft(a))return!1;if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(g.contains(a,"dojoDndHandle"))return!0;if(g.contains(a,"dojoDndItem")||g.contains(a,"dojoDndIgnore"))break}return!1}});return q})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c){var q=b("dojo.dnd.Selector",c,{constructor:function(a,b){b||(b={});this.singular=b.singular;this.autoSync=b.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(h(this.node,d.press,k.hitch(this,"onMouseDown")),h(this.node,d.release,k.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var b=new l,c=a._empty,d;for(d in this.selection)d in c||b.push(g.byId(d));return b},selectNone:function(){return this._removeSelection()._removeAnchor()},
selectAll:function(){this.forInItems(function(a,b){this._addItemClass(g.byId(b),"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var b=a._empty,c;for(c in this.selection)if(!(c in b)){var d=g.byId(c);this.delItem(c);e.destroy(d)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(b,c){c=c||m.global;var d=this.selection,e=a._empty,f;for(f in d)f in e||b.call(c,this.getItem(f),f,this)},sync:function(){q.superclass.sync.call(this);
this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var b=[],c=a._empty,d;for(d in this.selection)d in c||this.getItem(d)||b.push(d);n.forEach(b,function(a){delete this.selection[a]},this);return this},insertNodes:function(a,b,c,d){var e=this._normalizedCreator;this._normalizedCreator=function(b,c){b=e.call(this,b,c);a?(this.anchor?this.anchor!=b.node&&(this._removeItemClass(b.node,"Anchor"),this._addItemClass(b.node,"Selected")):(this.anchor=b.node,this._removeItemClass(b.node,"Selected"),
this._addItemClass(this.anchor,"Anchor")),this.selection[b.node.id]=1):(this._removeItemClass(b.node,"Selected"),this._removeItemClass(b.node,"Anchor"));return b};q.superclass.insertNodes.call(this,b,c,d);this._normalizedCreator=e;return this},destroy:function(){q.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(b){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!a.getCopyKeyState(b)&&!b.shiftKey&&this.current.id in this.selection)this.simpleSelection=
!0,f.isLeft(b)&&(b.stopPropagation(),b.preventDefault());else{if(!this.singular&&b.shiftKey){a.getCopyKeyState(b)||this._removeSelection();var c=this.getAllNodes();if(c.length&&(this.anchor||(this.anchor=c[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var d=0,e;d<c.length&&(e=c[d],e!=this.anchor&&e!=this.current);++d);for(++d;d<c.length;++d){e=c[d];if(e==this.anchor||e==this.current)break;this._addItemClass(e,"Selected");this.selection[e.id]=
1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?a.getCopyKeyState(b)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):a.getCopyKeyState(b)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):
(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);b.stopPropagation();b.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&
(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=h(this.node,d.move,k.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var b=a._empty,c;for(c in this.selection)if(!(c in b)){var d=g.byId(c);d&&this._removeItemClass(d,"Selected")}this.selection=
{};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return q})},"dojo/_base/NodeList":function(){define(["./kernel","../query","./array","./html","../NodeList-dom"],function(n,b,m){b=b.NodeList;var k=b.prototype;k.connect=b._adaptAsForEach(function(){return n.connect.apply(this,arguments)});k.coords=b._adaptAsMap(n.coords);b.events="blur focus change click error keydown keypress keyup load mousedown mouseenter mouseleave mousemove mouseout mouseover mouseup submit".split(" ");
m.forEach(b.events,function(b){var e="on"+b;k[e]=function(b,g){return this.connect(e,b,g)}});return n.NodeList=b})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){b=b("dojo.dnd.Container",h,{skipForm:!1,allowNested:!1,constructor:function(b,c){this.node=e.byId(b);c||(c={});this.creator=c.creator||
null;this.skipForm=c.skipForm;this.parent=c.dropParent&&e.byId(c.dropParent);this.map={};this.current=null;this.containerState="";f.add(this.node,"dojoDndContainer");c&&c._skipStartup||this.startup();this.events=[a(this.node,q.over,k.hitch(this,"onMouseOver")),a(this.node,q.out,k.hitch(this,"onMouseOut")),a(this.node,"dragstart",k.hitch(this,"onSelectStart")),a(this.node,"selectstart",k.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},setItem:function(a,
b){this.map[a]=b},delItem:function(a){delete this.map[a]},forInItems:function(a,b){b=b||m.global;var c=this.map,d=p._empty,e;for(e in c)e in d||a.call(b,c[e],e,this);return b},clearItems:function(){this.map={}},getAllNodes:function(){return c((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(b){if(b.id){var c=this.getItem(b.id);if(c){a[b.id]=c;return}}else b.id=p.getUniqueId();var c=b.getAttribute("dndType"),d=b.getAttribute("dndData");
a[b.id]={data:d||b.innerHTML,type:c?c.split(/\s*,\s*/):["text"]}},this);this.map=a;return this},insertNodes:function(a,b,c){this.parent.firstChild?b?c||(c=this.parent.firstChild):c&&(c=c.nextSibling):c=null;var d;if(c)for(b=0;b<a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),c.parentNode.insertBefore(d.node,c);else for(b=0;b<a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),this.parent.appendChild(d.node);
return this},destroy:function(){n.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,b,c){a._skipStartup=!0;return new c(b,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=a[0])}this.defaultCreator=p._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var b=a.relatedTarget;b&&
b!=this.node;)try{b=b.parentNode}catch(r){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(u){a=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){this.withHandles||
this.skipForm&&p.isFormElement(a)||(a.stopPropagation(),a.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,b){var c="dojoDnd"+a;a=a.toLowerCase()+"State";f.replace(this.node,c+b,c+this[a]);this[a]=b},_addItemClass:function(a,b){f.add(a,"dojoDndItem"+b)},_removeItemClass:function(a,b){f.remove(a,"dojoDndItem"+b)},_getChildByEvent:function(a){if(a=a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==this.parent||this.allowNested)&&f.contains(a,"dojoDndItem"))return a;
return null},_normalizedCreator:function(a,b){a=(this.creator||this.defaultCreator).call(this,a,b);k.isArray(a.type)||(a.type=["text"]);a.node.id||(a.node.id=p.getUniqueId());f.add(a.node,"dojoDndItem");return a}});p._createNode=function(a){return a?function(b){return l.create(a,{innerHTML:b})}:p._createSpan};p._createTrTd=function(a){var b=l.create("tr");l.create("td",{innerHTML:a},b);return b};p._createSpan=function(a){return l.create("span",{innerHTML:a})};p._defaultCreatorNodes={ul:"li",ol:"li",
div:"div",p:"div"};p._defaultCreator=function(a){a=a.tagName.toLowerCase();var b="tbody"==a||"thead"==a?p._createTrTd:p._createNode(p._defaultCreatorNodes[a]);return function(a,c){var d=a&&k.isObject(a),e;d&&a.tagName&&a.nodeType&&a.getAttribute?(e=a.getAttribute("dndData")||a.innerHTML,d=(d=a.getAttribute("dndType"))?d.split(/\s*,\s*/):["text"]):(e=d&&a.data?a.data:a,d=d&&a.type?a.type:["text"],a=("avatar"==c?p._createSpan:b)(String(e)));a.id||(a.id=p.getUniqueId());return{node:a,data:e,type:d}}};
return b})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,q,p){var t=b("dojo.dnd.Manager",[e],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:f("touch")?4:16,OFFSET_Y:f("touch")?4:16,overSource:function(a){this.avatar&&
(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());d.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),d.publish("/dnd/source/over",null)):d.publish("/dnd/source/over",null)},startDrag:function(b,c,e){function f(a){a.preventDefault();a.stopPropagation()}q.autoScrollStart(k.doc);this.source=b;this.nodes=c;this.copy=!!e;this.avatar=this.makeAvatar();k.body().appendChild(this.avatar.node);
d.publish("/dnd/start",b,c,this.copy);this.events=[h(k.doc,a.move,m.hitch(this,"onMouseMove")),h(k.doc,a.release,m.hitch(this,"onMouseUp")),h(k.doc,"keydown",m.hitch(this,"onKeyDown")),h(k.doc,"keyup",m.hitch(this,"onKeyUp")),h(k.doc,"dragstart",f),h(k.body(),"selectstart",f)];b="dojoDnd"+(e?"Copy":"Move");g.add(k.body(),b)},canDrop:function(a){a=!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){g.remove(k.body(),["dojoDndCopy","dojoDndMove"]);
n.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new p(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var b=this.avatar;b&&(q.autoScrollNodes(a),b=b.node.style,b.left=a.pageX+this.OFFSET_X+"px",b.top=a.pageY+this.OFFSET_Y+"px",b=!!this.source.copyState(c.getCopyKeyState(a)),this.copy!=b&&this._setCopyStatus(b));f("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&
this.canDropFlag){var b=!!this.source.copyState(c.getCopyKeyState(a));d.publish("/dnd/drop/before",this.source,this.nodes,b,this.target,a);d.publish("/dnd/drop",this.source,this.nodes,b,this.target,a)}else d.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case l.CTRL:a=!!this.source.copyState(!0);this.copy!=a&&this._setCopyStatus(a);break;case l.ESCAPE:d.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==l.CTRL&&(a=
!!this.source.copyState(!1),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();g.replace(k.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});c._manager=null;t.manager=c.manager=function(){c._manager||(c._manager=new t);return c._manager};return t})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),
function(n,b,m,k,g,e,f,l){return n("dojo.dnd.Avatar",null,{constructor:function(b){this.manager=b;this.construct()},construct:function(){var b=e.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),d=this.manager.source,a,c=e.create("tbody",null,b),g=e.create("tr",null,c),l=e.create("td",null,g),m=Math.min(5,this.manager.nodes.length),n=0;f("highcontrast")&&e.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},l);e.create("span",{innerHTML:d.generateText?
this._generateText():""},l);for(k.set(g,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});n<m;++n)d.creator?a=d._normalizedCreator(d.getItem(this.manager.nodes[n].id).data,"avatar").node:(a=this.manager.nodes[n].cloneNode(!0),"tr"==a.tagName.toLowerCase()&&(g=e.create("table"),e.create("tbody",null,g).appendChild(a),a=g)),a.id="",g=e.create("tr",null,c),l=e.create("td",null,g),l.appendChild(a),k.set(g,{"class":"dojoDndAvatarItem",style:{opacity:(9-n)/10}});this.node=b},destroy:function(){e.destroy(this.node);
this.node=!1},update:function(){g.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(f("highcontrast")){var b=m.byId("a11yIcon"),d="+";this.manager.canDropFlag&&!this.manager.copy?d="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(d="x"):d="o";b.innerHTML=d}l("tr.dojoDndAvatarHeader td span"+(f("highcontrast")?" span":""),this.node).forEach(function(a){a.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},
"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(n,b,m,k){return n("dijit.CheckedMenuItem",m,{baseClass:"dijitMenuItem dijitCheckedMenuItem",templateString:k,checked:!1,_setCheckedAttr:function(b){this.domNode.setAttribute("aria-checked",b?"true":"false");this._set("checked",b)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(b){this.disabled||
(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(b)}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c){f=n("dijit.MenuItem"+(e("dojo-bidi")?"_NoBidi":""),[l,h,d,a],{templateString:c,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",
a);var b="",c;c=a.search(/{\S}/);if(0<=c){var b=a.charAt(c+1),d=a.substr(0,c);a=a.substr(c+3);c=d+b+a;a=d+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+a}else c=a;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){!a||"label"in this.params||this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);
m.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&m.set(this.accelKeyNode,"id",this.id+"_accel");b.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==e("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(q){}},_setSelected:function(a){k.toggle(this.domNode,"dijitMenuItemSelected",a)},setLabel:function(a){g.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){g.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.",
"","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=a?"":"none",this.accelKeyNode.innerHTML=a,m.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});e("dojo-bidi")&&(f=n("dijit.MenuItem",f,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));
return f})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w){function v(a){return function(b){this._isLoaded?this.inherited(a,arguments):
this.loadDropDown(l.hitch(this,a,b))}}var z=b("dijit.form._SelectMenu",q,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(h(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}))},focus:function(){var a=!1,b=this.parentWidget.value;l.isArray(b)&&(b=b[b.length-1]);b&&n.forEach(this.parentWidget._getChildren(),function(c){c.option&&b===c.option.value&&(a=!0,
this.focusChild(c,!1))},this);a||this.inherited(arguments)}});g=b("dijit.form.Select"+(d("dojo-bidi")?"_NoBidi":""),[a,c,r],{baseClass:"dijitSelect dijitValidationTextBox",templateString:w,_buttonInputDisabled:d("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this._set("value",
this.options[0<=a?a:0].value)}this.dropDown=new z({id:this.id+"_menu",parentWidget:this});k.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(a){if(a.value||a.label){var b=l.hitch(this,"_setValueAttr",a);a=new p({option:a,label:("text"===this.labelType?(a.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a.label)||this.emptyLabel,onClick:b,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:a.disabled||
!1});a.focusNode.setAttribute("role","option");return a}return new t({ownerDocument:this.ownerDocument})},_addOptionItem:function(a){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(a))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(y){}},focusChild:function(a){a&&this.set("value",a.option)},_getFirst:function(){var a=this._getChildren();return a.length?a[0]:null},
_getLast:function(){var a=this._getChildren();return a.length?a[a.length-1]:null},childSelector:function(a){return(a=x.byNode(a))&&a.getParent()==this.dropDown},onKeyboardSearch:function(a,b,c,d){a&&this.focusChild(a)},_loadChildren:function(a){if(!0===a)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{n.forEach(this._getChildren(),function(a){a.destroyRecursive()});var b=new p({ownerDocument:this.ownerDocument,label:this.emptyLabel});
this.dropDown.addChild(b)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(a){this.inherited(arguments);m.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",_setDisabledAttr:function(a){this.inherited(arguments);this._refreshState()},
_setRequiredAttr:function(a){this._set("required",a);this.focusNode.setAttribute("aria-required",a);this._refreshState()},_setOptionsAttr:function(a){this._isLoaded=!1;this._set("options",a)},_setDisplay:function(a){a=("text"===this.labelType?(a||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+a+"\x3c/span\x3e"},
validate:function(a){a=this.disabled||this.isValid(a);this._set("state",a?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",a?"false":"true");var b=a?"":this._missingMsg;b&&this.focused&&this._hasBeenBlurred?u.show(b,this.domNode,this.tooltipPosition,!this.isLeftToRight()):u.hide(this.domNode);this._set("message",b);return a},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||"")},reset:function(){this.inherited(arguments);u.hide(this.domNode);
this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=e.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(h(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var a=this._keyNavCodes;delete a[f.LEFT_ARROW];delete a[f.RIGHT_ARROW]},_setStyleAttr:function(a){this.inherited(arguments);k.toggle(this.domNode,
this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(a){this._loadChildren(!0);this._isLoaded=!0;a()},destroy:function(a){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(a),delete this.dropDown);u.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){u.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});d("dojo-bidi")&&(g=
b("dijit.form.Select",g,{_setDisplay:function(a){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));g._Menu=z;g.prototype._onContainerKeydown=v("_onContainerKeydown");g.prototype._onContainerKeypress=v("_onContainerKeypress");return g})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q){return g("dijit.form._FormSelectWidget",q,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var b=this.options||[];if(null==a)return b;if(h.isArrayLike(a))return n.map(a,"return this.getOptions(item);",this);h.isString(a)&&(a={value:a});h.isObject(a)&&(n.some(b,function(b,c){for(var d in a)if(!(d in b)||b[d]!=a[d])return!1;a=c;return!0})||(a=-1));return 0<=a&&a<b.length?b[a]:null},addOption:function(a){n.forEach(h.isArrayLike(a)?a:[a],function(a){a&&h.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(h.isArrayLike(a)?
a:[a]);n.forEach(a,function(a){a&&(this.options=n.filter(this.options,function(b){return b.value!==a.value||b.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){n.forEach(h.isArrayLike(a)?a:[a],function(a){var b=this.getOptions({value:a.value}),c;if(b)for(c in a)b[c]=a[c]},this);this._loadChildren()},setStore:function(a,b,c){l.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(a,b,c)},_deprecatedSetStore:function(d,e,f){var g=this.store;f=f||{};if(g!==d){for(var l;l=this._notifyConnections.pop();)l.remove();d.get||(h.mixin(d,{_oldAPI:!0,get:function(a){var c=new b;this.fetchItemByIdentity({identity:a,onItem:function(a){c.resolve(a)},onError:function(a){c.reject(a)}});return c.promise},query:function(a,d){var e=new b(function(){f.abort&&f.abort()});e.total=new b;var f=this.fetch(h.mixin({query:a,onBegin:function(a){e.total.resolve(a)},
onComplete:function(a){e.resolve(a)},onError:function(a){e.reject(a)}},d));return new c(e)}}),d.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[m.after(d,"onNew",h.hitch(this,"_onNewItem"),!0),m.after(d,"onDelete",h.hitch(this,"_onDeleteItem"),!0),m.after(d,"onSet",h.hitch(this,"_onSetItem"),!0)]));this._set("store",d)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);f.query&&this._set("query",f.query);f.queryOptions&&this._set("queryOptions",f.queryOptions);d&&d.query&&(this._loadingStore=!0,this.onLoadDeferred=new b,this._queryRes=d.query(this.query,this.queryOptions),a(this._queryRes,h.hitch(this,function(a){if(this.sortByLabel&&!f.sort&&a.length)if(d.getValue)a.sort(k.createSortFunction([{attribute:d.getLabelAttributes(a[0])[0]}],d));else{var b=this.labelAttr;a.sort(function(a,c){return a[b]>c[b]?1:c[b]>
a[b]?-1:0})}f.onFetch&&(a=f.onFetch.call(this,a,f));n.forEach(a,function(a){this._addOptionForItem(a)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(h.hitch(this,function(a,b,c){b==c?this._onSetItem(a):(-1!=b&&this._onDeleteItem(a),-1!=c&&this._onNewItem(a))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:e);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(a):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),h.hitch(this,function(a){console.error("dijit.form.Select: "+a.toString());this.onLoadDeferred.reject(a)})));return g},_setValueAttr:function(a,b){this._onChangeActive||(b=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=h.isArrayLike(a)?n.map(a,function(a){return h.isObject(a)?a:{value:a}}):h.isObject(a)?[a]:[{value:a}];a=n.filter(this.getOptions(a),function(a){return a&&a.value});var c=this.getOptions()||[];this.multiple||a[0]&&a[0].value||!c.length||(a[0]=
c[0]);n.forEach(c,function(b){b.selected=n.some(a,function(a){return a.value===b.value})});c=n.map(a,function(a){return a.value});if("undefined"!=typeof c&&"undefined"!=typeof c[0]){var d=n.map(a,function(a){return a.label});this._setDisplay(this.multiple?d:d[0]);this.inherited(arguments,[this.multiple?c:c[0],b]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=n.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?
a:a[0]},_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(n.forEach(this._getChildren(),function(a){a.destroyRecursive()}),n.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;n.forEach(this._getChildren(),function(c){var d=n.some(a,function(a){return c.option&&
a===c.option.value});d&&!b.multiple&&(b.focusedChild=c);f.toggle(c.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),d);c.domNode.setAttribute("aria-selected",d?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=n.filter(a,function(a){return a.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?n.map(n.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,b){b&&b.parent||this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,c=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:c?b.getIdentity(a):null,label:c,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);e.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?d("\x3e *",this.srcNodeRef).map(function(a){return"separator"===a.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:a.getAttribute("data-"+l._scopeName+"-value")||a.getAttribute("value"),
label:String(a.innerHTML),selected:a.getAttribute("selected")||!1,disabled:a.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);m.after(this,"onChange",h.hitch(this,"_updateSelection"));var a=this.store;a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(n){var b={};n.setObject("dojo.data.util.sorter",b);b.basicComparator=function(b,k){var g=-1;null===b&&(b=void 0);null===k&&(k=void 0);if(b==k)g=0;else if(b>k||null==b)g=1;return g};b.createSortFunction=function(m,k){function g(a,b,c,d){return function(e,f){e=d.getValue(e,a);f=d.getValue(f,a);
return b*c(e,f)}}for(var e=[],f,l=k.comparatorMap,h=b.basicComparator,d=0;d<m.length;d++){f=m[d];var a=f.attribute;if(a){f=f.descending?-1:1;var c=h;l&&("string"!==typeof a&&"toString"in a&&(a=a.toString()),c=l[a]||h);e.push(g(a,f,c,k))}}return function(a,b){for(var c=0;c<e.length;){var d=e[c++](a,b);if(0!==d)return d}return 0}};return b})},"dijit/form/_FormValueWidget":function(){define(["dojo/_base/declare","dojo/sniff","./_FormWidget","./_FormValueMixin"],function(n,b,m,k){return n("dijit.form._FormValueWidget",
[m,k],{_layoutHackIE7:function(){if(7==b("ie"))for(var g=this.domNode,e=g.parentNode,f=g.firstChild||g,k=f.style.filter,h=this;e&&0==e.clientHeight;)(function(){var b=h.connect(e,"onscroll",function(){h.disconnect(b);f.style.filter=(new Date).getMilliseconds();h.defer(function(){f.style.filter=k})})})(),e=e.parentNode}})})},"dijit/form/_FormWidget":function(){define("dojo/_base/declare dojo/sniff dojo/_base/kernel dojo/ready ../_Widget ../_CssStateMixin ../_TemplatedMixin ./_FormWidgetMixin".split(" "),
function(n,b,m,k,g,e,f,l){b("dijit-legacy-requires")&&k(0,function(){require(["dijit/form/_FormValueWidget"])});return n("dijit.form._FormWidget",[g,f,e,l],{setDisabled:function(b){m.deprecated("setDisabled("+b+") is deprecated. Use set('disabled',"+b+") instead.","","2.0");this.set("disabled",b)},setValue:function(b){m.deprecated("dijit.form._FormWidget:setValue("+b+") is deprecated.  Use set('value',"+b+") instead.","","2.0");this.set("value",b)},getValue:function(){m.deprecated(this.declaredClass+
"::getValue() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},postMixInProperties:function(){this.nameAttrSetting=this.name?'name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"";this.inherited(arguments)}})})},"dijit/form/_FormWidgetMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff dojo/window ../a11y".split(" "),function(n,b,m,k,g,e,f,l,h,d){return b("dijit.form._FormWidgetMixin",
null,{name:"",alt:"",value:"",type:"text","aria-label":"focusNode",tabIndex:"0",_setTabIndexAttr:"focusNode",disabled:!1,intermediateChanges:!1,scrollOnFocus:!0,_setIdAttr:"focusNode",_setDisabledAttr:function(a){this._set("disabled",a);/^(button|input|select|textarea|optgroup|option|fieldset)$/i.test(this.focusNode.tagName)?m.set(this.focusNode,"disabled",a):this.focusNode.setAttribute("aria-disabled",a?"true":"false");this.valueNode&&m.set(this.valueNode,"disabled",a);a?(this._set("hovering",!1),
this._set("active",!1),a="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"_setTabIndexAttr"in this?this._setTabIndexAttr:"focusNode",n.forEach(g.isArray(a)?a:[a],function(a){a=this[a];l("webkit")||d.hasDefaultTabStop(a)?a.setAttribute("tabIndex","-1"):a.removeAttribute("tabIndex")},this)):""!=this.tabIndex&&this.set("tabIndex",this.tabIndex)},_onFocus:function(a){if("mouse"==a&&this.isFocusable())var b=this.own(f(this.focusNode,"focus",function(){d.remove();b.remove()}))[0],d=this.own(f(this.ownerDocumentBody,
"pointerup",g.hitch(this,function(a){d.remove();b.remove();this.focused&&("touchend"==a.type?this.defer("focus"):this.focus())})))[0];this.scrollOnFocus&&this.defer(function(){h.scrollIntoView(this.domNode)});this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&"none"!=k.get(this.domNode,"display")},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(a){}},compare:function(a,b){return"number"==typeof a&&"number"==typeof b?isNaN(a)&&
isNaN(b)?0:a-b:a>b?1:a<b?-1:0},onChange:function(){},_onChangeActive:!1,_handleOnChange:function(a,b){void 0!=this._lastValueReported||null!==b&&this._onChangeActive||(this._resetValue=this._lastValueReported=a);this._pendingOnChange=this._pendingOnChange||typeof a!=typeof this._lastValueReported||0!=this.compare(a,this._lastValueReported);(this.intermediateChanges||b||void 0===b)&&this._pendingOnChange&&(this._lastValueReported=a,this._pendingOnChange=!1,this._onChangeActive&&(this._onChangeHandle&&
this._onChangeHandle.remove(),this._onChangeHandle=this.defer(function(){this._onChangeHandle=null;this.onChange(a)})))},create:function(){this.inherited(arguments);this._onChangeActive=!0},destroy:function(){this._onChangeHandle&&(this._onChangeHandle.remove(),this.onChange(this._lastValueReported));this.inherited(arguments)}})})},"dijit/form/_FormValueMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormWidgetMixin".split(" "),function(n,
b,m,k,g,e,f){return n("dijit.form._FormValueMixin",f,{readOnly:!1,_setReadOnlyAttr:function(e){b.set(this.focusNode,"readOnly",e);this._set("readOnly",e)},postCreate:function(){this.inherited(arguments);void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.value)},_setValueAttr:function(b,e){this._handleOnChange(b,e)},_handleOnChange:function(b,e){this._set("value",b);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,!1)},reset:function(){this._hasBeenBlurred=
!1;this._setValueAttr(this._resetValue,!0)}})})},"dijit/_HasDropDown":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on dojo/touch ./registry ./focus ./popup ./_FocusMixin".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u){return n("dijit._HasDropDown",u,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,
dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(b){this.disabled||this.readOnly||("MSPointerDown"!=b.type&&b.preventDefault(),this.own(a.once(this.ownerDocument,c.release,d.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(a){var b=this.dropDown,c=!1;if(a&&this._opened){var d=e.position(this._buttonNode,!0);if(!(a.pageX>=d.x&&a.pageX<=d.x+d.w&&a.pageY>=d.y&&a.pageY<=d.y+d.h)){for(d=a.target;d&&!c;)g.contains(d,"dijitPopup")?
c=!0:d=d.parentNode;if(c){d=a.target;if(b.onItemClick){for(var f;d&&!(f=q.byNode(d));)d=d.parentNode;if(f&&f.onClick&&f.getParent)f.getParent().onItemClick(f,a)}return}}}this._opened?b.focus&&(!1!==b.autoFocus||"mouseup"==a.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){b.focus();delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(a){this._stopClickEvents&&(a.stopPropagation(),a.preventDefault())},buildRendering:function(){this.inherited(arguments);
this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var a={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";g.add(this._arrowWrapperNode||this._buttonNode,"dijit"+a+"ArrowButton")},postCreate:function(){this.inherited(arguments);var b=this.focusNode||this.domNode;this.own(a(this._buttonNode,
c.press,d.hitch(this,"_onDropDownMouseDown")),a(this._buttonNode,"click",d.hitch(this,"_onDropDownClick")),a(b,"keydown",d.hitch(this,"_onKey")),a(b,"keyup",d.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0);this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),delete this.dropDown);this.inherited(arguments)},_onKey:function(a){if(!this.disabled&&!this.readOnly){var b=this.dropDown,c=a.target;b&&this._opened&&b.handleKey&&!1===b.handleKey(a)?(a.stopPropagation(),
a.preventDefault()):b&&this._opened&&a.keyCode==h.ESCAPE?(this.closeDropDown(),a.stopPropagation(),a.preventDefault()):!this._opened&&(a.keyCode==h.DOWN_ARROW||(a.keyCode==h.ENTER||a.keyCode==h.SPACE&&(!this._searchTimer||a.ctrlKey||a.altKey||a.metaKey))&&("input"!==(c.tagName||"").toLowerCase()||c.type&&"text"!==c.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,a.stopPropagation(),a.preventDefault())}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var a=
this.dropDown;a&&a.focus&&this.defer(d.hitch(a,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1);this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(a){a()},loadAndOpenDropDown:function(){var a=new b,c=d.hitch(this,function(){this.openDropDown();a.resolve(this.dropDown)});this.isLoaded()?c():this.loadDropDown(c);return a},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var a=
this.dropDown,b=a.domNode,c=this._aroundNode||this.domNode,f=this,h=t.open({parent:this,popup:a,around:c,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){f.closeDropDown(!0)},onCancel:function(){f.closeDropDown(!0)},onClose:function(){k.set(f._popupStateNode,"popupActive",!1);g.remove(f._popupStateNode,"dijitHasDropDownOpen");f._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&c.offsetWidth>a._popupWrapper.offsetWidth){var c=c.offsetWidth-a._popupWrapper.offsetWidth,
l={w:a.domNode.offsetWidth+c};this._origStyle=b.style.cssText;d.isFunction(a.resize)?a.resize(l):e.setMarginBox(b,l);"R"==h.corner[1]&&(a._popupWrapper.style.left=a._popupWrapper.style.left.replace("px","")-c+"px")}k.set(this._popupStateNode,"popupActive","true");g.add(this._popupStateNode,"dijitHasDropDownOpen");this._set("_opened",!0);this._popupStateNode.setAttribute("aria-expanded","true");this._popupStateNode.setAttribute("aria-owns",a.id);"presentation"===b.getAttribute("role")||b.getAttribute("aria-labelledby")||
b.setAttribute("aria-labelledby",this.id);return h},closeDropDown:function(a){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer);this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),a&&this.focus&&this.focus(),t.close(this.dropDown),this._opened=!1);this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),
function(n,b,m,k,g,e){return n("dijit.MenuSeparator",[m,k,g],{templateString:e,buildRendering:function(){this.inherited(arguments);b.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/Tooltip":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff ./_base/manager ./place ./_Widget ./_TemplatedMixin ./BackgroundIframe dojo/text!./templates/Tooltip.html ./main".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x){function w(){}var v=b("dijit._MasterTooltip",[p,t],{duration:c.defaultDuration,templateString:r,postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.bgIframe=new u(this.domNode);this.fadeIn=m.fadeIn({node:this.domNode,duration:this.duration,onEnd:l.hitch(this,"_onShow")});this.fadeOut=m.fadeOut({node:this.domNode,duration:this.duration,onEnd:l.hitch(this,"_onHide")})},show:function(a,b,c,d,e,g,h){if(!this.aroundNode||this.aroundNode!==
b||this.containerNode.innerHTML!=a)if("playing"==this.fadeOut.status())this._onDeck=arguments;else{this.containerNode.innerHTML=a;e&&this.set("textDir",e);this.containerNode.align=d?"right":"left";var k=q.around(this.domNode,b,c&&c.length?c:z.defaultPosition,!d,l.hitch(this,"orient")),m=k.aroundNodePos;"M"==k.corner.charAt(0)&&"M"==k.aroundCorner.charAt(0)?(this.connectorNode.style.top=m.y+(m.h-this.connectorNode.offsetHeight>>1)-k.y+"px",this.connectorNode.style.left=""):"M"==k.corner.charAt(1)&&
"M"==k.aroundCorner.charAt(1)?this.connectorNode.style.left=m.x+(m.w-this.connectorNode.offsetWidth>>1)-k.x+"px":(this.connectorNode.style.left="",this.connectorNode.style.top="");f.set(this.domNode,"opacity",0);this.fadeIn.play();this.isShowingNow=!0;this.aroundNode=b;this.onMouseEnter=g||w;this.onMouseLeave=h||w}},orient:function(b,c,d,f,g){this.connectorNode.style.top="";var h=f.h;f=f.w;b.className="dijitTooltip "+{"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove",
"BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[c+"-"+d];this.domNode.style.width="auto";var k=e.position(this.domNode);a("ie")&&(k.w+=2);e.setMarginBox(this.domNode,{w:Math.min(Math.max(f,1),k.w)});"B"==d.charAt(0)&&"B"==c.charAt(0)?(b=e.position(b),c=this.connectorNode.offsetHeight,
b.h>h?(this.connectorNode.style.top=h-(g.h+c>>1)+"px",this.connectorNode.style.bottom=""):(this.connectorNode.style.bottom=Math.min(Math.max(g.h/2-c/2,0),b.h-c)+"px",this.connectorNode.style.top="")):(this.connectorNode.style.top="",this.connectorNode.style.bottom="");return Math.max(0,k.w-f)},_onShow:function(){a("ie")&&(this.domNode.style.filter="")},hide:function(a){this._onDeck&&this._onDeck[1]==a?this._onDeck=null:this.aroundNode===a&&(this.fadeIn.stop(),this.isShowingNow=!1,this.aroundNode=
null,this.fadeOut.play());this.onMouseEnter=this.onMouseLeave=w},_onHide:function(){this.domNode.style.cssText="";this.containerNode.innerHTML="";this._onDeck&&(this.show.apply(this,this._onDeck),this._onDeck=null)}});a("dojo-bidi")&&v.extend({_setAutoTextDir:function(a){this.applyTextDir(a);n.forEach(a.children,function(a){this._setAutoTextDir(a)},this)},_setTextDirAttr:function(a){this._set("textDir",a);"auto"==a?this._setAutoTextDir(this.containerNode):this.containerNode.dir=this.textDir}});x.showTooltip=
function(a,b,c,d,e,f,g){c&&(c=n.map(c,function(a){return{after:"after-centered",before:"before-centered"}[a]||a}));z._masterTT||(x._masterTT=z._masterTT=new v);return z._masterTT.show(a,b,c,d,e,f,g)};x.hideTooltip=function(a){return z._masterTT&&z._masterTT.hide(a)};var z=b("dijit.Tooltip",p,{label:"",showDelay:400,hideDelay:400,connectId:[],position:[],selector:"",_setConnectIdAttr:function(a){n.forEach(this._connections||[],function(a){n.forEach(a,function(a){a.remove()})},this);this._connectIds=
n.filter(l.isArrayLike(a)?a:a?[a]:[],function(a){return k.byId(a,this.ownerDocument)},this);this._connections=n.map(this._connectIds,function(a){a=k.byId(a,this.ownerDocument);var b=this.selector,c=b?function(a){return d.selector(b,a)}:function(a){return a},e=this;return[d(a,c(h.enter),function(){e._onHover(this)}),d(a,c("focusin"),function(){e._onHover(this)}),d(a,c(h.leave),l.hitch(e,"_onUnHover")),d(a,c("focusout"),l.hitch(e,"set","state","DORMANT"))]},this);this._set("connectId",a)},addTarget:function(a){a=
a.id||a;-1==n.indexOf(this._connectIds,a)&&this.set("connectId",this._connectIds.concat(a))},removeTarget:function(a){a=n.indexOf(this._connectIds,a.id||a);0<=a&&(this._connectIds.splice(a,1),this.set("connectId",this._connectIds))},buildRendering:function(){this.inherited(arguments);g.add(this.domNode,"dijitTooltipData")},startup:function(){this.inherited(arguments);var a=this.connectId;n.forEach(l.isArrayLike(a)?a:[a],this.addTarget,this)},getContent:function(a){return this.label||this.domNode.innerHTML},
state:"DORMANT",_setStateAttr:function(a){if(!(this.state==a||"SHOW TIMER"==a&&"SHOWING"==this.state||"HIDE TIMER"==a&&"DORMANT"==this.state)){this._hideTimer&&(this._hideTimer.remove(),delete this._hideTimer);this._showTimer&&(this._showTimer.remove(),delete this._showTimer);switch(a){case "DORMANT":this._connectNode&&(z.hide(this._connectNode),delete this._connectNode,this.onHide());break;case "SHOW TIMER":"SHOWING"!=this.state&&(this._showTimer=this.defer(function(){this.set("state","SHOWING")},
this.showDelay));break;case "SHOWING":var b=this.getContent(this._connectNode);if(!b){this.set("state","DORMANT");return}z.show(b,this._connectNode,this.position,!this.isLeftToRight(),this.textDir,l.hitch(this,"set","state","SHOWING"),l.hitch(this,"set","state","HIDE TIMER"));this.onShow(this._connectNode,this.position);break;case "HIDE TIMER":this._hideTimer=this.defer(function(){this.set("state","DORMANT")},this.hideDelay)}this._set("state",a)}},_onHover:function(a){this._connectNode&&a!=this._connectNode&&
this.set("state","DORMANT");this._connectNode=a;this.set("state","SHOW TIMER")},_onUnHover:function(a){this.set("state","HIDE TIMER")},open:function(a){this.set("state","DORMANT");this._connectNode=a;this.set("state","SHOWING")},close:function(){this.set("state","DORMANT")},onShow:function(){},onHide:function(){},destroy:function(){this.set("state","DORMANT");n.forEach(this._connections||[],function(a){n.forEach(a,function(a){a.remove()})},this);this.inherited(arguments)}});z._MasterTooltip=v;z.show=
x.showTooltip;z.hide=x.hideTooltip;z.defaultPosition=["after-centered","before-centered"];return z})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(n,b,m,k){return n("dijit.form.NumberSpinner",[m,k.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(b,e){var f=this.constraints,g=isNaN(b),h=!isNaN(f.max),d=!isNaN(f.min);g&&0!=e&&(b=0<e?d?f.min:h?f.max:0:h?this.constraints.max:d?f.min:0);e=b+e;if(g||
isNaN(e))return b;h&&e>f.max&&(e=f.max);d&&e<f.min&&(e=f.min);return e},_onKeyDown:function(g){if(!(this.disabled||this.readOnly||g.keyCode!=b.HOME&&g.keyCode!=b.END||g.ctrlKey||g.altKey||g.metaKey||"undefined"==typeof this.get("value"))){var e=this.constraints[g.keyCode==b.HOME?"min":"max"];"number"==typeof e&&this._setValueAttr(e,!1);g.stopPropagation();g.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),
function(n,b,m,k,g,e,f,l,h,d){return n("dijit.form._Spinner",l,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:h,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(a){return a},_arrowPressed:function(a,b,e){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),b*e),!1),d.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=
null},_typematicCallback:function(a,c,d){var e=this.smallDelta;c==this.textbox&&(c=d.keyCode,e=c==b.PAGE_UP||c==b.PAGE_DOWN?this.largeDelta:this.smallDelta,c=c==b.UP_ARROW||c==b.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==a?this._arrowReleased(c):this._arrowPressed(c,c==this.upArrowNode?1:-1,e)},_wheelTimer:null,_mouseWheeled:function(a){if(this.focused){a.stopPropagation();a.preventDefault();var b=a.wheelDelta/120;Math.floor(b)!=b&&(b=0<a.wheelDelta?1:-1);a=a.detail?-1*a.detail:b;if(0!==a){var d=
this[0<a?"upArrowNode":"downArrowNode"];this._arrowPressed(d,a,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(d)},50)}}},_setConstraintsAttr:function(a){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):
this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(a,b){this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(e(this.domNode,g.wheel,m.hitch(this,"_mouseWheeled")),f.addListener(this.upArrowNode,this.textbox,{keyCode:b.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),f.addListener(this.downArrowNode,this.textbox,
{keyCode:b.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),f.addListener(this.upArrowNode,this.textbox,{keyCode:b.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),f.addListener(this.downArrowNode,this.textbox,{keyCode:b.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,
this.defaultTimeout,this.minimumTimeout))}})})},"dijit/typematic":function(){define("dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/on dojo/sniff ./main".split(" "),function(n,b,m,k,g,e){var f=e.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(0>this._currentTimeout?this._initialDelay:1<this._subsequentDelay?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);
this._timer=setTimeout(m.hitch(this,"_fireEventAndReload"),this._currentTimeout)},trigger:function(b,e,d,a,c,f,g,k){if(c!=this._obj){this.stop();this._initialDelay=g||500;this._subsequentDelay=f||.9;this._minDelay=k||10;this._obj=c;this._node=d;this._count=this._currentTimeout=-1;this._callback=m.hitch(e,a);this._evt={faux:!0};for(var h in b)"layerX"!=h&&"layerY"!=h&&(e=b[h],"function"!=typeof e&&"undefined"!=typeof e&&(this._evt[h]=e));this._fireEventAndReload()}},stop:function(){this._timer&&(clearTimeout(this._timer),
this._timer=null);this._obj&&(this._callback(-1,this._node,this._evt),this._obj=null)},addKeyListener:function(e,g,d,a,c,q,p){var h="keyCode"in g?"keyCode":"charCode"in g?"charCode":"charOrCode",l=[k(e,"keyCode"in g?"keydown":"charCode"in g?"keypress":b._keypress,m.hitch(this,function(b){b[h]!=g[h]||void 0!==g.ctrlKey&&g.ctrlKey!=b.ctrlKey||void 0!==g.altKey&&g.altKey!=b.altKey||void 0!==g.metaKey&&g.metaKey!=(b.metaKey||!1)||void 0!==g.shiftKey&&g.shiftKey!=b.shiftKey?f._obj==g&&f.stop():(b.stopPropagation(),
b.preventDefault(),f.trigger(b,d,e,a,g,c,q,p))})),k(e,"keyup",m.hitch(this,function(){f._obj==g&&f.stop()}))];return{remove:function(){n.forEach(l,function(a){a.remove()})}}},addMouseListener:function(b,e,d,a,c,q){var h=[k(b,"mousedown",m.hitch(this,function(g){g.preventDefault();f.trigger(g,e,b,d,b,a,c,q)})),k(b,"mouseup",m.hitch(this,function(a){this._obj&&a.preventDefault();f.stop()})),k(b,"mouseout",m.hitch(this,function(a){this._obj&&a.preventDefault();f.stop()})),k(b,"dblclick",m.hitch(this,
function(h){h.preventDefault();9>g("ie")&&(f.trigger(h,e,b,d,b,a,c,q),setTimeout(m.hitch(this,f.stop),50))}))];return{remove:function(){n.forEach(h,function(a){a.remove()})}}},addListener:function(b,e,d,a,c,f,g,k){var h=[this.addKeyListener(e,d,a,c,f,g,k),this.addMouseListener(b,a,c,f,g,k)];return{remove:function(){n.forEach(h,function(a){a.remove()})}}}};return f})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(n,
b,m){return n("dijit.form.RangeBoundTextBox",m,{rangeMessage:"",rangeCheck:function(b,g){return("min"in g?0<=this.compare(b,g.min):!0)&&("max"in g?0>=this.compare(b,g.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var b=this.get("value");if(null==b)return!1;var g=!1;"min"in this.constraints&&(g=this.constraints.min,g=0>this.compare(b,"number"==typeof g&&0<=g&&0!=b?0:g));!g&&"max"in this.constraints&&(g=this.constraints.max,
g=0<this.compare(b,"number"!=typeof g||0<g?g:0));return g},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(b){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(b))},getErrorMessage:function(b){var g=this.get("value");return null==g||""===g||"number"==typeof g&&isNaN(g)||this.isInRange(b)?this.inherited(arguments):this.rangeMessage},postMixInProperties:function(){this.inherited(arguments);
this.rangeMessage||(this.messages=b.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(n,b,m,k){return n("dijit.form.MappedTextBox",k,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(b){return b.toString?b.toString():""},toString:function(){var b=
this.filter(this.get("value"));return null!=b?"string"==typeof b?b:this.serialize(b,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=m.place("\x3cinput type\x3d'hidden'"+(this.name?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/ValidationTextBox":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/i18n ./TextBox ../Tooltip dojo/text!./templates/ValidationTextBox.html dojo/i18n!./nls/validate".split(" "),
function(n,b,m,k,g,e,f){var l=n("dijit.form.ValidationTextBox",g,{templateString:f,required:!1,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},pattern:".*",regExp:"",regExpGen:function(){},state:"",tooltipPosition:[],_deprecateRegExp:function(e,d){d!=l.prototype[e]&&(b.deprecated("ValidationTextBox id\x3d"+this.id+", set('"+e+"', ...) is deprecated.  Use set('pattern', ...) instead.","","2.0"),this.set("pattern",d))},_setRegExpGenAttr:function(b){this._deprecateRegExp("regExpGen",
b);this._set("regExpGen",this._computeRegexp)},_setRegExpAttr:function(b){this._deprecateRegExp("regExp",b)},_setValueAttr:function(){this.inherited(arguments);this._refreshState()},validator:function(b,d){return(new RegExp("^(?:"+this._computeRegexp(d)+")"+(this.required?"":"?")+"$")).test(b)&&(!this.required||!this._isEmpty(b))&&(this._isEmpty(b)||void 0!==this.parse(b,d))},_isValidSubset:function(){return 0==this.textbox.value.search(this._partialre)},isValid:function(){return this.validator(this.textbox.value,
this.get("constraints"))},_isEmpty:function(b){return(this.trim?/^\s*$/:/^$/).test(b)},getErrorMessage:function(){var b="$_unset_$"==this.invalidMessage?this.messages.invalidMessage:this.invalidMessage?this.invalidMessage:this.promptMessage,d="$_unset_$"==this.missingMessage?this.messages.missingMessage:this.missingMessage?this.missingMessage:b;return this.required&&this._isEmpty(this.textbox.value)?d:b},getPromptMessage:function(){return this.promptMessage},_maskValidSubsetError:!0,validate:function(b){var d=
"",a=this.disabled||this.isValid(b);a&&(this._maskValidSubsetError=!0);var c=this._isEmpty(this.textbox.value),e=!a&&b&&this._isValidSubset();this._set("state",a?"":((!this._hasBeenBlurred||b)&&c||e)&&(this._maskValidSubsetError||e&&!this._hasBeenBlurred&&b)?"Incomplete":"Error");this.focusNode.setAttribute("aria-invalid","Error"==this.state?"true":"false");"Error"==this.state?(this._maskValidSubsetError=b&&e,d=this.getErrorMessage(b)):"Incomplete"==this.state?(d=this.getPromptMessage(b),this._maskValidSubsetError=
!this._hasBeenBlurred||b):c&&(d=this.getPromptMessage(b));this.set("message",d);return a},displayMessage:function(b){b&&this.focused?e.show(b,this.domNode,this.tooltipPosition,!this.isLeftToRight()):e.hide(this.domNode)},_refreshState:function(){this._created&&this.validate(this.focused);this.inherited(arguments)},constructor:function(b){this.constraints=m.clone(this.constraints);this.baseClass+=" dijitValidationTextBox"},startup:function(){this.inherited(arguments);this._refreshState()},_setConstraintsAttr:function(b){!b.locale&&
this.lang&&(b.locale=this.lang);this._set("constraints",b);this._refreshState()},_setPatternAttr:function(b){this._set("pattern",b);this._refreshState()},_computeRegexp:function(b){var d=this.pattern;"function"==typeof d&&(d=d.call(this,b));if(d!=this._lastRegExp){var a="";this._lastRegExp=d;".*"!=d&&d.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,function(b){switch(b.charAt(0)){case "{":case "+":case "?":case "*":case "^":case "$":case "|":case "(":a+=b;break;case ")":a+="|$)";break;default:a+=
"(?:"+b+"|$)"}});try{"".search(a)}catch(c){a=this.pattern,console.warn("RegExp error in "+this.declaredClass+": "+this.pattern)}this._partialre="^(?:"+a+")$"}return d},postMixInProperties:function(){this.inherited(arguments);this.messages=k.getLocalization("dijit.form","validate",this.lang);this._setConstraintsAttr(this.constraints)},_setDisabledAttr:function(b){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(b){this._set("required",b);this.focusNode.setAttribute("aria-required",
b);this._refreshState()},_setMessageAttr:function(b){this._set("message",b);this.displayMessage(b)},reset:function(){this._maskValidSubsetError=!0;this.inherited(arguments)},_onBlur:function(){this.displayMessage("");this.inherited(arguments)},destroy:function(){e.hide(this.domNode);this.inherited(arguments)}});return l})},"dijit/form/TextBox":function(){define("dojo/_base/declare dojo/dom-construct dojo/dom-style dojo/_base/kernel dojo/_base/lang dojo/on dojo/sniff ./_FormValueWidget ./_TextBoxMixin dojo/text!./templates/TextBox.html ../main".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){l=n("dijit.form.TextBox"+(f("dojo-bidi")?"_NoBidi":""),[l,h],{templateString:d,_singleNodeTemplate:'\x3cinput class\x3d"dijit dijitReset dijitLeft dijitInputField" data-dojo-attach-point\x3d"textbox,focusNode" autocomplete\x3d"off" type\x3d"${type}" ${!nameAttrSetting} /\x3e',_buttonInputDisabled:f("ie")?"disabled":"",baseClass:"dijitTextBox",postMixInProperties:function(){var a=this.type.toLowerCase();if(this.templateString&&"input"==this.templateString.toLowerCase()||
("hidden"==a||"file"==a)&&this.templateString==this.constructor.prototype.templateString)this.templateString=this._singleNodeTemplate;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);9>f("ie")&&this.defer(function(){try{var a=m.getComputedStyle(this.domNode);if(a){var b=a.fontFamily;if(b){var d=this.domNode.getElementsByTagName("INPUT");if(d)for(a=0;a<d.length;a++)d[a].style.fontFamily=b}}}catch(t){}})},_setPlaceHolderAttr:function(a){this._set("placeHolder",a);this._phspan||
(this._attachPoints.push("_phspan"),this._phspan=b.create("span",{className:"dijitPlaceHolder dijitInputField"},this.textbox,"after"),this.own(e(this._phspan,"mousedown",function(a){a.preventDefault()}),e(this._phspan,"touchend, pointerup, MSPointerUp",g.hitch(this,function(){this.focus()}))));this._phspan.innerHTML="";this._phspan.appendChild(this._phspan.ownerDocument.createTextNode(a));this._updatePlaceHolder()},_onInput:function(a){this.inherited(arguments);this._updatePlaceHolder()},_updatePlaceHolder:function(){this._phspan&&
(this._phspan.style.display=this.placeHolder&&!this.textbox.value?"":"none")},_setValueAttr:function(a,b,d){this.inherited(arguments);this._updatePlaceHolder()},getDisplayedValue:function(){k.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use get('displayedValue') instead.","","2.0");return this.get("displayedValue")},setDisplayedValue:function(a){k.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use set('displayedValue', ...) instead.","","2.0");this.set("displayedValue",
a)},_onBlur:function(a){this.disabled||(this.inherited(arguments),this._updatePlaceHolder(),this.selectOnClick&&(this.textbox.selectionStart=this.textbox.selectionEnd=void 0))},_onFocus:function(a){this.disabled||this.readOnly||(this.inherited(arguments),this._updatePlaceHolder())}});9>f("ie")&&(l.prototype._isTextSelected=function(){var a=this.ownerDocument.selection.createRange();return a.parentElement()==this.textbox&&0<a.text.length},a._setSelectionRange=h._setSelectionRange=function(a,b,d){a.createTextRange&&
(a=a.createTextRange(),a.collapse(!0),a.moveStart("character",-99999),a.moveStart("character",b),a.moveEnd("character",d-b),a.select())});f("dojo-bidi")&&(l=n("dijit.form.TextBox",l,{_setPlaceHolderAttr:function(a){this.inherited(arguments);this.applyTextDir(this._phspan)}}));return l})},"dijit/form/_TextBoxMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/sniff dojo/keys dojo/_base/lang dojo/on ../main".split(" "),function(n,b,m,k,g,e,f,l){var h=b("dijit.form._TextBoxMixin"+
(k("dojo-bidi")?"_NoBidi":""),null,{trim:!1,uppercase:!1,lowercase:!1,propercase:!1,maxLength:"",selectOnClick:!1,placeHolder:"",_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints)},_setValueAttr:function(b,a,c){var d;void 0!==b&&(d=this.filter(b),"string"!=typeof c&&(c=null===d||"number"==typeof d&&isNaN(d)?"":this.filter(this.format(d,this.constraints)),0!=this.compare(d,this.filter(this.parse(c,this.constraints)))&&(c=null)));null==c||"number"==typeof c&&isNaN(c)||
this.textbox.value==c||(this.textbox.value=c,this._set("displayedValue",this.get("displayedValue")));this.inherited(arguments,[d,a])},displayedValue:"",_getDisplayedValueAttr:function(){return this.filter(this.textbox.value)},_setDisplayedValueAttr:function(b){null==b?b="":"string"!=typeof b&&(b=String(b));this.textbox.value=b;this._setValueAttr(this.get("value"),void 0);this._set("displayedValue",this.get("displayedValue"))},format:function(b){return null==b?"":b.toString?b.toString():b},parse:function(b){return b},
_refreshState:function(){},onInput:function(){},_onInput:function(b){this._lastInputEventValue=this.textbox.value;this._processInput(this._lastInputProducingEvent||b);delete this._lastInputProducingEvent;this.intermediateChanges&&this._handleOnChange(this.get("value"),!1)},_processInput:function(){this._refreshState();this._set("displayedValue",this.get("displayedValue"))},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);this.own(f(this.textbox,
"keydown, keypress, paste, cut, compositionend",e.hitch(this,function(b){var a;if("keydown"==b.type&&229!=b.keyCode){a=b.keyCode;switch(a){case g.SHIFT:case g.ALT:case g.CTRL:case g.META:case g.CAPS_LOCK:case g.NUM_LOCK:case g.SCROLL_LOCK:return}if(!b.ctrlKey&&!b.metaKey&&!b.altKey){switch(a){case g.NUMPAD_0:case g.NUMPAD_1:case g.NUMPAD_2:case g.NUMPAD_3:case g.NUMPAD_4:case g.NUMPAD_5:case g.NUMPAD_6:case g.NUMPAD_7:case g.NUMPAD_8:case g.NUMPAD_9:case g.NUMPAD_MULTIPLY:case g.NUMPAD_PLUS:case g.NUMPAD_ENTER:case g.NUMPAD_MINUS:case g.NUMPAD_PERIOD:case g.NUMPAD_DIVIDE:return}if(65<=
a&&90>=a||48<=a&&57>=a||a==g.SPACE)return;a=!1;for(var c in g)if(g[c]===b.keyCode){a=!0;break}if(!a)return}}(a=32<=b.charCode?String.fromCharCode(b.charCode):b.charCode)||(a=65<=b.keyCode&&90>=b.keyCode||48<=b.keyCode&&57>=b.keyCode||b.keyCode==g.SPACE?String.fromCharCode(b.keyCode):b.keyCode);a||(a=229);if("keypress"==b.type){if("string"!=typeof a)return;if("a"<=a&&"z">=a||"A"<=a&&"Z">=a||"0"<=a&&"9">=a||" "===a)if(b.ctrlKey||b.metaKey||b.altKey)return}var d={faux:!0},h;for(h in b)/^(layer[XY]|returnValue|keyLocation)$/.test(h)||
(c=b[h],"function"!=typeof c&&"undefined"!=typeof c&&(d[h]=c));e.mixin(d,{charOrCode:a,_wasConsumed:!1,preventDefault:function(){d._wasConsumed=!0;b.preventDefault()},stopPropagation:function(){b.stopPropagation()}});this._lastInputProducingEvent=d;!1===this.onInput(d)&&(d.preventDefault(),d.stopPropagation());if(!d._wasConsumed&&9>=k("ie"))switch(b.keyCode){case g.TAB:case g.ESCAPE:case g.DOWN_ARROW:case g.UP_ARROW:case g.LEFT_ARROW:case g.RIGHT_ARROW:break;default:b.keyCode==g.ENTER&&"textarea"!=
this.textbox.tagName.toLowerCase()||this.defer(function(){this.textbox.value!==this._lastInputEventValue&&f.emit(this.textbox,"input",{bubbles:!0})})}})),f(this.textbox,"input",e.hitch(this,"_onInput")),f(this.domNode,"keypress",function(b){b.stopPropagation()}))},_blankValue:"",filter:function(b){if(null===b)return this._blankValue;if("string"!=typeof b)return b;this.trim&&(b=e.trim(b));this.uppercase&&(b=b.toUpperCase());this.lowercase&&(b=b.toLowerCase());this.propercase&&(b=b.replace(/[^\s]+/g,
function(a){return a.substring(0,1).toUpperCase()+a.substring(1)}));return b},_setBlurValue:function(){this._setValueAttr(this.get("value"),!0)},_onBlur:function(b){this.disabled||(this._setBlurValue(),this.inherited(arguments))},_isTextSelected:function(){return this.textbox.selectionStart!=this.textbox.selectionEnd},_onFocus:function(b){this.disabled||this.readOnly||(this.selectOnClick&&"mouse"==b&&(this._selectOnClickHandle=f.once(this.domNode,"mouseup, touchend",e.hitch(this,function(a){this._isTextSelected()||
h.selectInputText(this.textbox)})),this.own(this._selectOnClickHandle),this.defer(function(){this._selectOnClickHandle&&(this._selectOnClickHandle.remove(),this._selectOnClickHandle=null)},500)),this.inherited(arguments),this._refreshState())},reset:function(){this.textbox.value="";this.inherited(arguments)}});k("dojo-bidi")&&(h=b("dijit.form._TextBoxMixin",h,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_setDisplayedValueAttr:function(){this.inherited(arguments);
this.applyTextDir(this.focusNode)},_onInput:function(){this.applyTextDir(this.focusNode);this.inherited(arguments)}}));h._setSelectionRange=l._setSelectionRange=function(b,a,c){b.setSelectionRange&&b.setSelectionRange(a,c)};h.selectInputText=l.selectInputText=function(b,a,c){b=m.byId(b);isNaN(a)&&(a=0);isNaN(c)&&(c=b.value?b.value.length:0);try{b.focus(),h._setSelectionRange(b,a,c)}catch(q){}};return h})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),
function(n,b,m,k,g,e){var f=function(b){b=b||{};var d=m.getLocalization("dojo.cldr","number",m.normalizeLocale(b.locale)),a=b.pattern?b.pattern:d[(b.type||"decimal")+"Format"];b="number"==typeof b.places?b.places:"string"===typeof b.places&&0<b.places.length?b.places.replace(/.*,/,""):-1!=a.indexOf(".")?a.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:d.decimal,places:b}},l=n("dijit.form.NumberTextBoxMixin",null,{pattern:function(e){return"("+(this.focused&&this.editOptions?this._regExpGenerator(b.delegate(e,
this.editOptions))+"|":"")+this._regExpGenerator(e)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:g.format,_regExpGenerator:g.regexp,_decimalInfo:f(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(b){var d="number"==typeof b.places?b.places:0;d&&d++;"number"!=typeof b.max&&(b.max=9*Math.pow(10,15-d));"number"!=typeof b.min&&(b.min=-9*Math.pow(10,15-d));this.inherited(arguments,[b]);this.focusNode&&this.focusNode.value&&
!isNaN(this.value)&&this.set("value",this.value);this._decimalInfo=f(b)},_onFocus:function(b){if(!this.disabled&&!this.readOnly){var d=this.get("value");"number"!=typeof d||isNaN(d)||(d=this.format(d,this.constraints),void 0!==d&&(this.textbox.value=d,"mouse"!==b&&this.textbox.select()));this.inherited(arguments)}},format:function(e,d){var a=String(e);if("number"!=typeof e)return a;if(isNaN(e))return"";if(!("rangeCheck"in this&&this.rangeCheck(e,d))&&!1!==d.exponent&&/\de[-+]?\d/i.test(a))return a;
this.editOptions&&this.focused&&(d=b.mixin({},d,this.editOptions));return this._formatter(e,d)},_parser:g.parse,parse:function(e,d){var a=b.mixin({},d,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=a.places){var c=a.places,c="number"===typeof c?c:Number(c.split(",").pop());a.places="0,"+c}a=this._parser(e,a);this.editOptions&&this.focused&&isNaN(a)&&(a=this._parser(e,d));return a},_getDisplayedValueAttr:function(){var b=this.inherited(arguments);return isNaN(b)?this.textbox.value:
b},filter:function(b){if(null==b||"string"==typeof b&&""==b)return NaN;"number"!=typeof b||isNaN(b)||0==b||(b=g.round(b,this._decimalInfo.places));return this.inherited(arguments,[b])},serialize:function(b,d){return"number"!=typeof b||isNaN(b)?"":this.inherited(arguments)},_setBlurValue:function(){var e=b.hitch(b.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(e,!0)},_setValueAttr:function(b,d,a){if(void 0!==b&&void 0===a)if(a=String(b),"number"==typeof b)if(isNaN(b))a="";else{if("rangeCheck"in
this&&this.rangeCheck(b,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(a))a=void 0}else b?b=void 0:(a="",b=NaN);this.inherited(arguments,[b,d,a])},_getValueAttr:function(){var e=this.inherited(arguments);if(isNaN(e)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+g._realNumberRegexp(b.delegate(this.constraints))+"$")).test(this.textbox.value))return e=Number(this.textbox.value),isNaN(e)?void 0:e}else return e},
isValid:function(b){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);var d=this.get("value");return!isNaN(d)&&this.rangeCheck(d,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var b="number"==typeof this.constraints.min,d="number"==typeof this.constraints.max,a=this.get("value");if(isNaN(a)||!b&&!d)return this.inherited(arguments);var c=a|0,e=0>a,f=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),
g=(this.maxLength||20)-this.textbox.value.length,l=f?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"",c=f?c+"."+l:c+"",g=k.rep("9",g),f=a;e?f=Number(c+g):a=Number(c+g);return!(b&&a<this.constraints.min||d&&f>this.constraints.max)}});n=n("dijit.form.NumberTextBox",[e,l],{baseClass:"dijitTextBox dijitNumberTextBox"});n.Mixin=l;return n})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a){var c=h("dijit.ColorPalette",[m,k,g],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:b,baseClass:"dijitColorPalette",_dyeFactory:function(a,b,c,d){return new this._dyeClass(a,
b,c,d)},buildRendering:function(){this.inherited(arguments);this._dyeClass=h(c._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],f.getLocalization("dojo","colors",this.lang))}});c._Color=h("dijit._Color",l,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":n.toUrl("./themes/a11y/colors7x10.png"),"3x4":n.toUrl("./themes/a11y/colors3x4.png")},constructor:function(a,b,c,d){this._title=d;this._row=b;this._col=c;this.setColor(l.named[a])},getValue:function(){return this.toHex()},fillCell:function(b,c){c=a.substitute(e("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:c,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});d.place(c,b)}});return c})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(n,b,m,k,g,e,f,l,h,d,a){return n("dijit._PaletteMixin",l,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(a){return new ("string"==
typeof this.dyeClass?e.getObject(this.dyeClass):this.dyeClass)(a)},_preparePalette:function(b,d){this._cells=[];var c=this._blankGif;this.own(f(this.gridNode,h,e.hitch(this,"_onCellClick")));for(var l=0;l<b.length;l++)for(var m=k.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),n=0;n<b[l].length;n++){var q=b[l][n];if(q){var w=this._dyeFactory(q,l,n,d[q]),q=k.create("td",{"class":this.cellClass,tabIndex:"-1",title:d[q],role:"gridcell"},m);w.fillCell(q,c);q.idx=this._cells.length;this._cells.push({node:q,
dye:w})}}this._xDim=b[0].length;this._yDim=b.length;var v={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},z;for(z in v)this.own(a.addKeyListener(this.domNode,{keyCode:g[z],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=v[z];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){d.focus(this._currentFocus)},
_onCellClick:function(a){for(var b=a.target;"TD"!=b.tagName;){if(!b.parentNode||b==this.gridNode)return;b=b.parentNode}var c=this._getDye(b).getValue();this._setCurrent(b);d.focus(b);this._setValueAttr(c,!0);a.stopPropagation();a.preventDefault()},_setCurrent:function(a){"_currentFocus"in this&&b.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=a)&&b.set(a,"tabIndex",this.tabIndex)},_setValueAttr:function(a,b){0<=this._selectedCell&&m.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(a)for(var c=0;c<this._cells.length;c++)if(a==this._cells[c].dye.getValue()){this._selectedCell=c;m.add(this._cells[c].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?a:null);if(b||void 0===b)this.onChange(a)},onChange:function(){},_navigateByKey:function(a,b){-1!=b&&(a=this._currentFocus.idx+a,a<this._cells.length&&-1<a&&(a=this._cells[a].node,this._setCurrent(a),this.defer(e.hitch(d,"focus",a))))},_getDye:function(a){return this._cells[a.idx].dye}})})},
"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(n,b,m,k){var g={};b.setObject("dojo.colors",g);var e=function(b,e,d){0>d&&++d;1<d&&--d;var a=6*d;return 1>a?b+(e-b)*a:1>2*d?e:2>3*d?b+(e-b)*(2/3-d)*6:b};n.colorFromRgb=m.fromRgb=function(b,f){var d=b.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(d){b=d[2].split(/\s*,\s*/);var a=b.length,d=d[1];if("rgb"==d&&3==a||"rgba"==d&&4==a)return d=b[0],"%"==d.charAt(d.length-1)?(d=k.map(b,
function(a){return 2.56*parseFloat(a)}),4==a&&(d[3]=b[3]),m.fromArray(d,f)):m.fromArray(b,f);if("hsl"==d&&3==a||"hsla"==d&&4==a){var d=(parseFloat(b[0])%360+360)%360/360,c=parseFloat(b[1])/100,g=parseFloat(b[2])/100,c=.5>=g?g*(c+1):g+c-g*c,g=2*g-c,d=[256*e(g,c,d+1/3),256*e(g,c,d),256*e(g,c,d-1/3),1];4==a&&(d[3]=b[3]);return m.fromArray(d,f)}}return null};var f=function(b,e,d){b=Number(b);return isNaN(b)?d:b<e?e:b>d?d:b};m.prototype.sanitize=function(){this.r=Math.round(f(this.r,0,255));this.g=Math.round(f(this.g,
0,255));this.b=Math.round(f(this.b,0,255));this.a=f(this.a,0,1);return this};g.makeGrey=m.makeGrey=function(b,e){return m.fromArray([b,b,b,e])};b.mixin(m.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,
149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,
0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],
lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,
0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,
232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,
250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return m})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),
function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z){var y=b("dijit.form._SliderMover",a,{onMouseMove:function(a){var b=this.widget,c=b._abspos;c||(c=b._abspos=g.position(b.sliderBarContainer,!0),b._setPixelValue_=l.hitch(b,"_setPixelValue"),b._isReversed_=b._isReversed());a=a[b._mousePixelCoord]-c[b._startingPixelCoord];b._setPixelValue_(b._isReversed_?c[b._pixelCount]-a:a,c[b._pixelCount],!1)},destroy:function(b){a.prototype.destroy.apply(this,arguments);var c=this.widget;c._abspos=null;c._setValueAttr(c.value,
!0)}});m=b("dijit.form.HorizontalSlider",[w,v],{templateString:z,value:0,showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:t.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",
_onKeyUp:function(a){this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey||this._setValueAttr(this.value,!0)},_onKeyDown:function(a){if(!(this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey)){switch(a.keyCode){case f.HOME:this._setValueAttr(this.minimum,!1);break;case f.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?f.RIGHT_ARROW:f.LEFT_ARROW:case !1===this._descending?f.DOWN_ARROW:f.UP_ARROW:case !1===this._descending?f.PAGE_DOWN:f.PAGE_UP:this.increment(a);
break;case this._descending||this.isLeftToRight()?f.LEFT_ARROW:f.RIGHT_ARROW:case !1===this._descending?f.UP_ARROW:f.DOWN_ARROW:case !1===this._descending?f.PAGE_UP:f.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(a){this.disabled||this.readOnly||(h("ie")||u.focus(this.sliderHandle),a.stopPropagation(),a.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(a){if(!this.disabled&&!this.readOnly&&
this.clickSelect){u.focus(this.sliderHandle);a.stopPropagation();a.preventDefault();var b=g.position(this.sliderBarContainer,!0),c=a[this._mousePixelCoord]-b[this._startingPixelCoord];this._setPixelValue(this._isReversed()?b[this._pixelCount]-c:c,b[this._pixelCount],!0);this._movable.onMouseDown(a)}},_setPixelValue:function(a,b,c){if(!this.disabled&&!this.readOnly){var d=this.discreteValues;if(1>=d||Infinity==d)d=b;d--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(a/
(b/d))/d+this.minimum,this.maximum),this.minimum),c)}},_setValueAttr:function(a,b){this._set("value",a);this.valueNode.value=a;this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments);var c=this.maximum>this.minimum?(a-this.minimum)/(this.maximum-this.minimum):0,d=!1===this._descending?this.remainingBar:this.progressBar,e=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(b&&0<this.slideDuration&&
d.style[this._progressPixelSize]){var f=this,g={},h=parseFloat(d.style[this._progressPixelSize]),l=this.slideDuration*(c-h/100);0!=l&&(0>l&&(l=0-l),g[this._progressPixelSize]={start:h,end:100*c,units:"%"},this._inProgressAnim=k.animateProperty({node:d,duration:l,onAnimate:function(a){e.style[f._progressPixelSize]=100-parseFloat(a[f._progressPixelSize])+"%"},onEnd:function(){delete f._inProgressAnim},properties:g}),this._inProgressAnim.play())}else d.style[this._progressPixelSize]=100*c+"%",e.style[this._progressPixelSize]=
100*(1-c)+"%"},_bumpValue:function(a,b){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var c=e.getComputedStyle(this.sliderBarContainer),d=g.getContentBox(this.sliderBarContainer,c),c=this.discreteValues;if(1>=c||Infinity==c)c=d[this._pixelCount];c--;a=Math.round((this.value-this.minimum)*c/(this.maximum-this.minimum))+a;0>a&&(a=0);a>c&&(a=c);a=a*(this.maximum-this.minimum)/c+this.minimum;this._setValueAttr(a,b)}},_onClkBumper:function(a){this.disabled||this.readOnly||!this.clickSelect||
this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==f.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==f.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){this.focused&&(a.stopPropagation(),a.preventDefault(),this._bumpValue(0>a.wheelDelta?-1:1,!0))},
startup:function(){this._started||(n.forEach(this.getChildren(),function(a){this[a.container]!=this.containerNode&&this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,b,c){if(-1==a)this._setValueAttr(this.value,!0);else this[b==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](c)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display=
"");var a=c('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",a[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(r.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),r.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(p(this.domNode,
q.wheel,l.hitch(this,"_mouseWheeled")));var a=b(y,{widget:this});this._movable=new d(this.sliderHandle,{mover:a});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});m._Mover=y;return m})},"dijit/form/Button":function(){define("require dojo/_base/declare dojo/dom-class dojo/has dojo/_base/kernel dojo/_base/lang dojo/ready ./_FormWidget ./_ButtonMixin dojo/text!./templates/Button.html ../a11yclick".split(" "),
function(n,b,m,k,g,e,f,l,h,d){k("dijit-legacy-requires")&&f(0,function(){n(["dijit/form/DropDownButton","dijit/form/ComboButton","dijit/form/ToggleButton"])});f=b("dijit.form.Button"+(k("dojo-bidi")?"_NoBidi":""),[l,h],{showLabel:!0,iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},baseClass:"dijitButton",templateString:d,_setValueAttr:"valueNode",_setNameAttr:function(a){this.valueNode&&this.valueNode.setAttribute("name",a)},postCreate:function(){this.inherited(arguments);
this._setLabelFromContainer()},_setLabelFromContainer:function(){this.containerNode&&!this.label&&(this.label=e.trim(this.containerNode.innerHTML),this.onLabelSet())},_setShowLabelAttr:function(a){this.containerNode&&m.toggle(this.containerNode,"dijitDisplayNone",!a);this._set("showLabel",a)},setLabel:function(a){g.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},onLabelSet:function(){this.inherited(arguments);this.showLabel||
"title"in this.params||(this.titleNode.title=e.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});k("dojo-bidi")&&(f=b("dijit.form.Button",f,{onLabelSet:function(){this.inherited(arguments);this.titleNode.title&&this.applyTextDir(this.titleNode,this.titleNode.title)},_setTextDirAttr:function(a){this._created&&this.textDir!=a&&(this._set("textDir",a),this._setLabelAttr(this.label))}}));return f})},"dijit/form/_ButtonMixin":function(){define(["dojo/_base/declare","dojo/dom",
"dojo/has","../registry"],function(n,b,m,k){var g=n("dijit.form._ButtonMixin"+(m("dojo-bidi")?"_NoBidi":""),null,{label:"",type:"button",__onClick:function(b){b.stopPropagation();b.preventDefault();this.disabled||this.valueNode.click(b);return!1},_onClick:function(b){if(this.disabled)return b.stopPropagation(),b.preventDefault(),!1;!1===this.onClick(b)&&b.preventDefault();var e=b.defaultPrevented;if(!e&&"submit"==this.type&&!(this.valueNode||this.focusNode).form)for(var g=this.domNode;g.parentNode;g=
g.parentNode){var h=k.byNode(g);if(h&&"function"==typeof h._onSubmit){h._onSubmit(b);b.preventDefault();e=!0;break}}return!e},postCreate:function(){this.inherited(arguments);b.setSelectable(this.focusNode,!1)},onClick:function(){return!0},_setLabelAttr:function(b){this._set("label",b);(this.containerNode||this.focusNode).innerHTML=b;this.onLabelSet()},onLabelSet:function(){}});m("dojo-bidi")&&(g=n("dijit.form._ButtonMixin",g,{onLabelSet:function(){this.inherited(arguments);this.applyTextDir(this.containerNode||
this.focusNode)}}));return g})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(n,b,m){return n("dijit.form.HorizontalRule",[b,m],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(b){return this._positionPrefix+
b+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var b;if(1==this.count)b=this._genHTML(50,0);else{var g,e=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){b=this._genHTML(0,0);for(g=1;g<this.count-1;g++)b+=this._genHTML(e*g,g);b+=this._genHTML(100,this.count-1)}else{b=this._genHTML(100,0);for(g=1;g<this.count-1;g++)b+=this._genHTML(100-e*g,g);b+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=b}})})},"dojo/_base/query":function(){define(["../query",
"./NodeList"],function(n){return n})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(n,b,m,k,g,e,f,l,h){k("dijit-legacy-requires")&&e(0,function(){n(["dijit/form/RadioButton"])});return b("dijit.form.CheckBox",[f,l],{templateString:h,baseClass:"dijitCheckBox",_setValueAttr:function(b,a){"string"==typeof b&&(this.inherited(arguments),
b=!0);this._created&&this.set("checked",b,a)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&g("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&g("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},
"dijit/form/ToggleButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],function(n,b,m,k){return n("dijit.form.ToggleButton",[m,k],{baseClass:"dijitToggleButton",setChecked:function(g){b.deprecated("setChecked("+g+") is deprecated. Use set('checked',"+g+") instead.","","2.0");this.set("checked",g)}})})},"dijit/form/_ToggleButtonMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(n,b){return n("dijit.form._ToggleButtonMixin",null,
{checked:!1,_aria_attr:"aria-pressed",_onClick:function(b){var k=this.checked;this._set("checked",!k);var g=this.inherited(arguments);this.set("checked",g?this.checked:k);return g},_setCheckedAttr:function(m,k){this._set("checked",m);var g=this.focusNode||this.domNode;this._created&&b.get(g,"checked")!=!!m&&b.set(g,"checked",!!m);g.setAttribute(this._aria_attr,String(m));this._handleOnChange(m,k)},postCreate:function(){this.inherited(arguments);var b=this.focusNode||this.domNode;this.checked&&b.setAttribute("checked",
"checked");void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.checked)},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(n,b){return n("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(m){this._set("readOnly",m);b.set(this.focusNode,"readOnly",m)},_setLabelAttr:void 0,
_getSubmitValue:function(b){return null==b||""===b?"on":b},_setValueAttr:function(m){m=this._getSubmitValue(m);this._set("value",m);b.set(this.focusNode,"value",m)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));b.set(this.focusNode,"value",this.value)},_onClick:function(b){return this.readOnly?(b.stopPropagation(),b.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox",
"./ComboBoxMixin"],function(n,b,m){return n("dijit.form.ComboBox",[b,m],{})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),function(n,b,m,k,g,e,f,l,h){return n("dijit.form.ComboBoxMixin",[l,e],{dropDownClass:f,hasDownArrow:!0,templateString:h,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},
_setHasDownArrowAttr:function(b){this._set("hasDownArrow",b);this._buttonNode.style.display=b?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(d){d.get||k.mixin(d,{_oldAPI:!0,get:function(a){var c=new b;this.fetchItemByIdentity({identity:a,onItem:function(a){c.resolve(a)},onError:function(a){c.reject(a)}});return c.promise},query:function(a,c){var d=new b(function(){e.abort&&e.abort()});d.total=new b;var e=this.fetch(k.mixin({query:a,
onBegin:function(a){d.total.resolve(a)},onComplete:function(a){d.resolve(a)},onError:function(a){d.reject(a)}},c));return g(d)}});this._set("store",d)},postMixInProperties:function(){var b=this.params.store||this.store;b&&this._setStoreAttr(b);this.inherited(arguments);if(!this.params.store&&this.store&&!this.store._oldAPI){var a=this.declaredClass;k.mixin(this.store,{getValue:function(b,d){m.deprecated(a+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");
return b[d]},getLabel:function(b){m.deprecated(a+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return b.name},fetch:function(b){m.deprecated(a+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],k.hitch(this,function(a){(new a({objectStore:this})).fetch(b)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},
"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(n,b,m,k,g,e,f,l,h,d,a){b=b("dijit.form._AutoCompleterMixin",a,{item:null,autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(a){var b=0;if("number"==typeof a.selectionStart)b=a.selectionStart;else if(l("ie")){var c=
a.ownerDocument.selection.createRange().duplicate();a=a.createTextRange();c.move("character",0);a.move("character",0);try{a.setEndPoint("EndToEnd",c),b=String(a.text).replace(/\r/g,"").length}catch(t){}}return b},_setCaretPos:function(a,b){b=parseInt(b);d.selectInputText(a,b,b)},_setDisabledAttr:function(a){this.inherited(arguments);this.domNode.setAttribute("aria-disabled",a?"true":"false")},_onKey:function(a){if(!(32<=a.charCode)){var b=a.charCode||a.keyCode;if(b!=k.ALT&&b!=k.CTRL&&b!=k.META&&b!=
k.SHIFT){var c=this.dropDown,d=null;this._abortQuery();this.inherited(arguments);if(!(a.altKey||a.ctrlKey||a.metaKey))switch(this._opened&&(d=c.getHighlightedOption()),b){case k.PAGE_DOWN:case k.DOWN_ARROW:case k.PAGE_UP:case k.UP_ARROW:this._opened&&this._announceOption(d);a.stopPropagation();a.preventDefault();break;case k.ENTER:if(d){if(d==c.nextButton){this._nextSearch(1);a.stopPropagation();a.preventDefault();break}else if(d==c.previousButton){this._nextSearch(-1);a.stopPropagation();a.preventDefault();
break}a.stopPropagation();a.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case k.TAB:b=this.get("displayedValue");if(c&&(b==c._messages.previousMessage||b==c._messages.nextMessage))break;d&&this._selectOption(d);case k.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},_autoCompleteText:function(a){var b=this.focusNode;d.selectInputText(b,b.value.length);var c=this.ignoreCase?"toLowerCase":"substr";0==a[c](0).indexOf(this.focusNode.value[c](0))?
(c=this.autoComplete?this._getCaretPos(b):b.value.length,c+1>b.value.length&&(b.value=a,d.selectInputText(b,c))):(b.value=a,d.selectInputText(b))},_openResultList:function(a,b,d){var c=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();a.length||0!=d.start?(this._nextSearch=this.dropDown.onPage=g.hitch(this,function(b){a.nextPage(-1!==b);this.focus()}),this.dropDown.createOptions(a,d,g.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in d?(d.direction?this.dropDown.highlightFirstOption():
d.direction||this.dropDown.highlightLastOption(),c&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(b[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();
this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var a=this.get("displayedValue"),b=this.dropDown;!b||a!=b._messages.previousMessage&&a!=b._messages.nextMessage?"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",a)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},
_setItemAttr:function(a,b,d){var c="";a&&(d||(d=this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]),c=this._getValueField()!=this.searchAttr?this.store.getIdentity(a):d);this.set("value",c,b,d,a)},_announceOption:function(a){if(a){var b;if(a==this.dropDown.nextButton||a==this.dropDown.previousButton)b=a.innerHTML,this.item=void 0,this.value="";else{var c=this.dropDown.items[a.getAttribute("item")];b=(this.store._oldAPI?this.store.getValue(c,this.searchAttr):c[this.searchAttr]).toString();
this.set("item",c,!1,b)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",m.get(a,"id"));this._autoCompleteText(b)}},_selectOption:function(a){this.closeDropDown();a&&this._announceOption(a);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=
void 0;this.inherited(arguments)},_startSearch:function(a){if(!this.dropDown){var b=this.id+"_popup";this.dropDown=new (g.isString(this.dropDownClass)?g.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:g.hitch(this,this._selectOption),id:b,dir:this.dir,textDir:this.textDir})}this._lastInput=a;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new h({},this.srcNodeRef),
!("value"in this.params))){var a=this.item=this.store.fetchSelectedItem();if(a){var b=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(a,b):a[b]}}},postCreate:function(){var a=e('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",a[0].id));this.inherited(arguments);n.after(this,"onSearch",g.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(a){a=this.labelFunc(a,this.store);var b=this.labelType;
"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(a=this.doHighlight(a,this._lastInput),b="html");return{html:"html"==b,label:a}},doHighlight:function(a,b){var c=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?"g":""),d=this.queryExpr.indexOf("${0}");b=f.escapeString(b);return this._escapeHtml(a.replace(new RegExp((0==d?"^":"")+"("+b+")"+(d==this.queryExpr.length-4?"$":""),c),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},
_escapeHtml:function(a){return a=String(a).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(a,b){return(b._oldAPI?b.getValue(a,this.labelAttr||this.searchAttr):a[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(a,b,d,e){this._set("item",e||null);null==a&&(a="");this.inherited(arguments)}});l("dojo-bidi")&&b.extend({_setTextDirAttr:function(a){this.inherited(arguments);
this.dropDown&&this.dropDown._set("textDir",a)}});return b})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),function(n,b,m,k,g,e){function f(b){return{id:b.value,value:b.value,name:m.trim(b.innerText||b.textContent||"")}}return n("dijit.form.DataList",g,{constructor:function(g,h){this.domNode=b.byId(h);m.mixin(this,g);this.id&&e.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:k("option",
this.domNode).map(f)}])},destroy:function(){e.remove(this.id)},fetchSelectedItem:function(){var b=k("\x3e option[selected]",this.domNode)[0]||k("\x3e option",this.domNode)[0];return b&&f(b)}})})},"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(n,b,m,k,g,e,f){return n("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(b){this._set("list",
b)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(b){return new RegExp("^"+b.replace(/(\\.)|(\*)|(\?)|\W/g,function(b,d,a,c){return a?".*":c?".":d?d:"\\"+b})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=
!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(e){if(!this.disabled&&!this.readOnly){e=e.charOrCode;this._prev_key_backspace=!1;if(e==b.DELETE||e==b.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},
_startSearch:function(b){this._abortQuery();var f=this,d=m.clone(this.query),a={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},c=g.substitute(this.queryExpr,[b.replace(/([\\\*\?])/g,"\\$1")]),k,l=function(){var b=f._fetchHandle=f.store.query(d,a);f.disabled||f.readOnly||k!==f._lastQuery||e(b,function(c){f._fetchHandle=null;f.disabled||f.readOnly||k!==f._lastQuery||e(b.total,function(b){c.total=b;var e=f.pageSize;if(isNaN(e)||e>c.total)e=c.total;c.nextPage=function(b){a.direction=
b=!1!==b;a.count=e;b?(a.start+=c.length,a.start>=c.total&&(a.count=0)):(a.start-=e,0>a.start&&(a.count=Math.max(e+a.start,0),a.start=0));0>=a.count?(c.length=0,f.onSearch(c,d,a)):l()};f.onSearch(c,d,a)})},function(a){f._fetchHandle=null;f._cancelingQuery||console.error(f.declaredClass+" "+a.toString())})};m.mixin(a,this.fetchProperties);this.store._oldAPI?k=c:(k=this._patternToRegExp(c),k.toString=function(){return c});this._lastQuery=d[this.searchAttr]=k;this._queryDeferHandle=this.defer(l,this.searchDelay)},
constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var b=this.list;b&&(this.store=f.byId(b))}this.inherited(arguments)}})})},"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(n,b,m,k,g,e,f,l){return n("dijit.form._ComboBoxMenu",[g,e,l,f],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(b.add(this.previousButton,"dijitMenuItemRtl"),b.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var b=this.ownerDocument.createElement("div");b.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");b.setAttribute("role","option");return b},onHover:function(e){b.add(e,"dijitMenuItemHover")},onUnhover:function(e){b.remove(e,
"dijitMenuItemHover")},onSelect:function(e){b.add(e,"dijitMenuItemSelected")},onDeselect:function(e){b.remove(e,"dijitMenuItemSelected")},_page:function(b){var d=0,a=this.domNode.scrollTop,c=m.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();d<c;){var e=this.getHighlightedOption();if(b){if(!e.previousSibling||"none"==e.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!e.nextSibling||"none"==e.nextSibling.style.display)break;this.selectNextNode()}e=
this.domNode.scrollTop;d+=(e-a)*(b?-1:1);a=e}},handleKey:function(b){switch(b.keyCode){case k.DOWN_ARROW:return this.selectNextNode(),!1;case k.PAGE_DOWN:return this._page(!1),!1;case k.UP_ARROW:return this.selectPreviousNode(),!1;case k.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(n,b,m,k,g){var e=b("dijit.form._ComboBoxMenuMixin"+
(k("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=g.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(b){this._set("value",b);this.onChange(b)},onClick:function(b){if(b==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(b==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(b)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(b,e){var f=this._createMenuItem();b=e(b);b.html?f.innerHTML=b.label:f.appendChild(f.ownerDocument.createTextNode(b.label));""==f.innerHTML&&(f.innerHTML="\x26#160;");return f},createOptions:function(b,e,g){this.items=b;this.previousButton.style.display=0==e.start?"none":"";m.set(this.previousButton,"id",this.id+
"_prev");n.forEach(b,function(a,b){a=this._createOption(a,g);a.setAttribute("item",b);m.set(a,"id",this.id+b);this.nextButton.parentNode.insertBefore(a,this.nextButton)},this);var d=!1;b.total&&!b.total.then&&-1!=b.total?e.start+e.count<b.total?d=!0:e.start+e.count>b.total&&e.count==b.length&&(d=!0):e.count==b.length&&(d=!0);this.nextButton.style.display=d?"":"none";m.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var b=this.containerNode;2<b.childNodes.length;)b.removeChild(b.childNodes[b.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});k("dojo-bidi")&&(e=b("dijit.form._ComboBoxMenuMixin",
e,{_createOption:function(){var b=this.inherited(arguments);this.applyTextDir(b);return b}}));return e})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(n,b,m,k){return n("dijit.form._ListMouseMixin",k,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(b,e){this._setSelectedAttr(e,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(e)})},_onMouseDown:function(b,e){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(e,!1)},_onMouseUp:function(b,e){this._isDragging=!1;var f=this.selected,g=this._hoveredNode;f&&e==f?this.defer(function(){this._onClick(b,
f)}):g&&this.defer(function(){this._onClick(b,g)})},_onMouseOut:function(b,e){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(b,e){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=e;this.onHover(e);this._isDragging&&this._setSelectedAttr(e,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(n,b,m){return n("dijit.form._ListBase",null,{selected:null,_listConnect:function(k,g){var e=this;return e.own(b(e.containerNode,b.selector(function(b,e,g){return b.parentNode==g},k),function(b){e[g](b,this)}))},selectFirstNode:function(){for(var b=this.containerNode.firstChild;b&&"none"==b.style.display;)b=b.nextSibling;this._setSelectedAttr(b,!0)},selectLastNode:function(){for(var b=this.containerNode.lastChild;b&&"none"==b.style.display;)b=b.previousSibling;this._setSelectedAttr(b,
!0)},selectNextNode:function(){var b=this.selected;if(b){for(b=b.nextSibling;b&&"none"==b.style.display;)b=b.nextSibling;b?this._setSelectedAttr(b,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var b=this.selected;if(b){for(b=b.previousSibling;b&&"none"==b.style.display;)b=b.previousSibling;b?this._setSelectedAttr(b,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(b,g){if(this.selected!=b){var e=this.selected;if(e)this.onDeselect(e);
b&&(g&&m.scrollIntoView(b),this.onSelect(b));this._set("selected",b)}else if(b)this.onSelect(b)}})})},"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/Tooltip.html":'\x3cdiv class\x3d"dijitTooltip dijitTooltipLeft" id\x3d"dojoTooltip" data-dojo-attach-event\x3d"mouseenter:onMouseEnter,mouseleave:onMouseLeave"\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipConnector" data-dojo-attach-point\x3d"connectorNode"\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipContainer dijitTooltipContents" data-dojo-attach-point\x3d"containerNode" role\x3d\'alert\'\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/TextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/ValidationTextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/Button.html":'\x3cspan class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonNode"\r\n\t\tdata-dojo-attach-event\x3d"ondijitclick:__onClick" role\x3d"presentation"\r\n\t\t\x3e\x3cspan class\x3d"dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode,focusNode"\r\n\t\t\trole\x3d"button" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitToggleButtonIconChar"\x3e\x26#x25CF;\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tid\x3d"${id}_label"\r\n\t\t\t\tdata-dojo-attach-point\x3d"containerNode"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\x3e\x3c/span\r\n\t\x3e\x3c/span\r\n\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" class\x3d"dijitOffScreen"\r\n\t\tdata-dojo-attach-event\x3d"onclick:_onClick"\r\n\t\ttabIndex\x3d"-1" aria-hidden\x3d"true" data-dojo-attach-point\x3d"valueNode"\r\n/\x3e\x3c/span\x3e\r\n',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"*now":function(n){n(['dojo/i18n!*preload*jimu/nls/main*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","uk","zh-hk","zh-tw","ROOT"]'])}}});
define("./ConfigManager ./LayoutManager ./DataManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query dojo/domReady! esri/config esri/request esri/core/urlUtils esri/identity/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main dojo/ready".split(" "),function(n,b,m,k,g,e,f,l,h,d,a,c,q,p,t,u,r,x,w,v,z,y,A,B){function C(){var a=window.location.search;if(""===a)return{};var a=q.queryToObject(a.substr(1)),
b;for(b in a)a[b]=v.sanitizeHTML(a[b]);return a}e={};h=v.getEsriConfigRequestObject();h.timeout=18E4;"function"!==typeof d.getAll&&(d.getAll=function(a){var b=[];(a=d(a))&&b.push(a);return b});window.jimuNls=A;x.setProtocolErrorHandler(function(){return!0});x=v.getAncestorWindow();var F=!1;try{F=0===x.location.href.indexOf("https://")}catch(G){}var E=/\/SceneServer\/layers\/\d+\/?$/;h.interceptors=[{before:function(a){a&&"object"===typeof a.requestOptions&&!a.requestOptions.content&&E.test(a.url)&&
(a.content={f:"json"});a.requestOptions.query&&a.requestOptions.query.printFlag&&(a.timeout=3E5);F&&(a.url=a.url.replace(/^http(s?):\/\//gi,"https://"));-1===a.url.indexOf("/queryRelatedRecords?")||v.isHostedService(a.url)||(a.url=a.url.replace("FeatureServer","MapServer"))}}];f(window,"mousedown",function(a){if(l.isMiddle(a))return a.preventDefault(),a.stopPropagation(),a.returnValue=!1});String.prototype.startWith=function(a){return this.substr(0,a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-
a.length,a.length)===a?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=g.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.16";window.productVersion="Online 8.1";e.initApp=function(){var a,c;console.log("jimu.js init...");a=C();m.getInstance();k.setStyle(jimuConfig.loadingId,"display","none");k.setStyle(jimuConfig.mainPageId,
"display","block");c=b.getInstance({mapId:jimuConfig.mapId,urlParams:a},jimuConfig.layoutId);a=n.getInstance(a);c.startup();a.loadConfig();B(function(){setTimeout(function(){k.removeClass(document.body,"dj_a11y")},50)})};return e});