// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/Measurement3D/ButtonGroup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/query dojo/dom-class dojo/on dijit/_WidgetBase".split(" "),function(t,h,k,a,c,e,m){return t([m],{baseClass:"jimu-button-group",CSS:{ACTIVE:"jimu-state-active"},buttons:[],activeButton:null,postCreate:function(){this.inherited(arguments);this._initUI()},buttonClicked:function(e){this.activeButton===e?(c.remove(e,this.CSS.ACTIVE),this.activeButton=null):(a("*",this.domNode).removeClass(this.CSS.ACTIVE),
c.add(e,this.CSS.ACTIVE),this.activeButton=e);this.onChange(this.activeButton)},getActiveButton:function(){return this.activeButton},getActiveButtonValue:function(){var a=this.getActiveButton();return a&&a.getAttribute("data-value")},_initUI:function(){k.forEach(this.buttons,function(a){this._createButton(a)},this)},_createButton:function(a){var f=document.createElement("button");f.type="button";f.title=a.label;f.setAttribute("data-value",a.value);a.icon&&f.appendChild(a.icon);f.appendChild(document.createTextNode(a.content||
a.value));this.domNode.appendChild(f);this.own(e(f,"click",h.hitch(this,function(a){this.buttonClicked(a.target)})))},onChange:function(){}})})},"jimu/dijit/ViewStack":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/_base/array","dijit/_WidgetBase"],function(t,h,k,a,c){return t(c,{baseClass:"jimu-viewstack",declaredClass:"jimu.dijit.ViewStack",_currentView:null,postCreate:function(){this.inherited(arguments);this.views||(this.views=[]);a.forEach(this.views,h.hitch(this,
function(a){1===a.nodeType?(k.place(a,this.domNode),k.addClass(a,"view"),k.setStyle(a,"display","none")):a.domNode&&(k.place(a.domNode,this.domNode),k.addClass(a.domNode,"view"),k.setStyle(a.domNode,"display","none"))}))},startup:function(){this.inherited(arguments);0<this.views.length&&this.switchView(0)},getSelectedView:function(){return this._currentView},getSelectedLabel:function(){var a="",m=this.getSelectedView();m&&(a=m.label);return a},getViewByLabel:function(a){for(var e=0;e<this.views.length;e++)if(a===
this.views[e].label)return this.views[e];return null},addView:function(a){this.views.push(a);1===a.nodeType?(k.place(a,this.domNode),k.addClass(a,"view")):a.domNode&&(k.place(a.domNode,this.domNode),k.addClass(a.domNode,"view"))},removeView:function(e){var m=this.views.length;this.views=a.filter(this.views,function(a){return e!==a});m!==this.views.length&&(1===e.nodeType?k.destroy(e):e.domNode&&e.destroyRecursive())},switchView:function(a){var e,c;e="number"===typeof a?this.views[a]:"string"===typeof a?
this.getViewByLabel(a):a;this.views.forEach(h.hitch(this,function(a){a&&(1===a.nodeType?c=a:a.domNode&&(c=a.domNode),a===e?(k.setStyle(c,"display","block"),a.domNode&&!a._started&&(a.startup(),a._started=!0)):k.setStyle(c,"display","none"))}));this._currentView=e;this.onViewSwitch(e)},onViewSwitch:function(){}})})},"esri/widgets/DirectLineMeasurement3D":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./DirectLineMeasurement3D/nls/DirectLineMeasurement3D ../core/accessorSupport/decorators ./Widget ./DirectLineMeasurement3D/DirectLineMeasurement3DViewModel ./support/widget".split(" "),
function(t,h,k,a,c,e,m,n,f){return function(q){function b(a){a=q.call(this,a)||this;a.view=null;a.visible=null;a.iconClass="esri-icon-measure-line";a.label=c.widgetLabel;a.viewModel=new n;a.unitOptions=null;a.unit=null;return a}k(b,q);b.prototype.render=function(){var a=this,b=this.viewModel.isSupported,q=this.viewModel.active,e="disabled"===this.viewModel.state,m="ready"===this.viewModel.state,y="measuring"===this.viewModel.state||"measured"===this.viewModel.state,d=this.viewModel.measurement,m=
q&&m?f.tsx("section",{key:"esri-direct-line-measurement-3d__hint",class:"esri-direct-line-measurement-3d__hint"},f.tsx("p",{class:"esri-direct-line-measurement-3d__hint-text"},c.hint)):null,u=b?null:f.tsx("section",{key:"esri-direct-line-measurement-3d__unsupported",class:"esri-direct-line-measurement-3d__panel--error"},f.tsx("p",null,c.unsupported)),p=function(d,p,b){switch(p.state){case "available":return f.tsx("div",{key:b+"-enabled",class:"esri-direct-line-measurement-3d__measurement-item"},f.tsx("span",
{class:"esri-direct-line-measurement-3d__measurement-item-title"},d),f.tsx("span",{class:"esri-direct-line-measurement-3d__measurement-item-value"},p.text));case "unavailable":return f.tsx("div",{key:b+"-disabled",class:a.classes("esri-direct-line-measurement-3d__measurement-item","esri-direct-line-measurement-3d__measurement-item--disabled")},f.tsx("span",{class:"esri-direct-line-measurement-3d__measurement-item-title"},d))}},d=y?f.tsx("section",{key:"esri-direct-line-measurement-3d__measurement",
class:"esri-direct-line-measurement-3d__measurement"},p(c.direct,d.directDistance,"direct"),p(c.horizontal,d.horizontalDistance,"horizontal"),p(c.vertical,d.verticalDistance,"vertical")):null,A=this.id+"__units",p=f.tsx("label",{class:"esri-direct-line-measurement-3d__units-label",for:A},c.unit),A=f.tsx("div",{class:"esri-direct-line-measurement-3d__units-select-wrapper"},f.tsx("select",{class:"esri-direct-line-measurement-3d__units-select esri-select",id:A,onchange:this._changeUnit,bind:this},this.viewModel.unitOptions.map(function(d){return d===
a.viewModel.unit?f.tsx("option",{key:d,value:d,selected:!0},c.units[d]):f.tsx("option",{key:d,value:d},c.units[d])}))),p=f.tsx("section",{key:"esri-direct-line-measurement-3d__units",class:"esri-direct-line-measurement-3d__units"},p,A),p=y?f.tsx("div",{key:"settings",class:"esri-direct-line-measurement-3d__settings"},p):null,b=!b||q&&!y?null:f.tsx("div",{class:"esri-direct-line-measurement-3d__actions"},f.tsx("button",{disabled:e,class:this.classes("esri-button esri-button--secondary","esri-direct-line-measurement-3d__clear-button",
e&&"esri-button--disabled"),bind:this,onclick:this._newMeasurement},c.newMeasurement)),b=this.visible?f.tsx("div",{class:"esri-direct-line-measurement-3d__container"},u,m,p,d,b):null;return f.tsx("div",{key:"",class:this.classes("esri-direct-line-measurement-3d","esri-widget","esri-widget--panel"),role:"presentation"},b)};b.prototype._newMeasurement=function(){this.viewModel.newMeasurement()};b.prototype._changeUnit=function(a){a=a.target;if(a=a.options[a.selectedIndex])this.unit=a.value};a([e.aliasOf("viewModel.view")],
b.prototype,"view",void 0);a([e.aliasOf("viewModel.visible"),f.renderable()],b.prototype,"visible",void 0);a([e.aliasOf("viewModel.active"),f.renderable()],b.prototype,"active",void 0);a([e.property()],b.prototype,"iconClass",void 0);a([e.property()],b.prototype,"label",void 0);a([e.property({type:n}),f.renderable(["viewModel.state","viewModel.unitOptions","viewModel.unit","viewModel.measurement"])],b.prototype,"viewModel",void 0);a([e.aliasOf("viewModel.unitOptions")],b.prototype,"unitOptions",void 0);
a([e.aliasOf("viewModel.unit")],b.prototype,"unit",void 0);a([f.accessibleHandler()],b.prototype,"_newMeasurement",null);a([f.accessibleHandler()],b.prototype,"_changeUnit",null);return b=a([e.subclass("esri.widgets.DirectLineMeasurement3D")],b)}(e.declared(m))})},"esri/widgets/DirectLineMeasurement3D/DirectLineMeasurement3DViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Handles ../../core/Logger ../../core/promiseUtils ../../core/unitUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../views/3d/interactive/measurementTools/directLineMeasurement3D/DirectLineMeasurement3DTool ../support/commonProperties ../support/InteractiveToolViewModel".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g){var r=e.getLogger("esri.widgets.DirectLineMeasurement3D.DirectLineMeasurement3DViewModel");return function(g){function e(a){a=g.call(this,a)||this;a.supportedViewType="3d";a._handles=new c;a._userUnitOptions=null;a._userUnit=null;return a}k(e,g);e.prototype.initialize=function(){var a=this;this._handles.add([f.init(this,"unit",function(d){a.tool&&(a.tool.unit=d)})])};e.prototype.destroy=function(){this._handles.destroy();this._handles=null};Object.defineProperty(e.prototype,
"state",{get:function(){return this.isDisabled?"disabled":this.tool?this.tool.state:"ready"},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"measurement",{get:function(){if(!this.tool)return null;var a=this.tool.model,d=a.measurementMode,b="geodesic"===d,a=a.validMeasurement;return{mode:d,directDistance:{text:b?null:this.tool.triangleView.directLabel,state:a&&!b?"available":"unavailable"},horizontalDistance:{text:this.tool.triangleView.horizontalLabel,state:a?"available":"unavailable"},
verticalDistance:{text:this.tool.triangleView.verticalLabel,state:a?"available":"unavailable"}}},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"unitOptions",{get:function(){return this._filteredOrAllUnits(this._userUnitOptions)},set:function(a){this._userUnitOptions=a;this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"unit",{get:function(){return this._userUnit?this._userUnit=this._findSelectableUnit(this._userUnit,
this.defaultUnit):this._findSelectableUnit(this.defaultUnit)},set:function(a){this._userUnit=a?this._findSelectableUnit(a,this._userUnit):null;this.notifyChange("unit")},enumerable:!0,configurable:!0});e.prototype.newMeasurement=function(){m.ignoreAbortErrors(this.createTool())};e.prototype.clearMeasurement=function(){this.removeTool()};e.prototype.createToolParams=function(){return{toolConstructor:b,constructorArguments:{unit:this.unit}}};e.prototype.logUnsupportedError=function(){r.error("DirectLineMeasurement3D widget is not implemented for MapView")};
e.prototype.logError=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];r.error.apply(r,a)};e.prototype._findSelectableUnit=function(a,d){var b=this.unitOptions;return-1!==b.indexOf(a)?a:d?this._findSelectableUnit(d):b[0]};e.prototype._filteredOrAllUnits=function(a){if(!a)return n.measurementLengthUnits.slice();a=a.filter(function(a){return-1!==n.measurementLengthUnits.indexOf(a)});return 0===a.length?n.measurementLengthUnits.slice():a};a([q.property({dependsOn:["isDisabled","tool.state"],
readOnly:!0})],e.prototype,"state",null);a([q.property({dependsOn:"view.ready tool.triangleView tool.model.directDistance tool.model.horizontalDistance tool.model.verticalDistance tool.model.geodesicDistance tool.model.measurementMode".split(" "),readOnly:!0})],e.prototype,"measurement",null);a([q.property()],e.prototype,"tool",void 0);a([q.property(v.defaultUnitPropertyMetadata)],e.prototype,"defaultUnit",void 0);a([q.property({dependsOn:["view.spatialReference"]})],e.prototype,"unitOptions",null);
a([q.property({dependsOn:["unitOptions","defaultUnit"]})],e.prototype,"unit",null);return e=a([q.subclass("esri.widgets.DirectLineMeasurement3D.DirectLineMeasurement3DViewModel")],e)}(q.declared(g.InteractiveToolViewModel))})},"esri/views/3d/interactive/measurementTools/directLineMeasurement3D/DirectLineMeasurement3DTool":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/restHelper ../../../../../geometry ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ../../../../../layers/graphics/dehydratedFeatures ./DirectLineMeasurement3DModel ./DirectLineMeasurement3DView ../../../../interactive/InteractiveToolBase".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g,r,z){t=function(e){function d(a){var d=e.call(this,a)||this;d._handles=new m;d._cachedPickRequest=new r.PickRequest;d._cachedPickResult=new r.PickResult;d._isAnyPointerDown=!1;d.deferCreation=!0;d.startManipulator=null;d.endManipulator=null;d.model=new g({sceneView:a.view});return d}k(d,e);d.prototype.normalizeCtorArgs=function(a){return c(a,["view"])};d.prototype.initialize=function(){var a=this;this._view=new r(this.model);var d=q.init(this,"state",function(d){"ready"!==
d&&a.create();"measured"===d&&a.complete()},!0);this._handles.add(d);var d=this._view.createManipulators(),b=d.start,l=d.end;b.events.on("drag",function(){var d=b.mapPoint,p=b.surfaceType;n.isSome(d)&&n.isSome(p)&&(d=v.clonePoint(d,w),a.model.startPoint=d,a.model.startPointSurfaceLocation=a._surfaceLocation(d,p))});l.events.on("drag",function(){var d=l.mapPoint,b=l.surfaceType;n.isSome(d)&&n.isSome(b)&&(d=v.clonePoint(d,w),a.model.endPoint=d,a.model.endPointSurfaceLocation=a._surfaceLocation(d,b))});
[b,l].forEach(function(d){a._handles.add([d.watch("grabbing",function(){var d=b.grabbing||l.grabbing;d&&"measured"===a.model.state&&(a.model.state="editing");d||(a.model.finishMeasurement(),"editing"===a.model.state&&(a.model.state="measured"))},!0)])});this.manipulators.add(b);this.manipulators.add(l);this.startManipulator=b;this.endManipulator=l};d.prototype.destroy=function(){this._view.destroy();this._view=null;this._handles.destroy();this._handles=null};Object.defineProperty(d.prototype,"state",
{get:function(){return this.model.isMeasuring?"measured"===this.model.state?"measured":"measuring":"ready"},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"creating",{get:function(){return"initial"===this.model.state||"drawing"===this.model.state},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isSupported",{get:function(){return"3d"===this.get("view.type")},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"cursor",{get:function(){return!this.model.active||
"drawing"!==this.model.state&&"initial"!==this.model.state?null:"crosshair"},enumerable:!0,configurable:!0});d.prototype.activate=function(){this.model.active=!0};d.prototype.deactivate=function(){this.model.active=!1};d.prototype.onDetach=function(){this.model.reset()};d.prototype.onShow=function(){this._view.show();this._updateManipulatorVisibility()};d.prototype.onHide=function(){this._view.hide()};d.prototype.onInputEvent=function(a){switch(a.type){case "immediate-click":this._handleImmediateClick(a);
break;case "pointer-move":this._handlePointerMove(a);break;case "pointer-down":this._handlePointerDown();break;case "pointer-up":this._handlePointerUp()}this._updateManipulatorVisibility()};d.prototype._handlePointerMove=function(a){this._clearCachedPickRequest();var d=f.createScreenPointFromEvent(a);"mouse"===a.pointerType&&(this._hoverAt(d),"drawing"===this.model.state&&(this.endManipulator.events.emit("drag",{action:"update",start:null,screenPoint:d}),a.stopPropagation()))};d.prototype._handlePointerDown=
function(){this._isAnyPointerDown=!0};d.prototype._handlePointerUp=function(){this._isAnyPointerDown=!1};d.prototype._handleImmediateClick=function(a){this._clearCachedPickRequest();if("mouse"!==a.pointerType||0===a.button){var d=f.createScreenPointFromEvent(a),b=!1;if(this.model.active)switch(this.model.state){case "initial":this.startManipulator.events.emit("drag",{action:"start",start:d,screenPoint:d});null!=this.startManipulator.surfaceType&&(this.startManipulator.interactive=!1,this.endManipulator.interactive=
!1,this.model.state="drawing",b=!0);break;case "drawing":this.endManipulator.events.emit("drag",{action:"update",start:null,screenPoint:d}),null!=this.endManipulator.surfaceType&&(this.startManipulator.interactive=!0,this.endManipulator.interactive=!0,this.model.finishMeasurement(),b=!0)}b&&a.stopPropagation();"mouse"===a.pointerType&&this._hoverAt(d)}};d.prototype._hoverAt=function(a){var d=this._isAnyPointerDown&&"drawing"!==this.model.state&&"editing"!==this.model.state;this._view.requiresCursorPoint&&
!d?(a=this._pick(a),a.mapPoint&&(this.model.cursorPoint=a.mapPoint)):this.model.cursorPoint=null};d.prototype._pick=function(a){var d=this._cachedPickRequest.screenPoint;if(d&&d.x===a.x&&d.y===a.y)return this._cachedPickResult;this._cachedPickRequest.screenPoint=a;return this._cachedPickResult=this._view.pick(this._cachedPickRequest)};d.prototype._clearCachedPickRequest=function(){this._cachedPickRequest.screenPoint=null};d.prototype._surfaceLocation=function(a,d){return"ground"===d?"on-the-surface":
a.z>=this._view.getElevation(a)?"above-the-surface":"below-the-surface"};d.prototype._updateManipulatorVisibility=function(){this.startManipulator.visible=null!=this.model.startPoint;this.endManipulator.visible=null!=this.model.endPoint};a([b.property({dependsOn:["model.isMeasuring","model.state"],readOnly:!0})],d.prototype,"state",null);a([b.property({dependsOn:["model.state"],readOnly:!0})],d.prototype,"creating",null);a([b.property({dependsOn:["view.type"],readOnly:!0})],d.prototype,"isSupported",
null);a([b.property({dependsOn:["model.active","model.state"],readOnly:!0})],d.prototype,"cursor",null);a([b.property({constructOnly:!0})],d.prototype,"model",void 0);a([b.aliasOf("model.sceneView")],d.prototype,"view",void 0);a([b.aliasOf("model.mode")],d.prototype,"mode",void 0);a([b.aliasOf("model.unit")],d.prototype,"unit",void 0);a([b.aliasOf("model.directDistance")],d.prototype,"directDistance",void 0);a([b.aliasOf("model.validMeasurement")],d.prototype,"validMeasurement",void 0);a([b.aliasOf("model.horizontalDistance")],
d.prototype,"horizontalDistance",void 0);a([b.aliasOf("model.verticalDistance")],d.prototype,"verticalDistance",void 0);a([b.aliasOf("model.geodesicDistance")],d.prototype,"geodesicDistance",void 0);a([b.aliasOf("model.geodesicAngle")],d.prototype,"geodesicAngle",void 0);a([b.aliasOf("model.triangleView")],d.prototype,"triangleView",void 0);return d=a([b.subclass("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DTool")],d)}(b.declared(z.InteractiveToolBase));
var w=new e.Point;return t})},"esri/core/tsSupport/restHelper":function(){define([],function(){return function(t,h){var k={},a;for(a in t)Object.prototype.hasOwnProperty.call(t,a)&&0>h.indexOf(a)&&(k[a]=t[a]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var c=0;for(a=Object.getOwnPropertySymbols(t);c<a.length;c++)0>h.indexOf(a[c])&&(k[a[c]]=t[a[c]])}return k}})},"esri/views/3d/interactive/measurementTools/directLineMeasurement3D/DirectLineMeasurement3DModel":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Accessor ../../../../../core/Handles ../../../../../core/mathUtils ../../../../../core/Quantity ../../../../../core/quantityUtils ../../../../../core/unitUtils ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../geometry/Point ../../../../../geometry/support/geodesicUtils ../support/UnitNormalizer ../../../support/earthUtils ../../../support/projectionUtils ../../../support/PropertiesPool".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g,r,z,w,y,d,u,p){var A=d.earthRadius*Math.PI/180;t=function(d){function c(){var a=null!==d&&d.apply(this,arguments)||this;a._tempStartPosition=r.vec3f64.create();a._tempEndPosition=r.vec3f64.create();a._tempCornerPosition=r.vec3f64.create();a._unitNormalizer=new y;a._handles=new e;a._propertiesPool=new p.default({startPoint:z,endPoint:z},a);a.cursorPoint=null;a.state="initial";a.mode="auto";a.unit="metric";a.active=!1;a.directDistance=null;a.horizontalDistance=null;
a.verticalDistance=null;a.geodesicDistance=null;a.geodesicAngle=null;a.triangleCollapseRatioThreshold=.03;a.geodesicMeasurementDistanceThreshold=1E5;return a}k(c,d);c.prototype.initialize=function(){var a=this;this._handles.add(b.init(this.sceneView,"spatialReference",function(d){a._unitNormalizer.spatialReference=d}),"scene-view");this.reset()};c.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._propertiesPool.destroy();this._propertiesPool=null};Object.defineProperty(c.prototype,
"startPoint",{set:function(a){if(a){var d=this._propertiesPool.get("startPoint");d.copy(a);this._set("startPoint",d);this._updateMeasurement()}else this._set("startPoint",null)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"startPointSurfaceLocation",{set:function(a){this._set("startPointSurfaceLocation",a);this._updateMeasurement()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"endPoint",{set:function(a){if(a){var d=this._propertiesPool.get("endPoint");d.copy(a);
this._set("endPoint",d);this._updateMeasurement()}else this._set("endPoint",null)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"endPointSurfaceLocation",{set:function(a){this._set("endPointSurfaceLocation",a);this._updateMeasurement()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"measurementSurfaceLocation",{get:function(){var a=this.startPointSurfaceLocation,d=this.endPointSurfaceLocation;return null==a||null==d||"above-the-surface"===a&&"below-the-surface"===
d||"below-the-surface"===a&&"above-the-surface"===d||"on-the-surface"===a&&"on-the-surface"===d?"camera-dependent":"above-the-surface"===a||"above-the-surface"===d?"above-the-surface":"below-the-surface"},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"validMeasurement",{get:function(){return!!this.startPoint&&!!this.endPoint},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"isMeasuring",{get:function(){return!!this.startPoint},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"geodesicDistanceExceeded",{get:function(){return this.horizontalDistance&&this.horizontalDistance.value>this.geodesicMeasurementDistanceThreshold},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"measurementMode",{get:function(){var a=this.mode;if("auto"===a){a="euclidean";if("degrees"===this.unit||"degrees-minutes-seconds"===this.unit)a="geodesic";this.geodesicDistanceExceeded&&(a="geodesic")}return a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"triangleView",{get:function(){var a=this._collapseTriangle(),d=null,b=null,p=null,l=this.directDistance,b="geodesic"===this.measurementMode?this.geodesicDistance:this.horizontalDistance,e=this.verticalDistance,u=null;switch(this.unit){case "metric":d=l&&f.formatMetricLength(l);b=b&&f.formatMetricLength(b);p=e&&f.formatMetricVerticalLength(e);u=l&&l.toUnit("meters");break;case "imperial":d=l&&f.formatImperialLength(l);b=b&&f.formatImperialLength(b);p=e&&f.formatImperialVerticalLength(e);u=l&&l.toUnit(q.preferredImperialLengthUnit(l.value,
l.unit));break;case "degrees":b=this.geodesicAngle&&f.formatDecimal(this.geodesicAngle,"degrees");u=this.geodesicAngle&&this.geodesicAngle.toUnit("degrees");break;case "degrees-minutes-seconds":b=this.geodesicAngle&&f.formatDMS(this.geodesicAngle);u=this.geodesicAngle&&this.geodesicAngle.toUnit("degrees");break;default:d=l&&f.formatDecimal(l,this.unit),b=b&&f.formatDecimal(b,this.unit),p=e&&f.formatDecimal(e,this.unit),u=l&&l.toUnit(this.unit)}l=1;u&&(l=m.nextHighestPowerOfTen(u.value/30),l*="degrees"===
u.unit?A:q.convertUnit(1,u.unit,"meters"),l/=this._unitNormalizer.normalizeDistance(1));return{visible:this.validMeasurement&&!this.startPoint.equals(this.endPoint),mode:this.measurementMode,collapsed:a,directLabel:d,horizontalLabel:b,verticalLabel:p,stripeLength:l}},enumerable:!0,configurable:!0});c.prototype.reset=function(){this.clearMeasurement()};c.prototype.clearMeasurement=function(){this.state="initial";this.cursorPoint=this.endPoint=this.startPoint=null;this._clearOverride("measurementSurfaceLocation");
this._updateMeasurement()};c.prototype.finishMeasurement=function(){if(!this._isOverridden("measurementSurfaceLocation")){var a=this.measurementSurfaceLocation;this._override("measurementSurfaceLocation","camera-dependent"===a?this.sceneView.state.camera.aboveGround?"above-the-surface":"below-the-surface":a)}this.state="measured"};c.prototype._collapseTriangle=function(){return!this.validMeasurement||this.startPoint.equals(this.endPoint)||"geodesic"===this.measurementMode?!0:Math.min(this.verticalDistance.value/
this.horizontalDistance.value,this.horizontalDistance.value/this.verticalDistance.value)<this.triangleCollapseRatioThreshold};c.prototype._exactGeodesicDistanceAndAngle=function(a,d){u.pointToWGS84ComparableLonLat(a,l);u.pointToWGS84ComparableLonLat(d,x);a=m.deg2rad(l[0]);d=m.deg2rad(l[1]);var b=m.deg2rad(x[0]),p=m.deg2rad(x[1]);a=m.acosClamped(Math.sin(d)*Math.sin(p)+Math.cos(d)*Math.cos(p)*Math.cos(Math.abs(b-a)));a=m.rad2deg(a);d={distance:0};w.inverseGeodeticSolver(d,[l[0],l[1]],[x[0],x[1]]);
return{distance:new n(d.distance,"meters"),angle:new n(a,"degrees")}};c.prototype._approximateGeodesicDistanceAndAngle=function(a){return{distance:new n(a,"meters"),angle:new n(a/A,"degrees")}};c.prototype._euclideanDistances=function(a,d){a.z>d.z&&(a=[a,a=d][0]);var b=a.clone();b.z=d.z;var p=this._tempStartPosition,l=this._tempEndPosition,e=this._tempCornerPosition,c=this.sceneView.spatialReference,c=u.canProject(c,u.WGS84ECEFSpatialReference)?u.WGS84ECEFSpatialReference:c;u.pointToVector(a,p,c);
u.pointToVector(d,l,c);u.pointToVector(b,e,c);b=g.vec3.distance(p,l);l=g.vec3.distance(e,l);a=Math.abs(d.z-a.z);b=this._unitNormalizer.normalizeDistance(b);l=this._unitNormalizer.normalizeDistance(l);a=this._unitNormalizer.normalizeElevation(a);return{direct:new n(b,"meters"),horizontal:new n(l,"meters"),vertical:new n(a,"meters")}};c.prototype._updateMeasurement=function(){if(this.startPoint&&this.endPoint){var a=this._euclideanDistances(this.startPoint,this.endPoint),d=u.canProjectToWGS84ComparableLonLat(this.sceneView.spatialReference)?
this._exactGeodesicDistanceAndAngle(this.startPoint,this.endPoint):this._approximateGeodesicDistanceAndAngle(a.horizontal.value);this._set("directDistance",a.direct);this._set("horizontalDistance",a.horizontal);this._set("verticalDistance",a.vertical);this._set("geodesicDistance",d.distance);this._set("geodesicAngle",d.angle)}else this._set("directDistance",null),this._set("horizontalDistance",null),this._set("verticalDistance",null),this._set("geodesicDistance",null),this._set("geodesicAngle",null)};
a([v.property({constructOnly:!0})],c.prototype,"sceneView",void 0);a([v.property({value:null})],c.prototype,"startPoint",null);a([v.property({value:null})],c.prototype,"startPointSurfaceLocation",null);a([v.property({value:null})],c.prototype,"endPoint",null);a([v.property({value:null})],c.prototype,"endPointSurfaceLocation",null);a([v.property({dependsOn:["startPointSurfaceLocation","endPointSurfaceLocation"]})],c.prototype,"measurementSurfaceLocation",null);a([v.property()],c.prototype,"cursorPoint",
void 0);a([v.property()],c.prototype,"state",void 0);a([v.property()],c.prototype,"mode",void 0);a([v.property()],c.prototype,"unit",void 0);a([v.property()],c.prototype,"active",void 0);a([v.property({readOnly:!0,dependsOn:["startPoint","endPoint"]})],c.prototype,"validMeasurement",null);a([v.property({readOnly:!0,dependsOn:["startPoint"]})],c.prototype,"isMeasuring",null);a([v.property({readOnly:!0})],c.prototype,"directDistance",void 0);a([v.property({readOnly:!0})],c.prototype,"horizontalDistance",
void 0);a([v.property({readOnly:!0})],c.prototype,"verticalDistance",void 0);a([v.property({readOnly:!0})],c.prototype,"geodesicDistance",void 0);a([v.property({readOnly:!0})],c.prototype,"geodesicAngle",void 0);a([v.property({readOnly:!0,dependsOn:["horizontalDistance","geodesicMeasurementDistanceThreshold"]})],c.prototype,"geodesicDistanceExceeded",null);a([v.property({readOnly:!0,dependsOn:["horizontalDistance","unit","geodesicDistanceExceeded"]})],c.prototype,"measurementMode",null);a([v.property({readOnly:!0,
dependsOn:["unit","measurementMode","startPoint","endPoint","triangleCollapseRatioThreshold"]})],c.prototype,"triangleView",null);a([v.property()],c.prototype,"triangleCollapseRatioThreshold",void 0);a([v.property()],c.prototype,"geodesicMeasurementDistanceThreshold",void 0);return c=a([v.subclass("esri.views.3d.interactive.measurementTools.directLineMeasurement3D.DirectLineMeasurement3DModel")],c)}(v.declared(c));var l=r.vec3f64.create(),x=r.vec3f64.create();return t})},"esri/core/Quantity":function(){define(["require",
"exports","./unitFormatUtils","./unitUtils"],function(t,h,k,a){return function(){function c(e,c){this.measure=a.measureForUnit(c);this.value=e;this.unit=c}Object.defineProperty(c.prototype,"isBaseUnit",{get:function(){return a.isBaseUnit(this.unit)},enumerable:!0,configurable:!0});c.prototype.toUnit=function(e){return new c(a.convertUnit(this.value,this.unit,e),e)};c.prototype.toBaseUnit=function(){return this.toUnit(a.baseUnitForUnit(this.unit))};c.prototype.toDecimalString=function(a,c){void 0===
a&&(a=2);return k.formatDecimal(this.value,this.unit,a,c)};return c}()})},"esri/core/unitFormatUtils":function(){define("require exports dojo/i18n!./nls/Units ./string ./unitUtils ../intl/number".split(" "),function(t,h,k,a,c,e){function m(a,b){return k.units[a][b]}function n(a,b,c,f){void 0===c&&(c=2);void 0===f&&(f="abbr");return e.formatNumber(a,{minimumFractionDigits:c,maximumFractionDigits:c})+" "+m(b,f)}Object.defineProperty(h,"__esModule",{value:!0});h.unitName=m;h.formatDecimal=n;h.formatMetricLength=
function(a,b,e,f){void 0===e&&(e=2);void 0===f&&(f="abbr");var g=c.preferredMetricLengthUnit(a,b);return n(c.convertUnit(a,b,g),g,e,f)};h.formatMetricVerticalLength=function(a,b,e,f){void 0===e&&(e=2);void 0===f&&(f="abbr");var g=c.preferredMetricVerticalLengthUnit(a,b);return n(c.convertUnit(a,b,g),g,e,f)};h.formatImperialLength=function(a,b,e,f){void 0===e&&(e=2);void 0===f&&(f="abbr");var g=c.preferredImperialLengthUnit(a,b);return n(c.convertUnit(a,b,g),g,e,f)};h.formatImperialVerticalLength=
function(a,b,e,f){void 0===e&&(e=2);void 0===f&&(f="abbr");var g=c.preferredImperialVerticalLengthUnit(a,b);return n(c.convertUnit(a,b,g),g,e,f)};h.formatMetricArea=function(a,b,e,f){void 0===e&&(e=2);void 0===f&&(f="abbr");var g=c.preferredMetricAreaUnit(a,b);return n(c.convertUnit(a,b,g),g,e,f)};h.formatImperialArea=function(a,b,e,f){void 0===e&&(e=2);void 0===f&&(f="abbr");var g=c.preferredImperialAreaUnit(a,b);return n(c.convertUnit(a,b,g),g,e,f)};h.formatDMS=function(a,b,e){void 0===e&&(e=2);
a=c.convertUnit(a,b,"degrees");b=a-Math.floor(a);a-=b;b*=60;var f=b-Math.floor(b);b-=f;f*=60;return a.toFixed()+"\u00b0 "+b.toFixed()+"' "+f.toFixed(e)+'"'};t=k.units.bytes;var f=[t.B,t.kB,t.MB,t.GB,t.TB];h.formatFileSize=function(c){var b=0===c?0:Math.floor(Math.log(c)/Math.log(1024));c=e.formatNumber(c/Math.pow(1024,b),{maximumFractionDigits:2});return a.replace(f[b],{fileSize:c})}})},"esri/core/quantityUtils":function(){define(["require","exports","./unitFormatUtils"],function(t,h,k){Object.defineProperty(h,
"__esModule",{value:!0});h.formatDecimal=function(a,c,e,m){void 0===e&&(e=2);void 0===m&&(m="abbr");return k.formatDecimal(a.toUnit(c).value,c,e,m)};h.formatMetricLength=function(a,c,e){void 0===c&&(c=2);void 0===e&&(e="abbr");if("length"!==a.measure)throw Error("quantity is not a length");return k.formatMetricLength(a.value,a.unit,c,e)};h.formatMetricVerticalLength=function(a,c,e){void 0===c&&(c=2);void 0===e&&(e="abbr");if("length"!==a.measure)throw Error("quantity is not a length");return k.formatMetricVerticalLength(a.value,
a.unit,c,e)};h.formatMetricArea=function(a,c,e){void 0===c&&(c=2);void 0===e&&(e="abbr");if("area"!==a.measure)throw Error("quantity is not an area");return k.formatMetricArea(a.value,a.unit,c,e)};h.formatImperialLength=function(a,c,e){void 0===c&&(c=2);void 0===e&&(e="abbr");if("length"!==a.measure)throw Error("quantity is not a length");return k.formatImperialLength(a.value,a.unit,c,e)};h.formatImperialVerticalLength=function(a,c,e){void 0===c&&(c=2);void 0===e&&(e="abbr");if("length"!==a.measure)throw Error("quantity is not a length");
return k.formatImperialVerticalLength(a.value,a.unit,c,e)};h.formatImperialArea=function(a,c,e){void 0===c&&(c=2);void 0===e&&(e="abbr");if("area"!==a.measure)throw Error("quantity is not an area");return k.formatImperialArea(a.value,a.unit,c,e)};h.formatDMS=function(a){if("angle"!==a.measure)throw Error("quantity is not an angle");return k.formatDMS(a.value,a.unit)}})},"esri/geometry/support/geodesicUtils":function(){define("require exports @dojo/framework/shim/object ../. ../../core/Error ../../core/unitUtils".split(" "),
function(t,h,k,a,c,e){function m(a){if(!a||!a.isGeographic)return null;if(a.wkid){var d=y[a.wkid];if(d)return d}if(a.wkt){a=w.exec(a.wkt);if(!a||2!==a.length)return null;d=a[1].split(",");if(!d||3!==d.length)return null;a=parseFloat(d[1]);d=parseFloat(d[2]);return isNaN(a)||isNaN(d)?null:{a:a,f:0===d?0:1/d}}return null}function n(a){a=m(a||z);if("b"in a&&"eSq"in a&&"radius"in a)return a;var d=a.a*(1-a.f);return k.assign(a,{b:d,eSq:1-Math.pow(d/a.a,2),radius:(2*a.a+d)/3})}function f(a,b,p){var d=n(p);
p=d.a;var d=d.eSq,l=Math.sqrt(d),e=Math.sin(b[1]*r);b=p*b[0]*r;p=0<d?p*(1-d)*(e/(1-d*e*e)-1/(2*l)*Math.log((1-l*e)/(1+l*e)))*.5:p*e;a[0]=b;a[1]=p;return a}function q(a){return null!==m(a)}function b(d,b){if("polyline"!==d.type&&"polygon"!==d.type)throw new c("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");var p=d.spatialReference;if(!q(p))throw new c("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");var e=
n(p).radius/1E4;b<e&&(b=e);for(var e=[],l=[0,0],f={distance:null},u=0,r="polyline"===d.type?d.paths:d.rings;u<r.length;u++){var m=r[u],y=[];e.push(y);y.push([m[0][0],m[0][1]]);for(var w=m[0][0],k=m[0][1],z=void 0,h=void 0,t=0;t<m.length-1;t++)if(z=m[t+1][0],h=m[t+1][1],w!==z||k!==h){var B=[w,k];g(f,[w,k],[z,h],p);w=f.azimuth;k=f.distance;z=k/b;if(1<z){for(h=1;h<=z-1;h++)v(l,B,w,h*b,p),y.push(l.slice(0));v(l,B,w,(k+Math.floor(z-1)*b)/2,p);y.push(l.slice(0))}v(l,B,w,k,p);y.push(l.slice(0));w=l[0];k=
l[1]}}return"polyline"===d.type?new a.Polyline({paths:e,spatialReference:p}):new a.Polygon({rings:e,spatialReference:p})}function v(a,b,p,e,l){var d=b[0]*r,f=b[1]*r;b=p*r;l=n(l);var c=l.a,u=l.b;l=l.f;p=Math.sin(b);b=Math.cos(b);for(var g=(1-l)*Math.tan(f),f=1/Math.sqrt(1+g*g),m=g*f,q=Math.atan2(g,b),g=f*p,y=g*g,A=1-y,c=A*(c*c-u*u)/(u*u),v=1+c/16384*(4096+c*(-768+c*(320-175*c))),B=c/1024*(256+c*(-128+c*(74-47*c))),c=e/(u*v),w=2*Math.PI,k,z,h,E;1E-12<Math.abs(c-w);)h=Math.cos(2*q+c),k=Math.sin(c),z=
Math.cos(c),E=B*k*(h+B/4*(z*(-1+2*h*h)-B/6*h*(-3+4*k*k)*(-3+4*h*h))),w=c,c=e/(u*v)+E;e=m*k-f*z*b;u=l/16*A*(4+l*(4-3*A));e=Math.atan2(m*z+f*k*b,(1-l)*Math.sqrt(y+e*e))/r;d=(d+(Math.atan2(k*p,f*z-m*k*b)-(1-u)*l*g*(c+u*k*(h+u*z*(-1+2*h*h)))))/r;a.splice(0,a.length);a.push(d,e);return a}function g(a,b,e,c){var d=b[0]*r;b=b[1]*r;var p=e[0]*r;e=e[1]*r;var f=n(c),g=f.a;c=f.b;var u=f.f,m=f.radius,q=p-d,y=Math.atan((1-u)*Math.tan(b)),A=Math.atan((1-u)*Math.tan(e)),f=Math.sin(y),y=Math.cos(y),v=Math.sin(A),
A=Math.cos(A),w=1E3,B=q,k,z,h,t,E,I,H,J;do{t=Math.sin(B);E=Math.cos(B);h=Math.sqrt(A*t*A*t+(y*v-f*A*E)*(y*v-f*A*E));if(0===h)return{distance:0};E=f*v+y*A*E;I=Math.atan2(h,E);H=y*A*t/h;z=1-H*H;t=E-2*f*v/z;isNaN(t)&&(t=0);J=u/16*z*(4+u*(4-3*z));k=B;B=q+(1-J)*u*H*(I+J*h*(t+J*E*(-1+2*t*t)))}while(1E-12<Math.abs(B-k)&&0<--w);if(0===w)return a=p-d,{azimuth:Math.atan2(Math.sin(a)*Math.cos(e),Math.cos(b)*Math.sin(e)-Math.sin(b)*Math.cos(e)*Math.cos(a))/r,distance:Math.acos(Math.sin(b)*Math.sin(e)+Math.cos(b)*
Math.cos(e)*Math.cos(p-d))*m};d=z*(g*g-c*c)/(c*c);b=d/1024*(256+d*(-128+d*(74-47*d)));p=Math.atan2(y*Math.sin(B),y*v*Math.cos(B)-f*A);a.azimuth=Math.atan2(A*Math.sin(B),y*v-f*A*Math.cos(B))/r;a.distance=c*(1+d/16384*(4096+d*(-768+d*(320-175*d))))*(I-b*h*(t+b/4*(E*(-1+2*t*t)-b/6*t*(-3+4*h*h)*(-3+4*t*t))));a.reverseAzimuth=p/r;return a}Object.defineProperty(h,"__esModule",{value:!0});var r=Math.PI/180,z=a.SpatialReference.WGS84,w=/SPHEROID\[([^\]]+)]/i,y={4326:{a:6378137,f:1/298.257223563},104900:{a:2439700,
f:0},104901:{a:6051E3,f:0},104902:{a:6051800,f:0},104903:{a:1737400,f:0},104904:{a:3393400,f:.005207166853303471},104905:{a:3396190,f:.005886007555525457},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492E3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1E4,f:0},104912:{a:2409300,f:0},104913:{a:15E3,f:0},104914:{a:4E4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85E3,f:0},104918:{a:1821460,f:0},104919:{a:5E3,f:0},104920:{a:12E3,f:0},104921:{a:3E4,f:3},
104922:{a:18E3,f:0},104923:{a:14E3,f:0},104924:{a:49300,f:0},104925:{a:60268E3,f:.09796243445941462},104926:{a:16E3,f:0},104927:{a:9500,f:0},104928:{a:56E4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16E3,f:0},104932:{a:133E3,f:0},104933:{a:718E3,f:0},104934:{a:888E3,f:0},104935:{a:1986300,f:0},104936:{a:1E4,f:0},104937:{a:41900,f:0},104938:{a:11E4,f:0},104939:{a:50100,f:0},104940:{a:764E3,f:0},104941:{a:11E3,f:0},104942:{a:529800,f:0},104943:{a:2575E3,f:0},104944:{a:25559E3,f:.022927344575296365},
104945:{a:578900,f:0},104946:{a:33E3,f:0},104947:{a:21E3,f:0},104948:{a:13E3,f:0},104949:{a:31E3,f:0},104950:{a:27E3,f:0},104951:{a:42E3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15E3,f:0},104955:{a:54E3,f:0},104956:{a:77E3,f:0},104957:{a:27E3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764E3,f:.01708124697141011},104961:{a:74E3,f:0},104962:{a:79E3,f:0},104963:{a:104E3,f:.14423076923076922},104964:{a:29E3,f:0},104965:{a:17E4,f:0},104966:{a:208E3,f:0},104967:{a:4E4,
f:0},104968:{a:1352600,f:0},104969:{a:1195E3,f:0},104970:{a:593E3,f:0},104971:{a:3396190,f:0},104972:{a:47E4,f:0},104973:{a:255E3,f:0},104974:{a:2439400,f:0}};h.isSupported=q;h.geodesicAreas=function(a,g){void 0===g&&(g="square-meters");if(a.some(function(a){return!q(a.spatialReference)}))throw new c("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");for(var d=[],u=0;u<a.length;u++){var l=a[u],x=l.spatialReference,x=.0015696101447650193*n(x).radius;
d.push(b(l,x))}a=[];for(var u=[0,0],l=[0,0],r=0;r<d.length;r++){for(var x=d[r],m=x.rings,x=x.spatialReference,y=0,v=0;v<m.length;v++){var w=m[v];f(u,w[0],x);f(l,w[w.length-1],x);for(var k=l[0]*u[1]-u[0]*l[1],z=0;z<w.length-1;z++)f(u,w[z+1],x),f(l,w[z],x),k+=l[0]*u[1]-u[0]*l[1];y+=k}y=e.convertUnit(y,"square-meters",g);a.push(y/-2)}return a};h.geodesicLengths=function(a,b){void 0===b&&(b="meters");if(!a&&!a)throw new c("geodesic-lengths:invalid-geometries","the input geometries type is not supported");
if(a.some(function(a){return!q(a.spatialReference)}))throw new c("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");for(var d=[],f=0;f<a.length;f++){for(var l=a[f],u=l.spatialReference,l="polyline"===l.type?l.paths:l.rings,r=0,y=0;y<l.length;y++){for(var m=l[y],v=0,w=1;w<m.length;w++){var n=m[w-1][0],k=m[w][0],z=m[w-1][1],h=m[w][1];if(z!==h||n!==k){var B={distance:null};g(B,[n,z],[k,h],u);v+=B.distance}}r+=v}r=e.convertUnit(r,"meters",b);d.push(r)}return d};
h.geodesicDensify=b;h.directGeodeticSolver=v;h.inverseGeodeticSolver=g;h.geodesicDistance=function(a,b,f){void 0===f&&(f="meters");if(!a||!b)throw new c("geodesic-distance:missing-parameters","one or both input parameters are missing");if(!a.spatialReference||!b.spatialReference)throw new c("geodesic-distance:invalid-parameters","one or both input points do not have a spatial reference");if(!a.spatialReference.equals(b.spatialReference))throw new c("geodesic-distance:invalid-parameters","spatial references of input parameters do not match");
var d=a.spatialReference;if(!q(d))throw new c("geodesic-distance:not-supported","input geometry spatial reference is not supported");if(a.equals(b))return{distance:0,azimuth:0,reverseAzimuth:0};var p={distance:null};g(p,[a.x,a.y],[b.x,b.y],d);p.distance=e.convertUnit(p.distance,"meters",f);return p};h.pointFromDistance=function(d,b,e){if(!d||null==b||null==e)throw new c("point-from-distance:missing-parameters","one or more input parameters are missing or undefined");if(0>e||360<e)throw new c("point-from-distance:-of-bounds",
"azimuth is restricted to angles between, and including, 0\u00b0 to 360\u00b0 degrees");if(!d.spatialReference)throw new c("point-from-distance:missing-spatial-reference","the input point must have a spatial reference");var f=d.spatialReference;if(!q(f))throw new c("geodesic-distance:not-supported","input geometry spatial reference is not supported");var p=[0,0];v(p,[d.x,d.y],e,b,f);return new a.Point({x:p[0],y:p[1],spatialReference:f})}})},"@dojo/framework/shim/object":function(){(function(t){"object"===
typeof module&&"object"===typeof module.exports?(t=t(require,exports),void 0!==t&&(module.exports=t)):"function"===typeof define&&define.amd&&define(["require","exports","./global","../has/has","./Symbol"],t)})(function(t,h){Object.defineProperty(h,"__esModule",{value:!0});var k=t("./global"),a=t("../has/has"),c=t("./Symbol");a.default("es6-object")?(t=k.default.Object,h.assign=t.assign,h.getOwnPropertyDescriptor=t.getOwnPropertyDescriptor,h.getOwnPropertyNames=t.getOwnPropertyNames,h.getOwnPropertySymbols=
t.getOwnPropertySymbols,h.is=t.is,h.keys=t.keys):(h.keys=function(a){return Object.keys(a).filter(function(a){return!a.match(/^@@.+/)})},h.assign=function(a){for(var e=[],c=1;c<arguments.length;c++)e[c-1]=arguments[c];if(null==a)throw new TypeError("Cannot convert undefined or null to object");var f=Object(a);e.forEach(function(a){a&&h.keys(a).forEach(function(b){f[b]=a[b]})});return f},h.getOwnPropertyDescriptor=function(a,m){c.isSymbol(m);return Object.getOwnPropertyDescriptor(a,m)},h.getOwnPropertyNames=
function(a){return Object.getOwnPropertyNames(a).filter(function(a){return!a.match(/^@@.+/)})},h.getOwnPropertySymbols=function(a){return Object.getOwnPropertyNames(a).filter(function(a){return!!a.match(/^@@.+/)}).map(function(a){return Symbol.for(a.substring(2))})},h.is=function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c});a.default("es2017-object")?(t=k.default.Object,h.getOwnPropertyDescriptors=t.getOwnPropertyDescriptors,h.entries=t.entries,h.values=t.values):(h.getOwnPropertyDescriptors=
function(a){return h.getOwnPropertyNames(a).reduce(function(e,c){e[c]=h.getOwnPropertyDescriptor(a,c);return e},{})},h.entries=function(a){return h.keys(a).map(function(c){return[c,a[c]]})},h.values=function(a){return h.keys(a).map(function(c){return a[c]})})})},"esri/views/3d/interactive/measurementTools/support/UnitNormalizer":function(){define(["require","exports","../../../../../core/unitUtils"],function(t,h,k){return function(){function a(a){void 0===a&&(a=null);this.spatialReference=a;this._updateNormalizationFactors}
Object.defineProperty(a.prototype,"spatialReference",{get:function(){return this._spatialReference},set:function(a){a!==this._spatialReference&&(this._spatialReference=a,this._updateNormalizationFactors())},enumerable:!0,configurable:!0});a.prototype.normalizeDistance=function(a){return a*this._metersPerDistanceUnit};a.prototype.normalizeElevation=function(a){return a*this._metersPerElevationUnit};a.prototype.normalizeArea=function(a){return a*this._squareMetersPerAreaUnit};a.prototype._updateNormalizationFactors=
function(){this._metersPerDistanceUnit=k.getMetersPerUnitForSR(this._spatialReference,1);this._metersPerElevationUnit=k.getMetersPerUnitForSR(this._spatialReference,1);this._squareMetersPerAreaUnit=this._metersPerDistanceUnit*this._metersPerDistanceUnit};return a}()})},"esri/views/3d/interactive/measurementTools/directLineMeasurement3D/DirectLineMeasurement3DView":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Handles ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../manipulatorUtils ../support/Label ../support/LabelSegment ../support/labelUtils ../support/PathSegmentInterpolator ../support/viewUtils ../../../support/ElevationProvider ../../../support/geometryUtils ../../../support/LaserLineRenderer ../../../support/projectionUtils ../../../support/stack ../../../webgl-engine/lib/Geometry ../../../webgl-engine/lib/GeometryData ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/lib/Intersector ../../../webgl-engine/lib/Layer ../../../webgl-engine/lib/Object3D ../../../webgl-engine/materials/ColorMaterial ../../../webgl-engine/materials/lineStippleUtils ../../../webgl-engine/materials/MeasurementArrowMaterial ../../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g,r,z,w,y,d,u,p,A,l,x,C,F,G,L,M,D,N,K,Q,B){t=[1,.5,0,.75];var R={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:t,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,
.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:t,guideLineWidth:2,guideLineColor:t,guideStippleLengthPixels:6,labelDistance:25};t=function(){function a(a,b){void 0===b&&(b={});this._visible=!1;this._laserLineRenderer=null;this._directDistanceLabel=new r;this._horizontalDistanceLabel=new r;this._verticalDistanceLabel=new r;this._handles=new c;this._listenerHandles=null;this._cursorPosition=v.vec3f64.create();this._startPosition=v.vec3f64.create();
this._endPosition=v.vec3f64.create();this._centerPosition=v.vec3f64.create();this._cornerPosition=v.vec3f64.create();this._arrowLabelSegment=new z;this._horizontalLabelSegment=new z;this._verticalLabelSegment=new z;this._geodesicProjectionLabelSegment=new z;this._origin=v.vec3f64.create();this._originTransform=f.mat4f64.create();this._lastDraggedHandle=null;this._model=a;this._view=a.sceneView;this._params=d.copyParameter(R,b);this._layer=new M("point-to-point-measurement",{isPickable:!1});this._createMaterials();
this._createObjects();this._intersector=new L.Intersector(this._view.viewingMode);this._intersector.options.store=0}a.prototype.destroy=function(){this.hide();this._handles.destroy();this._handles=null};Object.defineProperty(a.prototype,"requiresCursorPoint",{get:function(){return"initial"===this._model.state&&this._model.active},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"cameraAboveGround",{get:function(){return this._view.state.camera.aboveGround},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"visible",{get:function(){return this._visible},set:function(a){a?this.show():this.hide()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"testData",{get:function(){return{labels:{direct:this._directDistanceLabel,horizontal:this._horizontalDistanceLabel,vertical:this._verticalDistanceLabel},laserLineRenderer:this._laserLineRenderer}},enumerable:!0,configurable:!0});a.prototype.createManipulators=function(){var a=this,d=function(){var d=g.createSphereManipulator(a._view,
a._params.handleColor,a._params.handleOpacity);d.visible=!1;d.hideOnGrab=!0;d.radius=a._params.handleRadius;return d},b=d(),f=d();this._model.startPoint&&(b.mapPoint=this._model.startPoint,b.visible=!0);this._model.endPoint&&(f.mapPoint=this._model.endPoint,f.visible=!0);var e=function(){var d=a._lastDraggedHandle;b.grabbing&&!f.grabbing&&(d="start");f.grabbing&&!b.grabbing&&(d="end");b.grabbing||f.grabbing||(d=null);var e=d!==a._lastDraggedHandle;a._lastDraggedHandle=d;e&&a.visible&&a._updateLaserLine()};
this._handles.add([b.watch("grabbing",function(){e()}),f.watch("grabbing",function(){e()})]);return{start:b,end:f}};a.prototype.show=function(){if(!this._visible){this._visible=!0;var a=this._view._stage;this._laserLineRenderer=new A.LaserLineRenderer(this._view.renderCoordsHelper,{innerColor:this._params.laserLineInnerColor,innerWidth:this._params.laserLineInnerWidth,glowColor:this._params.laserLineGlowColor,glowWidth:this._params.laserLineGlowWidth,glowFalloff:this._params.laserLineGlowFalloff,
globalAlpha:this._params.laserLineGlobalAlpha});a.addRenderPlugin(this._laserLineRenderer.renderSlots,this._laserLineRenderer);this._addToStage(a);this._directDistanceLabel.addToView(this._view);this._horizontalDistanceLabel.addToView(this._view);this._verticalDistanceLabel.addToView(this._view);this._initializeListeners();this._updateCursorPosition();this._updateStartPosition();this._updateEndPosition();this._updateLaserLine();this._updateView()}};a.prototype.hide=function(){if(this._visible){this._visible=
!1;var a=this._view._stage;a.removeRenderPlugin(this._laserLineRenderer);this._laserLineRenderer=null;this._removeFromStage(a);this._directDistanceLabel.removeFromView(this._view);this._horizontalDistanceLabel.removeFromView(this._view);this._verticalDistanceLabel.removeFromView(this._view);this._destroyListeners();this._view.cursor=null}};a.prototype.pick=function(d){var b=this._view.spatialReference;d=m.screenPointObjectToArray(d.screenPoint);this._view.sceneIntersectionHelper.intersectToolIntersectorScreen(d,
this._intersector);d=this._intersector.results.min;var f=v.vec3f64.create();if(!d.getIntersectionPoint(f))return new a.PickResult;b=this._view.renderCoordsHelper.fromRenderCoords(f,b);return new a.PickResult("TerrainRenderer"===d.intersector?"ground":"feature",f,b)};a.prototype.getElevation=function(a){return this._view.basemapTerrain.ready?u.getElevationAtPoint(this._view.elevationProvider,a)||0:0};a.prototype.overlappingHandles=function(a,b){return d.pointToPointScreenDistance(a,b,this._view)<=
this._params.handleRadius};a.prototype._createMaterials=function(){this._triangleLineMaterial=new B({width:this._params.triangleLineWidth,color:this._params.triangleColor,polygonOffset:!0},"triangle-line");this._triangleLineMaterial.renderOccluded=4;this._triangleCornerMaterial=new N({color:this._params.triangleColor,transparent:!0,writeDepth:!1,polygonOffset:!0},"triangle-corner");this._triangleCornerMaterial.renderOccluded=4;this._arrowMaterial=new Q({outlineColor:this._params.arrowOutlineColor,
stripeEvenColor:this._params.arrowStripeEvenColor,stripeOddColor:this._params.arrowStripeOddColor,polygonOffset:!0},"arrow");this._arrowMaterial.renderOccluded=4;this._geodesicProjectionLineMaterial=new B({width:this._params.geodesicProjectionLineWidth,color:this._params.geodesicProjectionLineColor,polygonOffset:!0},"geodesic-line");this._geodesicProjectionLineMaterial.renderOccluded=4;this._geodesicGuideLineMaterial=new B({width:this._params.guideLineWidth,color:this._params.geodesicProjectionLineColor,
polygonOffset:!0,stipplePattern:K.createStipplePatternSimple(this._params.guideStippleLengthPixels),stippleIntegerRepeats:!1},"geodesic-guide");this._geodesicGuideLineMaterial.renderOccluded=4};a.prototype._createObjects=function(){this._triangleLineObject=new D;this._layer.addObject(this._triangleLineObject);this._triangleCornerObject=new D;this._layer.addObject(this._triangleCornerObject);this._arrowObject=new D;this._layer.addObject(this._arrowObject);this._geodesicProjectionLineObject=new D;this._layer.addObject(this._geodesicProjectionLineObject);
this._geodesicProjectionStartGuideObject=new D;this._layer.addObject(this._geodesicProjectionStartGuideObject);this._geodesicProjectionEndGuideObject=new D;this._layer.addObject(this._geodesicProjectionEndGuideObject)};a.prototype._addToStage=function(a){a.add(0,this._layer);a.add(3,this._triangleLineMaterial);a.add(3,this._triangleCornerMaterial);a.add(3,this._arrowMaterial);a.add(3,this._geodesicProjectionLineMaterial);a.add(3,this._geodesicGuideLineMaterial);a.add(1,this._triangleLineObject);a.add(1,
this._triangleCornerObject);a.add(1,this._arrowObject);a.add(1,this._geodesicProjectionLineObject);a.add(1,this._geodesicProjectionStartGuideObject);a.add(1,this._geodesicProjectionEndGuideObject);a.addToViewContent([this._layer.id])};a.prototype._removeFromStage=function(a){a.removeFromViewContent([this._layer.id]);a.remove(0,this._layer.id);a.remove(3,this._triangleLineMaterial.id);a.remove(3,this._triangleCornerMaterial.id);a.remove(3,this._arrowMaterial.id);a.remove(3,this._geodesicProjectionLineMaterial.id);
a.remove(3,this._geodesicGuideLineMaterial.id);a.remove(1,this._triangleLineObject.id);a.remove(1,this._triangleCornerObject.id);a.remove(1,this._arrowObject.id);a.remove(1,this._geodesicProjectionLineObject.id);a.remove(1,this._geodesicProjectionStartGuideObject.id);a.remove(1,this._geodesicProjectionEndGuideObject.id)};a.prototype._getLabelPositions=function(a,b,f,c,p){var l=this._model.triangleView.collapsed,g=m.castRenderScreenPointArray3(x.sv3d.get()),u=m.castRenderScreenPointArray3(x.sv3d.get());
p.projectPoint(f,g);p.projectPoint(b,u);g={direct:l?"top":"bottom",horizontal:"top",vertical:g[0]<u[0]?"left":"right"};l||(u=x.sv2d.get(),l=x.sv2d.get(),d.screenSpaceTangent(a,f,u,p),d.screenSpaceTangent(a,b,l,p),q.vec2.dot(u,l)>=O?g.direct=e.sign(u[1])===e.sign(l[1])?w.mirrorPosition(g.vertical):g.vertical:(a=m.castRenderScreenPointArray(x.sv2d.get()),d.screenSpaceTangent(f,b,a,p),q.vec2.dot(a,l)>=O&&(g.direct=e.sign(a[0])===e.sign(l[0])?w.mirrorPosition(g.horizontal):g.horizontal)));"below-the-surface"===
c&&(b=function(a){return"top"===a?"bottom":"top"},g.direct=b(g.direct),g.horizontal=b(g.horizontal),g.vertical=b(g.vertical));return g};a.prototype._updateView=function(){var a;if(this._view.ready){var f=this._view._stage.getCamera(),e=this._view.renderCoordsHelper,p=this._model.triangleView;if(p.visible){var c="camera-dependent"===this._model.measurementSurfaceLocation?this._view.state.camera.aboveGround?"above-the-surface":"below-the-surface":this._model.measurementSurfaceLocation,l=this._startPosition;
a=this._endPosition;var g="above-the-surface"===c?1:-1,u=g*(e.getAltitude(a)-e.getAltitude(l));0>u&&(a=[a,l],l=a[0],a=a[1]);var r=this._cornerPosition;e.worldUpAtPosition(l,r);b.vec3.scale(r,r,g*Math.abs(u));b.vec3.add(r,r,l);e=this._centerPosition;d.midpoint([l,a,r],e);b.vec3.copy(this._origin,e);n.mat4.identity(this._originTransform);n.mat4.translate(this._originTransform,this._originTransform,this._origin);p.collapsed?(this._triangleLineObject.removeAllGeometries(),this._triangleCornerObject.removeAllGeometries()):
this._updateTriangleObjects(this._triangleLineObject,this._triangleCornerObject,l,a,r,this._origin,this._originTransform,f,this._horizontalLabelSegment,this._verticalLabelSegment);this._updateArrowObject(this._arrowObject,this._startPosition,this._endPosition,this._origin,this._originTransform,p.stripeLength,f,p.mode,this._arrowLabelSegment);e=this._requiresGeodesicVisualElements(this._startPosition,this._endPosition,f,p.mode);this._updateGeodesicProjectionLineObject(this._geodesicProjectionLineObject,
this._startPosition,this._endPosition,this._origin,this._originTransform,e,this._geodesicProjectionLabelSegment);this._updateGeodesicProjectionGuideObjects(e);g=this._params.labelDistance;c=this._getLabelPositions(l,a,r,c,f);this._updateAuxiliaryMeasureLabels(p,f,c);"geodesic"!==p.mode?this._updateLabel(this._directDistanceLabel,this._arrowLabelSegment,g,c.direct,p.directLabel,p.visible,16,f):(this._updateLabel(this._horizontalDistanceLabel,e?this._geodesicProjectionLabelSegment:this._arrowLabelSegment,
g,c.horizontal,p.horizontalLabel,p.visible,16,f),this._directDistanceLabel.visible=!1)}else this._triangleLineObject.removeAllGeometries(),this._triangleCornerObject.removeAllGeometries(),this._arrowObject.removeAllGeometries(),this._geodesicProjectionLineObject.removeAllGeometries(),this._geodesicProjectionStartGuideObject.removeAllGeometries(),this._geodesicProjectionEndGuideObject.removeAllGeometries(),this._directDistanceLabel.visible=!1,this._horizontalDistanceLabel.visible=!1,this._verticalDistanceLabel.visible=
!1}};a.prototype._updateAuxiliaryMeasureLabels=function(a,d,b){if(a.collapsed)this._horizontalDistanceLabel.visible=!1,this._verticalDistanceLabel.visible=!1;else{var f=this._params.labelDistance;this._updateLabel(this._horizontalDistanceLabel,this._horizontalLabelSegment,f,b.horizontal,a.horizontalLabel,!0,12,d);this._updateLabel(this._verticalDistanceLabel,this._verticalLabelSegment,f,b.vertical,a.verticalLabel,!0,12,d)}};a.prototype._updateTriangleObjects=function(a,d,f,e,p,c,l,g,u,r){var y=[b.vec3.subtract(x.sv3d.get(),
f,c),b.vec3.subtract(x.sv3d.get(),p,c),b.vec3.subtract(x.sv3d.get(),e,c)];u.update(p,e);r.update(f,p);u=new C(G.createPolylineGeometry(y),"triangle-line");a.removeAllGeometries();a.addGeometry(u,this._triangleLineMaterial,l);a=x.sv3d.get();u=x.sv3d.get();b.vec3.subtract(a,p,f);b.vec3.normalize(a,a);b.vec3.subtract(u,e,p);b.vec3.normalize(u,u);f=.33*Math.min(b.vec3.distance(p,f),b.vec3.distance(p,e));g=this._params.triangleCornerSize*g.computeScreenPixelSizeAt(p);p=new C(this._quadGeometryData(p,a,
u,Math.min(f,g),c),"triangle-corner");d.removeAllGeometries();d.addGeometry(p,this._triangleCornerMaterial,l)};a.prototype._updateArrowObject=function(a,d,b,f,p,e,c,l,g){this._createInterpolatedLineGeometry(a,this._arrowMaterial,"arrow",d,b,f,p,l,this._arrowLabelSegment);a=c.computeScreenPixelSizeAt(g.origin);this._arrowMaterial.setParameterValues({width:this._params.arrowWidth*a,stripeLength:e})};a.prototype._getSegmentInterpolator=function(a,d){var b=this._view.renderCoordsHelper.spatialReference;
return l.canProject(this._view.spatialReference,l.SphericalECEFSpatialReference)?new y.Spherical(a,d,b,b):new y.Linear(a,d)};a.prototype._updateGeodesicProjectionLineObject=function(a,d,f,p,e,c,l){c?(c=this._view.renderCoordsHelper,d=b.vec3.copy(x.sv3d.get(),d),f=b.vec3.copy(x.sv3d.get(),f),c.setAltitude(0,d),c.setAltitude(0,f),this._createInterpolatedLineGeometry(a,this._geodesicProjectionLineMaterial,"geodesicProjectionLine",d,f,p,e,"geodesic",l)):a.removeAllGeometries()};a.prototype._requiresGeodesicVisualElements=
function(a,d,b,f){return"geodesic"===f&&this._model.geodesicDistanceExceeded?this._requiresGeodesicGuideAt(a,b)||this._requiresGeodesicGuideAt(d,b):!1};a.prototype._requiresGeodesicGuideAt=function(a,d){var b=this._view.renderCoordsHelper;d=d.computeScreenPixelSizeAt(a);return 10<=b.getAltitude(a)/d};a.prototype._updateGeodesicProjectionGuideObjects=function(a){if(a){a=this._view.renderCoordsHelper;var d=b.vec3.copy(x.sv3d.get(),this._startPosition),f=b.vec3.copy(x.sv3d.get(),this._endPosition);a.setAltitude(0,
d);a.setAltitude(0,f);this._createInterpolatedLineGeometry(this._geodesicProjectionStartGuideObject,this._geodesicGuideLineMaterial,"geodesicGuideLine",d,this._startPosition,this._origin,this._originTransform,"euclidean");this._createInterpolatedLineGeometry(this._geodesicProjectionEndGuideObject,this._geodesicGuideLineMaterial,"geodesicGuideLine",f,this._endPosition,this._origin,this._originTransform,"euclidean")}else this._geodesicProjectionStartGuideObject.removeAllGeometries(),this._geodesicProjectionEndGuideObject.removeAllGeometries()};
a.prototype._createInterpolatedLineGeometry=function(a,f,p,e,c,l,g,u,r){var y=this._view.renderCoordsHelper,q=[],v=[],m=function(a,d){var f=x.sv3d.get();b.vec3.subtract(f,a,l);q.push(f);v.push(d)};if("euclidean"===u){var w=x.sv3d.get();d.midpoint([e,c],w);u=x.sv3d.get();y.worldUpAtPosition(w,u);m(e,u);m(c,u);r&&r.update(e,c)}else{e=this._getSegmentInterpolator(e,c);c=this._params.arrowSubdivisions+1&-2;for(var k=w=null,B=0;B<c;++B){var z=B/(c-1),n=x.sv3d.get();u=x.sv3d.get();e.eval(z,n);y.worldUpAtPosition(n,
u);B===c/2-1?w=n:B===c/2&&(k=n);m(n,u)}r&&r.update(w,k)}p=new C(G.createPolylineGeometry(q,v),p);a.removeAllGeometries();a.addGeometry(p,f,g)};a.prototype._quadGeometryData=function(a,d,f,e,p){var c=x.sv3d.get(),l=[],g=x.sv3d.get();b.vec3.scale(g,f,e);f=x.sv3d.get();b.vec3.scale(f,d,-e);for(d=0;4>d;++d)b.vec3.copy(c,a),b.vec3.subtract(c,c,p),d&1&&b.vec3.add(c,c,g),d&2&&b.vec3.add(c,c,f),l.push(c[0],c[1],c[2]);return new F.GeometryData({position:{size:3,data:l}},{position:new Uint32Array([0,1,2,1,
2,3])})};a.prototype._updateLabel=function(a,d,b,f,c,e,p,l){var g=m.castScreenPointArray(x.sv2d.get()),u=m.castScreenPointArray(x.sv2d.get());d=w.computeLabelPositionFromSegment(l,d,b,f,g,u);a.updatePosition(g,u);a.text=c;a.visible=d&&e;a.fontSize=p};a.prototype._updateCursorPosition=function(){this._model.cursorPoint&&this._view.renderCoordsHelper.toRenderCoords(this._model.cursorPoint,this._cursorPosition);this._updateLaserLine()};a.prototype._updateStartPosition=function(){this._model.startPoint&&
this._view.renderCoordsHelper.toRenderCoords(this._model.startPoint,this._startPosition)};a.prototype._updateEndPosition=function(){this._model.endPoint&&this._view.renderCoordsHelper.toRenderCoords(this._model.endPoint,this._endPosition)};a.prototype._getFocusPosition=function(){var a=this._model,d=a.triangleView.visible&&a.triangleView.collapsed&&"euclidean"===a.measurementMode;switch(a.state){case "drawing":return d?this._startPosition:a.endPoint?this._endPosition:this._startPosition;case "editing":return d?
"start"===this._lastDraggedHandle?this._endPosition:this._startPosition:"start"===this._lastDraggedHandle?this._startPosition:this._endPosition;default:return a.cursorPoint?this._cursorPosition:null}};a.prototype._getFocusSpherePosition=function(){return"drawing"===this._model.state||"end"===this._lastDraggedHandle?this._startPosition:this._endPosition};a.prototype._updateLaserLine=function(){var a=this._model,d=this._getFocusPosition(),b=this._params.laserLineEnabled&&!!d&&"measured"!==a.state&&
a.active;b?(this._laserLineRenderer.heightPlaneEnabled=b&&"euclidean"===a.measurementMode,this._laserLineRenderer.pointDistanceEnabled=b&&!!a.startPoint&&"geodesic"===a.measurementMode,this._laserLineRenderer.heightPlanePosition=d,this._laserLineRenderer.pointDistanceOrigin=this._getFocusSpherePosition(),this._laserLineRenderer.pointDistanceTarget=d,this._laserLineRenderer.lineVerticalPlaneEnabled=b&&a.triangleView.visible&&!a.triangleView.collapsed,this._laserLineRenderer.lineVerticalPlaneSegment=
p.lineSegment.fromPoints(this._startPosition,this._endPosition,P)):(this._laserLineRenderer.heightPlaneEnabled=!1,this._laserLineRenderer.pointDistanceEnabled=!1,this._laserLineRenderer.lineVerticalPlaneEnabled=!1)};a.prototype._initializeListeners=function(){var a=this;this._listenerHandles=new c;this._listenerHandles.add([this._model.watch("state",function(){a._updateLaserLine()}),this._model.watch("measurementMode",function(){a._updateLaserLine()}),this._model.watch("hoveredHandle",function(){a._updateView()}),
this._model.watch("cursorPoint",function(){a._updateCursorPosition()}),this._model.watch("startPoint",function(){a._updateStartPosition();a._updateView();a._updateLaserLine()}),this._model.watch("endPoint",function(){a._updateEndPosition();a._updateView();a._updateLaserLine()}),this._model.watch("unit",function(){a._updateView()}),this._model.watch("active",function(){a._updateLaserLine();a._updateView()}),this._view.state.watch("camera",function(){a._updateView()})])};a.prototype._destroyListeners=
function(){this._listenerHandles.destroy();this._listenerHandles=null};return a}();(function(a){var d=function(){return function(){}}();a.PickRequest=d;d=function(){return function(a,d,b){void 0===a&&(a=null);void 0===d&&(d=null);void 0===b&&(b=null);this.type=a;this.scenePoint=d;this.mapPoint=b}}();a.PickResult=d})(t||(t={}));var O=Math.cos(e.deg2rad(12)),P=p.lineSegment.create();return t})},"esri/views/3d/interactive/manipulatorUtils":function(){define("require exports ../../../core/maybe ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec4f64 ../../../layers/graphics/dehydratedFeatures ../layers/graphics/graphicUtils ../support/stack ../webgl-engine/lib/Geometry ../webgl-engine/lib/GeometryUtil ../webgl-engine/materials/ColorMaterial ../webgl-engine/materials/ShadedColorMaterial ../../interactive/Manipulator3D".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g,r){function z(a,b){void 0===b&&(b=4);var d=e.vec4f64.fromValues(a[0],a[1],a[2],3<a.length?a[3]:1);a=new g.ShadedColorMaterial({color:d,transparent:1>a[3],writeDepth:!0,cullFace:2},"manipulator");a.renderOccluded=b;return a}function w(a,b,e,g){a=c.vec3.normalize(f.sv3d.get(),a);b=c.vec3.normalize(f.sv3d.get(),b);var d=c.vec3.cross(f.sv3d.get(),a,b);g[0]=a[0];g[1]=a[1];g[2]=a[2];g[3]=0;g[4]=b[0];g[5]=b[1];g[6]=b[2];g[7]=0;g[8]=d[0];g[9]=d[1];g[10]=d[2];g[11]=0;g[12]=
e[0];g[13]=e[1];g[14]=e[2];g[15]=1;return g}function y(a,b){var d=a.getViewForGraphic(b);return k.isSome(d)&&"computeAttachmentOrigin"in d?d.computeAttachmentOrigin(b,a.spatialReference):null}Object.defineProperty(h,"__esModule",{value:!0});h.createManipulatorMaterial=z;h.createManipulatorOutlineMaterial=function(a,b){void 0===b&&(b=4);a=e.vec4f64.fromValues(a[0],a[1],a[2],4===a.length?a[3]:1);a=new v({color:a,transparent:!0,writeDepth:!0,cullFace:1},"manipulator-outline");a.renderOccluded=b;return a};
h.createSphereManipulator=function(a,f,c){return new r.Manipulator3D({view:a,renderObjects:[{geometry:new q(b.createSphereGeometry(1,32,32),"manipulator"),material:z(e.vec4f64.fromValues(f[0],f[1],f[2],null!=c?c:1))}]})};h.calculateInputRotationTransform=function(d,b,e,g){d=c.vec3.subtract(f.sv3d.get(),d,e);g=c.vec3.cross(f.sv3d.get(),g,d);e=w(d,g,e,f.sm4d.get());a.mat4.invert(e,e);b=c.vec3.transformMat4(f.sv3d.get(),b,e);return Math.atan2(b[1],b[0])};h.calculateTranslateRotateFromBases=w;h.getGraphicAttachmentOrigin=
y;h.placeAtGraphic=function(a,b,f){a=y(a,f);k.isSome(a)?b.elevationAlignedLocation=a:(f=f.geometry,k.isNone(f)||(f=n.computeCentroid(f),k.isNone(f)||(b.location=m.hydrateGeometry(f))))}})},"esri/views/3d/webgl-engine/materials/ShadedColorMaterial":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/ShadedColorMaterialTechnique".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g,r,z){Object.defineProperty(h,"__esModule",{value:!0});var w=m.newLayout().vec3f(q.VertexAttrConstants.POSITION).vec3f(q.VertexAttrConstants.NORMAL);t=function(f){function e(a,b){b=f.call(this,b)||this;b.supportsEdges=!0;b.techniqueConfig=new z.ShadedColorMaterialTechniqueConfiguration;b.params=g.copyParameters(a,d);return b}a(e,f);e.prototype.setParameterValues=function(a){v.updateParameters(this.params,a)&&this.parametersChanged()};e.prototype.getParameters=function(){return this.params};
e.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.cullFace=this.params.cullFace;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.writeDepth=this.params.writeDepth;return this.techniqueConfig};e.prototype.getPassParameters=function(){return this.params};e.prototype.intersect=function(a,b,d,f,e,c,p){g.intersectTriangleGeometry(a,b,f,e,c,void 0,p)};e.prototype.getGLMaterial=
function(a){return 0===a.output||4===a.output?new y(a):void 0};e.prototype.createBufferWriter=function(){return new b.DefaultBufferWriter(w)};e.prototype.createRenderer=function(a,b){return new r(a,b,this)};return e}(f.Material);h.ShadedColorMaterial=t;var y=function(b){function d(a){a=b.call(this,a)||this;a.updateParameters();return a}a(d,b);d.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(z.ShadedColorMaterialTechnique,this.material.getTechniqueConfig(this.output),
this.technique)};d.prototype.beginSlot=function(a){if(4===this.output)return 3===a;var b=3;this.technique.configuration.transparent&&(b=this.technique.configuration.writeDepth?5:8);return a===b};d.prototype.bind=function(a,b){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getPassParameters(),b)};return d}(n.GLMaterial),d={color:[1,1,1,1],shadingTint:[0,0,0,.25],shadingDirection:c.vec3.normalize(e.vec3f64.create(),[.5,-.5,-.5]),transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,
cullFace:0}})},"esri/views/3d/webgl-engine/shaders/ShadedColorMaterialTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/libs/gl-matrix-2/vec4f64 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./ShadedColorMaterial.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g,r,z){Object.defineProperty(h,"__esModule",{value:!0});c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}k(b,a);b.prototype.initializeProgram=function(a){var d=b.shader.get(),f=this.configuration,d=d.build({slicePlaneEnabled:f.slicePlaneEnabled,sliceHighlightDisabled:f.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1});return new r(a.rctx,d.generateSource("vertex"),d.generateSource("fragment"),v.Default3D)};b.prototype.bindPass=function(a,
b,d){a=b.color;var f=b.shadingTint;this.program.setUniform4fv("color",a);this.program.setUniform4fv("shadedColor",this.blendColor(w,f,a));this.program.setUniform3fv("shadingDirection",b.shadingDirection);this.program.setUniformMatrix4fv("viewNormal",d.viewInvTransp)};b.prototype.blendColor=function(a,b,d){var f=1-b[3],e=b[3]+d[3]*f;if(0===e)return a[3]=e,a;a[0]=(b[0]*b[3]+d[0]*d[3]*f)/e;a[1]=(b[1]*b[3]+d[1]*d[3]*f)/e;a[2]=(b[2]*b[3]+d[2]*d[3]*f)/e;a[3]=d[3];return a};b.prototype.bindDraw=function(a){n.Transform.bindUniforms(this.program,
a);m.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};b.prototype.initializePipeline=function(){var a=this.configuration,b=0===a.output?a.transparent&&z.separateBlendingParams(770,1,771,771):null;return z.makePipelineState({blending:b,culling:function(a){return 0!==a&&{face:1===a?1028:1029,mode:2305}}(a.cullFace),depthTest:{func:515},depthWrite:a.writeDepth&&z.defaultDepthWriteParams,colorWrite:z.defaultColorWriteParams})};b.shader=new f.ReloadableShaderModule(g,"./ShadedColorMaterial.glsl",
t);return b}(q.ShaderTechnique);h.ShadedColorMaterialTechnique=c;c=function(f){function d(){var a=null!==f&&f.apply(this,arguments)||this;a.output=0;a.cullFace=0;a.slicePlaneEnabled=!1;a.sliceHighlightDisabled=!1;a.transparent=!1;a.writeDepth=!0;return a}k(d,f);a([b.parameter({count:7})],d.prototype,"output",void 0);a([b.parameter({count:3})],d.prototype,"cullFace",void 0);a([b.parameter()],d.prototype,"slicePlaneEnabled",void 0);a([b.parameter()],d.prototype,"sliceHighlightDisabled",void 0);a([b.parameter()],
d.prototype,"transparent",void 0);a([b.parameter()],d.prototype,"writeDepth",void 0);return d}(b.ShaderTechniqueConfiguration);h.ShadedColorMaterialTechniqueConfiguration=c;var w=e.vec4f64.create()})},"esri/views/3d/webgl-engine/shaders/ShadedColorMaterial.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(t,h,k,a,c,e,m){Object.defineProperty(h,"__esModule",{value:!0});h.build=function(q){var b=new m.ShaderBuilder;b.include(c.Transform,{linearDepth:!1});b.vertex.uniforms.add("proj","mat4").add("view","mat4").add("viewNormal","mat4").add("model","mat4").add("modelNormal","mat4");b.fragment.uniforms.add("color","vec4").add("shadedColor","vec4").add("shadingDirection","vec3");b.attributes.add("position","vec3");b.attributes.add("normal","vec3");b.varyings.add("vWorldPosition","vec3");b.varyings.add("vViewNormal",
"vec3");b.varyings.add("vViewDirection","vec3");b.vertex.code.add(e.glsl(n||(n=k(["\n    void main(void) {\n      vWorldPosition \x3d (model * vec4(position, 1.0)).xyz;\n\n      vec3 worldNormal \x3d (modelNormal * vec4(normal, 1)).xyz;\n      vViewNormal \x3d (viewNormal * vec4(worldNormal, 1)).xyz;\n\n      gl_Position \x3d transformPosition(proj, view, vWorldPosition);\n    }\n  "],["\n    void main(void) {\n      vWorldPosition \x3d (model * vec4(position, 1.0)).xyz;\n\n      vec3 worldNormal \x3d (modelNormal * vec4(normal, 1)).xyz;\n      vViewNormal \x3d (viewNormal * vec4(worldNormal, 1)).xyz;\n\n      gl_Position \x3d transformPosition(proj, view, vWorldPosition);\n    }\n  "]))));
b.include(a.Slice,q);b.fragment.code.add(e.glsl(f||(f=k(["\n    void main() {\n      discardBySlice(vWorldPosition);\n\n      vec3 viewNormalNorm \x3d normalize(vViewNormal);\n\n      float shadingFactor \x3d 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\n      vec4 colorWithShading \x3d mix(color, shadedColor, shadingFactor);\n\n      gl_FragColor \x3d highlightSlice(colorWithShading, vWorldPosition);\n    }\n    "],["\n    void main() {\n      discardBySlice(vWorldPosition);\n\n      vec3 viewNormalNorm \x3d normalize(vViewNormal);\n\n      float shadingFactor \x3d 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\n      vec4 colorWithShading \x3d mix(color, shadedColor, shadingFactor);\n\n      gl_FragColor \x3d highlightSlice(colorWithShading, vWorldPosition);\n    }\n    "]))));
return b};var n,f})},"esri/views/interactive/Manipulator3D":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/assignHelper ../../core/Accessor ../../core/compilerUtils ../../core/Evented ../../core/maybe ../../core/screenUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../core/libs/gl-matrix-2/mat3 ../../core/libs/gl-matrix-2/mat3f64 ../../core/libs/gl-matrix-2/mat4 ../../core/libs/gl-matrix-2/mat4f64 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f32 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../../geometry/support/aaBoundingRect ../../layers/graphics/dehydratedFeatures ../3d/support/ElevationProvider ../3d/support/geometryUtils ../3d/support/projectionUtils ../3d/support/stack ../3d/webgl-engine/lib/Intersector ../3d/webgl-engine/lib/intersectorUtils ../3d/webgl-engine/lib/Layer ../3d/webgl-engine/lib/Object3D".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g,r,z,w,y,d,u,p,A,l,x,C,F,G,L,M,D,N){function K(a){return 0!==a[12]||0!==a[13]||0!==a[14]}Object.defineProperty(h,"__esModule",{value:!0});t=function(e){function c(a){a=e.call(this,a)||this;a.hideOnGrab=!1;a.moveOnDrag=!0;a.snapToPointer=!0;a.collisionType={type:"point"};a.collisionPriority=0;a.renderObjects=[];a.autoScaleRenderObjects=!0;a._radius=10;a._worldSized=!1;a._focusMultiplier=2;a._touchMultiplier=2.5;a.interactive=!0;a.selectable=!1;a.cursor=null;a.dragging=
!1;a._areAnyEngineObjectsVisible=!1;a.events=new n({target:a});a._position=p.vec3f64.create();a._modelTransform=w.mat4f64.create();a._dragOffset=null;a._dirtyScreenPoint=q.createScreenPoint();a._dirtyScreenPointArray=q.createScreenPointArray();a._dirtyRenderScreenPointArray=q.createRenderScreenPointArray3();a._dirtyOriginScreenPointArray=q.createScreenPointArray();a._dirtyScreenPixelSize=1;a._screenPositionDirty=!0;a._engineResourcesAddedToStage=!1;a._engineResources=null;a._attached=!1;a._engineLayerId=
null;a._materialIdReferences=null;a._hitResult={onSurface:!1,surfaceType:"ground"};return a}a(c,e);c.prototype.initialize=function(){var a=this;this._intersector=new L.Intersector(this.view.viewingMode);this._mapPoint=l.makeDehydratedPoint(0,0,0,this.view.spatialReference);this.events.on("drag",function(b){return a.drag(b)})};c.prototype.destroy=function(){this._removeResourcesFromStage();this._engineResources=null;this._set("view",null);this._camera=null};Object.defineProperty(c.prototype,"alignment",
{get:function(){return this._get("alignment")},set:function(a){this._set("alignment",a);this.constructed&&this._refreshMapPoint()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"visible",{set:function(a){a!==this._get("visible")&&(this._set("visible",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"radius",{get:function(){return this._radius},set:function(a){a!==this._radius&&(this._radius=a,this._updateEngineObject())},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"worldSized",{get:function(){return this._worldSized},set:function(a){a!==this._worldSized&&(this._worldSized=a,this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"focusMultiplier",{get:function(){return this._focusMultiplier},set:function(a){this._focusMultiplier=a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"touchMultiplier",{get:function(){return this._touchMultiplier},set:function(a){this._touchMultiplier=
a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"modelTransform",{get:function(){return this._modelTransform},set:function(a){K(a)&&(this._screenPositionDirty=!0);z.mat4.copy(this._modelTransform,a);this._updateEngineObject()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"position",{get:function(){return this._position},set:function(a){this.view.renderCoordsHelper.fromRenderCoords(a,this._mapPoint,this._mapPoint.spatialReference);this._refreshMapPoint()},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"mapPoint",{get:function(){return this._mapPoint},set:function(a){l.clonePoint(a,this._mapPoint);this._refreshMapPoint()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"grabbing",{set:function(a){a!==this._get("grabbing")&&(this._set("grabbing",a),this._updateEngineObject());a||(this._dragOffset=null)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hovering",{set:function(a){a!==this._get("hovering")&&
(this._set("hovering",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"selected",{set:function(a){a!==this._get("selected")&&(this._set("selected",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"state",{set:function(a){a!==this._get("state")&&(this._set("state",a),this._updateEngineObject())},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"areAnyEngineObjectsVisible",{get:function(){return this._areAnyEngineObjectsVisible},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"surfaceType",{get:function(){return this._hitResult.onSurface?this._hitResult.surfaceType:null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"focused",{get:function(){return this._focused},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_focused",{get:function(){return this._get("hovering")||this._get("grabbing")},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"screenPoint",
{get:function(){this._updateScreenSpaceProperties();return this._dirtyScreenPoint},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_screenPointArray",{get:function(){this._updateScreenSpaceProperties();return this._dirtyScreenPointArray},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_renderScreenPointArray",{get:function(){this._updateScreenSpaceProperties();return this._dirtyRenderScreenPointArray},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"_originScreenPointArray",{get:function(){this._updateScreenSpaceProperties();return this._dirtyOriginScreenPointArray},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_screenPixelSize",{get:function(){this._updateScreenSpaceProperties();return this._dirtyScreenPixelSize},enumerable:!0,configurable:!0});c.prototype._updateScreenSpaceProperties=function(){if(this._screenPositionDirty){this._screenPositionDirty=!1;this._dirtyScreenPixelSize=this._camera.computeScreenPixelSizeAt(this._position);
var a=K(this._modelTransform),b;a?(b=this._calculateModelTransformOffset(Y),b=u.vec3.add(b,b,this._position)):b=this._position;this._camera.projectPoint(b,this._dirtyRenderScreenPointArray);this._camera.renderToScreen(this._dirtyRenderScreenPointArray,this._dirtyScreenPointArray);q.screenPointArrayToObject(this._dirtyScreenPointArray,this._dirtyScreenPoint);a?(this._camera.projectPoint(this._position,R),this._camera.renderToScreen(R,this._dirtyOriginScreenPointArray)):y.vec2.copy(this._dirtyOriginScreenPointArray,
this._dirtyScreenPointArray)}};c.prototype.intersectionDistance=function(a,b){if(!this._get("visible"))return null;var d=q.screenPointObjectToArray(a,B),c=this._getCollisionRadius(b);b=-1*this._get("collisionPriority");switch(this.collisionType.type){case "point":if(y.vec2.squaredDistance(this._screenPointArray,d)<c*c)return this._renderScreenPointArray[2]+b;break;case "line":var f=this.collisionType.paths;a=this._getWorldToScreenObjectScale();a=this._calculateObjectTransform(a,I);for(var c=c*this._screenPixelSize,
d=C.ray.fromScreen(this._camera,d,P),e=0,l=f;e<l.length;e++)if(f=l[e],0!==f.length)for(var p=u.vec3.transformMat4(J,f[0],a),r=1;r<f.length;r++){var x=u.vec3.transformMat4(V,f[r],a),v=C.lineSegment.closestRayDistance2(C.lineSegment.fromPoints(p,x,O),d);if(null!=v&&v<c*c)return a=u.vec3.add(G.sv3d.get(),p,x),u.vec3.scale(a,a,.5),c=q.castRenderScreenPointArray(G.sv3d.get()),this._camera.projectPoint(a,c),c[2]+b;u.vec3.copy(p,x)}break;case "disc":p=this.collisionType.direction;a=this._getWorldToScreenObjectScale();
a=this._calculateObjectTransform(a,I);c*=this._screenPixelSize;d=C.ray.fromScreen(this._camera,d,P);r=g.mat3.fromMat4(T,a);r=u.vec3.transformMat3(U,p,r);p=this._calculateModelTransformPosition(W);C.plane.fromPositionAndNormal(p,r,H);e=S;if(C.plane.intersectRay(H,d,e)&&u.vec3.squaredDistance(e,p)<c*c)return this._renderScreenPointArray[2]+b;break;case "ribbon":a=this.collisionType;f=a.paths;p=a.direction;a=this._getWorldToScreenObjectScale();a=this._calculateObjectTransform(a,I);c*=this._camera.computeScreenPixelSizeAt(this._position);
d=C.ray.fromScreen(this._camera,d,P);r=g.mat3.fromMat4(T,a);r=u.vec3.transformMat3(U,p,r);p=this._calculateModelTransformPosition(W);C.plane.fromPositionAndNormal(p,r,H);e=S;if(!C.plane.intersectRay(H,d,e))break;d=0;for(l=f;d<l.length;d++)if(f=l[d],0!==f.length)for(p=u.vec3.transformMat4(J,f[0],a),r=1;r<f.length;r++){x=u.vec3.transformMat4(V,f[r],a);v=C.lineSegment.distance2(C.lineSegment.fromPoints(p,x,O),e);if(null!=v&&v<c*c)return a=u.vec3.add(G.sv3d.get(),p,x),u.vec3.scale(a,a,.5),c=q.castRenderScreenPointArray(G.sv3d.get()),
this._camera.projectPoint(a,c),c[2]+b;u.vec3.copy(p,x)}break;default:m.neverReached(this.collisionType)}return null};c.prototype.drag=function(a){if(this.moveOnDrag){a=q.screenPointObjectToArray(a.screenPoint,B);f.isNone(this._dragOffset)&&this.grabbing&&!this.snapToPointer&&(this._dragOffset=y.vec2.subtract(d.vec2f32.create(),a,this._originScreenPointArray));f.isSome(this._dragOffset)&&y.vec2.subtract(a,a,this._dragOffset);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(a,this._intersector,
"on-the-ground"===this.alignment?Q:null);a=this._intersector.results.min;var b=S;a.getIntersectionPoint(b)?(this.position=b,this._hitResult.onSurface=!0,this._hitResult.surfaceType="TerrainRenderer"===a.intersector?"ground":"feature"):this._hitResult.onSurface=!1}};c.prototype.attach=function(a){void 0===a&&(a={manipulator3D:{}});if(this.view._stage){a=a.manipulator3D;this._engineLayerId=a.engineLayerId;if(f.isNone(this._engineLayerId)){var b=new D("manipulator-3d",{isPickable:!1});this.view._stage.add(0,
b);this.view._stage.addToViewContent([b.id]);this._engineLayerId=b.id;a.engineLayerId=b.id}a.engineLayerReferences=(a.engineLayerReferences||0)+1;this._materialIdReferences=a.materialIdReferences;f.isNone(this._materialIdReferences)&&(this._materialIdReferences=new Map,a.materialIdReferences=this._materialIdReferences);this._camera=this.view.state.camera;this._attached=!0;this._updateEngineObject();F.canProject(this._mapPoint.spatialReference,this.view.spatialReference)||(this.mapPoint=l.makeDehydratedPoint(0,
0,0,this.view.spatialReference))}};c.prototype.detach=function(a){void 0===a&&(a={manipulator3D:{}});a=a.manipulator3D;a.engineLayerReferences--;var b=0===a.engineLayerReferences;b&&(a.engineLayerId=null);this._removeResourcesFromStage(b);this._camera=this._materialIdReferences=this._engineLayerId=this._engineResources=null;this._attached=!1};c.prototype.onViewChange=function(){this._camera=this.view.state.camera;this._screenPositionDirty=!0;this._updateEngineObject()};c.prototype.onElevationChange=
function(a){this.view.renderCoordsHelper.fromRenderCoords(this.position,X,a.spatialReference)&&A.containsPoint(a.extent,X)&&this._refreshMapPoint(!0)};c.prototype._refreshMapPoint=function(a){void 0===a&&(a=!1);switch(this.alignment){case "none":break;case "on-the-ground":var b=x.getElevationAtPoint(this.view.elevationProvider,this.mapPoint,"ground");if(b===this._mapPoint.z&&a)return;this._mapPoint.z=b;break;default:m.neverReached(this.alignment)}this._screenPositionDirty=!0;this._hitResult.onSurface=
!1;this.view.renderCoordsHelper.toRenderCoords(this._mapPoint,this._position);this._updateEngineObject()};c.prototype._updateEngineObject=function(){this._areAnyEngineObjectsVisible=!1;if(this._attached)if(!1===this._get("visible"))this._removeResourcesFromStage();else{var a=this._getWorldToScreenObjectScale(),b=I;!0===this._get("autoScaleRenderObjects")&&(a*=this._getFocusedSize(this._radius,this._focused));this._calculateObjectTransform(a,b);for(var a=this._ensureEngineResources().objectsByState,
d=(this._focused?2:1)|(this._get("selected")?8:4),c=this._get("hideOnGrab")&&this._get("grabbing"),f=0;f<a.length;f++){var e=a[f],g=e.stateMask,e=e.objects;if(c)for(var g=0,p=e;g<p.length;g++)e=p[g],e.hide();else if(p=0===(g&15)||(d&g)===(g&15),g=0===(g&65520)||(this._get("state")&g)===(g&65520),p&&g)for(g=0,p=e;g<p.length;g++)e=p[g],e.unhide(),e.objectTransformation=b,this._areAnyEngineObjectsVisible=!0;else for(g=0,p=e;g<p.length;g++)e=p[g],e.hide()}}};c.prototype._ensureEngineResources=function(){if(f.isNone(this._engineResources)){var a=
this.view._stage.getContent(0,f.expect(this._engineLayerId)),b=[],d=new Set;this.renderObjects.forEach(function(a){a=a.material;d.has(a)||(b.push(a),d.add(a))});var c=function(a,b){var d=b.geometry,c=b.material,f=b.transform;Array.isArray(d)?d.forEach(function(b){return a.addGeometry(b,c,f)}):a.addGeometry(d,c,f)},e=new Map;this.renderObjects.forEach(function(a){var b=new N({idHint:"manipulator"});c(b,a);a=a.stateMask||0;var d=e.get(a)||[];d.push(b);e.set(a,d)});var g=[];e.forEach(function(a,b){g.push({stateMask:b,
objects:a})});this._engineResources={objectsByState:g,layer:a,materials:b}}this._addResourcesToStage();return this._engineResources};c.prototype._addResourcesToStage=function(){var a=this;if(!this._engineResourcesAddedToStage&&!f.isNone(this._engineResources)){var b=this._engineResources,d=b.objectsByState,c=b.layer;b.materials.forEach(function(b){var d=f.expect(a._materialIdReferences),c=d.get(b.id)||0;0===c&&a.view._stage.add(3,b);d.set(b.id,c+1)});d.forEach(function(b){b.objects.forEach(function(b){c.addObject(b);
a.view._stage.add(1,b)})});this._engineResourcesAddedToStage=!0}};c.prototype._removeResourcesFromStage=function(a){var b=this;void 0===a&&(a=!1);if(this._engineResourcesAddedToStage&&!f.isNone(this._engineResources)){var d=this._engineResources,c=d.layer,e=d.materials;d.objectsByState.forEach(function(a){a.objects.forEach(function(a){c.removeObject(a);b.view._stage.remove(1,a.id)})});e.forEach(function(a){var d=f.expect(b._materialIdReferences),c=d.get(a.id);1===c?(b.view._stage.remove(3,a.id),d.delete(a.id)):
d.set(a.id,c-1)});a&&this.view._stage.remove(0,c.id);this._engineResourcesAddedToStage=!1}};c.prototype._getCollisionRadius=function(a){return this._getFocusedSize(this._radius,!0)*("touch"===a?this._touchMultiplier:1)};c.prototype._getFocusedSize=function(a,b){return a*(b?this._focusMultiplier:1)};c.prototype._getWorldToScreenObjectScale=function(){return this._worldSized?1:this._screenPixelSize};c.prototype._calculateModelTransformPosition=function(a){var b=this._getWorldToScreenObjectScale(),b=
this._calculateObjectTransform(b,E);return u.vec3.set(a,b[12],b[13],b[14])};c.prototype._calculateModelTransformOffset=function(a){var b=this._calculateModelTransformPosition(a);return u.vec3.subtract(a,b,this._position)};c.prototype._calculateObjectTransform=function(a,b){z.mat4.set(b,a,0,0,0,0,a,0,0,0,0,a,0,0,0,0,1);z.mat4.multiply(b,b,this._modelTransform);b[12]+=this._position[0];b[13]+=this._position[1];b[14]+=this._position[2];b[15]=1;return b};k([b.property({constructOnly:!0,nonNullable:!0})],
c.prototype,"view",void 0);k([b.property({value:"none",nonNullable:!0})],c.prototype,"alignment",null);k([b.property()],c.prototype,"hideOnGrab",void 0);k([b.property()],c.prototype,"moveOnDrag",void 0);k([b.property()],c.prototype,"snapToPointer",void 0);k([b.property()],c.prototype,"collisionType",void 0);k([b.property({type:v.Integer})],c.prototype,"collisionPriority",void 0);k([b.property({constructOnly:!0})],c.prototype,"renderObjects",void 0);k([b.property()],c.prototype,"autoScaleRenderObjects",
void 0);k([b.property({value:!0})],c.prototype,"visible",null);k([b.property()],c.prototype,"radius",null);k([b.property()],c.prototype,"worldSized",null);k([b.property()],c.prototype,"focusMultiplier",null);k([b.property()],c.prototype,"touchMultiplier",null);k([b.property()],c.prototype,"interactive",void 0);k([b.property()],c.prototype,"selectable",void 0);k([b.property()],c.prototype,"cursor",void 0);k([b.property({value:!1})],c.prototype,"grabbing",null);k([b.property()],c.prototype,"dragging",
void 0);k([b.property({value:!1})],c.prototype,"hovering",null);k([b.property({value:!1})],c.prototype,"selected",null);k([b.property({value:0})],c.prototype,"state",null);k([b.property({dependsOn:["hovering","grabbing"]})],c.prototype,"focused",null);return c=k([b.subclass("esri.views.interactive.Manipulator3D")],c)}(b.declared(e));h.Manipulator3D=t;var Q={include:new Set};Q.include.add(M.TERRAIN_ID);var B=q.createScreenPointArray(),R=q.createRenderScreenPointArray3(),O=C.lineSegment.create(),P=
C.ray.create(),T=r.mat3f64.create(),E=w.mat4f64.create(),I=w.mat4f64.create(),H=C.plane.create(),J=p.vec3f64.create(),V=p.vec3f64.create(),S=p.vec3f64.create(),U=p.vec3f64.create(),W=p.vec3f64.create(),Y=p.vec3f64.create(),X=p.vec3f64.create()})},"esri/views/3d/interactive/measurementTools/support/Label":function(){define(["require","exports","../../../../overlay/LineOverlayItem","../../../../overlay/TextOverlayItem"],function(t,h,k,a){return function(){function c(c){this._textItem=new a({visible:!1});
this._calloutItem=new k({visible:!1,width:2});this._visible=!1;this._calloutVisible=!0;c&&(this.fontSize=c)}Object.defineProperty(c.prototype,"textItem",{get:function(){return this._textItem},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"calloutItem",{get:function(){return this._calloutItem},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"text",{get:function(){return this._textItem.text},set:function(a){this._textItem.text=a},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"fontSize",{get:function(){return this._textItem.fontSize},set:function(a){this._textItem.fontSize=a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible=a;this._updateVisibility()},enumerable:!0,configurable:!0});c.prototype.addToView=function(a){a.overlay.items.addMany([this._textItem,this._calloutItem])};c.prototype.removeFromView=function(a){a.overlay&&!a.overlay.destroyed&&
a.overlay.items.removeMany([this._textItem,this._calloutItem])};c.prototype.updatePosition=function(a,c){if(c){var e=c[0]-a[0],f=c[1]-a[1];this._textItem.position=[c[0],c[1]];this._textItem.anchor=Math.abs(e)>Math.abs(f)?0<e?"left":"right":0<f?"top":"bottom";this._calloutItem.startPosition=[a[0],a[1]];this._calloutItem.endPosition=[c[0],c[1]];this._calloutVisible=!0}else this._textItem.position=[a[0],a[1]],this._textItem.anchor="center",this._calloutVisible=!1};c.prototype._updateVisibility=function(){this._textItem.visible=
this._visible;this._calloutItem.visible=this._visible&&this._calloutVisible};return c}()})},"esri/views/overlay/LineOverlayItem":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ../../libs/maquette/index".split(" "),function(t,h,k,a,c,e,m){var n={left:0,top:0,width:0,height:0,x1:0,y1:0,x2:0,y2:0};return function(c){function f(a){a=c.call(this,a)||this;a.startX=0;a.startY=0;a.endX=
0;a.endY=0;a.width=1;a.color=[0,0,0,.5];a.visible=!0;return a}k(f,c);Object.defineProperty(f.prototype,"startPosition",{get:function(){return[this.startX,this.startY]},set:function(a){this._set("startX",a[0]);this._set("startY",a[1])},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"endPosition",{get:function(){return[this.endX,this.endY]},set:function(a){this._set("endX",a[0]);this._set("endY",a[1])},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"strokeStyle",
{get:function(){var a=this.color;return"rgba("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"lineCap",{get:function(){return"round"},enumerable:!0,configurable:!0});f.prototype.render=function(){var a=this.calculateCoordinates(n),c=a.height,f=a.width;return m.h("div",{classes:{"esri-line-overlay-item":!0},styles:{left:a.left+"px",top:a.top+"px",width:f+"px",height:c+"px",visibility:this.visible?"visible":"hidden"}},[m.h("svg",{width:f,height:c},
[m.h("line",{x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,style:"stroke: "+this.strokeStyle+"; stroke-width: "+this.width+"; stroke-linecap: "+this.lineCap+";"})])])};f.prototype.renderCanvas=function(a){if(this.visible){a.strokeStyle=this.strokeStyle;a.lineWidth=this.width;a.lineCap=this.lineCap;var b=this.calculateCoordinates(n);a.beginPath();a.moveTo(b.left+b.x1,b.top+b.y1);a.lineTo(b.left+b.x2,b.top+b.y2);a.stroke()}};f.prototype.calculateCoordinates=function(a){var b=Math.min(this.startX,this.endX),c=Math.max(this.startX,
this.endX),f=Math.min(this.startY,this.endY),e=Math.max(this.startY,this.endY),w=this.width;a.left=b-w;a.top=f-w;a.width=c-b+2*w;a.height=Math.max(20,e-f+2*w);a.x1=this.startX-b+w;a.y1=this.startY-f+w;a.x2=this.endX-b+w;a.y2=this.endY-f+w;return a};a([e.property()],f.prototype,"startX",void 0);a([e.property()],f.prototype,"startY",void 0);a([e.property()],f.prototype,"endX",void 0);a([e.property()],f.prototype,"endY",void 0);a([e.property({dependsOn:["startX","startY"]})],f.prototype,"startPosition",
null);a([e.property({dependsOn:["endX","endY"]})],f.prototype,"endPosition",null);a([e.property()],f.prototype,"width",void 0);a([e.property()],f.prototype,"color",void 0);a([e.property()],f.prototype,"visible",void 0);a([e.property({readOnly:!0,dependsOn:["color"]})],f.prototype,"strokeStyle",null);return f=a([e.subclass("esri.views.overlay.LineOverlayItem")],f)}(e.declared(c))})},"esri/views/overlay/TextOverlayItem":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ../../libs/maquette/index".split(" "),
function(t,h,k,a,c,e,m){var n={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};t=function(b){function c(a){a=
b.call(this,a)||this;a.x=0;a.y=0;a.text="-";a.fontSize=14;a.anchor="center";a.visible=!0;a.backgroundColor="rgba(0, 0, 0, 0.6)";a.textColor="white";a.textShadowColor=[0,0,0];a.textShadowSize=1;return a}k(c,b);Object.defineProperty(c.prototype,"position",{get:function(){return[this.x,this.y]},set:function(a){this._set("x",a[0]);this._set("y",a[1])},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"padding",{get:function(){return.5*this.fontSize},enumerable:!0,configurable:!0});c.prototype.render=
function(){return m.h("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",backgroundColor:this.backgroundColor,color:this.textColor,padding:this.padding+"px",borderRadius:this.padding+"px",textShadow:"0 0 "+this.textShadowSize+"px rgb("+this.textShadowColor[0]+", "+this.textShadowColor[1]+", "+this.textShadowColor[2]+")"}},[this.text])};c.prototype.renderCanvas=function(a){if(this.visible){var b=
a.font.replace(/^(.*?)px/,"");a.font=this.fontSize+"px "+b;var c=this.padding,e=this.padding,g=a.measureText(this.text).width,d=this.fontSize,b=f[this.anchor];a.textAlign="center";a.textBaseline="middle";g+=2*c;c=d+2*c;this.roundedRect(a,this.x+b.x*g,this.y+b.y*c,g,c,e);a.fillStyle=this.backgroundColor;a.fill();e=this.x+(b.x+.5)*g;b=this.y+(b.y+.5)*c;this._renderTextShadow(a,this.text,e,b);a.fillStyle=this.textColor;a.fillText(this.text,e,b)}};c.prototype._renderTextShadow=function(a,b,c,f){a.lineJoin=
"miter";a.fillStyle="rgba("+this.textShadowColor[0]+", "+this.textShadowColor[1]+", "+this.textShadowColor[2]+", "+1/q.length+")";for(var e=this.textShadowSize,d=0,g=q;d<g.length;d++){var p=g[d];a.fillText(b,c+e*p[0],f+e*p[1])}};c.prototype.roundedRect=function(a,b,c,f,e,d){a.beginPath();a.moveTo(b,c+d);a.arcTo(b,c,b+d,c,d);a.lineTo(b+f-d,c);a.arcTo(b+f,c,b+f,c+d,d);a.lineTo(b+f,c+e-d);a.arcTo(b+f,c+e,b+f-d,c+e,d);a.lineTo(b+d,c+e);a.arcTo(b,c+e,b,c+e-d,d);a.closePath()};c.prototype._cssClasses=function(){var a=
{"esri-text-overlay-item":!0},b;for(b in n)a[n[b]]=this.anchor===b;return a};a([e.property()],c.prototype,"x",void 0);a([e.property()],c.prototype,"y",void 0);a([e.property({dependsOn:["x","y"]})],c.prototype,"position",null);a([e.property()],c.prototype,"text",void 0);a([e.property()],c.prototype,"fontSize",void 0);a([e.property()],c.prototype,"anchor",void 0);a([e.property()],c.prototype,"visible",void 0);a([e.property({dependsOn:["fontSize"]})],c.prototype,"padding",null);return c=a([e.subclass("esri.views.overlay.TextOverlayItem")],
c)}(e.declared(c));var f={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},
"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},q=[];for(h=0;360>h;h+=22.5)q.push([Math.cos(Math.PI*h/180),Math.sin(Math.PI*h/180)]);return t})},"esri/views/3d/interactive/measurementTools/support/LabelSegment":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec3","../../../../../core/libs/gl-matrix-2/vec3f64","./viewUtils"],function(t,h,k,a,c){return function(){function e(){this.origin=a.vec3f64.create();this.start=a.vec3f64.create();this.end=a.vec3f64.create()}
e.prototype.update=function(a,e,f){k.vec3.copy(this.start,a);k.vec3.copy(this.end,e);if(f)switch(f){case "start":k.vec3.copy(this.origin,this.start);break;case "center":c.midpoint([a,e],this.origin);break;case "end":k.vec3.copy(this.origin,this.end);break;default:k.vec3.copy(this.origin,f)}else c.midpoint([a,e],this.origin)};return e}()})},"esri/views/3d/interactive/measurementTools/support/viewUtils":function(){define("require exports ../../../../../core/lang ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64".split(" "),
function(t,h,k,a,c,e,m,n){function f(d,c,f){var e=f._stage.getCamera();f.renderCoordsHelper.toRenderCoords(d,b);e.projectPoint(b,v);a.renderArrayToScreen(f,v,c)}Object.defineProperty(h,"__esModule",{value:!0});var q=n.vec3f64.create();h.copyParameter=function(a,b){a=k.mixin({},a);b=k.clone(b);k.mixin(a,b);return a};h.resizeArray=function(a,b,d,c){for(;a.length<b;)a.push(d());if(c)for(;a.length>b;)d=a.pop(),c(d);else a.length=b};h.scaleTranslateMatrix=function(a,b,d){c.mat4.identity(d);c.mat4.translate(d,
d,b);m.vec3.set(q,a,a,a);c.mat4.scale(d,d,q)};h.midpoint=function(a,b){m.vec3.set(b,0,0,0);if(0<a.length){for(var d=0;d<a.length;++d)m.vec3.add(b,b,a[d]);m.vec3.scale(b,b,1/a.length)}};h.screenSpaceTangent=function(a,b,d,c){c.projectPoint(a,g);c.projectPoint(b,z);e.vec2.subtract(d,w,r);e.vec2.normalize(d,d)};h.projectPoint=f;h.pointToPointScreenDistance=function(a,b,c){f(a,d,c);f(b,u,c);return e.vec2.distance(d,u)};h.pointToScreenPositionDistance=function(a,b,d){f(a,y,d);return e.vec2.distance(y,
b)};var b=n.vec3f64.create(),v=a.createRenderScreenPointArray3(),g=a.createRenderScreenPointArray3(),r=g,z=a.createRenderScreenPointArray3(),w=z,y=a.createScreenPointArray(),d=a.createScreenPointArray(),u=a.createScreenPointArray()})},"esri/views/3d/interactive/measurementTools/support/labelUtils":function(){define("require exports ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./viewUtils".split(" "),
function(t,h,k,a,c,e,m){function n(a,b,d){a.projectPoint(b,r);if(0>r[2]||1<r[2])return!1;a.renderToScreen(r,d);return!0}function f(d,c,f,e,x,y){if(!c)return!1;m.screenSpaceTangent(c.start,c.end,b,d);a.vec2.set(g,-b[1],b[0]);var p=!1;switch(e){case "top":p=0>g[1];break;case "bottom":p=0<g[1];break;case "left":p=0<g[0];break;case "right":p=0>g[0]}p&&a.vec2.negate(g,g);if(0===a.vec2.length(g))switch(e){case "top":g[1]=1;break;case "bottom":g[1]=-1;break;case "left":g[0]=-1;break;case "right":g[0]=1}d.projectPoint(c.origin,
r);if(0>r[2]||1<r[2])return!1;d.renderToScreen(r,x);a.vec2.scale(g,g,f*d.pixelRatio);a.vec2.add(g,g,r);d.renderToScreen(g,y);return!0}function q(d,c,f,e,x,y){if(!c||!f)return!1;m.screenSpaceTangent(c.end,c.start,b,d);m.screenSpaceTangent(f.start,f.end,v,d);a.vec2.add(g,b,v);a.vec2.negate(g,g);a.vec2.normalize(g,g);d.projectPoint(c.end,r);if(0>r[2]||1<r[2])return!1;d.renderToScreen(r,x);a.vec2.scale(g,g,e*d.pixelRatio);a.vec2.add(g,g,r);d.renderToScreen(g,y);return!0}Object.defineProperty(h,"__esModule",
{value:!0});h.mirrorPosition=function(a){switch(a){case "top":return"bottom";case "right":return"left";case "bottom":return"top";case "left":return"right"}};h.computeLabelPositionFromPoint=n;h.positionLabelOnPoint=function(a,b,d){(b=n(d,b,y))&&a.updatePosition(y,null);return b};h.computeLabelPositionFromSegment=f;h.positionLabelOnSegment=function(a,b,c,e,g){(b=f(g,b,c,e,y,d))&&a.updatePosition(y,d);return b};h.computeLabelPositionFromCorner=q;h.computeLabelPositionFromPlane=function(b,d,f,e,x,y){b.projectPoint(d,
r);c.vec3.add(w,d,f);b.projectPoint(w,z);if(0>r[2]||1<r[2]||0>z[2]||1<z[2])return!1;a.vec2.subtract(g,z,r);a.vec2.normalize(g,g);b.renderToScreen(r,x);a.vec2.scale(g,g,e*b.pixelRatio);a.vec2.add(g,g,r);b.renderToScreen(g,y);return!0};h.positionLabelOnCorner=function(a,b,c,f,e){(b=q(e,b,c,f,y,d))&&a.updatePosition(y,d);return b};var b=k.createRenderScreenPointArray(),v=k.createRenderScreenPointArray(),g=k.createRenderScreenPointArray(),r=k.createRenderScreenPointArray3(),z=k.createRenderScreenPointArray3(),
w=e.vec3f64.create(),y=k.createScreenPointArray(),d=k.createScreenPointArray()})},"esri/views/3d/interactive/measurementTools/support/PathSegmentInterpolator":function(){define("require exports ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils ../../../support/projectionUtils".split(" "),function(t,h,k,a,c,e){var m;(function(m){var f=function(){function c(b,c){this._startPosition=a.vec3f64.create();this._endPosition=a.vec3f64.create();
k.vec3.copy(this._startPosition,b);k.vec3.copy(this._endPosition,c)}c.prototype.eval=function(a,c){k.vec3.lerp(c,this._startPosition,this._endPosition,a)};return c}();m.Linear=f;f=function(){function f(b,c,f,r){this._startPosition=a.vec3f64.create();this._endPosition=a.vec3f64.create();e.vectorToVector(b,f,this._startPosition,e.SphericalECEFSpatialReference);e.vectorToVector(c,f,this._endPosition,e.SphericalECEFSpatialReference);this._destSR=r}f.prototype.eval=function(a,f){c.slerp(this._startPosition,
this._endPosition,a,f);e.vectorToVector(f,e.SphericalECEFSpatialReference,f,this._destSR)};return f}();m.Spherical=f})(m||(m={}));return m})},"esri/views/3d/support/LaserLineRenderer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/mathUtils ../../../core/maybe ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ./geometryUtils ./LaserlinePathData ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/LaserlinePathTechnique ../webgl-engine/shaders/LaserlineTechnique".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g,r,z,w,y){function d(a,d,c,e){var g=u,l=p;m.vec3.transformMat4(g,d,e);m.vec3.copy(l,c);l[3]=0;f.vec4.transformMat4(l,l,e);b.plane.fromPositionAndNormal(g,l,a)}Object.defineProperty(h,"__esModule",{value:!0});var u=n.vec3f64.create(),p=q.vec4f64.create(),A={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:a.deg2rad(6),globalAlphaContrastBoost:2};t=function(){function a(a,d,c){void 0===d&&(d={});void 0===c&&(c=
{contrastControlEnabled:!1});this._technique=null;this._projInfo=q.vec4f64.create();this._zScale=e.vec2f64.create();this._heightPlaneEnabled=!1;this._heightPlanePosition=n.vec3f64.create();this._heightPlaneHeight=0;this._pointDistanceEnabled=!1;this._pointDistanceOrigin=n.vec3f64.create();this._pointDistanceTarget=n.vec3f64.create();this._lineVerticalPlaneEnabled=!1;this._lineVerticalPlaneSegment=b.lineSegment.create();this._intersectsLineEnabled=!1;this._intersectsLineSegment=b.lineSegment.create();
this._intersectsLineRadius=3;this._pathVerticalPlaneEnabled=this._intersectsLineInfinite=!1;this._pathTechnique=this._pathVerticalPlaneData=null;this.canRender=!0;this._tempNormal=n.vec3f64.create();this._tempDir=n.vec3f64.create();this._tempUp=n.vec3f64.create();this._tempVec3A=n.vec3f64.create();this._tempVec3B=n.vec3f64.create();this._tempVec4=q.vec4f64.create();this._tempPlane=b.plane.create();this._tempSphere=b.sphere.create();this._renderCoordsHelper=a;this._params=z.copyParameters(d,A);this._config=
c}Object.defineProperty(a.prototype,"renderSlots",{get:function(){return[this._config.contrastControlEnabled?17:16]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"needsLinearDepth",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"heightPlaneEnabled",{get:function(){return this._heightPlaneEnabled},set:function(a){a!==this._heightPlaneEnabled&&(this._heightPlaneEnabled=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"heightPlanePosition",{get:function(){return this._heightPlanePosition},set:function(a){m.vec3.copy(this._heightPlanePosition,a);this._requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"heightPlaneHeight",{get:function(){return this._heightPlaneHeight},set:function(a){this._heightPlaneHeight!==a&&(this._heightPlaneHeight=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pointDistanceEnabled",{get:function(){return this._pointDistanceEnabled},
set:function(a){a!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pointDistanceTarget",{get:function(){return this._pointDistanceTarget},set:function(a){m.vec3.copy(this._pointDistanceTarget,a);this._requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pointDistanceOrigin",{get:function(){return this._pointDistanceOrigin},set:function(a){m.vec3.copy(this._pointDistanceOrigin,
a);this._requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"lineVerticalPlaneEnabled",{get:function(){return this._lineVerticalPlaneEnabled},set:function(a){a!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"lineVerticalPlaneSegment",{get:function(){return this._lineVerticalPlaneSegment},set:function(a){b.lineSegment.copy(a,this._lineVerticalPlaneSegment);
this._requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"intersectsLineEnabled",{get:function(){return this._intersectsLineEnabled},set:function(a){a!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"intersectsLineSegment",{get:function(){return this._intersectsLineSegment},set:function(a){b.lineSegment.copy(a,this._intersectsLineSegment);this._requestRender()},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"intersectsLineRadius",{get:function(){return this._intersectsLineRadius},set:function(a){a!==this._intersectsLineRadius&&(this._intersectsLineRadius=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"intersectsLineInfinite",{get:function(){return this._intersectsLineInfinite},set:function(a){a!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=a,this._requestRender())},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"pathVerticalPlaneEnabled",{get:function(){return this._pathVerticalPlaneEnabled},set:function(a){a!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=a,c.isSome(this._pathVerticalPlaneData)&&this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pathVerticalPlaneVertices",{set:function(a){c.isNone(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new v.LaserlinePathData(this._renderCoordsHelper));this._pathVerticalPlaneData.vertices=
a;this.pathVerticalPlaneEnabled&&this._requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pathVerticalPlaneBuffers",{set:function(a){c.isNone(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new v.LaserlinePathData(this._renderCoordsHelper));this._pathVerticalPlaneData.buffers=a;this.pathVerticalPlaneEnabled&&this._requestRender()},enumerable:!0,configurable:!0});a.prototype.setParameterValues=function(a){z.updateParameters(this._params,a)&&this._requestRender()};
a.prototype.initializeRenderContext=function(a){this._initContext=a;this._quadVAO=g.createQuadVAO(a.rctx);this._techniqueRepository=a.shaderTechniqueRep;this._techniqueConfig=new y.LaserlineTechniqueConfiguration;this._pathTechniqueConfig=new w.LaserlinePathTechniqueConfiguration};a.prototype.uninitializeRenderContext=function(){this._quadVAO.dispose();this._quadVAO=null;c.isSome(this._technique)&&this._techniqueRepository.release(this._technique);c.isSome(this._pathVerticalPlaneData)&&this._pathVerticalPlaneData.dispose();
c.isSome(this._pathTechnique)&&this._techniqueRepository.release(this._pathTechnique)};a.prototype.render=function(a){var b=this.heightPlaneEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled,d=this.pathVerticalPlaneEnabled;if(!b&&!d)return!0;var c=a.camera;r.inverseProjectionInfo(c.projectionMatrix,c.fullWidth,c.fullHeight,this._projInfo,this._zScale);b&&this.renderUnified(a);d&&this.renderPath(a);return!0};a.prototype.renderUnified=function(a){var b=a.rctx,
d=this._selectTechnique(),c=d.program;b.bindProgram(c);d.bindPipelineState(b);this.bindGlobalUniforms(a,c);this.bindHeightPlaneUniforms(a,c);this.bindPointDistanceUniforms(a,c);this.bindLineVerticalPlaneUniforms(a,c);this.bindIntersectsLineUniforms(a,c);d.bind(this._params,a.camera);b.bindVAO(this._quadVAO);b.drawArrays(5,0,4)};a.prototype.renderPath=function(a){if(!c.isNone(this._pathVerticalPlaneData)){this._pathTechniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled;this._pathTechnique=
this._techniqueRepository.acquireAndReleaseExisting(w.LaserlinePathTechnique,this._pathTechniqueConfig,this._pathTechnique);var b=a.rctx,d=this._pathTechnique,f=d.program;b.bindProgram(f);d.bindPipelineState(b);this.bindGlobalUniforms(a,f);d.bind(this._params,this._pathVerticalPlaneData.origin,a.camera);this._pathVerticalPlaneData.draw(a.rctx)}};a.prototype.bindHeightPlaneUniforms=function(a,b){if(this._heightPlaneEnabled){var c=this._heightPlanePosition,f=this._tempVec3A,e=this._tempPlane;this._renderCoordsHelper.worldUpAtPosition(c,
f);d(e,c,f,a.camera.viewMatrix);b.setUniform4fv("heightPlane",e);b.setUniform1f("heightPlaneHeight",this._heightPlaneHeight)}};a.prototype.bindPointDistanceUniforms=function(a,b){if(this._pointDistanceEnabled){a=a.camera;var d=this._tempSphere;m.vec3.copy(d.center,this._pointDistanceOrigin);m.vec3.transformMat4(d.center,d.center,a.viewMatrix);d.radius=m.vec3.distance(this._pointDistanceOrigin,this._pointDistanceTarget);b.setUniform4f("pointDistanceSphere",d.center[0],d.center[1],d.center[2],d.radius)}};
a.prototype.bindLineVerticalPlaneUniforms=function(a,c){if(this._lineVerticalPlaneEnabled){var f=this._renderCoordsHelper;a=a.camera;var e=this._tempPlane,g=this._tempVec3A,p=this._tempUp,l=this._tempDir,r=this._tempNormal;b.lineSegment.pointAt(this._lineVerticalPlaneSegment,.5,g);f.worldUpAtPosition(g,p);m.vec3.normalize(l,this._lineVerticalPlaneSegment.vector);m.vec3.cross(r,p,l);m.vec3.normalize(r,r);d(e,this._lineVerticalPlaneSegment.origin,r,a.viewMatrix);c.setUniform4fv("lineVerticalPlane",
e);e=this._tempVec3A;m.vec3.copy(e,this._lineVerticalPlaneSegment.origin);f.setAltitude(0,e);m.vec3.transformMat4(e,e,a.viewMatrix);c.setUniform3fv("lineVerticalStart",e);e=this._tempVec3B;m.vec3.add(e,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector);f.setAltitude(0,e);m.vec3.transformMat4(e,e,a.viewMatrix);c.setUniform3fv("lineVerticalEnd",e)}};a.prototype.bindIntersectsLineUniforms=function(a,d){if(this._intersectsLineEnabled){var c=x,e=C;if(this._intersectsLineInfinite){var g=
a.camera;b.clipRay.fromRay(b.ray.wrap(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),l);l.c0=-Number.MAX_VALUE;if(!b.frustum.intersectClipRay(g.frustum.planes,l))return;b.clipRay.getStart(l,c);b.clipRay.getEnd(l,e)}else m.vec3.copy(c,this._intersectsLineSegment.origin),m.vec3.add(e,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);g=this._tempVec3A;m.vec3.transformMat4(g,c,a.camera.viewMatrix);d.setUniform3fv("intersectsLineStart",g);c=this._tempVec4;m.vec3.copy(c,
this._intersectsLineSegment.vector);this._tempVec4[3]=0;f.vec4.transformMat4(this._tempVec4,this._tempVec4,a.camera.viewMatrix);m.vec3.transformMat4(e,e,a.camera.viewMatrix);d.setUniform3fv("intersectsLineEnd",e);m.vec3.normalize(c,c);d.setUniform3f("intersectsLineDirection",c[0],c[1],c[2]);d.setUniform1f("intersectsLineRadius",this._intersectsLineRadius)}};a.prototype.bindGlobalUniforms=function(a,b){var d=a.camera;b.setUniform4fv("projInfo",this._projInfo);b.setUniform2fv("zScale",this._zScale);
b.setUniform2f("nearFar",d.near,d.far);this._heightPlaneEnabled?b.setUniform1f("maxPixelDistance",2*d.computeScreenPixelSizeAt(this._heightPlanePosition)):this._pointDistanceEnabled?b.setUniform1f("maxPixelDistance",2*d.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&b.setUniform1f("maxPixelDistance",2*d.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin));b.setUniform1i("depthMap",0);a.rctx.bindTexture(a.offscreenRenderingHelper.linearDepthTexture,
0);b.setUniform1i("frameColor",1);a.rctx.bindTexture(a.offscreenRenderingHelper.mainColorTexture,1)};a.prototype._requestRender=function(){this._initContext&&this._initContext.requestRender()};a.prototype._selectTechnique=function(){this._techniqueConfig.heightPlaneEnabled=this.heightPlaneEnabled;this._techniqueConfig.heightPlaneHeightEnabled=0!==this.heightPlaneHeight;this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled;this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled;
this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled;this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled;return this._technique=this._techniqueRepository.acquireAndReleaseExisting(y.LaserlineTechnique,this._techniqueConfig,this._technique)};return a}();h.LaserLineRenderer=t;var l=b.clipRay.create(),x=n.vec3f64.create(),C=n.vec3f64.create()})},"esri/views/3d/support/LaserlinePathData":function(){define("require exports ../../../core/maybe ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../webgl ./buffer/glUtil ./buffer/InterleavedLayout ../webgl-engine/shaders/LaserlinePathTechnique".split(" "),
function(t,h,k,a,c,e,m,n,f){Object.defineProperty(h,"__esModule",{value:!0});t=function(){function g(a){this._renderCoordsHelper=a;this._buffers=null;this._origin=c.vec3f64.create();this._dirty=!1;this._count=0;this._vao=null}Object.defineProperty(g.prototype,"vertices",{set:function(a){for(var b=new Float64Array(3*a.length),c=0,f=0;f<a.length;f++){var d=a[f];b[c++]=d[0];b[c++]=d[1];b[c++]=d[2]}this.buffers=[b]},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"buffers",{set:function(b){this._buffers=
b;if(0<this._buffers.length){b=this._buffers[0];var c=3*Math.floor(b.length/3/2);a.vec3.set(this._origin,b[c+0],b[c+1],b[c+2])}else a.vec3.set(this._origin,0,0,0);this._dirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"origin",{get:function(){return this._origin},enumerable:!0,configurable:!0});g.prototype.draw=function(a){var b=this.ensureVAO(a);k.isSome(b)&&(a.bindVAO(b),a.drawArrays(4,0,this._count))};g.prototype.dispose=function(){k.isSome(this._vao)&&this._vao.dispose()};
g.prototype.ensureVAO=function(a){if(k.isNone(this._buffers))return null;k.isNone(this._vao)&&(this._vao=this.createVAO(a,this._buffers));this.ensureVertexData(this._vao,this._buffers);return this._vao};g.prototype.createVAO=function(a,b){b=this.createDataBuffer(b);this._dirty=!1;return new e.VertexArrayObject(a,f.LaserlinePathTechnique.attributeLocations,{data:m.glLayout(v)},{data:e.BufferObject.createVertex(a,35044,b)})};g.prototype.ensureVertexData=function(a,b){this._dirty&&(b=this.createDataBuffer(b),
a.vertexBuffers.data.setData(b),this._dirty=!1)};g.prototype.numberOfRenderVertices=function(a){return 6*(a.length/3-1)};g.prototype.createDataBuffer=function(c){var f=this,e=c.reduce(function(a,b){return a+f.numberOfRenderVertices(b)},0);this._count=e;for(var e=v.createBuffer(e),g=this._origin,d=0,r=0,p=0;p<c.length;p++){for(var m=c[p],l=0;l<m.length;l+=3){var x=a.vec3.set(b,m[l+0],m[l+1],m[l+2]);0===l?r=this._renderCoordsHelper.getAltitude(x):this._renderCoordsHelper.setAltitude(r,x);var k=this._renderCoordsHelper.worldUpAtPosition(x,
q),n=d+2*l,x=a.vec3.subtract(b,x,g);if(l<m.length-3){e.up.setVec(n,k);e.up.setVec(n+3,k);e.up.setVec(n+5,k);for(var h=0;6>h;h++)e.start.setVec(n+h,x);e.extrude.setValues(n+0,0,-1);e.extrude.setValues(n+1,1,-1);e.extrude.setValues(n+2,1,1);e.extrude.setValues(n+3,0,-1);e.extrude.setValues(n+4,1,1);e.extrude.setValues(n+5,0,1)}if(0<l)for(e.up.setVec(n-2,k),e.up.setVec(n-4,k),e.up.setVec(n-5,k),h=-6;0>h;h++)e.end.setVec(n+h,x)}d+=this.numberOfRenderVertices(m)}return e.buffer};return g}();h.LaserlinePathData=
t;var q=c.vec3f64.create(),b=c.vec3f64.create(),v=n.newLayout().vec3f("start").vec3f("end").vec3f("up").vec2f("extrude")})},"esri/views/3d/webgl-engine/shaders/LaserlinePathTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./LaserlinePath.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g,r){Object.defineProperty(h,"__esModule",{value:!0});c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}k(c,a);c.prototype.initializeProgram=function(a){var b=c.shader.get().build(this.configuration);return new v(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),c.attributeLocations)};c.prototype.bind=function(a,b,c){this.program.setUniform3fv("innerColor",a.innerColor);this.program.setUniform1f("innerWidth",a.innerWidth*c.pixelRatio);
this.program.setUniform3fv("glowColor",a.glowColor);this.program.setUniform1f("glowWidth",a.glowWidth*c.pixelRatio);this.program.setUniform1f("glowFalloff",a.glowFalloff);this.program.setUniform1f("globalAlpha",a.globalAlpha);this.program.setUniform1f("perScreenPixelRatio",c.perScreenPixelRatio);this.program.setUniform2f("pixelToNDC",2/c.fullWidth,2/c.fullHeight);this.program.setUniformMatrix4fv("uProjectionMatrix",c.projectionMatrix);e.mat4.translate(z,c.viewMatrix,b);this.program.setUniformMatrix4fv("uModelViewMatrix",
z);this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=a.globalAlphaContrastBoost?a.globalAlphaContrastBoost:1)};c.prototype.initializePipeline=function(){return r.makePipelineState({blending:g.simpleBlendingParams(1,771),colorWrite:r.defaultColorWriteParams})};c.prototype.bindPipelineState=function(a){a.setPipelineState(this.pipeline)};c.shader=new n.ReloadableShaderModule(b,"./LaserlinePath.glsl",t);c.attributeLocations={start:0,end:1,up:2,extrude:3};
return c}(f.ShaderTechnique);h.LaserlinePathTechnique=c;c=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.contrastControlEnabled=!1;return a}k(c,b);a([q.parameter()],c.prototype,"contrastControlEnabled",void 0);return c}(q.ShaderTechniqueConfiguration);h.LaserlinePathTechniqueConfiguration=c;var z=m.mat4f64.create()})},"esri/views/3d/webgl-engine/shaders/LaserlinePath.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/Laserline.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(t,h,k,a,c,e){Object.defineProperty(h,"__esModule",{value:!0});h.build=function(f){var q=new e.ShaderBuilder;q.include(a.Laserline,f);q.vertex.uniforms.add("uModelViewMatrix","mat4");q.vertex.uniforms.add("uProjectionMatrix","mat4");q.attributes.add("start","vec3");q.attributes.add("end","vec3");q.attributes.add("up","vec3");q.attributes.add("extrude","vec2");q.varyings.add("uv","vec2");q.varyings.add("vViewStart","vec3");q.varyings.add("vViewEnd","vec3");q.varyings.add("vViewPlane","vec4");
q.vertex.uniforms.add("glowWidth","float");q.vertex.uniforms.add("pixelToNDC","vec2");q.vertex.code.add(c.glsl(m||(m=k(["\n  void main() {\n    vec3 pos \x3d mix(start, end, extrude.x);\n\n    vec4 viewPos \x3d uModelViewMatrix * vec4(pos, 1);\n    vec4 projPos \x3d uProjectionMatrix * viewPos;\n    vec2 ndcPos \x3d projPos.xy / projPos.w;\n\n    vec3 viewUp \x3d (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;\n    vec4 projPosUp \x3d uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);\n    vec2 projExtrudeDir \x3d normalize(projPosUp.xy / projPosUp.w - ndcPos);\n\n    vec2 lxy \x3d abs(sign(projExtrudeDir) - ndcPos);\n    ndcPos +\x3d length(lxy) * projExtrudeDir;\n\n    vec3 worldPlaneNormal \x3d normalize(cross(up, normalize(end - start)));\n    vec3 viewPlaneNormal \x3d (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;\n\n    vViewStart \x3d (uModelViewMatrix * vec4(start, 1)).xyz;\n    vViewEnd \x3d (uModelViewMatrix * vec4(end, 1)).xyz;\n    vViewPlane \x3d vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));\n\n    // Add enough padding in the X screen space direction for glow\n    float xPaddingPixels \x3d sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;\n    ndcPos.x +\x3d xPaddingPixels * pixelToNDC.x;\n\n    uv \x3d ndcPos * 0.5 + 0.5;\n    gl_Position \x3d vec4(ndcPos, 0, 1);\n  }\n  "],
["\n  void main() {\n    vec3 pos \x3d mix(start, end, extrude.x);\n\n    vec4 viewPos \x3d uModelViewMatrix * vec4(pos, 1);\n    vec4 projPos \x3d uProjectionMatrix * viewPos;\n    vec2 ndcPos \x3d projPos.xy / projPos.w;\n\n    vec3 viewUp \x3d (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;\n    vec4 projPosUp \x3d uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);\n    vec2 projExtrudeDir \x3d normalize(projPosUp.xy / projPosUp.w - ndcPos);\n\n    vec2 lxy \x3d abs(sign(projExtrudeDir) - ndcPos);\n    ndcPos +\x3d length(lxy) * projExtrudeDir;\n\n    vec3 worldPlaneNormal \x3d normalize(cross(up, normalize(end - start)));\n    vec3 viewPlaneNormal \x3d (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;\n\n    vViewStart \x3d (uModelViewMatrix * vec4(start, 1)).xyz;\n    vViewEnd \x3d (uModelViewMatrix * vec4(end, 1)).xyz;\n    vViewPlane \x3d vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));\n\n    // Add enough padding in the X screen space direction for glow\n    float xPaddingPixels \x3d sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;\n    ndcPos.x +\x3d xPaddingPixels * pixelToNDC.x;\n\n    uv \x3d ndcPos * 0.5 + 0.5;\n    gl_Position \x3d vec4(ndcPos, 0, 1);\n  }\n  "]))));
q.fragment.uniforms.add("globalAlpha","float");q.fragment.uniforms.add("perScreenPixelRatio","float");q.fragment.code.add(c.glsl(n||(n=k(["\n  float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {\n    vec3 origin \x3d mix(start, end, 0.5);\n    vec3 basis \x3d end - origin;\n    vec3 posAtOrigin \x3d pos - origin;\n\n    float x \x3d dot(normalize(basis), posAtOrigin);\n    float y \x3d dot(plane.xyz, posAtOrigin);\n\n    float dx \x3d max(abs(x) - length(basis), 0.0);\n    float dy \x3d y;\n\n    float dist \x3d length(vec2(dx, dy));\n\n    float width \x3d fwidth(y);\n    float maxPixelDistance \x3d length(pos) * perScreenPixelRatio * 2.0;\n    float pixelDist \x3d dist / min(width, maxPixelDistance);\n    return abs(pixelDist);\n  }\n\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    float distance \x3d planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);\n\n    vec4 color \x3d laserlineProfile(distance);\n    float alpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));\n\n    gl_FragColor \x3d laserlineOutput(color * alpha * depthDiscontinuityAlpha);\n  }\n  "],
["\n  float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {\n    vec3 origin \x3d mix(start, end, 0.5);\n    vec3 basis \x3d end - origin;\n    vec3 posAtOrigin \x3d pos - origin;\n\n    float x \x3d dot(normalize(basis), posAtOrigin);\n    float y \x3d dot(plane.xyz, posAtOrigin);\n\n    float dx \x3d max(abs(x) - length(basis), 0.0);\n    float dy \x3d y;\n\n    float dist \x3d length(vec2(dx, dy));\n\n    float width \x3d fwidth(y);\n    float maxPixelDistance \x3d length(pos) * perScreenPixelRatio * 2.0;\n    float pixelDist \x3d dist / min(width, maxPixelDistance);\n    return abs(pixelDist);\n  }\n\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    float distance \x3d planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);\n\n    vec4 color \x3d laserlineProfile(distance);\n    float alpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));\n\n    gl_FragColor \x3d laserlineOutput(color * alpha * depthDiscontinuityAlpha);\n  }\n  "]))));
return q};var m,n})},"esri/views/3d/webgl-engine/core/shaderLibrary/Laserline.glsl":function(){define("require exports ../../../../../core/tsSupport/makeTemplateObjectHelper ./output/ReadLinearDepth.glsl ./util/CameraSpace.glsl ../shaderModules/interfaces".split(" "),function(t,h,k,a,c,e){Object.defineProperty(h,"__esModule",{value:!0});h.Laserline=function(g,r){g.extensions.add("GL_OES_standard_derivatives");g.include(a.ReadLinearDepth);g.include(c.CameraSpace);g.fragment.uniforms.add("glowColor",
"vec3");g.fragment.uniforms.add("glowWidth","float");g.fragment.uniforms.add("glowFalloff","float");g.fragment.uniforms.add("innerColor","vec3");g.fragment.uniforms.add("innerWidth","float");g.fragment.uniforms.add("depthMap","sampler2D");g.fragment.uniforms.add("nearFar","vec2");g.fragment.uniforms.add("frameColor","sampler2D");r.contrastControlEnabled&&g.fragment.uniforms.add("globalAlphaContrastBoost","float");g.fragment.code.add(e.glsl(m||(m=k(["\n  vec4 blendPremultiplied(vec4 source, vec4 dest) {\n    float oneMinusSourceAlpha \x3d 1.0 - source.a;\n\n    return vec4(\n      source.rgb + dest.rgb * oneMinusSourceAlpha,\n      source.a + dest.a * oneMinusSourceAlpha\n    );\n  }\n  "],
["\n  vec4 blendPremultiplied(vec4 source, vec4 dest) {\n    float oneMinusSourceAlpha \x3d 1.0 - source.a;\n\n    return vec4(\n      source.rgb + dest.rgb * oneMinusSourceAlpha,\n      source.a + dest.a * oneMinusSourceAlpha\n    );\n  }\n  "]))));g.fragment.code.add(e.glsl(n||(n=k(["\n  vec4 premultipliedColor(vec3 rgb, float alpha) {\n    return vec4(rgb * alpha, alpha);\n  }\n  "],["\n  vec4 premultipliedColor(vec3 rgb, float alpha) {\n    return vec4(rgb * alpha, alpha);\n  }\n  "]))));g.fragment.code.add(e.glsl(f||
(f=k(["\n  vec4 laserlineProfile(float dist) {\n    if (dist \x3e glowWidth) {\n      return vec4(0.0);\n    }\n\n    float innerAlpha \x3d (1.0 - smoothstep(0.0, innerWidth, dist));\n    float glowAlpha \x3d pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);\n\n    return blendPremultiplied(\n      premultipliedColor(innerColor, innerAlpha),\n      premultipliedColor(glowColor, glowAlpha)\n    );\n  }\n  "],["\n  vec4 laserlineProfile(float dist) {\n    if (dist \x3e glowWidth) {\n      return vec4(0.0);\n    }\n\n    float innerAlpha \x3d (1.0 - smoothstep(0.0, innerWidth, dist));\n    float glowAlpha \x3d pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);\n\n    return blendPremultiplied(\n      premultipliedColor(innerColor, innerAlpha),\n      premultipliedColor(glowColor, glowAlpha)\n    );\n  }\n  "]))));
g.fragment.code.add(e.glsl(q||(q=k(["\n  bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {\n    float depth \x3d linearDepth(depthMap, uv, nearFar);\n\n    if (-depth \x3d\x3d nearFar[0]) {\n      return false;\n    }\n\n    pos \x3d reconstructPosition(gl_FragCoord.xy, depth);\n    normal \x3d normalize(cross(dFdx(pos), dFdy(pos)));\n\n    float ddepth \x3d fwidth(depth);\n    depthDiscontinuityAlpha \x3d 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\n\n    return true;\n  }\n  "],
["\n  bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {\n    float depth \x3d linearDepth(depthMap, uv, nearFar);\n\n    if (-depth \x3d\x3d nearFar[0]) {\n      return false;\n    }\n\n    pos \x3d reconstructPosition(gl_FragCoord.xy, depth);\n    normal \x3d normalize(cross(dFdx(pos), dFdy(pos)));\n\n    float ddepth \x3d fwidth(depth);\n    depthDiscontinuityAlpha \x3d 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\n\n    return true;\n  }\n  "]))));
r.contrastControlEnabled?g.fragment.code.add(e.glsl(b||(b=k(["\n    float rgbToLuminance(vec3 color) {\n      return dot(vec3(0.2126, 0.7152, 0.0722), color);\n    }\n\n    vec4 laserlineOutput(vec4 color) {\n      float backgroundLuminance \x3d rgbToLuminance(texture2D(frameColor, uv).rgb);\n      float alpha \x3d clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);\n\n      return color * alpha;\n    }\n    "],["\n    float rgbToLuminance(vec3 color) {\n      return dot(vec3(0.2126, 0.7152, 0.0722), color);\n    }\n\n    vec4 laserlineOutput(vec4 color) {\n      float backgroundLuminance \x3d rgbToLuminance(texture2D(frameColor, uv).rgb);\n      float alpha \x3d clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);\n\n      return color * alpha;\n    }\n    "])))):
g.fragment.code.add(e.glsl(v||(v=k(["\n    vec4 laserlineOutput(vec4 color) {\n      return color * globalAlpha;\n    }\n    "],["\n    vec4 laserlineOutput(vec4 color) {\n      return color * globalAlpha;\n    }\n    "]))))};var m,n,f,q,b,v})},"esri/views/3d/webgl-engine/shaders/LaserlineTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/factories/vec4f32 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./Laserlines.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g,r,z){Object.defineProperty(h,"__esModule",{value:!0});c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}k(c,a);c.prototype.initializeProgram=function(a){var d=c.shader.get().build(this.configuration);return new g(a.rctx,d.generateSource("vertex"),d.generateSource("fragment"),b.Default3D)};c.prototype.bind=function(a,b){this.program.setUniform3fv("innerColor",a.innerColor);this.program.setUniform1f("innerWidth",a.innerWidth*b.pixelRatio);this.program.setUniform3fv("glowColor",
a.glowColor);this.program.setUniform1f("glowWidth",a.glowWidth*b.pixelRatio);this.program.setUniform1f("glowFalloff",a.glowFalloff);this.program.setUniform1f("globalAlpha",a.globalAlpha);this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=a.globalAlphaContrastBoost?a.globalAlphaContrastBoost:1);var c=null!=a.angleCutoff?a.angleCutoff:v.defaultAngleCutoff;this.program.setUniform2f("angleCutoff",Math.cos(c),Math.cos(Math.max(0,c-e.deg2rad(2))));this.configuration.intersectsLineEnabled&&
this.program.setUniform1f("perScreenPixelRatio",b.perScreenPixelRatio);this.configuration.heightPlaneHeightEnabled&&this.program.setUniform4fv("heightPlaneFillColor",a.heightPlaneFillColor||m.ONES)};c.prototype.initializePipeline=function(){return z.makePipelineState({blending:r.simpleBlendingParams(1,771),colorWrite:z.defaultColorWriteParams})};c.shader=new n.ReloadableShaderModule(v,"./Laserlines.glsl",t);return c}(f.ShaderTechnique);h.LaserlineTechnique=c;c=function(b){function c(){var a=null!==
b&&b.apply(this,arguments)||this;a.heightPlaneEnabled=!1;a.heightPlaneHeightEnabled=!1;a.pointDistanceEnabled=!1;a.lineVerticalPlaneEnabled=!1;a.intersectsLineEnabled=!1;a.contrastControlEnabled=!1;return a}k(c,b);a([q.parameter()],c.prototype,"heightPlaneEnabled",void 0);a([q.parameter()],c.prototype,"heightPlaneHeightEnabled",void 0);a([q.parameter()],c.prototype,"pointDistanceEnabled",void 0);a([q.parameter()],c.prototype,"lineVerticalPlaneEnabled",void 0);a([q.parameter()],c.prototype,"intersectsLineEnabled",
void 0);a([q.parameter()],c.prototype,"contrastControlEnabled",void 0);return c}(q.ShaderTechniqueConfiguration);h.LaserlineTechniqueConfiguration=c})},"esri/views/3d/webgl-engine/shaders/Laserlines.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../../../../core/mathUtils ../core/shaderLibrary/Laserline.glsl ../core/shaderLibrary/ScreenSpacePass ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),function(t,h,k,a,c,e,m,n){Object.defineProperty(h,
"__esModule",{value:!0});h.defaultAngleCutoff=a.deg2rad(6);h.build=function(a){var x=new n.ShaderBuilder;x.extensions.add("GL_OES_standard_derivatives");x.include(e.ScreenSpacePass);x.include(c.Laserline,a);x.fragment.uniforms.add("angleCutoff","vec2");x.fragment.uniforms.add("globalAlpha","float");a.heightPlaneEnabled&&x.fragment.uniforms.add("heightPlane","vec4");a.heightPlaneHeightEnabled&&(x.fragment.uniforms.add("heightPlaneHeight","float"),x.fragment.uniforms.add("heightPlaneFillColor","vec4"));
a.pointDistanceEnabled&&x.fragment.uniforms.add("pointDistanceSphere","vec4");a.lineVerticalPlaneEnabled&&x.fragment.uniforms.add("lineVerticalPlane","vec4").add("lineVerticalStart","vec3").add("lineVerticalEnd","vec3");(a.heightPlaneEnabled||a.pointDistanceEnabled||a.lineVerticalPlaneEnabled)&&x.fragment.uniforms.add("maxPixelDistance","float");a.intersectsLineEnabled&&x.fragment.uniforms.add("intersectsLineStart","vec3").add("intersectsLineEnd","vec3").add("intersectsLineDirection","vec3").add("intersectsLineRadius",
"float").add("perScreenPixelRatio","float");if(a.heightPlaneEnabled||a.lineVerticalPlaneEnabled)a.heightPlaneHeightEnabled&&!a.lineVerticalPlaneEnabled||x.fragment.code.add(m.glsl(f||(f=k(["\n      float planeDistancePixels(vec4 plane, vec3 pos) {\n        float dist \x3d dot(plane.xyz, pos) + plane.w;\n        float width \x3d fwidth(dist);\n        dist /\x3d min(width, maxPixelDistance);\n        return abs(dist);\n      }"],["\n      float planeDistancePixels(vec4 plane, vec3 pos) {\n        float dist \x3d dot(plane.xyz, pos) + plane.w;\n        float width \x3d fwidth(dist);\n        dist /\x3d min(width, maxPixelDistance);\n        return abs(dist);\n      }"])))),
a.heightPlaneHeightEnabled&&x.fragment.code.add(m.glsl(q||(q=k(["\n      vec2 boxDistancePixels(vec4 plane, float height, vec3 pos) {\n        float d \x3d dot(plane.xyz, pos);\n\n        float offsetMin \x3d plane.w;\n        float offsetMax \x3d offsetMin - height;\n\n        float dmin \x3d d + offsetMin;\n        float dmax \x3d d + offsetMax;\n\n        float width \x3d fwidth(d);\n\n        float outerDistance \x3d min(abs(dmin), abs(dmax));\n        float innerDistance \x3d max(-dmin, dmax);\n\n        return vec2(innerDistance, outerDistance) / min(width, maxPixelDistance);\n      }"],
["\n      vec2 boxDistancePixels(vec4 plane, float height, vec3 pos) {\n        float d \x3d dot(plane.xyz, pos);\n\n        float offsetMin \x3d plane.w;\n        float offsetMax \x3d offsetMin - height;\n\n        float dmin \x3d d + offsetMin;\n        float dmax \x3d d + offsetMax;\n\n        float width \x3d fwidth(d);\n\n        float outerDistance \x3d min(abs(dmin), abs(dmax));\n        float innerDistance \x3d max(-dmin, dmax);\n\n        return vec2(innerDistance, outerDistance) / min(width, maxPixelDistance);\n      }"]))));
a.pointDistanceEnabled&&x.fragment.code.add(m.glsl(b||(b=k(["\n    float sphereDistancePixels(vec4 sphere, vec3 pos) {\n      float dist \x3d distance(sphere.xyz, pos) - sphere.w;\n      float width \x3d fwidth(dist);\n      dist /\x3d min(width, maxPixelDistance);\n      return abs(dist);\n    }\n    "],["\n    float sphereDistancePixels(vec4 sphere, vec3 pos) {\n      float dist \x3d distance(sphere.xyz, pos) - sphere.w;\n      float width \x3d fwidth(dist);\n      dist /\x3d min(width, maxPixelDistance);\n      return abs(dist);\n    }\n    "]))));
a.intersectsLineEnabled&&x.fragment.code.add(m.glsl(v||(v=k(["\n    float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\n      float dist \x3d length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\n      return abs(dist) - radius;\n    }\n    "],["\n    float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\n      float dist \x3d length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\n      return abs(dist) - radius;\n    }\n    "]))));
(a.lineVerticalPlaneEnabled||a.intersectsLineEnabled)&&x.fragment.code.add(m.glsl(g||(g=k(["\n    bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\n      vec3 dir \x3d end - start;\n      float t2 \x3d dot(dir, pos - start);\n      float l2 \x3d dot(dir, dir);\n      return t2 \x3e\x3d 0.0 \x26\x26 t2 \x3c\x3d l2;\n    }\n    "],["\n    bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\n      vec3 dir \x3d end - start;\n      float t2 \x3d dot(dir, pos - start);\n      float l2 \x3d dot(dir, dir);\n      return t2 \x3e\x3d 0.0 \x26\x26 t2 \x3c\x3d l2;\n    }\n    "]))));
x.fragment.code.add(m.glsl(r||(r=k(["\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    vec4 color \x3d vec4(0, 0, 0, 0);\n  "],["\n  void main() {\n    vec3 pos;\n    vec3 normal;\n    float depthDiscontinuityAlpha;\n\n    if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\n      discard;\n    }\n\n    vec4 color \x3d vec4(0, 0, 0, 0);\n  "]))));
a.heightPlaneEnabled&&(x.fragment.code.add(m.glsl(z||(z=k(["\n    {\n      float heightPlaneAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));\n    "],["\n    {\n      float heightPlaneAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));\n    "])))),a.heightPlaneHeightEnabled?x.fragment.code.add(m.glsl(w||(w=k(["\n      vec2 heightBoxDistance \x3d boxDistancePixels(heightPlane, heightPlaneHeight, pos);\n      vec4 heightPlaneFill \x3d premultipliedColor(heightPlaneFillColor.rgb, heightPlaneFillColor.a) * clamp(0.5 - heightBoxDistance.x, 0.0, 1.0);\n      vec4 heightPlaneLine \x3d laserlineProfile(heightBoxDistance.y);\n\n      vec4 heightPlaneColor \x3d blendPremultiplied(heightPlaneFill, heightPlaneLine);\n      "],
["\n      vec2 heightBoxDistance \x3d boxDistancePixels(heightPlane, heightPlaneHeight, pos);\n      vec4 heightPlaneFill \x3d premultipliedColor(heightPlaneFillColor.rgb, heightPlaneFillColor.a) * clamp(0.5 - heightBoxDistance.x, 0.0, 1.0);\n      vec4 heightPlaneLine \x3d laserlineProfile(heightBoxDistance.y);\n\n      vec4 heightPlaneColor \x3d blendPremultiplied(heightPlaneFill, heightPlaneLine);\n      "])))):x.fragment.code.add(m.glsl(y||(y=k(["\n      vec4 heightPlaneColor \x3d laserlineProfile(planeDistancePixels(heightPlane, pos));\n      "],
["\n      vec4 heightPlaneColor \x3d laserlineProfile(planeDistancePixels(heightPlane, pos));\n      "])))),x.fragment.code.add(m.glsl(d||(d=k(["\n      color \x3d max(color, heightPlaneColor * heightPlaneAlpha);\n    }\n    "],["\n      color \x3d max(color, heightPlaneColor * heightPlaneAlpha);\n    }\n    "])))));a.pointDistanceEnabled&&x.fragment.code.add(m.glsl(u||(u=k(["\n    {\n      // distance to sphere\n      float pointDistanceSphereDistance \x3d sphereDistancePixels(pointDistanceSphere, pos);\n      vec4 pointDistanceSphereColor \x3d laserlineProfile(pointDistanceSphereDistance);\n      float pointDistanceSphereAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\n\n      color \x3d max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);\n    }\n    "],
["\n    {\n      // distance to sphere\n      float pointDistanceSphereDistance \x3d sphereDistancePixels(pointDistanceSphere, pos);\n      vec4 pointDistanceSphereColor \x3d laserlineProfile(pointDistanceSphereDistance);\n      float pointDistanceSphereAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\n\n      color \x3d max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);\n    }\n    "]))));a.lineVerticalPlaneEnabled&&
x.fragment.code.add(m.glsl(p||(p=k(["\n    {\n      if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\n        float lineVerticalDistance \x3d planeDistancePixels(lineVerticalPlane, pos);\n\n        vec4 lineVerticalColor \x3d laserlineProfile(lineVerticalDistance);\n        float lineVerticalAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\n\n        color \x3d max(color, lineVerticalColor * lineVerticalAlpha);\n      }\n    }\n    "],
["\n    {\n      if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\n        float lineVerticalDistance \x3d planeDistancePixels(lineVerticalPlane, pos);\n\n        vec4 lineVerticalColor \x3d laserlineProfile(lineVerticalDistance);\n        float lineVerticalAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\n\n        color \x3d max(color, lineVerticalColor * lineVerticalAlpha);\n      }\n    }\n    "]))));a.intersectsLineEnabled&&
x.fragment.code.add(m.glsl(A||(A=k(["\n    {\n      if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\n        float intersectsLineDistance \x3d lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\n        vec4 intersectsLineColor \x3d laserlineProfile(intersectsLineDistance);\n        float intersectsLineAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\n\n        color \x3d max(color, intersectsLineColor * intersectsLineAlpha);\n      }\n    }\n    "],
["\n    {\n      if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\n        float intersectsLineDistance \x3d lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\n        vec4 intersectsLineColor \x3d laserlineProfile(intersectsLineDistance);\n        float intersectsLineAlpha \x3d 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\n\n        color \x3d max(color, intersectsLineColor * intersectsLineAlpha);\n      }\n    }\n    "]))));
x.fragment.code.add(m.glsl(l||(l=k(["\n    gl_FragColor \x3d laserlineOutput(color * depthDiscontinuityAlpha);\n  }\n  "],["\n    gl_FragColor \x3d laserlineOutput(color * depthDiscontinuityAlpha);\n  }\n  "]))));return x};var f,q,b,v,g,r,z,w,y,d,u,p,A,l})},"esri/views/3d/webgl-engine/materials/MeasurementArrowMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/MeasurementArrowTechnique".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v){t=function(a){function c(b,c){c=a.call(this,c)||this;c.techniqueConfig=new v.MeasurementArrowTechniqueConfiguration;c.params=q.copyParameters(b,r);return c}k(c,a);c.prototype.getTechniqueConfig=function(){this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset;return this.techniqueConfig};c.prototype.dispose=function(){};c.prototype.setParameterValues=function(a){q.updateParameters(this.params,a)&&this.parametersChanged()};c.prototype.getParameters=function(){return this.params};
c.prototype.getPassParameters=function(){return this.params};c.prototype.intersect=function(){};c.prototype.createBufferWriter=function(){return new A};c.prototype.createRenderer=function(a,c){return new b(a,c,this)};c.prototype.getGLMaterial=function(a){return 0===a.output?new g(a):void 0};return c}(n.Material);var g=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}k(b,a);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(v.MeasurementArrowTechnique,
this.material.getTechniqueConfig(),this.technique)};b.prototype.beginSlot=function(a){return 3===a};b.prototype.bind=function(a){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getPassParameters())};return b}(m.GLMaterial),r={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1},z=e.newLayout().vec3f(f.VertexAttrConstants.POSITION).vec3f(f.VertexAttrConstants.NORMAL).vec2f(f.VertexAttrConstants.UV0).f32(f.VertexAttrConstants.AUXPOS1),
w=c.vec3f64.create(),y=c.vec3f64.create(),d=c.vec3f64.create(),u=c.vec3f64.create(),p=c.vec3f64.create(),A=function(){function b(){this.vertexBufferLayout=z}b.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};b.prototype.elementCount=function(a){return 2*(a.indices[f.VertexAttrConstants.POSITION].length/2+1)};b.prototype.write=function(b,c,e,g){var l=c.vertexAttr[f.VertexAttrConstants.POSITION].data,r=c.vertexAttr[f.VertexAttrConstants.NORMAL].data,m=l.length/3;(c=c&&
c.indices&&c.indices.position)&&c.length!==2*(m-1)&&console.warn("MeasurementArrowMaterial does not support indices");c=b.transformation;for(var k=b.invTranspTransformation,n=e.position,x=e.normal,B=e.uv0,q=b=0;q<m;++q){var h=3*q;a.vec3.set(w,l[h],l[h+1],l[h+2]);q<m-1&&(h=3*(q+1),a.vec3.set(y,l[h],l[h+1],l[h+2]),a.vec3.set(p,r[h],r[h+1],r[h+2]),a.vec3.normalize(p,p),a.vec3.subtract(d,y,w),a.vec3.normalize(d,d),a.vec3.cross(u,p,d),a.vec3.normalize(u,u));h=a.vec3.distance(w,y);c&&k&&(a.vec3.transformMat4(w,
w,c),a.vec3.transformMat4(y,y,c),a.vec3.transformMat4(u,u,k));var v=g+2*q,z=v+1;n.setVec(v,w);n.setVec(z,w);x.setVec(v,u);x.setVec(z,u);B.set(v,0,b);B.set(v,1,-1);B.set(z,0,b);B.set(z,1,1);q<m-1&&(b+=h)}e=e.auxpos1;for(q=0;q<2*m;++q)e.set(g+q,b)};return b}();return t})},"esri/views/3d/webgl-engine/shaders/MeasurementArrowTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderLibrary/Transform.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./MeasurementArrow.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g){Object.defineProperty(h,"__esModule",{value:!0});c=function(a){function c(b,c){return a.call(this,b,c)||this}k(c,a);c.prototype.initializeProgram=function(a){var b=c.shader.get().build();return new v(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),q.Default3D)};c.prototype.bindPass=function(a,b){this.program.setUniform1f("width",b.width);this.program.setUniform1f("outlineSize",b.outlineSize);this.program.setUniform4fv("outlineColor",b.outlineColor);
this.program.setUniform1f("stripeLength",b.stripeLength);this.program.setUniform4fv("stripeEvenColor",b.stripeEvenColor);this.program.setUniform4fv("stripeOddColor",b.stripeOddColor)};c.prototype.bindDraw=function(a){e.Transform.bindUniforms(this.program,a)};c.prototype.initializePipeline=function(){return g.makePipelineState({polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},depthWrite:g.defaultDepthWriteParams,colorWrite:g.defaultColorWriteParams})};
Object.defineProperty(c.prototype,"primitiveType",{get:function(){return 5},enumerable:!0,configurable:!0});c.shader=new m.ReloadableShaderModule(b,"./MeasurementArrow.glsl",t);return c}(n.ShaderTechnique);h.MeasurementArrowTechnique=c;c=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.polygonOffsetEnabled=!1;return a}k(c,b);a([f.parameter()],c.prototype,"polygonOffsetEnabled",void 0);return c}(f.ShaderTechniqueConfiguration);h.MeasurementArrowTechniqueConfiguration=c})},"esri/views/3d/webgl-engine/shaders/MeasurementArrow.glsl":function(){define(["require",
"exports","../../../../core/tsSupport/makeTemplateObjectHelper","../core/shaderModules/interfaces","../core/shaderModules/ShaderBuilder"],function(t,h,k,a,c){Object.defineProperty(h,"__esModule",{value:!0});h.build=function(){var n=new c.ShaderBuilder;n.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4").add("width","float");n.attributes.add("position","vec3");n.attributes.add("normal","vec3");n.attributes.add("uv0","vec2");n.attributes.add("auxpos1","float");n.varyings.add("vtc",
"vec2");n.varyings.add("vlength","float");n.varyings.add("vradius","float");n.vertex.code.add(a.glsl(e||(e=k(["\n    void main(void) {\n      vec3 bitangent \x3d normal;\n\n      vtc \x3d uv0;\n      vlength \x3d auxpos1;\n      vradius \x3d 0.5 * width;\n\n      vec4 pos \x3d view * vec4((model * vec4(position + vradius * bitangent * uv0.y, 1.0)).xyz, 1.0);\n      gl_Position \x3d proj * pos;\n    }\n  "],["\n    void main(void) {\n      vec3 bitangent \x3d normal;\n\n      vtc \x3d uv0;\n      vlength \x3d auxpos1;\n      vradius \x3d 0.5 * width;\n\n      vec4 pos \x3d view * vec4((model * vec4(position + vradius * bitangent * uv0.y, 1.0)).xyz, 1.0);\n      gl_Position \x3d proj * pos;\n    }\n  "]))));
n.fragment.uniforms.add("outlineSize","float").add("outlineColor","vec4").add("stripeLength","float").add("stripeEvenColor","vec4").add("stripeOddColor","vec4");var f=1/Math.sqrt(2);n.fragment.code.add(a.glsl(m||(m=k(["\n    const float INV_SQRT2 \x3d ",";\n\n    vec4 arrowColor(vec2 tc, float len) {\n      float d \x3d INV_SQRT2 * (tc.x - abs(tc.y));\n      d \x3d min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n      d \x3d min(d, 1.0 - abs(tc.y));\n\n      if (d \x3c 0.0) {\n        return vec4(0.0);\n      } else if (d \x3c outlineSize) {\n        return outlineColor;\n      } else {\n        return fract(0.5 / stripeLength * tc.x * vradius) \x3e\x3d 0.5 ? stripeOddColor : stripeEvenColor;\n      }\n    }\n\n    void main(void) {\n      vec2 ntc \x3d vec2(vtc.x / vradius, vtc.y);\n      vec4 color \x3d arrowColor(ntc, vlength / vradius);\n      if (color.a \x3d\x3d 0.0) {\n        discard;\n      }\n      gl_FragColor \x3d color;\n    }\n  "],
["\n    const float INV_SQRT2 \x3d ",";\n\n    vec4 arrowColor(vec2 tc, float len) {\n      float d \x3d INV_SQRT2 * (tc.x - abs(tc.y));\n      d \x3d min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n      d \x3d min(d, 1.0 - abs(tc.y));\n\n      if (d \x3c 0.0) {\n        return vec4(0.0);\n      } else if (d \x3c outlineSize) {\n        return outlineColor;\n      } else {\n        return fract(0.5 / stripeLength * tc.x * vradius) \x3e\x3d 0.5 ? stripeOddColor : stripeEvenColor;\n      }\n    }\n\n    void main(void) {\n      vec2 ntc \x3d vec2(vtc.x / vradius, vtc.y);\n      vec4 color \x3d arrowColor(ntc, vlength / vradius);\n      if (color.a \x3d\x3d 0.0) {\n        discard;\n      }\n      gl_FragColor \x3d color;\n    }\n  "])),
a.glsl.float(f)));return n};var e,m})},"esri/views/interactive/InteractiveToolBase":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/has ../../core/promiseUtils ../../core/scheduling ../../core/accessorSupport/decorators ./interactiveToolUtils ./ManipulatorCollection".split(" "),function(t,h,k,a,c,e,m,n,f,q,b,v){Object.defineProperty(h,"__esModule",{value:!0});t=function(c){function g(a){a=
c.call(this,a)||this;a.attached=!1;a.created=!1;a.completed=!1;a.manipulators=new v.ManipulatorCollection;a.deferCreation=!1;a._editableFlags=[];a._manipulatorHandles=new e;a._creationResolver=n.createResolver();return a}k(g,c);Object.defineProperty(g.prototype,"active",{get:function(){return null!=this.view&&this.view.activeTool===this},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isSupported",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"visible",{set:function(a){this._set("visible",a);a||b.setActive(this,!1);this.attached&&(a?this._show():this._hide())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"editable",{get:function(){return this.hasEditableFlag(0)},set:function(a){this.setEditableFlag(0,a)},enumerable:!0,configurable:!0});g.prototype.attach=function(){if(!this.attached&&this.isSupported){this.manipulators.attach();this.onAttach();if(this.visible)this.onShow();this._set("attached",!0)}};g.prototype.detach=
function(){this.attached&&(this.onHide(),this.onDetach(),this.manipulators.detach(),this._manipulatorHandles.removeAll(),this._set("attached",!1))};g.prototype.handleInputEvent=function(a){if(this.attached)this.onInputEvent(a)};g.prototype.destroy=function(){this.manipulators.destroy();this._manipulatorHandles&&(this._manipulatorHandles.destroy(),this._manipulatorHandles=null);this._set("view",null)};g.prototype.setEditableFlag=function(a,b){this._editableFlags[a]=b;this.manipulators.isToolEditable=
this._editableFlags.every(function(a){return null==a||a});this._updateManipulatorAttachment();0===a&&this.notifyChange("editable");this.onEditableChange()};g.prototype.hasEditableFlag=function(a){a=this._editableFlags[a];return null==a?!0:a};g.prototype.when=function(){return this._creationResolver.promise};g.prototype.rejectCreation=function(a){this._creationResolver.reject(a)};g.prototype.initialize=function(){this.deferCreation||this.complete()};g.prototype.onAttach=function(){};g.prototype.onDetach=
function(){};g.prototype.onShow=function(){};g.prototype.onHide=function(){};g.prototype.onEditableChange=function(){};g.prototype.onInputEvent=function(a){};Object.defineProperty(g.prototype,"internallyEditable",{get:function(){return this.hasEditableFlag(0)&&this.hasEditableFlag(1)},enumerable:!0,configurable:!0});g.prototype.create=function(){var a=this;this.created||(this._set("created",!0),m("esri-native-promise")?this._creationResolver(this):f.schedule(function(){return a._creationResolver(a)}))};
g.prototype.complete=function(){this.create();this._set("completed",!0)};g.prototype._show=function(){this._updateManipulatorAttachment();this.onShow()};g.prototype._hide=function(){this._updateManipulatorAttachment();this.onHide()};g.prototype._updateManipulatorAttachment=function(){this.attached&&this.visible?this.manipulators.attach():this.manipulators.detach()};a([q.property({constructOnly:!0})],g.prototype,"view",void 0);a([q.property({dependsOn:["view.activeTool"],readOnly:!0})],g.prototype,
"active",null);a([q.property({value:!0})],g.prototype,"visible",null);a([q.property({value:!0})],g.prototype,"editable",null);a([q.property({readOnly:!0})],g.prototype,"attached",void 0);a([q.property({readOnly:!0})],g.prototype,"created",void 0);a([q.property({readOnly:!0})],g.prototype,"completed",void 0);a([q.property({readOnly:!0})],g.prototype,"manipulators",void 0);a([q.property({constructOnly:!0})],g.prototype,"deferCreation",void 0);return g=a([q.subclass("esri.views.interactive.InteractiveToolBase")],
g)}(q.declared(c));h.InteractiveToolBase=t})},"esri/views/interactive/ManipulatorCollection":function(){define(["require","exports","../../core/tsSupport/decorateHelper","../../core/Collection","../../core/maybe"],function(t,h,k,a,c){Object.defineProperty(h,"__esModule",{value:!0});t=function(){function e(){this._isToolEditable=!0;this._manipulators=new a;this._nextManipulatorId=0;this._resourceContexts={manipulator3D:{}};this._attached=!1}Object.defineProperty(e.prototype,"isToolEditable",{set:function(a){this._isToolEditable=
a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"length",{get:function(){return this._manipulators.length},enumerable:!0,configurable:!0});e.prototype.add=function(a,c){void 0===c&&(c=0);return this.addMany([a],c)[0]};e.prototype.addMany=function(a,c){var f=this;void 0===c&&(c=0);return a.map(function(a){var b=f._nextManipulatorId++;a={id:b,manipulator:a,visibilityPredicate:c,attached:!1};f._manipulators.add(a);f._attached&&f._updateManipulatorAttachment(a);return b})};e.prototype.remove=
function(a){if("number"===typeof a){for(var c=0;c<this._manipulators.length;c++)if(this._manipulators.getItemAt(c).id===a)return a=this._manipulators.splice(c,1)[0],this._detachManipulator(a),a.id;return null}for(c=0;c<this._manipulators.length;c++)if(this._manipulators.getItemAt(c).manipulator===a)return a=this._manipulators.splice(c,1)[0],this._detachManipulator(a),a.id;return null};e.prototype.removeAll=function(){var a=this;this._manipulators.forEach(function(c){a._detachManipulator(c)});this._manipulators.removeAll()};
e.prototype.attach=function(){var a=this;this._manipulators.forEach(function(c){a._updateManipulatorAttachment(c)});this._attached=!0};e.prototype.detach=function(){var a=this;this._manipulators.forEach(function(c){a._detachManipulator(c)});this._attached=!1};e.prototype.destroy=function(){this._manipulators.forEach(function(a){a=a.manipulator;a.destroy&&a.destroy()});this._manipulators.destroy();this._resourceContexts=null};e.prototype.on=function(a,c){return this._manipulators.on(a,function(a){c(a)})};
e.prototype.forEach=function(a){for(var c=0,f=this._manipulators.items;c<f.length;c++)a(f[c])};e.prototype.toArray=function(){var a=[];this.forEach(function(c){return a.push(c.manipulator)});return a};e.prototype.intersect=function(a,e){var f=null,k=Number.MAX_VALUE;this._manipulators.forEach(function(b){var q=b.id,g=b.manipulator;b.attached&&g.interactive&&(b=g.intersectionDistance(a,e),c.isSome(b)&&b<k&&(k=b,f=q))});return f};e.prototype.findById=function(a){if(c.isNone(a))return null;for(var e=
0,f=this._manipulators.items;e<f.length;e++){var k=f[e];if(a===k.id)return k.manipulator}return null};e.prototype._updateManipulatorAttachment=function(a){this._isManipulatorItemVisible(a)?this._attachManipulator(a):this._detachManipulator(a)};e.prototype._attachManipulator=function(a){a.attached||(a.manipulator.attach(this._resourceContexts),a.attached=!0)};e.prototype._detachManipulator=function(a){if(a.attached){var c=a.manipulator;c.grabbing=!1;c.dragging=!1;c.hovering=!1;c.selected=!1;c.detach(this._resourceContexts);
a.attached=!1}};e.prototype._isManipulatorItemVisible=function(a){return 2===a.visibilityPredicate?!0:this._isToolEditable?0===a.visibilityPredicate:1===a.visibilityPredicate};return e}();h.ManipulatorCollection=t})},"esri/widgets/support/commonProperties":function(){define(["require","exports","../../core/unitUtils"],function(t,h,k){Object.defineProperty(h,"__esModule",{value:!0});h.defaultUnitPropertyMetadata={dependsOn:["view.map.portalItem?.portal.units","view.map.portalItem?.portal.user.units",
"view.spatialReference"],readOnly:!0,get:function(){var a=this.view;if(!a)return"metric";var c=a.get("map.portalItem.portal");if(c)switch(c.get("user.units")||c.units){case "metric":return"metric";case "english":return"imperial"}return k.getDefaultUnitSystem(a.spatialReference)||"metric"}}})},"esri/widgets/support/InteractiveToolViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Accessor ../../core/Error ../../core/Handles ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../views/interactive/interactiveToolUtils".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g,r){Object.defineProperty(h,"__esModule",{value:!0});t=function(h){function n(a){var b=h.call(this)||this;b.tool=null;b._baseHandles=new q;b._loggedUnsupportedErrorOnce=!1;b._creationAbortController=null;a&&null!=a.visible&&(b.visible=a.visible);return b}k(n,h);n.prototype.initialize=function(){var a=this;this._baseHandles.add(v.init(this,["view.ready","isSupported"],function(){a.view&&a.view.ready&&!a.isSupported?a._loggedUnsupportedErrorOnce||(a.logUnsupportedError(),
a._loggedUnsupportedErrorOnce=!0):a._loggedUnsupportedErrorOnce=!1}))};n.prototype.destroy=function(){this.removeTool();this.view=null;this._baseHandles.destroy();this._baseHandles=null};Object.defineProperty(n.prototype,"isSupported",{get:function(){return!this.view||this.view.type===this.supportedViewType},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"view",{get:function(){return this._get("view")},set:function(a){var b=this;a!==this.view&&(this.removeTool(),this._set("view",
a),this._baseHandles.remove("tools"),a&&this._baseHandles.add(a.tools.on("change",function(a){if(b.tool){var c=0;for(a=a.removed;c<a.length;c++){var d=a[c];if(b.tool===d){d.destroyed||d.destroy();b._set("tool",null);break}}}}),"tools"))},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"visible",{set:function(a){this._set("visible",a);this.tool&&(this.tool.visible=a);!a&&this._creationAbortController&&(this._creationAbortController.abort(),this._creationAbortController=null)},enumerable:!0,
configurable:!0});Object.defineProperty(n.prototype,"active",{get:function(){return null!=this._creationAbortController||null!=this.tool&&this.tool.active},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"isDisabled",{get:function(){return!this.view||!this.view.ready||!this.isSupported},enumerable:!0,configurable:!0});n.prototype.createTool=function(){return m(this,void 0,void 0,function(){var a,d,g,p,k,l,x,h=this;return e(this,function(e){switch(e.label){case 0:this.removeTool();
if(!this.isSupported)return[2,b.reject(new f("tool:create","The view does not support the tool"))];a=this.createToolParams();d=function(){var b=r.evaluateToolConstructorArguments(a.constructorArguments);return c({visible:h.visible},b)};g=new AbortController;p=g.signal;this._creationAbortController=g;k=function(){g===h._creationAbortController&&(h._creationAbortController=null)};e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.view.createTool(a.toolConstructor,d,{signal:p})];case 2:return l=e.sent(),
this._set("tool",l),k(),[3,4];case 3:throw x=e.sent(),k(),x;case 4:return[2]}})})};n.prototype.removeTool=function(){this._creationAbortController&&this._creationAbortController.abort();this._creationAbortController=null;var a=this.tool;a&&(this.view&&this.view.tools&&this.view.tools.remove(a),a.destroyed||a.destroy(),this._set("tool",null))};a([g.property({constructOnly:!0})],n.prototype,"tool",void 0);a([g.property({dependsOn:["view.type"]})],n.prototype,"isSupported",null);a([g.property({value:null})],
n.prototype,"view",null);a([g.property({type:Boolean,value:!0})],n.prototype,"visible",null);a([g.property({dependsOn:["_creationAbortController","tool.active"]})],n.prototype,"active",null);a([g.property({dependsOn:["view","view.ready","isSupported"]})],n.prototype,"isDisabled",null);a([g.property()],n.prototype,"_creationAbortController",void 0);return n=a([g.subclass("esri.widgets.support.InteractiveToolViewModel")],n)}(g.declared(n));h.InteractiveToolViewModel=t})},"esri/widgets/AreaMeasurement3D":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./AreaMeasurement3D/nls/AreaMeasurement3D ../core/accessorSupport/decorators ./Widget ./AreaMeasurement3D/AreaMeasurement3DViewModel ./support/widget".split(" "),
function(t,h,k,a,c,e,m,n,f){return function(h){function b(a){a=h.call(this,a)||this;a.view=null;a.visible=null;a.iconClass="esri-icon-measure-area";a.label=c.widgetLabel;a.viewModel=new n;a.unitOptions=null;a.unit=null;return a}k(b,h);b.prototype.render=function(){var a=this,b=this.viewModel.isSupported,e=this.viewModel.active,k="disabled"===this.viewModel.state,h="ready"===this.viewModel.state,q="measuring"===this.viewModel.state||"measured"===this.viewModel.state,d=this.viewModel.measurement,h=
e&&h?f.tsx("section",{key:"esri-area-measurement-3d__hint",class:"esri-area-measurement-3d__hint"},f.tsx("p",{class:"esri-area-measurement-3d__hint-text"},c.hint)):null,n=b?null:f.tsx("section",{key:"esri-area-measurement-3d__unsupported",class:"esri-area-measurement-3d__panel--error"},f.tsx("p",null,c.unsupported)),p=function(b,d,e){switch(d.state){case "available":return f.tsx("div",{key:e+"-enabled",class:"esri-area-measurement-3d__measurement-item"},f.tsx("span",{class:"esri-area-measurement-3d__measurement-item-title"},
b),f.tsx("span",{class:"esri-area-measurement-3d__measurement-item-value"},d.text));case "unavailable":return f.tsx("div",{key:e+"-disabled",class:a.classes("esri-area-measurement-3d__measurement-item","esri-area-measurement-3d__measurement-item--disabled")},f.tsx("span",{class:"esri-area-measurement-3d__measurement-item-title"},b));case "invalid":return f.tsx("div",{key:e+"-enabled",class:"esri-area-measurement-3d__measurement-item"},f.tsx("span",{class:"esri-area-measurement-3d__measurement-item-title"},
b),f.tsx("span",{class:"esri-area-measurement-3d__measurement-item-value"},c.notApplicable))}},d=q?f.tsx("section",{key:"esri-area-measurement-3d__measurement",class:"esri-area-measurement-3d__measurement"},p(c.area,d.area,"area"),p(c.perimeterLength,d.perimeterLength,"perimeter-length")):null,m=this.id+"__units",p=f.tsx("label",{class:"esri-area-measurement-3d__units-label",for:m},c.unit),m=f.tsx("div",{class:"esri-area-measurement-3d__units-select-wrapper"},f.tsx("select",{class:"esri-area-measurement-3d__units-select esri-select",
id:m,onchange:this._changeUnit,bind:this},this.viewModel.unitOptions.map(function(b){return b===a.viewModel.unit?f.tsx("option",{key:b,value:b,selected:!0},c.units[b]):f.tsx("option",{key:b,value:b},c.units[b])}))),p=q?f.tsx("section",{key:"esri-area-measurement-3d__units",class:"esri-area-measurement-3d__units"},p,m):null,p=q?f.tsx("div",{key:"settings",class:"esri-area-measurement-3d__settings"},p):null,b=!b||e&&!q?null:f.tsx("div",{class:"esri-area-measurement-3d__actions"},f.tsx("button",{disabled:k,
class:this.classes("esri-button esri-button--secondary","esri-area-measurement-3d__clear-button",k&&"esri-button--disabled"),bind:this,onclick:this._newMeasurement},c.newMeasurement)),b=this.visible?f.tsx("div",{class:"esri-area-measurement-3d__container"},n,h,p,d,b):null;return f.tsx("div",{key:"",class:this.classes("esri-area-measurement-3d","esri-widget","esri-widget--panel"),role:"presentation"},b)};b.prototype._newMeasurement=function(){this.viewModel.newMeasurement()};b.prototype._changeUnit=
function(a){a=a.target;if(a=a.options[a.selectedIndex])this.unit=a.value};a([e.aliasOf("viewModel.view")],b.prototype,"view",void 0);a([e.aliasOf("viewModel.visible"),f.renderable()],b.prototype,"visible",void 0);a([e.aliasOf("viewModel.active"),f.renderable()],b.prototype,"active",void 0);a([e.property()],b.prototype,"iconClass",void 0);a([e.property()],b.prototype,"label",void 0);a([e.property({type:n}),f.renderable(["viewModel.state","viewModel.unitOptions","viewModel.unit","viewModel.measurement"])],
b.prototype,"viewModel",void 0);a([e.aliasOf("viewModel.unitOptions")],b.prototype,"unitOptions",void 0);a([e.aliasOf("viewModel.unit")],b.prototype,"unit",void 0);a([f.accessibleHandler()],b.prototype,"_newMeasurement",null);a([f.accessibleHandler()],b.prototype,"_changeUnit",null);return b=a([e.subclass("esri.widgets.AreaMeasurement3D")],b)}(e.declared(m))})},"esri/widgets/AreaMeasurement3D/AreaMeasurement3DViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Handles ../../core/Logger ../../core/promiseUtils ../../core/unitUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../views/3d/interactive/measurementTools/areaMeasurement3D/AreaMeasurement3DTool ../support/commonProperties ../support/InteractiveToolViewModel".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g){var r=e.getLogger("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel");return function(e){function g(a){a=e.call(this,a)||this;a.supportedViewType="3d";a._handles=new c;a._userUnitOptions=null;a._userUnit=null;a.tool=null;return a}k(g,e);g.prototype.initialize=function(){var a=this;this._handles.add([f.init(this,"unit",function(b){a.tool&&(a.tool.unit=b)})])};Object.defineProperty(g.prototype,"state",{get:function(){return this.isDisabled?"disabled":this.tool?
this.tool.state:"ready"},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"measurement",{get:function(){if(!this.tool||this.isDisabled)return null;var a=this.tool.model,b=a.measurementMode,c=a.measurementData,e=a.validMeasurement,f=(c=0===("euclidean"===b?c.intersectingSegments:c.geodesicIntersectingSegments).size)?e?"available":"unavailable":"invalid";return{mode:b,area:{text:c&&e?a.areaLabel:null,state:f},perimeterLength:{text:c&&e?a.perimeterLengthLabel:null,state:f}}},enumerable:!0,
configurable:!0});Object.defineProperty(g.prototype,"unitOptions",{get:function(){return this._filteredOrAllUnits(this._userUnitOptions)},set:function(a){this._userUnitOptions=a;this._set("unitOptions",this._filteredOrAllUnits(this._userUnitOptions))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"unit",{get:function(){return this._userUnit?this._userUnit=this._findSelectableUnit(this._userUnit,this.defaultUnit):this._findSelectableUnit(this.defaultUnit)},set:function(a){this._userUnit=
a?this._findSelectableUnit(a,this._userUnit):null;this.notifyChange("unit")},enumerable:!0,configurable:!0});g.prototype.newMeasurement=function(){m.ignoreAbortErrors(this.createTool())};g.prototype.clearMeasurement=function(){this.removeTool()};g.prototype.createToolParams=function(){return{toolConstructor:b,constructorArguments:{unit:this.unit}}};g.prototype.logUnsupportedError=function(){r.error("AreaMeasurement3D widget is not implemented for MapView")};g.prototype.logError=function(){for(var a=
[],b=0;b<arguments.length;b++)a[b]=arguments[b];r.error.apply(r,a)};g.prototype._findSelectableUnit=function(a,b){var c=this.unitOptions;return-1!==c.indexOf(a)?a:b?this._findSelectableUnit(b):c[0]};g.prototype._filteredOrAllUnits=function(a){if(!a)return n.measurementAreaUnits.slice();a=a.filter(function(a){return-1!==n.measurementAreaUnits.indexOf(a)});return 0===a.length?n.measurementAreaUnits.slice():a};a([q.property({dependsOn:["isDisabled","tool.state"],readOnly:!0})],g.prototype,"state",null);
a([q.property({dependsOn:"view.ready tool.area tool.geodesicArea tool.areaLabel tool.perimeterLength tool.geodesicPerimeterLength tool.model.perimeterLengthLabel tool.model.measurementMode tool.model.measurementData".split(" "),readOnly:!0})],g.prototype,"measurement",null);a([q.property({constructOnly:!0})],g.prototype,"tool",void 0);a([q.property(v.defaultUnitPropertyMetadata)],g.prototype,"defaultUnit",void 0);a([q.property({dependsOn:["view.spatialReference"]})],g.prototype,"unitOptions",null);
a([q.property({dependsOn:["unitOptions","defaultUnit"]})],g.prototype,"unit",null);a([q.property()],g.prototype,"clearMeasurement",null);return g=a([q.subclass("esri.widgets.AreaMeasurement3D.AreaMeasurement3DViewModel")],g)}(q.declared(g.InteractiveToolViewModel))})},"esri/views/3d/interactive/measurementTools/areaMeasurement3D/AreaMeasurement3DTool":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/restHelper ../../../../../core/Handles ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ./AreaMeasurement3DController ./AreaMeasurement3DModel ./AreaMeasurement3DView ../../../../interactive/InteractiveToolBase".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v){return function(g){function h(a){var b=g.call(this,a)||this;b._handles=new e;b.deferCreation=!0;b.model=new q({sceneView:a.view});return b}k(h,g);h.prototype.normalizeCtorArgs=function(a){return c(a,["view"])};h.prototype.initialize=function(){var a=this;this._view=new b(this.model,this.manipulators);this._controller=new f(this.model,this._view,this.manipulators);this._handles.add(m.init(this,"state",function(b){switch(b){case "measured":return a.complete();case "ready":break;
default:return a.create()}},!0))};h.prototype.destroy=function(){this.detach();this._view.destroy();this._view=null;this._controller.destroy();this._controller=null;this._handles.destroy();this._handles=null};Object.defineProperty(h.prototype,"state",{get:function(){return this.model.isMeasuring?"measured"===this.model.state?"measured":"measuring":"ready"},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isSupported",{get:function(){return"3d"===this.get("view.type")},enumerable:!0,
configurable:!0});Object.defineProperty(h.prototype,"cursor",{get:function(){return!this.model.active||"initial"!==this.model.state&&"drawing"!==this.model.state?null:"crosshair"},enumerable:!0,configurable:!0});h.prototype.activate=function(){this.model.active=!0};h.prototype.deactivate=function(){this.model.active=!1};h.prototype.onShow=function(){this._view.show()};h.prototype.onHide=function(){this._view.hide()};h.prototype.onDetach=function(){this.model.reset()};h.prototype.onInputEvent=function(a){this._controller.handleInputEvent(a)};
a([n.property({dependsOn:["model.isMeasuring","model.state"],readOnly:!0})],h.prototype,"state",null);a([n.property({dependsOn:["view.type"],readOnly:!0})],h.prototype,"isSupported",null);a([n.property({dependsOn:["model.active","state"],readOnly:!0})],h.prototype,"cursor",null);a([n.property({constructOnly:!0})],h.prototype,"model",void 0);a([n.aliasOf("model.sceneView")],h.prototype,"view",void 0);a([n.aliasOf("model.mode")],h.prototype,"mode",void 0);a([n.aliasOf("model.unit")],h.prototype,"unit",
void 0);a([n.aliasOf("model.areaLabel")],h.prototype,"areaLabel",void 0);a([n.aliasOf("model.area")],h.prototype,"area",void 0);a([n.aliasOf("model.geodesicArea")],h.prototype,"geodesicArea",void 0);a([n.aliasOf("model.pathLengthLabel")],h.prototype,"pathLengthLabel",void 0);a([n.aliasOf("model.pathLength")],h.prototype,"pathLength",void 0);a([n.aliasOf("model.geodesicPathLength")],h.prototype,"geodesicPathLength",void 0);a([n.aliasOf("model.perimeterLengthLabel")],h.prototype,"perimeterLengthLabel",
void 0);a([n.aliasOf("model.perimeterLength")],h.prototype,"perimeterLength",void 0);a([n.aliasOf("model.geodesicPerimeterLength")],h.prototype,"geodesicPerimeterLength",void 0);a([n.aliasOf("model.validMeasurement")],h.prototype,"validMeasurement",void 0);a([n.aliasOf("model.viewData")],h.prototype,"viewData",void 0);return h=a([n.subclass("esri.views.3d.interactive.measurementTools.areaMeasurement3D.AreaMeasurement3DTool")],h)}(n.declared(v.InteractiveToolBase))})},"esri/views/3d/interactive/measurementTools/areaMeasurement3D/AreaMeasurement3DController":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../geometry/Point ../../../../../layers/graphics/dehydratedFeatures ./AreaMeasurement3DView".split(" "),
function(t,h,k,a,c,e,m,n,f,q){return function(){function a(a,b,e){this._manipulators=e;this._handles=new c;this._tempPickRequest=new q.PickRequest;this.model=a;this.view=b;this.model.reset();this._setupManipulators()}a.prototype.destroy=function(){this._handles.destroy();this._handles=null};a.prototype.handleInputEvent=function(a){switch(a.type){case "immediate-click":this._handleImmediateClick(a);break;case "pointer-move":this._handlePointerMove(a);break;case "drag":this._handleDrag(a);break;case "key-down":this._handleKeyDown(a)}};
a.prototype._setupManipulators=function(){var a=this,b=0,c=function(c,g){a._handles.add(g.watch("dragging",function(f){f?(b++,a.model.lastDraggedVertex=e.expect(a.view.manipulatorIdToVertexId(c)),"measured"===a.model.state&&(a.model.state="editing")):(b--,0===b&&"editing"===a.model.state&&(a.model.state="measured"))},!0),"manipulator-"+c);g.events.on("drag",function(){var b=e.expect(a.view.manipulatorIdToVertexId(c));a.model.path.update(b,f.clonePoint(g.mapPoint,new n))});g.events.on("double-click",
function(b){if("mouse"!==b.pointerType||0===b.button)"drawing"===a.model.state&&a.model.finishMeasurement(),b.stopPropagation()})};this._manipulators.forEach(function(a){c(a.id,a.manipulator)});this._handles.add([this._manipulators.on("after-add",function(a){a=a.item;c(a.id,a.manipulator)}),this._manipulators.on("after-remove",function(b){a._handles.remove("manipulator-"+b.item.id)})])};a.prototype._handleDrag=function(a){"editing"===this.model.state&&a.stopPropagation()};a.prototype._handleImmediateClick=
function(a){if("mouse"!==a.pointerType||0===a.button){var b=m.createScreenPointFromEvent(a);if(this.model.active)switch(this.model.state){case "initial":this._addVertexAt(b)&&(this.model.state="drawing",a.stopPropagation());break;case "drawing":var c=this.view.vertexHandleAt(b,a.pointerType);if(e.isNone(c)){if(this._addVertexAt(b))return}else 0===c&&(this.model.finishMeasurement(),a.stopPropagation())}"mouse"===a.pointerType&&this._hoverAt(b)}};a.prototype._handlePointerMove=function(a){"mouse"===
a.pointerType&&(a=m.createScreenPointFromEvent(a),this._hoverAt(a))};a.prototype._handleKeyDown=function(a){"Enter"===a.key&&"drawing"===this.model.state&&(this.model.finishMeasurement(),a.stopPropagation())};a.prototype._hoverAt=function(a){this.view.requiresCursorPoint?(a=this._pick(a),a.mapPoint&&(this.model.cursorPoint=a.mapPoint)):this.model.cursorPoint=null};a.prototype._addVertexAt=function(a){a=this._pick(a);return a.mapPoint?(this.model.path.add(a.mapPoint),!0):!1};a.prototype._pick=function(a){var b=
this._tempPickRequest;b.screenPoint=a;return this.view.pick(b)};return a}()})},"esri/views/3d/interactive/measurementTools/areaMeasurement3D/AreaMeasurement3DView":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../manipulatorUtils ../support/Label ../support/LabelSegment ../support/labelUtils ../support/PathSegmentInterpolator ../support/viewUtils ../../../support/LaserLineRenderer ../../../support/projectionUtils ../../../support/stack ../../../webgl-engine/lib/Geometry ../../../webgl-engine/lib/GeometryData ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/lib/Intersector ../../../webgl-engine/lib/Layer ../../../webgl-engine/lib/Object3D ../../../webgl-engine/materials/CheckerBoardMaterial ../../../webgl-engine/materials/lineStippleUtils ../../../webgl-engine/materials/RibbonLineMaterial ../../../../interactive/ManipulatorCollection".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g,r,z,w,y,d,u,p,A,l,x,C,F,G,L,M,D,N){var K={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:1,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,handleRadiusHovered:10,handleRadiusMouse:10,handleRadiusTouch:25,pathLineColor:[1,.5,0,1],pathLineWidth:3,intersectingLineColor:[1,.2,0,1],perimeterLineColor:[1,.5,0,1],perimeterLineWidth:2,projectionLineColor:[1,
.5,0,1],projectionLineWidth:2,projectionLineStippleSize:5,areaColor1:[1,.5,0,.5],areaColor2:[1,1,1,.5],fillColor:[1,.5,0,.5],lineSubdivisions:64,labelDistance:25};t=function(){function a(a,c,d){void 0===c&&(c=new N.ManipulatorCollection);void 0===d&&(d={});this._model=a;this._manipulators=c;this.vertexManipulators=[];this._visible=!1;this._cursorManipulator=this._laserLineRenderer=null;this._pathSegmentObjects=[];this._perimeterSegmentObjects=[];this._projectionLineObjects=[];this._areaLabel=new g(16);
this._pathLengthLabel=new g(12);this._cursorSegmentLengthLabel=new g(12);this._perimeterLengthLabel=new g(12);this._pathLabelSegments=[];this._perimeterLabelSegments=[];this._cursorSegmentLengthLabelSegment=new r;this._listenerHandles=null;this._origin=b.vec3f64.create();this._originTransform=f.mat4f64.create();this._tempStartPosition=b.vec3f64.create();this._tempEndPosition=b.vec3f64.create();this._tempHandlePosition=b.vec3f64.create();this._sceneView=this._model.sceneView;this._params=y.copyParameter(K,
d);this._layer=new F("path-measurement-tool",{isPickable:!1});this._createMaterials();this._createObjects();this._intersector=new C.Intersector(this._sceneView.viewingMode);this._intersector.options.store=0;a=v.createSphereManipulator(this._sceneView,this._params.handleColor,this._params.handleOpacity);a.visible=!1;a.radius=this._params.handleRadius;a.interactive=!1;this._manipulators.add(a);this._cursorManipulator=a}a.prototype.destroy=function(){this.hide()};Object.defineProperty(a.prototype,"requiresCursorPoint",
{get:function(){return("initial"===this._model.state||"drawing"===this._model.state)&&this._model.active},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"visible",{get:function(){return this._visible},set:function(a){a?this.show():this.hide()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"testData",{get:function(){return{labels:{area:this._areaLabel,pathLength:this._pathLengthLabel,cursorSegmentLength:this._cursorSegmentLengthLabel,perimeterLength:this._perimeterLengthLabel},
laserLineRenderer:this._laserLineRenderer}},enumerable:!0,configurable:!0});a.prototype.show=function(){if(!this._visible){this._visible=!0;var a=this._sceneView._stage;this._laserLineRenderer=new d.LaserLineRenderer(this._sceneView.renderCoordsHelper,{glowColor:this._params.laserLineGlowColor,glowWidth:this._params.laserLineGlowWidth,glowFalloff:this._params.laserLineGlowFalloff,innerColor:this._params.laserLineInnerColor,innerWidth:this._params.laserLineInnerWidth,globalAlpha:this._params.laserLineGlobalAlpha});
a.addRenderPlugin(this._laserLineRenderer.renderSlots,this._laserLineRenderer);this._addToStage(a);this._areaLabel.addToView(this._sceneView);this._pathLengthLabel.addToView(this._sceneView);this._cursorSegmentLengthLabel.addToView(this._sceneView);this._perimeterLengthLabel.addToView(this._sceneView);this._initializeListeners();this._updateAll(this._model.viewData)}};a.prototype.hide=function(){if(this._visible){this._visible=!1;var a=this._sceneView._stage;a.removeRenderPlugin(this._laserLineRenderer);
this._laserLineRenderer=null;this._destroyListeners();this._updatePathLength(0);this._removeFromStage(a);this._areaLabel.removeFromView(this._sceneView);this._pathLengthLabel.removeFromView(this._sceneView);this._cursorSegmentLengthLabel.removeFromView(this._sceneView);this._perimeterLengthLabel.removeFromView(this._sceneView);this._sceneView.cursor=null}};a.prototype.vertexHandleAt=function(a,b){a=this._manipulators.intersect(a,b);return e.isSome(a)?this.manipulatorIdToVertexId(a):null};a.prototype.manipulatorIdToVertexId=
function(a){for(var b=0;b<this.vertexManipulators.length;b++)if(a===this.vertexManipulators[b].id)return b;return null};a.prototype.pick=function(c){var d=this._sceneView.spatialReference;c=m.screenPointObjectToArray(c.screenPoint);this._sceneView.sceneIntersectionHelper.intersectToolIntersectorScreen(c,this._intersector);c=this._intersector.results.min;var e=b.vec3f64.create();if(!c.getIntersectionPoint(e))return new a.PickResult;d=this._sceneView.renderCoordsHelper.fromRenderCoords(e,d);return new a.PickResult("TerrainRenderer"===
c.intersector?"surface":"feature",e,d)};a.prototype.overlappingHandles=function(a,b){return y.pointToPointScreenDistance(a,b,this._sceneView)<=this._params.handleRadius};a.prototype._createMaterials=function(){this._pathLineMaterial=new D({width:this._params.pathLineWidth,color:this._params.pathLineColor,polygonOffset:!0},"path-line");this._pathLineMaterial.renderOccluded=4;this._intersectingPathLineMaterial=new D({width:this._params.pathLineWidth,color:this._params.intersectingLineColor,polygonOffset:!0},
"intersecting-path-line");this._intersectingPathLineMaterial.renderOccluded=4;this._perimeterLineMaterial=new D({width:this._params.perimeterLineWidth,color:this._params.perimeterLineColor,polygonOffset:!0},"perimeter-line");this._perimeterLineMaterial.renderOccluded=4;this._intersectingPerimeterLineMaterial=new D({width:this._params.perimeterLineWidth,color:this._params.intersectingLineColor,polygonOffset:!0},"intersecting-perimeter-line");this._intersectingPerimeterLineMaterial.renderOccluded=4;
this._projectionLineMaterial=new D({width:this._params.projectionLineWidth,color:this._params.projectionLineColor,polygonOffset:!0,stipplePattern:M.createStipplePatternSimple(this._params.projectionLineStippleSize),stippleIntegerRepeats:!1},"projection-line");this._projectionLineMaterial.renderOccluded=4;this._checkerBoardMaterial=new L({color1:this._params.areaColor1,color2:this._params.areaColor2,transparent:!0,writeDepth:!1,polygonOffset:!0},"checker-board");this._checkerBoardMaterial.renderOccluded=
4};a.prototype._createObjects=function(){this._cursorSegmentObject=new G;this._areaObject=new G};a.prototype._addToStage=function(a){a.add(0,this._layer);a.add(3,this._pathLineMaterial);a.add(3,this._intersectingPathLineMaterial);a.add(3,this._perimeterLineMaterial);a.add(3,this._intersectingPerimeterLineMaterial);a.add(3,this._projectionLineMaterial);a.add(3,this._checkerBoardMaterial);a.addToViewContent([this._layer.id])};a.prototype._removeFromStage=function(a){a.removeFromViewContent([this._layer.id]);
a.remove(0,this._layer.id);a.remove(3,this._pathLineMaterial.id);a.remove(3,this._intersectingPathLineMaterial.id);a.remove(3,this._perimeterLineMaterial.id);a.remove(3,this._intersectingPerimeterLineMaterial.id);a.remove(3,this._projectionLineMaterial.id);a.remove(3,this._checkerBoardMaterial.id)};a.prototype._syncViewData=function(a){var b=this;if(!this._visible)return"none";var c=a.pathChanges;"full"===c.change?this._updateAll(a):"incremental"===c.change&&(c.updatedVertices.forEach(function(c){var d=
(c-1+b._model.path.length)%b._model.path.length;b._updatePathSegment(a,c);b._updatePathSegment(a,d);b._updateVertexHandle(a,c);b._updateArea(a);b._updatePerimeterSegments(a);b._updateProjectionLines(a);b._updateLaserLine();b._updateLabels(a)}),c.updatedVertices.has(this._model.path.length-1)&&this._updateCursorSegment());var d=c.change;c.clear();return d};a.prototype._updateAfterSyncViewData=function(a){var b=this._model.viewData;"full"!==this._syncViewData(b)&&a&&a(b)};a.prototype._updateOrigin=
function(a){y.midpoint(a.positionsRenderCoords,this._origin);n.mat4.identity(this._originTransform);n.mat4.translate(this._originTransform,this._originTransform,this._origin)};a.prototype._updateAll=function(a){this._updateOrigin(a);this._updatePathLength(a.path.length);this._updatePathSegments(a);this._updatePerimeterSegments(a);this._updateHandles(a);this._updateArea(a);this._updateProjectionLines(a);this._updateLabels(a);this._updateLaserLine()};a.prototype._updateCameraDependent=function(a){this._updateHandles(a);
this._updateProjectionLines(a);this._updateLabels(a)};a.prototype._updatePathLength=function(a){this._resizeObject3DArray(this._pathSegmentObjects,a);this._resizeObject3DArray(this._perimeterSegmentObjects,a);this._resizeManipulatorArray(this.vertexManipulators,a);y.resizeArray(this._pathLabelSegments,a,function(){return new r});y.resizeArray(this._perimeterLabelSegments,a,function(){return new r})};a.prototype._updatePathSegments=function(a){for(var b=0;b<this._pathSegmentObjects.length;++b)this._updatePathSegment(a,
b);this._updateCursorSegment()};a.prototype._updatePathSegment=function(a,b){var c=a.path,d=this._pathSegmentObjects[b];a.validMeasurement||b<c.length-1?(this._createInterpolatedLineGeometry(d,a.intersectingSegments.has(b)?this._intersectingPathLineMaterial:this._pathLineMaterial,"path-segment",a.positionsRenderCoords[b],a.positionsRenderCoords[(b+1)%c.length],this._origin,this._originTransform,this._model.measurementMode,this._pathLabelSegments[b],a.validMeasurement?"center":"end"),this._addObject3D(d)):
(d.removeAllGeometries(),this._removeObject3D(d))};a.prototype._updateCursorSegment=function(){var a=this._sceneView.renderCoordsHelper,b=this._model.path,c=this._cursorSegmentObject;0<b.length&&"drawing"===this._model.state&&this._model.cursorPoint?(a.toRenderCoords(b.back,this._tempStartPosition),a.toRenderCoords(this._model.cursorPoint,this._tempEndPosition),this._createInterpolatedLineGeometry(c,this._pathLineMaterial,"path-segment",this._tempStartPosition,this._tempEndPosition,this._origin,this._originTransform,
this._model.measurementMode,this._cursorSegmentLengthLabelSegment,"end"),this._addObject3D(c)):(c.removeAllGeometries(),this._removeObject3D(c))};a.prototype._updatePerimeterSegments=function(a){for(var b=0;b<this._perimeterSegmentObjects.length;++b)this._updatePerimeterSegment(a,b)};a.prototype._updatePerimeterSegment=function(a,b){var c=a.path,d=this._perimeterSegmentObjects[b];a.validMeasurement&&"geodesic"!==this._model.measurementMode?(this._updatePerimeterSegmentObject(d,a.positionsFittedRenderCoords[b],
a.positionsFittedRenderCoords[(b+1)%c.length],this._origin,this._originTransform,a.intersectingSegments.has(b),this._perimeterLabelSegments[b]),this._addObject3D(d)):(d.removeAllGeometries(),this._removeObject3D(d))};a.prototype._updatePerimeterSegmentObject=function(a,b,c,d,e,f,g){this._createInterpolatedLineGeometry(a,f?this._intersectingPerimeterLineMaterial:this._perimeterLineMaterial,"perimeter-segment",b,c,d,e,this._model.measurementMode,g)};a.prototype._updateHandles=function(a){for(var b=
0;b<this.vertexManipulators.length;++b)this._updateVertexHandle(a,b);this._updateCursorHandle()};a.prototype._updateVertexHandle=function(a,b){this.vertexManipulators[b].manipulator.position=a.positionsRenderCoords[b]};a.prototype._updateCursorHandle=function(){var a=this._cursorManipulator;"drawing"===this._model.state&&this._model.cursorPoint?(a.visible=!0,a.mapPoint=this._model.cursorPoint):a.visible=!1};a.prototype._updateArea=function(a){switch(this._model.measurementMode){case "euclidean":this._updateAreaEuclidean(a);
break;case "geodesic":this._updateAreaGeodesic()}};a.prototype._updateAreaEuclidean=function(a){var c=this,d=this._areaObject;if(a.validMeasurement&&0===a.intersectingSegments.size&&a.triangleIndices){var e=[],f=b.vec3f64.create();a.positionsFittedRenderCoords.forEach(function(a){q.vec3.subtract(f,a,c._origin);e.push(f[0],f[1],f[2])});var g=[];a.positionsProjected.forEach(function(a){g.push(a[0],a[1])});var p=new l.GeometryData({position:{size:3,data:e},uv0:{size:2,data:g}},{position:a.triangleIndices,
uv0:a.triangleIndices}),p=new A(p,"area");d.removeAllGeometries();d.addGeometry(p,this._checkerBoardMaterial,this._originTransform);this._addObject3D(d);this._checkerBoardMaterial.setParameterValues({size:[a.checkerSize,a.checkerSize]})}else d.removeAllGeometries(),this._removeObject3D(d)};a.prototype._updateAreaGeodesic=function(){var a=this._areaObject;a.removeAllGeometries();this._removeObject3D(a)};a.prototype._updateProjectionLines=function(a){var b=a.path;this._resizeObject3DArray(this._projectionLineObjects,
b.length);for(var c=0;c<b.length;++c)this._updateProjectionLine(a,c)};a.prototype._updateProjectionLine=function(a,c){var d=this._projectionLineObjects[c];d.removeAllGeometries();if(a.validMeasurement&&"euclidean"===this._model.measurementMode){a=b.vec3f64.create();q.vec3.subtract(a,this._model.viewData.positionsRenderCoords[c],this._origin);var e=b.vec3f64.create();q.vec3.subtract(e,this._model.viewData.positionsFittedRenderCoords[c],this._origin);c=new A(x.createPolylineGeometry([a,e]),"projected-line");
d.addGeometry(c,this._projectionLineMaterial,this._originTransform);this._addObject3D(d)}else this._removeObject3D(d)};a.prototype._updateLabels=function(a){var b=this,c=this._sceneView._stage.getCamera(),d=this._params.labelDistance,e=this._model,f="geodesic"===e.measurementMode,g="drawing"===e.state,p=function(a,c){return a.visible&&c.visible&&b._sceneView.overlay.overlaps(a.textItem,c.textItem)},l=this._areaLabel,h=z.positionLabelOnPoint(l,a.areaCentroid,c);l.text=e.areaLabel;l.visible=h&&a.validMeasurement&&
0===a.intersectingSegments.size&&null!=e.areaLabel;l=this._pathLengthLabel;h=z.positionLabelOnCorner(l,this._pathLabelSegments[a.pathLengthLabelSegmentIndex],this._cursorSegmentLengthLabelSegment,d,c);l.text=e.pathLengthLabel;l.visible=h&&g&&0<e.path.length;l=this._cursorSegmentLengthLabel;h=this._cursorSegmentLengthLabelSegment;h=z.positionLabelOnSegment(l,h,d,"bottom",c);l.text=e.cursorSegmentLengthLabel;l.visible=h&&g&&e.cursorSegmentLength&&0!==e.cursorSegmentLength.value;p(this._cursorSegmentLengthLabel,
this._pathLengthLabel)&&(this._cursorSegmentLengthLabel.visible=!1);p(this._pathLengthLabel,this._areaLabel)&&(this._pathLengthLabel.visible=!1);l=this._perimeterLengthLabel;if(e.validMeasurement&&0===a.intersectingSegments.size)for(g=0;g<a.path.length;++g)if(h=(a.perimeterLengthLabelSegmentIndex+g)%a.path.length,h=f?this._pathLabelSegments[h]:this._perimeterLabelSegments[h],h=z.positionLabelOnSegment(l,h,d,"top",c),l.text=e.perimeterLengthLabel,l.visible=h,p(l,this._areaLabel))l.visible=!1;else break;
else l.visible=!1};a.prototype._getFocusPoint=function(){var a=this._model,b=this._model.lastDraggedVertex;switch(a.state){case "drawing":return a.cursorPoint?a.cursorPoint:a.path.vertex(e.isSome(b)?b:a.path.length-1);case "editing":return e.isSome(b)?a.path.vertex(b):null;default:return a.cursorPoint}};a.prototype._updateLaserLine=function(){var a=this._model,b=this._params.laserLineEnabled&&"measured"!==a.state&&a.active;this._laserLineRenderer.pointDistanceEnabled=!1;this._laserLineRenderer.lineVerticalPlaneEnabled=
!1;a=this._getFocusPoint();b&&a?(b=this._tempHandlePosition,this._sceneView.renderCoordsHelper.toRenderCoords(a,b),this._laserLineRenderer.heightPlanePosition=b,this._laserLineRenderer.heightPlaneEnabled=!0):this._laserLineRenderer.heightPlaneEnabled=!1};a.prototype._addObject3D=function(a){a.parentLayer||(this._layer.addObject(a),this._sceneView._stage.add(1,a))};a.prototype._removeObject3D=function(a){a.parentLayer&&(this._layer.removeObject(a),this._sceneView._stage.remove(1,a.id))};a.prototype._resizeObject3DArray=
function(a,b){var c=this;y.resizeArray(a,b,function(){return new G},function(a){c._removeObject3D(a)})};a.prototype._resizeManipulatorArray=function(a,b){var c=this;y.resizeArray(a,b,function(){var a=v.createSphereManipulator(c._sceneView,c._params.handleColor,c._params.handleOpacity);a.hideOnGrab=!0;a.radius=c._params.handleRadius;return{id:c._manipulators.add(a),manipulator:a}},function(a){c._manipulators.remove(a.manipulator)})};a.prototype._createInterpolatedLineGeometry=function(a,b,c,d,e,f,
g,l,h,k){var n=this._sceneView.renderCoordsHelper,m=[],u=[],r=function(a,b){var c=p.sv3d.get();q.vec3.subtract(c,a,f);m.push(c);u.push(b)};if("euclidean"===l){var v=p.sv3d.get();y.midpoint([d,e],v);l=p.sv3d.get();n.worldUpAtPosition(v,l);r(d,l);r(e,l);h&&h.update(d,e,k)}else{d=this._getSegmentInterpolator(d,e);e=this._params.lineSubdivisions+1&-2;var t=v=null,w=e/2-1,z=e/2;"start"===k?(w=0,z=1):"end"===k&&(w=e-2,z=e-1);for(var C=0;C<e;++C){var B=C/(e-1),F=p.sv3d.get();l=p.sv3d.get();d.eval(B,F);n.worldUpAtPosition(F,
l);C===w&&(v=F);C===z&&(t=F);r(F,l)}h&&h.update(v,t,k)}c=new A(x.createPolylineGeometry(m,u),c);a.removeAllGeometries();a.addGeometry(c,b,g)};a.prototype._getSegmentInterpolator=function(a,b){if(u.canProject(this._sceneView.spatialReference,u.SphericalECEFSpatialReference)){var c=this._sceneView.renderCoordsHelper.spatialReference;return new w.Spherical(a,b,c,c)}return new w.Linear(a,b)};a.prototype._initializeListeners=function(){var a=this;this._listenerHandles=new c;this._listenerHandles.add([this._model.watch(["state",
"lastDraggedVertex"],function(){return a._updateLaserLine()}),this._model.watch("cursorPoint",function(){return a._updateAfterSyncViewData(function(b){a._updateCursorSegment();a._updateCursorHandle();"drawing"===a._model.state&&a._updateLabels(b);a._updateLaserLine()})}),this._sceneView.state.watch("camera",function(){return a._updateAfterSyncViewData(function(){return a._updateCameraDependent(a._model.viewData)})}),this._model.watch(["unit","measurementMode"],function(){return a._updateAll(a._model.viewData)}),
this._model.watch(["active"],function(){a._updateLaserLine();a._syncViewData(a._model.viewData)}),this._model.watch("viewData",function(b){return a._syncViewData(b)})])};a.prototype._destroyListeners=function(){this._listenerHandles.destroy();this._listenerHandles=null};a._handleGeometry=new A(x.createSphereGeometry(1,32,32),"handle");return a}();(function(a){var b=function(){return function(){}}();a.PickRequest=b;b=function(){return function(a,b,c){void 0===a&&(a=null);void 0===b&&(b=null);void 0===
c&&(c=null);this.type=a;this.scenePoint=b;this.mapPoint=c}}();a.PickResult=b})(t||(t={}));return t})},"esri/views/3d/webgl-engine/materials/CheckerBoardMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../lib/GLMaterial ../lib/Material ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/CheckerBoardTechnique".split(" "),function(t,h,k,a,c,e,m,n,f,q){t=function(a){function c(b,c){c=a.call(this,c)||
this;c.techniqueConfig=new q.CheckerBoardTechniqueConfiguration;c.params=m.copyParameters(b,v);return c}k(c,a);c.prototype.dispose=function(){};c.prototype.getPassParameters=function(){return this.params};c.prototype.getTechniqueConfig=function(){this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.polygonOffset=this.params.polygonOffset;return this.techniqueConfig};c.prototype.setParameterValues=function(a){m.updateParameters(this.params,
a)&&this.parametersChanged()};c.prototype.intersect=function(a,b,c,d,e,f,g){return n.intersectTriangleGeometry(a,b,d,e,f,void 0,g)};c.prototype.getGLMaterial=function(a){return 0===a.output?new b(a):void 0};c.prototype.createBufferWriter=function(){return new e.DefaultBufferWriter(e.PositionUVLayout)};c.prototype.createRenderer=function(a,b){return new f(a,b,this)};return c}(c.Material);var b=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}k(b,a);b.prototype.updateParameters=
function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(q.CheckerBoardTechnique,this.material.getTechniqueConfig(),this.technique)};b.prototype.beginSlot=function(a){var b=3;this.technique.configuration.transparent&&(b=this.technique.configuration.writeDepth?5:8);return a===b};b.prototype.bind=function(a){a.bindProgram(this.technique.program);this.technique.bindPass(a,this.material.getPassParameters())};return b}(a.GLMaterial),v={size:[1,1],color1:[.75,.75,.75,1],color2:[.5,.5,.5,1],
transparent:!1,writeDepth:!0,polygonOffset:!1};return t})},"esri/views/3d/webgl-engine/shaders/CheckerBoardTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderLibrary/Transform.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./CheckerBoard.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g,r){Object.defineProperty(h,"__esModule",{value:!0});c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}k(c,a);c.prototype.initializeProgram=function(a){var b=c.shader.get().build();return new v(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),q.Default3D)};c.prototype.bindPass=function(a,b){this.program.setUniform2fv("size",b.size);this.program.setUniform4fv("color1",b.color1);this.program.setUniform4fv("color2",b.color2)};c.prototype.bindDraw=
function(a){e.Transform.bindUniforms(this.program,a)};c.prototype.bindInstance=function(a){this.program.setUniformMatrix4fv("model",a.transformation)};c.prototype.initializePipeline=function(){var a=this.configuration;return r.makePipelineState({blending:a.transparent&&g.separateBlendingParams(770,1,771,771),polygonOffset:a.polygonOffset&&{factor:0,units:-25},depthTest:{func:513},depthWrite:a.writeDepth&&r.defaultDepthWriteParams,colorWrite:r.defaultColorWriteParams})};c.shader=new m.ReloadableShaderModule(b,
"./CheckerBoard.glsl",t);return c}(n.ShaderTechnique);h.CheckerBoardTechnique=c;c=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.transparent=!1;a.writeDepth=!0;a.polygonOffset=!1;return a}k(c,b);a([f.parameter()],c.prototype,"transparent",void 0);a([f.parameter()],c.prototype,"writeDepth",void 0);a([f.parameter()],c.prototype,"polygonOffset",void 0);return c}(f.ShaderTechniqueConfiguration);h.CheckerBoardTechniqueConfiguration=c})},"esri/views/3d/webgl-engine/shaders/CheckerBoard.glsl":function(){define(["require",
"exports","../../../../core/tsSupport/makeTemplateObjectHelper","../core/shaderModules/interfaces","../core/shaderModules/ShaderBuilder"],function(t,h,k,a,c){Object.defineProperty(h,"__esModule",{value:!0});h.build=function(){var h=new c.ShaderBuilder;h.extensions.add("GL_OES_standard_derivatives");h.attributes.add("position","vec3");h.attributes.add("uv0","vec2");h.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4");h.varyings.add("vUV","vec2");h.vertex.code.add(a.glsl(e||(e=
k(["\n    void main(void) {\n      vUV \x3d uv0;\n      gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n    }\n  "],["\n    void main(void) {\n      vUV \x3d uv0;\n      gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\n    }\n  "]))));h.fragment.uniforms.add("size","vec2").add("color1","vec4").add("color2","vec4");h.fragment.code.add(a.glsl(m||(m=k(["\n    void main() {\n      vec2 uvScaled \x3d vUV / (2.0 * size);\n\n      vec2 uv \x3d fract(uvScaled - 0.25);\n      vec2 ab \x3d clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\n      float fade \x3d smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\n      float t \x3d mix(abs(ab.x + ab.y), 0.5, fade);\n\n      gl_FragColor \x3d mix(color2, color1, t);\n    }\n  "],
["\n    void main() {\n      vec2 uvScaled \x3d vUV / (2.0 * size);\n\n      vec2 uv \x3d fract(uvScaled - 0.25);\n      vec2 ab \x3d clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\n      float fade \x3d smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\n      float t \x3d mix(abs(ab.x + ab.y), 0.5, fade);\n\n      gl_FragColor \x3d mix(color2, color1, t);\n    }\n  "]))));return h};var e,m})},"esri/views/3d/interactive/measurementTools/areaMeasurement3D/AreaMeasurement3DModel":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Accessor ../../../../../core/compilerUtils ../../../../../core/Handles ../../../../../core/mathUtils ../../../../../core/Quantity ../../../../../core/quantityUtils ../../../../../core/unitUtils ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ./MeasurementData ./PathChanges ../support/measurementUtils ../support/Path ../support/setUtils ../support/UnitNormalizer ../../../support/projectionUtils".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g,r,z,w,y,d,u,p){return function(c){function l(){var a=null!==c&&c.apply(this,arguments)||this;a._unitNormalizer=new u;a._measurementData=new r;a._measurementDataChanges=new z;a._viewDataChanges=new z;a._handles=new m;a.path=new y;a.pathVersion=0;a.cursorPoint=null;a.state="initial";a.lastDraggedVertex=null;a.mode="auto";a.unit="metric";a.active=!1;a.maxRelativeErrorCoplanar=.005;a.maxRelativeErrorAlmostCoplanar=.01;a.verticalAngleThreshold=80;a.geodesicMeasurementDistanceThreshold=
1E5;return a}k(l,c);l.prototype.initialize=function(){var a=this;this._handles.add(v.whenTrue(this.sceneView,"ready",function(){var b=a.sceneView.spatialReference;a._worldSpatialReference=!b||p.canProject(b,p.WGS84ECEFSpatialReference)?p.WGS84ECEFSpatialReference:b;a._unitNormalizer.spatialReference=b}),"scene-view");this.reset();var b=function(){a._set("pathVersion",a.pathVersion+1)};this._handles.add(this.path.on("cleared",function(){a._measurementDataChanges.fullChange();a._set("pathVersion",0)}));
this._handles.add(this.path.on("vertex-added",function(){a._measurementDataChanges.fullChange();b()}));this._handles.add(this.path.on("vertex-inserted",function(){a._measurementDataChanges.fullChange();b()}));this._handles.add(this.path.on("vertex-removed",function(){a._measurementDataChanges.fullChange();b()}));this._handles.add(this.path.on("vertex-updated",function(c){a._measurementDataChanges.incrementalChange(c.index);b()}))};l.prototype.destroy=function(){this._handles.destroy();this._handles=
null};Object.defineProperty(l.prototype,"validMeasurement",{get:function(){return 3<=this.path.length&&"measured"===this.state||"editing"===this.state},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"isMeasuring",{get:function(){return 1<=this.path.length},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"measurementData",{get:function(){this._viewDataChanges.merge(this._measurementDataChanges);var a=d.clone(this._measurementData.intersectingSegments),b=d.clone(this._measurementData.geodesicIntersectingSegments);
this._measurementData.update(this.path,this._measurementDataChanges,this.sceneView,this._unitNormalizer,this.validMeasurement,this.sceneView.renderSpatialReference,this._worldSpatialReference,{maxRelativeErrorCoplanar:this.maxRelativeErrorCoplanar,maxRelativeErrorAlmostCoplanar:this.maxRelativeErrorAlmostCoplanar,verticalAngleThreshold:this.verticalAngleThreshold});w.compareSets(this._measurementData.intersectingSegments,a)||this._viewDataChanges.fullChange();w.compareSets(this._measurementData.geodesicIntersectingSegments,
b)||this._viewDataChanges.fullChange();return this._measurementData},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"area",{get:function(){return this.measurementData.area},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"geodesicArea",{get:function(){return this.measurementData.geodesicArea},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"areaLabel",{get:function(){return this._formatAreaLabel("geodesic"===this.measurementMode?this.measurementData.geodesicArea:
this.measurementData.area,this.unit)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"pathLength",{get:function(){return this.measurementData.pathLength},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"geodesicPathLength",{get:function(){return this.measurementData.geodesicPathLength},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"pathLengthLabel",{get:function(){return this._formatLengthLabel("geodesic"===this.measurementMode?this.measurementData.geodesicPathLength:
this.measurementData.pathLength,this.unit)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"perimeterLength",{get:function(){return this.measurementData.perimeterLength},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"geodesicPerimeterLength",{get:function(){return this.measurementData.geodesicPathLength},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"perimeterLengthLabel",{get:function(){return this.measurementData.perimeterLength&&this._formatLengthLabel("geodesic"===
this.measurementMode?this.measurementData.geodesicPathLength:this.measurementData.perimeterLength,this.unit)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"cursorSegmentLength",{get:function(){return this.path.back&&this.cursorPoint&&new f(this._unitNormalizer.normalizeDistance(w.segmentLengthEuclidean(this.path.back,this.cursorPoint,this._worldSpatialReference)),"meters")},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"geodesicCursorSegmentLength",{get:function(){return this.path.back&&
this.cursorPoint&&new f(w.segmentLengthGeodesic(this.path.back,this.cursorPoint),"meters")},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"cursorSegmentLengthLabel",{get:function(){return this._formatLengthLabel("geodesic"===this.measurementMode?this.geodesicCursorSegmentLength:this.cursorSegmentLength,this.unit)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"viewData",{get:function(){var a=this.measurementData,c="geodesic"===this.measurementMode,d=c?this.geodesicArea:
this.area,e=1;d&&(d=this._toPreferredAreaUnit(d,this.unit),e=n.nextHighestPowerOfTen(Math.sqrt(d.value)/Math.sqrt(300)),e*=Math.sqrt(b.convertUnit(1,d.unit,"square-meters")),e/=this._unitNormalizer.normalizeDistance(1));return{validMeasurement:this.validMeasurement,path:this.path,pathChanges:this._viewDataChanges,positionsGeographic:a.positionsGeographic,positionsRenderCoords:a.positionsRenderCoords,positionsProjected:a.positionsProjectedWorldCoords,positionsFittedRenderCoords:a.positionsFittedRenderCoords,
intersectingSegments:c?a.geodesicIntersectingSegments:a.intersectingSegments,triangleIndices:c?a.geodesicTriangleIndices:a.triangleIndices,fittingMode:a.fittingMode,areaCentroid:c?a.geodesicAreaCentroidRenderCoords:a.areaCentroidRenderCoords,pathLengthLabelSegmentIndex:this.validMeasurement?0:this.path.length-2,perimeterLengthLabelSegmentIndex:0,checkerSize:e}},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"measurementMode",{get:function(){var a=this.mode;"auto"===a&&(a="euclidean",
(this.geodesicPathLength?this.geodesicPathLength.value:0)+(!this.validMeasurement&&this.geodesicCursorSegmentLength?this.geodesicCursorSegmentLength.value:0)>this.geodesicMeasurementDistanceThreshold&&(a="geodesic"));null==this.geodesicPathLength&&(a="euclidean");return a},enumerable:!0,configurable:!0});l.prototype.reset=function(){this.clearMeasurement()};l.prototype.clearMeasurement=function(){this.path.clear();this.state="initial";this.cursorPoint=null};l.prototype.finishMeasurement=function(){3>
this.path.length?this.clearMeasurement():(this._measurementDataChanges.fullChange(),this.state="measured")};l.prototype._preferredAreaUnit=function(a,c){switch(c){case "metric":return b.preferredMetricAreaUnit(a.value,a.unit);case "imperial":return b.preferredImperialAreaUnit(a.value,a.unit);default:return c}};l.prototype._preferredLengthUnit=function(a,c){c=this._deriveLengthUnitFromAreaUnit(c);switch(c){case "metric":return b.preferredMetricLengthUnit(a.value,a.unit);case "imperial":return b.preferredImperialLengthUnit(a.value,
a.unit);default:return c}};l.prototype._toPreferredAreaUnit=function(a,b){return a.toUnit(this._preferredAreaUnit(a,b))};l.prototype._toPreferredLengthUnit=function(a,b){return a.toUnit(this._preferredLengthUnit(a,b))};l.prototype._formatAreaLabel=function(a,b){return a&&q.formatDecimal(a,this._preferredAreaUnit(a,b))};l.prototype._formatLengthLabel=function(a,b){return a&&q.formatDecimal(a,this._preferredLengthUnit(a,b))};l.prototype._deriveLengthUnitFromAreaUnit=function(a){switch(a){case "metric":return"metric";
case "imperial":return"imperial";case "square-inches":return"inches";case "square-feet":return"feet";case "square-yards":return"yards";case "square-miles":return"miles";case "square-us-feet":return"us-feet";case "square-millimeters":return"millimeters";case "square-centimeters":return"centimeters";case "square-decimeters":return"decimeters";case "square-meters":return"meters";case "square-kilometers":return"kilometers";case "acres":return"imperial";case "ares":case "hectares":return"metric";default:e.neverReached(a)}throw Error("unhandled area unit");
};a([g.property({constructOnly:!0})],l.prototype,"sceneView",void 0);a([g.property({readOnly:!0})],l.prototype,"path",void 0);a([g.property({readOnly:!0})],l.prototype,"pathVersion",void 0);a([g.property()],l.prototype,"cursorPoint",void 0);a([g.property()],l.prototype,"state",void 0);a([g.property()],l.prototype,"lastDraggedVertex",void 0);a([g.property()],l.prototype,"mode",void 0);a([g.property()],l.prototype,"unit",void 0);a([g.property()],l.prototype,"active",void 0);a([g.property({readOnly:!0,
dependsOn:["path.length","state"]})],l.prototype,"validMeasurement",null);a([g.property({readOnly:!0,dependsOn:["path.length"]})],l.prototype,"isMeasuring",null);a([g.property({readOnly:!0,dependsOn:["pathVersion","validMeasurement","maxRelativeErrorCoplanar","maxRelativeErrorAlmostCoplanar","verticalAngleThreshold"]})],l.prototype,"measurementData",null);a([g.property({readOnly:!0,dependsOn:["measurementData"]})],l.prototype,"area",null);a([g.property({readOnly:!0,dependsOn:["measurementData"]})],
l.prototype,"geodesicArea",null);a([g.property({readOnly:!0,dependsOn:["measurementData","unit","measurementMode"]})],l.prototype,"areaLabel",null);a([g.property({readOnly:!0,dependsOn:["measurementData"]})],l.prototype,"pathLength",null);a([g.property({readOnly:!0,dependsOn:["measurementData"]})],l.prototype,"geodesicPathLength",null);a([g.property({readOnly:!0,dependsOn:["measurementData","unit","measurementMode"]})],l.prototype,"pathLengthLabel",null);a([g.property({readOnly:!0,dependsOn:["measurementData"]})],
l.prototype,"perimeterLength",null);a([g.property({readOnly:!0,dependsOn:["measurementData"]})],l.prototype,"geodesicPerimeterLength",null);a([g.property({readOnly:!0,dependsOn:["measurementData","unit","measurementMode"]})],l.prototype,"perimeterLengthLabel",null);a([g.property({readOnly:!0,dependsOn:["path.back","cursorPoint"]})],l.prototype,"cursorSegmentLength",null);a([g.property({readOnly:!0,dependsOn:["path.back","cursorPoint"]})],l.prototype,"geodesicCursorSegmentLength",null);a([g.property({readOnly:!0,
dependsOn:["unit","measurementMode","cursorSegmentLength","geodesicCursorSegmentLength"]})],l.prototype,"cursorSegmentLengthLabel",null);a([g.property({readOnly:!0,dependsOn:["unit","measurementMode","measurementData"]})],l.prototype,"viewData",null);a([g.property()],l.prototype,"maxRelativeErrorCoplanar",void 0);a([g.property()],l.prototype,"maxRelativeErrorAlmostCoplanar",void 0);a([g.property()],l.prototype,"verticalAngleThreshold",void 0);a([g.property()],l.prototype,"geodesicMeasurementDistanceThreshold",
void 0);a([g.property({readOnly:!0,dependsOn:["mode","validMeasurement","geodesicPathLength","geodesicCursorSegmentLength","geodesicMeasurementDistanceThreshold"]})],l.prototype,"measurementMode",null);return l=a([g.subclass("esri.views.3d.interactive.measurementTools.areaMeasurement3D.AreaMeasurement3DModel")],l)}(g.declared(c))})},"esri/views/3d/interactive/measurementTools/areaMeasurement3D/MeasurementData":function(){define("require exports ../../../../../core/mathUtils ../../../../../core/Quantity ../../../../../core/libs/earcut/earcut ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../../../geometry/SpatialReference ../../../../../geometry/support/intersects ../support/measurementUtils ../support/viewUtils ../../../support/earthUtils ../../../support/mathUtils ../../../support/projectionUtils".split(" "),
function(t,h,k,a,c,e,m,n,f,q,b,v,g,r,z,w,y){function d(a,b){for(var c=new Float64Array(a.length*b),d=0;d<a.length;++d)for(var e=a[d],f=0;f<b;++f)c[d*b+f]=e[f];return c}return function(){function h(){this.positionsWorldCoords=[];this.positionsRenderCoords=[];this.positionsProjectedWorldCoords=[];this.positionsFittedRenderCoords=[];this.positionsGeographic=[];this.positionsSpherical=[];this.positionsStereographic=[];this.pathSegmentLengths=[];this.geodesicPathSegmentLengths=[];this.perimeterSegmentLengths=
[];this.intersectingSegments=new Set;this.geodesicIntersectingSegments=new Set;this.areaCentroidWorldCoords=f.vec3f64.create();this.areaCentroidRenderCoords=f.vec3f64.create();this.geodesicAreaCentroidRenderCoords=f.vec3f64.create();this._length=0;this._centroidRenderCoords=f.vec3f64.create();this._planeWorldCoords=q.vec4f64.create();this._worldUp=f.vec3f64.create();this._worldTangent=f.vec3f64.create();this._frame=[f.vec3f64.create(),f.vec3f64.create(),f.vec3f64.create()];this._tempU=f.vec3f64.create();
this._tempV=f.vec3f64.create();this._tempVec3=f.vec3f64.create();this._tempSphere={center:f.vec3f64.create(),radius:0}}h.prototype.update=function(b,c,d,e,f,g,h,k){c.clear();this._resize(b.length);c=y.canProject(d.spatialReference,y.SphericalECEFSpatialReference)&&y.canProjectToWGS84ComparableLonLat(d.spatialReference);for(var l=this.positionsGeographic,p=this.positionsWorldCoords,q=this.positionsRenderCoords,m=this.positionsSpherical,u=0;u<b.length;++u){var r=b.vertex(u);y.pointToVector(r,p[u],h);
y.pointToVector(r,q[u],g);c&&(y.pointToWGS84ComparableLonLat(r,l[u]),y.pointToVector(r,m[u],y.SphericalECEFSpatialReference),n.vec3.normalize(m[u],m[u]))}b=this._updatePathLengths(f);this.pathLength=0<this._length?new a(e.normalizeDistance(b),"meters"):null;c?(b=this._updateGeodesicPathLengths(f),this.geodesicPathLength=0<this._length?new a(b,"meters"):null):this.geodesicPathLength=null;f?(this._updateArea(d,e,g,h,k),c&&this._updateGeodesicArea(d)):(this.geodesicTriangleIndices=this.triangleIndices=
this.perimeterLength=this.geodesicArea=this.area=null,this.intersectingSegments.clear(),this.geodesicIntersectingSegments.clear())};h.prototype._resize=function(a){a<this._length&&(this.positionsWorldCoords.length=a,this.positionsRenderCoords.length=a,this.positionsProjectedWorldCoords.length=a,this.positionsFittedRenderCoords.length=a,this.positionsGeographic.length=a,this.positionsSpherical.length=a,this.positionsStereographic.length=a,this.pathSegmentLengths.length=a,this.geodesicPathSegmentLengths.length=
a,this._length=this.perimeterSegmentLengths.length=a);for(;this._length<a;)this.positionsWorldCoords.push(f.vec3f64.create()),this.positionsRenderCoords.push(f.vec3f64.create()),this.positionsProjectedWorldCoords.push(m.vec2f64.create()),this.positionsFittedRenderCoords.push(f.vec3f64.create()),this.positionsGeographic.push(f.vec3f64.create()),this.positionsSpherical.push(f.vec3f64.create()),this.positionsStereographic.push(m.vec2f64.create()),this.pathSegmentLengths.push(0),this.geodesicPathSegmentLengths.push(0),
this.perimeterSegmentLengths.push(0),++this._length};h.prototype._updatePathLengths=function(a){for(var b=this.positionsWorldCoords,c=this.pathSegmentLengths,d=0,e=0;e<this._length;++e){var f=c[e]=n.vec3.distance(b[e],b[(e+1)%this._length]);if(e<this._length-1||a)d+=f}return d};h.prototype._updateGeodesicPathLengths=function(a){for(var b=this.positionsGeographic,c=this.geodesicPathSegmentLengths,d=0,e=0;e<this._length;++e){var f=c[e]=g.segmentLengthGeodesicVector(b[e],b[(e+1)%this._length]);if(e<
this._length-1||a)d+=f}return d};h.prototype._updateArea=function(b,c,d,f,h){var l=b.renderCoordsHelper;b=this.positionsWorldCoords;var k=this.positionsRenderCoords,p=this.positionsProjectedWorldCoords,q=this.positionsFittedRenderCoords,m=this._planeWorldCoords,u=this._centroidRenderCoords;r.midpoint(k,u);l.worldUpAtPosition(u,this._worldUp);l.worldBasisAtPosition(u,0,this._worldTangent);y.transformDirection(u,this._worldUp,d,this._worldUp,f);y.transformDirection(u,this._worldTangent,d,this._worldTangent,
f);g.bestFitPlane(b,m);this.fittingMode=this._selectFittingMode(m,b,this._worldUp,h);var v=0;if("horizontal"===this.fittingMode){var t=-Infinity;k.forEach(function(a,b){a=l.getAltitude(k[b]);a>t&&(t=a,v=b)})}h=b[v];var u=m,x=this._worldTangent;"horizontal"===this.fittingMode?u=this._worldUp:"vertical"===this.fittingMode&&(u=this._tempVec3,x=this._worldUp,w.makeOrthonormal(m,this._worldUp,u));n.vec3.copy(this._frame[2],u);w.makeOrthonormal(x,u,this._frame[0]);n.vec3.cross(this._frame[1],this._frame[0],
this._frame[2]);n.vec3.negate(this._frame[1],this._frame[1]);for(var m=this._tempVec3,u=this._tempU,x=this._tempV,z=0;z<this._length;++z){var A=p[z],C=q[z];n.vec3.subtract(m,b[z],h);e.vec2.set(A,n.vec3.dot(this._frame[0],m),n.vec3.dot(this._frame[1],m));n.vec3.scale(u,this._frame[0],A[0]);n.vec3.scale(x,this._frame[1],A[1]);n.vec3.add(m,u,x);n.vec3.add(m,m,h);y.vectorToVector(m,f,C,d)}this.perimeterLength=0<this._length?new a(c.normalizeDistance(this._updatePerimeterLengths()),"meters"):null;r.midpoint(q,
this.areaCentroidRenderCoords);y.vectorToVector(this.areaCentroidRenderCoords,d,this.areaCentroidWorldCoords,f);this._updateIntersectingSegments();this.area=0===this.intersectingSegments.size?new a(c.normalizeArea(this._computeArea()),"square-meters"):null};h.prototype._updateGeodesicArea=function(b){b=b.renderCoordsHelper;var c=this.positionsSpherical,d=this.positionsStereographic,f=this._tempVec3,h=g.fitHemisphere(c,f);if(h){var k=this._tempU,p=this._tempV;w.tangentFrame(f,k,p);for(var q=0;q<this._length;++q){var m=
n.vec3.dot(c[q],k),u=n.vec3.dot(c[q],p),r=n.vec3.dot(c[q],f);e.vec2.set(d[q],m/r,u/r)}n.vec3.scale(f,f,z.earthRadius);b.toRenderCoords(f,y.SphericalECEFSpatialReference,this.geodesicAreaCentroidRenderCoords);this._updateGeodesicIntersectingSegments();this.geodesicArea=h&&0===this.geodesicIntersectingSegments.size?new a(this._computeGeodesicArea(),"square-meters"):null}else this.geodesicArea=null};h.prototype._updatePerimeterLengths=function(){for(var a=this.positionsProjectedWorldCoords,b=this.perimeterSegmentLengths,
c=0,d=0;d<this._length;++d)var f=b[d]=e.vec2.distance(a[d],a[(d+1)%this._length]),c=c+f;return c};h.prototype._updateIntersectingSegments=function(){var a=this.positionsProjectedWorldCoords,b=this.intersectingSegments;b.clear();for(var c=0;c<this._length;++c)for(var d=c+2;d<this._length;++d)(d+1)%this._length!==c&&v.segmentIntersects(a[c],a[(c+1)%this._length],a[d],a[(d+1)%this._length])&&(b.add(c),b.add(d))};h.prototype._computeArea=function(){for(var a=this.positionsProjectedWorldCoords,b=d(a,2),
b=this.triangleIndices=new Uint32Array(c.earcut(b,[],2)),e=0,f=0;f<b.length;f+=3)e+=g.triangleAreaEuclidean(a[b[f]],a[b[f+1]],a[b[f+2]]);return e};h.prototype._updateGeodesicIntersectingSegments=function(){var a=this.positionsStereographic,b=this.geodesicIntersectingSegments;b.clear();for(var c=0;c<this._length;++c)for(var d=c+2;d<this._length;++d)(d+1)%this._length!==c&&v.segmentIntersects(a[c],a[(c+1)%this._length],a[d],a[(d+1)%this._length])&&(b.add(c),b.add(d))};h.prototype._computeGeodesicArea=
function(){for(var a=this.positionsGeographic,e=d(this.positionsStereographic,2),e=this.geodesicTriangleIndices=new Uint32Array(c.earcut(e,[],2)),f=0,h=0;h<e.length;h+=3)f+=g.triangleAreaGeodesic(a[e[h]],a[e[h+1]],a[e[h+2]],b.WGS84);return f};h.prototype._selectFittingMode=function(a,b,c,d){var e=b.map(function(b){return Math.abs(g.planePointDistance(a,b))}).reduce(function(a,b){return Math.max(a,b)},0);g.boundingSphere(b,this._tempSphere);b=e/(2*this._tempSphere.radius);var e=b<d.maxRelativeErrorAlmostCoplanar,
f="horizontal";b<d.maxRelativeErrorCoplanar?f="oblique":e&&(f=Math.abs(n.vec3.dot(c,a))>Math.cos(k.deg2rad(d.verticalAngleThreshold))?"horizontal":"vertical");return f};return h}()})},"esri/views/3d/interactive/measurementTools/support/measurementUtils":function(){define("require exports ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../geometry/geometryEngine ../../../../../geometry/Polygon ../../../../../geometry/SpatialReference ../../../../../geometry/support/geodesicUtils ../../../support/mathUtils ../../../support/projectionUtils".split(" "),
function(t,h,k,a,c,e,m,n,f,q){var b;(function(a){a.boundingSphere=function(a,b){var c=b.center;k.vec3.set(c,0,0,0);for(var d=0;d<a.length;++d)k.vec3.add(c,c,a[d]);k.vec3.scale(c,c,1/a.length);for(var e=0,d=0;d<a.length;++d)e=Math.max(e,k.vec3.squaredDistance(c,a[d]));b.radius=Math.sqrt(e)};a.bestFitPlane=function(a,b){if(3>a.length)throw Error("need at least 3 points to fit a plane");f.planeFromPoints(a[0],a[1],a[2],b)};a.planePointDistance=function(a,b){return k.vec3.dot(a,b)+a[3]};a.segmentLengthEuclidean=
function(a,b,c){return q.pointToVector(a,v,c)&&q.pointToVector(b,g,c)?k.vec3.distance(v,g):0};a.segmentLengthGeodesic=function(a,b){if(!q.pointToWGS84ComparableLonLat(a,v)||!q.pointToWGS84ComparableLonLat(b,g))return 0;a={distance:null};n.inverseGeodeticSolver(a,[v[0],v[1]],[g[0],g[1]]);return a.distance};a.segmentLengthGeodesicVector=function(a,b){var c={distance:null};n.inverseGeodeticSolver(c,[a[0],a[1]],[b[0],b[1]]);return c.distance};a.triangleAreaEuclidean=function(a,b,c){return.5*Math.abs((b[0]-
a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0]))};a.triangleAreaGeodesic=function(a,b,e,f){var d=z;if(!q.vectorToWGS84ComparableLonLat(a,f,v)||!q.vectorToWGS84ComparableLonLat(b,f,g)||!q.vectorToWGS84ComparableLonLat(e,f,r))return 0;d.setPoint(0,0,v);d.setPoint(0,1,g);d.setPoint(0,2,r);return Math.abs(c.geodesicArea(d,"square-meters"))};a.tangentFrame=function(a,b,c){Math.abs(a[0])>Math.abs(a[1])?k.vec3.set(b,0,1,0):k.vec3.set(b,1,0,0);k.vec3.cross(c,a,b);k.vec3.normalize(b,b);k.vec3.cross(b,c,a);k.vec3.normalize(c,
c)};a.fitHemisphere=function(a,b,c){void 0===b&&(b=null);void 0===c&&(c=!0);var d=function(a,b){if(0===b[0]&&0===b[1]&&0===b[2])return!1;for(var c=0;c<a.length;++c)if(-1E-6>k.vec3.dot(b,a[c]))return!1;return!0};if(0===a.length)return!1;if(1===a.length)return b&&k.vec3.copy(b,a[0]),!0;k.vec3.set(w,0,0,0);for(var e=0;e<a.length;++e)k.vec3.add(w,w,a[e]);k.vec3.normalize(w,w);if(d(a,w))return b&&k.vec3.copy(b,w),!0;if(!c)return!1;for(e=0;e<a.length;++e)for(c=0;c<a.length;++c)if(e!==c&&(k.vec3.cross(w,
a[e],a[c]),k.vec3.normalize(w,w),d(a,w)))return b&&k.vec3.copy(b,w),!0;return!1};a.compareSets=function(a,b){if(a===b)return!0;if(a.size!==b.size)return!1;for(var c=0;c<a.size;++c)if(!b.has(a[c]))return!1;return!0}})(b||(b={}));var v=a.vec3f64.create(),g=a.vec3f64.create(),r=a.vec3f64.create(),z=new e({rings:[[v,g,r]],spatialReference:m.WGS84}),w=a.vec3f64.create();return b})},"esri/views/3d/interactive/measurementTools/areaMeasurement3D/PathChanges":function(){define(["require","exports","../support/setUtils"],
function(t,h,k){return function(){function a(){this.change="none";this.updatedVertices=new Set}a.prototype.fullChange=function(){this.change="full"};a.prototype.incrementalChange=function(a){"none"===this.change&&(this.change="incremental");this.updatedVertices.add(a)};a.prototype.clear=function(){this.change="none";this.updatedVertices.clear()};a.prototype.assign=function(a){this.change=a.change;this.updatedVertices=k.clone(a.updatedVertices)};a.prototype.merge=function(a){var c=this;switch(this.change){case "none":this.assign(a);
break;case "incremental":"incremental"===a.change?a.updatedVertices.forEach(function(a){c.updatedVertices.add(a)}):"full"===a.change&&(this.change="full")}};return a}()})},"esri/views/3d/interactive/measurementTools/support/setUtils":function(){define(["require","exports"],function(t,h){Object.defineProperty(h,"__esModule",{value:!0});h.clone=function(h){var a=new Set;h.forEach(function(c){a.add(c)});return a}})},"esri/views/3d/interactive/measurementTools/support/Path":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Accessor ../../../../../core/Collection ../../../../../core/Evented ../../../../../core/accessorSupport/decorators".split(" "),
function(t,h,k,a,c,e,m,n){return function(c){function f(){var a=null!==c&&c.apply(this,arguments)||this;a.vertices=new e;return a}k(f,c);Object.defineProperty(f.prototype,"front",{get:function(){return this.vertices.items[0]||null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"back",{get:function(){return this.vertices.items[this.vertices.length-1]||null},enumerable:!0,configurable:!0});f.prototype.clear=function(){this.vertices.removeAll();this.emit("cleared",{});this._notifyFrontBack()};
f.prototype.vertex=function(a){return this.vertices.items[a]};f.prototype.add=function(a){this.vertices.add(a);a=this.vertices.length-1;this._notifyFrontBack();this.emit("vertex-added",{index:a});return a};f.prototype.insert=function(a,c){this.vertices.splice(a,0,c);this._notifyFrontBack();this.emit("vertex-inserted",{index:a});return a};f.prototype.remove=function(a){this.vertices.removeAt(a);this._notifyFrontBack();this.emit("vertex-removed",{index:a})};f.prototype.update=function(a,c){null!=c&&
(this.vertices.splice(a,1,c),this._notifyFrontBack());this.emit("vertex-updated",{index:a})};f.prototype._notifyFrontBack=function(){this.notifyChange("front");this.notifyChange("back")};a([n.property({readOnly:!0})],f.prototype,"vertices",void 0);a([n.property({aliasOf:"vertices.length"})],f.prototype,"length",void 0);a([n.property({readOnly:!0})],f.prototype,"front",null);a([n.property({readOnly:!0})],f.prototype,"back",null);return f=a([n.subclass("esri.views.3d.interactive.measurementTools.support.Path")],
f)}(n.declared(m.EventedMixin(c)))})},"widgets/Measurement3D/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/Measurement3D/Widget.html":'\x3cdiv\x3e\r\n\t\x3cheader class\x3d"${baseClass}__header" data-dojo-attach-point\x3d"headerNode"\x3e\x3c/header\x3e\r\n\t\x3cdiv class\x3d"hidden" data-dojo-attach-point\x3d"measurementNode"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"${baseClass}__hint" data-dojo-attach-point\x3d"hintNode"\x3e${nls.hint}\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Measurement3D/css/style.css":".esri-area-measurement-3d__container,.esri-direct-line-measurement-3d__container {padding: 0;}.esri-direct-line-measurement-3d {pointer-events: auto;}.jimu-widget-measurement .hidden {display: none !important;}.jimu-widget-measurement .esri-button {height: 32px; cursor: pointer; font-family: inherit; font-size: 14px;}.jimu-widget-measurement .measurement-button-wrapper {padding: 12px 15px;}.jimu-button-group {display: flex; flex-direction: row;}.jimu-button-group \x3e button {font-family: inherit; background: #fff; border: 1px solid #ccc; padding: 5px 10px; line-height: 20px; font-size: 1em; flex-basis: 0; flex-grow: 1; transition: background-color 125ms ease-in-out; position: relative; z-index: 1;}.jimu-button-group \x3e button:hover {background: #f0f0f0;}.jimu-button-group \x3e button.jimu-state-active {background: #24b5cc; border-color: #24b5cc; color: #fff; z-index: 2;}.jimu-button-group \x3e button.jimu-state-active:before {content: none;}.jimu-button-group \x3e button:not(:disabled) {cursor: pointer;}.jimu-button-group \x3e button + button {margin-left: -1px; border-left-width: 0;}.jimu-button-group \x3e button + button::before {content: ''; display: block; position: absolute; left: -1px; top: 4px; bottom: 4px; border-left: 1px solid #ccc;}.jimu-rtl .jimu-button-group \x3e button + button {margin-left: auto; margin-right: -1px; border-left-width: 1px; border-right-width: 0;}.jimu-rtl .jimu-button-group \x3e button + button::before {right: -1px; left: auto;}.jimu-button-group \x3e button img {vertical-align: middle; margin-right: 8px; pointer-events: none;}.jimu-rtl .jimu-button-group \x3e button img {margin-left: 8px; margin-right: auto;}.jimu-widget-measurement__header {font-size: 14px; text-align: center; border-bottom: 1px solid #e7e7e7; margin-bottom: 12px;}.jimu-widget-measurement__header img {vertical-align: middle; margin-right: 8px;}.jimu-rtl .jimu-widget-measurement__header img {margin-left: 8px; margin-right: auto;}.jimu-widget-measurement__hint {color: #323232; font-size: 14px;}.jimu-widget-frame.jimu-container .jimu-widget-measurement__header {margin: -14px -14px 14px; padding: 14px 14px 14px;}",
"*now":function(t){t(['dojo/i18n!*preload*widgets/Measurement3D/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","uk","zh-hk","zh-tw","ROOT"]'])}}});
define("dojo/_base/declare dojo/_base/lang dojo/on jimu/BaseWidget ./ButtonGroup jimu/dijit/ViewStack esri/widgets/DirectLineMeasurement3D esri/widgets/AreaMeasurement3D esri/core/watchUtils".split(" "),function(t,h,k,a,c,e,m,n){return t([a],{baseClass:"jimu-widget-measurement",name:"Measurement",MEASURE_TYPES:{DISTANCE:"distance",AREA:"area",LOCATION:"location"},measureWidgets:{},selectedMeasureType:null,buttonGroup:null,CSS:{clearButton:"esri-direct-line-measurement-3d__clear-button"},postCreate:function(){this.inherited(arguments);
this.measureWidgets={};this.selectedMeasureType=null},startup:function(){this.inherited(arguments);this.initUI()},destroy:function(){if(this.measureWidgets)for(var a in this.measureWidgets)if(this.measureWidgets.hasOwnProperty(a)){var c=this.measureWidgets[a];c.destroy&&c.destroy()}this.buttonGroup&&this.buttonGroup.destroy&&(this.buttonGroup.destroy(),this.buttonGroup=null);this.selectedMeasureType=null;this.inherited(arguments)},onOpen:function(){var a=this.getWidget(this.selectedMeasureType);a&&
(a.visible=!0)},onClose:function(){var a=this.getWidget(this.selectedMeasureType);a&&(a.visible=!1)},onActive:function(){var a=this.getWidget(this.selectedMeasureType);(a=a&&a.get("viewModel.tool"))&&a.activate()},onDeActive:function(){var a=this.getWidget(this.selectedMeasureType),c=a&&a.get("viewModel.tool");"measuring"===(a&&a.get("viewModel.state"))?a.viewModel.clearMeasurement():c&&c.deactivate()},_applyConfig:function(a){if(this.config&&a){var c=this.config,b,e;switch(a.measureType){case this.MEASURE_TYPES.DISTANCE:b=
"lengthUnit";e="defaultLengthUnit";break;case this.MEASURE_TYPES.AREA:b="areaUnit",e="defaultAreaUnit"}c.measurement&&c.measurement[b]?a.unit=c.measurement[b]:c[e]&&(a.unit=c[e])}},_createWidget:function(a){a=this._ensureWidget(a);this._applyConfig(a);return a},_ensureWidget:function(a){var c=this.getWidget(a);c||(c=document.createElement("div"),a===this.MEASURE_TYPES.DISTANCE?this.measureWidgets[a]=new m({container:c,view:this.sceneView,measureType:a,visible:!1}):a===this.MEASURE_TYPES.AREA&&(this.measureWidgets[a]=
new n({container:c,view:this.sceneView,measureType:a})),c=this.measureWidgets[a]);return c},_initWidget:function(a){var c=this.getWidget(a);c||(c=this._createWidget(a),this._addtoViewStack(c));c.visible=!0;this.viewStack.switchView(a)},_addtoViewStack:function(a){if(a){var c=document.createElement("div");c.label=a.measureType;c.appendChild(a.domNode);this.viewStack.addView(c)}},_initMeasurements:function(a){if(a){var e=[];a instanceof Array&&a.forEach(h.hitch(this,function(a){var b=document.createElement("img");
b.title=a.value;b.src=this._getMeasurementIconSource(a.value);e.push({value:a.value,label:a.label,icon:b,content:a.label})}));a=this.buttonGroup=new c({buttons:e,selected:null});a.placeAt(this.headerNode);this.own(k(a,"Change",h.hitch(this,function(a){this._toggleWidgetSection(!!a);this._handleMeasureChanged()})))}},_handleMeasureChanged:function(){var a=this.buttonGroup.getActiveButtonValue(),c=this.getWidget(this.selectedMeasureType);c&&(c.visible=!1);null!==a&&this._initWidget(a);this.selectedMeasureType=
a},_toggleWidgetSection:function(a){a?(this.measurementNode.classList.remove("hidden"),this.hintNode.classList.add("hidden")):(this.measurementNode.classList.add("hidden"),this.hintNode.classList.remove("hidden"))},_getMeasurementIconSource:function(a){var c;switch(a){case this.MEASURE_TYPES.DISTANCE:c=this.folderUrl+"images/Measure_Distance16.png";break;case this.MEASURE_TYPES.AREA:c=this.folderUrl+"images/Measure_Area16.png"}return c},initUI:function(){var a=this.config,c=[];this.viewStack=new e(null,
this.measurementNode);a&&(a.showArea&&c.push({label:this.nls.area,value:this.MEASURE_TYPES.AREA}),a.showDistance&&c.push({label:this.nls.distance,value:this.MEASURE_TYPES.DISTANCE}));0!==c.length&&this._initMeasurements(c)},getWidget:function(a){return a&&this.measureWidgets[a]}})});