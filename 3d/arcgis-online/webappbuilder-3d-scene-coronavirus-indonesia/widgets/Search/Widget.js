// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Search":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper @dojo/framework/shim/array dojo/i18n!../nls/common dojo/i18n!./Search/nls/Search ../intl ../../esri/core/promiseUtils ../core/events ../core/Handles ../core/string ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Search/SearchResultRenderer ./Search/SearchViewModel ./support/widget".split(" "),function(u,m,p,d,n,g,l,k,e,h,c,a,f,b,x,v,y,q){var B=
/<[a-z/][\s\S]*>/i;return function(x){function t(a){var b=x.call(this,a)||this;b._handles=new c;b._inputNode=null;b._sourceMenuButtonNode=null;b._sourceListNode=null;b._suggestionListNode=null;b._searchResultRenderer=new v;b._relatedTarget=null;b.activeMenu="none";b.activeSource=null;b.activeSourceIndex=null;b.allPlaceholder=null;b.allSources=null;b.autoNavigate=null;b.autoSelect=null;b.defaultSources=null;b.disabled=!1;b.goToOverride=null;b.iconClass="esri-icon-search";b.includeDefaultSources=null;
b.label=l.widgetLabel;b.locationEnabled=null;b.maxResults=null;b.maxSuggestions=null;b.minSuggestCharacters=null;b.popupEnabled=null;b.popupTemplate=null;b.portal=null;b.resultGraphic=null;b.resultGraphicEnabled=null;b.results=null;b.searchAllEnabled=null;b.searchTerm=null;b.selectedResult=null;b.sources=null;b.suggestions=null;b.suggestionsEnabled=null;b.view=null;b.viewModel=new y;b.own(f.watch(b,"searchTerm",function(a){if(a&&"warning"===b.activeMenu||!a&&!b.get("viewModel.selectedSuggestion.location"))b.activeMenu=
"none"}),f.on(b,"viewModel.allSources","change",function(){return b._watchSourceChanges()}),f.init(b,["viewModel.popupTemplate","viewModel.popupTemplate.content"],function(){"{Match_addr}"===b.get("viewModel.popupTemplate.content")&&(b.viewModel.popupTemplate.content=b._renderSearchResultsContent.bind(b))}));return b}p(t,x);t.prototype.postInitialize=function(){this.viewModel.load().catch(function(){})};t.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._cancelSuggest();
this._cancelSearch();this._searchResultRenderer&&(this._searchResultRenderer.viewModel=null,this._searchResultRenderer.destroy(),this._searchResultRenderer=null)};t.prototype.clear=function(){};t.prototype.focus=function(){this._inputNode&&(this.activeMenu="suggestion",this._inputNode.focus(),this.emit("search-focus"))};t.prototype.blur=function(a){this._inputNode&&(this._inputNode.blur(),this._inputBlur(a),this.emit("search-blur"))};t.prototype.search=function(a){var b=this;this.activeMenu="none";
this._cancelSuggest();this._cancelSearch();var f=e.createAbortController(),c=f.signal;this._searchController=f;return this.viewModel.search(a,{signal:c}).catch(function(a){if(b._searchController===f)return b.activeMenu="none",b._searchController=null,a}).then(function(a){if(b._searchController===f)return b.activeMenu=a.numResults?"none":"warning",b._searchController=null,a})};t.prototype.suggest=function(a){var b=this;this._cancelSuggest();var f=e.createAbortController(),c=f.signal;this._suggestController=
f;return this.viewModel.suggest(a,null,{signal:c}).then(function(a){if(b._suggestController===f)return b._suggestController=null,a.numResults&&(b.activeMenu="suggestion"),b._scrollToTopSuggestion(),a}).catch(function(){if(b._suggestController===f)return b._suggestController=null})};t.prototype.render=function(){var a=this,b,f,c=this.viewModel,e=c.activeSourceIndex,d=c.suggestions,h=c.maxInputLength,x=c.placeholder,v=c.searchTerm,n=c.searchAllEnabled,A=c.allSources,L=this._getSourceName(e),I=(""+v).trim(),
t=this.activeMenu,B=this.id,m=this.viewModel.state,C=this.id+"-suggest-menu",p=v?q.tsx("div",{key:"esri-search__clear-button",bind:this,role:"button",class:this.classes("esri-search__clear-button","esri-widget--button"),tabindex:"0",title:l.clearButtonTitle,onfocus:this._clearButtonFocus,onclick:this._handleClearButtonClick,onkeydown:this._handleClearButtonClick},q.tsx("span",{"aria-hidden":"true",class:"esri-icon-close"})):null,u=this.locationEnabled&&!I,Q=u?q.tsx("ul",{role:"presentation",key:"esri-search__suggestion-list-current-location",
class:this.classes("esri-menu__list","esri-search__suggestions-list","esri-search__suggestions-list--current-location")},q.tsx("li",{bind:this,onclick:this._handleUseCurrentLocationClick,onkeydown:this._handleUseCurrentLocationClick,onkeyup:this._handleSuggestionKeyup,role:"menuitem",class:"esri-menu__list-item",tabindex:"-1"},q.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-locate-circled"})," ",l.useCurrentLocation)):null,R=1<A.length&&e===y.ALL_INDEX,e=d?d.map(function(b){var f=
b.sourceIndex,c=b.results.length,e=c&&R?a._getSuggestionHeaderNode(f):null;b=b.results.map(function(b,f){return a._getSuggestionNode(b,f)});f=c?q.tsx("ul",{role:"presentation",key:"esri-search__suggestion-list-"+f,class:a.classes("esri-menu__list","esri-search__suggestions-list")},b):null;return[e,f]}):null,u=u||e&&e.length,h=q.tsx("input",{bind:this,placeholder:x,"aria-label":l.searchButtonTitle,maxlength:h,autocomplete:"off",type:"text",tabindex:"0",class:this.classes("esri-input","esri-search__input"),
"aria-autocomplete":"list",value:v,"aria-haspopup":"true","aria-owns":u?C:null,role:"textbox",onkeydown:this._handleInputKeydown,onkeyup:this._handleInputKeyup,onclick:this._handleInputClick,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:q.storeNode,"data-node-ref":"_inputNode",onfocusout:this._storeRelatedTarget,onfocus:this.focus,onblur:this.blur,title:v?"":x}),h=q.tsx("form",{key:"esri-search__form",bind:this,class:"esri-search__form",onsubmit:this._formSubmit,role:"search"},
h),C=u?q.tsx("div",{id:C,"aria-expanded":"suggestion"===t,key:"esri-search__suggestions-menu",class:this.classes("esri-menu","esri-search__suggestions-menu"),role:"menu",bind:this,afterCreate:q.storeNode,"data-node-ref":"_suggestionListNode"},Q,e):null,p=q.tsx("div",{key:"esri-search__input-container",class:"esri-search__input-container"},h,C,p),C=q.tsx("div",{key:"esri-search__submit-button",bind:this,role:"button",title:l.searchButtonTitle,class:this.classes("esri-search__submit-button","esri-widget--button"),
tabindex:"0",onclick:this._handleSearchButtonClick,onkeydown:this._handleSearchButtonClick},q.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-search"}),q.tsx("span",{class:"esri-icon-font-fallback-text"},l.searchButtonTitle)),v=I?k.substitute(l.noResultsFoundForValue,{value:'"'+v+'"'}):l.noResultsFound,v=c.get("selectedSuggestion.location")||I?q.tsx("div",{key:"esri-search__no_results"},q.tsx("div",{class:"esri-search__warning-header"},l.noResults),q.tsx("div",{class:"esri-search__warning-text"},
v)):null,c=c.get("selectedSuggestion.location")||I?null:q.tsx("div",{key:"esri-search__empty-search"},q.tsx("span",{"aria-hidden":"true",class:"esri-icon-notice-triangle"}),q.tsx("span",{class:"esri-search__no-value-text"},l.emptyValue)),c=q.tsx("div",{key:"esri-search__error-menu",class:this.classes("esri-menu","esri-search__warning-menu")},q.tsx("div",{class:"esri-search__warning-body"},v,c)),I=1<A.length,A=A&&A.toArray(),n=n?this._getSourceNode(y.ALL_INDEX):null,B=B+"-source-menu",L=I?q.tsx("div",
{key:"esri-search__source-menu-button",bind:this,role:"button",title:l.searchIn,"aria-haspopup":"true","aria-expanded":"source"===t,"aria-controls":B,class:this.classes("esri-search__sources-button","esri-widget--button"),tabindex:"0",onkeydown:this._handleSourceMenuButtonKeydown,onclick:this._handleSourcesMenuToggleClick,onkeyup:this._handleSourceMenuButtonKeyup,onblur:this._sourcesButtonBlur,afterCreate:q.storeNode,"data-node-ref":"_sourceMenuButtonNode"},q.tsx("span",{"aria-hidden":"true",role:"presentation",
class:"esri-icon-down-arrow esri-search__sources-button--down"}),q.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-up-arrow esri-search__sources-button--up"}),q.tsx("span",{class:"esri-search__source-name"},L)):null,B=I?q.tsx("ul",{id:B,role:"menu",bind:this,afterCreate:q.storeNode,"data-node-ref":"_sourceListNode",class:"esri-menu__list"},n,A.map(function(b,f){return a._getSourceNode(f)})):null,B=I?q.tsx("div",{tabIndex:0,key:"esri-search__source-menu",class:this.classes("esri-menu",
"esri-search__sources-menu")},B):null,t=(b={},b["esri-search--multiple-sources"]=I,b["esri-search--loading"]="loading"===m,b["esri-search--searching"]="searching"===m,b["esri-search--warning"]="warning"===t,b["esri-search--sources"]="source"===t,b["esri-search--show-suggestions"]="suggestion"===t,b);b=(f={},f["esri-disabled"]="disabled"===m,f["esri-widget--disabled"]=this.disabled,f);f="loading"===m?q.tsx("div",{role:"presentation",class:"esri-widget__loader",key:"base-loader"},q.tsx("span",{"aria-hidden":"true",
role:"presentation",class:"esri-widget__loader-animation"}),q.tsx("span",{class:"esri-icon-font-fallback-text"},l.searchButtonTitle),q.tsx("span",{class:"esri-widget__loader-text"},g.loading)):q.tsx("div",{role:"presentation",class:this.classes(t,"esri-search__container"),key:"base-container"},L,B,p,C,c);return q.tsx("div",{class:this.classes("esri-search esri-widget",b)},f)};t.prototype._watchSourceChanges=function(){var a=this,b=this._handles,c=this.viewModel.allSources;b.remove("sources");c.forEach(function(c){return b.add(f.watch(c,
"name",function(){return a.scheduleRender()}),"sources")})};t.prototype._handleSourceMenuButtonKeydown=function(a){var b=h.eventKey(a);"ArrowUp"===b||"ArrowDown"===b||"End"===b||"Home"===b?(a.preventDefault(),a.stopPropagation(),this.activeMenu="source"):this._handleSourcesMenuToggleClick(a)};t.prototype._handleSourcesMenuToggleClick=function(a){var b="source"===this.activeMenu;this.activeMenu=b?"none":"source";this.renderNow();b?this._sourceMenuButtonNode&&this._sourceMenuButtonNode.focus():(b=this._sourceListNode?
this._sourceListNode.getElementsByTagName("li"):null)&&(a="End"===h.eventKey(a)?b[b.length-1]:b[0])&&a.focus()};t.prototype._handleClearButtonClick=function(){this.viewModel.clear();this._focus()};t.prototype._handleSearchButtonClick=function(){this.search()};t.prototype._handleSuggestionClick=function(a){if(a=a.currentTarget["data-suggestion"])this._focus(),this.search(a)};t.prototype._handleUseCurrentLocationClick=function(){var a=this;this._focus("none");this._cancelSuggest();this._cancelSearch();
var b=e.createAbortController(),f=b.signal;this._searchController=b;this.viewModel.searchNearby({signal:f}).catch().then(function(){a._searchController=null})};t.prototype._handleSourceClick=function(a){this.viewModel.activeSourceIndex=a.currentTarget["data-source-index"];this._focus("none")};t.prototype._sourcesButtonBlur=function(a){this._removeActiveMenu(a&&a.relatedTarget,this._sourceListNode)};t.prototype._inputBlur=function(a){a=a&&a.relatedTarget;this._removeActiveMenu(a?a:this._relatedTarget,
this._suggestionListNode)};t.prototype._storeRelatedTarget=function(a){this._relatedTarget=a.relatedTarget};t.prototype._clearButtonFocus=function(){this.activeMenu="none"};t.prototype._removeActiveMenu=function(a,b){!a||a&&b&&b.contains(a)||(this.activeMenu="none")};t.prototype._cancelSuggest=function(){this._suggestController&&(this._suggestController.abort(),this._suggestController=null)};t.prototype._cancelSearch=function(){this._searchController&&(this._searchController.abort(),this._searchController=
null)};t.prototype._handleInputKeydown=function(a){var b=h.eventKey(a);("Tab"===b||"Escape"===b||a.shiftKey&&"Tab"===b)&&this._cancelSuggest()};t.prototype._handleInputKeyup=function(a){var b=h.eventKey(a),f=a.ctrlKey||a.metaKey||"Copy"===b||"ArrowLeft"===b||"ArrowRight"===b||"Enter"===b||"Shift"===b,c=this._suggestionListNode?this._suggestionListNode.getElementsByTagName("li"):null;f||("Tab"===b||"Escape"===b||a.shiftKey&&"Tab"===b?(this._cancelSuggest(),"Escape"===b&&(this.activeMenu="none")):"ArrowUp"!==
b&&"ArrowDown"!==b||!c?this.viewModel.searchTerm&&this.suggest():(this.activeMenu="suggestion",a.stopPropagation(),a.preventDefault(),this._cancelSuggest(),(a=c["ArrowUp"===b?c.length-1:0])&&a.focus()))};t.prototype._scrollToTopSuggestion=function(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)};t.prototype._handleInputClick=function(){this.activeMenu="suggestion"};t.prototype._handleInputPaste=function(a){a=a.target;this.viewModel.searchTerm!==a.value&&(this.viewModel.searchTerm=
a.value);this.viewModel.searchTerm&&this.suggest()};t.prototype._handleSourceMenuButtonKeyup=function(a){var b=h.eventKey(a);if("ArrowUp"===b||"ArrowDown"===b||"Home"===b||"End"===b)a.stopPropagation(),a.preventDefault(),(a=this._sourceListNode?this._sourceListNode.getElementsByTagName("li"):null)&&(b=a["ArrowUp"===b||"End"===b?a.length-1:0])&&b.focus()};t.prototype._handleSourceKeyup=function(a){var b=a.target,f=this._sourceListNode?n.from(this._sourceListNode.getElementsByTagName("li")):null,c=
h.eventKey(a);if("Escape"===c)this._focus("none"),this._sourceMenuButtonNode&&this._sourceMenuButtonNode.focus();else if(f){b=f.indexOf(b);if("Home"===c||"End"===c||"ArrowUp"===c||"ArrowDown"===c)a.stopPropagation(),a.preventDefault();"Home"===c?(f=f[0])&&f.focus():"End"===c?(f=f[f.length-1])&&f.focus():"ArrowUp"===c?(a=b-1,(f=0>a?this._sourceMenuButtonNode:f[a])&&f.focus()):"ArrowDown"===c&&(a=b+1,(f=a>=f.length?this._sourceMenuButtonNode:f[a])&&f.focus())}};t.prototype._handleSuggestionKeyup=function(a){var b=
a.target,f=this._suggestionListNode?n.from(this._suggestionListNode.getElementsByTagName("li")):null,b=f.indexOf(b),c=h.eventKey(a);this._cancelSuggest();if("Backspace"===c||"Delete"===c)this._focus();else if("Escape"===c)this._focus("none");else if(f){if("Home"===c||"End"===c||"ArrowUp"===c||"ArrowDown"===c)a.stopPropagation(),a.preventDefault();"Home"===c&&(a=f[0])&&a.focus();"End"===c&&(a=f[f.length-1])&&a.focus();"ArrowUp"===c?(--b,(f=0>b?f[f.length-1]:f[b])&&f.focus()):"ArrowDown"===c&&(b+=1,
(f=b>=f.length?f[0]:f[b])&&f.focus())}};t.prototype._focus=function(a){this.focus();a&&(this.activeMenu=a)};t.prototype._formSubmit=function(a){a.preventDefault();this.search()};t.prototype._getSourceName=function(a){var b=this.viewModel.allSources.getItemAt(a);return a===y.ALL_INDEX?l.all:b?b.name||l.untitledSource:l.untitledSource};t.prototype._getSuggestionHeaderNode=function(a){var b=this._getSourceName(a);return q.tsx("div",{key:"esri-search__suggestion-header-"+a,class:"esri-menu__header"},
b)};t.prototype._splitResult=function(b,f){f=a.escapeRegExpString(f);return b.replace(new RegExp("(^|)("+f+")(|$)","ig"),"$1|$2|$3").split("|")};t.prototype._getSuggestionNode=function(a,b){var f=this.viewModel.searchTerm;if(f){var c=a.text||l.untitledResult,e=[];if(B.test(c))e.push(q.tsx("div",{innerHTML:c}));else{var c=this._splitResult(c,f),d=f.toLowerCase();c.forEach(function(a,b){a&&a.length&&(a.toLowerCase()===d?e.push(q.tsx("strong",{key:b},a)):e.push(a))})}return q.tsx("li",{bind:this,onclick:this._handleSuggestionClick,
onkeydown:this._handleSuggestionClick,onkeyup:this._handleSuggestionKeyup,key:"esri-search__suggestion$-{sourceIndex}_"+b,"data-suggestion":a,role:"menuitem",class:"esri-menu__list-item",tabindex:"-1"},e)}};t.prototype._getSourceNode=function(a){var b,f=(b={},b["esri-menu__list-item--active"]=a===this.viewModel.activeSourceIndex,b);return q.tsx("li",{bind:this,key:"esri-search__source-"+a,onclick:this._handleSourceClick,onkeydown:this._handleSourceClick,onkeyup:this._handleSourceKeyup,"data-source-index":a,
role:"menuitem",class:this.classes("esri-search__source","esri-menu__list-item",f),tabindex:"-1"},this._getSourceName(a))};t.prototype._renderSearchResultsContent=function(){this._searchResultRenderer.showMoreResultsOpen=!1;this._searchResultRenderer.viewModel=this.viewModel;return this._searchResultRenderer};d([b.property(),q.renderable()],t.prototype,"activeMenu",void 0);d([b.aliasOf("viewModel.activeSource"),q.renderable()],t.prototype,"activeSource",void 0);d([b.aliasOf("viewModel.activeSourceIndex"),
q.renderable()],t.prototype,"activeSourceIndex",void 0);d([b.aliasOf("viewModel.allPlaceholder"),q.renderable()],t.prototype,"allPlaceholder",void 0);d([b.aliasOf("viewModel.allSources")],t.prototype,"allSources",void 0);d([b.aliasOf("viewModel.autoNavigate")],t.prototype,"autoNavigate",void 0);d([b.aliasOf("viewModel.autoSelect")],t.prototype,"autoSelect",void 0);d([b.aliasOf("viewModel.defaultSources")],t.prototype,"defaultSources",void 0);d([q.renderable(),b.property()],t.prototype,"disabled",
void 0);d([b.aliasOf("viewModel.goToOverride")],t.prototype,"goToOverride",void 0);d([b.property()],t.prototype,"iconClass",void 0);d([b.aliasOf("viewModel.includeDefaultSources")],t.prototype,"includeDefaultSources",void 0);d([b.property()],t.prototype,"label",void 0);d([q.renderable(),b.aliasOf("viewModel.locationEnabled")],t.prototype,"locationEnabled",void 0);d([b.aliasOf("viewModel.maxResults")],t.prototype,"maxResults",void 0);d([b.aliasOf("viewModel.maxSuggestions")],t.prototype,"maxSuggestions",
void 0);d([b.aliasOf("viewModel.minSuggestCharacters")],t.prototype,"minSuggestCharacters",void 0);d([b.aliasOf("viewModel.popupEnabled")],t.prototype,"popupEnabled",void 0);d([b.aliasOf("viewModel.popupTemplate")],t.prototype,"popupTemplate",void 0);d([b.aliasOf("viewModel.portal")],t.prototype,"portal",void 0);d([b.aliasOf("viewModel.resultGraphic")],t.prototype,"resultGraphic",void 0);d([b.aliasOf("viewModel.resultGraphicEnabled")],t.prototype,"resultGraphicEnabled",void 0);d([b.aliasOf("viewModel.results"),
q.renderable()],t.prototype,"results",void 0);d([b.aliasOf("viewModel.searchAllEnabled"),q.renderable()],t.prototype,"searchAllEnabled",void 0);d([b.aliasOf("viewModel.searchTerm"),q.renderable()],t.prototype,"searchTerm",void 0);d([b.aliasOf("viewModel.selectedResult")],t.prototype,"selectedResult",void 0);d([b.aliasOf("viewModel.sources")],t.prototype,"sources",void 0);d([b.aliasOf("viewModel.suggestions"),q.renderable()],t.prototype,"suggestions",void 0);d([b.aliasOf("viewModel.suggestionsEnabled")],
t.prototype,"suggestionsEnabled",void 0);d([b.aliasOf("viewModel.view"),q.renderable()],t.prototype,"view",void 0);d([q.vmEvent("search-complete search-clear search-start select-result suggest-start suggest-complete".split(" ")),b.property({type:y}),q.renderable(["viewModel.allSources","viewModel.activeSource.placeholder","viewModel.activeSource.name","viewModel.state"])],t.prototype,"viewModel",void 0);d([b.aliasOf("viewModel.clear")],t.prototype,"clear",null);d([q.accessibleHandler()],t.prototype,
"_handleSourcesMenuToggleClick",null);d([q.accessibleHandler()],t.prototype,"_handleClearButtonClick",null);d([q.accessibleHandler()],t.prototype,"_handleSearchButtonClick",null);d([q.accessibleHandler()],t.prototype,"_handleSuggestionClick",null);d([q.accessibleHandler()],t.prototype,"_handleUseCurrentLocationClick",null);d([q.accessibleHandler()],t.prototype,"_handleSourceClick",null);return t=d([b.subclass("esri.widgets.Search")],t)}(b.declared(x))})},"esri/widgets/Search/SearchResultRenderer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/i18n!./nls/Search ../../core/accessorSupport/decorators ../Widget ./SearchViewModel ../support/widget".split(" "),
function(u,m,p,d,n,g,l,k,e){return function(h){function c(a){a=h.call(this,a)||this;a.showMoreResultsOpen=!1;a.viewModel=null;return a}p(c,h);c.prototype.render=function(){var a=this,f,b=this.get("viewModel.selectedResult"),c=this.get("viewModel.results"),b=b&&b.name||"",d=1<this._countResults(c),h=d&&c.map(function(b){return a._moreResultsList(b)}),c=d?e.tsx("div",{key:"esri-search-renderer__more-results-button",class:"esri-search-result-renderer__more-results-item"},e.tsx("a",{class:"esri-widget__anchor",
href:"#",bind:this,onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?n.hideMoreResults:n.showMoreResults)):null,d=d?e.tsx("div",{key:"esri-search-renderer__more-results-container",class:"esri-search-result-renderer__more-results-list"},h):null,h=(f={},f["esri-search-result-renderer__more-results--show-more-results"]=this.showMoreResultsOpen,f);return e.tsx("div",{class:"esri-search-result-renderer esri-widget"},e.tsx("div",{key:"esri-search-renderer__container",
class:this.classes("esri-search-result-renderer__more-results",h)},e.tsx("div",{key:"esri-search-renderer__result-name",class:"esri-search-result-renderer__more-results-item"},b),e.tsx("div",{key:"esri-search-renderer__more-results"},c,d)))};c.prototype._showMoreResultsClick=function(a){a.preventDefault();this.showMoreResultsOpen=!this.showMoreResultsOpen;(a=this.get("viewModel.view.popup"))&&a.reposition()};c.prototype._selectResultClick=function(a){a.preventDefault();a=a.currentTarget["data-result"];
this.viewModel&&this.viewModel.select(a)};c.prototype._moreResultsList=function(a){var f=this,b=a.results,c=b.length,d=!!c,h=this.get("viewModel.selectedResult"),c=1===c&&b[0]===h,h=this._getSourceName(a.source,a.sourceIndex),h=1<this.get("viewModel.results").length&&!c?e.tsx("div",{key:"esri-search-result-renderer__header-"+a.sourceIndex,class:"esri-search-result-renderer__more-results-list-header"},h):null,b=d&&b.map(function(a,b){return f._moreResultsListItem(a,b)}),b=d&&!c?e.tsx("ul",{key:"esri-search-result-renderer__list-"+
a.sourceIndex},b):null;return d?e.tsx("div",{key:"esri-search-result-renderer__results-"+a.sourceIndex},h,b):null};c.prototype._moreResultsListItem=function(a,f){var b=this.get("viewModel.selectedResult");return a!==b?e.tsx("li",{key:"esri-search-result-renderer__list-item-"+f},e.tsx("a",{class:"esri-widget__anchor",href:"#",tabindex:"0",bind:this,"data-result":a,onclick:this._selectResultClick,onkeydown:this._selectResultClick},a.name)):null};c.prototype._getSourceName=function(a,f){return f===k.ALL_INDEX?
n.all:a.name};c.prototype._countResults=function(a){return a?a.reduce(function(a,b){return a+b.results.length},0):0};d([e.renderable(),g.property()],c.prototype,"showMoreResultsOpen",void 0);d([g.property(),e.renderable(["viewModel.results","viewModel.selectedResult"])],c.prototype,"viewModel",void 0);d([e.accessibleHandler()],c.prototype,"_showMoreResultsClick",null);d([e.accessibleHandler()],c.prototype,"_selectResultClick",null);return c=d([g.subclass("esri.widgets.Search.SearchResultRenderer")],
c)}(g.declared(l))})},"esri/widgets/Search/SearchViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper dojo/i18n!./nls/Search ../../Graphic ../../PopupTemplate ../../core/Accessor ../../core/Collection ../../core/Error ../../core/Evented ../../core/geolocationUtils ../../core/Handles ../../core/has ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../geometry/SpatialReference ../../portal/Portal ../../renderers/smartMapping/symbology/location ../../symbols/PictureMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ../../symbols/SimpleMarkerSymbol ../../symbols/TextSymbol ../../views/support/layerViewUtils ./LayerSearchSource ./LocatorSearchSource ./SearchSource ./support/geometryUtils ./support/locatorUtils ../support/GoTo".split(" "),
function(u,m,p,d,n,g,l,k,e,h,c,a,f,b,x,v,y,q,B,C,t,r,w,F,E,D,H,G,K,O,z,A,L,I,S,T,U){function J(a,b){return a.hasOwnProperty(b)&&null!=a[b]&&""!==a[b]}var M=y.getLogger("esri.widgets.Search.SearchViewModel"),P=c.ofType({key:function(a){return a.layer?"layer":"locator"},base:I,typeMap:{layer:A,locator:L}}),Q=w.WGS84,R=/<(?:.|\s)*?>/g;return function(f){function c(a){a=f.call(this,a)||this;a._handles=new x;a._gotoController=null;a._searching=null;a._loadingDefaultSources=null;a.allPlaceholder=l.allPlaceholder;
a.autoNavigate=!0;a.autoSelect=!0;a.defaultSources=new P;a.defaultSymbol=new D({url:u.toUrl("../../images/search/search-symbol-32.svg"),size:24,width:24,height:24});a.includeDefaultSources=!0;a.maxInputLength=128;a.maxResults=6;a.maxSuggestions=6;a.minSuggestCharacters=1;a.popupEnabled=!0;a.popupTemplate=new e({title:l.searchResult,content:"{Match_addr}"});a.portal=F.getDefault();a.resultGraphicEnabled=!0;a.resultGraphic=null;a.results=null;a.selectedSuggestion=null;a.searchAllEnabled=!0;a.selectedResult=
null;a.sources=new P;a.suggestionDelay=150;a.suggestions=null;a.suggestionsEnabled=!0;a.view=null;return a}p(c,f);c.prototype.initialize=function(){var a=this;this._handles.add(C.on(this,["defaultSources","sources"],"change",function(){return a.notifyChange("allSources")}))};c.prototype.destroy=function(){this._abortGoTo();this.clearGraphics();this._loadingDefaultSources=null;this._clearLoadingDefaultSources();this._handles.destroy();this._handles=null};Object.defineProperty(c.prototype,"activeSource",
{get:function(){return this.allSources.getItemAt(this.activeSourceIndex)||null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"activeSourceIndex",{get:function(){return 1!==this.allSources.length&&this.searchAllEnabled?-1:0},set:function(a){void 0===a?this._clearOverride("activeSourceIndex"):this._override("activeSourceIndex",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"allSources",{get:function(){var a=this.sources,b=this.defaultSources,c=this.includeDefaultSources,
a="function"===typeof c?c.call(null,{sources:a,defaultSources:b}):c?b.concat(a):a,b=this._get("allSources")||new P;b.removeAll();b.addMany(a.filter(Boolean));return b},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"locationEnabled",{get:function(){return this._get("locationEnabled")||b.supported()},set:function(c){if(void 0===c)this._clearOverride("locationEnabled");else{var f=b.supported();if(c&&!f){var e=new a("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",
{geolocation:navigator.geolocation});M.error(e)}this._override("locationEnabled",c&&f)}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"placeholder",{get:function(){var a=this.activeSourceIndex,b=this.allPlaceholder,b=void 0===b?l.allPlaceholder:b;return-1===a?b:(a=this.allSources.getItemAt(a))?a.placeholder:""},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"searchTerm",{get:function(){return this._get("searchTerm")||""},set:function(a){this._set("searchTerm",
a||"");this.clearGraphics();this.selectedSuggestion&&this.selectedSuggestion.text!==a&&this._set("selectedSuggestion",null);""===a&&this._clear()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"state",{get:function(){return this._searching?"searching":this._loadingDefaultSources?"loading":0===this.allSources.length?"disabled":"ready"},enumerable:!0,configurable:!0});c.prototype.load=function(){return g(this,void 0,void 0,function(){var a=this;return n(this,function(b){this._handles.add([C.init(this,
["portal","includeDefaultSources"],function(){return a._loadPortal()}),C.init(this,["view","portal","includeDefaultSources"],function(){return a._loadDefaultSources()})]);return[2]})})};c.prototype.clear=function(){this.searchTerm=""};c.prototype.clearGraphics=function(){this._removeHighlight();this._closePopup();this.view&&this.view.graphics.remove(this.resultGraphic);this._set("resultGraphic",null)};c.prototype.search=function(a,b){var c=this;this.emit("search-start");this.clearGraphics();var f=
this._createSuggestionForSearch(a);this._searching=a=this._whenViewAndPortalLoaded().then(function(){return c._getResultsFromSources(f,b).then(function(a){var b={activeSourceIndex:c.activeSourceIndex,searchTerm:f.text,numResults:0,numErrors:0,errors:[],results:[]};c._formatResponse(b,a,f);a=c._getFirstResult(b.results);var e=(f.location&&a?a.name:f.text).replace(R,"");c._set("searchTerm",e);(f.key&&"number"===typeof f.sourceIndex||f.location)&&c._set("selectedSuggestion",f);c._set("results",b.results);
c.emit("search-complete",b);return c._selectFirstResult(a).then(function(){return b})})}).then(function(a){c._clearSearching();return a},function(a){c._clearSearching();throw a;});this.notifyChange("state");return a};c.prototype.searchNearby=function(c){var f=this;if(!this.locationEnabled){var e=new a("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});M.error(e);return B.reject(e)}this._searching=e=b.getCurrentPosition().then(function(a){return b.positionToPoint({position:a,
view:f.view},c)}).then(function(a){return f.search(a,c)});this.notifyChange("state");e.catch(function(){}).then(function(){return f._clearSearching()});return e};c.prototype.select=function(b){var c=this;this.clearGraphics();if(!b){var f=new a("select:missing-parameter","Cannot select without a searchResult.",{searchResult:b});M.error(f);return B.reject(f)}var e=this.view,d=J(b,"sourceIndex")?b.sourceIndex:this._getSourceIndexOfResult(b),h=this.allSources.getItemAt(d);if(!h)return f=new a("select:missing-source",
"Cannot select without a source.",{source:h}),M.error(f),B.reject(f);var f=h instanceof A?this._getLayerSourcePopupTemplate(h):h.popupTemplate,r=h.resultSymbol||this._getDefaultSymbol(b),l=J(h,"resultGraphicEnabled")?h.resultGraphicEnabled:this.resultGraphicEnabled,g=J(h,"autoNavigate")?h.autoNavigate:this.autoNavigate,w=J(h,"popupEnabled")?h.popupEnabled:this.popupEnabled,x=w?f||this.popupTemplate:null,v=b.feature;if(!v)return f=new a("select:missing-feature","Cannot select without a feature.",{feature:v}),
M.error(f),B.reject(f);var n=v.attributes,y=v.geometry,L=v.layer,I=v.sourceLayer,t=S.getPointFromGeometry(y),f={layerViewQuery:this._getLayerView(v),elevationQuery:e&&q.isSome(t)?S.getPointWithElevation(t,e).catch(function(){return t}):B.resolve(t)};return B.eachAlways(f).then(function(a){var f=a.layerViewQuery.value,A=a.elevationQuery.value;r instanceof O&&(r.text=b.name);a=e&&g?c._getGoToTarget(b,h):null;return(q.isSome(a)?c._goToSearchResult(a):B.resolve()).then(function(){var a=f?v:new k({geometry:y,
symbol:r,attributes:n,layer:L,sourceLayer:I,popupTemplate:x}),g=w&&c.get("view.popup");(g=g&&a.getEffectivePopupTemplate(g.defaultPopupTemplateEnabled))&&e.popup.open({features:[a],location:A});f&&z.highlightsSupported(f)&&!g&&c._highlightFeature({graphic:a,layerView:f});!f&&l&&e&&e.graphics.push(a);c._set("selectedResult",b);c._set("resultGraphic",a);c.emit("select-result",{result:b,source:h,sourceIndex:d});return b})})};c.prototype.suggest=function(a,b,c){var f=this,e=a||this.searchTerm;this.emit("suggest-start",
{searchTerm:e});return this._suggestTimer(b,c).then(function(){return f._suggestImmediate(e,c).then(function(a){f._set("suggestions",a.results);f.emit("suggest-complete",a);return a})})};c.prototype._loadPortal=function(){var a=this.portal;this.includeDefaultSources&&a&&!a.loaded&&a.load()};c.prototype._clearLoadingDefaultSources=function(){this._loadingDefaultSources=null;this.notifyChange("state")};c.prototype._clearSearching=function(){this._searching=null;this.notifyChange("state")};c.prototype._convertHelperServices=
function(){var a=this.get("portal.helperServices.geocode");return a?a.map(function(a){if(!1!==a.placefinding&&(a=L.fromJSON(a),T.isArcGISWorldGeocoder(a.get("locator.url"))&&a.set({singleLineFieldName:"SingleLine",outFields:["Addr_type","Match_addr","StAddr","City"],placeholder:l.placeholder,defaultZoomScale:2500}),a.singleLineFieldName))return a}).filter(Boolean):[]};c.prototype._convertApplicationProperties=function(){var a=this,b=this.get("view.map.applicationProperties.viewing.search"),c=this.get("view.map");
if(!c||!b)return[];var f=b.hintText;return b.enabled?b.layers.map(function(b){var e=c.findLayerById(b.id);if(e){b=a._getLayerJSON(b);var h=A.fromJSON(b);h.placeholder=f;a._getLayer(e,b).then(function(a){h.layer=a});return h}}).filter(Boolean):[]};c.prototype._getSubLayer=function(a,b){return a&&a.allSublayers?(a=a.allSublayers.find(function(a){return a.id===b.subLayer}))?a.createFeatureLayer():B.reject():B.reject()};c.prototype._getLayer=function(b,c){var f=this;if("feature"===b.type||"scene"===b.type)return B.resolve(b);
if("map-image"===b.type)return b.load().then(function(){return f._getSubLayer(b,c).catch(function(){var c=new a("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:b});M.error(c);return null})})};c.prototype._getLayerJSON=function(a){return"function"===typeof a.toJSON?a.toJSON():a};c.prototype._updateDefaultSources=function(){var a=this.defaultSources,b=this.includeDefaultSources;a.removeAll();b&&a.addMany(this._convertApplicationProperties().concat(this._convertHelperServices()));
this.notifyChange("allSources")};c.prototype._abortGoTo=function(){this._gotoController&&this._gotoController.abort();this._gotoController=null};c.prototype._clear=function(){this._abortGoTo();this._set("results",null);this._set("suggestions",null);this._set("selectedResult",null);this._set("selectedSuggestion",null);this.emit("search-clear")};c.prototype._closePopup=function(){var a=this.get("view.popup"),b=this.resultGraphic;if(a&&b){var c=a.selectedFeature;c&&c===b&&a.close()}};c.prototype._suggestTimer=
function(a,b){return B.after(null!=a?a:this.suggestionDelay,null,b&&b.signal)};c.prototype._createLocationForSearch=function(a){return a instanceof k?S.getPointFromGeometry(a.geometry):a instanceof r?a:Array.isArray(a)&&2===a.length?new r({longitude:a[0],latitude:a[1]}):null};c.prototype._createSuggestionForSearch=function(a){if(a&&J(a,"key")&&J(a,"text")&&J(a,"sourceIndex"))return a;var b=this._createLocationForSearch(a),c="string"===typeof a?a:this.searchTerm,f=this.selectedSuggestion,e=this.selectedResult,
A=(a=!a&&f&&e)&&f.location;return a&&f.key===e.key&&f.sourceIndex===e.sourceIndex||A?f:{location:q.unwrap(b),text:b?"":c,sourceIndex:null,key:null}};c.prototype._getFirstResult=function(a){var b=null;a&&a.some(function(a){a=a.results[0];var c=!!a;c&&(b=a);return c});return b};c.prototype._selectFirstResult=function(a){return this.autoSelect&&a?this.select(a):B.resolve()};c.prototype._suggestImmediate=function(a,b){var c=this;return this._whenViewAndPortalLoaded().then(function(){return c._getSuggestionsFromSources(a,
b)}).then(function(b){var f={activeSourceIndex:c.activeSourceIndex,searchTerm:a,numResults:0,numErrors:0,errors:[],results:[]};c._formatResponse(f,b);return f})};c.prototype._formatSourceResponse=function(a,b,c){var f=b&&b.value||[];b=b&&b.error;var e=this.allSources.getItemAt(c);b?(a.errors.push({sourceIndex:c,source:e,error:b}),a.numErrors++):(a.results.push({sourceIndex:c,source:e,results:f}),a.numResults+=f.length)};c.prototype._formatResponse=function(a,b,c){var f=this;if(b)if(-1===a.activeSourceIndex){var e=
c&&J(c,"sourceIndex")&&-1!==c.sourceIndex?c.sourceIndex:void 0;b.forEach(function(b,c){f._formatSourceResponse(a,b,void 0!==e?e:c)})}else this._formatSourceResponse(a,b[0],a.activeSourceIndex)};c.prototype._getResultsFromSources=function(b,c){var f=this,e=this.allSources,A=!b.location&&J(b,"sourceIndex")?b.sourceIndex:this.activeSourceIndex,h=[];if(!e.length)return e=new a("search:no-sources-defined","At least one source is required.",{allSources:e}),M.error(e),B.reject(e);-1===A?e.forEach(function(a,
e){h.push(f._getResultsFromSource(b,e,c))}):h.push(this._getResultsFromSource(b,A,c));return B.eachAlways(h)};c.prototype._getSuggestionsFromSources=function(b,c){var f=this,e=this.allSources,A=this.activeSourceIndex,h=[];if(!e.length)return e=new a("suggest:no-sources-defined","At least one source is required.",{allSources:e}),M.error(e),B.reject(e);-1===A?e.forEach(function(a,e){h.push(f._getSuggestionsFromSource(b,e,c))}):h.push(this._getSuggestionsFromSource(b,A,c));return B.eachAlways(h)};c.prototype._getResultsFromSource=
function(a,b,c){var f=this.allSources.getItemAt(b),e=a.location,e=void 0===e?null:e,h=this.get("view.spatialReference")||Q,d=J(f,"maxResults")?f.maxResults:this.maxResults,r=f instanceof A&&J(f,"exactMatch")?f.exactMatch:!1;return f.getResults({view:this.view,sourceIndex:b,location:e,suggestResult:a,spatialReference:h,exactMatch:r,maxResults:d},c)};c.prototype._getSuggestionsFromSource=function(a,b,c){var f=this.allSources.getItemAt(b),e=J(f,"suggestionsEnabled")?f.suggestionsEnabled:this.suggestionsEnabled,
A=a.length,h=J(f,"minSuggestCharacters")?f.minSuggestCharacters:this.minSuggestCharacters;return e&&a.trim()&&A>=h?(e=this.get("view.spatialReference")||Q,A=J(f,"maxSuggestions")?f.maxSuggestions:this.maxSuggestions,f.getSuggestions({view:this.view,sourceIndex:b,suggestTerm:a,spatialReference:e,maxSuggestions:A},c)):B.resolve()};c.prototype.createDefaultSymbol=function(a,b){if("point"===b)return new K({color:a.color,size:a.size,outline:{color:a.outline.color,width:a.outline.width}});if("polyline"===
b)return new G({color:a.color,width:a.width});if("polygon"===b)return new H({color:a.color,outline:{color:a.outline.color,width:a.outline.width}})};c.prototype._getLayerSourcePopupTemplate=function(a){var b=a.layer;if(b)return J(a,"popupTemplate")?a.popupTemplate:b.popupTemplate};c.prototype._getSourceIndexOfResult=function(a){var b=null;this.results.some(function(c){return c.results.some(function(f){return f===a?(b=c.sourceIndex,!0):!1})});return b};c.prototype._getGoToTarget=function(a,b){var c=
a.extent;a=a.feature;return b instanceof A?a||c:c||a};c.prototype._goToSearchResult=function(a){return g(this,void 0,void 0,function(){var b,c,f;return n(this,function(e){switch(e.label){case 0:return b=!!a,this._abortGoTo(),this._gotoController=c=B.createAbortController(),f={target:{target:a},options:{animate:b,signal:c.signal}},[4,this.callGoTo(f)];case 1:return e.sent(),this._gotoController=null,[2]}})})};c.prototype._whenViewAndPortalLoaded=function(){var a=this.includeDefaultSources,b=this.portal,
c=this.view,c=c?c.when():B.resolve(),a=b&&a?b.when():B.resolve();return B.eachAlways([c,a]).then(function(){})};c.prototype._loadDefaultSources=function(){return g(this,void 0,void 0,function(){var a,b,c=this;return n(this,function(f){switch(f.label){case 0:return this._loadingDefaultSources=b=(a=this.includeDefaultSources)?this._whenViewAndPortalLoaded():B.resolve(),this.notifyChange("state"),[4,b.catch(function(){}).then(function(){c._loadingDefaultSources===b&&(c._clearLoadingDefaultSources(),
c._updateDefaultSources())})];case 1:return f.sent(),[2]}})})};c.prototype._getDefaultSymbol=function(a){var b=this.get("view.map.basemap.id");a=q.get(a,"feature","geometry","type");return q.isSome(a)&&(b=(b=E.getSchemes({basemap:b,geometryType:a})||E.getSchemes({basemap:"topo",geometryType:a}))&&b.primaryScheme)?(b.color&&J(b,"opacity")&&(b.color.a=b.opacity),this.createDefaultSymbol(b,a)):this.defaultSymbol};c.prototype._removeHighlight=function(){this._handles.remove("highlight")};c.prototype._getLayerView=
function(a){return g(this,void 0,void 0,function(){var b,c;return n(this,function(f){switch(f.label){case 0:b=this.view;if(!a||!b)return[2,B.resolve(null)];c=a.layer;return[4,b.when()];case 1:return f.sent(),[2,b.whenLayerView(c)]}})})};c.prototype._highlightFeature=function(a){var b=a.graphic,c=b.attributes,f=b.layer.objectIdField;a=a.layerView.highlight(c&&c[f]||b);this._handles.add(a,"highlight")};c.ALL_INDEX=-1;d([t.property({readOnly:!0,dependsOn:["activeSourceIndex","allSources.length"],value:null})],
c.prototype,"activeSource",null);d([t.property({dependsOn:["allSources.length","searchAllEnabled"]})],c.prototype,"activeSourceIndex",null);d([t.property()],c.prototype,"allPlaceholder",void 0);d([t.property({dependsOn:["defaultSources.length","sources.length","includeDefaultSources"],readOnly:!0})],c.prototype,"allSources",null);d([t.property()],c.prototype,"autoNavigate",void 0);d([t.property()],c.prototype,"autoSelect",void 0);d([t.property({readOnly:!0})],c.prototype,"defaultSources",void 0);
d([t.property()],c.prototype,"defaultSymbol",void 0);d([t.property()],c.prototype,"includeDefaultSources",void 0);d([t.property()],c.prototype,"locationEnabled",null);d([t.property()],c.prototype,"maxInputLength",void 0);d([t.property()],c.prototype,"maxResults",void 0);d([t.property()],c.prototype,"maxSuggestions",void 0);d([t.property()],c.prototype,"minSuggestCharacters",void 0);d([t.property({readOnly:!0,dependsOn:["activeSourceIndex","activeSource.placeholder","allPlaceholder","allSources"]})],
c.prototype,"placeholder",null);d([t.property()],c.prototype,"popupEnabled",void 0);d([t.property({type:e})],c.prototype,"popupTemplate",void 0);d([t.property({type:F})],c.prototype,"portal",void 0);d([t.property()],c.prototype,"resultGraphicEnabled",void 0);d([t.property({readOnly:!0})],c.prototype,"resultGraphic",void 0);d([t.property({readOnly:!0})],c.prototype,"results",void 0);d([t.property({readOnly:!0})],c.prototype,"selectedSuggestion",void 0);d([t.property()],c.prototype,"searchAllEnabled",
void 0);d([t.property({readOnly:!0})],c.prototype,"selectedResult",void 0);d([t.property()],c.prototype,"searchTerm",null);d([t.property({type:P})],c.prototype,"sources",void 0);d([t.property({readOnly:!0,dependsOn:["allSources.length"]})],c.prototype,"state",null);d([t.property()],c.prototype,"suggestionDelay",void 0);d([t.property({readOnly:!0})],c.prototype,"suggestions",void 0);d([t.property()],c.prototype,"suggestionsEnabled",void 0);d([t.property()],c.prototype,"view",void 0);d([t.property()],
c.prototype,"clear",null);return c=d([t.subclass("esri.widgets.Search.SearchViewModel")],c)}(t.declared(U.GoToMixin(f.EventedMixin(h))))})},"esri/core/geolocationUtils":function(){define("require exports ./tsSupport/assignHelper ../config ./Error ./has ./Logger ./promiseUtils ../geometry/Point ../geometry/support/webMercatorUtils ../portal/Portal ../tasks/GeometryService ../tasks/support/ProjectParameters".split(" "),function(u,m,p,d,n,g,l,k,e,h,c,a,f){function b(b,c,e){if(!c)return k.resolve(b);
var d=c.spatialReference;return d.isWGS84?k.resolve(b):d.isWebMercator?k.resolve(h.geographicToWebMercator(b)):x(e).then(function(c){if(!c)throw new n("geometry-service:missing-url","Geometry service URL is missing");c=new a({url:c});var h=new f({geometries:[b],outSR:d});return c.project(h,e).then(function(a){return a[0]})})}function x(a){if(d.geometryServiceUrl)return k.resolve(d.geometryServiceUrl);var b=c.getDefault();return b.load(a).catch(function(){}).then(function(){return b.get("helperServices.geometry.url")})}
Object.defineProperty(m,"__esModule",{value:!0});var v=l.getLogger("esri.core.geolocationUtils"),y={maximumAge:0,timeout:15E3,enableHighAccuracy:!0};m.supported=function(){var a=g("esri-geolocation");a||v.warn("geolocation-unsupported","Geolocation unsupported.");a&&((a=g("esri-secure-context"))||v.warn("insecure-context","Geolocation requires a secure origin."));return a};m.getCurrentPosition=function(a){a||(a=y);return k.create(function(b,c){setTimeout(function(){return c(new n("geolocation:timeout",
"getting the current geolocation position timed out"))},15E3);navigator.geolocation.getCurrentPosition(b,c,a)})};m.positionToPoint=function(a,c){var f=a.position;a=a.view;var h=f&&f.coords||{},h={accuracy:h.accuracy,altitude:h.altitude,altitudeAccuracy:h.altitudeAccuracy,heading:h.heading,latitude:h.latitude,longitude:h.longitude,speed:h.speed},f=f?{coords:h,timestamp:f.timestamp}:f;f=(f=f&&f.coords)?new e({longitude:f.longitude,latitude:f.latitude,z:f.altitude||null,spatialReference:{wkid:4326}}):
null;return b(f,a,c)}})},"esri/renderers/smartMapping/symbology/location":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/assignHelper ../../../Color ./support/SymbologyBase ./support/utils".split(" "),function(u,m,p,d,n,g,l){function k(e,c){var a="mesh"!==e.geometryType&&e.worldScale?e.view:null;switch(e.geometryType){case "point":case "multipoint":e=c.color;var f=d({},c.outline);c=c.size;return{color:new n(e),outline:{color:new n(f.color),width:f.width},
size:a?l.toWorldScale(c,a):c,opacity:1};case "polyline":return e=c.width,{color:new n(c.color),width:a?l.toWorldScale(e,a):e,opacity:1};case "polygon":e=c.size;var f=c.color,b=d({},c.outline);c=c.opacity;return{color:new n(f),outline:{color:new n(b.color),width:b.width},size:a?l.toWorldScale(e,a):e,opacity:c};case "mesh":return a=c.opacity,{color:new n(c.color),opacity:a}}}var e={default:{name:"default",label:"Default",description:"Default theme for basic visualization of features.",schemes:{point:{light:{primary:{color:[77,
77,77,1],outline:{color:[255,255,255,.25],width:"1px"},size:"8px"},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,.25],width:"1px"},size:"8px"},{color:[255,255,255,1],outline:{color:[51,51,51,.25],width:"1px"},size:"8px"}]},dark:{primary:{color:[255,255,255,1],outline:{color:[92,92,92,.25],width:"1px"},size:"8px"},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,.25],width:"1px"},size:"8px"},{color:[26,26,26,1],outline:{color:[178,178,178,.25],width:"1px"},size:"8px"}]}},
polyline:{light:{primary:{color:[77,77,77,1],width:"2px"},secondary:[{color:[226,119,40,1],width:"2px"},{color:[255,255,255,1],width:"2px"}]},dark:{primary:{color:[255,255,255,1],width:"2px"},secondary:[{color:[226,119,40,1],width:"2px"},{color:[26,26,26,1],width:"2px"}]}},polygon:{light:{primary:{size:"12px",color:[227,139,79,1],outline:{color:[255,255,255,.25],width:"1px"},opacity:.8},secondary:[{size:"12px",color:[128,128,128,1],outline:{color:[255,255,255,.25],width:"1px"},opacity:.8},{size:"12px",
color:[255,255,255,1],outline:{color:[128,128,128,.25],width:"1px"},opacity:.8}]},dark:{primary:{size:"12px",color:[227,139,79,1],outline:{color:[92,92,92,.25],width:"1px"},opacity:.8},secondary:[{size:"12px",color:[178,178,178,1],outline:{color:[92,92,92,.25],width:"1px"},opacity:.8},{size:"12px",color:[26,26,26,1],outline:{color:[128,128,128,.25],width:"1px"},opacity:.8}]}}}}};return new (function(h){function c(){return h.call(this,{themeDictionary:e})||this}p(c,h);c.prototype.getSchemes=function(a){var c=
this.getRawSchemes({theme:"default",basemap:a.basemap,geometryType:a.geometryType,basemapTheme:a.basemapTheme});if(c){var b=c.schemesInfo,e=c.basemapId,c=c.basemapTheme;return{primaryScheme:k(a,b.primary),secondarySchemes:b.secondary.map(function(b){return k(a,b)}).filter(Boolean),basemapId:e,basemapTheme:c}}};c.prototype.cloneScheme=function(a){if(a)return a=d({},a),a.color&&(a.color=new n(a.color)),"outline"in a&&a.outline&&(a.outline={color:a.outline.color&&new n(a.outline.color),width:a.outline.width}),
a};return c}(g))})},"esri/renderers/smartMapping/symbology/support/SymbologyBase":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","../../../../core/tsSupport/restHelper","./Theme"],function(u,m,p,d,n){return function(){function g(d){this.themes=null;d=d.themeDictionary;var k=new Map,e;for(e in d)k.set(e,new n(d[e]));this.themes=k}g.prototype.getThemes=function(d){var k=[];this.themes.forEach(function(e){e.isBasemapSupported(d)&&k.push({name:e.name,label:e.label,description:e.description,
basemaps:e.supportedBasemaps.slice()})});return k};g.prototype.filterSchemesByName=function(g){var k=g.name;g=d(g,["name"]);if(k){var e=this.getSchemes(g);if(e){g=null;for(var h=0,e=[e.primaryScheme].concat(e.secondarySchemes);h<e.length;h++){var c=e[h];if(c.name.toLowerCase()===k.toLowerCase()){g=c;break}}return g}}};g.prototype.filterSchemesByTag=function(g){var k=g.includedTags,e=g.excludedTags;g=d(g,["includedTags","excludedTags"]);if(!k&&!e)return[];var h=this.getSchemes(g);if(!h)return[];var c=
!(k&&k.length),a=!(e&&e.length),f=[];g=function(b){var h=c?!0:k.some(function(a){return-1<b.tags.indexOf(a)}),d=!a&&e.some(function(a){return-1<b.tags.indexOf(a)});h&&!d&&f.push(b)};for(var b=0,h=[h.primaryScheme].concat(h.secondarySchemes);b<h.length;b++)g(h[b]);return f};g.prototype.getRawSchemes=function(d){var k=this.themes.get(d.theme);if(k)return k.getRawSchemes({basemap:d.basemap,geometryType:d.geometryType,basemapTheme:d.basemapTheme})};return g}()})},"esri/core/tsSupport/restHelper":function(){define([],
function(){return function(u,m){var p={},d;for(d in u)Object.prototype.hasOwnProperty.call(u,d)&&0>m.indexOf(d)&&(p[d]=u[d]);if(null!=u&&"function"===typeof Object.getOwnPropertySymbols){var n=0;for(d=Object.getOwnPropertySymbols(u);n<d.length;n++)0>m.indexOf(d[n])&&(p[d[n]]=u[d[n]])}return p}})},"esri/renderers/smartMapping/symbology/support/Theme":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/lang ../../../../core/maybe ../../support/utils".split(" "),
function(u,m,p,d,n,g){return function(){function l(d){this.schemes=this.basemapGroups=this.supportedBasemaps=this.description=this.label=this.name=null;var e=d.label,h=d.description,c=d.schemes;this.name=d.name;this.label=e;this.description=h;this.schemes=c;d=d.basemapGroups||g.defaultBasemapGroups;e=[];if(d)for(var a in d)e=e.concat(d[a]);this.supportedBasemaps=e;this.basemapGroups=d}l.prototype.isBasemapSupported=function(d){return(d=g.getBasemapId(d,this.supportedBasemaps))&&-1<this.supportedBasemaps.indexOf(d)?
!0:!1};l.prototype.getRawSchemes=function(k){var e,h=k.basemap;e=k.basemapTheme;var c=null,a=null;h&&(c=g.getBasemapId(h,this.supportedBasemaps,!1))&&(h=g.getBasemapGroup(c),n.isSome(h)&&(a=h));!c&&e&&(c="dark"===e?"dark-gray":"gray",a=e);c||a||(c="gray",a="light");e=c;c=a;e&&(h=g.getBasemapGroup(e,this.basemapGroups),n.isSome(h)&&(c=h));k=k.geometryType;"multipoint"===k?k="point":"mesh"===k&&(k="polygon");return{schemesInfo:d.clone((this.schemes[k]||this.schemes["default"])[c]),basemapId:e,basemapTheme:a}};
return l}()})},"esri/renderers/smartMapping/support/utils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Basemap ../../../core/string ./adapters/CSVLayerAdapter ./adapters/FeatureLayerAdapter ./adapters/LayerAdapter ./adapters/PointCloudLayerAdapter ./adapters/SceneLayerAdapter ../../../support/arcadeOnDemand ../../../support/basemapUtils".split(" "),function(u,m,p,d,n,g,l,k,e,h,c,a,f){function b(a){return g.padStart(a,2,
"0")}function x(a,c,f){if("date"===c||"number"===c){"number"===c&&(a=new Date(a));c=f?a.getFullYear():a.getUTCFullYear();var e=b((f?a.getMonth():a.getUTCMonth())+1),d=b(f?a.getDate():a.getUTCDate()),h=b(f?a.getHours():a.getUTCHours()),r=b(f?a.getMinutes():a.getUTCMinutes());a=b(f?a.getSeconds():a.getUTCSeconds());a="TIMESTAMP'"+c+"-"+e+"-"+d+" "+h+":"+r+":"+a+"'"}return a}function v(a,b){if(b instanceof Date)return"date";if("number"===typeof b)return"number";if("string"===typeof b&&(a=a.getField(b),
"\x3cnow\x3e"!==b.toLowerCase()&&a&&"date"===a.type))return"field"}Object.defineProperty(m,"__esModule",{value:!0});var y;m.defaultBasemapGroups={light:"streets gray topo terrain national-geographic oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector".split(" "),dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"]};var q=(y={},y[0]={adapter:l,type:"csv",label:"CSVLayer"},y[2]={adapter:k,type:"feature",label:"FeatureLayer"},
y[1]={adapter:k,type:"geojson",label:"GeoJSONLayer"},y[3]={adapter:c,type:"scene",label:"SceneLayer"},y[4]={adapter:h,type:"point-cloud",label:"PointCloudLayer"},y),B=[0,2,1,3,4];m.unitValueInDays={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864E5};var C=["integer","small-integer"],t=null;m.getLayerTypeLabels=function(a){return a.map(function(a){return q[a].label})};m.createLayerAdapter=function(a,b){void 0===b&&(b=B);if(a instanceof e)return a;var c=null;b.some(function(b){var f=
a.type===q[b].type;f&&(c=new q[b].adapter({layer:a}));return f});return c};m.getFieldsList=function(b){return d(this,void 0,void 0,function(){var c,f,e,d,h;return p(this,function(g){switch(g.label){case 0:return c=b.field,f=b.normalizationField,e=b.valueExpression,d=[],e?t?[3,2]:[4,a.loadArcade()]:[3,3];case 1:t=h=g.sent().arcadeUtils,g.label=2;case 2:d=t.extractFieldNames(e),g.label=3;case 3:return c&&d.push(c),f&&d.push(f),[2,d]}})})};m.getNormalizationType=function(a){var b=a.normalizationType;
b||(a.normalizationField?b="field":null!=a.normalizationTotal&&(b="percent-of-total"));return b};m.getDateDiffSQL=function(a,b,c,f){var e=a.hasQueryEngine;c=x(c,v(a,c),e);a=x(b,v(a,b),e);a="("+c+" - "+a+")";e&&(a="("+a+" * "+m.unitValueInDays.milliseconds+")");f=m.unitValueInDays[f];e="/";1>f&&(f=1/f,e="*");return{sqlExpression:1===f?a:"("+a+" "+e+" "+f+")",sqlWhere:null}};m.getDateType=v;m.getBasemapGroup=function(a,b){void 0===b&&(b=m.defaultBasemapGroups);for(var c in b)if(-1<b[c].indexOf(a))return c};
m.getBasemapId=function(a,b,c){void 0===c&&(c=!0);var e=null;"string"===typeof a&&-1<b.indexOf(a)?e=a:a instanceof n&&(e=f.getWellKnownBasemapId(a));return c?e||"gray":e};m.isIntegerField=function(a,b){return(a=b&&a.getField(b))&&-1<C.indexOf(a.type)};m.castIntegerFieldToFloat=function(a){return"cast("+a+" as float)"}})},"esri/renderers/smartMapping/support/adapters/CSVLayerAdapter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../statistics/support/utils ../utils ./FeatureLayerAdapter ./support/utils ../../../../tasks/support/generateRendererUtils".split(" "),
function(u,m,p,d,n,g,l,k,e,h,c,a,f,b){function x(a){return"esri.tasks.support.ClassBreaksDefinition"===a.declaredClass}function v(a){return"esri.tasks.support.UniqueValueDefinition"===a.declaredClass}return function(a){function q(b){return a.call(this,b)||this}p(q,a);q.prototype._createGenerateRendererResult=function(a,c,e,d,h){return g(this,void 0,void 0,function(){var g,k,r,q,w;return n(this,function(n){switch(n.label){case 0:k=(g=a&&a.features)&&g.length;if(!k)throw new l("csv-layer-adapter:insufficient-data",
"No features are available to calculate statistics");r=null;return"percent-of-total"!==d?[3,2]:[4,f.calculateStatsFromMemory({field:c},g)];case 1:q=n.sent();r=q.sum;if(null==r)throw new l("csv-layer-adapter:invalid","invalid normalizationTotal");n.label=2;case 2:return x(h)?[4,f.getDataValues({field:c,normalizationType:d,normalizationField:e,normalizationTotal:r},g)]:[3,4];case 3:return w=n.sent().filter(function(a){return null!=a&&f.isValidNumber(a)}),[2,b.createGenerateRendererClassBreaks({definition:h,
values:w,normalizationTotal:r})];case 4:return v(h)?[4,f.getDataValues({field:c},g)]:[3,6];case 5:return w=n.sent().filter(function(a){return null!=a&&"string"===typeof a&&""!==a.trim()}),[2,b.createGenerateRendererUniqueValues(w)];case 6:return[2,void 0]}})})};q.prototype.generateRenderer=function(a,b){var f=this,e=a.classificationDefinition,d=null,g=null,k=null;x(e)?(d=e.classificationField,g=e.normalizationField,k=e.normalizationType):v(e)&&(d=e.attributeField);var q=this.layer;return c.getFieldsList({field:d,
normalizationField:g}).then(function(c){var r=q.createQuery();r.returnGeometry=!1;r.outFields=c;r.where=h.mergeWhereClauses(r.where,a.where);return q.queryFeatures(r,{signal:b}).then(function(a){return f._createGenerateRendererResult(a,d,g,k,e)})})};q.prototype.load=function(a){var b=this;a=this.layer.load(a).then(function(a){b.geometryType=a.geometryType;b.objectIdField=a.objectIdField;b.supportsSQLExpression=!0;b._hasLocalSource=!1;b.hasQueryEngine=!0});this.addResolvingPromise(a);return k.resolve(this)};
return q=d([e.subclass("esri.renderers.smartMapping.support.adapters.CSVLayerAdapter")],q)}(e.declared(a))})},"esri/renderers/smartMapping/statistics/support/utils":function(){define(["require","exports","../../../../core/Error","../../../../layers/support/fieldUtils"],function(u,m,p,d){function n(e,d){return new p(e,d)}function g(e,d){d&&(e=e?"("+e+") AND ("+d+")":d);return e}function l(e){var d=e.layer;return e.fields.filter(function(c){return!d.getField(c)})}function k(e){var d=e.layer;return e.fields.filter(function(c){c=
d.getFieldUsageInfo(c);return!c||!c.supportsStatistics})}Object.defineProperty(m,"__esModule",{value:!0});m.getSQLFilterForNormalization=function(e){var d=e.field,c=e.normalizationType;e=e.normalizationField;var a;"log"===c?a="(NOT "+d+" \x3d 0)":"field"===c&&(a="(NOT "+e+" \x3d 0)");return a};m.createError=n;m.getRangeExpr=function(e,d,c){d=null!=d?e+" \x3e\x3d "+d:"";e=null!=c?e+" \x3c\x3d "+c:"";c="";return(c=d&&e?g(d,e):d||e)?"("+c+")":""};m.verifyFieldType=function(e,d,c,a){var f=null;if(!d)f=
n(c,"'field' is not defined in the layer schema");else if(d.name===e.objectIdField||-1===a.indexOf(d.type))f=n(c,"'field' should be one of these types: "+a.join(","));return f};m.verifyNumericField=function(e,h,c){var a;h?h.name!==e.objectIdField&&d.isNumericField(h)||(a=n(c,"'field' should be one of these numeric types: "+d.numericTypes.join(","))):a=n(c,"'field' is not defined in the layer schema");return a};m.mergeWhereClauses=g;m.verifyBasicFieldValidity=function(e,d,c){var a=l({layer:e,fields:d});
if(a.length)return n(c,"Unknown fields: "+a.join(", ")+". You can only use fields defined in the layer schema");e=k({layer:e,fields:d});if(e.length)return n(c,"Unsupported fields: "+e.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true")}})},"esri/renderers/smartMapping/support/adapters/FeatureLayerAdapter":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry ../../../../core/arrayUtils ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/quantizationUtils ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/arcgisLayerUrl ../../../../layers/support/fieldUtils ../../statistics/support/predominanceUtils ../../statistics/support/utils ../utils ./LayerAdapter ./support/utils ../../../../tasks/GenerateRendererTask ../../../../tasks/support/GenerateRendererParameters ../../../../tasks/support/QuantizationParameters ../../../../tasks/support/Query ../../../../tasks/support/StatisticDefinition ../../../../tasks/support/UniqueValueDefinition".split(" "),
function(u,m,p,d,n,g,l,k,e,h,c,a,f,b,x,v,y,q,B,C,t,r,w,F,E,D,H,G,K){return function(r){function z(a){return r.call(this,a)||this}d(z,r);z.prototype.destroy=function(){this._hasLocalSource=null};z.prototype._isStatsSupportedOnService=function(){var b=this.layer;return!b.get("capabilities.query.supportsStatistics")||"multipatch"===this.geometryType&&!y.isHostedAgolService(b.url)&&10.5>b.version?a.reject(new h("feature-layer-adapter:not-supported","Layer does not support statistics query")):a.resolve()};
z.prototype._fetchFeaturesFromMemory=function(a,b,c){return l(this,void 0,void 0,function(){var e,d,A,k;return g(this,function(g){switch(g.label){case 0:return e=this.layer,this._hasLocalSource?[4,e.queryFeatures(b)]:[3,2];case 1:return d=g.sent(),[2,d.features];case 2:if(!a)throw new h("feature-layer-adapter:insufficient-data","view is required to fetch the features from layerView");return[4,a.whenLayerView(e)];case 3:return A=g.sent(),[4,f.whenFalseOnce(A,"updating")];case 4:return g.sent(),[4,
A.queryFeatures(b,{signal:c})];case 5:return k=g.sent(),[2,k.features]}})})};z.prototype._fetchFeaturesFromService=function(a,b){return this.layer.queryFeatures(a,{signal:b}).then(function(a){return a&&a.features})};z.prototype._fetchFeaturesForStats=function(a){var b=this;return t.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression}).then(function(c){return b.getSampleFeatures({sampleSize:-1,view:a.view,requiredFields:c,signal:a.signal})})};z.prototype._hasRequiredFieldsInView=
function(a,b){return l(this,void 0,void 0,function(){var c,e,d=this;return g(this,function(A){switch(A.label){case 0:return[4,b.whenLayerView(this.layer)];case 1:return c=A.sent(),[4,f.whenFalseOnce(c,"updating")];case 2:return A.sent(),e=!0,a&&a.length&&(e=a.every(function(a){a=d.getField(a);return-1<c.availableFields.indexOf(a.name)})),[2,e]}})})};z.prototype._summaryStatsFromGenRend=function(a){var b=a.normalizationType,c=a.normalizationField;return this.classBreaks({field:a.field,numClasses:5,
classificationMethod:"standard-deviation",standardDeviationInterval:.25,normalizationType:b,normalizationField:"field"===b?c:void 0,minValue:a.minValue,maxValue:a.maxValue,signal:a.signal}).then(function(a){var b,c,f;a.classBreakInfos.some(function(a){a.hasAvg&&(b=a);return!!b});b&&(f=b.maxValue-b.minValue,c=b.minValue+f/2,f*=4);return w.processSummaryStatisticsResult({min:a.minValue,max:a.maxValue,avg:c,stddev:f})})};z.prototype._getSummaryStatsQuery=function(a,b){var c=a.field,f=a.normalizationType,
e=a.normalizationField,d=a.normalizationTotal;b=this.supportsSQLExpression&&b?w.msSinceUnixEpochSQL(this,c):a.sqlExpression;var d=w.getFieldExpr({field:c,normalizationType:f,normalizationField:e,normalizationTotal:d,layer:this}),h=b||d,d=h?C.getRangeExpr(h,a.minValue,a.maxValue):null,c=C.getSQLFilterForNormalization({field:c,normalizationField:e,normalizationType:f});a=C.mergeWhereClauses(a.sqlWhere,c);a=C.mergeWhereClauses(a,d);c=this.layer.createQuery();c.where=C.mergeWhereClauses(c.where,a);c.sqlFormat=
b?"standard":null;c.outStatistics=w.statisticTypes.map(function(a){var b=new G;b.statisticType="variance"===a?"var":a;b.onStatisticField=h;b.outStatisticFieldName=a+"_value";return b});return c};z.prototype._summaryStatsFromServiceQuery=function(a,b){return l(this,void 0,void 0,function(){var c,f,e,d;return g(this,function(h){switch(h.label){case 0:return[4,this._isStatsSupportedOnService()];case 1:h.sent();if("percent-of-total"!==a.normalizationType)return[3,3];c=a;return[4,this._getNormalizationTotal(a.field,
a.normalizationType)];case 2:c.normalizationTotal=h.sent(),h.label=3;case 3:return f=this._getSummaryStatsQuery(a,b),[4,this.layer.queryFeatures(f,{signal:a.signal})];case 4:return e=h.sent(),d=w.getSummaryStatisticsFromFeatureSet(e,b),[2,w.processSummaryStatisticsResult(d)]}})})};z.prototype._summaryStatsFromClientQuery=function(a,b){return l(this,void 0,void 0,function(){var c,e,d,A,k,r,q,l,v;return g(this,function(g){switch(g.label){case 0:c=a.view;e=a.signal;if(!c)throw new h("feature-layer-adapter:insufficient-data",
"view is required to query stats from layerView");return[4,c.whenLayerView(this.layer)];case 1:return d=g.sent(),[4,f.whenFalseOnce(d,"updating")];case 2:return g.sent(),[4,t.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression})];case 3:return A=g.sent(),[4,this._hasRequiredFieldsInView(A,c)];case 4:return k=g.sent(),r=this._getSummaryStatsQuery(a,b),!this._hasLocalSource||k?[3,6]:[4,this.layer.queryFeatures(r,{signal:e})];case 5:return l=g.sent(),
[3,8];case 6:return[4,d.queryFeaturesJSON(r,{signal:e})];case 7:l=g.sent(),g.label=8;case 8:return q=l,v=w.getSummaryStatisticsFromFeatureSet(q,b),[2,w.processSummaryStatisticsResult(v)]}})})};z.prototype._summaryStatsFromMemory=function(a,b){return l(this,void 0,void 0,function(){var c,f,e,d,A,k,r,q,l,v,x;return g(this,function(g){switch(g.label){case 0:return c=a.field,f=a.valueExpression,e=a.view,d={field:c,valueExpression:f,normalizationField:a.normalizationField,view:e,signal:a.signal},(k=a.features)?
[3,2]:[4,this._fetchFeaturesForStats(d)];case 1:k=g.sent(),g.label=2;case 2:r=(A=k)&&A.length;if(!r)throw new h("feature-layer-adapter:insufficient-data","No features are available to calculate statistics");q=p({},a);return"percent-of-total"!==q.normalizationType?[3,4]:[4,w.calculateStatsFromMemory({field:c},A)];case 3:l=g.sent();v=l.sum;if(null==v)throw new h("feature-layer-adapter:invalid","invalid normalizationTotal");q.normalizationTotal=v;g.label=4;case 4:return[4,w.calculateStatsFromMemory(q,
A,b)];case 5:return x=g.sent(),[2,w.processSummaryStatisticsResult(x)]}})})};z.prototype._uvFromGenRenderer=function(a,b){var c=this,f=a.field,e=new K;e.attributeField=f;var d=new E;d.classificationDefinition=e;return this.generateRenderer(d,a.signal).then(function(a){var b={},e=c.getField(f);a.uniqueValues.forEach(function(a){var c=a.value;if(null==c||""===c||"string"===typeof c&&(""===c.trim()||"\x3cnull\x3e"===c.toLowerCase()))c=null;null==b[c]?b[c]={count:a.count,data:q.isNumericField(e)&&c?Number(c):
c}:b[c].count+=a.count});return{count:b}}).then(function(c){return w.createUVResult(c,b,a.returnAllCodedValues)})};z.prototype._getUVQuery=function(a){var b=a.field,c=a.sqlExpression,f="countOF"+(b||"Expr"),e=new G;e.statisticType="count";e.onStatisticField=c?"1":b;e.outStatisticFieldName=f;f=this.layer.createQuery();f.where=C.mergeWhereClauses(f.where,a.sqlWhere);f.sqlFormat=c?"standard":null;f.outStatistics=[e];f.groupByFieldsForStatistics=[b||c];return f};z.prototype._uvFromServiceQuery=function(a,
b){var c=this;return this._isStatsSupportedOnService().then(function(){return c.layer.queryFeatures(c._getUVQuery(a),{signal:a.signal})}).then(function(b){return w.getUniqueValuesFromFeatureSet(b,c,a.field,null,a.signal)}).then(function(c){return w.createUVResult(c,b,a.returnAllCodedValues)})};z.prototype._uvFromClientQuery=function(a,b){return l(this,void 0,void 0,function(){var c,e,d,A,k;return g(this,function(g){switch(g.label){case 0:c=a.view;e=a.signal;if(!c)throw new h("feature-layer-adapter:insufficient-data",
"view is required to query stats from layerView");return[4,c.whenLayerView(this.layer)];case 1:return d=g.sent(),[4,f.whenFalseOnce(d,"updating")];case 2:return g.sent(),[4,d.queryFeaturesJSON(this._getUVQuery(a),{signal:e})];case 3:return A=g.sent(),[4,w.getUniqueValuesFromFeatureSet(A,this,a.field,null,a.signal)];case 4:return k=g.sent(),[2,w.createUVResult(k,b,a.returnAllCodedValues)]}})})};z.prototype._uvFromMemory=function(a,b){return l(this,void 0,void 0,function(){var c,f,e,d,h,A,k;return g(this,
function(g){switch(g.label){case 0:c=a.field;f=a.valueExpression;e=a.view;d=a.signal;h={field:c,valueExpression:f,view:e,signal:d};if(!a.features)return[3,1];k=a.features;return[3,3];case 1:return[4,this._fetchFeaturesForStats(h)];case 2:k=g.sent(),g.label=3;case 3:return A=k,[2,w.calculateUniqueValuesFromMemory(a,A,b)]}})})};z.prototype._calcBinsSQL=function(a,b){var c=[],f=b.length;b.forEach(function(b,e){b=C.mergeWhereClauses(a+" \x3e\x3d "+b[0],a+(e===f-1?" \x3c\x3d ":" \x3c ")+b[1]);c.push("WHEN ("+
b+") THEN "+(e+1))});return["CASE",c.join(" "),"ELSE 0 END"].join(" ")};z.prototype._getNormalizationTotal=function(b,c,f){return b&&"percent-of-total"===c?this.summaryStatistics({field:b,signal:f}).then(function(a){return a.sum}):a.resolve(null)};z.prototype._getQueryParamsForExpr=function(a,b){var c=a.signal;if(!a.valueExpression&&!a.sqlExpression){var f=a.field,e=f?this.getField(f):null,e=q.isDateField(e);b={field:f,normalizationType:a.normalizationType,normalizationField:a.normalizationField,
normalizationTotal:b,layer:this};return{sqlExpression:e?w.msSinceUnixEpochSQL(this,f):w.getFieldExpr(b),sqlWhere:e?null:a.sqlWhere||C.getSQLFilterForNormalization(a),signal:c}}return{valueExpression:a.valueExpression,sqlExpression:a.sqlExpression,sqlWhere:a.sqlWhere,signal:c}};z.prototype._getDataRange=function(b,c,f){return null!=c&&null!=f?a.resolve({min:c,max:f}):this.summaryStatistics(b).then(function(a){return{min:a.min,max:a.max}})};z.prototype._histogramForExpr=function(a){var b=this;return this._getNormalizationTotal(a.field,
a.normalizationType,a.signal).then(function(c){var f=b._getQueryParamsForExpr(a,c);return b._getDataRange(f,a.minValue,a.maxValue).then(function(e){var d=e.min,h=e.max,g=a.numBins||10;e=w.getEqualIntervalBins(d,h,g);e=b._calcBinsSQL(f.sqlExpression,e);var k=new G({statisticType:"count",outStatisticFieldName:"countOFExpr",onStatisticField:"1"}),A=b.layer.createQuery();A.where=C.mergeWhereClauses(A.where,f.sqlWhere);A.sqlFormat="standard";A.outStatistics=[k];A.groupByFieldsForStatistics=[e];A.orderByFields=
[e];return b._isStatsSupportedOnService().then(function(){return b.layer.queryFeatures(A,{signal:f.signal})}).then(function(a){return w.getHistogramFromFeatureSet(a,d,h,g,c)})})})};z.prototype._histogramForField=function(b){var c=this,f=null,f=null!=b.minValue&&null!=b.maxValue?a.resolve({min:b.minValue,max:b.maxValue}):this.summaryStatistics(b).then(function(a){if(!a.count)throw new h("feature-layer-adapter:insufficient-data","Either the layer has no features or none of the features have data for the field");
return{min:a.min,max:a.max}});return f.then(function(a){return c._getBins({min:a.min,max:a.max},b.field,b.numBins,b.signal)})};z.prototype._getBins=function(a,b,c,f){void 0===c&&(c=10);var e=a.min,d=a.max,h=a.normTotal,g=a.excludeZerosExpr,k=a.intervals||w.getEqualIntervalBins(e,d,c);return this._queryBins(k,a.sqlExpr||b,g,f).then(function(a){return{bins:a.map(function(a,b){return{minValue:k[b][0],maxValue:k[b][1],count:a.value}}),minValue:e,maxValue:d,normalizationTotal:h}})};z.prototype._queryBins=
function(b,c,f,e){for(var d=this,h=[],g=b.length,k=0;k<g;k++){var A=C.mergeWhereClauses(f,C.mergeWhereClauses(c+" \x3e\x3d "+b[k][0],null!==b[k][1]?c+(k===g-1?" \x3c\x3d ":" \x3c ")+b[k][1]:""));h.push(A)}return a.eachAlways(h.map(function(a){return d.queryFeatureCount(a,e)}))};z.prototype._binParamsFromGenRend=function(a,b){var c=this,f=a.field,e=a.normalizationType,d=a.normalizationField,h=a.signal,g=C.getSQLFilterForNormalization({field:f,normalizationType:e,normalizationField:d});a=new E({classificationDefinition:w.createCBDefn({field:f,
normalizationType:e,normalizationField:d,classificationMethod:a.classificationMethod,standardDeviationInterval:a.standardDeviationInterval,breakCount:a.numBins||10}),where:C.mergeWhereClauses(g,b)});return this.generateRenderer(a,h).then(function(a){return w.generateBinParams({field:f,normalizationType:e,normalizationField:d,normalizationTotal:a.normalizationTotal,classBreaks:a.classBreaks,where:g,layer:c})})};z.prototype._histogramFromMemory=function(b){var c=this,f=b.field,e=b.normalizationType,
d=b.valueExpression,g=b.classificationMethod,k=b.minValue,r=b.maxValue,A=b.view,q=b.signal,l={field:f,valueExpression:d,normalizationField:b.normalizationField,view:A,signal:q};return(b.features?a.resolve(b.features):this._fetchFeaturesForStats(l)).then(function(l){if(!l||!l.length)throw new h("feature-layer-adapter:insufficient-data","No features are available to calculate histogram");var v=null!=k&&null!=r,x=null;g&&"equal-interval"!==g||e?(v=p({},b),v.features=l,x=c._getBinParamsFromMemory(v)):
x=v?a.resolve({min:k,max:r,source:"parameters"}):c.summaryStatistics({field:f,valueExpression:d,features:l,view:A,signal:q}).then(function(b){return b.count?{min:b.min,max:b.max}:a.reject(new h("feature-layer-adapter:insufficient-data","No features are available to calculate histogram"))});return x.then(function(a){return w.calculateHistogramFromMemory(b,a,l)})})};z.prototype._getBinParamsFromMemory=function(a){return l(this,void 0,void 0,function(){var b,c,f,e,d,h,k,r,l,q,A,v=this;return g(this,
function(g){b=a.field;c=a.valueExpression;f=a.classificationMethod;e=a.standardDeviationInterval;d=a.normalizationType;h=a.normalizationField;k=a.minValue;r=a.maxValue;l=a.features;q=a.view;A=a.signal;return[2,this._classBreaksFromMemory({field:b,valueExpression:c,normalizationType:d,normalizationField:h,classificationMethod:f,standardDeviationInterval:e,minValue:k,maxValue:r,numClasses:a.numBins,features:l,view:q,signal:A}).then(function(a){var c=a.normalizationTotal;a=a.classBreakInfos;var f=C.getSQLFilterForNormalization({field:b,
normalizationType:d,normalizationField:h});return w.generateBinParams({field:b,normalizationType:d,normalizationField:h,normalizationTotal:c,classBreaks:a,where:f,layer:v})})]})})};z.prototype._classBreaksFromGenRend=function(a){var b=a.field,c=a.normalizationType,f=a.normalizationField,e=a.normalizationTotal,d=a.signal,h=C.getSQLFilterForNormalization({field:b,normalizationType:c,normalizationField:f}),e=w.getFieldExpr({field:b,normalizationType:c,normalizationField:f,normalizationTotal:e,layer:this}),
e=C.getRangeExpr(e,a.minValue,a.maxValue),b=w.createCBDefn({field:b,normalizationType:c,normalizationField:f,classificationMethod:a.classificationMethod,standardDeviationInterval:a.standardDeviationInterval,breakCount:a.numClasses||5}),c=new E;c.classificationDefinition=b;c.where=C.mergeWhereClauses(h,e);return this.generateRenderer(c,d).then(function(b){return w.resolveCBResult(a,b)})};z.prototype._classBreaksFromInterpolation=function(b){for(var c=b.minValue,f=b.maxValue,e=b.numClasses||5,d=[],
h=(f-c)/e,g=0;g<e;g++){var k=c+g*h;d.push({minValue:k,maxValue:k+h})}d[e-1].maxValue=f;b=w.resolveCBResult(b,{classBreaks:d,normalizationTotal:b.normalizationTotal});return a.resolve(b)};z.prototype._classBreaksFromMemory=function(a){return l(this,void 0,void 0,function(){var b,c,f,e,d,k,r,l,q,v,x,A;return g(this,function(g){switch(g.label){case 0:return b=a.field,c=a.normalizationField,f=a.valueExpression,e=a.view,d=a.signal,k={field:b,valueExpression:f,normalizationField:c,view:e,signal:d},(l=a.features)?
[3,2]:[4,this._fetchFeaturesForStats(k)];case 1:l=g.sent(),g.label=2;case 2:q=(r=l)&&r.length;if(!q)throw new h("feature-layer-adapter:insufficient-data","No features are available to calculate statistics");v=p({},a);return"percent-of-total"!==v.normalizationType?[3,4]:[4,w.calculateStatsFromMemory({field:b},r)];case 3:x=g.sent();A=x.sum;if(null==A)throw new h("feature-layer-adapter:invalid","invalid normalizationTotal");v.normalizationTotal=A;g.label=4;case 4:return[2,w.calculateClassBreaksFromMemory(v,
r)]}})})};z.prototype._heatmapStatsFromMemory=function(a,b){return l(this,void 0,void 0,function(){var c,f,e,d,k,r,l,q,v,x,A,n;return g(this,function(g){switch(g.label){case 0:c=a.blurRadius;f=a.field;e=a.view;d=a.signal;k=e.state;r=k.resolution;l=k.size;q=new D.default({extent:e.extent,tolerance:r});v=new H({returnGeometry:!0,geometry:e.extent,quantizationParameters:q});if(!a.features)return[3,1];A=this._quantizeFeatures(a.features,q,e);return[3,3];case 1:return[4,this._fetchFeaturesFromMemory(e,
v,d)];case 2:A=g.sent(),g.label=3;case 3:x=A;if(!x||!x.length)return[2,{count:0,min:null,max:null,avg:null,stddev:null}];if(n=w.calculateHeatmapStats(x,c,b,f,l[0],l[1]))return[2,{count:n.count,min:n.min,max:n.max,avg:n.mean,stddev:n.stdDev}];throw new h("feature-layer-adapter:invalid","unable to calculate heatmap statistics");}})})};z.prototype._quantizeFeatures=function(a,b,f){var e=this,d=x.toQuantizationTransform(b);b=f.spatialReference;var h=f.size,g=v.isWrappable(b);f=v.getInfo(b);var r=Math.round((f.valid[1]-
f.valid[0])/d.scale[0]);return a.map(function(a){var b=new k.Point(c.unwrap(a.geometry));x.quantizePoint(d,b,b,b.hasZ,b.hasM);a.geometry=g?e._wrapPoint(b,r,h[0]):b;return a})};z.prototype._wrapPoint=function(a,b,c){0>a.x?a.x+=b:a.x>c&&(a.x-=b);return a};z.prototype.getField=function(a){void 0===a&&(a="");return this.layer.getField(a)};z.prototype.getFieldUsageInfo=function(a){return this.getField(a)?{supportsLabelingInfo:!0,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:!0,supportsStatistics:!0}:
null};z.prototype.getFieldDomain=function(a,b){return this.layer.getFieldDomain(a,b)};z.prototype.summaryStatistics=function(b){var c=this,f=b.field,f=f?this.getField(f):null,e=q.isDateField(f),d=(f=b.valueExpression||b.sqlExpression)&&!b.sqlExpression,g=b.view,g=g&&"3d"===g.type;return this._hasLocalSource||b.features||d?d||b.features||g?this._summaryStatsFromMemory(b,e):this._summaryStatsFromClientQuery(b,e):this.supportsSQLExpression||!e&&!f?(b.normalizationType&&!this.supportsSQLExpression?this._summaryStatsFromGenRend(b):
this._summaryStatsFromServiceQuery(b,e)).catch(function(){a.throwIfAborted(b.signal);return c._summaryStatsFromMemory(b,e)}):a.reject(new h("feature-layer-adapter:not-supported","Layer does not support standardized SQL expression for queries"))};z.prototype.uniqueValues=function(b){var c=this,f=b.field,e=b.valueExpression,d=b.sqlExpression,h=b.signal,g=(f?this.getField(f):null)&&this.getFieldDomain(f),k=e&&(!d||!this.supportsSQLExpression),r=(f=b.view)&&"3d"===f.type;return this._hasLocalSource||
b.features||k?k||b.features||r?this._uvFromMemory(b,g):this._uvFromClientQuery(b,g):this._uvFromServiceQuery(b,g).catch(function(f){a.throwIfAborted(h);return b.field?c._uvFromGenRenderer(b,g):f}).catch(function(){a.throwIfAborted(h);return k||b.features||r?c._uvFromMemory(b,g):c._uvFromClientQuery(b,g)})};z.prototype.histogram=function(b){var c=this,f=b.field,e=b.normalizationType,d=b.normalizationField,g=b.classificationMethod,k=b.signal,r=f?this.getField(f):null,r=q.isDateField(r),l=b.valueExpression||
b.sqlExpression,v=l&&!b.sqlExpression,x=this.supportsSQLExpression,n=!g||"equal-interval"===g,y=b.minValue,z=b.maxValue,A=null!=y&&null!=z,t=b.numBins||10;return this._hasLocalSource||b.features||v?this._histogramFromMemory(b):(l||x)&&n?l&&!x?a.reject(new h("feature-layer-adapter:not-supported","Layer does not support standardized SQL expression for queries")):this._histogramForExpr(b):r&&n?a.reject(new h("feature-layer-adapter:not-supported","Normalization and date field are not allowed when layer does not support standardized SQL expression for queries")):
e||!n?this._binParamsFromGenRend(b).then(function(a){if(!A)return c._getBins(a,f,t,k);if(y>a.max||z<a.min)throw new h("histogram:insufficient-data","Range defined by 'minValue' and 'maxValue' does not intersect available data range of the field");if(n)return c._getBins({min:y,max:z,sqlExpr:a.sqlExpr,excludeZerosExpr:a.excludeZerosExpr},f,t,k);a=w.getFieldExpr({field:f,normalizationType:e,normalizationField:d,normalizationTotal:a.normTotal,layer:c});a=C.getRangeExpr(a,y,z);return c._binParamsFromGenRend(b,
a).then(function(a){return c._getBins(a,f,t,k)})}):this._histogramForField(b)};z.prototype.classBreaks=function(b){var c=this,f=!1!==b.analyzeData,e=this._hasLocalSource||b.features||b.valueExpression;return f&&e?this._classBreaksFromMemory(b):(f?this._classBreaksFromGenRend(b):this._classBreaksFromInterpolation(b)).catch(function(){a.throwIfAborted(b.signal);return c._classBreaksFromMemory(b)})};z.prototype.queryFeatureCount=function(b,c){if(this._hasLocalSource)return a.reject(new h("feature-layer-adapter:not-supported",
"Layer does not support count query"));var f=this.layer,e=f.createQuery();e.where=C.mergeWhereClauses(e.where,b);return f.queryFeatureCount(e,{signal:c})};z.prototype.generateRenderer=function(b,c){var f=this.layer;if(this._hasLocalSource||10.1>f.version)return a.reject(new h("feature-layer-adapter:not-supported","Layer does not support generateRenderer operation (requires ArcGIS Server version 10.1+)"));var e=new F({url:f.parsedUrl.path,source:f.dynamicDataSource,gdbVersion:f.gdbVersion}),f=f.createQuery();
b.where=C.mergeWhereClauses(b.where,f.where);return e.execute(b,{signal:c})};z.prototype.heatmapStatistics=function(b){var c=this,f=b.field,e=b.fieldOffset,d=b.signal;return(f&&null==e?this.summaryStatistics({field:f,signal:d}):a.resolve(null)).then(function(a){var f=e||0;if(a){var d=a.min,h=a.max;a.count?d===h&&0===d?f=1:0>=h?f="abs":0>d&&(f=-1.01*d):f=1}return c._heatmapStatsFromMemory(b,f).then(function(b){return p({},b,{summaryStatistics:a,fieldOffset:f})})})};z.prototype.predominantCategories=
function(a){return l(this,void 0,void 0,function(){var b,c,f,e,d,k,r,l,q,v,x,n,w,y,z,A;return g(this,function(g){switch(g.label){case 0:if(!this._hasLocalSource&&!this.supportsSQLExpression)throw new h("feature-layer-adapter:not-supported","Layer does not support advanced SQL expressions and standardized queries");b=a.fields;c=a.view;f=a.signal;e=B.getArcadeForPredominantCategory(b);d=B.getSQLForPredominantCategoryName(b);return c&&this._hasLocalSource?[4,this._uvFromMemory({valueExpression:e,view:c,
signal:f})]:[3,2];case 1:return r=g.sent(),[3,4];case 2:return[4,this._uvFromServiceQuery({sqlExpression:d.expression,valueExpression:e,signal:f})];case 3:r=g.sent(),g.label=4;case 4:k=r;l=k.uniqueValueInfos;q=l.map(function(a){return a.value});v=b.filter(function(a){return-1===q.indexOf(a)});x=0;for(n=v;x<n.length;x++)w=n[x],l.push({value:w,count:0});l.sort(function(a,c){return b.indexOf(a.value)-b.indexOf(c.value)});y=0;for(z=l;y<z.length;y++)A=z[y],A.value===B.noDominantCategoryField&&(A.value=
null);return[2,{predominantCategoryInfos:l}]}})})};z.prototype.getSampleFeatures=function(b){return l(this,void 0,void 0,function(){var c,f,d,h,k,r,l,q,v,x,n,w,y,z;return g(this,function(g){switch(g.label){case 0:c=b.view,f=b.sampleSize,d=b.requiredFields,h=b.returnGeometry,k=b.signal,r=this.layer.createQuery(),l=1,r.outSpatialReference=b.spatialReference||c&&c.spatialReference,r.returnGeometry=!!h,r.outFields=d,q=[],v=!1,g.label=1;case 1:return g.trys.push([1,5,,6]),[4,this._hasRequiredFieldsInView(d,
c)];case 2:return(v=g.sent())?[4,this._fetchFeaturesFromMemory(c,r,k)]:[3,4];case 3:q=g.sent();if(q.length&&0<f&&f<=q.length)return[2,e.pickRandom(q,f,l)];g.label=4;case 4:return[3,6];case 5:return g.sent(),a.throwIfAborted(k),[3,6];case 6:return g.trys.push([6,10,,11]),this._hasLocalSource?[2,v?q:this._fetchFeaturesFromService(r,k)]:[4,this.queryFeatureCount(null,k)];case 7:x=g.sent();n=this.layer.capabilities.query.maxRecordCount;w=-1===f?x:f;w=n&&w>n?n:w;if(x<=q.length||q.length>=n)return[2,q];
y=c.extent.width/c.width/c.scale*4E5;r.maxAllowableOffset=b.resolution||y;return x<=w?[2,this._fetchFeaturesFromService(r,k)]:2E4>=x?[4,this.layer.queryObjectIds()]:[3,9];case 8:return z=g.sent(),r.objectIds=e.pickRandom(z,w,l),[2,this._fetchFeaturesFromService(r,k)];case 9:return this.layer.get("capabilities.query.supportsPagination")&&(r.num=Math.min(w,2E4)),[2,this._fetchFeaturesFromService(r,k)];case 10:return g.sent(),a.throwIfAborted(k),[2,q];case 11:return[2]}})})};z.prototype.load=function(b){var c=
this;b=this.layer.load(b).then(function(a){c.geometryType=a.geometryType;c.objectIdField=a.objectIdField;c.supportsSQLExpression=a.get("capabilities.query.supportsSqlExpression");c._hasLocalSource=!a.url&&!!a.source;c.hasQueryEngine=c._hasLocalSource;c.minScale=a.minScale;c.maxScale=a.maxScale;c.fullExtent=a.fullExtent});this.addResolvingPromise(b);return a.resolve(this)};n([b.property({constructOnly:!0})],z.prototype,"layer",void 0);return z=n([b.subclass("esri.renderers.smartMapping.support.adapters.FeatureLayerAdapter")],
z)}(b.declared(r))})},"esri/renderers/smartMapping/statistics/support/predominanceUtils":function(){define(["require","exports","../../support/utils"],function(u,m,p){function d(c){return"("+c.map(function(a){return a+" \x3e\x3d 0"}).join(" OR ")+")"}function n(c,a){var f=a.returnFieldName,b=a.defaultValue,e=a.layer,d=[];f&&b&&(a=c.map(function(a){return a+" \x3c\x3d 0"}).join(" AND "),d.push("WHEN "+a+" THEN "+b));a=function(a){var b=c.reduce(function(b,c){a!==c&&b.push(a+" \x3e "+c);return b},[]).join(" AND "),
h=e&&p.isIntegerField(e,a),h=f&&"'"+a+"'"?"'"+a+"'":h?p.castIntegerFieldToFloat(a):a;d.push("WHEN "+b+" THEN "+h)};for(var h=0;h<c.length;h++)a(c[h]);return"CASE "+d.join(" ")+" ELSE "+(b||"0")+" END"}function g(c){return c&&c.map(function(a){return'$feature["'+a+'"];'}).join("\n")+"\n"||""}function l(c,a){void 0===a&&(a=!1);c=c.map(function(a){return'"'+a+'"'});return"\n  var fieldNames \x3d [ "+c.join(", ")+" ];\n  var numFields \x3d "+c.length+";\n  var maxValueField \x3d null;\n  var maxValue \x3d -Infinity;\n  var value, i, totalValue \x3d null;\n\n  for(i \x3d 0; i \x3c numFields; i++) {\n    value \x3d $feature[fieldNames[i]];\n\n    if(value \x3e 0) {\n      if(value \x3e maxValue) {\n        maxValue \x3d value;\n        maxValueField \x3d fieldNames[i];\n      }\n      else if (value \x3d\x3d maxValue) {\n        maxValueField \x3d null;\n      }\n    }\n    "+
(a?"\n  if(value !\x3d null \x26\x26 value \x3e\x3d 0) {\n    if (totalValue \x3d\x3d null) { totalValue \x3d 0; }\n    totalValue \x3d totalValue + value;\n  }\n  ":"")+"\n  }\n  "}function k(c){var a=l(c);return"\n  "+g(c)+"\n  "+a+"\n  return maxValueField;\n  "}function e(c){var a=g(c);c=c.map(function(a){return'"'+a+'"'});return"\n  "+a+"\n  var fieldNames \x3d [ "+c.join(", ")+" ];\n  var numFields \x3d "+c.length+";\n  var value, i, totalValue \x3d null;\n\n  for(i \x3d 0; i \x3c numFields; i++) {\n    value \x3d $feature[fieldNames[i]];\n\n    if(value !\x3d null \x26\x26 value \x3e\x3d 0) {\n      if (totalValue \x3d\x3d null) { totalValue \x3d 0; }\n      totalValue \x3d totalValue + value;\n    }\n  }\n\n  return totalValue;\n  "}
function h(c){var a=l(c,!0);return"\n  "+g(c)+"\n  "+a+"\n\n  var strength \x3d null;\n\n  if (maxValueField !\x3d null \x26\x26 totalValue \x3e 0) {\n    strength \x3d (maxValue / totalValue) * 100;\n  }\n\n  return strength;\n  "}Object.defineProperty(m,"__esModule",{value:!0});m.noDominantCategoryField="no_dominant_category";m.getSQLForPredominantCategoryName=function(c){return{expression:n(c,{returnFieldName:!0,defaultValue:"'"+m.noDominantCategoryField+"'"})}};m.getPredominanceExpressions=function(c,
a){var f=a.join(" + "),b={sqlExpression:"("+f+")",sqlWhere:d(a)};c={sqlExpression:"(( ("+n(a,{layer:c})+") / ("+f+") ) * 100)",sqlWhere:d(a)+" AND (("+f+") \x3e 0)"};return{predominantCategory:{valueExpression:k(a)},size:{valueExpression:e(a),statisticsQuery:b,histogramQuery:b},opacity:{valueExpression:h(a),statisticsQuery:c,histogramQuery:c}}};m.getArcadeForPredominantCategory=k;m.getArcadeForPredominantCategoryValue=function(c){var a=l(c);return"\n  "+g(c)+"\n  "+a+"\n  return maxValue;\n  "};m.getArcadeForPredominantCategoryAlias=
function(c){var a=c.map(function(a){return a.fieldName}),f=g(a),a=a.map(function(a){return'"'+a+'"'});c=c.map(function(a){return a.label?'"'+a.label+'"':'"'+a.fieldName+'"'});return"\n  "+f+"\n  var fieldNames \x3d [ "+a.join(", ")+" ];\n  var fieldAliases \x3d [ "+c.join(", ")+" ];\n  var numFields \x3d "+a.length+';\n  var maxFieldAlias \x3d null;\n  var maxValue \x3d -Infinity;\n  var value, i, totalValue \x3d null;\n\n  for(i \x3d 0; i \x3c numFields; i++) {\n    value \x3d $feature[fieldNames[i]];\n\n    if(value \x3e 0) {\n      if(value \x3e maxValue) {\n        maxValue \x3d value;\n        maxFieldAlias \x3d fieldAliases[i];\n      }\n      else if (value \x3d\x3d maxValue) {\n        maxFieldAlias \x3d "Tie";\n      }\n    }\n  }\n  return maxFieldAlias;\n  '};
m.getArcadeForPredominanceMargin=function(c){var a=g(c);c=c.map(function(a){return'$feature["'+a+'"]'});return"\n  "+a+"\n  var fieldValues \x3d [ "+c.join(", ")+" ];\n  var totalValue \x3d Sum(fieldValues);\n  var order \x3d Reverse(Sort(fieldValues));\n  return IIF(totalValue \x3e 0, Round(((order[0] - order[1]) / totalValue) * 100, 2), null);\n  "};m.getArcadeForSumOfFields=e;m.getArcadeForStrengthOfPredominance=h;m.getArcadeForOrderedFields=function(c){var a=c.map(function(a){return a.fieldName}),
a=g(a);c=c.map(function(a){return'{\n    value: $feature["'+a.fieldName+'"],\n    alias: "'+(a.label||a.fieldName)+'"\n    }'});return"\n  "+a+"\n  var groups \x3d [ "+c.join(", ")+' ];\n  var numTopValues \x3d Count(groups);\n\n  function getValuesArray(arr){\n    var valuesArray \x3d []\n    for(var i in arr){\n      valuesArray[i] \x3d arr[i].value;\n    }\n    return valuesArray;\n  }\n\n  function findAliases(top5Array, fullArray){\n    var aliases \x3d [];\n    var found \x3d "";\n    for(var i in top5Array){\n      for(var k in fullArray){\n        if(top5Array[i] \x3d\x3d fullArray[k].value \x26\x26 Find(fullArray[k].alias, found) \x3d\x3d -1){\n          found +\x3d fullArray[k].alias;\n          aliases[Count(aliases)] \x3d {\n            alias: fullArray[k].alias,\n            value: top5Array[i]\n          };\n        }\n      }\n    }\n    return aliases;\n  }\n\n  function getTopGroups(groupsArray){\n    var values \x3d getValuesArray(groupsArray);\n    var top5Values \x3d IIF(Max(values) \x3e 0, Top(Reverse(Sort(values)),numTopValues), "no data");\n    var top5Aliases \x3d findAliases(top5Values,groupsArray);\n\n    if(TypeOf(top5Values) \x3d\x3d "String"){\n      return top5Values;\n    } else {\n      var content \x3d "";\n      for(var i in top5Aliases){\n        if(top5Aliases[i].value \x3e 0){\n          content +\x3d (i+1) + ". " + top5Aliases[i].alias + " (" + Text(top5Aliases[i].value, "#,###") + ")";\n          content +\x3d IIF(i \x3c numTopValues-1, TextFormatting.NewLine, "");\n        }\n      }\n    }\n\n    return content;\n  }\n\n  getTopGroups(groups);\n  '}})},
"esri/renderers/smartMapping/support/adapters/LayerAdapter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Loadable ../../../../core/accessorSupport/decorators".split(" "),function(u,m,p,d,n,g,l,k){return function(e){function h(c){return e.call(this,c)||this}p(h,e);d([k.property()],h.prototype,"geometryType",void 0);d([k.property()],
h.prototype,"objectIdField",void 0);d([k.property()],h.prototype,"supportsSQLExpression",void 0);d([k.property()],h.prototype,"hasQueryEngine",void 0);d([k.property()],h.prototype,"minScale",void 0);d([k.property()],h.prototype,"maxScale",void 0);d([k.property()],h.prototype,"fullExtent",void 0);return h=d([k.subclass("esri.renderers.smartMapping.support.adapters.LayerAdapter")],h)}(k.declared(l))})},"esri/renderers/smartMapping/support/adapters/support/utils":function(){define("require exports ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/promiseUtils ../../utils ../../../../support/heatmapUtils ../../../../../support/arcadeOnDemand ../../../../../tasks/support/ClassBreaksDefinition ../../../../../tasks/support/generateRendererUtils".split(" "),
function(u,m,p,d,n,g,l,k,e,h){function c(a,b,c){b=null==b?-Infinity:b;c=null==c?Infinity:c;return a.filter(function(a){return null!=a&&w(a)&&a>=b&&a<=c})}function a(a,b){return d(this,void 0,void 0,function(){var c,f,e,d,h,g,r,l,q,v,x;return p(this,function(n){switch(n.label){case 0:return c=a.field,f="function"===typeof c,e=a.valueExpression,d=a.normalizationType,h=a.normalizationField,g=a.normalizationTotal,r=[],l=a.view,v=q=null,e?H?[3,2]:[4,k.loadArcade()]:[3,3];case 1:H=x=n.sent().arcadeUtils,
n.label=2;case 2:q=H.createFunction(e),v=l&&H.getViewInfo({viewingMode:"2d"===l.type?"map":l.viewingMode,scale:l.scale,spatialReference:l.spatialReference}),n.label=3;case 3:if(!b)return[2,r];b.forEach(function(a){var b=a.attributes,k;e?(k=H.createExecContext(a,v),k=H.executeFunction(q,k)):f?k=c.call(null,a):b&&(k=b[c]);d&&null!=k&&w(k)&&(b=b&&parseFloat(b[h]),"log"===d&&0!==k?k=Math.log(k)*Math.LOG10E:"percent-of-total"===d&&w(g)&&0!==g?k=k/g*100:"field"===d&&w(b)&&0!==b&&(k/=b));r.push(k)});return[2,
r]}})})}function f(a,b){for(var c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,e=null,d=null,h=null,g=null,k=0;k<a.length;k++)var r=a[k],e=e+r,c=Math.min(c,r),f=Math.max(f,r);if(k=a.length){d=e/k;for(g=h=0;g<a.length;g++)r=a[g],h+=Math.pow(r-d,2);g=b?1<k?h/(k-1):0:0<k?h/k:0;h=Math.sqrt(g)}else f=c=null;return{avg:d,count:k,max:f,min:c,stddev:h,sum:e,variance:g}}function b(a){var b=a.field,c=a.classificationMethod||"equal-interval",f=a.normalizationType,d=a.normalizationField,h=new e;h.classificationField=
b;h.breakCount=a.breakCount;h.classificationMethod=c;h.standardDeviationInterval="standard-deviation"===c?a.standardDeviationInterval||1:void 0;h.normalizationType=f;h.normalizationField="field"===f?d:void 0;return h}function x(a,b){var c=b.classBreaks,f=c[0].minValue,e=c[c.length-1].maxValue,d="standard-deviation"===a.classificationMethod,h=E,c=c.map(function(a){var b=a.label;a={minValue:a.minValue,maxValue:a.maxValue,label:b};if(d&&b){var c=b.match(h).map(function(a){return+a.trim()});2===c.length?
(a.minStdDev=c[0],a.maxStdDev=c[1],0>c[0]&&0<c[1]&&(a.hasAvg=!0)):1===c.length&&(-1<b.indexOf("\x3c")?(a.minStdDev=null,a.maxStdDev=c[0]):-1<b.indexOf("\x3e")&&(a.minStdDev=c[0],a.maxStdDev=null))}return a});return{minValue:f,maxValue:e,classBreakInfos:c,normalizationTotal:b.normalizationTotal}}function v(a,b,c){b=(b-a)/c;for(var f=[],e,d=1;d<=c;d++)e=a+b,e=Number(e.toFixed(16)),f.push([a,e]),a=e;return f}function y(a){var b=a.field,c=a.normalizationType,f=a.normalizationField,e=a.normalizationTotal;
a=g.isIntegerField(a.layer,b);var d=b;"percent-of-total"===c?d="(("+(a?g.castIntegerFieldToFloat(b):b)+" / "+e+") * 100)":"log"===c?d="(log("+b+") * "+D+")":"field"===c&&(d="("+(a?g.castIntegerFieldToFloat(b):b)+" / "+f+")");return d}function q(a,b){for(var c=-1,f=a.length-1;0<=f;f--)if(b>=a[f][0]){c=f;break}return c}function B(a,b){var c;b=b.toLowerCase();if(a)for(var f in a)if(f.toLowerCase()!==b){c=a[f];break}return c}function C(a,b){var c;b=b.toLowerCase();if(a)for(var f in a)if(f.toLowerCase()===
b){c=a[f];break}return c}function t(a,b){if(b)for(var c in a)a[c].label=b[c];return{count:a}}function r(a,b,c){var f=a.count;a=[];c&&b&&"coded-value"===b.type&&b.codedValues.forEach(function(a){a=a.code;f.hasOwnProperty(a)||(f[a]={data:a,count:0})});for(var e in f)b=f[e],a.push({value:b.data,count:b.count,label:b.label});return{uniqueValueInfos:a}}function w(a){return"number"===typeof a&&!isNaN(a)&&Infinity!==a&&-Infinity!==a}Object.defineProperty(m,"__esModule",{value:!0});var F=/_value$/i,E=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,
D=Math.LOG10E;m.statisticTypes="min max avg stddev count sum variance".split(" ");var H=null;m.getSummaryStatisticsFromFeatureSet=function(a,b){a=(a=a&&a.features)&&a[0]&&a[0].attributes;var c={},f;for(f in a)c[f.replace(F,"").toLowerCase()]=a[f];c.min===c.max&&null!=c.min&&null==c.stddev&&(c.stddev=c.variance=0);b&&("min max avg stddev sum variance".split(" ").forEach(function(a){null!=c[a]&&(c[a]=Math.ceil(c[a]))}),c.min===c.max&&null!=c.min&&(c.avg=c.min,c.stddev=c.variance=0));return c};m.calculateStatsFromMemory=
function(b,e,h){return d(this,void 0,void 0,function(){var d,g;return p(this,function(k){switch(k.label){case 0:return[4,a(b,e)];case 1:return d=k.sent(),d=c(d,b.minValue,b.maxValue),g=f(d,!b.normalizationType),h&&["avg","stddev","variance"].forEach(function(a){null!=g[a]&&(g[a]=Math.ceil(g[a]))}),[2,g]}})})};m.getDataValues=a;m.processSummaryStatisticsResult=function(a){for(var b in a)-1<m.statisticTypes.indexOf(b)&&(w(a[b])||(a[b]=null));return a};m.createCBDefn=b;m.calculateHeatmapStats=function(a,
b,c,f,e,d){void 0===b&&(b=10);var h=new Float64Array(e*d),g=l.createKernel(b);b=Math.round(3*b);var k=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,q=0,v=0,x=0,n=0;c=l.createValueFunction(f,c);for(f=0;f<a.length;f++)for(var w=a[f],y=w.geometry,z=y.x-b,t=y.y-b,A=Math.max(0,z),q=Math.max(0,t),m=Math.min(d,y.y+b),y=Math.min(e,y.x+b),w=+c(w.attributes),B=q;B<m;B++)for(var D=g[B-t],p=A;p<y;p++){var q=B*e+p,F=h[q],q=h[q]+=D*g[p-z]*w,F=q-F,v=v+F,x=x+F*F;q<k&&(k=q);q>r&&(r=q);n++}return n?{mean:v/n,
stdDev:Math.sqrt((x-v*v/n)/n),min:k,max:r,mid:(r-k)/2,count:n}:{mean:0,stddev:0,min:0,max:0,mid:0,count:0}};m.calculateClassBreaksFromMemory=function(f,e){return d(this,void 0,void 0,function(){var d,g,k,r;return p(this,function(l){switch(l.label){case 0:return d=f.normalizationTotal,g=b({field:f.field,normalizationType:f.normalizationType,normalizationField:f.normalizationField,classificationMethod:f.classificationMethod,standardDeviationInterval:f.standardDeviationInterval,breakCount:f.numClasses||
5}),[4,a(f,e)];case 1:return k=l.sent(),k=c(k,f.minValue,f.maxValue),r=h.createGenerateRendererClassBreaks({definition:g,values:k,normalizationTotal:d}),[2,x(f,r)]}})})};m.resolveCBResult=x;m.getEqualIntervalBins=v;m.generateBinParams=function(a){var b=[],c=a.classBreaks,f=c[0].minValue,e=c[c.length-1].maxValue;c.forEach(function(a){b.push([a.minValue,a.maxValue])});return{min:f,max:e,intervals:b,sqlExpr:y({field:a.field,normalizationType:a.normalizationType,normalizationField:a.normalizationField,
normalizationTotal:a.normalizationTotal,layer:a.layer}),excludeZerosExpr:a.where,normTotal:a.normalizationTotal}};m.getFieldExpr=y;m.calculateHistogramFromMemory=function(b,c,f){return d(this,void 0,void 0,function(){var e,d,h,g,k,r,l,x,n,w,y;return p(this,function(z){switch(z.label){case 0:return e=c.min,d=c.max,h=c.normTotal,g=b.numBins||10,k=c.intervals||v(e,d,g),r=k.map(function(a,b){return{minValue:k[b][0],maxValue:k[b][1],count:0}}),[4,a(b,f)];case 1:l=z.sent();x=0;for(n=l;x<n.length;x++)w=
n[x],null!=w&&w>=e&&w<=d&&(y=q(k,w),-1<y&&r[y].count++);return[2,{bins:r,minValue:e,maxValue:d,normalizationTotal:h}]}})})};m.getHistogramFromFeatureSet=function(a,b,c,f,e){var d={};a&&a.features&&a.features.forEach(function(a){var b=a.attributes;a=B(b,"countOFExpr");b=C(b,"countOFExpr");0!==a&&(d[a]=b)});var h=[];v(b,c,f).forEach(function(a,b){b=(b+1).toString();h.push({minValue:a[0],maxValue:a[1],count:d.hasOwnProperty(b)?d[b]:0})});return{bins:h,minValue:b,maxValue:c,normalizationTotal:e}};m.getUniqueValuesFromFeatureSet=
function(a,b,c,f,e){var d="countOF"+(c||"Expr"),h={},g=!1;(a&&a.features).forEach(function(a){var b=a.attributes;a=C(b,d);b=c?C(b,c):B(b,d);null===b&&0===a&&(g=!0);if(null==b||"string"===typeof b&&""===b.trim())b=null;null==h[b]?h[b]={count:a,data:b}:h[b].count+=a});return c&&g?b.queryFeatureCount(c+" is NULL",e).then(function(a){h["null"].count+=a||0;return t(h,f)}).catch(function(){n.throwIfAborted(e);return t(h,f)}):n.resolve(t(h,f))};m.createUVResult=r;m.calculateUniqueValuesFromMemory=function(b,
c,f){return d(this,void 0,void 0,function(){var e,d,h,g,k;return p(this,function(l){switch(l.label){case 0:return[4,a(b,c)];case 1:e=l.sent();d={};h=0;for(g=e;h<g.length;h++){k=g[h];if(null==k||"string"===typeof k&&""===k.trim())k=null;null==d[k]?d[k]={count:1,data:k}:d[k].count++}return[2,r({count:d},f,b.returnAllCodedValues)]}})})};m.msSinceUnixEpochSQL=function(a,b){return g.getDateDiffSQL(a,new Date(0),b,"milliseconds").sqlExpression};m.isValidNumber=w})},"esri/renderers/support/heatmapUtils":function(){define(["require",
"exports","../../core/global","../../core/mathUtils"],function(u,m,p,d){function n(g,e,h,c,a){g=new Uint32Array(g*g);e="buffer"in e?e:new Float64Array(e);h="buffer"in h?new Uint32Array(h.buffer):new Uint32Array((new Uint8Array(h)).buffer);a=h.length/(a-c);for(var f=0;f<e.length;f++)g[f]=h[d.clamp(Math.floor((e[f]-c)*a),0,h.length-1)];return g.buffer}function g(d){for(var e=Math.round(3*d),h=2*d*d,c=new Float64Array(2*e+1),a=0;a<=c.length;a++)c[a]=Math.exp(-Math.pow(a-e,2)/h)/Math.sqrt(2*Math.PI)*
(d/2);return c}function l(d,e){return"function"===typeof d?d:d?"string"===typeof e?function(e){return-1*+e[d]}:function(h){return+h[d]+e}:function(){return 1}}Object.defineProperty(m,"__esModule",{value:!0});m.generateGradient=function(){if(!("document"in p))return function(){return null};var d=document.createElement("canvas"),e=d.getContext("2d");d.height=512;d.width=1;return function(h){e.clearRect(0,0,1,d.height);var c=e.createLinearGradient(0,0,0,d.height),a=0;for(h=h.colorStops;a<h.length;a++){var f=
h[a],b=f.color;c.addColorStop(Math.max(f.ratio,.001),"rgba("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")")}e.fillStyle=c;e.fillRect(0,0,1,d.height);return e.getImageData(0,0,1,d.height).data}}();m.calculateHeatmapIntensityInfo=function(d,e,h,c){var a=e.blurRadius,f=e.fieldOffset,b=e.field;e=new Float64Array(h*c);for(var k=g(a),a=Math.round(3*a),v=Number.NEGATIVE_INFINITY,n,f=l(b,f),b=0;b<d.length;b++){var q=d[b],m=q.geometry,p=m.x-a,t=m.y-a,r=Math.max(0,p);n=Math.max(0,t);for(var w=Math.min(c,m.y+a),m=
Math.min(h,m.x+a),q=+f(q.attributes),F=n;F<w;F++)for(var E=k[F-t],D=r;D<m;D++)n=e[F*h+D]+=E*k[D-p]*q,n>v&&(v=n)}return{matrix:e.buffer,max:v}};m.drawHeatmap=function(d,e,h,c,a,f){d.canvas.width=d.canvas.height=e;d.clearRect(0,0,e,e);var b=d.getImageData(0,0,e,e);h&&c&&b.data.set(new Uint8ClampedArray(n(e,h,c,a,f)));d.putImageData(b,0,0)};m.createHeatmapImageData=n;m.createKernel=g;m.createValueFunction=l})},"esri/tasks/support/ClassBreaksDefinition":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/jsonMap ../../core/accessorSupport/decorators ./ClassificationDefinition".split(" "),
function(u,m,p,d,n,g,l){var k=new n.default({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),e=new n.default({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});return function(h){function c(){var a=null!==h&&h.apply(this,arguments)||this;a.breakCount=null;a.classificationField=null;a.classificationMethod=
null;a.normalizationField=null;a.normalizationType=null;a.type="class-breaks-definition";return a}p(c,h);Object.defineProperty(c.prototype,"standardDeviationInterval",{set:function(a){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",a)},enumerable:!0,configurable:!0});d([g.property({json:{write:!0}})],c.prototype,"breakCount",void 0);d([g.property({json:{write:!0}})],c.prototype,"classificationField",void 0);d([g.property({type:String,json:{read:k.read,write:k.write}})],
c.prototype,"classificationMethod",void 0);d([g.property({json:{write:!0}})],c.prototype,"normalizationField",void 0);d([g.property({json:{read:e.read,write:e.write}})],c.prototype,"normalizationType",void 0);d([g.property({value:null,json:{write:!0}})],c.prototype,"standardDeviationInterval",null);d([g.property()],c.prototype,"type",void 0);return c=d([g.subclass("esri.tasks.support.ClassBreaksDefinition")],c)}(g.declared(l))})},"esri/tasks/support/ClassificationDefinition":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators ../../symbols/Symbol ./colorRamps".split(" "),
function(u,m,p,d,n,g,l,k,e){var h=new n.default({classBreaksDef:"class-breaks-definition",uniqueValueDef:"unique-value-definition"});return function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.baseSymbol=null;a.colorRamp=null;a.type=null;return a}p(a,c);d([l.property({type:k,json:{write:!0}})],a.prototype,"baseSymbol",void 0);d([l.property({types:e.types,json:{read:{reader:e.fromJSON},write:!0}})],a.prototype,"colorRamp",void 0);d([l.property({json:{read:h.read,write:h.write}})],
a.prototype,"type",void 0);return a=d([l.subclass("esri.tasks.support.ClassificationDefinition")],a)}(l.declared(g.JSONSupport))})},"esri/tasks/support/generateRendererUtils":function(){define(["require","exports"],function(u,m){function p(a){var c=a.definition,b=c.classificationMethod,l=c.breakCount,v=c.normalizationType,y=[],q=a.values;if(0===q.length)return[];var q=q.sort(function(a,b){return a-b}),m=q[0];a=q[q.length-1];if("equal-interval"===b)if(q.length>=l){q=(a-m)/l;b=m;for(c=1;c<l;c++){var p=
Number((m+c*q).toFixed(6));y.push({minValue:b,maxValue:p,label:d(b,p,v)});b=p}y.push({minValue:b,maxValue:a,label:d(b,a,v)})}else q.forEach(function(a){y.push({minValue:a,maxValue:a,label:d(a,a,v)})});else if("natural-breaks"===b){for(var q=n(q),t=g(q.uniqueValues,q.valueFrequency,l),b=m,c=1;c<l;c++)q.uniqueValues.length>c&&(p=Number(q.uniqueValues[t[c]].toFixed(6)),y.push({minValue:b,maxValue:p,label:d(b,p,v)}),b=p);y.push({minValue:b,maxValue:a,label:d(b,a,v)})}else if("quantile"===b)if(q.length>=
l&&m!==a){b=m;m=Math.ceil(q.length/l);p=0;for(c=1;c<l;c++)t=m+p-1,t>q.length&&(t=q.length-1),0>t&&(t=0),y.push({minValue:b,maxValue:q[t],label:d(b,q[t],v)}),b=q[t],p+=m,m=Math.ceil((q.length-p)/(l-c));y.push({minValue:b,maxValue:a,label:d(b,a,v)})}else for(b=-1,c=0;c<q.length;c++)p=q[c],p!==b&&(b=p,y.push({minValue:b,maxValue:p,label:d(b,p,v)}),b=p);else if("standard-deviation"===b)if(t=e(q),b=h(q,t),0===b)y.push({minValue:q[0],maxValue:q[0],label:d(q[0],q[0],v)});else{for(var q=k(m,a,l,t,b),q=q*
b,r=0,b=m,c=l;1<=c;c--)m=Number((t-(c-.5)*q).toFixed(6)),y.push({minValue:b,maxValue:m,label:d(b,m,v)}),b=m,r++;p=Number((t+.5*q).toFixed(6));y.push({minValue:b,maxValue:p,label:d(b,p,v)});b=p;r++;for(c=1;c<=l;c++)p=r===2*l?a:Number((t+(c+.5)*q).toFixed(6)),y.push({minValue:b,maxValue:p,label:d(b,p,v)}),b=p,r++}return y}function d(a,c,b){var f=null;return f=a===c?b&&"percent-of-total"===b?a+"%":a.toString():b&&"percent-of-total"===b?a+"% - "+c+"%":a+" - "+c}function n(a){for(var c=[],b=[],e=Number.MIN_VALUE,
d=1,h=-1,g=0;g<a.length;g++){var k=a[g];k===e?(d++,b[h]=d):null!==k&&(c.push(k),e=k,d=1,b.push(d),h++)}return{uniqueValues:c,valueFrequency:b}}function g(a,f,b){var e=a.length,d=[];b>e&&(b=e);for(var h=0;h<b;h++)d.push(Math.round(h*e/b-1));d.push(e-1);for(var h=l(d,a,f,b),e=h.mean,h=h.sdcm,g=b,k=0,n=0,t=0,r=0,w=!0,m=0;2>m&&w;m++){0===m&&(w=!1);for(var p=0;p<g-1;p++)for(;d[p+1]+1!==d[p+2];)if(d[p+1]+=1,k=c(p,d,a,f),t=k.sbMean,k=k.sbSdcm,n=c(p+1,d,a,f),r=n.sbMean,n=n.sbSdcm,k+n<h[p]+h[p+1])h[p]=k,h[p+
1]=n,e[p]=t,e[p+1]=r,w=!0;else{--d[p+1];break}for(p=g-1;0<p;p--)for(;d[p]!==d[p-1]+1;)if(--d[p],k=c(p-1,d,a,f),t=k.sbMean,k=k.sbSdcm,n=c(p,d,a,f),r=n.sbMean,n=n.sbSdcm,k+n<h[p-1]+h[p])h[p-1]=k,h[p]=n,e[p-1]=t,e[p]=r,w=!0;else{d[p]+=1;break}}w&&(h=l(d,a,f,b));return d}function l(a,f,b,e){for(var d=[],h=[],g=[],k=0,l=[],n=[],r=0;r<e;r++){var x=c(r,a,f,b);l.push(x.sbMean);n.push(x.sbSdcm);k+=n[r]}for(var p=k,m=!0;m||k<p;){m=!1;d=[];for(r=0;r<e;r++)d.push(a[r]);for(r=0;r<e;r++)for(g=a[r]+1;g<=a[r+1];g++)if(h=
f[g],0<r&&g!==a[r+1]&&Math.abs(h-l[r])>Math.abs(h-l[r-1]))a[r]=g;else if(r<e-1&&a[r]!==g-1&&Math.abs(h-l[r])>Math.abs(h-l[r+1])){a[r+1]=g-1;break}p=k;k=0;h=[];g=[];for(r=0;r<e;r++)h.push(l[r]),g.push(n[r]),x=c(r,a,f,b),l[r]=x.sbMean,n[r]=x.sbSdcm,k+=n[r]}if(k>p){for(r=0;r<e;r++)a[r]=d[r],l[r]=h[r],n[r]=g[r];k=p}return{mean:l,sdcm:n}}function k(a,c,b,e,d){a=Math.max(e-a,c-e)/d/b;return 1<=a?1:.5<=a?.5:.25}function e(a){for(var c=0,b=0;b<a.length;b++)c+=a[b];return c/=a.length}function h(a,c){for(var b=
0,f=0;f<a.length;f++)var e=a[f],b=b+(e-c)*(e-c);b/=a.length;return Math.sqrt(b)}function c(a,c,b,e){for(var f=0,d=0,h=c[a]+1;h<=c[a+1];h++)var g=e[h],f=f+b[h]*g,d=d+g;0>=d&&console.log("Exception in Natural Breaks calculation");f/=d;d=0;for(h=c[a]+1;h<=c[a+1];h++)d+=e[h]*Math.pow(b[h]-f,2);return{sbMean:f,sbSdcm:d}}Object.defineProperty(m,"__esModule",{value:!0});m.createGenerateRendererUniqueValues=function(a){a=n(a);for(var c=[],b=a.uniqueValues.length,e=0;e<b;e++){var d=a.uniqueValues[e];c.push({value:d,
count:a.valueFrequency[e],label:d.toString()})}return{uniqueValues:c}};m.createGenerateRendererClassBreaks=function(a){var c=a.normalizationTotal;return{classBreaks:p(a),normalizationTotal:c}}})},"esri/tasks/GenerateRendererTask":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/promiseUtils ../core/accessorSupport/decorators ../layers/support/layerSourceUtils ../renderers/support/jsonUtils ./QueryTask ./Task ./support/Query ./support/StatisticDefinition".split(" "),
function(u,m,p,d,n,g,l,k,e,h,c,a,f,b){return function(a){function v(b){b=a.call(this,b)||this;b._field=null;b.checkValueRange=null;b.gdbVersion=null;b.source=null;return b}d(v,a);Object.defineProperty(v.prototype,"parsedUrl",{get:function(){var a=this._parseUrl(this.url);a.path+="/generateRenderer";return a},enumerable:!0,configurable:!0});v.prototype.execute=function(a,b){var c=this,f=a.classificationDefinition;a=p({},a.toJSON(),{f:"json"});this._field="esri.tasks.support.ClassBreaksDefinition"===
f.declaredClass?f.classificationField:f.attributeField;this.source&&(f={source:e.sourceToJSON(this.source)},a.layer=JSON.stringify(f));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);a.classificationDef&&(a.classificationDef=JSON.stringify(a.classificationDef));f={query:a};if(this.requestOptions||b)f=p({},this.requestOptions,b,f);return g(this.parsedUrl.path,f).then(function(a){return c._handleExecuteResponse(a)})};v.prototype._handleExecuteResponse=function(a){var e=this,d=a&&a.data;if(d){if(!this.checkValueRange)return a=
this._processRendererJSON(d),l.resolve(a);a=new c(this.url);var h=new b({statisticType:"min",onStatisticField:this._field}),g=new b({statisticType:"max",onStatisticField:this._field}),h=new f({outStatistics:[h,g]});return a.execute(h).then(function(a){a=a.features[0].attributes;var b=null,c=null,f;for(f in a)0===f.toLowerCase().indexOf("min")?b=a[f]:c=a[f];return e._processRendererJSON(d,b,c)})}};v.prototype._processRendererJSON=function(a,b,c){if("classBreaks"===a.type){var f=h.fromJSON(a);return{classBreaks:f.classBreakInfos.map(function(a,
e){0===e&&void 0!==b&&null!==b&&(a.minValue=b);e===f.classBreakInfos.length-1&&void 0!==c&&null!==c&&(a.maxValue=c);return{minValue:a.minValue,maxValue:a.maxValue,label:a.label}}),normalizationTotal:f.normalizationTotal}}return{uniqueValues:a.uniqueValueInfos.map(function(f,e){0===e&&void 0!==b&&null!==b&&(f.value=b);e===a.uniqueValueInfos.length-1&&void 0!==c&&null!==c&&(f.value=c);return{count:f.count,value:f.value,label:f.label}})}};n([k.property()],v.prototype,"checkValueRange",void 0);n([k.property()],
v.prototype,"gdbVersion",void 0);n([k.property()],v.prototype,"source",void 0);n([k.property({readOnly:!0,dependsOn:["url"]})],v.prototype,"parsedUrl",null);return v=n([k.subclass("esri.tasks.GenerateRendererTask")],v)}(k.declared(a))})},"esri/tasks/support/GenerateRendererParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ./ClassificationDefinition".split(" "),function(u,
m,p,d,n,g,l){return function(k){function e(){var e=null!==k&&k.apply(this,arguments)||this;e.classificationDefinition=null;e.where=null;return e}p(e,k);d([g.property({type:l,json:{read:{source:"classificationDef"},write:{target:"classificationDef"}}})],e.prototype,"classificationDefinition",void 0);d([g.property({type:String,json:{write:!0}})],e.prototype,"where",void 0);return e=d([g.subclass("esri.tasks.support.GenerateRendererParameters")],e)}(g.declared(n.JSONSupport))})},"esri/tasks/support/UniqueValueDefinition":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./ClassificationDefinition".split(" "),
function(u,m,p,d,n,g){return function(g){function k(){var e=null!==g&&g.apply(this,arguments)||this;e.attributeField=null;e.attributeField2=null;e.attributeField3=null;e.fieldDelimiter=null;e.type="unique-value-definition";return e}p(k,g);Object.defineProperty(k.prototype,"uniqueValueFields",{get:function(){var e=[];this.attributeField&&e.push(this.attributeField);this.attributeField2&&e.push(this.attributeField2);this.attributeField3&&e.push(this.attributeField3);return e},enumerable:!0,configurable:!0});
d([n.property()],k.prototype,"attributeField",void 0);d([n.property()],k.prototype,"attributeField2",void 0);d([n.property()],k.prototype,"attributeField3",void 0);d([n.property({json:{write:!0}})],k.prototype,"fieldDelimiter",void 0);d([n.property({dependsOn:["attributeField","attributeField2","attributeField3"],json:{write:!0}})],k.prototype,"uniqueValueFields",null);d([n.property()],k.prototype,"type",void 0);return k=d([n.subclass("esri.tasks.support.UniqueValueDefinition")],k)}(n.declared(g))})},
"esri/renderers/smartMapping/support/adapters/PointCloudLayerAdapter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/fieldUtils ./SceneLayerAdapter".split(" "),function(u,m,p,d,n,g,l,k){return function(e){function h(c){return e.call(this,c)||this}p(h,e);h.prototype.getField=function(c){void 0===c&&(c="");return l.getField(this.layer.fields,
c)};h.prototype.getFieldUsageInfo=function(c){c=this.getField(c);if(!c)return null;c=this._hasCachedStatistics(c.name);return{supportsLabelingInfo:c,supportsPopupTemplate:c,supportsRenderer:c,supportsLayerQuery:!1,supportsStatistics:c}};h.prototype.getFieldDomain=function(){return null};h.prototype.load=function(c){var a=this;c=this.layer.load(c).then(function(){a.geometryType="point";a.objectIdField=null;a.supportsSQLExpression=!1;a.hasQueryEngine=!1});this.addResolvingPromise(c);return n.resolve(this)};
return h=d([g.subclass("esri.renderers.smartMapping.support.adapters.PointCloudLayerAdapter")],h)}(g.declared(k))})},"esri/renderers/smartMapping/support/adapters/SceneLayerAdapter":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Graphic ../../../../core/arrayUtils ../../../../core/Error ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/fieldUtils ../../statistics/support/utils ./FeatureLayerAdapter ./LayerAdapter ./support/utils ../../../../tasks/support/FeatureSet".split(" "),
function(u,m,p,d,n,g,l,k,e,h,c,a,f,b,x,v,y,q,B){return function(y){function m(a){return y.call(this,a)||this}d(m,y);m.prototype._hasCachedStatistics=function(a){return this.layer.hasCachedStatistics(a)};m.prototype._fetchFeaturesFromMemory=function(b,f){return b?b.whenLayerView(this.layer).then(function(b){var e=a.whenFalseOnce(b,"updating").then(function(){return b.queryFeatures(f)}).then(function(a){return"esri.tasks.support.FeatureSet"===a.declaredClass?a.features:a});return c.timeout(e,1E4,null)}):
c.reject(new h("scene-layer-adapter:insufficient-data","view is required to fetch the features from layerView"))};m.prototype._generateFeatureSetForCachedHistogram=function(a,b,c,f){void 0===b&&(b=a.minimum);void 0===c&&(c=a.maximum);for(var e=[],d=0;d<f;d++)e[d]=0;for(var h=a.counts.length,g=a.minimum,l=a.maximum,d=0;d<h;d++){var r=(d+.5)/h,r=((1-r)*g+r*l-b)/(c-b)*f;0<=r&&r<=f&&(e[r===f?f-1:Math.floor(r)]+=a.counts[d])}var n=[];e.forEach(function(a,b){var c=new k({attributes:{}});c.attributes.EXPR_1=
b+1;c.attributes.countOFExpr=a;n.push(c)});a=new B;a.features=n;return a};m.prototype._getCachedStatistics=function(a,b){var f=this.layer;return a.valueExpression||a.sqlExpression||a.sqlWhere||a.minValue||a.maxValue?c.reject(new h("scene-layer-adapter:not-supported","This Layer does not support calculating statistics when 'valueExpression', 'sqlExpression', 'sqlWhere', 'minValue' or 'maxValue' is specified")):f.queryCachedStatistics(b&&b.name,{signal:a.signal}).then(function(a){var b=a.stats;a=b.min;
var c=b.max,f=b.avg,e=b.stddev,d=b.sum,h=b.variance,b=b.count;if(0!==a||0!==c)f=0===f?null:f,d=0===d?null:d,e=0===e?null:e,h=0===h?null:h,b=0===b?null:b;null==b&&null!=d&&null!=f&&(b=Math.round(d/f));return{avg:f,count:b,max:c,min:a,stddev:e,sum:d,variance:h}})};m.prototype._getSummaryStatisticsFromMemory=function(a,c){return l(this,void 0,void 0,function(){var f,e,d,k,l,r,n,v;return g(this,function(g){switch(g.label){case 0:if(!a.features)return[3,1];e=a.features;return[3,3];case 1:return[4,this._fetchFeaturesFromMemory(a.view)];
case 2:e=g.sent(),g.label=3;case 3:d=(f=e)&&f.length;if(!d)throw new h("scene-layer-adapter:insufficient-data","No features are available to calculate statistics");k=b.isDateField(c);l=p({},a);return"percent-of-total"!==l.normalizationType?[3,5]:[4,q.calculateStatsFromMemory({field:l.field},f)];case 4:r=g.sent();n=r.sum;if(null==n)throw new h("scene-layer-adapter:invalid","invalid normalizationTotal");l.normalizationTotal=n;g.label=5;case 5:return[4,q.calculateStatsFromMemory(l,f,k)];case 6:return v=
g.sent(),[2,q.processSummaryStatisticsResult(v)]}})})};m.prototype._getCachedStatisticsForUniqueValues=function(a,f){var e=this,d=this.layer,g=f&&f.name,l=f&&this.getFieldDomain(a.field);return a.valueExpression||a.sqlExpression||a.sqlWhere?c.reject(new h("scene-layer-adapter:not-supported","This Layer does not support calculating statistics when 'valueExpression', 'sqlExpression' or 'sqlWhere' is specified")):d.queryCachedStatistics(g,{signal:a.signal}).then(function(c){var h=c.stats;c=c.labels&&
c.labels.labels;var l={},n=[];if(h.mostFrequentValues){var r="countOF"+g;h.mostFrequentValues.forEach(function(a){var c=new k({attributes:{}});c.attributes[g]=f&&f.name!==d.objectIdField&&(b.isNumericField(f)||b.isDateField(f))?Number(a.value):a.value;c.attributes[r]=a.count;n.push(c)});c&&c.forEach(function(a){l[a.value]=a.label})}h=new B;h.features=n;return q.getUniqueValuesFromFeatureSet(h,e,a.field,l,a.signal)}).then(function(b){return q.createUVResult(b,l,a.returnAllCodedValues)})};m.prototype._getUniqueValuesFromMemory=
function(a,b){var f=b&&this.getFieldDomain(a.field);return(a.features?c.resolve(a.features):this._fetchFeaturesFromMemory(a.view)).then(function(b){return q.calculateUniqueValuesFromMemory(a,b,f)})};m.prototype._getCachedStatisticsForHistogram=function(a,b){var f=this,e=this.layer;return a.valueExpression||a.sqlExpression||a.sqlWhere||a.normalizationType?c.reject(new h("scene-layer-adapter:not-supported","This Layer does not support calculating statistics when 'valueExpression' or 'sqlExpression' or 'sqlWhere' or 'normalizationType' is specified")):
e.queryCachedStatistics(b&&b.name,{signal:a.signal}).then(function(b){b=b.stats;var c=a.minValue,e=a.maxValue,c=null!=c?c:b.min,e=null!=e?e:b.max,d=a.numBins||10;b=f._generateFeatureSetForCachedHistogram(b.histogram,c,e,d);return q.getHistogramFromFeatureSet(b,c,e,d)})};m.prototype._getClassBreaksFromMemory=function(a){return l(this,void 0,void 0,function(){var b,c,f,e,d,k;return g(this,function(g){switch(g.label){case 0:if(!a.features)return[3,1];c=a.features;return[3,3];case 1:return[4,this._fetchFeaturesFromMemory(a.view)];
case 2:c=g.sent(),g.label=3;case 3:f=(b=c)&&b.length;if(!f)throw new h("scene-layer-adapter:insufficient-data","No features are available to calculate statistics");e=p({},a);return"percent-of-total"!==e.normalizationType?[3,5]:[4,q.calculateStatsFromMemory({field:e.field},b)];case 4:d=g.sent();k=d.sum;if(null==k)throw new h("scene-layer-adapter:invalid","invalid normalizationTotal");e.normalizationTotal=k;g.label=5;case 5:return[2,q.calculateClassBreaksFromMemory(e,b)]}})})};m.prototype._getHistogramFromMemory=
function(a){var b=this;return(a.features?c.resolve(a.features):this._fetchFeaturesFromMemory(a.view)).then(function(f){if(!f||!f.length)throw new h("scene-layer-adapter:insufficient-data","No features are available to calculate histogram");var e=a.field,d=a.normalizationType,g=a.valueExpression,k=a.classificationMethod,l=a.minValue,n=a.maxValue,r=a.view,v=null!=l&&null!=n,x=null;k&&"equal-interval"!==k||d?(e=p({},a),e.features=f,x=b._getBinParamsFromMemory(e)):x=v?c.resolve({min:l,max:n}):b.summaryStatistics({field:e,
valueExpression:g,features:f,view:r,signal:a.signal}).then(function(a){return a.count?{min:a.min,max:a.max}:c.reject(new h("feature-layer-adapter:insufficient-data","No features are available to calculate histogram"))});return x.then(function(b){return q.calculateHistogramFromMemory(a,b,f)})})};m.prototype._getBinParamsFromMemory=function(a){return l(this,void 0,void 0,function(){var b,c,f,e,d,h,k,l,n,r,v=this;return g(this,function(g){b=a.field;c=a.valueExpression;f=a.classificationMethod;e=a.standardDeviationInterval;
d=a.normalizationType;h=a.normalizationField;k=a.minValue;l=a.maxValue;n=a.features;r=a.view;return[2,this._getClassBreaksFromMemory({field:b,valueExpression:c,normalizationType:d,normalizationField:h,classificationMethod:f,standardDeviationInterval:e,minValue:k,maxValue:l,numClasses:a.numBins,features:n,view:r}).then(function(a){var c=a.normalizationTotal;a=a.classBreakInfos;var f=x.getSQLFilterForNormalization({field:b,normalizationType:d,normalizationField:h});return q.generateBinParams({field:b,
normalizationType:d,normalizationField:h,normalizationTotal:c,classBreaks:a,where:f,layer:v})})]})})};m.prototype.getField=function(a){void 0===a&&(a="");return this.layer.getField(a)};m.prototype.getFieldUsageInfo=function(a){a=this.getField(a);if(!a)return null;a=this.layer.getFieldUsageInfo(a.name);return{supportsLabelingInfo:a.supportsLabelingInfo,supportsPopupTemplate:a.supportsPopupTemplate,supportsRenderer:a.supportsRenderer,supportsLayerQuery:a.supportsLayerQuery,supportsStatistics:!0}};m.prototype.getFieldDomain=
function(a,b){return this._featureLayerAdapter?this._featureLayerAdapter.getFieldDomain(a,b):null};m.prototype.summaryStatistics=function(a){var b=this,f=this.getField(a.field);return this._featureLayerAdapter?this._featureLayerAdapter.summaryStatistics(a):this._hasCachedStatistics(f&&f.name)?this._getCachedStatistics(a,f).catch(function(){c.throwIfAborted(a.signal);return b._getSummaryStatisticsFromMemory(a,f)}):this._getSummaryStatisticsFromMemory(a,f)};m.prototype.uniqueValues=function(a){var b=
this,f=this.getField(a.field);return this._featureLayerAdapter?this._featureLayerAdapter.uniqueValues(a):this._hasCachedStatistics(f&&f.name)?this._getCachedStatisticsForUniqueValues(a,f).catch(function(){c.throwIfAborted(a.signal);return b._getUniqueValuesFromMemory(a,f)}):this._getUniqueValuesFromMemory(a,f)};m.prototype.histogram=function(a){var b=this,f=this.getField(a.field);return this._featureLayerAdapter?this._featureLayerAdapter.histogram(a):this._hasCachedStatistics(f&&f.name)?this._getCachedStatisticsForHistogram(a,
f).catch(function(){c.throwIfAborted(a.signal);return b._getHistogramFromMemory(a)}):this._getHistogramFromMemory(a)};m.prototype.classBreaks=function(a){var b=this.getField(a.field);return this._featureLayerAdapter?this._featureLayerAdapter.classBreaks(a):this._hasCachedStatistics(b&&b.name)?c.reject(new h("scene-layer-adapter:not-supported","Cached stats not supported")):this._getClassBreaksFromMemory(a)};m.prototype.queryFeatureCount=function(a,b){return this._featureLayerAdapter?this._featureLayerAdapter.queryFeatureCount(a,
b):c.reject(new h("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support count query"))};m.prototype.generateRenderer=function(a,b){return this._featureLayerAdapter?this._featureLayerAdapter.generateRenderer(a,b):c.reject(new h("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support generateRenderer operation"))};m.prototype.heatmapStatistics=function(a){return this._featureLayerAdapter?this._featureLayerAdapter.heatmapStatistics(a):
c.reject(new h("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support heatmapStatistics operation"))};m.prototype.predominantCategories=function(a){return l(this,void 0,void 0,function(){return g(this,function(b){if(this._featureLayerAdapter)return[2,this._featureLayerAdapter.predominantCategories(a)];throw new h("scene-layer-adapter:not-supported","SceneLayer without associated FeatureLayer does not support predominantCategories");})})};m.prototype.getSampleFeatures=
function(a){return l(this,void 0,void 0,function(){var b,c,f,d,k,l,n;return g(this,function(g){switch(g.label){case 0:if("mesh"===this.layer.geometryType)throw new h("scene-layer-adapter:not-supported","getSampleFeatures does not support scene layer with mesh geometry type");b=a.view;c=a.sampleSize;f=1;d=this.layer.createQuery();d.outFields=null;d.returnGeometry=!0;d.where=null;d.num=c;k=[];g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this._fetchFeaturesFromMemory(b,d)];case 2:return k=g.sent(),
k.length&&0<c&&c<=k.length?[2,e.pickRandom(k,c,f)]:[3,4];case 3:return g.sent(),[3,4];case 4:l=null;if(!this._featureLayerAdapter)return[3,6];n=p({},a);delete n.view;return[4,this._featureLayerAdapter.getSampleFeatures(n)];case 5:l=g.sent(),g.label=6;case 6:return l&&l.length?[2,l]:[2,e.pickRandom(k,k.length,f)]}})})};m.prototype.load=function(a){var b=this,f=this.layer.load(a).then(function(c){var f=c.associatedLayer;b.geometryType=c.geometryType;if(f)return b._featureLayerAdapter=new v({layer:f}),
b._featureLayerAdapter.load(a).then(function(){b.objectIdField=b._featureLayerAdapter.objectIdField;b.supportsSQLExpression=b._featureLayerAdapter.supportsSQLExpression;b.minScale=b._featureLayerAdapter.minScale;b.maxScale=b._featureLayerAdapter.maxScale;b.fullExtent=b._featureLayerAdapter.fullExtent});b.objectIdField=c.objectIdField;b.supportsSQLExpression=!1;b.hasQueryEngine=!1;b.fullExtent=c.fullExtent});this.addResolvingPromise(f);return c.resolve(this)};n([f.property({constructOnly:!0})],m.prototype,
"layer",void 0);return m=n([f.subclass("esri.renderers.smartMapping.support.adapters.SceneLayerAdapter")],m)}(f.declared(y))})},"esri/renderers/smartMapping/symbology/support/utils":function(){define(["require","exports","../../../../core/arrayUtils","../../../../core/screenUtils","../../support/utils"],function(u,m,p,d,n){function g(c,a){return c.r===a.r&&c.g===a.g&&c.b===a.b}function l(c){var a=c.width,f=c.height,b=c.pixelSizeAt(c.toMap(d.createScreenPoint(.5*a,.5*f),{exclude:[]}));0>=b&&(b=c.pixelSizeAt(c.toMap(d.createScreenPoint(.5*
a,.95*f),{exclude:[]})),0>=b&&(a=c.camera.position.clone(),a.z=0,b=2*c.pixelSizeAt(a)));return b}Object.defineProperty(m,"__esModule",{value:!0});var k="streets gray topo terrain national-geographic oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector".split(" "),e=["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"],h=[].concat(k).concat(e);m.hasIdenticalColors=function(c,a){var f=0;if(c.length===a.length){var b=c.every(function(b,
c){return g(b,a[c])});b?f=1:(b=c.slice(0).reverse().every(function(b,c){return g(b,a[c])}))&&(f=-1)}return f};m.getPixelSize=l;m.toWorldScale=function(c,a){return Math.ceil(l(a)*d.pt2px(d.toPt(c)))};m.getStorageType=function(c){return"multipoint"===c?"point":"mesh"===c?"polygon":c};m.getBasemapTheme=function(c){c=n.getBasemapId(c,h,!1);if(!c)return null;if(-1<k.indexOf(c))return"light";if(-1<e.indexOf(c))return"dark"};m.getTagsFromSchemes=function(c){if(!c)return[];var a=new Set,f=[c.primaryScheme];
c.secondarySchemes&&f.push.apply(f,c.secondarySchemes);for(c=0;c<f.length;c++){var b=f[c];b&&"tags"in b&&b.tags&&b.tags.forEach(function(b){return a.add(b)})}return p.keysOfSet(a)}})},"esri/widgets/Search/LayerSearchSource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/lang ../../core/accessorSupport/decorators ./SearchSource ./support/layerSearchUtils".split(" "),function(u,m,p,d,n,g,l,
k,e){return function(h){function c(){var a=null!==h&&h.apply(this,arguments)||this;a.displayField=null;a.exactMatch=null;a.orderByFields=null;a.searchFields=null;a.searchQueryParams=null;a.searchTemplate=null;a.suggestionTemplate=null;a.suggestQueryParams=null;a.getResults=function(b,c){return e.getResults(n({source:a},b),c)};a.getSuggestions=function(b,c){return e.getSuggestions(n({source:a},b),c)};return a}p(c,h);a=c;Object.defineProperty(c.prototype,"layer",{set:function(a){this._set("layer",a);
a&&a.load().catch(function(){})},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"name",{get:function(){return this._getLayerTitle()||""},set:function(a){void 0===a?this._clearOverride("name"):this._override("name",a)},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new a({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?g.clone(this.outFields):
null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,searchExtent:this.searchExtent?this.searchExtent.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?g.clone(this.searchFields):null,searchQueryParams:this.searchQueryParams?
g.clone(this.searchQueryParams):null,suggestionTemplate:this.suggestionTemplate,suggestQueryParams:this.suggestQueryParams?g.clone(this.suggestQueryParams):null,zoomScale:this.zoomScale})};c.prototype._getFirstStringField=function(){var a=this.layer,b="";a&&a.fields&&a.fields.some(function(a){return"string"===a.type?(b=a.name,!0):!1});return b};c.prototype._getDisplayField=function(){return this.displayField||this.layer.displayField||this._getFirstStringField()};c.prototype._getSearchFieldsString=
function(){var a=this.layer;return a.loaded?": "+(this.searchFields||[this._getDisplayField()]).map(function(b){var c=a.getField(b);return c&&c.alias||b}).join(", "):""};c.prototype._getLayerTitle=function(){var a=this.layer;if(a&&(a=a.title))return""+a+this._getSearchFieldsString()};var a;d([l.property({json:{read:{source:"field.name"},write:{target:"field.name"}}})],c.prototype,"displayField",void 0);d([l.property({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],c.prototype,
"exactMatch",void 0);d([l.property({value:null})],c.prototype,"layer",null);d([l.property({dependsOn:["layer.title","layer.loaded"]})],c.prototype,"name",null);d([l.property({type:[String],json:{write:!0}})],c.prototype,"orderByFields",void 0);d([l.property()],c.prototype,"searchFields",void 0);d([l.property()],c.prototype,"searchQueryParams",void 0);d([l.property()],c.prototype,"searchTemplate",void 0);d([l.property()],c.prototype,"suggestionTemplate",void 0);d([l.property()],c.prototype,"suggestQueryParams",
void 0);return c=a=d([l.subclass("esri.widgets.Search.LayerSearchSource")],c)}(l.declared(k))})},"esri/widgets/Search/SearchSource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Identifiable ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(u,m,p,d,n,g,l){return function(g){function e(e){e=g.call(this,e)||this;e.autoNavigate=null;e.filter=null;e.getResults=null;e.getSuggestions=null;e.maxResults=
null;e.maxSuggestions=null;e.minSuggestCharacters=null;e.outFields=null;e.placeholder="";e.popupEnabled=null;e.popupTemplate=null;e.prefix="";e.resultGraphicEnabled=null;e.resultSymbol=null;e.searchExtent=null;e.suggestionsEnabled=null;e.suffix="";e.withinViewEnabled=!1;e.zoomScale=null;return e}p(e,g);d([l.property()],e.prototype,"autoNavigate",void 0);d([l.property()],e.prototype,"filter",void 0);d([l.property()],e.prototype,"getResults",void 0);d([l.property()],e.prototype,"getSuggestions",void 0);
d([l.property()],e.prototype,"maxResults",void 0);d([l.property()],e.prototype,"maxSuggestions",void 0);d([l.property()],e.prototype,"minSuggestCharacters",void 0);d([l.property()],e.prototype,"outFields",void 0);d([l.property()],e.prototype,"placeholder",void 0);d([l.property()],e.prototype,"popupEnabled",void 0);d([l.property()],e.prototype,"popupTemplate",void 0);d([l.property()],e.prototype,"prefix",void 0);d([l.property()],e.prototype,"resultGraphicEnabled",void 0);d([l.property()],e.prototype,
"resultSymbol",void 0);d([l.property()],e.prototype,"searchExtent",void 0);d([l.property()],e.prototype,"suggestionsEnabled",void 0);d([l.property()],e.prototype,"suffix",void 0);d([l.property()],e.prototype,"withinViewEnabled",void 0);d([l.property()],e.prototype,"zoomScale",void 0);return e=d([l.subclass("esri.widgets.Search.SearchSource")],e)}(l.declared(n.IdentifiableMixin(g.JSONSupport)))})},"esri/widgets/Search/support/layerSearchUtils":function(){define("require exports ../../../intl ../../../core/Error ../../../core/lang ../../../core/Logger ../../../core/promiseUtils ../../../core/unitUtils ./geometryUtils".split(" "),
function(u,m,p,d,n,g,l,k,e){function h(a,b){var c=a.filter,f=a.searchExtent;b=b&&b.extent;a=a.withinViewEnabled&&b?b:void 0;return c&&c.geometry||f||a}function c(a){return a?a.load().then(l.resolve).catch(l.reject):l.resolve()}function a(a){return a&&!!a.get("capabilities.query.supportsPagination")}function f(a){var b="";a&&(a=a.fields)&&a.some(function(a){return"string"===a.type?(b=a.name,!0):!1});return b}function b(a,b){return a&&b?b.every(function(b){return!!a.getField(b)}):!1}function x(a){for(var b=
0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1}function v(a,b,c){var f=null;(a=a.codedValues)&&a.some(function(a){var e=a.name,e=c?e:e.toLowerCase();return(c?b:b.toLowerCase())===e?(f=a.code.toString(),!0):!1});return f}function y(a,b){return(b=b&&b.where)?"("+a+") AND ("+b+")":a}function q(a,b,c,f,e){var d=b.definitionExpression,h="";if(a){var g=w.test(b.url)&&x(a)?"N":"";c&&c.forEach(function(c){var d=b.getField(c);c=((c="function"===typeof b.getFieldDomain&&b.getFieldDomain(c))&&"coded-value"===
c.type?v(c,a,e):null)||a||null;if(null!==c){var k=d.type,d=d.name;"string"===k||"date"===k||"global-id"===k?e?d=y(d+" \x3d "+g+"'"+c+"'",f):(c=c.toUpperCase(),d=y("UPPER("+d+") LIKE "+g+"'%"+c+"%'",f)):"oid"===k||"small-integer"===k||"integer"===k||"single"===k||"double"===k?(c=Number(c),d=isNaN(c)?null:y(d+" \x3d "+c,f)):d=y(d+" \x3d "+c,f);d&&(h+=h?" OR ("+d+")":"("+d+")")}})}return d?"("+d+") AND ("+h+")":h}function B(a,b){var c=null;(a=a.codedValues)&&a.length&&a.some(function(a){return a.code===
b?(c=a.name,!0):!1});return c}function C(a,b,c){var f=a.layer,e=a.attributes,d="function"===typeof f.getFieldDomain&&f.getFieldDomain(c);return b?p.substitute(b,e):c&&a.hasOwnProperty("attributes")&&e.hasOwnProperty(c)?(a=e[c],c=f.getField(c),d&&"coded-value"===d.type?B(d,a):c&&"date"===c.type?p.formatDate(new Date(a)):"number"===typeof a?a.toString():"string"!==typeof a?"":a.trim()):""}function t(a,b,c,f){return a.features.map(function(a){var e=a.attributes[a.layer.objectIdField];return{text:C(a,
b.suggestionTemplate,f),key:e,sourceIndex:c}})}function r(a,b,c,f,d,h,g){return a.features.map(function(a){var k=a.clone(),l=a.layer,l=(l=l&&l.objectIdField)&&a.attributes[l];a=C(a,c.searchTemplate,d);var q=e.createExtentFromGeometry(k.geometry,b,h);return{extent:g?e.scaleExtent(n.clone(q),b,g):q,feature:k,key:l,name:a,sourceIndex:f}})}Object.defineProperty(m,"__esModule",{value:!0});var w=/https?:\/\/services.*\.arcgis\.com/i,F=/(?:\{([^}]+)\})/g,E=g.getLogger("esri.widgets.Search.support.layerSearchUtils");
m.getResults=function(e,g){var l=e.exactMatch,n=void 0===l?!1:l,v=e.location,x=e.maxResults,m=e.spatialReference,w=e.source,y=e.sourceIndex,p=e.suggestResult,t=e.view,B=w.layer,u=w.filter,F=w.zoomScale,C=t&&t.scale,D=h(w,t),H=g&&g.signal;return c(B).then(function(){var a=B.popupTemplate;return a?a.getRequiredFields(B.fields):null}).then(function(c){var e=B.objectIdField,h=B.returnZ,g=w.displayField||w.layer.displayField||f(w.layer);if(!B.getField(g))throw E.error("invalid-field: displayField is invalid."),
new d("getResults():invalid-field","displayField is invalid.");c=c&&c.length?c:[g];var l=(c=w.outFields||c)&&-1!==c.indexOf("*");-1!==c.indexOf(e)||l||c.push(e);if(!l&&!b(B,c))throw E.error("invalid-field: outField is invalid."),new d("getResults():invalid-field","outField is invalid.");var e=B.createQuery(),l=w.orderByFields,z=w.searchQueryParams;z&&e.set(z);l&&(e.orderByFields=l);m&&(e.outSpatialReference=m,l=1/k.getMetersPerUnitForSR(m))&&(e.maxAllowableOffset=l);l=!!B.get("capabilities.data.supportsZ");
e.returnZ=l&&!1!==h;e.returnGeometry=!0;c&&(e.outFields=c);if(v)e.geometry=v;else if(p.key)e.objectIds=[parseInt(p.key,10)];else{h=w.searchFields||[g];if(!b(B,h))throw E.error("invalid-field: search field is invalid."),new d("getResults():invalid-field","search field is invalid.");a(B)&&(e.num=x);D&&(e.geometry=D);if(!p.text.trim())return[];c=w.prefix;l=w.suffix;c=(""+(void 0===c?"":c)+p.text+(void 0===l?"":l)).replace(/\'/g,"''");h=q(c,B,h,u,n);if(!h)return[];e.where=h}return B.queryFeatures(e,{signal:H}).then(function(a){return r(a,
t,w,y,g,C,F)})})};m.getSuggestions=function(e,g){var k=e.source,l=e.spatialReference,n=e.suggestTerm,v=e.maxSuggestions,x=e.sourceIndex,r=k.layer,w=k.filter,m=g&&g.signal,y=h(k,e.view);return c(r).then(function(){if(!a(r))return[];var c=k.displayField||k.layer.displayField||f(k.layer),e=k.searchFields||[c],h=[];k.suggestionTemplate?k.suggestionTemplate.replace(F,function(a,b){h.push(b);return a}):h.push(c);var g=h&&-1!==h.indexOf("*");-1!==h.indexOf(r.objectIdField)||g||h.push(r.objectIdField);var p=
!!r.getField(c),g=g||b(r,h),z=b(r,e);if(!p)throw E.error("invalid-field: displayField is invalid."),new d("getSuggestions():invalid-field","displayField is invalid.");if(!g)throw E.error("invalid-field: outField is invalid."),new d("getSuggestions():invalid-field","outField is invalid.");if(!z)throw E.error("invalid-field: search field is invalid."),new d("getSuggestions():invalid-field","search field is invalid.");p=r.createQuery();g=k.orderByFields;(z=k.suggestQueryParams)&&p.set(z);g&&(p.orderByFields=
g);p.outSpatialReference=l;p.returnGeometry=!1;p.num=v;p.outFields=h;y&&(p.geometry=y);if(!n.trim())return[];g=k.prefix;z=k.suffix;g=(""+(void 0===g?"":g)+n+(void 0===z?"":z)).replace(/\'/g,"''");e=q(g,r,e,w,!1);if(!e)return[];p.where=e;return r.queryFeatures(p,{signal:m}).then(function(a){return t(a,k,x,c)})})}})},"esri/widgets/Search/support/geometryUtils":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../geometry/support/scaleUtils ../../../views/MapView".split(" "),
function(u,m,p,d,n,g,l,k,e){function h(a,c,b){var f=a.hasZ?a.z:void 0;return c&&c.map?(b?k.getExtentForScale(c,b):c.extent).clone().centerAt(a).set({zmax:f,zmin:f}):new p.Extent({xmin:a.x-.25,ymin:a.y-.25,xmax:a.x+.25,ymax:a.y+.25,spatialReference:a.spatialReference,zmin:f,zmax:f})}Object.defineProperty(m,"__esModule",{value:!0});var c=n.getLogger("esri.widgets.Search.support.geometryUtils");m.getPointWithElevation=function(a,f){return f?a?a.hasZ||f instanceof e?l.resolve(a):(f=f.get("map.ground"))&&
f.layers.length?f.queryElevation(a).then(function(a){return a.geometry}):l.resolve(a):(c.error("missing-parameter: point is missing."),l.reject(new d("searchgeometryutils:missing-parameter","point is missing."))):(c.error("missing-parameter: view is missing."),l.reject(new d("searchgeometryutils:missing-parameter","view is missing.")))};m.getPointFromGeometry=function(a){return a instanceof p.Point?a:a instanceof p.Extent?a.center:a instanceof p.Polygon?a.centroid:a instanceof p.Multipoint?a.getPoint(0):
a instanceof p.Polyline?a.getPoint(0,0):null};m.createExtentFromGeometry=function(a,c,b){if(g.isNone(a))return null;if(a instanceof p.Extent)return a;if(a instanceof p.Multipoint||a instanceof p.Polygon||a instanceof p.Polyline)return a.extent;if(a instanceof p.Point)return h(a,c,b)};m.scaleExtent=function(a,c,b){return g.isNone(a)||g.isNone(c)?null:h(a.center,c,b)}})},"esri/views/MapView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../core/Error ../core/has ../core/Logger ../core/promiseUtils ../core/screenUtils ../core/watchUtils ../core/workers ../core/accessorSupport/decorators ./BreakpointsOwner ./DOMContainer ./Magnifier ./MapViewBase ./2d/input/MapViewInputManager ./2d/support/HighlightOptions ./support/screenshotUtils ./support/WebGLRequirements ./ui/2d/DefaultUI2D @dojo/framework/shim/Promise".split(" "),
function(u,m,p,d,n,g,l,k,e,h,c,a,f,b,x,v,y,q,B,C,t,r,w){function F(){return g(this,void 0,void 0,function(){var a,b,c,f,e,d,h;return n(this,function(g){switch(g.label){case 0:return[4,Promise.all([new Promise(function(a,b){u(["./webgl"],a,b)}),new Promise(function(a,b){u(["./2d/mapViewDeps"],a,b)}),new Promise(function(a,b){u(["./2d/engine"],a,b)})])];case 1:return a=g.sent(),b=a[1],c=b.GraphicsView2D,f=b.LabelManager,e=b.MapViewNavigation,d=b.MagnifierView2D,h=a[2].Stage,G=c,K=f,O=e,z=d,H=h,[2]}})})}
function E(a){return!("layerViews"in a)&&null!=a.container}var D=e.getLogger("esri.views.MapView"),H,G,K,O,z;return function(e){function g(a){a=e.call(this,a)||this;a._magnifierView=null;a._stage=null;a._resolveWhenReady=[];a.graphicsView=null;a.highlightOptions=new C;a.magnifier=new y;a.inputManager=new B({view:a});a.mapViewNavigation=null;a.supersampleScreenhotsEnabled=!0;a.ui=new w;a.rendering=!1;f.initialize();return a}p(g,e);g.prototype.destroy=function(){this.inputManager.destroy();this._set("inputManager",
null)};Object.defineProperty(g.prototype,"background",{get:function(){return this.get("map.initialViewProperties.background")||null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"navigating",{get:function(){return!(!this.mapViewNavigation||!this.mapViewNavigation.interacting)},enumerable:!0,configurable:!0});g.prototype.toMap=function(a){if(c.isSupportedScreenPointEvent(a)){var b=c.createScreenPointFromSupportedEvent(this,a);return this.inherited(arguments,[b])}return this.inherited(arguments)};
g.prototype.hitTest=function(a){var b=c.isSupportedScreenPointEvent(a)?c.createScreenPointFromSupportedEvent(this,a):a;if(!this.ready||isNaN(b.x)||isNaN(b.y))return h.resolve({screenPoint:b,results:[]});var f=this.toMap(b);a=[this.graphicsView];a.push.apply(a,this.allLayerViews.toArray().reverse());return h.all(a.map(function(a){return a&&a.hitTest?a.hitTest(b.x,b.y):null})).then(function(a){return{screenPoint:b,results:a.filter(function(a){return null!=a}).map(function(a){return{mapPoint:f,graphic:a}})}})};
g.prototype.takeScreenshot=function(a){return this.ready?this._stage.takeScreenshot(t.toRenderSettings(a,this),this.allLayerViews):h.reject("Map view cannot be used before it is ready")};g.prototype.on=function(a,b,c,f){var e=this.inputManager&&this.viewEvents.on(a,b,c,f);return e?e:this.inherited(arguments)};g.prototype.hasEventListener=function(a){return this.inherited(arguments)||this.viewEvents.hasHandler(a)};g.prototype.whenLayerView=function(a){return this.inherited(arguments)};g.prototype.graphicChanged=
function(a){this.graphicsView&&this.graphicsView.graphicUpdateHandler(a)};g.prototype.whenReady=function(){var a=this;return h.create(function(b){a.ready?b(a):a._resolveWhenReady.push(b)})};g.prototype.forceDOMReadyCycle=function(){this.forceReadyCycle()};g.prototype.validate=function(){var a=r.check({supportsMajorWebPerformanceCaveat:!0});k("safari")&&9>k("safari")&&(a=new l("mapview:browser-not-supported","This browser is not supported by MapView (Safari \x3c 9)",{type:"safari",requiredVersion:9,
detectedVersion:k("safari")}));return a?(D.warn("#validate()",a.message),h.reject(a)):F()};g.prototype._startup=function(){var b=this;this.timeline.begin("MapView Startup");this.inherited(arguments);this.graphics.owner=this;var c=new H(this.surface,{canvas:this.renderCanvas,supersampleScreenshots:this.supersampleScreenhotsEnabled,contextOptions:{deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline}),
f=new G({view:this,graphics:this.graphics}),e=new O({view:this,animationManager:this.animationManager}),d=new K({view:this});this._magnifierView=new z;this._magnifierView.magnifier=this.magnifier;this._stage=c;this.frameTask.graphicsView=f;this._set("graphicsView",f);this._set("mapViewNavigation",e);this._set("labelManager",d);this.handles.add([this.allLayerViews.on("change",function(){return b._updateStageChildren()}),c.on("post-render",function(){return b._set("rendering",b.allLayerViews.some(function(a){return!("layerViews"in
a)&&!0===a.rendering}))}),c.on("webgl-error",function(a){return b.fatalError=a.error}),a.init(this,"stationary",function(a){return c.stationary=a},!0),a.init(this,"state.id",function(){return c.state=b.state},!0),a.init(this,"background",function(a){return c.background=a},!0),a.init(this,"magnifier",function(a){return b._magnifierView.magnifier=a},!0),a.init(this,"renderingOptions",function(a){return c.renderingOptions=a},!0),a.init(this,"highlightOptions",function(){return c.highlightOptions=b.highlightOptions},
!0)],"map-view");c.state=this.state;c.background=this.background;this._updateStageChildren();f=this._resolveWhenReady;this._resolveWhenReady=[];f.forEach(function(a){return a(b)});this.timeline.end("MapView Startup")};g.prototype._teardown=function(){this.handles.remove("map-view");this.layerViewManager.clear();this.labelManager.destroy();this._magnifierView.destroy();this._stage.destroy();this.graphicsView.destroy();this.mapViewNavigation.destroy();this._stage=null;this._set("graphicsView",null);
this._magnifierView=null;this._set("labelManager",null);this._set("mapViewNavigation",null);this.graphics.owner=null;this.inherited(arguments)};g.prototype._updateStageChildren=function(){var a=this;this._stage.removeAllChildren();this.allLayerViews.filter(E).forEach(function(b,c){a._stage.addChildAt(b.container,c)});this._stage.addChild(this.graphicsView.container);this._stage.addChild(this._magnifierView)};d([b.property({readOnly:!0,dependsOn:["map.initialViewProperties?.background"]})],g.prototype,
"background",null);d([b.property()],g.prototype,"graphicsView",void 0);d([b.property({type:C})],g.prototype,"highlightOptions",void 0);d([b.property({type:y})],g.prototype,"magnifier",void 0);d([b.property({readOnly:!0})],g.prototype,"inputManager",void 0);d([b.property({readOnly:!0})],g.prototype,"mapViewNavigation",void 0);d([b.property({dependsOn:["mapViewNavigation.interacting"],type:Boolean})],g.prototype,"navigating",null);d([b.property({type:Boolean,constructOnly:!0})],g.prototype,"supersampleScreenhotsEnabled",
void 0);d([b.property({type:w})],g.prototype,"ui",void 0);d([b.property({readOnly:!0})],g.prototype,"rendering",void 0);d([b.property({constructOnly:!0})],g.prototype,"renderCanvas",void 0);d([b.property({constructOnly:!0})],g.prototype,"deactivatedWebGLExtensions",void 0);d([b.property({constructOnly:!0})],g.prototype,"debugWebGLExtensions",void 0);return g=d([b.subclass("esri.views.MapView")],g)}(b.declared(x.BreakpointsOwner(v.DOMContainer(q))))})},"esri/views/Magnifier":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/accessorSupport/decorators".split(" "),
function(u,m,p,d,n,g){return function(l){function k(e){e=l.call(this,e)||this;e.factor=1.5;e.offsetX=0;e.offsetY=0;e.position=null;e.visible=!1;return e}p(k,l);Object.defineProperty(k.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});d([g.property({type:Number})],k.prototype,"factor",void 0);d([g.property({type:Number})],k.prototype,"offsetX",void 0);d([g.property({type:Number})],k.prototype,"offsetY",void 0);d([g.property()],k.prototype,"position",
void 0);d([g.property({readOnly:!0,dependsOn:["factor","offsetX","offsetY","position","visible"]})],k.prototype,"version",null);d([g.property({type:Boolean})],k.prototype,"visible",void 0);return k=d([g.subclass("esri.views.Magnifier")],k)}(g.declared(n))})},"esri/views/MapViewBase":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../geometry ../Viewpoint ../core/Error ../core/Logger ../core/now ../core/promiseUtils ../core/screenUtils ../core/watchUtils ../core/accessorSupport/decorators ../geometry/support/webMercatorUtils ../layers/support/TileInfo ./PopupView ./View ./ViewAnimation ./2d/AnimationManager ./2d/FrameTask ./2d/layerViewModuleImportUtils ./2d/MapViewConstraints ./2d/PaddedViewState ./2d/tiling ./2d/viewpointUtils ./2d/support/Timeline".split(" "),
function(u,m,p,d,n,g,l,k,e,h,c,a,f,b,x,v,y,q,B,C,t,r,w,F,E,D,H){var G=e.getLogger("esri.views.MapView");return function(e){function q(a){var b=e.call(this,a)||this;b._stationaryTimer=null;b.frameTask=new t.default(b);b.featuresTilingScheme=null;b.fullOpacity=1;b.initialExtent=null;b.labelManager=null;b.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0};b.resizeAlign="center";b.timeline=new H.Timeline;b.type="2d";b.constraints=new w;b.padding=
{top:0,right:0,bottom:0,left:0};var c=b.handles,f=function(){return b.notifyChange("updating")};c.add([b.watch("viewpoint",function(){b._lastStationaryEventTimestamp=h();b._flipStationary(160)},!0),b.on("resize",function(a){return b._resizeHandler(a)}),b.watch("animationManager.animation",function(a){b.animation=a}),b.allLayerViews.on("change",function(){f();c.remove("map-view-base-layerViewsUpdating");c.add(b.allLayerViews.map(function(a){return a.watch("updating",f)}),"map-view-base-layerViewsUpdating")})],
"map-view-base");return b}d(q,e);q.prototype.destroy=function(){this.destroyed||(this._set("preconditionsReady",!1),this._gotoTask=this.frameTask=null)};Object.defineProperty(q.prototype,"animation",{set:function(a){var b=this,c=this._get("animation");a!==c&&(c&&c.stop(),!a||a.isFulfilled()?this._set("animation",null):(this._set("animation",a),this.frameTask.animationInProgress=!0,c=function(){a===b._get("animation")&&(b._set("animation",null),b.frameTask.requestFrame());b.frameTask.animationInProgress=
!1},a.when(c,c)))},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"center",{get:function(){if(!this.ready)return this._get("center");var a=this.state.paddedViewState,b=a.center;return new g.Point({x:b[0],y:b[1],spatialReference:a.spatialReference})},set:function(a){if(null!=a)if(this._normalizeInput(a))if(this.ready){var b=this.viewpoint;D.centerAt(b,b,a);this.viewpoint=b}else this._set("center",a),this.notifyChange("initialExtentRequired");else G.error("#center","incompatible spatialReference "+
JSON.stringify(a.spatialReference)+" with view's spatialReference "+JSON.stringify(this.spatialReference))},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"constraints",{set:function(a){var b=this,c=this._get("constraints");c&&(this.handles.remove("map-view-base-constraints"),c.destroy());this._set("constraints",a);a&&(a.view=this,this.ready&&(this.state.viewpoint=a.fit(this.state.paddedViewState.viewpoint)),this.handles.add(a.on("update",function(){b.ready&&b.state&&(b.state.viewpoint=
a.fit(b.state.paddedViewState.viewpoint))}),"map-view-base-constraints"))},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"extent",{get:function(){return this.ready?this.state.paddedViewState.extent.clone():this._get("extent")},set:function(a){if(null!=a){var b=this._normalizeInput(a);b?b.width&&b.height?this.ready?(a=this.viewpoint,D.setExtent(a,a,b,this.size,{constraints:this.constraints}),this.viewpoint=a):(this._set("extent",b),this._set("center",null),this._set("viewpoint",
null),this._set("scale",0),this._set("zoom",-1),this.notifyChange("initialExtentRequired")):G.error("#extent","invalid extent size"):G.error("#center","incompatible spatialReference "+JSON.stringify(a.spatialReference)+" with view's spatialReference "+JSON.stringify(this.spatialReference))}},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"initialExtentRequired",{get:function(){var a=this.extent,b=this.center,c=this.scale,f=this.viewpoint,e=this.zoom;return this.get("map.initialViewProperties.viewpoint")||
a||b&&(0!==c||-1!==e)||f?!1:!0},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"padding",{get:function(){return this.ready?this.state.padding:this._get("padding")},set:function(a){this.ready?(this.state.padding=a,this._set("padding",this.state.padding)):this._set("padding",a)},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"resolution",{get:function(){return this.state?this.state.resolution:0},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,
"rotation",{get:function(){return this.ready?this.state.rotation:this._get("rotation")},set:function(a){if(!isNaN(a))if(this.ready){var b=this.viewpoint;D.rotateTo(b,b,a);this.viewpoint=b}else this._set("rotation",a)},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"scale",{get:function(){return this.ready?this.state.scale:this._get("scale")},set:function(a){if(a&&!isNaN(a))if(this.ready){var b=this.viewpoint;D.scaleTo(b,b,a);this.viewpoint=b}else{this._set("scale",a);this._set("zoom",
-1);if(a=this._get("extent"))this._set("extent",null),this._set("center",a.center);this.notifyChange("initialExtentRequired")}},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"stationary",{get:function(){return!this.animation&&!this.navigating&&!this._get("resizing")&&!this._stationaryTimer},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"updating",{get:function(){return!this.destroyed&&(!0===this.get("layerViewManager.updating")||!0===this.get("labelManager.updating")||
!0===this.get("graphicsView.updating")||this.allLayerViews.some(function(a){return!a.destroyed&&!("layerViews"in a)&&a.attached&&!0===a.updating}))},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"viewpoint",{get:function(){if(!this.ready)return this._get("viewpoint");var a=this.state.paddedViewState;return a&&a.viewpoint.clone()},set:function(a){if(null!=a){var b=this._normalizeInput(a);b?this.ready?(a=new l({targetGeometry:new g.Point,scale:0,rotation:0}),D.copy(a,b),this.constraints.constrain(a,
this.state.paddedViewState.viewpoint),this.state.viewpoint=a,this.frameTask.requestFrame(),this._set("viewpoint",a)):(this._set("viewpoint",b),this._set("extent",null),this._set("center",null),this._set("zoom",-1),this._set("scale",0),this.notifyChange("initialExtentRequired")):!a.scale||isNaN(a.scale)?G.error("#viewpoint","invalid scale value of "+a.scale):a.targetGeometry?G.error("#viewpoint","incompatible spatialReference "+JSON.stringify(a.targetGeometry.spatialReference)+" with view's spatialReference "+
JSON.stringify(this.spatialReference)):G.error("#viewpoint","geometry not defined")}},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"zoom",{get:function(){return this.ready?this.constraints.scaleToZoom(this.scale):this._get("zoom")},set:function(a){if(null!=a){if(!this.ready){this.notifyChange("initialExtentRequired");this._set("zoom",a);this._set("scale",0);var b=this._get("extent");b&&(this._set("extent",null),this._set("center",b.center))}this.constraints.effectiveLODs&&(b=
this.viewpoint,D.scaleTo(b,b,this.constraints.zoomToScale(a)),this.viewpoint=b,this._set("zoom",this.constraints.scaleToZoom(this.scale)))}},enumerable:!0,configurable:!0});q.prototype.goTo=function(a,b){var c=this;if(a)return f.whenTrueOnce(this,"ready",b&&b.signal).then(function(){c.animation&&(c.animation=null);var f=p({animate:!0},b),e=D.createAsync(a,c);c._gotoTask={};return f.animate?c._gotoAnimated(e,f):c._gotoImmediate(e,f)});G.error("#goTo()","target cannot be null or undefined")};q.prototype.hitTest=
function(a){return c.reject("Should be implemented by subclasses")};q.prototype.popupHitTest=function(a){var b=this;return this.hitTest(a).then(function(c){return p({},c,{mapPoint:b.toMap(a)})})};q.prototype.toMap=function(a){if(!this.ready)return null;a=this.state.toMap([0,0],[a.x,a.y]);return new g.Point({x:a[0],y:a[1],spatialReference:this.spatialReference})};q.prototype.isTileInfoRequired=function(){return!0};q.prototype.toScreen=function(b){if(!this.ready)return null;b=this._normalizeInput(b);
b=[b.x,b.y];b=this.state.toScreen(b,b);return a.createScreenPoint(b[0],b[1])};q.prototype.pixelSizeAt=function(){return this.ready?this.state.resolution:(G.error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)};q.prototype.requestLayerViewUpdate=function(a){this.ready&&this.frameTask.requestLayerViewUpdate(a)};q.prototype.requestUpdate=function(a){this.ready&&this.frameTask.requestUpdate(a)};q.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||
this.get("defaultsFromMap.spatialReference")||null};q.prototype.isSpatialReferenceSupported=function(a,b){return b||this._get("ready")?!0:null!==this._getDefaultViewpoint()};q.prototype.importLayerView=function(a){return r.layerView2DImporter.importLayerView(a)};q.prototype.hasLayerViewModule=function(a){return r.layerView2DImporter.hasLayerViewModule(a)};q.prototype._createOrReplaceAnimation=function(a){if(!this.animation||this.animation.done)this.animation=new B;this.animation.update(a);return this.animation};
q.prototype._cancellableGoTo=function(a,b,f){var e=this,d=f.then(function(){a===e._gotoTask&&(e.animation=null)}).catch(function(c){a===e._gotoTask&&(e.animation=null,b.done||(b.stop(),e.frameTask.animationInProgress=!1));throw c;}),g=c.create(function(a){return a(d)},function(){a!==e._gotoTask||b.done||(b.stop(),e.frameTask.animationInProgress=!1)});b.when().catch(function(){a===e._gotoTask&&g.cancel&&g.cancel()});return g};q.prototype._gotoImmediate=function(a,b){var f=this,e=this._gotoTask,d=this._createOrReplaceAnimation(a);
a=a.then(function(a){c.throwIfAborted(b);if(e!==f._gotoTask)throw new k("view:goto-interrupted","Goto was interrupted");f.viewpoint=d.target=a;d.finish()});return this._cancellableGoTo(e,d,a)};q.prototype._gotoAnimated=function(a,b){var c=this,f=this._gotoTask,e=this._createOrReplaceAnimation(a);a=a.then(function(a){if(f!==c._gotoTask)throw new k("view:goto-interrupted","Goto was interrupted");e.update(a);c.animationManager.animate(e,c.viewpoint,b);return e.when().then(function(){},function(){})});
return this._cancellableGoTo(f,e,a)};q.prototype._resizeHandler=function(a){var b=this.state;if(b){var c=this.state.paddedViewState.viewpoint,f=this.state.paddedViewState.size.concat();b.size=[a.width,a.height];D.resize(c,c,f,this.state.paddedViewState.size,this.resizeAlign);c=this.constraints.constrain(c,null);this.state.viewpoint=c}};q.prototype._startup=function(){var a=this._getDefaultViewpoint();this.constraints.view=this;this.constraints.fit(a);this._set("animationManager",new C.default({view:this}));
this._set("state",new F({padding:this._get("padding"),size:this.size,viewpoint:a}));this._set("featuresTilingScheme",new E.TileInfoView(v.create({spatialReference:this.spatialReference,size:512})));this._set("ready",!0);this.frameTask&&this.frameTask.start()};q.prototype._teardown=function(){this.frameTask&&this.frameTask.stop();this._set("ready",!1);this._stationaryTimer&&(clearTimeout(this._stationaryTimer),this._stationaryTimer=null);var a=this.state.paddedViewState,b=a.center,c=a.spatialReference,
f=a.rotation,a=a.scale,b=new g.Point({x:b[0],y:b[1],spatialReference:c});this._set("viewpoint",null);this._set("extent",null);this._set("center",b);this._set("zoom",-1);this._set("rotation",f);this._set("scale",a);this._set("spatialReference",c);this.constraints.view=null;this.animationManager.destroy();this._set("animationManager",null);this._set("state",null);this.animation=null};q.prototype._flipStationary=function(a){var b=this;return null!==this._stationaryTimer?this._stationaryTimer:this._stationaryTimer=
setTimeout(function(){b._stationaryTimer=null;var a=h()-b._lastStationaryEventTimestamp;160>a&&(b._stationaryTimer=b._flipStationary(a))},a)};q.prototype._normalizeInput=function(a,b){void 0===b&&(b=this.spatialReference);var c=a&&a.targetGeometry||a;return b?c?b.equals(c.spatialReference)?a:x.canProject(c,b)?a&&"esri.Viewpoint"===a.declaredClass?(a.targetGeometry=x.project(c,b),a):x.project(c,b):null:null:a};q.prototype._getDefaultViewpoint=function(){var a=this.constraints,b=this._get("zoom"),c=
this._get("scale"),f=this._normalizeInput(this._get("center")),e=this._normalizeInput(this._get("extent")),d=this._get("rotation"),g=this._normalizeInput(this._get("viewpoint"));a.effectiveLODs?-1!==b&&(c=a.zoomToScale(b)):b=-1;var h=null,k=null,b=0,a=g&&g.rotation,q=g&&g.targetGeometry;q&&("extent"===q.type?h=q:"point"===q.type&&(k=q,b=g.scale));g=this._normalizeInput(this.get("map.initialViewProperties.viewpoint.targetGeometry.extent"));q=this._normalizeInput(this.initialExtent);e=e||h||g||q;f=
f||k||e&&e.center;c=c||b||e&&D.extentToScale(e,this.size);return f&&c?new l({targetGeometry:f,scale:c,rotation:d||a||0}):null};n([b.property()],q.prototype,"_stationaryTimer",void 0);n([b.property()],q.prototype,"animation",null);n([b.property({readOnly:!0})],q.prototype,"animationManager",void 0);n([b.property({value:null,type:g.Point,dependsOn:["state.id","ready"]})],q.prototype,"center",null);n([b.property({type:w})],q.prototype,"constraints",null);n([b.property({value:null,type:g.Extent,dependsOn:["state.id",
"ready"]})],q.prototype,"extent",null);n([b.property({readOnly:!0})],q.prototype,"featuresTilingScheme",void 0);n([b.property()],q.prototype,"fullOpacity",void 0);n([b.property({type:g.Extent})],q.prototype,"initialExtent",void 0);n([b.property({dependsOn:["map.initialViewProperties?.viewpoint"]})],q.prototype,"initialExtentRequired",null);n([b.property()],q.prototype,"labelManager",void 0);n([b.property({value:{top:0,right:0,bottom:0,left:0},cast:function(a){return p({top:0,right:0,bottom:0,left:0},
a)}})],q.prototype,"padding",null);n([b.property({type:Object})],q.prototype,"renderingOptions",void 0);n([b.property()],q.prototype,"resizeAlign",void 0);n([b.property({readOnly:!0,dependsOn:["state.id"]})],q.prototype,"resolution",null);n([b.property({value:0,type:Number,dependsOn:["state.id","ready"]})],q.prototype,"rotation",null);n([b.property({value:0,type:Number,dependsOn:["state.id","ready"]})],q.prototype,"scale",null);n([b.property({type:g.SpatialReference,dependsOn:["map.initialViewProperties?.spatialReference",
"defaultsFromMap.isSpatialReferenceDone"]})],q.prototype,"spatialReference",void 0);n([b.property({readOnly:!0})],q.prototype,"state",void 0);n([b.property({dependsOn:["animation","navigating","resizing","_stationaryTimer"]})],q.prototype,"stationary",null);n([b.property({type:H.Timeline,readOnly:!0})],q.prototype,"timeline",void 0);n([b.property({readOnly:!0})],q.prototype,"type",void 0);n([b.property({readOnly:!0,dependsOn:["layerViewManager.updating","labelManager.updating","graphicsView?.updating"]})],
q.prototype,"updating",null);n([b.property({value:null,type:l,dependsOn:["state.id","ready"]})],q.prototype,"viewpoint",null);n([b.property({value:-1,dependsOn:["state.id"]})],q.prototype,"zoom",null);return q=n([b.subclass("esri.views.MapViewBase")],q)}(b.declared(y.PopupView(q)))})},"esri/views/2d/AnimationManager":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../geometry ../../Viewpoint ../../core/Accessor ../../core/scheduling ../../core/accessorSupport/decorators ../ViewAnimation ./unitBezier ./viewpointUtils".split(" "),
function(u,m,p,d,n,g,l,k,e,h,c,a){Object.defineProperty(m,"__esModule",{value:!0});var f=function(){function a(a,b,f,e){var d=a.targetGeometry,g=b.targetGeometry;e?"string"===typeof e&&(e=c.parse(e)||c.easingFunctions.ease):e=c.easingFunctions.ease;this.easing=e;this.duration=f;this.sCenterX=d.x;this.sCenterY=d.y;this.sScale=a.scale;this.sRotation=a.rotation;this.tCenterX=g.x;this.tCenterY=g.y;this.tScale=b.scale;this.tRotation=b.rotation;this.dCenterX=this.tCenterX-this.sCenterX;this.dCenterY=this.tCenterY-
this.sCenterY;this.dScale=this.tScale-this.sScale;this.dRotation=this.tRotation-this.sRotation;180<this.dRotation?this.dRotation-=360:-180>this.dRotation&&(this.dRotation+=360)}a.prototype.applyRatio=function(a,b){var c=this.easing(b),f,e;1<=b?(b=this.tCenterX,f=this.tCenterY,e=this.tRotation,c=this.tScale):(b=this.sCenterX+c*this.dCenterX,f=this.sCenterY+c*this.dCenterY,e=this.sRotation+c*this.dRotation,c=this.sScale+c*this.dScale);a.targetGeometry.x=b;a.targetGeometry.y=f;a.scale=c;a.rotation=e};
return a}();u=function(b){function l(a){a=b.call(this,a)||this;a.duration=200;a.transition=null;a.easing=c.easingFunctions.ease;a.view=null;a.viewpoint=null;a.viewpoint=new g({targetGeometry:new n.Point,scale:0,rotation:0});a._updateTask=k.addFrameTask({postRender:a._postRender.bind(a)});a._updateTask.pause();return a}d(l,b);l.prototype.destroy=function(){this._updateTask.remove();this._updateTask=null};l.prototype.animate=function(b,c,e){var d=this;this.stop();a.copy(this.viewpoint,c);this.transition=
new f(this.viewpoint,b.target,e&&e.duration||this.duration,e&&e.easing||this.easing);c=function(){d.animation===b&&d._updateTask&&("finished"===b.state&&(d.transition.applyRatio(d.viewpoint,1),d.view.state&&(d.view.state.viewpoint=d.viewpoint.clone())),d.animation=null,d.updateFunction=null)};b.when(c,c);this._startTime=k.now();this._updateTask.resume();return this.animation=b};l.prototype.animateContinous=function(a,b){var c=this;this.stop();this.updateFunction=b;this.viewpoint=a;var f=new h({target:a.clone()});
a=function(){c.animation===f&&c._updateTask&&(c.animation=null,c.updateFunction=null)};f.when(a,a);this._startTime=k.now();this._updateTask.resume();return this.animation=f};l.prototype.stop=function(){this.animation&&(this.animation.stop(),this.updateFunction=this.animation=null)};l.prototype._postRender=function(a){var b=this.animation;b&&b.state!==h.State.STOPPED?(this.updateFunction?this.updateFunction(this.viewpoint,a.deltaTime):(a=(k.now()-this._startTime)/this.transition.duration,b=1<=a,this.transition.applyRatio(this.viewpoint,
a),b&&this.animation.finish()),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())):this._updateTask.pause()};p([e.property()],l.prototype,"animation",void 0);p([e.property()],l.prototype,"duration",void 0);p([e.property()],l.prototype,"transition",void 0);p([e.property()],l.prototype,"easing",void 0);p([e.property()],l.prototype,"view",void 0);p([e.property()],l.prototype,"viewpoint",void 0);return l=p([e.subclass("esri.views.2d.AnimationManager")],l)}(e.declared(l));m.default=u})},
"esri/views/2d/unitBezier":function(){define(["require","exports"],function(u,m){function p(d,g,l,k){function e(b,f){var e,d,g,k;g=b;for(d=0;8>d;d++){k=((a*g+c)*g+h)*g-b;if(Math.abs(k)<f)return g;e=(3*a*g+2*c)*g+h;if(1E-6>Math.abs(e))break;g-=k/e}e=0;d=1;g=b;if(g<e)return e;if(g>d)return d;for(;e<d;){k=((a*g+c)*g+h)*g;if(Math.abs(k-b)<f)break;b>k?e=g:d=g;g=.5*(d-e)+e}return g}var h=3*d,c=3*(l-d)-h,a=1-h-c,f=3*g,b=3*(k-g)-f,n=1-f-b;return function(a,c){void 0===c&&(c=1E-6);a=e(a,c);return((n*a+b)*
a+f)*a}}Object.defineProperty(m,"__esModule",{value:!0});m.unitBezier=p;var d=/^cubic-bezier\((.*)\)/;m.easingFunctions={};m.parse=function(n){var g=m.easingFunctions[n]||null;!g&&(n=d.exec(n))&&(n=n[1].split(",").map(function(d){return parseFloat(d.trim())}),4!==n.length||n.some(function(d){return isNaN(d)})||(g=p.apply(p,n)));return g};m.easingFunctions.ease=p(.25,.1,.25,1);m.easingFunctions.linear=p(0,0,1,1);m.easingFunctions.easeIn=m.easingFunctions["ease-in"]=p(.42,0,1,1);m.easingFunctions.easeOut=
m.easingFunctions["ease-out"]=p(0,0,.58,1);m.easingFunctions.easeInOut=m.easingFunctions["ease-in-out"]=p(.42,0,.58,1)})},"esri/views/2d/FrameTask":function(){define(["require","exports","../../core/scheduling"],function(u,m,p){Object.defineProperty(m,"__esModule",{value:!0});u=function(){function d(d){var g=this;this.view=d;this._frameTaskHandle=null;this.updateEnabled=this.stationary=!0;this.animationInProgress=!1;this.prepare=function(){g._updateParameters.state=g.view.state;g._updateParameters.stationary=
g.view.stationary;g._updateParameters.pixelRatio=window.devicePixelRatio;g._updateParameters.renderingOptions=g.view.renderingOptions};this.update=function(){if(g.updateEnabled){var d=g.view,k=d.labelManager,e=g.graphicsView,h=d.allLayerViews.toArray().filter(function(a){return!("layerViews"in a)&&a.isFulfilled()}),c=h.length,a=d.state,f=0;for(;f<h.length;f++)if(d=h[f],d.attached){var b=d.lastUpdateId;if(null==b||!g.stationary&&!d.moving)d.moving=!0,d.moveStart();b!==a.id&&d.viewChange();g.stationary&&
d.moving&&(d.moving=!1,d.moveEnd());d.lastUpdateId=a.id}k&&k.lastUpdateId!==a.id&&(k.viewChange(),k.lastUpdateId=a.id);e&&e.lastUpdateId!==a.id&&(e.viewChange(),e.lastUpdateId=a.id);k=g._layerViewsTrash;for(e=0;e<k.length;e++)d=k[e],g._detachLayerView(d);for(e=k.length=0;e<c;e++)d=h[e],d.isFulfilled()&&!d.attached&&g._attachLayerView(d);h=g._updateParameters;c=g._layerViewsToUpdate;d=c.slice();e=c.length=0;for(a=d;e<a.length;e++)d=a[e],"layerViews"in d?c.push(d):d.processUpdate(h);c=g._updatablesToUpdate;
d=c.slice();for(c=c.length=0;c<d.length;c++)d[c].processUpdate(h);g.animationInProgress||0!==g._layerViewsToUpdate.length||0!==g._updatablesToUpdate.length||0!==k.length||g._frameTaskHandle.pause()}}}d.prototype.destroy=function(){this.stop()};d.prototype.start=function(){var d=this;this.stationary=this.view.stationary;this._updateParameters={state:this.view.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:this.view.renderingOptions};this._layerViewsTrash=[];this._layerViewsToUpdate=
[];this._updatablesToUpdate=[];this._allLayerViewsChangeHandle=this.view.allLayerViews.on("change",function(g){Array.prototype.push.apply(d._layerViewsTrash,g.removed);d.requestFrame()});this._stationaryHandle=this.view.watch("stationary",function(g){d.stationary=g;d.requestFrame()});this._frameTaskHandle=p.addFrameTask(this)};d.prototype.stop=function(){var d=this;this._frameTaskHandle&&(this.view.allLayerViews.forEach(function(g){"layerViews"in g||d._detachLayerView(g)}),this._stationaryHandle.remove(),
this._allLayerViewsChangeHandle.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._allLayerViewsChangeHandle=this._frameTaskHandle=this._layerViewsTrash=this._layerViewsToUpdate=null,this.stationary=!0,this.animationInProgress=!1)};d.prototype.requestLayerViewUpdate=function(d){this._layerViewsToUpdate.push(d);this.requestFrame()};d.prototype.requestUpdate=function(d){this._updatablesToUpdate.push(d);this.requestFrame()};d.prototype.requestFrame=function(){this._frameTaskHandle&&
this._frameTaskHandle.resume()};d.prototype._attachLayerView=function(d){d.attached||(d.attached=!0,d.attach(),this._updateParameters.stationary?d.moving=!1:(d.moving=!0,d.moveStart()))};d.prototype._detachLayerView=function(d){d.attached&&(d.detach(),d.attached=!1,d.moving=!1)};return d}();m.default=u})},"esri/views/2d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error","../../core/maybe","@dojo/framework/shim/Promise"],function(u,m,p,d){function n(){return Promise.all([new Promise(function(e,
d){u(["../webgl"],e,d)}),new Promise(function(e,d){u(["./engine"],e,d)})])}Object.defineProperty(m,"__esModule",{value:!0});var g=function(){return n().then(function(){return new Promise(function(e,d){u(["./layers/TileLayerView2D"],e,d)})})},l=function(){return n().then(function(){return new Promise(function(e,d){u(["./layers/FeatureLayerView2D"],e,d)})})},k={"base-dynamic":function(){return n().then(function(){return new Promise(function(e,d){u(["./layers/BaseDynamicLayerView2D"],e,d)})})},"base-tile":g,
"bing-maps":g,csv:l,"geo-rss":function(){return n().then(function(){return new Promise(function(e,d){u(["./layers/GeoRSSLayerView2D"],e,d)})})},feature:l,geojson:l,graphics:function(){return n().then(function(){return new Promise(function(e,d){u(["./layers/GraphicsLayerView2D"],e,d)})})},group:function(){return n().then(function(){return new Promise(function(e,d){u(["../layers/GroupLayerView"],e,d)})})},imagery:function(){return n().then(function(){return new Promise(function(e,d){u(["./layers/ImageryLayerView2D"],
e,d)})})},"imagery-tile":function(){return n().then(function(){return new Promise(function(e,d){u(["./layers/TileImageryLayerView2D"],e,d)})})},kml:function(){return n().then(function(){return new Promise(function(e,d){u(["./layers/KMLLayerView2D"],e,d)})})},"map-image":function(){return n().then(function(){return new Promise(function(e,d){u(["./layers/MapImageLayerView2D"],e,d)})})},"map-notes":function(){return n().then(function(){return new Promise(function(e,d){u(["./layers/MapNotesLayerView2D"],
e,d)})})},"open-street-map":g,route:function(){return n().then(function(){return new Promise(function(e,d){u(["./layers/RouteLayerView2D"],e,d)})})},stream:function(){return n().then(function(){return new Promise(function(e,d){u(["./layers/StreamLayerView2D"],e,d)})})},tile:g,"vector-tile":function(){return n().then(function(){return new Promise(function(e,d){u(["./layers/VectorTileLayerView2D"],e,d)})})},"web-tile":g,wms:function(){return n().then(function(){return new Promise(function(e,d){u(["./layers/WMSLayerView2D"],
e,d)})})},wmts:function(){return n().then(function(){return new Promise(function(e,d){u(["./layers/WMTSLayerView2D"],e,d)})})},"base-elevation":null,"building-scene":null,elevation:null,"integrated-mesh":null,"point-cloud":null,scene:null,unknown:null,unsupported:null};m.layerView2DImporter={hasLayerViewModule:function(e){return d.isSome(k[e.type])},importLayerView:function(e){var g=k[e.type];if(!d.isSome(g))throw e=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",
g=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),new p(g+":view-not-supported",e+" is not supported in 2D");return g(e)}}})},"esri/views/2d/MapViewConstraints":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Evented ../../core/accessorSupport/decorators ../../layers/support/LOD ./constraints/RotationConstraint ./constraints/ZoomConstraint".split(" "),function(u,m,p,d,n,g,l,k,e){return function(h){function c(){var a=null!==
h&&h.apply(this,arguments)||this;a.lods=null;a.minScale=0;a.maxScale=0;a.minZoom=-1;a.maxZoom=-1;a.rotationEnabled=!0;a.snapToZoom=!0;return a}p(c,h);c.prototype.initialize=function(){this.watch("_zoom, _rotation",this.emit.bind(this,"update"),!0)};c.prototype.destroy=function(){this.view=null;this._set("_zoom",null);this._set("_rotation",null)};Object.defineProperty(c.prototype,"_rotation",{get:function(){return new k({rotationEnabled:this.rotationEnabled})},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"_defaultLODs",{get:function(){var a=this.get("view.defaultsFromMap.tileInfo"),c=this.get("view.spatialReference");return a&&c&&a.spatialReference.equals(c)?a.lods:null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_zoom",{get:function(){return new e({lods:this.lods||this._defaultLODs,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale,snapToZoom:this.snapToZoom})},enumerable:!0,configurable:!0});c.prototype.canZoomInTo=function(a){var c=this.effectiveMaxScale;
return 0===c||a>=c};c.prototype.canZoomOutTo=function(a){var c=this.effectiveMinScale;return 0===c||a<=c};c.prototype.constrain=function(a,c){this._zoom.constrain(a,c);this._rotation.constrain(a,c);return a};c.prototype.fit=function(a){return this._zoom.fit(a)};c.prototype.zoomToScale=function(a){return this._zoom.zoomToScale(a)};c.prototype.scaleToZoom=function(a){return this._zoom.scaleToZoom(a)};c.prototype.snapScale=function(a){return this._zoom.snapToClosestScale(a)};c.prototype.snapToNextScale=
function(a){return this._zoom.snapToNextScale(a)};c.prototype.snapToPreviousScale=function(a){return this._zoom.snapToPreviousScale(a)};d([g.property({readOnly:!0,aliasOf:"_zoom.effectiveLODs"})],c.prototype,"effectiveLODs",void 0);d([g.property({readOnly:!0,aliasOf:"_zoom.effectiveMinScale"})],c.prototype,"effectiveMinScale",void 0);d([g.property({readOnly:!0,aliasOf:"_zoom.effectiveMaxScale"})],c.prototype,"effectiveMaxScale",void 0);d([g.property({readOnly:!0,aliasOf:"_zoom.effectiveMinZoom"})],
c.prototype,"effectiveMinZoom",void 0);d([g.property({readOnly:!0,aliasOf:"_zoom.effectiveMaxZoom"})],c.prototype,"effectiveMaxZoom",void 0);d([g.property({type:[l]})],c.prototype,"lods",void 0);d([g.property()],c.prototype,"minScale",void 0);d([g.property()],c.prototype,"maxScale",void 0);d([g.property()],c.prototype,"minZoom",void 0);d([g.property()],c.prototype,"maxZoom",void 0);d([g.property()],c.prototype,"rotationEnabled",void 0);d([g.property()],c.prototype,"snapToZoom",void 0);d([g.property()],
c.prototype,"view",void 0);d([g.property({type:k,dependsOn:["rotationEnabled"]})],c.prototype,"_rotation",null);d([g.property({dependsOn:["view.spatialReference","view.defaultsFromMap.tileInfo"]})],c.prototype,"_defaultLODs",null);d([g.property({readOnly:!0,type:e,dependsOn:"lods minZoom maxZoom minScale maxScale snapToZoom _defaultLODs".split(" ")})],c.prototype,"_zoom",null);return c=d([g.subclass("esri.views.2d.MapViewConstraints")],c)}(g.declared(n.EventedAccessor))})},"esri/views/2d/constraints/RotationConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(u,m,p,d,n,g){return function(l){function k(){var e=null!==l&&l.apply(this,arguments)||this;e.enabled=!0;e.rotationEnabled=!0;return e}p(k,l);e=k;k.prototype.constrain=function(e,c){if(!this.enabled||!c)return e;this.rotationEnabled||(e.rotation=c.rotation);return e};k.prototype.clone=function(){return new e({enabled:this.enabled,rotationEnabled:this.rotationEnabled})};var e;d([g.property()],k.prototype,"enabled",void 0);d([g.property()],k.prototype,"rotationEnabled",void 0);return k=e=d([g.subclass("esri.views.2d.constraints.RotationConstraint")],
k)}(g.declared(n))})},"esri/views/2d/constraints/ZoomConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../layers/support/LOD".split(" "),function(u,m,p,d,n,g,l){return function(k){function e(c){c=k.call(this,c)||this;c._lodByScale={};c._scales=[];c.effectiveLODs=null;c.effectiveMinZoom=-1;c.effectiveMaxZoom=-1;c.effectiveMinScale=0;c.effectiveMaxScale=
0;c.lods=null;c.minZoom=-1;c.maxZoom=-1;c.minScale=0;c.maxScale=0;c.snapToZoom=!0;return c}p(e,k);h=e;e.prototype.initialize=function(){var c=this,a,f,b=this.lods;f=this.minScale;a=this.maxScale;var e=this.minZoom,d=this.maxZoom,g=-1,h=-1,k=!1,l=!1;0!==f&&0!==a&&f<a&&(a=[a,f],f=a[0],a=a[1]);if(b&&b.length){b=b.map(function(a){return a.clone()});b.sort(function(a,b){return b.scale-a.scale});b.forEach(function(a,b){return a.level=b});for(var n,r=0,w=b;r<w.length;r++){var m=w[r];!k&&0<f&&f>=m.scale&&
(g=m.level,k=!0);!l&&0<a&&a>=m.scale&&(h=n?n.level:-1,l=!0);n=m}-1===e&&(e=0===f?0:g);-1===d&&(d=0===a?b.length-1:h);e=Math.max(e,0);e=Math.min(e,b.length-1);d=Math.max(d,0);d=Math.min(d,b.length-1);e>d&&(f=[d,e],e=f[0],d=f[1]);f=b[e].scale;a=b[d].scale;b.splice(0,e);b.splice(d-e+1,b.length);b.forEach(function(a,b){c._lodByScale[a.scale]=a;c._scales[b]=a.scale});this._set("effectiveLODs",b);this._set("effectiveMinZoom",e);this._set("effectiveMaxZoom",d)}this._set("effectiveMinScale",f);this._set("effectiveMaxScale",
a)};e.prototype.constrain=function(c,a){if(a&&c.scale===a.scale)return c;var e=this.effectiveMinScale,b=this.effectiveMaxScale,d=c.targetGeometry,g=a&&a.targetGeometry,h=0!==e&&c.scale>e;if(0!==b&&c.scale<b||h)e=h?e:b,g&&(a=(e-a.scale)/(c.scale-a.scale),d.x=g.x+(d.x-g.x)*a,d.y=g.y+(d.y-g.y)*a),c.scale=e;this.snapToZoom&&this.effectiveLODs&&(c.scale=this._getClosestScale(c.scale));return c};e.prototype.fit=function(c){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(c,null);var a=this.scaleToZoom(c.scale);
c.scale=this.zoomToScale(.99<Math.abs(a-Math.floor(a))?Math.round(a):Math.floor(a));return c};e.prototype.zoomToScale=function(c){if(!this.effectiveLODs)return 0;c-=this.effectiveMinZoom;c=Math.max(0,c);var a=this._scales;if(0>=c)return a[0];if(c>=a.length)return a[a.length-1];var e=Math.round(c);return a[e]+(e-c)*(a[Math.round(c-.5)]-a[e])};e.prototype.scaleToZoom=function(c){if(!this.effectiveLODs)return-1;var a=this._scales,e,b;if(c>=a[0])return this.effectiveMinZoom;if(c<=a[a.length-1])return this.effectiveMaxZoom;
for(var d=0;d<a.length-1;d++){e=a[d];b=a[d+1];if(b===c)return a=d+this.effectiveMinZoom,a+1;if(e>c&&b<c)return a=d+this.effectiveMinZoom,a+1-(c-b)/(e-b)}};e.prototype.snapToClosestScale=function(c){if(!this.effectiveLODs)return c;c=this.scaleToZoom(c);return this.zoomToScale(Math.round(c))};e.prototype.snapToNextScale=function(c,a){void 0===a&&(a=.5);if(!this.effectiveLODs)return c*a;c=Math.round(this.scaleToZoom(c));return this.zoomToScale(c+1)};e.prototype.snapToPreviousScale=function(c,a){void 0===
a&&(a=2);if(!this.effectiveLODs)return c*a;c=Math.round(this.scaleToZoom(c));return this.zoomToScale(c-1)};e.prototype.clone=function(){return new h({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})};e.prototype._getClosestScale=function(c){if(this._lodByScale[c])return this._lodByScale[c].scale;c=this._scales.reduce(function(a,e){return Math.abs(e-c)<=Math.abs(a-c)?e:a},this._scales[0]);return this._lodByScale[c].scale};var h;d([g.property({readOnly:!0})],
e.prototype,"effectiveLODs",void 0);d([g.property({readOnly:!0})],e.prototype,"effectiveMinZoom",void 0);d([g.property({readOnly:!0})],e.prototype,"effectiveMaxZoom",void 0);d([g.property({readOnly:!0})],e.prototype,"effectiveMinScale",void 0);d([g.property({readOnly:!0})],e.prototype,"effectiveMaxScale",void 0);d([g.property({type:[l]})],e.prototype,"lods",void 0);d([g.property()],e.prototype,"minZoom",void 0);d([g.property()],e.prototype,"maxZoom",void 0);d([g.property()],e.prototype,"minScale",
void 0);d([g.property()],e.prototype,"maxScale",void 0);d([g.property()],e.prototype,"snapToZoom",void 0);return e=h=d([g.subclass("esri.views.2d.constraints.ZoomConstraint")],e)}(g.declared(n))})},"esri/views/2d/PaddedViewState":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f64 ./viewpointUtils ./ViewState".split(" "),
function(u,m,p,d,n,g,l,k,e,h){var c=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.left=0;b.top=0;b.right=0;b.bottom=0;return b}p(c,a);d([g.property()],c.prototype,"left",void 0);d([g.property()],c.prototype,"top",void 0);d([g.property()],c.prototype,"right",void 0);d([g.property()],c.prototype,"bottom",void 0);return c=d([g.subclass("esri.views.2d.PaddedViewState.Padding")],c)}(g.declared(n));return function(a){function f(){for(var b=[],e=0;e<arguments.length;e++)b[e]=arguments[e];
var f=a.apply(this,b)||this;f.paddedViewState=new h;f._updateContent=function(){var a=k.vec2f64.create();return function(){var b=f._get("size"),c=f._get("padding");if(b&&c){var e=f.paddedViewState;l.vec2.set(a,c.left+c.right,c.top+c.bottom);l.vec2.subtract(a,b,a);l.vec2.copy(e.size,a);if(b=e.viewpoint)f.viewpoint=b}}}();f.watch(["size","padding"],f._updateContent,!0);f.padding=new c;f.size=[0,0];return f}p(f,a);Object.defineProperty(f.prototype,"padding",{set:function(a){this._set("padding",a||new c)},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"viewpoint",{set:function(a){if(a){var b=a.clone();this.paddedViewState.viewpoint=a;e.addPadding(b,a,this._get("size"),this._get("padding"));a=this._viewpoint2D;var c=b.targetGeometry;a.center[0]=c.x;a.center[1]=c.y;a.rotation=b.rotation;a.scale=b.scale;a.spatialReference=c.spatialReference;this._update()}},enumerable:!0,configurable:!0});d([g.property()],f.prototype,"paddedViewState",void 0);d([g.property({type:c})],f.prototype,"padding",
null);d([g.property()],f.prototype,"viewpoint",null);return f=d([g.subclass("esri.views.2d.PaddedViewState")],f)}(g.declared(h))})},"esri/views/2d/tiling":function(){define("require exports ./tiling/TileInfoView ./tiling/TileKey ./tiling/TileQueue ./tiling/TileStrategy".split(" "),function(u,m,p,d,n,g){Object.defineProperty(m,"__esModule",{value:!0});m.TileInfoView=p;m.TileKey=d;m.TileQueue=n;m.TileStrategy=g})},"esri/views/2d/tiling/TileInfoView":function(){define("require exports ../../../geometry/support/spatialReferenceUtils ./LODInfo ./TileCoverage ./TileKey ./TileSpan".split(" "),
function(u,m,p,d,n,g,l){var k=new g("0/0/0/0"),e=function(){function c(a,c,b,e,d,g,h,k){this.x=a;this.ymin=c;this.ymax=b;this.invM=e;this.leftAdjust=d;this.rightAdjust=g;this.leftBound=h;this.rightBound=k}c.create=function(a,e){var b;a[1]>e[1]&&(b=[e,a],a=b[0],e=b[1]);b=a[0];a=a[1];var f=e[0];e=e[1];var d=f-b,g=e-a,g=0!==g?d/g:0,h=(Math.ceil(a)-a)*g,k=(Math.floor(a)-a)*g;return new c(b,Math.floor(a),Math.ceil(e),g,0>d?h:k,0>d?k:h,0>d?f:b,0>d?b:f)};c.prototype.incrRow=function(){this.x+=this.invM};
c.prototype.getLeftCol=function(){return Math.max(this.x+this.leftAdjust,this.leftBound)};c.prototype.getRightCol=function(){return Math.min(this.x+this.rightAdjust,this.rightBound)};return c}(),h=[[0,0],[0,0],[0,0],[0,0]];return function(){function c(a,c){var b=this;this.tileInfo=a;this.fullExtent=c;this.scales=[];this._lodInfos=null;this._infoByScale={};this._infoByLevel={};var e=a.lods.slice();e.sort(function(a,b){return b.scale-a.scale});var f=this._lodInfos=e.map(function(b){return d.create(a,
b,c)});e.forEach(function(a,c){b._infoByLevel[a.level]=f[c];b._infoByScale[a.scale]=f[c];b.scales[c]=a.scale},this);this._wrap=a.isWrappable}Object.defineProperty(c.prototype,"spatialReference",{get:function(){return this.tileInfo.spatialReference},enumerable:!0,configurable:!0});c.prototype.getLODInfoAt=function(a){return this._infoByLevel["number"===typeof a?a:a.level]};c.prototype.getTileBounds=function(a,c,b){void 0===b&&(b=!1);k.set(c);return(c=this._infoByLevel[k.level])?c.getTileBounds(a,k,
b):a};c.prototype.getTileCoords=function(a,c,b){void 0===b&&(b=!1);k.set(c);return(c=this._infoByLevel[k.level])?c.getTileCoords(a,k,b):a};c.prototype.getTileCoverage=function(a,c,b){void 0===c&&(c=192);void 0===b&&(b="closest");b="closest"===b?this.getClosestInfoForScale(a.scale):this.getSmallestInfoForScale(a.scale);var f=n.pool.acquire(b),d=this._wrap,g;g=Infinity;var k=-Infinity,m,p,t=f.spans;h[0][0]=h[0][1]=h[1][1]=h[3][0]=-c;h[1][0]=h[2][0]=a.size[0]+c;h[2][1]=h[3][1]=a.size[1]+c;for(c=0;c<
h.length;c++){var r=h[c];a.toMap(r,r);r[0]=b.getColumnForX(r[0]);r[1]=b.getRowForY(r[1])}a=[];r=3;for(c=0;4>c;c++){if(h[c][1]!==h[r][1]){var w=e.create(h[c],h[r]);g=Math.min(w.ymin,g);k=Math.max(w.ymax,k);void 0===a[w.ymin]&&(a[w.ymin]=[]);a[w.ymin].push(w)}r=c}if(null==g||null==k||100<k-g)return null;for(r=[];g<k;){null!=a[g]&&(r=r.concat(a[g]));m=Infinity;p=-Infinity;for(c=r.length-1;0<=c;c--)w=r[c],m=Math.min(m,w.getLeftCol()),p=Math.max(p,w.getRightCol());m=Math.floor(m);p=Math.floor(p);if(g>=
b.first[1]&&g<=b.last[1])if(d)if(b.size[0]<b.worldSize[0])for(w=Math.floor(p/b.worldSize[0]),c=Math.floor(m/b.worldSize[0]);c<=w;c++)t.push(new l(g,Math.max(b.getFirstColumnForWorld(c),m),Math.min(b.getLastColumnForWorld(c),p)));else t.push(new l(g,m,p));else m>b.last[0]||p<b.first[0]||(m=Math.max(m,b.first[0]),p=Math.min(p,b.last[0]),t.push(new l(g,m,p)));g+=1;for(c=r.length-1;0<=c;c--)w=r[c],w.ymax>=g?w.incrRow():r.splice(c,1)}return f};c.prototype.getTileParentId=function(a){k.set(a);a=this._lodInfos.indexOf(this._infoByLevel[k.level])-
1;if(0>a)return null;this._getTileIdAtLOD(k,this._lodInfos[a],k);return k.id};c.prototype.getTileResolution=function(a){return(a=this._infoByLevel["object"===typeof a?a.level:a])?a.resolution:-1};c.prototype.getTileScale=function(a){return(a=this._infoByLevel[a.level])?a.scale:-1};c.prototype.intersects=function(a,c){k.set(c);c=this._infoByLevel[k.level];var b=a.lodInfo;if(b.resolution>c.resolution){this._getTileIdAtLOD(k,b,k);for(var e=b.denormalizeCol(k.col,k.world),f=0,d=a.spans;f<d.length;f++){var g=
d[f];if(g.row===k.row&&g.colFrom<=e&&g.colTo>=e)return!0}}if(b.resolution<c.resolution){d=a.spans.reduce(function(a,b){a[0]=Math.min(a[0],b.row);a[1]=Math.max(a[1],b.row);a[2]=Math.min(a[2],b.colFrom);a[3]=Math.max(a[3],b.colTo);return a},[Infinity,-Infinity,Infinity,-Infinity]);a=d[0];var e=d[1],f=d[2],d=d[3],h=c.denormalizeCol(k.col,k.world),g=b.getColumnForX(c.getXForColumn(h)),l=b.getRowForY(c.getYForRow(k.row)),h=b.getColumnForX(c.getXForColumn(h+1))-1;c=b.getRowForY(c.getYForRow(k.row+1))-1;
return!(g>d||h<f||l>e||c<a)}var n=b.denormalizeCol(k.col,k.world);return a.spans.some(function(a){return a.row===k.row&&a.colFrom<=n&&a.colTo>=n})};c.prototype.normalizeBounds=function(a,c,b){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];this._wrap&&(c=p.getInfo(this.tileInfo.spatialReference),b=-b*(c.valid[1]-c.valid[0]),a[0]+=b,a[2]+=b);return a};c.prototype.getSmallestInfoForScale=function(a){var c=this.scales;if(this._infoByScale[a])return this._infoByScale[a];if(a>c[0])return this._infoByScale[c[0]];
for(var b=1;b<c.length-1;b++)if(a>c[b]+1E-6)return this._infoByScale[c[b-1]];return this._infoByScale[c[c.length-1]]};c.prototype.getClosestInfoForScale=function(a){var c=this.scales;if(this._infoByScale[a])return this._infoByScale[a];a=c.reduce(function(b,c){return Math.abs(c-a)<Math.abs(b-a)?c:b},c[0]);return this._infoByScale[a]};c.prototype.scaleToLevel=function(a){var c=this.scales;if(this._infoByScale[a])return this._infoByScale[a].level;for(var b=c.length-1;0<=b;b--)if(a<c[b])return b===c.length-
1?this._infoByScale[c[c.length-1]].level:this._infoByScale[c[b]].level+(c[b]-a)/(c[b]-c[b+1]);return this._infoByScale[c[0]].level};c.prototype.scaleToZoom=function(a){return this.tileInfo.scaleToZoom(a)};c.prototype._getTileIdAtLOD=function(a,c,b){var e=this._infoByLevel[b.level];a.set(b);if(c.resolution<e.resolution)return null;if(c.resolution===e.resolution)return a;a.level=c.level;a.col=Math.floor(b.col*e.resolution/c.resolution+.01);a.row=Math.floor(b.row*e.resolution/c.resolution+.01);return a};
return c}()})},"esri/views/2d/tiling/LODInfo":function(){define(["require","exports","../../../geometry/support/spatialReferenceUtils","./TileKey"],function(u,m,p,d){function n(d,g,e){d[0]=g;d[1]=e;return d}var g=new d("0/0/0/0");return function(){function d(d,e,g,c,a,f,b,l,n,m,q,p){this.level=d;this.resolution=e;this.scale=g;this.origin=c;this.first=a;this.last=f;this.size=b;this.norm=l;this.worldStart=n;this.worldEnd=m;this.worldSize=q;this.wrap=p}d.create=function(g,e,h){var c=p.getInfo(g.spatialReference),
a=[g.origin.x,g.origin.y],f=[g.size[0]*e.resolution,g.size[1]*e.resolution],b=[-Infinity,-Infinity],k=[Infinity,Infinity],l=[Infinity,Infinity];h&&(n(b,Math.max(0,Math.floor((h.xmin-a[0])/f[0])),Math.max(0,Math.floor((a[1]-h.ymax)/f[1]))),n(k,Math.max(0,Math.floor((h.xmax-a[0])/f[0])),Math.max(0,Math.floor((a[1]-h.ymin)/f[1]))),n(l,k[0]-b[0]+1,k[1]-b[1]+1));var m;g.isWrappable?(g=[Math.ceil(Math.round(2*c.origin[1]/e.resolution)/g.size[0]),l[1]],c=[Math.floor((c.origin[0]-a[0])/f[0]),b[1]],h=[g[0]+
c[0]-1,k[1]],m=!0):(c=b,h=k,g=l,m=!1);return new d(e.level,e.resolution,e.scale,a,b,k,l,f,c,h,g,m)};d.prototype.normalizeCol=function(d){if(!this.wrap)return d;var e=this.worldSize[0];return 0>d?e-1-Math.abs((d+1)%e):d%e};d.prototype.denormalizeCol=function(d,e){return this.wrap?this.worldSize[0]*e+d:d};d.prototype.getWorldForColumn=function(d){return this.wrap?Math.floor(d/this.worldSize[0]):0};d.prototype.getFirstColumnForWorld=function(d){return d*this.worldSize[0]+this.first[0]};d.prototype.getLastColumnForWorld=
function(d){return d*this.worldSize[0]+this.first[0]+this.size[0]-1};d.prototype.getColumnForX=function(d){return(d-this.origin[0])/this.norm[0]};d.prototype.getXForColumn=function(d){return this.origin[0]+d*this.norm[0]};d.prototype.getRowForY=function(d){return(this.origin[1]-d)/this.norm[1]};d.prototype.getYForRow=function(d){return this.origin[1]-d*this.norm[1]};d.prototype.getTileBounds=function(d,e,h){void 0===h&&(h=!1);g.set(e);var c=h?g.col:this.denormalizeCol(g.col,g.world),a=g.row;e=this.getXForColumn(c);
h=this.getYForRow(a+1);c=this.getXForColumn(c+1);a=this.getYForRow(a);d[0]=e;d[1]=h;d[2]=c;d[3]=a;return d};d.prototype.getTileCoords=function(d,e,h){void 0===h&&(h=!1);g.set(e);e=h?g.col:this.denormalizeCol(g.col,g.world);Array.isArray(d)?n(d,this.getXForColumn(e),this.getYForRow(g.row)):(d.x=this.getXForColumn(e),d.y=this.getYForRow(g.row));return d};return d}()})},"esri/views/2d/tiling/TileCoverage":function(){define(["require","exports","../../../core/ObjectPool"],function(u,m,p){return function(){function d(d){this.lodInfo=
d;this.spans=[]}d.prototype.release=function(){};d.prototype.forEach=function(d,g){var l=this.spans,k=this.lodInfo,e=k.level;if(0!==l.length)for(var h=0;h<l.length;h++)for(var c=l[h],a=c.row,f=c.colTo,c=c.colFrom;c<=f;c++)d.call(g,e,a,k.normalizeCol(c),k.getWorldForColumn(c))};d.pool=new p(d,!0);return d}()})},"esri/views/2d/tiling/TileSpan":function(){define(["require","exports","../../../core/ObjectPool"],function(u,m,p){return function(){function d(d,g,l){this.row=d;this.colFrom=g;this.colTo=l}
d.pool=new p(d,!0);return d}()})},"esri/views/2d/tiling/TileQueue":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/SetUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec2 ../../support/QueueProcessor".split(" "),function(u,m,p,d,n,g,l,k,e){function h(a,b){a.length=0;b.forEach(function(b){return a.push(b)});return a}var c=new Set,a=[],f=new Map,b=[0,0];return function(n){function m(a){a=
n.call(this,a)||this;a._keyToItem=new Map;a.concurrency=6;a.strategy="scale-first";a.tileInfoView=null;return a}d(m,n);m.prototype.initialize=function(){var a=this,b=this.process;this._queue=new e.QueueProcessor({concurrency:this.concurrency,process:function(c,e){c=a._keyToItem.get(c);return b(c,{signal:e})},peeker:"scale-first"===this.strategy?function(b){return a._peekByScaleFirst(b)}:function(b){return a._peekByCenterFirst(b)}})};m.prototype.destroy=function(){this.clear();this._queue.destroy();
this._queue=null};Object.defineProperty(m.prototype,"length",{get:function(){return this._queue?this._queue.length:0},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"onGoingCount",{get:function(){return this._keyToItem.size},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"updating",{get:function(){return 0<this.length||0<this.onGoingCount},enumerable:!0,configurable:!0});m.prototype.abort=function(a){this._queue.abort("string"===typeof a?a:a.id)};m.prototype.clear=
function(){this._queue.clear();this._keyToItem.clear();this.notifyChange("updating")};m.prototype.has=function(a){return"string"===typeof a?this._keyToItem.has(a):this._keyToItem.has(a.id)};m.prototype.isOngoing=function(a){a="string"===typeof a?a:a.id;return this.has(a)&&this._queue.isOngoing(a)};m.prototype.pause=function(){this._queue.pause()};m.prototype.push=function(a){var b=this,c=a.key.id;if(this.has(c))return this.get(c);var e=this._queue.push(c),d=function(){b._keyToItem.delete(c);b.notifyChange("updating")};
this._keyToItem.set(c,a);e.then(d,d);this.notifyChange("updating");return e};m.prototype.reset=function(){this._queue.reset();this.notifyChange("updating")};m.prototype.resume=function(){this._queue.resume()};m.prototype._peekByScaleFirst=function(b){var e=this;if(!this.state)return g.firstOfSet(b);var d=this.tileInfoView,k=Number.NEGATIVE_INFINITY,l=Number.POSITIVE_INFINITY;b.forEach(function(a){a=e._keyToItem.get(a);var b=e.tileInfoView.getTileScale(a.key);f.has(b)||(f.set(b,[]),k=Math.max(b,k),
l=Math.min(b,l));f.get(b).push(a.key);c.add(b)});var n=this.state.scale;f.has(n)||(h(a,c),a.sort(),n=a.reduce(function(a,b){return Math.abs(b-n)<Math.abs(a-n)?b:a},a[0]));n=Math.min(n,k);n=Math.max(n,l);b=f.get(n);var m=d.getClosestInfoForScale(n),p=m.getColumnForX(this.state.center[0]),x=m.getRowForY(this.state.center[1]);b.sort(function(a,b){var c=m.denormalizeCol(a.col,a.world),e=m.denormalizeCol(b.col,b.world);return Math.sqrt((p-c)*(p-c)+(x-a.row)*(x-a.row))-Math.sqrt((p-e)*(p-e)+(x-b.row)*(x-
b.row))});c.clear();f.clear();return b[0].id};m.prototype._peekByCenterFirst=function(a){var c=this;if(!this.state)return g.firstOfSet(a);var e=this.tileInfoView,d=this.state.center,f=Number.POSITIVE_INFINITY,h=null;a.forEach(function(a){a=c._keyToItem.get(a);e.getTileCoords(b,a.key);var g=k.vec2.distance(b,d);g<f&&(f=g,h=a.key)});return h.id};p([l.property({constructOnly:!0})],m.prototype,"concurrency",void 0);p([l.property({constructOnly:!0})],m.prototype,"process",void 0);p([l.property()],m.prototype,
"state",void 0);p([l.property({constructOnly:!0})],m.prototype,"strategy",void 0);p([l.property({constructOnly:!0})],m.prototype,"tileInfoView",void 0);p([l.property({readOnly:!0})],m.prototype,"updating",null);return m=p([l.subclass("esri.views.2d.tiling.TileQueue")],m)}(l.declared(n))})},"esri/views/support/QueueProcessor":function(){define("require exports ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/scheduling".split(" "),function(u,m,p,d,n,g){Object.defineProperty(m,"__esModule",
{value:!0});var l=function(){return function(d,e){this.item=d;this.controller=e;this.promise=null}}();u=function(){function k(e){var d=this;this._deferreds=new Map;this._controllers=new Map;this._processingItems=new Map;this._isPaused=!1;this._task=this._schedule=null;this.concurrency=1;e.concurrency&&(this.concurrency=e.concurrency);this._queue=new n.default(e.peeker);this.process=e.process;var c=e.scheduler;e.task&&p.isSome(c)&&(this._task=c.registerTask(e.task,function(a){return d.update(a)},function(){return d.needsUpdate()}))}
k.prototype.destroy=function(){this.clear();this._schedule&&(this._schedule.remove(),this._schedule=null);this._task&&(this._task.remove(),this._task=null)};Object.defineProperty(k.prototype,"length",{get:function(){return this._processingItems.size+this._queue.length},enumerable:!0,configurable:!0});k.prototype.abort=function(e){(e=this._controllers.get(e))&&e.abort()};k.prototype.clear=function(){this._queue.clear();var e=[];this._controllers.forEach(function(d){return e.push(d)});this._controllers.clear();
e.forEach(function(e){return e.abort()});this._processingItems.clear();this._cancelNext()};k.prototype.get=function(e){return(e=this._deferreds.get(e))?e.promise:void 0};k.prototype.isOngoing=function(e){return this._processingItems.has(e)};k.prototype.has=function(e){return this._deferreds.has(e)};k.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())};k.prototype.push=function(e){var g=this,c=this.get(e);if(c)return c;var a,c=d.createAbortController(),f=function(){b.remove();
g._deferreds.delete(e);g._controllers.delete(e);g._queue.remove(e);g._processingItems.delete(e);g._scheduleNext()},b=d.onAbortOrThrow(c.signal,function(){var b=g._processingItems.get(e);b&&b.controller.abort();f();a.reject(d.createAbortError())});a=d.createDeferred();this._deferreds.set(e,a);this._controllers.set(e,c);a.promise.then(f,f);this._queue.push(e);this._scheduleNext();return a.promise};k.prototype.reset=function(){var e=[];this._processingItems.forEach(function(a){return e.push(a)});this._processingItems.clear();
for(var d=0;d<e.length;d++){var c=e[d];this._queue.push(c.item);c.controller.abort()}this._scheduleNext()};k.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())};k.prototype.needsUpdate=function(){return!this._isPaused&&0<this._queue.length&&this._processingItems.size<this.concurrency};k.prototype.update=function(e){for(;!e.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()};k.prototype._scheduleNext=
function(){var e=this;this._task||this._isPaused||this._schedule||(this._schedule=g.schedule(function(){e._schedule=null;e._next()}))};k.prototype._next=function(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())};k.prototype._cancelNext=function(){this._schedule&&(this._schedule.remove(),this._schedule=null)};k.prototype._processResult=function(e,d){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(d))};
k.prototype._processError=function(e,d){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(d))};k.prototype._canProcessFulfillment=function(e){return this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e?!0:!1};k.prototype._process=function(e){var g=this;if(!p.isNone(e)){var c,a=d.createAbortController(),f=new l(e,a);this._processingItems.set(e,f);try{c=this.process(e,a.signal)}catch(b){this._processError(f,b)}c&&"function"===typeof c.then?(f.promise=
c,c.then(function(a){return g._processResult(f,a)},function(a){return g._processError(f,a)})):this._processResult(f,c)}};Object.defineProperty(k.prototype,"test",{get:function(){var e=this;return{update:function(d){return e.update(d)}}},enumerable:!0,configurable:!0});return k}();m.QueueProcessor=u})},"esri/core/Queue":function(){define(["require","exports","./SetUtils"],function(u,m,p){Object.defineProperty(m,"__esModule",{value:!0});u=function(){function d(d){void 0===d&&(d=function(d){return p.firstOfSet(d)});
this._peeker=d;this._items=new Set}Object.defineProperty(d.prototype,"length",{get:function(){return this._items.size},enumerable:!0,configurable:!0});d.prototype.clear=function(){this._items.clear()};d.prototype.peek=function(){if(0!==this._items.size)return this._peeker(this._items)};d.prototype.push=function(d){this.contains(d)||this._items.add(d)};d.prototype.contains=function(d){return this._items.has(d)};d.prototype.pop=function(){if(0!==this.length){var d=this.peek();this._items.delete(d);
return d}};d.prototype.remove=function(d){this._items.delete(d)};return d}();m.default=u})},"esri/views/2d/tiling/TileStrategy":function(){define("require exports ../../../core/tsSupport/extendsHelper ./TileCache ./TileCoverage ./TileKey".split(" "),function(u,m,p,d,n,g){var l=new g(0,0,0,0),k=new Map,e=[],h=[];return function(){function c(a){var c=this;this._previousScale=Number.POSITIVE_INFINITY;this.cachePolicy="keep";this.coveragePolicy="closest";this.resampling=!0;this.tileIndex=new Map;this.tiles=
[];this.buffer=192;this.acquireTile=a.acquireTile;this.releaseTile=a.releaseTile;this.tileInfoView=a.tileInfoView;this.resampling=null==a.resampling||!!a.resampling;a.cachePolicy&&(this.cachePolicy=a.cachePolicy);a.coveragePolicy&&(this.coveragePolicy=a.coveragePolicy);null!=a.buffer&&(this.buffer=a.buffer);a.cacheSize&&(this._tileCache=new d.default(a.cacheSize,this.tileInfoView,function(a){c.releaseTile(a)}))}c.prototype.destroy=function(){this.tileIndex.clear()};c.prototype.update=function(a){var c=
this,b=this.resampling,d=this.tileIndex,g=this.tileInfoView.getTileCoverage(a.state,this.buffer,this.coveragePolicy);h.length=0;e.length=0;k.clear();if(g){var m=this.tileInfoView.tileInfo,q=m.minScale,p=m.maxScale,u=g.spans,t=g.lodInfo,r=t.level,w=a.state,F=w.scale,m=w.center,w=w.resolution,E=!a.stationary&&F>this._previousScale;this._previousScale=F;this.tiles.length=0;if(!b&&(F>q||F<p))return this.tiles.length=0,k.clear(),d.forEach(function(a){c.releaseTile(a)}),d.clear(),h.length=0,e.length=0,
k.clear(),n.pool.release(g),!0;d.forEach(function(a){return a.visible=!0});p=q=0;if(0<u.length)for(F=0;F<u.length;F++){a=u[F];for(var D=a.row,H=a.colTo,G=a.colFrom;G<=H;G++)if(q++,a=l.set(r,D,t.normalizeCol(G),t.getWorldForColumn(G)).id,d.has(a))b=d.get(a),b.isReady?(k.set(a,b),p++):E||this._addParentTile(a,k);else{b=void 0;if(this._tileCache&&this._tileCache.has(a)){if(b=this._tileCache.pop(a),this.tileIndex.set(a,b),b.isReady){k.set(a,b);p++;continue}}else b=this.acquireTile(l),this.tileIndex.set(a,
b);E||this._addParentTile(a,k)}}var K=p===q;d.forEach(function(a,b){l.set(b);if(!k.has(b)){var d=c.tileInfoView.intersects(g,l);!d||!E&&K?"purge"===c.cachePolicy?l.level===r&&d||e.push(b):(l.level>r||!d)&&e.push(b):a.isReady?h.push(b):l.level>r&&e.push(b)}});for(u=0;u<h.length;u++)a=h[u],(b=d.get(a))&&b.isReady&&k.set(a,b);for(u=0;u<e.length;u++)a=e[u],b=d.get(a),this._tileCache?this._tileCache.add(b):this.releaseTile(b),d["delete"](a);k.forEach(function(a){return c.tiles.push(a)});d.forEach(function(a){k.has(a.key.id)||
(a.visible=!1)});this._tileCache&&this._tileCache.prune(r,m,w);n.pool.release(g);return K}};c.prototype.clear=function(a){var c=this;void 0===a&&(a=!0);var b=this.tileIndex;a&&b.forEach(function(a){c.releaseTile(a)});b.clear()};c.prototype._addParentTile=function(a,c){for(var b=null;;){a=this.tileInfoView.getTileParentId(a);if(!a)break;if(this.tileIndex.has(a)){if((b=this.tileIndex.get(a))&&b.isReady){c.has(b.key.id)||c.set(b.key.id,b);break}}else if(this._tileCache&&this._tileCache.has(a)&&(b=this._tileCache.pop(a),
this.tileIndex.set(a,b),b&&b.isReady)){c.has(b.key.id)||c.set(b.key.id,b);break}}};return c}()})},"esri/views/2d/tiling/TileCache":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2"],function(u,m,p){Object.defineProperty(m,"__esModule",{value:!0});u=function(){function d(d,g,l){this.maxSize=d;this.tileInfoView=g;this.removedFunc=l;this._tilePerId=new Map;this._tileKeysPerLevel=[]}d.prototype.has=function(d){return this._tilePerId.has(d)};d.prototype.get=function(d){return this._tilePerId.get(d)};
d.prototype.pop=function(d){var g=this._tilePerId.get(d);if(!g)return null;var l=this._tileKeysPerLevel[g.key.level];this._tilePerId["delete"](d);for(var k=0;k<l.length;k++)if(l[k].id===d){l.splice(k,1);break}g.visible=!0;return g};d.prototype.add=function(d){d.visible=!1;var g=d.key,l=g.id;this._tilePerId.has(l)||(this._tilePerId.set(l,d),d=g.level,this._tileKeysPerLevel[d]||(this._tileKeysPerLevel[d]=[]),this._tileKeysPerLevel[d].push(g))};d.prototype.prune=function(d,g,l){var k=this._tilePerId.size;
if(!(k<=this.maxSize)){for(var e=this._tileKeysPerLevel.length-1;k>this.maxSize&&0<=e;)e!==d&&(k=this._pruneAroundCenterTile(k,g,l,e)),e--;k>this.maxSize&&(k=this._pruneAroundCenterTile(k,g,l,d))}};d.prototype._pruneAroundCenterTile=function(d,g,l,k){k=this._tileKeysPerLevel[k];if(!k||0===k.length)return d;var e=this.tileInfoView.tileInfo,h=e.size,c=e.origin,a=l*h[0],f=l*h[1],b=[0,0],n=[0,0];for(k.sort(function(e,d){b[0]=c.x+a*(e.col+.5);b[1]=c.y-f*(e.row+.5);n[0]=c.x+a*(d.col+.5);n[1]=c.y-f*(d.row+
.5);return p.vec2.squaredDistance(b,g)-p.vec2.squaredDistance(n,g)});0<k.length&&(l=k.pop(),this._removeTile(l.id),d--,d!==this.maxSize););return d};d.prototype._removeTile=function(d){var g=this._tilePerId.get(d);this.removedFunc&&this.removedFunc(g);this._tilePerId["delete"](d)};return d}();m.default=u})},"esri/views/2d/support/Timeline":function(){define(["require","exports","../../../core/tsSupport/decorateHelper","../../../core/tsSupport/declareExtendsHelper","../../../core/accessorSupport/decorators"],
function(u,m,p,d,n){Object.defineProperty(m,"__esModule",{value:!0});u=function(){function d(){this._names=new Map}d.prototype.begin=function(d){this._names.has(d)||(this._names.set(d,!1),-1!==d.indexOf("Brush")&&this.record("Esri.FirstDraw"),performance.mark("Esri."+d+".Start"))};d.prototype.end=function(d){this._names.has(d)&&!this._names.get(d)&&(this._names.set(d,!0),performance.mark("Esri."+d+".End"))};d.prototype.record=function(d){this._names.has(d)||(this._names.set(d,!0),performance.mark("Esri."+
d))};return d=p([n.subclass("esri.views.2d.support.Timeline")],d)}();m.Timeline=u})},"esri/views/2d/input/MapViewInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DoubleTapDragZoom ./handlers/DragPan ./handlers/DragRotate ./handlers/GamepadNavigation ./handlers/KeyPan ./handlers/KeyRotate ./handlers/KeyZoom ./handlers/MouseWheelZoom ./handlers/PinchAction ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/DoubleTapDrag ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick".split(" "),
function(u,m,p,d,n,g,l,k,e,h,c,a,f,b,x,v,y,q,B,C,t,r,w,F,E,D){var H={left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},G={zoomIn:["\x3d","+"],zoomOut:["-","_"]},K={clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"};return function(n){function m(){var a=null!==n&&n.apply(this,arguments)||this;a._handles=new g;return a}p(m,n);m.prototype.initialize=function(){var a=this;this._handles.add([l.whenNot(this.view,
"ready",function(){return a._disconnect()}),l.when(this.view,"ready",function(){return a._connect()})])};m.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this._disconnect()};m.prototype._disconnect=function(){this._inputManager&&(this.view.viewEvents.disconnect(),this._inputManager.destroy(),this._inputManager=null,this._source.destroy(),this._source=null)};m.prototype._connect=function(){var d=this,g=new B.BrowserEventSource(this.view.surface,this.view.input),
k=[new F.ImmediateDoubleClick,new E.PointerClickHoldAndDrag,new D.SingleAndDoubleClick,new w.Drag(this.view.navigation),new r.DoubleTapDrag],k=new C.InputManager({eventSource:g,recognizers:k});k.installHandlers("prevent-context-menu",[new t.PreventContextMenu],C.ViewEventPriorities.INTERNAL);k.installHandlers("navigation",[new q.PinchRotateAndZoom(this.view),new f.GamepadNavigation(this.view),new y.MouseWheelZoom(this.view),new e.DoubleClickZoom(this.view),new e.DoubleClickZoom(this.view,["Ctrl"]),
new c.DragPan(this.view,"primary"),new b.KeyPan(this.view,H),new v.KeyZoom(this.view,G),new x.KeyRotate(this.view,K),new a.DragRotate(this.view,"secondary"),new h.DoubleTapDragZoom(this.view,"touch")],C.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(k);this._source=g;this._inputManager=k;l.init(this.view.navigation,"browserTouchPanEnabled",function(a){d._source.browserTouchPanningEnabled=!a})};Object.defineProperty(m.prototype,"test",{get:function(){return{inputManager:this._inputManager}},
enumerable:!0,configurable:!0});d([k.property()],m.prototype,"view",void 0);return m=d([k.subclass("esri.views.2d.input.MapViewInputManager")],m)}(k.declared(n))})},"esri/views/2d/input/handlers/DoubleClickZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler","../../../input/handlers/support"],function(u,m,p,d,n){Object.defineProperty(m,"__esModule",{value:!0});u=function(d){function g(g,e){var h=d.call(this,!0)||this;h.view=g;h.registerIncoming("double-click",
e,function(c){return h._handleDoubleClick(c,e)});return h}p(g,d);g.prototype._handleDoubleClick=function(d,e){n.eventMatchesPointerAction(d.data,"primary")&&(d.stopPropagation(),e?this.view.mapViewNavigation.zoomOut([d.data.x,d.data.y]):this.view.mapViewNavigation.zoomIn([d.data.x,d.data.y]))};return g}(d.InputHandler);m.DoubleClickZoom=u})},"esri/views/2d/input/handlers/DoubleTapDragZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../../core/compilerUtils",
"../../../input/InputHandler"],function(u,m,p,d,n){Object.defineProperty(m,"__esModule",{value:!0});u=function(g){function l(d,e,h){var c=g.call(this,!0)||this;c.view=d;c.pointerType=e;c.registerIncoming("double-tap-drag",h,function(a){return c._handleDoubleTapDrag(a)});return c}p(l,g);l.prototype._handleDoubleTapDrag=function(g){var e=g.data;if(e.pointerType===this.pointerType){g.stopPropagation();var h=e.action;g=e.delta;var c=this.view,e=c.mapViewNavigation;switch(h){case "begin":this._currentScale=
this._startScale=h=c.scale;this._previousDelta=g;e.begin();break;case "update":if(this._previousDelta.y===g.y)break;this._previousDelta=g;g=this._startScale*Math.pow(1.015,g.y);e.setViewpointImmediate(g/this._currentScale);this._currentScale=g;break;case "end":h=c.constraints;c=h.effectiveLODs;if(!h.snapToZoom||!c){e.end();break}c=h.snapScale(this._currentScale);g=(0<g.y?Math.max(c,h.snapToPreviousScale(this._startScale)):Math.min(c,h.snapToNextScale(this._startScale)))/this._currentScale;e.zoom(g);
break;default:d.neverReached(h)}}};return l}(n.InputHandler);m.DoubleTapDragZoom=u})},"esri/views/2d/input/handlers/DragPan":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../input/DragEventSeparator ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(u,m,p,d,n,g){Object.defineProperty(m,"__esModule",{value:!0});u=function(l){function k(e,h,c){var a=l.call(this,!0)||this;a.view=e;a.pointerAction=h;a.registerIncoming("drag",c,function(b){return a._handleDrag(b)});
a.registerIncoming("pointer-down",function(){return a.stopMomentumNavigation()});var f=a.view.mapViewNavigation;a.dragEventSeparator=new d.DragEventSeparator({start:function(b,c){f.pan.begin(a.view,c.data);c.stopPropagation()},update:function(b,c){f.pan.update(a.view,c.data);c.stopPropagation()},end:function(b,c){f.pan.end(a.view,c.data);c.stopPropagation()},condition:function(b,c){return 1===b&&g.eventMatchesPointerAction(c.data,a.pointerAction)}});return a}p(k,l);k.prototype._handleDrag=function(d){var e=
this.view.mapViewNavigation;e.pinch.zoomMomentum||e.pinch.rotateMomentum?this.stopMomentumNavigation():this.dragEventSeparator.handle(d)};k.prototype.stopMomentumNavigation=function(){this.view.mapViewNavigation.pan.stopMomentumNavigation()};return k}(n.InputHandler);m.DragPan=u})},"esri/views/2d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../input/DragEventSeparator ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(u,m,p,d,n,g){Object.defineProperty(m,"__esModule",{value:!0});u=function(l){function k(e,h,c){var a=l.call(this,!0)||this;a.view=e;a.pointerAction=h;var f=a.view.mapViewNavigation;a.dragEventSeparator=new d.DragEventSeparator({start:function(b,c){f.rotate.begin(a.view,c.data);c.stopPropagation()},update:function(b,c){f.rotate.update(a.view,c.data);c.stopPropagation()},end:function(a,c){f.rotate.end();c.stopPropagation()},condition:function(b,c){return 1===b&&g.eventMatchesPointerAction(c.data,
a.pointerAction)}});a.registerIncoming("drag",c,function(b){return a.dragEventSeparator.handle(b)});return a}p(k,l);return k}(n.InputHandler);m.DragRotate=u})},"esri/views/2d/input/handlers/GamepadNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/scheduling ../../../../core/watchUtils ../../viewpointUtils ../../../input/InputHandler ../../../navigation/gamepadAndKeyboardUtils".split(" "),function(u,m,p,d,n,g,l,k,e){Object.defineProperty(m,
"__esModule",{value:!0});u=function(f){function b(a){var b=f.call(this,!0)||this;b.view=a;b.frameTask=null;b.watchHandles=new d;b.currentDevice=null;b.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};b.handle=b.registerIncoming("gamepad",function(a){return b.handleEvent(a)});b.handle.pause();return b}p(b,f);b.prototype.onInstall=function(a){var b=this;f.prototype.onInstall.call(this,a);this.watchHandles.add([g.init(this.view.navigation.gamepad,"enabled",function(a){a?(b.handle.resume(),
b.frameTask||(b.frameTask=n.addFrameTask({update:function(a){return b.frameUpdate(a.deltaTime)}}))):(b.handle.pause(),b.frameTask&&(b.frameTask.remove(),b.frameTask=null))})])};b.prototype.onUninstall=function(){this.watchHandles.removeAll();this.frameTask&&(this.frameTask.remove(),this.frameTask=null);f.prototype.onUninstall.call(this)};b.prototype.handleEvent=function(a){var b=this.view.navigation.gamepad.device;b&&a.data.device!==b||this.currentDevice&&this.currentDevice!==a.data.device||("end"===
a.data.action?(this.currentDevice=null,e.resetTransformation(this.transformation)):(this.currentDevice=a.data.device,e.extractTransformation(a.data,this.view.navigation.gamepad,this.transformation)))};b.prototype.frameUpdate=function(b){var d=this.transformation;if(!e.isZeroTransformation(d)){var f=this.view.viewpoint.clone(),g=c*this.view.navigation.gamepad.velocityFactor*b;l.translateBy(f,f,[d.translation[0]*g,-d.translation[1]*g]);g=this.view.size;l.scaleAndRotateBy(f,f,1+d.translation[2]*a*b,
this.view.constraints.rotationEnabled?-d.heading*h*b:0,[g[0]/2,g[1]],g);b=this.view.constraints.constrain(f,this.view.viewpoint);this.view.viewpoint=b}};return b}(k.InputHandler);m.GamepadNavigation=u;var h=.06,c=.7,a=6E-4})},"esri/views/2d/input/handlers/KeyPan":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(u,m,p,d){Object.defineProperty(m,"__esModule",{value:!0});u=function(d){function g(g,k,e){var h,c=d.call(this,!0)||
this;c.view=g;c.keys=k;c._pressed=!1;c._keyMap=(h={},h[k.left]="left",h[k.right]="right",h[k.up]="up",h[k.down]="down",h);c.registerIncoming("key-down",e,function(a){return c._handleKeyDown(a)});c.registerIncoming("key-up",e,function(a){return c._handleKeyUp(a)});c.registerIncoming("blur",e,function(){return c._handleBlur()});return c}p(g,d);g.prototype._handleKeyDown=function(d){d.data.repeat||this._handleKey(d,!0)};g.prototype._handleKeyUp=function(d){this._handleKey(d,!1)};g.prototype._handleBlur=
function(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())};g.prototype._handleKey=function(d,g){var e=this._keyMap[d.data.key];if(this._pressed=null!=e){if(g)switch(this.view.mapViewNavigation.begin(),e){case "left":this.view.mapViewNavigation.continousPanLeft();break;case "right":this.view.mapViewNavigation.continousPanRight();break;case "up":this.view.mapViewNavigation.continousPanUp();break;case "down":this.view.mapViewNavigation.continousPanDown()}else this._pressed=!1,this.view.mapViewNavigation.stop();
d.stopPropagation()}};return g}(d.InputHandler);m.KeyPan=u})},"esri/views/2d/input/handlers/KeyRotate":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(u,m,p,d){Object.defineProperty(m,"__esModule",{value:!0});u=function(d){function g(g,k,e){var h,c=d.call(this,!0)||this;c.view=g;c.keys=k;c._pressed=!1;c._keyToDirection=(h={},h[k.clockwiseOption1]="clockwise",h[k.clockwiseOption2]="clockwise",h[k.counterClockwiseOption1]="counterClockwise",
h[k.counterClockwiseOption2]="counterClockwise",h[k.resetOption1]="reset",h[k.resetOption2]="reset",h);c.registerIncoming("key-down",e,function(a){return c._handleKeyDown(a)});c.registerIncoming("key-up",e,function(a){return c._handleKeyUp(a)});c.registerIncoming("blur",e,function(){return c._handleBlur()});return c}p(g,d);g.prototype._handleKeyDown=function(d){d.data.repeat||this._handleKey(d,!0)};g.prototype._handleKeyUp=function(d){this._handleKey(d,!1)};g.prototype._handleBlur=function(){this._pressed&&
(this._pressed=!1,this.view.mapViewNavigation.stop())};g.prototype._handleKey=function(d,g){var e=d.modifiers;if(!(0<e.size&&!e.has("Shift")||!this.view.constraints.rotationEnabled)&&(e=this._keyToDirection[d.data.key],this._pressed=null!=e)){if(g)switch(this.view.mapViewNavigation.begin(),e){case "clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case "counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case "reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=
!1,this.view.mapViewNavigation.stop();d.stopPropagation()}};return g}(d.InputHandler);m.KeyRotate=u})},"esri/views/2d/input/handlers/KeyZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../../core/compilerUtils","../../../input/InputHandler"],function(u,m,p,d,n){Object.defineProperty(m,"__esModule",{value:!0});u=function(g){function l(d,e,h){var c=g.call(this,!0)||this;c.view=d;c.keys=e;c._keysToZoomAction={};c.registerIncoming("key-down",h,function(a){return c._handleKeyDown(a)});
e.zoomIn.forEach(function(a){return c._keysToZoomAction[a]=0});e.zoomOut.forEach(function(a){return c._keysToZoomAction[a]=1});return c}p(l,g);l.prototype._handleKeyDown=function(d){this._handleKey(d)};l.prototype._handleKey=function(g){var e=g.modifiers;if(!(0<e.size)||e.has("Shift"))if(e=g.data.key,e in this._keysToZoomAction){var e=this._keysToZoomAction[e],h=this.view.mapViewNavigation,c=null;switch(e){case 0:c=h.zoomIn();break;case 1:c=h.zoomOut();break;default:d.neverReached(e);return}h.begin();
c.then(function(){return h.end()});g.stopPropagation()}};return l}(n.InputHandler);m.KeyZoom=u})},"esri/views/2d/input/handlers/MouseWheelZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(u,m,p,d){Object.defineProperty(m,"__esModule",{value:!0});u=function(d){function g(g,k){var e=d.call(this,!0)||this;e.view=g;e._canZoom=!0;e.registerIncoming("mouse-wheel",k,function(d){return e._handleMouseWheel(d)});return e}p(g,d);g.prototype._handleMouseWheel=
function(d){var g=this;if(this.view.navigation.mouseWheelZoomEnabled&&(d.preventDefault(),d.stopPropagation(),this._canZoom)){var e=this.view.mapViewNavigation;d=d.data;if(d=e.zoom(1/Math.pow(.6,1/60*d.deltaY),[d.x,d.y]))this._canZoom=!1,d.catch(function(){}).then(function(){g._canZoom=!0;e.end()})}};return g}(d.InputHandler);m.MouseWheelZoom=u})},"esri/views/2d/input/handlers/PinchAction":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/DragEventSeparator",
"../../../input/InputHandler"],function(u,m,p,d,n){Object.defineProperty(m,"__esModule",{value:!0});u=function(g){function l(k){var e=g.call(this,!0)||this;e.view=k;e.registerIncoming("drag",function(c){return e._handleDrag(c)});e.registerIncoming("pointer-down",function(){return e.stopMomentumNavigation()});var h=e.view.mapViewNavigation;e.dragEventSeparator=new d.DragEventSeparator({start:function(c,a){h.pinch.begin(e.view,a.data);a.stopPropagation()},update:function(c,a){h.pinch.update(e.view,
a.data);a.stopPropagation()},end:function(c,a){h.pinch.end(e.view);a.stopPropagation()},condition:function(c){return 2<=c}});return e}p(l,g);l.prototype._handleDrag=function(d){this.dragEventSeparator.handle(d)};l.prototype.stopMomentumNavigation=function(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()};return l}(n.InputHandler);m.PinchRotateAndZoom=u})},"esri/views/input/recognizers/DoubleTapDrag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../../../core/MapUtils ../../../core/screenUtils ../DragEventSeparator ../InputHandler ./SingleAndDoubleClick ./support".split(" "),
function(u,m,p,d,n,g,l,k,e,h){Object.defineProperty(m,"__esModule",{value:!0});u=function(c){function a(a,b,h,k,n){void 0===a&&(a=e.DefaultParameters.maximumDoubleClickDelay);void 0===b&&(b=e.DefaultParameters.maximumDoubleClickDistance);void 0===h&&(h=e.DefaultParameters.maximumDoubleTouchDelay);void 0===k&&(k=e.DefaultParameters.maximumDoubleTouchDistance);void 0===n&&(n=d.default);var f=c.call(this,!1)||this;f.maximumDoubleClickDelay=a;f.maximumDoubleClickDistance=b;f.maximumDoubleTouchDelay=h;
f.maximumDoubleTouchDistance=k;f._clock=n;f._doubleTapDragReady=!1;f._doubleTapDragActive=!1;f._dragStartCenter=g.createScreenPoint(0,0);f._pointerState=new Map;f._doubleTapDrag=f.registerOutgoing("double-tap-drag");f._dragEventSeparator=new l.DragEventSeparator({start:function(a,b){return f._dragStart(a,b)},update:function(a,b){return f._dragUpdate(b)},end:function(a,b){return f._dragEnd(b)}});f.registerIncoming("drag",function(a){return f._dragEventSeparator.handle(a)});f.registerIncoming("pointer-down",
function(a){return f._handlePointerDown(a)});f.registerIncoming("pointer-up",function(){return f._handlePointerUp()});return f}p(a,c);a.prototype.onUninstall=function(){this._pointerState.forEach(function(a){null!=a.doubleTapTimeout&&(a.doubleTapTimeout.remove(),a.doubleTapTimeout=null)})};Object.defineProperty(a.prototype,"hasPendingInputs",{get:function(){return n.someMap(this._pointerState,function(a){return null!=a.doubleTapTimeout})},enumerable:!0,configurable:!0});a.prototype._clearPointerDown=
function(a){var b=this._pointerState.get(a);b&&(b.doubleTapTimeout.remove(),b.doubleTapTimeout=null,this._pointerState.delete(a),this.refreshHasPendingInputs())};a.prototype._createDoubleTapDragData=function(a,b,c){return{action:a,delta:b,button:c.button,buttons:c.buttons,pointer:c.pointer,pointers:c.pointers,pointerType:c.pointerType,timestamp:c.timestamp}};a.prototype._dragStart=function(a,b){if(this._doubleTapDragReady&&1===a){this._doubleTapDragReady=!1;this._doubleTapDragActive=!0;var c=b.data;
a=b.modifiers;this._dragStartCenter=c.center;c=this._createDoubleTapDragData("begin",g.createScreenPoint(0,0),c);this._doubleTapDrag.emit(c,void 0,a);b.stopPropagation()}};a.prototype._dragUpdate=function(a){if(this._doubleTapDragActive){var b=a.data,c=a.modifiers,d=b.center,d=g.createScreenPoint(d.x-this._dragStartCenter.x,d.y-this._dragStartCenter.y),b=this._createDoubleTapDragData("update",d,b);this._doubleTapDrag.emit(b,void 0,c);a.stopPropagation()}};a.prototype._dragEnd=function(a){if(this._doubleTapDragActive){var b=
a.data,c=a.modifiers,d=b.center,d=g.createScreenPoint(d.x-this._dragStartCenter.x,d.y-this._dragStartCenter.y),b=this._createDoubleTapDragData("end",d,b);this._doubleTapDrag.emit(b,void 0,c);this._doubleTapDragActive=!1;a.stopPropagation()}};a.prototype._handlePointerDown=function(a){var b=a.data,c=this._pointerId(b),d=this._pointerState.get(c),e=b.native.pointerType;d?(e="touch"===e?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance,this._clearPointerDown(c),h.manhattanDistance(d.event.data,
b)>e?this._storePointerDown(a):this._doubleTapDragReady=!0):this._storePointerDown(a)};a.prototype._handlePointerUp=function(){this._doubleTapDragReady=!1};a.prototype._pointerId=function(a){var b=a.native;a=b.pointerId;var c=b.button,b=b.pointerType;return"mouse"===b?a+":"+c:""+b};a.prototype._storePointerDown=function(a){var b=this,c=a.data,d=c.native.pointerType,e=this._pointerId(c),c=this._clock.setTimeout(function(){return b._clearPointerDown(e)},"touch"===d?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay);
this._pointerState.set(e,{event:a,doubleTapTimeout:c});this.refreshHasPendingInputs()};return a}(k.InputHandler);m.DoubleTapDrag=u})},"esri/views/2d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(u,m,p,d,n,g,l){var k=0;return function(e){function g(){var c=null!==e&&e.apply(this,arguments)||this;c.color=
new n([0,255,255]);c.haloOpacity=1;c.fillOpacity=.25;return c}p(g,e);Object.defineProperty(g.prototype,"version",{get:function(){return k++},enumerable:!0,configurable:!0});d([l.property({readOnly:!0,dependsOn:["color","haloColor","haloOpacity","fillOpacity"]})],g.prototype,"version",null);d([l.property({type:n})],g.prototype,"color",void 0);d([l.property({type:n})],g.prototype,"haloColor",void 0);d([l.property()],g.prototype,"haloOpacity",void 0);d([l.property()],g.prototype,"fillOpacity",void 0);
return g=d([l.subclass("esri.views.2d.support.HighlightOptions")],g)}(l.declared(g))})},"esri/views/ui/2d/DefaultUI2D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI".split(" "),function(u,m,p,d,n,g){return function(g){function k(d){d=g.call(this,d)||this;d.components=["attribution","zoom"];return d}p(k,g);d([n.property()],k.prototype,"components",void 0);return k=d([n.subclass("esri.views.ui.2d.DefaultUI2D")],
k)}(n.declared(g))})},"esri/widgets/Search/LocatorSearchSource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/lang ../../core/accessorSupport/decorators ../../tasks/Locator ./SearchSource ./support/locatorUtils".split(" "),function(u,m,p,d,n,g,l,k,e,h){return function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.categories=null;a.countryCode=null;a.defaultZoomScale=null;
a.locator=null;a.locationType=null;a.name="";a.placeholder="";a.searchTemplate="";a.singleLineFieldName=null;a.suggestionsEnabled=null;a.zoomScale=null;a.getResults=function(b,c){return h.getResults(n({source:a},b),c)};a.getSuggestions=function(b,c){return h.getSuggestions(n({source:a},b),c)};return a}p(a,c);e=a;a.prototype.readLocator=function(a,c){return(a=c.url)?new k({url:a}):null};a.prototype.writeLocator=function(a,c){c.url=a?a.url:null};a.prototype.clone=function(){return new e({autoNavigate:this.autoNavigate,
filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?g.clone(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,searchExtent:this.searchExtent?this.searchExtent.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,
categories:this.categories?g.clone(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,locator:this.locator,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})};var e;d([l.property()],a.prototype,"categories",void 0);d([l.property()],a.prototype,"countryCode",void 0);d([l.property({json:{write:!0}})],a.prototype,"defaultZoomScale",void 0);d([l.property({type:k})],a.prototype,"locator",void 0);d([l.reader("locator",
["url"])],a.prototype,"readLocator",null);d([l.writer("locator")],a.prototype,"writeLocator",null);d([l.property()],a.prototype,"locationType",void 0);d([l.property({json:{write:!0}})],a.prototype,"name",void 0);d([l.property({json:{write:!0}})],a.prototype,"placeholder",void 0);d([l.property()],a.prototype,"searchTemplate",void 0);d([l.property({json:{write:!0}})],a.prototype,"singleLineFieldName",void 0);d([l.property({json:{read:{source:"suggest"},write:{target:"suggest"}}})],a.prototype,"suggestionsEnabled",
void 0);d([l.property({json:{write:!0}})],a.prototype,"zoomScale",void 0);return a=e=d([l.subclass("esri.widgets.Search.LocatorSearchSource")],a)}(l.declared(e))})},"esri/tasks/Locator":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../request ../core/accessorSupport/decorators ../geometry/SpatialReference ./Task ./support/AddressCandidate".split(" "),function(u,m,p,d,n,g,l,k,e,h){return function(c){function a(a){a=
c.call(this,a)||this;a.outSpatialReference=null;a.url=null;return a}p(a,c);a.prototype.addressToLocations=function(a,b){var c=a.address,d=a.categories,e=a.countryCode,f=a.forStorage,h=a.location,k=a.locationType,l=a.magicKey,m=a.maxLocations,p=a.outFields;a=a.searchExtent;var u=h?h.clone().normalize():null,E=a?a.shiftCentralMeridian():null,D=this.outSpatialReference,h=this.parsedUrl;a=this.requestOptions;d={f:"json",outSR:D?JSON.stringify(D.toJSON()):null,outFields:p?p.join(","):null,searchExtent:E?
JSON.stringify(E.toJSON()):null,category:d?d.join(","):null,countryCode:e||null,magicKey:l||null,location:u,locationType:k||null,maxLocations:m||null,forStorage:f||null};c={query:this._encode(n({},h.query,c,d))};b=n({},a,b,c);return g(h.path+"/findAddressCandidates",b).then(this._handleAddressToLocationsResponse)};a.prototype.suggestLocations=function(a,b){var c=this.parsedUrl,d=this.requestOptions,e=a.location,f=a.searchExtent,e=e?e.clone().normalize():null,f=f?f.shiftCentralMeridian():null;a={f:"json",
text:a.text,maxSuggestions:a.maxSuggestions,searchExtent:f?JSON.stringify(f.toJSON()):null,category:a.categories?a.categories.join(","):null,countryCode:a.countryCode||null,location:e};a={query:this._encode(n({},c.query,a))};b=n({},d,b,a);return g(c.path+"/suggest",b).then(this._handleSuggestLocationsResponse)};a.prototype.addressesToLocations=function(a,b){var c=this.outSpatialReference,d=this.parsedUrl,e=this.requestOptions,f=a.addresses,h=a.categories,k=a.locationType;a=a.countryCode;var l=[];
Array.isArray(f)&&f.forEach(function(a){l.push({attributes:a})});c={category:h?h.join(","):null,sourceCountry:a||null,addresses:JSON.stringify({records:l}),locationType:k||null,f:"json",outSR:c?JSON.stringify(c):null};c={query:this._encode(n({},d.query,c))};b=n({},e,b,c);return g(d.path+"/geocodeAddresses",b).then(this._handleAddressesToLocationsResponse)};a.prototype.locationToAddress=function(a,b){var c=a.locationType,d=(a=a.location)?a.clone().normalize():null,e="undefined"!==typeof d,f=this.outSpatialReference;
a=this.parsedUrl;var h=this.requestOptions,c={outSR:f?JSON.stringify(f.toJSON()):null,location:e?JSON.stringify(d.toJSON()):null,locationType:c||null,f:"json"},c={query:this._encode(n({},a.query,c))};b=n({},h,b,c);return g(a.path+"/reverseGeocode",b).then(this._handleLocationToAddressResponse)};a.prototype._handleAddressToLocationsResponse=function(a){a=a.data;if(!a)return[];var b=a.candidates,c=a.spatialReference;return b?b.map(function(a){if(a){var b=a.extent,d=a.location,e=b?b&&"number"===typeof b.xmin&&
"number"===typeof b.ymin&&"number"===typeof b.xmax&&"number"===typeof b.ymax:!0;if(d&&"number"===typeof d.x&&"number"===typeof d.y&&e)return b&&(b.spatialReference=c),d.spatialReference=c,h.fromJSON(a)}}):[]};a.prototype._handleSuggestLocationsResponse=function(a){return(a=a.data)?a.suggestions||[]:[]};a.prototype._handleAddressesToLocationsResponse=function(a){a=a.data;if(!a)return[];var b=a.locations,c=a.spatialReference;return b?b.map(function(a){var b=a.location;b&&(b.spatialReference=c);return h.fromJSON(a)}):
[]};a.prototype._handleLocationToAddressResponse=function(a){if(a=a.data){var b=a.address;return h.fromJSON({address:b&&b.Match_addr||"",attributes:b||{},location:a.location,score:100})}};d([l.property({type:k})],a.prototype,"outSpatialReference",void 0);d([l.property()],a.prototype,"url",void 0);return a=d([l.subclass("esri.tasks.Locator")],a)}(l.declared(e))})},"esri/tasks/support/AddressCandidate":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/Point".split(" "),
function(u,m,p,d,n,g,l,k){return function(e){function h(c){c=e.call(this,c)||this;c.address=null;c.attributes=null;c.extent=null;c.location=null;c.score=null;return c}d(h,e);p([g.property({type:String,json:{write:!0}})],h.prototype,"address",void 0);p([g.property({type:Object,json:{write:!0}})],h.prototype,"attributes",void 0);p([g.property({type:l,json:{write:!0}})],h.prototype,"extent",void 0);p([g.property({type:k,json:{write:!0}})],h.prototype,"location",void 0);p([g.property({type:Number,json:{write:!0}})],
h.prototype,"score",void 0);return h=p([g.subclass("esri.tasks.support.AddressCandidate")],h)}(g.declared(n.JSONSupport))})},"esri/widgets/Search/support/locatorUtils":function(){define("require exports ../../../Graphic ../../../core/maybe ../../../core/promiseUtils ./geometryUtils".split(" "),function(u,m,p,d,n,g){function l(a,d){var b=a.source,e=a.spatialReference,f=a.location,g=a.sourceIndex,h=a.view;a=b.locator;var k=b.zoomScale,l=b.defaultZoomScale,n=h&&h.scale;d=d&&d.signal;e&&(a.outSpatialReference=
e);return a.locationToAddress({location:f},{signal:d}).then(function(a){return c([a],{sourceIndex:g,scale:n,view:h,zoomScale:k,defaultZoomScale:l})})}function k(a,c){var b=a.filter,d=a.searchExtent;a=a.withinViewEnabled;var e=c&&c.extent;return(c=g.createExtentFromGeometry(b&&b.geometry,c,c&&c.scale))||d||(a&&e?e:void 0)}function e(a,e){var b=a.source,f=a.suggestResult,g=a.spatialReference,h=a.view,l=a.maxResults,m=a.sourceIndex,p=b&&b.zoomScale,t=b&&b.defaultZoomScale;if(!f.text.trim())return n.resolve();
a=""+(!f.key&&b.prefix?b.prefix:"")+f.text+(!f.key&&b.suffix?b.suffix:"");var r={},w=b.locator,u=h&&h.scale,E=k(b,h);e=e&&e.signal;if(!w)return n.resolve();b.categories&&(r.categories=b.categories);b.locationType&&(r.locationType=b.locationType);g&&(w.outSpatialReference=g);if(g=h&&h.get("extent.center"))r.location=g;r.maxLocations=l;E&&(r.searchExtent=d.unwrap(E));b.countryCode&&(r.countryCode=b.countryCode);var D=f.key;D&&(r.magicKey=D);r.address={};r.address[b.singleLineFieldName||"Single Line Input"]=
a;b.outFields&&(r.outFields=b.outFields);return w.addressToLocations(r,{signal:e}).then(function(a){return c(a,{key:D,scale:u,sourceIndex:m,view:h,zoomScale:p,defaultZoomScale:t})})}function h(a,c){return a.map(function(a){return{text:a.text,key:a.magicKey,sourceIndex:c}})}function c(a,c){return a.map(function(a){var b=c.key,d=c.scale,e=c.sourceIndex,f=c.view,h=c.zoomScale,k=c.defaultZoomScale,l=a.extent,n=a.location,m=a.address;a=new p({geometry:n,attributes:a.attributes});l=l||n;d=g.createExtentFromGeometry(l,
f,d);f=h?g.scaleExtent(d,f,h):k&&"point"===l.type?g.scaleExtent(d,f,k):d;n=n?n.x+","+n.y:"";return{extent:f,feature:a,key:b,name:m||n,sourceIndex:e}})}Object.defineProperty(m,"__esModule",{value:!0});m.getResults=function(a,c){return a.location?l(a,c):e(a,c)};m.getSuggestions=function(a,c){var b=a.source,e=a.spatialReference,f=a.view,g=a.suggestTerm,l=a.maxSuggestions,m=a.sourceIndex;a={};var p=b.locator,t=k(b,f);c=c&&c.signal;if(!p)return n.resolve();b.categories&&(a.categories=b.categories);p.outSpatialReference=
e;if(e=f&&f.get("extent.center"))a.location=e;if(!g.trim())return n.resolve();e=b.prefix;f=b.suffix;a.text=""+(void 0===e?"":e)+g+(void 0===f?"":f);t&&(a.searchExtent=d.unwrap(t));a.maxSuggestions=l;b.countryCode&&(a.countryCode=b.countryCode);return p.suggestLocations(a,{signal:c}).then(function(a){return h(a,m)})};m.isArcGISWorldGeocoder=function(a){return a?/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(a)||/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/gi.test(a):
!1}})},"esri/layers/SceneLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../PopupTemplate ../renderers ../request ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/utils ./Layer ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/commonProperties ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/FetchAssociatedFeatureLayer ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/LabelClass ./support/labelingInfo ./support/RangeInfo ../renderers/support/jsonUtils ../renderers/support/styleUtils ../support/popupUtils ../tasks/support/Query".split(" "),
function(u,m,p,d,n,g,l,k,e,h,c,a,f,b,x,v,y,q,B,C,t,r,w,F,E,D,H,G,K,O,z,A,L,I,S,T,U,J,M,P,Q){function R(a,b,c){a&&((a=J.read(a,b,c)||void 0)||N.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:c}));return a}var X=["3DObject","Point"],N=a.getLogger("esri.layers.SceneLayer"),V=z.defineFieldProperties(),W={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",
polygons:"polygons","features-polygons":"polygons"},Y={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(a){function b(b,c){b=a.call(this,b)||this;b.featureReduction=null;b.rangeInfos=null;b.operationalLayerType="ArcGISSceneServiceLayer";b.type="scene";b.fields=null;b.outFields=null;b.nodePages=null;b.materialDefinitions=null;b.textureSetDefinitions=null;b.geometryDefinitions=null;b.serviceUpdateTimeStamp=null;b.definitionExpression=null;b.path=null;b.labelsVisible=
!0;b.labelingInfo=null;b.legendEnabled=!0;b.cachedDrawingInfo={color:!1};b.popupEnabled=!0;b.popupTemplate=null;b.objectIdField=null;b.objectIdFilter=null;b._fieldUsageInfo={};b.screenSizePerspectiveEnabled=!0;return b}d(b,a);b.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?p({url:a},b):a};b.prototype.getField=function(a){return this.fieldsIndex.get(a)};b.prototype.getFieldDomain=function(a){return(a=this.getField(a))&&a.domain?a.domain:null};Object.defineProperty(b.prototype,
"fieldsIndex",{get:function(){return new A(this.fields)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"elevationInfo",{set:function(a){this._set("elevationInfo",a);this.loaded&&this._validateElevationInfo()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"geometryType",{get:function(){return Y[this.profile]||"mesh"},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderer",{set:function(a){L.fixRendererFields(a,this.fields);this._set("renderer",
a)},enumerable:!0,configurable:!0});b.prototype.readCachedDrawingInfo=function(a){if(null==a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};Object.defineProperty(b.prototype,"defaultPopupTemplate",{get:function(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null},enumerable:!0,configurable:!0});b.prototype.readObjectIdField=function(a,b){!a&&b.fields&&b.fields.some(function(b){"esriFieldTypeOID"===b.type&&(a=b.name);return!!a});return a||void 0};
b.prototype.readProfile=function(a,b){a=b.store.profile;if(null!=a&&W[a])return W[a];N.error("Unknown or missing profile",{profile:a,layer:this});return"mesh-pyramids"};b.prototype.load=function(a){var b=this,c=f.isSome(a)?a.signal:null;a=this.loadFromPortal({supportedTypes:["Scene Service"]},a).then(function(){return b._fetchService(c)},function(){return b._fetchService(c)}).then(function(){return x.all([b._verifyRootNodeAndUpdateExtent(b.nodePages,c),b._setAssociatedFeatureLayer(c)])}).then(function(){return b._validateElevationInfo()}).then(function(){return b._applyAssociatedLayerOverrides()}).then(function(){return b._populateFieldUsageInfo()}).then(function(){return M.loadStyleRenderer(b,
{origin:"service"},c)}).then(function(){return L.fixRendererFields(b.renderer,b.fields)});this.addResolvingPromise(a);return x.resolve(this)};b.prototype.createQuery=function(){var a=new Q;"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};b.prototype.queryExtent=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryExtent(a||c.createQuery(),b)})};b.prototype.queryFeatureCount=
function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryFeatureCount(a||c.createQuery(),b)})};b.prototype.queryFeatures=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryFeatures(a||c.createQuery(),b)}).then(function(a){if(a&&a.features)for(var b=0,d=a.features;b<d.length;b++){var e=d[b];e.layer=c;e.sourceLayer=c}return a})};b.prototype.queryObjectIds=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryObjectIds(a||
c.createQuery(),b)})};b.prototype.getFieldUsageInfo=function(a){var b={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[a]||b:(N.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),b)};b.prototype.createPopupTemplate=function(a){return P.createPopupTemplate(this,a)};b.prototype._getAssociatedLayerForQuery=function(){var a=this;if(!this.loaded)return this.load().then(function(){return a._getAssociatedLayerForQuery()});
var b=this.associatedLayer;return null!=b?x.resolve(b):x.reject(new c("scenelayer:query-not-available","SceneLayer queries are not available without associated feature layer"))};b.prototype.hasCachedStatistics=function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===a})};b.prototype.queryCachedStatistics=function(a,b){return l(this,void 0,void 0,function(){var d,e,f,k,l;return g(this,function(g){switch(g.label){case 0:return[4,this.load(b)];case 1:g.sent();
if(!this.statisticsInfo)throw new c("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");d=this.fieldsIndex.get(a);if(!d)throw new c("scenelayer:field-unexisting","Field '"+a+"' does not exist on the layer");e=0;for(f=this.statisticsInfo;e<f.length;e++)if(k=f[e],k.name===d.name)return l=v.join(this.parsedUrl.path,k.href),[2,h(l,{query:{f:"json"},responseType:"json",signal:b?b.signal:null}).then(function(a){return a.data})];throw new c("scenelayer:no-cached-statistics",
"Cached statistics for this attribute are not available");}})})};b.prototype.validateLayer=function(a){if(a.layerType&&-1===X.indexOf(a.layerType))throw new c("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new c("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new c("layer:service-version-too-new",
"Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});a=this.normalReferenceFrame;var b=this.spatialReference,d=!1,e=!1;if(null==a)e=d=!0;else switch(b=b&&b.isGeographic,a){case "east-north-up":case "earth-centered":d=!0;e=b;break;case "vertex-reference-frame":d=!0;e=!b;break;default:d=!1}if(!d)throw new c("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!e)throw new c("scenelayer:incompatible-normal-reference-frame",
"Normal reference frame is incompatible with layer spatial reference.");};b.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=function(a){var c=!(!b.attributeStorageInfo||!b.attributeStorageInfo.some(function(b){return b.name===a.name})),d=!!(b.associatedLayer&&b.associatedLayer.fields&&b.associatedLayer.fields.some(function(b){return b&&a.name===b.name}));b._fieldUsageInfo[a.name]={supportsLabelingInfo:c,supportsRenderer:c,supportsPopupTemplate:c||d,supportsLayerQuery:d}},
b=this,c=0,d=this.fields;c<d.length;c++)a(d[c])};b.prototype._applyAssociatedLayerOverrides=function(){if(this.associatedLayer){if(this.associatedLayer.fields){for(var a=null,b=0,c=this.associatedLayer.fields;b<c.length;b++){var d=c[b];this.getField(d.name)||(a||(a=this.fields?this.fields.slice():[]),a.push(d.clone()))}a&&this._set("fields",a)}a=["popupTemplate","popupEnabled"];b=B.getProperties(this);for(c=0;c<a.length;c++)d=a[c],this._buddyIsMoreImportant(d)&&(b.setDefaultOrigin(this.associatedLayer.originOf(d)),
b.set(d,this.associatedLayer[d]),b.setDefaultOrigin("user"))}};b.prototype._setAssociatedFeatureLayer=function(a){return l(this,void 0,void 0,function(){var b,c,d;return g(this,function(e){switch(e.label){case 0:b=new O.FetchAssociatedFeatureLayer(this,a),e.label=1;case 1:return e.trys.push([1,3,,4]),c=this,[4,b.fetch()];case 2:return c.associatedLayer=e.sent(),[3,4];case 3:return d=e.sent(),x.isAbortError(d)||this._logWarningOnPopupEnabled(),[3,4];case 4:return[2]}})})};b.prototype._logWarningOnPopupEnabled=
function(){var a=this;y.whenValidOnce(this,["popupTemplate","popupEnabled"],function(){return a.popupEnabled&&null!=a.popupTemplate}).then(function(){return function(){var b="this SceneLayer: "+a.title;null==a.attributeStorageInfo?N.warn("Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on "+b):N.info("Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on "+b)}})};b.prototype._buddyIsMoreImportant=function(a){if(!this.associatedLayer)return!1;
var b=this.originIdOf(a);a=this.associatedLayer.originIdOf(a);return null!=a&&2>=a?null==b||2>b:null!=a&&3>=a?null==b||3>b:!1};b.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("mesh-pyramids"===this.profile&&"absolute-height"!==a.mode&&N.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&N.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};
n([q.property({types:{key:"type",base:G.default,typeMap:{selection:K.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],b.prototype,"featureReduction",void 0);n([q.property({type:[U.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],b.prototype,"rangeInfos",void 0);n([q.property({json:{read:!1}})],b.prototype,"associatedLayer",
void 0);n([q.property({type:["show","hide"]})],b.prototype,"listMode",void 0);n([q.property({type:["ArcGISSceneServiceLayer"]})],b.prototype,"operationalLayerType",void 0);n([q.property({json:{read:!1},readOnly:!0})],b.prototype,"type",void 0);n([q.property(p({},V.fields,{readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}}))],b.prototype,"fields",void 0);n([q.property({readOnly:!0,dependsOn:["fields"]})],b.prototype,"fieldsIndex",null);n([q.property(V.outFields)],b.prototype,"outFields",void 0);
n([q.property({type:I.I3SNodePageDefinition,readOnly:!0})],b.prototype,"nodePages",void 0);n([q.property({type:[I.I3SMaterialDefinition],readOnly:!0})],b.prototype,"materialDefinitions",void 0);n([q.property({type:[I.I3STextureSetDefinition],readOnly:!0})],b.prototype,"textureSetDefinitions",void 0);n([q.property({type:[I.I3SGeometryDefinition],readOnly:!0})],b.prototype,"geometryDefinitions",void 0);n([q.property({readOnly:!0})],b.prototype,"serviceUpdateTimeStamp",void 0);n([q.property({readOnly:!0})],
b.prototype,"attributeStorageInfo",void 0);n([q.property({readOnly:!0})],b.prototype,"statisticsInfo",void 0);n([q.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],b.prototype,"definitionExpression",void 0);n([q.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],b.prototype,"path",void 0);n([q.property(D.elevationInfo)],b.prototype,"elevationInfo",
null);n([q.property({type:String,dependsOn:["profile"]})],b.prototype,"geometryType",null);n([q.property(D.labelsVisible)],b.prototype,"labelsVisible",void 0);n([q.property({type:[S],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:T.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:T.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],b.prototype,"labelingInfo",void 0);n([q.property(D.legendEnabled)],
b.prototype,"legendEnabled",void 0);n([q.property(D.opacityDrawingInfo)],b.prototype,"opacity",void 0);n([q.property({types:e.webSceneRendererTypes,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:R}}},read:{source:"layerDefinition.drawingInfo.renderer",reader:R},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],b.prototype,"renderer",null);n([q.property({json:{read:!1}})],b.prototype,"cachedDrawingInfo",void 0);n([q.reader("service","cachedDrawingInfo")],b.prototype,
"readCachedDrawingInfo",null);n([q.property(D.popupEnabled)],b.prototype,"popupEnabled",void 0);n([q.property({type:k,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],b.prototype,"popupTemplate",void 0);n([q.property({readOnly:!0,json:{read:!1},dependsOn:["fields","title","attributeStorageInfo","associatedLayer"]})],b.prototype,"defaultPopupTemplate",null);n([q.property({type:String,json:{read:!1}})],b.prototype,"objectIdField",void 0);n([q.reader("service","objectIdField",["objectIdField",
"fields"])],b.prototype,"readObjectIdField",null);n([q.property({json:{read:!1}})],b.prototype,"objectIdFilter",void 0);n([q.property({type:String,json:{read:!1}})],b.prototype,"profile",void 0);n([q.reader("service","profile",["store.profile"])],b.prototype,"readProfile",null);n([q.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],b.prototype,"normalReferenceFrame",void 0);n([q.property(H.screenSizePerspectiveEnabled)],b.prototype,
"screenSizePerspectiveEnabled",void 0);return b=n([q.subclass("esri.layers.SceneLayer")],b)}(q.declared(F.ScaleRangeLayer(E.SceneService(t.ArcGISService(r.OperationalLayer(w.PortalLayer(b.MultiOriginJSONMixin(C))))))))})},"esri/layers/mixins/SceneService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties".split(" "),
function(u,m,p,d,n,g,l,k,e,h,c,a,f,b,x,v,y){Object.defineProperty(m,"__esModule",{value:!0});var q=e.getLogger("esri.layers.mixins.SceneService");m.SceneService=function(e){return function(e){function m(){var a=null!==e&&e.apply(this,arguments)||this;a.blendMode=null;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.minScale=0;a.maxScale=0;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";a.title=null;a.layerId=null;return a}
p(m,e);m.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)};m.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return x.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new x(a):null};m.prototype.readFullExtent=function(a,b){a=b.store;b=this._readSpatialReference(b);return null==b||null==a||null==a.extent||!Array.isArray(a.extent)||a.extent.some(function(a){return a<
B})?null:new f({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],spatialReference:b})};m.prototype.readVersion=function(a,b){a=b.store;b=null!=a.version?a.version.toString():"";a={major:Number.NaN,minor:Number.NaN,versionString:b};b=b.split(".");2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10));return a};m.prototype.readTitlePortalItem=function(a){return"item-title"!==this.sublayerTitleMode?void 0:a};m.prototype.readTitleService=function(a,b){a=this.portalItem&&
this.portalItem.title;if("item-title"===this.sublayerTitleMode)return v.titleFromUrlAndName(this.url,b.name);b=b.name||v.parse(this.url).title;"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b);return v.cleanTitle(b)};m.prototype.readLayerId=function(a,b){return b.id};Object.defineProperty(m.prototype,"url",{set:function(a){a=v.sanitizeUrlWithLayerId(this,a,q);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0});m.prototype.writeUrl=
function(a,b,c,d){v.writeUrlWithLayerId(this,a,"layers",b,d)};Object.defineProperty(m.prototype,"parsedUrl",{get:function(){var a=this._get("url");if(!a)return null;a=c.urlToObject(a);null!=this.layerId&&v.isArcGISUrl(a.path)&&(a.path=a.path+"/layers/"+this.layerId);return a},enumerable:!0,configurable:!0});m.prototype._verifyRootNodeAndUpdateExtent=function(a,b){return g(this,void 0,void 0,function(){var c,d,e;return n(this,function(f){switch(f.label){case 0:if(!a)return[3,4];f.label=1;case 1:return f.trys.push([1,
3,,4]),c=this._updateExtentFromRootPage,d=[a],[4,this._fetchRootPage(a,b)];case 2:return[2,c.apply(this,d.concat([f.sent()]))];case 3:return f.sent(),[3,4];case 4:return e=this._updateExtentFromRootNode,[4,this._fetchRootNode(b)];case 5:return[2,e.apply(this,[f.sent()])]}})})};m.prototype._fetchRootPage=function(a,b){return g(this,void 0,void 0,function(){var c,d,e;return n(this,function(f){switch(f.label){case 0:if(!a)return[2,h.reject()];c=Math.floor(a.rootIndex/a.nodesPerPage);d=this.parsedUrl.path+
"/nodepages/"+c;return[4,l(d,{responseType:"json",signal:b})];case 1:return e=f.sent(),[2,e.data]}})})};m.prototype._updateExtentFromRootPage=function(a,b){if(null==b||null==b.nodes)throw new k("sceneservice:invalid-node-page","Inavlid node page.");b=b.nodes[a.rootIndex%a.nodesPerPage];if(null==b||null==b.obb||null==b.obb.center||null==b.obb.halfSize)throw new k("sceneservice:invalid-node-page","Inavlid node page.");a=b.obb.halfSize;b=b.obb.center[2];a=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);this.fullExtent.zmin=
b-a;this.fullExtent.zmax=b+a};m.prototype._updateExtentFromRootNode=function(a){if(null!=this.fullExtent&&!this.fullExtent.hasZ&&null!=a&&Array.isArray(a.mbs)&&4===a.mbs.length){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=b+a}};m.prototype._fetchRootNode=function(a){return g(this,void 0,void 0,function(){var b,d,e;return n(this,function(f){switch(f.label){case 0:if(!this.rootNode)return[2];b=c.join(this.parsedUrl.path,this.rootNode);f.label=1;case 1:return f.trys.push([1,
3,,4]),[4,l(b,{query:{f:"json"},responseType:"json",signal:a})];case 2:return d=f.sent(),[2,d.data];case 3:throw e=f.sent(),new k("sceneservice:root-node-missing","Root node missing.",{error:e,url:b});case 4:return[2]}})})};m.prototype._fetchService=function(a){return g(this,void 0,void 0,function(){var b;return n(this,function(c){switch(c.label){case 0:return null==this.layerId&&/SceneServer\/*$/i.test(this.url)?[4,this._fetchFirstLayerId(a)]:[3,2];case 1:b=c.sent(),null!=b&&(this.layerId=b),c.label=
2;case 2:return[2,this._fetchServiceLayer(a)]}})})};m.prototype._fetchFirstLayerId=function(a){return g(this,void 0,void 0,function(){var b;return n(this,function(c){switch(c.label){case 0:return[4,l(this.url,{query:{f:"json"},responseType:"json",signal:a})];case 1:return b=c.sent(),b.data&&Array.isArray(b.data.layers)&&0<b.data.layers.length?[2,b.data.layers[0].id]:[2,void 0]}})})};m.prototype._fetchServiceLayer=function(a){return g(this,void 0,void 0,function(){var b,c;return n(this,function(d){switch(d.label){case 0:return[4,
l(this.parsedUrl.path,{query:{f:"json"},responseType:"json",signal:a})];case 1:return b=d.sent(),b.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),c=b.data,this.read(c,{origin:"service",url:this.parsedUrl}),this.validateLayer(c),[2]}})})};m.prototype.validateLayer=function(a){};d([a.shared({id:{json:{origins:{service:{read:!1},"portal-item":{read:!1}}}}})],m.prototype,"properties",void 0);d([a.property({type:x})],m.prototype,"spatialReference",void 0);d([a.reader("spatialReference",["spatialReference",
"store.indexCRS","store.geographicCRS"])],m.prototype,"readSpatialReference",null);d([a.property({type:f})],m.prototype,"fullExtent",void 0);d([a.reader("fullExtent",["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],m.prototype,"readFullExtent",null);d([a.property({readOnly:!0,type:b})],m.prototype,"heightModelInfo",void 0);d([a.property({type:Number,json:{read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"},origins:{service:{read:{source:"minScale"},
write:!1}}}})],m.prototype,"minScale",void 0);d([a.property({type:Number,json:{read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"},origins:{service:{read:{source:"maxScale"},write:!1}}}})],m.prototype,"maxScale",void 0);d([a.property({readOnly:!0})],m.prototype,"version",void 0);d([a.reader("version",["store.version"])],m.prototype,"readVersion",null);d([a.property({type:String,json:{read:{source:"copyrightText"}}})],m.prototype,"copyright",void 0);d([a.property({type:String,
json:{read:!1}})],m.prototype,"sublayerTitleMode",void 0);d([a.property({type:String})],m.prototype,"title",void 0);d([a.reader("portal-item","title")],m.prototype,"readTitlePortalItem",null);d([a.reader("service","title",["name"])],m.prototype,"readTitleService",null);d([a.property({type:Number})],m.prototype,"layerId",void 0);d([a.reader("service","layerId",["id"])],m.prototype,"readLayerId",null);d([a.property(y.url)],m.prototype,"url",null);d([a.writer("url")],m.prototype,"writeUrl",null);d([a.property({dependsOn:["layerId"]})],
m.prototype,"parsedUrl",null);d([a.property({readOnly:!0})],m.prototype,"store",void 0);d([a.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],m.prototype,"rootNode",void 0);return m=d([a.subclass("esri.layers.mixins.SceneService")],m)}(a.declared(e))};var B=-1E38})},"esri/layers/support/FetchAssociatedFeatureLayer":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../kernel ../../request ../../core/arrayUtils ../../core/maybe ../../core/promiseUtils ../FeatureLayer ../../portal/Portal ../../portal/PortalItem".split(" "),
function(u,m,p,d,n,g,l,k,e,h,c,a){Object.defineProperty(m,"__esModule",{value:!0});u=function(){function f(a,c){this.layer=a;this.signal=c;this.rootDocument=null;if(a=this.layer.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i))this.urlParts={root:a[1],layerId:parseInt(a[2],10)}}f.prototype.fetch=function(){return d(this,void 0,void 0,function(){var a,c,d;return p(this,function(b){switch(b.label){case 0:if(!this.urlParts||-1===["mesh-pyramids","points"].indexOf(this.layer.profile))return[2,
null];if(!this.layer.portalItem)return[3,1];c=this.layer.portalItem;return[3,3];case 1:return[4,this.portalItemFromServiceItemId()];case 2:c=b.sent(),b.label=3;case 3:return a=c,k.isNone(a)?[2,this.loadFromUrl()]:[4,this.findAndLoadRelatedPortalItem(a)];case 4:return d=b.sent(),k.isNone(d)?[2,null]:[2,this.loadFeatureLayerFromPortalItem(d)]}})})};f.prototype.fetchRootDocument=function(){return d(this,void 0,void 0,function(){var a,c,d;return p(this,function(b){switch(b.label){case 0:if(k.isSome(this.rootDocument))return[2,
this.rootDocument];if(k.isNone(this.urlParts))return this.rootDocument={},[2,{}];a={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal};c=this.urlParts.root+"/SceneServer";b.label=1;case 1:return b.trys.push([1,3,,4]),[4,g(c,a)];case 2:return d=b.sent(),this.rootDocument=d.data,[3,4];case 3:return b.sent(),this.rootDocument={},[3,4];case 4:return[2,this.rootDocument]}})})};f.prototype.fetchServiceOwningPortalUrl=function(){return d(this,void 0,void 0,function(){var a,c,d,
f,h;return p(this,function(b){switch(b.label){case 0:if((a=n.id&&n.id.findServerInfo(this.layer.parsedUrl.path))&&a.owningSystemUrl)return[2,a.owningSystemUrl];c=this.layer.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";b.label=1;case 1:return b.trys.push([1,3,,4]),[4,g(c,{query:{f:"json"},responseType:"json",signal:this.signal})];case 2:return d=b.sent(),(f=d.data.owningSystemUrl)?[2,f]:[3,4];case 3:return h=b.sent(),e.throwIfAbortError(h),[3,4];case 4:return[2,null]}})})};f.prototype.findAndLoadRelatedPortalItem=
function(a){return d(this,void 0,void 0,function(){var b,c;return p(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),[4,a.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})];case 1:return b=d.sent(),[2,l.find(b,function(a){return"Feature Service"===a.type})||null];case 2:return c=d.sent(),e.throwIfAbortError(c),[2,null];case 3:return[2]}})})};f.prototype.loadFeatureLayerFromPortalItem=function(a){return d(this,void 0,void 0,function(){var b,
c;return p(this,function(d){switch(d.label){case 0:return[4,a.load({signal:this.signal})];case 1:return d.sent(),[4,this.findMatchingAssociatedSublayerUrl(a.url)];case 2:return b=d.sent(),c=new h({url:b,portalItem:a}),[2,c.load({signal:this.signal})]}})})};f.prototype.loadFromUrl=function(){return d(this,void 0,void 0,function(){var a,c;return p(this,function(b){switch(b.label){case 0:return[4,this.findMatchingAssociatedSublayerUrl(this.urlParts.root+"/FeatureServer")];case 1:return a=b.sent(),c=
new h({url:a}),[2,c.load({signal:this.signal})]}})})};f.prototype.findMatchingAssociatedSublayerUrl=function(a){return d(this,void 0,void 0,function(){var b,c,d,f,h,k,l,m,n,u,E,D;return p(this,function(q){switch(q.label){case 0:return b=a.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),c={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal},d=this.urlParts.layerId,f=this.fetchRootDocument(),h=g(b,c),[4,e.all([h,f])];case 1:k=q.sent();l=k[0];n=(m=k[1])&&m.layers;u=l.data&&
l.data.layers;if(!Array.isArray(u))throw Error("expected layers array");if(Array.isArray(n))for(E=0;E<Math.min(n.length,u.length);E++){if(D=n[E],D.id===d)return[2,b+"/"+u[E].id]}else if(d<u.length)return[2,b+"/"+u[d].id];throw Error("could not find matching associated sublayer");}})})};f.prototype.portalItemFromServiceItemId=function(){return d(this,void 0,void 0,function(){var b,d,f,g;return p(this,function(h){switch(h.label){case 0:return[4,this.fetchRootDocument()];case 1:b=h.sent();d=b.serviceItemId;
if(!d)return[2,null];f=new a({id:d});return[4,this.fetchServiceOwningPortalUrl()];case 2:g=h.sent();k.isSome(g)&&(f.portal=new c({url:g}));try{return[2,f.load({signal:this.signal})]}catch(B){return e.throwIfAbortError(B),[2,null]}}})})};return f}();m.FetchAssociatedFeatureLayer=u})},"esri/layers/support/I3SLayerDefinitions":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(u,m,p,d,n,g){Object.defineProperty(m,"__esModule",{value:!0});u=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.nodesPerPage=null;b.rootIndex=0;b.lodSelectionMetricType=null;return b}p(c,a);d([g.property({type:Number})],c.prototype,"nodesPerPage",void 0);d([g.property({type:Number})],c.prototype,"rootIndex",void 0);d([g.property({type:String})],c.prototype,"lodSelectionMetricType",void 0);return c=d([g.subclass("esri.layer.support.I3SNodePageDefinition")],c)}(g.declared(n.JSONSupport));
m.I3SNodePageDefinition=u;var l=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.factor=1;return b}p(c,a);d([g.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],c.prototype,"id",void 0);d([g.property({type:Number})],c.prototype,"factor",void 0);return c=d([g.subclass("esri.layer.support.I3SMaterialTexture")],c)}(g.declared(n.JSONSupport));m.I3SMaterialTexture=l;var k=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.baseColorFactor=
[1,1,1,1];b.baseColorTexture=null;b.metallicRoughnessTexture=null;b.metallicFactor=1;b.roughnessFactor=1;return b}p(c,a);d([g.property({type:[Number]})],c.prototype,"baseColorFactor",void 0);d([g.property({type:l})],c.prototype,"baseColorTexture",void 0);d([g.property({type:l})],c.prototype,"metallicRoughnessTexture",void 0);d([g.property({type:Number})],c.prototype,"metallicFactor",void 0);d([g.property({type:Number})],c.prototype,"roughnessFactor",void 0);return c=d([g.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],
c)}(g.declared(n.JSONSupport));m.I3SMaterialPBRMetallicRoughness=k;u=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.alphaMode="opaque";b.alphaCutoff=.25;b.doubleSided=!1;b.cullFace="none";b.normalTexture=null;b.occlusionTexture=null;b.emissiveTexture=null;b.emissiveFactor=null;b.pbrMetallicRoughness=null;return b}p(c,a);d([g.enumeration.serializable()({opaque:"opaque",mask:"mask",blend:"blend"})],c.prototype,"alphaMode",void 0);d([g.property({type:Number})],c.prototype,"alphaCutoff",
void 0);d([g.property({type:Boolean})],c.prototype,"doubleSided",void 0);d([g.enumeration.serializable()({none:"none",back:"back",front:"front"})],c.prototype,"cullFace",void 0);d([g.property({type:l})],c.prototype,"normalTexture",void 0);d([g.property({type:l})],c.prototype,"occlusionTexture",void 0);d([g.property({type:l})],c.prototype,"emissiveTexture",void 0);d([g.property({type:[Number]})],c.prototype,"emissiveFactor",void 0);d([g.property({type:k})],c.prototype,"pbrMetallicRoughness",void 0);
return c=d([g.subclass("esri.layer.support.I3SMaterialDefinition")],c)}(g.declared(n.JSONSupport));m.I3SMaterialDefinition=u;var e=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}p(c,a);d([g.property({type:String,json:{read:{source:["name","index"],reader:function(a,c){return null!=a?a:""+c.index}}}})],c.prototype,"name",void 0);d([g.enumeration.serializable()({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2"})],c.prototype,"format",void 0);return c=d([g.subclass("esri.layer.support.I3STextureFormat")],
c)}(g.declared(n.JSONSupport));m.I3STextureFormat=e;u=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.atlas=!1;return b}p(c,a);d([g.property({type:[e]})],c.prototype,"formats",void 0);d([g.property({type:Boolean})],c.prototype,"atlas",void 0);return c=d([g.subclass("esri.layer.support.I3STextureSetDefinition")],c)}(g.declared(n.JSONSupport));m.I3STextureSetDefinition=u;var h=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}p(c,a);d([g.enumeration.serializable()({Float32:"Float32",
UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],c.prototype,"type",void 0);d([g.property({type:Number})],c.prototype,"component",void 0);return c=d([g.subclass("esri.layer.support.I3SGeometryAttribute")],c)}(g.declared(n.JSONSupport));m.I3SGeometryAttribute=h;var c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}p(c,a);d([g.enumeration.serializable()({draco:"draco"})],c.prototype,"encoding",void 0);d([g.property({type:[String]})],c.prototype,"attributes",void 0);
return c=d([g.subclass("esri.layer.support.I3SGeometryAttribute")],c)}(g.declared(n.JSONSupport));m.I3SGeometryCompressedAttributes=c;u=function(a){function e(){var b=null!==a&&a.apply(this,arguments)||this;b.offset=0;return b}p(e,a);d([g.property({type:Number})],e.prototype,"offset",void 0);d([g.property({type:h})],e.prototype,"position",void 0);d([g.property({type:h})],e.prototype,"normal",void 0);d([g.property({type:h})],e.prototype,"uv0",void 0);d([g.property({type:h})],e.prototype,"color",void 0);
d([g.property({type:h})],e.prototype,"uvRegion",void 0);d([g.property({type:h})],e.prototype,"featureId",void 0);d([g.property({type:h})],e.prototype,"faceRange",void 0);d([g.property({type:c})],e.prototype,"compressedAttributes",void 0);return e=d([g.subclass("esri.layer.support.I3SGeometryBuffer")],e)}(g.declared(n.JSONSupport));m.I3SGeometryBuffer=u;n=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}p(c,a);d([g.enumeration.serializable()({triangle:"triangle"})],c.prototype,
"topology",void 0);d([g.property()],c.prototype,"geometryBuffers",void 0);return c=d([g.subclass("esri.layer.support.I3SMeshDefinition")],c)}(g.declared(n.JSONSupport));m.I3SGeometryDefinition=n})},"esri/layers/support/RangeInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(u,m,p,d,n,g){Object.defineProperty(m,"__esModule",{value:!0});u=function(l){function k(){var d=
null!==l&&l.apply(this,arguments)||this;d.name=null;d.field=null;d.currentRangeExtent=null;d.fullRangeExtent=null;d.type="rangeInfo";return d}p(k,l);d([g.property({type:String,json:{read:!0,write:!0}})],k.prototype,"name",void 0);d([g.property({type:String,json:{read:!0,write:!0}})],k.prototype,"field",void 0);d([g.property({type:[Number],json:{read:!0,write:!0}})],k.prototype,"currentRangeExtent",void 0);d([g.property({type:[Number],json:{read:!0,write:!0}})],k.prototype,"fullRangeExtent",void 0);
d([g.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],k.prototype,"type",void 0);return k=d([g.subclass("esri.layers.support.RangeInfo")],k)}(g.declared(n.JSONSupport));m.RangeInfo=u;m.default=u})},"widgets/Search/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred dojo/when dojo/promise/all jimu/portalUtils jimu/utils esri/request".split(" "),function(u,m,p,d,n,g,l,k){return{map:null,layerInfosObj:null,appConfig:null,_esriLocatorRegExp:/geocode(.){0,3}\.arcgis.com\/arcgis\/rest\/services\/World\/GeocodeServer/g,
setMap:function(d){this.map=d},setLayerInfosObj:function(d){this.layerInfosObj=d},setAppConfig:function(d){this.appConfig=d},getConfigInfo:function(e){if(e&&e.sources&&0<e.sources.length){var g=null;return this.searchLayer(this.map)&&e.upgradeFromGeocoder?(g=this.map.itemInfo.itemData.applicationProperties.viewing.search,g=m.map(g.layers,u.hitch(this,function(c,a){a.hintText=c;return this._getQueryTypeGeocoder(a)},g.hintText)),n(g).then(u.hitch(this,function(c){e.sources=[].concat(c).concat(e.sources);
return e}))):e}return d(this._getSoucesFromPortalAndWebmap()).then(u.hitch(this,function(c){return{allPlaceholder:"",showInfoWindowOnSelect:!0,sources:c}}))},_getSoucesFromPortalAndWebmap:function(){var d=[],h=null;this.searchLayer(this.map)&&(h=this.map.itemInfo.itemData.applicationProperties.viewing.search,m.forEach(h.layers,u.hitch(this,function(c,a){a.hintText=c;d.push(this._getQueryTypeGeocoder(a))},h.hintText)));return g.getPortalSelfInfo(this.appConfig.portalUrl).then(u.hitch(this,function(c){if((c=
c.helperServices&&c.helperServices.geocode)&&0<c.length)for(var a=0,e=c.length;a<e;a++){var b=c[a];b&&d.push(this._processSingleLine(b))}return n(d).then(u.hitch(this,function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];d&&(d&&"query"===d.type||(d={name:d.name||this._getGeocodeName(d.url),url:d.url,singleLineFieldName:d.singleLineFieldName,placeholder:d.placeholder||window.jimuNls.common.findAddressOrPlace||d.name||this._getGeocodeName(d.url),maxResults:6,searchInCurrentMapExtent:!1,type:"locator"}),
b.push(d))}return b}))}))},_getQueryTypeGeocoder:function(d){var e=this.map.findLayerById(d.id),c=null,a=null,a=d.id,c=null;e&&e.allSublayers&&(c=e.allSublayers.find(function(a){return a.id===d.subLayer}));return e?(c="scene"===e.type?e.url+"/layers/"+e.layerId:c?c.url||e.url+"/"+d.subLayer:e.url+"/"+e.layerId,{name:e.title,layerId:a,url:c,placeholder:d.hintText||window.jimuNls.common.findAddressOrPlace,searchFields:[d.field.name],displayField:d.field.name,exactMatch:d.field.exactMatch||!1,maxResults:6,
searchInCurrentMapExtent:!1,type:"query"}):null},_isEsriLocator:function(d){this._esriLocatorRegExp.lastIndex=0;return this._esriLocatorRegExp.test(d)},_processSingleLine:function(d){if(d.singleLineFieldName)return d;if(this._isEsriLocator(d.url))return d.singleLineFieldName="SingleLine",d;var e=new p;k(d.url,{query:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(u.hitch(this,function(c){c.singleLineAddressField&&c.singleLineAddressField.name?(d.singleLineFieldName=c.singleLineAddressField.name,
e.resolve(d)):(console.warn(d.url+"has no singleLineFieldName"),e.resolve(null))}),u.hitch(this,function(c){console.error(c);e.resolve(null)}));return e.promise},_getGeocodeName:function(d){if("string"!==typeof d)return"geocoder";d=d.split("/");return d[d.length-2]||"geocoder"},getGeocoderName:function(d){return this._getGeocodeName(d)},hasAppSearchInfo:function(d){return d.itemInfo&&d.itemInfo.itemData&&d.itemInfo.itemData.applicationProperties&&d.itemInfo.itemData.applicationProperties.viewing&&
d.itemInfo.itemData.applicationProperties.viewing.search},searchLayer:function(d){if(!d||!this.hasAppSearchInfo(d))return!1;d=d.itemInfo.itemData.applicationProperties.viewing.search;return d.enabled&&0!==d.layers.length?!0:!1}}})},"widgets/Search/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/Search/Widget.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"searchNode" class\x3d"search-node"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"searchResultsNode" class\x3d"searchResults arcgisSearch esri-search"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Search/css/style.css":".jimu-widget-search{min-height: 32px;}.jimu-widget-search .search-node.default-width-for-openAtStart{width: 300px;}.jimu-widget-search .esri-search__container{border: 1px solid #57585A;}.jimu-widget-search .result-item-selected{background: #eee;}.jimu-widget-search .esri-search .esri-search-button:hover,.jimu-widget-search .esri-search .esri-search-button:focus {background-color: #485566; color: white;}.jimu-widget-search .esri-search .show-all-results{position: absolute; height: 25px; color: #686868; line-height: 25px; display: none; width: 237px; margin: auto; background-color: #fff; padding: 0 12px; cursor: pointer;}.jimu-widget-search .searchResults .esri-menu{border-radius: 0; color: #686868; font-size: 12px; padding: 0; top: 33px; visibility: visible;}.jimu-widget-search .searchMenu {position: absolute; top: 100%; left: 0; z-index: 1000; display: none; float: left; padding: 5px 0; margin: 2px 0 0; font-size: 14px; line-height: 16px; background-color: #fff; -webkit-background-clip: padding-box; background-clip: padding-box; border: 1px solid #57585A; -webkit-border-radius: 4px; border-radius: 4px; overflow: auto; max-height: 300px;}.jimu-widget-search .searchMenu ul {margin: 0; padding: 0; list-style: none;}.jimu-widget-search .esri-search .esri-menu li.active{background-color: #d9dde0; color: #686868; font-size: 14px;}.jimu-widget-search .esri-search .esri-menu li{padding: 0 12px; line-height: 25px; cursor: pointer;}.jimu-widget-search .esri-search .esri-menu li:hover,.jimu-widget-search .esri-search .esri-menu li:focus {background-color: #eee;}.jimu-widget-search .esri-search .esri-menu .menu-header{background-color: #d9dde0; color: #686868; font-size: 14px; min-height: 30px; padding: 0 12px; line-height: 30px;}",
"*now":function(u){u(['dojo/i18n!*preload*widgets/Search/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","uk","zh-hk","zh-tw","ROOT"]'])}}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/when dojo/on dojo/query dojo/keys dojo/Deferred dojo/promise/all jimu/BaseWidget jimu/utils esri/widgets/Search esri/widgets/Search/SearchViewModel esri/tasks/Locator esri/tasks/support/Query esri/layers/FeatureLayer esri/layers/SceneLayer esri/symbols/PictureMarkerSymbol esri/PopupTemplate ./utils dojo/NodeList-dom".split(" "),function(u,m,p,d,n,g,l,k,e,h,c,a,f,b,x,v,y,q,B,C,t){return u([c],{name:"Search",baseClass:"jimu-widget-search",
searchDijit:null,searchResults:null,_highlightedFeatureHandle:null,postCreate:function(){this.listenWidgetIds.push("framework")},startup:function(){this.inherited(arguments);this.config&&this.config.sources||(this.config.sources=[]);t.setMap(this.sceneView.map);t.setAppConfig(this.appConfig);n(t.getConfigInfo(this.config)).then(m.hitch(this,function(a){return h(this._convertConfig(a)).then(function(a){return p.filter(a,function(a){return a})})})).then(m.hitch(this,function(c){this.domNode&&(c=new b({activeSourceIndex:1===
c.length?0:-1,allPlaceholder:a.stripHTML(this.config.allPlaceholder?this.config.allPlaceholder:window.jimuNls.common.findAddressOrPlace),autoSelect:!0,buttonModeEnabled:!1,labelEnabled:!1,popupEnabled:a.isDefined(this.config.showInfoWindowOnSelect)?!!this.config.showInfoWindowOnSelect:!0,view:this.sceneView,sources:c,theme:"arcgisSearch"}),this.searchDijit=new f({viewModel:c,includeDefaultSources:!1,container:this.searchNode}),this._resetSearchDijitStyle(),this.own(this.searchDijit.viewModel.watch("activeSourceIndex",
m.hitch(this,"_onSourceIndexChange"))),this.own(g(this.searchDijit.viewModel,"select-result",m.hitch(this,"_onSelectResult"))),this.own(g(this.searchDijit.domNode,"click",m.hitch(this,"_onSearchDijitClick"))),this.own(g(this.searchDijit,"suggest-complete",m.hitch(this,"_onSuggestResults"))),this.own(g(this.searchDijit._inputNode,"keyup",m.hitch(this,function(a){a.keyCode!==k.ENTER&&this._onClearSearch()}))),this.own(g(this.searchDijit.viewModel,"search-clear",m.hitch(this,"_onClearSearch"))),this.fetchData("framework"))}))},
_convertConfig:function(b){return p.map(b.sources,m.hitch(this,function(b){var c=new e;if(b&&b.url&&"locator"===b.type)c.resolve({locator:new x(b.url||""),outFields:["*"],singleLineFieldName:b.singleLineFieldName||"",name:a.stripHTML(b.name||""),placeholder:a.stripHTML(b.placeholder||""),highlightSymbol:new B({url:this.folderUrl+"css/images/search-pointer.png",size:36,width:36,height:36,xoffset:9,yoffset:18}),countryCode:b.countryCode||"",maxSuggestions:b.maxSuggestions||6,maxResults:b.maxResults||
6,zoomScale:b.zoomScale||5E4,withinViewEnabled:!!b.searchInCurrentMapExtent});else if(b&&b.url&&"query"===b.type){var d=this._getLayerViewByLayerId(b.layerId),f;f=/\/sceneserver\//gi.test(b.url)?new q({url:b.url||null,outFields:["*"]}):new y({url:b.url||null,outFields:["*"]});f.load().then(m.hitch(this,function(){var e=this._getInfoTemplate(f,b,b.displayField),g=null;b.searchFields&&0<b.searchFields.length?g=b.searchFields:(g=[],p.forEach(f.fields,function(a){"esriFieldTypeOID"!==a.type&&a.name!==
f.objectIdField&&"esriFieldTypeGeometry"!==a.type&&g.push(a.name)}));e={layer:f,outFields:["*"],searchFields:g,displayField:b.displayField||"",exactMatch:!!b.exactMatch,name:a.stripHTML(b.name||""),placeholder:a.stripHTML(b.placeholder||""),maxSuggestions:b.maxSuggestions||6,maxResults:b.maxResults||6,popupTemplate:e||null,zoomScale:b.zoomScale||5E4,withinViewEnabled:!!b.searchInCurrentMapExtent,featureLayerId:b.layerId,featurelayerGeometryType:f.geometryType};d&&(e.resultGraphicEnabled=!1);"scene"===
f.type&&(e.autoNavigate=!1);c.resolve(e)}),m.hitch(this,function(){c.resolve(null)}))}else c.resolve(null);return c}))},_getInfoTemplate:function(b,c){var d,e=[];p.filter(b.fields,function(a){var b=a.name.toLowerCase();0>b.indexOf("shape")&&0>b.indexOf("objectid")&&0>b.indexOf("perimeter")&&e.push(a.name)});(b=a.getDefaultPopupInfo(b,c.name+": {"+c.displayField+"}",e))&&(d=new C({title:b.title,content:[{type:"fields",fieldInfos:b.fieldInfos}]}));return d},destroy:function(){t.setAppConfig(null);var a=
this.sceneView.popup.viewModel;a&&(a.visible=!1);this.searchDijit&&this.searchDijit.viewModel&&(this.searchDijit.viewModel.set("view",null),this.searchDijit.viewModel.clear());this._highlightedFeatureHandle&&this._highlightedFeatureHandle.remove();this.inherited(arguments)},_getLayerViewByLayerId:function(a){return this.sceneView.layerViews.find(m.hitch(this,function(b){return b.layer.id===a}))},_onSelectResult:function(a){var b=a.result;if(b&&b.name){var b=a.result.feature,c=this._getLayerViewByLayerId(a.source.featureLayerId);
if(c){var d=new v;d.where=c.layer.objectIdField+" \x3d "+b.attributes[c.layer.objectIdField];d.outFields=["*"];d.returnGeometry=!0;d.maxAllowableOffset=0;d.outSpatialReference=this.sceneView.spatialReference;c.layer.queryFeatures(d).then(m.hitch(this,function(a){if(a=a.features[0])this._highlightedFeatureHandle&&this._highlightedFeatureHandle.remove(),this._highlightedFeatureHandle=c.highlight(a),"scene"===c.layer.type&&this.sceneView.goTo(a)}))}"point"===a.source.featurelayerGeometryType&&a.source.zoomScale&&
this.sceneView.goTo({scale:a.source.zoomScale})}},_onSearchComplete:function(){},onReceiveData:function(a,b,c){"framework"===a&&"framework"===b&&c&&c.searchString&&(this.searchDijit.viewModel.set("value",c.searchString),this.searchDijit.viewModel.search())},setPosition:function(){this._resetSearchDijitStyle();this.inherited(arguments)},resize:function(){this._resetSearchDijitStyle()},_onSourceIndexChange:function(){this.searchDijit.viewModel.value&&this.searchDijit.viewModel.search(this.searchDijit.viewModel.value)},
_onSuggestResults:function(){var a=0;setTimeout(m.hitch(this,function(){var b=l(".esri-search__suggestions-menu",this.domNode)[0];10<=a++||(b?this._resetSelectorPosition(".esri-search__suggestions-menu"):setTimeout(m.hitch(this,arguments.callee),10))}),10)},_onClearSearch:function(){d.setStyle(this.searchResultsNode,"display","none");this.searchResultsNode.innerHTML="";this.searchResults=null;this.sceneView.popup.close();this._highlightedFeatureHandle&&this._highlightedFeatureHandle.remove()},_onSearchDijitClick:function(){this._resetSelectorPosition(".esri-search__sources-menu");
this._onSuggestResults()},_resetSelectorPosition:function(a){var b=d.getMarginBox(window.jimuConfig.layoutId);l(a,this.domNode).forEach(m.hitch(this,function(a){var c=d.position(a);if("none"!==d.getStyle(a,"display")&&"hidden"!==d.getStyle(a,"visibility")){var e=d.position(this.searchDijit.domNode),f=e.y-2,g=b.h-e.y-e.h;g>c.y+c.h||f>c.h?d.setStyle(a,"top",(g>c.y+c.h?e.h:-c.h-2)+"px"):(d.setStyle(a,"height",Math.max(g,f)+"px"),d.setStyle(a,"top",(g>f?e.h:-f-2)+"px"))}}))},_onSelectSearchResult:function(a){for(a=
a.target;!d.hasAttr(a,"data-source-index")||!d.getAttr(a,"data-index");)a=a.parentNode;var b=null,b=d.getAttr(a,"data-source-index");a=parseInt(d.getAttr(a,"data-index"),10);"all"!==b&&(b=parseInt(b,10));this.searchResults&&this.searchResults[b]&&this.searchResults[b][a]&&(b=this.searchResults[b][a],this.searchDijit.viewModel.select(b))},_hideResultMenu:function(){l(".show-all-results",this.searchResultsNode).style("display","block");l(".searchMenu",this.searchResultsNode).style("display","none")},
_showResultMenu:function(){d.setStyle(this.searchResultsNode,"display","block");l(".show-all-results",this.searchResultsNode).style("display","none");l(".searchMenu",this.searchResultsNode).style("display","block");var a=l(".esri-input-container",this.searchDijit.domNode)[0];if(a){var a=d.getMarginBox(a),b={width:a.w+"px"};if(window.isRTL){var c=d.getMarginBox(this.searchDijit.domNode);b.right=c.w-a.l-a.w+"px"}else b.left=a.l+"px";l(".show-all-results",this.searchResultsNode).style(b);l(".searchMenu",
this.searchResultsNode).style(b)}},_resetSearchDijitStyle:function(){}})});