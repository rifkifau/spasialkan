// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
/*

 Copyright 2000, Silicon Graphics, Inc. All Rights Reserved.
 Copyright 2015, Google Inc. All Rights Reserved.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to
 deal in the Software without restriction, including without limitation the
 rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 sell copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice including the dates of first publication and
 either this permission notice or a reference to http://oss.sgi.com/projects/FreeB/
 shall be included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 SILICON GRAPHICS, INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
 IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

 Original Code. The Original Code is: OpenGL Sample Implementation,
 Version 1.2.1, released January 26, 2000, developed by Silicon Graphics,
 Inc. The Original Code is Copyright (c) 1991-2000 Silicon Graphics, Inc.
 Copyright in any portions created by third parties is as indicated
 elsewhere herein. All Rights Reserved.
*/
require({cache:{"esri/widgets/Legend":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Legend/nls/Legend ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/decorators/cast ./Widget ./Legend/LegendViewModel ./Legend/styles/Card ./Legend/styles/Classic ./support/widget".split(" "),function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,x){return function(k){function t(c){c=k.call(this,
c)||this;c._handles=new q;c.activeLayerInfos=null;c.basemapLegendVisible=!1;c.groundLegendVisible=!1;c.respectLayerVisibility=!0;c.iconClass="esri-icon-layer-list";c.label=a.widgetLabel;c.layerInfos=null;c.style=new g;c.view=null;c.viewModel=new n;return c}h(t,k);t.prototype.postInitialize=function(){var c=this;this.own(m.on(this,"activeLayerInfos","change",function(){return c._refreshActiveLayerInfos(c.activeLayerInfos)}),m.init(this,"style",function(a,g){g&&a!==g&&g.destroy();a&&(a.activeLayerInfos=
c.activeLayerInfos,"card"===a.type&&(a.view=c.view))}))};t.prototype.destroy=function(){this._handles.destroy();this._handles=null};t.prototype.castStyle=function(c){if(c instanceof r||c instanceof g)return c;if("string"===typeof c)return"card"===c?new r:new g;if(c&&"string"===typeof c.type){var a=f({},c);delete a.type;return new ("card"===c.type?r:g)(a)}return new g};t.prototype.render=function(){return this.style.render()};t.prototype._refreshActiveLayerInfos=function(c){var a=this;this._handles.removeAll();
c.forEach(function(c){return a._renderOnActiveLayerInfoChange(c)});this.scheduleRender()};t.prototype._renderOnActiveLayerInfoChange=function(c){var a=this,g=m.init(c,"version",function(){return a.scheduleRender()});this._handles.add(g,"version_"+c.layer.uid);c.children.forEach(function(c){return a._renderOnActiveLayerInfoChange(c)})};e([c.aliasOf("viewModel.activeLayerInfos"),x.renderable()],t.prototype,"activeLayerInfos",void 0);e([c.aliasOf("viewModel.basemapLegendVisible"),x.renderable()],t.prototype,
"basemapLegendVisible",void 0);e([c.aliasOf("viewModel.groundLegendVisible"),x.renderable()],t.prototype,"groundLegendVisible",void 0);e([c.aliasOf("viewModel.respectLayerVisibility"),x.renderable()],t.prototype,"respectLayerVisibility",void 0);e([c.property()],t.prototype,"iconClass",void 0);e([c.property()],t.prototype,"label",void 0);e([c.aliasOf("viewModel.layerInfos"),x.renderable()],t.prototype,"layerInfos",void 0);e([c.property(),x.renderable()],t.prototype,"style",void 0);e([l.cast("style")],
t.prototype,"castStyle",null);e([c.aliasOf("viewModel.view"),x.renderable()],t.prototype,"view",void 0);e([c.property(),x.renderable(["view.size"])],t.prototype,"viewModel",void 0);return t=e([c.subclass("esri.widgets.Legend")],t)}(c.declared(k))})},"esri/widgets/Legend/LegendViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../../views/2d/layers/support/clusterUtils ./support/ActiveLayerInfo".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k){var n=a.ofType(k),r="esri.layers.CSVLayer esri.layers.FeatureLayer esri.layers.HeatmapLayer esri.layers.MapImageLayer esri.layers.PointCloudLayer esri.layers.TileLayer esri.layers.StreamLayer esri.layers.SceneLayer esri.layers.GeoRSSLayer esri.layers.GeoJSONLayer esri.layers.GroupLayer esri.layers.ImageryLayer esri.layers.WMSLayer esri.layers.WMTSLayer esri.layers.TileImageryLayer".split(" "),g=["view.basemapView.baseLayerViews","view.groundView.layerViews","view.layerViews",
"view.basemapView.referenceLayerViews"];return function(a){function t(c){c=a.call(this,c)||this;c._handles=new q;c._layerViewByLayerId={};c._layerInfosByLayerViewId={};c._activeLayerInfosByLayerViewId={};c.activeLayerInfos=new n;c.basemapLegendVisible=!1;c.groundLegendVisible=!1;c.respectLayerVisibility=!0;c.layerInfos=[];c.view=null;return c}f(t,a);t.prototype.initialize=function(){this._handles.add(m.init(this,"view",this._viewHandles),"view")};t.prototype.destroy=function(){this._destroyViewActiveLayerInfos();
this._handles.destroy();this.view=this._handles=null};Object.defineProperty(t.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});t.prototype._viewHandles=function(){this._handles.remove("state");this.view&&this._handles.add(m.init(this,"state",this._stateHandles),"state")};t.prototype._stateHandles=function(){this._resetAll();"ready"===this.state&&this._watchPropertiesAndAllLayerViews()};t.prototype._resetAll=function(){this._handles.remove(["all-layer-views",
"legend-properties"]);this._destroyViewActiveLayerInfos();this.activeLayerInfos.removeAll()};t.prototype._destroyViewActiveLayerInfos=function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)};t.prototype._destroyViewActiveLayerInfo=function(c){this._handles.remove(c);var a=this._activeLayerInfosByLayerViewId[c];delete this._activeLayerInfosByLayerViewId[c];a&&a.parent&&a.parent.children.remove(a)};t.prototype._watchPropertiesAndAllLayerViews=function(){var c=
this.view.allLayerViews;c.length&&this._refresh();this._handles.add(c.on("change",this._allLayerViewsChangeHandle.bind(this)),"all-layer-views");this._handles.add(m.watch(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),"legend-properties")};t.prototype._allLayerViewsChangeHandle=function(c){var a=this;c.removed.forEach(function(c){return a._destroyViewActiveLayerInfo(c.uid)});this._refresh()};t.prototype._propertiesChangeHandle=function(){this._destroyViewActiveLayerInfos();
this._refresh()};t.prototype._refresh=function(){this._layerInfosByLayerViewId={};this.activeLayerInfos.removeAll();this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this);this._sortActiveLayerInfos(this.activeLayerInfos)};t.prototype._sortActiveLayerInfos=function(c){var a=this;if(!(2>c.length)){var g=[];c.forEach(function(k){if(!k.parent){var l=k.layer.parent;(l=(l=l&&"uid"in l&&a._layerViewByLayerId[l.uid])&&
a._activeLayerInfosByLayerViewId[l.uid])&&-1!==c.indexOf(l)&&(g.push(k),k.parent=l,l.children.add(k),a._sortActiveLayerInfos(l.children))}});c.removeMany(g);var k={};this.view.allLayerViews.forEach(function(c,a){return k[c.layer.uid]=a});c.sort(function(c,a){return(k[a.layer.uid]||0)-(k[c.layer.uid]||0)})}};t.prototype._generateLayerViews=function(){var c=[];g.filter(this._filterLayerViews,this).map(this.get,this).filter(function(c){return null!=c}).forEach(this._collectLayerViews("layerViews",c));
return c};t.prototype._filterLayerViews=function(c){var a=!this.groundLegendVisible&&"view.groundView.layerViews"===c;return!(!this.basemapLegendVisible&&("view.basemapView.baseLayerViews"===c||"view.basemapView.referenceLayerViews"===c))&&!a};t.prototype._collectLayerViews=function(c,a){var g=function(k){k&&k.forEach(function(k){a.push(k);g(k[c])});return a};return g};t.prototype._filterLayerViewsByLayerInfos=function(c){var a=this,g=this.layerInfos;return g&&g.length?g.some(function(g){return a._hasLayerInfo(g,
c)}):!0};t.prototype._hasLayerInfo=function(c,a){var g=this._isLayerUIDMatching(c.layer,a.layer.uid);g&&(this._layerInfosByLayerViewId[a.uid]=c);return g};t.prototype._isLayerUIDMatching=function(c,a){return c&&(c.uid===a||this._hasLayerUID(c.layers,a))};t.prototype._hasLayerUID=function(c,a){var g=this;return c&&c.some(function(c){return g._isLayerUIDMatching(c,a)})};t.prototype._isLayerViewSupported=function(c){return-1<r.indexOf(c.layer.declaredClass)?(this._layerViewByLayerId[c.layer.uid]=c,!0):
!1};t.prototype._generateActiveLayerInfo=function(c){var a=this;this._isLayerActive(c)?this._buildActiveLayerInfo(c):(this._handles.remove(c.uid),this._handles.add(m.watch(c,"suspended, layer.legendEnabled",function(){return a._layerActiveHandle(c)}),c.uid))};t.prototype._layerActiveHandle=function(c){this._isLayerActive(c)&&(this._handles.remove(c.uid),this._buildActiveLayerInfo(c))};t.prototype._isLayerActive=function(c){return this.respectLayerVisibility?!c.suspended&&c.get("layer.legendEnabled"):
!0};t.prototype._buildActiveLayerInfo=function(c){var a=this,g=c.layer,l=c.uid,n=this._layerInfosByLayerViewId[l],t=this._activeLayerInfosByLayerViewId[l];t||(t=new k({layer:g,title:n&&void 0!==n.title?n.title:g.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,sublayerIds:n&&n.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[l]=t);t.parent||(n=(n=g.parent)&&this._layerViewByLayerId[n.uid],t.parent=n&&this._activeLayerInfosByLayerViewId[n.uid]);if(!this._handles.has(l)){var n=
m.watch(g,"title",function(g){return a._titleHandle(g,t,c)}),r=m.watch(g,"renderer?, opacity",function(){return a._constructLegendElements(t,c)}),e=m.whenTrue(this.view,"stationary",function(){return a._scaleHandle(t,c)}),b=m.watch(c,"_effectiveRenderer",function(){return a._constructLegendElements(t,c)}),n=[n,r,e,b];this.respectLayerVisibility&&(r=m.watch(c,"suspended",function(g){return a._suspendedHandle(g,t,c)}),g=m.watch(g,"legendEnabled",function(g){return a._legendEnabledHandle(g,t,c)}),n.push(r,
g));this._handles.add(n,l)}t.isScaleDriven||this._constructLegendElements(t,c);this._addActiveLayerInfo(t,c)};t.prototype._titleHandle=function(c,a,g){a.title=c;this._constructLegendElements(a,g)};t.prototype._legendEnabledHandle=function(c,a,g){c?this._addActiveLayerInfo(a,g):this._removeActiveLayerInfo(a)};t.prototype._suspendedHandle=function(c,a,g){c?this._removeActiveLayerInfo(a):this._addActiveLayerInfo(a,g)};t.prototype._scaleHandle=function(c,a){c.isScaleDriven&&this._constructLegendElements(c,
a)};t.prototype._addActiveLayerInfo=function(c,a){this._isLayerActive(a)&&-1===this.activeLayerInfos.indexOf(c)&&((a=c.parent)?(-1===a.children.indexOf(c)&&a.children.push(c),this._sortActiveLayerInfos(a.children)):(this.activeLayerInfos.add(c),this._sortActiveLayerInfos(this.activeLayerInfos)))};t.prototype._removeActiveLayerInfo=function(c){var a=c.parent;a?a.children.remove(c):this.activeLayerInfos.remove(c)};t.prototype._constructLegendElements=function(c,a){var g=a.layer;g.featureCollections?
c.buildLegendElementsForFeatureCollections(g.featureCollections):g.renderer?c.buildLegendElementsForRenderer(g.renderer):g.url&&c.buildLegendElementsForTools();if(g.featureReduction&&"cluster"===g.featureReduction.type){a=a._effectiveRenderer;var k=(g=g.renderer.clone())&&"visualVariables"in g&&g.visualVariables||[];if(!(a&&"visualVariables"in a&&a.visualVariables))return null;a=l.findSizeVV(a.visualVariables);l.getActiveSizeStops(this.view,a)&&(g.visualVariables=k.concat([a]),c.buildLegendElementsForRenderer(g))}};
h([c.property({type:n})],t.prototype,"activeLayerInfos",void 0);h([c.property()],t.prototype,"basemapLegendVisible",void 0);h([c.property()],t.prototype,"groundLegendVisible",void 0);h([c.property()],t.prototype,"respectLayerVisibility",void 0);h([c.property()],t.prototype,"layerInfos",void 0);h([c.property({dependsOn:["view.ready"],readOnly:!0})],t.prototype,"state",null);h([c.property()],t.prototype,"view",void 0);return t=h([c.subclass("esri.widgets.Legend.LegendViewModel")],t)}(c.declared(e))})},
"esri/views/2d/layers/support/clusterUtils":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/MD5 ../../../../renderers/visualVariables/SizeVariable ../../../../renderers/visualVariables/support/SizeStop ../../engine".split(" "),function(b,d,f,h,e,a,q,m,c,l,k,n,r){function g(c,a,g){switch(c){case "avg":case "avg_angle":return"cluster_avg_"+
a;case "mode":return"cluster_type_"+a;case "norm":return c=a.toLowerCase()+",norm:field,"+g.toLowerCase(),"cluster_avg_"+l.createMD5Hash(c)}}function x(c,a,g){var k=l.createMD5Hash(a),n="mode"===g?"cluster_type_"+k:"cluster_avg_"+k;c.some(function(c){return c.name===n})||c.push({name:n,outStatistic:{onStatisticField:k,onStatisticValueExpression:a,statisticType:g}});return n}function t(c,a,k,l){var n=g(k,a,l);c.some(function(c){return c.name===n})||("norm"===k?c.push({name:n,outStatistic:{onStatisticField:a,
onStatisticNormalizationField:l,statisticType:k}}):c.push({name:n,outStatistic:{onStatisticField:a,statisticType:k}}));return n}var u=this;Object.defineProperty(d,"__esModule",{value:!0});var y=m.getLogger("esri.views.2d.layers.support.clusterUtils");q.add("esri-cluster-arcade-enabled",1);var A=q("esri-cluster-arcade-enabled");d.createClusterRenderer=function(a,g,k,l,n){return h(u,void 0,void 0,function(){var g,r,m;return f(this,function(e){g=k.clone();if(!d.isClusterCompatibleRenderer(g))return[2,
g];r="visualVariables"in g&&g.visualVariables||[];m=d.findSizeVV(r);r.forEach(function(c){"rotation"===c.type?c.field?c.field=t(a,c.field,"avg_angle"):c.valueExpression&&(c.field=x(a,c.valueExpression,"avg_angle"),c.valueExpression=null):c.normalizationField?(c.field=t(a,c.field,"norm",c.normalizationField),c.normalizationField=null):c.field?c.field=t(a,c.field,"avg"):(c.field=x(a,c.valueExpression,"avg"),c.valueExpression=null)});c.isNone(m)&&r.push(d.createClusterCountSizeVariable(l,n));switch(g.type){case "unique-value":g.field?
g.field=t(a,g.field,"mode"):g.valueExpression&&(g.field=x(a,g.valueExpression,"mode"),g.valueExpression=null);break;case "class-breaks":g.normalizationField?(g.field=t(a,g.field,"norm",g.normalizationField),g.normalizationField=null):g.field?g.field=t(a,g.field,"avg"):(g.field=x(a,g.valueExpression,"avg"),g.valueExpression=null)}g.visualVariables=r;return[2,g]})})};d.findSizeVV=function(c){for(var a=0;a<c.length;a++){var g=c[a];if("size"===g.type)return g}return null};d.getActiveSizeStops=function(c,
a){c=c.featuresTilingScheme.getClosestInfoForScale(c.scale).level;return a.levels?a.levels[c]:null};d.createClusterCountSizeVariable=function(a,g){var l=[new n({value:0,size:0}),new n({value:1})];if(c.isNone(g))return new k({field:"cluster_count",stops:l.concat([new n({value:2,size:0})])});a=Object.keys(g).reduce(function(c,a){var k;return e({},c,(k={},k[a]=l.concat([new n({value:Math.max(2,g[a].minValue),size:"12px"}),new n({value:Math.max(3,g[a].maxValue),size:"50px"})]),k))},{});return new r.LevelDependentSizeVariable({field:"cluster_count",
levels:a})};d.isClusterCompatibleRenderer=function(c){var g=function(g){return y.error(new a("Unsupported-renderer",g,{renderer:c}))};if("unique-value"===c.type){if(c.field2||c.field3)return g("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1}else if("class-breaks"===c.type){if(c.normalizationField){var k=c.normalizationType;if("field"!==k)return g("FeatureReductionCluster does not support a normalizationType of "+k),!1}}else if("simple"!==c.type)return g("FeatureReductionCluster does not support renderers of type "+
c.type),!1;if(!A){if("valueExpression"in c&&c.valueExpression)return g("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in c&&c.visualVariables||[]).some(function(c){return!!("valueExpression"in c&&c.valueExpression)}))return g("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0}})},"esri/core/MD5":function(){define(["require",
"exports"],function(b,d){function f(a,c){var l=(a&65535)+(c&65535);return(a>>16)+(c>>16)+(l>>16)<<16|l&65535}function h(a,c,l,k,n,r){a=f(f(c,a),f(k,r));return f(a<<n|a>>>32-n,l)}function e(a,c,l,k,n,r,g){return h(c&l|~c&k,a,c,n,r,g)}function a(a,c,l,k,n,r,g){return h(c&k|l&~k,a,c,n,r,g)}function q(a,c,l,k,n,r,g){return h(l^(c|~k),a,c,n,r,g)}Object.defineProperty(d,"__esModule",{value:!0});d.outputTypes={Base64:0,Hex:1,String:2,Raw:3};d.createMD5Hash=function(m,c){void 0===c&&(c=d.outputTypes.Hex);
c=c||d.outputTypes.Base64;for(var l=[],k=0,n=8*m.length;k<n;k+=8)l[k>>5]|=(m.charCodeAt(k/8)&255)<<k%32;m=8*m.length;l[m>>5]|=128<<m%32;l[(m+64>>>9<<4)+14]=m;m=1732584193;for(var k=-271733879,n=-1732584194,r=271733878,g=0;g<l.length;g+=16){var b=m,t=k,u=n,y=r;m=e(m,k,n,r,l[g+0],7,-680876936);r=e(r,m,k,n,l[g+1],12,-389564586);n=e(n,r,m,k,l[g+2],17,606105819);k=e(k,n,r,m,l[g+3],22,-1044525330);m=e(m,k,n,r,l[g+4],7,-176418897);r=e(r,m,k,n,l[g+5],12,1200080426);n=e(n,r,m,k,l[g+6],17,-1473231341);k=e(k,
n,r,m,l[g+7],22,-45705983);m=e(m,k,n,r,l[g+8],7,1770035416);r=e(r,m,k,n,l[g+9],12,-1958414417);n=e(n,r,m,k,l[g+10],17,-42063);k=e(k,n,r,m,l[g+11],22,-1990404162);m=e(m,k,n,r,l[g+12],7,1804603682);r=e(r,m,k,n,l[g+13],12,-40341101);n=e(n,r,m,k,l[g+14],17,-1502002290);k=e(k,n,r,m,l[g+15],22,1236535329);m=a(m,k,n,r,l[g+1],5,-165796510);r=a(r,m,k,n,l[g+6],9,-1069501632);n=a(n,r,m,k,l[g+11],14,643717713);k=a(k,n,r,m,l[g+0],20,-373897302);m=a(m,k,n,r,l[g+5],5,-701558691);r=a(r,m,k,n,l[g+10],9,38016083);
n=a(n,r,m,k,l[g+15],14,-660478335);k=a(k,n,r,m,l[g+4],20,-405537848);m=a(m,k,n,r,l[g+9],5,568446438);r=a(r,m,k,n,l[g+14],9,-1019803690);n=a(n,r,m,k,l[g+3],14,-187363961);k=a(k,n,r,m,l[g+8],20,1163531501);m=a(m,k,n,r,l[g+13],5,-1444681467);r=a(r,m,k,n,l[g+2],9,-51403784);n=a(n,r,m,k,l[g+7],14,1735328473);k=a(k,n,r,m,l[g+12],20,-1926607734);m=h(k^n^r,m,k,l[g+5],4,-378558);r=h(m^k^n,r,m,l[g+8],11,-2022574463);n=h(r^m^k,n,r,l[g+11],16,1839030562);k=h(n^r^m,k,n,l[g+14],23,-35309556);m=h(k^n^r,m,k,l[g+
1],4,-1530992060);r=h(m^k^n,r,m,l[g+4],11,1272893353);n=h(r^m^k,n,r,l[g+7],16,-155497632);k=h(n^r^m,k,n,l[g+10],23,-1094730640);m=h(k^n^r,m,k,l[g+13],4,681279174);r=h(m^k^n,r,m,l[g+0],11,-358537222);n=h(r^m^k,n,r,l[g+3],16,-722521979);k=h(n^r^m,k,n,l[g+6],23,76029189);m=h(k^n^r,m,k,l[g+9],4,-640364487);r=h(m^k^n,r,m,l[g+12],11,-421815835);n=h(r^m^k,n,r,l[g+15],16,530742520);k=h(n^r^m,k,n,l[g+2],23,-995338651);m=q(m,k,n,r,l[g+0],6,-198630844);r=q(r,m,k,n,l[g+7],10,1126891415);n=q(n,r,m,k,l[g+14],15,
-1416354905);k=q(k,n,r,m,l[g+5],21,-57434055);m=q(m,k,n,r,l[g+12],6,1700485571);r=q(r,m,k,n,l[g+3],10,-1894986606);n=q(n,r,m,k,l[g+10],15,-1051523);k=q(k,n,r,m,l[g+1],21,-2054922799);m=q(m,k,n,r,l[g+8],6,1873313359);r=q(r,m,k,n,l[g+15],10,-30611744);n=q(n,r,m,k,l[g+6],15,-1560198380);k=q(k,n,r,m,l[g+13],21,1309151649);m=q(m,k,n,r,l[g+4],6,-145523070);r=q(r,m,k,n,l[g+11],10,-1120210379);n=q(n,r,m,k,l[g+2],15,718787259);k=q(k,n,r,m,l[g+9],21,-343485551);m=f(m,b);k=f(k,t);n=f(n,u);r=f(r,y)}l=[m,k,n,
r];switch(c){case d.outputTypes.Raw:return l;case d.outputTypes.Hex:c=[];m=0;for(k=4*l.length;m<k;m++)c.push("0123456789abcdef".charAt(l[m>>2]>>m%4*8+4&15)+"0123456789abcdef".charAt(l[m>>2]>>m%4*8&15));return c.join("");case d.outputTypes.String:c=[];m=0;for(k=32*l.length;m<k;m+=8)c.push(String.fromCharCode(l[m>>5]>>>m%32&255));return c.join("");case d.outputTypes.Base64:c=[];m=0;for(k=4*l.length;m<k;m+=3)for(n=(l[m>>2]>>m%4*8&255)<<16|(l[m+1>>2]>>(m+1)%4*8&255)<<8|l[m+2>>2]>>(m+2)%4*8&255,r=0;4>
r;r++)8*m+6*r>32*l.length?c.push("\x3d"):c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>6*(3-r)&63));return c.join("")}}})},"esri/views/2d/engine":function(){define("require exports ./engine/Bitmap ./engine/BitmapContainer ./engine/BitmapTile ./engine/Container ./engine/webgl/TileContainer ./engine/DisplayObject ./engine/RasterTile ./engine/RasterTileContainer ./engine/Stage ./engine/webgl/AttributeStoreView ./engine/webgl/collisions/CollisionGrid ./engine/webgl/collisions/CollisionEngine ./engine/webgl/collisions/LayerViewSorter ./engine/webgl/Geometry ./engine/webgl/alignmentUtils ./engine/webgl/color ./engine/webgl/definitions ./engine/webgl/enums ./engine/webgl/fontUtils ./engine/webgl/Utils ./engine/webgl/brushes/BrushBitmap ./engine/webgl/brushes/BrushClip ./engine/webgl/brushes/BrushRasterBitmap ./engine/webgl/brushes/WGLBrushInfo ./engine/webgl/brushes/WGLBrushStencil ./engine/webgl/brushes/WGLBrushVTLBackground ./engine/webgl/brushes/WGLBrushVTLCircle ./engine/webgl/brushes/WGLBrushVTLFill ./engine/webgl/brushes/WGLBrushVTLLine ./engine/webgl/brushes/WGLBrushVTLSymbol ./engine/webgl/brushes/WGLGeometryBrush ./engine/webgl/brushes/WGLGeometryBrushFill ./engine/webgl/brushes/WGLGeometryBrushLabel ./engine/webgl/brushes/WGLGeometryBrushLine ./engine/webgl/brushes/WGLGeometryBrushMarker ./engine/webgl/brushes/WGLGeometryBrushText ./engine/webgl/util/debug ./engine/webgl/mesh/templates/shapingUtils ./engine/webgl/TileClipper ./engine/webgl/TurboLine ./engine/webgl/mesh/factories/matcherUtils ./engine/webgl/mesh/factories/WGLMeshFactory ./engine/webgl/mesh/MeshData ./engine/webgl/mesh/templates/WGLTemplateStore ./engine/webgl/Painter ./engine/webgl/TileData ./engine/webgl/util/BidiText ./engine/webgl/util/Matcher ./engine/webgl/util/vvFlagUtils ./engine/webgl/visualVariablesUtils ./engine/webgl/WGLRendererInfo ./engine/webgl/WGLTile ./engine/webgl/BitBlitRenderer ./engine/webgl/shaders/MagnifierPrograms ../../symbols/cim/CIMSymbolHelper ./engine/webgl/Rect ./engine/webgl/mesh/templates/util ./engine/webgl/painter/RenderPass ./engine/webgl/TiledDisplayObject ./engine/BitmapTileContainer ./engine/LevelDependentSizeVariable".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,x,t,u,y,A,p,w,v,z,B,C,D,G,F,E,H,J,K,I,M,N,L,Q,P,U,T,S,R,O,V,X,Z,aa,W,Y,ca,ba,ia,ja,ka,la,ea,ma,na,oa,pa,qa,ra,sa){Object.defineProperty(d,"__esModule",{value:!0});d.Bitmap=f.Bitmap;d.BitmapContainer=h.BitmapContainer;d.BitmapTile=e.BitmapTile;d.Container=a.Container;d.TileContainer=q.default;d.DisplayObject=m.DisplayObject;d.RasterTile=c.RasterTile;d.RasterTileContainer=l.RasterTileContainer;d.Stage=k.Stage;d.AttributeStoreView=n.AttributeStoreView;d.CollisionGrid=
r.CollisionGrid;d.CollisionEngine=g.CollisionEngine;d.LayerViewSorter=x.LayerViewSorter;d.Point=t.Point;d.alignmentUtils=u;d.color=y;d.definitions=A;d.enums=p;d.fontUtils=w;d.Utils=v;d.debug=U;d.ShapedGlyph=T.ShapedGlyph;d.shapeGlyphs=T.shapeGlyphs;d.ShapingInfo=T.ShapingInfo;d.TileClipper=S.TileClipper;d.SimpleBuilder=S.SimpleBuilder;d.tessellate=R.tessellate;d.TessellationState=R.TessellationState;d.splitVertex=R.splitVertex;d.createMatcher=O.createMatcher;d.WGLMeshFactory=V.WGLMeshFactory;d.MeshData=
X.MeshData;d.WGLTemplateStore=Z.WGLTemplateStore;d.Painter=aa.default;d.PainterOptions=aa.PainterOptions;d.TileData=W.TileData;d.bidiText=Y.bidiText;d.FeatureMatcher=ca.FeatureMatcher;d.getVVFlags=ba.getVVFlags;d.getTypeOfSizeVisualVariable=ia.getTypeOfSizeVisualVariable;d.WGLRendererInfo=ja.WGLRendererInfo;d.WGLTile=ka.WGLTile;d.BitBlitRenderer=la.BitBlitRenderer;d.createMagnifierProgram=ea.createMagnifierProgram;d.magnifier=ea.magnifier;d.CIMSymbolHelper=ma.CIMSymbolHelper;d.Rect=na.default;d.getLimitCosine=
oa.getLimitCosine;b=d.brushes||(d.brushes={});b.Geometry=I.default;b.Marker=Q.default;b.Line=L.default;b.Fill=M.default;b.Text=P.default;b.Label=N.default;b.Clip=B.default;b.Stencil=G.default;b.Bitmap=z.default;b.Raster=C.default;b.TileInfo=D.default;b.VTLBackground=F.WGLBrushVTLBackground;b.VTLFill=H.WGLBrushVTLFill;b.VTLLine=J.WGLBrushVTLLine;b.VTLCircle=E.WGLBrushVTLCircle;b.VTLSymbol=K.WGLBrushVTLSymbol;d.RenderPass=pa.default;d.TiledDisplayObject=qa.TiledDisplayObject;d.BitmapTileContainer=ra.BitmapTileContainer;
d.LevelDependentSizeVariable=sa.LevelDependentSizeVariable})},"esri/views/2d/engine/Bitmap":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/vec2f32 ../../webgl ./DisplayObject ./ImageryBitmapSource".split(" "),function(b,d,f,h,e,a,q,m,c){function l(c){var a=document.createElement("canvas");a.width=c.width;a.height=c.height;c.render(a.getContext("2d"));return a}function k(c,
a,g){var k={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};a&&g&&(k.width=a,k.height=g);return new q.Texture(c,k)}function n(c){g.has(c)&&(r.splice(r.indexOf(c),1),g.delete(c))}Object.defineProperty(d,"__esModule",{value:!0});var r=[],g=new Set;b=function(g){function t(c,a){void 0===c&&(c=null);void 0===a&&(a=function(){return null});var k=g.call(this)||this;k.stencilRef=0;k.coordScale=[1,1];k._height=void 0;k.pixelRatio=1;k.resolution=0;k.rotation=0;k._source=null;
k._width=void 0;k.x=0;k.y=0;k.transforms={dvs:e.mat3f32.create()};k.source=c;k.requestRender=a;return k}f(t,g);Object.defineProperty(t.prototype,"isSourceScaled",{get:function(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"height",{get:function(){return void 0!==this._height?this._height:this.sourceHeight},set:function(c){this._height=c},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"source",
{get:function(){return this._source},set:function(c){this._source=c;this.invalidateTexture()},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"sourceHeight",{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"sourceWidth",{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width},enumerable:!0,configurable:!0});
Object.defineProperty(t.prototype,"width",{get:function(){return void 0!==this._width?this._width:this.sourceWidth},set:function(c){this._width=c},enumerable:!0,configurable:!0});t.prototype.attach=function(){this.updateTexture();return!0};t.prototype.detach=function(){this._texture.dispose();this._texture=null;n(this)};t.prototype.invalidateTexture=function(){this.attached?this.updateTexture():n(this)};t.prototype.setTransform=function(c){var g=h.mat3.identity(this.transforms.dvs),k=c.toScreenNoRotation([0,
0],this.x,this.y),l=this.resolution/this.pixelRatio/c.resolution,n=l*this.width,l=l*this.height,t=Math.PI*this.rotation/180;h.mat3.translate(g,g,a.vec2f32.fromValues(k[0],k[1]));h.mat3.translate(g,g,a.vec2f32.fromValues(n/2,l/2));h.mat3.rotate(g,g,-t);h.mat3.translate(g,g,a.vec2f32.fromValues(-n/2,-l/2));h.mat3.scaleByVec2(g,g,a.vec2f32.fromValues(n,l));h.mat3.multiply(this.transforms.dvs,c.displayViewMat3,g)};t.prototype.updateTexture=function(){this._texture||(this._texture=this.source?k(this.stage.context,
this.sourceWidth,this.sourceHeight):k(this.stage.context));var a=this.source;a?(this._texture.resize(this.sourceWidth,this.sourceHeight),a&&"render"in a?a instanceof c.default?(a=a.getRenderedRasterPixels(),this._texture.setData(a.renderedRasterPixels)):this._texture.setData(l(a)):!a||"render"in a||this._texture.setData(a),this.ready(),this.requestRender()):this._texture.setData(null)};t.prototype.setSamplingProfile=function(c){this._texture&&(c.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),
this._texture.setSamplingMode(c.samplingMode))};t.prototype.bind=function(c){this._texture&&this.stage.context.bindTexture(this._texture,c)};return t}(m.DisplayObject);d.Bitmap=b})},"esri/views/2d/engine/ImageryBitmapSource":function(){define(["require","exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(b,e,a){this.pixelBlock=b;this.extent=e;this.originalPixelBlock=a}Object.defineProperty(b.prototype,"width",{get:function(){return this.pixelBlock?this.pixelBlock.width:
0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this.pixelBlock?this.pixelBlock.height:0},enumerable:!0,configurable:!0});b.prototype.render=function(b){var e=this.pixelBlock;if(e){var a=this.filter({pixelBlock:e}),e=a.pixelBlock.getAsRGBA(),a=b.createImageData(a.pixelBlock.width,a.pixelBlock.height);a.data.set(e);b.putImageData(a,0,0)}};b.prototype.getRenderedRasterPixels=function(){var b=this.filter({pixelBlock:this.pixelBlock});return{width:b.pixelBlock.width,
height:b.pixelBlock.height,renderedRasterPixels:new Uint8Array(b.pixelBlock.getAsRGBA().buffer)}};return b}();d.default=b})},"esri/views/2d/engine/BitmapContainer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../engine ./webgl/WGLContainer".split(" "),function(b,d,f,h,e,a){Object.defineProperty(d,"__esModule",{value:!0});b=function(a){function m(){return null!==a&&a.apply(this,arguments)||this}f(m,a);m.prototype.prepareRenderPasses=
function(c){var l=this,k=c.registerRenderPass({name:"bitmap",brushes:[e.brushes.Bitmap],target:function(){return l.children}});return a.prototype.prepareRenderPasses.call(this,c).concat([k])};return m}(a.default);d.BitmapContainer=b})},"esri/views/2d/engine/webgl/WGLContainer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../engine ../Container ./ClippingInfo ./enums".split(" "),function(b,d,f,h,e,a,q,
m,c){Object.defineProperty(d,"__esModule",{value:!0});b=function(l){function k(c){var a=l.call(this)||this;a.name=a.constructor.name;a._lastTime=null;a.setClips(c);return a}f(k,l);k.prototype.setClips=function(c){var a=this;e.isSome(this._clippingInfos)&&(this._clippingInfos.forEach(function(c){return c.destroy()}),this._clippingInfos=null);e.isSome(c)&&c.length&&(this._clippingInfos=c.items.map(function(c){return m.default.fromClipArea(a,c)}));this.requestRender()};k.prototype.doRender=function(a){this.attachChildren();
this.detachChildren();var k=this.createRenderParams(a),g=k.context,l=k.painter,n=k.globalOpacity,m=k.profiler,n=k.drawPhase===c.WGLDrawPhase.LABEL?1:n*this.opacity;m.recordContainerStart(this.name);l.beforeRenderLayer(g,this._clippingInfos?255:0,n);this.updateTransforms(a.state);this.renderChildren(k);l.compositeLayer(g,n);m.recordContainerEnd()};k.prototype.renderChildren=function(c){e.isNone(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(this.stage.painter));for(var a=0,g=this._renderPasses;a<
g.length;a++)g[a].render(c)};k.prototype.createRenderParams=function(c){var a=Date.now(),g=(e.isSome(this._lastTime)?a-this._lastTime:0)/1E3;this._lastTime=a;return h({},c,{context:this.stage.context,painter:this.stage.painter,profiler:this.stage.profiler,renderingOptions:this.stage.renderingOptions,driverTestResult:this.stage.driverTestResult,timeDelta:g,timeline:this.stage.timeline})};k.prototype.prepareRenderPasses=function(k){var l=this;return[k.registerRenderPass({name:"clip",brushes:[a.brushes.Clip],
target:function(){return l._clippingInfos},drawPhase:c.WGLDrawPhase.MAP|c.WGLDrawPhase.LABEL|c.WGLDrawPhase.LABEL_ALPHA|c.WGLDrawPhase.DEBUG})]};k.prototype.updateTransforms=function(c){for(var a=0,g=this.children;a<g.length;a++)g[a].setTransform(c)};return k}(q.Container);d.default=b})},"esri/views/2d/engine/Container":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./DisplayObject"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});b=function(e){function a(){var a=
null!==e&&e.apply(this,arguments)||this;a._childrenSet=new Set;a._childrenToAttach=[];a._childrenToDetach=[];a.children=[];return a}f(a,e);Object.defineProperty(a.prototype,"numChildren",{get:function(){return this.children.length},enumerable:!0,configurable:!0});a.prototype.detach=function(){for(var a=0,m=this.children.concat(this._childrenToDetach);a<m.length;a++){var c=m[a];c.attached&&(this.detachChild(c),c.attached=!1,c.parent=null)}};a.prototype.doRender=function(a){var m=a.globalOpacity;a.globalOpacity*=
this.opacity;this.attachChildren();this.detachChildren();this.renderChildren(a);a.globalOpacity=m};a.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)};a.prototype.addChildAt=function(a,m){void 0===m&&(m=this.numChildren);if(!a||this.contains(a))return a;var c=a.parent;c&&c!==this&&c.removeChild(a);m>=this.numChildren?this.children.push(a):this.children.splice(m,0,a);this._childrenSet.add(a);m=this._childrenToDetach.indexOf(a);-1<m&&this._childrenToDetach.splice(m,1);this._childrenToAttach.push(a);
this.requestRender();return a};a.prototype.contains=function(a){return this._childrenSet.has(a)};a.prototype.getChildIndex=function(a){return this.children.indexOf(a)};a.prototype.getChildAt=function(a){return 0>a||a>this.children.length?null:this.children[a]};a.prototype.removeAllChildren=function(){for(var a=this.numChildren;a--;)this.removeChildAt(0)};a.prototype.removeChild=function(a){return this.contains(a)?this.removeChildAt(this.getChildIndex(a)):a};a.prototype.removeChildAt=function(a){if(0>
a||a>=this.children.length)return null;a=this.children.splice(a,1)[0];this._childrenSet["delete"](a);if(a.attached)this._childrenToDetach.push(a);else{var m=this._childrenToAttach.indexOf(a);-1<m&&this._childrenToAttach.splice(m,1)}return a};a.prototype.setChildIndex=function(a,m){var c=this.getChildIndex(a);-1<c&&(this.children.splice(c,1),this.children.splice(m,0,a))};a.prototype.sortChildren=function(a){return this.children.sort(a)};a.prototype.attachChildren=function(){var a=this._childrenToAttach;
if(0!==a.length)for(var m=0,c=!1;!c;)c=a[m],c.parent=this,c.stage=this.stage,this.attachChild(c)?(c.attached=!0,a.splice(m,1)):++m,c=a.length===m};a.prototype.detachChildren=function(){for(var a=this._childrenToDetach;0<a.length;){var m=a.shift();this.detachChild(m);m.attached=!1;m.parent=null;m.stage=null}};a.prototype.renderChildren=function(a){for(var m=this.children,c=m.length,l=0;l<c;l++)m[l].processRender(a)};a.prototype.attachChild=function(a){return a.attach()};a.prototype.detachChild=function(a){a.detach()};
return a}(h.DisplayObject);d.Container=b})},"esri/views/2d/engine/webgl/ClippingInfo":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../DisplayObject ./Mesh2D ../../../webgl/VertexArrayObject".split(" "),function(b,d,f,h,e,a,q,m,c){Object.defineProperty(d,"__esModule",{value:!0});var l=e.getLogger("esri.views.2d.engine.webgl.ClippingInfo");b=function(k){function n(c,a){var g=k.call(this)||this;g._cache=
{};g.parent=c;g._handle=a.watch("version",function(){return g._invalidate()});g._clip=a;g.attach();g.attached=!0;return g}f(n,k);n.fromClipArea=function(c,a){return new n(c,a)};n.prototype._destroyGL=function(){a.isSome(this._cache.mesh)&&(this._cache.mesh.destroy(),this._cache.mesh=null);a.isSome(this._cache.vao)&&(this._cache.vao.dispose(),this._cache.vao=null)};n.prototype.destroy=function(){this._destroyGL();this._handle.remove()};n.prototype.doRender=function(){};n.prototype.getVAO=function(k,
g,l,n){var t=g.size,m=t[0],t=t[1];if("geometry"===this._clip.type||this._lastWidth!==m||this._lastHeight!==t)this._lastWidth=m,this._lastHeight=t,this._destroyGL();a.isNone(this._cache.vao)&&(g=this._createMesh(g,this._clip),m=g.getIndexBuffer(k),t=g.getVertexBuffers(k),this._cache.mesh=g,this._cache.vao=new c(k,l,n,t,m));return this._cache.vao};n.prototype._invalidate=function(){this._destroyGL();this.requestRender()};n.prototype._createScreenRect=function(c,a){var g=c.size;c=g[0];var g=g[1],k="string"===
typeof a.left?parseFloat(a.left)/100*c:a.left,l="string"===typeof a.right?parseFloat(a.right)/100*c:a.right,n="string"===typeof a.top?parseFloat(a.top)/100*g:a.top;a="string"===typeof a.bottom?parseFloat(a.bottom)/100*g:a.bottom;return{x:k,y:n,width:Math.max(c-l-k,0),height:Math.max(g-a-n,0)}};n.prototype._createMesh=function(c,a){switch(a.type){case "rect":return m.default.fromRect(this._createScreenRect(c,a));case "path":return m.default.fromPath(a);case "geometry":return m.default.fromGeometry(c,
a);default:return l.error(new h("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),m.default.fromRect({x:0,y:0,width:1,height:1})}};return n}(q.DisplayObject);d.default=b})},"esri/views/2d/engine/webgl/Mesh2D":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedGeometry ./number ../../../webgl/BufferObject".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r){Object.defineProperty(d,"__esModule",{value:!0});var g=e.getLogger("esri.views.2d.engine.webgl.Mesh2D"),x=function(c,a){var g=c.coords;c=c.lengths;for(var k=[],l=0,n=0;l<c.length;n+=c[l],l+=1){for(var t=n,m=[];l<c.length-1;l+=1,n+=c[l]){for(var e=n+c[l],r=0,b=1;b<c[l+1];b++)r+=(g[2*(e+b)]-g[2*(e+b-1)])*(g[2*(e+b)+1]+g[2*(e+b-1)+1]);if(!(a?0<r:0>r))break;m.push(n+c[l]-t)}r=g.slice(2*t,2*(n+c[l]));e=0;for(m=q.earcut(r,m,2);e<m.length;e++)k.push(m[e]+t)}return k};
b=function(){function t(c,a,g,k){void 0===k&&(k=!1);this._cache={};this.vertices=c;this.indices=a;this.primitiveType=g;this.isMapSpace=k}t.fromRect=function(c){var a=c.x,g=c.y;return t.fromScreenExtent({xmin:a,ymin:g,xmax:a+c.width,ymax:g+c.height})};t.fromPath=function(c){var a=l.convertFromNestedArray(new k.default,c.path,!1,!1);c=a.coords;for(var a=new Uint32Array(x(a,!0)),g=new Uint32Array(c.length/2),m=0;m<g.length;m++)g[m]=n.i1616to32(Math.floor(c[2*m]),Math.floor(c[2*m+1]));return new t({geometry:g},
a,4)};t.fromGeometry=function(c,a){var k=a.geometry.type;switch(k){case "polygon":return t.fromPolygon(c,a.geometry);case "extent":return t.fromMapExtent(c,a.geometry);default:return g.error(new h("mapview-bad-type","Unable to create a mesh from type "+k,a)),t.fromRect({x:0,y:0,width:1,height:1})}};t.fromPolygon=function(a,g){var e=l.convertFromPolygon(new k.default,g,!1,!1);g=e.coords;for(var e=new Uint32Array(x(e,!1)),r=new Uint32Array(g.length/2),b=c.vec2f64.create(),d=c.vec2f64.create(),f=0;f<
r.length;f++)m.vec2.set(b,g[2*f],g[2*f+1]),a.toScreen(d,b),r[f]=n.i1616to32(Math.floor(d[0]),Math.floor(d[1]));return new t({geometry:r},e,4,!0)};t.fromScreenExtent=function(c){var a=c.xmin,g=c.xmax,k=c.ymin;c=c.ymax;a={geometry:new Uint32Array([n.i1616to32(a,k),n.i1616to32(g,k),n.i1616to32(a,c),n.i1616to32(a,c),n.i1616to32(g,k),n.i1616to32(g,c)])};g=new Uint32Array([0,1,2,3,4,5]);return new t(a,g,4)};t.fromMapExtent=function(c,a){var g=c.toScreen([0,0],[a.xmin,a.ymin]),k=g[0],g=g[1];a=c.toScreen([0,
0],[a.xmax,a.ymax]);c=a[0];a=a[1];k={geometry:new Uint32Array([n.i1616to32(k,g),n.i1616to32(c,g),n.i1616to32(k,a),n.i1616to32(k,a),n.i1616to32(c,g),n.i1616to32(c,a)])};g=new Uint32Array([0,1,2,3,4,5]);return new t(k,g,4)};t.prototype.destroy=function(){a.isSome(this._cache.indexBuffer)&&this._cache.indexBuffer.dispose();for(var c in this._cache.vertexBuffers)a.isSome(this._cache.vertexBuffers[c])&&this._cache.vertexBuffers[c].dispose()};Object.defineProperty(t.prototype,"elementType",{get:function(){var c;
a:switch(this.indices.BYTES_PER_ELEMENT){case 1:c=5121;break a;case 2:c=5123;break a;case 4:c=5125;break a;default:throw new h("Cannot get DataType of array");}return c},enumerable:!0,configurable:!0});t.prototype.getIndexBuffer=function(c,a){void 0===a&&(a=35044);this._cache.indexBuffer||(this._cache.indexBuffer=r.createIndex(c,a,this.indices));return this._cache.indexBuffer};t.prototype.getVertexBuffers=function(c,a){var g=this;void 0===a&&(a=35044);this._cache.vertexBuffers||(this._cache.vertexBuffers=
Object.keys(this.vertices).reduce(function(k,l){var n;return f({},k,(n={},n[l]=r.createVertex(c,a,g.vertices[l]),n))},{}));return this._cache.vertexBuffers};return t}();d.default=b})},"esri/views/2d/engine/webgl/number":function(){define(["require","exports"],function(b,d){function f(a,e,m){return Math.round(Math.max(Math.min(a,m),e))}Object.defineProperty(d,"__esModule",{value:!0});var h=new Float32Array(1),e=new Uint32Array(h.buffer);d.i8=function(a){return f(a,-128,127)};d.i16=function(a){return f(a,
-32768,32767)};d.i32=function(a){return f(a,-2147483648,2147483647)};d.u8=function(a){return f(a,0,255)};d.u16=function(a){return f(a,0,65535)};d.u32=function(a){return f(a,0,4294967295)};d.toUint32=function(a){h[0]=a;return e[0]};d.toFloat32=function(a){e[0]=a;return h[0]};d.u32to4Xu8=function(a){return[a&255,(a&65280)>>>8,(a&16711680)>>>16,(a&4278190080)>>>24]};d.i1616to32=function(a,e){return 65535&a|e<<16};d.i8888to32=function(a,e,m,c){return a&255|(e&255)<<8|(m&255)<<16|c<<24};d.i8816to32=function(a,
e,m){return a&255|(e&255)<<8|m<<16};d.numTo32=function(a){return a|0}})},"esri/views/2d/engine/webgl/enums":function(){define(["require","exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});(function(b){b[b.FILL=0]="FILL";b[b.LINE=1]="LINE";b[b.MARKER=2]="MARKER";b[b.TEXT=3]="TEXT";b[b.LABEL=4]="LABEL"})(d.WGLGeometryType||(d.WGLGeometryType={}));(function(b){b[b.SUCCEEDED=0]="SUCCEEDED";b[b.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY"})(d.WGLGeometryTransactionStatus||(d.WGLGeometryTransactionStatus=
{}));(function(b){b[b.NONE=0]="NONE";b[b.MAP=1]="MAP";b[b.LABEL=2]="LABEL";b[b.LABEL_ALPHA=4]="LABEL_ALPHA";b[b.HITTEST=8]="HITTEST";b[b.HIGHLIGHT=16]="HIGHLIGHT";b[b.CLIP=32]="CLIP";b[b.DEBUG=64]="DEBUG";b[b.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"})(d.WGLDrawPhase||(d.WGLDrawPhase={}));(function(b){b[b.SIZE=0]="SIZE";b[b.COLOR=1]="COLOR";b[b.OPACITY=2]="OPACITY";b[b.ROTATION=3]="ROTATION"})(d.VVType||(d.VVType={}));(function(b){b[b.NONE=0]="NONE";b[b.OPACITY=1]="OPACITY";b[b.COLOR=2]="COLOR";b[b.ROTATION=
4]="ROTATION";b[b.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE";b[b.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS";b[b.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS";b[b.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"})(d.WGLVVFlag||(d.WGLVVFlag={}));(function(b){b[b.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE";b[b.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE";b[b.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE";b[b.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"})(d.WGLVVTarget||(d.WGLVVTarget={}));(function(b){b[b.SPRITE=
0]="SPRITE";b[b.GLYPH=1]="GLYPH"})(d.MosaicType||(d.MosaicType={}))})},"esri/views/2d/engine/BitmapTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./Bitmap ./webgl/TiledDisplayObject".split(" "),function(b,d,f,h,e,a){Object.defineProperty(d,"__esModule",{value:!0});b=function(a){function m(c,l,k,n){void 0===n&&(n=null);var m=a.call(this,c,l,k,k)||this;c=m.requestRender.bind(m);m.bitmap=new e.Bitmap(n,c);m.bitmap.coordScale=k;m.bitmap.once("isReady",
function(){return m.ready()});return m}f(m,a);Object.defineProperty(m.prototype,"stencilRef",{get:function(){return this.bitmap.stencilRef},set:function(c){this.bitmap.stencilRef=c},enumerable:!0,configurable:!0});m.prototype.setTransform=function(c,l){a.prototype.setTransform.call(this,c,l);this.bitmap.transforms.dvs=this.transforms.dvs};m.prototype.attach=function(){this.bitmap.stage=this.stage;var c=this.bitmap.attach();c&&(this.bitmap.attached=!0);return c};m.prototype.detach=function(){this.bitmap.detach()};
return m}(a.TiledDisplayObject);d.BitmapTile=b})},"esri/views/2d/engine/webgl/TileContainer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ./enums ./WGLContainer ./brushes/WGLBrushInfo ./brushes/WGLBrushStencil".split(" "),function(b,d,f,h,e,a,q,m){Object.defineProperty(d,"__esModule",{value:!0});d.sortByLevel=function(c,a){return 0!==c.key.level-a.key.level?c.key.level-a.key.level:0!==c.key.row-a.key.row?c.key.row-a.key.row:c.key.col-
a.key.col};b=function(c){function a(a,l){l=c.call(this,l)||this;l._tileInfoView=a;return l}f(a,c);a.prototype.renderChildren=function(a){this.sortChildren(d.sortByLevel);this.setStencilReference();c.prototype.renderChildren.call(this,a)};a.prototype.createRenderParams=function(a){var k=a.state;return h({},c.prototype.createRenderParams.call(this,a),{requiredLevel:this._tileInfoView.getClosestInfoForScale(k.scale).level,displayLevel:this._tileInfoView.tileInfo.scaleToZoom(k.scale)})};a.prototype.prepareRenderPasses=
function(a){var k=this,l=a.registerRenderPass({name:"stencil",brushes:[m.default],drawPhase:e.WGLDrawPhase.DEBUG|e.WGLDrawPhase.MAP,target:function(){return k.children}}),g=a.registerRenderPass({name:"tileInfo",brushes:[q.default],drawPhase:e.WGLDrawPhase.DEBUG,target:function(){return k.children},has:"esri-tiles-debug"});return c.prototype.prepareRenderPasses.call(this,a).concat([l,g])};a.prototype.updateTransforms=function(c){for(var a=0,k=this.children;a<k.length;a++){var g=k[a],l=this._tileInfoView.getTileResolution(g.key);
g.setTransform(c,l)}};a.prototype.setStencilReference=function(){for(var c=1,a=0,l=this.children;a<l.length;a++)l[a].stencilRef=c++};return a}(a.default);d.default=b})},"esri/views/2d/engine/webgl/brushes/WGLBrushInfo":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms".split(" "),function(b,d,f,h,e,a,q,m){Object.defineProperty(d,"__esModule",
{value:!0});b=function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a._color=h.vec4f32.fromValues(1,0,0,1);return a}f(a,c);a.prototype.dispose=function(){this._outlineProgram&&(this._outlineProgram.dispose(),this._outlineProgram=null);this._tileInfoProgram&&(this._tileInfoProgram.dispose(),this._tileInfoProgram=null);this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=null);this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),
this._tileInfoVertexArrayObject=null);this._canvas=null};a.prototype.prepareState=function(c){c=c.context;c.setBlendingEnabled(!0);c.setBlendFunctionSeparate(1,771,1,771);c.setColorMask(!0,!0,!0,!0);c.setStencilWriteMask(0);c.setStencilTestEnabled(!1)};a.prototype.draw=function(c,a){c=c.context;if(a.isReady){this._loadWGLResources(c);c.bindVAO(this._outlineVertexArrayObject);c.bindProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",a.transforms.dvs);this._outlineProgram.setUniform2f("u_coord_range",
a.coordRange[0],a.coordRange[1]);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",this._color);c.drawArrays(3,0,4);c.bindVAO();var k=this._getTexture(c,a);k&&(c.bindVAO(this._tileInfoVertexArrayObject),c.bindProgram(this._tileInfoProgram),c.bindTexture(k,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",a.transforms.dvs),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform2f("u_coord_ratio",a.coordRange[0]/a.size[0],a.coordRange[1]/
a.size[1]),this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",k.descriptor.width,k.descriptor.height),c.drawArrays(5,0,4),c.bindVAO())}};a.prototype._loadWGLResources=function(c){if(!this._outlineProgram||!this._tileInfoProgram){var a=e.createProgram(c,q.background),k=e.createProgram(c,m.tileInfo),g={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},l=new Int8Array([0,0,1,0,1,1,0,1]),l=e.BufferObject.createVertex(c,
35044,l),l=new e.VertexArrayObject(c,q.background.attributes,g,{geometry:l}),t=new Int8Array([0,0,1,0,0,1,1,1]),t=e.BufferObject.createVertex(c,35044,t);c=new e.VertexArrayObject(c,m.tileInfo.attributes,g,{geometry:t});this._outlineProgram=a;this._tileInfoProgram=k;this._outlineVertexArrayObject=l;this._tileInfoVertexArrayObject=c}};a.prototype._getTexture=function(c,a){if(a.texture)return a.texture;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),
this._canvas.setAttribute("width","300"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var k=a.triangleCount,g=a.key.id;0<a.triangleCount&&(g+=", "+k);var l=this._canvas,n=l.getContext("2d");n.font="24px sans-serif";n.textAlign="left";n.textBaseline="top";n.clearRect(0,0,300,32);1E5<k?(n.fillStyle="red",n.fillRect(0,0,300,32),n.fillStyle="black"):(n.clearRect(0,0,300,32),n.fillStyle="blue");n.fillText(g,0,0);a.texture=new e.Texture(c,{target:3553,pixelFormat:6408,
dataType:5121,samplingMode:9728,wrapMode:33071},l);return a.texture};return a}(a.default);d.default=b})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(["require","exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(){this.name=this.constructor.name||"UnnamedBrush"}b.prototype.prepareState=function(b,e,a){};b.prototype.draw=function(b,e,a){};b.prototype.drawMany=function(b,e,a){for(var d=0;d<e.length;d++)this.draw(b,e[d],a)};return b}();
d.default=b})},"esri/views/2d/engine/webgl/shaders/BackgroundPrograms":function(){define(["require","exports","./sources/resolver"],function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});d.background={name:"background",shaders:{vertexShader:f.resolveIncludes("background/background.vert"),fragmentShader:f.resolveIncludes("background/background.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/shaders/sources/resolver":function(){define(["require","exports","../../../../../webgl",
"./shaderRepository"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});var e=new f.ShaderCompiler(function(a){var b=h;a.split("/").forEach(function(a){b&&(b=b[a])});return b});d.resolveIncludes=function(a){return e.resolveIncludes(a)}})},"esri/views/2d/engine/webgl/shaders/sources/shaderRepository":function(){define(["require","exports"],function(b,d){return{background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\n  gl_FragColor \x3d u_color;\n}","background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\n  vec3 v_pos \x3d u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n}"},
bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\n  lowp vec4 color \x3d texture2D(u_tex, v_uv);\n  gl_FragColor \x3d color *  u_opacity;\n}","bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n  v_uv \x3d a_tex;\n}"},filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\n  float b \x3d 1.0 / 6.0;\n  float v2 \x3d v * v;\n  float v3 \x3d v2 * v;\n  float w0 \x3d b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\n  float w1 \x3d b * (3.0 * v3  - 6.0 * v2 + 4.0);\n  float w2 \x3d b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\n  float w3 \x3d b * v3;\n  return vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\n  vec4 w \x3d computeWeights(v);\n  float g0 \x3d w.x + w.y;\n  float g1 \x3d w.z + w.w;\n  float h0 \x3d 1.0 - (w.y / g0) + v;\n  float h1 \x3d 1.0 + (w.w / g1) - v;\n  return vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\n  vec2 eX \x3d vec2(1.0 / texSize.x, 0.0);\n  vec2 eY \x3d vec2(0.0, 1.0 / texSize.y);\n  vec2 texel \x3d coords * texSize - 0.5;\n  vec3 hgX \x3d bicubicOffsetsAndWeights(fract(texel).x).xyz;\n  vec3 hgY \x3d bicubicOffsetsAndWeights(fract(texel).y).xyz;\n  vec2 coords10 \x3d coords + hgX.x * eX;\n  vec2 coords00 \x3d coords - hgX.y * eX;\n  vec2 coords11 \x3d coords10 + hgY.x * eY;\n  vec2 coords01 \x3d coords00 + hgY.x * eY;\n  coords10 \x3d coords10 - hgY.y * eY;\n  coords00 \x3d coords00 - hgY.y * eY;\n  vec4 color00 \x3d texture2D(sampler, coords00);\n  vec4 color10 \x3d texture2D(sampler, coords10);\n  vec4 color01 \x3d texture2D(sampler, coords01);\n  vec4 color11 \x3d texture2D(sampler, coords11);\n  color00 \x3d mix(color00, color01, hgY.z);\n  color10 \x3d mix(color10, color11, hgY.z);\n  color00 \x3d mix(color00, color10, hgX.z);\n  return color00;\n}",
"bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\n  vec2 texelStart \x3d floor(coords * texSize);\n  vec2 coord0 \x3d texelStart / texSize;\n  vec2 coord1 \x3d (texelStart +  vec2(1.0, 0.0)) / texSize;\n  vec2 coord2 \x3d (texelStart +  vec2(0.0, 1.0)) / texSize;\n  vec2 coord3 \x3d (texelStart +  vec2(1.0, 1.0)) / texSize;\n  vec4 color0 \x3d texture2D(sampler, coord0);\n  vec4 color1 \x3d texture2D(sampler, coord1);\n  vec4 color2 \x3d texture2D(sampler, coord2);\n  vec4 color3 \x3d texture2D(sampler, coord3);\n  vec2 blend \x3d fract(coords * texSize);\n  vec4 color01 \x3d mix(color0, color1, blend.x);\n  vec4 color23 \x3d mix(color2, color3, blend.x);\n  return mix(color01, color23, blend.y);\n}",
"epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\n  vec2 invSize \x3d 1.0 / texSize;\n  vec2 texel \x3d coords * texSize;\n  vec2 texel_i \x3d floor(texel);\n  vec2 texel_frac \x3d fract(texel);\n  vec4 colorP \x3d texture2D(sampler, texel_i * invSize);\n  vec4 colorP1 \x3d vec4(colorP);\n  vec4 colorP2 \x3d vec4(colorP);\n  vec4 colorP3 \x3d vec4(colorP);\n  vec4 colorP4 \x3d vec4(colorP);\n  vec4 colorA \x3d texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\n  vec4 colorB \x3d texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\n  vec4 colorC \x3d texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\n  vec4 colorD \x3d texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\n  if (colorC \x3d\x3d colorA \x26\x26 colorC !\x3d colorD \x26\x26 colorA !\x3d colorB) {\n    colorP1 \x3d colorA;\n  }\n  if (colorA \x3d\x3d colorB \x26\x26 colorA !\x3d colorC \x26\x26 colorB !\x3d colorD) {\n    colorP2 \x3d colorB;\n  }\n  if (colorD \x3d\x3d colorC \x26\x26 colorD !\x3d colorB \x26\x26 colorC !\x3d colorA) {\n    colorP3 \x3d colorC;\n  }\n  if (colorB \x3d\x3d colorD \x26\x26 colorB !\x3d colorA \x26\x26 colorD !\x3d colorC) {\n    colorP4 \x3d colorD;\n  }\n  vec4 colorP12 \x3d mix(colorP1, colorP2, texel_frac.x);\n  vec4 colorP34 \x3d mix(colorP1, colorP2, texel_frac.x);\n  return mix(colorP12, colorP34, texel_frac.y);\n}"},
fx:{integrate:{"integrate.frag":"precision mediump float;\nuniform lowp sampler2D u_sourceTexture;\nuniform lowp sampler2D u_maskTexture;\nuniform mediump float u_zoomLevel;\nuniform highp float u_timeDelta;\nuniform highp float u_animationTime;\nvarying highp vec2 v_texcoord;\n#include \x3cmaterials/utils.glsl\x3e\nvoid main()\n{\n#ifdef DELTA\n  vec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\n  vec4 data0 \x3d texture2D(u_maskTexture, v_texcoord);\n  float flags \x3d data0.r * 255.0;\n  float groupMinZoom \x3d data0.g * 255.0;\n  float isVisible \x3d getFilterBit(flags, 0);\n  float wouldClip \x3d step(groupMinZoom, u_zoomLevel);\n  float direction \x3d wouldClip * 1.0 + (1.0 - wouldClip) * -1.0;\n  float dt \x3d u_timeDelta / max(u_animationTime, 0.0001);\n  vec4 nextState \x3d vec4(texel + direction * dt);\n  gl_FragColor \x3d  vec4(nextState);\n#elif defined(UPDATE)\n  vec4 texel \x3d texture2D(u_sourceTexture, v_texcoord);\n  gl_FragColor \x3d texel;\n#endif\n}",
"integrate.vert":"precision mediump float;\nattribute vec2 a_pos;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump vec4 u_sigmas;\nuniform sampler2D u_texture;\nmediump vec4 gauss4(mediump vec2 dir) {\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas * u_sigmas));\n}\nmediump float gauss1(mediump vec2 dir) {\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas[3] * u_sigmas[3]));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\n  return u_channelSelector * sample;\n}\nvoid accumGauss4(mediump float i, inout mediump vec4 tot, inout mediump vec4 weight) {\n  mediump vec4 w \x3d gauss4(i * u_direction.xy);\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw)) * w;\n  weight +\x3d w;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\n  mediump float w \x3d gauss1(i * u_direction.xy);\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\n  weight +\x3d w;\n}\nvoid main(void) {\n  mediump float tot \x3d 0.0;\n  mediump float weight \x3d 0.0;\n  accumGauss1(-4.0, tot, weight);\n  accumGauss1(-3.0, tot, weight);\n  accumGauss1(-2.0, tot, weight);\n  accumGauss1(-1.0, tot, weight);\n  accumGauss1(0.0, tot, weight);\n  accumGauss1(1.0, tot, weight);\n  accumGauss1(2.0, tot, weight);\n  accumGauss1(3.0, tot, weight);\n  accumGauss1(4.0, tot, weight);\n  gl_FragColor \x3d vec4(0.0, 0.0, 0.0, tot / weight);\n}",
"highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump vec4 u_sigmas;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\n  mediump float sigma \x3d u_sigmas[3];\n  mediump float y \x3d texture2D(u_texture, v_texcoord)[3];\n  const mediump float y0 \x3d 0.5;\n  mediump float m0 \x3d 1.0 / (sqrt(2.0 * 3.1415) * sigma);\n  mediump float d \x3d (y - y0) / m0;\n  return d;\n}\nmediump vec4 shade(mediump float d) {\n  mediump float mappedDistance \x3d (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\n  mappedDistance \x3d clamp(mappedDistance, 0.0, 1.0);\n  return texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\n  mediump float d \x3d estimateDistance();\n  gl_FragColor \x3d shade(d);\n}",
"textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\n  gl_Position \x3d vec4(a_position, 0.0, 1.0);\n  v_texcoord \x3d a_texcoord;\n}"},magnifier:{"magnifier.frag":"uniform lowp vec4 u_background;\nuniform mediump sampler2D u_readbackTexture;\nuniform mediump sampler2D u_maskTexture;\nuniform mediump sampler2D u_overlyTexture;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\n  lowp vec4 color \x3d texture2D(u_readbackTexture, v_texCoord);\n  color \x3d color + (1.0 - color.a) * u_background;\n  lowp vec4 mask_color \x3d texture2D(u_maskTexture, v_texCoord);\n  lowp float gray \x3d 1.0 - dot(mask_color, vec4(0.3, 0.59, 0.11, 0));\n  color *\x3d gray;\n  lowp vec4 overley_color \x3d texture2D(u_overlyTexture, v_texCoord);\n  overley_color.rgb *\x3d overley_color.a;\n  gl_FragColor \x3d overley_color + (1.0 - overley_color.a) * color;\n}",
"magnifier.vert":"precision mediump float;\nattribute mediump vec2 a_pos;\nuniform mediump vec2 u_drawPos;\nuniform mediump float u_width;\nuniform mediump float u_height;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\n  v_texCoord \x3d a_pos;\n  vec2 coord \x3d u_drawPos + vec2(a_pos - 0.5) * vec2(u_width, u_height);\n  gl_Position \x3d vec4(coord, 0.0, 1.0);\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D u_attributeData0;\nuniform highp sampler2D u_attributeData1;\nuniform highp sampler2D u_attributeData2;\nuniform highp sampler2D u_attributeData3;\nuniform highp int u_attributeTextureSize;\nhighp vec2 getAttributeDataCoords(in highp vec4 id) {\n  highp vec4 texel \x3d unpackLocalIdTexel(id);\n  highp float size \x3d float(u_attributeTextureSize);\n  highp float u32 \x3d float(int(texel.r) + int(texel.g) * 256 + int(texel.b) * 256 * 256 + int(texel.a) * 256 * 256 * 256);\n  highp float col \x3d mod(u32, size);\n  highp float row \x3d (u32 - col) / size;\n  highp float u \x3d col / size;\n  highp float v \x3d row / size;\n  return vec2(u, v);\n}\nhighp vec4 getAttributeData0(in highp vec4 id) {\n  vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData0, coords);\n}\nhighp vec4 getAttributeData1(in highp vec4 id) {\n  highp vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData1, coords);\n}\nhighp vec4 getAttributeData2(in highp vec4 id) {\n  highp vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData2, coords);\n}\nhighp vec4 getAttributeData3(in highp vec4 id) {\n  highp vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData3, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\n  bool isMagic \x3d v.x \x3d\x3d 255.0 \x26\x26 v.y \x3d\x3d 255.0;\n  if (isMagic) {\n    return NAN_MAGIC_NUMBER;\n  }\n  return (v.x + v.y * float(0x100)) - 32768.0;\n}",
"constants.glsl":"const float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float SIGNED_BYTE_TO_UNSIGNED \x3d 128.0;\nconst float SOFT_EDGE_RATIO \x3d 1.0;\nconst float THIN_LINE_WIDTH_FACTOR \x3d 1.1;\nconst float THIN_LINE_HALF_WIDTH \x3d 1.0;\nconst float EXTRUDE_SCALE_PLACEMENT_PADDING \x3d 1.0 / 4.0;\nconst float OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float OUTLINE_SCALE \x3d 1.0 / 5.0;\nconst float SDF_FONT_SIZE \x3d 24.0;\nconst float MAX_SDF_DISTANCE \x3d 8.0;\nconst float PLACEMENT_PADDING \x3d 8.0;\nconst float EPSILON \x3d 0.0000001;\nconst int MAX_FILTER_COUNT \x3d 2;\nconst int ATTR_VV_SIZE \x3d 0;\nconst int ATTR_VV_COLOR \x3d 1;\nconst int ATTR_VV_OPACITY \x3d 2;\nconst int ATTR_VV_ROTATION \x3d 3;\nconst highp float NAN_MAGIC_NUMBER \x3d 1e-30;",
"effects.glsl":"uniform highp mat4 u_insideEffectMat4[ MAX_FILTER_COUNT ];\nuniform highp mat4 u_outsideEffectMat4[ MAX_FILTER_COUNT ];\nuniform highp float u_insideOpacities[ MAX_FILTER_COUNT ];\nuniform highp float u_outsideOpacities[ MAX_FILTER_COUNT ];\nvec4 getEffectColor(in vec4 color, in float filterFlags) {\n  vec4 rgbw \x3d vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\n  float a \x3d color.a;\n  for (int i \x3d 1; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getFilterBit(filterFlags, i);\n    rgbw \x3d u_insideEffectMat4[ i ] * (bit  * rgbw) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * rgbw);\n    a    \x3d u_insideOpacities[ i ]  * (bit  * a)    + u_outsideOpacities[ i ]  * ((1.0 - bit) * a);\n  }\n  return vec4(rgbw.rgb * a, a);\n}\nvec3 applyFilter(inout vec4 color, inout vec3 pos, in float filterFlags) {\n  vec4 rgbw \x3d vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\n  float a \x3d color.a;\n  for (int i \x3d 0; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getFilterBit(filterFlags, i);\n    rgbw \x3d u_insideEffectMat4[ i ] * (bit  * rgbw) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * rgbw);\n    a    \x3d u_insideOpacities[ i ]  * (bit  * a)    + u_outsideOpacities[ i ]  * ((1.0 - bit) * a);\n  }\n  color.rgb \x3d rgbw.rgb * a;\n  color.a \x3d a;\n  pos.z +\x3d 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef HIGHLIGHT\n  pos.z +\x3d 2.0 * (1.0 - getHighlightBit(filterFlags));\n#endif\n  return pos;\n}\nvec3 applyFilterLabels(inout vec4 color, inout vec3 pos, in float filterFlags) {\n  float bit \x3d getFilterBit(filterFlags, 0);\n  pos.z +\x3d 2.0 * (1.0 - bit);\n#ifndef OUTSIDE_LABELS_VISIBLE\n  for (int i \x3d 1; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getFilterBit(filterFlags, i);\n    pos.z +\x3d 2.0 * (1.0 - bit);\n  }\n#endif\n  return pos;\n}",
fill:{"common.glsl":"#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\n#endif\n#ifdef DOT_DENSITY\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec4 v_id;\nvarying highp float v_flags;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef DOT_DENSITY\nvarying highp vec2 v_dotTextureCoords;\nvarying highp vec4 v_dotThresholds[ 2 ];\n#endif",
"fill.frag":"precision highp float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef DOT_DENSITY\n#include \x3cmaterials/effects.glsl\x3e\n#endif\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#ifdef DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\nvoid main() {\n#ifdef ID\n  gl_FragColor \x3d v_id;\n#elif defined(PATTERN)\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d v_opacity * v_color * color;\n#elif defined(DOT_DENSITY) \x26\x26 !defined(HIGHLIGHT)\n  vec4 textureThresholds0 \x3d texture2D(u_dotTextures[0], v_dotTextureCoords);\n  vec4 textureThresholds1 \x3d texture2D(u_dotTextures[1], v_dotTextureCoords);\n  vec4 difference0 \x3d v_dotThresholds[0] - textureThresholds0;\n  vec4 difference1 \x3d v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\n  vec4 isPositive0 \x3d step(0.0, difference0);\n  vec4 isPositive1 \x3d step(0.0, difference1);\n  float weightSum \x3d dot(isPositive0, difference0) + dot(isPositive1, difference1);\n  float lessThanEqZero \x3d step(weightSum, 0.0);\n  float greaterThanZero \x3d 1.0 - lessThanEqZero ;\n  float divisor \x3d (weightSum + lessThanEqZero);\n  vec4 weights0 \x3d difference0 * isPositive0 / divisor;\n  vec4 weights1 \x3d difference1 * isPositive1 / divisor;\n  vec4 dotColor \x3d u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\n  vec4 preEffectColor \x3d greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\n  float diffMax \x3d max(max4(difference0), max4(difference1));\n  float lessThanZero \x3d step(diffMax, 0.0);\n  float greaterOrEqZero \x3d 1.0 - lessThanZero;\n  vec4 isMax0 \x3d step(diffMax, difference0);\n  vec4 isMax1 \x3d step(diffMax, difference1);\n  vec4 dotColor \x3d u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\n  vec4 preEffectColor \x3d greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\n  gl_FragColor \x3d getEffectColor(preEffectColor, v_flags);\n#else\n  gl_FragColor \x3d v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d 1.0;\n#endif\n}",
"fill.vert":"precision highp float;\n#ifdef DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color \x3d vec4(0.0, 0.0, 0.0, 1.0);\nvec4 a_aux3 \x3d vec4(0.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_tlbr;\nattribute vec4 a_aux1;\nattribute vec2 a_aux2;\nattribute vec4 a_aux3;\n#endif\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\n  return featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef PATTERN\nmat3 getPatternMatrix() {\n  mat3 patternMatrix \x3d mat3(1.0);\n  vec2 aux2 \x3d (1.0 / SIGNED_BYTE_TO_UNSIGNED) * a_aux2;\n  patternMatrix[0][0] \x3d 1.0 / (u_zoomFactor * a_aux1.x * aux2.x);\n  patternMatrix[1][1] \x3d 1.0 / (u_zoomFactor * a_aux1.y * aux2.y);\n  return patternMatrix;\n}\n#endif\nvoid main()\n{\n  INIT;\n  float a_bitSet \x3d a_aux3.a;\n  v_color     \x3d getColor(a_color, a_bitSet, 0);\n  v_opacity   \x3d getOpacity(a_bitSet, 1);\n  v_id        \x3d norm(a_id);\n  v_pos       \x3d u_dvsMat3 * vec3(a_pos, 1.);\n  v_flags     \x3d getFilterFlags();\n#ifdef PATTERN\n  vec2 symbolOffset \x3d u_zoomFactor * (a_aux1.zw - SIGNED_BYTE_TO_UNSIGNED);\n  v_tileTextureCoord \x3d (getPatternMatrix() * vec3(a_pos + symbolOffset, 1.0)).xy;\n  v_tlbr \x3d a_tlbr / u_mosaicSize.xyxy;\n#elif defined(DOT_DENSITY)\n  vec4 ddAttributeData0 \x3d getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\n  vec4 ddAttributeData1 \x3d getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\n  float size \x3d u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\n  v_dotThresholds[0] \x3d dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\n  v_dotThresholds[1] \x3d dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\n  v_dotTextureCoords \x3d (a_pos + 0.5) / size;\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, v_flags), 1.0);\n}"},
icon:{"common.glsl":"uniform lowp vec2 u_mosaicSize;\nvarying lowp vec4 v_color;\nvarying highp vec4 v_id;\nvarying highp vec4 v_sizeTex;\nvarying mediump vec3 v_pos;\nvarying highp float v_filters;\nvarying lowp float v_opacity;\n#ifdef SDF\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\nvarying mediump float v_overridingOutlineColor;\nvarying mediump float v_isThin;\n#endif","icon.frag":"precision mediump float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/effects.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n  vec2 v_size \x3d v_sizeTex.xy;\n  vec2 v_tex  \x3d v_sizeTex.zw;\n#ifdef SDF\n  lowp vec4 fillPixelColor \x3d v_color;\n  float d \x3d 0.5 - rgba2float(texture2D(u_texture, v_tex));\n  float size \x3d max(v_size.x, v_size.y);\n  float dist \x3d d * size * SOFT_EDGE_RATIO * v_distRatio;\n  fillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\n  float outlineWidth \x3d v_outlineWidth;\n  #ifdef HIGHLIGHT\n    outlineWidth \x3d max(outlineWidth, 4.0 * v_isThin);\n  #endif\n  if (outlineWidth \x3e 0.25) {\n    lowp vec4 outlinePixelColor \x3d v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\n    float clampedOutlineSize \x3d min(outlineWidth, size);\n    outlinePixelColor *\x3d clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\n    gl_FragColor \x3d v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n  }\n  else {\n    gl_FragColor \x3d v_opacity * fillPixelColor;\n  }\n#else\n   lowp vec4 texColor \x3d texture2D(u_texture, v_tex);\n   gl_FragColor \x3d v_opacity * getEffectColor(texColor, v_filters);\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"icon.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec4 a_bitSetAndDistRatio;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float referenceSize, in float bitSet) {\n#ifdef VV_SIZE\n  float r \x3d getSize(baseSize.y) / referenceSize;\n  baseSize.xy *\x3d r;\n  offset.xy *\x3d r;\n  float scaleSymbolProportionally \x3d getBit(bitSet, 3);\n  outlineSize *\x3d scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\n  return baseSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\n  float isMapAligned \x3d getBit(a_bitSet, 0);\n  vec3  offset       \x3d getRotation() * vec3(in_offset, 0.0);\n  return getMatrix(isMapAligned) * offset;\n}\nvoid main()\n{\n  INIT;\n  vec2  a_size   \x3d a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 256.0;\n  vec2  a_offset \x3d a_vertexOffset / 16.0;\n  float a_outlineSize \x3d a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 256.0;\n  float a_bitSet \x3d a_bitSetAndDistRatio.z;\n  vec2 v_size \x3d getMarkerSize(a_offset, a_size, a_outlineSize, a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 256.0, a_bitSet);\n  vec2 v_tex      \x3d a_texCoords / u_mosaicSize;\n  v_color    \x3d getColor(a_color, a_bitSet, 1);\n  v_opacity  \x3d getOpacity(a_bitSet, 1);\n  v_id       \x3d norm(a_id);\n  v_filters  \x3d getFilterFlags();\n  v_pos      \x3d u_dvsMat3 * vec3(a_pos, 1.0) + getOffset(a_offset, a_bitSet);\n  v_sizeTex  \x3d vec4(v_size.xy, v_tex.xy);\n#ifdef SDF\n  v_isThin   \x3d getBit(a_bitSet, 2);\n  #ifdef VV_COLOR\n    v_overridingOutlineColor \x3d v_isThin;\n  #else\n    v_overridingOutlineColor \x3d 0.0;\n  #endif\n  v_outlineWidth \x3d min(a_outlineSize, max(max(v_size.x, v_size.y) - 0.99, 0.0));\n  v_outlineColor \x3d getEffectColor(a_outlineColor, v_filters);\n  v_distRatio \x3d a_bitSetAndDistRatio.w / 126.0;\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, v_filters), 1.0);\n}"},
label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform mediump float u_mapRotation;\nuniform mediump float u_mapAligned;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"#include \x3cmaterials/text/text.frag\x3e","label.vert":"precision highp float;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_glyphData;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHalo;\nuniform float u_zoomLevel;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\n  float glyphAngle \x3d angle * 360.0 / 254.0;\n  float mapAngle \x3d u_mapRotation * 360.0 / 254.0;\n  float diffAngle \x3d min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\n  float z \x3d 0.0;\n  z +\x3d u_mapAligned * (2.0 * (1.0 - step(minZoom, u_zoomLevel)));\n  z +\x3d u_mapAligned * 2.0 * step(90.0, diffAngle);\n  z +\x3d 2.0 * (1.0 - step(u_zoomLevel, maxZoom));\n  return z;\n}\nvoid main()\n{\n  INIT;\n  float groupMinZoom    \x3d getMinZoom();\n  float glyphMinZoom    \x3d a_glyphData.x;\n  float glyphMaxZoom    \x3d a_glyphData.y;\n  float glyphAngle      \x3d a_glyphData.z;\n  float a_minZoom          \x3d max(groupMinZoom, glyphMinZoom);\n  float a_placementPadding \x3d a_refSymbolAndPlacementOffset.x * EXTRUDE_SCALE_PLACEMENT_PADDING;\n  vec2  a_placementDir     \x3d unpack_u8_nf32(a_refSymbolAndPlacementOffset.zw);\n  float a_refSymbolSize    \x3d a_refSymbolAndPlacementOffset.y;\n  float fontSize           \x3d a_texAndSize.z;\n  float haloSize           \x3d a_texAndSize.w * OUTLINE_SCALE;\n  vec2  vertexOffset \x3d a_vertexOffset * OFFSET_PRECISION;\n  vec3  pos          \x3d vec3(floor(a_pos * 0.5) * OFFSET_PRECISION, 1.0);\n  float z            \x3d getZ(a_minZoom, glyphMaxZoom, glyphAngle);\n  float fontScale    \x3d fontSize / SDF_FONT_SIZE;\n  float halfSize     \x3d getSize(a_refSymbolSize) / 2.0;\n  float animation    \x3d pow(getAnimationState(), vec4(2.0)).r;\n  v_color     \x3d animation * ((1.0 - u_isHalo) * a_color + (u_isHalo * a_haloColor));\n  v_opacity   \x3d 1.0;\n  v_tex       \x3d a_texCoords / u_mosaicSize;\n  v_edgeDistanceOffset \x3d u_isHalo * haloSize / fontScale / MAX_SDF_DISTANCE;\n  v_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n  vec2 placementOffset \x3d a_placementDir * (halfSize + a_placementPadding);\n  vec3 glyphOffset     \x3d u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\n  vec3 v_pos           \x3d vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\n  gl_Position \x3d vec4(applyFilterLabels(v_color, v_pos, getFilterFlags()), 1.0);\n#ifdef DEBUG\n  v_color \x3d vec4(a_color.rgb, z \x3d\x3d 0.0 ? 1.0 : 0.645);\n#endif\n}"},
line:{"common.glsl":"varying lowp vec4 v_color;\nvarying highp vec4 v_id;\nvarying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp float v_opacity;\nvarying highp vec3 v_pos;\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif","line.frag":"precision lowp float;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\nuniform lowp float u_blur;\nuniform mediump float u_zoomFactor;\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\n#endif\n#ifdef SDF\nconst float sdfPatternHalfWidth \x3d 15.5;\nconst float widthFactor \x3d 2.0;\n#endif\nvoid main()\n{\n  mediump float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(v_lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\n  mediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\n  lowp float alpha \x3d clamp(thinLineFactor * (v_lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT)\n  mediump float lineHalfWidth \x3d widthFactor * v_lineHalfWidth;\n  mediump float lineWidthRatio \x3d lineHalfWidth / sdfPatternHalfWidth;\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * lineHalfWidth) / (lineWidthRatio * v_patternSize.x), 1.0);\n  mediump float relativeTexY \x3d 0.5 + 0.5 * v_normal.y;\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\n  mediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\n  float dist \x3d d * lineHalfWidth;\n  lowp vec4 fillPixelColor \x3d v_opacity * alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n  gl_FragColor \x3d fillPixelColor;\n#elif defined(PATTERN) \x26\x26 !defined(HIGHLIGHT)\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * v_lineHalfWidth) / v_patternSize.x, 1.0);\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * v_lineHalfWidth / v_patternSize.y);\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\n  gl_FragColor \x3d v_opacity * alpha * v_color * color;\n#else\n  gl_FragColor \x3d v_opacity * alpha * v_color;\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"line.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\nconst float SCALE \x3d 1.0 / 31.0;\nconst float WIDTH_SCALE \x3d 1.0 / 1024.0;\nfloat getBaseLineHalfWidth(in float in_lineHalfWidth) {\n#ifdef VV_SIZE\n  float referenceHalfWidth \x3d a_aux.x * WIDTH_SCALE;\n  float lineWidth \x3d 2.0 * in_lineHalfWidth;\n  return 0.5 * (in_lineHalfWidth / referenceHalfWidth) * getSize(lineWidth);\n#else\n  return in_lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\n  float halfWidth \x3d max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\n  halfWidth \x3d max(halfWidth, 2.0);\n#endif\n  return halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\n  float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT)\n  thinLineFactor *\x3d 2.0;\n#endif\n  return thinLineFactor * halfWidth * offset * SCALE;\n}\nvoid main()\n{\n  INIT;\n  float a_bitSet          \x3d a_segmentDirection.w;\n  float a_accumulatedDist \x3d a_accumulatedDistanceAndHalfWidth.x;\n  float a_lineHalfWidth   \x3d a_accumulatedDistanceAndHalfWidth.y * WIDTH_SCALE;\n  float aa                \x3d 0.5 * u_antialiasing;\n  vec2  a_offset          \x3d a_offsetAndNormal.xy;\n  float baseWidth \x3d getBaseLineHalfWidth(a_lineHalfWidth);\n  float halfWidth \x3d getLineHalfWidth(baseWidth, aa);\n  float z         \x3d 2.0 * step(baseWidth, 0.0);\n  vec2  dist      \x3d getDist(a_offset, halfWidth);\n  vec3  offset    \x3d u_displayViewMat3 * vec3(dist, 0.0);\n  vec3  pos       \x3d u_dvsMat3 * vec3(a_pos.xy, 1.0) + offset;\n  v_color         \x3d getColor(a_color, a_bitSet, 0);\n  v_opacity       \x3d getOpacity(a_bitSet, 0);\n  v_lineHalfWidth \x3d halfWidth;\n  v_id            \x3d norm(a_id);\n  v_normal        \x3d a_offsetAndNormal.zw * SCALE;\n  v_pos           \x3d vec3(pos.xy, z);\n#ifdef PATTERN\n  v_tlbr          \x3d a_tlbr / u_mosaicSize.xyxy;\n  v_patternSize   \x3d vec2(a_tlbr.z - a_tlbr.x, a_tlbr.w - a_tlbr.y);\n#endif\n#if defined(PATTERN) || defined(SDF)\n  v_accumulatedDistance \x3d a_accumulatedDist + dot(SCALE * a_segmentDirection.xy, dist / u_zoomFactor);\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, getFilterFlags()), 1.0);\n}"},
text:{"common.glsl":"uniform highp vec2 u_mosaicSize;\nvarying highp vec4 v_id;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec2 v_tex;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying lowp float v_transparency;","text.frag":"precision mediump float;\n#include \x3cmaterials/text/common.glsl\x3e\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n  float SDF_CUTOFF \x3d (2.0 / 8.0);\n  float SDF_BASE_EDGE_DIST \x3d 1.0 - SDF_CUTOFF;\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  mediump float edge \x3d SDF_BASE_EDGE_DIST - v_edgeDistanceOffset;\n#ifdef HIGHLIGHT\n  edge /\x3d 2.0;\n#endif\n  lowp float aa \x3d v_antialiasingWidth;\n  lowp float alpha \x3d smoothstep(edge - aa, edge + aa, dist);\n  gl_FragColor \x3d alpha * v_color * v_opacity;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"text.vert":"precision highp float;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHalo;\nfloat getTextSize(inout vec2 offset, in float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\n   float ratio \x3d baseSize / referenceSize;\n   baseSize \x3d ratio * getSize(baseSize);\n#endif\n  return baseSize;\n}\nvoid main()\n{\n  INIT;\n  float a_bitSet    \x3d a_aux.w;\n  float a_fontSize  \x3d a_texFontSize.z;\n  vec2  a_offset    \x3d a_vertexOffset * OFFSET_PRECISION;\n  vec3  in_pos      \x3d vec3(floor(a_pos * 0.5), 1.0);\n  float fontSize    \x3d getTextSize(a_offset, a_fontSize, a_aux.z * a_aux.z / 256.0);\n  float scaleFactor \x3d fontSize / a_fontSize;\n  float fontScale   \x3d fontSize / SDF_FONT_SIZE;\n  vec3  offset      \x3d getRotation() * vec3(scaleFactor * a_offset, 0.0);\n  v_color   \x3d u_isHalo * a_haloColor + (1.0 - u_isHalo) * getColor(a_color, a_bitSet, 0);\n  v_opacity \x3d getOpacity(a_bitSet, 0);\n  v_id      \x3d norm(a_id);\n  v_tex     \x3d a_texCoords / u_mosaicSize;\n  v_pos     \x3d u_dvsMat3 * in_pos + u_displayMat3 * offset;\n  v_edgeDistanceOffset \x3d u_isHalo * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\n  v_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n  gl_Position \x3d  vec4(applyFilter(v_color, v_pos, getFilterFlags()), 1.0);\n}"},
"utils.glsl":"float rshift(in float u32, in int amount) {\n  return floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\nfloat getFilterBit(in float bitset, in int bitIndex) {\n  return getBit(bitset, bitIndex + 1);\n}\nfloat getHighlightBit(in float bitset) {\n  return getBit(bitset, 0);\n}\nhighp vec4 unpackLocalIdTexel(in highp vec4 bitset) {\n  float isAggregate \x3d getBit(bitset.a, 7);\n  return (1.0 - isAggregate) * bitset + isAggregate * (vec4(bitset.rgba) - vec4(0.0, 0.0, 0.0, float(0x80)));\n}\nvec4 unpack(in float u32) {\n  float r \x3d mod(rshift(u32, 0), 255.0);\n  float g \x3d mod(rshift(u32, 8), 255.0);\n  float b \x3d mod(rshift(u32, 16), 255.0);\n  float a \x3d mod(rshift(u32, 24), 255.0);\n  return vec4(r, g, b, a);\n}\nvec4 norm(in vec4 v) {\n  return v /\x3d 255.0;\n}\nfloat max4(vec4 target) {\n  return max(max(max(target.x, target.y), target.z), target.w);\n}\nvec2 unpack_u8_nf32(vec2 bytes) {\n  return (bytes - 127.0) / 127.0;\n}",
"vcommon.glsl":"#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/attributeData.glsl\x3e\n#include \x3cmaterials/vv.glsl\x3e\n#include \x3cmaterials/effects.glsl\x3e\nattribute vec2 a_pos;\nattribute highp vec4 a_id;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform highp float u_pixelRatio;\nuniform mediump float u_zoomFactor;\nuniform mediump float u_antialiasing;\nvec4 VV_ADATA \x3d vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\n#ifdef OES_TEXTURE_FLOAT\n  target.rgba \x3d getAttributeData2(a_id);\n#else\n  vec4 data0 \x3d getAttributeData2(a_id);\n  vec4 data1 \x3d getAttributeData3(a_id);\n  target.r \x3d u88VVToFloat(data0.rg * 255.0);\n  target.g \x3d u88VVToFloat(data0.ba * 255.0);\n  target.b \x3d u88VVToFloat(data1.rg * 255.0);\n  target.a \x3d u88VVToFloat(data1.ba * 255.0);\n#endif\n}\n#ifdef VV\n  #define INIT loadVisualVariableData(VV_ADATA)\n#else\n  #define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\n  float isColorLocked   \x3d getBit(a_bitSet, index);\n  return getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\n  return a_color;\n#endif\n}\nfloat getOpacity(in float a_bitSet, in int index) {\n#ifdef VV_OPACITY\n  float isOpacityLocked \x3d getBit(a_bitSet, index);\n  return getVVOpacity(VV_ADATA[ATTR_VV_OPACITY], isOpacityLocked);\n#else\n  return 1.0;\n#endif\n}\nfloat getSize(in float in_size) {\n#ifdef VV_SIZE\n  return getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE]);\n#else\n  return in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\n  return getVVRotationMat3(mod(VV_ADATA[ATTR_VV_ROTATION], 360.0));\n#else\n  return mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\n  return ceil(getAttributeData0(a_id).x * 255.0);\n#else\n  return getAttributeData0(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\n  return getAttributeData1(a_id);\n}\nfloat getMinZoom() {\n  vec4 data0 \x3d getAttributeData0(a_id) * 255.0;\n  return data0.g;\n}\nmat3 getMatrix(float isMapAligned) {\n  return isMapAligned * u_displayViewMat3 + (1.0 - isMapAligned) * u_displayMat3;\n}",
"vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n  #define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n  #define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float u_vvColorValues[8];\nuniform vec4 u_vvColors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 u_vvSizeMinMaxValue;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float u_vvSizeScaleStopsValue;\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float u_vvSizeFieldStopsValues[6];\nuniform float u_vvSizeFieldStopsSizes[6];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float u_vvSizeUnitValueWorldToPixelsRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float u_vvOpacityValues[8];\nuniform float u_vvOpacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float u_vvRotationType;\n#endif\nbool isNan(float val) {\n  return (val \x3d\x3d NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  float interpolationRatio \x3d (sizeValue  - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\n  interpolationRatio \x3d clamp(interpolationRatio, 0.0, 1.0);\n  return u_vvSizeMinMaxValue.z + interpolationRatio * (u_vvSizeMinMaxValue.w - u_vvSizeMinMaxValue.z);\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N \x3d 6;\nfloat getVVStopsSize(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  if (sizeValue \x3c\x3d u_vvSizeFieldStopsValues[0]) {\n    return u_vvSizeFieldStopsSizes[0];\n  }\n  for (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\n    if (u_vvSizeFieldStopsValues[i] \x3e\x3d sizeValue) {\n      float f \x3d (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\n      return mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\n    }\n  }\n  return u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  return u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N \x3d 8;\nfloat getVVOpacity(float opacityValue, float isOpacityLocked) {\n  if (isNan(opacityValue) || isOpacityLocked \x3d\x3d 1.0) {\n    return 1.0;\n  }\n  if (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\n    return u_vvOpacities[0];\n  }\n  for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n    if (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\n      float f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\n    }\n  }\n  return u_vvOpacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\n  if (isNan(rotationValue)) {\n    return mat4(1, 0, 0, 0,\n                0, 1, 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1);\n  }\n  float rotation \x3d rotationValue;\n  if (u_vvRotationType \x3d\x3d 1.0) {\n    rotation \x3d 90.0 - rotation;\n  }\n  float angle \x3d C_DEG_TO_RAD * rotation;\n  float sinA \x3d sin(angle);\n  float cosA \x3d cos(angle);\n  return mat4(cosA, sinA, 0, 0,\n              -sinA,  cosA, 0, 0,\n              0,     0, 1, 0,\n              0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\n  if (isNan(rotationValue)) {\n    return mat3(1, 0, 0,\n                0, 1, 0,\n                0, 0, 1);\n  }\n  float rotation \x3d rotationValue;\n  if (u_vvRotationType \x3d\x3d 1.0) {\n    rotation \x3d 90.0 - rotation;\n  }\n  float angle \x3d C_DEG_TO_RAD * -rotation;\n  float sinA \x3d sin(angle);\n  float cosA \x3d cos(angle);\n  return mat3(cosA, -sinA, 0,\n             sinA, cosA, 0,\n              0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N \x3d 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\n  if (isNan(colorValue) || isColorLocked \x3d\x3d 1.0) {\n    return fallback;\n  }\n  if (colorValue \x3c\x3d u_vvColorValues[0]) {\n    return u_vvColors[0];\n  }\n  for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n    if (u_vvColorValues[i] \x3e\x3d colorValue) {\n      float f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\n    }\n  }\n  return u_vvColors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\n  return getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\n  return u_vvSizeScaleStopsValue;\n#elif defined(VV_SIZE_FIELD_STOPS)\n  float outSize \x3d getVVStopsSize(vvSize, size);\n  return isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_UNIT_VALUE)\n  return getVVUnitValue(vvSize, size);\n#else\n  return size;\n#endif\n}"},
raster:{bitmap:{"bitmap.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform highp vec2 u_coordScale;\n#include \x3cfiltering/bicubic.glsl\x3e\nvoid main() {\n#ifdef BICUBIC\n  vec4 color \x3d sampleBicubicBSpline(u_texture, v_texcoord, u_coordScale);\n#else\n  vec4 color \x3d texture2D(u_texture, v_texcoord);\n#endif\n  gl_FragColor \x3d vec4(color.rgb * color.a, color.a);\n}","bitmap.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},
common:{"common.glsl":"uniform sampler2D u_image;\nuniform int u_bandCount;\nuniform bool u_isFloatTexture;\nuniform bool u_flipY;\nuniform bool u_applyTransform;\nuniform float u_opacity;\nuniform int u_resampling;\n#include \x3craster/common/projection.glsl\x3e\nvec2 getPixelLocation(vec2 coords) {\n  vec2 targetLocation \x3d u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n  if (!u_applyTransform) {\n    return targetLocation;\n  }\n  return projectPixelLocation(targetLocation);\n}\nbool isOutside(vec2 coords){\n   if (coords.t\x3e1.00001 ||coords.t\x3c-0.00001 || coords.s\x3e1.00001 ||coords.s\x3c-0.00001) {\n     return true;\n   } else {\n     return false;\n   }\n}\nvec4 getPixel(vec2 pixelLocation) {\n  return texture2D(u_image, pixelLocation);\n}",
"contrastBrightness.glsl":"uniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nvec4 adjustContrastBrightness(vec4 currentPixel, bool isFloat) {\n  vec4 pixelValue \x3d isFloat ? currentPixel * 255.0 : currentPixel;\n  float maxI \x3d 255.0;\n  float mid \x3d 128.0;\n  float c \x3d u_contrastOffset;\n  float b \x3d u_brightnessOffset;\n  vec4 v;\n  if (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\n    v \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n  } else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\n    v \x3d (200.0 * pixelValue - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n  } else if (c \x3d\x3d 100.0) {\n    v \x3d (200.0 * pixelValue - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\n    v \x3d (sign(v) + 1.0) / 2.0;\n  } else if (c \x3d\x3d -100.0) {\n    v \x3d vec4(mid, mid, mid, currentPixel.a);\n  }\n  return vec4(v.r / 255.0, v.g / 255.0, v.b / 255.0, currentPixel.a);\n}",
"projection.glsl":"uniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nuniform vec2 u_srcImageSize;\nvec2 projectPixelLocation(vec2 coords) {\n  vec2 index_image \x3d floor(coords * u_targetImageSize);\n  vec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\n  vec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\n  vec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\n  vec2 srcLocation;\n  vec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\n  if (pos.s \x3c\x3d pos.t) {\n    vec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\n    vec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\n    srcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\n    srcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n  } else {\n    vec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\n    vec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\n    srcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\n    srcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n  }\n  return srcLocation;\n}"},
lut:{"colorize.glsl":"uniform sampler2D u_colormap;\nuniform float u_colormapOffset;\nuniform float u_colormapMaxIndex;\nvec4 colorize(vec4 currentPixel, bool isFloat) {\n  float clrIndex \x3d isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;\n  vec4 result;\n  if (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_colormapMaxIndex) {\n    result \x3d vec4(0.0, 0.0, 0.0, 0.0);\n  } else {\n    vec2 clrPosition \x3d vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);\n    vec4 color \x3d texture2D(u_colormap, clrPosition);\n    result \x3d vec4(color.rgb, color.a * u_opacity);\n  }\n  return result;\n}",
"lut.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\n#include \x3craster/lut/colorize.glsl\x3e\nvoid main() {\n  vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n  if (isOutside(pixelLocation)) {\n     gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n     return;\n  }\n  vec4 currentPixel \x3d getPixel(pixelLocation);\n  gl_FragColor \x3d colorize(currentPixel, true);\n}","lut.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"},
stretch:{"stretch.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\n#include \x3craster/common/common.glsl\x3e\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput;\nuniform float u_maxOutput;\nuniform float u_factor[3];\nuniform bool u_useGamma;\nuniform float u_gamma[3];\nuniform float u_gammaCorrection[3];\nuniform bool u_applyColormap;\n#include \x3craster/lut/colorize.glsl\x3e\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {\n  if (val \x3e\x3d maxCutOff) {\n    return maxOutput;\n  } else if (val \x3c\x3d minCutOff) {\n    return minOutput;\n  }\n  float stretchedVal;\n  if (useGamma) {\n  \tfloat tempf \x3d 1.0;\n\t  float outRange \x3d maxOutput - minOutput;\n\t  float relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\n\t  if (gamma \x3e 1.0) {\n      tempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n    }\n    stretchedVal \x3d floor(tempf * outRange * pow(relativeVal, 1.0 / gamma)) + minOutput;\n  } else {\n    stretchedVal \x3d minOutput + (val - minCutOff) * factor;\n  }\n  return stretchedVal;\n}\nvoid main() {\n  vec2 pixelLocation \x3d getPixelLocation(v_texcoord);\n  if (isOutside(pixelLocation)) {\n     gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n     return;\n  }\n  vec4 currentPixel \x3d getPixel(pixelLocation);\n  if (currentPixel.a \x3d\x3d 0.0) {\n    gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\n    return;\n  }\n  if (u_bandCount \x3d\x3d 1) {\n    float grayVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n    if (u_applyColormap) {\n      gl_FragColor \x3d colorize(vec4(grayVal, grayVal, grayVal, currentPixel.a), true);\n    } else {\n      gl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n    }\n  } else {\n    float redVal \x3d stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);\n    float greenVal \x3d stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);\n    float blueVal \x3d stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);\n    gl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n  }\n}",
"stretch.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\n  v_texcoord \x3d a_pos;\n  gl_Position \x3d vec4(u_dvsMat3 * vec3(a_pos * u_coordScale, 1.0), 1.0);\n}"}},stencil:{"stencil.frag":"void main() {\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nvoid main() {\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\n  gl_FragColor \x3d 0.75 * color;\n}",
"tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\n  mediump vec2 offset \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\n  vec3 v_pos \x3d u_dvsMat3 * vec3(offset, 1.0);\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n  v_tex \x3d a_pos;\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}"}}})},
"esri/views/2d/engine/webgl/shaders/TileInfoPrograms":function(){define(["require","exports","./sources/resolver"],function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});d.tileInfo={name:"tileInfo",shaders:{vertexShader:f.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:f.resolveIncludes("tileInfo/tileInfo.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/brushes/WGLBrushStencil":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ./WGLBrush ../shaders/BackgroundPrograms".split(" "),
function(b,d,f,h,e,a,q){Object.defineProperty(d,"__esModule",{value:!0});b=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c._color=h.vec4f32.fromValues(1,0,0,1);c._initialized=!1;return c}f(c,a);c.prototype.dispose=function(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)};c.prototype.prepareState=function(c,a){c=c.context;c.setDepthWriteEnabled(!1);
c.setDepthTestEnabled(!1);c.setStencilTestEnabled(!0);c.setBlendingEnabled(!1);c.setColorMask(!1,!1,!1,!1);c.setStencilOp(7680,7680,7681);c.setStencilWriteMask(255);c.setStencilFunctionSeparate(1032,516,a.stencilRef,255)};c.prototype.draw=function(c,a){c=c.context;this._initialized||this._initialize(c);c.bindVAO(this._solidVertexArrayObject);c.bindProgram(this._solidProgram);this._solidProgram.setUniformMatrix3fv("u_dvsMat3",a.transforms.dvs);this._solidProgram.setUniform2fv("u_coord_range",a.coordRange);
this._solidProgram.setUniform1f("u_depth",0);this._solidProgram.setUniform4fv("u_color",this._color);c.drawArrays(5,0,4);c.bindVAO()};c.prototype._initialize=function(c){if(this._initialized)return!0;var a=e.createProgram(c,q.background);if(!a)return!1;var l=new Int8Array([0,0,1,0,0,1,1,1]),l=e.BufferObject.createVertex(c,35044,l);c=new e.VertexArrayObject(c,q.background.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:l});this._solidProgram=
a;this._solidVertexArrayObject=c;return this._initialized=!0};return c}(a.default);d.default=b})},"esri/views/2d/engine/RasterTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./RasterBitmap ./webgl/TiledDisplayObject".split(" "),function(b,d,f,h,e,a){Object.defineProperty(d,"__esModule",{value:!0});b=function(a){function m(c,l,k,n){void 0===n&&(n=null);var m=a.call(this,c,l,k)||this;c=m.requestRender.bind(m);m.bitmap=new e.RasterBitmap(n,
null,null,c);m.bitmap.coordScale=k;m.bitmap.once("isReady",function(){return m.ready()});return m}f(m,a);Object.defineProperty(m.prototype,"stencilRef",{get:function(){return this.bitmap.stencilRef},set:function(c){this.bitmap.stencilRef=c},enumerable:!0,configurable:!0});m.prototype.setTransform=function(c,l){a.prototype.setTransform.call(this,c,l);this.bitmap.transforms.dvs=this.transforms.dvs};m.prototype.attach=function(){this.bitmap.stage=this.stage;var c=this.bitmap.attach();c&&(this.bitmap.attached=
!0);return c};m.prototype.detach=function(){this.bitmap.detach()};return m}(a.TiledDisplayObject);d.RasterTile=b})},"esri/views/2d/engine/RasterBitmap":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/assignHelper ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/vec2f32 ../../../layers/support/rasterFunctions/pixelUtils ./DisplayObject ./webgl/WGLRasterUtils".split(" "),function(b,d,f,h,e,a,q,
m,c,l){function k(c){r.has(c)&&(n.splice(n.indexOf(c),1),r.delete(c))}Object.defineProperty(d,"__esModule",{value:!0});var n=[],r=new Set,g={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"};b=function(c){function n(g,k,l,n){void 0===g&&(g=null);void 0===k&&(k=null);void 0===l&&(l=null);void 0===n&&(n=function(){return null});var m=c.call(this)||this;
m.stencilRef=0;m.coordScale=[1,1];m._symbolizerParameters=null;m.height=null;m.pixelRatio=1;m.resolution=0;m.rotation=0;m._source=null;m.rawPixelBlock=null;m._suspended=!1;m._bandIds=null;m._interpolation=null;m._transformGrid=null;m.width=null;m.x=0;m.y=0;m.transforms={dvs:a.mat3f32.create()};m.source=g;m.transformGrid=k;m.interpolation=l;m.requestRender=n;return m}f(n,c);Object.defineProperty(n.prototype,"symbolizerParameters",{get:function(){return this._symbolizerParameters||g},set:function(c){this._symbolizerParameters=
c},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"source",{get:function(){return this._source},set:function(c){this._source=c;this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"suspended",{get:function(){return this._suspended},set:function(c){this._suspended&&!c&&this.attached&&(this.ready(),this.requestRender());this._suspended=c},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,
"bandIds",{get:function(){return this._bandIds},set:function(c){this.attached&&this._updateRasterTexture(c);this._bandIds=c},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"interpolation",{get:function(){return this._interpolation},set:function(c){this._interpolation=c;this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===c?9729:9728)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"transformGrid",{get:function(){return this._transformGrid},set:function(c){this._transformGrid=
c;this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null)},enumerable:!0,configurable:!0});n.prototype.attach=function(){this.updateTexture();return!0};n.prototype.detach=function(){this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null);this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null);this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null);k(this)};n.prototype.invalidateTexture=
function(){this.attached?this.updateTexture():k(this)};n.prototype.setTransform=function(c){var a=e.mat3.identity(this.transforms.dvs),g=c.toScreenNoRotation([0,0],this.x,this.y),k=this.resolution/this.pixelRatio/c.resolution,l=k*this.width,k=k*this.height,n=Math.PI*this.rotation/180;e.mat3.translate(a,a,q.vec2f32.fromValues(g[0],g[1]));e.mat3.translate(a,a,q.vec2f32.fromValues(l/2,k/2));e.mat3.rotate(a,a,-n);e.mat3.translate(a,a,q.vec2f32.fromValues(-l/2,-k/2));e.mat3.scaleByVec2(a,a,q.vec2f32.fromValues(l,
k));e.mat3.multiply(this.transforms.dvs,c.displayViewMat3,a)};n.prototype.updateTexture=function(){var c=this.stage.context,a=this.source,a=a&&a.pixels&&0<a.pixels.length;!this._rasterTexture&&a&&this._updateRasterTexture(this.bandIds);this._rasterTexture&&a&&(this._updateColormapTexture(),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=l.createTransformTexture(c,this.transformGrid)));this._rasterTexture&&!a&&this._rasterTexture.setData(null);this.suspended||(this.ready(),
this.requestRender())};n.prototype.getUniforms=function(){var c=this.source,a=this.transformGrid,g;switch(this.symbolizerParameters.type){case "lut":g=this._getColormapUniforms();break;case "stretch":g=this._getStretchUniforms()}c=h({},g,{u_srcImageSize:[c.width,c.height],u_resampling:"nearest",u_flipY:!0,u_applyTransform:a?!0:!1,u_dvsMat3:this.transforms.dvs});this.transformGrid&&(c.u_transformSpacing=a.spacing,c.u_transformGridSize=a.size,c.u_targetImageSize=new Float32Array([this.width,this.height]));
return c};n.prototype.getTextures=function(){if(!this._rasterTexture)return null;var c=[],a=[];this._transformGridTexture&&(a.push(this._transformGridTexture),c.push("u_transformGrid"));this._rasterTexture&&(a.push(this._rasterTexture),c.push("u_image"));this._colormapTexture&&(a.push(this._colormapTexture),c.push("u_colormap"));return{names:c,textures:a}};n.prototype._getColormapUniforms=function(){var c=this.symbolizerParameters;return{u_colormapOffset:c.colormapOffset||0,u_colormapMaxIndex:c.colormap.length/
4-1,u_isFloatTexture:!1}};n.prototype._getStretchUniforms=function(){var c=this.symbolizerParameters,a={u_bandCount:c.bandCount,u_minOutput:c.outMin,u_maxOutput:c.outMax,u_minCutOff:c.minCutOff,u_maxCutOff:c.maxCutOff,u_factor:c.factor,u_useGamma:c.useGamma,u_gamma:c.gamma,u_gammaCorrection:c.gammaCorrection,u_contrast:c.contrast,u_brightness:c.brightness};c.colormap&&(a.u_colormapOffset=c.colormapOffset||0,a.u_colormapMaxIndex=c.colormap.length/4-1,a.u_isFloatTexture=!1,a.u_applyColormap=!0);return a};
n.prototype._updateRasterTexture=function(c){var a=this.source?m.extractBands(this.source,c):null;if(a&&a.pixels&&0<a.pixels.length){c=null==c&&null==this.bandIds||c&&this.bandIds&&c.join("")===this.bandIds.join("");if(this._rasterTexture){if(c)return;this._rasterTexture.dispose();this._rasterTexture=null}this._rasterTexture=l.createRasterTexture(this.stage.context,a,this.interpolation||"nearest")}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null)};n.prototype._updateColormapTexture=
function(){var c=this._colormap,a=this.symbolizerParameters.colormap;if(a){var g=this.stage.context;if(!c)this._colormapTexture=l.createColormapTexture(g,a),this._colormap=a;else if(a.length!==c.length||a.some(function(a,g){return a!==c[g]}))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=l.createColormapTexture(g,a),this._colormap=a}else this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null};
return n}(c.DisplayObject);d.RasterBitmap=b})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["require","exports","../PixelBlock"],function(b,d,f){function h(a,c){a=Math.min(Math.max(a,-100),100);c=Math.min(Math.max(c,-100),100);var l,k,n=new Uint8Array(256);for(l=0;256>l;l++)0<a&&100>a?k=(200*l-25500+510*c)/(2*(100-a))+128:0>=a&&-100<a?k=(200*l-25500+510*c)*(100+a)/2E4+128:100===a?(k=200*l-25500+256*(100-a)+510*c,k=0<k?255:0):-100===a&&(k=128),n[l]=255<k?255:0>k?0:k;return n}
function e(a,c,l,k,n,b,g,e){return{xmin:n<=l*a?0:n<l*a+a?n-l*a:a,ymin:b<=k*c?0:b<k*c+c?b-k*c:c,xmax:n+g<=l*a?0:n+g<l*a+a?n+g-l*a:a,ymax:b+e<=k*c?0:b+e<k*c+c?b+e-k*c:c}}function a(a,c,l,k){var n=a.filter(function(c){return q(c)})[0];if(null==n)return null;var m=k?k.width:c.width;k=k?k.height:c.height;var g=n.width,b=n.height,t=c.width/g;c=c.height/b;var d=l?l.x:0;l=l?l.y:0;var h=n.pixelType,A=f.getPixelArrayConstructor(h),p=n.pixels.length,n=[],w,v,z,B,C,D,G,F,E,H;for(C=0;C<p;C++){v=new A(m*k);for(D=
0;D<c;D++)for(G=0;G<t;G++)if(z=a[D*t+G])for(w=z.pixels[C],H=e(g,b,G,D,d,l,m,k),F=H.ymin;F<H.ymax;F++)for(z=(D*b+F-l)*m+(G*g-d),B=F*g,E=H.xmin;E<H.xmax;E++)v[z+E]=w[B+E];n.push(v)}var J;if(a.some(function(c){return null==c||c.mask&&0<c.mask.length}))for(J=new Uint8Array(m*k),D=0;D<c;D++)for(G=0;G<t;G++)if(A=(z=a[D*t+G])?z.mask:null,H=e(g,b,G,D,d,l,m,k),A)for(F=H.ymin;F<H.ymax;F++)for(z=(D*b+F-l)*m+(G*g-d),B=F*g,E=H.xmin;E<H.xmax;E++)J[z+E]=A[B+E];else if(z)for(F=H.ymin;F<H.ymax;F++)for(z=(D*b+F-l)*
m+(G*g-d),B=F*g,E=H.xmin;E<H.xmax;E++)J[z+E]=1;else for(F=H.ymin;F<H.ymax;F++)for(z=(D*b+F-l)*m+(G*g-d),B=F*g,E=H.xmin;E<H.xmax;E++)J[z+E]=0;a=new f({width:m,height:k,pixels:n,pixelType:h,mask:J});a.updateStatistics();return a}Object.defineProperty(d,"__esModule",{value:!0});var q=function(a){return a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length};d.extractBands=function(a,c){if(!c||!q(a))return a;var l=a.pixels.length;return c&&c.some(function(c){return c>=l})||
1===l&&1===c.length&&0===c[0]||l===c.length&&!c.some(function(c,a){return c!==a})?a:new f({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:c.map(function(c){return a.pixels[c]}),statistics:a.statistics&&c.map(function(c){return a.statistics[c]})})};d.createColormapLUT=function(a){if(a){var c=a.colormap;if(c&&0!==c.length){var c=c.sort(function(c,a){return c[0]-a[0]}),l=0;0>c[0][0]&&(l=c[0][0]);var k=Math.max(256,c[c.length-
1][0]-l+1),n=new Uint8Array(4*k),b=[],g=0,e=0,m=5===c[0].length;if(65536<k)return c.forEach(function(c){b[c[0]-l]=m?c.slice(1):c.slice(1).concat([255])}),{indexed2DColormap:b,offset:l,alphaSpecified:m};if(a.fillUnspecified)for(a=c[e],g=a[0]-l;g<k;g++)n[4*g]=a[1],n[4*g+1]=a[2],n[4*g+2]=a[3],n[4*g+3]=m?a[4]:255,g===a[0]-l&&(a=e===c.length-1?a:c[++e]);else for(g=0;g<c.length;g++)a=c[g],e=4*(a[0]-l),n[e]=a[1],n[e+1]=a[2],n[e+2]=a[3],n[e+3]=m?a[4]:255;return{indexedColormap:n,offset:l,alphaSpecified:m}}}};
d.colorize=function(a,c){if(!q(a)||!c&&(c.indexedColormap||c.indexed2DColormap))return a;var l=a.clone(),k=l.pixels,n=l.mask,b=l.width*l.height;if(1!==k.length)return a;var g=c.indexedColormap;a=c.indexed2DColormap;var e=c.offset;c=c.alphaSpecified;var m=g.length-1,d=0,k=k[0],f=new Uint8Array(k.length),h=new Uint8Array(k.length),p=new Uint8Array(k.length),w=0;if(g)if(n)for(d=0;d<b;d++)n[d]&&(w=4*(k[d]-e),w<e||w>m?n[d]=0:(f[d]=g[w],h[d]=g[w+1],p[d]=g[w+2],n[d]=g[w+3]));else{n=new Uint8Array(b);for(d=
0;d<b;d++)w=4*(k[d]-e),w<e||w>m?n[d]=0:(f[d]=g[w],h[d]=g[w+1],p[d]=g[w+2],n[d]=g[w+3]);l.mask=n}else if(n)for(d=0;d<b;d++)n[d]&&(g=a[k[d]],f[d]=g[0],h[d]=g[1],p[d]=g[2],n[d]=g[3]);else{n=new Uint8Array(b);for(d=0;d<b;d++)g=a[k[d]],f[d]=g[0],h[d]=g[1],p[d]=g[2],n[d]=g[3];l.mask=n}l.pixels=[f,h,p];l.statistics=null;l.pixelType="u8";l.maskIsAlpha=c;return l};d.estimateStatisticsHistograms=function(a){if(!q(a))return null;a.statistics||a.updateStatistics();var c=a.pixels,l=a.mask,k=a.pixelType,n=a.statistics;
a=a.width*a.height;var b=c.length,g,e,m,d,f,h=[],p=[],w,v,z;for(d=0;d<b;d++){w=new Uint32Array(256);z=c[d];if("u8"===k)if(g=-.5,e=255.5,l)for(f=0;f<a;f++)l[f]&&w[z[f]]++;else for(f=0;f<a;f++)w[z[f]]++;else{g=n[d].minValue;e=n[d].maxValue;m=(e-g)/256;v=new Uint32Array(257);if(l)for(f=0;f<a;f++)l[f]&&v[Math.floor((z[f]-g)/m)]++;else for(f=0;f<a;f++)v[Math.floor((z[f]-g)/m)]++;for(f=0;255>f;f++)w[f]=v[f];w[255]=v[255]+v[256]}h.push({min:g,max:e,size:256,counts:w});for(f=z=v=m=0;256>f;f++)m+=w[f],v+=
f*w[f];v/=m;for(f=0;256>f;f++)z+=w[f]*Math.pow(f-v,2);w=Math.sqrt(z/(m-1));m=(e-g)/256;f=(v+.5)*m+g;w*=m;p.push({min:g,max:e,avg:f,stddev:w})}return{statistics:p,histograms:h}};d.createStretchLUT=function(a){var c=a.minCutOff,l=a.maxCutOff,k=a.gamma,n=a.pixelType,b=a.outMin||0,g=a.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(n))return null;var e=c.length,m,d=0;"s8"===n?d=-127:"s16"===n&&(d=-32767);var f=256;-1<["u16","s16"].indexOf(n)&&(f=65536);for(var q=[],p=g-b,n=0;n<e;n++)q[n]=l[n]-c[n];
m=k&&k.length>=e;var w=[];if(m)for(n=0;n<e;n++)w[n]=1<k[n]?2<k[n]?6.5+Math.pow(k[n]-2,2.5):6.5+100*Math.pow(2-k[n],4):1;var v,z=[],B,C,D;if(m)for(n=0;n<e;n++){D=[];for(m=0;m<f;m++)B=m+d,v=(B-c[n])/q[n],C=1,1<k[n]&&(C-=Math.pow(1/p,v*w[n])),D[m]=B<l[n]&&B>c[n]?Math.floor(C*p*Math.pow(v,1/k[n]))+b:B>=l[n]?g:b;z[n]=D}else for(n=0;n<e;n++){D=[];for(m=0;m<f;m++)B=m+d,D[m]=B<=c[n]?b:B>=l[n]?g:Math.floor((B-c[n])/q[n]*p)+b;z[n]=D}if(null!=a.contrastOffset)for(a=h(a.contrastOffset,a.brightnessOffset),n=0;n<
e;n++)for(D=z[n],m=0;m<f;m++)D[m]=a[D[m]];return{lut:z,offset:d}};d.createContrastBrightnessLUT=h;d.stretch=function(a,c){if(!q(a))return null;a=a.clone();var l=a.pixels,k=a.mask,n=c.minCutOff,b=c.maxCutOff,g=c.gamma,e=c.outMin||0;c=c.outMax||255;var m=a.width*a.height,d=l.length,f,h,p,w,v,z=c-e,B=[];for(f=0;f<d;f++)B[f]=b[f]-n[f];h=g&&g.length>=d;var C=[];if(h)for(f=0;f<d;f++)C[f]=1<g[f]?2<g[f]?6.5+Math.pow(g[f]-2,2.5):6.5+100*Math.pow(2-g[f],4):1;if(h)if(null!=k)for(h=0;h<m;h++){if(k[h])for(f=0;f<
d;f++)p=l[f][h],v=(p-n[f])/B[f],w=1,1<g[f]&&(w-=Math.pow(1/z,v*C[f])),l[f][h]=p<b[f]&&p>n[f]?Math.floor(w*z*Math.pow(v,1/g[f]))+e:p>=b[f]?c:e}else for(h=0;h<m;h++)for(f=0;f<d;f++)p=l[f][h],v=(p-n[f])/B[f],w=1,1<g[f]&&(w-=Math.pow(1/z,v*C[f])),l[f][h]=p<b[f]&&p>n[f]?Math.floor(w*z*Math.pow(v,1/g[f]))+e:p>=b[f]?c:e;else if(null!=k)for(h=0;h<m;h++){if(k[h])for(f=0;f<d;f++)p=l[f][h],l[f][h]=p<b[f]&&p>n[f]?Math.floor((p-n[f])/B[f]*z)+e:p>=b[f]?c:e}else for(h=0;h<m;h++)for(f=0;f<d;f++)p=l[f][h],l[f][h]=
p<b[f]&&p>n[f]?Math.floor((p-n[f])/B[f]*z)+e:p>=b[f]?c:e;a.pixelType="u8";a.updateStatistics();return a};d.lookupPixels=function(a,c){if(!q(a))return null;var l=a.pixels,k=a.mask,n=a.width*a.height,b=l.length,g=c.lut;c=c.offset;var e,m;g&&1===g[0].length&&(g=l.map(function(){return g}));var d=[],h,A,p;if(c)if(null==k)for(e=0;e<b;e++){h=l[e];A=g[e];p=new Uint8Array(n);for(m=0;m<n;m++)p[m]=A[h[m]-c];d.push(p)}else for(e=0;e<b;e++){h=l[e];A=g[e];p=new Uint8Array(n);for(m=0;m<n;m++)k[m]&&(p[m]=A[h[m]-
c]);d.push(p)}else if(null==k)for(e=0;e<b;e++){h=l[e];A=g[e];p=new Uint8Array(n);for(m=0;m<n;m++)p[m]=A[h[m]];d.push(p)}else for(e=0;e<b;e++){h=l[e];A=g[e];p=new Uint8Array(n);for(m=0;m<n;m++)k[m]&&(p[m]=A[h[m]]);d.push(p)}a=new f({width:a.width,height:a.height,pixels:d,mask:k,pixelType:"u8"});a.updateStatistics();return a};d.remapColor=function(a,c){if(!q(a))return null;a=a.clone();var l=a.width*a.height,k=c.length,n=Math.floor(k/2),e=c[Math.floor(n)],g=a.pixels[0],b,m,d,f,h,p,w=!1,v=new Uint8Array(l),
z=new Uint8Array(l),B=new Uint8Array(l),C=a.mask,D=4===c[0].mappedColor.length;C||(C=new Uint8Array(l),C.fill(D?255:1),a.mask=C);for(h=0;h<l;h++)if(C[h]){b=g[h];w=!1;p=n;m=e;d=0;for(f=k-1;1<f-d;){if(b===m.value){w=!0;break}b>m.value?d=p:f=p;p=Math.floor((d+f)/2);m=c[Math.floor(p)]}w||(b===c[d].value?(m=c[d],w=!0):b===c[f].value?(m=c[f],w=!0):b<c[d].value?(w=!1,m=null):b>c[d].value&&(b<c[f].value?(m=c[d],w=!0):f===k-1?(w=!1,m=null):(m=c[f],w=!0)));w?(v[h]=m.mappedColor[0],z[h]=m.mappedColor[1],B[h]=
m.mappedColor[2],C[h]=m.mappedColor[3]):v[h]=z[h]=B[h]=C[h]=0}a.pixels=[v,z,B];a.mask=C;a.pixelType="u8";a.maskIsAlpha=D;return a};d.getClipBounds=e;d.mosaicPixelData=function(e,c){if(!e||0===e.length)return null;var l=e.filter(function(c){return c.pixelBlock})[0];if(!l)return null;var k=(l.extent.xmax-l.extent.xmin)/l.pixelBlock.width,n=(l.extent.ymax-l.extent.ymin)/l.pixelBlock.height,b=.01*Math.min(k,n),g=e.sort(function(c,a){return Math.abs(c.extent.ymax-a.extent.ymax)>b?a.extent.ymax-c.extent.ymax:
Math.abs(c.extent.xmin-a.extent.xmin)>b?c.extent.xmin-a.extent.xmin:0}),m=Math.min.apply(null,g.map(function(c){return c.extent.xmin})),d=Math.min.apply(null,g.map(function(c){return c.extent.ymin})),f=Math.max.apply(null,g.map(function(c){return c.extent.xmax})),h=Math.max.apply(null,g.map(function(c){return c.extent.ymax}));e={x:Math.round((c.xmin-m)/k),y:Math.round((h-c.ymax)/n)};m={width:Math.round((f-m)/k),height:Math.round((h-d)/n)};k={width:Math.round((c.xmax-c.xmin)/k),height:Math.round((c.ymax-
c.ymin)/n)};if(Math.round(m.width/l.pixelBlock.width)*Math.round(m.height/l.pixelBlock.height)!==g.length||0>e.x||0>e.y||m.width<k.width||m.height<k.height)return null;l=g.map(function(c){return c.pixelBlock});l=a(l,m,e,k);return{extent:c,pixelBlock:l}};d.mosaic=a;d.setValidBoundary=function(a,c,l){if(!q(a))return null;var k=a.width,n=a.height,e=c.x;c=c.y;var g=l.width+e;l=l.height+c;if(0>e||0>c||g>k||l>n||0===e&&0===c&&g===k&&l===n)return a;a.mask||(a.mask=new Uint8Array(k*n));for(var b=a.mask,m=
0;m<n;m++)for(var d=m*k,f=0;f<k;f++)b[d+f]=m<c||m>=l||f<e||f>=g?0:1;a.updateStatistics();return a};d.clip=function(a,c,l){if(!q(a))return null;var k=c.x,e=c.y,b=c.x+l.width;c=c.x+l.height;if(c===a.height&&b===a.width)return a;for(var g=a.pixels,m=a.mask,d=a.width,h=d*a.height,y=g.length,A=[],p=0;p<y;p++){for(var w=g[p],v=f.createEmptyBand(a.pixelType,h),z=0,B=e;B<=c;B++)for(var C=B*d,D=k;D<=b;D++)v[z++]=w[C+D];A.push(v)}var G;if(m)for(G=new Uint8Array(l.width*l.height),z=0,B=e;B<=c;B++)for(C=B*d,
D=k;D<=b;D++)G[z++]=m[C+D];a=new f({width:l.width,height:l.height,pixels:A,mask:G});a.updateStatistics();return a};d.approximateTransform=function(a,c,l,k){if(!q(a))return null;var e=a.pixels,b=a.mask,g=a.pixelType,m=a.width,d=a.height;a=f.getPixelArrayConstructor(g);var h=e.length,y=c.width,A=c.height;c=k.cols;var p=k.rows,w=Math.ceil(y/c),v=Math.ceil(A/p),z=!1;for(k=0;k<l.length;k+=3)-1===l[k]&&-1===l[k+1]&&-1===l[k+2]&&(z=!0);var B,C,D,G,F,E,H,J=new Float32Array(y*A),K=new Float32Array(y*A),I=
0,M,N;for(k=0;k<v;k++)for(var L=0;L<w;L++){B=12*(k*w+L);C=l[B];D=l[B+1];G=l[B+2];F=l[B+3];E=l[B+4];H=l[B+5];for(var Q=0;Q<p;Q++){I=(k*p+Q)*y+L*c;N=(Q+.5)/p;for(var P=0;P<Q;P++)M=(P+.5)/c,J[I+P]=Math.round((C*M+D*N+G)*m-.5),K[I+P]=Math.round((F*M+E*N+H)*d-.5)}B+=6;C=l[B];D=l[B+1];G=l[B+2];F=l[B+3];E=l[B+4];H=l[B+5];for(Q=0;Q<p;Q++)for(I=(k*p+Q)*y+L*c,N=(Q+.5)/p,P=Q;P<c;P++)M=(P+.5)/c,J[I+P]=Math.round((C*M+D*N+G)*m-.5),K[I+P]=Math.round((F*M+E*N+H)*d-.5)}l=function(c,a){for(var g=0;g<A;g++){B=g*y;
for(var k=0;k<y;k++)c[B]=z&&(0>J[B]||0>K[B])?0:a[J[B]+K[B]*m],B++}};d=[];for(k=0;k<h;k++)c=new a(y*A),l(c,e[k]),d.push(c);e=new f({width:y,height:A,pixelType:g,pixels:d});if(b)e.mask=new Uint8Array(y*A),l(e.mask,b);else if(z)for(e.mask=new Uint8Array(y*A),k=0;k<y*A;k++)e.mask[k]=0>J[k]||0>K[k]?0:1;e.updateStatistics();return e}})},"esri/layers/support/PixelBlock":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/compilerUtils ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),
function(b,d,f,h,e,a,q,m,c,l){var k=c.getLogger("esri.layers.support.PixelBlock");return function(c){function b(a){a=c.call(this,a)||this;a.width=null;a.height=null;a.pixelType="f32";a.validPixelCount=null;a.mask=null;a.maskIsAlpha=!1;a.pixels=null;a.statistics=null;return a}f(b,c);g=b;b.createEmptyBand=function(c,a){return new (g.getPixelArrayConstructor(c))(a)};b.getPixelArrayConstructor=function(c){var a;switch(c){case "u1":case "u2":case "u4":case "u8":a=Uint8Array;break;case "u16":a=Uint16Array;
break;case "u32":a=Uint32Array;break;case "s8":a=Int8Array;break;case "s16":a=Int16Array;break;case "s32":a=Int32Array;break;case "u32":a=Uint32Array;break;case "f32":a=Float32Array;break;case "f64":a=Float64Array;break;case "c64":case "c128":case "unknown":a=Float32Array;break;default:e.neverReached(c)}return a};b.prototype.castPixelType=function(c){if(!c)return"f32";c=c.toLowerCase();-1<["u1","u2","u4"].indexOf(c)?c="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(c)&&(c="f32");
return c};b.prototype.getPlaneCount=function(){return this.pixels&&this.pixels.length};b.prototype.addData=function(c){if(!c.pixels||c.pixels.length!==this.width*this.height)throw new a("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(c.pixels);this.statistics.push(c.statistics||{minValue:null,maxValue:null})};b.prototype.getAsRGBA=
function(){var c=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(c);break;default:this._fillFrom8Bit(c)}return new Uint8ClampedArray(c)};b.prototype.getAsRGBAFloat=function(){var c=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(c);return c};b.prototype.updateStatistics=function(){var c=this;this.statistics=this.pixels.map(function(a){return c._calculateBandStatistics(a,
c.mask)});var a=this.mask,g=0;if(a)for(var k=0;k<a.length;k++)a[k]&&g++;else g=this.width*this.height;this.validPixelCount=g};b.prototype.clamp=function(c){if(c&&"f64"!==c&&"f32"!==c){var a;switch(c){case "u8":a=[0,255];break;case "u16":a=[0,65535];break;case "u32":a=[0,4294967295];break;case "s8":a=[-128,127];break;case "s16":a=[-32768,32767];break;case "s32":a=[-2147483648,2147483647];break;default:a=[-3.4*1E39,3.4*1E39]}var k=a[0];a=a[1];for(var l=this.pixels,b=this.width*this.height,e=l.length,
n,d,m,f=[],r=0;r<e;r++){m=g.createEmptyBand(c,b);n=l[r];for(var h=0;h<b;h++)d=n[h],m[h]=d>a?a:d<k?k:d;f.push(m)}this.pixels=f;this.pixelType=c}};b.prototype.clone=function(){var c=new g({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(c.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));var a,k=g.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){c.pixels=
[];var l=this.pixels[0].slice;for(a=0;a<this.pixels.length;a++)c.pixels[a]=l?this.pixels[a].slice(0,this.pixels[a].length):new k(this.pixels[a])}if(this.statistics)for(c.statistics=[],a=0;a<this.statistics.length;a++)c.statistics[a]=m.clone(this.statistics[a]);return c};b.prototype._fillFrom8Bit=function(c){var a=this.mask,g=this.maskIsAlpha,l=this.pixels;if(c&&l&&l.length){var b,e,n;b=e=n=l[0];3<=l.length?(e=l[1],n=l[2]):2===l.length&&(e=l[1]);c=new Uint32Array(c);l=this.width*this.height;if(b.length!==
l)k.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(a&&a.length===l)if(g)for(g=0;g<l;g++)a[g]&&(c[g]=a[g]<<24|n[g]<<16|e[g]<<8|b[g]);else for(g=0;g<l;g++)a[g]&&(c[g]=-16777216|n[g]<<16|e[g]<<8|b[g]);else for(g=0;g<l;g++)c[g]=-16777216|n[g]<<16|e[g]<<8|b[g]}else k.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};b.prototype._fillFromNon8Bit=function(c){var a=this.pixels,g=this.mask,l=this.statistics;if(c&&a&&a.length){var b=this.pixelType,
e=1,n=0,e=1;l&&0<l.length?(n=l.map(function(a){return a.minValue}).reduce(function(a,c){return Math.min(a,c)}),e=l.map(function(a){return a.maxValue-a.minValue}).reduce(function(a,c){return Math.max(a,c)}),e=255/e):(e=255,"s8"===b?(n=-128,e=127):"u16"===b?e=65535:"s16"===b?(n=-32768,e=32767):"u32"===b?e=4294967295:"s32"===b?(n=-2147483648,e=2147483647):"f32"===b?(n=-3.4*1E39,e=3.4*1E39):"f64"===b&&(n=-Number.MAX_VALUE,e=Number.MAX_VALUE),e=255/(e-n));c=new Uint32Array(c);var b=this.width*this.height,
d,m,l=d=m=a[0];if(l.length!==b)return k.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=a.length)if(d=a[1],3<=a.length&&(m=a[2]),g&&g.length===b)for(a=0;a<b;a++)g[a]&&(c[a]=-16777216|(m[a]-n)*e<<16|(d[a]-n)*e<<8|(l[a]-n)*e);else for(a=0;a<b;a++)c[a]=-16777216|(m[a]-n)*e<<16|(d[a]-n)*e<<8|(l[a]-n)*e;else if(g&&g.length===b)for(a=0;a<b;a++)d=(l[a]-n)*e,g[a]&&(c[a]=-16777216|d<<16|d<<8|d);else for(a=0;a<b;a++)d=(l[a]-n)*e,c[a]=-16777216|d<<16|d<<8|d}else k.error("getAsRGBA()",
"Unable to convert to RGBA. The input pixel block is empty.")};b.prototype._fillFrom32Bit=function(a){var c=this.pixels,g=this.mask;if(!a||!c||!c.length)return k.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");var l,b,e;l=b=e=c[0];3<=c.length?(b=c[1],e=c[2]):2===c.length&&(b=c[1]);var n=this.width*this.height;if(l.length!==n)return k.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var d=0;if(g&&g.length===n)for(c=0;c<n;c++)a[d++]=
l[c],a[d++]=b[c],a[d++]=e[c],a[d++]=g[c]&1;else for(c=0;c<n;c++)a[d++]=l[c],a[d++]=b[c],a[d++]=e[c],a[d++]=1};b.prototype._calculateBandStatistics=function(a,c){var g=Infinity,k=-Infinity,l=a.length,b,e=0;if(c)for(b=0;b<l;b++)c[b]&&(e=a[b],g=e<g?e:g,k=e>k?e:k);else for(b=0;b<l;b++)e=a[b],g=e<g?e:g,k=e>k?e:k;return{minValue:g,maxValue:k}};var g;h([l.property({json:{write:!0}})],b.prototype,"width",void 0);h([l.property({json:{write:!0}})],b.prototype,"height",void 0);h([l.property({json:{write:!0}})],
b.prototype,"pixelType",void 0);h([l.cast("pixelType")],b.prototype,"castPixelType",null);h([l.property({json:{write:!0}})],b.prototype,"validPixelCount",void 0);h([l.property({json:{write:!0}})],b.prototype,"mask",void 0);h([l.property({json:{write:!0}})],b.prototype,"maskIsAlpha",void 0);h([l.property({json:{write:!0}})],b.prototype,"pixels",void 0);h([l.property({json:{write:!0}})],b.prototype,"statistics",void 0);return b=g=h([l.subclass("esri.layers.support.PixelBlock")],b)}(l.declared(q.JSONSupport))})},
"esri/views/2d/engine/webgl/WGLRasterUtils":function(){define(["require","exports","../../../webgl"],function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});d.createRasterTexture=function(b,e,a,d){void 0===a&&(a="nearest");void 0===d&&(d=!1);var m=!(d&&"u8"===e.pixelType);d=m?5126:5121;m=null==e.pixels||0===e.pixels.length?null:m?e.getAsRGBAFloat():e.getAsRGBA();return new f.Texture(b,{width:e.width,height:e.height,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:"bilinear"===
a?9729:9728,dataType:d,wrapMode:33071,flipped:!1},m)};d.createFrameBuffer=function(b,e,a,d){d=new f.Texture(b,{width:e,height:a,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:9728,dataType:d?5121:5126,wrapMode:33071,flipped:!1});return new f.FramebufferObject(b,{colorTarget:0,depthStencilTarget:3,width:e,height:a},d)};d.createTransformTexture=function(b,e){for(var a=4*e.size[0],d=e.size[1],m={width:a,height:d,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5126,samplingMode:9728,
wrapMode:33071,flipped:!1},a=new Float32Array(a*d*4),c=d=0;c<e.coefficients.length;c++)a[d++]=e.coefficients[c],2===c%3&&(a[d++]=1);return new f.Texture(b,m,a)};d.createColormapTexture=function(b,e){return new f.Texture(b,{width:e.length/4,height:1,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,flipped:!1},e)};d.getUniformInfos=function(b,e){b=b.gl;e=e.glName;for(var a=b.getProgramParameter(e,b.ACTIVE_UNIFORMS),d=new Map,m,c=0;c<a;c++)(m=b.getActiveUniform(e,
c))&&d.set(m.name,{location:b.getUniformLocation(e,m.name),info:m});return d};d.setUniforms=function(b,e,a,d){Object.keys(d).forEach(function(m){var c=a.get(m)||a.get(m+"[0]");if(c){var l=d[m];if(null!==c&&null!=l){var k=b.gl,c=c.info;switch(c.type){case k.FLOAT:1<c.size?e.setUniform1fv(m,l):e.setUniform1f(m,l);break;case k.FLOAT_VEC2:e.setUniform2fv(m,l);break;case k.FLOAT_VEC3:e.setUniform3fv(m,l);break;case k.FLOAT_VEC4:e.setUniform4fv(m,l);break;case k.FLOAT_MAT3:e.setUniformMatrix3fv(m,l);break;
case k.FLOAT_MAT4:e.setUniformMatrix4fv(m,l);break;case k.INT:case k.BOOL:1<c.size?e.setUniform1iv(m,l):e.setUniform1i(m,l);break;case k.INT_VEC2:case k.BOOL_VEC2:e.setUniform2iv(m,l);break;case k.INT_VEC3:case k.BOOL_VEC3:e.setUniform3iv(m,l);break;case k.INT_VEC4:case k.BOOL_VEC4:e.setUniform4iv(m,l)}}}})};d.setTextures=function(b,e,a,d){a.length===d.length&&(d.some(function(a){return null==a})||a.some(function(a){return null==a})||a.forEach(function(a,c){e.setUniform1i(a,c);b.bindTexture(d[c],
c)}))}})},"esri/views/2d/engine/RasterTileContainer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../geometry/support/aaBoundingRect ../engine ./RasterTile ./webgl/enums ./webgl/TileContainer".split(" "),function(b,d,f,h,e,a,q,m,c){Object.defineProperty(d,"__esModule",{value:!0});b=function(c){function k(){return null!==c&&c.apply(this,arguments)||this}f(k,c);k.prototype.createTile=function(a){var c=this._tileInfoView.getTileBounds(e.create(),
a);return new q.RasterTile(a,c,this._tileInfoView.tileInfo.size)};k.prototype.destroyTile=function(){};k.prototype.prepareRenderPasses=function(k){var b=this,g=k.registerRenderPass({name:"bitmap (tile)",brushes:[a.brushes.Raster],target:function(){return b.children.map(function(a){return a.bitmap})},drawPhase:m.WGLDrawPhase.MAP});return c.prototype.prepareRenderPasses.call(this,k).concat([g])};k.prototype.doRender=function(a){this.visible&&a.drawPhase===m.WGLDrawPhase.MAP&&c.prototype.doRender.call(this,
a)};return k}(c.default);d.RasterTileContainer=b})},"esri/views/2d/engine/Stage":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/events ../../../core/has ../../../core/promiseUtils ../../../core/scheduling ../../../core/watchUtils ../../../core/libs/gl-matrix-2/common ../../../core/libs/gl-matrix-2/mat2d ../../../core/libs/gl-matrix-2/mat2df64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../webgl ./Container ./webgl/BitBlitRenderer ./webgl/definitions ./webgl/enums ./webgl/Painter ./webgl/Profiler ./webgl/WebGLDriverTest ./webgl/shaders/StencilPrograms ../support/Timeline ../../support/screenshotUtils".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,x,t,u,y,A,p,w,v,z,B,C,D){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function d(g,k){var l=b.call(this)||this;l._renderParameters={drawPhase:0,state:l.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1};l._clipData=new Float32Array(8);l._upperLeft=x.vec2f64.create();l._upperRight=x.vec2f64.create();l._lowerLeft=x.vec2f64.create();l._lowerRight=x.vec2f64.create();l._mat2=r.mat2df64.create();l._clipRendererInitialized=!1;l._supersampleScreenshots=
!0;l.dataUploadCounter=0;l.stage=l;l._stationary=!0;l.attached=!0;var n=k.canvas,n=void 0===n?document.createElement("canvas"):n,d=k.alpha,m=k.stencil,f=k.renderContext,p=k.supersampleScreenshots,p=void 0===p?!0:p,h=k.contextOptions,h=void 0===h?{}:h;l._canvas=n;d=t.createContextOrErrorHTML(n,{alpha:void 0===d?!0:d,antialias:!1,depth:!0,stencil:void 0===m?!0:m},void 0===f?"webgl":f);l.context=new t.RenderingContext(d,h);l.painter=new w.default(l.context,l);l._taskHandle=c.addFrameTask({render:function(){return l.renderFrame()}});
l._taskHandle.pause();l._supersampleScreenshots=p;l._lostWebGLContextHandle=a.on(n,"webglcontextlost",function(){l.emit("webgl-error",{error:new e("webgl-context-lost")})});q("esri-2d-profiler")&&(l._debugOutput=document.createElement("div"),l._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),g.appendChild(l._debugOutput));n.setAttribute("style","width: 100%; height:100%; display:block;");l.profiler=new v.Profiler(l.context,l._debugOutput);l.renderingOptions=
k.renderingOptions;l.timeline=k.timeline||new C.Timeline;l.driverTestResult=z.testWebGLDriver(l.context);g.appendChild(n);return l}f(d,b);d.prototype.destroy=function(){this.removeAllChildren();this.renderFrame();this._taskHandle.remove();this._boundFBO=this._taskHandle=null;this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null);this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null);this._clipVAO&&(this._clipVAO.dispose(),this._clipVBO=this._clipVAO=null);this._clipStencilProgram&&
(this._clipStencilProgram.dispose(),this._clipStencilProgram=null);this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null);this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas);this._debugOutput&&this._debugOutput.parentNode&&this._debugOutput.parentNode.removeChild(this._debugOutput);this.painter.dispose();this.context.dispose();this._canvas=null};Object.defineProperty(d.prototype,"background",{get:function(){return this._background},
set:function(a){this._background=a;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"highlightOptions",{get:function(){return this._highlightOptions},set:function(a){var c=this;this._highlightOptionsHandle&&(this._highlightOptionsHandle.remove(),this._highlightOptionsHandle=null);if(this._highlightOptions=a)this._highlightOptionsHandle=l.init(this._highlightOptions,"version",function(){c.painter.setHighlightOptions(a);c.requestRender()})},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"renderingOptions",{get:function(){return this._renderingOptions},set:function(a){this._renderingOptions=a;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"state",{get:function(){return this._state},set:function(a){this._state=a;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"stationary",{get:function(){return this._stationary},set:function(a){this._stationary!==a&&(this._stationary=
a,this.requestRender())},enumerable:!0,configurable:!0});d.prototype.requestRender=function(){this._lastRenderRequestTime=Date.now();this._taskHandle&&this._taskHandle.resume()};d.prototype.renderFrame=function(){Date.now()-this._lastRenderRequestTime>=A.MAX_ANIMATION_TIME_MS&&this._taskHandle.pause();this._renderParameters.state=this._state;this._renderParameters.stationary=this.stationary;this._renderParameters.pixelRatio=window.devicePixelRatio;this._renderParameters.globalOpacity=1;this.processRender(this._renderParameters)};
d.prototype.renderChildren=function(a){var c=this.context,g=this.children,g=a.children?a.children:g;this.profiler.recordStart("drawLayers");this.dataUploadCounter=0;this.beforeRenderChildren(a);a.drawPhase=p.WGLDrawPhase.MAP;this.painter.beforeRenderLayers(c);for(var k=0;k<g.length;k++){var l=g[k];l.attached&&l.processRender(a)}this.painter.renderLayers(c);a.drawPhase=p.WGLDrawPhase.LABEL;this.painter.beforeRenderLayers(c);for(k=0;k<g.length;k++)l=g[k],l.attached&&l.processRender(a);this.painter.renderLayers(c);
if(q("esri-tiles-debug")){a.drawPhase=p.WGLDrawPhase.DEBUG;this.painter.beforeRenderLayers(c);for(k=0;k<g.length;k++)l=g[k],l.attached&&l.processRender(a);this.painter.renderLayers(c)}this.profiler.recordEnd("drawLayers");this.afterRenderChildren()};d.prototype.beforeRenderChildren=function(a){var c=this.context,l=a.state,b=a.pixelRatio;if(this.painter){c.enforceState();var e=l.size;a=l.rotation;var d=Math.round(e[0]*b),e=Math.round(e[1]*b);this._boundFBO=c.getBoundFramebufferObject();if(l.spatialReference&&
(l.spatialReference._isWrappable?l.spatialReference._isWrappable():l.spatialReference.isWrappable)){var m=k.common.toRadian(a),f=Math.abs(Math.cos(m)),r=Math.abs(Math.sin(m)),p=Math.round(l.worldScreenWidth);if(Math.round(d*f+e*r)<=p)this._clipFrame=!1;else{this._clipFBO&&this._clipFBO.width===d&&this._clipFBO.height===e||(this._clipFBO=new t.FramebufferObject(c,{colorTarget:0,depthStencilTarget:3,width:d,height:e}));var h=(this.state.padding.left-this.state.padding.right)/2,v=(this.state.padding.bottom-
this.state.padding.top)/2,q=.5*d,x=.5*e,l=1/d,u=1/e,b=.5*p*b,y=.5*(d*r+e*f),d=this._upperLeft,f=this._upperRight,r=this._lowerLeft,p=this._lowerRight;g.vec2.set(d,-b,-y);g.vec2.set(f,b,-y);g.vec2.set(r,-b,y);g.vec2.set(p,b,y);n.mat2d.identity(this._mat2);n.mat2d.translate(this._mat2,this._mat2,[q+h,x+v]);0!==a&&n.mat2d.rotate(this._mat2,this._mat2,m);g.vec2.transformMat2d(d,d,this._mat2);g.vec2.transformMat2d(f,f,this._mat2);g.vec2.transformMat2d(r,r,this._mat2);g.vec2.transformMat2d(p,p,this._mat2);
a=this._clipData;a.set([2*r[0]*l-1,2*(e-r[1])*u-1,2*p[0]*l-1,2*(e-p[1])*u-1,2*d[0]*l-1,2*(e-d[1])*u-1,2*f[0]*l-1,2*(e-f[1])*u-1]);this._clipRendererInitialized||this._initializeClipRenderer(c);this._clipVBO.setData(a);this._boundFBO=c.getBoundFramebufferObject();c.bindFramebuffer(this._clipFBO);c.setDepthWriteEnabled(!0);c.setStencilWriteMask(255);c.setClearColor(0,0,0,0);c.setClearDepth(1);c.setClearStencil(0);c.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT|c.gl.STENCIL_BUFFER_BIT);c.setDepthWriteEnabled(!1);
this._clipFrame=!0}}else this._clipFrame=!1}};d.prototype.afterRenderChildren=function(){var a=this.context;a.logIno();this._clipFrame&&this._clipRendererInitialized&&(a.bindFramebuffer(this._boundFBO),this._boundFBO=null,a.bindVAO(this._clipVAO),a.bindProgram(this._clipStencilProgram),a.setDepthWriteEnabled(!1),a.setDepthTestEnabled(!1),a.setStencilTestEnabled(!0),a.setBlendingEnabled(!1),a.setColorMask(!1,!1,!1,!1),a.setStencilOp(7680,7680,7681),a.setStencilWriteMask(255),a.setStencilFunction(519,
1,255),a.drawElements(4,6,5123,0),a.bindVAO(),a.setColorMask(!0,!0,!0,!0),a.setBlendingEnabled(!0),a.setStencilFunction(514,1,255),this._blitRenderer.render(a,this._clipFBO.colorTexture,9728,1),a.setStencilTestEnabled(!1))};d.prototype.doRender=function(a){var c=this.context,g=a.state,k=a.pixelRatio;this._resizeCanvas(a);this.context.enforceState();c.setViewport(0,0,k*g.size[0],k*g.size[1]);c.setDepthWriteEnabled(!0);c.setStencilWriteMask(255);this.background&&this.background.color?(g=this.background.color,
c.setClearColor(g.r/255,g.g/255,g.b/255,g.a)):c.setClearColor(0,0,0,0);c.setClearDepth(1);c.setClearStencil(0);c.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT|c.gl.STENCIL_BUFFER_BIT);c.setDepthWriteEnabled(!1);b.prototype.doRender.call(this,a)};d.prototype.takeScreenshot=function(a,c){var g=D.screenshotSuperSampleSettings(a,this._supersampleScreenshots,this._state.padding),k=g.framebufferWidth,l=g.framebufferHeight,b=this.context,e=a.layers,n={drawPhase:null,globalOpacity:1,stationary:!0,state:this._renderParameters.state.clone(),
pixelRatio:g.pixelRatio};if(null!=a.rotation){var d=n.state.viewpoint;d.rotation=a.rotation;n.state.viewpoint=d}0<e.length&&(n.children=[],e.forEach(function(a){var g=c.find(function(c){return c.layer.id===a.id});g&&"container"in g&&g.container&&g.attached&&n.children.push(g.container)}));var f=new t.FramebufferObject(b,{colorTarget:0,depthStencilTarget:3,width:k,height:l}),e=b.getBoundFramebufferObject(),d=b.getViewport();b.bindFramebuffer(f);b.setViewport(0,0,k,l);k=b.gl;!a.ignoreBackground&&this.background&&
this.background.color?(l=this.background.color,b.setClearColor(l.r/255,l.g/255,l.b/255,l.a)):b.setClearColor(0,0,0,0);b.setClearDepth(1);b.setClearStencil(0);b.clear(k.COLOR_BUFFER_BIT|k.DEPTH_BUFFER_BIT|k.STENCIL_BUFFER_BIT);this.renderChildren(n);g=this._readbackScreenshot(g);b.bindFramebuffer(e);b.setViewport(d.x,d.y,d.width,d.height);this.requestRender();b=this._ensureScreenshotEncodeCanvas();a=D.encodeResult(g,a,b,{flipY:!0,premultipliedAlpha:!0});return m.resolve(a)};d.prototype._ensureScreenshotEncodeCanvas=
function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};d.prototype._readbackScreenshot=function(a){var c=a.framebufferWidth,g=a.framebufferHeight,k=a.region;a=a.resample;var l=this.context.gl;if(a){var b=D.createEmptyImageData(c,g,this._ensureScreenshotEncodeCanvas());l.readPixels(0,0,c,g,6408,5121,new Uint8Array(b.data.buffer));c=D.createEmptyImageData(k.width,k.height,this._ensureScreenshotEncodeCanvas());return D.resampleHermite(b,
c,!0,a.region.x,g-(a.region.y+a.region.height),a.region.width,a.region.height)}b=D.createEmptyImageData(k.width,k.height,this._ensureScreenshotEncodeCanvas());l.readPixels(k.x,g-(k.y+k.height),k.width,k.height,6408,5121,new Uint8Array(b.data.buffer));return b};d.prototype._resizeCanvas=function(a){var c=this._canvas,g=c.style,k=a.state.size,l=a.pixelRatio;a=k[0];var k=k[1],b=Math.round(a*l),l=Math.round(k*l);if(c.width!==b||c.height!==l)c.width=b,c.height=l;g.width=a+"px";g.height=k+"px"};d.prototype._initializeClipRenderer=
function(a){if(this._clipRendererInitialized)return!0;this._blitRenderer=new y.BitBlitRenderer;var c=B.stencil.attributes,g=t.createProgram(a,B.stencil);if(!g)return!1;var k=t.BufferObject.createVertex(a,35040,32),l=new Uint16Array([0,1,2,2,1,3]),l=t.BufferObject.createIndex(a,35044,l);a=new t.VertexArrayObject(a,c,{geometry:[{name:"a_pos",count:2,type:5126,offset:0,stride:8,normalized:!1,divisor:0}]},{geometry:k},l);this._clipStencilProgram=g;this._clipVBO=k;this._clipVAO=a;return this._clipRendererInitialized=
!0};return d}(u.Container);d.Stage=b})},"esri/views/2d/engine/webgl/BitBlitRenderer":function(){define(["require","exports","../../../webgl","./shaders/BitBlitPrograms"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(){this._initialized=!1}b.prototype.dispose=function(){this._program&&(this._program.dispose(),this._program=null);this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)};b.prototype.render=function(a,b,e,c){a&&
(this._initialized||this._initialize(a),a.setBlendFunctionSeparate(1,771,1,771),a.bindVAO(this._vertexArrayObject),a.bindProgram(this._program),b.setSamplingMode(e),a.bindTexture(b,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",c),a.drawArrays(5,0,4),a.bindTexture(null,0),a.bindVAO())};b.prototype._initialize=function(a){if(this._initialized)return!0;var b=h.bitBlit.attributes,e=f.createProgram(a,h.bitBlit);if(!e)return!1;var c=new Int8Array(16);c[0]=-1;c[1]=-1;c[2]=
0;c[3]=0;c[4]=1;c[5]=-1;c[6]=1;c[7]=0;c[8]=-1;c[9]=1;c[10]=0;c[11]=1;c[12]=1;c[13]=1;c[14]=1;c[15]=1;a=new f.VertexArrayObject(a,b,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_tex",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:f.BufferObject.createVertex(a,35044,c)});this._program=e;this._vertexArrayObject=a;return this._initialized=!0};return b}();d.BitBlitRenderer=b})},"esri/views/2d/engine/webgl/shaders/BitBlitPrograms":function(){define(["require",
"exports","./sources/resolver"],function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});d.bitBlit={name:"bitBlit",shaders:{vertexShader:f.resolveIncludes("bitBlit/bitBlit.vert"),fragmentShader:f.resolveIncludes("bitBlit/bitBlit.frag")},attributes:{a_pos:0,a_tex:1}}})},"esri/views/2d/engine/webgl/Painter":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../webgl ../../engine ../vectorTiles/shaders/ProgramCache ./BitBlitRenderer ./enums ./MaterialManager ./TextureManager ./effects/AnimationEffect ./effects/HighlightEffect ./effects/HittestEffect ./painter/RenderPass".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g){Object.defineProperty(d,"__esModule",{value:!0});b=function(){return function(){}}();d.PainterOptions=b;b=function(){function b(g,b){this.context=g;this._blitRenderer=new q.BitBlitRenderer;this._brushCache=new Map;this._vtlProgramCache=null;this.brushNameToCtor={marker:e.brushes.Marker,line:e.brushes.Line,fill:e.brushes.Fill,text:e.brushes.Text,label:e.brushes.Label,clip:e.brushes.Clip,stencil:e.brushes.Stencil,bitmap:e.brushes.Bitmap,tileInfo:e.brushes.TileInfo,
vtlBackground:e.brushes.VTLBackground,vtlFill:e.brushes.VTLFill,vtlLine:e.brushes.VTLLine,vtlCircle:e.brushes.VTLCircle,vtlSymbol:e.brushes.VTLSymbol};this.effects={highlight:new n.default,hittest:new r.HittestEffect,integrate:new k.AnimationEffect};this.materialManager=new c(g);this._vtlProgramCache=new a.default(g);this.textureManager=new l(b)}b.prototype.getFbos=function(a,c){if(a!==this._lastWidth||c!==this._lastHeight){this._lastWidth=a;this._lastHeight=c;if(this._fbos)for(var g in this._fbos)this._fbos[g].dispose();
g={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:a,height:c};var k={colorTarget:0,depthStencilTarget:3};a=new h.Renderbuffer(this.context,{width:a,height:c,internalFormat:34041});this._fbos={output:new h.FramebufferObject(this.context,k,g,a),alpha:new h.FramebufferObject(this.context,k,g,a),effect0:new h.FramebufferObject(this.context,k,g,a)}}return this._fbos};b.prototype.beforeRenderLayers=function(a){var c=a.getViewport(),c=this.getFbos(c.width,c.height);this._prevFBO=
a.getBoundFramebufferObject();a.bindFramebuffer(c.output);a.setDepthWriteEnabled(!0);a.setClearColor(0,0,0,0);a.setClearDepth(1);a.clear(a.gl.COLOR_BUFFER_BIT|a.gl.DEPTH_BUFFER_BIT);a.setDepthWriteEnabled(!1)};b.prototype.beforeRenderLayer=function(a,c,g){1!==g?(a.bindFramebuffer(this._fbos.alpha),a.setColorMask(!0,!0,!0,!0),a.setClearColor(0,0,0,0),a.clear(a.gl.COLOR_BUFFER_BIT)):a.bindFramebuffer(this._fbos.output);a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setStencilTestEnabled(!0);
a.setClearStencil(c);a.setStencilWriteMask(255);a.clear(a.gl.STENCIL_BUFFER_BIT)};b.prototype.compositeLayer=function(a,c){1!==c&&(a.bindFramebuffer(this._fbos.output),a.setStencilTestEnabled(!1),a.setStencilWriteMask(0),a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(1,771,1,771),a.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(a,this._fbos.alpha.colorTexture,9728,c))};b.prototype.renderLayers=function(a){a.bindFramebuffer(this._prevFBO);this._fbos&&(a.setStencilTestEnabled(!1),a.setStencilWriteMask(0),
a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(1,771,1,771),a.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(a,this._fbos.output.colorTexture,9728,1))};b.prototype.dispose=function(){this.materialManager.dispose();this.textureManager.dispose();this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null);this._vtlProgramCache&&(this._vtlProgramCache.dispose(),this._vtlProgramCache=null);this._brushCache&&(this._brushCache.forEach(function(a){return a.dispose()}),this._brushCache.clear(),
this._brushCache=null);if(this._fbos)for(var a in this._fbos)this._fbos[a]&&this._fbos[a].dispose();if(this.effects)for(var c in this.effects)this.effects[c]&&this.effects[c].dispose();this._prevFBO=null};b.prototype.getGeometryBrush=function(a){var c;a=(c={},c[m.WGLGeometryType.FILL]=e.brushes.Fill,c[m.WGLGeometryType.LINE]=e.brushes.Line,c[m.WGLGeometryType.MARKER]=e.brushes.Marker,c[m.WGLGeometryType.TEXT]=e.brushes.Text,c)[a];c=this._brushCache.get(a);void 0===c&&(c=new a,this._brushCache.set(a,
c));return this._brushCache.get(a)};b.prototype.renderObject=function(a,c,g,k){g=this.brushNameToCtor[g];if(!g)return null;var b=this._brushCache.get(g);void 0===b&&(b=new g,this._brushCache.set(g,b));b.prepareState(a,c,k);b.draw(a,c,k)};b.prototype.renderObjects=function(a,c,g,k){g=this.brushNameToCtor[g];if(!g)return null;var b=this._brushCache.get(g);void 0===b&&(b=new g,this._brushCache.set(g,b));b.drawMany(a,c,k)};b.prototype.getVectorTileProgramCach=function(){return this._vtlProgramCache};
b.prototype.registerRenderPass=function(a){var c=this,k=a.brushes.map(function(a){c._brushCache.has(a)||c._brushCache.set(a,new a);return c._brushCache.get(a)});return new g.default(k,a)};b.prototype.setHighlightOptions=function(a){this.effects.highlight.setHighlightOptions(a)};return b}();d.default=b})},"esri/views/2d/engine/vectorTiles/shaders/ProgramCache":function(){define(["require","exports","../../../../webgl","./Programs"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});
b=function(){function b(a){this._cache=Array(8);for(var b=0;8>b;b++)this._cache[b]={};this._programRepo=new f.ProgramCache(a)}b.prototype.dispose=function(){this._programRepo&&(this._programRepo.dispose(),this._programRepo=null)};b.prototype.getProgram=function(a,b,e){var c=this._cache[a];c[b]||(a=this._programRepo.getProgram(this._getProgramTemplate(a),e),c[b]=a);return c[b]};b.prototype.getProgramAttributes=function(a){switch(a){case 0:return h.background.attributes;case 5:return h.circle.attributes;
case 1:return h.fill.attributes;case 4:return h.icon.attributes;case 3:return h.line.attributes;case 2:return h.outline.attributes;case 6:return h.text.attributes;default:return null}};b.prototype._getProgramTemplate=function(a){switch(a){case 0:return h.background;case 5:return h.circle;case 1:return h.fill;case 4:return h.icon;case 3:return h.line;case 2:return h.outline;case 6:return h.text;default:return null}};return b}();d.default=b})},"esri/views/2d/engine/vectorTiles/shaders/Programs":function(){define(["require",
"exports","../../../../webgl","./sources/resolver"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});d.background={name:"background",shaders:function(a){return{vertexShader:f.glslifyDefineMap({ID:a.id,PATTERN:a.pattern})+h.resolveIncludes("background/background.vert"),fragmentShader:f.glslifyDefineMap({ID:a.id,PATTERN:a.pattern})+h.resolveIncludes("background/background.frag")}},attributes:{a_pos:0}};d.circle={name:"circle",shaders:function(a){return{vertexShader:f.glslifyDefineMap({ID:a.id})+
h.resolveIncludes("circle/circle.vert"),fragmentShader:f.glslifyDefineMap({ID:a.id})+h.resolveIncludes("circle/circle.frag")}},attributes:{a_pos:0,a_color:1,a_stroke_color:2,a_data:3}};var e=function(a){return f.glslifyDefineMap({ID:a.id,DD:a.dd,PATTERN:a.pattern})};d.fill={name:"fill",shaders:function(a){return{vertexShader:e(a)+h.resolveIncludes("fill/fill.vert"),fragmentShader:e(a)+h.resolveIncludes("fill/fill.frag")}},attributes:{a_pos:0,a_color:1}};d.outline={name:"outline",shaders:function(a){return{vertexShader:f.glslifyDefineMap({ID:a.id,
DD:a.dd})+h.resolveIncludes("outline/outline.vert"),fragmentShader:f.glslifyDefineMap({ID:a.id,DD:a.dd})+h.resolveIncludes("outline/outline.frag")}},attributes:{a_pos:0,a_offset:1,a_xnormal:2,a_color:3}};d.icon={name:"icon",shaders:function(a){return{vertexShader:f.glslifyDefineMap({ID:a.id,DD:a.dd,SDF:a.sdf})+h.resolveIncludes("icon/icon.vert"),fragmentShader:f.glslifyDefineMap({ID:a.id,DD:a.dd,SDF:a.sdf})+h.resolveIncludes("icon/icon.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,
a_color:4,a_size:5}};var a=function(a){return f.glslifyDefineMap({ID:a.id,DD:a.dd,PATTERN:a.pattern})};d.line={name:"line",shaders:function(b){return{vertexShader:a(b)+h.resolveIncludes("line/line.vert"),fragmentShader:a(b)+h.resolveIncludes("line/line.frag")}},attributes:{a_pos:0,a_offsetAndNormal:1,a_accumulatedDistance:2,a_color:3,a_width:4}};d.text={name:"text",shaders:function(a){return{vertexShader:f.glslifyDefineMap({ID:a.id,DD:a.dd})+h.resolveIncludes("text/text.vert"),fragmentShader:f.glslifyDefineMap({ID:a.id,
DD:a.dd})+h.resolveIncludes("text/text.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,a_color:4,a_size:5}}})},"esri/views/2d/engine/vectorTiles/shaders/sources/resolver":function(){define(["require","exports","../../../../../webgl","./shaderRepository"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});var e=new f.ShaderCompiler(function(a){var b=h;a.split("/").forEach(function(a){b&&(b=b[a])});return b});d.resolveIncludes=function(a){return e.resolveIncludes(a)}})},
"esri/views/2d/engine/vectorTiles/shaders/sources/shaderRepository":function(){define(["require","exports"],function(b,d){return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos \x3d mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d u_opacity * color;\n#else\n  gl_FragColor \x3d u_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\nvoid main() {\n  gl_Position \x3d vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\n  v_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n}"},
circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float dist \x3d length(v_offset);\n  mediump float alpha \x3d smoothstep(0.0, -v_blur, dist - 1.0);\n  lowp float color_mix_ratio \x3d v_stroke_width \x3c 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\n  gl_FragColor \x3d alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"circle.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_color;\nattribute vec4 a_stroke_color;\nattribute vec4 a_data;\nconst float sizePrecision \x3d 0.25;\nconst float blurPrecision \x3d 0.03125;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_radius;\nuniform lowp vec4 u_color;\nuniform mediump float u_blur;\nuniform mediump float u_stroke_width;\nuniform lowp vec4 u_stroke_color;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n  v_color \x3d a_color * u_color;\n  v_stroke_color \x3d a_stroke_color * u_stroke_color;\n  v_stroke_width \x3d a_data[1] * sizePrecision * u_stroke_width;\n  v_radius \x3d a_data[2] * u_radius;\n  v_blur \x3d max(a_data[0] * blurPrecision + u_blur, u_antialiasingWidth / (v_radius + v_stroke_width));\n  mediump vec2 offset \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n  v_offset \x3d offset;\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  mediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord \x3d fract(v_tileTextureCoord);\n  mediump vec2 samplePos \x3d mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d v_color[3] * color;\n#else\n  gl_FragColor \x3d v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"fill.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\nvoid main()\n{\n#ifdef DD\n  v_color \x3d a_color * u_color;\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n#ifdef PATTERN\n  v_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n  vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\nuniform mediump float u_outlineSize;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_transparency;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include \x3cutil/encoding.glsl\x3e\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\n  lowp vec4 fillPixelColor \x3d v_color;\n  float d \x3d rgba2float(texture2D(u_texture, v_tex)) - 0.5;\n  const float sofetEdgeRatio \x3d 0.248062016;\n  float size \x3d max(v_size.x, v_size.y);\n  float dist \x3d d * sofetEdgeRatio * size;\n  fillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\n  if (u_outlineSize \x3e 0.25) {\n    lowp vec4 outlinePixelColor \x3d u_outlineColor;\n    const float outlineLimitRatio \x3d (16.0 / 86.0);\n    float clampedOutlineSize \x3d sofetEdgeRatio * min(u_outlineSize, outlineLimitRatio * max(v_size.x, v_size.y));\n    outlinePixelColor *\x3d clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\n    gl_FragColor \x3d v_transparency * mixColors(fillPixelColor, outlinePixelColor);\n  }\n  else {\n    gl_FragColor \x3d v_transparency * fillPixelColor;\n  }\n#else\n  lowp vec4 texColor \x3d texture2D(u_texture, v_tex);\n  gl_FragColor \x3d v_transparency * texColor;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_size;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeSpeed;\nuniform mediump float u_minfadeLevel;\nuniform mediump float u_maxfadeLevel;\nuniform mediump float u_fadeChange;\nuniform mediump float u_opacity;\nvarying mediump vec2 v_tex;\nvarying lowp float v_transparency;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float tileCoordRatio \x3d 1.0 / 8.0;\nvoid main()\n{\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\n  mediump float a_angle         \x3d a_levelInfo[1];\n  mediump float a_minLevel      \x3d a_levelInfo[2];\n  mediump float a_maxLevel      \x3d a_levelInfo[3];\n  mediump float delta_z \x3d 0.0;\n  mediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\n  delta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level);\n  delta_z +\x3d step(a_maxLevel, u_level);\n  mediump float alpha \x3d u_fadeSpeed !\x3d 0.0 ? clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0) : 1.0;\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\n  {\n    v_transparency \x3d 0.0;\n  }\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\n  {\n    v_transparency \x3d 1.0;\n  }\n  delta_z +\x3d step(v_transparency, 0.0);\n  vec2 offset \x3d C_OFFSET_PRECISION * a_vertexOffset;\n  v_size \x3d abs(offset);\n#ifdef SDF\n  offset \x3d (120.0 / 86.0) * offset;\n#endif\n#ifdef DD\n  mediump float icon_size \x3d a_size * u_size;\n#else\n  mediump float icon_size \x3d u_size;\n#endif\n  mediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(icon_size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef DD\n  v_color \x3d a_color * u_color;\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  v_tex \x3d a_tex.xy / u_mosaicSize;\n  v_transparency *\x3d v_color.w;\n}"},
line:{"line.frag":"varying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform mediump vec2 u_spriteSize;\nuniform sampler2D u_texture;\nconst mediump float tileCoordRatio \x3d 8.0;\n#else\nvarying mediump vec2 v_dasharray;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\n  lowp float alpha \x3d clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\n  mediump float relativeTexX \x3d mod((v_accumulatedDistance + v_normal.x * v_lineHalfWidth * tileCoordRatio) / u_spriteSize.x, 1.0);\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * v_lineHalfWidth / u_spriteSize.y);\n  mediump vec2 texCoord \x3d mix(u_pattern_tl, u_pattern_br, vec2(relativeTexX, relativeTexY));\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\n  gl_FragColor \x3d alpha * v_color[3] * color;\n#else\n  lowp float dashPos \x3d  mod(v_accumulatedDistance, v_dasharray.x + v_dasharray.y);\n  lowp float dashAlpha \x3d clamp(min(dashPos, v_dasharray.x - dashPos) + 0.5, 0.0, 1.0);\n  dashAlpha \x3d max(sign(-v_dasharray.y), dashAlpha);\n  alpha *\x3d dashAlpha;\n  gl_FragColor \x3d alpha * v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"line.vert":"attribute vec2 a_pos;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistance;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_blur;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale \x3d 1.0 / 31.0;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_width;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_width;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\n#ifndef PATTERN\nuniform mediump vec2 u_dasharray;\nvarying mediump vec2 v_dasharray;\n#endif\nvoid main()\n{\n  v_normal \x3d a_offsetAndNormal.zw * scale;\n#ifdef DD\n  v_lineHalfWidth \x3d a_width * u_width;\n#else\n  v_lineHalfWidth \x3d u_width;\n#endif\n  v_lineHalfWidth +\x3d u_antialiasing;\n  v_lineHalfWidth *\x3d 0.5;\n#ifndef PATTERN\n#ifdef DD\n  v_dasharray \x3d u_dasharray * a_width;\n#else\n  v_dasharray \x3d u_dasharray * u_width;\n#endif\n#endif\n  mediump vec2 dist \x3d v_lineHalfWidth * scale * a_offsetAndNormal.xy;\n  mediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) +  u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n  v_accumulatedDistance \x3d a_accumulatedDistance.x;\n  v_blur \x3d u_blur + u_antialiasing;\n  #ifdef DD\n    v_color \x3d a_color * u_color;\n  #else\n    v_color \x3d u_color;\n  #endif\n  #ifdef ID\n    v_id \x3d u_id / 255.0;\n  #endif\n}"},
outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist \x3d abs(v_normal.y);\n  lowp float alpha \x3d smoothstep(1.0, 0.0, dist);\n  gl_FragColor \x3d alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale \x3d 1.0 / 15.0;\nvoid main()\n{\n#ifdef DD\n  v_color \x3d a_color * u_color;\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  v_normal \x3d a_xnormal;\n  mediump vec2 dist \x3d u_outline_width * scale * a_offset;\n  mediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth, 1.0);\n}"},
text:{"text.frag":"uniform lowp sampler2D u_texture;\nuniform mediump float u_edgeDistance;\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  mediump float alpha \x3d smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist) * v_transparency;\n  gl_FragColor \x3d alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\nuniform lowp vec4 u_color;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nvarying lowp vec4 v_color;\nuniform mediump float u_size;\n#ifdef DD\nattribute mediump float a_size;\n#endif\nvarying mediump float v_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeSpeed;\nuniform mediump float u_minfadeLevel;\nuniform mediump float u_maxfadeLevel;\nuniform mediump float u_fadeChange;\nuniform mediump float u_opacity;\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\nconst float offsetPrecision \x3d 1.0 / 8.0;\nconst mediump float edgePos \x3d 0.75;\nuniform mediump float u_edgeDistance;\nuniform mediump float u_edgeBlur;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale \x3d 1.0 / 24.0;\nvoid main()\n{\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\n  mediump float a_angle        \x3d a_levelInfo[1];\n  mediump float a_minLevel    \x3d a_levelInfo[2];\n  mediump float a_maxLevel    \x3d a_levelInfo[3];\n  mediump float delta_z \x3d 0.0;\n  mediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\n  delta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level);\n  delta_z +\x3d step(a_maxLevel, u_level);\n  mediump float alpha \x3d u_fadeSpeed !\x3d 0.0 ? clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0) : 1.0;\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\n  {\n    v_transparency \x3d 0.0;\n  }\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\n  {\n    v_transparency \x3d 1.0;\n  }\n  delta_z +\x3d step(v_transparency, 0.0);\n  v_tex \x3d a_tex.xy / u_mosaicSize;\n#ifdef DD\n  if (u_halo \x3e 0.5)\n  {\n    v_color \x3d u_color;\n  }\n  else\n  {\n    v_color \x3d a_color * u_color;\n  }\n#else\n  v_color \x3d u_color;\n#endif\n#ifdef DD\n  v_size \x3d a_size * u_size;\n#else\n  v_size \x3d u_size;\n#endif\n#ifdef ID\n  v_id \x3d u_id / 255.0;\n#endif\n  v_edgeDistance \x3d edgePos - u_edgeDistance / v_size;\n  v_edgeWidth \x3d (u_antialiasingWidth + u_edgeBlur) / v_size;\n  mediump vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * v_size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\n  gl_Position \x3d vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}"}}})},"esri/views/2d/engine/webgl/MaterialManager":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../../webgl ./enums ./shaders/MaterialPrograms".split(" "),function(b,
d,f,h,e,a,q){var m=function(c){return c===a.WGLDrawPhase.HITTEST||c===a.WGLDrawPhase.LABEL_ALPHA},c=function(c,k,b,e){e=e.reduce(function(a,k){var g;return f({},a,(g={},g[k]=c.driverTestResult[k],g))},{});k=f({},k.getVariation(),c.rendererInfo.getVariation(),{highlight:c.drawPhase===a.WGLDrawPhase.HIGHLIGHT,id:m(c.drawPhase)},e);if(h.isSome(b))for(e=0;e<b.length;e++)k[b[e]]=!0;return k};return function(){function b(a){this._programByKey=new Map;this._programCache=new e.ProgramCache(a)}b.prototype.dispose=
function(){this._programCache&&this._programCache.dispose()};b.prototype.getProgram=function(a,c,b,g){void 0===b&&(b=[]);void 0===g&&(g=[]);var k=c.path+b.join(".")+g.join(".");if(this._programByKey.has(k))return this._programByKey.get(k);g=g.reduce(function(c,g){var k;return f({},c,(k={},k[g]=a.driverTestResult[g],k))},{});b=f({},b.reduce(function(a,c){var g;return f({},a,(g={},g[c]=!0,g))},{}),g);c=this._programCache.getProgram(q.createProgramTemplate(c.path,c.attributes),b);if(!c)throw Error("Unable to get program for key: ${key}");
this._programByKey.set(k,c);return c};b.prototype.getMaterialProgram=function(k,b,l,g,e,d){void 0===d&&(d=["ignoresSamplerPrecision"]);var n,f=d;n=k.rendererInfo;var r=k.drawPhase,f=b.getVariationHash()+"-"+f.join(".")+"-",r=(m(r)?1:0)|(r===a.WGLDrawPhase.HIGHLIGHT?2:0);n=f+r+"-"+n.getVariationHash()+"-"+(h.isSome(e)&&e.join("."));if(this._programByKey.has(n))return this._programByKey.get(n);k=c(k,b,e,d);l=this._programCache.getProgram(q.createProgramTemplate(l,g),k);if(!l)throw Error("Unable to get program for key: ${key}");
this._programByKey.set(n,l);return l};return b}()})},"esri/views/2d/engine/webgl/shaders/MaterialPrograms":function(){define(["require","exports","../../../../webgl","./sources/resolver"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});var e=function(a){var b={},e;for(e in a){for(var c=e,l=void 0,l=""+c[0].toUpperCase(),k=1;k<c.length;k++){var n=c[k];n===n.toUpperCase()?(l+="_",l+=n):l+=n.toUpperCase()}b[l]=a[e]}return f.glslifyDefineMap(b)};d.createProgramTemplate=function(a,b){var d=
a+a.substring(a.lastIndexOf("/"));return{name:name,attributes:b,shaders:function(a){return{vertexShader:e(a)+h.resolveIncludes(d+".vert"),fragmentShader:e(a)+h.resolveIncludes(d+".frag")}}}}})},"esri/views/2d/engine/webgl/TextureManager":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../config ../../../../request ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../symbols/cim/Rasterizer ./definitions ./enums ./fontUtils ./GlyphMosaic ./GlyphSource ./SDFConverter ./SpriteMosaic ./animatedFormats/apng ./animatedFormats/gif ./util/BidiText ./util/Result ./util/symbolUtils".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,x,t,u,y,A,p,w,v,z,B,C,D,G){function F(a){switch(a.type){case "CIMSolidStroke":case "CIMSolidFill":return!0;case "esriSFS":return"esriSFSSolid"===a.style||"esriSFSNull"===a.style;case "esriSLS":return"esriSLSSolid"===a.style||"esriSLSNull"===a.style;default:return!1}}function E(a){switch(a.type){case "esriSMS":case "esriPMS":case "CIMPointSymbol":case "CIMVectorMarker":case "CIMPictureMarker":case "CIMCharacterMarker":return!1;default:return!0}}function H(a){return h(this,
void 0,void 0,function(){var c,g;return e(this,function(b){switch(b.label){case 0:c=window.URL.createObjectURL(a),b.label=1;case 1:return b.trys.push([1,3,,4]),[4,q(c,{responseType:"image"})];case 2:return g=b.sent().data,window.URL.revokeObjectURL(c),[2,g];case 3:return b.sent(),window.URL.revokeObjectURL(c),[2,new m("mapview-invalid-resource","Could not fetch requested resource at "+c)];case 4:return[2]}})})}function J(a,c){return h(this,void 0,void 0,function(){var g,b,l,d,n,r,p,h,t;return e(this,
function(e){switch(e.label){case 0:g=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;if(-1===g.indexOf(";base64,"))return[3,1];l=g.indexOf(";base64,")+8;d=g.substring(l);n=atob(d);r=new Uint8Array(n.length);for(p=0;p<n.length;p++)r[p]=n.charCodeAt(p);b=r.buffer;return[3,4];case 1:return e.trys.push([1,3,,4]),[4,q(g,f({responseType:"array-buffer"},c))];case 2:return b=h=e.sent().data,[3,4];case 3:return t=e.sent(),k.isAbortError(t)?[3,4]:[2,new m("mapview-invalid-resource","Could not fetch requested resource at "+
g)];case 4:return[2,b]}})})}var K=g.vec2f32.create(),I=c.getLogger("esri.views.2d.engine.webgl.TextureManager"),M=function(){function a(a,c,g){this.mosaicType=a;this.page=c;this.sdf=g}a.fromMosaic=function(c,g){return new a(c,g.page,g.sdf)};return a}();return function(){function c(c){this._invalidFontsMap=new Map;this._sdfConverter=new w.default(126);this._bindingInfos=[];this._hashToBindingIndex=new Map;this._rasterizer=new x.default;this._spriteMosaic=new v(c,2048,2048,500);this._glyphSource=new p(a.fontsUrl+
"/{fontstack}/{range}.pbf");this._glyphMosaic=new A(1024,1024,this._glyphSource)}c.prototype.dispose=function(){this._spriteMosaic.dispose();this._glyphMosaic.dispose();this._rasterizer.dispose();this._rasterizer=this._glyphMosaic=this._spriteMosaic=null};Object.defineProperty(c.prototype,"sprites",{get:function(){return this._spriteMosaic},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"glyphs",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0});c.prototype.rasterizeItem=
function(a,c,g){return h(this,void 0,void 0,function(){var b,k,d,n=this;return e(this,function(e){switch(e.label){case 0:if(l.isNone(a))return I.error(new m("mapview-null-resource","Unable to rasterize null resource",void 0)),[2,null];b=a.type;switch(b){case "CIMTextSymbol":return[3,1];case "esriTS":return[3,1]}return[3,3];case 1:return[4,this._rasterizeText(a,c,g)];case 2:return k=e.sent(),k.forEach(function(a){return n._setTextureBinding(u.MosaicType.GLYPH,a)}),[2,{glyphMosaicItems:k}];case 3:return a.type&&
-1!==a.type.toLowerCase().indexOf("3d")?(I.error(new m("mapview-invalid-type","MapView does not support symbol type: "+a.type,a)),[2,null]):[4,this._rasterizeSpriteSymbol(a,g)];case 4:return d=e.sent(),D.ok(d)&&d&&this._setTextureBinding(u.MosaicType.SPRITE,d),[2,{spriteMosaicItem:d}]}})})};c.prototype.bindTextures=function(a,c,g){if(0!==g.textureBinding){var b=this._bindingInfos[g.textureBinding-1];g=b.page;switch(b.mosaicType){case u.MosaicType.SPRITE:var b=this.sprites.getWidth(g),k=this.sprites.getHeight(g),
b=r.vec2.set(K,b,k);this._spriteMosaic.bind(a,9729,g,t.TEXTURE_BINDING_SPRITE_ATLAS);c.setUniform1i("u_texture",t.TEXTURE_BINDING_SPRITE_ATLAS);c.setUniform2fv("u_mosaicSize",b);break;case u.MosaicType.GLYPH:b=this.glyphs.width;k=this.glyphs.height;b=r.vec2.set(K,b,k);this._glyphMosaic.bind(a,9729,g,t.TEXTURE_BINDING_GLYPH_ATLAS);c.setUniform1i("u_texture",t.TEXTURE_BINDING_GLYPH_ATLAS);c.setUniform2fv("u_mosaicSize",b);break;default:I.error("mapview-texture-manager","Cannot handle unknown type "+
b.mosaicType)}}};c.prototype._hashMosaic=function(a,c){return 1|a<<1|(c.sdf?1:0)<<2|c.page<<3};c.prototype._setTextureBinding=function(a,c){var g=this._hashMosaic(a,c);this._hashToBindingIndex.has(g)||(a=M.fromMosaic(a,c),this._hashToBindingIndex.set(g,this._bindingInfos.length+1),this._bindingInfos.push(a));c.textureBinding=this._hashToBindingIndex.get(g)};c.prototype._rasterizeText=function(a,c,g){return h(this,void 0,void 0,function(){var b,k,l;return e(this,function(e){switch(e.label){case 0:b=
y.getFullyQualifiedFontName(a.font);k=this._invalidFontsMap.has(b);var d;if(c)d=c;else{d=C.bidiText(a.text)[0];for(var n=[],f=0;f<d.length;f++)n.push(d.charCodeAt(f));d=n}l=d;e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._glyphMosaic.getGlyphItems(k?"arial-unicode-ms-regular":b,l,g)];case 2:return[2,e.sent()];case 3:return e.sent(),I.error(new m("mapview-invalid-resource","Couldn't find font "+b+". Falling back to Arial Unicode MS Regular",void 0)),this._invalidFontsMap.set(b,!0),[2,this._glyphMosaic.getGlyphItems("arial-unicode-ms-regular",
l,g)];case 4:return[2]}})})};c.prototype._rasterizeSpriteSymbol=function(a,c){return h(this,void 0,void 0,function(){var g,b,k,l,d,n;return e(this,function(e){if(F(a))return[2,null];g=G.keyFromSymbol(a);return this._spriteMosaic.has(g)?[2,this._spriteMosaic.getSpriteItem(g)]:"esriSMS"===a.type&&a.path?[2,this._handleSVG(a,g,c)]:a.url||a.imageData?[2,this._handleImage(a,g,c)]:(b=this._rasterizer.rasterizeJSONResource(a))?(k=b.size,l=b.image,d=b.sdf,n=b.simplePattern,[2,this._addItemToMosaic(g,k,{type:"static",
data:l},E(a),d,n)]):[2,new m("TextureManager","unrecognized or null rasterized image")]})})};c.prototype._handleSVG=function(a,c,g){return h(this,void 0,void 0,function(){var b,k;return e(this,function(l){switch(l.label){case 0:return b=[126,126],[4,this._sdfConverter.draw(a.path,g)];case 1:return k=l.sent(),[2,this._addItemToMosaic(c,b,{type:"static",data:new Uint32Array(k.buffer)},!1,!0,!0)]}})})};c.prototype._handleGIFOrPNG=function(a,c,g){return h(this,void 0,void 0,function(){var b,l,d,n,f,r,
p,h,t,v,q,x;return e(this,function(e){switch(e.label){case 0:return[4,J(a,g)];case 1:b=e.sent();if(!D.ok(b))return[3,10];l=B.isGIF(b);d=z.isPNG(b);if(!l&&!d)return[2,new m("mapview-invalid-resource","Image data is neither GIF nor PNG!")];n=void 0;e.label=2;case 2:return e.trys.push([2,7,,8]),l&&B.isAnimatedGIF(b)?[4,B.default.create(b,g)]:[3,4];case 3:return n=e.sent(),[3,6];case 4:return d&&z.isAnimatedPNG(b)?[4,z.default.create(b,g)]:[3,6];case 5:n=e.sent(),e.label=6;case 6:return[3,8];case 7:return f=
e.sent(),k.isAbortError(f)?[3,8]:[2,new m("mapview-invalid-resource","Could not fetch requested resource!")];case 8:if(n&&D.ok(n))return[2,this._addItemToMosaic(c,[n.width,n.height],{type:"animated",data:n},E(a),!1,!1)];r=l?"image/gif":"image/png";p=new Blob([b],{type:r});return[4,H(p)];case 9:if((h=e.sent())&&h instanceof HTMLImageElement)return t=this._rasterizer.rasterizeImageResource(h,a.colorSubstitutions),v=t.size,q=t.sdf,x=t.image,[2,this._addItemToMosaic(c,v,{type:"static",data:x},E(a),q,
!1)];e.label=10;case 10:return[2,new m("mapview-invalid-resource","Could not handle resource!")]}})})};c.prototype._handleImage=function(a,c,g){return h(this,void 0,void 0,function(){var b,l,d,r,p,h,t;return e(this,function(e){switch(e.label){case 0:var v;(v=a.url&&-1!==a.url.indexOf(".gif")||a.contentType&&"image/gif"===a.contentType||a.imageData&&-1!==a.imageData.indexOf("data:image/gif"))||(v=a.url&&-1!==a.url.indexOf(".png")||a.contentType&&"image/png"===a.contentType||a.imageData&&-1!==a.imageData.indexOf("data:image/png"));
if(v)return[2,this._handleGIFOrPNG(a,c,g)];b=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;e.label=1;case 1:return e.trys.push([1,3,,4]),[4,q(b,f({responseType:"image"},g))];case 2:return l=e.sent().data,-1!==b.indexOf("data:image/svg+xml")&&(l.width=n.pt2px(a.width),l.height=n.pt2px(a.height)),d=this._rasterizer.rasterizeImageResource(l,a.colorSubstitutions),r=d.size,p=d.sdf,h=d.image,[2,this._addItemToMosaic(c,r,{type:"static",data:h},E(a),p,!1)];case 3:return t=e.sent(),k.isAbortError(t)?
[3,4]:[2,new m("mapview-invalid-resource","Could not fetch requested resource at "+b)];case 4:return[2,void 0]}})})};c.prototype._addItemToMosaic=function(a,c,g,b,k,l){return this._spriteMosaic.addSpriteItem(a,c,g,b,k,l)};return c}()})},"esri/views/2d/engine/webgl/fontUtils":function(){define(["require","exports"],function(b,d){function f(b){b=b.toLowerCase().split(" ").join("-");switch(b){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";
case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return b}}Object.defineProperty(d,"__esModule",{value:!0});d.getFullyQualifiedFontName=function(b){var e;a:{if(b.weight)switch(b.weight.toLowerCase()){case "bold":case "bolder":e="-bold";break a}e=""}var a;a:{if(b.style)switch(b.style.toLowerCase()){case "italic":case "oblic":a="-italic";break a}a=""}e+=a;return f(b.family)+(0<e.length?e:"-regular")};d.getFontDecorationTop=function(b){switch(b){case "underline":return-26;
case "line-through":return-18}return NaN}})},"esri/views/2d/engine/webgl/GlyphMosaic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/has ../../../../core/promiseUtils ../../../webgl ./Rect ./RectangleBinPack".split(" "),function(b,d,f,h,e,a,q,m,c){function l(a){for(var c=new Set,b=0;b<a.length;b++)c.add(Math.floor(a[b]/256));return c}function k(c,g,b){c.has(g)||c.set(g,b().then(function(){c.delete(g)}).catch(function(b){c.delete(g);
a.throwIfNotAbortError(b)}));return c.get(g)}var n;e("stable-symbol-rendering")&&(n=new Set);return function(){function b(a,b,k){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphCache={};this._textures=[];this._rangePromises=new Map;!n&&e("stable-symbol-rendering")&&(n=new Set);this.width=a;this.height=b;this._glyphSource=k;this._binPack=new c(a-4,b-4);this._glyphData.push(new Uint8Array(a*b));this._dirties.push(!0);this._textures.push(null);this._initDecorationGlyph()}
b.prototype.dispose=function(){this._binPack=null;for(var a=0,c=this._textures;a<c.length;a++){var b=c[a];b&&b.dispose()}this._textures.length=0;this._glyphData.length=0};b.prototype._initDecorationGlyph=function(){for(var a=[117,149,181,207,207,181,149,117],c=[],b=0;b<a.length;b++)for(var k=a[b],l=0;11>l;l++)c.push(k);a={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(c)};this._recordGlyph(a)};b.prototype.getGlyphItems=function(a,c,b){return h(this,void 0,void 0,function(){var g,
k=this;return f(this,function(l){switch(l.label){case 0:return g=this._getGlyphCache(a),[4,this._fetchRanges(a,c,b)];case 1:return l.sent(),e("stable-symbol-rendering")?[2,this._getMosaicItemsStable(g,a,c)]:[2,c.map(function(c){return k._getMosaicItem(g,a,c)})]}})})};b.prototype.bind=function(a,c,b,k){var g=this._getTexture(a,b);g.setSamplingMode(c);this._dirties[b]&&(g.setData(this._glyphData[b]),this._dirties[b]=!1);a.bindTexture(g,k)};b.prototype._getGlyphCache=function(a){this._glyphCache[a]||
(this._glyphCache[a]={});return this._glyphCache[a]};b.prototype._getTexture=function(a,c){this._textures[c]||(this._textures[c]=new q.Texture(a,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));return this._textures[c]};b.prototype._invalidate=function(){this._dirties[this._currentPage]=!0};b.prototype._fetchRanges=function(c,b,k){return h(this,void 0,void 0,function(){var g,e,d=this;return f(this,function(n){switch(n.label){case 0:return g=
l(b),e=[],g.forEach(function(a){e.push(d._fetchRange(c,a,k))}),[4,a.all(e)];case 1:return n.sent(),[2]}})})};b.prototype._fetchRange=function(a,c,b){return h(this,void 0,void 0,function(){var g,l=this;return f(this,function(e){if(256<c)return[2,null];g=a+c;return[2,k(this._rangePromises,g,function(){return l._glyphSource.getRange(a,c,b)})]})})};b.prototype._getMosaicItem=function(a,c,b){if(!a[b]){c=this._glyphSource.getGlyph(c,b);if(!c||!c.metrics)return{rect:new m.default(0,0,0,0),page:0,metrics:{left:0,
width:0,height:0,advance:0,top:0},code:b,sdf:!0};var g=this._recordGlyph(c);a[b]={rect:g,page:this._currentPage,metrics:c.metrics,code:b,sdf:!0};this._invalidate()}return a[b]};b.prototype._getMosaicItemsStable=function(a,c,b){var g=this,k=[],l=b.map(function(a){return a});b.map(function(a){return a}).sort().map(function(b){return g._getMosaicItem(a,c,b)}).forEach(function(a){var c=l.indexOf(a.code);k[c]=a;l[c]=null});return k};b.prototype._recordGlyph=function(a){var g=a.metrics;if(0===g.width)g=
new m.default(0,0,0,0);else{var b=g.width+6,k=g.height+6,g=this._binPack.allocate(b,k);g.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph(),this._binPack=new c(this.width-4,this.height-4),g=this._binPack.allocate(b,k));var l=this._glyphData[this._currentPage];a=a.bitmap;var d=void 0,n=void 0;
if(a)for(var f=0;f<k;f++)for(var d=b*f,n=this.width*(g.y+f)+g.x,h=0;h<b;h++)l[n+h]=a[d+h];e("esri-glyph-debug")&&this._showDebugPage(l)}return g};b.prototype._showDebugPage=function(a){var c=document.createElement("canvas"),g=c.getContext("2d"),b=new ImageData(this.width,this.height),k=b.data;c.width=this.width;c.height=this.height;c.style.border="1px solid black";for(var l=0;l<a.length;++l)k[4*l+0]=a[l],k[4*l+1]=0,k[4*l+2]=0,k[4*l+3]=255;g.putImageData(b,0,0);document.body.appendChild(c)};return b}()})},
"esri/views/2d/engine/webgl/Rect":function(){define(["require","exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(b,e,a,d){void 0===b&&(b=0);void 0===e&&(e=0);void 0===a&&(a=0);void 0===d&&(d=0);this.x=b;this.y=e;this.width=a;this.height=d}Object.defineProperty(b.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},enumerable:!0,configurable:!0});b.prototype.union=function(b){this.x=Math.min(this.x,b.x);this.y=Math.min(this.y,b.y);
this.width=Math.max(this.width,b.width);this.height=Math.max(this.height,b.height)};return b}();d.default=b})},"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["require","exports","./Rect"],function(b,d,f){return function(){function b(b,a){this._height=this._width=0;this._free=[];this._width=b;this._height=a;this._free.push(new f.default(0,0,b,a))}Object.defineProperty(b.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"height",{get:function(){return this._height},enumerable:!0,configurable:!0});b.prototype.allocate=function(b,a){if(b>this._width||a>this._height)return new f.default;for(var e=null,d=-1,c=0;c<this._free.length;++c){var l=this._free[c];b<=l.width&&a<=l.height&&(null===e||l.y<=e.y&&l.x<=e.x)&&(e=l,d=c)}if(null===e)return new f.default;this._free.splice(d,1);e.width<e.height?(e.width>b&&this._free.push(new f.default(e.x+b,e.y,e.width-b,a)),e.height>a&&this._free.push(new f.default(e.x,e.y+a,e.width,
e.height-a))):(e.width>b&&this._free.push(new f.default(e.x+b,e.y,e.width-b,e.height)),e.height>a&&this._free.push(new f.default(e.x,e.y+a,b,e.height-a)));return new f.default(e.x,e.y,b,a)};b.prototype.release=function(b){for(var a=0;a<this._free.length;++a){var e=this._free[a];if(e.y===b.y&&e.height===b.height&&e.x+e.width===b.x)e.width+=b.width;else if(e.x===b.x&&e.width===b.width&&e.y+e.height===b.y)e.height+=b.height;else if(b.y===e.y&&b.height===e.height&&b.x+b.width===e.x)e.x=b.x,e.width+=b.width;
else if(b.x===e.x&&b.width===e.width&&b.y+b.height===e.y)e.y=b.y,e.height+=b.height;else continue;this._free.splice(a,1);this.release(b)}this._free.push(b)};return b}()})},"esri/views/2d/engine/webgl/GlyphSource":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../request ../../../../core/pbf ../../../../core/promiseUtils".split(" "),function(b,d,f,h,e,a){var q=function(){function a(a){this._metrics=[];for(this._bitmaps=[];a.next();)switch(a.tag()){case 1:for(var c=
a.getMessage();c.next();)switch(c.tag()){case 3:for(var b=c.getMessage(),l=void 0,g=void 0,e=void 0,d=void 0,m=void 0,f=void 0,h=void 0;b.next();)switch(b.tag()){case 1:l=b.getUInt32();break;case 2:g=b.getBytes();break;case 3:e=b.getUInt32();break;case 4:d=b.getUInt32();break;case 5:m=b.getSInt32();break;case 6:f=b.getSInt32();break;case 7:h=b.getUInt32();break;default:b.skip()}b.release();l&&(this._metrics[l]={width:e,height:d,left:m,top:f,advance:h},this._bitmaps[l]=g);break;default:c.skip()}c.release();
break;default:a.skip()}}a.prototype.getMetrics=function(a){return this._metrics[a]};a.prototype.getBitmap=function(a){return this._bitmaps[a]};return a}(),m=function(){function a(){this._ranges=[]}a.prototype.getRange=function(a){return this._ranges[a]};a.prototype.addRange=function(a,c){this._ranges[a]=c};return a}();return function(){function c(a){this._glyphInfo={};this._baseURL=a}c.prototype.getRange=function(c,b,d){var k=this._getFontStack(c);if(k.getRange(b))return a.resolve();var g=256*b,l=
g+255;c=this._baseURL.replace("{fontstack}",c).replace("{range}",g+"-"+l);return h(c,f({responseType:"array-buffer"},d)).then(function(a){k.addRange(b,new q(new e(new Uint8Array(a.data),new DataView(a.data))))})};c.prototype.getGlyph=function(a,c){if(a=this._getFontStack(a)){var b=Math.floor(c/256);if(!(256<b)&&(a=a.getRange(b)))return{metrics:a.getMetrics(c),bitmap:a.getBitmap(c)}}};c.prototype._getFontStack=function(a){var c=this._glyphInfo[a];c||(c=this._glyphInfo[a]=new m);return c};return c}()})},
"esri/views/2d/engine/webgl/SDFConverter":function(){define(["require","exports","../../../../core/promiseUtils","../../../../core/promiseUtils","./packingUtils"],function(b,d,f,h,e){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function a(a){this.size=a;this.canvas=document.createElement("canvas");this.canvas.width=this.canvas.height=a;this.context=this.canvas.getContext("2d");this._gridOuter=new Float64Array(a*a);this._gridInner=new Float64Array(a*a);this._f=new Float64Array(a);
this._d=new Float64Array(a);this._z=new Float64Array(a+1);this._v=new Int16Array(a)}a.prototype.draw=function(a,b,c){var l=this;void 0===c&&(c=31);this._initSVG();var k=this._createSVGString(a);return f.create(function(a,d){var g=new Image;g.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(k);g.onload=function(){l.context.clearRect(0,0,l.size,l.size);l.context.drawImage(g,0,0,l.size,l.size);for(var b=l.context.getImageData(0,0,l.size,l.size),k=new Uint8Array(l.size*l.size*4),d=0;d<l.size*
l.size;d++){var n=b.data[4*d+3]/255;l._gridOuter[d]=1===n?0:0===n?1E20:Math.pow(Math.max(0,.5-n),2);l._gridInner[d]=1===n?1E20:0===n?0:Math.pow(Math.max(0,n-.5),2)}l._edt(l._gridOuter,l.size,l.size);l._edt(l._gridInner,l.size,l.size);for(d=0;d<l.size*l.size;d++)e.packFloatRGBA(.5-(l._gridOuter[d]-l._gridInner[d])/(2*c),k,4*d);a(k)};var n=b&&b.signal;if(n)h.onAbort(n,function(){return d(h.createAbortError())})})};a.prototype._initSVG=function(){if(!this._svg){var a=document.createElementNS("http://www.w3.org/2000/svg",
"svg");a.setAttribute("style","position: absolute;");a.setAttribute("width","0");a.setAttribute("height","0");a.setAttribute("aria-hidden","true");a.setAttribute("role","presentation");document.body.appendChild(a);this._svg=a}};a.prototype._createSVGString=function(a){var b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttribute("d",a);this._svg.appendChild(b);a=b.getBBox();var c=a.width/a.height,l=this.size/2,k,e,d;1<c?(e=k=l/a.width,d=this.size/4,c=l-1/c*l/2):(k=e=l/a.height,
d=l-l*c/2,c=this.size/4);b.setAttribute("style","transform: matrix("+k+", 0, 0, "+e+", "+(-a.x*k+d)+", "+(-a.y*e+c)+")");a='\x3csvg style\x3d"fill:red;" height\x3d"'+this.size+'" width\x3d"'+this.size+'" xmlns\x3d"http://www.w3.org/2000/svg"\x3e'+this._svg.innerHTML+"\x3c/svg\x3e";this._svg.removeChild(b);return a};a.prototype._edt=function(a,b,c){for(var l=this._f,k=this._d,e=this._v,d=this._z,g=0;g<b;g++){for(var f=0;f<c;f++)l[f]=a[f*b+g];this._edt1d(l,k,e,d,c);for(f=0;f<c;f++)a[f*b+g]=k[f]}for(f=
0;f<c;f++){for(g=0;g<b;g++)l[g]=a[f*b+g];this._edt1d(l,k,e,d,b);for(g=0;g<b;g++)a[f*b+g]=Math.sqrt(k[g])}};a.prototype._edt1d=function(a,b,c,l,k){c[0]=0;l[0]=-1E20;l[1]=1E20;for(var e=1,d=0;e<k;e++){for(var g=(a[e]+e*e-(a[c[d]]+c[d]*c[d]))/(2*e-2*c[d]);g<=l[d];)d--,g=(a[e]+e*e-(a[c[d]]+c[d]*c[d]))/(2*e-2*c[d]);d++;c[d]=e;l[d]=g;l[d+1]=1E20}for(d=e=0;e<k;e++){for(;l[d+1]<e;)d++;b[e]=(e-c[d])*(e-c[d])+a[c[d]]}};return a}();d.default=b})},"esri/views/2d/engine/webgl/packingUtils":function(){define(["require",
"exports"],function(b,d){function f(a){return a-Math.floor(a)}Object.defineProperty(d,"__esModule",{value:!0});var h=[1,256,65536,16777216],e=[1/256,1/65536,1/16777216,1/4294967296],a=function(a,b){void 0===b&&(b=0);for(var c=0,l=0;4>l;l++)c+=a[b+l]*e[l];return c}(new Uint8ClampedArray([255,255,255,255]));d.packFloatRGBA=function(b,e,c){void 0===c&&(c=0);b=0>b?0:b>a?a:b;for(var l=0;4>l;l++)e[c+l]=Math.floor(256*f(b*h[l]))}})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define("require exports ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../webgl ./GeometryUtils ./Rect ./RectangleBinPack".split(" "),
function(b,d,f,h,e,a,q,m,c){function l(a){return a&&"static"===a.type}return function(){function b(a,b,g,k){void 0===k&&(k=0);this._mosaicPages=[];this._currentPage=this._maxItemSize=0;this._fixSpriteLocationsTable=h("fix-sprite-locations");this._testId=h("test-id");this._pageHeight=this._pageWidth=0;this._mosaicRects=new Map;this._spriteCopyQueue=[];this.pixelRatio=1;(0>=b||0>=g)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=b;this._pageHeight=
g;this._requestRender=a;0<k&&(this._maxItemSize=k);this.pixelRatio=window.devicePixelRatio||1;if(this._fixSpriteLocationsTable){a=[];for(var e in this._fixSpriteLocationsTable[this._testId])b=this._fixSpriteLocationsTable[this._testId][e],a[b.page]=b.pageSize;for(e=0;e<a.length;e++)b=a[e],this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(b[0]*b[1])},size:[b[0],b[1]],dirty:!0,texture:void 0})}this._binPack=new c(this._pageWidth,this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",
data:new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight))},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}b.prototype.getWidth=function(a){return a>=this._mosaicPages.length?-1:this._mosaicPages[a].size[0]};b.prototype.getHeight=function(a){return a>=this._mosaicPages.length?-1:this._mosaicPages[a].size[1]};b.prototype.getPageTexture=function(a){return a<this._mosaicPages.length?this._mosaicPages[a].texture:null};b.prototype.has=function(a){return this._mosaicRects.has(a)};
Object.defineProperty(b.prototype,"itemCount",{get:function(){return this._mosaicRects.size},enumerable:!0,configurable:!0});b.prototype.getSpriteItem=function(a){return this._mosaicRects.get(a)};b.prototype.addSpriteItem=function(a,c,b,k,e,d){var g;if(this._mosaicRects.has(a))return this._mosaicRects.get(a);var n,f;l(b)?this._fixSpriteLocationsTable&&this._fixSpriteLocationsTable[this._testId]&&this._fixSpriteLocationsTable[this._testId][a]?(g=this._fixSpriteLocationsTable[this._testId][a],n=g.rect,
f=g.page,g=g.pageSize):(g=this._allocateImage(c[0],c[1]),n=g[0],f=g[1],g=g[2]):(n=new m.default(0,0,c[0],c[1]),f=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:b,size:c,dirty:!0,texture:void 0}));if(0>=n.width||0>=n.height)return null;d={rect:n,width:c[0],height:c[1],sdf:e,simplePattern:d,pixelRatio:1,page:f};this._mosaicRects.set(a,d);l(b)&&this._copy({rect:n,spriteSize:c,spriteData:b.data,page:f,pageSize:g,repeat:k,sdf:e});return d};b.prototype.hasItemsToProcess=function(){return 0!==
this._spriteCopyQueue.length};b.prototype.processNextItem=function(){var a=this._spriteCopyQueue.pop();a&&this._copy(a)};b.prototype.getSpriteItems=function(a){for(var c={},b=0;b<a.length;b++){var k=a[b];c[k]=this.getSpriteItem(k)}return c};b.prototype.getMosaicItemPosition=function(a){var c=(a=this.getSpriteItem(a))&&a.rect;if(!c)return null;c.width=a.width;c.height=a.height;var b=this._mosaicPages[a.page];return{size:[a.width,a.height],tl:[(c.x+1)/b[0],(c.y+1)/b[1]],br:[(c.x+1+a.width)/b[0],(c.y+
1+a.height)/b[1]],page:a.page}};b.prototype.bind=function(c,b,g,k){void 0===g&&(g=0);void 0===k&&(k=0);g=this._mosaicPages[g];var d=g.mosaicsData,n=g.texture;n||(n=g.size,n=l(d)?new a.Texture(c,{pixelFormat:6408,dataType:5121,width:n[0],height:n[1]},new Uint8Array(d.data.buffer)):new a.Texture(c,{pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:n[0],height:n[1]},null),g.texture=n);n.setSamplingMode(b);l(d)?(c.bindTexture(n,k),g.dirty&&(n.setData(new Uint8Array(d.data.buffer)),
n.generateMipmap())):(b=d.data,d=b.bindFrame(c,n,k),e.isSome(this._requestRender)&&d&&0<b.frameCount&&this._requestRender.requestRender(),b.bindFrame(c,n,k));g.dirty=!1};b._copyBits=function(a,c,b,k,e,l,d,f,m,h,v){var g=k*c+b;d=f*l+d;if(v)for(d-=l,v=-1;v<=h;v++,g=((v+h)%h+k)*c+b,d+=l)for(f=-1;f<=m;f++)e[d+f]=a[g+(f+m)%m];else for(v=0;v<h;v++){for(f=0;f<m;f++)e[d+f]=a[g+f];g+=c;d+=l}};b.prototype._copy=function(a){if(!(a.page>=this._mosaicPages.length)){var c=this._mosaicPages[a.page],g=c.mosaicsData;
if(!l(c.mosaicsData))throw new f("mapview-invalid-resource","unsuitable data type!");var k=a.spriteData;(g=g.data)&&k||console.error("Source or target images are uninitialized!");b._copyBits(k,a.spriteSize[0],0,0,g,a.pageSize[0],a.rect.x+1,a.rect.y+1,a.spriteSize[0],a.spriteSize[1],a.repeat);c.dirty=!0}};b.prototype._allocateImage=function(a,b){a+=2;b+=2;var g=Math.max(a,b);if(this._maxItemSize&&this._maxItemSize<g){var g=Math.pow(2,Math.ceil(q.log2(a))),k=Math.pow(2,Math.ceil(q.log2(b)));a=new m.default(0,
0,a,b);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(g*k)},size:[g,k],dirty:!0,texture:void 0});return[a,this._mosaicPages.length-1,[g,k]]}g=this._binPack.allocate(a,b);return 0>=g.width?(g=this._mosaicPages[this._currentPage],!g.dirty&&l(g.mosaicsData)&&(g.mosaicsData=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,
texture:void 0}),this._binPack=new c(this._pageWidth,this._pageHeight),this._allocateImage(a,b)):[g,this._currentPage,[this._pageWidth,this._pageHeight]]};b.prototype.dispose=function(){this._binPack=null;for(var a=0,c=this._mosaicPages;a<c.length;a++){var b=c[a],k=b.texture;k&&k.dispose();b=b.mosaicsData;l(b)||b.data.pause()}this._mosaicPages=null;this._mosaicRects.clear()};return b}()})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["require","exports"],function(b,d){function f(b,
a){b%=a;return 0<=b?b:b+a}Object.defineProperty(d,"__esModule",{value:!0});d.C_INFINITY=Number.POSITIVE_INFINITY;d.C_PI=Math.PI;d.C_2PI=2*d.C_PI;d.C_PI_BY_2=d.C_PI/2;d.C_RAD_TO_256=128/d.C_PI;d.C_256_TO_RAD=d.C_PI/128;d.C_DEG_TO_256=256/360;d.C_DEG_TO_RAD=d.C_PI/180;d.C_SQRT2=1.414213562;d.C_SQRT2_INV=1/d.C_SQRT2;var h=1/Math.LN2;d.positiveMod=f;d.radToByte=function(b){return f(b*d.C_RAD_TO_256,256)};d.degToByte=function(b){return f(b*d.C_DEG_TO_256,256)};d.log2=function(b){return Math.log(b)*h};
d.sqr=function(b){return b*b};d.interpolate=function(b,a,d){return b*(1-d)+a*d};d.between=function(b,a,d){return b>=a&&b<=d||b>=d&&b<=a}})},"esri/views/2d/engine/webgl/animatedFormats/apng":function(){define("require exports ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/Error ../../../../../core/promiseUtils".split(" "),function(b,d,f,h,e,a,q){function m(a){var c=a.constructor===Uint8Array?a:
new Uint8Array(a);return A.some(function(a,b){return a!==c[b]})?!1:!0}function c(a,c){var b=new Uint8Array(c);if(A.some(function(a,c){return a!==b[c]}))return u;var k=!1;l(b,function(a){return!(k="acTL"===a)});if(!k)return y;var e=[],d=[],f=null,m=null,h=0;l(b,function(c,b,g,k){var l=new DataView(b.buffer);switch(c){case "IHDR":f=b.subarray(g+8,g+8+k);a.width=l.getUint32(g+8);a.height=l.getUint32(g+12);break;case "acTL":a.numPlays=l.getUint32(g+8+4);break;case "fcTL":m&&(a.frames.push(m),h++);m=new p;
m.width=l.getUint32(g+8+4);m.height=l.getUint32(g+8+8);m.left=l.getUint32(g+8+12);m.top=l.getUint32(g+8+16);c=l.getUint16(g+8+20);b=l.getUint16(g+8+22);0===b&&(b=100);m.delay=1E3*c/b;10>=m.delay&&(m.delay=100);a.playTime+=m.delay;m.disposeOp=l.getUint8(g+8+24);m.blendOp=l.getUint8(g+8+25);m.dataParts=[];0===h&&2===m.disposeOp&&(m.disposeOp=1);break;case "fdAT":m&&m.dataParts.push(b.subarray(g+8+4,g+8+k));break;case "IDAT":m&&m.dataParts.push(b.subarray(g+8,g+8+k));break;case "IEND":d.push(n(b,g,12+
k));break;default:e.push(n(b,g,12+k))}});if(0===a.frames.length)return y;a.frameCount=a.frames.length;var v=new Blob(e),t=new Blob(d);a.frames.forEach(function(a){var c=[];c.push(A);f.set(g(a.width),0);f.set(g(a.height),4);c.push(r("IHDR",f));c.push(v);a.dataParts.forEach(function(a){return c.push(r("IDAT",a))});c.push(t);a.data=new Blob(c,{type:"image/png"});delete a.dataParts;c=null});return a}function l(a,c){var b=new DataView(a.buffer),g=8,k,l,e;do l=b.getUint32(g),k=g+4,k=Array.prototype.slice.call(a.subarray(k,
k+4)),k=String.fromCharCode.apply(String,k),e=c(k,a,g,l),g+=12+l;while(!1!==e&&"IEND"!==k&&g<a.length)}function k(a){for(var c=new Uint8Array(a.length),b=0;b<a.length;b++)c[b]=a.charCodeAt(b);return c}function n(a,c,b){var g=new Uint8Array(b);g.set(a.subarray(c,c+b));return g}function r(a,c){var b=a.length+c.length,g=new Uint8Array(b+8),l=new DataView(g.buffer);l.setUint32(0,c.length);g.set(k(a),4);g.set(c,8);var e=4,d=b;void 0===e&&(e=0);void 0===d&&(d=g.length-e);a=-1;c=e;for(e+=d;c<e;c++)a=a>>>
8^x[(a^g[c])&255];l.setUint32(b+4,a^-1);return g}function g(a){return new Uint8Array([a>>>24&255,a>>>16&255,a>>>8&255,a&255])}Object.defineProperty(d,"__esModule",{value:!0});var x=new Uint32Array(256);for(b=0;256>b;b++){e=b;for(var t=0;8>t;t++)e=0!==(e&1)?3988292384^e>>>1:e>>>1;x[b]=e}var u=new a("Not a PNG"),y=new a("Not an animated PNG"),A=new Uint8Array([137,80,78,71,13,10,26,10]);d.isPNG=m;d.getPNGSize=function(a){a=new Uint8Array(a);var c,b;l(a,function(a,g,k){g=new DataView(g.buffer);"IHDR"===
a&&(c=g.getUint32(k+8),b=g.getUint32(k+12))});return[c,b]};d.isAnimatedPNG=function(a){a=new Uint8Array(a);if(!m(a))return!1;var c=!1;l(a,function(a){return!(c="acTL"===a)});return c};b=function(){function b(){this.playTime=this.numPlays=this.height=this.width=0;this.frames=[];this.playing=this.paused=!1;this.playSpeed=1;this.currentFrameNumber=0;this._lastUsedFrame=-1}b.create=function(c,g){return h(this,void 0,void 0,function(){var k,l;return f(this,function(e){switch(e.label){case 0:k=new b,e.label=
1;case 1:return e.trys.push([1,3,,4]),[4,k._load(c,g)];case 2:return e.sent(),[3,4];case 3:return l=e.sent(),q.isAbortError(l)?[3,4]:[2,new a("invalid-resource","Could not load PNG: "+l.message)];case 4:return[2,k]}})})};b.prototype.play=function(){this.playing||(this.paused=!1,this.playing=!0,this._play())};b.prototype.pause=function(){this.paused=!0;this.playing=!1;clearTimeout(this.timerID)};b.prototype.togglePlay=function(){this.paused||!this.playing?this.play():this.pause()};b.prototype.bindFrame=
function(a,c,b){a.bindTexture(c,b);a=this.frameChanged();if(!a)return!1;b=this.currentFrame;var g=b.frameData,k=c.descriptor;(b.left||b.top||b.width!==k.width||b.height!==k.height)&&c.setData(null);c.updateData(0,b.left,b.top,b.width,b.height,g);this.updateUsedFrame();return a};b.prototype.frameChanged=function(){return this._lastUsedFrame!==this.currentFrameNumber};b.prototype.updateUsedFrame=function(){this._lastUsedFrame=this.currentFrameNumber};b.prototype._load=function(b,g){return h(this,void 0,
void 0,function(){var g,k,l=this;return f(this,function(e){switch(e.label){case 0:e.trys.push([0,2,,3]);g=c(this,b);if(g!==this)return[2,g];this._resizeCanvas=document.createElement("canvas");this._resizeCanvas.width=this.width;this._resizeCanvas.height=this.height;return[4,q.all(this.frames.map(function(a){return a.createImage(l._resizeCanvas)}))];case 1:return e.sent(),[3,3];case 2:return k=e.sent(),q.isAbortError(k)?[3,3]:[2,new a("invalid-resource","Could not parse PNG")];case 3:return this.play(),
[2]}})})};b.prototype._play=function(){var a=this,c;if(0===this.playSpeed)this.pause();else{0>this.playSpeed?(--this.currentFrameNumber,0>this.currentFrameNumber&&(this.currentFrameNumber=this.frames.length-1),c=this.currentFrameNumber,--c,0>c&&(c=this.frames.length-1),c=1*-this.frames[c].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,c=1*this.frames[this.currentFrameNumber].delay/this.playSpeed);var b=this.frames[this.currentFrameNumber];this.currentFrame=
{frameData:b.imageData,top:b.top,left:b.left,width:b.width,height:b.height};this.timerID=window.setTimeout(function(){return a._play()},c)}};return b}();d.default=b;var p=function(){function a(){this.blendOp=this.disposeOp=this.delay=this.height=this.width=this.top=this.left=0;this.imageData=this.data=null}a.prototype.createImage=function(a){return h(this,void 0,void 0,function(){var c=this;return f(this,function(b){return null!==this.imageData?[2]:[2,q.create(function(b,g){var k=URL.createObjectURL(c.data),
l=document.createElement("img");l.onload=function(){URL.revokeObjectURL(k);var g;a.width=l.width;a.height=l.height;g=a.getContext("2d");g.drawImage(l,0,0,l.width,l.height);g=g.getImageData(0,0,l.width,l.height);g=new Uint8Array(g.data);for(var e,d=0;d<g.length;d+=4)e=g[d+3]/255,g[d]*=e,g[d+1]*=e,g[d+2]*=e;g=new ImageData(new Uint8ClampedArray(g.buffer),l.width,l.height);c.imageData=g;b()};l.onerror=function(){URL.revokeObjectURL(k);c.imageData=null;g(Error("Image creation error"))};l.src=k})]})})};
return a}()})},"esri/views/2d/engine/webgl/animatedFormats/gif":function(){define("require exports ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/Error ../../../../../core/promiseUtils".split(" "),function(b,d,f,h,e,a,q){function m(a){if(!a||0===a.byteLength)return!1;a=a.constructor===Uint8Array?a:new Uint8Array(a);return 71===a[0]&&73===a[1]&&70===a[2]&&56===a[3]}Object.defineProperty(d,"__esModule",
{value:!0});d.isGIF=m;d.getGIFSize=function(a){var c=new Uint8ClampedArray(a),b=6;a=c[b++]+(c[b++]<<8);c=c[b++]+(c[b++]<<8);return[a,c]};d.isAnimatedGIF=function(a){if(!a||0===a.byteLength)return!1;a=new Uint8Array(a);if(!m(a))return!1;for(var c=0,b=0,e=a.length-9;b<e&&(0!==a[b]||33!==a[b+1]||249!==a[b+2]||4!==a[b+3]||0!==a[b+8]||44!==a[b+9]&&33!==a[b+9]||(c++,!(1<c)));++b);return 1<c};b=function(){function b(){this.playing=this.paused=!1;this.waitTillDone=!0;this.firstFrameOnly=this.loading=!1;this.frames=
[];this.comment="";this.frameCount=this.currentFrameNumber=this.length=0;this.playSpeed=1;this.lastFrame=null;this.playOnLoad=!0;this.complete=!1;this.interlaceOffsets=[0,4,2,1];this.interlaceSteps=[8,8,4,2];this._lastUsedFrame=-1}b.create=function(c,e){return h(this,void 0,void 0,function(){var k,g;return f(this,function(l){switch(l.label){case 0:k=new b,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,k._load(c,e)];case 2:return l.sent(),[3,4];case 3:return g=l.sent(),q.isAbortError(g)?[3,4]:[2,
new a("invalid-resource","Could not load PNG: "+g.message)];case 4:return[2,k]}})})};b.prototype.play=function(){this.playing||(this.paused=!1,this.playing=!0,this._play())};b.prototype.pause=function(){this.paused=!0;this.playing=!1;clearTimeout(this.timerID)};b.prototype.togglePlay=function(){this.paused||!this.playing?this.play():this.pause()};b.prototype.bindFrame=function(a,c,b){a.bindTexture(c,b);if(a=this.frameChanged())b=this.currentFrame,c.updateData(0,0,0,b.width,b.height,b.frameData),this.updateUsedFrame();
return a};b.prototype.seekFrame=function(a){clearTimeout(this.timerID);this.currentFrameNumber=a%this.frames.length;this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)};b.prototype.seek=function(a){clearTimeout(this.timerID);0>a&&(a=0);a=1E3*a%this.length;for(var c=0;a>this.frames[c].time+this.frames[c].delay&&c<this.frames.length;)c+=1;this.currentFrameNumber=c;this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)};b.prototype.frameChanged=function(){return this._lastUsedFrame!==
this.currentFrameNumber};b.prototype.updateUsedFrame=function(){this._lastUsedFrame=this.currentFrameNumber};b.prototype._load=function(c,b){return h(this,void 0,void 0,function(){var k;return f(this,function(g){switch(g.label){case 0:return g.trys.push([0,2,,3]),this.loading=!0,[4,this._parse(c,b)];case 1:return g.sent(),this.loading=!1,this.play(),[3,3];case 2:return k=g.sent(),q.isAbortError(k)?[3,3]:[2,new a("invalid-resource","Could not parse gif!")];case 3:return[2]}})})};b.prototype._parse=
function(a,b){var k=this,g=new c(a);g.pos+=6;this.width=g.data[g.pos++]+(g.data[g.pos++]<<8);this.height=g.data[g.pos++]+(g.data[g.pos++]<<8);a=g.data[g.pos++];this.globalColourCount=1<<(a&7)+1;g.pos++;g.pos++;a&128&&(this.globalColourTable=this._parseColourTable(this.globalColourCount,g));return q.create(function(a,c){setTimeout(function(){return k._parseBlock(g,a,c,b)},0)})};b.prototype._parseBlock=function(a,c,b,g){return h(this,void 0,void 0,function(){var k,e=this;return f(this,function(l){if(g&&
g.signal&&q.isAborted(g.signal))return b(q.createAbortError()),[2];k=a.data[a.pos++];if(44===k){if(this._parseImg(a),this.firstFrameOnly)return this._finishedLoading(),c(),[2]}else{if(59===k)return this._finishedLoading(),c(),[2];this._parseExt(a)}if("function"===typeof this.onprogress)this.onprogress({bytesRead:a.pos,totalBytes:a.data.length,frame:this.frames.length});setTimeout(function(){return e._parseBlock(a,c,b,g)},0);return[2]})})};b.prototype._parseColourTable=function(a,c){for(var b=[],g=
0;g<a;g++)b.push([c.data[c.pos++],c.data[c.pos++],c.data[c.pos++]]);return b};b.prototype._parseImg=function(a){var c={};this.frames.push(c);c.disposalMethod=this.disposalMethod;c.time=this.length;c.delay=10*this.delayTime;this.length+=c.delay;c.transparencyIndex=this.transparencyGiven?this.transparencyIndex:void 0;c.leftPos=a.data[a.pos++]+(a.data[a.pos++]<<8);c.topPos=a.data[a.pos++]+(a.data[a.pos++]<<8);c.width=a.data[a.pos++]+(a.data[a.pos++]<<8);c.height=a.data[a.pos++]+(a.data[a.pos++]<<8);
var b=a.data[a.pos++];c.localColourTableFlag=b&128?!0:!1;c.localColourTableFlag&&(c.localColourTable=this._parseColourTable(1<<(b&7)+1,a));this.pixelBufSize!==c.width*c.height&&(this.pixelBuf=new Uint8Array(c.width*c.height),this.pixelBufSize=c.width*c.height);this._lzwDecode(a.data[a.pos++],a.readSubBlocksB());if(b&64){c.interlaced=!0;a=c.width;b=this.pixelBufSize/a;this.interlacedBufSize!==this.pixelBufSize&&(this.deinterlaceBuf=new Uint8Array(this.pixelBufSize),this.interlacedBufSize=this.pixelBufSize);
for(var g=0,k=0;4>k;k++)for(var e=this.interlaceOffsets[k];e<b;e+=this.interlaceSteps[k])this.deinterlaceBuf.set(this.pixelBuf.subarray(g,g+a),e*a),g+=a}else c.interlaced=!1;this._processFrame(c)};b.prototype._lzwDecode=function(a,c){var b,g,k,e,l,d,f,m,n,h;k=g=0;var q=[];e=1<<a;l=e+1;d=a+1;for(h=!1;!h;){m=f;for(b=f=0;b<d;b++)c[k>>3]&1<<(k&7)&&(f|=1<<b),k++;if(f===e){q=[];d=a+1;for(b=0;b<e;b++)q[b]=[b];q[e]=[];q[l]=null}else{if(f===l){h=!0;break}f>=q.length?q.push(q[m].concat(q[m][0])):m!==e&&q.push(q[m].concat(q[f][0]));
m=q[f];n=m.length;for(b=0;b<n;b++)this.pixelBuf[g++]=m[b];q.length===1<<d&&12>d&&d++}}};b.prototype._processFrame=function(a){a.image=document.createElement("canvas");a.image.width=this.width;a.image.height=this.height;a.ctx=a.image.getContext("2d");var c=a.localColourTableFlag?a.localColourTable:this.globalColourTable;null===this.lastFrame&&(this.lastFrame=a);var b=2===this.lastFrame.disposalMethod||3===this.lastFrame.disposalMethod?!0:!1;b||a.ctx.drawImage(this.lastFrame.image,0,0,this.width,this.height);
for(var g=a.ctx.getImageData(a.leftPos,a.topPos,a.width,a.height),e=a.transparencyIndex,k=g.data,l=a.interlaced?this.deinterlaceBuf:this.pixelBuf,d=l.length,f=0,m,h,v=0;v<d;v++)m=l[v],h=c[m],e!==m?(k[f++]=h[0],k[f++]=h[1],k[f++]=h[2],k[f++]=255):(b&&(k[f+3]=0),f+=4);a.ctx.putImageData(g,a.leftPos,a.topPos);this.lastFrame=a};b.prototype._parseExt=function(a){var c=a.data[a.pos++];249===c?this._parseGCExt(a):254===c?this.comment+=a.readSubBlocks():255===c?this._parseAppExt(a):(1===c&&(a.pos+=13),a.readSubBlocks())};
b.prototype._parseAppExt=function(a){a.pos+=1;"NETSCAPE"===a.getString(8)?a.pos+=8:(a.pos+=3,a.readSubBlocks())};b.prototype._parseGCExt=function(a){var c;a.pos++;c=a.data[a.pos++];this.disposalMethod=(c&28)>>2;this.transparencyGiven=c&1?!0:!1;this.delayTime=a.data[a.pos++]+(a.data[a.pos++]<<8);this.transparencyIndex=a.data[a.pos++];a.pos++};b.prototype._finishedLoading=function(){this.loading=!1;this.frameCount=this.frames.length;this.lastFrame=null;this.complete=!0;this.deinterlaceBuf=this.pixelBufSize=
this.deinterlaceBuf=this.pixelBuf=this.waitTillDone=this.transparencyIndex=this.delayTime=this.transparencyGiven=this.disposalMethod=void 0;this.currentFrameNumber=0;0<this.frames.length&&this._setCurrentFrame(0);this.playOnLoad&&this.play()};b.prototype._play=function(){var a=this,c;0===this.playSpeed?this.pause():(0>this.playSpeed?(--this.currentFrameNumber,0>this.currentFrameNumber&&(this.currentFrameNumber=this.frames.length-1),c=this.currentFrameNumber,--c,0>c&&(c=this.frames.length-1),c=1*-this.frames[c].delay/
this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,c=1*this.frames[this.currentFrameNumber].delay/this.playSpeed),this._setCurrentFrame(this.currentFrameNumber),this.timerID=window.setTimeout(function(){return a._play()},c))};b.prototype._setCurrentFrame=function(a){this.currentFrame={frameData:this.frames[a].image,top:0,left:0,width:this.width,height:this.height}};return b}();d.default=b;var c=function(){function a(a){this.pos=0;this.data=new Uint8ClampedArray(a);
this.len=this.data.length}a.prototype.getString=function(a){for(var c="";a--;)c+=String.fromCharCode(this.data[this.pos++]);return c};a.prototype.readSubBlocks=function(){var a,c,b="";do for(c=a=this.data[this.pos++];c--;)b+=String.fromCharCode(this.data[this.pos++]);while(0!==a&&this.pos<this.len);return b};a.prototype.readSubBlocksB=function(){var a,c,b=[];do for(c=a=this.data[this.pos++];c--;)b.push(this.data[this.pos++]);while(0!==a&&this.pos<this.len);return b};return a}()})},"esri/views/2d/engine/webgl/util/BidiText":function(){define(["require",
"exports","../../../../../core/BidiEngine"],function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});var h=new f.default;d.bidiText=function(b){if(!h.hasBidiChar(b))return[b,!1];var a;a="rtl"===h.checkContextual(b)?"IDNNN":"ICNNN";return[h.bidiTransform(b,a,"VLYSN"),!0]}})},"esri/core/BidiEngine":function(){define(["require","exports","./bidiEngineTables"],function(b,d,f){function h(c,b,g,k,l){var d=c;void 0===b&&(b=l.defInFormat);void 0===g&&(g=l.defOutFormat);void 0===k&&(k=l.defSwap);if(b!==
g){var f=b.substring(0,1),n=g.substring(0,1),p;p=b.substring(1,4);var r=g.substring(1,4);"C"===p.charAt(0)&&(p=e(d),p="ltr"===p||"rtl"===p?p.toUpperCase():"L"===b.charAt(2)?"LTR":"RTL",b=f+p);"C"===r.charAt(0)&&(p=e(d),"rtl"===p?r="RTL":"ltr"===p?(d=d.split(""),d.reverse(),p=e(d.join("")),r=p.toUpperCase()):r="L"===g.charAt(2)?"LTR":"RTL",g=n+r)}if(b===g)return c;n=b.substring(0,1);d=b.substring(1,4);f=g.substring(0,1);r=g.substring(1,4);l.inFormat=b;l.outFormat=g;l.swap=k;if("L"===n&&"VLTR"===g){if("LTR"===
d)return l.dir=B,a(c,l);if("RTL"===d)return l.dir=C,a(c,l)}if("V"===n&&"V"===f)return l.dir="RTL"===d?C:B,m(c,l);if("L"===n&&"VRTL"===g)return l.dir="LTR"===d?B:C,c=a(c,l),m(c);if("VLTR"===b&&"LLTR"===g)return l.dir=B,a(c,l);if("V"===n&&"L"===f&&d!==r)return c=m(c),"RTL"===d?h(c,"LLTR","VLTR",k,l):h(c,"LRTL","VRTL",k,l);if("VRTL"===b&&"LRTL"===g)return h(c,"LRTL","VRTL",k,l);"L"===n&&"L"===f&&(b=l.swap,l.swap=b.substr(0,1)+"N","RTL"===d?(l.dir=C,c=a(c,l),l.swap="N"+b.substr(1,2),l.dir=B,c=a(c,l)):
(l.dir=B,c=a(c,l),l.swap="N"+b.substr(1,2),c=h(c,"VLTR","LRTL",l.swap,l)));return c}function e(a){return(a=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(a))?"z">=a[0]?"ltr":"rtl":""}function a(a,c){a=a.split("");var b=[];q(a,b,c);if(0!==c.hiLevel&&c.swap.substr(0,1)!==c.swap.substr(1,2))for(var g=0;g<a.length;g++)if(1===b[g]){var e=g,l;b:{l=a[g];for(var d=void 0,m=0,n=f.SwapTable.length-1;m<=n;)if(d=Math.floor((m+n)/2),l<f.SwapTable[d][0])n=d-1;else if(l>f.SwapTable[d][0])m=
d+1;else{l=f.SwapTable[d][1];break b}}a[e]=l}k(2,a,b,c);k(1,a,b,c);p=b;return a.join("")}function q(a,c,b){var g=a.length,e=b.dir?f.impTabRtl:f.impTabLtr,l=null,k=null,d=null,l=0,k=k=null,m=-1,h=k=null,p=[],r=[];b.hiLevel=b.dir;b.lastArabic=!1;b.hasUbatAl=!1;b.hasUbatB=!1;b.hasUbatS=!1;for(k=0;k<g;k++){var h=k,d=a[k].charCodeAt(0),t=f.MasterTable[d>>8];p[h]=t<f.TBBASE?t:f.UnicodeTable[t-f.TBBASE][d&255]}for(h=0;h<g;h++){r[h]=k=n(a,p,r,h,b);l=e[l][k];k=l&240;l&=15;c[h]=d=e[l][v];if(0<k){if(16===k)for(k=
m;k<h;k++)c[k]=1;m=-1}if(k=e[l][z])-1===m&&(m=h);else if(-1<m){for(k=m;k<h;k++)c[k]=d;m=-1}p[h]===f.UBAT_B&&(c[h]=0);b.hiLevel|=d}if(b.hasUbatS)for(a=0;a<g;a++)if(p[a]===f.UBAT_S)for(c[a]=b.dir,e=a-1;0<=e;e--)if(p[e]===f.UBAT_WS)c[e]=b.dir;else break}function m(a,c){a=a.split("");if(c){var b=[];q(a,b,c);p=b}a.reverse();y.reverse();return a.join("")}function c(a){for(var c=0;c<f.ArabicAlefBetIntervalsBegine.length;c++)if(a>=f.ArabicAlefBetIntervalsBegine[c]&&a<=f.ArabicAlefBetIntervalsEnd[c])return!0;
return!1}function l(a,b,e,l){for(;b*e<l&&g(a[b]);)b+=e;return b*e<l&&c(a[b])?!0:!1}function k(a,c,b,g){if(!(g.hiLevel<a))if(1!==a||g.dir!==C||g.hasUbatB){g=c.length;for(var e=0,l,k,d;e<g;){if(b[e]>=a){for(l=e+1;l<g&&b[l]>=a;)l++;for(k=l-1;e<k;e++,k--)d=c[e],c[e]=c[k],c[k]=d,d=y[e],y[e]=y[k],y[k]=d;e=l}e++}}else c.reverse(),y.reverse()}function n(a,c,b,g,e){return{UBAT_L:function(){e.lastArabic=!1;return f.UBAT_L},UBAT_R:function(){e.lastArabic=!1;return f.UBAT_R},UBAT_ON:function(){return f.UBAT_ON},
UBAT_AN:function(){return f.UBAT_AN},UBAT_EN:function(){return e.lastArabic?f.UBAT_AN:f.UBAT_EN},UBAT_AL:function(){e.lastArabic=!0;e.hasUbatAl=!0;return f.UBAT_R},UBAT_WS:function(){return f.UBAT_ON},UBAT_CS:function(){var a,l;if(1>g||g+1>=c.length||(a=b[g-1])!==f.UBAT_EN&&a!==f.UBAT_AN||(l=c[g+1])!==f.UBAT_EN&&l!==f.UBAT_AN)return f.UBAT_ON;e.lastArabic&&(l=f.UBAT_AN);return l===a?l:f.UBAT_ON},UBAT_ES:function(){return(0<g?b[g-1]:f.UBAT_B)===f.UBAT_EN&&g+1<c.length&&c[g+1]===f.UBAT_EN?f.UBAT_EN:
f.UBAT_ON},UBAT_ET:function(){if(0<g&&b[g-1]===f.UBAT_EN)return f.UBAT_EN;if(e.lastArabic)return f.UBAT_ON;for(var a=g+1,l=c.length;a<l&&c[a]===f.UBAT_ET;)a++;return a<l&&c[a]===f.UBAT_EN?f.UBAT_EN:f.UBAT_ON},UBAT_NSM:function(){if("VLTR"===e.inFormat){for(var l=c.length,k=g+1;k<l&&c[k]===f.UBAT_NSM;)k++;if(k<l&&(l=a[g].charCodeAt[0],k=c[k],(1425<=l&&2303>=l||64286===l)&&(k===f.UBAT_R||k===f.UBAT_AL)))return f.UBAT_R}return 1>g||c[g-1]===f.UBAT_B?f.UBAT_ON:b[g-1]},UBAT_B:function(){e.lastArabic=!0;
e.hasUbatB=!0;return e.dir},UBAT_S:function(){e.hasUbatS=!0;return f.UBAT_ON},UBAT_LRE:function(){e.lastArabic=!1;return f.UBAT_ON},UBAT_RLE:function(){e.lastArabic=!1;return f.UBAT_ON},UBAT_LRO:function(){e.lastArabic=!1;return f.UBAT_ON},UBAT_RLO:function(){e.lastArabic=!1;return f.UBAT_ON},UBAT_PDF:function(){e.lastArabic=!1;return f.UBAT_ON},UBAT_BN:function(){return f.UBAT_ON}}[f.TYPES_NAMES[c[g]]]()}function r(a,c){for(var b=0;b<f.BaseForm.length;b++)if(a===f.BaseForm[b])return c[b];return a}
function g(a){return"\u064b"<=a&&"\u0655">=a?!0:!1}function x(a){return"L"===a?"LTR":"R"===a?"RTL":"C"===a?"CLR":"D"===a?"CRL":""}function t(a,c){for(var b=0;b<f.AlefTable.length;b++)if(a===f.AlefTable[b])return c[b];return a}function u(a,c,b,g){for(var e=0;e<a.length;e++)if(a[e]>c||!b&&a[e]===c)a[e]+=g}Object.defineProperty(d,"__esModule",{value:!0});b=function(){function a(){this.inputFormat="ILYNN";this.outputFormat="VLNNN";this.sourceToTarget=[];this.targetToSource=[];this.levels=[]}a.prototype.bidiTransform=
function(a,b,e){this.sourceToTarget=[];this.targetToSource=[];if(!a)return"";var k=this.sourceToTarget,d=this.targetToSource,m=a.length;y=[];p=[];for(var n=0;n<m;n++)k[n]=n,d[n]=n,y[n]=n;if(!this.checkParameters(b,e))return a;b=this.inputFormat;e=this.outputFormat;var k=a,k=w,n=x(b.charAt(1)),d=x(e.charAt(1)),v="I"===b.charAt(0)?"L":b.charAt(0),m="I"===e.charAt(0)?"L":e.charAt(0),n=v+n,d=m+d,m=b.charAt(2)+e.charAt(2);k.defInFormat=n;k.defOutFormat=d;k.defSwap=m;a=h(a,n,d,m,k);k=!1;if("R"===e.charAt(1))k=
!0;else if("C"===e.charAt(1)||"D"===e.charAt(1))k="rtl"===this.checkContextual(a);d=this.sourceToTarget=y;m=Array(d.length);for(n=0;n<d.length;n++)m[d[n]]=n;A=this.targetToSource=m;if(b.charAt(3)===e.charAt(3))k=a;else if("S"===e.charAt(3))if(b=k,e=!0,0===a.length)k="";else{void 0===b&&(b=!0);void 0===e&&(e=!0);a=String(a);a=a.split("");var q=0,d=1,k=a.length;b||(q=a.length-1,d=-1,k=1);for(var m=k,n=e,z=0,k=[],v=0;q*d<m;q+=d)if(c(a[q])||g(a[q])){var C;if(C="\u0644"===a[q])b:{for(var B=a,J=q+d,D=d,
G=m;J*D<G&&g(B[J]);)J+=D;C=" ";if(J*D<G)for(C=B[J],B=0;B<f.AlefTable.length;B++)if(f.AlefTable[B]===C){C=!0;break b}C=!1}if(C){a[q]=0===z?t(a[q+d],f.LamAlefInialTableFE):t(a[q+d],f.LamAlefMedialTableFE);q+=d;z=a;C=q;B=d;for(J=m;C*B<J&&g(z[C]);)C+=B;C*B<J&&(z[C]=" ");n&&(k[v]=q,v++);z=0}else{C=a[q];if(1===z){B=q;if(l(a,q+d,d,m))b:for(J=a[q],D=0;D<f.BaseForm.length;D++){if(J===f.BaseForm[D]){J=f.MedialForm[D];break b}}else J=r(a[q],f.FinalForm);a[B]=J}else!0===l(a,q+d,d,m)?a[q]=r(a[q],f.InitialForm):
a[q]=r(a[q],f.IsolatedForm);g(C)||(z=1);b:{for(B=0;B<f.StandAlonForm.length;B++)if(f.StandAlonForm[B]===C){C=!0;break b}C=!1}!0===C&&(z=0)}}else z=0;d="";for(m=0;m<a.length;m++){if(n=e){b:{for(n=0;n<k.length;n++)if(k[n]===m)break b;n=-1}n=-1<n}n?(u(A,m,!b,-1),y.splice(m,1)):d+=a[m]}k=d}else if(b=a,e=k,a=!0,0===b.length)k="";else for(void 0===a&&(a=!0),void 0===e&&(e=!0),b=String(b),k="",d=b.split(""),m=0;m<b.length;m++)n=!1,"\ufe70"<=d[m]&&"\ufeff">d[m]?(v=b.charCodeAt(m),"\ufef5"<=d[m]&&"\ufefc">=
d[m]?(e?(0<m&&a&&" "===d[m-1]?k=k.substring(0,k.length-1)+"\u0644":(k+="\u0644",n=!0),k+=f.AlefTable[(v-65269)/2]):(k+=f.AlefTable[(v-65269)/2],k+="\u0644",m+1<b.length&&a&&" "===d[m+1]?m++:n=!0),n&&(u(A,m,!0,1),y.splice(m,0,y[m]))):k+=f.FETo06Table[v-65136]):k+=d[m];this.sourceToTarget=y;this.targetToSource=A;this.levels=p;return k};a.prototype._inputFormatSetter=function(a){if(!D.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=a};a.prototype._outputFormatSetter=
function(a){if(!D.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=a};a.prototype.checkParameters=function(a,c){a?this._inputFormatSetter(a):a=this.inputFormat;c?this._outputFormatSetter(c):c=this.outputFormat;return a===c?!1:!0};a.prototype.checkContextual=function(a){a=e(a);if("ltr"!==a&&"rtl"!==a){try{a=document.dir.toLowerCase()}catch(H){}"ltr"!==a&&"rtl"!==a&&(a="ltr")}return a};a.prototype.hasBidiChar=function(a){return G.test(a)};return a}();
d.default=b;var y=[],A=[],p=[],w={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1,defOutFormat:""},v=5,z=6,B=0,C=1,D=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,G=/[\u0591-\u06ff\ufb1d-\ufefc]/})},"esri/core/bidiEngineTables":function(){define(["require","exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});d.SwapTable=[["(",")"],[")","("],["\x3c","\x3e"],["\x3e","\x3c"],
["[","]"],["]","["],["{","}"],["}","{"],["\u00ab","\u00bb"],["\u00bb","\u00ab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]];d.AlefTable=["\u0622","\u0623","\u0625","\u0627"];d.LamAlefInialTableFE=
["\ufef5","\ufef7","\ufef9","\ufefb"];d.LamAlefMedialTableFE=["\ufef6","\ufef8","\ufefa","\ufefc"];d.BaseForm="\u0627\u0628\u062a\u062b\u062c\u062d\u062e\u062f\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063a\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u06cc\u0626\u0624".split("");d.IsolatedForm="\ufe8d\ufe8f\ufe95\ufe99\ufe9d\ufea1\ufea5\ufea9\ufeab\ufead\ufeaf\ufeb1\ufeb5\ufeb9\ufebd\ufec1\ufec5\ufec9\ufecd\ufed1\ufed5\ufed9\ufedd\ufee1\ufee5\ufee9\ufeed\ufef1\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfc\ufe89\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe89\ufe85".split("");
d.FinalForm="\ufe8e\ufe90\ufe96\ufe9a\ufe9e\ufea2\ufea6\ufeaa\ufeac\ufeae\ufeb0\ufeb2\ufeb6\ufeba\ufebe\ufec2\ufec6\ufeca\ufece\ufed2\ufed6\ufeda\ufede\ufee2\ufee6\ufeea\ufeee\ufef2\ufe88\ufe84\ufe82\ufe94\ufef0\ufbfd\ufe8a\ufe86\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8a\ufe86".split("");d.MedialForm="\ufe8e\ufe92\ufe98\ufe9c\ufea0\ufea4\ufea8\ufeaa\ufeac\ufeae\ufeb0\ufeb4\ufeb8\ufebc\ufec0\ufec4\ufec8\ufecc\ufed0\ufed4\ufed8\ufedc\ufee0\ufee4\ufee8\ufeec\ufeee\ufef4\ufe88\ufe84\ufe82\ufe94\ufef0\ufbff\ufe8c\ufe86\ufe71\ufe72\ufe74\ufe77\ufe79\ufe7b\ufe7d\ufe7f\ufe80\ufe8c\ufe86".split("");
d.InitialForm="\ufe8d\ufe91\ufe97\ufe9b\ufe9f\ufea3\ufea7\ufea9\ufeab\ufead\ufeaf\ufeb3\ufeb7\ufebb\ufebf\ufec3\ufec7\ufecb\ufecf\ufed3\ufed7\ufedb\ufedf\ufee3\ufee7\ufeeb\ufeed\ufef3\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfe\ufe8b\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8b\ufe85".split("");d.StandAlonForm="\u0621\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0649".split("");d.FETo06Table="\u064b\u064b\u064c\u061f\u064d\u061f\u064e\u064e\u064f\u064f\u0650\u0650\u0651\u0651\u0652\u0652\u0621\u0622\u0622\u0623\u0623\u0624\u0624\u0625\u0625\u0626\u0626\u0626\u0626\u0627\u0627\u0628\u0628\u0628\u0628\u0629\u0629\u062a\u062a\u062a\u062a\u062b\u062b\u062b\u062b\u062c\u062c\u062c\u062c\u062d\u062d\u062d\u062d\u062e\u062e\u062e\u062e\u062f\u062f\u0630\u0630\u0631\u0631\u0632\u0632\u0633\u0633\u0633\u0633\u0634\u0634\u0634\u0634\u0635\u0635\u0635\u0635\u0636\u0636\u0636\u0636\u0637\u0637\u0637\u0637\u0638\u0638\u0638\u0638\u0639\u0639\u0639\u0639\u063a\u063a\u063a\u063a\u0641\u0641\u0641\u0641\u0642\u0642\u0642\u0642\u0643\u0643\u0643\u0643\u0644\u0644\u0644\u0644\u0645\u0645\u0645\u0645\u0646\u0646\u0646\u0646\u0647\u0647\u0647\u0647\u0648\u0648\u0649\u0649\u064a\u064a\u064a\u064a\ufef5\ufef6\ufef7\ufef8\ufef9\ufefa\ufefb\ufefc\u061f\u061f\u061f".split("");
d.ArabicAlefBetIntervalsBegine=["\u0621","\u0641"];d.ArabicAlefBetIntervalsEnd=["\u063a","\u064a"];d.impTabLtr=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]];d.impTabRtl=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]];d.UBAT_L=0;d.UBAT_R=1;d.UBAT_EN=2;d.UBAT_AN=3;d.UBAT_ON=4;d.UBAT_B=5;d.UBAT_S=6;d.UBAT_AL=7;d.UBAT_WS=8;d.UBAT_CS=9;d.UBAT_ES=10;d.UBAT_ET=11;d.UBAT_NSM=12;d.UBAT_LRE=13;d.UBAT_RLE=14;d.UBAT_PDF=15;d.UBAT_LRO=16;
d.UBAT_RLO=17;d.UBAT_BN=18;d.TYPES_NAMES="UBAT_L UBAT_R UBAT_EN UBAT_AN UBAT_ON UBAT_B UBAT_S UBAT_AL UBAT_WS UBAT_CS UBAT_ES UBAT_ET UBAT_NSM UBAT_LRE UBAT_RLE UBAT_PDF UBAT_LRO UBAT_RLO UBAT_BN".split(" ");d.TBBASE=100;b=d.UBAT_L;var f=d.UBAT_R,h=d.UBAT_EN,e=d.UBAT_AN,a=d.UBAT_ON,q=d.UBAT_B,m=d.UBAT_S,c=d.UBAT_AL,l=d.UBAT_WS,k=d.UBAT_CS,n=d.UBAT_ES,r=d.UBAT_ET,g=d.UBAT_NSM,x=d.UBAT_LRE,t=d.UBAT_RLE,u=d.UBAT_PDF,y=d.UBAT_LRO,A=d.UBAT_RLO,p=d.UBAT_BN;d.MasterTable=[d.TBBASE+0,b,b,b,b,d.TBBASE+1,d.TBBASE+
2,d.TBBASE+3,f,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,d.TBBASE+4,a,a,a,b,a,b,a,b,a,a,a,b,b,a,a,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,b,b,a,a,b,b,a,a,b,b,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,
b,b,b,d.TBBASE+5,c,c,d.TBBASE+6,d.TBBASE+7];d.UnicodeTable=[[p,p,p,p,p,p,p,p,p,m,q,m,l,q,p,p,p,p,p,p,p,p,p,p,p,p,p,p,q,q,q,m,l,a,a,r,r,r,a,a,a,a,a,n,k,n,k,k,h,h,h,h,h,h,h,h,h,h,k,a,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,a,a,a,p,p,p,p,p,p,q,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,k,a,r,r,r,r,a,a,a,a,b,a,a,p,a,a,r,r,h,h,a,b,a,a,a,h,b,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,b,b,b,b,
b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,b,b,b,b,b,b,b,b],[b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,a,b,b,b,b,b,b,b,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,b,a,a,a,a,a,a,a,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,f,g,f,g,g,f,g,g,f,g,a,a,a,a,a,a,a,a,f,f,f,f,f,f,
f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,a,a,a,a,a,f,f,f,f,f,a,a,a,a,a,a,a,a,a,a,a],[e,e,e,e,a,a,a,a,c,r,r,c,k,c,a,a,g,g,g,g,g,g,g,g,g,g,g,c,a,a,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,e,e,e,e,e,e,e,e,e,e,r,e,e,c,c,c,g,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,
c,c,c,c,c,c,g,g,g,g,g,g,g,e,a,g,g,g,g,g,g,c,c,g,g,a,g,g,g,g,c,c,h,h,h,h,h,h,h,h,h,h,c,c,c,c,c,c],[c,c,c,c,c,c,c,c,c,c,c,c,c,c,a,c,c,g,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,a,a,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,g,g,g,g,g,g,g,g,g,g,g,c,a,a,a,a,a,a,a,a,a,a,a,a,a,a,f,f,f,f,f,f,f,f,f,f,
f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,g,g,g,g,g,g,g,g,g,f,f,a,a,a,a,f,a,a,a,a,a],[l,l,l,l,l,l,l,l,l,l,l,p,p,p,b,f,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,l,q,x,t,u,y,A,k,r,r,r,r,r,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,k,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,l,p,p,p,p,p,a,a,a,a,a,p,p,p,p,p,p,h,b,a,a,h,h,h,h,h,h,n,n,a,a,a,b,h,h,h,h,h,h,h,h,h,h,n,n,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,a,a,a,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,a,a,a,a,a,a,a,a,a,a,
a,a,a,a,a,a,a,a,a,a,a,a,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a],[b,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,a,b,b,b,b,b,a,a,a,a,a,f,g,f,f,f,f,f,f,f,f,f,f,n,f,f,f,f,f,f,f,f,f,f,f,f,f,a,f,f,f,f,f,a,f,a,f,f,a,f,f,a,f,f,f,f,f,f,f,f,f,f,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,
c,c,c,c,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c],[g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,g,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,g,g,g,g,g,g,g,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,k,a,k,a,a,k,a,a,a,a,a,a,a,a,a,r,a,a,n,n,a,a,a,a,a,r,r,a,a,a,a,a,c,c,c,c,c,a,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,
c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,a,a,p],[a,a,a,r,r,r,a,a,a,a,a,n,k,n,k,k,h,h,h,h,h,h,h,h,h,h,k,a,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,a,a,a,a,a,a,a,a,a,a,a,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,b,
b,b,b,b,b,b,b,b,b,b,b,b,b,a,a,a,b,b,b,b,b,b,a,a,b,b,b,b,b,b,a,a,b,b,b,b,b,b,a,a,b,b,b,a,a,a,r,r,a,a,a,r,r,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a]]})},"esri/views/2d/engine/webgl/util/Result":function(){define(["require","exports","../../../../../core/Error"],function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});d.ok=function(b,e){return b&&"name"in b?(e&&e.error(new f(b.name,b.message,b.details)),!1):!0}})},"esri/views/2d/engine/webgl/util/symbolUtils":function(){define(["require",
"exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});d.keyFromSymbol=function(b){switch(b.type){case "esriSMS":return b.style+"."+b.path;case "esriSLS":return b.style+"."+b.cap;case "esriSFS":return""+b.style;case "esriPFS":case "esriPMS":return b.imageData?b.imageData:""+b.url+b.width+b.height;default:return b.mosaicHash?b.mosaicHash:JSON.stringify(b)}}})},"esri/views/2d/engine/webgl/effects/AnimationEffect":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/maybe ../definitions ../VertexStream ./Effect".split(" "),
function(b,d,f,h,e,a,q){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.defines=[];a._desc={path:"fx/integrate",attributes:{a_position:0}};return a}f(c,b);c.prototype.dispose=function(){this._quad&&this._quad.dispose()};c.prototype.bind=function(){};c.prototype.unbind=function(){};c.prototype.draw=function(c,b){if(b.size){var k=c.context,l=c.renderingOptions;this._quad||(this._quad=new a(k,[0,0,1,0,0,1,1,1]));var g=k.getBoundFramebufferObject(),
d=k.getViewport(),m=d.x,f=d.y,q=d.width,d=d.height;b.bindTextures(k);var A=b.getBlock(e.ATTRIBUTE_DATA_ANIMATION);if(!h.isNone(A)){var p=A.getFBO(k),A=A.getFBO(k,1);k.setViewport(0,0,b.size,b.size);this._computeDelta(c,A,l.labelsAnimationTime);this._updateAnimationState(c,A,p);k.bindFramebuffer(g);k.setViewport(m,f,q,d)}}};c.prototype._computeDelta=function(a,c,b){var k=a.context,g=a.displayLevel,d=a.painter.materialManager.getProgram(a,this._desc,["delta"]);k.bindFramebuffer(c);k.setClearColor(0,
0,0,0);k.clear(k.gl.COLOR_BUFFER_BIT);k.bindProgram(d);d.setUniform1i("u_maskTexture",e.TEXTURE_BINDING_ATTRIBUTE_DATA_0);d.setUniform1i("u_sourceTexture",e.TEXTURE_BINDING_ATTRIBUTE_DATA_1);d.setUniform1f("u_timeDelta",a.timeDelta);d.setUniform1f("u_animationTime",b/1E3);d.setUniform1f("u_zoomLevel",Math.round(10*g));this._quad.draw()};c.prototype._updateAnimationState=function(a,c,b){var e=a.context;a=a.painter.materialManager.getProgram(a,this._desc,["update"]);e.bindTexture(c.colorTexture,1);
e.bindProgram(a);a.setUniform1i("u_sourceTexture",1);e.bindFramebuffer(b);e.setClearColor(0,0,0,0);e.clear(e.gl.COLOR_BUFFER_BIT);this._quad.draw()};return c}(q.Effect);d.AnimationEffect=b})},"esri/views/2d/engine/webgl/VertexStream":function(){define(["require","exports","../../../../core/tsSupport/declareExtendsHelper","../../../webgl"],function(b,d,f,h){return function(){function b(a,b){this.rctx=a;this._vertexBuffer=h.BufferObject.createVertex(a,35044,new Uint16Array(b));this._vao=new h.VertexArrayObject(a,
{a_position:0},{geometry:[{name:"a_position",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:this._vertexBuffer})}b.prototype.bind=function(){this._vao.bind()};b.prototype.unbind=function(){this._vao.unbind()};b.prototype.dispose=function(){this._vao.dispose(!1);this._vertexBuffer.dispose()};b.prototype.draw=function(){this.rctx.bindVAO(this._vao);this.rctx.drawArrays(5,0,4)};return b}()})},"esri/views/2d/engine/webgl/effects/Effect":function(){define(["require","exports"],function(b,
d){Object.defineProperty(d,"__esModule",{value:!0});b=function(){return function(){this.name=this.constructor.name}}();d.Effect=b})},"esri/views/2d/engine/webgl/effects/HighlightEffect":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/has ../BitBlitRenderer ../effects/Effect ./highlight/HighlightGradient ./highlight/HighlightRenderer ./highlight/HighlightSurfaces".split(" "),function(b,d,f,h,e,a,q,m,c){Object.defineProperty(d,"__esModule",{value:!0});
b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.defines=["highlight"];b._hlRenderer=new m.default;b._hlGradient=new q.default;b._width=void 0;b._height=void 0;b._hlSurfaces=new c.default;b._adjustedWidth=void 0;b._adjustedHeight=void 0;b._blitRenderer=new e.BitBlitRenderer;return b}f(b,a);b.prototype.dispose=function(){this._hlSurfaces&&this._hlSurfaces.dispose();this._hlRenderer&&this._hlRenderer.dispose();this._hlGradient&&this._hlGradient.destroy();this._boundFBO=null};
b.prototype.bind=function(a){var c=a.context,b=a.painter,e=c.getViewport(),k=e.width,e=e.height,b=b.getFbos(k,e).effect0;this.setup(a,k,e);c.bindFramebuffer(b);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT)};b.prototype.unbind=function(){};b.prototype.setup=function(a,c,b){a=a.context;this._width=c;this._height=b;var g=c%4,e=b%4;c+=2>g?-g:4-g;b+=2>e?-e:4-e;this._adjustedWidth=c;this._adjustedHeight=b;this._boundFBO=a.getBoundFramebufferObject();c=Math.round(.75*c);b=Math.round(.75*b);this._hlRenderer.setup(a,
c,b);this._hlSurfaces.setup(a,c,b)};b.prototype.draw=function(a){a=a.context;var c=a.getBoundFramebufferObject();a.setViewport(0,0,.75*this._adjustedWidth,.75*this._adjustedHeight);a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setStencilTestEnabled(!1);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._blitRenderer.render(a,c.colorTexture,9728,1);a.setStencilTestEnabled(!1);a.setBlendingEnabled(!1);a.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);
this._hlRenderer.preBlur(a,this._hlSurfaces.sharedBlur1Tex);h("esri-feature-highlight-debug")?(a.bindFramebuffer(null),a.clear(a.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(a,this._hlSurfaces.sharedBlur2Tex)):(a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),a.setClearColor(0,0,0,0),a.clear(a.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(a,this._hlSurfaces.sharedBlur2Tex),a.bindFramebuffer(this._boundFBO),a.setBlendingEnabled(!0),a.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(a,
this._hlSurfaces.sharedBlur1Tex,this._hlGradient),this._boundFBO=null)};b.prototype.setHighlightOptions=function(a){this._hlGradient.setHighlightOptions(a)};return b}(a.Effect);d.default=b})},"esri/views/2d/engine/webgl/effects/highlight/HighlightGradient":function(){define("require exports ../../../../../../core/Logger ../../../../../webgl ../../definitions ./parameters".split(" "),function(b,d,f,h,e,a){function q(c,b){b.fillColor[0]=c.color.r/255;b.fillColor[1]=c.color.g/255;b.fillColor[2]=c.color.b/
255;b.fillColor[3]=c.color.a;c.haloColor?(b.outlineColor[0]=c.haloColor.r/255,b.outlineColor[1]=c.haloColor.g/255,b.outlineColor[2]=c.haloColor.b/255,b.outlineColor[3]=c.haloColor.a):(b.outlineColor[0]=b.fillColor[0],b.outlineColor[1]=b.fillColor[1],b.outlineColor[2]=b.fillColor[2],b.outlineColor[3]=b.fillColor[3]);b.fillColor[3]*=c.fillOpacity;b.outlineColor[3]*=c.haloOpacity;b.fillColor[0]*=b.fillColor[3];b.fillColor[1]*=b.fillColor[3];b.fillColor[2]*=b.fillColor[3];b.outlineColor[0]*=b.outlineColor[3];
b.outlineColor[1]*=b.outlineColor[3];b.outlineColor[2]*=b.outlineColor[3];b.outlineWidth=a.HIGHLIGHT_SIZING.outlineWidth;b.outerHaloWidth=a.HIGHLIGHT_SIZING.outerHaloWidth;b.innerHaloWidth=a.HIGHLIGHT_SIZING.innerHaloWidth;b.outlinePosition=a.HIGHLIGHT_SIZING.outlinePosition}Object.defineProperty(d,"__esModule",{value:!0});var m=f.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient"),c=[0,0,0,0];b=function(){function b(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*
.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:a.HIGHLIGHT_SIZING.outlinePosition,outlineWidth:a.HIGHLIGHT_SIZING.outlineWidth,innerHaloWidth:a.HIGHLIGHT_SIZING.innerHaloWidth,outerHaloWidth:a.HIGHLIGHT_SIZING.outerHaloWidth};this.shadeTexChanged=!0;this.texelData=new Uint8Array(4*a.SHADE_TEXTURE_SIZE);this.minMaxDistance=[0,0]}b.prototype.setHighlightOptions=function(b){function e(a,c,b){p[0]=(1-b)*a[0]+b*c[0];p[1]=(1-b)*a[1]+b*c[1];p[2]=(1-b)*a[2]+b*c[2];p[3]=(1-b)*a[3]+b*c[3]}var d,
g=this._convertedHighlightOptions;q(b,g);b=g.outlinePosition-g.outlineWidth/2-g.outerHaloWidth;var k=g.outlinePosition-g.outlineWidth/2,l=g.outlinePosition+g.outlineWidth/2,f=g.outlinePosition+g.outlineWidth/2+g.innerHaloWidth,h=Math.sqrt(Math.PI/2)*a.SIGMAS[3],A=Math.abs(b)>h?Math.round(10*(Math.abs(b)-h))/10:0,h=Math.abs(f)>h?Math.round(10*(Math.abs(f)-h))/10:0;A&&!h?m.error("The outer rim of the highlight is "+A+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):
!A&&h?m.error("The inner rim of the highlight is "+h+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):A&&h&&m.error("The highlight is "+Math.max(A,h)+"px away from the edge of the feature; consider reducing some width values.");for(var p=[void 0,void 0,void 0,void 0],A=this.texelData,h=0;h<a.SHADE_TEXTURE_SIZE;++h)d=b+h/(a.SHADE_TEXTURE_SIZE-1)*(f-b),d<b?(p[4*h+0]=0,p[4*h+1]=0,p[4*h+2]=0,p[4*h+3]=0):d<
k?e(c,g.outlineColor,(d-b)/(k-b)):d<l?(d=g.outlineColor,p[0]=d[0],p[1]=d[1],p[2]=d[2],p[3]=d[3]):d<f?e(g.outlineColor,g.fillColor,(d-l)/(f-l)):(d=g.fillColor,p[4*h+0]=d[0],p[4*h+1]=d[1],p[4*h+2]=d[2],p[4*h+3]=d[3]),A[4*h+0]=255*p[0],A[4*h+1]=255*p[1],A[4*h+2]=255*p[2],A[4*h+3]=255*p[3];this.minMaxDistance[0]=b;this.minMaxDistance[1]=f;this.shadeTexChanged=!0};b.prototype.applyHighlightOptions=function(c,b){this.shadeTex||(this.shadeTex=new h.Texture(c,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,
width:a.SHADE_TEXTURE_SIZE,height:1,samplingMode:9729}));this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,a.SHADE_TEXTURE_SIZE,1,this.texelData),this.shadeTexChanged=!1);c.bindTexture(this.shadeTex,e.TEXTURE_BINDING_HIGHLIGHT_1);b.setUniform2fv("u_minMaxDistance",this.minMaxDistance)};b.prototype.destroy=function(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)};return b}();d.default=b})},"esri/views/2d/engine/webgl/effects/highlight/parameters":function(){define(["require","exports"],
function(b,d){Object.defineProperty(d,"__esModule",{value:!0});d.SIGMAS=[void 0,void 0,void 0,1];d.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1];d.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];d.SHADE_TEXTURE_SIZE=256;d.HIGHLIGHT_SIZING={outlineWidth:.7,outerHaloWidth:.7,innerHaloWidth:.7,outlinePosition:0}})},"esri/views/2d/engine/webgl/effects/highlight/HighlightRenderer":function(){define("require exports ../../../../../webgl ../../definitions ./parameters ../../shaders/HighlightPrograms".split(" "),
function(b,d,f,h,e,a){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(){this._height=this._width=void 0;this._resources=null}b.prototype.dispose=function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)};b.prototype.preBlur=function(a,c){a.bindTexture(c,h.TEXTURE_BINDING_HIGHLIGHT_0);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",
[1,0,1/this._width,0]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",e.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};b.prototype.finalBlur=function(a,c){a.bindTexture(c,h.TEXTURE_BINDING_HIGHLIGHT_0);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",e.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);
a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};b.prototype.renderHighlight=function(a,c,b){a.bindTexture(c,h.TEXTURE_BINDING_HIGHLIGHT_0);a.bindProgram(this._resources.highlightProgram);b.applyHighlightOptions(a,this._resources.highlightProgram);a.bindVAO(this._resources.quadVAO);a.setBlendingEnabled(!0);a.setBlendFunction(1,771);a.drawArrays(5,0,4);a.bindVAO()};b.prototype._initialize=function(b,c,d){this._width=c;this._height=d;c=new f.BufferObject(b,34962,35044,(new Int8Array([-1,
-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1])).buffer);d=new f.VertexArrayObject(b,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",count:2,type:5120,offset:0,stride:4,normalized:!1},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:c});var k=f.createProgram(b,a.highlight);b=f.createProgram(b,a.blur);k.setUniform1i("u_texture",h.TEXTURE_BINDING_HIGHLIGHT_0);k.setUniform1i("u_shade",h.TEXTURE_BINDING_HIGHLIGHT_1);k.setUniform4fv("u_sigmas",e.SIGMAS);b.setUniform1i("u_texture",
h.TEXTURE_BINDING_HIGHLIGHT_0);b.setUniform4fv("u_sigmas",e.SIGMAS);this._resources={quadGeometry:c,quadVAO:d,highlightProgram:k,blurProgram:b}};b.prototype.setup=function(a,c,b){this._resources?(this._width=c,this._height=b):this._initialize(a,c,b)};return b}();d.default=b})},"esri/views/2d/engine/webgl/shaders/HighlightPrograms":function(){define(["require","exports","./sources/resolver"],function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});d.highlight={name:"highlight",shaders:{vertexShader:f.resolveIncludes("highlight/textured.vert"),
fragmentShader:f.resolveIncludes("highlight/highlight.frag")},attributes:{a_position:0,a_texcoord:1}};d.blur={name:"blur",shaders:{vertexShader:f.resolveIncludes("highlight/textured.vert"),fragmentShader:f.resolveIncludes("highlight/blur.frag")},attributes:{a_position:0,a_texcoord:1}}})},"esri/views/2d/engine/webgl/effects/highlight/HighlightSurfaces":function(){define(["require","exports","../../../../../webgl"],function(b,d,f){function h(b,a,d){a=new f.Texture(b,{target:3553,pixelFormat:6408,dataType:5121,
wrapMode:33071,width:a,height:d,samplingMode:9729});b=new f.FramebufferObject(b,{colorTarget:0,depthStencilTarget:2},a);return[a,b]}Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(){this._height=this._width=void 0;this._resources=null}b.prototype.dispose=function(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)};b.prototype._initialize=
function(a,b,e){this._width=b;this._height=e;var c=h(a,b,e),d=c[0],c=c[1];a=h(a,b,e);this._resources={sharedBlur1Tex:d,sharedBlur1Fbo:c,sharedBlur2Tex:a[0],sharedBlur2Fbo:a[1]}};b.prototype.setup=function(a,b,e){!this._resources||this._width===b&&this._height===e||this.dispose();this._resources||this._initialize(a,b,e)};Object.defineProperty(b.prototype,"sharedBlur1Tex",{get:function(){return this._resources.sharedBlur1Tex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sharedBlur1Fbo",
{get:function(){return this._resources.sharedBlur1Fbo},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sharedBlur2Tex",{get:function(){return this._resources.sharedBlur2Tex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sharedBlur2Fbo",{get:function(){return this._resources.sharedBlur2Fbo},enumerable:!0,configurable:!0});return b}();d.default=b})},"esri/views/2d/engine/webgl/effects/HittestEffect":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/MapUtils ../../../../../core/maybe ../definitions ./Effect".split(" "),
function(b,d,f,h,e,a,q){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.name=a.constructor.name;a.defines=["id"];a._lastSize=0;return a}f(c,b);c.prototype.dispose=function(){e.isSome(this._fbo)&&this._fbo.dispose()};c.prototype.bind=function(a){var c=a.context;a=a.painter;var b=c.getViewport();a=a.getFbos(b.width,b.height).effect0;c.bindFramebuffer(a);c.setClearColor(0,0,0,0);c.clear(c.gl.COLOR_BUFFER_BIT)};c.prototype.unbind=
function(){};c.prototype.draw=function(c,b,e){var d=this,g=c.context,k=c.state,l=c.pixelRatio;void 0===e&&(e=a.HITTEST_SEARCH_SIZE);var f=g.getBoundFramebufferObject(),m=k.size[1]*l,n=Math.round(e*l),p=n/2,q=n/2;this._ensureBuffer(n);b.forEach(function(a,c){var g=new Map;f.readPixels(Math.floor(c[0]*l-n/2),Math.floor(m-c[1]*l-n/2),n,n,6408,5121,d._buf);for(var e=0;e<d._buf32.length;e++){var k=d._buf32[e];if(4294967295!==k&&0!==k){var r=e%n,v=n-Math.floor(e/n),r=(p-r)*(p-r)+(q-v)*(q-v),v=g.has(k)?
g.get(k):4294967295;g.set(k,Math.min(r,v))}}g=h.pairsOfMap(g).sort(function(a,c){return a[1]-c[1]}).map(function(a){return a[0]});a.resolve(g);b.delete(c)})};c.prototype._ensureBuffer=function(a){this._lastSize!==a&&(this._lastSize=a,this._buf=new Uint8Array(4*a*a),this._buf32=new Uint32Array(this._buf.buffer))};return c}(q.Effect);d.HittestEffect=b})},"esri/views/2d/engine/webgl/painter/RenderPass":function(){define("require exports @dojo/framework/shim/iterator ../../../../../core/has ../../../../../core/maybe ../enums".split(" "),
function(b,d,f,h,e,a){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(b,c){this.brushes=b;this.name=c.name;this.drawPhase=c.drawPhase||a.WGLDrawPhase.MAP;this._targetFn=c.target;this.effects=c.effects||[];this.has=c.has}b.prototype.render=function(a){var c=a.context,b=a.profiler,e=this._targetFn(),d=this.drawPhase&a.drawPhase;b.recordPassStart(this.name);if(d&&(!this.has||h(this.has))){this._doRender(a,e);b.recordPassEnd();for(var d=0,f=this.effects;d<f.length;d++){var g=
f[d];if(g.enable()){var m=g.apply;b.recordPassStart(this.name+"."+m.name);b.recordBrushStart(m.name);var g=g.args&&g.args(),t=c.getViewport(),q=t.x,y=t.y,A=t.width,t=t.height,p=c.getBoundFramebufferObject();m.bind(a,g);this._doRender(a,e,m.defines);m.draw(a,g);m.unbind(a,g);c.bindFramebuffer(p);c.setViewport(q,y,A,t);b.recordBrushEnd();b.recordPassEnd()}}}};b.prototype._doRender=function(a,c,b){if(!e.isNone(c))if(f.isArrayLike(c))for(var d=0;d<c.length;d++){var l=c[d];if(l.isReady&&l.visible)for(var m=
0,g=this.brushes;m<g.length;m++){var h=g[m];a.profiler.recordBrushStart(h.name);h.prepareState(a,l,b);h.draw(a,l,b);a.profiler.recordBrushEnd()}}else for(d=0,l=this.brushes;d<l.length;d++)h=l[d],a.profiler.recordBrushStart(h.name),h.prepareState(a,c,b),h.draw(a,c,b),a.profiler.recordBrushEnd()};return b}();d.default=b})},"esri/views/2d/engine/webgl/Profiler":function(){define("require exports ../../../../core/CircularArray ../../../../core/Evented ../../../../core/has ../../../../core/maybe ../../../webgl/capabilities/DisjointTimerQuery".split(" "),
function(b,d,f,h,e,a,q){Object.defineProperty(d,"__esModule",{value:!0});var m=e("esri-2d-profiler");b=function(){function c(a,c){var b=this;this._events=new h;this._entries=new Map;this._timings=new f.default(10);if(m){this._ext=q.load(a.gl,{});this._debugOutput=c;var e=a.gl;if(this.enableCommandLogging){a=function(a){if("function"===typeof e[a]){var c=e[a],g=-1!==a.indexOf("draw");e[a]=function(){for(var d=[],k=0;k<arguments.length;k++)d[k]=arguments[k];b._events.emit("command",{container:b._currentContainer,
pass:b._currentPass,brush:b._currentBrush,method:a,args:d,isDrawCommand:g});b._currentSummary&&(b._currentSummary.commands++,g&&b._currentSummary.drawCommands++);return c.apply(e,d)}}};for(var g in e)a(g)}}}Object.defineProperty(c.prototype,"enableCommandLogging",{get:function(){return!("object"===typeof m&&m.disableCommands)},enumerable:!0,configurable:!0});c.prototype.recordContainerStart=function(a){m&&(this._currentContainer=a)};c.prototype.recordContainerEnd=function(){m&&(this._currentContainer=
null)};c.prototype.recordPassStart=function(a){m&&(this._currentPass=a,this._initSummary())};c.prototype.recordPassEnd=function(){m&&(this._currentPass=null,this._emitSummary())};c.prototype.recordBrushStart=function(a){m&&(this._currentBrush=a)};c.prototype.recordBrushEnd=function(){m&&(this._currentBrush=null)};c.prototype.recordStart=function(c){if(m&&a.isSome(this._ext)){if(this._entries.has(c)){var b=this._entries.get(c),e=this._ext.resultAvailable(b.query),d=this._ext.disjoint();if(e&&!d){e=
this._ext.getResult(b.query)/1E6;d=0;if(a.isSome(this._timings.enqueue(e))){for(var d=this._timings.entries,g=d.length,l=0,f=0;f<d.length;f++)l+=d[f];d=l/g}e=e.toFixed(2);d=d?d.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed("Frame report for "+c+", "+e+" ms ("+d+" last 10 avg)\n"+b.commandsLen+" Commands ("+b.drawCommands+" draw)"),console.log("RenderPass breakdown: "),console.table(b.summaries),console.log("Commands: ",b.commands),console.groupEnd()):console.log("Frame report for "+
c+", "+e+" ms ("+d+" last 10 avg)");this._debugOutput.innerHTML=e+" ("+d+")"}e=0;for(b=b.handles;e<b.length;e++)b[e].remove();this._entries.delete(c)}var h={name:c,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(h.handles.push(this._events.on("command",function(a){h.commandsLen++;h.commands.push(a);a.isDrawCommand&&h.drawCommands++})),h.handles.push(this._events.on("summary",function(a){delete a.target;h.summaries.push(a)})));
this._ext.beginTimeElapsed(h.query);this._entries.set(c,h)}};c.prototype.recordEnd=function(c){m&&a.isSome(this._ext)&&this._entries.has(c)&&this._ext.endTimeElapsed()};c.prototype._initSummary=function(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})};c.prototype._emitSummary=function(){this.enableCommandLogging&&this._events.emit("summary",this._currentSummary)};return c}();d.Profiler=b})},"esri/core/CircularArray":function(){define(["require",
"exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(b){void 0===b&&(b=Number.POSITIVE_INFINITY);this._start=this.size=0;this.maxSize=b;this._buffer=isFinite(b)?Array(b):[]}Object.defineProperty(b.prototype,"entries",{get:function(){return this._buffer},enumerable:!0,configurable:!0});b.prototype.enqueue=function(b){if(this.size===this.maxSize){var e=this._buffer[this._start];this._buffer[this._start]=b;this._start=(this._start+1)%this.maxSize;return e}isFinite(this.maxSize)?
this._buffer[(this._start+this.size++)%this.maxSize]=b:this._buffer[this._start+this.size++]=b;return null};b.prototype.dequeue=function(){if(0===this.size)return null;var b=this._buffer[this._start];this._buffer[this._start]=null;this.size--;this._start=(this._start+1)%this.maxSize;return b};return b}();d.default=b})},"esri/views/2d/engine/webgl/WebGLDriverTest":function(){define("require exports ../../../../core/Logger ../../../../core/maybe ../../../webgl ./VertexStream".split(" "),function(b,
d,f,h,e,a){Object.defineProperty(d,"__esModule",{value:!0});var q=f.getLogger("esri.views.2d.engine.webgl.WebGLDriverTest"),m=function(){function a(a){this._ignoresSamplerPrecision=null;this._context=a}Object.defineProperty(a.prototype,"ignoresSamplerPrecision",{get:function(){h.isNone(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=d.testSamplerPrecision(this._context));return this._ignoresSamplerPrecision},enumerable:!0,configurable:!0});return a}();d.testWebGLDriver=function(a){return new m(a)};
d.testSamplerPrecision=function(c){var b=new e.FramebufferObject(c,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),d=new Uint8Array(4),f=new a(c,[0,0,1,0,0,1,1,1]),m=new e.Program(c,"\nprecision highp float;\n\nattribute vec2 a_pos;\n\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value \x3d texture2D(u_texture, vec2(0.0));\n\n  float bit \x3d getBit(value.x * 255.0, 1);\n\n  v_color \x3d bit * vec4(1.0);\n\n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n",
"\nprecision highp float;\n\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor \x3d v_color;\n}\n",{a_pos:0}),g=new e.Texture(c,{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([2,255,0,0]));m.setUniform1i("u_texture",0);c.bindTexture(g,0);c.bindFramebuffer(b);c.bindProgram(m);var h=c.getViewport(),g=h.x,t=h.y,u=h.width,h=h.height;c.setViewport(0,0,1,1);f.draw();c.setViewport(g,t,u,h);b.readPixels(0,0,1,1,6408,5121,d);m.dispose();f.dispose();
b.dispose();(c=255!==d[0]||255!==d[1]||255!==d[2]||255!==d[3])&&q.warn("A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. ["+d[0]+"."+d[1]+"."+d[2]+"."+d[3]+"]");return c}})},"esri/views/2d/engine/webgl/shaders/StencilPrograms":function(){define(["require",
"exports","./sources/resolver"],function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});d.stencil={name:"stencil",shaders:{vertexShader:f.resolveIncludes("stencil/stencil.vert"),fragmentShader:f.resolveIncludes("stencil/stencil.frag")},attributes:{a_pos:0}}})},"esri/views/2d/support/Timeline":function(){define(["require","exports","../../../core/tsSupport/decorateHelper","../../../core/tsSupport/declareExtendsHelper","../../../core/accessorSupport/decorators"],function(b,d,f,h,e){Object.defineProperty(d,
"__esModule",{value:!0});b=function(){function a(){this._names=new Map}a.prototype.begin=function(a){this._names.has(a)||(this._names.set(a,!1),-1!==a.indexOf("Brush")&&this.record("Esri.FirstDraw"),performance.mark("Esri."+a+".Start"))};a.prototype.end=function(a){this._names.has(a)&&!this._names.get(a)&&(this._names.set(a,!0),performance.mark("Esri."+a+".End"))};a.prototype.record=function(a){this._names.has(a)||(this._names.set(a,!0),performance.mark("Esri."+a))};return a=f([e.subclass("esri.views.2d.support.Timeline")],
a)}();d.Timeline=b})},"esri/views/2d/engine/webgl/AttributeStoreView":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../webgl ./definitions ./Utils ./util/debug ../../../webgl/FramebufferObject".split(" "),function(b,d,f,h,e,a,q,m,c,l,k,n,r,g){Object.defineProperty(d,"__esModule",{value:!0});var x=q.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),
t=r.createDebugLogger(r.DEBUG_ATTR_UPDATES,x),u=!1,y=function(){function c(a,c,b){this._lastTexture=this._texture=null;this._fbos={};this.texelSize=4;var g=a.buffer,e=a.pixelType;a=a.textureOnly;var d=n.getPixelArrayCtor(e);this.shared=b;this.pixelType=e;this.size=c;this.textureOnly=a;a||(this.data=new d(m.expect(g)));this._resetRange()}c.prototype.destroy=function(){m.andThen(this._texture,function(a){return a.dispose()});var a=function(a){m.andThen(c._fbos[a],function(c){"0"===a&&c.detachColorTexture();
c.dispose()});c._fbos[a]=null},c=this,b;for(b in this._fbos)a(b);this._texture=null};Object.defineProperty(c.prototype,"_textureDesc",{get:function(){return{target:3553,wrapMode:33071,pixelFormat:6408,dataType:this.pixelType,samplingMode:9728,width:this.size,height:this.size}},enumerable:!0,configurable:!0});c.prototype.setData=function(c,b,g){c&=2147483647;var d=m.expect(this.data);b=c*this.texelSize+b;!d||b>=d.length?a("esri-2d-debug")&&!u&&(x.error(new e("mapview-attributeStore","Attempted to set out of bounds index")),
u=!0):(d[b]=g,this.dirtyStart=Math.min(this.dirtyStart,c),this.dirtyEnd=Math.max(this.dirtyEnd,c))};c.prototype.getData=function(c,b){if(m.isNone(this.data))return null;c=(c&2147483647)*this.texelSize+b;return!this.data||c>=this.data.length?(a("esri-2d-debug")&&!u&&(x.error(new e("mapview-attributeStore","Attempted to read out of bounds index")),u=!0),null):this.data[c]};c.prototype.getTexture=function(a){var c=this;return m.unwrapOr(this._texture,function(){return c._initTexture(a)})};c.prototype.getFBO=
function(a,c){void 0===c&&(c=0);if(m.isNone(this._fbos[c])){var b=0===c?this.getTexture(a):this._textureDesc;this._fbos[c]=new g(a,{colorTarget:0,depthStencilTarget:0},b)}return this._fbos[c]};Object.defineProperty(c.prototype,"locked",{get:function(){return 5121===this.pixelType&&this.shared&&!this.textureOnly&&a("esri-atomics")&&this.data?1===Atomics.load(this.data,0):!1},enumerable:!0,configurable:!0});c.prototype.updateTexture=function(a){if(!this.locked)try{var c=this.dirtyStart,b=this.dirtyEnd;
if(!(c>b)){this._resetRange();var g=m.expect(this.data).buffer,d=this.getTexture(a),k=(c-c%this.size)/this.size,l=(b-b%this.size)/this.size,f=k*this.size*4,h=4*(this.size+l*this.size)-f,p=n.getPixelArrayCtor(this.pixelType),r=p.BYTES_PER_ELEMENT;try{new p(g,f*r,h)}catch(I){console.debug(I)}var t=new p(g,f*r,h),q=this.size;a=l-k+1;a>this.size?x.error(new e("mapview-webgl","Out-of-bounds index when updating AttributeData")):d.updateData(0,0,k,q,a,t)}}catch(I){console.debug(I)}};c.prototype.update=function(a){var c=
a.data,b=a.start,g=a.end;if(m.isSome(c))for(var e=this.data,d=b*this.texelSize,k=0;k<c.length;k++)a.layout&1<<k%this.texelSize&&(e[d+k]=c[k]);this.dirtyStart=Math.min(this.dirtyStart,b);this.dirtyEnd=Math.max(this.dirtyEnd,g)};c.prototype.resize=function(a,c){var b=this.size;this.size=c;this.textureOnly?b!==this.size&&(this._lastTexture=this._texture,this._texture=null):(c=n.getPixelArrayCtor(this.pixelType),this.destroy(),this.data=new c(m.expect(a.buffer)))};c.prototype._resetRange=function(){this.dirtyStart=
2147483647;this.dirtyEnd=0};c.prototype._initTexture=function(a){var c=new l.Texture(a,this._textureDesc,m.unwrapOr(this.data,void 0));if(m.isSome(this._lastTexture)&&this._fbos[0]){var b=this._lastTexture.descriptor.width,g=this._lastTexture.descriptor.height,e=this._lastTexture.descriptor.dataType,d=this._lastTexture.descriptor.pixelFormat,k=this.getFBO(a),f=n.getPixelBytes(e),h=n.getPixelArrayCtor(e),f=new ArrayBuffer(b*g*f*this.texelSize),h=new h(f),f=a.getBoundFramebufferObject(),p=a.getViewport(),
r=p.x,t=p.y,q=p.width,p=p.height;a.bindFramebuffer(k);k.readPixels(0,0,b,g,d,e,h);c.updateData(0,0,0,2*b,g/2,h);a.setViewport(r,t,q,p);a.bindFramebuffer(f)}this.destroy();return this._texture=c};return c}();b=function(){function a(){this._locked=this._forceNextUpload=this._initialized=!1}a.prototype.initialize=function(a){var c=a.blocks,b=a.shared,g=a.size;this.shared=b;this.size=g;t("Initializing AttributeStoreView",a);if(m.isNone(this._data))this._data=m.mapMany(c,function(a){return new y(a,g,b)});
else for(a=0;a<this._data.length;a++){var e=this._data[a],d=c[a];m.isSome(d)&&(m.isNone(e)?this._data[a]=new y(d,g,b):e.resize(d,g))}this._initialized=!0};a.prototype.destroy=function(){m.andThen(this._data,function(a){return m.mapMany(a,function(a){return a.destroy()})});m.andThen(this._defaultTexture,function(a){return a.dispose()})};a.prototype.getBlock=function(a){return m.isNone(this._data)?null:this._data[a]};a.prototype.setLabelMinZoom=function(a,c){this.setData(a,0,1,c)};a.prototype.getLabelMinZoom=
function(a){return this.getData(a,0,1,255)};a.prototype.getFilterFlags=function(a){return this.getData(a,0,0,0)};a.prototype.getVVSize=function(a){return this.getData(a,k.ATTRIBUTE_DATA_VV,0,0)};a.prototype.getData=function(a,c,b,g){if(!this._data)return 0;c=m.expect(this._data)[c];if(m.isNone(c))return 0;a=c.getData(a,b);return m.isSome(a)?a:g};a.prototype.setData=function(a,c,b,g){c=m.expect(this._data)[c];m.expect(c).setData(a,b,g)};a.prototype.lockTextureUpload=function(){this._locked=!0};a.prototype.unlockTextureUpload=
function(){this._locked=!1};a.prototype.forceTextureUpload=function(){this._forceNextUpload=!0};a.prototype.requestUpdate=function(a){return h(this,void 0,void 0,function(){var b;return f(this,function(g){if(this._pendingAttributeUpdate)return x.error(new e("mapview-webgl","Tried to update attribute data with a pending update")),[2];b=c.createResolver();t("AttributeStoreView Update Requested",a);this._pendingAttributeUpdate={data:a,resolver:b};return[2,b.promise]})})};a.prototype.update=function(){if(this._initialized&&
m.isSome(this._pendingAttributeUpdate)){for(var a=this._pendingAttributeUpdate,c=a.data,a=a.resolver,b=m.expect(this._data),g=function(a){var g=c.blocks[a];m.andThen(b[a],function(c){return m.andThen(g,function(b){t("Updating block "+a,b);c.update(b)})})},e=0;e<c.blocks.length;e++)g(e);this._pendingAttributeUpdate=null;a()}};a.prototype.bindTextures=function(a){this.update();var c=this._getDefaultTexture(a);if(this._initialized){var b=m.expect(this._data);if(!this._locked||this._forceNextUpload)m.forEachSome(b,
function(c){return c.updateTexture(a)}),this._forceNextUpload=!1;a.bindTexture(m.mapOr(b[0],c,function(c){return c.getTexture(a)}),k.TEXTURE_BINDING_ATTRIBUTE_DATA_0);a.bindTexture(m.mapOr(b[1],c,function(c){return c.getTexture(a)}),k.TEXTURE_BINDING_ATTRIBUTE_DATA_1);a.bindTexture(m.mapOr(b[2],c,function(c){return c.getTexture(a)}),k.TEXTURE_BINDING_ATTRIBUTE_DATA_2);a.bindTexture(m.mapOr(b[3],c,function(c){return c.getTexture(a)}),k.TEXTURE_BINDING_ATTRIBUTE_DATA_3)}else a.bindTexture(c,k.TEXTURE_BINDING_ATTRIBUTE_DATA_0),
a.bindTexture(c,k.TEXTURE_BINDING_ATTRIBUTE_DATA_1),a.bindTexture(c,k.TEXTURE_BINDING_ATTRIBUTE_DATA_2),a.bindTexture(c,k.TEXTURE_BINDING_ATTRIBUTE_DATA_3)};a.prototype._getDefaultTexture=function(a){m.isNone(this._defaultTexture)&&(this._defaultTexture=new l.Texture(a,{wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array(4)));return this._defaultTexture};return a}();d.AttributeStoreView=b})},"esri/views/2d/engine/webgl/Utils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../symbols/cim/enums ../../../webgl ./color ./enums ./SymbolProperties".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n){function r(a){for(var c={},b=0;b<a.length;b++){var g=a[b];c[g.name]=g.strideInBytes}return c}function g(a){switch(a){case k.WGLGeometryType.MARKER:return w;case k.WGLGeometryType.FILL:return v;case k.WGLGeometryType.LINE:return z;case k.WGLGeometryType.TEXT:return B;case k.WGLGeometryType.LABEL:return C}return null}function x(a){switch(a%4){case 0:case 2:return 4;case 1:case 3:return 1}}function t(a){return"string"===typeof a}function u(a){switch(a){case 5120:case 5121:return 1;
case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function y(a){var c={},b=function(b){var g=0;c[b]=a[b].map(function(a){var c=f({},a,{normalized:a.normalized||!1,divisor:a.divisor||0,offset:g,stride:0});g+=a.count*u(a.type);return c});c[b].forEach(function(a){return a.stride=g})},g;for(g in a)b(g);return c}Object.defineProperty(d,"__esModule",{value:!0});var A,p=e.getLogger("esri.views.2d.engine.webgl.Utils");d.C_VBO_GEOMETRY="geometry";d.C_VBO_PERINSTANCE="per_instance";d.C_VBO_PERINSTANCE_VV=
"per_instance_vv";d.C_ICON_VERTEX_DEF=[{name:d.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];d.C_FILL_VERTEX_DEF=[{name:d.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];d.C_FILL_VERTEX_DEF_DD=[{name:d.C_VBO_GEOMETRY,strideInBytes:12,divisor:0}];d.C_LINE_VERTEX_DEF=[{name:d.C_VBO_GEOMETRY,strideInBytes:36,divisor:0}];d.C_TEXT_VERTEX_DEF=[{name:d.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];d.C_LABEL_VERTEX_DEF=[{name:d.C_VBO_GEOMETRY,strideInBytes:36,divisor:0}];d.C_ICON_STRIDE_SPEC=r(d.C_ICON_VERTEX_DEF);
d.C_FILL_STRIDE_SPEC=r(d.C_FILL_VERTEX_DEF);d.C_FILL_STRIDE_SPEC_DD=r(d.C_FILL_VERTEX_DEF_DD);d.C_LINE_STRIDE_SPEC=r(d.C_LINE_VERTEX_DEF);d.C_TEXT_STRIDE_SPEC=r(d.C_TEXT_VERTEX_DEF);d.C_LABEL_STRIDE_SPEC=r(d.C_LABEL_VERTEX_DEF);d.getStrides=function(a,c){switch(a){case k.WGLGeometryType.MARKER:return d.C_ICON_STRIDE_SPEC;case k.WGLGeometryType.FILL:return c?d.C_FILL_STRIDE_SPEC_DD:d.C_FILL_STRIDE_SPEC;case k.WGLGeometryType.LINE:return d.C_LINE_STRIDE_SPEC;case k.WGLGeometryType.TEXT:return d.C_TEXT_STRIDE_SPEC;
case k.WGLGeometryType.LABEL:return d.C_LABEL_STRIDE_SPEC}return null};var w=[d.C_VBO_GEOMETRY],v=[d.C_VBO_GEOMETRY],z=[d.C_VBO_GEOMETRY],B=[d.C_VBO_GEOMETRY],C=[d.C_VBO_GEOMETRY];d.getNamedBuffers=g;d.strideToPackingFactor=x;d.allocateTypedArrayBuffer=function(a,c){switch(c%4){case 0:case 2:return new Uint32Array(Math.floor(a*c/4));case 1:case 3:return new Uint8Array(a*c)}};d.allocateTypedArrayBufferwithData=function(a,c){switch(c%4){case 0:case 2:return new Uint32Array(a);case 1:case 3:return new Uint8Array(a)}};
d.getTextProperties=function(a){return n.TextProperties.pool.acquire(a.color?l.copyAndPremultiply(a.color):[255,255,255,255],a.haloColor?l.copyAndPremultiply(a.haloColor):[255,255,255,255],q.pt2px(a.haloSize),q.pt2px(a.font.size),a.angle*Math.PI/180,a.xoffset/a.font.size,a.yoffset/a.font.size,"left"===a.horizontalAlignment?0:"right"===a.horizontalAlignment?1:.5,"top"===a.verticalAlignment?0:"bottom"===a.verticalAlignment?1:.5)};d.isDefined=function(a){return null!=a};d.isNumber=function(a){return"number"===
typeof a};d.isString=t;d.isStringOrNull=function(a){return null==a||t(a)};d.getCapType=function(a,c){switch(a){case "butt":return m.CapType.BUTT;case "round":return c?m.CapType.SQUARE:m.CapType.ROUND;case "square":return m.CapType.SQUARE;default:return p.error(new h("mapview-invalid-type","Cap type "+a+" is not a valid option. Defaulting to round")),m.CapType.ROUND}};d.getJoinType=function(a){switch(a){case "miter":return m.JoinType.MITER;case "bevel":return m.JoinType.BEVEL;case "round":return m.JoinType.ROUND;
default:return p.error(new h("mapview-invalid-type","Join type "+a+" is not a valid option. Defaulting to round")),m.JoinType.ROUND}};d.getVVType=function(a){switch(a){case "opacity":return k.VVType.OPACITY;case "color":return k.VVType.COLOR;case "rotation":return k.VVType.ROTATION;case "size":return k.VVType.SIZE;default:return p.error("Cannot interpret unknown vv: "+a),null}};d.getTransformParams=function(a){return{transform:a.transform,hasZ:a.hasZ,hasM:a.hasM}};d.copyMeshData=function(a,c,b,g,
e,d,k){for(var l in d)for(var f=d[l].stride,m=x(f),h=d[l].data,n=b[l].data,p=f*e.vertexCount/m,r=f*a/m,m=f*e.vertexFrom/m,f=0;f<p;++f)n[f+r]=h[f+m];b=e.indexCount;for(f=0;f<b;++f)g[f+c]=k[f+e.indexFrom]-e.vertexFrom+a};d.C_VBO_INFO=(A={},A[d.C_VBO_GEOMETRY]=35044,A);d.createGeometryData=function(a,c){for(var b=[],e=0;5>e;++e){for(var d={},k=0,l=g(e);k<l.length;k++){var f=l[k];d[f]={data:c(e,f)}}b.push({data:a(e),buffers:d})}return b};d.createTextureFromTexelData=function(b,g){var e,d;a.isPowerOfTwo(g.width)&&
a.isPowerOfTwo(g.height)?(e=!0,d=9987):(e=!1,d=9729);return new c.Texture(b,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:e,samplingMode:d,wrapMode:33071,flipped:!0},g)};d.geometryToMappedGeometry=function(a){return{vertexFrom:void 0,vertexTo:void 0,geometry:a}};d.getBytes=u;d.getPixelBytes=function(a){switch(a){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:p.error(new h("webgl-utils","Unable to handle type "+a))}};d.getPixelArrayCtor=function(a){switch(a){case 5121:return Uint8Array;
case 32819:return Uint16Array;case 5126:return Float32Array;default:p.error(new h("webgl-utils","Unable to handle type "+a))}};var D=new Map;d.createProgramDescriptor=function(a,c){if(!D.has(a)){var b=y(c),g={},e;for(e in b){var d=b[e];g[e]=d.length?d[0].stride:0}e={};for(var k in c)for(var d=0,l=c[k];d<l.length;d++){var f=l[d];e[f.name]=f.location}D.set(a,{strides:g,bufferLayouts:b,attributes:e})}return D.get(a)}})},"esri/views/2d/engine/webgl/color":function(){define(["require","exports","./number"],
function(b,d,f){function h(a,b){Array.isArray(b)?(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3]):(a[0]=b.r,a[1]=b.g,a[2]=b.b,a[3]=b.a);return a}function e(a,b,c){void 0===b&&(b=0);void 0===c&&(c=!1);var e=a[b+3];a[b+0]*=e;a[b+1]*=e;a[b+2]*=e;c||(a[b+3]*=255);return a}Object.defineProperty(d,"__esModule",{value:!0});d.white=[255,255,255,1];var a=[0,0,0,0];d.premultiplyAlpha=e;d.copyAndPremultiply=function(a){return e(h([],a))};d.premultiplyAlphaUint32=function(b){e(h(a,b));return f.i8888to32(a[0],a[1],a[2],
a[3])};d.premultiplyAlphaRGBA=function(a){if(!a)return 0;var b=a.a;return f.i8888to32(a.r*b,a.g*b,a.b*b,255*b)}})},"esri/views/2d/engine/webgl/SymbolProperties":function(){define(["require","exports","../../../../core/ObjectPool"],function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(){this.color=[0,0,0,0];this.haloColor=[0,0,0,0];this.haloSize=0;this.size=12;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=0}b.prototype.acquire=function(b,a,d,f,c,
l,k,h,r){this.color=b;this.haloColor=a;this.haloSize=d;this.size=f;this.angle=c;this.offsetX=l;this.offsetY=k;this.hAnchor=h;this.vAnchor=r};b.prototype.release=function(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=this.size=this.haloSize=this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0};b.pool=new f(b);return b}();d.TextProperties=b})},"esri/views/2d/engine/webgl/util/debug":function(){define(["require",
"exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});d.createDebugLogger=function(b,d){return b&&function(){for(var b=[],a=0;a<arguments.length;a++)b[a]=arguments[a];return d.warn.apply(d,["DEBUG:"].concat(b))}||function(){return null}};d.DEBUG_ATTR_UPDATES=!1})},"esri/views/2d/engine/webgl/collisions/CollisionGrid":function(){define(["require","exports","../definitions"],function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(b){this._bucketSize=
b;this._rowsLength=f.TILE_SIZE/b;this._colsLength=f.TILE_SIZE/b;this._grid=this._initGrid()}b.prototype.checkOverlap=function(b,a){b=Math.floor(b/this._bucketSize);a=Math.floor(a/this._bucketSize);return 0>b||b>=this._rowsLength||0>a||a>=this._colsLength?!0:this._grid[a][b]};b.prototype.markUsed=function(b,a){this._grid[Math.floor(a/this._bucketSize)][Math.floor(b/this._bucketSize)]=!0};b.prototype.reset=function(){this._grid=this._initGrid()};b.prototype._initGrid=function(){for(var b=[],a=0;a<this._rowsLength;a++)b.push(Array(this._colsLength));
return b};return b}();d.CollisionGrid=b})},"esri/views/2d/engine/webgl/collisions/CollisionEngine":function(){define("require exports ../../../../../core/Error ../../../../../core/Logger ../../../../../core/MapUtils ../../../../../core/mathUtils ../definitions ./CollisionBucket ./LayerCollisionInfo".split(" "),function(b,d,f,h,e,a,q,m,c){Object.defineProperty(d,"__esModule",{value:!0});var l=q.TILE_SIZE/q.COLLISION_BUCKET_SIZE,k=h.getLogger("esri.views.2d.engine.webgl.collisions.CollisionEngine");
b=function(){function b(a){this._layers=new Map;this._collisionBuckets=new Map;this._didError=!1;this._tilingScheme=a}Object.defineProperty(b.prototype,"collisionInfos",{get:function(){return e.valuesOfMap(this._layers)},enumerable:!0,configurable:!0});b.prototype.registerLayerView=function(a,b){if(!this._layers.has(a)){var g=c.default.create(a,b,this.collisionInfos,this._tilingScheme);this._layers.set(a,g);this._collisionBuckets.forEach(function(a){return a.onRegisterLayer(g.index)})}};b.prototype.unregisterLayerView=
function(a){var b=this;if(this._layers.has(a)){var e=this._layers.get(a);c.default.delete(e.index,this.collisionInfos);this._layers.delete(a);this._collisionBuckets.forEach(function(a,c){var g=a.getTile(e.index);g&&(a.onUnregisterLayer(e.index),a.canDelete()&&b._collisionBuckets.delete(c),g.reference&&(g.reference.isDirty=!1))})}};b.prototype.addTile=function(a,c){var b=c.key.id;this._layers.has(a)&&(this._collisionBuckets.has(b)||this._collisionBuckets.set(b,new m.default(c.key,this._layers.size)),
a=this._getIndex(a),this._collisionBuckets.get(b).getTile(a).reference=c)};b.prototype.removeTile=function(a,c){this._layers.has(a)&&this._collisionBuckets.has(c)&&(a=this._getIndex(a),c=this._collisionBuckets.get(c).getTile(a),c.dirty=!1,c.reference=null)};b.prototype.run=function(a,b){var g=e.valuesOfMap(this._collisionBuckets).sort(function(a,c){return a.key.compareRowMajor(c.key)}),d=!0,l=a.renderingOptions.labelCollisionsEnabled&&!this._didError,m=this.collisionInfos;try{for(var h=0;h<g.length;h++){var n=
g[h],d=d||n.isDirty;n.computeNeighbors(this._collisionBuckets);for(var r=0;r<this._layers.size;r++){var v=c.default.find(r,m);n.reset(a,d,v)}}for(a=0;a<this._layers.size;a++)for(v=c.default.find(a,m),d=0,h=g;d<h.length;d++)n=h[d],this._run(l,n,v,b)}catch(z){k.error(new f("mapview-labeling","Encountered an error during decluttering. Disabling collisions",z)),this._didError=!0}for(b=0;b<g.length;b++)n=g[b],n.ready()};b.prototype._run=function(a,c,b,d){var g=c.getReference(b.index);g&&g.hasData&&(g.key.level!==
d?this._resetLabelsMinZoom(c,b):this._runVisibility(a,c,g,b,d))};b.prototype._resetLabelsMinZoom=function(a,c){if(a&&"polyline"!==c.geometryType&&(a=a.getReference(c.index))&&a.hasData){c=c.layerView.tileRenderer.featuresView.attributeView;var b=0;for(a=a.displayObjects;b<a.length;b++)c.setLabelMinZoom(a[b].id,255)}};b.prototype._checkLabelsVisible=function(a,c){var b=!c.effect||c.effect.excludedLabelsVisible||!!(a&q.EFFECT_FLAG_0);return(!c.filter||!!(a&q.FILTER_FLAG_0))&&b};b.prototype._runVisibility=
function(a,c,b,d,e){var g=d.layerView.tileRenderer.featuresView.attributeView,k=0;for(b=b.displayObjects.sort(function(a,c){a=g.getLabelMinZoom(a.id);c=g.getLabelMinZoom(c.id);return a-c});k<b.length;k++){var l=b[k];if(l.metrics.length){var f="polyline"===d.geometryType?0:10*(e-1),m=g.getFilterFlags(l.id),h=this._checkLabelsVisible(m,d.layerView);if(a)for(var n=0;n<l.metrics.length;n++)m=l.metrics[n],m=h?-1!==m.minZoom?m.minZoom:this._computeLabelVisibility(l,m,d.index,c,m.baseZoom,e):255,f=Math.max(m,
f);g.setLabelMinZoom(l.id,f);h=0;for(l=l.metrics;h<l.length;h++)m=l[h],m.minZoom=f}}};b.prototype._computeLabelVisibility=function(a,c,b,d,e,k){for(var g=c.xBucket,f=c.yBucket,m=c.xOverflow,h=c.yOverflow,n=g-m,g=g+m+1,m=f+h+1,f=f-h;f<m;f++)for(h=n;h<g;h++)if(!(h<-l||f<-l||h>l||f>l))for(var r=0;r<=b;r++){var t=this._getRelativeSubBucket(r,d,h,f);if(t)for(var q=0;q<t.length;q++){var u=t[q];if(r!==b||u.id!==a.id)u=this._compareLabels(c,u,e,k),e=Math.max(u,e)}}return e};b.prototype._compareLabels=function(c,
b,d,e){if(-1===b.minZoom||b.minZoom>10*(e+1))return d;c=c.findCollisionDelta(b);e=a.clamp(Math.ceil(10*(c+e)),0,255);return b.minZoom>=e?d:Math.max(d,e)};b.prototype._getNeighboringTile=function(a,c,b,d){return(c=c.neighbors[3*(1+d)+(1+b)])&&c.getTile(a)};b.prototype._getRelativeSubBucket=function(c,b,d,e){var g=a.sign(Math.floor(d/4)),k=a.sign(Math.floor(e/4));return(c=this._getNeighboringTile(c,b,g,k))&&c.reference&&c.index&&c.reference.hasData?c.index[e-4*k][d-4*g]:null};b.prototype._getIndex=
function(a){return this._layers.get(a).index};return b}();d.CollisionEngine=b})},"esri/views/2d/engine/webgl/collisions/CollisionBucket":function(){define(["require","exports","../../../tiling","./CollisionBucketEntry"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(a,b){this.neighbors=Array(9);this._tiles=Array(b);for(var d=0;d<b;d++)this._tiles[d]=new h.default;this.key=a}Object.defineProperty(b.prototype,"isDirty",{get:function(){for(var a=0,b=this._tiles;a<
b.length;a++)if(b[a].dirty)return!0;return!1},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this._tiles.length},enumerable:!0,configurable:!0});b.prototype.getTile=function(a){return this._tiles[a]};b.prototype.getReference=function(a){return(a=this._tiles[a])&&a.reference};b.prototype.onRegisterLayer=function(a){this.invalidateRange(a);this._add(a)};b.prototype.onUnregisterLayer=function(a){this.invalidateRange(a);this._remove(a)};b.prototype.onLabelsRendered=
function(){};b.prototype.invalidateRange=function(a){for(;a<this._tiles.length;a++)this._tiles[a].dirty=!0};b.prototype.add=function(a){this._add(a)};b.prototype.remove=function(a){this._remove(a)};b.prototype.canDelete=function(){return 0===this._tiles.length};b.prototype.ready=function(){for(var a=0,b=this._tiles;a<b.length;a++)b[a].dirty=!1};b.prototype.computeNeighbors=function(a){this.neighbors[0]=this._getNeighbor(a,-1,-1);this.neighbors[1]=this._getNeighbor(a,0,-1);this.neighbors[2]=this._getNeighbor(a,
1,-1);this.neighbors[3]=this._getNeighbor(a,-1,0);this.neighbors[4]=this;this.neighbors[5]=this._getNeighbor(a,1,0);this.neighbors[6]=this._getNeighbor(a,-1,1);this.neighbors[7]=this._getNeighbor(a,0,1);this.neighbors[8]=this._getNeighbor(a,1,1)};b.prototype.reset=function(a,b,d){var c=this._tiles[d.index];c&&c.reset(a,b,d)};b.prototype._add=function(a){var b=[];if(a>=this._tiles.length)this._tiles.push(new h.default);else{for(var d=0;d<this._tiles.length;d++)d===a&&b.push(new h.default),b.push(this._tiles[d]);
this._tiles=b}};b.prototype._remove=function(a){for(var b=[],d=0;d<this._tiles.length;d++)d!==a&&b.push(this._tiles[d]);this._tiles=b};b.prototype._getNeighbor=function(a,b,d){var c=this.key;b=f.TileKey.getId(c.level,c.row+d,c.col+b,c.world);return a.has(b)?a.get(b):null};return b}();d.default=b})},"esri/views/2d/tiling":function(){define("require exports ./tiling/TileInfoView ./tiling/TileKey ./tiling/TileQueue ./tiling/TileStrategy".split(" "),function(b,d,f,h,e,a){Object.defineProperty(d,"__esModule",
{value:!0});d.TileInfoView=f;d.TileKey=h;d.TileQueue=e;d.TileStrategy=a})},"esri/views/2d/tiling/TileInfoView":function(){define("require exports ../../../geometry/support/spatialReferenceUtils ./LODInfo ./TileCoverage ./TileKey ./TileSpan".split(" "),function(b,d,f,h,e,a,q){var m=new a("0/0/0/0"),c=function(){function a(a,c,b,d,e,k,l,f){this.x=a;this.ymin=c;this.ymax=b;this.invM=d;this.leftAdjust=e;this.rightAdjust=k;this.leftBound=l;this.rightBound=f}a.create=function(c,b){var g;c[1]>b[1]&&(g=[b,
c],c=g[0],b=g[1]);g=c[0];c=c[1];var d=b[0];b=b[1];var e=d-g,k=b-c,k=0!==k?e/k:0,l=(Math.ceil(c)-c)*k,f=(Math.floor(c)-c)*k;return new a(g,Math.floor(c),Math.ceil(b),k,0>e?l:f,0>e?f:l,0>e?d:g,0>e?g:d)};a.prototype.incrRow=function(){this.x+=this.invM};a.prototype.getLeftCol=function(){return Math.max(this.x+this.leftAdjust,this.leftBound)};a.prototype.getRightCol=function(){return Math.min(this.x+this.rightAdjust,this.rightBound)};return a}(),l=[[0,0],[0,0],[0,0],[0,0]];return function(){function a(a,
c){var b=this;this.tileInfo=a;this.fullExtent=c;this.scales=[];this._lodInfos=null;this._infoByScale={};this._infoByLevel={};var d=a.lods.slice();d.sort(function(a,c){return c.scale-a.scale});var e=this._lodInfos=d.map(function(b){return h.create(a,b,c)});d.forEach(function(a,c){b._infoByLevel[a.level]=e[c];b._infoByScale[a.scale]=e[c];b.scales[c]=a.scale},this);this._wrap=a.isWrappable}Object.defineProperty(a.prototype,"spatialReference",{get:function(){return this.tileInfo.spatialReference},enumerable:!0,
configurable:!0});a.prototype.getLODInfoAt=function(a){return this._infoByLevel["number"===typeof a?a:a.level]};a.prototype.getTileBounds=function(a,c,b){void 0===b&&(b=!1);m.set(c);return(c=this._infoByLevel[m.level])?c.getTileBounds(a,m,b):a};a.prototype.getTileCoords=function(a,c,b){void 0===b&&(b=!1);m.set(c);return(c=this._infoByLevel[m.level])?c.getTileCoords(a,m,b):a};a.prototype.getTileCoverage=function(a,b,g){void 0===b&&(b=192);void 0===g&&(g="closest");g="closest"===g?this.getClosestInfoForScale(a.scale):
this.getSmallestInfoForScale(a.scale);var d=e.pool.acquire(g),k=this._wrap,f;f=Infinity;var m=-Infinity,h,n,r=d.spans;l[0][0]=l[0][1]=l[1][1]=l[3][0]=-b;l[1][0]=l[2][0]=a.size[0]+b;l[2][1]=l[3][1]=a.size[1]+b;for(b=0;b<l.length;b++){var v=l[b];a.toMap(v,v);v[0]=g.getColumnForX(v[0]);v[1]=g.getRowForY(v[1])}a=[];v=3;for(b=0;4>b;b++){if(l[b][1]!==l[v][1]){var z=c.create(l[b],l[v]);f=Math.min(z.ymin,f);m=Math.max(z.ymax,m);void 0===a[z.ymin]&&(a[z.ymin]=[]);a[z.ymin].push(z)}v=b}if(null==f||null==m||
100<m-f)return null;for(v=[];f<m;){null!=a[f]&&(v=v.concat(a[f]));h=Infinity;n=-Infinity;for(b=v.length-1;0<=b;b--)z=v[b],h=Math.min(h,z.getLeftCol()),n=Math.max(n,z.getRightCol());h=Math.floor(h);n=Math.floor(n);if(f>=g.first[1]&&f<=g.last[1])if(k)if(g.size[0]<g.worldSize[0])for(z=Math.floor(n/g.worldSize[0]),b=Math.floor(h/g.worldSize[0]);b<=z;b++)r.push(new q(f,Math.max(g.getFirstColumnForWorld(b),h),Math.min(g.getLastColumnForWorld(b),n)));else r.push(new q(f,h,n));else h>g.last[0]||n<g.first[0]||
(h=Math.max(h,g.first[0]),n=Math.min(n,g.last[0]),r.push(new q(f,h,n)));f+=1;for(b=v.length-1;0<=b;b--)z=v[b],z.ymax>=f?z.incrRow():v.splice(b,1)}return d};a.prototype.getTileParentId=function(a){m.set(a);a=this._lodInfos.indexOf(this._infoByLevel[m.level])-1;if(0>a)return null;this._getTileIdAtLOD(m,this._lodInfos[a],m);return m.id};a.prototype.getTileResolution=function(a){return(a=this._infoByLevel["object"===typeof a?a.level:a])?a.resolution:-1};a.prototype.getTileScale=function(a){return(a=this._infoByLevel[a.level])?
a.scale:-1};a.prototype.intersects=function(a,c){m.set(c);c=this._infoByLevel[m.level];var b=a.lodInfo;if(b.resolution>c.resolution){this._getTileIdAtLOD(m,b,m);for(var d=b.denormalizeCol(m.col,m.world),e=0,k=a.spans;e<k.length;e++){var l=k[e];if(l.row===m.row&&l.colFrom<=d&&l.colTo>=d)return!0}}if(b.resolution<c.resolution){k=a.spans.reduce(function(a,c){a[0]=Math.min(a[0],c.row);a[1]=Math.max(a[1],c.row);a[2]=Math.min(a[2],c.colFrom);a[3]=Math.max(a[3],c.colTo);return a},[Infinity,-Infinity,Infinity,
-Infinity]);a=k[0];var d=k[1],e=k[2],k=k[3],f=c.denormalizeCol(m.col,m.world),l=b.getColumnForX(c.getXForColumn(f)),h=b.getRowForY(c.getYForRow(m.row)),f=b.getColumnForX(c.getXForColumn(f+1))-1;c=b.getRowForY(c.getYForRow(m.row+1))-1;return!(l>k||f<e||h>d||c<a)}var n=b.denormalizeCol(m.col,m.world);return a.spans.some(function(a){return a.row===m.row&&a.colFrom<=n&&a.colTo>=n})};a.prototype.normalizeBounds=function(a,c,b){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];this._wrap&&(c=f.getInfo(this.tileInfo.spatialReference),
b=-b*(c.valid[1]-c.valid[0]),a[0]+=b,a[2]+=b);return a};a.prototype.getSmallestInfoForScale=function(a){var c=this.scales;if(this._infoByScale[a])return this._infoByScale[a];if(a>c[0])return this._infoByScale[c[0]];for(var b=1;b<c.length-1;b++)if(a>c[b]+1E-6)return this._infoByScale[c[b-1]];return this._infoByScale[c[c.length-1]]};a.prototype.getClosestInfoForScale=function(a){var c=this.scales;if(this._infoByScale[a])return this._infoByScale[a];a=c.reduce(function(c,b){return Math.abs(b-a)<Math.abs(c-
a)?b:c},c[0]);return this._infoByScale[a]};a.prototype.scaleToLevel=function(a){var c=this.scales;if(this._infoByScale[a])return this._infoByScale[a].level;for(var b=c.length-1;0<=b;b--)if(a<c[b])return b===c.length-1?this._infoByScale[c[c.length-1]].level:this._infoByScale[c[b]].level+(c[b]-a)/(c[b]-c[b+1]);return this._infoByScale[c[0]].level};a.prototype.scaleToZoom=function(a){return this.tileInfo.scaleToZoom(a)};a.prototype._getTileIdAtLOD=function(a,c,b){var g=this._infoByLevel[b.level];a.set(b);
if(c.resolution<g.resolution)return null;if(c.resolution===g.resolution)return a;a.level=c.level;a.col=Math.floor(b.col*g.resolution/c.resolution+.01);a.row=Math.floor(b.row*g.resolution/c.resolution+.01);return a};return a}()})},"esri/views/2d/tiling/LODInfo":function(){define(["require","exports","../../../geometry/support/spatialReferenceUtils","./TileKey"],function(b,d,f,h){function e(a,b,c){a[0]=b;a[1]=c;return a}var a=new h("0/0/0/0");return function(){function b(a,c,b,d,e,f,g,h,t,q,y,A){this.level=
a;this.resolution=c;this.scale=b;this.origin=d;this.first=e;this.last=f;this.size=g;this.norm=h;this.worldStart=t;this.worldEnd=q;this.worldSize=y;this.wrap=A}b.create=function(a,c,d){var k=f.getInfo(a.spatialReference),l=[a.origin.x,a.origin.y],m=[a.size[0]*c.resolution,a.size[1]*c.resolution],g=[-Infinity,-Infinity],h=[Infinity,Infinity],t=[Infinity,Infinity];d&&(e(g,Math.max(0,Math.floor((d.xmin-l[0])/m[0])),Math.max(0,Math.floor((l[1]-d.ymax)/m[1]))),e(h,Math.max(0,Math.floor((d.xmax-l[0])/m[0])),
Math.max(0,Math.floor((l[1]-d.ymin)/m[1]))),e(t,h[0]-g[0]+1,h[1]-g[1]+1));var q;a.isWrappable?(a=[Math.ceil(Math.round(2*k.origin[1]/c.resolution)/a.size[0]),t[1]],k=[Math.floor((k.origin[0]-l[0])/m[0]),g[1]],d=[a[0]+k[0]-1,h[1]],q=!0):(k=g,d=h,a=t,q=!1);return new b(c.level,c.resolution,c.scale,l,g,h,t,m,k,d,a,q)};b.prototype.normalizeCol=function(a){if(!this.wrap)return a;var c=this.worldSize[0];return 0>a?c-1-Math.abs((a+1)%c):a%c};b.prototype.denormalizeCol=function(a,c){return this.wrap?this.worldSize[0]*
c+a:a};b.prototype.getWorldForColumn=function(a){return this.wrap?Math.floor(a/this.worldSize[0]):0};b.prototype.getFirstColumnForWorld=function(a){return a*this.worldSize[0]+this.first[0]};b.prototype.getLastColumnForWorld=function(a){return a*this.worldSize[0]+this.first[0]+this.size[0]-1};b.prototype.getColumnForX=function(a){return(a-this.origin[0])/this.norm[0]};b.prototype.getXForColumn=function(a){return this.origin[0]+a*this.norm[0]};b.prototype.getRowForY=function(a){return(this.origin[1]-
a)/this.norm[1]};b.prototype.getYForRow=function(a){return this.origin[1]-a*this.norm[1]};b.prototype.getTileBounds=function(b,c,d){void 0===d&&(d=!1);a.set(c);var e=d?a.col:this.denormalizeCol(a.col,a.world),l=a.row;c=this.getXForColumn(e);d=this.getYForRow(l+1);e=this.getXForColumn(e+1);l=this.getYForRow(l);b[0]=c;b[1]=d;b[2]=e;b[3]=l;return b};b.prototype.getTileCoords=function(b,c,d){void 0===d&&(d=!1);a.set(c);c=d?a.col:this.denormalizeCol(a.col,a.world);Array.isArray(b)?e(b,this.getXForColumn(c),
this.getYForRow(a.row)):(b.x=this.getXForColumn(c),b.y=this.getYForRow(a.row));return b};return b}()})},"esri/views/2d/tiling/TileCoverage":function(){define(["require","exports","../../../core/ObjectPool"],function(b,d,f){return function(){function b(b){this.lodInfo=b;this.spans=[]}b.prototype.release=function(){};b.prototype.forEach=function(b,a){var d=this.spans,e=this.lodInfo,c=e.level;if(0!==d.length)for(var l=0;l<d.length;l++)for(var k=d[l],f=k.row,h=k.colTo,k=k.colFrom;k<=h;k++)b.call(a,c,
f,e.normalizeCol(k),e.getWorldForColumn(k))};b.pool=new f(b,!0);return b}()})},"esri/views/2d/tiling/TileSpan":function(){define(["require","exports","../../../core/ObjectPool"],function(b,d,f){return function(){function b(b,a,d){this.row=b;this.colFrom=a;this.colTo=d}b.pool=new f(b,!0);return b}()})},"esri/views/2d/tiling/TileQueue":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/SetUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec2 ../../support/QueueProcessor".split(" "),
function(b,d,f,h,e,a,q,m,c){function l(a,c){a.length=0;c.forEach(function(c){return a.push(c)});return a}var k=new Set,n=[],r=new Map,g=[0,0];return function(b){function d(a){a=b.call(this,a)||this;a._keyToItem=new Map;a.concurrency=6;a.strategy="scale-first";a.tileInfoView=null;return a}h(d,b);d.prototype.initialize=function(){var a=this,b=this.process;this._queue=new c.QueueProcessor({concurrency:this.concurrency,process:function(c,g){c=a._keyToItem.get(c);return b(c,{signal:g})},peeker:"scale-first"===
this.strategy?function(c){return a._peekByScaleFirst(c)}:function(c){return a._peekByCenterFirst(c)}})};d.prototype.destroy=function(){this.clear();this._queue.destroy();this._queue=null};Object.defineProperty(d.prototype,"length",{get:function(){return this._queue?this._queue.length:0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"onGoingCount",{get:function(){return this._keyToItem.size},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return 0<
this.length||0<this.onGoingCount},enumerable:!0,configurable:!0});d.prototype.abort=function(a){this._queue.abort("string"===typeof a?a:a.id)};d.prototype.clear=function(){this._queue.clear();this._keyToItem.clear();this.notifyChange("updating")};d.prototype.has=function(a){return"string"===typeof a?this._keyToItem.has(a):this._keyToItem.has(a.id)};d.prototype.isOngoing=function(a){a="string"===typeof a?a:a.id;return this.has(a)&&this._queue.isOngoing(a)};d.prototype.pause=function(){this._queue.pause()};
d.prototype.push=function(a){var c=this,b=a.key.id;if(this.has(b))return this.get(b);var g=this._queue.push(b),d=function(){c._keyToItem.delete(b);c.notifyChange("updating")};this._keyToItem.set(b,a);g.then(d,d);this.notifyChange("updating");return g};d.prototype.reset=function(){this._queue.reset();this.notifyChange("updating")};d.prototype.resume=function(){this._queue.resume()};d.prototype._peekByScaleFirst=function(c){var b=this;if(!this.state)return a.firstOfSet(c);var g=this.tileInfoView,d=
Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY;c.forEach(function(a){a=b._keyToItem.get(a);var c=b.tileInfoView.getTileScale(a.key);r.has(c)||(r.set(c,[]),d=Math.max(c,d),e=Math.min(c,e));r.get(c).push(a.key);k.add(c)});var f=this.state.scale;r.has(f)||(l(n,k),n.sort(),f=n.reduce(function(a,c){return Math.abs(c-f)<Math.abs(a-f)?c:a},n[0]));f=Math.min(f,d);f=Math.max(f,e);c=r.get(f);var m=g.getClosestInfoForScale(f),h=m.getColumnForX(this.state.center[0]),t=m.getRowForY(this.state.center[1]);
c.sort(function(a,c){var b=m.denormalizeCol(a.col,a.world),g=m.denormalizeCol(c.col,c.world);return Math.sqrt((h-b)*(h-b)+(t-a.row)*(t-a.row))-Math.sqrt((h-g)*(h-g)+(t-c.row)*(t-c.row))});k.clear();r.clear();return c[0].id};d.prototype._peekByCenterFirst=function(c){var b=this;if(!this.state)return a.firstOfSet(c);var d=this.tileInfoView,e=this.state.center,k=Number.POSITIVE_INFINITY,l=null;c.forEach(function(a){a=b._keyToItem.get(a);d.getTileCoords(g,a.key);var c=m.vec2.distance(g,e);c<k&&(k=c,l=
a.key)});return l.id};f([q.property({constructOnly:!0})],d.prototype,"concurrency",void 0);f([q.property({constructOnly:!0})],d.prototype,"process",void 0);f([q.property()],d.prototype,"state",void 0);f([q.property({constructOnly:!0})],d.prototype,"strategy",void 0);f([q.property({constructOnly:!0})],d.prototype,"tileInfoView",void 0);f([q.property({readOnly:!0})],d.prototype,"updating",null);return d=f([q.subclass("esri.views.2d.tiling.TileQueue")],d)}(q.declared(e))})},"esri/views/support/QueueProcessor":function(){define("require exports ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/scheduling".split(" "),
function(b,d,f,h,e,a){Object.defineProperty(d,"__esModule",{value:!0});var q=function(){return function(a,c){this.item=a;this.controller=c;this.promise=null}}();b=function(){function b(a){var c=this;this._deferreds=new Map;this._controllers=new Map;this._processingItems=new Map;this._isPaused=!1;this._task=this._schedule=null;this.concurrency=1;a.concurrency&&(this.concurrency=a.concurrency);this._queue=new e.default(a.peeker);this.process=a.process;var b=a.scheduler;a.task&&f.isSome(b)&&(this._task=
b.registerTask(a.task,function(a){return c.update(a)},function(){return c.needsUpdate()}))}b.prototype.destroy=function(){this.clear();this._schedule&&(this._schedule.remove(),this._schedule=null);this._task&&(this._task.remove(),this._task=null)};Object.defineProperty(b.prototype,"length",{get:function(){return this._processingItems.size+this._queue.length},enumerable:!0,configurable:!0});b.prototype.abort=function(a){(a=this._controllers.get(a))&&a.abort()};b.prototype.clear=function(){this._queue.clear();
var a=[];this._controllers.forEach(function(c){return a.push(c)});this._controllers.clear();a.forEach(function(a){return a.abort()});this._processingItems.clear();this._cancelNext()};b.prototype.get=function(a){return(a=this._deferreds.get(a))?a.promise:void 0};b.prototype.isOngoing=function(a){return this._processingItems.has(a)};b.prototype.has=function(a){return this._deferreds.has(a)};b.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())};b.prototype.push=function(a){var c=
this,b=this.get(a);if(b)return b;var d,b=h.createAbortController(),e=function(){g.remove();c._deferreds.delete(a);c._controllers.delete(a);c._queue.remove(a);c._processingItems.delete(a);c._scheduleNext()},g=h.onAbortOrThrow(b.signal,function(){var b=c._processingItems.get(a);b&&b.controller.abort();e();d.reject(h.createAbortError())});d=h.createDeferred();this._deferreds.set(a,d);this._controllers.set(a,b);d.promise.then(e,e);this._queue.push(a);this._scheduleNext();return d.promise};b.prototype.reset=
function(){var a=[];this._processingItems.forEach(function(c){return a.push(c)});this._processingItems.clear();for(var b=0;b<a.length;b++){var d=a[b];this._queue.push(d.item);d.controller.abort()}this._scheduleNext()};b.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())};b.prototype.needsUpdate=function(){return!this._isPaused&&0<this._queue.length&&this._processingItems.size<this.concurrency};b.prototype.update=function(a){for(;!a.done&&0<this._queue.length&&this._processingItems.size<
this.concurrency;)this._process(this._queue.pop()),a.madeProgress()};b.prototype._scheduleNext=function(){var c=this;this._task||this._isPaused||this._schedule||(this._schedule=a.schedule(function(){c._schedule=null;c._next()}))};b.prototype._next=function(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())};b.prototype._cancelNext=function(){this._schedule&&(this._schedule.remove(),this._schedule=null)};b.prototype._processResult=function(a,
b){this._canProcessFulfillment(a)&&(this._scheduleNext(),this._deferreds.get(a.item).resolve(b))};b.prototype._processError=function(a,b){this._canProcessFulfillment(a)&&(this._scheduleNext(),this._deferreds.get(a.item).reject(b))};b.prototype._canProcessFulfillment=function(a){return this._deferreds.get(a.item)&&this._processingItems.get(a.item)===a?!0:!1};b.prototype._process=function(a){var c=this;if(!f.isNone(a)){var b,d=h.createAbortController(),e=new q(a,d);this._processingItems.set(a,e);try{b=
this.process(a,d.signal)}catch(g){this._processError(e,g)}b&&"function"===typeof b.then?(e.promise=b,b.then(function(a){return c._processResult(e,a)},function(a){return c._processError(e,a)})):this._processResult(e,b)}};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{update:function(c){return a.update(c)}}},enumerable:!0,configurable:!0});return b}();d.QueueProcessor=b})},"esri/core/Queue":function(){define(["require","exports","./SetUtils"],function(b,d,f){Object.defineProperty(d,
"__esModule",{value:!0});b=function(){function b(b){void 0===b&&(b=function(a){return f.firstOfSet(a)});this._peeker=b;this._items=new Set}Object.defineProperty(b.prototype,"length",{get:function(){return this._items.size},enumerable:!0,configurable:!0});b.prototype.clear=function(){this._items.clear()};b.prototype.peek=function(){if(0!==this._items.size)return this._peeker(this._items)};b.prototype.push=function(b){this.contains(b)||this._items.add(b)};b.prototype.contains=function(b){return this._items.has(b)};
b.prototype.pop=function(){if(0!==this.length){var b=this.peek();this._items.delete(b);return b}};b.prototype.remove=function(b){this._items.delete(b)};return b}();d.default=b})},"esri/views/2d/tiling/TileStrategy":function(){define("require exports ../../../core/tsSupport/extendsHelper ./TileCache ./TileCoverage ./TileKey".split(" "),function(b,d,f,h,e,a){var q=new a(0,0,0,0),m=new Map,c=[],l=[];return function(){function a(a){var c=this;this._previousScale=Number.POSITIVE_INFINITY;this.cachePolicy=
"keep";this.coveragePolicy="closest";this.resampling=!0;this.tileIndex=new Map;this.tiles=[];this.buffer=192;this.acquireTile=a.acquireTile;this.releaseTile=a.releaseTile;this.tileInfoView=a.tileInfoView;this.resampling=null==a.resampling||!!a.resampling;a.cachePolicy&&(this.cachePolicy=a.cachePolicy);a.coveragePolicy&&(this.coveragePolicy=a.coveragePolicy);null!=a.buffer&&(this.buffer=a.buffer);a.cacheSize&&(this._tileCache=new h.default(a.cacheSize,this.tileInfoView,function(a){c.releaseTile(a)}))}
a.prototype.destroy=function(){this.tileIndex.clear()};a.prototype.update=function(a){var b=this,g=this.resampling,d=this.tileIndex,k=this.tileInfoView.getTileCoverage(a.state,this.buffer,this.coveragePolicy);l.length=0;c.length=0;m.clear();if(k){var f=this.tileInfoView.tileInfo,h=f.minScale,n=f.maxScale,p=k.spans,w=k.lodInfo,v=w.level,z=a.state,B=z.scale,f=z.center,z=z.resolution,C=!a.stationary&&B>this._previousScale;this._previousScale=B;this.tiles.length=0;if(!g&&(B>h||B<n))return this.tiles.length=
0,m.clear(),d.forEach(function(a){b.releaseTile(a)}),d.clear(),l.length=0,c.length=0,m.clear(),e.pool.release(k),!0;d.forEach(function(a){return a.visible=!0});n=h=0;if(0<p.length)for(B=0;B<p.length;B++){a=p[B];for(var D=a.row,G=a.colTo,F=a.colFrom;F<=G;F++)if(h++,a=q.set(v,D,w.normalizeCol(F),w.getWorldForColumn(F)).id,d.has(a))g=d.get(a),g.isReady?(m.set(a,g),n++):C||this._addParentTile(a,m);else{g=void 0;if(this._tileCache&&this._tileCache.has(a)){if(g=this._tileCache.pop(a),this.tileIndex.set(a,
g),g.isReady){m.set(a,g);n++;continue}}else g=this.acquireTile(q),this.tileIndex.set(a,g);C||this._addParentTile(a,m)}}var E=n===h;d.forEach(function(a,g){q.set(g);if(!m.has(g)){var d=b.tileInfoView.intersects(k,q);!d||!C&&E?"purge"===b.cachePolicy?q.level===v&&d||c.push(g):(q.level>v||!d)&&c.push(g):a.isReady?l.push(g):q.level>v&&c.push(g)}});for(p=0;p<l.length;p++)a=l[p],(g=d.get(a))&&g.isReady&&m.set(a,g);for(p=0;p<c.length;p++)a=c[p],g=d.get(a),this._tileCache?this._tileCache.add(g):this.releaseTile(g),
d["delete"](a);m.forEach(function(a){return b.tiles.push(a)});d.forEach(function(a){m.has(a.key.id)||(a.visible=!1)});this._tileCache&&this._tileCache.prune(v,f,z);e.pool.release(k);return E}};a.prototype.clear=function(a){var c=this;void 0===a&&(a=!0);var b=this.tileIndex;a&&b.forEach(function(a){c.releaseTile(a)});b.clear()};a.prototype._addParentTile=function(a,c){for(var b=null;;){a=this.tileInfoView.getTileParentId(a);if(!a)break;if(this.tileIndex.has(a)){if((b=this.tileIndex.get(a))&&b.isReady){c.has(b.key.id)||
c.set(b.key.id,b);break}}else if(this._tileCache&&this._tileCache.has(a)&&(b=this._tileCache.pop(a),this.tileIndex.set(a,b),b&&b.isReady)){c.has(b.key.id)||c.set(b.key.id,b);break}}};return a}()})},"esri/views/2d/tiling/TileCache":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2"],function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(b,a,d){this.maxSize=b;this.tileInfoView=a;this.removedFunc=d;this._tilePerId=new Map;this._tileKeysPerLevel=
[]}b.prototype.has=function(b){return this._tilePerId.has(b)};b.prototype.get=function(b){return this._tilePerId.get(b)};b.prototype.pop=function(b){var a=this._tilePerId.get(b);if(!a)return null;var d=this._tileKeysPerLevel[a.key.level];this._tilePerId["delete"](b);for(var e=0;e<d.length;e++)if(d[e].id===b){d.splice(e,1);break}a.visible=!0;return a};b.prototype.add=function(b){b.visible=!1;var a=b.key,d=a.id;this._tilePerId.has(d)||(this._tilePerId.set(d,b),b=a.level,this._tileKeysPerLevel[b]||(this._tileKeysPerLevel[b]=
[]),this._tileKeysPerLevel[b].push(a))};b.prototype.prune=function(b,a,d){var e=this._tilePerId.size;if(!(e<=this.maxSize)){for(var c=this._tileKeysPerLevel.length-1;e>this.maxSize&&0<=c;)c!==b&&(e=this._pruneAroundCenterTile(e,a,d,c)),c--;e>this.maxSize&&(e=this._pruneAroundCenterTile(e,a,d,b))}};b.prototype._pruneAroundCenterTile=function(b,a,d,h){h=this._tileKeysPerLevel[h];if(!h||0===h.length)return b;var c=this.tileInfoView.tileInfo,e=c.size,k=c.origin,m=d*e[0],r=d*e[1],g=[0,0],q=[0,0];for(h.sort(function(c,
b){g[0]=k.x+m*(c.col+.5);g[1]=k.y-r*(c.row+.5);q[0]=k.x+m*(b.col+.5);q[1]=k.y-r*(b.row+.5);return f.vec2.squaredDistance(g,a)-f.vec2.squaredDistance(q,a)});0<h.length&&(d=h.pop(),this._removeTile(d.id),b--,b!==this.maxSize););return b};b.prototype._removeTile=function(b){var a=this._tilePerId.get(b);this.removedFunc&&this.removedFunc(a);this._tilePerId["delete"](b)};return b}();d.default=b})},"esri/views/2d/engine/webgl/collisions/CollisionBucketEntry":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2"],
function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(){this._reference=null}Object.defineProperty(b.prototype,"dirty",{get:function(){return this.reference&&this.reference.isDirty},set:function(b){this.reference&&this.reference.hasData&&(b||this.reference.isDirty)&&(this.reference.isDirty=b)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"index",{get:function(){return this._reference&&this._reference.labelIndex},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"reference",{get:function(){return this._reference},set:function(b){this._reference=b},enumerable:!0,configurable:!0});b.prototype.reset=function(b,a,d){b=b.state;var e=d.layerView.tileRenderer,c=this.reference;if(!c||!c.hasData)return!1;a&&(c.isDirty=!0);a=c.transforms.labelMat2d;for(var l=a[4],k=a[5],h=0,r=c.displayObjects;h<r.length;h++)for(var g=r[h],q=e.featuresView.attributeView,q=d.hasVV()?q.getVVSize(g.id):0,t=0,g=g.metrics;t<g.length;t++){var u=g[t];d.hasVV()&&
u.computeVVOffset(q,d.vvEval);var y=u.bounds.center,A=u.bounds.centerT;c.isDirty&&(u.minZoom=-1);var p=f.vec2.copy(A,u.anchor);b.rotation?f.vec2.transformMat2d(p,p,a):(A[0]=p[0]+l,A[1]=p[1]+k);f.vec2.add(A,p,y);A[0]+=u.offsetX;A[1]+=u.offsetY;if(u.boxes)for(y=0,A=u.boxes;y<A.length;y++){var p=A[y],w=p.centerT;f.vec2.add(w,u.anchor,p.center);b.rotation?f.vec2.transformMat2d(w,w,a):(w[0]+=l,w[1]+=k)}}return!0};return b}();d.default=b})},"esri/views/2d/engine/webgl/collisions/LayerCollisionInfo":function(){define("require exports ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/screenUtils ./visualVariableSimpleUtils".split(" "),
function(b,d,f,h,e,a){function q(c){return function(b){return e.pt2px(a.getSizeForValueSimple(b,c))}}function m(a){if(!a)return null;for(var c=0;c<a.length;c++){var b=a[c];if("size"===b.type)return q(b)}return null}Object.defineProperty(d,"__esModule",{value:!0});var c=function(a,c){return a.order-c.order},l=function(a,c){return a.index-c.index},k=f.getLogger("esri/views/2d/engine/webgl/collisions/CollisionEngine");d.createLabelVVEvaluator=m;b=function(){function a(a,c,b,d){var g=this;this._vvHandle=
null;var e=a.layer,k=e.geometryType,l=e.labelingInfo,f=e.renderer;e.renderer&&(this.vvEval=m("visualVariables"in f&&f.visualVariables));this._vvHandle=e.watch("renderer",function(a){e.renderer&&(g.vvEval=m("visualVariables"in a&&a.visualVariables))});l=l.map(function(a){var c=!!a.maxScale,b=!!a.minScale&&d.scaleToZoom(a.minScale)||0;a=c&&d.scaleToZoom(a.maxScale)||255;return{minZoom:h.clamp(Math.floor(10*b),0,255),maxZoom:h.clamp(Math.floor(10*a),0,255)}});this.layerView=a;this.geometryType=k;this.index=
c;this.order=b;this.zoomRanges=l;this.layerView=a}a.prototype.hasVV=function(){return!!this.vvEval};a.prototype.allOrNothing=function(){return"polyline"!==this.geometryType};a.prototype.destroy=function(){this._vvHandle.remove()};a.create=function(b,g,d,e){d=d.sort(c);for(var k=!1,l=-1,f=0;f<d.length;f++){var h=d[f];!k&&h.order>g&&(l=h.index,k=!0);k&&h.index++}k||(l=d.length);return new a(b,l,g,e)};a.delete=function(a,c){for(var b=c.sort(l),g=a+1;g<b.length;g++)c[g].index--;c[a].destroy();c.splice(a,
1)};a.find=function(a,c){for(var b=0;b<c.length;b++){var g=c[b];if(g.index===a)return g}k.error("Tried to get a LayerCollisionInfo for an index that doesn't exist!");return null};return a}();d.default=b})},"esri/views/2d/engine/webgl/collisions/visualVariableSimpleUtils":function(){define(["require","exports","../../../../../core/mathUtils","../../../../../renderers/support/utils"],function(b,d,f,h){function e(c,b){switch(b.transformationType){case "additive":var d=a(b.minSize,c);return c+(d||b.minDataValue);
case "constant":return d=(d=b.stops)&&d.length&&d[0].size,null==d&&(d=b.minSize),a(d,c);case "clamped-linear":var d=(c-b.minDataValue)/(b.maxDataValue-b.minDataValue),e=a(b.minSize,c),l=a(b.maxSize,c);c=c<=b.minDataValue?e:c>=b.maxDataValue?l:e+d*(l-e);return c;case "proportional":return d=c/b.minDataValue,e=a(b.minSize,c),c=a(b.maxSize,c),f.clamp(d*e,e,c);case "stops":return e=q(c,b.cache.ipData),l=e[0],d=e[1],e=e[2],l===d?c=a(b.stops[l].size,c):(l=a(b.stops[l].size,c),c=a(b.stops[d].size,c),c=l+
(c-l)*e),c;case "real-world-size":d=h.meterIn[b.valueUnit];e=a(b.minSize,c);l=a(b.maxSize,c);b=b.valueRepresentation;var g=null,g="area"===b?2*Math.sqrt(c/m)/d:"radius"===b||"distance"===b?2*c/d:c/d;return f.clamp(g,e,l);case "identity":return c;case "unknown":return null}}function a(a,b){return"number"===typeof a?a:e(b,a)}function q(a,b){if(b){var c=0,d=b.length-1;b.some(function(b,g){if(a<b)return d=g,!0;c=g;return!1});return[c,d,(a-b[c])/(b[d]-b[c])]}}Object.defineProperty(d,"__esModule",{value:!0});
var m=Math.PI;d.getSizeForValueSimple=e})},"esri/views/2d/engine/webgl/collisions/LayerViewSorter":function(){define(["require","exports","../../../../../core/Error","../../../../../core/Logger"],function(b,d,f,h){function e(a){return"esri.views.2d.layers.FeatureLayerView2D"===a.declaredClass||"esri.views.2d.layers.StreamLayerView2D"===a.declaredClass}Object.defineProperty(d,"__esModule",{value:!0});var a=h.getLogger("esri.views.2d.engine.collisions.LayerViewSorter");b=function(){function b(a,c){this.registerLayer=
a;this.unregisterLayer=c;this._layerViewState=new Map}b.prototype.findIndex=function(a){return a.view.allLayerViews.findIndex(function(c){return c.uid===a.uid})};b.prototype.update=function(b){for(var c=b.added,d=0,k=b.removed;d<k.length;d++)b=k[d],e(b)&&this._layerViewState.has(b)&&this._deleteState(b);for(d=0;d<c.length;d++){b=c[d];if(k=e(b))a:if(b.layer&&b.layer.renderer)switch(b.layer.renderer.type){case "class-breaks":case "simple":case "unique-value":case "dictionary":case "dot-density":k=!0;
break a;default:a.error(new f("mapview-labeling","Renderer of type "+b.layer.renderer.type+" does not currently support labeling")),k=!1}else k=!1;k&&!this._layerViewState.has(b)&&this._createState(b)}this._recomputeOrder()};b.prototype.destroy=function(){this._layerViewState.forEach(function(a){return a.handle.remove()})};b.prototype._createState=function(a){var c={priority:-1,handle:null};c.handle=a.watch("labelsVisible",this._recomputeOrder.bind(this));this._layerViewState.set(a,c);return c};b.prototype._deleteState=
function(a){if(this._layerViewState.has(a)){var c=this._layerViewState.get(a);c.handle.remove();-1!==c.priority&&this.unregisterLayer(a);this._layerViewState.delete(a)}};b.prototype._recomputeOrder=function(){var a=this;this._layerViewState.forEach(function(c,b){var d=b.view.map.allLayers.findIndex(function(a){return a.uid===b.layer.uid}),e=b.layer,d=e.visible&&e.labelsVisible&&e.labelingInfo?4294967295-d:-1;d!==c.priority&&(c.priority=d,a.unregisterLayer(b),-1!==d&&a.registerLayer(b,d))})};return b}();
d.LayerViewSorter=b})},"esri/views/2d/engine/webgl/Geometry":function(){define(["require","exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(b,d){this.x=b;this.y=d}b.prototype.clone=function(){return new b(this.x,this.y)};b.prototype.equals=function(b,d){return b===this.x&&d===this.y};b.prototype.isEqual=function(b){return b.x===this.x&&b.y===this.y};b.prototype.setCoords=function(b,d){this.x=b;this.y=d};b.prototype.normalize=function(){var b=this.x,
d=this.y,b=Math.sqrt(b*b+d*d);this.x/=b;this.y/=b};b.prototype.rightPerpendicular=function(){var b=this.x;this.x=this.y;this.y=-b};b.prototype.move=function(b,d){this.x+=b;this.y+=d};b.prototype.assign=function(b){this.x=b.x;this.y=b.y};b.prototype.assignAdd=function(b,d){this.x=b.x+d.x;this.y=b.y+d.y};b.prototype.assignSub=function(b,d){this.x=b.x-d.x;this.y=b.y-d.y};b.prototype.rotate=function(b,d){var a=this.x,e=this.y;this.x=a*b-e*d;this.y=a*d+e*b};b.prototype.scale=function(b){this.x*=b;this.y*=
b};b.prototype.length=function(){var b=this.x,d=this.y;return Math.sqrt(b*b+d*d)};b.distance=function(b,d){var a=d.x-b.x;b=d.y-b.y;return Math.sqrt(a*a+b*b)};b.add=function(d,e){return new b(d.x+e.x,d.y+e.y)};b.sub=function(d,e){return new b(d.x-e.x,d.y-e.y)};return b}();d.Point=b})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["require","exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});var f;(function(b){b[b.Left=-1]="Left";b[b.Center=0]="Center";b[b.Right=
1]="Right"})(f=d.HAlign||(d.HAlign={}));var h;(function(b){b[b.Top=1]="Top";b[b.Center=0]="Center";b[b.Bottom=-1]="Bottom";b[b.Baseline=2]="Baseline"})(h=d.VAlign||(d.VAlign={}));d.getXAnchorDirection=function(b){switch(b){case "left":return f.Left;case "right":return f.Right;case "center":case "justify":return f.Center}};d.getYAnchorDirection=function(b){switch(b){case "top":return h.Top;case "middle":return h.Center;case "baseline":return h.Baseline;case "bottom":return h.Bottom}};d.getAlignmentFromPlacement=
function(b){switch(b){case "above-left":return[f.Right,h.Bottom];case "above-center":case "above-along":return[f.Center,h.Bottom];case "above-right":return[f.Left,h.Bottom];case "center-left":return[f.Right,h.Center];case "center-center":case "center-along":return[f.Center,h.Center];case "center-right":return[f.Left,h.Center];case "below-left":return[f.Right,h.Top];case "below-center":case "below-along":return[f.Center,h.Top];case "below-right":return[f.Left,h.Top];case "always-horizontal":return[f.Center,
h.Baseline];default:return console.debug("Found invalid placement type "+b),[f.Center,h.Center]}};d.getXDirection=function(b){switch(b){case f.Right:return-1;case f.Center:return 0;case f.Left:return 1;default:return console.debug("Found invalid horizontal alignment "+b),0}};d.getYDirection=function(b){switch(b){case h.Top:return 1;case h.Center:return 0;case h.Bottom:case h.Baseline:return-1;default:return console.debug("Found invalid vertical alignment "+b),0}};d.getJustification=function(b){switch(b){case "left":return f.Left;
case "right":return f.Right;case "center":case "justify":return f.Center}}})},"esri/views/2d/engine/webgl/brushes/BrushBitmap":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../definitions ../VertexStream ./WGLBrush".split(" "),function(b,d,f,h,e,a){Object.defineProperty(d,"__esModule",{value:!0});var q={nearest:{defines:[],samplingMode:9728,mips:!1},bilinear:{defines:[],samplingMode:9729,mips:!1},bicubic:{defines:["bicubic"],samplingMode:9729,mips:!1},trilinear:{defines:[],
samplingMode:9987,mips:!0}};b=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c._desc={path:"raster/bitmap",attributes:{a_position:0,a_texcoord:1}};return c}f(c,a);c.prototype.dispose=function(){this._quad&&this._quad.dispose()};c.prototype.prepareState=function(a,c){a=a.context;a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(1,771,1,771);a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!0);a.setStencilFunction(514,c.stencilRef,255)};c.prototype.draw=
function(a,c){var b=a.context,d=a.renderingOptions,g=a.painter;if(c.source){a.timeline.begin(this.name);this._quad||(this._quad=new e(b,[0,0,1,0,0,1,1,1]));if("dynamic"===d.samplingMode)var d=a.state,k=c.resolution/c.pixelRatio/d.resolution,l=Math.round(a.pixelRatio)!==a.pixelRatio,d=d.rotation||1.05<k||.95>k||l||c.isSourceScaled||c.rotation?q.bilinear:q.nearest;else d=q[d.samplingMode];g=g.materialManager.getProgram(a,this._desc,d.defines);c.setSamplingProfile(d);c.bind(h.TEXTURE_BINDING_BITMAP);
b.bindProgram(g);g.setUniformMatrix3fv("u_dvsMat3",c.transforms.dvs);g.setUniform1i("u_texture",h.TEXTURE_BINDING_BITMAP);g.setUniform2fv("u_coordScale",c.coordScale);this._quad.draw();a.timeline.end(this.name)}};return c}(a.default);d.default=b})},"esri/views/2d/engine/webgl/brushes/BrushClip":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../Utils ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/programUtils".split(" "),
function(b,d,f,h,e,a,q,m){Object.defineProperty(d,"__esModule",{value:!0});b=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c._color=h.vec4f32.fromValues(0,1,0,1);return c}f(c,a);c.prototype.dispose=function(){this._program&&this._program.dispose()};c.prototype.prepareState=function(a){a=a.context;a.setStencilTestEnabled(!0);a.setBlendingEnabled(!1);a.setFaceCullingEnabled(!1);a.setColorMask(!1,!1,!1,!1);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255);a.setStencilFunction(519,
0,255)};c.prototype.draw=function(a,c){var b=a.context;a=a.state;this._program||(this._program=m.createProgram(b,q.background));var d=this._program,k=e.createProgramDescriptor("clip",{geometry:[{location:0,name:"a_pos",count:2,type:5122}]});c=c.getVAO(b,a,k.attributes,k.bufferLayouts);b.bindProgram(this._program);d.setUniform2fv("u_coord_range",[1,1]);d.setUniform4fv("u_color",this._color);d.setUniformMatrix3fv("u_dvsMat3",a.displayMat3);b.bindVAO(c);b.drawElements(4,c.indexBuffer.size,5125,0);b.bindVAO()};
return c}(a.default);d.default=b})},"esri/views/2d/engine/webgl/brushes/BrushRasterBitmap":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../VertexStream ../WGLRasterUtils ./WGLBrush".split(" "),function(b,d,f,h,e,a,q){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a._desc={lut:{path:"raster/lut",attributes:{a_position:0,a_texcoord:1}},stretch:{path:"raster/stretch",
attributes:{a_position:0,a_texcoord:1}}};return a}f(c,b);c.prototype.dispose=function(){this._quad&&this._quad.dispose()};c.prototype.prepareState=function(a,c){a=a.context;a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(1,771,1,771);a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!0);a.setStencilFunction(514,c.stencilRef,255)};c.prototype.draw=function(c,b){var d=c.context,k=c.painter;if(b.source&&!b.suspended){c.timeline.begin(this.name);this._quad||(this._quad=
new e(d,[0,0,1,0,0,1,1,1]));k=k.materialManager.getProgram(c,this._desc[b.symbolizerParameters.type]);d.bindProgram(k);var g=a.getUniformInfos(d,k),l=b.getTextures();a.setTextures(d,k,l.names,l.textures);l=b.getUniforms();b=h({u_opacity:b.opacity,u_coordScale:b.coordScale},l);b.u_flipY=!1;a.setUniforms(d,k,g,b);this._quad.draw();c.timeline.end(this.name)}};return c}(q.default);d.default=b})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLBackground":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../../vectorTiles/shaders/Programs ../definitions ../enums ../number ./WGLBrush".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a._color=e.vec4f32.fromValues(1,0,0,1);a._patternMatrix=h.mat3f32.create();a._programOptions={id:!1,pattern:!1};return a}f(d,b);d.prototype.dispose=function(){this._program&&(this._program.dispose(),this._program=null);this._vao&&(this._vao.dispose(),this._vao=null)};d.prototype.drawMany=function(a,b){var d=a.context,g=a.styleLayerId;this._loadWGLResources(d);
var e=a.displayLevel,k=a.styleLayer,f=a.painter.getVectorTileProgramCach(),h=k.getPaintValue("background-color",e),n=k.getPaintValue("background-opacity",e),q=k.getPaintValue("background-pattern",e),r=void 0!==q,x=h[3]*n,D=a.spriteMosaic,G,F=(window.devicePixelRatio|1)>m.VTL_HIGH_RES_CUTOFF?2:1;a=a.drawPhase===c.WGLDrawPhase.HITTEST;var E=this._programOptions;E.id=a;E.pattern=r;f=f.getProgram(0,(a?1:0)<<1|(r?1:0),E);d.bindVAO(this._vao);d.bindProgram(f);if(r){G=D.getMosaicItemPosition(q,!0);if(!G)return;
f.setUniform1f("u_opacity",n);f.setUniform2f("u_pattern_tl",G.tl[0],G.tl[1]);f.setUniform2f("u_pattern_br",G.br[0],G.br[1]);f.setUniform1i("u_texture",m.VTL_TEXTURE_BINDING_UNIT_SPRITES);D.bind(d,9729,G.page,m.VTL_TEXTURE_BINDING_UNIT_SPRITES)}else this._color[0]=x*h[0],this._color[1]=x*h[1],this._color[2]=x*h[2],this._color[3]=x,f.setUniform4fv("u_color",this._color);f.setUniform1f("u_depth",k.z||0);a&&(g=l.u32to4Xu8(g),f.setUniform4f("u_id",g[0],g[1],g[2],g[3]));for(g=0;g<b.length;g++)k=b[g],f.setUniform1f("u_coord_range",
k.coordRange[0]),f.setUniformMatrix3fv("u_dvsMat3",k.transforms.dvs),r&&(h=F*k.size[0]*Math.max(Math.pow(2,Math.round(e)-k.key.level),1),n=h/G.size[1],this._patternMatrix[0]=h/G.size[0],this._patternMatrix[4]=n,f.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),d.setStencilFunction(514,k.stencilRef,255),d.drawArrays(5,0,4)};d.prototype._loadWGLResources=function(c){if(!this._program||!this._vao){var b=a.createProgram(c,q.background);if(b){var d=new Int8Array([0,0,1,0,0,1,1,1]),d=a.BufferObject.createVertex(c,
35044,d);c=new a.VertexArrayObject(c,q.background.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:d});this._program=b;this._vao=c}}};return d}(k.default);d.WGLBrushVTLBackground=b})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLCircle":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../enums ../number ./WGLBrush".split(" "),function(b,d,f,h,e,
a,q,m){Object.defineProperty(d,"__esModule",{value:!0});var c=[1,1,1,1];b=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a._color=h.vec4f32.create();a._strokeColor=h.vec4f32.create();a._programOptions={id:!1};a._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:16,normalized:!0,divisor:0},{name:"a_stroke_color",count:4,type:5121,offset:8,stride:16,normalized:!0,divisor:0},
{name:"a_data",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};return a}f(d,b);d.prototype.dispose=function(){};d.prototype.drawMany=function(b,d){var g=b.context,e=b.state,k=b.drawPhase,l=b.styleLayerId,f=b.displayLevel,h=b.styleLayer;b=b.painter.getVectorTileProgramCach();var m=h.hasDataDrivenRadius?1:h.getPaintValue("circle-radius",f),n=h.hasDataDrivenColor?c:h.getPaintValue("circle-color",f),v=h.hasDataDrivenOpacity?1:h.getPaintValue("circle-opacity",f),r=h.hasDataDrivenStrokeWidth?
1:h.getPaintValue("circle-stroke-width",f),B=h.hasDataDrivenStrokeColor?c:h.getPaintValue("circle-stroke-color",f),C=h.hasDataDrivenStrokeOpacity?1:h.getPaintValue("circle-stroke-opacity",f),D=h.hasDataDrivenBlur?0:h.getPaintValue("circle-blur",f),v=v*n[3];this._color[0]=v*n[0];this._color[1]=v*n[1];this._color[2]=v*n[2];this._color[3]=v;v=C*B[3];this._strokeColor[0]=v*B[0];this._strokeColor[1]=v*B[1];this._strokeColor[2]=v*B[2];this._strokeColor[3]=v;n=h.getPaintValue("circle-translate",f);f=h.getPaintValue("circle-translate-anchor",
f);B=k===a.WGLDrawPhase.HITTEST;k=this._programOptions;k.id=B;k=b.getProgram(5,B?1:0,k);g.bindProgram(k);k.setUniformMatrix3fv("u_displayMat3",1===f?e.displayMat3:e.displayViewMat3);k.setUniform2fv("u_circleTranslation",n);k.setUniform1f("u_depth",h.z);k.setUniform1f("u_radius",m);k.setUniform4fv("u_color",this._color);k.setUniform1f("u_blur",D);k.setUniform1f("u_stroke_width",r);k.setUniform4fv("u_stroke_color",this._strokeColor);k.setUniform1f("u_antialiasingWidth",1.2);B&&(e=q.u32to4Xu8(l),k.setUniform4f("u_id",
e[0],e[1],e[2],e[3]));for(e=0;e<d.length;e++)if(h=d[e],h.layerData[l]&&(m=h.layerData[l],r=this._getCircleVAO(g,h,b)))g.bindVAO(r),k.setUniformMatrix3fv("u_dvsMat3",h.transforms.dvs),g.setStencilFunction(514,h.stencilRef,255),g.drawElements(4,m.triangleElementCount,5125,12*m.triangleElementStart),h.triangleCount+=m.triangleElementCount/3};d.prototype._getCircleVAO=function(a,c,b){if(c.circleVertexArrayObject)return c.circleVertexArrayObject;var d=c.circleVertexBuffer,g=c.circleIndexBuffer;if(!d||
!g)return null;c.circleVertexArrayObject=new e.VertexArrayObject(a,b.getProgramAttributes(5),this._vertexAttributes,{geometry:d},g);return c.circleVertexArrayObject};return d}(m.default);d.WGLBrushVTLCircle=b})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLFill":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../definitions ../enums ../number ./WGLBrush".split(" "),
function(b,d,f,h,e,a,q,m,c,l){Object.defineProperty(d,"__esModule",{value:!0});var k=1/65536,n=[1,1,1,1];b=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a._fillVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]};a._fillVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:8,normalized:!0,divisor:0}]};a._outlineVertexAttributes=
{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}]};a._outlineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:12,normalized:!1,
divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:12,normalized:!0,divisor:0}]};a._color=e.vec4f32.create();a._outlineColor=e.vec4f32.create();a._fillProgramOptions={id:!1,dd:!1,pattern:!1};a._outlineProgramOptions={id:!1,dd:!1};a._patternMatrix=h.mat3f32.create();return a}f(d,b);d.prototype.dispose=function(){};d.prototype.drawMany=function(a,b){var d=a.displayLevel,g=a.drawPhase,e=a.renderPass,k=a.styleLayerId,l=a.styleLayer,f=l.getPaintValue("fill-pattern",d),h=l.hasDataDrivenColor?
n:l.getPaintValue("fill-color",d),t=l.hasDataDrivenOpacity?1:l.getPaintValue("fill-opacity",d),q=t*h[3],r=void 0!==f||1>q||l.hasDataDrivenFill;if(!r||"opaque"!==e){this._color[0]=q*h[0];this._color[1]=q*h[1];this._color[2]=q*h[2];this._color[3]=q;var x;g===m.WGLDrawPhase.HITTEST&&(x=c.u32to4Xu8(k));g=l.getPaintValue("fill-translate",d);d=l.getPaintValue("fill-translate-anchor",d);this._drawFill(a,k,l,b,g,d,f,r,x);this._drawOutline(a,k,l,b,g,d,f,x,t)}};d.prototype._drawFill=function(a,c,b,d,g,e,l,
f,h){var p=a.context,n=a.displayLevel,v=a.drawPhase,t=a.renderPass,r=a.spriteMosaic,y=a.state;if(f||"translucent"!==t){f=void 0!==l;var t=a.pixelRatio>q.VTL_HIGH_RES_CUTOFF?2:1,u=b.hasDataDrivenFill;a=a.painter.getVectorTileProgramCach();var A,w=v===m.WGLDrawPhase.HITTEST,v=this._fillProgramOptions;v.id=w;v.dd=u;v.pattern=f;v=a.getProgram(1,(w?1:0)<<2|(u?1:0)<<1|(f?1:0),v);p.bindProgram(v);if(f){A=r.getMosaicItemPosition(l,!0);if(!A){p.bindProgram();return}v.setUniform2f("u_pattern_tl",A.tl[0],A.tl[1]);
v.setUniform2f("u_pattern_br",A.br[0],A.br[1]);v.setUniform1i("u_texture",q.VTL_TEXTURE_BINDING_UNIT_SPRITES);r.bind(p,9729,A.page,q.VTL_TEXTURE_BINDING_UNIT_SPRITES)}v.setUniformMatrix3fv("u_displayMat3",1===e?y.displayMat3:y.displayViewMat3);v.setUniform2fv("u_fillTranslation",g);v.setUniform1f("u_depth",b.z+k);v.setUniform4fv("u_color",this._color);w&&v.setUniform4f("u_id",h[0],h[1],h[2],h[3]);for(b=0;b<d.length;b++)if(g=d[b],g.layerData[c]&&(l=this._getFillVAO(p,g,u,a)))e=g.layerData[c],p.bindVAO(l),
v.setUniformMatrix3fv("u_dvsMat3",g.transforms.dvs),f&&(l=g.coordRange[0]/(t*g.size[0]*Math.max(Math.pow(2,Math.round(n)-g.key.level),1)),h=1/(A.size[1]*l),this._patternMatrix[0]=1/(A.size[0]*l),this._patternMatrix[4]=h,v.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)),p.setStencilFunction(514,g.stencilRef,255),p.drawElements(4,e.triangleElementCount,5125,12*e.triangleElementStart),g.triangleCount+=e.triangleElementCount/3}};d.prototype._drawOutline=function(a,c,b,d,g,e,l,f,h){var p=
a.context,v=a.displayLevel,t=a.drawPhase,q=a.pixelRatio,r=a.state;if("opaque"!==a.renderPass&&(l=void 0!==l,b.getPaintValue("fill-antialias",v)&&!l||b.hasDataDrivenOutlineColor)){a=a.painter.getVectorTileProgramCach();l=b.hasDataDrivenOutline;if(b.outlineUsesFillColor){if(1!==this._color[3])return;this._outlineColor[0]=this._color[0];this._outlineColor[1]=this._color[1];this._outlineColor[2]=this._color[2];this._outlineColor[3]=this._color[3]}else v=b.hasDataDrivenOutlineColor?n:b.getPaintValue("fill-outline-color",
v),h*=v[3],this._outlineColor[0]=h*v[0],this._outlineColor[1]=h*v[1],this._outlineColor[2]=h*v[2],this._outlineColor[3]=h;q=.75/q;h=t===m.WGLDrawPhase.HITTEST;t=this._outlineProgramOptions;t.id=h;t.dd=l;t=a.getProgram(2,(h?1:0)<<1|(l?1:0),t);p.bindProgram(t);t.setUniformMatrix3fv("u_displayMat3",1===e?r.displayMat3:r.displayViewMat3);t.setUniform2fv("u_fillTranslation",g);t.setUniform1f("u_depth",b.z+k);t.setUniform1f("u_outline_width",q);t.setUniform4fv("u_color",this._outlineColor);h&&t.setUniform4f("u_id",
f[0],f[1],f[2],f[3]);for(b=0;b<d.length;b++)if(g=d[b],g.layerData[c]&&(e=g.layerData[c],f=this._getOutlineVAO(p,g,l,a)))p.bindVAO(f),t.setUniformMatrix3fv("u_dvsMat3",g.transforms.dvs),p.setStencilFunction(514,g.stencilRef,255),p.drawElements(4,e.outlineElementCount,5125,12*e.outlineElementStart),g.triangleCount+=e.outlineElementCount/3}};d.prototype._getFillVAO=function(c,b,d,g){if(d){if(b.fillDDVertexArrayObject)return b.fillDDVertexArrayObject;d=b.fillDDVertexBuffer;var e=b.fillIndexBuffer;if(!d||
!e)return null;b.fillDDVertexArrayObject=new a.VertexArrayObject(c,g.getProgramAttributes(1),this._fillVertexAttributesDD,{geometry:d},e);return b.fillDDVertexArrayObject}if(b.fillVertexArrayObject)return b.fillVertexArrayObject;d=b.fillVertexBuffer;e=b.fillIndexBuffer;if(!d||!e)return null;b.fillVertexArrayObject=new a.VertexArrayObject(c,g.getProgramAttributes(1),this._fillVertexAttributes,{geometry:d},e);return b.fillVertexArrayObject};d.prototype._getOutlineVAO=function(c,b,d,g){if(d){if(b.outlineDDVertexArrayObject)return b.outlineDDVertexArrayObject;
d=b.outlineDDVertexBuffer;var e=b.outlineIndexBuffer;if(!d||!e)return null;b.outlineDDVertexArrayObject=new a.VertexArrayObject(c,g.getProgramAttributes(2),this._outlineVertexAttributesDD,{geometry:d},e);return b.outlineDDVertexArrayObject}if(b.outlineVertexArrayObject)return b.outlineVertexArrayObject;d=b.outlineVertexBuffer;e=b.outlineIndexBuffer;if(!d||!e)return null;b.outlineVertexArrayObject=new a.VertexArrayObject(c,g.getProgramAttributes(2),this._outlineVertexAttributes,{geometry:d},e);return b.outlineVertexArrayObject};
return d}(l.default);d.WGLBrushVTLFill=b})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLLine":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../definitions ../enums ../number ./WGLBrush".split(" "),function(b,d,f,h,e,a,q,m,c,l){Object.defineProperty(d,"__esModule",{value:!0});d.C_DEG_TO_RAD=Math.PI/180;var k=[1,1,1,1];b=function(b){function d(){var a=null!==
b&&b.apply(this,arguments)||this;a._color=e.vec4f32.create();a._dashArray=h.vec2f32.create();a._programOptions={id:!1,dd:!1,pattern:!1};a._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}]};a._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,
normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:20,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:20,normalized:!0,divisor:0},{name:"a_width",count:1,type:5126,offset:16,stride:20,normalized:!1,divisor:0}]};return a}f(d,b);d.prototype.dispose=function(){};d.prototype.drawMany=function(a,b){var d=a.context,g=a.displayLevel,e=a.state,l=a.drawPhase,
f=a.styleLayerId,h=a.styleLayer,n=a.painter.getVectorTileProgramCach(),r=h.getPaintValue("line-translate",g),x=h.getPaintValue("line-translate-anchor",g),C=h.getPaintValue("line-pattern",g),D=void 0!==C,G=1/a.pixelRatio,F=h.getPaintValue("line-blur",g),E=h.hasDataDrivenColor?k:h.getPaintValue("line-color",g),H=h.hasDataDrivenOpacity?1:h.getPaintValue("line-opacity",g),J=h.hasDataDrivenWidth?1:h.getPaintValue("line-width",g),H=H*E[3];this._color[0]=H*E[0];this._color[1]=H*E[1];this._color[2]=H*E[2];
this._color[3]=H;var E=h.hasDataDrivenLine,H=l===m.WGLDrawPhase.HITTEST,K;H&&(K=c.u32to4Xu8(f));l=this._programOptions;l.id=H;l.dd=E;l.pattern=D;l=n.getProgram(3,(H?1:0)<<2|(E?1:0)<<1|(D?1:0),l);d.bindProgram(l);l.setUniformMatrix3fv("u_displayViewMat3",e.displayViewMat3);l.setUniformMatrix3fv("u_displayMat3",1===x?e.displayMat3:e.displayViewMat3);l.setUniform2fv("u_lineTranslation",r);l.setUniform1f("u_depth",h.z);l.setUniform1f("u_blur",F);l.setUniform1f("u_antialiasing",G);l.setUniform4fv("u_color",
this._color);l.setUniform1f("u_width",J);H&&l.setUniform4f("u_id",K[0],K[1],K[2],K[3]);if(D){if(a=a.spriteMosaic,C=a.getMosaicItemPosition(C,!0))a.bind(d,9729,C.page,q.VTL_TEXTURE_BINDING_UNIT_SPRITES),l.setUniform2f("u_pattern_tl",C.tl[0],C.br[1]),l.setUniform2f("u_pattern_br",C.br[0],C.tl[1]),l.setUniform2f("u_spriteSize",8*C.size[0],C.size[1]),l.setUniform1i("u_texture",q.VTL_TEXTURE_BINDING_UNIT_SPRITES)}else C=h.getPaintValue("line-dasharray",g),2>C.length&&(C=[1,-1]),this._dashArray[0]=8*C[0],
this._dashArray[1]=8*C[1],l.setUniform2fv("u_dasharray",this._dashArray);for(C=0;C<b.length;C++)if(a=b[C],a.layerData[f]&&(g=a.layerData[f],e=this._getLineVAO(d,a,E,n)))d.bindVAO(e),l.setUniformMatrix3fv("u_dvsMat3",a.transforms.dvs),d.setStencilFunction(514,a.stencilRef,255),d.drawElements(4,g.triangleElementCount,5125,12*g.triangleElementStart),a.triangleCount+=g.triangleElementCount/3};d.prototype._getLineVAO=function(c,b,d,e){if(d){if(b.lineDDVertexArrayObject)return b.lineDDVertexArrayObject;
d=b.lineDDVertexBuffer;var g=b.lineIndexBuffer;if(!d||!g)return null;b.lineDDVertexArrayObject=new a.VertexArrayObject(c,e.getProgramAttributes(3),this._vertexAttributesDD,{geometry:d},g);return b.lineDDVertexArrayObject}if(b.lineVertexArrayObject)return b.lineVertexArrayObject;d=b.lineVertexBuffer;g=b.lineIndexBuffer;if(!d||!g)return null;b.lineVertexArrayObject=new a.VertexArrayObject(c,e.getProgramAttributes(3),this._vertexAttributes,{geometry:d},g);return b.lineVertexArrayObject};return d}(l.default);
d.WGLBrushVTLLine=b})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLSymbol":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../definitions ../enums ../GeometryUtils ../number ./WGLBrush".split(" "),function(b,d,f,h,e,a,q,m,c,l,k){Object.defineProperty(d,"__esModule",{value:!0});var n=1/65536,r=[1,1,1,1];b=function(b){function d(){var a=null!==b&&b.apply(this,
arguments)||this;a._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};a._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",
count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}]};a._iconProgramOptions={id:!1,dd:!1,sdf:!1};a._sdfProgramOptions={id:!1,dd:!1};a._spritesTextureSize=h.vec2f32.create();a._haloColor=
e.vec4f32.create();a._sdfColor=e.vec4f32.create();a._color=e.vec4f32.create();return a}f(d,b);d.prototype.dispose=function(){};d.prototype.drawMany=function(a,c){var b=a.drawPhase,d=a.styleLayerId,g=a.styleLayer,e=a.fadeRecorder.getFadeValues(),k;b===m.WGLDrawPhase.HITTEST&&(k=l.u32to4Xu8(d));this._drawIcons(a,g,c,e,k);this._drawText(a,g,c,e,k)};d.prototype._drawIcons=function(a,b,d,g,e){for(var k=this,l=a.context,f=a.displayLevel,h=a.drawPhase,p=a.painter,n=a.state,t=a.styleLayerId,y,u=!1,A=0;A<
d.length;A++){var x=d[A];if(x.layerData[t]&&(y=x.layerData[t],0<y.iconPerPageElementsMap.size)){u=!0;break}}if(u){var x=b.hasDataDrivenIconSize?1:b.getLayoutValue("icon-size",f),K=b.hasDataDrivenIconColor?r:b.getPaintValue("icon-color",f),I=b.hasDataDrivenIconOpacity?1:b.getPaintValue("icon-opacity",f),u=b.getPaintValue("icon-translate",f),A=b.getPaintValue("icon-translate-anchor",f),M=p.getVectorTileProgramCach(),p=K[3]*I;this._color[0]=p*K[0];this._color[1]=p*K[1];this._color[2]=p*K[2];this._color[3]=
p;p=b.getLayoutValue("icon-rotation-alignment",f);2===p&&(p=1===b.getLayoutValue("symbol-placement",f)?0:1);var K=y.isSDF,N=b.hasDataDrivenIcon,h=h===m.WGLDrawPhase.HITTEST,I=this._iconProgramOptions;I.id=h;I.dd=N;I.sdf=K;var L=M.getProgram(4,(h?1:0)<<2|(N?1:0)<<1|(K?1:0),I);l.bindProgram(L);K&&(K=b.getPaintValue("icon-halo-color",f),I=b.getPaintValue("icon-halo-width",f),L.setUniform4f("u_outlineColor",K[0],K[1],K[2],K[3]),L.setUniform1f("u_outlineSize",I));L.setUniformMatrix3fv("u_displayViewMat3",
0===p?n.displayViewMat3:n.displayMat3);L.setUniformMatrix3fv("u_displayMat3",1===A?n.displayMat3:n.displayViewMat3);L.setUniform2fv("u_iconTranslation",u);L.setUniform1f("u_depth",b.z);L.setUniform1f("u_mapRotation",c.degToByte(n.rotation));L.setUniform1f("u_keepUpright",0);L.setUniform1f("u_level",10*f);L.setUniform1f("u_fadeSpeed",10*g.fadeSpeed);L.setUniform1f("u_minfadeLevel",10*g.minfadeLevel);L.setUniform1f("u_maxfadeLevel",10*g.maxfadeLevel);L.setUniform1f("u_fadeChange",10*(f+g.fadeChange));
L.setUniform1i("u_texture",q.VTL_TEXTURE_BINDING_UNIT_SPRITES);L.setUniform1f("u_size",x);L.setUniform4fv("u_color",this._color);h&&L.setUniform4fv("u_id",e);b=function(c){if(!c.layerData[t])return"continue";y=c.layerData[t];if(0===y.iconPerPageElementsMap.size)return"continue";var b=Q._getIconVAO(l,c,N,M);if(!b)return"continue";l.bindVAO(b);L.setUniformMatrix3fv("u_dvsMat3",c.transforms.dvs);y.iconPerPageElementsMap.forEach(function(b,d){k._renderIconRange(a,L,b,d,c)})};var Q=this;for(g=0;g<d.length;g++)x=
d[g],b(x)}};d.prototype._renderIconRange=function(a,c,b,d,g){var e=a.context,k=a.hasClipping,l=a.requiredLevel;a=a.spriteMosaic;this._spritesTextureSize[0]=a.getWidth(d)/4;this._spritesTextureSize[1]=a.getHeight(d)/4;c.setUniform2fv("u_mosaicSize",this._spritesTextureSize);a.bind(e,9729,d,q.VTL_TEXTURE_BINDING_UNIT_SPRITES);c=!0;l!==g.key.level||k?e.setStencilFunction(514,g.stencilRef,255):c=!1;e.setStencilTestEnabled(c);e.drawElements(4,b[1],5125,12*b[0]);g.triangleCount+=b[1]/3};d.prototype._drawText=
function(a,b,d,g,e){for(var k=this,l=a.context,f=a.displayLevel,p=a.drawPhase,t=a.glyphMosaic,y=a.hasClipping,u=a.painter,A=a.pixelRatio,x=a.requiredLevel,H=a.state,J=a.styleLayerId,K,I=!1,M=0;M<d.length;M++)if(a=d[M],a.layerData[J]&&(K=a.layerData[J],0<K.glyphPerPageElementsMap.size)){I=!0;break}if(I){a=b.getLayoutValue("text-rotation-alignment",f);2===a&&(a=1===b.getLayoutValue("symbol-placement",f)?0:1);var I=0===a,I=b.getLayoutValue("text-keep-upright",f)&&I,p=p===m.WGLDrawPhase.HITTEST,A=.8*
3/A,M=b.hasDataDrivenTextSize?1:b.getLayoutValue("text-size",f),N=b.hasDataDrivenTextColor?r:b.getPaintValue("text-color",f),L=b.hasDataDrivenTextOpacity?1:b.getPaintValue("text-opacity",f),Q=b.getPaintValue("text-halo-color",f),P=b.getPaintValue("text-halo-width",f),U=3*b.getPaintValue("text-halo-blur",f),T=3*P,S=u.getVectorTileProgramCach(),u=N[3]*L;this._sdfColor[0]=u*N[0];this._sdfColor[1]=u*N[1];this._sdfColor[2]=u*N[2];this._sdfColor[3]=u;u=Q[3]*L;this._haloColor[0]=u*Q[0];this._haloColor[1]=
u*Q[1];this._haloColor[2]=u*Q[2];this._haloColor[3]=u;this._glyphTextureSize||(this._glyphTextureSize=h.vec2f32.fromValues(t.width/4,t.height/4));var u=b.getPaintValue("text-translate",f),N=b.getPaintValue("text-translate-anchor",f),R=b.hasDataDrivenText,L=this._sdfProgramOptions;L.id=p;L.dd=R;var O=S.getProgram(6,(p?1:0)<<1|(R?1:0),L);l.bindProgram(O);O.setUniformMatrix3fv("u_displayViewMat3",0===a?H.displayViewMat3:H.displayMat3);O.setUniformMatrix3fv("u_displayMat3",1===N?H.displayMat3:H.displayViewMat3);
O.setUniform2fv("u_textTranslation",u);O.setUniform1f("u_depth",b.z+n);O.setUniform2fv("u_mosaicSize",this._glyphTextureSize);O.setUniform1f("u_mapRotation",c.degToByte(H.rotation));O.setUniform1f("u_keepUpright",I?1:0);O.setUniform1f("u_level",10*f);O.setUniform1f("u_fadeSpeed",10*g.fadeSpeed);O.setUniform1f("u_minfadeLevel",10*g.minfadeLevel);O.setUniform1f("u_maxfadeLevel",10*g.maxfadeLevel);O.setUniform1f("u_fadeChange",10*(f+g.fadeChange));O.setUniform1i("u_texture",q.VTL_TEXTURE_BINDING_UNIT_GLYPHS);
O.setUniform1f("u_size",M);O.setUniform1f("u_antialiasingWidth",A);p&&O.setUniform4f("u_id",e[0],e[1],e[2],e[3]);b=function(a){if(!a.layerData[J])return"continue";K=a.layerData[J];if(0===K.glyphPerPageElementsMap.size)return"continue";var c=V._getSDFVAO(l,a,R,S);if(!c)return"continue";l.bindVAO(c);O.setUniformMatrix3fv("u_dvsMat3",a.transforms.dvs);c=!0;x!==a.key.level||y?l.setStencilFunction(514,a.stencilRef,255):c=!1;l.setStencilTestEnabled(c);K.glyphPerPageElementsMap.forEach(function(c,b){k._renderGlyphRange(l,
c,b,t,O,Q[3],P,U,T,a)})};var V=this;for(g=0;g<d.length;g++)a=d[g],b(a)}};d.prototype._renderGlyphRange=function(a,c,b,d,g,e,k,l,f,h){d.bind(a,9729,b,q.VTL_TEXTURE_BINDING_UNIT_GLYPHS);0<e&&0<k&&(g.setUniform4fv("u_color",this._haloColor),g.setUniform1f("u_halo",1),g.setUniform1f("u_edgeDistance",f),g.setUniform1f("u_edgeBlur",l),a.drawElements(4,c[1],5125,12*c[0]),h.triangleCount+=c[1]/3);0<this._sdfColor[3]&&(g.setUniform4fv("u_color",this._sdfColor),g.setUniform1f("u_halo",0),g.setUniform1f("u_edgeDistance",
0),g.setUniform1f("u_edgeBlur",0),a.drawElements(4,c[1],5125,12*c[0]),h.triangleCount+=c[1]/3)};d.prototype._getIconVAO=function(c,b,d,g){if(d){if(b.iconDDVertexArrayObject)return b.iconDDVertexArrayObject;d=b.iconDDVertexBuffer;var e=b.iconIndexBuffer;if(!d||!e)return null;b.iconDDVertexArrayObject=new a.VertexArrayObject(c,g.getProgramAttributes(4),this._vertexAttributesDD,{geometry:d},e);return b.iconDDVertexArrayObject}if(b.iconVertexArrayObject)return b.iconVertexArrayObject;d=b.iconVertexBuffer;
e=b.iconIndexBuffer;if(!d||!e)return null;b.iconVertexArrayObject=new a.VertexArrayObject(c,g.getProgramAttributes(4),this._vertexAttributes,{geometry:d},e);return b.iconVertexArrayObject};d.prototype._getSDFVAO=function(c,b,d,g){if(d){if(b.textDDVertexArrayObject)return b.textDDVertexArrayObject;d=b.textDDVertexBuffer;var e=b.textIndexBuffer;if(!d||!e)return null;b.textDDVertexArrayObject=new a.VertexArrayObject(c,g.getProgramAttributes(6),this._vertexAttributesDD,{geometry:d},e);return b.textDDVertexArrayObject}if(b.textVertexArrayObject)return b.textVertexArrayObject;
d=b.textVertexBuffer;e=b.textIndexBuffer;if(!d||!e)return null;b.textVertexArrayObject=new a.VertexArrayObject(c,g.getProgramAttributes(6),this._vertexAttributes,{geometry:d},e);return b.textVertexArrayObject};return d}(k.default);d.WGLBrushVTLSymbol=b})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrush":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../definitions ./WGLBrush".split(" "),function(b,d,f,h,e,a){Object.defineProperty(d,"__esModule",
{value:!0});b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);b.prototype.prepareState=function(a,b,d){a=a.context;d=d&&-1!==d.indexOf("id");a.setBlendingEnabled(!d);a.setBlendFunctionSeparate(1,771,1,771);a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!0);a.setStencilFunction(514,b.stencilRef,255)};b.prototype.draw=function(a,b,d){var c=this;if(b.isReady&&b.hasData){b.commitChanges();var e=this.getGeometryType(),g=b.getDisplayList(),k=
b.getGeometry(e);k&&g&&(a.timeline.begin(this.name),g.byType(e,function(g){c.drawGeometry(a,b,g,k,d)}),a.timeline.end(this.name))}};b.prototype._getVAO=function(a,b,d,e){e.vao||(e.vao=new h.VertexArrayObject(a,d,b,e.vertexBufferMap,e.indexBuffer));return e.vao};b.prototype._setSharedUniforms=function(a,b,d){a.setUniform1f("u_pixelRatio",b.pixelRatio);a.setUniformMatrix3fv("u_dvsMat3",d.transforms.dvs);a.setUniformMatrix3fv("u_displayViewMat3",b.state.displayViewMat3);a.setUniformMatrix4fv("u_insideEffectMat4",
b.rendererInfo.insideEffect);a.setUniformMatrix4fv("u_outsideEffectMat4",b.rendererInfo.outsideEffect);a.setUniform1fv("u_insideOpacities",b.rendererInfo.insideOpacities);a.setUniform1fv("u_outsideOpacities",b.rendererInfo.outsideOpacities);a.setUniform1i("u_attributeTextureSize",b.attributeView.size);a.setUniform1i("u_attributeData0",e.TEXTURE_BINDING_ATTRIBUTE_DATA_0);a.setUniform1i("u_attributeData1",e.TEXTURE_BINDING_ATTRIBUTE_DATA_1);a.setUniform1i("u_attributeData2",e.TEXTURE_BINDING_ATTRIBUTE_DATA_2);
a.setUniform1i("u_attributeData3",e.TEXTURE_BINDING_ATTRIBUTE_DATA_3)};return b}(a.default);d.default=b})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushFill":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/RandomLCG ../../../../webgl ../definitions ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(b,d,f,h,e,a,q,m,c,l,k){Object.defineProperty(d,"__esModule",{value:!0});
b=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a._dotTextureSize=0;a._dotTextures=null;a._dotSamplers=new Int32Array([q.TEXTURE_BINDING_RENDERER_0,q.TEXTURE_BINDING_RENDERER_1]);return a}f(d,b);d.prototype.dispose=function(){this._disposeTextures()};d.prototype.getGeometryType=function(){return m.WGLGeometryType.FILL};d.prototype.drawGeometry=function(a,b,d,e,l){var g=a.context,f=a.painter,h=a.rendererInfo,m=a.requiredLevel,n=d.indexCount,t=d.indexFrom;d=k.FillMaterialKey.load(d.materialKey);
var r=c.createProgramDescriptor(d.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121}].concat(d.dotDensity?[]:[{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_tlbr",count:4,type:5123},{location:4,name:"a_aux1",count:4,type:5121},{location:5,name:"a_aux2",count:2,type:5123},{location:6,name:"a_aux3",count:4,type:5121}],d.dotDensity?[{location:2,name:"a_inverseArea",count:1,type:5126}]:[])}),y=r.bufferLayouts,r=r.attributes;
l=f.materialManager.getMaterialProgram(a,d,"materials/fill",r,l);e=this._getVAO(g,y,r,e);g.bindProgram(l);g.bindVAO(e);this._setSharedUniforms(l,a,b);d.textureBinding&&(f.textureManager.bindTextures(g,l,d),f=1/Math.pow(2,m-b.key.level)/a.pixelRatio,l.setUniform1f("u_zoomFactor",f));d.vvColor&&(l.setUniform1fv("u_vvColorValues",h.vvColorValues),l.setUniform4fv("u_vvColors",h.vvColors));d.vvOpacity&&(l.setUniform1fv("u_vvOpacityValues",h.vvOpacityValues),l.setUniform1fv("u_vvOpacities",h.vvOpacities));
d.dotDensity&&(d=q.TILE_SIZE/h.ddDotSize,e=d*window.devicePixelRatio*d*window.devicePixelRatio,f=1/Math.pow(2,m-b.key.level),b=1/f*(1/f),a=h.ddDotScale?a.state.scale/h.ddDotScale:1,l.setUniform1f("u_tileZoomFactor",f),l.setUniform1f("u_tileDotsOverArea",e/(q.TILE_SIZE*window.devicePixelRatio*q.TILE_SIZE*window.devicePixelRatio)),l.setUniformMatrix4fv("u_dotColors",h.ddColors),l.setUniform4fv("u_isActive",h.ddActiveDots),l.setUniform4fv("u_dotBackgroundColor",h.ddBackgroundColor),l.setUniform1f("u_dotValue",
Math.max(1,h.ddDotValue*a*b)),this._bindDotDensityTextures(g,l,h,d));g.drawElements(4,n,5125,4*t);g.bindVAO(null)};d.prototype._disposeTextures=function(){if(this._dotTextures){for(var a=0;a<this._dotTextures.length;a++)this._dotTextures[a].dispose();this._dotTextures=null}};d.prototype._bindDotDensityTextures=function(a,b,c,d){c=this._createDotDensityTextures(a,d,c.ddSeed);b.setUniform1iv("u_dotTextures",this._dotSamplers);for(b=0;b<c.length;b++)a.bindTexture(c[b],this._dotSamplers[b])};d.prototype._createDotDensityTextures=
function(a,b,c){if(this._dotTextureSize!==b||this._seed!==c)this._disposeTextures(),this._dotTextureSize=b,this._seed=c;null===this._dotTextures&&(c=new e(c),this._dotTextures=[this._allocDotDensityTexture(a,b,c),this._allocDotDensityTexture(a,b,c)]);return this._dotTextures};d.prototype._allocDotDensityTexture=function(b,c,d){for(var g=new Float32Array(c*c*4),e=0;e<g.length;e++)g[e]=d.getFloat();return new a.Texture(b,{wrapMode:10497,pixelFormat:6408,dataType:5126,samplingMode:9728,width:c,height:c},
g)};return d}(l.default);d.default=b})},"esri/views/2d/engine/webgl/materialKey/MaterialKey":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../renderers ../../../../../core/Error ../../../../../core/maybe ../enums ../mesh/templates/WGLLabelTemplate ../util/vvFlagUtils".split(" "),function(b,d,f,h,e,a,q,m,c,l){Object.defineProperty(d,"__esModule",{value:!0});d.createMaterialKey=function(a,b,c,d){if(q.isSome(b)){a:{if("heatmap"===
b.type)throw Error("Symbol processor does not support heatmap renderer");switch(a){case m.WGLGeometryType.FILL:a=g.from(b);break a;case m.WGLGeometryType.LINE:a=t.from(b,c);break a;case m.WGLGeometryType.MARKER:if("dot-density"===b.type)throw Error("Dot Density renderer does not support Marker GeometryTypes");a=x.from(b);break a;case m.WGLGeometryType.TEXT:a=u.from(b);break a;case m.WGLGeometryType.LABEL:a=y.from(b,d);break a;default:throw Error("Unable to createMaterialKey for unknown geometryType "+
a);}}return a}switch(a){case m.WGLGeometryType.FILL:return g.from(null);case m.WGLGeometryType.LINE:return t.from(null,c);case m.WGLGeometryType.MARKER:return x.from(null);case m.WGLGeometryType.TEXT:return u.from(null);case m.WGLGeometryType.LABEL:return y.from(null,d);default:throw Error("Unable to createMaterialKey for unknown geometryType "+a);}};b=function(){function b(a){this._data=0;this._data=a}b.load=function(a){var b=this.shared;b.data=a;return b};Object.defineProperty(b.prototype,"data",
{get:function(){return this._data},set:function(a){this._data=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"geometryType",{get:function(){return this.bits(8,11)},set:function(a){this.setBits(a,8,11)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"mapAligned",{get:function(){return!!this.bit(20)},set:function(a){this.setBit(20,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sdf",{get:function(){return!!this.bit(11)},set:function(a){this.setBit(11,
a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"pattern",{get:function(){return!!this.bit(12)},set:function(a){this.setBit(12,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureBinding",{get:function(){return this.bits(0,8)},set:function(a){this.setBits(a,0,8)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"geometryTypeString",{get:function(){switch(this.geometryType){case m.WGLGeometryType.FILL:return"fill";case m.WGLGeometryType.MARKER:return"marker";
case m.WGLGeometryType.LINE:return"line";case m.WGLGeometryType.TEXT:return"text";case m.WGLGeometryType.LABEL:return"label";default:throw new a("Unable to handle unknown geometryType: "+this.geometryType);}},enumerable:!0,configurable:!0});b.prototype.setBit=function(a,b){a=1<<a;this._data=b?this._data|a:this._data&~a};b.prototype.bit=function(a){return(this._data&1<<a)>>a};b.prototype.setBits=function(a,b,c){for(var d=0;b<c;b++,d++)this.setBit(b,0!==(a&1<<d))};b.prototype.bits=function(a,b){for(var c=
0,d=0;a<b;a++,d++)c|=this.bit(a)<<d;return c};b.prototype.hasVV=function(){return!1};b.prototype.setVV=function(a,b){};b.prototype.getVariation=function(){var a={},b;for(b in this)"boolean"===typeof this[b]&&(a[b]=this[b]);return a};b.prototype.getVariationHash=function(){return this._data&~(7&this.textureBinding)};b.shared=new b(0);return b}();d.MaterialKeyBase=b;h=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);Object.defineProperty(b.prototype,
"vvSizeMinMaxValue",{get:function(){return 0!==this.bit(16)},set:function(a){this.setBit(16,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeScaleStops",{get:function(){return 0!==this.bit(17)},set:function(a){this.setBit(17,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeFieldStops",{get:function(){return 0!==this.bit(18)},set:function(a){this.setBit(18,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeUnitValue",
{get:function(){return 0!==this.bit(19)},set:function(a){this.setBit(19,a)},enumerable:!0,configurable:!0});b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue};b.prototype.setVV=function(b,c){a.prototype.setVV.call(this,b,c);b&=l.getSizeFlagsMask(b,c);this.vvSizeMinMaxValue=!!(b&m.WGLVVFlag.SIZE_MINMAX_VALUE);this.vvSizeFieldStops=!!(b&m.WGLVVFlag.SIZE_FIELD_STOPS);this.vvSizeUnitValue=!!(b&m.WGLVVFlag.SIZE_UNIT_VALUE);
this.vvSizeScaleStops=!!(b&m.WGLVVFlag.SIZE_SCALE_STOPS)};return b}(a)};var k=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);Object.defineProperty(b.prototype,"vvRotation",{get:function(){return 0!==this.bit(15)},set:function(a){this.setBit(15,a)},enumerable:!0,configurable:!0});b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvRotation};b.prototype.setVV=function(b,c){a.prototype.setVV.call(this,b,c);this.vvRotation=!c&&!!(b&
m.WGLVVFlag.ROTATION)};return b}(a)},n=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);Object.defineProperty(b.prototype,"vvColor",{get:function(){return 0!==this.bit(13)},set:function(a){this.setBit(13,a)},enumerable:!0,configurable:!0});b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvColor};b.prototype.setVV=function(b,c){a.prototype.setVV.call(this,b,c);this.vvColor=!c&&!!(b&m.WGLVVFlag.COLOR)};return b}(a)},r=function(a){return function(a){function b(){return null!==
a&&a.apply(this,arguments)||this}f(b,a);Object.defineProperty(b.prototype,"vvOpacity",{get:function(){return 0!==this.bit(14)},set:function(a){this.setBit(14,a)},enumerable:!0,configurable:!0});b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvOpacity};b.prototype.setVV=function(b,c){a.prototype.setVV.call(this,b,c);this.vvOpacity=!c&&!!(b&m.WGLVVFlag.OPACITY)};return b}(a)},g=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);b.load=function(a){var b=
this.shared;b.data=a;return b};b.from=function(a){var b=this.load(0);b.geometryType=m.WGLGeometryType.FILL;q.isSome(a)&&(a instanceof e.DotDensityRenderer?b.dotDensity=!0:(a=l.getVVFlags(a.visualVariables),b.setVV(a,!1)));return b.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};Object.defineProperty(b.prototype,"dotDensity",{get:function(){return!!this.bit(15)},set:function(a){this.setBit(15,a)},enumerable:!0,configurable:!0});b.shared=new b(0);return b}(n(r(b)));
d.FillMaterialKey=g;var x=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a){var b=this.load(0);b.geometryType=m.WGLGeometryType.MARKER;q.isSome(a)&&(a=l.getVVFlags(a.visualVariables),b.setVV(a,!1));return b.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(n(r(k(h(b)))));d.MarkerMaterialKey=x;var t=function(a){function b(){return null!==
a&&a.apply(this,arguments)||this}f(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a,b){var c=this.load(0);c.geometryType=m.WGLGeometryType.LINE;q.isSome(a)&&(a=l.getVVFlags(a.visualVariables),c.setVV(a,b));return c.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(n(r(h(b))));d.LineMaterialKey=t;var u=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);b.load=function(a){var b=
this.shared;b.data=a;return b};b.from=function(a){var b=this.load(0);b.geometryType=m.WGLGeometryType.TEXT;q.isSome(a)&&(a=l.getVVFlags(a.visualVariables),b.setVV(a,!1));return b.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(n(r(k(h(b)))));d.TextMaterialKey=u;var y=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a,b){var d=this.load(0);
d.geometryType=m.WGLGeometryType.LABEL;q.isSome(a)&&(a=l.getVVFlags(a.visualVariables),d.setVV(a,!1));d.mapAligned=!!c.isMapAligned(b.labelPlacement);return d.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(h(b));d.LabelMaterialKey=y})},"esri/views/2d/engine/webgl/mesh/templates/WGLLabelTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/mathUtils ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../engine ../../color ../../definitions ../../enums ../../number ../../WGLDisplayRecord ../../collisions/Metric ../../materialKey/MaterialKey ./segmentUtils ./WGLTextTemplate".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,x,t,u,y,A){Object.defineProperty(d,"__esModule",{value:!0});var p=e.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate");d.isMapAligned=function(a){switch(a){case "above-along":case "below-along":case "center-along":return 1;default:return 0}};var w=function(a){var b=new Map;return function(c){b.has(c)||b.set(c,a(c));return b.get(c)}}(function(a){var b=0;if(0===a)return Infinity;for(;!(a%2);)b++,a/=2;return b}),v=function(a,b){return g.i1616to32(2*Math.round(8*
a),2*Math.round(8*b))};b=function(b){function d(d,g,e,f){var h=b.call(this,d,e.font.size,e.haloSize||0,e.color&&k.premultiplyAlphaRGBA(e.color)||0,e.haloColor&&k.premultiplyAlphaRGBA(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.id,e.lineWidth,e.lineHeight)||this;h._outLineLabelAngle=0;h._refPlacementPadding=0;h._refPlacementDirX=0;h._refPlacementDirY=0;h.geometryType=r.WGLGeometryType.LABEL;var m;m=!!g.minScale&&f.scaleToZoom(g.minScale)||
0;m=a.clamp(m,0,25.5);f=!!g.maxScale&&f.scaleToZoom(g.maxScale)||255;f=a.clamp(f,0,25.5);var p=l.alignmentUtils.getAlignmentFromPlacement(g.labelPlacement),v=p[1];h._xAlignD=p[0];h._yAlignD=v;h._minZoom=m;h._maxZoom=f;h._refPlacementPadding=c.pt2px(e.haloSize)+n.TEXT_PLACEMENT_PADDING;d=u.LabelMaterialKey.load(u.createMaterialKey(h.geometryType,d,!1,g));d.sdf=!0;h._materialKey=d.data;return h}f(d,b);d.fromLabelClass=function(a,b,c){if("center-along"===b.labelPlacement){var g=b.symbol;g.xoffset=0;
g.yoffset=0;g.angle=0;g.font.decoration="none"}return new d(a,b,b.symbol,c)};Object.defineProperty(d.prototype,"_shapedBox",{get:function(){return m.unwrap(this._shapingInfo).bounds},enumerable:!0,configurable:!0});d.prototype.bindReferenceTemplate=function(a){var b=l.alignmentUtils.getXDirection(this._xAlignD),c=l.alignmentUtils.getYDirection(this._yAlignD);if(m.isNone(a))this._refSymbolAndPlacementOffset=g.i8888to32(0,0,Math.floor(127*b+127),Math.floor(127*c+127));else{if("circle"===a.boundsType&&
(b||c))var d=Math.sqrt(b*b+c*c),b=b/d,c=c/d;a=Math.max(a.height,a.width)+Math.max(a.xOffset,a.yOffset);this._refSymbolAndPlacementOffset=g.i8888to32(4*this._refPlacementPadding,a,Math.floor(127*b+127),Math.floor(127*c+127));this._referenceSize=a;this._refPlacementDirX=b;this._refPlacementDirY=c}};d.prototype.writeMesh=function(a,b,c,d,g,e,k){if(!m.isNone(this._shapingInfo))switch(this.current={outRecords:a,outVecs:b,outMetrics:k,inId:d,inShaping:this._shapingInfo,zoomLevel:e},c){case "esriGeometryPolyline":return this._placeLineLabels(g.geometry);
case "esriGeometryPoint":return this._placePointLabels(g.geometry);case "esriGeometryPolygon":return this._placePointLabels(g.centroid);default:a="Geometry of type "+c+" is not supported",void 0===a&&(a="mapview-labeling"),p.error(new h(a,"mapview-labeling"))}};d.prototype._isVisible=function(a,b){var c=Math.floor(10*this.current.zoomLevel);return Math.floor(10*a)<=c&&c<=Math.floor(10*b)};d.prototype._placePointLabels=function(a){var b=this.current;this._writeGlyphs(b.outRecords,b.outVecs,b.inId,
a,b.outMetrics)};d.prototype._placeLineLabels=function(a){a=y.smoothPaths(a.paths,this.current.inShaping.bounds.width);for(var b=this._placeSubdivGlyphs.bind(this),c=(this._shapedBox.width+128)/4,d=0;d<a.length;d++)y.pathDivide(a[d],c,b)};d.prototype._placeSubdivGlyphs=function(a,b,c,d){var g=w(b);c=q.log2(Math.min(c,d-c)/(4+this._shapedBox.width/4/2));g=Math.max(this._minZoom,this.current.zoomLevel+2-(0===b?c:Math.min(g,c)));c=this._shapedBox.width/2*Math.pow(2,this.current.zoomLevel-g);this.current.inShaping.isMultiline?
0===b&&this._placeStraight(a,g):this._placeCurved(a,g,c)};d.prototype._placeStraight=function(a,b){var c=this.current;this._writeGlyphs(c.outRecords,c.outVecs,c.inId,a,c.outMetrics,b)};d.prototype._placeCurved=function(a,b,c){var d=new t.default(this.current.inId,{from:this.current.outRecords.length,count:-1},a.x,a.y,b),g=a.clone(),e=(180/Math.PI*a.angle+180)%360;this._outLineLabelAngle=Math.round(180/Math.PI*a.angle%360*(254/360));this._placeFirst(g,d,b,1);this._placeBack(a,g,d,b,c,1);this._placeForward(a,
g,d,b,c,1);this._outLineLabelAngle=Math.round(254/360*e);this._placeFirst(g,d,b,0);this._placeBack(a,g,d,b,c,0);this._placeForward(a,g,d,b,c,0);d.range.count=this.current.outRecords.length-d.range.from;d.bounds&&this.current.outMetrics.push(d)};d.prototype._placeBack=function(a,b,c,d,g,e){var k=a.clone();for(a=a.backwardLength+0;k.prev()&&!(a>=g);)this._placeOnSegment(k,b,c,a,d,-1,e),a+=k.length+0};d.prototype._placeForward=function(a,b,c,d,g,e){var k=a.clone();for(a=a.remainingLength+0;k.next()&&
!(a>=g);)this._placeOnSegment(k,b,c,a,d,1,e),a+=k.length+0};d.prototype._placeFirst=function(a,b,c,d){for(var g=this.current.inShaping,e=g.glyphs,k=this.current.zoomLevel,l=this.current,f=l.outRecords,h=l.outVecs,l=l.inId,m=v(a.x,a.y),n=0;n<e.length;n++){var p=e[n],r=p.x>g.bounds.x?d:1-d,r=Math.max(0,k+q.log2(Math.abs(p.x+p.width/2-g.bounds.x)/(r*a.remainingLength+(1-r)*a.backwardLength+0))),r=Math.max(c,r);p.maxZoom=25;p.angle=a.angle+(1-d)*Math.PI;p.minZoom=r;this._writeGlyph(f,h,p,l,m);d&&this._isVisible(p.minZoom,
p.maxZoom)&&b.add(p.bounds,0,0)}};d.prototype._placeOnSegment=function(a,b,c,d,g,e,k){for(var l=this.current.inShaping.glyphs,f=this.current,h=f.outRecords,m=f.outVecs,f=f.inId,n=this.current.inShaping,p=this.current.zoomLevel,r=v(a.x+a.dx/a.length*-e*d,a.y+a.dy/a.length*-e*d),t=0;t<l.length;t++){var y=l[t],u=y.x>n.bounds.x?k:1-k;if(u&&1===e||!u&&-1===e){var x=Math.abs(y.x+y.width/2-n.bounds.x),u=Math.max(0,p+q.log2(x/d)-.1),x=Math.max(g,p+q.log2(x/(d+a.length+0)));0!==u&&(y.angle=a.angle+(1-k)*Math.PI,
y.minZoom=x,y.maxZoom=u,this._writeGlyph(h,m,y,f,r),k&&this._isVisible(y.minZoom,y.maxZoom)&&c.add(y.bounds,a.x-b.x,a.y-b.y))}}};d.prototype._writeGlyphs=function(a,b,c,d,g,e){void 0===e&&(e=this._minZoom);var k=this._shapingInfo;if(!(m.isNone(k)||0>d.x||512<=d.x||0>d.y||512<=d.y)){var l=v(d.x,d.y);d=new t.default(c,{from:a.length,count:-1},d.x,d.y,e);for(var f=0,h=k.glyphs;f<h.length;f++){var n=h[f];n.minZoom=e;n.maxZoom=this._maxZoom;this._writeGlyph(a,b,n,c,l)}d.range.count=a.length-d.range.from;
d.bounds=k.boundsT;a=u.LabelMaterialKey.load(this._materialKey);d.setPlacementOffset(a.vvSizeFieldStops||a.vvSizeMinMaxValue||a.vvSizeScaleStops||a.vvSizeUnitValue,this._referenceSize,this._refPlacementPadding,this._refPlacementDirX,this._refPlacementDirY);g.push(d)}};d.prototype._writeGlyph=function(a,b,c,d,g){var e=u.MaterialKeyBase.load(this._materialKey),k=new x(d,this.geometryType,e.data,0,0);e.textureBinding=c.textureBinding;k.materialKey=e.data;k.indexFrom=b.indexVector.length;k.indexCount=
this._writeIndices(b);k.vertexFrom=b.getVector("geometry").vertexCount;k.vertexCount=this._writeVertex(b,d,g,c);a.push(k)};d.prototype._writeVertexCommon=function(a,b,c,d){var e=this._color,k=this._haloColor,l=g.i8888to32(0,0,this._size,this._haloSize);d=g.i8888to32(Math.floor(10*Math.max(d.minZoom,this._minZoom)),Math.floor(10*Math.min(d.maxZoom,this._maxZoom)),this._outLineLabelAngle,0);a.push(c);a.push(b);a.push(e);a.push(k);a.push(l);a.push(this._refSymbolAndPlacementOffset);a.push(d)};return d}(A.default);
d.default=b})},"esri/views/2d/engine/webgl/WGLDisplayRecord":function(){define(["require","exports","./MeshData","./Utils"],function(b,d,f,h){return function(){function b(a,b,d,c,e){void 0===c&&(c=0);void 0===e&&(e=0);this.id=a;this.geometryType=b;this.materialKey=d;this.minZoom=c;this.maxZoom=e;this.meshData=null;this.indexCount=this.indexFrom=this.vertexCount=this.vertexFrom=this.zOrder=this.symbolLevel=0}Object.defineProperty(b.prototype,"sortKey",{get:function(){void 0===this._sortKey&&this._computeSortKey();
return this._sortKey},enumerable:!0,configurable:!0});b.prototype.clone=function(){return this.copy()};b.prototype.copy=function(){var a=new b(this.id,this.geometryType,this.materialKey);a.vertexFrom=this.vertexFrom;a.vertexCount=this.vertexCount;a.indexFrom=this.indexFrom;a.indexCount=this.indexCount;a.zOrder=this.zOrder;a.symbolLevel=this.symbolLevel;a.meshData=this.meshData;a.minZoom=this.minZoom;a.maxZoom=this.maxZoom;return a};b.prototype.setMeshDataFromBuffers=function(a,b,d){var c=new f,e;
for(e in b){for(var k=b[e].stride,m=b[e].data,q=[],g=h.strideToPackingFactor(k),x=0;x<k*a.vertexCount/g;++x)q[x]=m[x+k*a.vertexFrom/g];c.vertexData.set(e,q)}for(x=c.indexData.length=0;x<a.indexCount;++x)c.indexData[x]=d[x+a.indexFrom]-a.vertexFrom;c.vertexCount=a.vertexCount;this.meshData=c};b.prototype.readMeshDataFromBuffers=function(a,b){this.meshData?this.meshData.clear():this.meshData=new f;for(var d in a){for(var c=a[d].stride,e=a[d].data,k=[],n=h.strideToPackingFactor(c),q=0;q<c*this.vertexCount/
n;++q)k[q]=e[q+c*this.vertexFrom/n];this.meshData.vertexData.set(d,k)}for(q=this.meshData.indexData.length=0;q<this.indexCount;++q)this.meshData.indexData[q]=b[q+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount};b.prototype.writeMeshDataToBuffers=function(a,b,d,c){for(var e in b)for(var k=b[e].stride,f=this.meshData.vertexData.get(e),m=b[e].data,g=h.strideToPackingFactor(k),q=0;q<k*this.meshData.vertexCount/g;++q)m[q+k*a/g]=f[q];for(q=0;q<this.meshData.indexData.length;++q)c[q+
d]=this.meshData.indexData[q]+a;this.vertexFrom=a;this.vertexCount=this.meshData.vertexCount;this.indexFrom=d;this.indexCount=this.meshData.indexData.length};b.writeAllMeshDataToBuffers=function(a,b,d){for(var c=0,e=0,k=0;k<a.length;k++){var f=a[k];f.writeMeshDataToBuffers(c,b,e,d);c+=f.vertexCount;e+=f.indexCount}};b.prototype._computeSortKey=function(){this._sortKey=(this.symbolLevel&31)<<12|(this.zOrder&127)<<4|this.geometryType&7};b.prototype.serialize=function(a){a.push(this.geometryType);a.push(this.materialKey);
a.push(this.symbolLevel);a.push(this.zOrder);a.push(this.vertexFrom);a.push(this.vertexCount);a.push(this.indexFrom);a.push(this.indexCount);a.push(this.minZoom);a.push(this.maxZoom);return a};b.deserialize=function(a,d){var e=a.readInt32(),c=a.readInt32();d=new b(d.id,e,c);d.symbolLevel=a.readInt32();d.zOrder=a.readInt32();d.vertexFrom=a.readInt32();d.vertexCount=a.readInt32();d.indexFrom=a.readInt32();d.indexCount=a.readInt32();d.minZoom=a.readInt32();d.maxZoom=a.readInt32();return d};return b}()})},
"esri/views/2d/engine/webgl/MeshData":function(){define(["require","exports"],function(b,d){return function(){function b(){this.vertexData=new Map;this.vertexCount=0;this.indexData=[]}b.prototype.clear=function(){this.vertexData.clear();this.vertexCount=0;this.indexData=[]};b.prototype.update=function(b,d,a){for(var e in b)this.vertexData.set(e,b[e]);for(e in this.vertexData)null===b[e]&&this.vertexData.delete(e);this.vertexCount=d;this.indexData=a};return b}()})},"esri/views/2d/engine/webgl/collisions/Metric":function(){define("require exports ../../../../../core/Logger ../../../../../core/libs/gl-matrix-2/vec2f32 ../definitions ./BoundingBox ../util/serializationUtils".split(" "),
function(b,d,f,h,e,a,q){Object.defineProperty(d,"__esModule",{value:!0});var m=f.getLogger("esri/views/2d/engine/webgl/collisions/Metric");b=function(){function b(a,b,c,d,g){this.id=a;this.range=b;this.boxes=null;this.minZoom=-1;this.placementPadding=this.offsetY=this.offsetX=this.directionY=this.directionX=this.size=0;this.anchor=h.vec2f32.fromValues(c,d);this.baseZoom=g}b.prototype.add=function(a,b,c){a.x+=b;a.y+=c;this.bounds?(this.boxes?this.boxes.push(a):(this.boxes=[this.bounds,a],this.bounds=
this.bounds.clone()),this.bounds.extend(a)):this.bounds=a};b.prototype.computeIndex=function(){var a=Math.floor(this.anchor[1]/e.COLLISION_BUCKET_SIZE);this.xBucket=Math.floor(this.anchor[0]/e.COLLISION_BUCKET_SIZE);this.yBucket=a;a=e.TILE_SIZE/e.COLLISION_BUCKET_SIZE;this.hasVV?this.yOverflow=this.xOverflow=a:(this.xOverflow=Math.min(a,Math.ceil(2*this.bounds.width/e.COLLISION_BUCKET_SIZE)),this.yOverflow=Math.min(a,Math.ceil(2*this.bounds.height/e.COLLISION_BUCKET_SIZE)))};b.prototype.findCollisionDelta=
function(a){var b=this.bounds.findCollisionDelta(a.bounds),c=this.boxes&&this.boxes.length,d=a.boxes&&a.boxes.length;return Math.abs(b)>e.COLLISION_MAX_ZOOM_DELTA||!c&&!d?b:c&&d?this._boxesToBoxes(a):c?this._boxesToBox(a):this._boxToBoxes(a)};b.prototype.computeVVOffset=function(a,b){b||m.error("mapview-labeling","Unable to compute label offset. Expected an evaluator function but found "+b);var c=this.size;this.hasVV&&(a=b(a),c=isNaN(a)||null==a||Infinity===a?this.size:a);this._computeOffset(c)};
b.prototype.setPlacementOffset=function(a,b,c,d,g){this.hasVV=a;this.size=b;this.placementPadding=Math.round(c);this.directionX=d;this.directionY=g};b.prototype.clone=function(){var a=new b(this.id,this.range,this.anchor[0],this.anchor[1],this.baseZoom);a.minZoom=this.minZoom;this.bounds&&(a.bounds=this.bounds.clone());this.boxes&&(a.boxes=this.boxes.map(function(a){return a.clone()}));a.xBucket=this.xBucket;a.yBucket=this.yBucket;a.xOverflow=this.xOverflow;a.yOverflow=this.yOverflow;a.hasVV=this.hasVV;
a.size=this.size;a.directionX=this.directionX;a.directionY=this.directionY;a.offsetX=this.offsetX;a.offsetY=this.offsetY;return a};b.prototype._boxToBoxes=function(a){var b=-Infinity,c=0;for(a=a.boxes;c<a.length;c++)var d=this.bounds.findCollisionDelta(a[c]),b=Math.max(d,b);return b};b.prototype._boxesToBox=function(a){for(var b=this.boxes[0].findCollisionDelta(a.bounds),c=1;c<this.boxes.length;c++)var d=this.boxes[c].findCollisionDelta(a.bounds),b=Math.max(d,b);return b};b.prototype._boxesToBoxes=
function(a){for(var b=-Infinity,c=0;c<this.boxes.length;c++)for(var d=this.boxes[c],g=0,e=a.boxes;g<e.length;g++)var f=d.findCollisionDelta(e[g]),b=Math.max(f,b);return b};b.prototype._computeOffset=function(a){this.offsetX=this.directionX*(a/2+this.placementPadding);this.offsetY=this.directionY*(a/2+this.placementPadding)};b.prototype.serialize=function(a){a.push(this.id);this.bounds.serialize(a);a.push(this.range.from);a.push(this.range.count);a.push(this.anchor[0]);a.push(this.anchor[1]);a.push(this.baseZoom);
a.push(this.hasVV?1:0);a.push(this.size);a.writeF32(this.directionX);a.writeF32(this.directionY);a.push(this.offsetX);a.push(this.offsetY);a.push(this.placementPadding);q.serializeList(a,this.boxes);return a};b.deserialize=function(c){var d=c.readInt32(),e=a.default.deserialize(c),f=c.readInt32(),g=c.readInt32(),l={from:f,count:g},h=c.readInt32(),m=c.readInt32(),y=c.readInt32(),f=c.readInt32(),g=c.readInt32(),A=c.readF32(),p=c.readF32(),w=c.readInt32(),v=c.readInt32(),z=c.readInt32();c=q.deserializeList(c,
a.default);d=new b(d,l,h,m,y);d.bounds=e;d.boxes=c;d.setPlacementOffset(!!f,g,z,A,p);d.offsetX=w;d.offsetY=v;d.computeIndex();f||d._computeOffset(g);return d};return b}();d.default=b})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["require","exports","../../../../../core/mathUtils","../../../../../core/libs/gl-matrix-2/vec2f32"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(a,b,d,c){this.center=h.vec2f32.fromValues(a,b);this.centerT=
h.vec2f32.create();this.halfWidth=d/2;this.halfHeight=c/2;this.width=d;this.height=c}Object.defineProperty(b.prototype,"x",{get:function(){return this.center[0]},set:function(a){this.center[0]=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"y",{get:function(){return this.center[1]},set:function(a){this.center[1]=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"blX",{get:function(){return this.center[0]+this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"blY",{get:function(){return this.center[1]+this.halfHeight},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"trX",{get:function(){return this.center[0]-this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"trY",{get:function(){return this.center[1]-this.halfHeight},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"xmin",{get:function(){return this.x-this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"xmax",
{get:function(){return this.x+this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"ymin",{get:function(){return this.y-this.halfHeight},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"ymax",{get:function(){return this.y+this.halfHeight},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new b(this.x,this.y,this.width,this.height)};b.prototype.serialize=function(a){a.writeF32(this.center[0]);a.writeF32(this.center[1]);a.push(this.width);
a.push(this.height);return a};b.prototype.findCollisionDelta=function(a,b){void 0===b&&(b=4);return f.log2(Math.min((a.halfWidth+this.halfWidth+b)/Math.abs(a.centerT[0]-this.centerT[0]),(a.halfHeight+this.halfHeight+b)/Math.abs(a.centerT[1]-this.centerT[1])))};b.prototype.extend=function(a){var b=Math.min(this.xmin,a.xmin),d=Math.min(this.ymin,a.ymin),c=Math.max(this.xmax,a.xmax)-b;a=Math.max(this.ymax,a.ymax)-d;this.width=c;this.height=a;this.halfWidth=c/2;this.halfHeight=a/2;this.x=b+c/2;this.y=
d+a/2};b.deserialize=function(a){var d=a.readF32(),e=a.readF32(),c=a.readInt32();a=a.readInt32();return new b(d,e,c,a)};return b}();d.default=b})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["require","exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});d.serializeList=function(b,d){if(null===d)b.push(0);else{b.push(d.length);for(var e=0;e<d.length;e++)d[e].serialize(b);return b}};d.deserializeList=function(b,d,e){for(var a=b.readInt32(),a=Array(a),
f=0;f<a.length;f++)a[f]=d.deserialize(b,e);return a}})},"esri/views/2d/engine/webgl/mesh/templates/segmentUtils":function(){define(["require","exports","../../../../../../core/maybe","./util"],function(b,d,f,h){function e(a){return a.length-1}function a(a){for(var b=0,c=0;c<e(a);c++)b+=q(a,c);return b}function q(a,b,c){void 0===c&&(c=1);b=a[b+1];a=b[0];b=b[1];return Math.sqrt(a*a+b*b)*c}function m(a,b,c,d,g){if(!(c<b)){var e=d.clone().seek(c/2);f.isNone(e)||(a(e.clone(),c,g),c=(c-b)/2,e=f.expect(e.seek(b/
2)),m(a,b,c,d,g+1),m(a,b,c,e,g+1))}}Object.defineProperty(d,"__esModule",{value:!0});d.segmentAt=function(a,b){return a[b+1]};d.segmentCount=e;d.pathLength=a;d.segmentLength=q;var c=function(){function a(a,b,c,d,e){this._segments=a;this._index=b;this._distance=c;this._xStart=d;this._yStart=e;this._done=!1}a.create=function(b){return new a(b,0,0,b[0][0],b[0][1])};a.prototype.clone=function(){return new a(this._segments,this._index,this._distance,this.xStart,this.yStart)};a.prototype.equals=function(a){return this._index===
a._index||a._index===this._index-1&&(0===this._distance||1===a._distance)||a._index===this._index+1&&(1===this._distance||0===a._distance)};a.prototype.leq=function(a){return this._index<a._index||this._index===a._index&&this._distance<=a._distance};a.prototype.geq=function(a){return this._index>a._index||this._index===a._index&&this._distance>=a._distance};Object.defineProperty(a.prototype,"_segment",{get:function(){return this._segments[this._index+1]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"angle",{get:function(){var a=this.dy,b=Math.acos((0*a+-1*-this.dx)/(1*this.length));0<a&&(b=2*Math.PI-b);return b},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"xStart",{get:function(){return this._xStart},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yStart",{get:function(){return this._yStart},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"x",{get:function(){return this.xStart+this.distance*this.dx},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"y",{get:function(){return this.yStart+this.distance*this.dy},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"dx",{get:function(){return this._segment[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"dy",{get:function(){return this._segment[1]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"xMidpoint",{get:function(){return this.xStart+.5*this.dx},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yMidpoint",{get:function(){return this.yStart+
.5*this.dy},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"xEnd",{get:function(){return this.xStart+this.dx},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yEnd",{get:function(){return this.yStart+this.dy},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"length",{get:function(){var a=this.dx,b=this.dy;return Math.sqrt(a*a+b*b)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"remainingLength",{get:function(){return this.length*
(1-this._distance)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"backwardLength",{get:function(){return this.length*this._distance},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"done",{get:function(){return this._done},enumerable:!0,configurable:!0});a.prototype.hasPrev=function(){return 0<=this._index-1};a.prototype.hasNext=function(){return this._index+
1<e(this._segments)};a.prototype.next=function(){if(!this.hasNext())return null;this._xStart+=this.dx;this._yStart+=this.dy;this._distance=0;this._index+=1;return this};a.prototype.prev=function(){if(!this.hasPrev())return this._done=!0,null;--this._index;this._xStart-=this.dx;this._yStart-=this.dy;this._distance=1;return this};a.prototype._seekBackwards=function(a,b){var c=this.backwardLength;if(a<=c)return this._distance=(c-a)/this.length,this;for(c=this.backwardLength;this.prev();){if(c+this.length>
a)return this._seekBackwards(a-c);c+=this.length}this._distance=0;return b?this:null};a.prototype.seek=function(a,b){void 0===b&&(b=!1);if(0>a)return this._seekBackwards(Math.abs(a),b);if(a<=this.remainingLength)return this._distance=(this.backwardLength+a)/this.length,this;for(var c=this.remainingLength;this.next();){if(c+this.length>a)return this.seek(a-c,b);c+=this.length}this._distance=1;return b?this:null};return a}();d.SegmentCursor=c;d.pathDivide=function(b,d,e){var f=a(b);b=c.create(b);var g=
f/2,k=Math.floor((f-d)/2/d);b.seek(g-k*d);for(var l=-k;l<=k;l++)512>b.x&&0<=b.x&&512>b.y&&0<=b.y&&e(b.clone(),l,g+l*d,f),b.seek(d)};d.pathSubdivide=function(b,d,e){m(e,d,a(b),c.create(b),0)};d.smoothPaths=function(a,b){for(var c=0;c<a.length;c++){var d=a[c],g=[];g.push(d[0]);for(var e=1;e<d.length;e++){var f=g[e-1],k=f[0],f=f[1],k=k+d[e][0],f=f+d[e][1];g.push([k,f])}k=g;f=b;if(!(0>=f||(d=k.length,3>d))){var e=[],l=0;e.push(0);for(var m=1;m<d;m++)l+=h.dist(k[m],k[m-1]),e.push(l);f=Math.min(f,.2*l);
l=[];l.push(k[0][0]);l.push(k[0][1]);var p=k[d-1][0],q=k[d-1][1],m=h.sub([0,0],k[0],k[1]);h.normalize(m);k[0][0]+=f*m[0];k[0][1]+=f*m[1];h.sub(m,k[d-1],k[d-2]);h.normalize(m);k[d-1][0]+=f*m[0];k[d-1][1]+=f*m[1];for(m=1;m<d;m++)e[m]+=f;e[d-1]+=f;for(var v=.5*f,m=1;m<d-1;m++){for(var z=0,B=0,C=0,D=m-1;0<=D&&!(e[D+1]<e[m]-v);D--){var G=v+e[D+1]-e[m],F=e[D+1]-e[D],E=e[m]-e[D]<v?1:G/F;if(1E-6>Math.abs(E))break;var H=E*E,J=E*G-.5*H*F,K=E*F/f,I=k[D+1],M=k[D][0]-I[0],N=k[D][1]-I[1],z=z+K/J*(I[0]*E*G+.5*H*
(G*M-F*I[0])-H*E*F*M/3),B=B+K/J*(I[1]*E*G+.5*H*(G*N-F*I[1])-H*E*F*N/3),C=C+K}for(D=m+1;D<d&&!(e[D-1]>e[m]+v);D++){G=v-e[D-1]+e[m];F=e[D]-e[D-1];E=e[D]-e[m]<v?1:G/F;if(1E-6>Math.abs(E))break;H=E*E;J=E*G-.5*H*F;K=E*F/f;I=k[D-1];M=k[D][0]-I[0];N=k[D][1]-I[1];z+=K/J*(I[0]*E*G+.5*H*(G*M-F*I[0])-H*E*F*M/3);B+=K/J*(I[1]*E*G+.5*H*(G*N-F*I[1])-H*E*F*N/3);C+=K}l.push(z/C);l.push(B/C)}l.push(p);l.push(q);for(D=m=0;m<d;m++)k[m][0]=l[D++],k[m][1]=l[D++]}d=[];d.push(g[0]);for(e=1;e<g.length;e++)k=g[e-1],m=k[0],
l=k[1],f=g[e],k=f[0],f=f[1],d.push([Math.round(k-m),Math.round(f-l)]);a[c]=d}return a}})},"esri/views/2d/engine/webgl/mesh/templates/util":function(){define(["require","exports"],function(b,d){function f(b,d){return Math.sqrt(b*b+d*d)}Object.defineProperty(d,"__esModule",{value:!0});d.sub=function(b,d,a){b[0]=d[0]-a[0];b[1]=d[1]-a[1];return b};d.len=f;d.normalize=function(b){var d=f(b[0],b[1]);b[0]/=d;b[1]/=d};d.dist=function(b,d){return f(b[0]-d[0],b[1]-d[1])};d.isFunction=function(b){return"function"===
typeof b};d.getLimitCosine=function(b){return 1/Math.max(b,1)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../alignmentUtils ../../color ../../materialKey/MaterialKey ./WGLBaseTextTemplate ./WGLMeshTemplate ../../util/BidiText".split(" "),function(b,d,f,h,e,a,q,m,c,l){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function c(a,c,d,f,k,l,m,n,w,v,
z,B,C,D,G,F){void 0===F&&(F=!1);var g=b.call(this)||this;g._xOffset=h.pt2px(z);g._yOffset=h.pt2px(B);g._decoration=n||"none";g._color=f;g._haloColor=k;g._haloSize=Math.min(Math.floor(5*h.pt2px(h.toPt(d))),127);g._size=Math.min(Math.round(h.pt2px(c)),127);c=Math.min(Math.round(h.pt2px(c)),127);g._referenceSize=Math.round(Math.sqrt(256*c));g._scale=g._size/24;g._angle=v;g._justify=e.getJustification(l||"center");g._xAlignD=e.getXAnchorDirection(l||"center");g._yAlignD=e.getYAnchorDirection(m||"baseline");
g._baseline="baseline"===(m||"baseline");g._bitset=w?1:0;a=q.MaterialKeyBase.load(q.createMaterialKey(g.geometryType,a,!1));a.sdf=!0;g._materialKey=a.data;g.symbolId=C;g._lineWidth=h.pt2px(D)||512;g._lineHeight=G||1;g._isCIM=F;return g}f(c,b);c.fromText=function(b,d,e){b=new c(b,d.font.size,d.haloSize||0,d.color&&a.premultiplyAlphaRGBA(d.color)||0,d.haloColor&&a.premultiplyAlphaRGBA(d.haloColor)||0,d.horizontalAlignment,d.verticalAlignment,d.font.decoration,!1,d.angle||0,d.xoffset,d.yoffset,d.id,
d.lineWidth,d.lineHeight,!1);d=l.bidiText(d.text)[1];b.bindTextInfo(e,d);return b};c.fromCIMText=function(b,d,e){var g=d.scaleFactor||1;b=new c(b,d.size*d.sizeRatio*g,d.outlineSize*d.sizeRatio,a.premultiplyAlphaRGBA(d.color),a.premultiplyAlphaRGBA(d.outlineColor),d.horizontalAlignment,d.verticalAlignment,d.decoration,d.colorLocked,d.angle,d.offsetX*d.sizeRatio*g,d.offsetY*d.sizeRatio*g,d.materialHash,512,1,!0);d=l.bidiText(d.text)[1];b.bindTextInfo(e,d);return b};return c}(m.default(c.default));d.default=
b})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/maybe ../../../../engine ../../definitions ../../enums ../../number ../../WGLDisplayRecord ../../materialKey/MaterialKey".split(" "),function(b,d,f,h,e,a,q,m,c,l,k,n){Object.defineProperty(d,"__esModule",{value:!0});var r=e.getLogger("esri.views.2d.engine.webgl.WGLTextTemplate"),
g=function(a,b){void 0===b&&(b="mapview-processing");return r.error(new h(b,a))};d.default=function(b){return function(b){function d(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];a=b.apply(this,a)||this;a._isCIM=!1;a.geometryType=c.WGLGeometryType.TEXT;a._aux=l.i8888to32(0,0,a._referenceSize,a._bitset);return a}f(d,b);d.prototype.bindTextInfo=function(b,c){var d=this;this._shapingInfo=b&&b.length?a.andThen(b,function(a){return q.shapeGlyphs(a,c,{scale:d._scale,angle:d._angle,xOffset:d._xOffset,
yOffset:d._yOffset,hAlign:d._xAlignD,vAlign:d._yAlignD,maxLineWidth:Math.max(32,Math.min(d._lineWidth,512)),lineHeight:m.MAGIC_LABEL_LINE_HEIGHT*Math.max(.25,Math.min(d._lineHeight,4)),decoration:d._decoration,isCIM:d._isCIM})}):null};d.prototype.writeMesh=function(b,c,d,e,f){var k=this;switch(d){case "esriGeometryPoint":this._writeGlyphs(b,c,e,f.geometry);break;case "esriGeometryPolygon":a.andThen(f.centroid,function(a){return k._writeGlyphs(b,c,e,a)});break;case "esriGeometryMultipoint":var l=d=
0,h=0;for(f=f.geometry.points;h<f.length;h++){var m=f[h],n=m[1];d+=m[0];l+=n;this._writeGlyphs(b,c,e,{x:d,y:l})}break;default:g("Unable to handle geometryType: "+d)}};d.prototype._writeGlyphs=function(b,c,d,g){var e=this._shapingInfo;if(!a.isNone(e)){var f=n.MaterialKeyBase.load(this._materialKey);g=l.i1616to32(2*g.x,2*g.y);for(var h=0,e=e.glyphs;h<e.length;h++){var m=e[h],p=new k(d,this.geometryType,f.data,0,0);f.textureBinding=m.textureBinding;p.materialKey=f.data;p.indexFrom=c.indexVector.length;
p.indexCount=this._writeIndices(c);p.vertexFrom=c.getVector("geometry").vertexCount;p.vertexCount=this._writeVertex(c,d,g,m);b.push(p)}}};d.prototype._writeVertexCommon=function(a,b,c,d){d=this._color;var g=this._haloColor,e=l.i8888to32(0,0,this._referenceSize,this._bitset),f=l.i8888to32(0,0,this._size,this._haloSize);a.push(c);a.push(b);a.push(d);a.push(g);a.push(f);a.push(e)};d.prototype._writeVertex=function(a,b,c,d){a=a.get("geometry");this._writeVertexCommon(a,b,c,d);a.push(d.offsets.upperLeft);
a.push(d.texcoords.upperLeft);this._writeVertexCommon(a,b,c,d);a.push(d.offsets.upperRight);a.push(d.texcoords.upperRight);this._writeVertexCommon(a,b,c,d);a.push(d.offsets.lowerLeft);a.push(d.texcoords.lowerLeft);this._writeVertexCommon(a,b,c,d);a.push(d.offsets.lowerRight);a.push(d.texcoords.lowerRight);return 4};d.prototype._writeIndices=function(a){var b=a.getVector("geometry").vertexCount;a=a.indexVector;a.push(b+0);a.push(b+1);a.push(b+2);a.push(b+1);a.push(b+3);a.push(b+2);return 6};return d}(b)}})},
"esri/views/2d/engine/webgl/mesh/templates/WGLMeshTemplate":function(){define(["require","exports","../../../../../../core/tsSupport/extendsHelper"],function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(){}b.prototype.writeMesh=function(b,a,d,f,c){};b.prototype.bindFeature=function(b,a,d){};return b}();d.default=b})},"esri/views/2d/engine/webgl/util/vvFlagUtils":function(){define(["require","exports","../enums","../visualVariablesUtils"],function(b,d,f,h){function e(a,
b){void 0===b&&(b=!1);var c=f.WGLVVFlag.SIZE_FIELD_STOPS|f.WGLVVFlag.SIZE_MINMAX_VALUE|f.WGLVVFlag.SIZE_SCALE_STOPS|f.WGLVVFlag.SIZE_UNIT_VALUE;a=(a&(f.WGLVVTarget.FIELD_TARGETS_OUTLINE|f.WGLVVTarget.MINMAX_TARGETS_OUTLINE|f.WGLVVTarget.SCALE_TARGETS_OUTLINE|f.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;return b?c&a:c&~a}function a(a){var b=e(a,!1);return a&(f.WGLVVFlag.COLOR|f.WGLVVFlag.OPACITY|f.WGLVVFlag.ROTATION|b)}Object.defineProperty(d,"__esModule",{value:!0});d.getVVFlags=function(a){if(!a)return f.WGLVVFlag.NONE;
for(var b=0,c=0;c<a.length;c++){var d=a[c];if("size"===d.type){var e=h.getTypeOfSizeVisualVariable(d),b=b|e;"outline"===d.target&&(b|=e<<4)}else"color"===d.type?b|=f.WGLVVFlag.COLOR:"opacity"===d.type?b|=f.WGLVVFlag.OPACITY:"rotation"===d.type&&(b|=f.WGLVVFlag.ROTATION)}return b};d.getSizeFlagsMask=e;d.getMarkerVVFlags=a;d.getFillVVFlags=function(a){return a&(f.WGLVVFlag.COLOR|f.WGLVVFlag.OPACITY)};d.getLineVVFlags=function(a,b){if(b)return b=e(a,!0),a&b;b=e(a,!1);return a&(f.WGLVVFlag.COLOR|f.WGLVVFlag.OPACITY|
b)};d.getTextVVFlags=function(b){return a(b)};d.getLabelVVFlags=function(a){var b=e(a,!1);return a&b}})},"esri/views/2d/engine/webgl/visualVariablesUtils":function(){define("require exports ../../../../core/Error ../../../../core/Logger ./enums ./Utils".split(" "),function(b,d,f,h,e,a){Object.defineProperty(d,"__esModule",{value:!0});var q=h.getLogger("esri.views.2d.engine.webgl");d.getTypeOfSizeVisualVariable=function(b){if(a.isNumber(b.minDataValue)&&a.isNumber(b.maxDataValue)&&null!=b.minSize&&
null!=b.maxSize)return e.WGLVVFlag.SIZE_MINMAX_VALUE;if((b.expression&&"view.scale"===b.expression||b.valueExpression&&"$view.scale"===b.valueExpression)&&Array.isArray(b.stops))return e.WGLVVFlag.SIZE_SCALE_STOPS;if((null!=b.field||b.expression&&"view.scale"!==b.expression||b.valueExpression&&"$view.scale"!==b.valueExpression)&&(Array.isArray(b.stops)||"levels"in b&&b.levels))return e.WGLVVFlag.SIZE_FIELD_STOPS;if((null!=b.field||b.expression&&"view.scale"!==b.expression||b.valueExpression&&"$view.scale"!==
b.valueExpression)&&null!=b.valueUnit)return e.WGLVVFlag.SIZE_UNIT_VALUE;q.error(new f("mapview-bad-type","Found invalid size VisualVariable",b));return e.WGLVVFlag.NONE}})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLabel":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(b,d,f,h,e,a,q,m){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function c(){return null!==
b&&b.apply(this,arguments)||this}f(c,b);c.prototype.dispose=function(){};c.prototype.getGeometryType=function(){return e.WGLGeometryType.LABEL};c.prototype.drawGeometry=function(b,c,d,g,e){var f=b.context,k=b.painter,l=b.state,h=b.rendererInfo,n=d.indexCount,q=d.indexFrom;d=m.LabelMaterialKey.load(d.materialKey);var v=d.mapAligned?1:0;if(v||!(1<=Math.abs(c.key.level-Math.round(100*b.displayLevel)/100))){var r=a.createProgramDescriptor(d.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},
{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_haloColor",count:4,type:5121,normalized:!0},{location:4,name:"a_texAndSize",count:4,type:5121},{location:5,name:"a_refSymbolAndPlacementOffset",count:4,type:5121},{location:6,name:"a_glyphData",count:4,type:5121},{location:7,name:"a_vertexOffset",count:2,type:5122},{location:8,name:"a_texCoords",count:2,type:5123}]}),x=r.bufferLayouts,r=r.attributes;e=k.materialManager.getMaterialProgram(b,
d,"materials/label",r,e);g=this._getVAO(f,x,r,g);b.context.setStencilFunction(514,0,255);f.bindProgram(e);f.bindVAO(g);this._setSharedUniforms(e,b,c);k.textureManager.bindTextures(f,e,d);k=1===v?l.displayViewMat3:l.displayMat3;d.vvSizeMinMaxValue&&e.setUniform4fv("u_vvSizeMinMaxValue",h.vvSizeMinMaxValue);d.vvSizeScaleStops&&e.setUniform1f("u_vvSizeScaleStopsValue",h.vvSizeScaleStopsValue);d.vvSizeFieldStops&&(c=h.getSizeVVFieldStops(c.key.level),e.setUniform1fv("u_vvSizeFieldStopsValues",c.values),
e.setUniform1fv("u_vvSizeFieldStopsSizes",c.sizes));d.vvSizeUnitValue&&e.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",h.vvSizeUnitValueToPixelsRatio);e.setUniform1f("u_mapRotation",Math.floor(l.rotation/360*254));e.setUniform1f("u_mapAligned",v);e.setUniformMatrix3fv("u_displayMat3",k);e.setUniform1f("u_opacity",1);e.setUniform1f("u_zoomLevel",Math.round(10*b.displayLevel));e.setUniform2fv("u_screenSize",b.state.size);e.setUniform1f("u_isHalo",1);f.drawElements(4,n,5125,4*q);e.setUniform1f("u_isHalo",
0);f.drawElements(4,n,5125,4*q);f.bindVAO(null);f.setStencilTestEnabled(!0);f.setBlendingEnabled(!0)}};return c}(q.default);d.default=b})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLine":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(b,d,f,h,e,a,q,m){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function c(){return null!==b&&b.apply(this,
arguments)||this}f(c,b);c.prototype.dispose=function(){};c.prototype.getGeometryType=function(){return e.WGLGeometryType.LINE};c.prototype.drawGeometry=function(b,c,d,g,e){var f=b.context,k=b.painter,l=b.rendererInfo,h=b.requiredLevel,n=d.indexFrom,q=d.indexCount;d=m.LineMaterialKey.load(d.materialKey);var v=a.createProgramDescriptor(d.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},
{location:3,name:"a_offsetAndNormal",count:4,type:5120},{location:4,name:"a_accumulatedDistanceAndHalfWidth",count:2,type:5123},{location:5,name:"a_tlbr",count:4,type:5123},{location:6,name:"a_segmentDirection",count:4,type:5120},{location:7,name:"a_aux",count:2,type:5123}]}),r=v.bufferLayouts,v=v.attributes;e=k.materialManager.getMaterialProgram(b,d,"materials/line",v,e);g=this._getVAO(f,r,v,g);r=1/b.pixelRatio;f.bindProgram(e);f.bindVAO(g);this._setSharedUniforms(e,b,c);d.textureBinding&&k.textureManager.bindTextures(f,
e,d);e.setUniform1f("u_zoomFactor",Math.pow(2,h-c.key.level)/b.pixelRatio);e.setUniform1f("u_blur",0+r);e.setUniform1f("u_antialiasing",r);d.vvSizeMinMaxValue&&e.setUniform4fv("u_vvSizeMinMaxValue",l.vvSizeMinMaxValue);d.vvSizeScaleStops&&e.setUniform1f("u_vvSizeScaleStopsValue",l.vvSizeScaleStopsValue);d.vvSizeFieldStops&&(b=l.getSizeVVFieldStops(c.key.level),e.setUniform1fv("u_vvSizeFieldStopsValues",b.values),e.setUniform1fv("u_vvSizeFieldStopsSizes",b.sizes));d.vvSizeUnitValue&&e.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",
l.vvSizeUnitValueToPixelsRatio);d.vvColor&&(e.setUniform1fv("u_vvColorValues",l.vvColorValues),e.setUniform4fv("u_vvColors",l.vvColors));d.vvOpacity&&(e.setUniform1fv("u_vvOpacityValues",l.vvOpacityValues),e.setUniform1fv("u_vvOpacities",l.vvOpacities));f.setFaceCullingEnabled(!0);f.setFrontFace(2305);f.setCullFace(1029);f.drawElements(4,q,5125,4*n);f.setFaceCullingEnabled(!1);f.bindVAO(null)};return c}(q.default);d.default=b})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushMarker":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),
function(b,d,f,h,e,a,q,m,c){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}f(d,b);d.prototype.dispose=function(){};d.prototype.getGeometryType=function(){return a.WGLGeometryType.MARKER};d.prototype.drawGeometry=function(a,b,d,e,f){var g=a.context,k=a.painter,l=a.rendererInfo,h=a.state,m=d.indexCount,n=d.indexFrom;d=c.MarkerMaterialKey.load(d.materialKey);var t=q.createProgramDescriptor(d.data,{geometry:[{location:0,name:"a_pos",
count:2,type:5122},{location:1,name:"a_vertexOffset",count:2,type:5122},{location:2,name:"a_texCoords",count:2,type:5123},{location:3,name:"a_bitSetAndDistRatio",count:4,type:5121},{location:4,name:"a_id",count:4,type:5121},{location:5,name:"a_color",count:4,type:5121,normalized:!0},{location:6,name:"a_outlineColor",count:4,type:5121,normalized:!0},{location:7,name:"a_sizeAndOutlineWidth",count:4,type:5121}]}),r=t.bufferLayouts,t=t.attributes;f=k.materialManager.getMaterialProgram(a,d,"materials/icon",
t,f);e=this._getVAO(g,r,t,e);g.bindProgram(f);g.bindVAO(e);d.textureBinding&&k.textureManager.bindTextures(g,f,d);this._setSharedUniforms(f,a,b);f.setUniformMatrix3fv("u_displayMat3",d.vvRotation?h.displayViewMat3:h.displayMat3);d.vvSizeMinMaxValue&&f.setUniform4fv("u_vvSizeMinMaxValue",l.vvSizeMinMaxValue);d.vvSizeScaleStops&&f.setUniform1f("u_vvSizeScaleStopsValue",l.vvSizeScaleStopsValue);d.vvSizeFieldStops&&(a=l.getSizeVVFieldStops(b.key.level),f.setUniform1fv("u_vvSizeFieldStopsValues",a.values),
f.setUniform1fv("u_vvSizeFieldStopsSizes",a.sizes));d.vvSizeUnitValue&&f.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",l.vvSizeUnitValueToPixelsRatio);d.vvColor&&(f.setUniform1fv("u_vvColorValues",l.vvColorValues),f.setUniform4fv("u_vvColors",l.vvColors));d.vvOpacity&&(f.setUniform1fv("u_vvOpacityValues",l.vvOpacityValues),f.setUniform1fv("u_vvOpacities",l.vvOpacities));d.vvRotation&&f.setUniform1f("u_vvRotationType","geographic"===l.vvMaterialParameters.vvRotationType?0:1);g.drawElements(4,
m,5125,4*n);g.bindVAO(null)};return d}(m.default);d.default=b})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushText":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(b,d,f,h,e,a,q,m){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}f(c,b);c.prototype.dispose=function(){};c.prototype.getGeometryType=
function(){return e.WGLGeometryType.TEXT};c.prototype.drawGeometry=function(b,c,d,g,e){var f=b.context,k=b.painter,l=b.rendererInfo,h=b.state,n=d.indexCount,q=d.indexFrom;d=m.TextMaterialKey.load(d.materialKey);var v=a.createProgramDescriptor(d.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_haloColor",count:4,type:5121,normalized:!0},{location:4,name:"a_texFontSize",
count:4,type:5121},{location:5,name:"a_aux",count:4,type:5120},{location:6,name:"a_vertexOffset",count:2,type:5122},{location:7,name:"a_texCoords",count:2,type:5123}]}),r=v.bufferLayouts,v=v.attributes;e=k.materialManager.getMaterialProgram(b,d,"materials/text",v,e);g=this._getVAO(f,r,v,g);f.bindProgram(e);f.bindVAO(g);this._setSharedUniforms(e,b,c);k.textureManager.bindTextures(f,e,d);e.setUniformMatrix3fv("u_displayMat3",h.displayMat3);d.vvSizeMinMaxValue&&e.setUniform4fv("u_vvSizeMinMaxValue",
l.vvSizeMinMaxValue);d.vvSizeScaleStops&&e.setUniform1f("u_vvSizeScaleStopsValue",l.vvSizeScaleStopsValue);d.vvSizeFieldStops&&(b=l.getSizeVVFieldStops(c.key.level),e.setUniform1fv("u_vvSizeFieldStopsValues",b.values),e.setUniform1fv("u_vvSizeFieldStopsSizes",b.sizes));d.vvSizeUnitValue&&e.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",l.vvSizeUnitValueToPixelsRatio);d.vvColor&&(e.setUniform1fv("u_vvColorValues",l.vvColorValues),e.setUniform4fv("u_vvColors",l.vvColors));d.vvOpacity&&(e.setUniform1fv("u_vvOpacityValues",
l.vvOpacityValues),e.setUniform1fv("u_vvOpacities",l.vvOpacities));d.vvRotation&&e.setUniform1f("u_vvRotationType","geographic"===l.vvMaterialParameters.vvRotationType?0:1);e.setUniform1f("u_isHalo",1);f.drawElements(4,n,5125,4*q);e.setUniform1f("u_isHalo",0);f.drawElements(4,n,5125,4*q);f.bindVAO(null)};return c}(q.default);d.default=b})},"esri/views/2d/engine/webgl/mesh/templates/shapingUtils":function(){define("require exports ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../.. ../../alignmentUtils ../../number ../../collisions/BoundingBox".split(" "),
function(b,d,f,h,e,a,q,m,c,l){Object.defineProperty(d,"__esModule",{value:!0});var k=function(){function a(a,b,c,d){this._rotationT=h.mat2df32.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=255;var g=c.rect,e=new Float32Array(8);a*=d;b*=d;var f=c.code?g.width*d:c.metrics.width,k=c.code?g.height*d:c.metrics.height;e[0]=a;e[1]=b;e[2]=a+f;e[3]=b;e[4]=a;e[5]=b+k;e[6]=a+f;e[7]=b+k;this._data=e;this._setTextureCoords(g);this._scale=d;this._mosaic=c;this.x=a;this.y=b}Object.defineProperty(a.prototype,
"width",{get:function(){return this._mosaic.metrics.width*this._scale},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"mosaic",{get:function(){return this._mosaic},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"angle",{get:function(){return this._angle},set:function(a){this._angle=a;f.mat2d.identity(this._rotationT);f.mat2d.rotate(this._rotationT,this._rotationT,-a);this._setOffsets(this._data)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"xTopLeft",{get:function(){return this._data[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yTopLeft",{get:function(){return this._data[1]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"xBottomRight",{get:function(){return this._data[6]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"yBottomRight",{get:function(){return this._data[7]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"texcoords",{get:function(){return this._texcoords},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"textureBinding",{get:function(){return this._mosaic.textureBinding},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"offsets",{get:function(){this._offsets||this._setOffsets(this._data);return this._offsets},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"char",{get:function(){return String.fromCharCode(this._mosaic.code)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"code",
{get:function(){return this._mosaic.code},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bounds",{get:function(){var a=this._mosaic.metrics,b=a.width*this._scale,c=Math.abs(a.height)*this._scale,a=new Float32Array(8);a[0]=this.x;a[1]=this.y;a[2]=this.x+b;a[3]=this.y;a[4]=this.x;a[5]=this.y+c;a[6]=this.x+b;a[7]=this.y+c;b=f.mat2d.multiply(h.mat2df32.create(),this._rotationT,this._T);h.mat2df32.transformMany(a,a,b);for(var c=b=Infinity,d=0,g=0,e=0;4>e;e++)var k=a[2*e],m=a[2*e+1],
b=Math.min(b,k),c=Math.min(c,m),d=Math.max(d,k),g=Math.max(g,m);a=d-b;g-=c;return new l.default(b+a/2,c+g/2,a,g)},enumerable:!0,configurable:!0});a.prototype.setTransform=function(a){this._T=a;this._offsets=null};a.prototype._setOffsets=function(a){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});var b=this._offsets,d=new Float32Array(8),g=f.mat2d.multiply(h.mat2df32.create(),this._rotationT,this._T);h.mat2df32.transformMany(d,a,g);b.upperLeft=c.i1616to32(8*d[0],
8*d[1]);b.upperRight=c.i1616to32(8*d[2],8*d[3]);b.lowerLeft=c.i1616to32(8*d[4],8*d[5]);b.lowerRight=c.i1616to32(8*d[6],8*d[7])};a.prototype._setTextureCoords=function(a){var b=a.x,d=a.y,g=a.width;a=a.height;this._texcoords={upperLeft:c.i1616to32(b,d),upperRight:c.i1616to32(b+g,d),lowerLeft:c.i1616to32(b,d+a),lowerRight:c.i1616to32(b+g,d+a)}};return a}();d.ShapedGlyph=k;var n=function(a,b){return{code:0,page:0,sdf:!0,rect:new q.Rect(0,0,11,8),textureBinding:b,metrics:{advance:0,height:4,width:a,left:0,
top:0}}},r=function(){function b(a,b,c){this._decorate(a,b,c);this.glyphs=a;this.bounds=this._createBounds(a);this.isMultiline=1<b.length;this._hasRotation=0!==c.angle;this._T=this._createGlyphTransform(this.bounds,c);for(b=0;b<a.length;b++)a[b].setTransform(this._T)}b.prototype._decorate=function(a,b,c){if("none"!==c.decoration&&a.length){var d=c.scale;c="underline"===c.decoration?30:20;for(var g=a[0].textureBinding,e=0;e<b.length;e++){var f=b[e];a.push(new k(f.startX*d,f.startY*d+c*d,n((f.width+
f.glyphWidthEnd)*d,g),1))}}};Object.defineProperty(b.prototype,"boundsT",{get:function(){var b=this.bounds,c=e.vec2.set(a.vec2f32.create(),b.x,b.y);e.vec2.transformMat2d(c,c,this._T);return this._hasRotation?(b=Math.max(b.width,b.height),new l.default(c[0],c[1],b,b)):new l.default(c[0],c[1],b.width,b.height)},enumerable:!0,configurable:!0});b.prototype._createBounds=function(a){for(var b=Infinity,c=Infinity,d=0,g=0,e=0;e<a.length;e++)var f=a[e],b=Math.min(b,f.xTopLeft),c=Math.min(c,f.yTopLeft),d=
Math.max(d,f.xTopLeft+f.width),g=Math.max(g,f.yBottomRight);a=d-b;g-=c;return new l.default(b+a/2,c+g/2,a,g)};b.prototype._createGlyphTransform=function(b,c){var d=c.angle*Math.PI/180,g=h.mat2df32.create(),k=a.vec2f32.create();f.mat2d.translate(g,g,e.vec2.set(k,c.xOffset,-c.yOffset));c.isCIM?f.mat2d.rotate(g,g,d):(f.mat2d.translate(g,g,e.vec2.set(k,b.x,b.y)),f.mat2d.rotate(g,g,d),f.mat2d.translate(g,g,e.vec2.set(k,-b.x,-b.y)));return g};return b}();d.ShapingInfo=r;var g=function(){return function(a,
b,c,d,g,e){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(b,c));this.end=Math.max(0,Math.max(b,c));this.end<a.length&&(this.glyphWidthEnd=a[this.end].metrics.width);this.width=d;this.yMin=g;this.yMax=e}}();d.shapeGlyphs=function(a,b,c){var d=c.scale,e=[],f=[],l=1/c.scale*c.maxLineWidth,h=b?a.length-1:0,n=b?-1:a.length;b=b?-1:1;for(var q=h,t=0,u=0,x=q,F=x,E=0,H=Infinity,J=0;q!==n;){var K=a[q],I=K.code,K=K.metrics,M=Math.abs(K.top);10!==I&&32!==I&&(H=Math.min(H,M),J=Math.max(J,
M+K.height));10===I?(q!==h&&(f.push(new g(a,x,q-b,t,H,J)),H=Infinity,J=0),t=0,x=q+b,F=q+b,u=0):32===I?(F=q+b,u=0,E=K.advance,t+=K.advance):(t>l&&(F!==x?(I=F-2*b,t-=E,f.push(new g(a,x,I,t-u,H,J)),H=Infinity,J=0,x=F,t=u):(f.push(new g(a,x,q-b,t,H,J)),H=Infinity,J=0,F=x=q,t=0)),t+=K.advance,u+=K.advance);q+=b}l=new g(a,x,q-b,t,H,J);0<=l.start&&l.end<a.length&&f.push(l);for(l=0;l<f.length;l++);h=f[0].yMin;n=c.vAlign;l=c.hAlign;b=n===m.VAlign.Baseline?1:0;h=(1-b)*-h+(f[f.length-1].yMax+c.lineHeight*(f.length-
1)+("underline"===c.decoration?4:0)-h)/2*(b?0:n-1)+-26*(b?1:0);for(n=0;n<f.length;n++)for(q=f[n],u=q.start,b=q.end,q=q.width/2*(l+1)*-1-3,t=n*c.lineHeight+h-3,f[n].startX=q,f[n].startY=t;u<=b;u++)x=a[u],10!==x.code&&(F=new k(q+x.metrics.left,t-x.metrics.top,x,d),q+=x.metrics.advance,e.push(F));return new r(e,f,c)}})},"esri/views/2d/engine/webgl/TileClipper":function(){define(["require","exports","./definitions","./Geometry","./GeometryUtils"],function(b,d,f,h,e){Object.defineProperty(d,"__esModule",
{value:!0});var a=function(){return function(a,b,d){this.ratio=a;this.x=b;this.y=d}}();b=function(){function b(a,b,d,e,h){void 0===e&&(e=8);void 0===h&&(h=8);this.lines=[];this.starts=[];this.pixelRatio=e;this.pixelMargin=h;this.tileSize=f.TILE_SIZE*e;this.dz=a;this.yPos=b;this.xPos=d}b.prototype.setExtent=function(a){this.finalRatio=this.tileSize/a*(1<<this.dz);var b=this.pixelRatio*this.pixelMargin,b=b/this.finalRatio;a>>=this.dz;b>a&&(b=a);this.margin=b;this.xmin=a*this.xPos-b;this.ymin=a*this.yPos-
b;this.xmax=this.xmin+a+2*b;this.ymax=this.ymin+a+2*b};b.prototype.reset=function(a){this.type=a;this.lines=[];this.starts=[];this.line=null;this.start=0};b.prototype.moveTo=function(a,b){this._pushLine();this._prevIsIn=this._isIn(a,b);this._moveTo(a,b,this._prevIsIn);this._prevPt=new h.Point(a,b);this._firstPt=new h.Point(a,b);this._dist=0};b.prototype.lineTo=function(b,d){var c=this._isIn(b,d),e=new h.Point(b,d),f=h.Point.distance(this._prevPt,e),g,l,m;if(c)this._prevIsIn?this._lineTo(b,d,!0):(g=
this._prevPt,l=e,b=this._intersect(l,g),this.start=this._dist+f*(1-this._r),this._lineTo(b.x,b.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,g=e,b=this._intersect(l,g),this._lineTo(b.x,b.y,!0),this._lineTo(g.x,g.y,!1);else{var q=this._prevPt;if(!(q.x<=this.xmin&&e.x<=this.xmin||q.x>=this.xmax&&e.x>=this.xmax||q.y<=this.ymin&&e.y<=this.ymin||q.y>=this.ymax&&e.y>=this.ymax)){b=[];if(q.x<this.xmin&&e.x>this.xmin||q.x>this.xmin&&e.x<this.xmin)d=(this.xmin-q.x)/(e.x-q.x),m=q.y+
d*(e.y-q.y),m<=this.ymin?l=!1:m>=this.ymax?l=!0:b.push(new a(d,this.xmin,m));if(q.x<this.xmax&&e.x>this.xmax||q.x>this.xmax&&e.x<this.xmax)d=(this.xmax-q.x)/(e.x-q.x),m=q.y+d*(e.y-q.y),m<=this.ymin?l=!1:m>=this.ymax?l=!0:b.push(new a(d,this.xmax,m));if(q.y<this.ymin&&e.y>this.ymin||q.y>this.ymin&&e.y<this.ymin)d=(this.ymin-q.y)/(e.y-q.y),m=q.x+d*(e.x-q.x),m<=this.xmin?g=!1:m>=this.xmax?g=!0:b.push(new a(d,m,this.ymin));if(q.y<this.ymax&&e.y>this.ymax||q.y>this.ymax&&e.y<this.ymax)d=(this.ymax-q.y)/
(e.y-q.y),m=q.x+d*(e.x-q.x),m<=this.xmin?g=!1:m>=this.xmax?g=!0:b.push(new a(d,m,this.ymax));if(0===b.length)g?l?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):l?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(1<b.length&&b[0].ratio>b[1].ratio)this.start=this._dist+f*b[1].ratio,this._lineTo(b[1].x,b[1].y,!0),this._lineTo(b[0].x,b[0].y,!0);else for(this.start=this._dist+f*b[0].ratio,g=0;g<b.length;g++)this._lineTo(b[g].x,b[g].y,!0)}this._lineTo(e.x,
e.y,!1)}this._dist+=f;this._prevIsIn=c;this._prevPt=e};b.prototype.close=function(){if(2<this.line.length){var a=this._firstPt,b=this._prevPt;a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y);a=this.line;for(b=a.length;4<=b;)if(a[0].x===a[1].x&&a[0].x===a[b-2].x||a[0].y===a[1].y&&a[0].y===a[b-2].y)a.pop(),a[0].x=a[b-2].x,a[0].y=a[b-2].y,--b;else break}};b.prototype.result=function(a){void 0===a&&(a=!0);this._pushLine();if(0===this.lines.length)return null;3===this.type&&a&&q.simplify(this.tileSize,this.margin*
this.finalRatio,this.lines);return this.lines};b.prototype.resultWithStarts=function(){if(2!==this.type)throw Error("Only valid for lines");this._pushLine();var a=this.lines,b=a.length;if(0===b)return null;for(var d=[],e=0;e<b;e++)d.push({line:a[e],start:this.starts[e]||0});return d};b.prototype._isIn=function(a,b){return a>=this.xmin&&a<=this.xmax&&b>=this.ymin&&b<=this.ymax};b.prototype._intersect=function(a,b){var c,d,e;if(b.x>=this.xmin&&b.x<=this.xmax)d=b.y<=this.ymin?this.ymin:this.ymax,e=(d-
a.y)/(b.y-a.y),c=a.x+e*(b.x-a.x);else if(b.y>=this.ymin&&b.y<=this.ymax)c=b.x<=this.xmin?this.xmin:this.xmax,e=(c-a.x)/(b.x-a.x),d=a.y+e*(b.y-a.y);else{d=b.y<=this.ymin?this.ymin:this.ymax;c=b.x<=this.xmin?this.xmin:this.xmax;var g=(c-a.x)/(b.x-a.x),f=(d-a.y)/(b.y-a.y);g<f?(e=g,d=a.y+g*(b.y-a.y)):(e=f,c=a.x+f*(b.x-a.x))}this._r=e;return new h.Point(c,d)};b.prototype._pushLine=function(){this.line&&(1===this.type?0<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?
1<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&3<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)));this.line=[];this.start=0};b.prototype._moveTo=function(a,b,d){3!==this.type?d&&(a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new h.Point(a,b))):(d||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&
(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new h.Point(a,b)),this._is_v=this._is_h=!1)};b.prototype._lineTo=function(a,b,d){if(3!==this.type)if(d){a=Math.round((a-(this.xmin+this.margin))*this.finalRatio);b=Math.round((b-(this.ymin+this.margin))*this.finalRatio);if(0<this.line.length&&(d=this.line[this.line.length-1],d.equals(a,b)))return;this.line.push(new h.Point(a,b))}else this.line&&0<this.line.length&&
this._pushLine();else if(d||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line&&0<this.line.length){d=this.line[this.line.length-1];var c=d.x===a,e=d.y===b;c&&e||(this._is_h&&c?(d.x=a,d.y=b,d=this.line[this.line.length-2],d.x===a&&d.y===b?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(d=this.line[this.line.length-
2],this._is_h=d.x===a,this._is_v=d.y===b)):(this._is_h=d.x===a,this._is_v=d.y===b)):this._is_v&&e?(d.x=a,d.y=b,d=this.line[this.line.length-2],d.x===a&&d.y===b?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(d=this.line[this.line.length-2],this._is_h=d.x===a,this._is_v=d.y===b)):(this._is_h=d.x===a,this._is_v=d.y===b)):(this.line.push(new h.Point(a,b)),this._is_h=c,this._is_v=e))}else this.line.push(new h.Point(a,b))};return b}();d.TileClipper=b;b=function(){function a(){}a.prototype.setExtent=
function(a){this._ratio=4096===a?1:4096/a};a.prototype.reset=function(a){this.type=a;this.lines=[];this.line=null};a.prototype.moveTo=function(a,b){this.line&&this.lines.push(this.line);this.line=[];var c=this._ratio;this.line.push(new h.Point(Math.round(a*c),Math.round(b*c)))};a.prototype.lineTo=function(a,b){var c=this._ratio;this.line.push(new h.Point(Math.round(a*c),Math.round(b*c)))};a.prototype.close=function(){var a=this.line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])};a.prototype.result=
function(){this.line&&this.lines.push(this.line);if(0===this.lines.length)return null;3===this.type&&1!==this._ratio&&q.simplify(4096,64,this.lines);return this.lines};return a}();d.SimpleBuilder=b;var q=function(){function a(){}a.simplify=function(b,d,e){if(e){var c=-d,f=b+d,g=-d,k=b+d;b=[];d=[];for(var h=e.length,l=0;l<h;++l){var m=e[l];if(m&&!(2>m.length))for(var q=m[0],p=void 0,w=m.length,v=1;v<w;++v)p=m[v],q.x===p.x&&(q.x<=c&&(q.y>p.y?(b.push(l),b.push(v),b.push(0),b.push(-1)):(d.push(l),d.push(v),
d.push(0),d.push(-1))),q.x>=f&&(q.y<p.y?(b.push(l),b.push(v),b.push(1),b.push(-1)):(d.push(l),d.push(v),d.push(1),d.push(-1)))),q.y===p.y&&(q.y<=g&&(q.x<p.x?(b.push(l),b.push(v),b.push(2),b.push(-1)):(d.push(l),d.push(v),d.push(2),d.push(-1))),q.y>=k&&(q.x>p.x?(b.push(l),b.push(v),b.push(3),b.push(-1)):(d.push(l),d.push(v),d.push(3),d.push(-1)))),q=p}0!==b.length&&0!==d.length&&(a.fillParent(e,d,b),a.fillParent(e,b,d),c=[],a.calcDeltas(c,d,b),a.calcDeltas(c,b,d),a.addDeltas(c,e))}};a.fillParent=function(a,
b,d){for(var c=d.length,f=b.length,g=0;g<f;g+=4){for(var k=b[g],h=b[g+1],l=b[g+2],m=a[k][h-1],k=a[k][h],h=8092,q=-1,p=0;p<c;p+=4)if(d[p+2]===l){var w=d[p],v=d[p+1],z=a[w][v-1],w=a[w][v];switch(l){case 0:case 1:e.between(m.y,z.y,w.y)&&e.between(k.y,z.y,w.y)&&(z=Math.abs(w.y-z.y),z<h&&(h=z,q=p));break;case 2:case 3:e.between(m.x,z.x,w.x)&&e.between(k.x,z.x,w.x)&&(z=Math.abs(w.x-z.x),z<h&&(h=z,q=p))}}b[g+3]=q}};a.calcDeltas=function(b,d,e){for(var c=d.length,f=0;f<c;f+=4){var g=a.calcDelta(f,d,e,[]);
b.push(d[f]);b.push(d[f+1]);b.push(d[f+2]);b.push(g)}};a.calcDelta=function(b,d,e,f){b=d[b+3];if(-1===b)return 0;var c=f.length;if(1<c&&f[c-2]===b)return 0;f.push(b);return a.calcDelta(b,e,d,f)+1};a.addDeltas=function(a,b){for(var c=a.length,d=0,e=0;e<c;e+=4){var g=a[e+3];g>d&&(d=g)}for(e=0;e<c;e+=4){var f=b[a[e]],h=a[e+1],g=d-a[e+3];switch(a[e+2]){case 0:f[h-1].x-=g;f[h].x-=g;1===h&&(f[f.length-1].x-=g);h===f.length-1&&(f[0].x-=g);break;case 1:f[h-1].x+=g;f[h].x+=g;1===h&&(f[f.length-1].x+=g);h===
f.length-1&&(f[0].x+=g);break;case 2:f[h-1].y-=g;f[h].y-=g;1===h&&(f[f.length-1].y-=g);h===f.length-1&&(f[0].y-=g);break;case 3:f[h-1].y+=g,f[h].y+=g,1===h&&(f[f.length-1].y+=g),h===f.length-1&&(f[0].y+=g)}}};return a}()})},"esri/views/2d/engine/webgl/TurboLine":function(){define(["require","exports","../../../../symbols/cim/enums","./mesh/templates/util"],function(b,d,f,h){function e(){if(p.cosine<n.innerBisectorAutoSplitThreshold){p.splitInner=!0;p.gapInner=!0;var a=Math.max(n.innerBisectorAutoSplitThreshold,
p.cosine),a=Math.sqrt(1-a*a)/a;p.leftInner.x=p.nextNormal.x+p.sign*a*p.outbound.x;p.leftInner.y=p.nextNormal.y+p.sign*a*p.outbound.y;p.rightInner.x=p.prevNormal.x-p.sign*a*p.inbound.x;p.rightInner.y=p.prevNormal.y-p.sign*a*p.inbound.y}else n.enableInnerBisectorSplit&&(p.splitInner=!0,p.gapInner=!1,p.leftInner.x=p.rightInner.x=p.bisector.x/p.cosine,p.leftInner.y=p.rightInner.y=p.bisector.y/p.cosine);p.cosine<n.outerBisectorAutoSplitThreshold?(p.splitOuter=!0,p.gapOuter=!0,a=Math.max(n.outerBisectorAutoSplitThreshold,
p.cosine),a=Math.sqrt(1-a*a)/a,p.leftOuter.x=p.prevNormal.x-p.sign*a*p.inbound.x,p.leftOuter.y=p.prevNormal.y-p.sign*a*p.inbound.y,p.rightOuter.x=p.nextNormal.x+p.sign*a*p.outbound.x,p.rightOuter.y=p.nextNormal.y+p.sign*a*p.outbound.y):n.enableOuterBisectorSplit&&(p.splitOuter=!0,p.gapOuter=!1,p.leftOuter.x=p.rightOuter.x=p.bisector.x/p.cosine,p.leftOuter.y=p.rightOuter.y=p.bisector.y/p.cosine)}function a(){if(u)p.distance=0,u=p.isCap=p.isFirstVertex=p.isLastVertex=!1;else{if(0===x)if(p.isFirstVertex=
0===g,A=k[g],0===g){if(x=0,p.closed){p.inbound.x=A.x-k[k.length-2].x;p.inbound.y=A.y-k[k.length-2].y;var a=Math.sqrt(p.inbound.x*p.inbound.x+p.inbound.y*p.inbound.y);p.inbound.x/=a;p.inbound.y/=a}}else p.inbound.x=A.x-y.x,p.inbound.y=A.y-y.y,x=Math.sqrt(p.inbound.x*p.inbound.x+p.inbound.y*p.inbound.y),p.inbound.x/=x,p.inbound.y/=x;p.distance+x-t<=n.wrapDistance?(g<k.length-1?(p.outbound.x=k[g+1].x-A.x,p.outbound.y=k[g+1].y-A.y,a=Math.sqrt(p.outbound.x*p.outbound.x+p.outbound.y*p.outbound.y),p.outbound.x/=
a,p.outbound.y/=a):p.closed?(p.outbound.x=k[1].x-A.x,p.outbound.y=k[1].y-A.y,a=Math.sqrt(p.outbound.x*p.outbound.x+p.outbound.y*p.outbound.y),p.outbound.x/=a,p.outbound.y/=a):(p.outbound.x=p.inbound.x,p.outbound.y=p.inbound.y),0!==g||p.closed||(p.inbound.x=p.outbound.x,p.inbound.y=p.outbound.y),++g,p.isLastVertex=g===k.length,p.isCap=!p.closed&&(p.isFirstVertex||p.isLastVertex),p.distance+=x-t,t=x=0,u=p.distance+x-t===n.wrapDistance,p.currentVertex.x=A.x,p.currentVertex.y=A.y,y=A,A=null):(p.outbound.x=
p.inbound.x,p.outbound.y=p.inbound.y,t+=n.wrapDistance-p.distance,p.distance=n.wrapDistance,u=!0,a=t/x,p.currentVertex.x=(1-a)*y.x+a*A.x,p.currentVertex.y=(1-a)*y.y+a*A.y)}}function q(){p.prevNormal.x=-p.inbound.y;p.prevNormal.y=p.inbound.x;p.nextNormal.x=-p.outbound.y;p.nextNormal.y=p.outbound.x}function m(){q();p.bisector.x=p.prevNormal.x+p.nextNormal.x;p.bisector.y=p.prevNormal.y+p.nextNormal.y;var a=Math.sqrt(p.bisector.x*p.bisector.x+p.bisector.y*p.bisector.y);.001>a?(p.bisector.x=void 0,p.bisector.y=
void 0,p.cosine=0,p.sign=void 0):(p.bisector.x/=a,p.bisector.y/=a,p.cosine=p.bisector.x*p.nextNormal.x+p.bisector.y*p.nextNormal.y,p.sign=0<=p.prevNormal.x*p.nextNormal.y-p.prevNormal.y*p.nextNormal.x?1:-1)}function c(a){r.vertex(p);1===a?(p.leftEntry0=p.entry0,p.leftEntry1=p.entry1,p.leftEntry2=p.entry2,p.leftExit0=p.exit0,p.leftExit1=p.exit1,p.leftExit2=p.exit2):2===a&&(p.rightEntry0=p.entry0,p.rightEntry1=p.entry1,p.rightEntry2=p.entry2,p.rightExit0=p.exit0,p.rightExit1=p.exit1,p.rightExit2=p.exit2)}
function l(a){r.vertex(p);1===a?(p.leftEntry0=p.entry0,p.leftEntry2=p.entry2,p.leftExit0=p.exit0,p.leftExit2=p.exit2):2===a&&(p.rightEntry0=p.entry0,p.rightEntry2=p.entry2,p.rightExit0=p.exit0,p.rightExit2=p.exit2)}Object.defineProperty(d,"__esModule",{value:!0});b=function(){return function(){this.isCap=this.isLastVertex=this.isFirstVertex=this.closed=void 0;this.currentVertex={x:void 0,y:void 0};this.inbound={x:void 0,y:void 0};this.outbound={x:void 0,y:void 0};this.prevNormal={x:void 0,y:void 0};
this.nextNormal={x:void 0,y:void 0};this.bisector={x:void 0,y:void 0};this.leftInner={x:void 0,y:void 0};this.rightInner={x:void 0,y:void 0};this.leftOuter={x:void 0,y:void 0};this.rightOuter={x:void 0,y:void 0}}}();d.TessellationState=b;d.tessellate=function(b,d,e){n.trackDistance=null!=d.trackDistance?d.trackDistance:!1;n.wrapDistance=null!=d.wrapDistance?d.wrapDistance:65535;n.thin=null!=d.thin?d.thin:!1;n.initialDistance=null!=d.initialDistance?d.initialDistance:0;n.enableOuterBisectorSplit=null!=
d.enableOuterBisectorSplit?d.enableOuterBisectorSplit:!1;n.outerBisectorAutoSplitThreshold=null!=d.outerBisectorAutoSplitThreshold?d.outerBisectorAutoSplitThreshold:0;n.enableInnerBisectorSplit=null!=d.enableOuterBisectorSplit?d.enableOuterBisectorSplit:!1;n.innerBisectorAutoSplitThreshold=null!=d.innerBisectorAutoSplitThreshold?d.innerBisectorAutoSplitThreshold:0;k=b;r=e;t=x=g=0;u=!1;A=y=null;p.currentVertex.x=null;p.currentVertex.y=null;p.distance=n.initialDistance;b=k[0];d=k[k.length-1];p.canSplit=
!1;p.closed=b.x===d.x&&b.y===d.y;if(!(2>k.length||2===k.length&&p.closed))if(n.thin)if(n.trackDistance)for(a(),q(),l(1);x-t>n.wrapDistance||g<k.length;)a(),q(),l(2),r.bridge(p),p.leftExit0=p.rightExit0,p.leftExit2=p.rightExit2;else for(;g<k.length;)0<g&&(p.inbound.x=p.outbound.x,p.inbound.y=p.outbound.y),g<k.length-1?(p.outbound.x=k[g+1].x-k[g].x,p.outbound.y=k[g+1].y-k[g].y,b=Math.sqrt(p.outbound.x*p.outbound.x+p.outbound.y*p.outbound.y),p.distance+=b,p.outbound.x/=b,p.outbound.y/=b):(p.outbound.x=
p.inbound.x,p.outbound.y=p.inbound.y),0===g&&(p.inbound.x=p.outbound.x,p.inbound.y=p.outbound.y),p.currentVertex.x=k[g].x,p.currentVertex.y=k[g].y,p.prevNormal.x=-p.inbound.y,p.prevNormal.y=p.inbound.x,p.nextNormal.x=-p.outbound.y,p.nextNormal.y=p.outbound.x,0===g?(r.vertex(p),p.leftEntry0=p.entry0,p.leftEntry2=p.entry2,p.leftExit0=p.exit0,p.leftExit2=p.exit2):(r.vertex(p),p.rightEntry0=p.entry0,p.rightEntry2=p.entry2,p.rightExit0=p.exit0,p.rightExit2=p.exit2,r.bridge(p),p.leftExit0=p.rightExit0,
p.leftExit2=p.rightExit2),++g;else{if(n.enableOuterBisectorSplit||0<n.outerBisectorAutoSplitThreshold||n.enableInnerBisectorSplit||0<n.innerBisectorAutoSplitThreshold)for(p.canSplit=!0,a(),m(),p.splitInner=p.gapInner=p.splitOuter=p.gapOuter=!1,c(1),p.closure0=p.leftEntry0,p.closure1=p.leftEntry1,p.closure2=p.leftEntry2;x-t>n.wrapDistance||g<k.length-1||g<k.length&&(!p.closed||n.trackDistance);)a(),m(),p.splitInner=p.gapInner=p.splitOuter=p.gapOuter=!1,c(2),r.bridge(p),p.leftExit0=p.rightExit0,p.leftExit1=
p.rightExit1,p.leftExit2=p.rightExit2;else for(a(),m(),c(1),p.closure0=p.leftEntry0,p.closure1=p.leftEntry1,p.closure2=p.leftEntry2;x-t>n.wrapDistance||g<k.length-1||g<k.length&&(!p.closed||n.trackDistance);)a(),m(),c(2),r.bridge(p),p.leftExit0=p.rightExit0,p.leftExit1=p.rightExit1,p.leftExit2=p.rightExit2;p.closed&&!n.trackDistance&&(p.rightEntry0=p.closure0,p.rightEntry1=p.closure1,p.rightEntry2=p.closure2,r.bridge(p),p.leftExit0=p.rightExit0,p.leftExit1=p.rightExit1,p.leftExit2=p.rightExit2)}};
d.cleanup=function(){r=k=null};d.splitVertex=e;var k,n={},r,g=void 0,x,t,u,y,A,p=new b;b=function(){function a(a,b){this.writeVertex=a;this.writeTriangle=b;this.capType=f.CapType.BUTT;this.joinType=f.JoinType.MITER;this.miterLimitCosine=h.getLimitCosine(2);this.roundLimitCosine=Math.cos(23*Math.PI/180);this.almostParallelCosine=.97;this.radsPerSlice=.8;this.joinOnUTurn=this.textured=!1}a.prototype.vertex=function(a){var b=this.joinType===f.JoinType.MITER?this.miterLimitCosine:this.roundLimitCosine,
c=a.isCap&&this.capType!==f.CapType.BUTT,d=!1;a.cosine>this.almostParallelCosine?(a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):a.cosine<1-this.almostParallelCosine?(d=!a.isCap&&this.joinOnUTurn,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,
a.prevNormal.y,0,-1,a.distance),a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.canSplit?(e(),0<a.sign?(a.splitInner?(a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,a.leftInner.x,
a.leftInner.y,0,-1,a.distance),a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.rightInner.x,a.rightInner.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.cosine<b?(d=!a.isCap,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,
0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.splitOuter?(d=d||a.gapOuter,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,-a.leftOuter.x,-a.leftOuter.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,-a.rightOuter.x,-a.rightOuter.y,0,1,a.distance)):a.entry2=a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):(a.splitInner?
(a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,-a.leftInner.x,-a.leftInner.y,0,1,a.distance),a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,-a.rightInner.x,-a.rightInner.y,0,1,a.distance)):a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance),a.cosine<b?(d=!a.isCap,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,
a.prevNormal.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance)):a.splitOuter?(d=d||a.gapOuter,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.leftOuter.x,a.leftOuter.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,a.rightOuter.x,a.rightOuter.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,
0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance))):0<a.sign?(a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.cosine<b?(d=!a.isCap,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.entry2=a.exit2=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):(a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance),a.cosine<b?(d=!a.isCap,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance));b=a.canSplit&&(a.splitInner||a.splitOuter)||d||c?a.entry1=a.exit1=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,0,0,0,0,a.distance):a.entry1=a.exit1=null;if(d&&this.joinType!==f.JoinType.ROUND)this.writeTriangle(b,0<a.sign?a.exit2:a.entry0,0<a.sign?a.entry2:a.exit0);else if(c&&this.capType===f.CapType.ROUND||d&&this.joinType===f.JoinType.ROUND){var g=d=c=void 0,k=void 0,h=void 0,l=void 0;if(a.isCap){var m=
Math.PI,h=Math.ceil(m/this.radsPerSlice),l=m/h;a.isFirstVertex?(c=a.prevNormal.x,d=a.prevNormal.y,g=a.entry0,k=a.entry2):a.isLastVertex&&(c=-a.nextNormal.x,d=-a.nextNormal.y,g=a.exit2,k=a.exit0)}else m=2*Math.acos(a.cosine),h=Math.ceil(m/this.radsPerSlice),l=m/h,c=0<a.sign?-a.prevNormal.x:a.nextNormal.x,d=0<a.sign?-a.prevNormal.y:a.nextNormal.y,g=0<a.sign?a.entry2:a.exit0,k=0<a.sign?a.exit2:a.entry0;for(var m=Math.cos(l),l=Math.sin(l),n=l*c+m*d,c=m*c-l*d,d=n,p,n=void 0,q=0;q<h;++q)p=n,q<h-1&&(n=a.isCap?
this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,c,d,a.isFirstVertex?-1:1,0,a.distance):this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,c,d,0,a.sign,a.distance)),this.writeTriangle(0===q?g:p,b,q===h-1?k:n),p=l*c+m*d,c=m*c-l*d,d=p}else c&&this.capType===f.CapType.SQUARE&&(c=a.isFirstVertex?1:-1,g=d=void 0,this.textured?(d=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x-c*a.inbound.x,a.prevNormal.y-c*a.inbound.y,-c,-1,a.distance),g=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.prevNormal.x-c*a.inbound.x,-a.prevNormal.y-c*a.inbound.y,-c,1,a.distance)):(d=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x-c*a.inbound.x,a.prevNormal.y-c*a.inbound.y,0,-1,a.distance),g=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x-c*a.inbound.x,-a.prevNormal.y-c*a.inbound.y,0,1,a.distance)),0<c?(this.writeTriangle(b,a.entry2,g),this.writeTriangle(b,g,d),this.writeTriangle(b,d,a.entry0)):(this.writeTriangle(b,g,a.exit2),
this.writeTriangle(b,d,g),this.writeTriangle(b,a.exit0,d)))};a.prototype.bridge=function(a){this.writeTriangle(a.leftExit0,a.rightEntry0,null!=a.leftExit1?a.leftExit1:a.leftExit2);this.writeTriangle(a.rightEntry0,null!=a.rightEntry1?a.rightEntry1:a.rightEntry2,null!=a.leftExit1?a.leftExit1:a.leftExit2);null!=a.leftExit1&&null!=a.rightEntry1?(this.writeTriangle(a.leftExit1,a.rightEntry1,a.leftExit2),this.writeTriangle(a.rightEntry1,a.rightEntry2,a.leftExit2)):null!=a.leftExit1?this.writeTriangle(a.leftExit1,
a.rightEntry2,a.leftExit2):null!=a.rightEntry1&&this.writeTriangle(a.rightEntry1,a.rightEntry2,a.leftExit2)};return a}();d.StandardTessellationCallbacks=b;b=function(){function a(a,b){this.writeVertex=a;this.writeTriangle=b}a.prototype.vertex=function(a){a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance);a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance);a.exit0=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance);a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)};a.prototype.bridge=function(a){this.writeTriangle(a.leftExit0,a.rightEntry0,a.leftExit2);this.writeTriangle(a.rightEntry0,a.rightEntry2,a.leftExit2)};return a}();d.ThinTessellationCallbacks=b})},"esri/views/2d/engine/webgl/mesh/factories/matcherUtils":function(){define("require exports ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/Error ../../../../../../core/Logger ../../util/Matcher".split(" "),
function(b,d,f,h,e,a,q){Object.defineProperty(d,"__esModule",{value:!0});var m=a.getLogger("esri/views/2d/engine/webgl/mesh/factories/matcherUtils");d.createMatcher=function(a,b,d){return h(this,void 0,void 0,function(){return f(this,function(c){if(!d)return[2,new q.GraphicMatcher(a)];switch(d.type){case "simple":case "dot-density":return[2,q.FeatureMatcher.fromBasicRenderer(d,a,b)];case "unique-value":return[2,q.MapMatcher.fromUVRenderer(d,a,b)];case "class-breaks":return[2,q.IntervalMatcher.fromCBRenderer(d,
a,b)];case "dictionary":return[2,q.DictionaryMatcher.fromDictionaryRenderer(d,a,b)];default:return m.error(new e("mapview-mesh:invalid-renderer","Unable to handle unknown renderer type")),[2,null]}})})}})},"esri/views/2d/engine/webgl/util/Matcher":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/Error ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../support/arcadeOnDemand ../../../../../symbols/support/cimSymbolUtils ../../../arcade/utils".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r){function g(a,b){return e(this,void 0,void 0,function(){var c,d;return h(this,function(e){switch(e.label){case 0:return c=a||1,"number"===typeof c?[2,function(a,b,d){return c}]:[4,k.createRendererExpression(c,b.spatialReference,b.fields)];case 1:return d=e.sent(),[2,function(a,c,e){return r.callWithFeature(d,a,{$view:e},b.geometryType,c)||1}]}})})}Object.defineProperty(d,"__esModule",{value:!0});var x=m.getLogger("esri/views/2d/engine/webgl/util/Matcher");b=function(){function a(){this._defaultResult=
null}a.fromBasicRenderer=function(b,c,d){return e(this,void 0,void 0,function(){var e,g,f;return h(this,function(k){switch(k.label){case 0:return[4,n.expandSymbols(b.getSymbols(),b,d)];case 1:return e=k.sent(),g=new a,e.length?[4,c.createTemplateGroup(e[0],null,b)]:[3,3];case 2:f=k.sent(),g.setDefault(f),k.label=3;case 3:return[2,g]}})})};a.prototype.size=function(){return 1};a.prototype.getDefault=function(){return this._defaultResult};a.prototype.setDefault=function(a){this._defaultResult=a};a.prototype.match=
function(a,b,c,d,e){return this.getDefault()};a.prototype.analyze=function(a,b,c,d,g){return e(this,void 0,void 0,function(){return h(this,function(a){return[2]})})};return a}();d.FeatureMatcher=b;m=function(a){function b(b,c,d,e){var g=a.call(this)||this;g._intervals=[];g._isMaxInclusive=c;e?g._getValue=r.callWithFeature.bind(null,e):b&&b.length?"function"===typeof b?(g._field=null,g._getValue=b):(g._field=b,g._normalizationInfo=d,g._getValue=g._getValueFromField.bind(g)):g._field=null;return g}
f(b,a);b.fromCBRenderer=function(a,c,d){return e(this,void 0,void 0,function(){var g,f,m,p,q,r,t,y,u,A,J,x,I,M=this;return h(this,function(w){switch(w.label){case 0:return g=a.isMaxInclusive,f=a.normalizationField,m=a.normalizationTotal,p=a.normalizationType,q=a.field,r={normalizationField:f,normalizationTotal:m,normalizationType:p},(u=t=a.valueExpression)?[4,k.createRendererExpression(t,d.spatialReference,d.fields)]:[3,2];case 1:u=w.sent(),w.label=2;case 2:return y=u,A=new b(q,g,r,y),[4,n.expandSymbol(a.backgroundFillSymbol,
a,d)];case 3:return J=w.sent(),[4,l.all(a.classBreakInfos.map(function(b){return e(M,void 0,void 0,function(){var e,g,f;return h(this,function(k){switch(k.label){case 0:return[4,n.expandSymbol(b.symbol,a,d)];case 1:return e=k.sent(),[4,c.createTemplateGroup(e,J,a)];case 2:return g=k.sent(),f={min:b.minValue,max:b.maxValue},A.add(f,g),[2]}})})}))];case 4:return w.sent(),[4,n.expandSymbol(a.defaultSymbol,a,d)];case 5:return(x=w.sent())?[4,c.createTemplateGroup(x,J,a)]:[3,7];case 6:I=w.sent(),A.setDefault(I),
w.label=7;case 7:return[2,A]}})})};b.prototype.add=function(a,b){this._intervals.push({interval:a,result:b});this._intervals.sort(function(a,b){return a.interval.min-b.interval.min})};b.prototype.size=function(){return a.prototype.size.call(this)+this._intervals.length};b.prototype.match=function(a,b,c,d,e){if(!this._getValue)return this.getDefault();a=this._getValue(b,{$view:e},c,d);if(!a&&(null===a||void 0===a||isNaN(a)))return this.getDefault();for(b=0;b<this._intervals.length;b++)if(d=this._intervals[b],
c=d.interval,d=d.result,e=this._isMaxInclusive?a<=c.max:a<c.max,a>=c.min&&e)return d;return this.getDefault()};b.prototype._needsNormalization=function(){var a=this._normalizationInfo;return a&&(a.normalizationField||a.normalizationTotal||a.normalizationType)};b.prototype._getValueFromField=function(a){var b=a.attributes[this._field];if(!this._needsNormalization())return b;var c=this._normalizationInfo,d=c.normalizationField,e=c.normalizationTotal,c=c.normalizationType;a=!!d&&a.attributes[d];if(c)switch(c){case "field":return(a||
void 0)&&b/a;case "log":return Math.log(b)*Math.LOG10E;case "percent-of-total":return b/e*100;default:x.error("Found unknown normalization type: "+c)}else x.error("Normalization is required, but no type was set!")};return b}(b);d.IntervalMatcher=m;m=function(a){function b(b,c,d){var e=a.call(this)||this;e._nullResult=null;e._resultsMap=new Map;d?e._getValue=r.callWithFeature.bind(null,d):b&&b.length?"function"===typeof b[0]?(e._fields=null,e._getValue=b[0]):(e._fields=b,e._seperator=c||"",e._getValue=
e._getValueFromFields.bind(e)):e._fields=null;return e}f(b,a);b.fromUVRenderer=function(a,c,d){return e(this,void 0,void 0,function(){var g,f,m,p,q,r,t,y,u,A,J=this;return h(this,function(w){switch(w.label){case 0:return g=a.uniqueValueInfos,f=a.fieldDelimiter,m=[a.field],p=a.valueExpression,a.field2&&m.push(a.field2),a.field3&&m.push(a.field3),[4,n.expandSymbol(a.backgroundFillSymbol,a,d)];case 1:return q=w.sent(),(t=p)?[4,k.createRendererExpression(p,d.spatialReference,d.fields)]:[3,3];case 2:t=
w.sent(),w.label=3;case 3:return r=t,y=new b(m,f,r),[4,l.all(g.map(function(b){return e(J,void 0,void 0,function(){var e,g;return h(this,function(f){switch(f.label){case 0:return[4,n.expandSymbol(b.symbol,a,d)];case 1:return e=f.sent(),[4,c.createTemplateGroup(e,q,a)];case 2:return g=f.sent(),"\x3cNull\x3e"===b.value?y.setNullResult(g):y.add(b.value,g),[2]}})})}))];case 4:return w.sent(),[4,n.expandSymbol(a.defaultSymbol,a,d)];case 5:return(u=w.sent())?[4,c.createTemplateGroup(a.defaultSymbol,q,a)]:
[3,7];case 6:A=w.sent(),y.setDefault(A),w.label=7;case 7:return[2,y]}})})};b.prototype.setNullResult=function(a){this._nullResult=a};b.prototype.add=function(a,b){this._resultsMap.set(a.toString(),b)};b.prototype.size=function(){return a.prototype.size.call(this)+this._resultsMap.size};b.prototype.match=function(a,b,c,d,e){if(!this._getValue)return this.getDefault();a=this._getValue(b,{$view:e},c,d);if(null!==this._nullResult&&(null==a||""===a||"\x3cNull\x3e"===a))return this._nullResult;if(!a&&null==
a)return this.getDefault();a=a.toString();return this._resultsMap.has(a)?this._resultsMap.get(a):this.getDefault()};b.prototype._getValueFromFields=function(a){for(var b=[],c=0,d=this._fields;c<d.length;c++)b.push(a.attributes[d[c]]);return b.join(this._seperator)};return b}(b);d.MapMatcher=m;m=function(b){function c(a,c,d,e){var g=b.call(this)||this;g._fidToAttributeHash=new Map;g._attributeHashToGroup=new Map;g._renderer=a;g._fieldMap=a.fieldMap;g._templates=c;g._info=d;g._scaleFn=e;return g}f(c,
b);c.fromDictionaryRenderer=function(a,b,d){return e(this,void 0,void 0,function(){var e;return h(this,function(f){switch(f.label){case 0:return a.fetchResources({spatialReference:d.spatialReference,fields:d.fields}),[4,g(a.scaleExpression,d)];case 1:return e=f.sent(),[2,new c(a,b,d,e)]}})})};c.prototype._analyzeFeature=function(b,c,d,g,f){return e(this,void 0,void 0,function(){var e,k,l,m,p,r,t,y,J,u,w,A;return h(this,function(h){switch(h.label){case 0:e=b.attributes[c];k=this._fidToAttributeHash.get(e);
l=this._hashAttributes(b);if(k===l)return[2];if(m=this._attributeHashToGroup.has(l))return[3,4];p=a({},g,{spatialReference:this._info.spatialReference,abortOptions:f,fields:this._info.fields});r=this._scaleFn(b,d,g);return[4,this._renderer.getSymbolAsync(b,p)];case 1:return t=h.sent(),[4,n.expandSymbol(t,this._renderer,this._info,f)];case 2:y=h.sent();if("expanded-cim"!==y.type)return x.error(new q("mapview-bad-type","Found unexpected type "+y.type+" in dictionary response")),[2];J=0;for(u=y.layers;J<
u.length;J++)w=u[J],w.scaleFactor=r,w.templateHash+="-"+r;return[4,this._templates.createTemplateGroup(y,null,this._renderer)];case 3:A=h.sent(),this._attributeHashToGroup.set(l,A),h.label=4;case 4:return this._fidToAttributeHash.set(e,l),[2]}})})};c.prototype.analyze=function(a,b,c,d,g){return e(this,void 0,void 0,function(){var e,f=this;return h(this,function(k){switch(k.label){case 0:return e=b.map(function(b){return f._analyzeFeature(b,a,c,d,g)}),[4,l.all(e)];case 1:return k.sent(),[2]}})})};
c.prototype.match=function(a,b){a=this._fidToAttributeHash.get(b.attributes[a]);return this._attributeHashToGroup.get(a)};c.prototype._hashAttributes=function(a){var b="",c;for(c in this._fieldMap)b+=". "+a.attributes[this._fieldMap[c]];return b};return c}(b);d.DictionaryMatcher=m;b=function(a){function b(b){var c=a.call(this)||this;c._templates=b;return c}f(b,a);b.prototype.match=function(a,b){return c.isNone(b.symbol)?0:b.groupId?b.groupId:this._templates.createTemplateGroup(b.symbol,null,null)};
return b}(b);d.GraphicMatcher=b})},"esri/views/2d/engine/webgl/mesh/factories/WGLMeshFactory":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/Error ../../../../../../core/has ../../../../../../core/Logger ../../../../../../core/maybe ../../../../../../core/promiseUtils ../../../../../../geometry/support/jsonUtils ../../../../../../symbols/SimpleLineSymbol ../../definitions ../../enums ../../WGLDisplayObject ../MeshData ../VertexVector ../templates/WGLLabelTemplate ../templates/WGLLineTemplate ../templates/WGLMarkerTemplate ../templates/WGLTemplateStore".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,x,t,u,y,A,p,w){Object.defineProperty(d,"__esModule",{value:!0});var v=m.getLogger("esri.views.2d.engine.webgl.WGLMeshFactory"),z={esriGeometryPoint:"above-right above-center above-left center-center center-left center-right below-center below-left below-right".split(" "),esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};b=function(){function b(a,b,d,e,g,f){this._isDD=!1;this._labelsDebugTemplate=
null;this._isDD=c.isSome(d)&&"dot-density"===d.type;this._geometryType=a;this._idField=b;this._templateStore=e;this._setLabelTemplates(g,d,f)}b.prototype.update=function(a,b,d){this._isDD=c.isSome(b)&&"dot-density"===b.type;this._setLabelTemplates(a,b,d)};b.prototype._setLabelTemplates=function(a,b,c){a&&this._validateLabelingInfo(a)&&(this._labelTemplates=a.map(function(a){return y.default.fromLabelClass(b,a,c)}))};Object.defineProperty(b.prototype,"templates",{get:function(){return this._templateStore},
enumerable:!0,configurable:!0});b.prototype.createMeshData=function(a){var b=Array(5),c=this._labelTemplates&&0<this._labelTemplates.length,d="esriGeometryPolyline"===this._geometryType?r.HEURISTIC_GLYPHS_PER_LINE:r.HEURISTIC_GLYPHS_PER_FEATURE;b[g.WGLGeometryType.MARKER]=new u.VertexVectors(g.WGLGeometryType.MARKER,a);b[g.WGLGeometryType.FILL]=new u.VertexVectors(g.WGLGeometryType.FILL,a,this._isDD);b[g.WGLGeometryType.LINE]=new u.VertexVectors(g.WGLGeometryType.LINE,a);b[g.WGLGeometryType.TEXT]=
new u.VertexVectors(g.WGLGeometryType.TEXT,a);b[g.WGLGeometryType.LABEL]=new u.VertexVectors(g.WGLGeometryType.LABEL,c?d:0);return new t.MeshData([],b)};b.prototype.analyze=function(a,b,d,g,f){return e(this,void 0,void 0,function(){var e,k,m,n,q,p,r,t,y;return h(this,function(h){switch(h.label){case 0:return e=a,l.isAborted(f)?[2,[]]:c.isSome(b)?[4,b.analyze(this._idField,a,d,g,f)]:[3,2];case 1:h.sent(),h.label=2;case 2:k=0;for(m=e;k<m.length;k++){n=m[k];q=n.groupId;if(null==q||-1===q)q=b.match(this._idField,
n,this._geometryType,d,g);if(w.isDynamicId(q))for(p=this._templateStore.getDynamicTemplateGroup(q),r=0,t=p;r<t.length;r++)(y=t[r])&&y.analyze&&y.analyze(this._templateStore,n,d,g);n.groupId=q}return[2,this._templateStore.finalize(f).then(function(){return e})]}})})};b.prototype.write=function(a,b,d,e,g,f){var h=this._templateStore.getTemplateGroup(b.groupId),l=b.localId;if(null==l)q("esri-2d-debug")&&console.debug("Got null id for feature");else{var m=new x(l);if(w.isDynamicId(b.groupId))for(var n=
0;n<h.length;n++){var p=h[n];p.bindFeature(b,d,e)}if(h&&(b.geometry||b.centroid)){d=m.displayRecords;p=b.insertAfter;void 0!==p&&(m.insertAfter=p);(e=this._geometryType)||(e=null!=b.centroid?"esriGeometryPolygon":k.getJsonType(b.geometry));for(n=0;n<h.length;n++){var p=h[n],r=a.get(p.geometryType);p.writeMesh(d,r,e,l,b)}c.isSome(f)&&(h=f&&this._findLabelRef(h),this._writeLabels(m,a,l,b,f,h,g));a.pushDisplayObject(m)}}};b.prototype._hasBadLabelClass=function(b,c){var d=b.labelPlacement,e=z[c];if(!b.symbol)return v.warn("No LabelClass symbol specified."),
!0;if(!e)return v.error(new a("mapview-labeling:unsupported-geometry-type","Unable to create labels for Feature Layer, "+c+" is not supported")),!0;e.some(function(a){return a===d})||(e=e[0],d&&v.warn("Found invalid label placement type "+d+" for "+c+". Defaulting to "+e),b.labelPlacement=e);return!1};b.prototype._validateLabelingInfo=function(a){var b=this;return!a.some(function(a){return b._hasBadLabelClass(a,b._geometryType)})};b.prototype._findLabelRef=function(a){for(var b=0;b<a.length;b++){var c=
a[b];if(c instanceof p.default)return c}return null};b.prototype._writeLabels=function(a,b,d,e,g,f,k){for(var h=a.displayRecords,l=[],m=0;m<g.length;m++){var n=g[m];if(c.isSome(n)){var q=n.glyphs,p=n.rtl,n=this._labelTemplates[n.classIndex],t=b.get(n.geometryType);n.bindReferenceTemplate(f);n.bindTextInfo(q,p);n.writeMesh(h,t,this._geometryType,d,e,k,l)}}a.metrics=l;r.DEBUG_LABELS&&this._debugLabels(a,b)};b.prototype._debugLabels=function(a,b){var c=a.displayRecords,d=a.id,e=0;for(a=a.metrics;e<a.length;e++)for(var g=
a[e],f=0,k=g.boxes?g.boxes.concat([g.bounds]):[g.bounds];f<k.length;f++){var h=k[f],h={geometry:{paths:[[[g.anchor[0]+g.offsetX+h.center[0]-h.width/2,g.anchor[1]+g.offsetY+h.center[1]+h.height/2],[0,-h.height],[h.width,0],[0,h.height],[-h.width,0]]]},attributes:{}},l=this._getLabelDebugTemplate(),m=b.get(l.geometryType);l.writeMesh(c,m,"esriGeometryPolyline",d,h)}};b.prototype._getLabelDebugTemplate=function(){this._labelsDebugTemplate||(this._labelsDebugTemplate=this._createLabelsDebugTemplate());
return this._labelsDebugTemplate};b.prototype._createLabelsDebugTemplate=function(){var a=new n({style:"solid",width:1,color:[255,0,0,1]});return A.default.fromSimpleLine(null,!1,a,null,!1)};return b}();d.WGLMeshFactory=b})},"esri/views/2d/engine/webgl/WGLDisplayObject":function(){define(["require","exports","./WGLDisplayRecord","./collisions/Metric","./util/serializationUtils"],function(b,d,f,h,e){return function(){function a(a){this.insertAfter=null;this.id=a;this.displayRecords=[];this.metrics=
[]}a.prototype.copy=function(){var b=new a(this.id);b.set(this);return b};a.prototype.clone=function(){var b=new a(this.id);b.displayRecords=this.displayRecords.map(function(a){return a.clone()});b.metrics=this.metrics.map(function(a){return a.clone()});b.insertAfter=this.insertAfter;return b};a.prototype.set=function(a){this.id=a.id;this.displayRecords=a.displayRecords;this.metrics=a.metrics;this.insertAfter=a.insertAfter};a.prototype.serialize=function(a){a.push(this.id);e.serializeList(a,this.metrics);
e.serializeList(a,this.displayRecords);return a};a.deserialize=function(b){var d=b.readInt32(),c=new a(d),d={id:d},l=e.deserializeList(b,h.default);l.length&&(c.metrics=l);c.displayRecords=e.deserializeList(b,f,d);return c};return a}()})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["require","exports","../util/serializationUtils","../util/Writer"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(a,b){this.displayObjects=a;this.vertexVectorsMap=
b}Object.defineProperty(b.prototype,"vertexBuffersMap",{get:function(){if(!this._vertexBuffersMap){this._vertexBuffersMap={};for(var a=0;a<this.vertexVectorsMap.length;a++)this._vertexBuffersMap[a]=this.vertexVectorsMap[a].intoBuffers();this.vertexVectorsMap=null}return this._vertexBuffersMap},enumerable:!0,configurable:!0});b.prototype.get=function(a){return this.vertexVectorsMap[a]};b.prototype.pushDisplayObject=function(a){this.displayObjects.push(a)};b.prototype.encode=function(a,b){var d=f.serializeList(new h.default(Uint32Array,
this._guessSize()),this.displayObjects).buffer(),c={};b.push(d);for(var e=0;e<this.vertexVectorsMap.length;e++){var k=this.vertexVectorsMap[e];c[e]={};k.transfer(c[e],b)}a.displayObjects=d;a.vertexBuffersMap=c;this.destroy()};b.prototype.destroy=function(){this.displayObjects=this.vertexVectorsMap=null};b.prototype._guessSize=function(){for(var a=this.displayObjects,b=Math.min(a.length,4),d=0,c=0;c<b;c++)d=Math.max(d,a[c].displayRecords.length);return 2*(12*a.length+a.length*d*40)};return b}();d.MeshData=
b})},"esri/views/2d/engine/webgl/util/Writer":function(){define(["require","exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(b,d){this._pos=0;d=d?this._roundToNearest(d,b.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(d);this._buffer=new b(this._array);this._ctor=b}Object.defineProperty(b.prototype,"length",{get:function(){return this._pos},enumerable:!0,configurable:!0});b.prototype._roundToNearest=function(b,d){b=Math.round(b);return b+(d-b%d)};
b.prototype._ensureSize=function(b){if(this._pos+b>=this._buffer.length){b=this._roundToNearest(1.5*(this._array.byteLength+b*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);b=new ArrayBuffer(b);var d=new this._ctor(b);d.set(this._buffer,0);this._array=b;this._buffer=d}};b.prototype.writeF32=function(b){this._ensureSize(1);var d=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=b;this._pos++;return d};b.prototype.push=function(b){this._ensureSize(1);var d=this._pos;this._buffer[this._pos++]=
b;return d};b.prototype.writeRegion=function(b){this._ensureSize(b.length);var d=this._pos;this._buffer.set(b,this._pos);this._pos+=b.length;return d};b.prototype.buffer=function(){var b=this._array.slice(0,4*this._pos);this.destroy();return b};b.prototype.seek=function(b){this._pos=b};b.prototype.destroy=function(){this._buffer=this._array=null};return b}();d.default=b})},"esri/views/2d/engine/webgl/mesh/VertexVector":function(){define(["require","exports","../Utils","./VertexBuffer","../util/Writer"],
function(b,d,f,h,e){Object.defineProperty(d,"__esModule",{value:!0});var a=function(){function a(a,b){this.data=a;this.stride=b}Object.defineProperty(a.prototype,"vertexCount",{get:function(){return this.data.length/(this.stride/4)},enumerable:!0,configurable:!0});a.prototype.transfer=function(a,b){var c=this.data.buffer();a.vertexCount=this.vertexCount;a.data=c;a.stride=this.stride;b.push(c)};return a}();d.default=a;b=function(){function b(b,c,d){void 0===d&&(d=!1);this.geometryType=b;this.indexVector=
new e.default(Uint32Array,c);this.namedVectors={};b=f.getStrides(b,d);for(var k in b){d=b[k];var h=void 0;switch(d%4){case 0:case 2:h=new e.default(Uint32Array,d/4*c);break;case 1:case 3:h=new e.default(Uint8Array,d*c)}this.namedVectors[k]=new a(h,d)}}b.prototype.get=function(a){return this.namedVectors[a].data};b.prototype.getVector=function(a){return this.namedVectors[a]};b.prototype.transfer=function(a,b){var c=this.indexVector.buffer(),d={};b.push(c);for(var e in this.namedVectors){var f=this.namedVectors[e];
d[e]={};f.transfer(d[e],b)}a.geometryType=this.geometryType;a.indexBuffer=c;a.namedBuffers=d;this.destroy()};b.prototype.intoBuffers=function(){var a=h.VertexBuffers.fromVertexVectors(this);this.destroy();return a};b.prototype.destroy=function(){this.namedVectors=this.indexVector=null};return b}();d.VertexVectors=b})},"esri/views/2d/engine/webgl/mesh/VertexBuffer":function(){define(["require","exports","../Utils"],function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});var h=function(){function b(a,
b,d){this.data=a;this.stride=b;this.vertexCount=d}b.decode=function(a){var d=f.allocateTypedArrayBufferwithData(a.data,a.stride);return new b(d,a.stride,a.vertexCount)};b.fromVertexVector=function(a){var d=f.allocateTypedArrayBufferwithData(a.data.buffer(),a.stride);return new b(d,a.stride,a.vertexCount)};return b}();d.default=h;b=function(){function b(a,b,d){this.geometryType=a;this.indexBuffer=new Uint32Array(b);this.namedBuffers=d}b.decode=function(a){var d=a.geometryType,e=a.indexBuffer,c={},
f;for(f in a.namedBuffers)c[f]=h.decode(a.namedBuffers[f]);return new b(d,e,c)};b.fromVertexVectors=function(a){var d=a.geometryType,e=a.indexVector.buffer(),c={},f;for(f in a.namedVectors)c[f]=h.fromVertexVector(a.namedVectors[f]);return new b(d,e,c)};return b}();d.VertexBuffers=b})},"esri/views/2d/engine/webgl/mesh/templates/WGLLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../color ../../number ../../Utils ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLMeshTemplate".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r){Object.defineProperty(d,"__esModule",{value:!0});var g=h.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");b=function(b){function d(a,c,d,e,g,f,h,m,n,q,r,t,x,H,J,K){var p=b.call(this)||this;a=l.LineMaterialKey.load(l.createMaterialKey(p.geometryType,a,x));c&&(a.sdf=c.sdf,a.pattern=!0,a.textureBinding=c.textureBinding);p._capType=e;p._joinType=g;p._miterLimitCosine=k.getLimitCosine(f);p.tessellationProperties._fillColor=h;p.tessellationProperties._tl=m;p.tessellationProperties._br=
n;p._hasPattern=q;p._isDashed=r;p._joinOnUTurn=K;p._isColorLocked=t;p._isOutline=x;p._zOrder=J;p._materialKey=a.data;p.tessellationProperties._bitset=t?1:0;p.tessellationProperties._halfWidth=.5*d;p.tessellationProperties._halfReferenceWidth=.5*H;p._initializeTessellator(!1);return p}f(d,b);d.fromCIMLine=function(b,c,g,f,k){var h=c.color,l=c.scaleFactor||1,n=c.isDashed,p=c.cap;n&&p===a.CapType.ROUND&&(p=a.CapType.SQUARE);var r=c.join,l=e.pt2px(c.width)*l,t=e.pt2px(c.referenceWidth),y=e.pt2px(c.miterLimit),
h=h&&q.premultiplyAlphaRGBA(h)||0;if(!g)return new d(b,g,l,p,r,y,h,0,0,!1,n,c.colorLocked,f,t,c.zOrder,k);var u=g.rect,x=u.x+1+g.width,J=u.y+1+g.height,u=m.i1616to32(u.x+1,u.y+1),x=m.i1616to32(x,J);return new d(b,g,l,p,r,y,h,u,x,!0,n,c.colorLocked,f,t,c.zOrder,k)};d.fromSimpleLine=function(a,b,g,f,k){var h=g.color,l="solid"!==g.style&&"none"!==g.style,n=c.getCapType(g.cap||"round",l),p=c.getJoinType(g.join||"round"),h=h&&"none"!==g.style&&q.premultiplyAlphaRGBA(h)||0;"none"===g.style&&(h=0);var r=
e.pt2px(g.width);g=g.miterLimit;if(!f)return new d(a,f,r,n,p,g,h,0,0,!1,l,!1,b,r,0,k);var t=f.rect,y=t.x+1+f.width,u=t.y+1+f.height,t=m.i1616to32(t.x+1,t.y+1),y=m.i1616to32(y,u);return new d(a,f,r,n,p,g,h,t,y,!0,l,!1,b,r,0,k)};d.fromPictureLineSymbol=function(a,b,c,d){g.error("PictureLineSymbol support does not exist!");return null};return d}(n.default(r.default));d.default=b})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/has ../../../../../../core/Logger ../../definitions ../../enums ../../number ../../TileClipper ../../TurboLine ../../WGLDisplayRecord ../../materialKey/MaterialKey".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n){Object.defineProperty(d,"__esModule",{value:!0});var r=e.getLogger("esri.views.2d.engine.webgl.WGLLineTemplateBase"),g=a.TILE_SIZE+16,x=1/3.8,t=new c.TileClipper(0,0,0,1,16);t.setExtent(a.TILE_SIZE);var u=0,y=0,A=0;h("esri-tiles-performance")&&setInterval(function(){console.log("New (FL)","feat\x3d"+A,"secs\x3d"+u,"tris\x3d"+y,"tris/sec\x3d"+Math.round(y/u))},1E4);var p=new Uint32Array(9),w=new Uint32Array(36),v=new Uint32Array(3),z=new Uint32Array(6),B=function(a){return function(b){var c=
Math.ceil(1024*a._halfWidth),d=Math.ceil(1024*a._halfReferenceWidth);b.entry0=a.offset+a.vertexCount++;var g=m.i1616to32(b.distance,c),e=m.i8888to32(Math.round(31*b.prevNormal.x),Math.round(31*b.prevNormal.y),Math.round(0),Math.round(-31)),f=m.i8888to32(0,0,0,a._bitset);w[0]=m.i1616to32(b.currentVertex.x,b.currentVertex.y);w[1]=a.id;w[2]=a._fillColor;w[3]=e;w[4]=g;w[5]=a._tl;w[6]=a._br;w[7]=f;w[8]=m.i1616to32(d,0);b.entry2=a.offset+a.vertexCount++;g=m.i1616to32(b.distance,c);e=m.i8888to32(Math.round(31*
-b.prevNormal.x),Math.round(31*-b.prevNormal.y),Math.round(0),Math.round(31));f=m.i8888to32(0,0,0,a._bitset);w[9]=m.i1616to32(b.currentVertex.x,b.currentVertex.y);w[10]=a.id;w[11]=a._fillColor;w[12]=e;w[13]=g;w[14]=a._tl;w[15]=a._br;w[16]=f;w[17]=m.i1616to32(d,0);b.exit0=a.offset+a.vertexCount++;g=m.i1616to32(b.distance,c);e=m.i8888to32(Math.round(31*b.nextNormal.x),Math.round(31*b.nextNormal.y),Math.round(0),Math.round(-31));f=m.i8888to32(0,0,0,a._bitset);w[18]=m.i1616to32(b.currentVertex.x,b.currentVertex.y);
w[19]=a.id;w[20]=a._fillColor;w[21]=e;w[22]=g;w[23]=a._tl;w[24]=a._br;w[25]=f;w[26]=m.i1616to32(d,0);b.exit2=a.offset+a.vertexCount++;g=m.i1616to32(b.distance,c);e=m.i8888to32(Math.round(31*-b.nextNormal.x),Math.round(31*-b.nextNormal.y),Math.round(0),Math.round(31));f=m.i8888to32(0,0,0,a._bitset);w[27]=m.i1616to32(b.currentVertex.x,b.currentVertex.y);w[28]=a.id;w[29]=a._fillColor;w[30]=e;w[31]=g;w[32]=a._tl;w[33]=a._br;w[34]=f;w[35]=m.i1616to32(d,0);a.geometryBuf.writeRegion(w)}},C=function(a){return function(b){z[0]=
b.leftExit0;z[1]=b.rightEntry0;z[2]=b.leftExit2;z[3]=b.rightEntry0;z[4]=b.rightEntry2;z[5]=b.leftExit2;a.indexCount+=6;a.indexBuf.writeRegion(z)}},D=function(a){return function(b,c,d,g,e,f,k,h,l){l=m.i1616to32(l,Math.ceil(1024*a._halfWidth));e=m.i8888to32(Math.round(31*e),Math.round(31*f),Math.round(31*k),Math.round(31*h));d=m.i8888to32(31*d,31*g,0,a._bitset);p[0]=m.i1616to32(b,c);p[1]=a.id;p[2]=a._fillColor;p[3]=e;p[4]=l;p[5]=a._tl;p[6]=a._br;p[7]=d;p[8]=m.i1616to32(Math.ceil(1024*a._halfReferenceWidth),
0);a.geometryBuf.writeRegion(p);return a.offset+a.vertexCount++}},G=function(a){return function(b,c,d){v[0]=b;v[1]=c;v[2]=d;a.indexCount+=3;a.indexBuf.writeRegion(v)}};d.default=function(b){return function(b){function c(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];a=b.apply(this,a)||this;a.tessellationProperties={_fillColor:null,_tl:null,_br:null,_halfWidth:null,_bitset:null,_halfReferenceWidth:null,id:null,indexBuf:null,indexCount:null,geometryBuf:null,vertexCount:null,offset:null};
a._tessellationOptions={};a.geometryType=q.WGLGeometryType.LINE;return a}f(c,b);c.prototype.writeMesh=function(a,b,c,d,g){var e=b.indexVector,f=b.get("geometry"),h=new k(d,this.geometryType,this._materialKey);b=b.getVector("geometry").vertexCount;h.vertexFrom=b;h.indexFrom=e.length;switch(c){case "esriGeometryPolyline":c=this._clipLines(g.geometry.paths);if(0===c.length)break;this._write(h,e,f,b,d,c);a.push(h);break;case "esriGeometryPolygon":c=this._clipLines(g.geometry.rings);if(0===c.length)break;
this._write(h,e,f,b,d,c);a.push(h);break;default:r.error("Unable to handle geometryType: "+c)}};c.prototype._clipLines=function(a){for(var b=[],c=!1,d=0;d<a.length;){var e=[],f=a[d];t.reset(2);var k=f[0],h=k[0],k=k[1];if(c)t.moveTo(h,k);else{if(-16>h||h>g||-16>k||k>g){c=!0;continue}e.push({x:h,y:k})}for(var l=!1,m=f.length,n=1;n<m;++n)if(h+=f[n][0],k+=f[n][1],c)t.lineTo(h,k);else{if(-16>h||h>g||-16>k||k>g){l=!0;break}e.push({x:h,y:k})}if(l)c=!0;else{if(c){if(e=t.resultWithStarts())for(c=0;c<e.length;c++)b.push(e[c])}else b.push({line:e,
start:0});d++;c=!1}}return b};c.prototype._write=function(a,b,c,d,e,g){var f;h("esri-tiles-performance")&&(f=performance.now());this.tessellationProperties.id=e;this.tessellationProperties.indexBuf=b;this.tessellationProperties.indexCount=0;this.tessellationProperties.geometryBuf=c;this.tessellationProperties.vertexCount=0;this.tessellationProperties.offset=d;for(b=0;b<g.length;b++)c=g[b],d=c.line,2>d.length||(this._tessellationOptions.initialDistance=c.start%65535,this._tessellationCallbacks instanceof
l.StandardTessellationCallbacks&&(this._tessellationCallbacks.capType=this._capType,this._tessellationCallbacks.joinType=this._joinType),l.tessellate(d,this._tessellationOptions,this._tessellationCallbacks),l.cleanup(),h("esri-tiles-performance")&&A++);a.vertexCount=this.tessellationProperties.vertexCount;a.indexCount=this.tessellationProperties.indexCount;a.zOrder=this._zOrder;h("esri-tiles-performance")&&(u+=(performance.now()-f)/1E3,y+=a.indexCount/3)};c.prototype._initializeTessellator=function(b){var c=
n.LineMaterialKey.load(this._materialKey);this._tessellationOptions.trackDistance=this._isDashed||this._hasPattern;this._tessellationOptions.thin=!b&&this.tessellationProperties._halfWidth<a.THIN_LINE_THRESHOLD/2&&!(c.vvSizeFieldStops||c.vvSizeMinMaxValue||c.vvSizeScaleStops||c.vvSizeUnitValue);this._tessellationOptions.wrapDistance=65535;this._tessellationOptions.outerBisectorAutoSplitThreshold=x;this._tessellationOptions.enableOuterBisectorSplit=this._isDashed||this._hasPattern;this._tessellationOptions.innerBisectorAutoSplitThreshold=
x;this._tessellationOptions.enableInnerBisectorSplit=this._isDashed||this._hasPattern;this._tessellationOptions.thin?this._tessellationCallbacks={vertex:B(this.tessellationProperties),bridge:C(this.tessellationProperties)}:(b=new l.StandardTessellationCallbacks(D(this.tessellationProperties),G(this.tessellationProperties)),b.miterLimitCosine=this._miterLimitCosine,b.textured=this._isDashed||this._hasPattern,b.joinOnUTurn=this._joinOnUTurn,this._tessellationCallbacks=b)};return c}(b)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./WGLBaseMarkerTemplate ./WGLMeshTemplate".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,x,t){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function d(d,e,f,k,h,n,t,y,u,x,E,H,J,K,I,M,N,L,Q){var p=b.call(this)||this;p.height=t;p.width=n;p.xOffset=e*Q;p.yOffset=f*Q;e=c.vec2f32.create();f=q.mat2df32.create();E=(K===l.Alignment.MAP?1:0)|(E?1:0)<<1|(J?1:0)<<2|(H?1:0)<<3;H=I&&I.sdf;a.mat2d.translate(f,f,c.vec2f32.fromValues(p.xOffset,-p.yOffset));k&&a.mat2d.rotate(f,f,3.14159265359/180*k);d=g.MarkerMaterialKey.load(g.createMaterialKey(p.geometryType,
d,!1));d.sdf=H;d.pattern=!0;d.textureBinding=I.textureBinding;p._materialKey=d.data;p._fillColor=h;p._outlineColor=u;p._sizeOutlineWidth=r.i8888to32(Math.round(Math.sqrt(256*n)),Math.round(Math.sqrt(256*t)),Math.round(Math.sqrt(256*x)),Math.round(Math.sqrt(256*y)));h=I.rect.x;y=I.rect.y;u=h+I.rect.width;x=y+I.rect.height;M=.5-((.5+M)*I.width+1)/I.rect.width;N=.5-((.5+N)*I.height+1)/I.rect.height;d=Math.round(Math.min(64*L,255));n*=I.rect.width/I.width*L*Q;t*=I.rect.height/I.height*L*Q;I=(M-.5)*n;
N=(N-.5)*t;p._bitestAndDistRatio=r.i8888to32(0,0,E,d);m.vec2.set(e,I,N);m.vec2.transformMat2d(e,e,f);p._offsetUpperLeft=r.i1616to32(16*e[0],16*e[1]);p._texUpperLeft=r.i1616to32(h,y);m.vec2.set(e,I+n,N);m.vec2.transformMat2d(e,e,f);p._offsetUpperRight=r.i1616to32(16*e[0],16*e[1]);p._texUpperRight=r.i1616to32(u,y);m.vec2.set(e,I,N+t);m.vec2.transformMat2d(e,e,f);p._offsetBottomLeft=r.i1616to32(16*e[0],16*e[1]);p._texBottomLeft=r.i1616to32(h,x);m.vec2.set(e,I+n,N+t);m.vec2.transformMat2d(e,e,f);p._offsetBottomRight=
r.i1616to32(16*e[0],16*e[1]);p._texBottomRight=r.i1616to32(u,x);return p}f(d,b);d.fromCIMMarker=function(a,b,c){var g=b.size,f=(c&&c.width||1)/(c&&c.height||1)*b.scaleX,m=b.scaleSymbolsProportionally&&b.frameHeight?g/b.frameHeight:1,n=k.premultiplyAlphaRGBA(b.color),p=k.premultiplyAlphaRGBA(b.outlineColor),q=e.pt2px(g),r=q*f,t=e.pt2px(b.offsetX||0),y=e.pt2px(b.offsetY||0),m=e.pt2px(b.outlineWidth||0)*m,u=b.alignment||l.Alignment.SCREEN,x=e.pt2px(b.referenceSize),w=b.rotation||0;b.rotateClockwise||
(w=-w);var A=0,N=0,L=b.anchorPoint;L&&(b.isAbsoluteAnchorPoint?g&&(A=-L.x/(g*f),N=L.y/g):(A=L.x,N=L.y));return new d(a,t,y,w,n,r,q,x,p,m,b.colorLocked,b.scaleSymbolsProportionally,!1,u,c,A,N,b.sizeRatio,h.unwrapOr(b.scaleFactor,1))};d.fromPictureMarker=function(a,b,c){var g=Math.round(e.pt2px(b.width)),f=Math.round(e.pt2px(b.height)),k=n.PICTURE_FILL_COLOR,h=Math.round(e.pt2px(b.xoffset||0)),m=Math.round(e.pt2px(b.yoffset||0));return new d(a,h,m,b.angle,k,g,f,f,0,0,!1,!1,!1,l.Alignment.SCREEN,c,0,
0,1,1)};d.fromSimpleMarker=function(a,b,c){var g=k.premultiplyAlphaRGBA(b.color),f=Math.round(e.pt2px(b.size)),h=Math.round(e.pt2px(b.xoffset||0)),m=Math.round(e.pt2px(b.yoffset||0)),n=b.style,p=b.outline,q=(p&&p.color&&k.premultiplyAlphaRGBA(p.color))|0,p=(p&&p.width&&Math.round(e.pt2px(p.width)))|0;a=new d(a,h,m,b.angle,g,f,f,f,q,p,!1,!1,"cross"===n||"x"===n,l.Alignment.SCREEN,c,0,0,1.96875,1);a.boundsType="circle"===n?"circle":"square";return a};return d}(x.default(t.default));d.default=b})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../enums ../../number ../../WGLDisplayRecord".split(" "),
function(b,d,f,h,e,a,q){Object.defineProperty(d,"__esModule",{value:!0});var m=h.getLogger("esri.views.2d.engine.webgl.WGLMarkerTemplateBase");d.default=function(b){return function(b){function c(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];a=b.apply(this,a)||this;a.xOffset=0;a.yOffset=0;a.width=0;a.height=0;a.boundsType="square";a.geometryType=e.WGLGeometryType.MARKER;return a}f(c,b);c.prototype.writeMesh=function(a,b,c,d,e){var g=b.indexVector,f=b.get("geometry"),k=new q(d,this.geometryType,
this._materialKey);b=b.getVector("geometry").vertexCount;a.push(k);k.vertexFrom=b;k.indexFrom=g.length;switch(c){case "esriGeometryPoint":c=e.geometry;a=c.x;c=c.y;this._writeVertices(k,f,d,this._getPos(a,c));this._writeIndices(k,g,b);break;case "esriGeometryPolyline":this._writeMany(k,g,f,b,d,e.geometry.paths[0]);break;case "esriGeometryPolygon":(c=e.centroid)?(a=c.x,c=c.y,this._writeVertices(k,f,d,this._getPos(a,c)),this._writeIndices(k,g,b)):m.error("Tried to render polygon geometries as markers, but found no centroid!");
break;case "esriGeometryMultipoint":this._writeMany(k,g,f,b,d,e.geometry.points);break;default:m.error("Unable to handle geometryType: "+c)}};c.prototype._getPos=function(b,c){return a.i1616to32(b,c)};c.prototype._writeMany=function(a,b,c,d,e,f){for(var g=0,k=0,h=0,l=0;l<f.length;l++){var m=f[l],n=m[0],m=m[1],q=this._getPos(n+g,m+k);this._writeVertices(a,c,e,q);this._writeIndices(a,b,d+h);g+=n;k+=m;h+=4}};c.prototype._writeVertices=function(a,b,c,d){b.push(d);b.push(this._offsetUpperLeft);b.push(this._texUpperLeft);
b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetUpperRight);b.push(this._texUpperRight);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetBottomLeft);b.push(this._texBottomLeft);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);
b.push(d);b.push(this._offsetBottomRight);b.push(this._texBottomRight);b.push(this._bitestAndDistRatio);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);a.vertexCount+=4};c.prototype._writeIndices=function(a,b,c){b.push(c+0);b.push(c+1);b.push(c+2);b.push(c+1);b.push(c+3);b.push(c+2);a.indexCount+=6};return c}(b)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTemplateStore":function(){define("require exports ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/support/defaults ./WGLDynamicLineTemplate ./WGLDynamicMarkerTemplate ./WGLDynamicTextTemplate ./WGLFillTemplate ./WGLLineTemplate ./WGLMarkerTemplate ./WGLTextTemplate ../../util/Lock ../../util/Result ../../../../layers/features/textUtils".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,x,t,u,y){function A(a,b){var c=a.length;a.push(null);b.then(function(b){return a[c]=b});return a}function p(a){return!!(a&1)}Object.defineProperty(d,"__esModule",{value:!0});var w=a.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),v=[];d.isDynamicId=p;b=function(){function a(a,b){this._templateIdCounter=this._idCounter=1;this._idToTemplateGroup=new Map;this._symbolToTemplate=new Map;this._fetchQueue=[];this._idToResolver=new Map;this._cimTemplateCache=
new Map;this._cimAnalyses=[];this._lock=new t.default;this._fetchResource=a;this._joinOnUTurn=b}Object.defineProperty(a.prototype,"_markerError",{get:function(){return this._errorTemplates.marker[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_fillError",{get:function(){return this._errorTemplates.fill[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_lineError",{get:function(){return this._errorTemplates.line[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"_textError",{get:function(){return this._errorTemplates.line[0]},enumerable:!0,configurable:!0});a.prototype.createTemplateGroup=function(a,b,c){this._initErrorTemplates();var d=a.hash();if(this._symbolToTemplate.has(d)&&"expanded-cim"!==a.type)return this._symbolToTemplate.get(d);var e=[];b&&this._createMeshTemplates(e,b,c,!0);this._createMeshTemplates(e,a,c,!1);a=this._createGroupId("expanded-cim"===a.type);this._idToTemplateGroup.set(a,e);this._symbolToTemplate.set(d,a);return a};a.prototype.getTemplateGroup=
function(a){return this._idToTemplateGroup.has(a)?this._idToTemplateGroup.get(a):v};a.prototype.getDynamicTemplateGroup=function(a){if(!this._idToTemplateGroup.has(a))return v;p(a)||w.error("mapview-template-store","Id "+a+" does not refer to a dynamic template");return this._idToTemplateGroup.get(a)};a.prototype.getMosaicItem=function(a,b,c){var d=this,e=this._createTemplateId(),g=q.create(function(a){return d._idToResolver.set(e,a)});a=b?a.toJSON():a;this._fetchQueue.push({symbol:a,id:e,glyphIds:c});
return g};a.prototype.finalize=function(a){return this._fetchQueue.length||this._lock.isHeld()?t.withLock(this._lock,this._fetchAllQueuedResources.bind(this),a):q.resolve()};a.prototype._initErrorTemplates=function(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],m.errorPolygonSymbol2D,null,!1),marker:this._createMeshTemplates([],m.errorPointSymbol2D,null,!1),line:this._createMeshTemplates([],m.errorPolylineSymbol2D,null,!1)})};a.prototype._fetchAllQueuedResources=
function(a){var b=this;if(!this._fetchQueue.length)return q.resolve();var c=this._fetchQueue,d=this._cimAnalyses;this._fetchQueue=[];this._cimAnalyses=[];return q.all(d).then(function(){return b._fetchResource(c,a).then(function(a){for(var c=0;c<a.length;c++){var d=a[c],e=d.id,d=d.mosaicItem;b._idToResolver.get(e)(d);b._idToResolver.delete(e)}})}).catch(function(a){q.isAbortError(a)?b._fetchQueue=b._fetchQueue.concat(c):w.error(new e("mapview-template-store","Unable to fetch requested texture resources",
a))})};a.prototype._createGroupId=function(a){return this._idCounter++<<1|(a?1:0)};a.prototype._createTemplateId=function(){return this._templateIdCounter++};a.prototype._createSMS=function(a,b){return f(this,void 0,void 0,function(){var c;return h(this,function(d){switch(d.label){case 0:return[4,this.getMosaicItem(a,!0)];case 1:return c=d.sent().spriteMosaicItem,u.ok(c,w)?[2,g.default.fromSimpleMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createPMS=function(a,b){return f(this,void 0,void 0,
function(){var c;return h(this,function(d){switch(d.label){case 0:return[4,this.getMosaicItem(a,!0)];case 1:return c=d.sent().spriteMosaicItem,u.ok(c,w)?[2,g.default.fromPictureMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createSFS=function(a,b,c){return f(this,void 0,void 0,function(){var d,e;return h(this,function(g){switch(g.label){case 0:return[4,this.getMosaicItem(a,!0)];case 1:return d=g.sent().spriteMosaicItem,e=a,u.ok(d,w)?[2,n.default.fromSimpleFill(b,e,d,c)]:[2,this._fillError]}})})};
a.prototype._createPFS=function(a,b,c){return f(this,void 0,void 0,function(){var d,e;return h(this,function(g){switch(g.label){case 0:return[4,this.getMosaicItem(a,!0)];case 1:return d=g.sent().spriteMosaicItem,e=a,u.ok(d,w)?[2,n.default.fromPictureFill(b,e,d,c)]:[2,this._fillError]}})})};a.prototype._createSLS=function(a,b,c){return f(this,void 0,void 0,function(){var d,e;return h(this,function(g){switch(g.label){case 0:return[4,this.getMosaicItem(a,!0)];case 1:return d=g.sent().spriteMosaicItem,
e=a,u.ok(d,w)?[2,r.default.fromSimpleLine(b,c,e,d,this._joinOnUTurn)]:[2,this._lineError]}})})};a.prototype._createTS=function(a,b){return f(this,void 0,void 0,function(){var c;return h(this,function(d){switch(d.label){case 0:return[4,this.getMosaicItem(a,!0)];case 1:return c=d.sent().glyphMosaicItems,[2,x.default.fromText(b,a,c)]}})})};a.prototype._createCIMText=function(a,b){return f(this,void 0,void 0,function(){var c;return h(this,function(d){switch(d.label){case 0:return"function"===typeof a.materialHash?
[2,q.resolve(k.default.fromCIMText(b,a))]:[4,this.getMosaicItem(a.cim,!1,y.codepoints(a.text))];case 1:return c=d.sent().glyphMosaicItems,a.cim.mosaicHash=a.materialHash,u.ok(c,w)?[2,x.default.fromCIMText(b,a,c)]:[2,this._textError]}})})};a.prototype._createCIMFill=function(a,b){return f(this,void 0,void 0,function(){var c;return h(this,function(d){switch(d.label){case 0:return a.cim.mosaicHash=a.materialHash,[4,this.getMosaicItem(a.cim,!1)];case 1:return c=d.sent().spriteMosaicItem,u.ok(c,w)?[2,
n.default.fromCIMFill(b,a,c,!1)]:[2,this._fillError]}})})};a.prototype._createCIMLine=function(a,b){return f(this,void 0,void 0,function(){var d;return h(this,function(e){switch(e.label){case 0:if("function"===typeof a.materialHash)return[2,q.resolve(c.default.fromCIMLine(b,a))];a.cim.mosaicHash=a.materialHash;return[4,this.getMosaicItem(a.cim,!1)];case 1:return d=e.sent().spriteMosaicItem,u.ok(d,w)?[2,r.default.fromCIMLine(b,a,d,!1,this._joinOnUTurn)]:[2,this._lineError]}})})};a.prototype._createCIMMarker=
function(a,b){return f(this,void 0,void 0,function(){var c;return h(this,function(d){switch(d.label){case 0:if("function"===typeof a.materialHash)return[2,q.resolve(l.default.fromCIMMarker(b,a))];a.cim.mosaicHash=a.materialHash;return[4,this.getMosaicItem(a.cim,!1)];case 1:return c=d.sent().spriteMosaicItem,u.ok(c,w)?[2,g.default.fromCIMMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createCIM=function(a,b){return f(this,void 0,void 0,function(){var c,d,e=this;return h(this,function(g){c=
a.templateHash;if(this._cimTemplateCache.has(c))return[2,this._cimTemplateCache.get(c)];switch(a.type){case "marker":d=this._createCIMMarker(a,b);break;case "line":d=this._createCIMLine(a,b);break;case "fill":d=this._createCIMFill(a,b);break;case "text":d=this._createCIMText(a,b)}d.then(function(a){return e._cimTemplateCache.set(c,a)});return[2,d]})})};a.prototype._createMeshTemplates=function(a,b,c,d){if(-1!==b.type.indexOf("3d"))return w.error("3D symbols are not supported with MapView"),a;switch(b.type){case "cim":return w.error(new e("mapview-bad-type",
"Found a cim type not yet expanded")),a;case "expanded-cim":d=0;for(b=b.layers;d<b.length;d++)A(a,this._createCIM(b[d],c));return a;case "simple-marker":return A(a,this._createSMS(b,c));case "picture-marker":return A(a,this._createPMS(b,c));case "simple-fill":return A(a,this._createSFS(b,c,d)),b.outline&&A(a,this._createSLS(b.outline,c,!0)),a;case "picture-fill":return A(a,this._createPFS(b,c,d)),b.outline&&A(a,this._createSLS(b.outline,c,!0)),a;case "simple-line":return A(a,this._createSLS(b,c,!1));
case "text":return A(a,this._createTS(b,c));default:return w.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),a}};return a}();d.WGLTemplateStore=b})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../color ../../number ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function c(a,c){var d=b.call(this,c)||this;d._cimLineLayer=c;var g=0;m.isFunction(c.width)||(g=.5*h.pt2px(c.width));d._dynamicPropertyMap.set("_halfWidth",function(a,b,d){return m.isFunction(c.width)?.5*h.pt2px(c.width(a,b,d)):g});m.isFunction(c.cap)?d._dynamicPropertyMap.set("_capType",c.cap):d._capType=c.cap;m.isFunction(c.join)?d._dynamicPropertyMap.set("_joinType",c.join):d._joinType=c.join;if(m.isFunction(c.color))d._dynamicPropertyMap.set("_fillColor",
function(a,b,d){return(a=c.color(a,b,d))&&e.premultiplyAlphaRGBA(a)||0});else{var f=c.color;d._fillColor=f&&e.premultiplyAlphaRGBA(f)||0}m.isFunction(c.miterLimit)?d._dynamicPropertyMap.set("_miterLimitCosine",function(a,b,d){return m.getLimitCosine(c.miterLimit(a,b,d))}):d._miterLimitCosine=m.getLimitCosine(c.miterLimit);d._scaleFactor=c.scaleFactor||1;d._isDashed=c.isDashed;d.tessellationProperties._bitset=c.colorLocked?1:0;d._materialKey=q.createMaterialKey(d.geometryType,a,c.isOutline);d._initializeTessellator(!0);
return d}f(c,b);c.fromCIMLine=function(a,b){return new c(a,b)};c.prototype.bindFeature=function(b,c,d){var e=this;this._dynamicPropertyMap.forEach(function(a,g){e[g]=a(b,c,d)});this._halfWidth*=this._scaleFactor;var g=this._materialCache,f=this._cimLineLayer.materialHash,f=f(b,c,d),f=g.get(f),g=null;f&&k.ok(f.spriteMosaicItem)&&(g=f.spriteMosaicItem);if(g){this._hasPattern=!0;var f=g.rect,h=f.x+1+g.width,l=f.y+1+g.height;this.tessellationProperties._tl=a.i1616to32(f.x+1,f.y+1);this.tessellationProperties._br=
a.i1616to32(h,l)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor;this.tessellationProperties._halfWidth=this._halfWidth;this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;f=q.LineMaterialKey.load(this._materialKey);g&&(f.sdf=g.sdf,f.pattern=!0,f.textureBinding=g.textureBinding);this._materialKey=f.data};return c}(c.default(l.default));d.default=b})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMeshTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/cim/cimAnalyzer ./WGLMeshTemplate".split(" "),
function(b,d,f,h,e,a,q){Object.defineProperty(d,"__esModule",{value:!0});var m=h.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");b=function(b){function c(a){var c=b.call(this)||this;c._ongoingMaterialRequestMap=new Map;c._materialCache=new Map;c._dynamicPropertyMap=new Map;c._cimLayer=a;return c}f(c,b);c.prototype.analyze=function(b,c,d,g){var f=this,k=this._materialCache,h=this._cimLayer.materialHash;if(!h)return m.error("A Dynamic mesh template must have a material hash value or function!"),
e.reject(null);var l="function"===typeof h?h(c,d,g):h;if(k.has(l))return b=k.get(l),e.resolve(b);if(this._ongoingMaterialRequestMap.has(l))return this._ongoingMaterialRequestMap.get(l);c=a.analyzeCIMResource(this._cimLayer.cim,this._cimLayer.materialOverrides);c.mosaicHash=l;b=b.getMosaicItem(c,!1).then(function(a){f._ongoingMaterialRequestMap.delete(l);k.set(l,a);return a}).catch(function(a){f._ongoingMaterialRequestMap.delete(l);m.error(".analyze()",a.message);return null});this._ongoingMaterialRequestMap.set(l,
b);return b};return c}(q.default);d.default=b})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,x,t,u,y,A){Object.defineProperty(d,"__esModule",{value:!0});var p=3.14159265359/180,w=k.vec2f32.create(),v=c.mat2df32.create(),z=e.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");b=function(b){function c(c,d){var e=b.call(this,d)||this;e._cimMarkerLayer=d;t.isFunction(d.color)?e._dynamicPropertyMap.set("_fillColor",function(a,b,c){return r.premultiplyAlphaRGBA(d.color(a,b,c))}):e._fillColor=r.premultiplyAlphaRGBA(d.color);t.isFunction(d.outlineColor)?
e._dynamicPropertyMap.set("_outlineColor",function(a,b,c){return r.premultiplyAlphaRGBA(d.outlineColor(a,b,c))}):e._outlineColor=r.premultiplyAlphaRGBA(d.outlineColor);t.isFunction(d.size)?e._dynamicPropertyMap.set("_size",function(a,b,c){return q.pt2px(d.size(a,b,c))}):e._size=q.pt2px(d.size);t.isFunction(d.scaleX)?e._dynamicPropertyMap.set("_scaleX",d.scaleX):e._scaleX=d.scaleX;t.isFunction(d.offsetX)?e._dynamicPropertyMap.set("xOffset",function(a,b,c){return q.pt2px(d.offsetX(a,b,c))}):e.xOffset=
q.pt2px(d.offsetX);t.isFunction(d.offsetY)?e._dynamicPropertyMap.set("yOffset",function(a,b,c){return q.pt2px(d.offsetY(a,b,c))}):e.yOffset=q.pt2px(d.offsetY);t.isFunction(d.outlineWidth)?e._dynamicPropertyMap.set("_outlineWidth",function(a,b,c){return q.pt2px(d.outlineWidth(a,b,c))}):e._outlineWidth=q.pt2px(d.outlineWidth);t.isFunction(d.rotation)?e._dynamicPropertyMap.set("_angle",d.rotation):e._angle=d.rotation;e._scaleFactor=a.unwrapOr(d.scaleFactor,1);e._bitSet=(d.alignment===n.Alignment.MAP?
1:0)|(d.colorLocked?1:0)<<1|(d.scaleSymbolsProportionally?1:0)<<3;e._materialKey=x.createMaterialKey(e.geometryType,c,!1);return e}f(c,b);c.fromCIMMarker=function(a,b){return new c(a,b)};c.prototype.bindFeature=function(a,b,c){var d=this;this._dynamicPropertyMap.forEach(function(e,g){d[g]=e(a,b,c)});var e=this._cimMarkerLayer.materialHash,e="function"===typeof e?e(a,b,c):e;if((e=this._materialCache.get(e))&&A.ok(e.spriteMosaicItem)&&e.spriteMosaicItem){var e=e.spriteMosaicItem,f=this._cimMarkerLayer.sizeRatio,
n=e.width/e.height*this._scaleX,r=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,t=this._size,y=t*n,u=this.xOffset*this._scaleFactor,B=this.yOffset*this._scaleFactor,C=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/q.pt2px(this._cimMarkerLayer.frameHeight):1,D=this._outlineWidth*C,F=q.pt2px(this._cimMarkerLayer.referenceSize),G=0,C=0,R=this._cimMarkerLayer.anchorPoint;R&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(G=-R.x/(this._size*
n),C=R.y/this._size):(G=R.x,C=R.y));this._sizeOutlineWidth=g.i8888to32(Math.round(Math.sqrt(256*y)),Math.round(Math.sqrt(256*t)),Math.round(Math.sqrt(256*D)),Math.round(Math.sqrt(256*F)));m.mat2d.identity(v);m.mat2d.translate(v,v,k.vec2f32.fromValues(u,-B));r&&m.mat2d.rotate(v,v,p*r);n=e.rect.x;r=e.rect.y;u=n+e.rect.width;B=r+e.rect.height;G=.5-((.5+G)*e.width+1)/e.rect.width;C=.5-((.5+C)*e.height+1)/e.rect.height;y=y*f*this._scaleFactor;t=t*f*this._scaleFactor;f=Math.round(64*f);y*=e.rect.width/
e.width;t*=e.rect.height/e.height;G=(G-.5)*y;C=(C-.5)*t;this._bitestAndDistRatio=g.i8888to32(0,0,this._bitSet,f);l.vec2.set(w,G,C);l.vec2.transformMat2d(w,w,v);this._offsetUpperLeft=g.i1616to32(16*w[0],16*w[1]);this._texUpperLeft=g.i1616to32(n,r);l.vec2.set(w,G+y,C);l.vec2.transformMat2d(w,w,v);this._offsetUpperRight=g.i1616to32(16*w[0],16*w[1]);this._texUpperRight=g.i1616to32(u,r);l.vec2.set(w,G,C+t);l.vec2.transformMat2d(w,w,v);this._offsetBottomLeft=g.i1616to32(16*w[0],16*w[1]);this._texBottomLeft=
g.i1616to32(n,B);l.vec2.set(w,G+y,C+t);l.vec2.transformMat2d(w,w,v);this._offsetBottomRight=g.i1616to32(16*w[0],16*w[1]);this._texBottomRight=g.i1616to32(u,B);t=x.MarkerMaterialKey.load(this._materialKey);t.sdf=e.sdf;t.pattern=!0;t.textureBinding=e.textureBinding;this._materialKey=t.data}else z.error(new h("mapview-cim","Encountered an error when binding feature"))};return c}(u.default(y.default));d.default=b})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/screenUtils ../../alignmentUtils ../../color ../../materialKey/MaterialKey ./util ./WGLBaseTextTemplate ./WGLDynamicMeshTemplate ../../../../layers/features/textUtils".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function d(d,e){var g=b.call(this,e)||this;g._horizontalAlignment="center";g._verticalAlignment="middle";g._textToGlyphs=new Map;var f=e.scaleFactor||1;g._cimTextLayer=e;l.isFunction(e.color)?g._dynamicPropertyMap.set("_color",function(a,b,c){return m.premultiplyAlphaRGBA(e.color(a,b,c))}):g._color=m.premultiplyAlphaRGBA(e.color);l.isFunction(e.color)?g._dynamicPropertyMap.set("_haloColor",function(a,
b,c){return m.premultiplyAlphaRGBA(e.outlineColor(a,b,c))}):g._haloColor=m.premultiplyAlphaRGBA(e.outlineColor);var k;l.isFunction(e.size)||(k=Math.min(Math.round(a.pt2px(e.size*e.sizeRatio)),127));g._dynamicPropertyMap.set("_size",function(b,c,d){return l.isFunction(e.size)?Math.min(Math.round(a.pt2px(e.size(b,c,d)*e.sizeRatio)),127):k});l.isFunction(e.outlineSize)?g._dynamicPropertyMap.set("_haloSize",function(b,c,d){return Math.min(Math.floor(5*a.pt2px(e.outlineSize(b,c,d)*e.sizeRatio)),127)}):
g._haloSize=Math.min(Math.floor(5*a.pt2px(e.outlineSize*e.sizeRatio)),127);var h;l.isFunction(e.offsetX)||(h=Math.round(a.pt2px(e.offsetX*e.sizeRatio)));g._dynamicPropertyMap.set("_xOffset",function(b,c,d){return l.isFunction(e.offsetX)?Math.round(a.pt2px(e.offsetX(b,c,d)*e.sizeRatio)):h});var n;l.isFunction(e.offsetY)||(n=Math.round(a.pt2px(e.offsetY*e.sizeRatio)));g._dynamicPropertyMap.set("_yOffset",function(b,c,d){return l.isFunction(e.offsetY)?Math.round(a.pt2px(e.offsetY(b,c,d)*e.sizeRatio)):
n});l.isFunction(e.angle)?g._dynamicPropertyMap.set("_angle",e.angle):g._angle=e.angle;l.isFunction(e.horizontalAlignment)?g._dynamicPropertyMap.set("_horizontalAlignment",e.horizontalAlignment):g._horizontalAlignment=e.horizontalAlignment;l.isFunction(e.verticalAlignment)?g._dynamicPropertyMap.set("_verticalAlignment",e.verticalAlignment):g._verticalAlignment=e.verticalAlignment;g._scaleFactor=f;l.isFunction(e.text)?g._dynamicPropertyMap.set("_text",e.text):g._text=e.text;f=Math.min(Math.round(a.pt2px(e.referenceSize*
e.sizeRatio)),127);g._referenceSize=Math.round(Math.sqrt(256*f));g._materialKey=c.createMaterialKey(g.geometryType,d,!1);d=c.TextMaterialKey.load(g._materialKey);d.sdf=!0;g._bitset=e.colorLocked?1:0;g._materialKey=d.data;g._decoration="none";g._lineHeight=1;g._lineWidth=512;g._isCIM=!0;return g}f(d,b);d.fromCIMText=function(a,b){return new d(a,b)};d.prototype.analyze=function(a,b,c,d){return e(this,void 0,void 0,function(){var e,g;return h(this,function(f){switch(f.label){case 0:return f=this._cimTextLayer,
e="string"===typeof f.text?f.text:"function"===typeof f.text?f.text(b,c,d):"",[4,a.getMosaicItem(this._cimTextLayer.cim,!1,r.codepoints(e))];case 1:return g=f.sent(),this._textToGlyphs.set(e,g.glyphMosaicItems),[2,g]}})})};d.prototype.bindFeature=function(a,b,c){var d=this;this._dynamicPropertyMap.forEach(function(e,g){d[g]=e(a,b,c)});if(this._text&&0!==this._text.length){this._size*=this._scaleFactor;this._scale=this._size/24;this._xOffset*=this._scaleFactor;this._yOffset*=this._scaleFactor;this._xAlignD=
q.getXAnchorDirection(this._horizontalAlignment||"center");this._yAlignD=q.getYAnchorDirection(this._verticalAlignment||"baseline");var e=this._textToGlyphs.get(this._text);this.bindTextInfo(e,!1)}else this._shapingInfo=null};return d}(k.default(n.default));d.default=b})},"esri/views/2d/layers/features/textUtils":function(){define(["require","exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});d.codepoints=function(b){for(var d=Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);
return d}})},"esri/views/2d/engine/webgl/mesh/templates/WGLFillTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/screenUtils ../../../../../../core/libs/earcut/earcut ../../color ../../definitions ../../enums ../../number ../../TileClipper ../../WGLDisplayRecord ../../materialKey/MaterialKey ../Tesselator ./WGLMeshTemplate".split(" "),function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,
x,t){Object.defineProperty(d,"__esModule",{value:!0});var u=h.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLFillTemplate"),y=[],A=[];b=function(b){function d(a,d,e,f,k,h,m,p,q){var r=b.call(this)||this;r.fillColor=e;r.tl=f;r.br=k;r.aux1=h;r.aux2=m;r.aux3=p;r.isBFS=q;r.geometryType=l.WGLGeometryType.FILL;r.forceLibtess=!1;a=g.FillMaterialKey.load(g.createMaterialKey(r.geometryType,a,!1));d&&(a.sdf=d.sdf,a.pattern=!0,a.textureBinding=d.textureBinding);r._materialKey=a.data;r._tesselator=new x.default;
r._tileClipper=new n.TileClipper(0,0,0,1,8);r._tileClipper.setExtent(c.TILE_SIZE);return r}f(d,b);d.fromCIMFill=function(b,c,g,f){void 0===f&&(f=!1);var h=c.color,h=h&&m.premultiplyAlphaRGBA(h)||0,l=k.i8888to32(0,0,0,c.colorLocked?1:0);if(!g)return new d(b,null,h,0,0,0,0,l,f);var l=g.rect,n=g.width,p=g.height,q=l.x+1,r=l.y+1,t=q+n,y=r+p,l=e.nextHighestPowerOfTwo(a.pt2px(c.height||0));255<l?l=255:0>=l&&(l=e.nextHighestPowerOfTwo(y-r));n=e.nextHighestPowerOfTwo(a.pt2px(c.height/p*n||0));255<n?n=255:
0>=n&&(n=e.nextHighestPowerOfTwo(t-q));p=a.pt2px(c.offsetX||0)+128;255<p&&(p=255);var x=a.pt2px(-c.offsetY||0)+128;255<x&&(x=255);c=c.scaleX||1;q=k.i1616to32(q,r);t=k.i1616to32(t,y);l=k.i8888to32(n,l,p,x);c=k.i1616to32(128*c,128);return new d(b,g,h,q,t,l,c,0,f)};d.fromSimpleFill=function(a,b,c,g){void 0===g&&(g=!1);var f=b.color;b=f&&"none"!==b.style&&m.premultiplyAlphaRGBA(f)||0;f=k.i8888to32(0,0,0,g?255:0);if(!c)return new d(a,null,b,0,0,0,0,f,g);var h=c.rect,l=h.x+1,n=h.y+1,p=h.x+1+c.width,q=h.y+
1+c.height,h=k.i1616to32(l,n),r=k.i1616to32(p,q),l=k.i8888to32(e.nextHighestPowerOfTwo(p-l),e.nextHighestPowerOfTwo(q-n),0,0),n=k.i1616to32(128,128);return new d(a,c,b,h,r,l,n,f,g)};d.fromPictureFill=function(b,g,f,h){void 0===h&&(h=!1);var l=c.PICTURE_FILL_COLOR,m=f.rect,n=m.x+1,p=m.y+1,m=n+f.width,q=p+f.height,n=k.i1616to32(n,p),m=k.i1616to32(m,q),q=e.nextHighestPowerOfTwo(a.pt2px(g.width));255<q&&(q=255);p=e.nextHighestPowerOfTwo(a.pt2px(g.height));255<p&&(p=255);var r=a.pt2px(g.xoffset)+128;255<
r&&(r=255);var t=a.pt2px(-g.yoffset)+128;255<t&&(t=255);q=k.i8888to32(q,p,r,t);g=k.i1616to32(128*g.xscale,128*g.yscale);p=k.i8888to32(0,0,0,h?255:0);return new d(b,f,l,n,m,q,g,p,h)};d.prototype.writeMesh=function(a,b,c,d,e){y.length=0;if("esriGeometryPolygon"!==c)"esriGeometryPolyline"!==c&&u.error("Unable to handle geometryType: "+c);else{var f=e.geometry;c=g.FillMaterialKey.load(this._materialKey);var k=(e=this._isClippingRequired(f))?this._clip(f,!1):f.rings;if(c.dotDensity){for(var f=f.rings,
h=0,l=0;l<f.length;l++)for(var m=f[l],n=m[0],p=n[0],n=n[1],q=1;q<m.length;q++)var r=m[q],t=p+r[0],r=n+r[1],h=h-(t-p)*(r+n)/2,p=t,n=r;f=h}else f=0;this.forceLibtess?this._writeMeshLibtess(a,b,d,k,e,c,f):this._writeMeshEarcut(a,b,d,k,e,c,f)||this._writeMeshLibtess(a,b,d,k,e,c,f)}};d.prototype._isClippingRequired=function(a){var b=c.TILE_SIZE+8,d=0;for(a=a.rings;d<a.length;d++){var e=a[d],g=e.length;if(!(3>g)){var f=e[0][0],k=e[0][1];if(-8>f||f>b||-8>k||k>b)return!0;for(var h=1;h<g;++h)if(f+=e[h][0],
k+=e[h][1],-8>f||f>b||-8>k||k>b)return!0}}return!1};d.prototype._clip=function(a,b){var c;this._tileClipper.reset(3);for(var d=0,e=a.rings;d<e.length;d++){var g=e[d],f=g.length;if(!(3>f)){a=g[0][0];c=g[0][1];this._tileClipper.moveTo(a,c);for(var k=1;k<f;++k)a+=g[k][0],c+=g[k][1],this._tileClipper.lineTo(a,c);this._tileClipper.close()}}return this._tileClipper.result(b)};d.prototype._writeMeshLibtess=function(a,b,c,d,e,g,f){if(d&&d.length){var k=[],h=b.indexVector;b=b.getVector("geometry");var l=new r(c,
this.geometryType,this._materialKey),m=b.vertexCount;l.vertexFrom=m;l.indexFrom=h.length;this._tesselator.beginPolygon(y,k);for(var n=0;n<d.length;n++){var p=d[n];if(!(3>p.length)){this._tesselator.beginContour();var q=void 0,t=void 0;e?(q=p[0].x,t=p[0].y):(q=p[0][0],t=p[0][1]);var x=[q,t,0];this._tesselator.addVertex(x,x);for(x=1;x<p.length-1;x++){var u=void 0,w=void 0;e?(q=p[x].x,t=p[x].y):(u=p[x][0],w=p[x][1],q+=u,t+=w);u=[q,t,0];this._tesselator.addVertex(u,u)}this._tesselator.endContour()}}this._tesselator.endPolygon();
this._writeVerticesLibTess(l,b,c,y,g,f);this._writeIndicesLibTess(l,h,m,k);0<l.indexCount&&a.push(l)}};d.prototype._writeMeshEarcut=function(a,b,c,d,e,g,f){if(d&&d.length){var k=b.indexVector;b=b.getVector("geometry");var h=new r(c,this.geometryType,this._materialKey),l=k.length,m=b.data.length;h.vertexFrom=b.vertexCount;h.indexFrom=k.length;for(var n=0,p=0,q=0;q<d.length;q++){var t=d[q],x=p,u=void 0,w=void 0;e?(u=t[0].x,w=t[0].y):(u=t[0][0],w=t[0][1]);y[p++]=u;y[p++]=w;for(var v=0,z=1;z<t.length;++z){var B=
void 0,C=void 0;e?(B=u,C=w,u=t[z].x,w=t[z].y,B=u-B,C=w-C):(B=t[z][0],C=t[z][1],u+=B,w+=C);v-=B*(w+w-C);y[p++]=u;y[p++]=w}if(0<v){if(0<x-n){if(!this._write(h,k,b,c,y,A,n,x,g,f))return k.seek(l),b.data.seek(m),y.length=A.length=0,!1;n=x}A.length=0}else 0>v?0<x-n?A.push(.5*(x-n)):p=x:p=x}if(0<p-n&&!this._write(h,k,b,c,y,A,n,p,g,f))return k.seek(l),b.data.seek(m),y.length=A.length=0,!1;y.length=A.length=0;a.push(h);return!0}};d.prototype._write=function(a,b,c,d,e,g,f,k,h,l){e=e.slice(f,k);f=q.earcut(e,
g,2);if(0<q.deviation(e,g,2,f))return!1;if(f.length)return g=c.vertexCount,this._writeVertices(a,c,d,e,h,l),this._writeIndices(a,b,g,f),!0};d.prototype._writeVertices=function(a,b,c,d,e,g){for(var f=0;f<d.length;f+=2){var h=k.i1616to32(d[f],d[f+1]);b.data.push(h);b.data.push(c);e.dotDensity?b.data.writeF32(1/g):(b.data.push(this.fillColor),b.data.push(this.tl),b.data.push(this.br),b.data.push(this.aux1),b.data.push(this.aux2),b.data.push(this.aux3));a.vertexCount++}};d.prototype._writeIndices=function(a,
b,c,d){for(var e=0;e<d.length;e+=3)b.push(c+d[e]),b.push(c+d[e+1]),b.push(c+d[e+2]),a.indexCount+=3};d.prototype._writeVerticesLibTess=function(a,b,c,d,e,g){for(var f=0;f<d.length;f+=2){var h=k.i1616to32(d[f],d[f+1]);b.data.push(h);b.data.push(c);e.dotDensity?b.data.writeF32(1/g):(b.data.push(this.fillColor),b.data.push(this.tl),b.data.push(this.br),b.data.push(this.aux1),b.data.push(this.aux2),b.data.push(this.aux3));a.vertexCount++}};d.prototype._writeIndicesLibTess=function(a,b,c,d){for(var e=
0;e<d.length;e++)b.push(c+d[e]),a.indexCount++};return d}(t.default);d.default=b})},"esri/views/2d/engine/webgl/mesh/Tesselator":function(){define(["require","exports","../../../../../core/Logger","../../../../../core/libs/libtess/libtess"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});var e=f.getLogger("esri.views.2d.engine.webgl.mesh.templates.Tesselator");b=function(){function a(){this._indexCounter=this._currentVertexIndex=0;this._triangleIndices=[-1,-1,-1];this.glu=new h.GluTesselator;
this.glu.gluTessCallback(h.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this));this.glu.gluTessCallback(h.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this));this.glu.gluTessCallback(h.gluEnum.GLU_TESS_END,this._endcallback.bind(this));this.glu.gluTessCallback(h.gluEnum.GLU_TESS_COMBINE,this._combinecallback.bind(this));this.glu.gluTessCallback(h.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this));this.glu.gluTessCallback(h.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this));
this.glu.gluTessProperty(h.gluEnum.GLU_TESS_WINDING_RULE,h.windingRule.GLU_TESS_WINDING_ODD)}a.prototype.beginPolygon=function(a,b){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._indexCounter=this._currentVertexIndex=0;this.glu.gluTessBeginPolygon(a);this._indices=b};a.prototype.endPolygon=function(){this.glu.gluTessEndPolygon()};a.prototype.beginContour=function(){this.glu.gluTessBeginContour()};a.prototype.endContour=function(){this.glu.gluTessEndContour()};
a.prototype.addVertex=function(a,b){this.glu.gluTessVertex(a,b)};a.prototype._vertexCallback=function(a,b){b[b.length]=a[0];b[b.length]=a[1];this._triangleIndices[this._currentVertexIndex]=-1;if(2<=this._currentVertexIndex){for(a=0;3>a;a++)-1===this._triangleIndices[a]&&(this._triangleIndices[a]=this._indexCounter++),this._indices[this._indices.length]=this._triangleIndices[a];this._currentVertexIndex=0}else this._currentVertexIndex++};a.prototype._begincallback=function(){this._triangleIndices[0]=
-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._currentVertexIndex=0};a.prototype._endcallback=function(){this._currentVertexIndex=0};a.prototype._errorcallback=function(a){e.error("Encountered error during tesselation: "+a)};a.prototype._combinecallback=function(a){return[a[0],a[1],a[2]]};a.prototype._edgeCallback=function(){};return a}();d.default=b})},"esri/core/libs/libtess/libtess":function(){define([],function(){var b={DEBUG:!1,assert:function(d,f){if(b.DEBUG&&!d)throw Error("Assertion failed"+
(f?": "+f:""));},GLU_TESS_MAX_COORD:1E150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,
GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,
GLU_INVALID_VALUE:100901},geom:{}};b.geom.vertEq=function(b,f){return b.s===f.s&&b.t===f.t};b.geom.vertLeq=function(b,f){return b.s<f.s||b.s===f.s&&b.t<=f.t};b.geom.edgeEval=function(d,f,h){b.assert(b.geom.vertLeq(d,f)&&b.geom.vertLeq(f,h));var e=f.s-d.s,a=h.s-f.s;return 0<e+a?e<a?f.t-d.t+e/(e+a)*(d.t-h.t):f.t-h.t+a/(e+a)*(h.t-d.t):0};b.geom.edgeSign=function(d,f,h){b.assert(b.geom.vertLeq(d,f)&&b.geom.vertLeq(f,h));var e=f.s-d.s,a=h.s-f.s;return 0<e+a?(f.t-h.t)*e+(f.t-d.t)*a:0};b.geom.transLeq=function(b,
f){return b.t<f.t||b.t===f.t&&b.s<=f.s};b.geom.transEval=function(d,f,h){b.assert(b.geom.transLeq(d,f)&&b.geom.transLeq(f,h));var e=f.t-d.t,a=h.t-f.t;return 0<e+a?e<a?f.s-d.s+e/(e+a)*(d.s-h.s):f.s-h.s+a/(e+a)*(h.s-d.s):0};b.geom.transSign=function(d,f,h){b.assert(b.geom.transLeq(d,f)&&b.geom.transLeq(f,h));var e=f.t-d.t,a=h.t-f.t;return 0<e+a?(f.s-h.s)*e+(f.s-d.s)*a:0};b.geom.edgeGoesLeft=function(d){return b.geom.vertLeq(d.dst(),d.org)};b.geom.edgeGoesRight=function(d){return b.geom.vertLeq(d.org,
d.dst())};b.geom.vertL1dist=function(b,f){return Math.abs(b.s-f.s)+Math.abs(b.t-f.t)};b.geom.vertCCW=function(b,f,h){return 0<=b.s*(f.t-h.t)+f.s*(h.t-b.t)+h.s*(b.t-f.t)};b.geom.interpolate_=function(b,f,h,e){b=0>b?0:b;h=0>h?0:h;return b<=h?0===h?(f+e)/2:f+b/(b+h)*(e-f):e+h/(b+h)*(f-e)};b.geom.edgeIntersect=function(d,f,h,e,a){var q,m;b.geom.vertLeq(d,f)||(q=d,d=f,f=q);b.geom.vertLeq(h,e)||(q=h,h=e,e=q);b.geom.vertLeq(d,h)||(q=d,d=h,h=q,q=f,f=e,e=q);b.geom.vertLeq(h,f)?b.geom.vertLeq(f,e)?(q=b.geom.edgeEval(d,
h,f),m=b.geom.edgeEval(h,f,e),0>q+m&&(q=-q,m=-m),a.s=b.geom.interpolate_(q,h.s,m,f.s)):(q=b.geom.edgeSign(d,h,f),m=-b.geom.edgeSign(d,e,f),0>q+m&&(q=-q,m=-m),a.s=b.geom.interpolate_(q,h.s,m,e.s)):a.s=(h.s+f.s)/2;b.geom.transLeq(d,f)||(q=d,d=f,f=q);b.geom.transLeq(h,e)||(q=h,h=e,e=q);b.geom.transLeq(d,h)||(q=d,d=h,h=q,q=f,f=e,e=q);b.geom.transLeq(h,f)?b.geom.transLeq(f,e)?(q=b.geom.transEval(d,h,f),m=b.geom.transEval(h,f,e),0>q+m&&(q=-q,m=-m),a.t=b.geom.interpolate_(q,h.t,m,f.t)):(q=b.geom.transSign(d,
h,f),m=-b.geom.transSign(d,e,f),0>q+m&&(q=-q,m=-m),a.t=b.geom.interpolate_(q,h.t,m,e.t)):a.t=(h.t+f.t)/2};b.mesh={};b.mesh.makeEdge=function(d){var f=b.mesh.makeEdgePair_(d.eHead);b.mesh.makeVertex_(f,d.vHead);b.mesh.makeVertex_(f.sym,d.vHead);b.mesh.makeFace_(f,d.fHead);return f};b.mesh.meshSplice=function(d,f){var h=!1,e=!1;d!==f&&(f.org!==d.org&&(e=!0,b.mesh.killVertex_(f.org,d.org)),f.lFace!==d.lFace&&(h=!0,b.mesh.killFace_(f.lFace,d.lFace)),b.mesh.splice_(f,d),e||(b.mesh.makeVertex_(f,d.org),
d.org.anEdge=d),h||(b.mesh.makeFace_(f,d.lFace),d.lFace.anEdge=d))};b.mesh.deleteEdge=function(d){var f=d.sym,h=!1;d.lFace!==d.rFace()&&(h=!0,b.mesh.killFace_(d.lFace,d.rFace()));d.oNext===d?b.mesh.killVertex_(d.org,null):(d.rFace().anEdge=d.oPrev(),d.org.anEdge=d.oNext,b.mesh.splice_(d,d.oPrev()),h||b.mesh.makeFace_(d,d.lFace));f.oNext===f?(b.mesh.killVertex_(f.org,null),b.mesh.killFace_(f.lFace,null)):(d.lFace.anEdge=f.oPrev(),f.org.anEdge=f.oNext,b.mesh.splice_(f,f.oPrev()));b.mesh.killEdge_(d)};
b.mesh.addEdgeVertex=function(d){var f=b.mesh.makeEdgePair_(d),h=f.sym;b.mesh.splice_(f,d.lNext);f.org=d.dst();b.mesh.makeVertex_(h,f.org);f.lFace=h.lFace=d.lFace;return f};b.mesh.splitEdge=function(d){var f=b.mesh.addEdgeVertex(d).sym;b.mesh.splice_(d.sym,d.sym.oPrev());b.mesh.splice_(d.sym,f);d.sym.org=f.org;f.dst().anEdge=f.sym;f.sym.lFace=d.rFace();f.winding=d.winding;f.sym.winding=d.sym.winding;return f};b.mesh.connect=function(d,f){var h=!1,e=b.mesh.makeEdgePair_(d),a=e.sym;f.lFace!==d.lFace&&
(h=!0,b.mesh.killFace_(f.lFace,d.lFace));b.mesh.splice_(e,d.lNext);b.mesh.splice_(a,f);e.org=d.dst();a.org=f.org;e.lFace=a.lFace=d.lFace;d.lFace.anEdge=a;h||b.mesh.makeFace_(e,d.lFace);return e};b.mesh.zapFace=function(d){var f=d.anEdge,h=f.lNext,e;do if(e=h,h=e.lNext,e.lFace=null,null===e.rFace()){e.oNext===e?b.mesh.killVertex_(e.org,null):(e.org.anEdge=e.oNext,b.mesh.splice_(e,e.oPrev()));var a=e.sym;a.oNext===a?b.mesh.killVertex_(a.org,null):(a.org.anEdge=a.oNext,b.mesh.splice_(a,a.oPrev()));b.mesh.killEdge_(e)}while(e!==
f);f=d.prev;d=d.next;d.prev=f;f.next=d};b.mesh.meshUnion=function(b,f){var d=b.fHead,e=b.vHead,a=b.eHead,q=f.fHead,m=f.vHead;f=f.eHead;q.next!==q&&(d.prev.next=q.next,q.next.prev=d.prev,q.prev.next=d,d.prev=q.prev);m.next!==m&&(e.prev.next=m.next,m.next.prev=e.prev,m.prev.next=e,e.prev=m.prev);f.next!==f&&(a.sym.next.sym.next=f.next,f.next.sym.next=a.sym.next,f.sym.next.sym.next=a,a.sym.next=f.sym.next);return b};b.mesh.deleteMesh=function(b){};b.mesh.makeEdgePair_=function(d){var f=new b.GluHalfEdge,
h=new b.GluHalfEdge,e=d.sym.next;h.next=e;e.sym.next=f;f.next=d;d.sym.next=h;f.sym=h;f.oNext=f;f.lNext=h;h.sym=f;h.oNext=h;return h.lNext=f};b.mesh.splice_=function(b,f){var d=b.oNext,e=f.oNext;d.sym.lNext=f;e.sym.lNext=b;b.oNext=e;f.oNext=d};b.mesh.makeVertex_=function(d,f){var h=f.prev,e=new b.GluVertex(f,h);h.next=e;f.prev=e;f=e.anEdge=d;do f.org=e,f=f.oNext;while(f!==d)};b.mesh.makeFace_=function(d,f){var h=f.prev,e=new b.GluFace(f,h);h.next=e;f.prev=e;e.anEdge=d;e.inside=f.inside;f=d;do f.lFace=
e,f=f.lNext;while(f!==d)};b.mesh.killEdge_=function(b){var d=b.next;b=b.sym.next;d.sym.next=b;b.sym.next=d};b.mesh.killVertex_=function(b,f){var d=b.anEdge,e=d;do e.org=f,e=e.oNext;while(e!==d);f=b.prev;b=b.next;b.prev=f;f.next=b};b.mesh.killFace_=function(b,f){var d=b.anEdge,e=d;do e.lFace=f,e=e.lNext;while(e!==d);f=b.prev;b=b.next;b.prev=f;f.next=b};b.normal={};b.normal.S_UNIT_X_=1;b.normal.S_UNIT_Y_=0;b.normal.projectPolygon=function(d,f,h,e){var a=!1,q=[f,h,e];0===f&&0===h&&0===e&&(b.normal.computeNormal_(d,
q),a=!0);h=b.normal.longAxis_(q);f=d.mesh.vHead;if(b.TRUE_PROJECT){b.normal.normalize_(q);e=[0,0,0];var m=[0,0,0];e[h]=0;e[(h+1)%3]=b.normal.S_UNIT_X_;e[(h+2)%3]=b.normal.S_UNIT_Y_;h=b.normal.dot_(e,q);e[0]-=h*q[0];e[1]-=h*q[1];e[2]-=h*q[2];b.normal.normalize_(e);m[0]=q[1]*e[2]-q[2]*e[1];m[1]=q[2]*e[0]-q[0]*e[2];m[2]=q[0]*e[1]-q[1]*e[0];b.normal.normalize_(m);for(q=f.next;q!==f;q=q.next)q.s=b.normal.dot_(q.coords,e),q.t=b.normal.dot_(q.coords,m)}else for(e=(h+1)%3,m=(h+2)%3,h=0<q[h]?1:-1,q=f.next;q!==
f;q=q.next)q.s=q.coords[e],q.t=h*q.coords[m];a&&b.normal.checkOrientation_(d)};b.normal.dot_=function(b,f){return b[0]*f[0]+b[1]*f[1]+b[2]*f[2]};b.normal.normalize_=function(d){var f=d[0]*d[0]+d[1]*d[1]+d[2]*d[2];b.assert(0<f);f=Math.sqrt(f);d[0]/=f;d[1]/=f;d[2]/=f};b.normal.longAxis_=function(b){var d=0;Math.abs(b[1])>Math.abs(b[0])&&(d=1);Math.abs(b[2])>Math.abs(b[d])&&(d=2);return d};b.normal.computeNormal_=function(d,f){var h=[-2*b.GLU_TESS_MAX_COORD,-2*b.GLU_TESS_MAX_COORD,-2*b.GLU_TESS_MAX_COORD],
e=[2*b.GLU_TESS_MAX_COORD,2*b.GLU_TESS_MAX_COORD,2*b.GLU_TESS_MAX_COORD],a=[],q=[],m;d=d.mesh.vHead;for(m=d.next;m!==d;m=m.next)for(var c=0;3>c;++c){var l=m.coords[c];l<e[c]&&(e[c]=l,q[c]=m);l>h[c]&&(h[c]=l,a[c]=m)}m=0;h[1]-e[1]>h[0]-e[0]&&(m=1);h[2]-e[2]>h[m]-e[m]&&(m=2);if(e[m]>=h[m])f[0]=0,f[1]=0,f[2]=1;else{h=0;e=q[m];a=a[m];q=[0,0,0];e=[e.coords[0]-a.coords[0],e.coords[1]-a.coords[1],e.coords[2]-a.coords[2]];c=[0,0,0];for(m=d.next;m!==d;m=m.next)c[0]=m.coords[0]-a.coords[0],c[1]=m.coords[1]-
a.coords[1],c[2]=m.coords[2]-a.coords[2],q[0]=e[1]*c[2]-e[2]*c[1],q[1]=e[2]*c[0]-e[0]*c[2],q[2]=e[0]*c[1]-e[1]*c[0],l=q[0]*q[0]+q[1]*q[1]+q[2]*q[2],l>h&&(h=l,f[0]=q[0],f[1]=q[1],f[2]=q[2]);0>=h&&(f[0]=f[1]=f[2]=0,f[b.normal.longAxis_(e)]=1)}};b.normal.checkOrientation_=function(b){for(var d=0,h=b.mesh.fHead,e=h.next;e!==h;e=e.next){var a=e.anEdge;if(!(0>=a.winding)){do d+=(a.org.s-a.dst().s)*(a.org.t+a.dst().t),a=a.lNext;while(a!==e.anEdge)}}if(0>d)for(b=b.mesh.vHead,d=b.next;d!==b;d=d.next)d.t=-d.t};
b.render={};b.render.renderMesh=function(d,f,h){for(var e=!1,a=-1,q=f.fHead.prev;q!==f.fHead;q=q.prev)if(q.inside){e||(d.callBeginCallback(b.primitiveType.GL_TRIANGLES),e=!0);var m=q.anEdge;b.assert(m.lNext.lNext.lNext===m,"renderMesh called with non-triangulated mesh");do{if(h){var c=m.rFace().inside?0:1;a!==c&&(a=c,d.callEdgeFlagCallback(!!a))}d.callVertexCallback(m.org.data);m=m.lNext}while(m!==q.anEdge)}e&&d.callEndCallback()};b.render.renderBoundary=function(d,f){for(var h=f.fHead.next;h!==f.fHead;h=
h.next)if(h.inside){d.callBeginCallback(b.primitiveType.GL_LINE_LOOP);var e=h.anEdge;do d.callVertexCallback(e.org.data),e=e.lNext;while(e!==h.anEdge);d.callEndCallback()}};b.sweep={};b.sweep.SENTINEL_COORD_=4*b.GLU_TESS_MAX_COORD;b.sweep.TOLERANCE_NONZERO_=!1;b.sweep.computeInterior=function(d){d.fatalError=!1;b.sweep.removeDegenerateEdges_(d);b.sweep.initPriorityQ_(d);b.sweep.initEdgeDict_(d);for(var f;null!==(f=d.pq.extractMin());){for(;;){var h=d.pq.minimum();if(null===h||!b.geom.vertEq(h,f))break;
h=d.pq.extractMin();b.sweep.spliceMergeVertices_(d,f.anEdge,h.anEdge)}b.sweep.sweepEvent_(d,f)}f=d.dict.getMin().getKey();d.event=f.eUp.org;b.sweep.doneEdgeDict_(d);b.sweep.donePriorityQ_(d);b.sweep.removeDegenerateFaces_(d.mesh);d.mesh.checkMesh()};b.sweep.addWinding_=function(b,f){b.winding+=f.winding;b.sym.winding+=f.sym.winding};b.sweep.edgeLeq_=function(d,f,h){d=d.event;f=f.eUp;h=h.eUp;if(f.dst()===d)return h.dst()===d?b.geom.vertLeq(f.org,h.org)?0>=b.geom.edgeSign(h.dst(),f.org,h.org):0<=b.geom.edgeSign(f.dst(),
h.org,f.org):0>=b.geom.edgeSign(h.dst(),d,h.org);if(h.dst()===d)return 0<=b.geom.edgeSign(f.dst(),d,f.org);f=b.geom.edgeEval(f.dst(),d,f.org);d=b.geom.edgeEval(h.dst(),d,h.org);return f>=d};b.sweep.deleteRegion_=function(d,f){f.fixUpperEdge&&b.assert(0===f.eUp.winding);f.eUp.activeRegion=null;d.dict.deleteNode(f.nodeUp);f.nodeUp=null};b.sweep.fixUpperEdge_=function(d,f){b.assert(d.fixUpperEdge);b.mesh.deleteEdge(d.eUp);d.fixUpperEdge=!1;d.eUp=f;f.activeRegion=d};b.sweep.topLeftRegion_=function(d){var f=
d.eUp.org;do d=d.regionAbove();while(d.eUp.org===f);d.fixUpperEdge&&(f=b.mesh.connect(d.regionBelow().eUp.sym,d.eUp.lNext),b.sweep.fixUpperEdge_(d,f),d=d.regionAbove());return d};b.sweep.topRightRegion_=function(b){var d=b.eUp.dst();do b=b.regionAbove();while(b.eUp.dst()===d);return b};b.sweep.addRegionBelow_=function(d,f,h){var e=new b.ActiveRegion;e.eUp=h;e.nodeUp=d.dict.insertBefore(f.nodeUp,e);return h.activeRegion=e};b.sweep.isWindingInside_=function(d,f){switch(d.windingRule){case b.windingRule.GLU_TESS_WINDING_ODD:return 0!==
(f&1);case b.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==f;case b.windingRule.GLU_TESS_WINDING_POSITIVE:return 0<f;case b.windingRule.GLU_TESS_WINDING_NEGATIVE:return 0>f;case b.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return 2<=f||-2>=f}b.assert(!1);return!1};b.sweep.computeWinding_=function(d,f){f.windingNumber=f.regionAbove().windingNumber+f.eUp.winding;f.inside=b.sweep.isWindingInside_(d,f.windingNumber)};b.sweep.finishRegion_=function(d,f){var h=f.eUp,e=h.lFace;e.inside=f.inside;e.anEdge=
h;b.sweep.deleteRegion_(d,f)};b.sweep.finishLeftRegions_=function(d,f,h){var e=f;for(f=f.eUp;e!==h;){e.fixUpperEdge=!1;var a=e.regionBelow(),q=a.eUp;if(q.org!==f.org){if(!a.fixUpperEdge){b.sweep.finishRegion_(d,e);break}q=b.mesh.connect(f.lPrev(),q.sym);b.sweep.fixUpperEdge_(a,q)}f.oNext!==q&&(b.mesh.meshSplice(q.oPrev(),q),b.mesh.meshSplice(f,q));b.sweep.finishRegion_(d,e);f=a.eUp;e=a}return f};b.sweep.addRightEdges_=function(d,f,h,e,a,q){var m=!0;do b.assert(b.geom.vertLeq(h.org,h.dst())),b.sweep.addRegionBelow_(d,
f,h.sym),h=h.oNext;while(h!==e);for(null===a&&(a=f.regionBelow().eUp.rPrev());;){e=f.regionBelow();h=e.eUp.sym;if(h.org!==a.org)break;h.oNext!==a&&(b.mesh.meshSplice(h.oPrev(),h),b.mesh.meshSplice(a.oPrev(),h));e.windingNumber=f.windingNumber-h.winding;e.inside=b.sweep.isWindingInside_(d,e.windingNumber);f.dirty=!0;!m&&b.sweep.checkForRightSplice_(d,f)&&(b.sweep.addWinding_(h,a),b.sweep.deleteRegion_(d,f),b.mesh.deleteEdge(a));m=!1;f=e;a=h}f.dirty=!0;b.assert(f.windingNumber-h.winding===e.windingNumber);
q&&b.sweep.walkDirtyRegions_(d,f)};b.sweep.callCombine_=function(d,f,h,e,a){var q=[f.coords[0],f.coords[1],f.coords[2]];f.data=null;f.data=d.callCombineCallback(q,h,e);null===f.data&&(a?d.fatalError||(d.callErrorCallback(b.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),d.fatalError=!0):f.data=h[0])};b.sweep.spliceMergeVertices_=function(d,f,h){var e=[null,null,null,null];e[0]=f.org.data;e[1]=h.org.data;b.sweep.callCombine_(d,f.org,e,[.5,.5,0,0],!1);b.mesh.meshSplice(f,h)};b.sweep.vertexWeights_=function(d,
f,h,e,a){var q=b.geom.vertL1dist(f,d),m=b.geom.vertL1dist(h,d),c=a+1;e[a]=.5*m/(q+m);e[c]=.5*q/(q+m);d.coords[0]+=e[a]*f.coords[0]+e[c]*h.coords[0];d.coords[1]+=e[a]*f.coords[1]+e[c]*h.coords[1];d.coords[2]+=e[a]*f.coords[2]+e[c]*h.coords[2]};b.sweep.getIntersectData_=function(d,f,h,e,a,q){var m=[0,0,0,0],c=[h.data,e.data,a.data,q.data];f.coords[0]=f.coords[1]=f.coords[2]=0;b.sweep.vertexWeights_(f,h,e,m,0);b.sweep.vertexWeights_(f,a,q,m,2);b.sweep.callCombine_(d,f,c,m,!0)};b.sweep.checkForRightSplice_=
function(d,f){var h=f.regionBelow(),e=f.eUp,a=h.eUp;if(b.geom.vertLeq(e.org,a.org)){if(0<b.geom.edgeSign(a.dst(),e.org,a.org))return!1;b.geom.vertEq(e.org,a.org)?e.org!==a.org&&(d.pq.remove(e.org.pqHandle),b.sweep.spliceMergeVertices_(d,a.oPrev(),e)):(b.mesh.splitEdge(a.sym),b.mesh.meshSplice(e,a.oPrev()),f.dirty=h.dirty=!0)}else{if(0>b.geom.edgeSign(e.dst(),a.org,e.org))return!1;f.regionAbove().dirty=f.dirty=!0;b.mesh.splitEdge(e.sym);b.mesh.meshSplice(a.oPrev(),e)}return!0};b.sweep.checkForLeftSplice_=
function(d,f){var h=f.regionBelow();d=f.eUp;var e=h.eUp;b.assert(!b.geom.vertEq(d.dst(),e.dst()));if(b.geom.vertLeq(d.dst(),e.dst())){if(0>b.geom.edgeSign(d.dst(),e.dst(),d.org))return!1;f.regionAbove().dirty=f.dirty=!0;h=b.mesh.splitEdge(d);b.mesh.meshSplice(e.sym,h);h.lFace.inside=f.inside}else{if(0<b.geom.edgeSign(e.dst(),d.dst(),e.org))return!1;f.dirty=h.dirty=!0;h=b.mesh.splitEdge(e);b.mesh.meshSplice(d.lNext,e.sym);h.rFace().inside=f.inside}return!0};b.sweep.checkForIntersect_=function(d,f){var h=
f.regionBelow(),e=f.eUp,a=h.eUp,q=e.org,m=a.org,c=e.dst(),l=a.dst(),k=new b.GluVertex;b.assert(!b.geom.vertEq(l,c));b.assert(0>=b.geom.edgeSign(c,d.event,q));b.assert(0<=b.geom.edgeSign(l,d.event,m));b.assert(q!==d.event&&m!==d.event);b.assert(!f.fixUpperEdge&&!h.fixUpperEdge);if(q===m||Math.min(q.t,c.t)>Math.max(m.t,l.t))return!1;if(b.geom.vertLeq(q,m)){if(0<b.geom.edgeSign(l,q,m))return!1}else if(0>b.geom.edgeSign(c,m,q))return!1;b.geom.edgeIntersect(c,q,l,m,k);b.assert(Math.min(q.t,c.t)<=k.t);
b.assert(k.t<=Math.max(m.t,l.t));b.assert(Math.min(l.s,c.s)<=k.s);b.assert(k.s<=Math.max(m.s,q.s));b.geom.vertLeq(k,d.event)&&(k.s=d.event.s,k.t=d.event.t);var n=b.geom.vertLeq(q,m)?q:m;b.geom.vertLeq(n,k)&&(k.s=n.s,k.t=n.t);if(b.geom.vertEq(k,q)||b.geom.vertEq(k,m))return b.sweep.checkForRightSplice_(d,f),!1;if(!b.geom.vertEq(c,d.event)&&0<=b.geom.edgeSign(c,d.event,k)||!b.geom.vertEq(l,d.event)&&0>=b.geom.edgeSign(l,d.event,k)){if(l===d.event)return b.mesh.splitEdge(e.sym),b.mesh.meshSplice(a.sym,
e),f=b.sweep.topLeftRegion_(f),e=f.regionBelow().eUp,b.sweep.finishLeftRegions_(d,f.regionBelow(),h),b.sweep.addRightEdges_(d,f,e.oPrev(),e,e,!0),!0;if(c===d.event)return b.mesh.splitEdge(a.sym),b.mesh.meshSplice(e.lNext,a.oPrev()),h=f,f=b.sweep.topRightRegion_(f),q=f.regionBelow().eUp.rPrev(),h.eUp=a.oPrev(),a=b.sweep.finishLeftRegions_(d,h,null),b.sweep.addRightEdges_(d,f,a.oNext,e.rPrev(),q,!0),!0;0<=b.geom.edgeSign(c,d.event,k)&&(f.regionAbove().dirty=f.dirty=!0,b.mesh.splitEdge(e.sym),e.org.s=
d.event.s,e.org.t=d.event.t);0>=b.geom.edgeSign(l,d.event,k)&&(f.dirty=h.dirty=!0,b.mesh.splitEdge(a.sym),a.org.s=d.event.s,a.org.t=d.event.t);return!1}b.mesh.splitEdge(e.sym);b.mesh.splitEdge(a.sym);b.mesh.meshSplice(a.oPrev(),e);e.org.s=k.s;e.org.t=k.t;e.org.pqHandle=d.pq.insert(e.org);b.sweep.getIntersectData_(d,e.org,q,c,m,l);f.regionAbove().dirty=f.dirty=h.dirty=!0;return!1};b.sweep.walkDirtyRegions_=function(d,f){for(var h=f.regionBelow();;){for(;h.dirty;)f=h,h=h.regionBelow();if(!f.dirty&&
(h=f,f=f.regionAbove(),null===f||!f.dirty))break;f.dirty=!1;var e=f.eUp,a=h.eUp;e.dst()!==a.dst()&&b.sweep.checkForLeftSplice_(d,f)&&(h.fixUpperEdge?(b.sweep.deleteRegion_(d,h),b.mesh.deleteEdge(a),h=f.regionBelow(),a=h.eUp):f.fixUpperEdge&&(b.sweep.deleteRegion_(d,f),b.mesh.deleteEdge(e),f=h.regionAbove(),e=f.eUp));if(e.org!==a.org)if(e.dst()===a.dst()||f.fixUpperEdge||h.fixUpperEdge||e.dst()!==d.event&&a.dst()!==d.event)b.sweep.checkForRightSplice_(d,f);else if(b.sweep.checkForIntersect_(d,f))break;
e.org===a.org&&e.dst()===a.dst()&&(b.sweep.addWinding_(a,e),b.sweep.deleteRegion_(d,f),b.mesh.deleteEdge(e),f=h.regionAbove())}};b.sweep.connectRightVertex_=function(d,f,h){var e=h.oNext,a=f.regionBelow(),q=f.eUp,m=a.eUp,c=!1;q.dst()!==m.dst()&&b.sweep.checkForIntersect_(d,f);b.geom.vertEq(q.org,d.event)&&(b.mesh.meshSplice(e.oPrev(),q),f=b.sweep.topLeftRegion_(f),e=f.regionBelow().eUp,b.sweep.finishLeftRegions_(d,f.regionBelow(),a),c=!0);b.geom.vertEq(m.org,d.event)&&(b.mesh.meshSplice(h,m.oPrev()),
h=b.sweep.finishLeftRegions_(d,a,null),c=!0);c?b.sweep.addRightEdges_(d,f,h.oNext,e,e,!0):(e=b.geom.vertLeq(m.org,q.org)?m.oPrev():q,e=b.mesh.connect(h.lPrev(),e),b.sweep.addRightEdges_(d,f,e,e.oNext,e.oNext,!1),e.sym.activeRegion.fixUpperEdge=!0,b.sweep.walkDirtyRegions_(d,f))};b.sweep.connectLeftDegenerate_=function(d,f,h){var e=f.eUp;if(b.geom.vertEq(e.org,h))b.assert(b.sweep.TOLERANCE_NONZERO_),b.sweep.TOLERANCE_NONZERO_&&b.sweep.spliceMergeVertices_(d,e,h.anEdge);else if(b.geom.vertEq(e.dst(),
h)){if(b.assert(b.sweep.TOLERANCE_NONZERO_),b.sweep.TOLERANCE_NONZERO_){f=b.sweep.topRightRegion_(f);var e=f.regionBelow(),a=e.eUp.sym,q=a.oNext,m=q;e.fixUpperEdge&&(b.assert(q!==a),b.sweep.deleteRegion_(d,e),b.mesh.deleteEdge(a),a=q.oPrev());b.mesh.meshSplice(h.anEdge,a);b.geom.edgeGoesLeft(q)||(q=null);b.sweep.addRightEdges_(d,f,a.oNext,m,q,!0)}}else b.mesh.splitEdge(e.sym),f.fixUpperEdge&&(b.mesh.deleteEdge(e.oNext),f.fixUpperEdge=!1),b.mesh.meshSplice(h.anEdge,e),b.sweep.sweepEvent_(d,h)};b.sweep.connectLeftVertex_=
function(d,f){var h=new b.ActiveRegion;h.eUp=f.anEdge.sym;var h=d.dict.search(h).getKey(),e=h.regionBelow(),a=h.eUp,q=e.eUp;0===b.geom.edgeSign(a.dst(),f,a.org)?b.sweep.connectLeftDegenerate_(d,h,f):(e=b.geom.vertLeq(q.dst(),a.dst())?h:e,h.inside||e.fixUpperEdge?(a=e===h?b.mesh.connect(f.anEdge.sym,a.lNext):b.mesh.connect(q.dNext(),f.anEdge).sym,e.fixUpperEdge?b.sweep.fixUpperEdge_(e,a):b.sweep.computeWinding_(d,b.sweep.addRegionBelow_(d,h,a)),b.sweep.sweepEvent_(d,f)):b.sweep.addRightEdges_(d,h,
f.anEdge,f.anEdge,null,!0))};b.sweep.sweepEvent_=function(d,f){d.event=f;for(var h=f.anEdge;null===h.activeRegion;)if(h=h.oNext,h===f.anEdge){b.sweep.connectLeftVertex_(d,f);return}f=b.sweep.topLeftRegion_(h.activeRegion);var e=f.regionBelow(),h=e.eUp,e=b.sweep.finishLeftRegions_(d,e,null);e.oNext===h?b.sweep.connectRightVertex_(d,f,e):b.sweep.addRightEdges_(d,f,e.oNext,h,h,!0)};b.sweep.addSentinel_=function(d,f){var h=new b.ActiveRegion,e=b.mesh.makeEdge(d.mesh);e.org.s=b.sweep.SENTINEL_COORD_;e.org.t=
f;e.dst().s=-b.sweep.SENTINEL_COORD_;e.dst().t=f;d.event=e.dst();h.eUp=e;h.windingNumber=0;h.inside=!1;h.fixUpperEdge=!1;h.sentinel=!0;h.dirty=!1;h.nodeUp=d.dict.insert(h)};b.sweep.initEdgeDict_=function(d){d.dict=new b.Dict(d,b.sweep.edgeLeq_);b.sweep.addSentinel_(d,-b.sweep.SENTINEL_COORD_);b.sweep.addSentinel_(d,b.sweep.SENTINEL_COORD_)};b.sweep.doneEdgeDict_=function(d){for(var f=0,h;null!==(h=d.dict.getMin().getKey());)h.sentinel||(b.assert(h.fixUpperEdge),b.assert(1===++f)),b.assert(0===h.windingNumber),
b.sweep.deleteRegion_(d,h);d.dict=null};b.sweep.removeDegenerateEdges_=function(d){for(var f=d.mesh.eHead,h,e=f.next;e!==f;e=h){h=e.next;var a=e.lNext;b.geom.vertEq(e.org,e.dst())&&e.lNext.lNext!==e&&(b.sweep.spliceMergeVertices_(d,a,e),b.mesh.deleteEdge(e),e=a,a=e.lNext);if(a.lNext===e){if(a!==e){if(a===h||a===h.sym)h=h.next;b.mesh.deleteEdge(a)}if(e===h||e===h.sym)h=h.next;b.mesh.deleteEdge(e)}}};b.sweep.initPriorityQ_=function(d){var f=new b.PriorityQ;d.pq=f;d=d.mesh.vHead;var h;for(h=d.next;h!==
d;h=h.next)h.pqHandle=f.insert(h);f.init()};b.sweep.donePriorityQ_=function(b){b.pq.deleteQ();b.pq=null};b.sweep.removeDegenerateFaces_=function(d){for(var f,h=d.fHead.next;h!==d.fHead;h=f)f=h.next,h=h.anEdge,b.assert(h.lNext!==h),h.lNext.lNext===h&&(b.sweep.addWinding_(h.oNext,h),b.mesh.deleteEdge(h))};b.tessmono={};b.tessmono.tessellateMonoRegion_=function(d){d=d.anEdge;for(b.assert(d.lNext!==d&&d.lNext.lNext!==d);b.geom.vertLeq(d.dst(),d.org);d=d.lPrev());for(;b.geom.vertLeq(d.org,d.dst());d=d.lNext);
for(var f=d.lPrev(),h;d.lNext!==f;)if(b.geom.vertLeq(d.dst(),f.org)){for(;f.lNext!==d&&(b.geom.edgeGoesLeft(f.lNext)||0>=b.geom.edgeSign(f.org,f.dst(),f.lNext.dst()));)h=b.mesh.connect(f.lNext,f),f=h.sym;f=f.lPrev()}else{for(;f.lNext!==d&&(b.geom.edgeGoesRight(d.lPrev())||0<=b.geom.edgeSign(d.dst(),d.org,d.lPrev().org));)h=b.mesh.connect(d,d.lPrev()),d=h.sym;d=d.lNext}for(b.assert(f.lNext!==d);f.lNext.lNext!==d;)h=b.mesh.connect(f.lNext,f),f=h.sym};b.tessmono.tessellateInterior=function(d){for(var f,
h=d.fHead.next;h!==d.fHead;h=f)f=h.next,h.inside&&b.tessmono.tessellateMonoRegion_(h)};b.tessmono.discardExterior=function(d){for(var f,h=d.fHead.next;h!==d.fHead;h=f)f=h.next,h.inside||b.mesh.zapFace(h)};b.tessmono.setWindingNumber=function(d,f,h){for(var e,a=d.eHead.next;a!==d.eHead;a=e)e=a.next,a.rFace().inside!==a.lFace.inside?a.winding=a.lFace.inside?f:-f:h?b.mesh.deleteEdge(a):a.winding=0};b.Dict=function(d,f){this.head_=new b.DictNode;this.frame_=d;this.leq_=f};b.Dict.prototype.deleteDict_=
function(){};b.Dict.prototype.insertBefore=function(d,f){do d=d.prev;while(null!==d.key&&!this.leq_(this.frame_,d.key,f));f=new b.DictNode(f,d.next,d);d.next.prev=f;return d.next=f};b.Dict.prototype.insert=function(b){return this.insertBefore(this.head_,b)};b.Dict.prototype.deleteNode=function(b){b.next.prev=b.prev;b.prev.next=b.next};b.Dict.prototype.search=function(b){var d=this.head_;do d=d.next;while(null!==d.key&&!this.leq_(this.frame_,b,d.key));return d};b.Dict.prototype.getMin=function(){return this.head_.next};
b.Dict.prototype.getMax=function(){return this.head_.prev};b.DictNode=function(b,f,h){this.key=b||null;this.next=f||this;this.prev=h||this};b.DictNode.prototype.getKey=function(){return this.key};b.DictNode.prototype.getSuccessor=function(){return this.next};b.DictNode.prototype.getPredecessor=function(){return this.prev};b.GluTesselator=function(){this.state_=b.GluTesselator.tessState_.T_DORMANT;this.errorCallback_=this.mesh=this.lastEdge_=null;this.normal_=[0,0,0];this.windingRule=b.windingRule.GLU_TESS_WINDING_ODD;
this.fatalError=!1;this.combineCallback_=this.event=this.pq=this.dict=null;this.boundaryOnly_=!1;this.polygonData_=this.meshCallback_=this.endCallback_=this.vertexCallback_=this.edgeFlagCallback_=this.beginCallback_=null};b.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2};b.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(b.GluTesselator.tessState_.T_DORMANT)};b.GluTesselator.prototype.gluTessProperty=function(d,f){switch(d){case b.gluEnum.GLU_TESS_TOLERANCE:return;
case b.gluEnum.GLU_TESS_WINDING_RULE:switch(f){case b.windingRule.GLU_TESS_WINDING_ODD:case b.windingRule.GLU_TESS_WINDING_NONZERO:case b.windingRule.GLU_TESS_WINDING_POSITIVE:case b.windingRule.GLU_TESS_WINDING_NEGATIVE:case b.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:this.windingRule=f;return}break;case b.gluEnum.GLU_TESS_BOUNDARY_ONLY:this.boundaryOnly_=!!f;return;default:this.callErrorCallback(b.gluEnum.GLU_INVALID_ENUM);return}this.callErrorCallback(b.gluEnum.GLU_INVALID_VALUE)};b.GluTesselator.prototype.gluGetTessProperty=
function(d){switch(d){case b.gluEnum.GLU_TESS_TOLERANCE:return 0;case b.gluEnum.GLU_TESS_WINDING_RULE:return d=this.windingRule,b.assert(d===b.windingRule.GLU_TESS_WINDING_ODD||d===b.windingRule.GLU_TESS_WINDING_NONZERO||d===b.windingRule.GLU_TESS_WINDING_POSITIVE||d===b.windingRule.GLU_TESS_WINDING_NEGATIVE||d===b.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO),d;case b.gluEnum.GLU_TESS_BOUNDARY_ONLY:return b.assert(!0===this.boundaryOnly_||!1===this.boundaryOnly_),this.boundaryOnly_;default:this.callErrorCallback(b.gluEnum.GLU_INVALID_ENUM)}return!1};
b.GluTesselator.prototype.gluTessNormal=function(b,f,h){this.normal_[0]=b;this.normal_[1]=f;this.normal_[2]=h};b.GluTesselator.prototype.gluTessCallback=function(d,f){f=f?f:null;switch(d){case b.gluEnum.GLU_TESS_BEGIN:case b.gluEnum.GLU_TESS_BEGIN_DATA:this.beginCallback_=f;break;case b.gluEnum.GLU_TESS_EDGE_FLAG:case b.gluEnum.GLU_TESS_EDGE_FLAG_DATA:this.edgeFlagCallback_=f;break;case b.gluEnum.GLU_TESS_VERTEX:case b.gluEnum.GLU_TESS_VERTEX_DATA:this.vertexCallback_=f;break;case b.gluEnum.GLU_TESS_END:case b.gluEnum.GLU_TESS_END_DATA:this.endCallback_=
f;break;case b.gluEnum.GLU_TESS_ERROR:case b.gluEnum.GLU_TESS_ERROR_DATA:this.errorCallback_=f;break;case b.gluEnum.GLU_TESS_COMBINE:case b.gluEnum.GLU_TESS_COMBINE_DATA:this.combineCallback_=f;break;case b.gluEnum.GLU_TESS_MESH:this.meshCallback_=f;break;default:this.callErrorCallback(b.gluEnum.GLU_INVALID_ENUM)}};b.GluTesselator.prototype.gluTessVertex=function(d,f){var h=!1,e=[0,0,0];this.requireState_(b.GluTesselator.tessState_.T_IN_CONTOUR);for(var a=0;3>a;++a){var q=d[a];q<-b.GLU_TESS_MAX_COORD&&
(q=-b.GLU_TESS_MAX_COORD,h=!0);q>b.GLU_TESS_MAX_COORD&&(q=b.GLU_TESS_MAX_COORD,h=!0);e[a]=q}h&&this.callErrorCallback(b.errorType.GLU_TESS_COORD_TOO_LARGE);this.addVertex_(e,f)};b.GluTesselator.prototype.gluTessBeginPolygon=function(d){this.requireState_(b.GluTesselator.tessState_.T_DORMANT);this.state_=b.GluTesselator.tessState_.T_IN_POLYGON;this.mesh=new b.GluMesh;this.polygonData_=d};b.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(b.GluTesselator.tessState_.T_IN_POLYGON);
this.state_=b.GluTesselator.tessState_.T_IN_CONTOUR;this.lastEdge_=null};b.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(b.GluTesselator.tessState_.T_IN_CONTOUR);this.state_=b.GluTesselator.tessState_.T_IN_POLYGON};b.GluTesselator.prototype.gluTessEndPolygon=function(){this.requireState_(b.GluTesselator.tessState_.T_IN_POLYGON);this.state_=b.GluTesselator.tessState_.T_DORMANT;b.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]);b.sweep.computeInterior(this);
if(!this.fatalError){var d=this.mesh;this.boundaryOnly_?b.tessmono.setWindingNumber(d,1,!0):b.tessmono.tessellateInterior(d);this.mesh.checkMesh();if(this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)this.boundaryOnly_?b.render.renderBoundary(this,this.mesh):b.render.renderMesh(this,this.mesh,!!this.edgeFlagCallback_);if(this.meshCallback_){b.tessmono.discardExterior(this.mesh);this.meshCallback_(this.mesh);this.polygonData_=this.mesh=null;return}}b.mesh.deleteMesh(this.mesh);
this.mesh=this.polygonData_=null};b.GluTesselator.prototype.requireState_=function(b){this.state_!==b&&this.gotoState_(b)};b.GluTesselator.prototype.gotoState_=function(d){for(;this.state_!==d;)if(this.state_<d)switch(this.state_){case b.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(b.errorType.GLU_TESS_MISSING_BEGIN_POLYGON);this.gluTessBeginPolygon(null);break;case b.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(b.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case b.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(b.errorType.GLU_TESS_MISSING_END_CONTOUR);
this.gluTessEndContour();break;case b.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(b.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}};b.GluTesselator.prototype.addVertex_=function(d,f){var h=this.lastEdge_;null===h?(h=b.mesh.makeEdge(this.mesh),b.mesh.meshSplice(h,h.sym)):(b.mesh.splitEdge(h),h=h.lNext);h.org.data=f;h.org.coords[0]=d[0];h.org.coords[1]=d[1];h.org.coords[2]=d[2];h.winding=1;h.sym.winding=-1;this.lastEdge_=h};b.GluTesselator.prototype.callBeginCallback=
function(b){this.beginCallback_&&this.beginCallback_(b,this.polygonData_)};b.GluTesselator.prototype.callVertexCallback=function(b){this.vertexCallback_&&this.vertexCallback_(b,this.polygonData_)};b.GluTesselator.prototype.callEdgeFlagCallback=function(b){this.edgeFlagCallback_&&this.edgeFlagCallback_(b,this.polygonData_)};b.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)};b.GluTesselator.prototype.callCombineCallback=function(b,f,h){return this.combineCallback_?
this.combineCallback_(b,f,h,this.polygonData_)||null:null};b.GluTesselator.prototype.callErrorCallback=function(b){this.errorCallback_&&this.errorCallback_(b,this.polygonData_)};b.GluFace=function(b,f){this.next=b||this;this.prev=f||this;this.anEdge=null;this.inside=!1};b.GluHalfEdge=function(b){this.next=b||this;this.activeRegion=this.lFace=this.org=this.lNext=this.oNext=this.sym=null;this.winding=0};b.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace};b.GluHalfEdge.prototype.dst=function(){return this.sym.org};
b.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext};b.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym};b.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym};b.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext};b.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym};b.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym};b.GluMesh=function(){this.vHead=new b.GluVertex;this.fHead=new b.GluFace;this.eHead=new b.GluHalfEdge;this.eHeadSym=
new b.GluHalfEdge;this.eHead.sym=this.eHeadSym;this.eHeadSym.sym=this.eHead};b.GluMesh.prototype.checkMesh=function(){if(b.DEBUG){var d=this.fHead,f=this.vHead,h=this.eHead,e,a;for(e=e=d;(a=e.next)!==d;e=a){b.assert(a.prev===e);e=a.anEdge;do b.assert(e.sym!==e),b.assert(e.sym.sym===e),b.assert(e.lNext.oNext.sym===e),b.assert(e.oNext.sym.lNext===e),b.assert(e.lFace===a),e=e.lNext;while(e!==a.anEdge)}b.assert(a.prev===e&&null===a.anEdge);for(e=e=f;(d=e.next)!==f;e=d){b.assert(d.prev===e);e=d.anEdge;
do b.assert(e.sym!==e),b.assert(e.sym.sym===e),b.assert(e.lNext.oNext.sym===e),b.assert(e.oNext.sym.lNext===e),b.assert(e.org===d),e=e.oNext;while(e!==d.anEdge)}b.assert(d.prev===e&&null===d.anEdge&&null===d.data);for(f=f=h;(e=f.next)!==h;f=e)b.assert(e.sym.next===f.sym),b.assert(e.sym!==e),b.assert(e.sym.sym===e),b.assert(null!==e.org),b.assert(null!==e.dst()),b.assert(e.lNext.oNext.sym===e),b.assert(e.oNext.sym.lNext===e);b.assert(e.sym.next===f.sym&&e.sym===this.eHeadSym&&e.sym.sym===e&&null===
e.org&&null===e.dst()&&null===e.lFace&&null===e.rFace())}};b.GluVertex=function(b,f){this.next=b||this;this.prev=f||this;this.data=this.anEdge=null;this.coords=[0,0,0];this.pqHandle=this.t=this.s=0};b.PriorityQ=function(){this.verts_=[];this.order_=null;this.size_=0;this.initialized_=!1;this.heap_=new b.PriorityQHeap};b.PriorityQ.prototype.deleteQ=function(){this.verts_=this.order_=this.heap_=null};b.PriorityQ.prototype.init=function(){this.order_=[];for(var d=0;d<this.size_;d++)this.order_[d]=d;
d=function(d){return function(e,a){return b.geom.vertLeq(d[e],d[a])?1:-1}}(this.verts_);this.order_.sort(d);this.initialized_=!0;this.heap_.init();if(b.DEBUG)for(var f=0+this.size_-1,d=0;d<f;++d)b.assert(b.geom.vertLeq(this.verts_[this.order_[d+1]],this.verts_[this.order_[d]]))};b.PriorityQ.prototype.insert=function(b){if(this.initialized_)return this.heap_.insert(b);var d=this.size_++;this.verts_[d]=b;return-(d+1)};b.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();
var d=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var f=this.heap_.minimum();if(b.geom.vertLeq(f,d))return this.heap_.extractMin()}do--this.size_;while(0<this.size_&&null===this.verts_[this.order_[this.size_-1]]);return d};b.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var d=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var f=this.heap_.minimum();if(b.geom.vertLeq(f,d))return f}return d};b.PriorityQ.prototype.remove=function(d){if(0<=
d)this.heap_.remove(d);else for(d=-(d+1),b.assert(d<this.verts_.length&&null!==this.verts_[d]),this.verts_[d]=null;0<this.size_&&null===this.verts_[this.order_[this.size_-1]];)--this.size_};b.PriorityQHeap=function(){this.heap_=b.PriorityQHeap.reallocNumeric_([0],b.PriorityQHeap.INIT_SIZE_+1);this.verts_=[null,null];this.handles_=[0,0];this.size_=0;this.max_=b.PriorityQHeap.INIT_SIZE_;this.freeList_=0;this.initialized_=!1;this.heap_[1]=1};b.PriorityQHeap.INIT_SIZE_=32;b.PriorityQHeap.reallocNumeric_=
function(b,f){for(var d=Array(f),e=0;e<b.length;e++)d[e]=b[e];for(;e<f;e++)d[e]=0;return d};b.PriorityQHeap.prototype.init=function(){for(var b=this.size_;1<=b;--b)this.floatDown_(b);this.initialized_=!0};b.PriorityQHeap.prototype.insert=function(d){var f=++this.size_;2*f>this.max_&&(this.max_*=2,this.handles_=b.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1));var h;0===this.freeList_?h=f:(h=this.freeList_,this.freeList_=this.handles_[this.freeList_]);this.verts_[h]=d;this.handles_[h]=f;
this.heap_[f]=h;this.initialized_&&this.floatUp_(f);return h};b.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_};b.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]};b.PriorityQHeap.prototype.extractMin=function(){var b=this.heap_,f=this.verts_,h=this.handles_,e=b[1],a=f[e];0<this.size_&&(b[1]=b[this.size_],h[b[1]]=1,f[e]=null,h[e]=this.freeList_,this.freeList_=e,0<--this.size_&&this.floatDown_(1));return a};b.PriorityQHeap.prototype.remove=function(d){var f=
this.heap_,h=this.verts_,e=this.handles_;b.assert(1<=d&&d<=this.max_&&null!==h[d]);var a=e[d];f[a]=f[this.size_];e[f[a]]=a;a<=--this.size_&&(1>=a?this.floatDown_(a):b.geom.vertLeq(h[f[a>>1]],h[f[a]])?this.floatDown_(a):this.floatUp_(a));h[d]=null;e[d]=this.freeList_;this.freeList_=d};b.PriorityQHeap.prototype.floatDown_=function(d){for(var f=this.heap_,h=this.verts_,e=this.handles_,a=f[d];;){var q=d<<1;q<this.size_&&b.geom.vertLeq(h[f[q+1]],h[f[q]])&&(q+=1);b.assert(q<=this.max_);var m=f[q];if(q>
this.size_||b.geom.vertLeq(h[a],h[m])){f[d]=a;e[a]=d;break}f[d]=m;e[m]=d;d=q}};b.PriorityQHeap.prototype.floatUp_=function(d){for(var f=this.heap_,h=this.verts_,e=this.handles_,a=f[d];;){var q=d>>1,m=f[q];if(0===q||b.geom.vertLeq(h[m],h[a])){f[d]=a;e[a]=d;break}f[d]=m;e[m]=d;d=q}};b.ActiveRegion=function(){this.nodeUp=this.eUp=null;this.windingNumber=0;this.fixUpperEdge=this.dirty=this.sentinel=this.inside=!1};b.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()};
b.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()};return b})},"esri/views/2d/engine/webgl/util/Lock":function(){define(["require","exports","../../../../../core/promiseUtils"],function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(){this._resolver=null}b.prototype.isHeld=function(){return!!this._resolver};b.prototype.acquire=function(){var b=this;return this._resolver?this._resolver.promise.then(function(){return b.acquire()}):
(this._resolver=f.createResolver(),f.resolve())};b.prototype.release=function(){var b=this._resolver;this._resolver=null;b.resolve()};return b}();d.default=b;d.withLock=function(b,d,a){return b.acquire().then(function(){return d(a)}).then(function(){return b.release()}).catch(function(a){b.release();throw a;})}})},"esri/views/2d/engine/webgl/TileData":function(){define("require exports ./MemoryRequirements ./TileBufferData ./TileDisplayData ./Utils ./Utils ./WGLDisplayObject ./WGLDisplayRecord ./mesh/VertexBuffer ./util/Reader ./util/serializationUtils ./util/Writer".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r){Object.defineProperty(d,"__esModule",{value:!0});var g=new f.default,x=new f.default;b=function(){function b(){this.tileBufferData=this.tileDisplayData=null}b.prototype.reshuffle=function(){g.reset();for(var c=e.groupRecordsByGeometryType(this.tileDisplayData.displayObjects),d=0;d<c.length;d++)for(var f=c[d],k=0,l=f;k<l.length;k++){var m=l[k];m&&g.needMore(m.geometryType,m.meshData?m.meshData.vertexCount:m.vertexCount,m.meshData?m.meshData.indexData.length:m.indexCount)}k=
c.length;d=new h;for(l=0;l<k;++l){d.geometries[l].indexBuffer=new Uint32Array(Math.round(1.15*g.indicesFor(l)));var m=[],n;for(n in this.tileBufferData.geometries[l].vertexBuffer)m.push(this.tileBufferData.geometries[l].vertexBuffer[n].stride);var m=b._computeVertexAlignment(m),f=Math.round(1.15*g.verticesFor(l)),m=b._align(f,m),r;for(r in this.tileBufferData.geometries[l].vertexBuffer)f=this.tileBufferData.geometries[l].vertexBuffer[r].stride,d.geometries[l].vertexBuffer[r]={stride:f,data:q.allocateTypedArrayBuffer(m,
f)}}x.reset();this.tileDisplayData.displayList.clear();for(l=0;l<k;++l){f=c[l];n=0;for(r=f;n<r.length;n++){m=r[n];if(m.meshData)m.writeMeshDataToBuffers(x.verticesFor(l),d.geometries[l].vertexBuffer,x.indicesFor(l),d.geometries[l].indexBuffer),m.meshData=null;else{var t=this.tileBufferData.geometries[l].vertexBuffer,D=this.tileBufferData.geometries[l].indexBuffer,G=d.geometries[l].vertexBuffer,F=d.geometries[l].indexBuffer,E=x.verticesFor(l),H=x.indicesFor(l);a.copyMeshData(E,H,G,F,m,t,D);m.vertexFrom=
E;m.indexFrom=H}x.needMore(l,m.vertexCount,m.indexCount)}this.tileDisplayData.displayList.unified||this.tileDisplayData.displayList.addToList(f)}if(this.tileDisplayData.displayList.unified)for(c=0,k=this.tileDisplayData.displayObjects;c<k.length;c++)this.tileDisplayData.displayList.addToList(k[c].displayRecords);this.tileBufferData=d};b.prototype.getStrides=function(){for(var a=[],b=0;b<this.tileBufferData.geometries.length;++b){var c=this.tileBufferData.geometries[b];a[b]={};for(var d in c.vertexBuffer)a[b][d]=
c.vertexBuffer[d].stride}return a};b.prototype.clone=function(){var a=new b;a.tileBufferData=this.tileBufferData.clone();a.tileDisplayData=this.tileDisplayData.clone();return a};b.prototype._guessSize=function(){for(var a=this.tileDisplayData.displayObjects,b=Math.min(a.length,4),c=0,d=0;d<b;d++)c=Math.max(c,a[d].displayRecords.length);return 2*(12*a.length+a.length*c*40)};b.prototype.serialize=function(){var a=this.tileBufferData.serialize(),b=this.tileBufferData.getBuffers(),c=this.tileDisplayData.serialize(new r.default(Int32Array,
this._guessSize())).buffer();b.push(c);return{result:{displayData:c,bufferData:a},transferList:b}};b.decode=function(a){var c=n.deserializeList(new k.default(a.displayObjects),m),d={},e;for(e in a.vertexBuffersMap)d[e]=l.VertexBuffers.decode(a.vertexBuffersMap[e]);return b.fromMeshData({displayObjects:c,vertexBuffersMap:d})};b.fromMeshData=function(a){var c=new b,d=new e.default,g=new h;d.displayObjects=a.displayObjects;for(var f in a.vertexBuffersMap){var k=a.vertexBuffersMap[f];g.geometries[f].indexBuffer=
k.indexBuffer;g.geometries[f].vertexBuffer=k.namedBuffers}c.tileDisplayData=d;c.tileBufferData=g;return c};b.bind=function(a,c){var d=new b;d.tileDisplayData=a;d.tileBufferData=c;return d};b.create=function(a,d){var g=new b;g.tileDisplayData=new e.default;g.tileDisplayData.displayObjects=a;for(var f=[0,0,0,0,0],k=[0,0,0,0,0],l=[[],[],[],[],[]],m=0;m<a.length;m++)for(var n=0,r=a[m].displayRecords;n<r.length;n++){var t=r[n];l[t.geometryType].push(t);f[t.geometryType]+=t.meshData.vertexCount;k[t.geometryType]+=
t.meshData.indexData.length}a=new h;d=[d.fill||{},d.line||{},d.icon||{},d.text||{},d.label||{}];for(m=0;5>m;m++){var n=new Uint32Array(k[m]),r=d[m],t=f[m],x={},y=void 0;for(y in r){var u={data:q.allocateTypedArrayBuffer(t,r[y]),stride:r[y]};x[y]=u}r=x;c.writeAllMeshDataToBuffers(l[m],r,n);a.geometries[m]={indexBuffer:n,vertexBuffer:r}}g.tileBufferData=a;return g};b._align=function(a,b){var c=a%b;return 0===c?a:a+(b-c)};b._computeVertexAlignment=function(a){for(var b=!1,c=!1,d=0;d<a.length;d++){var e=
a[d];2===e%4?b=!0:0!==e%4&&(c=!0)}return c?4:b?2:1};return b}();d.TileData=b})},"esri/views/2d/engine/webgl/MemoryRequirements":function(){define(["require","exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(){this._byGeometryType=null}Object.defineProperty(b.prototype,"satisfied",{get:function(){return!this._byGeometryType},enumerable:!0,configurable:!0});b.prototype.reset=function(){this._byGeometryType=null};b.prototype.verticesFor=function(b){return this._byGeometryType?
this._byGeometryType[b].vertices:0};b.prototype.indicesFor=function(b){return this._byGeometryType?this._byGeometryType[b].indices:0};b.prototype.needMore=function(b,d,a){if(d||a)this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]),b=this._byGeometryType[b],b.vertices+=d,b.indices+=a};return b}();d.default=b})},"esri/views/2d/engine/webgl/TileBufferData":function(){define(["require","exports",
"./Utils"],function(b,d,f){return function(){function b(){this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}b.prototype.clone=function(){for(var d=new b,a=0;a<this.geometries.length;a++){var f=this.geometries[a],h=d.geometries[a];h.indexBuffer=f.indexBuffer.slice();h.vertexBuffer={};for(var c in f.vertexBuffer){var l=f.vertexBuffer[c],k=l.stride;
h.vertexBuffer[c]={data:l.data.slice(),stride:k}}}return d};b.deserialize=function(d){for(var a=new b,e=0;5>e;++e){a.geometries[e].indexBuffer=new Uint32Array(d.geometries[e].indexBuffer);a.geometries[e].vertexBuffer={};for(var h in d.geometries[e].vertexBuffer)a.geometries[e].vertexBuffer[h]={data:f.allocateTypedArrayBufferwithData(d.geometries[e].vertexBuffer[h].data,d.geometries[e].vertexBuffer[h].stride),stride:d.geometries[e].vertexBuffer[h].stride}}return a};b.prototype.serialize=function(){for(var b=
{geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]},a=0;5>a;++a)for(var d in this.geometries[a].vertexBuffer)b.geometries[a].vertexBuffer[d]={data:this.geometries[a].vertexBuffer[d].data.buffer,stride:this.geometries[a].vertexBuffer[d].stride};
return b};b.prototype.getBuffers=function(){for(var b=[],a=0;5>a;++a){b.push(this.geometries[a].indexBuffer.buffer);for(var d in this.geometries[a].vertexBuffer)b.push(this.geometries[a].vertexBuffer[d].data.buffer)}return b};return b}()})},"esri/views/2d/engine/webgl/TileDisplayData":function(){define(["require","exports","./WGLDisplayList","./WGLDisplayObject","./util/serializationUtils"],function(b,d,f,h,e){function a(a){for(var b=[[],[],[],[],[]],c=0;c<a.length;c++)for(var d=0,e=a[c].displayRecords;d<
e.length;d++){var f=e[d];b[f.geometryType].push(f)}return b}Object.defineProperty(d,"__esModule",{value:!0});d.groupRecordsByGeometryType=a;b=function(){function b(){}Object.defineProperty(b.prototype,"displayObjectRegistry",{get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;for(var a=0,b=this.displayObjects;a<b.length;a++){var d=b[a];this._displayObjectRegistry.set(d.id,d)}}return this._displayObjectRegistry},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"displayList",{get:function(){return this._displayList},enumerable:!0,configurable:!0});b.prototype.computeDisplayList=function(b){this._displayList=new f(b);if(b){b=0;for(var c=this.displayObjects;b<c.length;b++)for(var d=0,e=c[b].displayRecords;d<e.length;d++)this._displayList.addToList(e[d])}else for(b=a(this.displayObjects),c=b.length,d=0;d<c;++d)this._displayList.addToList(b[d])};b.prototype.clone=function(){var a=new b;this.displayObjects&&(a.displayObjects=this.displayObjects.map(function(a){return a.clone()}));
return a};b.prototype.serialize=function(a){e.serializeList(a,this.displayObjects);return a};b.prototype._deserializeObjects=function(a){for(var b=a.readInt32(),b=Array(b),d=new Map,e=0;e<b.length;++e){var f=h.deserialize(a);b[e]=f;d.set(f.id,f)}this.displayObjects=b;this._displayList=null;this._displayObjectRegistry=d};b.deserialize=function(a){var c=new b;c._deserializeObjects(a);return c};return b}();d.default=b})},"esri/views/2d/engine/webgl/WGLDisplayList":function(){define(["require","exports",
"../../../../core/tsSupport/generatorHelper","../../../../core/Logger","./enums"],function(b,d,f,h,e){function a(a,b,c){for(var d=[],e=3;e<arguments.length;e++)d[e-3]=arguments[e];b<a.length?a.splice.apply(a,[b,c].concat(d)):a.push.apply(a,d)}var q=h.getLogger("esri.views.2d.engine.webgl.WGLDisplayList");b=new Map;b.set(e.WGLDrawPhase.MAP,[e.WGLGeometryType.FILL,e.WGLGeometryType.LINE,e.WGLGeometryType.MARKER,e.WGLGeometryType.TEXT]);b.set(e.WGLDrawPhase.LABEL,[e.WGLGeometryType.LABEL]);b.set(e.WGLDrawPhase.LABEL_ALPHA,
[e.WGLGeometryType.LABEL]);b=function(){function b(a){void 0===a&&(a=!1);this.symbolLevels=[];this.unified=a}b.prototype.replay=function(a,b,c){if(this.unified)for(var d=0,e=this.symbolLevels;d<e.length;d++)for(var g=0,f=e[d].zLevels;g<f.length;g++){var k=f[g].geometryDPInfo,h;for(h in k)if(k[h])for(var l=0,m=k[h];l<m.length;l++){var n=m[l],q=a.painter.getGeometryBrush(n.geometryType),r=b.getGeometry(n.geometryType);q.prepareState(a,b);q.drawGeometry(a,b,n,r,c)}}};Object.defineProperty(b.prototype,
"empty",{get:function(){return!this.symbolLevels||0===this.symbolLevels.length},enumerable:!0,configurable:!0});b.prototype.clear=function(){this.symbolLevels.length=0};b.prototype.addToList=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)this._addToList(a[c],b);else this._addToList(a,b)};b.prototype.removeFromList=function(a){Array.isArray(a)||(a=[a]);for(var b=null,c=0;c<a.length;c++)b=this._removeFromList(a[c]);return b};b.prototype.byType=function(a,b){for(var c=0,d=this.symbolLevels;c<
d.length;c++)for(var e=0,g=d[c].zLevels;e<g.length;e++){var f=g[e].geometryDPInfo,k=this.getDPInfoType(a);if(f[k])for(var h=0,f=f[k];h<f.length;h++)b(f[h])}};b.prototype.clone=function(){for(var a=new b(this.unified),c=0,d=this.symbolLevels;c<d.length;c++)a.symbolLevels.push(d[c].clone());return a};b.prototype.splitAfter=function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),c=b.length,d=a.indexFrom+a.indexCount,e=0;e<c;++e){var f=b[e];if(f.geometryType===a.geometryType&&
d>f.indexFrom&&d<=f.indexFrom+f.indexCount)return d<f.indexFrom+f.indexCount&&(a=new m,a.geometryType=f.geometryType,a.materialKey=f.materialKey,a.indexFrom=d,a.indexCount=f.indexFrom+f.indexCount-d,b.splice(e+1,0,a),f.indexCount=d-f.indexFrom),e}};b.prototype._addToList=function(b,c){var d=this._getDisplayList(b.symbolLevel,b.zOrder,b.geometryType);c=null!=c?c:d.length-1;var e=0<=c&&c<d.length?d[c]:null;null===e||e.materialKey!==b.materialKey||e.indexFrom+e.indexCount!==b.indexFrom||this.unified&&
e.geometryType!==b.geometryType?(e=new m,e.indexFrom=b.indexFrom,e.indexCount=b.indexCount,e.materialKey=b.materialKey,e.geometryType=b.geometryType,a(d,c+1,0,e)):e.indexCount+=b.indexCount};b.prototype._removeFromList=function(b){for(var c=this._getDisplayList(b.symbolLevel,b.zOrder,b.geometryType),d=c.length,e=void 0,f=0;f<d;++f){var k=c[f];if(b.indexFrom+b.indexCount>k.indexFrom&&b.indexFrom<k.indexFrom+k.indexCount&&(!this.unified||k.geometryType===b.geometryType)){e=f;break}}if(void 0!==e){k=
c[e];if(b.indexFrom===k.indexFrom)return k.indexCount-=b.indexCount,k.indexFrom+=b.indexCount,0===k.indexCount&&a(c,e,1),e-1;if(b.indexFrom+b.indexCount===k.indexFrom+k.indexCount)return k.indexCount-=b.indexCount,0===k.indexCount?(a(c,e,1),e-1):e;var d=k.indexFrom,f=b.indexFrom-k.indexFrom,h=b.indexCount;b=k.indexFrom+k.indexCount-(b.indexFrom+b.indexCount);k.indexCount=f;var l=new m;l.geometryType=k.geometryType;l.materialKey=k.materialKey;l.indexFrom=d+f+h;l.indexCount=b;a(c,e+1,0,l);return e}return null};
b.prototype._getDisplayList=function(a,b,d){for(var g,f=this.symbolLevels.length,h=0;h<f;h++)if(this.symbolLevels[h].symbolLevel===a){g=this.symbolLevels[h];break}g||(g=new k,g.symbolLevel=a,this.symbolLevels.push(g));var m;a=g.zLevels.length;for(f=0;f<a;f++)if(g.zLevels[f].zLevel===b){m=g.zLevels[f];break}m||(m=new l,m.geometryDPInfo=new c,m.zLevel=b,g.zLevels.push(m));var n;if(this.unified)m.geometryDPInfo.unified||(m.geometryDPInfo.unified=[]),n=m.geometryDPInfo.unified;else switch(d){case e.WGLGeometryType.FILL:m.geometryDPInfo.fill||
(m.geometryDPInfo.fill=[]);n=m.geometryDPInfo.fill;break;case e.WGLGeometryType.LINE:m.geometryDPInfo.line||(m.geometryDPInfo.line=[]);n=m.geometryDPInfo.line;break;case e.WGLGeometryType.MARKER:m.geometryDPInfo.marker||(m.geometryDPInfo.marker=[]);n=m.geometryDPInfo.marker;break;case e.WGLGeometryType.TEXT:m.geometryDPInfo.text||(m.geometryDPInfo.text=[]);n=m.geometryDPInfo.text;break;case e.WGLGeometryType.LABEL:m.geometryDPInfo.label||(m.geometryDPInfo.label=[]);n=m.geometryDPInfo.label;break;
default:console.error("Trying to add a record with geometry type '"+d+"'.")}return n};b.prototype.getDPInfoType=function(a){if(this.unified)return"unified";switch(a){case e.WGLGeometryType.FILL:return"fill";case e.WGLGeometryType.LINE:return"line";case e.WGLGeometryType.MARKER:return"marker";case e.WGLGeometryType.TEXT:return"text";case e.WGLGeometryType.LABEL:return"label";default:q.error("DisplayList: Tried to convert unknown geometryType: "+a)}};return b}();var m=function(){function a(){this.materialKey=
null;this.indexCount=this.indexFrom=0}a.prototype.clone=function(){var b=new a;b.geometryType=this.geometryType;b.materialKey=this.materialKey;b.indexFrom=this.indexFrom;b.indexCount=this.indexCount;return b};return a}(),c=function(){function a(){this.unified=this.label=this.text=this.marker=this.line=this.fill=null}a.prototype.clone=function(){var b=new a;b.fill=this.fill&&this.fill.map(function(a){return a.clone()});b.line=this.line&&this.line.map(function(a){return a.clone()});b.marker=this.marker&&
this.marker.map(function(a){return a.clone()});b.text=this.text&&this.text.map(function(a){return a.clone()});b.label=this.label&&this.label.map(function(a){return a.clone()});b.unified=this.unified&&this.unified.map(function(a){return a.clone()});return b};return a}(),l=function(){function a(){this.geometryDPInfo=new c}a.prototype.clone=function(){var b=new a;b.zLevel=this.zLevel;b.geometryDPInfo=this.geometryDPInfo.clone();return b};return a}(),k=function(){function a(){this.zLevels=[]}a.prototype.clone=
function(){var b=new a;b.symbolLevel=this.symbolLevel;for(var c=0,d=this.zLevels;c<d.length;c++)b.zLevels.push(d[c].clone());return b};return a}();return b})},"esri/views/2d/engine/webgl/util/Reader":function(){define(["require","exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(b){this._pos=0;this._buffer=b;this._i32View=new Int32Array(this._buffer);this._f32View=new Float32Array(this._buffer)}b.prototype.readInt32=function(){return this._i32View[this._pos++]};
b.prototype.readF32=function(){return this._f32View[this._pos++]};return b}();d.default=b})},"esri/views/2d/engine/webgl/WGLRendererInfo":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../core/unitUtils ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../renderers/support/utils ./definitions ./Utils".split(" "),function(b,d,f,h,e,a,q,m,c,l,k,n){function r(a,b){var c=b.length;
if(a<b[0].value||1===c)return b[0].size;for(var d=1;d<c;d++)if(a<b[d].value)return b[d-1].size+(a-b[d-1].value)/(b[d].value-b[d-1].value)*(b[d].size-b[d-1].size);return b[c-1].size}function g(b,c,d){void 0===d&&(d=0);if(a.isNone(c))b[d+0]=0,b[d+1]=0,b[d+2]=0,b[d+3]=0;else{var e=c.g,g=c.b,f=c.a;b[d+0]=c.r*f/255;b[d+1]=e*f/255;b[d+2]=g*f/255;b[d+3]=f}}Object.defineProperty(d,"__esModule",{value:!0});var x=function(a,b,c){for(var d=c*=16,e=0;d<Math.min(c+16,a.length);d++,e++)a[d]=b[e]},t=c.mat4f32.create();
b=function(){function b(){this.symbolLevels=[];this.vvColorValues=new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.ddColors=new Float32Array(32);this.ddBackgroundColor=new Float32Array(4);this.ddActiveDots=new Float32Array(8);this.insideEffect=new Float32Array(16*k.MAX_FILTERS);this.insideOpacity=1;this.outsideEffect=new Float32Array(16*k.MAX_FILTERS);this.outsideOpacity=
1;this.effectCount=0;this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1};this._buf0=new Float32Array(2);this._buf1=new Float32Array(2);this.symbolLevels.push(0);for(var a=0;a<k.MAX_FILTERS;a++)x(this.insideEffect,t,a),x(this.outsideEffect,t,a)}Object.defineProperty(b.prototype,"insideOpacities",{get:function(){this._buf0[0]=1;this._buf0[1]=this.insideOpacity;return this._buf0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"outsideOpacities",{get:function(){this._buf1[0]=0;this._buf1[1]=this.outsideOpacity;return this._buf1},enumerable:!0,configurable:!0});b.prototype.getSizeVVFieldStops=function(b){var c=this._vvSizeFieldStops;switch(c.type){case "static":return c;case "level-dependent":return a.unwrapOr(c.levels[b],function(){var d=Infinity,e=0,g;for(g in c.levels){var f=parseFloat(g),k=Math.abs(b-f);k<d&&(d=k,e=f)}if(Infinity===d)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};
d=Math.pow(2,(b-e)/2);e=a.expect(c.levels[e]);g=new Float32Array(e.values);g[2]*=d;g[3]*=d;return{sizes:a.unwrap(e.sizes),values:g}})}};Object.defineProperty(b.prototype,"vvMaterialParameters",{get:function(){return this._vvMaterialParameters},enumerable:!0,configurable:!0});b.prototype.update=function(b){a.isSome(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,b)};b.prototype.setInfo=function(b,c,d){var e=this;a.isSome(d)?(d.forEach(function(a,b){return e._updateEffects(b,a)}),this.effectCount=
d.length):this.effectCount=0;this._vvInfo=c;switch(b.type){case "dot-density":this._updateDotDensityInfo(b)}};b.prototype.getVariation=function(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,effectCount:this.effectCount,oesTextureFloat:e("esri-webgl-texture-float")}};b.prototype.getVariationHash=function(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1|this.effectCount<<2};b.prototype._updateEffects=function(b,c){b+=1;if(a.isSome(c)&&c.filter&&
c.filter.enabled){this.outsideLabelsVisible=c.excludedLabelsVisible;var d=c.parsedIncludedEffect;c=c.parsedExcludedEffect;a.isSome(d)?(x(this.insideEffect,d.getColorMatrix(),b),this.insideOpacity=d.getOpacity()):(x(this.insideEffect,t,b),this.insideOpacity=1);a.isSome(c)?(x(this.outsideEffect,c.getColorMatrix(),b),this.outsideOpacity=c.getOpacity()):(x(this.outsideEffect,t,b),this.outsideOpacity=1)}else x(this.insideEffect,t,b),x(this.outsideEffect,t,b),this.outsideOpacity=this.insideOpacity=1};b.prototype._updateVisualVariables=
function(a,b){var c=this._vvMaterialParameters;c.vvOpacityEnabled=!1;c.vvSizeEnabled=!1;c.vvColorEnabled=!1;c.vvRotationEnabled=!1;if(a){var d=a.size;if(d){c.vvSizeEnabled=!0;if(d.minMaxValue){var e=d.minMaxValue,g=void 0,f=void 0;n.isDefined(e.minSize)&&n.isDefined(e.maxSize)&&(n.isNumber(e.minSize)&&n.isNumber(e.maxSize)?(g=q.pt2px(e.minSize),f=q.pt2px(e.maxSize)):(f=b.scale,g=q.pt2px(r(f,e.minSize.stops)),f=q.pt2px(r(f,e.maxSize.stops))));this.vvSizeMinMaxValue.set([e.minDataValue,e.maxDataValue,
g,f])}d.scaleStops&&(this.vvSizeScaleStopsValue=q.pt2px(r(b.scale,d.scaleStops.stops)));d.unitValue&&(this.vvSizeUnitValueToPixelsRatio=m.getMetersPerUnitForSR(b.spatialReference)/l.meterIn[d.unitValue.unit]/b.resolution);d.fieldStops&&(this._vvSizeFieldStops=d.fieldStops)}if(b=a.color)c.vvColorEnabled=!0,this.vvColorValues.set(b.values),this.vvColors.set(b.colors);if(b=a.opacity)c.vvOpacityEnabled=!0,this.vvOpacityValues.set(b.values),this.vvOpacities.set(b.opacities);if(a=a.rotation)c.vvRotationEnabled=
!0,c.vvRotationType=a.type}};b.prototype._updateDotDensityInfo=function(a){var b=a.attributes;this.ddDotValue=a.dotValue;this.ddDotScale=a.referenceScale;this.ddDotSize=a.dotSize;this.ddDotBlending=a.dotBlendingEnabled;this.ddSeed=a.seed;for(var c=0;c<k.DOT_DENSITY_MAX_FIELDS;c++){var d=c>=b.length?new h([0,0,0,0]):b[c].color;g(this.ddColors,d,4*c)}for(c=0;8>c;c++)this.ddActiveDots[c]=c<a.attributes.length?1:0;g(this.ddBackgroundColor,a.backgroundColor)};return b}();d.WGLRendererInfo=b})},"esri/views/2d/engine/webgl/WGLTile":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/mat2d ../../../../core/libs/gl-matrix-2/mat2df32 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ./definitions ./DirtyMap ./DisplayRecordStore ./Fader ./TiledDisplayObject ./WGLBuffers".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r){Object.defineProperty(d,"__esModule",{value:!0});var g=new Set;b=function(b){function d(a,d,g){void 0===g&&(g=!1);a=b.call(this,a,d,[m.TILE_SIZE,m.TILE_SIZE])||this;a._data=null;a._displayList=null;a._wglBuffers=null;a._dirtyMap=new c.default;a._labelIndex=null;a._dirty=!0;a.fader=new k.default;a._ensureCorrectZOrder=g;a.transforms.labelMat2d=e.mat2df32.create();return a}f(d,b);d.prototype.destroy=function(){this.clear()};Object.defineProperty(d.prototype,"displayObjects",
{get:function(){return this._data.tileDisplayData.displayObjects},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"canDisplay",{get:function(){return!!this.attached},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isDirty",{get:function(){return this._dirty},set:function(a){(this._dirty=a)||this.isReady||this.ready();this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasData",{get:function(){return!!this._data},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"labelIndex",{get:function(){return this._labelIndex},enumerable:!0,configurable:!0});d.prototype.getGeometry=function(a){return this._wglBuffers&&this._wglBuffers.has(a)?this._wglBuffers.get(a):null};d.prototype.getDisplayList=function(){return this._data&&this._displayList};Object.defineProperty(d.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});d.prototype.setTransform=function(c,d){b.prototype.setTransform.call(this,
c,d);var e=this.transforms.labelMat2d;d=c.getScreenTransform(e,d);var g=q.vec2f32.create();a.vec2.transformMat2d(g,this.coords,d);h.mat2d.identity(e);h.mat2d.translate(e,e,g);h.mat2d.multiply(e,c.viewMat2d,e)};d.prototype.setData=function(a,b,d){var e=a.addOrUpdate,g=a.remove;!a.clear&&this.hasData||a.addOrUpdate?!a.clear&&this.hasData||!a.addOrUpdate?this.hasData&&this._doPatchData({addOrUpdate:e,remove:g},b,d):(e.tileDisplayData.computeDisplayList(this._ensureCorrectZOrder),this._dirtyMap=new c.default,
this._dispRecStore=l.default.fromTileData(e,this._dirtyMap),this._data=e,this._readyTileIfNoLabels(b,d),this._dirtyMap.markAllDirty(),this._displayList||(this._displayList=e.tileDisplayData.displayList.clone())):(this.clear(),this.ready());this.emit("change")};d.prototype.commitChanges=function(){this.fader.step()||this.requestRender();this._wglBuffers||(this._wglBuffers=new r.default(this.stage.context));this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap);this._displayList=this._data.tileDisplayData.displayList.clone();
this._dirtyMap.markAllClean()};d.prototype.clear=function(){this._dispRecStore=this._displayList=this._data=null;this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)};d.prototype.attach=function(){return!0};d.prototype._readyTileIfNoLabels=function(a,b){a&&this._rebuildLabelIndex();this.isDirty=a&&b?!0:!1};d.prototype._doPatchData=function(a,b,c){this._patchData(a)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=l.default.fromTileData(this._data,this._dirtyMap));
this._readyTileIfNoLabels(b,c);this.requestRender()};d.prototype._rebuildLabelIndex=function(){this._labelIndex=this._initLabelIndex();for(var a=0,b=this.displayObjects;a<b.length;a++)for(var c=0,d=b[a].metrics;c<d.length;c++)this._insertIntoLabelIndex(d[c])};d.prototype._insertIntoLabelIndex=function(a){0>a.xBucket||0>a.yBucket||3<a.yBucket||3<a.xBucket||this.labelIndex[a.yBucket][a.xBucket].push(a)};d.prototype._initLabelIndex=function(){for(var a=[],b=0;b<m.TILE_SIZE/m.COLLISION_BUCKET_SIZE;b++){a.push([]);
for(var c=0;c<m.TILE_SIZE/m.COLLISION_BUCKET_SIZE;c++)a[b].push([])}return a};d.prototype._patchData=function(a){for(var b=!0,c=a.addOrUpdate&&a.addOrUpdate.tileDisplayData&&a.addOrUpdate.tileDisplayData.displayObjects||[],d=(a.remove||[]).slice(),e=0;e<c.length;e++){var f=c[e];null!=f.insertAfter&&d.push(f.id)}for(f=0;f<d.length;f++){var k=d[f];if(e=this._data.tileDisplayData.displayObjectRegistry.get(k)){this._data.tileDisplayData.displayList.removeFromList(e.displayRecords);for(var h=0,l=e.displayRecords;h<
l.length;h++)this._dispRecStore.delete(l[h]);this._data.tileDisplayData.displayObjectRegistry.delete(k);e=this._data.tileDisplayData.displayObjects.indexOf(e);this._data.tileDisplayData.displayObjects.splice(e,1)}}for(d=0;d<c.length;d++){f=c[d];e=this._data.tileDisplayData.displayObjectRegistry.get(f.id);k=void 0;if(e){h=e.displayRecords;e.set(f);e.displayRecords=h;h=e.displayRecords.length;for(l=0;l<h;++l){var m=e.displayRecords[l],n=f.displayRecords[l];if(l>=f.displayRecords.length||m.geometryType!==
n.geometryType||m.symbolLevel!==n.symbolLevel||m.zOrder!==n.zOrder||m.materialKey!==n.materialKey)this._dispRecStore.delete(e.displayRecords[l]),l<f.displayRecords.length&&(e.displayRecords[l]=void 0)}e.displayRecords.length=f.displayRecords.length;e.metrics=f.metrics}else if(e=f.copy(),e.displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(f.id,e),l=void 0,m=this._data.tileDisplayData.displayObjects,null!=e.insertAfter?(k={},0<=e.insertAfter?(h=this._data.tileDisplayData.displayObjectRegistry.get(e.insertAfter))?
(l=m.indexOf(h)+1,l<m.length?m.splice(l,0,e):(m.push(e),l=m.length)):(m.push(e),l=m.length):(m.unshift(e),l=0)):(m.push(e),l=m.length),k){n=void 0;if(this._data.tileDisplayData.displayList.unified)n=0<f.displayRecords.length?1:0;else{g.clear();for(var n=0,q=f.displayRecords;n<q.length;n++)h=this._data.tileDisplayData.displayList.getDPInfoType(q[n].geometryType),g.add(h);n=g.size}q=0;for(--l;0<=l&&q<n;--l)for(var r=m[l].displayRecords.length-1;0<=r&&q<n;--r){var t=m[l].displayRecords[r],h=this._data.tileDisplayData.displayList.getDPInfoType(t.geometryType);
k[h]||(k[h]=t,++q)}}q=f.displayRecords.length;for(l=0;l<q;++l){n=f.displayRecords[l];(m=e.displayRecords[l])?(m.meshData=n.meshData,m.materialKey=n.materialKey):(m=n.copy(),m.vertexFrom=void 0,m.indexFrom=void 0,e.displayRecords[l]=m);var r=n.geometryType,h=this._data.tileDisplayData.displayList.getDPInfoType(r),t=a.addOrUpdate.tileBufferData.geometries[r],r=t.vertexBuffer,t=t.indexBuffer,x=void 0;k&&(x=k[h]?this._data.tileDisplayData.displayList.splitAfter(k[h]):-1);b=this._dispRecStore.setMeshData(m,
n,r,t,x)&&b;k&&null!=m.indexFrom&&null!=m.indexFrom&&(k[h]=m)}}return b};return d}(n.TiledDisplayObject);d.WGLTile=b})},"esri/views/2d/engine/webgl/DirtyMap":function(){define(["require","exports","./Utils"],function(b,d,f){function h(b,a,d){if(!b.allDirty)if(null!=b.from&&null!=b.count){var e=Math.min(b.from,a);a=Math.max(b.from+b.count,a+d)-e;b.from=e;b.count=a}else b.from=a,b.count=d}Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(){this._dirties=f.createGeometryData(function(){return{indices:{from:null,
count:null,allDirty:!1}}},function(){return{vertices:{from:null,count:null,allDirty:!1}}})}b.prototype.hasDirty=function(){for(var a=0,b=this._dirties;a<b.length;a++){var d=b[a];if(null!==d.data.indices.count||d.data.indices.allDirty)return!0}return!1};b.prototype.markAllClean=function(){for(var a=0,b=this._dirties;a<b.length;a++){var d=b[a];d.data.indices.from=null;d.data.indices.count=null;d.data.indices.allDirty=!1;for(var c in d.buffers)d.buffers[c].data.vertices.from=null,d.buffers[c].data.vertices.count=
null,d.buffers[c].data.vertices.allDirty=!1}};b.prototype.markAllDirty=function(){for(var a=0,b=this._dirties;a<b.length;a++){var d=b[a];d.data.indices.allDirty=!0;for(var c in d.buffers)d.buffers[c].data.vertices.allDirty=!0}};b.prototype.forEach=function(a){for(var b=0;b<this._dirties.length;++b){var d=this._dirties[b],c={},e;for(e in d.buffers){var f=d.buffers[e].data.vertices;if(f.allDirty||null!=f.from&&null!=f.count&&0<f.count)c[e]=f}d=d.data.indices;f=void 0;f=d.allDirty||null!=d.from&&null!=
d.count&&0<d.count?{indices:d,vertices:c}:{indices:null,vertices:c};(f.indices||0<Object.keys(f).length)&&a(f,b)}};b.prototype.markDirtyIndices=function(a,b,d){h(this._dirties[a].data.indices,b,d)};b.prototype.markDirtyVertices=function(a,b,d,c){h(this._dirties[a].buffers[b].data.vertices,d,c)};return b}();d.default=b})},"esri/views/2d/engine/webgl/DisplayRecordStore":function(){define(["require","exports","../../../../core/has","./FreeList","./Utils"],function(b,d,f,h,e){function a(a){a=a.getStrides();
for(var b={},d=0;d<a.length;d++)b[q[d]]=a[d];return b}Object.defineProperty(d,"__esModule",{value:!0});var q=["FILL","LINE","MARKER","TEXT","LABEL"];b=function(){function b(a,b,d,f){this._strides=a;this._displayList=b;this._freeListsAndStorage={};this._dirtyMap=null;this._dirtyMap=d;for(var c in a){this._freeListsAndStorage[c]={vtxFreeList:f?new h.FreeList(f):null,idxFreeList:f?new h.FreeList(f):null,vertexBuffers:{},indexBuffer:f?new Uint32Array(f):null};for(var g in a[c])this._freeListsAndStorage[c].vertexBuffers[g]=
{data:f?e.allocateTypedArrayBuffer(f,a[c][g]):null,stride:a[c][g]}}}b.fromTileData=function(c,d){var f=a(c),l=[0,0,0,0,0],m=[0,0,0,0,0],g=[];c.tileDisplayData.displayObjectRegistry.forEach(function(a){g.push(a)});for(var x=0;x<g.length;x++)for(var t=0,u=g[x].displayRecords;t<u.length;t++){var y=u[t];l[y.geometryType]=Math.max(l[y.geometryType],y.vertexFrom+y.vertexCount);m[y.geometryType]=Math.max(m[y.geometryType],y.indexFrom+y.indexCount)}d=new b(f,c.tileDisplayData.displayList,d,null);for(f=0;f<
c.tileBufferData.geometries.length;++f){var x=l[f],u=m[f],y=c.tileBufferData.geometries[f],t=d._storageFor(q[f]),A=c.tileBufferData.geometries[f].indexBuffer;t.indexBuffer=A;t.idxFreeList=new h.FreeList(A.length);t.idxFreeList.allocate(u);var u=void 0,p;for(p in y.vertexBuffer)y=c.tileBufferData.geometries[f].vertexBuffer[p],t.vertexBuffers[p].data=y.data,t.vertexBuffers[p].stride=y.stride,A=e.strideToPackingFactor(y.stride),y=y.data.length*A/y.stride,u||(u=y);t.vtxFreeList=new h.FreeList(u);t.vtxFreeList.allocate(x)}return d};
b.prototype.delete=function(a){var b=q[a.geometryType];this._freeVertices(b,a.vertexFrom,a.vertexCount);this._freeIndices(b,a.indexFrom,a.indexCount);this._displayList.removeFromList(a);a.vertexFrom=void 0;a.indexFrom=void 0};b.prototype.setMeshData=function(a,b,d,f,h){var c=q[a.geometryType];a.meshData=null;var k=void 0,l=void 0;void 0===a.vertexFrom?(l=b.vertexCount,k=this._allocateVertices(c,l)):b.vertexCount>a.vertexCount?(this._freeVertices(c,a.vertexFrom,a.vertexCount),l=b.vertexCount,k=this._allocateVertices(c,
l)):b.vertexCount===a.vertexCount?(k=a.vertexFrom,l=a.vertexCount):(this._freeVertices(c,a.vertexFrom+b.vertexCount,a.vertexCount-b.vertexCount),k=a.vertexFrom,l=b.vertexCount);var m=!0,n=void 0,r=void 0,p=void 0;void 0===a.indexFrom?(n=h,p=b.indexCount,r=this._allocateIndices(c,p)):b.indexCount>a.indexCount?(n=this._displayList.removeFromList(a),this._freeIndices(c,a.indexFrom,a.indexCount),p=b.indexCount,r=this._allocateIndices(c,p)):b.indexCount===a.indexCount?(m=!1,r=a.indexFrom,p=a.indexCount):
(n=this._displayList.removeFromList(a),this._freeIndices(c,a.indexFrom+b.indexCount,a.indexCount-b.indexCount),r=a.indexFrom,p=b.indexCount);if(-1!==k&&-1!==r){h=this._storageFor(c);e.copyMeshData(k,r,h.vertexBuffers,h.indexBuffer,b,d,f);a.vertexFrom=k;a.indexFrom=r;a.vertexCount=b.vertexCount;a.indexCount=b.indexCount;if(this._dirtyMap){this._dirtyMap.markDirtyIndices(a.geometryType,a.indexFrom,a.indexCount);for(var w in d)this._dirtyMap.markDirtyVertices(a.geometryType,w,a.vertexFrom,a.vertexCount)}m&&
this._displayList.addToList(a,n);return!0}-1!==k&&this._freeVertices(c,k,l);-1!==r&&this._freeIndices(c,r,p);a.setMeshDataFromBuffers(b,d,f);a.vertexFrom=void 0;a.vertexCount=0;a.indexFrom=void 0;a.indexCount=0;return!1};b.prototype._allocateVertices=function(a,b){a=this._storageFor(a);b=a.vtxFreeList.allocate(b);return-1===b||.5<a.vtxFreeList.fragmentation?-1:b};b.prototype._freeVertices=function(a,b,d){var c=this._storageFor(a);c.vtxFreeList.free(b,d);if(f("esri-feature-tiles-debug"))for(var k in c.vertexBuffers)for(var g=
c.vertexBuffers[k].data,h=this._stridesFor(a,k),l=e.strideToPackingFactor(h),m=b*h/l,h=d*h/l,l=m;l<m+h;++l)g[l]=0};b.prototype._freeIndices=function(a,b,d){a=this._storageFor(a);a.idxFreeList.free(b,d);if(f("esri-feature-tiles-debug")){a=a.indexBuffer;for(var c=b;c<b+d;++c)a[c]=0}};b.prototype._allocateIndices=function(a,b){a=this._storageFor(a);b=a.idxFreeList.allocate(b);return-1===b||.5<a.idxFreeList.fragmentation?-1:b};b.prototype._storageFor=function(a){return this._freeListsAndStorage[a]};b.prototype._stridesFor=
function(a,b){return this._strides[a][b]};return b}();d.default=b})},"esri/views/2d/engine/webgl/FreeList":function(){define(["require","exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});var f=function(){function b(b){this._largestRange=null;this._parent=b;this._updateLargestRange()}Object.defineProperty(b.prototype,"largestRange",{get:function(){return this._largestRange},enumerable:!0,configurable:!0});b.prototype.rangeCreated=function(b){if(!this._largestRange||b.count>this._largestRange.count)this._largestRange=
b};b.prototype.rangeResized=function(b,a){if(b===this._largestRange)b.count<a&&this._updateLargestRange();else if(!this._largestRange||b.count>this._largestRange.count)this._largestRange=b};b.prototype.findBestRange=function(b){for(var a=this._parent._freeHead,d=null;null!==a;)a.count>=b&&(!d||a.count-b<d.count-b)&&(d=a),a=a.next;return d};b.prototype.findAdjacentRanges=function(b,a){for(var d=!0,e=!1,c=null,f=this._parent._freeHead;d&&!e;){var k=null!==f?f.from:this._parent._size;b>=(null!==c?c.from+
c.count:0)&&b+a<=k?(d=!1,e=!0):null!==f?(c=f,f=f.next):d=!1}return[c,f]};b.prototype._updateLargestRange=function(){for(var b=null,a=this._parent._freeHead;null!==a;){if(!b||a.count>b.count)b=a;a=a.next}this._largestRange=b};return b}();b=function(){function b(b,a){this._allocated=0;this._size=b;this._freeHead=0<b?{from:0,count:b,prev:null,next:null}:null;this._bookKeeper=a||new f(this);this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}b.prototype.allocate=function(d){var a=this._bookKeeper.findBestRange(d);
if(null===a)return-1;var e=a.from,f=a.count;a.from+=d;a.count-=d;this._bookKeeper.rangeResized(a,e,f);this._allocated+=d;0===a.count&&(d=null!==a.prev?this._freeHead:a.next,b._removeRange(a),this._freeHead=d);return e};b.prototype.free=function(d,a){var e=this._bookKeeper.findAdjacentRanges(d,a),f=e[0],e=e[1];d={from:d,count:a,prev:f,next:e};null!==f&&(f.next=d);null!==e&&(e.prev=d);this._bookKeeper.rangeCreated(d);this._allocated-=a;if(null!==e&&d.from+d.count===e.from){a=d.from;var c=d.count;b._fuse(d,
e);b._removeRange(e);this._bookKeeper.rangeResized(d,a,c);this._bookKeeper.rangeResized(e,void 0,0)}null!==f&&f.from+f.count===d.from&&(a=f.from,c=f.count,b._fuse(f,d),b._removeRange(d),this._bookKeeper.rangeResized(f,a,c),this._bookKeeper.rangeResized(d,void 0,0));this._freeHead=null!==d.prev?this._freeHead:d};Object.defineProperty(b.prototype,"fragmentation",{get:function(){var b=this._size-this._allocated;return 0===b?0:1-this._bookKeeper.largestRange.count/b},enumerable:!0,configurable:!0});b._removeRange=
function(b){null!==b.prev?null!==b.next?(b.prev.next=b.next,b.next.prev=b.prev):b.prev.next=null:null!==b.next&&(b.next.prev=null)};b._fuse=function(b,a){b.count+=a.count;b.next=a.next;a.from+=a.count;a.count=0;null!==a.next&&(a.next.prev=b)};return b}();d.FreeList=b})},"esri/views/2d/engine/webgl/Fader":function(){define(["require","exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(b){void 0===b&&(b=400);this.duration=b;this._value=this._elapsed=this._lastTime=
0;this._finished=!1}Object.defineProperty(b.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});b.prototype.reset=function(){this._value=this._elapsed=this._lastTime=0};b.prototype.step=function(){var b=performance.now();if(0===this._lastTime)return this._lastTime=b,this._value=0,!0;if(this._elapsed>=this.duration)return!0;this._elapsed+=b-this._lastTime;this._lastTime=b;this._value=Math.min(this._elapsed/this.duration,1);return!1};return b}();d.default=b})},"esri/views/2d/engine/webgl/WGLBuffers":function(){define(["require",
"exports","../../../webgl","./Utils"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(a){this.geometryMap=h.createGeometryData(function(){return{indexBuffer:f.BufferObject.createIndex(a,35044),vao:null}},function(b,d){return{vertexBuffer:f.BufferObject.createVertex(a,h.C_VBO_INFO[d])}})}b.prototype.dispose=function(){for(var a=0;5>a;a++){var b=this.geometryMap[a];if(b){b.data.vao&&b.data.vao.dispose(!1);b.data.indexBuffer&&b.data.indexBuffer.dispose();for(var d in b.buffers)b.buffers[d]&&
b.buffers[d].data.vertexBuffer.dispose()}}};b.prototype.get=function(a){var b=this.geometryMap[a];a={};for(var d in b.buffers)a[d]=b.buffers[d].data.vertexBuffer;return{indexBuffer:b.data.indexBuffer,get vao(){return b.data.vao},set vao(a){b.data.vao=a},vertexBufferMap:a}};b.prototype.has=function(a){return null!=this.geometryMap[a]};b.prototype.upload=function(a,b){var d=this;b.forEach(function(b,e){d._upload(b,e,a)})};b.prototype._upload=function(a,b,d){a.indices&&(a.indices.allDirty?this._uploadIndices(d,
b):null!=a.indices.from&&null!=a.indices.count&&this._uploadIndices(d,b,a.indices.from,a.indices.count));if(a.vertices){a=a.vertices;for(var c in a){var e=a[c];e.allDirty?this._uploadVertices(d,b,c):null!=e.from&&null!=e.count&&this._uploadVertices(d,b,c,e.from,e.count)}}};b.prototype._uploadVertices=function(a,b,d,c,e){var f=this.geometryMap[b];f&&(b=a.geometries[b].vertexBuffer[d])&&(a=b.stride,b=b.data.buffer,f.buffers[d]&&0<b.byteLength&&(null!=c&&null!=e?f.buffers[d].data.vertexBuffer.setSubData(b,
c*a,c*a,(c+e)*a):f.buffers[d].data.vertexBuffer.setData(b)))};b.prototype._uploadIndices=function(a,b,d,c){var e=this.geometryMap[b];e&&(a=a.geometries[b].indexBuffer.buffer,e.data.indexBuffer&&0<a.byteLength&&(null!=d&&null!=c?e.data.indexBuffer.setSubData(a,4*d,4*d,4*(d+c)):e.data.indexBuffer.setData(a)))};return b}();d.default=b})},"esri/views/2d/engine/webgl/shaders/MagnifierPrograms":function(){define(["require","exports","../../../../webgl","./sources/resolver"],function(b,d,f,h){Object.defineProperty(d,
"__esModule",{value:!0});d.magnifier={name:"magnifier",shaders:{vertexShader:h.resolveIncludes("magnifier/magnifier.vert"),fragmentShader:h.resolveIncludes("magnifier/magnifier.frag")},attributes:{a_pos:0}};d.createMagnifierProgram=function(b){return f.createProgram(b,d.magnifier)}})},"esri/views/2d/engine/BitmapTileContainer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../geometry/support/aaBoundingRect ../engine ./BitmapTile ./webgl/enums ./webgl/TileContainer".split(" "),
function(b,d,f,h,e,a,q,m,c){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}f(c,b);c.prototype.createTile=function(a){var b=this._tileInfoView.getTileBounds(e.create(),a);return new q.BitmapTile(a,b,this._tileInfoView.tileInfo.size)};c.prototype.destroyTile=function(){};c.prototype.prepareRenderPasses=function(c){var d=this,e=c.registerRenderPass({name:"bitmap (tile)",brushes:[a.brushes.Bitmap],target:function(){return d.children.map(function(a){return a.bitmap})},
drawPhase:m.WGLDrawPhase.MAP});return b.prototype.prepareRenderPasses.call(this,c).concat([e])};c.prototype.doRender=function(a){this.visible&&a.drawPhase===m.WGLDrawPhase.MAP&&b.prototype.doRender.call(this,a)};return c}(c.default);d.BitmapTileContainer=b})},"esri/views/2d/engine/LevelDependentSizeVariable":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/lang ../../../core/accessorSupport/decorators ../../../renderers/visualVariables/SizeVariable ../../../renderers/visualVariables/support/sizeVariableUtils".split(" "),
function(b,d,f,h,e,a,q,m){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}h(c,b);d=c;c.prototype.writeLevels=function(a,b,c){for(var d in a){b.stops=this.levels[d];break}};c.prototype.clone=function(){return new d({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:m.isSizeVariable(this.maxSize)?this.maxSize.clone():this.maxSize,
minDataValue:this.minDataValue,minSize:m.isSizeVariable(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(function(a){return a.clone()}),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:e.clone(this.levels)})};var d;f([a.property()],c.prototype,"levels",void 0);f([a.writer("levels")],
c.prototype,"writeLevels",null);return c=d=f([a.subclass("esri.views.2d.engine.LevelDependentSizeVariable")],c)}(a.declared(q));d.LevelDependentSizeVariable=b})},"esri/widgets/Legend/support/ActiveLayerInfo":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper dojo/i18n!../../Legend/nls/Legend ../../../Color ../../../request ../../../symbols ../../../core/Accessor ../../../core/arrayUtils ../../../core/Collection ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/ExportImageParameters ../../../layers/support/fieldUtils ../../../renderers/support/jsonUtils ../../../renderers/visualVariables/SizeVariable ../../../symbols/support/symbolUtils ../../../symbols/support/utils ../../../views/MapView ../../../views/2d/layers/support/clusterUtils ./colorRampUtils ./heatmapRampUtils ./relationshipRampUtils ./sizeRampUtils ./utils @dojo/framework/shim/Promise".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,x,t,u,y,A,p,w,v,z,B,C,D,G,F,E,H,J,K,I,M){function N(a){return"esri.renderers.SimpleRenderer"===a.declaredClass}function L(a){return"esri.renderers.ClassBreaksRenderer"===a.declaredClass}function Q(a){return"esri.renderers.UniqueValueRenderer"===a.declaredClass}function P(a){return"esri.renderers.HeatmapRenderer"===a.declaredClass}function U(a){return"esri.renderers.PointCloudClassBreaksRenderer"===a.declaredClass}function T(a){return"esri.renderers.PointCloudStretchRenderer"===
a.declaredClass}function S(a){return"esri.renderers.PointCloudUniqueValueRenderer"===a.declaredClass}function R(a){return"esri.renderers.DotDensityRenderer"===a.declaredClass}var O=t.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),V=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,X=new k.SimpleMarkerSymbol({size:6,outline:{color:[128,128,128,.5],width:.5}}),Z=new k.SimpleFillSymbol({style:"solid"}),aa=new k.SimpleMarkerSymbol({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,
color:[85,85,85,1]}});return function(d){function k(a){a=d.call(this,a)||this;a._handles=new x;a._hasColorRamp=!1;a._hasOpacityRamp=!1;a._hasSizeRamp=!1;a._legendResponse={};a._webStyleSymbolCache=new Map;a._dotDensityUrlCache=new Map;a._scaleDrivenSizeVariable=null;a.children=new g;a.layer=null;a.legendElements=[];a.parent=null;a.respectLayerVisibility=!0;a.sublayerIds=[];a.title=null;a.view=null;return a}h(k,d);k.prototype.initialize=function(){var a=this,b=function(){return a.notifyChange("ready")};
this._handles.add([p.on(this,"children","change",function(c){var d=c.removed,e=a._handles;c.added.map(function(a){var c="activeLayerInfo-ready-watcher-"+a.layer.uid;e.add(p.init(a,"ready",b),c)});d.forEach(function(a){return e.remove(a.layer.uid)});b()})])};k.prototype.destroy=function(){this._handles.destroy();this._scaleDrivenSizeVariable=this._dotDensityUrlCache=this._webStyleSymbolCache=this._legendResponse=this._handles=null};Object.defineProperty(k.prototype,"ready",{get:function(){return null===
this.layer?!0:0<this.children.length?this._isGroupActive():0<this.legendElements.length},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"scale",{get:function(){return this.view&&this.view.scale},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"isScaleDriven",{get:function(){var a=this,b=this.layer;if(null===b)return!1;if("featureReduction"in b&&b.featureReduction&&"cluster"===b.featureReduction.type)return!0;if("renderer"in b&&b.renderer){if("dot-density"===b.renderer.type)return!0;
var c=b.get("renderer.valueExpression");if(V.test(c))return!0;if(b=b.get("renderer.visualVariables"))return b.some(function(b){return a._isScaleDrivenSizeVariable(b)})}return this._isLayerScaleDriven(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"version",{get:function(){return this._get("version")+1},enumerable:!0,configurable:!0});k.prototype.buildLegendElementsForFeatureCollections=function(b){return a(this,void 0,void 0,function(){var a,c=this;return q(this,function(d){this.legendElements=
[];a=b.map(function(a){if("esri.layers.FeatureLayer"===a.declaredClass)return c._buildRendererLegendElements(a.renderer,{title:a.title,mode:0});if(a.featureSet&&a.featureSet.features.length){var b=a.layerDefinition,b=(b=b&&b.drawingInfo)&&B.fromJSON(b.renderer);return b?c._buildRendererLegendElements(b,{title:a.name,mode:0}):(O.warn("drawingInfo not available!"),null)}return null});return[2,y.eachAlways(a).then(function(){})]})})};k.prototype.buildLegendElementsForRenderer=function(b){return a(this,
void 0,void 0,function(){return q(this,function(a){return[2,this._buildRendererLegendElements(b)]})})};k.prototype.buildLegendElementsForTools=function(){return a(this,void 0,void 0,function(){var a,b=this;return q(this,function(c){switch(c.label){case 0:a=this.layer;if("esri.layers.WMTSLayer"!==a.declaredClass)return[3,1];this._constructLegendElementsForWMTSlayer();return[3,6];case 1:if("esri.layers.WMSLayer"!==a.declaredClass)return[3,2];this._constructLegendElementsForWMSSublayers();return[3,6];
case 2:return"esri.layers.MapImageLayer"!==a.declaredClass&&"esri.layers.TileLayer"!==a.declaredClass?[3,4]:[4,this._constructLegendElementsForSublayers()];case 3:return c.sent(),[3,6];case 4:return this._handles.remove("imageryLayers-watcher"),[4,this._getLegendLayers().then(function(c){b.legendElements=[];c.forEach(function(c){if("esri.layers.ImageryLayer"===a.declaredClass){var d=a.watch("renderingRule, bandIds",function(){b._legendResponse["default"]=null;b.buildLegendElementsForTools()});b._handles.add(d,
"imageryLayers-watcher")}(c=b._generateSymbolTableElementForLegendLayer(c))&&c.infos.length&&("esri.layers.ImageryLayer"===a.declaredClass&&(c.title=a.title),b.legendElements.push(c));b.notifyChange("ready")});b.notifyChange("ready")}).catch(function(a){O.warn("Request to server for legend has failed!",a)})];case 5:c.sent(),c.label=6;case 6:return[2]}})})};k.prototype._isGroupActive=function(){var a=this.children;return a.length?a.some(function(a){return a.ready}):!1};k.prototype._isScaleDrivenSizeVariable=
function(a){if(a&&"size"!==a.type)return!1;var b=a.minSize,c=a.maxSize;return"object"===typeof b&&b?this._isScaleDrivenSizeVariable(b):"object"===typeof c&&c?this._isScaleDrivenSizeVariable(c):!!a.expression||V.test(a.valueExpression)};k.prototype._isLayerScaleDriven=function(a){var b=this;if("minScale"in a&&0<a.minScale||"maxScale"in a&&0<a.maxScale)return!0;if("sublayers"in a&&a.sublayers)return a.sublayers.some(function(a){return b._isLayerScaleDriven(a)});var c=a.parent;if(!1===a.loaded&&"esri.layers.MapImageLayer"===
c.declaredClass&&"source"in a&&a.source&&"map-layer"===a.source.type)for(var d=0,c=c.sourceJSON.layers;d<c.length;d++){var e=c[d];if(e.id===a.source.mapLayerId&&(0<e.minScale||0<e.maxScale))return!0}return!1};k.prototype._buildRendererLegendElements=function(b,c){void 0===c&&(c={});return a(this,void 0,void 0,function(){var a,d;return q(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._getRendererLegendElements(b,{title:c.title})];case 1:return a=e.sent(),0===c.mode?Array.prototype.push.apply(this.legendElements,
a):this.legendElements=a,this.notifyChange("ready"),[3,3];case 2:return d=e.sent(),O.warn("error while building legend for layer!",d),[3,3];case 3:return[2]}})})};k.prototype._constructLegendElementsForWMTSlayer=function(){this.legendElements=[];this._handles.remove("wmts-activeLayer-watcher");var a=this.layer,b=a.activeLayer;this._handles.add(p.watch(this.layer,"activeLayer",this._constructLegendElementsForWMTSlayer.bind(this)),"wmts-activeLayer-watcher");if(b.styleId&&b.styles){var c=null;b.styles.some(function(a){return b.styleId===
a.id?(c=a.legendUrl,!0):!1});c&&(this.legendElements=[{type:"symbol-table",title:b.title,infos:[{src:c,opacity:a.opacity}]}])}this.notifyChange("ready")};k.prototype._constructLegendElementsForWMSSublayers=function(){this.legendElements=[];this._handles.remove("wms-sublayers-watcher");var a=this.layer,b=null;if(a.customParameters||a.customLayerParameters)b=f({},a.customParameters,a.customLayerParameters);this._handles.add(p.watch(this.layer,"sublayers",this._constructLegendElementsForWMSSublayers.bind(this)),
"wms-sublayers-watcher");this.legendElements=this._generateLegendElementsForWMSSublayers(a.sublayers,b);this.notifyChange("ready")};k.prototype._generateLegendElementsForWMSSublayers=function(a,b){var c=this,d=[];this._handles.add(a.on("change",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher");a.forEach(function(a){var e=a.watch("title, visible, legendEnabled",function(){return c._constructLegendElementsForWMSSublayers()});c._handles.add(e,"wms-sublayers-watcher");
a.visible&&a.legendEnabled&&(a=c._generateSymbolTableElementForWMSSublayer(a,b))&&a.infos.length&&d.unshift(a)});return d};k.prototype._generateSymbolTableElementForWMSSublayer=function(a,b){return!a.legendUrl&&a.sublayers?(b=this._generateLegendElementsForWMSSublayers(a.sublayers,b).filter(function(a){return a}),{type:"symbol-table",title:a.title,infos:b}):this._generateSymbolTableElementForLegendUrl(a,b)};k.prototype._generateSymbolTableElementForLegendUrl=function(a,b){var c=a.legendUrl;if(c){var d=
{type:"symbol-table",title:a.title||a.name||a.id&&a.id+"",infos:[]};b&&(c+="?"+A.objectToQuery(b));d.infos.push({src:c,opacity:a.layer&&a.layer.opacity});return d}};k.prototype._getLegendLayers=function(a){var b=this,c=(a=a&&a.hasDynamicLayers?a.dynamicLayers:null)||"default",d=this._legendResponse&&this._legendResponse[c];return d?y.resolve(d):this._legendRequest(a).then(function(a){a=a.layers;return b._legendResponse[c]=a})};k.prototype._legendRequest=function(a){var b=this.layer;a={f:"json",dynamicLayers:a};
"esri.layers.ImageryLayer"===b.declaredClass&&(b.renderingRule&&(a.renderingRule=JSON.stringify(b.renderingRule.toJSON())),b.bandIds&&(a.bandIds=b.bandIds.join()),b.raster||b.viewId)&&(a=f({raster:b.raster,viewId:b.viewId},a));var c=b.url.replace(/(\/)+$/,"");"version"in b&&10.01<=b.version?(b=c.indexOf("?"),c=-1<b?c.substring(0,b)+"/legend"+c.substring(b):c+"/legend"):(b=c.toLowerCase().indexOf("/rest/"),c=c.substring(0,b)+c.substring(b+5,c.length),c="https://utility.arcgis.com/sharing/tools/legend?soapUrl\x3d"+
encodeURI(c)+"\x26returnbytes\x3dtrue");return l(c,{query:a}).then(function(a){return a.data})};k.prototype._constructLegendElementsForSublayers=function(){return a(this,void 0,void 0,function(){var a,b,c;return q(this,function(d){switch(d.label){case 0:this.legendElements=[],this._handles.remove("sublayers-watcher"),a=this.layer,this._handles.add(p.watch(a,"sublayers",this._constructLegendElementsForSublayers.bind(this)),"sublayers-watcher"),d.label=1;case 1:return d.trys.push([1,3,,4]),b=this,[4,
this._generateLegendElementsForSublayers(a.sublayers,a.opacity)];case 2:return b.legendElements=d.sent(),this.notifyChange("ready"),[3,4];case 3:return c=d.sent(),O.warn("Request to server for legend has failed!",c),[3,4];case 4:return[2]}})})};k.prototype._generateLegendElementsForSublayers=function(b,c,d){return a(this,void 0,void 0,function(){var a,e,g,f,k,h,l,m,n,p,r,t=this;return q(this,function(q){switch(q.label){case 0:a=[],this._handles.add(b.on("change",this._constructLegendElementsForSublayers.bind(this)),
"sublayers-watcher"),e=b.toArray(),!d&&this.sublayerIds&&this.sublayerIds.length&&(g=this.layer,e=this.sublayerIds.map(function(a){return g.findSublayerById(a)}).filter(Boolean)),f=0,k=e,q.label=1;case 1:if(!(f<k.length))return[3,8];h=k[f];l=h.watch("renderer, opacity, title, visible, legendEnabled",function(){return t._constructLegendElementsForSublayers()});this._handles.add(l,"sublayers-watcher");if(!h.visible||!h.legendEnabled)return[3,7];m=h&&null!=h.opacity?h.opacity:null;n=null!=m?m*c:c;return!h.renderer||
h.sublayers?[3,5]:this.respectLayerVisibility&&!this._isSublayerInScale(h)?[3,4]:[4,h.load()];case 2:return q.sent(),[4,this._getRendererLegendElements(h.renderer,{title:h.title,opacity:n,sublayer:h})];case 3:p=q.sent(),Array.prototype.unshift.apply(a,p),q.label=4;case 4:return[3,7];case 5:return[4,this._generateSymbolTableElementForSublayer(h,n,d)];case 6:(r=q.sent())&&a.unshift(r),q.label=7;case 7:return f++,[3,1];case 8:return[2,a.filter(function(a){return a&&0<a.infos.length})]}})})};k.prototype._generateSymbolTableElementForSublayer=
function(b,c,d){return a(this,void 0,void 0,function(){var a,e,g,f;return q(this,function(k){switch(k.label){case 0:if(d)return[3,4];d=new Map;a=new v.ExportImageParameters({layer:this.layer});k.label=1;case 1:return k.trys.push([1,,3,4]),[4,this._getLegendLayers(a)];case 2:return e=k.sent(),e.forEach(function(a){return d.set(a.layerId,a)}),[3,4];case 3:return a.destroy(),[7];case 4:return(g=d.get(b.id))||!b.sublayers?[3,6]:[4,this._generateLegendElementsForSublayers(b.sublayers,c,d)];case 5:return f=
k.sent(),[2,{type:"symbol-table",title:b.title,infos:f}];case 6:return[2,this._generateSymbolTableElementForLegendLayer(g,b,c)]}})})};k.prototype._generateSymbolTableElementForLegendLayer=function(a,b,c){var d=this;if(!a||!a.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(a,b))return null;var e=b&&b.renderer,g=b&&b.title||a.layerName;e&&(e=b&&b.title||this._getRendererTitle(e,b))&&(g&&(e.title=g),g=e);g={type:"symbol-table",title:g,infos:[]};a.legendType&&(g.legendType=a.legendType);
b=b?this._sanitizeLegendForSublayer(a.legend.slice(),b):a.legend;g.infos=b.map(function(b){var e=b.url;if(b.imageData&&0<b.imageData.length)e="data:image/png;base64,"+b.imageData;else if(0!==e.indexOf("http"))e=A.addTokenParameter(d.layer.url+"/"+a.layerId+"/images/"+e);else return null;return{label:b.label,src:e,opacity:null==c?d.layer.opacity:c,width:b.width,height:b.height}}).filter(function(a){return!!a});return g.infos.length?g:null};k.prototype._isSublayerInScale=function(a){var b=a.minScale||
0;a=a.maxScale||0;return 0<b&&b<this.scale||a>this.scale?!1:!0};k.prototype._isLegendLayerInScale=function(a,b){b=b||this.layer;var c=null,d=null,e=!0;!b.minScale&&0!==b.minScale||!b.maxScale&&0!==b.maxScale?(0===a.minScale&&b.tileInfo&&(c=b.tileInfo.lods[0].scale),0===a.maxScale&&b.tileInfo&&(d=b.tileInfo.lods[b.tileInfo.lods.length-1].scale)):(c=Math.min(b.minScale,a.minScale)||b.minScale||a.minScale,d=Math.max(b.maxScale,a.maxScale));if(0<c&&c<this.scale||d>this.scale)e=!1;return e};k.prototype._sanitizeLegendForSublayer=
function(a,b){if("version"in this.layer&&10.1>this.layer.version||0===a.length)return a;b=b.renderer;var c=null,d=null;a.some(function(a){return a.values})&&a.some(function(a,b){a.values||(c=b,d=a,d.label||(d.label="others"));return null!=d});b?"unique-value"===b.type?d&&(a.splice(c,1),a.push(d)):"class-breaks"===b.type&&(d&&a.splice(c,1),a.reverse(),d&&a.push(d)):d&&(a.splice(c,1),a.push(d));return a};k.prototype._getRendererLegendElements=function(b,c){void 0===c&&(c={});return a(this,void 0,void 0,
function(){return q(this,function(a){return N(b)||L(b)||Q(b)||"raster-stretch"===b.type||"raster-colormap"===b.type||P(b)||U(b)||T(b)||S(b)||R(b)?U(b)||T(b)||S(b)||"esri.renderers.PointCloudRGBRenderer"===b.declaredClass?[2,this._constructPointCloudRendererLegendElements(b,c)]:R(b)?[2,this._constructDotDensityRendererLegendElements(b)]:[2,this._constructRendererLegendElements(b,c)]:(O.warn("Renderer not supported!"),[2,[]])})})};k.prototype._getPointCloudRendererTitle=function(a){return a.legendOptions&&
a.legendOptions.title||a.field};k.prototype._constructPointCloudRendererLegendElements=function(a,b){var c=this;void 0===b&&(b={});b=b.title;var d=[],e=null,g=null;if(U(a))e={type:"symbol-table",title:b||this._getPointCloudRendererTitle(a),infos:[]},a.colorClassBreakInfos.forEach(function(a){e.infos.unshift({label:a.label||a.minValue+" - "+a.maxValue,value:[a.minValue,a.maxValue],symbol:c._getAppliedCloneSymbol(X,a.color)})});else if(T(a)){var g=a.stops,f=null;if(g.length&&(1===g.length&&(f=g[0].color),
!f)){var k=g[0].value,h=g[g.length-1].value;null!=k&&null!=h&&(f=H.getColorFromPointCloudStops(k+(h-k)/2,g))}e={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(X,f||X.color)}]};g=H.getRampStopsForPointCloud(a.stops);g={type:"color-ramp",title:b||this._getPointCloudRendererTitle(a),infos:g,preview:D.renderColorRampPreviewHTML(g.map(function(a){return a.color}))}}else S(a)&&(e={type:"symbol-table",title:b||this._getPointCloudRendererTitle(a),infos:[]},
a.colorUniqueValueInfos.forEach(function(a){e.infos.push({label:a.label||a.values.join(", "),value:a.values.join(", "),symbol:c._getAppliedCloneSymbol(X,a.color)})}));e&&e.infos.length&&d.push(e);g&&g.infos.length&&d.push(g);a=d.reduce(function(a,b){return a.concat(b.infos)},[]).filter(function(a){return!!a.symbol}).map(function(a){return c._getSymbolPreview(a,c.layer.opacity)});return y.eachAlways(a).then(function(){return d})};k.prototype._getElementInfoForDotDensity=function(a,b){var c=a.outline,
c=a.dotSize+"-"+b+"-"+a.backgroundColor+"-"+(c&&JSON.stringify(c.toJSON())),d=this._dotDensityUrlCache;a=d.has(c)?d.get(c):D.renderDotDensityPreviewHTML(a,b);d.set(c,a);return{opacity:1,src:a.src,preview:a,width:a.width,height:a.height}};k.prototype._constructDotDensityRendererLegendElements=function(a){var b=this,c=a.calculateDotValue(this.view.scale),d={type:"symbol-table",title:{value:c&&Math.round(c),unit:a.legendOptions&&a.legendOptions.unit||""},infos:[]};a.attributes.forEach(function(c){var e=
b._getElementInfoForDotDensity(a,c.color);e.label=c.label||c.valueExpressionTitle||c.field;d.infos.push(e)});return y.resolve([d])};k.prototype._constructRendererLegendElements=function(b,c){void 0===c&&(c={});return a(this,void 0,void 0,function(){var a,d,e,g,f,k,h,l,m,n,p,r,t,x,w,v,z,M,A,I,B,C,H,F,E,G,ca,ba,O,T,U,R,S,X,V,W,Y,fa,ga,ha,da=this;return q(this,function(q){switch(q.label){case 0:return a=c.title,e=(d=c.sublayer)||this.layer,[4,this._loadRenderer(b)];case 1:return g=q.sent(),this._hasSizeRamp=
this._hasOpacityRamp=this._hasColorRamp=!1,this._scaleDrivenSizeVariable=null,[4,this._getVisualVariableLegendElements(g,e)];case 2:f=q.sent()||[];k={type:"symbol-table",title:a||this._getRendererTitle(g,e),infos:[]};h=null;l=!1;if(!P(g))return[3,3];m=J.getHeatmapRampStops(g);f.push({type:"heatmap-ramp",title:a,infos:m,preview:D.renderColorRampPreviewHTML(m.map(function(a){return a.color}))});return[3,12];case 3:if(!Q(g))return[3,4];if(p=(n=g&&g.authoringInfo)&&"relationship"===n.type){if(r=n.focus,
t=n.numClasses,x=n.field1,w=n.field2,t&&x&&w){v=[x,w];z=K.getRotationAngleForFocus(r)||0;M=0;for(A=v;M<A.length;M++)I=A[M],B=I.field,C=I.normalizationField,H={field:this._getFieldAlias(B,e),normField:C&&this._getFieldAlias(C,e)},F=aa.clone(),F.angle=z,k.infos.push({label:H,symbol:F}),z+=90;E=K.getRelationshipRampElement({focus:r,numClasses:t,infos:g.uniqueValueInfos});f.unshift(E)}}else G=g.field,g.uniqueValueInfos.forEach(function(a){a.symbol&&k.infos.push({label:a.label||da._getDomainName(G,a.value,
e)||a.value,value:a.value,symbol:a.symbol})});g.defaultSymbol&&(k.infos.push({label:g.defaultLabel||"others",symbol:g.defaultSymbol}),l=!0);return[3,12];case 4:if(!L(g))return[3,5];h=this._isUnclassedRenderer(g);if(ca=!h||!this._hasSizeRamp)g.classBreakInfos.forEach(function(a){a.symbol&&k.infos.unshift({label:a.label||(h?null:a.minValue+" - "+a.maxValue),value:[a.minValue,a.maxValue],symbol:a.symbol})}),h&&(k.title=null),this._updateInfosforClassedSizeRenderer(g,k.infos);g.defaultSymbol&&!h&&(k.infos.push({label:g.defaultLabel||
"others",symbol:g.defaultSymbol}),l=!0);return[3,12];case 5:if("raster-stretch"!==g.type)return[3,11];if("esri.layers.TileImageryLayer"!==this.layer.declaredClass)return[3,6];ba=this._constructTileImageryStretchRendererElements(g);"stretch-ramp"===ba.type?f.push(ba):k.infos=ba;return[3,10];case 6:return O=this.layer,U=T=void 0,g.statistics&&g.statistics.length&&(T=g.statistics[0].min||g.statistics[0][0],U=g.statistics[0].max||g.statistics[0][1]),R=[],X=u.unwrap,O.renderingRule?[4,O.generateRasterInfo(O.renderingRule)]:
[3,8];case 7:return V=q.sent(),[3,9];case 8:V=O.serviceRasterInfo,q.label=9;case 9:S=X.apply(void 0,[V]),W=S.keyProperties.BandProperties,1===S.bandCount?(T=T||S.statistics&&S.statistics[0].min,U=U||S.statistics&&S.statistics[0].max,T||U?f.push(this._getStretchLegendElements(g,{min:T,max:U})):this.buildLegendElementsForTools()):O.bandIds&&1===O.bandIds.length?(T=T||S.statistics&&S.statistics[O.bandIds[0]].min,U=U||S.statistics&&S.statistics[O.bandIds[0]].max,T||U?f.push(this._getStretchLegendElements(g,
{min:T,max:U})):this.buildLegendElementsForTools()):3<=S.bandCount?W&&W.length>=S.bandCount?O.bandIds&&3===O.bandIds.length?(R=O.bandIds.map(function(a){return W[a].BandName}),k.infos=this._createSymbolTableElementMultiBand(R)):"lerc"===O.format?(R=[0,1,2].map(function(a){return W[a].BandName}),k.infos=this._createSymbolTableElementMultiBand(R)):this.buildLegendElementsForTools():"lerc"===O.format?(R=["band0","band1","band2"],k.infos=this._createSymbolTableElementMultiBand(R)):this.buildLegendElementsForTools():
this.buildLegendElementsForTools(),q.label=10;case 10:return[3,12];case 11:"raster-colormap"===g.type?g.colormapInfos.forEach(function(a){k.infos.push({label:a.label,value:a.value,symbol:da._getAppliedCloneSymbol(Z,a.color)})}):N(g)&&g.symbol&&!this._hasSizeRamp&&k.infos.push({label:g.label,symbol:g.symbol}),q.label=12;case 12:return Y=g.defaultSymbol,!Y||l||N(g)||h&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||f.push({type:"symbol-table",infos:[{label:g.defaultLabel||"others",
symbol:Y}]}),k.infos.length&&f.unshift(k),fa=null==c.opacity?e.opacity:c.opacity,ga=this._getSymbolConfig("visualVariables"in g&&g.visualVariables),ha=f.reduce(function(a,b){return a.concat(b.infos)},[]).filter(function(a){return!(!a||!a.symbol)}).map(function(a){return da._getSymbolPreview(a,fa,ga)}),g=null,[4,y.eachAlways(ha)];case 13:return q.sent(),[2,f]}})})};k.prototype._constructTileImageryStretchRendererElements=function(a){var b=this.layer,c=b.rasterInfo,d=c.bandCount||a.statistics.length,
e,g,f=[],k=c.keyProperties&&c.keyProperties.BandProperties;a.statistics&&a.statistics.length&&(e=void 0!==a.statistics[0].min?a.statistics[0].min:a.statistics[0][0],g=a.statistics[0].max||a.statistics[0][1]);if(1===c.bandCount)return this._getStretchLegendElements(a,{min:e,max:g});f=k&&k.length>=c.bandCount?b.bandIds&&b.bandIds.length===d?b.bandIds.map(function(a){return k[a].BandName}):[0,1,2].map(function(a){return k[a].BandName||"band"+a}):["band0","band1","band2"];3>d&&3>f.length?f.push(f[1]):
3<d&&3<f.length&&f.splice(3);return this._createSymbolTableElementMultiBand(f)};k.prototype._getStretchLegendElements=function(a,b){a=H.getStrectchRampStops(a.colorRamp,b);return{type:"stretch-ramp",title:"",infos:a,preview:D.renderColorRampPreviewHTML(a.map(function(a){return a.color}))}};k.prototype._createSymbolTableElementMultiBand=function(a){var b=[],c=["red","green","blue"];a.forEach(function(a,d){b.push({label:{colorName:c[d],bandName:a},src:M.RGB_IMG_SOURCE[d],opacity:1})});return b};k.prototype._updateInfosforClassedSizeRenderer=
function(a,b){var c=a.authoringInfo&&"class-breaks-size"===a.authoringInfo.type,d=a.classBreakInfos.some(function(a){return G.isVolumetricSymbol(a.symbol)});if(c&&d){var e=I.REAL_WORLD_MAX_SIZE;a=a.classBreakInfos.length;var g=(e-I.REAL_WORLD_MIN_SIZE)/(1<a?a-1:a);b.forEach(function(a,b){a.size=e-g*b})}};k.prototype._getSymbolConfig=function(a){var b=!1,c=!1;if(a)for(var d=0;d<a.length&&(!b||!c);d++){var e=a[d];"size"===e.type&&("height"===e.axis&&(b=!0),"width-and-depth"===e.axis&&(c=!0))}return b&&
c?"tall":null};k.prototype._getSymbolPreview=function(c,d,e){return a(this,void 0,void 0,function(){var a,g;return q(this,function(f){switch(f.label){case 0:return a=c.size,this._scaleDrivenSizeVariable?[4,new Promise(function(a,c){b(["../../../renderers/visualVariables/support/visualVariableUtils"],a,c)})]:[3,2];case 1:g=f.sent().getSize,a=g(this._scaleDrivenSizeVariable,null,{view:this.view,scale:this.scale,shape:"simple-marker"===c.symbol.type?c.symbol.style:null}),f.label=2;case 2:return[2,D.renderPreviewHTML(c.symbol,
{size:a,opacity:d,symbolConfig:e,rotation:c.symbol.angle}).then(function(a){c.preview=a;return c}).catch(function(){c.preview=null;return c})]}})})};k.prototype._loadRenderer=function(b){return a(this,void 0,void 0,function(){var a,c,d,e,g=this;return q(this,function(f){switch(f.label){case 0:return a=[],b=b.clone(),[4,this._getMedianColor(b)];case 1:c=f.sent();if(L(b)||Q(b))d=b.classBreakInfos||b.uniqueValueInfos,e=d.map(function(a){return g._fetchSymbol(a.symbol,c).then(function(b){a.symbol=b}).catch(function(){a.symbol=
null})}),Array.prototype.push.apply(a,e);a.push(this._fetchSymbol(b.symbol||b.defaultSymbol,b.defaultSymbol?null:c).then(function(a){g._applySymbolToRenderer(b,a,N(b))}).catch(function(){g._applySymbolToRenderer(b,null,N(b))}));return[2,y.eachAlways(a).then(function(){return b})]}})})};k.prototype._applySymbolToRenderer=function(a,b,c){c?a.symbol=b:a.defaultSymbol=b};k.prototype._getMedianColor=function(c){return a(this,void 0,void 0,function(){var a,d,e,g,f;return q(this,function(k){switch(k.label){case 0:if(!("visualVariables"in
c&&c.visualVariables))return[2,null];a=r.find(c.visualVariables,function(a){return"color"===a.type});if(!a)return[2,null];e=d=null;if(a.stops){if(1===a.stops.length)return[2,a.stops[0].color];d=a.stops[0].value;e=a.stops[a.stops.length-1].value}g=d+(e-d)/2;return[4,new Promise(function(a,c){b(["../../../renderers/visualVariables/support/visualVariableUtils"],a,c)})];case 1:return f=k.sent().getColor,[2,f(a,g)]}})})};k.prototype._fetchSymbol=function(a,b){var c=this;if(!a)return y.reject();if("web-style"===
a.type){var d=a.portal,d=a.name+"-"+a.styleName+"-"+a.styleUrl+"-"+(d&&d.url)+"-"+(d&&d.user&&d.user.username),e=this._webStyleSymbolCache;e.has(d)||(this.view instanceof F?e.set(d,a.fetchCIMSymbol()):e.set(d,a.fetchSymbol()));return e.get(d).then(function(a){return c._getAppliedCloneSymbol(a,b)}).catch(function(){O.warn("Fetching web-style failed!");return y.reject()})}return y.resolve(this._getAppliedCloneSymbol(a,b))};k.prototype._getAppliedCloneSymbol=function(a,b){if(!a)return a;a=a.clone();
var d=-1<a.type.indexOf("3d");b=b&&b.toRgba();d?this._applyColorTo3dSymbol(a,b):a.color&&(a.color=new c(b||a.color));return a};k.prototype._applyColorTo3dSymbol=function(a,b){b&&a.symbolLayers.forEach(function(a){a&&(a.material||(a.material={}),a.material.color=new c(b))})};k.prototype._createClusterSizeVariable=function(a){var b=E.getActiveSizeStops(this.view,a);return new C({field:a.field,legendOptions:{title:m.clusterCountTitle},minSize:b[2].size,minDataValue:b[2].value,maxSize:b[3].size,maxDataValue:b[3].value})};
k.prototype._getVisualVariableLegendElements=function(b,c){return a(this,void 0,void 0,function(){var d,e,g,f,k,h,l,m,n,p=this;return q(this,function(r){switch(r.label){case 0:if(!("visualVariables"in b&&b.visualVariables))return[2,null];d=b.visualVariables;e=[];g=[];f=[];d.forEach(function(a){"color"===a.type?e.push(a):"size"===a.type?("levels"in a&&a.levels&&(a=p._createClusterSizeVariable(a)),g.push(a)):"opacity"===a.type&&f.push(a)});k=e.concat(g,f);0===e.length&&L(b)&&b.classBreakInfos&&1===
b.classBreakInfos.length&&(h=(m=b.classBreakInfos[0])&&m.symbol);0===e.length&&N(b)&&(h=b.symbol);h&&(-1<h.type.indexOf("3d")?(n=h.symbolLayers.getItemAt(0),"water"===n.type?u.isSome(n.color)&&(l=n.color):u.isSome(n.material)&&u.isSome(n.material.color)&&(l=n.material.color)):h.url||(l=h.color));return[4,y.all(k.map(function(d){return a(p,void 0,void 0,function(){var a,e,g,f,k,h,m,n;return q(this,function(p){switch(p.label){case 0:if(d.legendOptions&&!1===d.legendOptions.showLegend)return[3,10];a=
this._getRampTitle(d,c);e=null;f=(g="getField"in c&&c.getField&&c.getField(d.field))&&z.isDateField(g);return"color"!==d.type?[3,2]:[4,H.getRampStops(d,null,f)];case 1:return k=p.sent(),e={type:"color-ramp",title:a,infos:k,preview:D.renderColorRampPreviewHTML(k.map(function(a){return a.color}))},this._hasColorRamp||(this._hasColorRamp=!(null==e.infos||!e.infos.length)),[3,9];case 2:if("size"!==d.type||"outline"===d.target)return[3,7];if(!V.test(d.valueExpression))return[3,3];this._scaleDrivenSizeVariable=
d;return[3,6];case 3:return h={type:"size-ramp",title:a},m=I.getRampStops,n=[b,d],[4,this._getMedianColor(b)];case 4:return[4,m.apply(void 0,n.concat([p.sent(),this.scale,this.view,f]))];case 5:e=(h.infos=p.sent(),h),this._hasSizeRamp||(this._hasSizeRamp=!(null==e.infos||!e.infos.length)),p.label=6;case 6:return[3,9];case 7:return"opacity"!==d.type?[3,9]:[4,H.getRampStops(d,l,f)];case 8:k=p.sent(),e={type:"opacity-ramp",title:a,infos:k,preview:D.renderColorRampPreviewHTML(k.map(function(a){return a.color}))},
this._hasOpacityRamp||(this._hasOpacityRamp=!(null==e.infos||!e.infos.length)),p.label=9;case 9:return[2,e&&e.infos?e:null];case 10:return[2,void 0]}})})}))];case 1:return[2,r.sent().filter(function(a){return!!a})]}})})};k.prototype._getDomainName=function(a,b,c){return a&&"function"!==typeof a?(c=(a="getField"in c&&c.getField&&c.getField(a))&&"getFieldDomain"in c&&c.getFieldDomain?c.getFieldDomain(a.name):null)&&"coded-value"===c.type?c.getName(b):null:null};k.prototype._getRampTitle=function(a,
b){var c=a.field,d=a.normalizationField,e=!1,g=!1,f=!1,k=null,c="function"===typeof c?null:c,d="function"===typeof d?null:d;if(null!=(a.legendOptions&&a.legendOptions.title))k=a.legendOptions.title;else if(a.valueExpressionTitle)k=a.valueExpressionTitle;else{if("renderer"in b&&b.renderer&&"authoringInfo"in b.renderer&&b.renderer.authoringInfo&&b.renderer.authoringInfo.visualVariables)for(a=b.renderer.authoringInfo.visualVariables,k=0;k<a.length;k++){var h=a[k];if("color"===h.type){if("ratio"===h.style){e=
!0;break}if("percent"===h.style){g=!0;break}if("percent-of-total"===h.style){f=!0;break}}}k={field:c&&this._getFieldAlias(c,b),normField:d&&this._getFieldAlias(d,b),ratio:e,ratioPercent:g,ratioPercentTotal:f}}return k};k.prototype._getRendererTitle=function(a,b){if(a.legendOptions&&a.legendOptions.title)return a.legendOptions.title;if(a.valueExpressionTitle)return a.valueExpressionTitle;var c=a.field,d=null,e=null;L(a)&&(d=a.normalizationField,e="percent-of-total"===a.normalizationType);c="function"===
typeof c?null:c;d="function"===typeof d?null:d;a=null;if(c||d)a={field:c&&this._getFieldAlias(c,b),normField:d&&this._getFieldAlias(d,b),normByPct:e};return a};k.prototype._getFieldAlias=function(a,b){var c="popupTemplate"in b&&b.popupTemplate,c=c&&c.fieldInfos,d=null;c&&c.some(function(b){return a===b.fieldName?(d=b,!0):!1});c=null;"getField"in b&&b.getField?c=b.getField(a):"fieldsIndex"in b&&b.fieldsIndex&&(c=b.fieldsIndex.get(a));b=d||c;var e=null;b&&(e=d&&d.label||c&&c.alias||"name"in b&&b.name||
"fieldName"in b&&b.fieldName);return e};k.prototype._isUnclassedRenderer=function(a){var b=a.visualVariables,c=!1;L(a)&&a.classBreakInfos&&1===a.classBreakInfos.length&&b&&(c=a.field?b.some(function(b){return!(!b||a.field!==b.field||(a.normalizationField||b.normalizationField)&&a.normalizationField!==b.normalizationField)}):!!b.length);return c};e([w.property()],k.prototype,"children",void 0);e([w.property()],k.prototype,"layer",void 0);e([w.property()],k.prototype,"legendElements",void 0);e([w.property()],
k.prototype,"parent",void 0);e([w.property({readOnly:!0})],k.prototype,"ready",null);e([w.property()],k.prototype,"respectLayerVisibility",void 0);e([w.property({dependsOn:["view.scale"],readOnly:!0})],k.prototype,"scale",null);e([w.property()],k.prototype,"sublayerIds",void 0);e([w.property({dependsOn:["layer.renderer?.valueExpression?","layer.renderer?.visualVariables?","layer.featureReduction?","scale"],readOnly:!0})],k.prototype,"isScaleDriven",null);e([w.property()],k.prototype,"title",void 0);
e([w.property({dependsOn:["ready"],readOnly:!0,value:0})],k.prototype,"version",null);e([w.property()],k.prototype,"view",void 0);return k=e([w.subclass("esri.widgets.Legend.support.ActiveLayerInfo")],k)}(w.declared(n))})},"esri/layers/support/ExportImageParameters":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./sublayerUtils ./timeUtils ../../views/View".split(" "),
function(b,d,f,h,e,a,q,m,c,l){Object.defineProperty(d,"__esModule",{value:!0});var k={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._scale=null;b.view=null;return b}h(b,a);Object.defineProperty(b.prototype,"dynamicLayers",
{get:function(){if(!this.hasDynamicLayers)return null;var a=this.visibleSublayers.map(function(a){return a.toExportImageJSON()});return a.length?JSON.stringify(a):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasDynamicLayers",{get:function(){return this.layer&&m.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"layer",{set:function(a){var b=this;this._get("layer")!==a&&(this._set("layer",
a),this._layerHandles&&(this._layerHandles.forEach(function(a){return a.remove()}),this._layerHandles.length=0),a&&(this._layerHandles=[a.allSublayers.on("change",function(){return b.notifyChange("visibleSublayers")}),a.on("sublayer-update",function(a){return b.notifyChange(k[a.propertyName])})]))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"layers",{get:function(){var a=this.visibleSublayers;return a?a.length?"show:"+a.map(function(a){return a.id}).join(","):"show:-1":null},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"layerDefs",{get:function(){var a=this.visibleSublayers.filter(function(a){return null!=a.definitionExpression});return a.length?JSON.stringify(a.reduce(function(a,b){a[b.id]=b.definitionExpression;return a},{})):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"scale",{get:function(){return null!=this._scale?this._scale:this.view&&this.view.scale||0},set:function(a){this.view||(this._scale=a,this.notifyChange("scale"))},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"version",{get:function(){this.layers;this.layerDefs;this.dynamicLayers;this.timeExtent;var a=this.layer;a&&(a.dpi,a.imageFormat,a.imageTransparency,a.gdbVersion);return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visibleSublayers",{get:function(){var a=this,b=[];if(!this.layer)return b;var c=this.layer.sublayers,d=function(c){var e=a.scale,g=
0===c.minScale||e<=c.minScale,f=0===c.maxScale||e>=c.maxScale;c.visible&&(0===e||g&&f)&&(c.sublayers?c.sublayers.forEach(d):b.unshift(c))};c&&c.forEach(d);c=this._get("visibleSublayers");return!c||c.length!==b.length||c.some(function(a,c){return b[c]!==a})?b:c},enumerable:!0,configurable:!0});b.prototype.toJSON=function(){var a=this.layer,a={dpi:a.dpi,format:a.imageFormat,transparent:a.imageTransparency,gdbVersion:a.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?a.dynamicLayers=this.dynamicLayers:
a=f({},a,{layers:this.layers,layerDefs:this.layerDefs});return a};e([q.property({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],b.prototype,"dynamicLayers",null);e([q.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],b.prototype,"hasDynamicLayers",null);e([q.property()],b.prototype,"layer",null);e([q.property({readOnly:!0,dependsOn:["visibleSublayers"]})],b.prototype,"layers",null);e([q.property({readOnly:!0,dependsOn:["visibleSublayers"]})],
b.prototype,"layerDefs",null);e([q.property({type:Number,dependsOn:["view.scale"]})],b.prototype,"scale",null);e([q.property(c.combinedViewLayerTimeExtentProperty)],b.prototype,"timeExtent",void 0);e([q.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion timeExtent".split(" ")})],b.prototype,"version",null);e([q.property({type:l})],b.prototype,"view",void 0);e([q.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],b.prototype,
"visibleSublayers",null);return b=e([q.subclass("esri.layers.mixins.ExportImageParameters")],b)}(q.declared(a));d.ExportImageParameters=b})},"esri/symbols/support/symbolUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../core/compilerUtils ../../core/maybe ../../core/promiseUtils ../../support/arcadeOnDemand ./previewCIMSymbol ./previewSymbol2D ./previewSymbol3D ./previewWebStyleSymbol ./utils".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g){function x(b,c){switch(b.type){case "web-style":return r.previewWebStyleSymbol(b,x,c);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return n.previewSymbol3D(b,c);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return k.previewSymbol2D(b,c);case "cim":return l.previewCIMSymbol(b,c);default:a.neverReached(b)}}function t(a){return a&&"opacity"in a?a.opacity*t(a.parent):
1}Object.defineProperty(d,"__esModule",{value:!0});var u=null;d.renderDotDensityPreviewHTML=function(a,b,c){var d=a.backgroundColor,e=a.outline;a=a.dotSize;var g=c&&c.swatchSize||22,f=Math.round(g*g/Math.pow(a,2)*.8),k=window.devicePixelRatio;c=document.createElement("canvas");var h=g*k;c.width=h;c.height=h;c.style.width=c.width/k+"px";c.style.height=c.height/k+"px";var l=c.getContext("2d");d&&(l.fillStyle=d.toCss(!0),l.fillRect(0,0,h,h),l.fill());l.fillStyle=b.toCss(!0);if(u&&u.length/2===f)for(b=
0;b<2*f;b+=2){var d=u[b],m=u[b+1];l.fillRect(d,m,a*k,a*k);l.fill()}else for(u=[],b=0;b<2*f;b+=2)d=Math.floor(Math.random()*(h-0+1)+0),m=Math.floor(Math.random()*(h-0+1)+0),u.push(d,m),l.fillRect(d,m,a*k,a*k),l.fill();e&&(e.color&&(l.strokeStyle=e.color.toCss(!0)),l.lineWidth=e.width,l.strokeRect(0,0,h,h));e=new Image(g,g);e.src=c.toDataURL();return e};d.renderColorRampPreviewHTML=function(a,b){void 0===b&&(b={});var c="horizontal"===b.align,d=b.width,d=void 0===d?c?75:24:d,e=b.height,e=void 0===e?
c?24:75:e;b=b.gradient;var g=void 0===b?!0:b;b=window.devicePixelRatio;var f=d*b,k=e*b;b=document.createElement("canvas");b.width=f;b.height=k;b.style.width=d+"px";b.style.height=e+"px";var h=b.getContext("2d"),l=c?f:0,m=c?0:k;if(g){var n=h.createLinearGradient(0,0,l,m),q=1/(a.length-1);a.forEach(function(a,b){return n.addColorStop(b*q,a.toString())});h.fillStyle=n;h.fillRect(0,0,f,k)}else for(g=c?f/a.length:f,f=c?k:k/a.length,m=l=k=0;m<a.length;m++)h.fillStyle=a[m].toString(),h.fillRect(k,l,g,f),
k=c?k+g:0,l=c?0:l+f;a=document.createElement("div");a.style.width=d+"px";a.style.height=e+"px";a.appendChild(b);return a};d.renderPreviewHTML=x;d.getDisplayedSymbol=function(a,d){return h(this,void 0,void 0,function(){var k,h,l,n,r,x,u,y,A,E,H,J,K,I,M,N,L,Q,P,U,T,S,R;return f(this,function(f){switch(f.label){case 0:if(!a)return[2,void 0];k=t(a.layer||a.sourceLayer);return!q.isSome(a.symbol)||q.isSome(d)&&!0===d.ignoreGraphicSymbol?[3,4]:"web-style"!==a.symbol.type?[3,2]:[4,a.symbol.fetchSymbol(q.isSome(d)?
d.abortOptions:null)];case 1:return l=f.sent(),[3,3];case 2:l=a.symbol.clone(),f.label=3;case 3:return h=l,g.applyColorToSymbol(h,null,k),[2,h];case 4:return n=a.get("layer.renderer")||a.get("sourceLayer.renderer"),[4,n.getSymbolAsync(a)];case 5:return(r=f.sent())?"web-style"!==r.type?[3,7]:[4,r.fetchSymbol(q.isSome(d)?d.abortOptions:null)]:[2,void 0];case 6:return r=f.sent(),[3,8];case 7:r=r.clone(),f.label=8;case 8:if(!("visualVariables"in n)||"visualVariables"in n&&!n.visualVariables||"visualVariables"in
n&&n.visualVariables&&!n.visualVariables.length)return[2,r];if(!n.arcadeRequiredForVisualVariables||!q.isNone(d)&&!q.isNone(d.arcade))return[3,10];u=x=e({},q.unwrap(d));return[4,c.loadArcade()];case 9:u.arcade=f.sent(),d=x,f.label=10;case 10:return[4,m.create(function(a){return b(["../../renderers/visualVariables/support/visualVariableUtils"],a)})];case 11:y=f.sent();A=[];E=[];H=[];J=[];K=0;for(I=n.visualVariables;K<I.length;K++)switch(M=I[K],M.type){case "color":A.push(M);break;case "opacity":E.push(M);
break;case "rotation":J.push(M);break;case "size":M.target||H.push(M)}L=(N=!!A.length&&A[A.length-1])?y.getColor(N,a,d):null;P=(Q=!!E.length&&E[E.length-1])?y.getOpacity(Q,a,d):null;null!=k&&(P=null!=P?P*k:k);g.applyColorToSymbol(r,L,P);if(!H.length)return[3,13];U=y.getAllSizes(H,a,d);return[4,g.applySizesToSymbol(r,U)];case 12:f.sent(),f.label=13;case 13:T=0;for(S=J;T<S.length;T++)R=S[T],g.applyRotationToSymbol(r,y.getRotationAngle(R,a,d),R.axis);return[2,r]}})})}})},"esri/symbols/support/previewCIMSymbol":function(){define(["require",
"exports","../../core/tsSupport/generatorHelper","../../core/tsSupport/awaiterHelper","../cim/CIMSymbolRasterizer"],function(b,d,f,h,e){Object.defineProperty(d,"__esModule",{value:!0});var a=new e(null,!0);d.previewCIMSymbol=function(b,d){void 0===d&&(d={});return h(this,void 0,void 0,function(){var c,e,k,h,m,g,q,t,u,y;return f(this,function(f){switch(f.label){case 0:return c=d.size,e=d.maxSize,k=d.feature,h=d.fieldMap,m=Math.min(c||22,e||120),g=3,[4,a.rasterizeCIMSymbolAsync(b,k,h,{targetSize:m*
g})];case 1:return q=f.sent(),t=document.createElement("canvas"),t.width=q.imageData.width,t.height=q.imageData.height,u=t.getContext("2d"),u.putImageData(q.imageData,0,0),y=new Image(t.width/g,t.height/g),y.src=t.toDataURL(),[2,y]}})})}})},"esri/symbols/support/previewSymbol2D":function(){define("require exports ../../core/Error ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils".split(" "),function(b,d,f,h,e,a,q,m){function c(a,b){var c=k.getContext("2d"),d=[];
b&&(b.weight&&d.push(b.weight),b.size&&d.push(b.size+"px"),b.family&&d.push(b.family));c.font=d.join(" ");return c.measureText(a).width}function l(a){if(0===a.length)return 0;if(2<a.length){var b=e.px2pt(1),c=parseFloat(a);switch(a.slice(-2)){case "px":return c;case "pt":return c*b;case "in":return 72*c*b;case "pc":return 12*c*b;case "mm":return c*n*b;case "cm":return c*r*b}}return parseFloat(a)}Object.defineProperty(d,"__esModule",{value:!0});var k=document.createElement("canvas"),n=7.2/2.54,r=72/
2.54;d.previewSymbol2D=function(b,d){var g=d&&d.size?e.pt2px(d.size):null,k=d&&d.maxSize?e.pt2px(d.maxSize):null,n=d&&null!=d.opacity?d.opacity:null,r=d&&null!=d.rotation?d.rotation:null,p=a.getStroke(b),x={shape:null,fill:null,stroke:p};p&&p.width&&(p.width=Math.min(p.width,80));var v=0,z=0;switch(b.type){case "simple-marker":var p=b.style,B=e.pt2px(b.size),v=Math.min(g||B||22,k||120),z=Math.min(g||B||22,k||120);switch(p){case "circle":x.shape={type:"circle",cx:.5*B,cy:.5*B,r:.5*B};break;case "cross":x.shape=
{type:"path",path:[{command:"M",values:[0,.5*z]},{command:"L",values:[v,.5*z]},{command:"M",values:[.5*v,0]},{command:"L",values:[.5*v,z]}]};break;case "diamond":x.shape={type:"path",path:[{command:"M",values:[0,.5*z]},{command:"L",values:[.5*v,0]},{command:"L",values:[v,.5*z]},{command:"L",values:[.5*v,z]},{command:"Z",values:[]}]};break;case "square":x.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[v,0]},{command:"L",values:[v,z]},{command:"L",values:[0,z]},{command:"Z",
values:[]}]};break;case "triangle":x.shape={type:"path",path:[{command:"M",values:[.5*v,0]},{command:"L",values:[v,z]},{command:"L",values:[0,z]},{command:"Z",values:[]}]};break;case "x":x.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[v,z]},{command:"M",values:[v,0]},{command:"L",values:[0,z]}]};break;case "path":x.shape={type:"path",path:b.path||""}}break;case "simple-line":g=Math.min(g||p&&p.width||22,k||80);p.width=g;v=22<g?2*g:40;z=g;x.shape={type:"path",path:[{command:"M",
values:[0,z]},{command:"L",values:[v,z]}]};break;case "picture-fill":case "simple-fill":v=Math.min(g||22,k||120);z=Math.min(g||22,k||120);x.shape=q.shapes.fill[0];break;case "picture-marker":var p=e.pt2px(b.width),C=e.pt2px(b.height),B=Math.max(p,C),C=p/C,p=1>=C?Math.ceil(B*C):B,C=1>=C?B:Math.ceil(B/C),v=Math.min(g||p||22,k||120),z=Math.min(g||C||22,k||120);x.shape={type:"image",x:-Math.round(v/2),y:-Math.round(z/2),width:v,height:z,src:b.url||""};break;case "text":p=b.text||"Aa",B=b.font,g=Math.min(g||
e.pt2px(B.size),k||120),C=c(p,{weight:B.weight,size:g,family:B.family}),v=(k=/[\uE600-\uE6FF]/.test(p))?g:C,z=g,C=.25*l((B?g:0).toString()),k&&(C+=5),x.shape={type:"text",text:p,x:0,y:C,align:"middle",decoration:B&&B.decoration,rotated:b.rotated,kerning:b.kerning},x.font=B&&{size:g,style:B.style,decoration:B.decoration,weight:B.weight,family:B.family}}if(!x.shape)return h.reject(new f("symbolPreview: renderPreviewHTML2D","symbol not supported."));var D=a.getFill(b),g=b.color,k=null;D&&"pattern"===
D.type&&g&&"picture-fill"!==b.type?k=a.getPatternUrlWithColor(D.src,g.toCss(!0)).then(function(a){D.src=a;x.fill=D;return x}):(x.fill=D,k=h.resolve(x));return k.then(function(a){return m.renderSymbol([[a]],[v,z],{node:d&&d.node,scale:!0,opacity:n,rotation:r})})}})},"esri/symbols/support/previewUtils":function(){define(["require","exports"],function(b,d){Object.defineProperty(d,"__esModule",{value:!0});d.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",
path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},
{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],
cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",
path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};d.getPathSymbolShapes=function(b){var d=22,e=22;1>b?d*=.75:1<b&&(e*=1.25);return[{type:"path",path:[{command:"M",values:[22,0]},{command:"L",values:[19.25,0]},{command:"L",values:[0,e-11]},{command:"L",values:[d-11,e-11]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[22,0]},{command:"L",values:[22,2.75]},{command:"L",values:[d-11,22]},{command:"L",
values:[d-11,e-11]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[d-11,e-11]},{command:"L",values:[0,e-11]},{command:"L",values:[0,22]},{command:"L",values:[d-11,22]},{command:"Z",values:[]}]}]};d.getExtrudeSymbolShapes=function(b){b*=.5;return[{type:"path",path:[{command:"M",values:[0,.7*11]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+b]},{command:"L",values:[0,22*.7+b-.7*11]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,22*.7]},{command:"L",
values:[6.6,22*.7+b]},{command:"L",values:[22,b]},{command:"L",values:[22,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,0]},{command:"L",values:[22,0]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[0,.7*11]},{command:"Z",values:[]}]}]};d.getWaterSymbolShapes=function(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},
{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},
{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]};
d.getCubeShapes=function(b,d){var e=d?20:b,a=d?4:6,a=e=22>=e?e-.5*a:e-a;d=d?.35*e:.5*e;return[{type:"path",path:[{command:"M",values:[.5*a,0]},{command:"L",values:[a,.5*d]},{command:"L",values:[.5*a,d]},{command:"L",values:[0,.5*d]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[.5*a,d]},{command:"L",values:[.5*a,b]},{command:"L",values:[0,b-.5*d]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*a,d]},{command:"L",values:[.5*a,
b]},{command:"L",values:[a,b-.5*d]},{command:"L",values:[a,.5*d]},{command:"Z",values:[]}]}]};d.getCylinderShapes=function(b,d){var e=d?20:b;d=d?4:6;e=22>=e?e-.5*d:e-d;d=.5*e;var a=.15*e;b-=a;return[{type:"ellipse",cx:.5*e,cy:b,rx:d,ry:a},{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[0,b]},{command:"L",values:[e,b]},{command:"L",values:[e,a]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*e,cy:a,rx:d,ry:a}]};d.getConeShapes=function(b,d){var e=d?20:b;d=d?4:6;e=22>=e?e-.5*d:e-
d;d=.15*e;var a=e;b-=d;return[{type:"ellipse",cx:.5*e,cy:b,rx:.5*e,ry:d},{type:"path",path:[{command:"M",values:[.5*a,0]},{command:"L",values:[a,b]},{command:"L",values:[0,b]},{command:"Z",values:[]}]}]};d.getInvertedConeShapes=function(b){var d=b,d=22>d?d-3:d-6,e=.15*d,a=d;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[a,0]},{command:"L",values:[.5*a,b-e]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*d,cy:0,rx:.5*d,ry:e}]};d.getDiamondShapes=function(b){var d=b,d=22>
d?d-2:d-4,e=Math.floor(b/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*d,0]},{command:"L",values:[d,.5*b-e]},{command:"L",values:[.45*d-e,.5*b+e]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*d,0]},{command:"L",values:[.45*d-e,.5*b+e]},{command:"L",values:[0,.5*b-e]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*b-e]},{command:"L",values:[.45*d-e,.5*b+e]},{command:"L",values:[.45*d,b]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",
values:[.45*d,b]},{command:"L",values:[d,.5*b-e]},{command:"L",values:[.45*d-e,.5*b+e]},{command:"Z",values:[]}]}]};d.getTetrahedronShapes=function(b){var d=b,d=22>d?d-1:d-2;return[{type:"path",path:[{command:"M",values:[.45*b,0]},{command:"L",values:[b,d]},{command:"L",values:[.45*b,.6*d]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*b,0]},{command:"L",values:[.45*b,.6*d]},{command:"L",values:[0,d]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,d]},
{command:"L",values:[.45*b,.6*d]},{command:"L",values:[b,d]},{command:"Z",values:[]}]}]}})},"esri/symbols/support/renderUtils":function(){define("require exports ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/has ../../core/promiseUtils ../../libs/maquette/index ./svgUtils".split(" "),function(b,d,f,h,e,a,q,m,c,l){function k(b,c,d){return b?h(b,{responseType:"image"}).then(function(a){a=a.data;var b=a.width,e=a.height,g=b/e,f=c;d&&(f=Math.min(f,Math.max(b,e)));return{image:a,
width:1>=g?Math.ceil(f*g):f,height:1>=g?f:Math.ceil(f/g)}}):m.reject(new a("renderUtils: imageDataSize","href not provided."))}Object.defineProperty(d,"__esModule",{value:!0});var n=c.createProjector();d.renderSymbol=function(a,b,c){var d=Math.ceil(b[0]);b=Math.ceil(b[1]);if(!a.some(function(a){return!!a.length}))return null;var e=c&&c.node||document.createElement("div");null!=c.opacity&&(e.style.opacity=c.opacity.toString());n.append(e,l.renderSVG.bind(null,a,d,b,c));return e};d.tintImageWithColor=
function(a,b,c,d,h){return k(a,b,h).then(function(g){var k=g.width?g.width:b,h=g.height?g.height:b,l;if(l=g.image)l=c&&"ignore"!==d?"multiply"===d&&255===c.r&&255===c.g&&255===c.b&&1===c.a?!1:!0:!1;if(l){var m=g.image.width,n=g.image.height;/\.svg$/i.test(a)&&(--m,--n);var q,r;q=Math.ceil(k);r=Math.ceil(h);l=document.createElement("canvas");l.width=q;l.height=r;l.style.width=q+"px";l.style.height=r+"px";l=l.getContext("2d");l.clearRect(0,0,q,r);l.drawImage(g.image,0,0,m,n,0,0,k,h);g=l.getImageData(0,
0,k,h);m=[c.r/255,c.g/255,c.b/255,c.a];n=e.toHSV(c);for(q=0;q<g.data.length;q+=4){r=g.data;var t=q,x=m,u=n;switch(d){case "multiply":r[t+0]*=x[0];r[t+1]*=x[1];r[t+2]*=x[2];r[t+3]*=x[3];break;default:var y=e.toHSV({r:r[t+0],g:r[t+1],b:r[t+2]});y.h=u.h;y.s=u.s;y.v=y.v/100*u.v;u=e.toRGB(y);r[t+0]=u.r;r[t+1]=u.g;r[t+2]=u.b;r[t+3]*=x[3]}}l.putImageData(g,0,0);a=l.canvas.toDataURL("image/png")}else(l=f.id&&f.id.findCredential(a))&&l.token&&(g=-1===a.indexOf("?")?"?":"\x26",a=""+a+g+"token\x3d"+l.token);
return{url:a,width:k,height:h}}).catch(function(){return{url:a,width:b,height:b}})}})},"esri/core/colorUtils":function(){define(["require","exports"],function(b,d){function f(a,b){var c=[],d,e;if(a[0].length!==b.length)throw"dimensions do not match";var f=a.length,k=a[0].length,h=0;for(d=0;d<f;d++){for(e=h=0;e<k;e++)h+=a[d][e]*b[e];c.push(h)}return c}function h(a){a=[a.r/255,a.g/255,a.b/255].map(function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)});a=f(c,a);return{x:100*a[0],y:100*a[1],
z:100*a[2]}}function e(a){a=f(l,[a.x/100,a.y/100,a.z/100]).map(function(a){return Math.min(1,Math.max(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055,0))});return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*a[2])}}function a(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(function(a){return a>Math.pow(6/29,3)?Math.pow(a,1/3):1/3*Math.pow(29/6,2)*a+4/29});return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-a[2])}}function q(a){var b=a.l;a=[(b+16)/116+a.a/500,(b+16)/116,(b+16)/116-a.b/
200].map(function(a){return a>6/29?Math.pow(a,3):3*Math.pow(6/29,2)*(a-4/29)});return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}}function m(a){if("r"in a&&"g"in a&&"b"in a)return a;if("l"in a&&"c"in a&&"h"in a){var b=a.c,c=a.h;return e(q({l:a.l,a:b*Math.cos(c),b:b*Math.sin(c)}))}if("l"in a&&"a"in a&&"b"in a)return e(q(a));if("x"in a&&"y"in a&&"z"in a)return e(a);if("h"in a&&"s"in a&&"v"in a){c=(a.h+360)%360/60;b=a.v/100*255;a=a.s/100*b;var d=a*(1-Math.abs(c%2-1));switch(Math.floor(c)){case 0:c={r:a,
g:d,b:0};break;case 1:c={r:d,g:a,b:0};break;case 2:c={r:0,g:a,b:d};break;case 3:c={r:0,g:d,b:a};break;case 4:c={r:d,g:0,b:a};break;case 5:case 6:c={r:a,g:0,b:d};break;default:c={r:0,g:0,b:0}}c.r=Math.round(c.r+b-a);c.g=Math.round(c.g+b-a);c.b=Math.round(c.b+b-a);return c}}Object.defineProperty(d,"__esModule",{value:!0});var c=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],l=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];d.toRGB=m;d.toHSV=function(a){if("h"in a&&
"s"in a&&"v"in a)return a;var b=m(a);a=b.r;var c=b.g,b=b.b,d=Math.max(a,c,b),e=d-Math.min(a,c,b),f;0===e?f=0:d===a?f=(c-b)/e%6:d===c?f=(b-a)/e+2:d===b&&(f=(a-c)/e+4);0>f&&(f+=6);return{h:60*f,s:100*(0===e?0:e/d),v:100/255*d}};d.toLAB=function(b){return"l"in b&&"a"in b&&"b"in b?b:a(h(m(b)))};d.toLCH=function(b){if(!("l"in b&&"c"in b&&"h"in b)){var c=a(h(m(b)));b=c.l;var d=c.a,e=c.b,c=Math.sqrt(d*d+e*e),d=Math.atan2(e,d),d=0<d?d:d+2*Math.PI;b={l:b,c:c,h:d}}return b};d.toXYZ=function(a){return"x"in a&&
"y"in a&&"z"in a?a:h(m(a))};d.darken=function(b,c){b=a(h(b));b.l*=1-c;return e(q(b))}})},"esri/symbols/support/svgUtils":function(){define("require exports ../../Color ../../core/has ../../core/libs/gl-matrix-2/mat2df32 ../../core/libs/gl-matrix-2/math/mat2d ../../widgets/support/widget".split(" "),function(b,d,f,h,e,a,q){function m(a){return a.map(function(a){return a.command+" "+a.values.join(" ")}).join(" ").trim()}function c(a,b,c,d){if(a){if("circle"===a.type)return q.tsx("circle",{fill:b,"fill-rule":"evenodd",
stroke:c.color,"stroke-width":c.width,"stroke-linecap":c.cap,"stroke-linejoin":c.join,"stroke-dasharray":c.dashArray,"stroke-miterlimit":"4",cx:a.cx,cy:a.cy,r:a.r});if("ellipse"===a.type)return q.tsx("ellipse",{fill:b,"fill-rule":"evenodd",stroke:c.color,"stroke-width":c.width,"stroke-linecap":c.cap,"stroke-linejoin":c.join,"stroke-dasharray":c.dashArray,"stroke-miterlimit":"4",cx:a.cx,cy:a.cy,rx:a.rx,ry:a.ry});if("rect"===a.type)return q.tsx("rect",{fill:b,"fill-rule":"evenodd",stroke:c.color,"stroke-width":c.width,
"stroke-linecap":c.cap,"stroke-linejoin":c.join,"stroke-dasharray":c.dashArray,"stroke-miterlimit":"4",x:a.x,y:a.y,width:a.width,height:a.height});if("image"===a.type)return q.tsx("image",{href:a.src,x:a.x,y:a.y,width:a.width,height:a.height,preserveAspectRatio:"none"});if("path"===a.type)return a="string"!==typeof a.path?m(a.path):a.path,q.tsx("path",{fill:b,"fill-rule":"evenodd",stroke:c.color,"stroke-width":c.width,"stroke-linecap":c.cap,"stroke-linejoin":c.join,"stroke-dasharray":c.dashArray,
"stroke-miterlimit":"4",d:a});if("text"===a.type)return q.tsx("text",{fill:b,"fill-rule":"evenodd",stroke:c.color,"stroke-width":c.width,"stroke-linecap":c.cap,"stroke-linejoin":c.join,"stroke-dasharray":c.dashArray,"stroke-miterlimit":"4","text-anchor":d.align,"text-decoration":d.decoration,kerning:d.kerning,rotate:d.rotate,"text-rendering":C,"font-style":d.font.style,"font-variant":d.font.variant,"font-weight":d.font.weight,"font-size":d.font.size,"font-family":d.font.family,x:a.x,y:a.y},a.text)}return null}
function l(a){var b={fill:"none",pattern:null,linearGradient:null};if(a)if("type"in a&&"pattern"===a.type){var c="patternId-"+ ++z;b.fill="url(#"+c+")";b.pattern={id:c,x:a.x,y:a.y,width:a.width,height:a.height,image:{x:0,y:0,width:a.width,height:a.height,href:a.src}}}else"type"in a&&"linear"===a.type?(c="linearGradientId-"+ ++B,b.fill="url(#"+c+")",b.linearGradient={id:c,x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,stops:a.colors.map(function(a){return{offset:a.offset,color:a.color&&(new f(a.color)).toString()}})}):
a&&(a=new f(a),b.fill=a.toString());return b}function k(a){var b={color:"none",width:1,cap:"butt",join:"4",dashArray:"none"};if(a&&(null!=a.width&&(b.width=a.width),a.cap&&(b.cap=a.cap),a.join&&(b.join=a.join.toString()),a.color&&(b.color=(new f(a.color)).toString()),a.style)){var c=null;a.style in H&&(c=H[a.style]);if(Array.isArray(c)){for(var c=c.slice(0),d=0;d<c.length;++d)c[d]*=a.width;if("butt"!==a.cap){for(d=0;d<c.length;d+=2)c[d]-=a.width,1>c[d]&&(c[d]=1);for(d=1;d<c.length;d+=2)c[d]+=a.width}c=
c.join(",")}b.dashArray=c}return b}function n(a,b){var c={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};a&&(c.align=a.align,c.decoration=a.decoration,c.kerning=a.kerning?"auto":"0",c.rotate=a.rotated?"90":"0",c.font.style=b.style||"normal",c.font.variant=b.variant||"normal",c.font.weight=b.weight||"normal",c.font.size=b.size&&b.size.toString()||"10pt",c.font.family=b.family||"serif");return c}function r(a){var b=a.pattern;a=a.linearGradient;
return b?q.tsx("pattern",{id:b.id,patternUnits:"userSpaceOnUse",x:b.x,y:b.y,width:b.width,height:b.height},q.tsx("image",{x:b.image.x,y:b.image.y,width:b.image.width,height:b.image.height,href:b.image.href})):a?(b=a.stops.map(function(a,b){return q.tsx("stop",{key:b+"-stop",offset:a.offset,"stop-color":a.color})}),q.tsx("linearGradient",{id:a.id,gradientUnits:"userSpaceOnUse",x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2},b)):null}function g(b,c,d){return a.translate(b,a.identity(b),[c,d])}function x(b,c,d,e,g){a.scale(b,
a.identity(b),[c,d]);b[4]=b[4]*c-e*c+e;b[5]=b[5]*d-g*d+g;return b}function t(b,c,d,e){var g=c%360*Math.PI/180;a.rotate(b,a.identity(b),g);c=Math.cos(g);var g=Math.sin(g),f=b[4],k=b[5];b[4]=f*c-k*g+e*g-d*c+d;b[5]=k*c+f*g-d*g-e*c+e;return b}function u(a,b){F&&"left"in F?(F.left>a&&(F.left=a),F.right<a&&(F.right=a),F.top>b&&(F.top=b),F.bottom<b&&(F.bottom=b)):F={left:a,bottom:b,right:a,top:b}}function y(a){var b=a.args,c=b.length;switch(a.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(a=
0;a<c;a+=2)u(b[a],b[a+1]);E.x=b[c-2];E.y=b[c-1];break;case "H":for(a=0;a<c;++a)u(b[a],E.y);E.x=b[c-1];break;case "V":for(a=0;a<c;++a)u(E.x,b[a]);E.y=b[c-1];break;case "m":a=0;"x"in E||(u(E.x=b[0],E.y=b[1]),a=2);for(;a<c;a+=2)u(E.x+=b[a],E.y+=b[a+1]);break;case "l":case "t":for(a=0;a<c;a+=2)u(E.x+=b[a],E.y+=b[a+1]);break;case "h":for(a=0;a<c;++a)u(E.x+=b[a],E.y);break;case "v":for(a=0;a<c;++a)u(E.x,E.y+=b[a]);break;case "c":for(a=0;a<c;a+=6)u(E.x+b[a],E.y+b[a+1]),u(E.x+b[a+2],E.y+b[a+3]),u(E.x+=b[a+
4],E.y+=b[a+5]);break;case "s":case "q":for(a=0;a<c;a+=4)u(E.x+b[a],E.y+b[a+1]),u(E.x+=b[a+2],E.y+=b[a+3]);break;case "A":for(a=0;a<c;a+=7)u(b[a+5],b[a+6]);E.x=b[c-2];E.y=b[c-1];break;case "a":for(a=0;a<c;a+=7)u(E.x+=b[a+5],E.y+=b[a+6])}}function A(a,b,c){var d=D[a.toLowerCase()];"number"===typeof d&&(d?b.length>=d&&(a={action:a,args:b.slice(0,b.length-b.length%d)},c.push(a),y(a)):(a={action:a,args:[]},c.push(a),y(a)))}function p(a){var b={x:0,y:0,width:0,height:0};if("circle"===a.type)b.x=a.cx-a.r,
b.y=a.cy-a.r,b.width=2*a.r,b.height=2*a.r;else if("ellipse"===a.type)b.x=a.cx-a.rx,b.y=a.cy-a.ry,b.width=2*a.rx,b.height=2*a.ry;else if("image"===a.type||"rect"===a.type)b.x=a.x,b.y=a.y,b.width=a.width,b.height=a.height;else if("path"===a.type){a=("string"!==typeof a.path?m(a.path):a.path).match(G);var c=[];F={};E={};if(a){for(var d="",e=[],g=a.length,f=0;f<g;++f){var k=a[f],h=parseFloat(k);isNaN(h)?(d&&A(d,e,c),e=[],d=k):e.push(h)}A(d,e,c);a={x:0,y:0,width:0,height:0};F&&"left"in F&&(a.x=F.left,
a.y=F.top,a.width=F.right-F.left,a.height=F.bottom-F.top)}else a=null;b.x=a.x;b.y=a.y;b.width=a.width;b.height=a.height}return b}function w(a){for(var b={x:0,y:0,width:0,height:0},c=null,d=Number.NEGATIVE_INFINITY,e=Number.NEGATIVE_INFINITY,g=0;g<a.length;g++){var f=a[g];c?(c.x=Math.min(c.x,f.x),c.y=Math.min(c.y,f.y),d=Math.max(d,f.x+f.width),e=Math.max(e,f.y+f.height)):(c=b,c.x=f.x,c.y=f.y,d=f.x+f.width,e=f.y+f.height)}c&&(c.width=d-c.x,c.height=e-c.y);return c}function v(b,c,d,f,k,h){var l=c/2,
m=d/2,n=b.width+f,q=b.height+f,p=e.mat2df32.create(),r=e.mat2df32.create(),v=!1;if(k&&0!==n&&0!==q){k=n/q;var v=c>d?c:d,u=1,w=1;isNaN(v)||(1<k?(u=v/n,w=v/k/q):(w=v/q,u=v*k/n));a.multiply(r,r,x(p,u,w,l,m));v=!0}k=b.x+(n-f)/2;b=b.y+(q-f)/2;a.multiply(r,r,g(p,l-k,m-b));!v&&(n>c||q>d)&&(l=n/c>q/d,c=(l?c:d)/(l?n:q),a.multiply(r,r,x(p,c,c,k,b)));h&&a.multiply(r,r,t(p,h,k,b));return"matrix("+r[0]+","+r[1]+","+r[2]+","+r[3]+","+r[4]+","+r[5]+")"}Object.defineProperty(d,"__esModule",{value:!0});var z=0,B=
0,C=h("chrome")?"auto":"optimizeLegibility",D={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},G=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g,F={},E={},H={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};d.renderShape=c;d.generateFillAttributes=l;d.generateStrokeAttributes=k;d.generateTextAttributes=n;d.renderDef=r;d.getBoundingBox=p;d.computeBBox=
w;d.getTransformMatrix=v;d.renderSVG=function(a,b,d,e){for(var g=[],f=[],h=0;h<a.length;h++){for(var m=[],t=[],x=0,u=0,y=a[h];u<y.length;u++){var z=y[u],M=z.shape,B=z.fill,J=z.stroke,z=z.font,x=x+(J&&J.width||0),B=l(B),J=k(J),z="text"===M.type?n(M,z):null;g.push(r(B));m.push(c(M,B.fill,J,z));t.push(p(M))}t=v(w(t),b,d,x,e&&e.scale,e&&e.rotation);f.push(q.tsx("g",{transform:t},m))}return q.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:b,height:d},q.tsx("defs",null,g),f)}})},"esri/symbols/support/previewSymbol3D":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/colorUtils ../../core/compilerUtils ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./IconSymbol3DLayerResource ./ObjectSymbol3DLayerResource ./previewUtils ./renderUtils ./styleUtils ./utils".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,x,t,u){function y(a){var b=a.outline,c=m.isSome(a.material)?a.material.color:null,c=m.isSome(c)?c.toRgba().toString():null;if(m.isNone(b))return"fill"===a.type&&"255,255,255,1"===c?{color:"#bdc3c7",width:.75}:null;a=l.pt2px(b.size)||0;return{color:"rgba("+(m.isSome(b.color)?b.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80)}}function A(a,b){var d=b&&b.resource,d=d&&d.href;return a.thumbnail&&a.thumbnail.url?c.resolve(a.thumbnail.url):d&&"object"!==b.type?
c.resolve(u.getIconHref(a,b)):a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?t.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal},"webRef").catch(function(a){return a}).then(function(a){return a&&a.thumbnail&&a.thumbnail.url||K}):c.resolve(K)}function p(a,b){void 0===b&&(b=1);var c=a.a;a=h.toHSV(a);b=h.toRGB({h:a.h,s:a.s/b,v:100-(100-a.v)/b});return[b.r,b.g,b.b,c]}function w(a,b){return Math.round(Math.min(Math.max(a+191.25*b,0),255))}function v(a){return"water"===
a.type?m.isNone(a.color)?null:a.color:m.isNone(a.material)||m.isNone(a.material.color)?null:a.material.color}function z(a,b){void 0===b&&(b=0);a=v(a);if(!a)return b=w(k.defaultThematicColor.r,b),[b,b,b,100];a=a.toRgba();for(var c=0;3>c;c++)a[c]=w(a[c],b);return a}function B(a){return a.outline?y(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function C(a,b){a=v(a);if(!a)return null;var c;c="rgba("+(w(a.r,b)+",");c+=w(a.g,b)+",";c+=w(a.b,b)+",";return c+a.a+");"}function D(a,b){b=C(a,b);if(!b)return{};a=
Math.min(a.size?l.pt2px(a.size):.75,80);return{color:b,width:a}}function G(a,b,c){c*=.75;return{type:"linear",x1:c?.25*c:0,y1:c?.5*c:0,x2:c||4,y2:c?.5*c:4,colors:[{color:a,offset:0},{color:b,offset:1}]}}function F(a){var b=a.depth,c=a.height;return(a=a.width)&&b&&c&&a===b&&a<c}function E(a,b,c){var d=[];if(!a)return d;switch(a.type){case "icon":var f=a.resource&&a.resource.primitive||n.defaultPrimitive;switch(f){case "circle":d.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:z(a,0),stroke:y(a)});
break;case "square":d.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[0,0]},{command:"L",values:[b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:z(a,0),stroke:y(a)});break;case "triangle":d.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:z(a,0),stroke:y(a)});break;case "cross":d.push({shape:{type:"path",path:[{command:"M",values:[.5*b,0]},{command:"L",values:[.5*
b,b]},{command:"M",values:[0,.5*b]},{command:"L",values:[b,.5*b]}]},stroke:B(a)});break;case "x":d.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[b,b]},{command:"M",values:[b,0]},{command:"L",values:[0,b]}]},stroke:B(a)});break;case "kite":d.push({shape:{type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*b]},{command:"L",values:[.5*b,b]},{command:"Z",values:[]}]},fill:z(a,0),stroke:y(a)});break;default:e.neverReached(f)}break;
case "object":switch(f=a.resource&&a.resource.primitive||r.defaultPrimitive,f){case "cone":f=z(a,0);a=z(a,-.6);a=G(f,a,c?20:b);b=g.getConeShapes(b,c);d.push({shape:b[0],fill:a});d.push({shape:b[1],fill:a});break;case "inverted-cone":c=z(a,0);a=z(a,-.6);a=G(c,a,b);b=g.getInvertedConeShapes(b);d.push({shape:b[0],fill:a});d.push({shape:b[1],fill:c});break;case "cube":b=g.getCubeShapes(b,c);d.push({shape:b[0],fill:z(a,0)});d.push({shape:b[1],fill:z(a,-.3)});d.push({shape:b[2],fill:z(a,-.5)});break;case "cylinder":var f=
z(a,0),k=z(a,-.6),f=G(f,k,c?20:b);b=g.getCylinderShapes(b,c);d.push({shape:b[0],fill:f});d.push({shape:b[1],fill:f});d.push({shape:b[2],fill:z(a,0)});break;case "diamond":b=g.getDiamondShapes(b);d.push({shape:b[0],fill:z(a,-.3)});d.push({shape:b[1],fill:z(a,0)});d.push({shape:b[2],fill:z(a,-.3)});d.push({shape:b[3],fill:z(a,-.7)});break;case "sphere":c=z(a,0);a=z(a,-.6);a=G(c,a);a.x1=0;a.y1=0;a.x2=.25*b;a.y2=.25*b;d.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:a});break;case "tetrahedron":b=
g.getTetrahedronShapes(b);d.push({shape:b[0],fill:z(a,-.3)});d.push({shape:b[1],fill:z(a,0)});d.push({shape:b[2],fill:z(a,-.6)});break;default:e.neverReached(f)}}return d}function H(a,b){var d=b&&b.size?l.pt2px(b.size):null,e=b&&b.maxSize?l.pt2px(b.maxSize):null,g=b&&b.disableUpsampling,f=a.symbolLayers,k=[],h=0,m=0,n=f.getItemAt(f.length-1),q;n&&"icon"===n.type&&(q=n.size&&l.pt2px(n.size));f.forEach(function(f){if("icon"===f.type||"object"===f.type){var n="icon"===f.type?f.size&&l.pt2px(f.size):
0,p=d||n?Math.ceil(Math.min(d||n,e||120)):22;if(f&&f.resource&&f.resource.href){var r=A(a,f).then(function(a){var b=f.get("material.color"),c;c="icon"===f.type?"multiply":"tint";return x.tintImageWithColor(a,p,b,c,g)}).then(function(a){var b=a.width,c=a.height;h=Math.max(h,b);m=Math.max(m,c);return[{shape:{type:"image",x:0,y:0,width:b,height:c,src:a.url},fill:null,stroke:null}]});k.push(r)}else r=p,"icon"===f.type&&q&&d&&(r=n/q*p),n=b&&"tall"===b.symbolConfig||("object"===f.type?F(f):!1),h=Math.max(h,
n?20:r),m=Math.max(m,r),k.push(c.resolve(E(f,r,n)))}});return c.eachAlways(k).then(function(a){var c=[];a.forEach(function(a){a.value?c.push(a.value):a.error&&I.warn("error while building swatchInfo!",a.error)});return x.renderSymbol(c,[h,m],{node:b&&b.node,scale:!1,opacity:b&&b.opacity})})}function J(a,b){var d=a.symbolLayers,e=[];a=u.isVolumetricSymbol(a);var k=b&&b.size?l.pt2px(b.size):null,h=(b&&b.maxSize?l.pt2px(b.maxSize):null)||80,m=0,n=0,q;d.forEach(function(a,b){if(a&&("line"===a.type||"path"===
a.type)){var c=[];switch(a.type){case "line":var d=D(a,0),l=d&&d.width||0;0===b&&(q=l);var p=Math.min(k||l,h);b=0===b?p:k?l/q*p:p;n=Math.max(n,b);m=Math.max(m,20<b?2*b:40);d.width=b;c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[m,.5*n]}]},stroke:d});break;case "path":b=Math.min(k||22,h);l=z(a,0);p=z(a,-.2);d=(d=C(a,-.4))?{color:d,width:1}:{};if("quad"===a.profile){var r=a.width||a.size;a=a.height||a.size;a=g.getPathSymbolShapes(r&&a?r/a:1);d=f({},d,{join:"bevel"});
c.push({shape:a[0],fill:p,stroke:d});c.push({shape:a[1],fill:p,stroke:d});c.push({shape:a[2],fill:l,stroke:d})}else c.push({shape:g.shapes.pathSymbol3DLayer[0],fill:p,stroke:d}),c.push({shape:g.shapes.pathSymbol3DLayer[1],fill:l,stroke:d});m=n=Math.max(n,b)}e.push(c)}});return c.resolve(x.renderSymbol(e,[m,n],{node:b&&b.node,scale:a,opacity:b&&b.opacity}))}Object.defineProperty(d,"__esModule",{value:!0});var K=b.toUrl("../../images/Legend/legend3dsymboldefault.png"),I=q.getLogger("esri.symbols.support.previewSymbol3D");
d.getSymbolLayerFill=z;d.previewSymbol3D=function(b,d){if(0===b.symbolLayers.length)return c.reject(new a("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var e=null;switch(b.type){case "point-3d":e=H(b,d);break;case "line-3d":e=J(b,d);break;case "polygon-3d":case "mesh-3d":e="mesh-3d"===b.type;b=b.symbolLayers;for(var k=d&&d.size?l.pt2px(d.size):null,h=d&&d.maxSize?l.pt2px(d.maxSize):null,k=k||22,m=[],n=0,q=0,r=!1,t=0;t<b.length;t++){var u=b.getItemAt(t),w=[];if(!e||"fill"===
u.type){var B=g.shapes.fill[0];switch(u.type){case "fill":var A=y(u),C=Math.min(k,h||120),n=Math.max(n,C),q=Math.max(q,C),r=!0;w.push({shape:B,fill:z(u,0),stroke:A});break;case "line":B={stroke:D(u,0),shape:B};n=Math.max(n,22);q=Math.max(q,22);w.push(B);break;case "extrude":var A=f({join:"round"},D(u,-.4)),B=z(u,0),u=z(u,-.2),C=Math.min(k,h||120),K=g.getExtrudeSymbolShapes(C);A.width=1;w.push({shape:K[0],fill:u,stroke:A});w.push({shape:K[1],fill:u,stroke:A});w.push({shape:K[2],fill:B,stroke:A});B=
22*.7+.5*C;n=Math.max(n,22);q=Math.max(q,B);break;case "water":r=v(u),B=p(r),u=p(r,2),A=p(r,3),C=g.getWaterSymbolShapes(),r=!0,w.push({shape:C[0],fill:B}),w.push({shape:C[1],fill:u}),w.push({shape:C[2],fill:A}),C=Math.min(k,h||120),n=Math.max(n,C),q=Math.max(q,C)}m.push(w)}}e=c.resolve(x.renderSymbol(m,[n,q],{node:d&&d.node,scale:r,opacity:d&&d.opacity}))}return e?e:c.reject(new a("symbolPreview: swatchInfo3D","symbol not supported."))}})},"esri/symbols/support/previewWebStyleSymbol":function(){define(["require",
"exports","../../request","../../core/screenUtils"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});d.previewWebStyleSymbol=function(b,a,d){var e=b.thumbnail&&b.thumbnail.url;return e?f(e,{responseType:"image"}).then(function(a){a=a.data;var b=!/\\.svg$/i.test(a.src)&&d&&d.disableUpsampling,c=Math.max(a.width,a.height),e=d&&null!=d.maxSize?h.pt2px(d.maxSize):120;b&&(e=Math.min(c,e));b=Math.min(e,d&&null!=d.size?h.pt2px(d.size):c);b!==c&&(c=0!==a.width&&0!==a.height?a.width/a.height:
1,1<=c?(a.width=b,a.height=b/c):(a.width=b*c,a.height=b));return d&&d.node?(d.node.appendChild(a),d.node):a}):b.fetchSymbol().then(function(b){return a(b,d)})}})},"esri/views/MapView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../core/Error ../core/has ../core/Logger ../core/promiseUtils ../core/screenUtils ../core/watchUtils ../core/workers ../core/accessorSupport/decorators ./BreakpointsOwner ./DOMContainer ./Magnifier ./MapViewBase ./2d/input/MapViewInputManager ./2d/support/HighlightOptions ./support/screenshotUtils ./support/WebGLRequirements ./ui/2d/DefaultUI2D @dojo/framework/shim/Promise".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,x,t,u,y,A,p,w,v,z){function B(){return a(this,void 0,void 0,function(){var a,c,d,g,f,k,h;return e(this,function(e){switch(e.label){case 0:return[4,Promise.all([new Promise(function(a,c){b(["./webgl"],a,c)}),new Promise(function(a,c){b(["./2d/mapViewDeps"],a,c)}),new Promise(function(a,c){b(["./2d/engine"],a,c)})])];case 1:return a=e.sent(),c=a[1],d=c.GraphicsView2D,g=c.LabelManager,f=c.MapViewNavigation,k=c.MagnifierView2D,h=a[2].Stage,F=d,E=g,H=f,J=k,G=h,[2]}})})}
function C(a){return!("layerViews"in a)&&null!=a.container}var D=c.getLogger("esri.views.MapView"),G,F,E,H,J;return function(a){function b(b){b=a.call(this,b)||this;b._magnifierView=null;b._stage=null;b._resolveWhenReady=[];b.graphicsView=null;b.highlightOptions=new p;b.magnifier=new u;b.inputManager=new A({view:b});b.mapViewNavigation=null;b.supersampleScreenhotsEnabled=!0;b.ui=new z;b.rendering=!1;r.initialize();return b}f(b,a);b.prototype.destroy=function(){this.inputManager.destroy();this._set("inputManager",
null)};Object.defineProperty(b.prototype,"background",{get:function(){return this.get("map.initialViewProperties.background")||null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"navigating",{get:function(){return!(!this.mapViewNavigation||!this.mapViewNavigation.interacting)},enumerable:!0,configurable:!0});b.prototype.toMap=function(a){if(k.isSupportedScreenPointEvent(a)){var b=k.createScreenPointFromSupportedEvent(this,a);return this.inherited(arguments,[b])}return this.inherited(arguments)};
b.prototype.hitTest=function(a){var b=k.isSupportedScreenPointEvent(a)?k.createScreenPointFromSupportedEvent(this,a):a;if(!this.ready||isNaN(b.x)||isNaN(b.y))return l.resolve({screenPoint:b,results:[]});var c=this.toMap(b);a=[this.graphicsView];a.push.apply(a,this.allLayerViews.toArray().reverse());return l.all(a.map(function(a){return a&&a.hitTest?a.hitTest(b.x,b.y):null})).then(function(a){return{screenPoint:b,results:a.filter(function(a){return null!=a}).map(function(a){return{mapPoint:c,graphic:a}})}})};
b.prototype.takeScreenshot=function(a){return this.ready?this._stage.takeScreenshot(w.toRenderSettings(a,this),this.allLayerViews):l.reject("Map view cannot be used before it is ready")};b.prototype.on=function(a,b,c,d){var e=this.inputManager&&this.viewEvents.on(a,b,c,d);return e?e:this.inherited(arguments)};b.prototype.hasEventListener=function(a){return this.inherited(arguments)||this.viewEvents.hasHandler(a)};b.prototype.whenLayerView=function(a){return this.inherited(arguments)};b.prototype.graphicChanged=
function(a){this.graphicsView&&this.graphicsView.graphicUpdateHandler(a)};b.prototype.whenReady=function(){var a=this;return l.create(function(b){a.ready?b(a):a._resolveWhenReady.push(b)})};b.prototype.forceDOMReadyCycle=function(){this.forceReadyCycle()};b.prototype.validate=function(){var a=v.check({supportsMajorWebPerformanceCaveat:!0});m("safari")&&9>m("safari")&&(a=new q("mapview:browser-not-supported","This browser is not supported by MapView (Safari \x3c 9)",{type:"safari",requiredVersion:9,
detectedVersion:m("safari")}));return a?(D.warn("#validate()",a.message),l.reject(a)):B()};b.prototype._startup=function(){var a=this;this.timeline.begin("MapView Startup");this.inherited(arguments);this.graphics.owner=this;var b=new G(this.surface,{canvas:this.renderCanvas,supersampleScreenshots:this.supersampleScreenhotsEnabled,contextOptions:{deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline}),
c=new F({view:this,graphics:this.graphics}),d=new H({view:this,animationManager:this.animationManager}),e=new E({view:this});this._magnifierView=new J;this._magnifierView.magnifier=this.magnifier;this._stage=b;this.frameTask.graphicsView=c;this._set("graphicsView",c);this._set("mapViewNavigation",d);this._set("labelManager",e);this.handles.add([this.allLayerViews.on("change",function(){return a._updateStageChildren()}),b.on("post-render",function(){return a._set("rendering",a.allLayerViews.some(function(a){return!("layerViews"in
a)&&!0===a.rendering}))}),b.on("webgl-error",function(b){return a.fatalError=b.error}),n.init(this,"stationary",function(a){return b.stationary=a},!0),n.init(this,"state.id",function(){return b.state=a.state},!0),n.init(this,"background",function(a){return b.background=a},!0),n.init(this,"magnifier",function(b){return a._magnifierView.magnifier=b},!0),n.init(this,"renderingOptions",function(a){return b.renderingOptions=a},!0),n.init(this,"highlightOptions",function(){return b.highlightOptions=a.highlightOptions},
!0)],"map-view");b.state=this.state;b.background=this.background;this._updateStageChildren();c=this._resolveWhenReady;this._resolveWhenReady=[];c.forEach(function(b){return b(a)});this.timeline.end("MapView Startup")};b.prototype._teardown=function(){this.handles.remove("map-view");this.layerViewManager.clear();this.labelManager.destroy();this._magnifierView.destroy();this._stage.destroy();this.graphicsView.destroy();this.mapViewNavigation.destroy();this._stage=null;this._set("graphicsView",null);
this._magnifierView=null;this._set("labelManager",null);this._set("mapViewNavigation",null);this.graphics.owner=null;this.inherited(arguments)};b.prototype._updateStageChildren=function(){var a=this;this._stage.removeAllChildren();this.allLayerViews.filter(C).forEach(function(b,c){a._stage.addChildAt(b.container,c)});this._stage.addChild(this.graphicsView.container);this._stage.addChild(this._magnifierView)};h([g.property({readOnly:!0,dependsOn:["map.initialViewProperties?.background"]})],b.prototype,
"background",null);h([g.property()],b.prototype,"graphicsView",void 0);h([g.property({type:p})],b.prototype,"highlightOptions",void 0);h([g.property({type:u})],b.prototype,"magnifier",void 0);h([g.property({readOnly:!0})],b.prototype,"inputManager",void 0);h([g.property({readOnly:!0})],b.prototype,"mapViewNavigation",void 0);h([g.property({dependsOn:["mapViewNavigation.interacting"],type:Boolean})],b.prototype,"navigating",null);h([g.property({type:Boolean,constructOnly:!0})],b.prototype,"supersampleScreenhotsEnabled",
void 0);h([g.property({type:z})],b.prototype,"ui",void 0);h([g.property({readOnly:!0})],b.prototype,"rendering",void 0);h([g.property({constructOnly:!0})],b.prototype,"renderCanvas",void 0);h([g.property({constructOnly:!0})],b.prototype,"deactivatedWebGLExtensions",void 0);h([g.property({constructOnly:!0})],b.prototype,"debugWebGLExtensions",void 0);return b=h([g.subclass("esri.views.MapView")],b)}(g.declared(x.BreakpointsOwner(t.DOMContainer(y))))})},"esri/views/Magnifier":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/accessorSupport/decorators".split(" "),
function(b,d,f,h,e,a){return function(b){function d(a){a=b.call(this,a)||this;a.factor=1.5;a.offsetX=0;a.offsetY=0;a.position=null;a.visible=!1;return a}f(d,b);Object.defineProperty(d.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});h([a.property({type:Number})],d.prototype,"factor",void 0);h([a.property({type:Number})],d.prototype,"offsetX",void 0);h([a.property({type:Number})],d.prototype,"offsetY",void 0);h([a.property()],d.prototype,"position",
void 0);h([a.property({readOnly:!0,dependsOn:["factor","offsetX","offsetY","position","visible"]})],d.prototype,"version",null);h([a.property({type:Boolean})],d.prototype,"visible",void 0);return d=h([a.subclass("esri.views.Magnifier")],d)}(a.declared(e))})},"esri/views/MapViewBase":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../geometry ../Viewpoint ../core/Error ../core/Logger ../core/now ../core/promiseUtils ../core/screenUtils ../core/watchUtils ../core/accessorSupport/decorators ../geometry/support/webMercatorUtils ../layers/support/TileInfo ./PopupView ./View ./ViewAnimation ./2d/AnimationManager ./2d/FrameTask ./2d/layerViewModuleImportUtils ./2d/MapViewConstraints ./2d/PaddedViewState ./2d/tiling ./2d/viewpointUtils ./2d/support/Timeline".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,x,t,u,y,A,p,w,v,z,B,C,D,G){var F=c.getLogger("esri.views.MapView");return function(b){function c(a){var c=b.call(this,a)||this;c._stationaryTimer=null;c.frameTask=new w.default(c);c.featuresTilingScheme=null;c.fullOpacity=1;c.initialExtent=null;c.labelManager=null;c.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0};c.resizeAlign="center";c.timeline=new G.Timeline;c.type="2d";c.constraints=new z;c.padding=
{top:0,right:0,bottom:0,left:0};var d=c.handles,e=function(){return c.notifyChange("updating")};d.add([c.watch("viewpoint",function(){c._lastStationaryEventTimestamp=l();c._flipStationary(160)},!0),c.on("resize",function(a){return c._resizeHandler(a)}),c.watch("animationManager.animation",function(a){c.animation=a}),c.allLayerViews.on("change",function(){e();d.remove("map-view-base-layerViewsUpdating");d.add(c.allLayerViews.map(function(a){return a.watch("updating",e)}),"map-view-base-layerViewsUpdating")})],
"map-view-base");return c}h(c,b);c.prototype.destroy=function(){this.destroyed||(this._set("preconditionsReady",!1),this._gotoTask=this.frameTask=null)};Object.defineProperty(c.prototype,"animation",{set:function(a){var b=this,c=this._get("animation");a!==c&&(c&&c.stop(),!a||a.isFulfilled()?this._set("animation",null):(this._set("animation",a),this.frameTask.animationInProgress=!0,c=function(){a===b._get("animation")&&(b._set("animation",null),b.frameTask.requestFrame());b.frameTask.animationInProgress=
!1},a.when(c,c)))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"center",{get:function(){if(!this.ready)return this._get("center");var b=this.state.paddedViewState,c=b.center;return new a.Point({x:c[0],y:c[1],spatialReference:b.spatialReference})},set:function(a){if(null!=a)if(this._normalizeInput(a))if(this.ready){var b=this.viewpoint;D.centerAt(b,b,a);this.viewpoint=b}else this._set("center",a),this.notifyChange("initialExtentRequired");else F.error("#center","incompatible spatialReference "+
JSON.stringify(a.spatialReference)+" with view's spatialReference "+JSON.stringify(this.spatialReference))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"constraints",{set:function(a){var b=this,c=this._get("constraints");c&&(this.handles.remove("map-view-base-constraints"),c.destroy());this._set("constraints",a);a&&(a.view=this,this.ready&&(this.state.viewpoint=a.fit(this.state.paddedViewState.viewpoint)),this.handles.add(a.on("update",function(){b.ready&&b.state&&(b.state.viewpoint=
a.fit(b.state.paddedViewState.viewpoint))}),"map-view-base-constraints"))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"extent",{get:function(){return this.ready?this.state.paddedViewState.extent.clone():this._get("extent")},set:function(a){if(null!=a){var b=this._normalizeInput(a);b?b.width&&b.height?this.ready?(a=this.viewpoint,D.setExtent(a,a,b,this.size,{constraints:this.constraints}),this.viewpoint=a):(this._set("extent",b),this._set("center",null),this._set("viewpoint",
null),this._set("scale",0),this._set("zoom",-1),this.notifyChange("initialExtentRequired")):F.error("#extent","invalid extent size"):F.error("#center","incompatible spatialReference "+JSON.stringify(a.spatialReference)+" with view's spatialReference "+JSON.stringify(this.spatialReference))}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"initialExtentRequired",{get:function(){var a=this.extent,b=this.center,c=this.scale,d=this.viewpoint,e=this.zoom;return this.get("map.initialViewProperties.viewpoint")||
a||b&&(0!==c||-1!==e)||d?!1:!0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"padding",{get:function(){return this.ready?this.state.padding:this._get("padding")},set:function(a){this.ready?(this.state.padding=a,this._set("padding",this.state.padding)):this._set("padding",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"resolution",{get:function(){return this.state?this.state.resolution:0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"rotation",{get:function(){return this.ready?this.state.rotation:this._get("rotation")},set:function(a){if(!isNaN(a))if(this.ready){var b=this.viewpoint;D.rotateTo(b,b,a);this.viewpoint=b}else this._set("rotation",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"scale",{get:function(){return this.ready?this.state.scale:this._get("scale")},set:function(a){if(a&&!isNaN(a))if(this.ready){var b=this.viewpoint;D.scaleTo(b,b,a);this.viewpoint=b}else{this._set("scale",a);this._set("zoom",
-1);if(a=this._get("extent"))this._set("extent",null),this._set("center",a.center);this.notifyChange("initialExtentRequired")}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"stationary",{get:function(){return!this.animation&&!this.navigating&&!this._get("resizing")&&!this._stationaryTimer},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"updating",{get:function(){return!this.destroyed&&(!0===this.get("layerViewManager.updating")||!0===this.get("labelManager.updating")||
!0===this.get("graphicsView.updating")||this.allLayerViews.some(function(a){return!a.destroyed&&!("layerViews"in a)&&a.attached&&!0===a.updating}))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"viewpoint",{get:function(){if(!this.ready)return this._get("viewpoint");var a=this.state.paddedViewState;return a&&a.viewpoint.clone()},set:function(b){if(null!=b){var c=this._normalizeInput(b);c?this.ready?(b=new q({targetGeometry:new a.Point,scale:0,rotation:0}),D.copy(b,c),this.constraints.constrain(b,
this.state.paddedViewState.viewpoint),this.state.viewpoint=b,this.frameTask.requestFrame(),this._set("viewpoint",b)):(this._set("viewpoint",c),this._set("extent",null),this._set("center",null),this._set("zoom",-1),this._set("scale",0),this.notifyChange("initialExtentRequired")):!b.scale||isNaN(b.scale)?F.error("#viewpoint","invalid scale value of "+b.scale):b.targetGeometry?F.error("#viewpoint","incompatible spatialReference "+JSON.stringify(b.targetGeometry.spatialReference)+" with view's spatialReference "+
JSON.stringify(this.spatialReference)):F.error("#viewpoint","geometry not defined")}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"zoom",{get:function(){return this.ready?this.constraints.scaleToZoom(this.scale):this._get("zoom")},set:function(a){if(null!=a){if(!this.ready){this.notifyChange("initialExtentRequired");this._set("zoom",a);this._set("scale",0);var b=this._get("extent");b&&(this._set("extent",null),this._set("center",b.center))}this.constraints.effectiveLODs&&(b=
this.viewpoint,D.scaleTo(b,b,this.constraints.zoomToScale(a)),this.viewpoint=b,this._set("zoom",this.constraints.scaleToZoom(this.scale)))}},enumerable:!0,configurable:!0});c.prototype.goTo=function(a,b){var c=this;if(a)return r.whenTrueOnce(this,"ready",b&&b.signal).then(function(){c.animation&&(c.animation=null);var d=f({animate:!0},b),e=D.createAsync(a,c);c._gotoTask={};return d.animate?c._gotoAnimated(e,d):c._gotoImmediate(e,d)});F.error("#goTo()","target cannot be null or undefined")};c.prototype.hitTest=
function(a){return k.reject("Should be implemented by subclasses")};c.prototype.popupHitTest=function(a){var b=this;return this.hitTest(a).then(function(c){return f({},c,{mapPoint:b.toMap(a)})})};c.prototype.toMap=function(b){if(!this.ready)return null;b=this.state.toMap([0,0],[b.x,b.y]);return new a.Point({x:b[0],y:b[1],spatialReference:this.spatialReference})};c.prototype.isTileInfoRequired=function(){return!0};c.prototype.toScreen=function(a){if(!this.ready)return null;a=this._normalizeInput(a);
a=[a.x,a.y];a=this.state.toScreen(a,a);return n.createScreenPoint(a[0],a[1])};c.prototype.pixelSizeAt=function(){return this.ready?this.state.resolution:(F.error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)};c.prototype.requestLayerViewUpdate=function(a){this.ready&&this.frameTask.requestLayerViewUpdate(a)};c.prototype.requestUpdate=function(a){this.ready&&this.frameTask.requestUpdate(a)};c.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||
this.get("defaultsFromMap.spatialReference")||null};c.prototype.isSpatialReferenceSupported=function(a,b){return b||this._get("ready")?!0:null!==this._getDefaultViewpoint()};c.prototype.importLayerView=function(a){return v.layerView2DImporter.importLayerView(a)};c.prototype.hasLayerViewModule=function(a){return v.layerView2DImporter.hasLayerViewModule(a)};c.prototype._createOrReplaceAnimation=function(a){if(!this.animation||this.animation.done)this.animation=new A;this.animation.update(a);return this.animation};
c.prototype._cancellableGoTo=function(a,b,c){var d=this,e=c.then(function(){a===d._gotoTask&&(d.animation=null)}).catch(function(c){a===d._gotoTask&&(d.animation=null,b.done||(b.stop(),d.frameTask.animationInProgress=!1));throw c;}),g=k.create(function(a){return a(e)},function(){a!==d._gotoTask||b.done||(b.stop(),d.frameTask.animationInProgress=!1)});b.when().catch(function(){a===d._gotoTask&&g.cancel&&g.cancel()});return g};c.prototype._gotoImmediate=function(a,b){var c=this,d=this._gotoTask,e=this._createOrReplaceAnimation(a);
a=a.then(function(a){k.throwIfAborted(b);if(d!==c._gotoTask)throw new m("view:goto-interrupted","Goto was interrupted");c.viewpoint=e.target=a;e.finish()});return this._cancellableGoTo(d,e,a)};c.prototype._gotoAnimated=function(a,b){var c=this,d=this._gotoTask,e=this._createOrReplaceAnimation(a);a=a.then(function(a){if(d!==c._gotoTask)throw new m("view:goto-interrupted","Goto was interrupted");e.update(a);c.animationManager.animate(e,c.viewpoint,b);return e.when().then(function(){},function(){})});
return this._cancellableGoTo(d,e,a)};c.prototype._resizeHandler=function(a){var b=this.state;if(b){var c=this.state.paddedViewState.viewpoint,d=this.state.paddedViewState.size.concat();b.size=[a.width,a.height];D.resize(c,c,d,this.state.paddedViewState.size,this.resizeAlign);c=this.constraints.constrain(c,null);this.state.viewpoint=c}};c.prototype._startup=function(){var a=this._getDefaultViewpoint();this.constraints.view=this;this.constraints.fit(a);this._set("animationManager",new p.default({view:this}));
this._set("state",new B({padding:this._get("padding"),size:this.size,viewpoint:a}));this._set("featuresTilingScheme",new C.TileInfoView(t.create({spatialReference:this.spatialReference,size:512})));this._set("ready",!0);this.frameTask&&this.frameTask.start()};c.prototype._teardown=function(){this.frameTask&&this.frameTask.stop();this._set("ready",!1);this._stationaryTimer&&(clearTimeout(this._stationaryTimer),this._stationaryTimer=null);var b=this.state.paddedViewState,c=b.center,d=b.spatialReference,
e=b.rotation,b=b.scale,c=new a.Point({x:c[0],y:c[1],spatialReference:d});this._set("viewpoint",null);this._set("extent",null);this._set("center",c);this._set("zoom",-1);this._set("rotation",e);this._set("scale",b);this._set("spatialReference",d);this.constraints.view=null;this.animationManager.destroy();this._set("animationManager",null);this._set("state",null);this.animation=null};c.prototype._flipStationary=function(a){var b=this;return null!==this._stationaryTimer?this._stationaryTimer:this._stationaryTimer=
setTimeout(function(){b._stationaryTimer=null;var a=l()-b._lastStationaryEventTimestamp;160>a&&(b._stationaryTimer=b._flipStationary(a))},a)};c.prototype._normalizeInput=function(a,b){void 0===b&&(b=this.spatialReference);var c=a&&a.targetGeometry||a;return b?c?b.equals(c.spatialReference)?a:x.canProject(c,b)?a&&"esri.Viewpoint"===a.declaredClass?(a.targetGeometry=x.project(c,b),a):x.project(c,b):null:null:a};c.prototype._getDefaultViewpoint=function(){var a=this.constraints,b=this._get("zoom"),c=
this._get("scale"),d=this._normalizeInput(this._get("center")),e=this._normalizeInput(this._get("extent")),g=this._get("rotation"),f=this._normalizeInput(this._get("viewpoint"));a.effectiveLODs?-1!==b&&(c=a.zoomToScale(b)):b=-1;var k=null,h=null,b=0,a=f&&f.rotation,l=f&&f.targetGeometry;l&&("extent"===l.type?k=l:"point"===l.type&&(h=l,b=f.scale));f=this._normalizeInput(this.get("map.initialViewProperties.viewpoint.targetGeometry.extent"));l=this._normalizeInput(this.initialExtent);e=e||k||f||l;d=
d||h||e&&e.center;c=c||b||e&&D.extentToScale(e,this.size);return d&&c?new q({targetGeometry:d,scale:c,rotation:g||a||0}):null};e([g.property()],c.prototype,"_stationaryTimer",void 0);e([g.property()],c.prototype,"animation",null);e([g.property({readOnly:!0})],c.prototype,"animationManager",void 0);e([g.property({value:null,type:a.Point,dependsOn:["state.id","ready"]})],c.prototype,"center",null);e([g.property({type:z})],c.prototype,"constraints",null);e([g.property({value:null,type:a.Extent,dependsOn:["state.id",
"ready"]})],c.prototype,"extent",null);e([g.property({readOnly:!0})],c.prototype,"featuresTilingScheme",void 0);e([g.property()],c.prototype,"fullOpacity",void 0);e([g.property({type:a.Extent})],c.prototype,"initialExtent",void 0);e([g.property({dependsOn:["map.initialViewProperties?.viewpoint"]})],c.prototype,"initialExtentRequired",null);e([g.property()],c.prototype,"labelManager",void 0);e([g.property({value:{top:0,right:0,bottom:0,left:0},cast:function(a){return f({top:0,right:0,bottom:0,left:0},
a)}})],c.prototype,"padding",null);e([g.property({type:Object})],c.prototype,"renderingOptions",void 0);e([g.property()],c.prototype,"resizeAlign",void 0);e([g.property({readOnly:!0,dependsOn:["state.id"]})],c.prototype,"resolution",null);e([g.property({value:0,type:Number,dependsOn:["state.id","ready"]})],c.prototype,"rotation",null);e([g.property({value:0,type:Number,dependsOn:["state.id","ready"]})],c.prototype,"scale",null);e([g.property({type:a.SpatialReference,dependsOn:["map.initialViewProperties?.spatialReference",
"defaultsFromMap.isSpatialReferenceDone"]})],c.prototype,"spatialReference",void 0);e([g.property({readOnly:!0})],c.prototype,"state",void 0);e([g.property({dependsOn:["animation","navigating","resizing","_stationaryTimer"]})],c.prototype,"stationary",null);e([g.property({type:G.Timeline,readOnly:!0})],c.prototype,"timeline",void 0);e([g.property({readOnly:!0})],c.prototype,"type",void 0);e([g.property({readOnly:!0,dependsOn:["layerViewManager.updating","labelManager.updating","graphicsView?.updating"]})],
c.prototype,"updating",null);e([g.property({value:null,type:q,dependsOn:["state.id","ready"]})],c.prototype,"viewpoint",null);e([g.property({value:-1,dependsOn:["state.id"]})],c.prototype,"zoom",null);return c=e([g.subclass("esri.views.MapViewBase")],c)}(g.declared(u.PopupView(y)))})},"esri/views/2d/AnimationManager":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../geometry ../../Viewpoint ../../core/Accessor ../../core/scheduling ../../core/accessorSupport/decorators ../ViewAnimation ./unitBezier ./viewpointUtils".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n){Object.defineProperty(d,"__esModule",{value:!0});var r=function(){function a(a,b,c,d){var e=a.targetGeometry,g=b.targetGeometry;d?"string"===typeof d&&(d=k.parse(d)||k.easingFunctions.ease):d=k.easingFunctions.ease;this.easing=d;this.duration=c;this.sCenterX=e.x;this.sCenterY=e.y;this.sScale=a.scale;this.sRotation=a.rotation;this.tCenterX=g.x;this.tCenterY=g.y;this.tScale=b.scale;this.tRotation=b.rotation;this.dCenterX=this.tCenterX-this.sCenterX;this.dCenterY=this.tCenterY-
this.sCenterY;this.dScale=this.tScale-this.sScale;this.dRotation=this.tRotation-this.sRotation;180<this.dRotation?this.dRotation-=360:-180>this.dRotation&&(this.dRotation+=360)}a.prototype.applyRatio=function(a,b){var c=this.easing(b),d,e;1<=b?(b=this.tCenterX,d=this.tCenterY,e=this.tRotation,c=this.tScale):(b=this.sCenterX+c*this.dCenterX,d=this.sCenterY+c*this.dCenterY,e=this.sRotation+c*this.dRotation,c=this.sScale+c*this.dScale);a.targetGeometry.x=b;a.targetGeometry.y=d;a.scale=c;a.rotation=e};
return a}();b=function(b){function d(c){c=b.call(this,c)||this;c.duration=200;c.transition=null;c.easing=k.easingFunctions.ease;c.view=null;c.viewpoint=null;c.viewpoint=new a({targetGeometry:new e.Point,scale:0,rotation:0});c._updateTask=m.addFrameTask({postRender:c._postRender.bind(c)});c._updateTask.pause();return c}h(d,b);d.prototype.destroy=function(){this._updateTask.remove();this._updateTask=null};d.prototype.animate=function(a,b,c){var d=this;this.stop();n.copy(this.viewpoint,b);this.transition=
new r(this.viewpoint,a.target,c&&c.duration||this.duration,c&&c.easing||this.easing);b=function(){d.animation===a&&d._updateTask&&("finished"===a.state&&(d.transition.applyRatio(d.viewpoint,1),d.view.state&&(d.view.state.viewpoint=d.viewpoint.clone())),d.animation=null,d.updateFunction=null)};a.when(b,b);this._startTime=m.now();this._updateTask.resume();return this.animation=a};d.prototype.animateContinous=function(a,b){var c=this;this.stop();this.updateFunction=b;this.viewpoint=a;var d=new l({target:a.clone()});
a=function(){c.animation===d&&c._updateTask&&(c.animation=null,c.updateFunction=null)};d.when(a,a);this._startTime=m.now();this._updateTask.resume();return this.animation=d};d.prototype.stop=function(){this.animation&&(this.animation.stop(),this.updateFunction=this.animation=null)};d.prototype._postRender=function(a){var b=this.animation;b&&b.state!==l.State.STOPPED?(this.updateFunction?this.updateFunction(this.viewpoint,a.deltaTime):(a=(m.now()-this._startTime)/this.transition.duration,b=1<=a,this.transition.applyRatio(this.viewpoint,
a),b&&this.animation.finish()),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())):this._updateTask.pause()};f([c.property()],d.prototype,"animation",void 0);f([c.property()],d.prototype,"duration",void 0);f([c.property()],d.prototype,"transition",void 0);f([c.property()],d.prototype,"easing",void 0);f([c.property()],d.prototype,"view",void 0);f([c.property()],d.prototype,"viewpoint",void 0);return d=f([c.subclass("esri.views.2d.AnimationManager")],d)}(c.declared(q));d.default=b})},
"esri/views/2d/unitBezier":function(){define(["require","exports"],function(b,d){function f(b,a,d,f){function c(a,b){var c,d,g,f;g=a;for(d=0;8>d;d++){f=((h*g+k)*g+e)*g-a;if(Math.abs(f)<b)return g;c=(3*h*g+2*k)*g+e;if(1E-6>Math.abs(c))break;g-=f/c}c=0;d=1;g=a;if(g<c)return c;if(g>d)return d;for(;c<d;){f=((h*g+k)*g+e)*g;if(Math.abs(f-a)<b)break;a>f?c=g:d=g;g=.5*(d-c)+c}return g}var e=3*b,k=3*(d-b)-e,h=1-e-k,m=3*a,g=3*(f-a)-m,q=1-m-g;return function(a,b){void 0===b&&(b=1E-6);a=c(a,b);return((q*a+g)*
a+m)*a}}Object.defineProperty(d,"__esModule",{value:!0});d.unitBezier=f;var h=/^cubic-bezier\((.*)\)/;d.easingFunctions={};d.parse=function(b){var a=d.easingFunctions[b]||null;!a&&(b=h.exec(b))&&(b=b[1].split(",").map(function(a){return parseFloat(a.trim())}),4!==b.length||b.some(function(a){return isNaN(a)})||(a=f.apply(f,b)));return a};d.easingFunctions.ease=f(.25,.1,.25,1);d.easingFunctions.linear=f(0,0,1,1);d.easingFunctions.easeIn=d.easingFunctions["ease-in"]=f(.42,0,1,1);d.easingFunctions.easeOut=
d.easingFunctions["ease-out"]=f(0,0,.58,1);d.easingFunctions.easeInOut=d.easingFunctions["ease-in-out"]=f(.42,0,.58,1)})},"esri/views/2d/FrameTask":function(){define(["require","exports","../../core/scheduling"],function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});b=function(){function b(b){var a=this;this.view=b;this._frameTaskHandle=null;this.updateEnabled=this.stationary=!0;this.animationInProgress=!1;this.prepare=function(){a._updateParameters.state=a.view.state;a._updateParameters.stationary=
a.view.stationary;a._updateParameters.pixelRatio=window.devicePixelRatio;a._updateParameters.renderingOptions=a.view.renderingOptions};this.update=function(){if(a.updateEnabled){var b=a.view,d=b.labelManager,c=a.graphicsView,e=b.allLayerViews.toArray().filter(function(a){return!("layerViews"in a)&&a.isFulfilled()}),f=e.length,h=b.state,r=0;for(;r<e.length;r++)if(b=e[r],b.attached){var g=b.lastUpdateId;if(null==g||!a.stationary&&!b.moving)b.moving=!0,b.moveStart();g!==h.id&&b.viewChange();a.stationary&&
b.moving&&(b.moving=!1,b.moveEnd());b.lastUpdateId=h.id}d&&d.lastUpdateId!==h.id&&(d.viewChange(),d.lastUpdateId=h.id);c&&c.lastUpdateId!==h.id&&(c.viewChange(),c.lastUpdateId=h.id);d=a._layerViewsTrash;for(c=0;c<d.length;c++)b=d[c],a._detachLayerView(b);for(c=d.length=0;c<f;c++)b=e[c],b.isFulfilled()&&!b.attached&&a._attachLayerView(b);e=a._updateParameters;f=a._layerViewsToUpdate;b=f.slice();c=f.length=0;for(h=b;c<h.length;c++)b=h[c],"layerViews"in b?f.push(b):b.processUpdate(e);f=a._updatablesToUpdate;
b=f.slice();for(f=f.length=0;f<b.length;f++)b[f].processUpdate(e);a.animationInProgress||0!==a._layerViewsToUpdate.length||0!==a._updatablesToUpdate.length||0!==d.length||a._frameTaskHandle.pause()}}}b.prototype.destroy=function(){this.stop()};b.prototype.start=function(){var b=this;this.stationary=this.view.stationary;this._updateParameters={state:this.view.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:this.view.renderingOptions};this._layerViewsTrash=[];this._layerViewsToUpdate=
[];this._updatablesToUpdate=[];this._allLayerViewsChangeHandle=this.view.allLayerViews.on("change",function(a){Array.prototype.push.apply(b._layerViewsTrash,a.removed);b.requestFrame()});this._stationaryHandle=this.view.watch("stationary",function(a){b.stationary=a;b.requestFrame()});this._frameTaskHandle=f.addFrameTask(this)};b.prototype.stop=function(){var b=this;this._frameTaskHandle&&(this.view.allLayerViews.forEach(function(a){"layerViews"in a||b._detachLayerView(a)}),this._stationaryHandle.remove(),
this._allLayerViewsChangeHandle.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._allLayerViewsChangeHandle=this._frameTaskHandle=this._layerViewsTrash=this._layerViewsToUpdate=null,this.stationary=!0,this.animationInProgress=!1)};b.prototype.requestLayerViewUpdate=function(b){this._layerViewsToUpdate.push(b);this.requestFrame()};b.prototype.requestUpdate=function(b){this._updatablesToUpdate.push(b);this.requestFrame()};b.prototype.requestFrame=function(){this._frameTaskHandle&&
this._frameTaskHandle.resume()};b.prototype._attachLayerView=function(b){b.attached||(b.attached=!0,b.attach(),this._updateParameters.stationary?b.moving=!1:(b.moving=!0,b.moveStart()))};b.prototype._detachLayerView=function(b){b.attached&&(b.detach(),b.attached=!1,b.moving=!1)};return b}();d.default=b})},"esri/views/2d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error","../../core/maybe","@dojo/framework/shim/Promise"],function(b,d,f,h){function e(){return Promise.all([new Promise(function(a,
d){b(["../webgl"],a,d)}),new Promise(function(a,d){b(["./engine"],a,d)})])}Object.defineProperty(d,"__esModule",{value:!0});var a=function(){return e().then(function(){return new Promise(function(a,d){b(["./layers/TileLayerView2D"],a,d)})})},q=function(){return e().then(function(){return new Promise(function(a,d){b(["./layers/FeatureLayerView2D"],a,d)})})},m={"base-dynamic":function(){return e().then(function(){return new Promise(function(a,d){b(["./layers/BaseDynamicLayerView2D"],a,d)})})},"base-tile":a,
"bing-maps":a,csv:q,"geo-rss":function(){return e().then(function(){return new Promise(function(a,d){b(["./layers/GeoRSSLayerView2D"],a,d)})})},feature:q,geojson:q,graphics:function(){return e().then(function(){return new Promise(function(a,d){b(["./layers/GraphicsLayerView2D"],a,d)})})},group:function(){return e().then(function(){return new Promise(function(a,d){b(["../layers/GroupLayerView"],a,d)})})},imagery:function(){return e().then(function(){return new Promise(function(a,d){b(["./layers/ImageryLayerView2D"],
a,d)})})},"imagery-tile":function(){return e().then(function(){return new Promise(function(a,d){b(["./layers/TileImageryLayerView2D"],a,d)})})},kml:function(){return e().then(function(){return new Promise(function(a,d){b(["./layers/KMLLayerView2D"],a,d)})})},"map-image":function(){return e().then(function(){return new Promise(function(a,d){b(["./layers/MapImageLayerView2D"],a,d)})})},"map-notes":function(){return e().then(function(){return new Promise(function(a,d){b(["./layers/MapNotesLayerView2D"],
a,d)})})},"open-street-map":a,route:function(){return e().then(function(){return new Promise(function(a,d){b(["./layers/RouteLayerView2D"],a,d)})})},stream:function(){return e().then(function(){return new Promise(function(a,d){b(["./layers/StreamLayerView2D"],a,d)})})},tile:a,"vector-tile":function(){return e().then(function(){return new Promise(function(a,d){b(["./layers/VectorTileLayerView2D"],a,d)})})},"web-tile":a,wms:function(){return e().then(function(){return new Promise(function(a,d){b(["./layers/WMSLayerView2D"],
a,d)})})},wmts:function(){return e().then(function(){return new Promise(function(a,d){b(["./layers/WMTSLayerView2D"],a,d)})})},"base-elevation":null,"building-scene":null,elevation:null,"integrated-mesh":null,"point-cloud":null,scene:null,unknown:null,unsupported:null};d.layerView2DImporter={hasLayerViewModule:function(a){return h.isSome(m[a.type])},importLayerView:function(a){var b=m[a.type];if(!h.isSome(b))throw a=a.declaredClass?a.declaredClass.slice(a.declaredClass.lastIndexOf(".")+1):"Unknown",
b=a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),new f(b+":view-not-supported",a+" is not supported in 2D");return b(a)}}})},"esri/views/2d/MapViewConstraints":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Evented ../../core/accessorSupport/decorators ../../layers/support/LOD ./constraints/RotationConstraint ./constraints/ZoomConstraint".split(" "),function(b,d,f,h,e,a,q,m,c){return function(b){function d(){var a=null!==
b&&b.apply(this,arguments)||this;a.lods=null;a.minScale=0;a.maxScale=0;a.minZoom=-1;a.maxZoom=-1;a.rotationEnabled=!0;a.snapToZoom=!0;return a}f(d,b);d.prototype.initialize=function(){this.watch("_zoom, _rotation",this.emit.bind(this,"update"),!0)};d.prototype.destroy=function(){this.view=null;this._set("_zoom",null);this._set("_rotation",null)};Object.defineProperty(d.prototype,"_rotation",{get:function(){return new m({rotationEnabled:this.rotationEnabled})},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"_defaultLODs",{get:function(){var a=this.get("view.defaultsFromMap.tileInfo"),b=this.get("view.spatialReference");return a&&b&&a.spatialReference.equals(b)?a.lods:null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"_zoom",{get:function(){return new c({lods:this.lods||this._defaultLODs,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale,snapToZoom:this.snapToZoom})},enumerable:!0,configurable:!0});d.prototype.canZoomInTo=function(a){var b=this.effectiveMaxScale;
return 0===b||a>=b};d.prototype.canZoomOutTo=function(a){var b=this.effectiveMinScale;return 0===b||a<=b};d.prototype.constrain=function(a,b){this._zoom.constrain(a,b);this._rotation.constrain(a,b);return a};d.prototype.fit=function(a){return this._zoom.fit(a)};d.prototype.zoomToScale=function(a){return this._zoom.zoomToScale(a)};d.prototype.scaleToZoom=function(a){return this._zoom.scaleToZoom(a)};d.prototype.snapScale=function(a){return this._zoom.snapToClosestScale(a)};d.prototype.snapToNextScale=
function(a){return this._zoom.snapToNextScale(a)};d.prototype.snapToPreviousScale=function(a){return this._zoom.snapToPreviousScale(a)};h([a.property({readOnly:!0,aliasOf:"_zoom.effectiveLODs"})],d.prototype,"effectiveLODs",void 0);h([a.property({readOnly:!0,aliasOf:"_zoom.effectiveMinScale"})],d.prototype,"effectiveMinScale",void 0);h([a.property({readOnly:!0,aliasOf:"_zoom.effectiveMaxScale"})],d.prototype,"effectiveMaxScale",void 0);h([a.property({readOnly:!0,aliasOf:"_zoom.effectiveMinZoom"})],
d.prototype,"effectiveMinZoom",void 0);h([a.property({readOnly:!0,aliasOf:"_zoom.effectiveMaxZoom"})],d.prototype,"effectiveMaxZoom",void 0);h([a.property({type:[q]})],d.prototype,"lods",void 0);h([a.property()],d.prototype,"minScale",void 0);h([a.property()],d.prototype,"maxScale",void 0);h([a.property()],d.prototype,"minZoom",void 0);h([a.property()],d.prototype,"maxZoom",void 0);h([a.property()],d.prototype,"rotationEnabled",void 0);h([a.property()],d.prototype,"snapToZoom",void 0);h([a.property()],
d.prototype,"view",void 0);h([a.property({type:m,dependsOn:["rotationEnabled"]})],d.prototype,"_rotation",null);h([a.property({dependsOn:["view.spatialReference","view.defaultsFromMap.tileInfo"]})],d.prototype,"_defaultLODs",null);h([a.property({readOnly:!0,type:c,dependsOn:"lods minZoom maxZoom minScale maxScale snapToZoom _defaultLODs".split(" ")})],d.prototype,"_zoom",null);return d=h([a.subclass("esri.views.2d.MapViewConstraints")],d)}(a.declared(e.EventedAccessor))})},"esri/views/2d/constraints/RotationConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(b,d,f,h,e,a){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.enabled=!0;a.rotationEnabled=!0;return a}f(d,b);c=d;d.prototype.constrain=function(a,b){if(!this.enabled||!b)return a;this.rotationEnabled||(a.rotation=b.rotation);return a};d.prototype.clone=function(){return new c({enabled:this.enabled,rotationEnabled:this.rotationEnabled})};var c;h([a.property()],d.prototype,"enabled",void 0);h([a.property()],d.prototype,"rotationEnabled",void 0);return d=c=h([a.subclass("esri.views.2d.constraints.RotationConstraint")],
d)}(a.declared(e))})},"esri/views/2d/constraints/ZoomConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../layers/support/LOD".split(" "),function(b,d,f,h,e,a,q){return function(b){function c(a){a=b.call(this,a)||this;a._lodByScale={};a._scales=[];a.effectiveLODs=null;a.effectiveMinZoom=-1;a.effectiveMaxZoom=-1;a.effectiveMinScale=0;a.effectiveMaxScale=
0;a.lods=null;a.minZoom=-1;a.maxZoom=-1;a.minScale=0;a.maxScale=0;a.snapToZoom=!0;return a}f(c,b);d=c;c.prototype.initialize=function(){var a=this,b,c,d=this.lods;c=this.minScale;b=this.maxScale;var e=this.minZoom,f=this.maxZoom,h=-1,l=-1,m=!1,q=!1;0!==c&&0!==b&&c<b&&(b=[b,c],c=b[0],b=b[1]);if(d&&d.length){d=d.map(function(a){return a.clone()});d.sort(function(a,b){return b.scale-a.scale});d.forEach(function(a,b){return a.level=b});for(var w,v=0,z=d;v<z.length;v++){var B=z[v];!m&&0<c&&c>=B.scale&&
(h=B.level,m=!0);!q&&0<b&&b>=B.scale&&(l=w?w.level:-1,q=!0);w=B}-1===e&&(e=0===c?0:h);-1===f&&(f=0===b?d.length-1:l);e=Math.max(e,0);e=Math.min(e,d.length-1);f=Math.max(f,0);f=Math.min(f,d.length-1);e>f&&(c=[f,e],e=c[0],f=c[1]);c=d[e].scale;b=d[f].scale;d.splice(0,e);d.splice(f-e+1,d.length);d.forEach(function(b,c){a._lodByScale[b.scale]=b;a._scales[c]=b.scale});this._set("effectiveLODs",d);this._set("effectiveMinZoom",e);this._set("effectiveMaxZoom",f)}this._set("effectiveMinScale",c);this._set("effectiveMaxScale",
b)};c.prototype.constrain=function(a,b){if(b&&a.scale===b.scale)return a;var c=this.effectiveMinScale,d=this.effectiveMaxScale,e=a.targetGeometry,f=b&&b.targetGeometry,k=0!==c&&a.scale>c;if(0!==d&&a.scale<d||k)c=k?c:d,f&&(b=(c-b.scale)/(a.scale-b.scale),e.x=f.x+(e.x-f.x)*b,e.y=f.y+(e.y-f.y)*b),a.scale=c;this.snapToZoom&&this.effectiveLODs&&(a.scale=this._getClosestScale(a.scale));return a};c.prototype.fit=function(a){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(a,null);var b=this.scaleToZoom(a.scale);
a.scale=this.zoomToScale(.99<Math.abs(b-Math.floor(b))?Math.round(b):Math.floor(b));return a};c.prototype.zoomToScale=function(a){if(!this.effectiveLODs)return 0;a-=this.effectiveMinZoom;a=Math.max(0,a);var b=this._scales;if(0>=a)return b[0];if(a>=b.length)return b[b.length-1];var c=Math.round(a);return b[c]+(c-a)*(b[Math.round(a-.5)]-b[c])};c.prototype.scaleToZoom=function(a){if(!this.effectiveLODs)return-1;var b=this._scales,c,d;if(a>=b[0])return this.effectiveMinZoom;if(a<=b[b.length-1])return this.effectiveMaxZoom;
for(var e=0;e<b.length-1;e++){c=b[e];d=b[e+1];if(d===a)return b=e+this.effectiveMinZoom,b+1;if(c>a&&d<a)return b=e+this.effectiveMinZoom,b+1-(a-d)/(c-d)}};c.prototype.snapToClosestScale=function(a){if(!this.effectiveLODs)return a;a=this.scaleToZoom(a);return this.zoomToScale(Math.round(a))};c.prototype.snapToNextScale=function(a,b){void 0===b&&(b=.5);if(!this.effectiveLODs)return a*b;a=Math.round(this.scaleToZoom(a));return this.zoomToScale(a+1)};c.prototype.snapToPreviousScale=function(a,b){void 0===
b&&(b=2);if(!this.effectiveLODs)return a*b;a=Math.round(this.scaleToZoom(a));return this.zoomToScale(a-1)};c.prototype.clone=function(){return new d({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})};c.prototype._getClosestScale=function(a){if(this._lodByScale[a])return this._lodByScale[a].scale;a=this._scales.reduce(function(b,c){return Math.abs(c-a)<=Math.abs(b-a)?c:b},this._scales[0]);return this._lodByScale[a].scale};var d;h([a.property({readOnly:!0})],
c.prototype,"effectiveLODs",void 0);h([a.property({readOnly:!0})],c.prototype,"effectiveMinZoom",void 0);h([a.property({readOnly:!0})],c.prototype,"effectiveMaxZoom",void 0);h([a.property({readOnly:!0})],c.prototype,"effectiveMinScale",void 0);h([a.property({readOnly:!0})],c.prototype,"effectiveMaxScale",void 0);h([a.property({type:[q]})],c.prototype,"lods",void 0);h([a.property()],c.prototype,"minZoom",void 0);h([a.property()],c.prototype,"maxZoom",void 0);h([a.property()],c.prototype,"minScale",
void 0);h([a.property()],c.prototype,"maxScale",void 0);h([a.property()],c.prototype,"snapToZoom",void 0);return c=d=h([a.subclass("esri.views.2d.constraints.ZoomConstraint")],c)}(a.declared(e))})},"esri/views/2d/PaddedViewState":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f64 ./viewpointUtils ./ViewState".split(" "),
function(b,d,f,h,e,a,q,m,c,l){var k=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.left=0;a.top=0;a.right=0;a.bottom=0;return a}f(c,b);h([a.property()],c.prototype,"left",void 0);h([a.property()],c.prototype,"top",void 0);h([a.property()],c.prototype,"right",void 0);h([a.property()],c.prototype,"bottom",void 0);return c=h([a.subclass("esri.views.2d.PaddedViewState.Padding")],c)}(a.declared(e));return function(b){function d(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];
var d=b.apply(this,a)||this;d.paddedViewState=new l;d._updateContent=function(){var a=m.vec2f64.create();return function(){var b=d._get("size"),c=d._get("padding");if(b&&c){var e=d.paddedViewState;q.vec2.set(a,c.left+c.right,c.top+c.bottom);q.vec2.subtract(a,b,a);q.vec2.copy(e.size,a);if(b=e.viewpoint)d.viewpoint=b}}}();d.watch(["size","padding"],d._updateContent,!0);d.padding=new k;d.size=[0,0];return d}f(d,b);Object.defineProperty(d.prototype,"padding",{set:function(a){this._set("padding",a||new k)},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewpoint",{set:function(a){if(a){var b=a.clone();this.paddedViewState.viewpoint=a;c.addPadding(b,a,this._get("size"),this._get("padding"));a=this._viewpoint2D;var d=b.targetGeometry;a.center[0]=d.x;a.center[1]=d.y;a.rotation=b.rotation;a.scale=b.scale;a.spatialReference=d.spatialReference;this._update()}},enumerable:!0,configurable:!0});h([a.property()],d.prototype,"paddedViewState",void 0);h([a.property({type:k})],d.prototype,"padding",
null);h([a.property()],d.prototype,"viewpoint",null);return d=h([a.subclass("esri.views.2d.PaddedViewState")],d)}(a.declared(l))})},"esri/views/2d/input/MapViewInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DoubleTapDragZoom ./handlers/DragPan ./handlers/DragRotate ./handlers/GamepadNavigation ./handlers/KeyPan ./handlers/KeyRotate ./handlers/KeyZoom ./handlers/MouseWheelZoom ./handlers/PinchAction ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/DoubleTapDrag ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,x,t,u,y,A,p,w,v,z,B,C,D){var G={left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},F={zoomIn:["\x3d","+"],zoomOut:["-","_"]},E={clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"};return function(b){function d(){var c=null!==b&&b.apply(this,arguments)||this;c._handles=new a;return c}f(d,b);d.prototype.initialize=function(){var a=this;this._handles.add([q.whenNot(this.view,
"ready",function(){return a._disconnect()}),q.when(this.view,"ready",function(){return a._connect()})])};d.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this._disconnect()};d.prototype._disconnect=function(){this._inputManager&&(this.view.viewEvents.disconnect(),this._inputManager.destroy(),this._inputManager=null,this._source.destroy(),this._source=null)};d.prototype._connect=function(){var a=this,b=new A.BrowserEventSource(this.view.surface,this.view.input),
d=[new B.ImmediateDoubleClick,new C.PointerClickHoldAndDrag,new D.SingleAndDoubleClick,new z.Drag(this.view.navigation),new v.DoubleTapDrag],d=new p.InputManager({eventSource:b,recognizers:d});d.installHandlers("prevent-context-menu",[new w.PreventContextMenu],p.ViewEventPriorities.INTERNAL);d.installHandlers("navigation",[new y.PinchRotateAndZoom(this.view),new r.GamepadNavigation(this.view),new u.MouseWheelZoom(this.view),new c.DoubleClickZoom(this.view),new c.DoubleClickZoom(this.view,["Ctrl"]),
new k.DragPan(this.view,"primary"),new g.KeyPan(this.view,G),new t.KeyZoom(this.view,F),new x.KeyRotate(this.view,E),new n.DragRotate(this.view,"secondary"),new l.DoubleTapDragZoom(this.view,"touch")],p.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(d);this._source=b;this._inputManager=d;q.init(this.view.navigation,"browserTouchPanEnabled",function(b){a._source.browserTouchPanningEnabled=!b})};Object.defineProperty(d.prototype,"test",{get:function(){return{inputManager:this._inputManager}},
enumerable:!0,configurable:!0});h([m.property()],d.prototype,"view",void 0);return d=h([m.subclass("esri.views.2d.input.MapViewInputManager")],d)}(m.declared(e))})},"esri/views/2d/input/handlers/DoubleClickZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler","../../../input/handlers/support"],function(b,d,f,h,e){Object.defineProperty(d,"__esModule",{value:!0});b=function(a){function b(b,c){var d=a.call(this,!0)||this;d.view=b;d.registerIncoming("double-click",
c,function(a){return d._handleDoubleClick(a,c)});return d}f(b,a);b.prototype._handleDoubleClick=function(a,b){e.eventMatchesPointerAction(a.data,"primary")&&(a.stopPropagation(),b?this.view.mapViewNavigation.zoomOut([a.data.x,a.data.y]):this.view.mapViewNavigation.zoomIn([a.data.x,a.data.y]))};return b}(h.InputHandler);d.DoubleClickZoom=b})},"esri/views/2d/input/handlers/DoubleTapDragZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../../core/compilerUtils",
"../../../input/InputHandler"],function(b,d,f,h,e){Object.defineProperty(d,"__esModule",{value:!0});b=function(a){function b(b,c,d){var e=a.call(this,!0)||this;e.view=b;e.pointerType=c;e.registerIncoming("double-tap-drag",d,function(a){return e._handleDoubleTapDrag(a)});return e}f(b,a);b.prototype._handleDoubleTapDrag=function(a){var b=a.data;if(b.pointerType===this.pointerType){a.stopPropagation();var d=b.action;a=b.delta;var e=this.view,b=e.mapViewNavigation;switch(d){case "begin":this._currentScale=
this._startScale=d=e.scale;this._previousDelta=a;b.begin();break;case "update":if(this._previousDelta.y===a.y)break;this._previousDelta=a;a=this._startScale*Math.pow(1.015,a.y);b.setViewpointImmediate(a/this._currentScale);this._currentScale=a;break;case "end":d=e.constraints;e=d.effectiveLODs;if(!d.snapToZoom||!e){b.end();break}e=d.snapScale(this._currentScale);a=(0<a.y?Math.max(e,d.snapToPreviousScale(this._startScale)):Math.min(e,d.snapToNextScale(this._startScale)))/this._currentScale;b.zoom(a);
break;default:h.neverReached(d)}}};return b}(e.InputHandler);d.DoubleTapDragZoom=b})},"esri/views/2d/input/handlers/DragPan":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../input/DragEventSeparator ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(b,d,f,h,e,a){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function d(c,d,e){var f=b.call(this,!0)||this;f.view=c;f.pointerAction=d;f.registerIncoming("drag",e,function(a){return f._handleDrag(a)});
f.registerIncoming("pointer-down",function(){return f.stopMomentumNavigation()});var k=f.view.mapViewNavigation;f.dragEventSeparator=new h.DragEventSeparator({start:function(a,b){k.pan.begin(f.view,b.data);b.stopPropagation()},update:function(a,b){k.pan.update(f.view,b.data);b.stopPropagation()},end:function(a,b){k.pan.end(f.view,b.data);b.stopPropagation()},condition:function(b,c){return 1===b&&a.eventMatchesPointerAction(c.data,f.pointerAction)}});return f}f(d,b);d.prototype._handleDrag=function(a){var b=
this.view.mapViewNavigation;b.pinch.zoomMomentum||b.pinch.rotateMomentum?this.stopMomentumNavigation():this.dragEventSeparator.handle(a)};d.prototype.stopMomentumNavigation=function(){this.view.mapViewNavigation.pan.stopMomentumNavigation()};return d}(e.InputHandler);d.DragPan=b})},"esri/views/2d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../input/DragEventSeparator ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(b,d,f,h,e,a){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function d(c,d,e){var f=b.call(this,!0)||this;f.view=c;f.pointerAction=d;var k=f.view.mapViewNavigation;f.dragEventSeparator=new h.DragEventSeparator({start:function(a,b){k.rotate.begin(f.view,b.data);b.stopPropagation()},update:function(a,b){k.rotate.update(f.view,b.data);b.stopPropagation()},end:function(a,b){k.rotate.end();b.stopPropagation()},condition:function(b,c){return 1===b&&a.eventMatchesPointerAction(c.data,
f.pointerAction)}});f.registerIncoming("drag",e,function(a){return f.dragEventSeparator.handle(a)});return f}f(d,b);return d}(e.InputHandler);d.DragRotate=b})},"esri/views/2d/input/handlers/GamepadNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/scheduling ../../../../core/watchUtils ../../viewpointUtils ../../../input/InputHandler ../../../navigation/gamepadAndKeyboardUtils".split(" "),function(b,d,f,h,e,a,q,m,c){Object.defineProperty(d,
"__esModule",{value:!0});b=function(b){function d(a){var c=b.call(this,!0)||this;c.view=a;c.frameTask=null;c.watchHandles=new h;c.currentDevice=null;c.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};c.handle=c.registerIncoming("gamepad",function(a){return c.handleEvent(a)});c.handle.pause();return c}f(d,b);d.prototype.onInstall=function(c){var d=this;b.prototype.onInstall.call(this,c);this.watchHandles.add([a.init(this.view.navigation.gamepad,"enabled",function(a){a?(d.handle.resume(),
d.frameTask||(d.frameTask=e.addFrameTask({update:function(a){return d.frameUpdate(a.deltaTime)}}))):(d.handle.pause(),d.frameTask&&(d.frameTask.remove(),d.frameTask=null))})])};d.prototype.onUninstall=function(){this.watchHandles.removeAll();this.frameTask&&(this.frameTask.remove(),this.frameTask=null);b.prototype.onUninstall.call(this)};d.prototype.handleEvent=function(a){var b=this.view.navigation.gamepad.device;b&&a.data.device!==b||this.currentDevice&&this.currentDevice!==a.data.device||("end"===
a.data.action?(this.currentDevice=null,c.resetTransformation(this.transformation)):(this.currentDevice=a.data.device,c.extractTransformation(a.data,this.view.navigation.gamepad,this.transformation)))};d.prototype.frameUpdate=function(a){var b=this.transformation;if(!c.isZeroTransformation(b)){var d=this.view.viewpoint.clone(),e=k*this.view.navigation.gamepad.velocityFactor*a;q.translateBy(d,d,[b.translation[0]*e,-b.translation[1]*e]);e=this.view.size;q.scaleAndRotateBy(d,d,1+b.translation[2]*n*a,
this.view.constraints.rotationEnabled?-b.heading*l*a:0,[e[0]/2,e[1]],e);a=this.view.constraints.constrain(d,this.view.viewpoint);this.view.viewpoint=a}};return d}(m.InputHandler);d.GamepadNavigation=b;var l=.06,k=.7,n=6E-4})},"esri/views/2d/input/handlers/KeyPan":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function a(a,d,c){var e,f=b.call(this,!0)||
this;f.view=a;f.keys=d;f._pressed=!1;f._keyMap=(e={},e[d.left]="left",e[d.right]="right",e[d.up]="up",e[d.down]="down",e);f.registerIncoming("key-down",c,function(a){return f._handleKeyDown(a)});f.registerIncoming("key-up",c,function(a){return f._handleKeyUp(a)});f.registerIncoming("blur",c,function(){return f._handleBlur()});return f}f(a,b);a.prototype._handleKeyDown=function(a){a.data.repeat||this._handleKey(a,!0)};a.prototype._handleKeyUp=function(a){this._handleKey(a,!1)};a.prototype._handleBlur=
function(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())};a.prototype._handleKey=function(a,b){var c=this._keyMap[a.data.key];if(this._pressed=null!=c){if(b)switch(this.view.mapViewNavigation.begin(),c){case "left":this.view.mapViewNavigation.continousPanLeft();break;case "right":this.view.mapViewNavigation.continousPanRight();break;case "up":this.view.mapViewNavigation.continousPanUp();break;case "down":this.view.mapViewNavigation.continousPanDown()}else this._pressed=!1,this.view.mapViewNavigation.stop();
a.stopPropagation()}};return a}(h.InputHandler);d.KeyPan=b})},"esri/views/2d/input/handlers/KeyRotate":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function a(a,d,c){var e,f=b.call(this,!0)||this;f.view=a;f.keys=d;f._pressed=!1;f._keyToDirection=(e={},e[d.clockwiseOption1]="clockwise",e[d.clockwiseOption2]="clockwise",e[d.counterClockwiseOption1]="counterClockwise",
e[d.counterClockwiseOption2]="counterClockwise",e[d.resetOption1]="reset",e[d.resetOption2]="reset",e);f.registerIncoming("key-down",c,function(a){return f._handleKeyDown(a)});f.registerIncoming("key-up",c,function(a){return f._handleKeyUp(a)});f.registerIncoming("blur",c,function(){return f._handleBlur()});return f}f(a,b);a.prototype._handleKeyDown=function(a){a.data.repeat||this._handleKey(a,!0)};a.prototype._handleKeyUp=function(a){this._handleKey(a,!1)};a.prototype._handleBlur=function(){this._pressed&&
(this._pressed=!1,this.view.mapViewNavigation.stop())};a.prototype._handleKey=function(a,b){var c=a.modifiers;if(!(0<c.size&&!c.has("Shift")||!this.view.constraints.rotationEnabled)&&(c=this._keyToDirection[a.data.key],this._pressed=null!=c)){if(b)switch(this.view.mapViewNavigation.begin(),c){case "clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case "counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case "reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=
!1,this.view.mapViewNavigation.stop();a.stopPropagation()}};return a}(h.InputHandler);d.KeyRotate=b})},"esri/views/2d/input/handlers/KeyZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../../core/compilerUtils","../../../input/InputHandler"],function(b,d,f,h,e){Object.defineProperty(d,"__esModule",{value:!0});b=function(a){function b(b,c,d){var e=a.call(this,!0)||this;e.view=b;e.keys=c;e._keysToZoomAction={};e.registerIncoming("key-down",d,function(a){return e._handleKeyDown(a)});
c.zoomIn.forEach(function(a){return e._keysToZoomAction[a]=0});c.zoomOut.forEach(function(a){return e._keysToZoomAction[a]=1});return e}f(b,a);b.prototype._handleKeyDown=function(a){this._handleKey(a)};b.prototype._handleKey=function(a){var b=a.modifiers;if(!(0<b.size)||b.has("Shift"))if(b=a.data.key,b in this._keysToZoomAction){var b=this._keysToZoomAction[b],d=this.view.mapViewNavigation,e=null;switch(b){case 0:e=d.zoomIn();break;case 1:e=d.zoomOut();break;default:h.neverReached(b);return}d.begin();
e.then(function(){return d.end()});a.stopPropagation()}};return b}(e.InputHandler);d.KeyZoom=b})},"esri/views/2d/input/handlers/MouseWheelZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function a(a,d){var c=b.call(this,!0)||this;c.view=a;c._canZoom=!0;c.registerIncoming("mouse-wheel",d,function(a){return c._handleMouseWheel(a)});return c}f(a,b);a.prototype._handleMouseWheel=
function(a){var b=this;if(this.view.navigation.mouseWheelZoomEnabled&&(a.preventDefault(),a.stopPropagation(),this._canZoom)){var c=this.view.mapViewNavigation;a=a.data;if(a=c.zoom(1/Math.pow(.6,1/60*a.deltaY),[a.x,a.y]))this._canZoom=!1,a.catch(function(){}).then(function(){b._canZoom=!0;c.end()})}};return a}(h.InputHandler);d.MouseWheelZoom=b})},"esri/views/2d/input/handlers/PinchAction":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/DragEventSeparator",
"../../../input/InputHandler"],function(b,d,f,h,e){Object.defineProperty(d,"__esModule",{value:!0});b=function(a){function b(b){var c=a.call(this,!0)||this;c.view=b;c.registerIncoming("drag",function(a){return c._handleDrag(a)});c.registerIncoming("pointer-down",function(){return c.stopMomentumNavigation()});var d=c.view.mapViewNavigation;c.dragEventSeparator=new h.DragEventSeparator({start:function(a,b){d.pinch.begin(c.view,b.data);b.stopPropagation()},update:function(a,b){d.pinch.update(c.view,
b.data);b.stopPropagation()},end:function(a,b){d.pinch.end(c.view);b.stopPropagation()},condition:function(a){return 2<=a}});return c}f(b,a);b.prototype._handleDrag=function(a){this.dragEventSeparator.handle(a)};b.prototype.stopMomentumNavigation=function(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()};return b}(e.InputHandler);d.PinchRotateAndZoom=b})},"esri/views/input/recognizers/DoubleTapDrag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../../../core/MapUtils ../../../core/screenUtils ../DragEventSeparator ../InputHandler ./SingleAndDoubleClick ./support".split(" "),
function(b,d,f,h,e,a,q,m,c,l){Object.defineProperty(d,"__esModule",{value:!0});b=function(b){function d(d,e,f,k,l){void 0===d&&(d=c.DefaultParameters.maximumDoubleClickDelay);void 0===e&&(e=c.DefaultParameters.maximumDoubleClickDistance);void 0===f&&(f=c.DefaultParameters.maximumDoubleTouchDelay);void 0===k&&(k=c.DefaultParameters.maximumDoubleTouchDistance);void 0===l&&(l=h.default);var g=b.call(this,!1)||this;g.maximumDoubleClickDelay=d;g.maximumDoubleClickDistance=e;g.maximumDoubleTouchDelay=f;
g.maximumDoubleTouchDistance=k;g._clock=l;g._doubleTapDragReady=!1;g._doubleTapDragActive=!1;g._dragStartCenter=a.createScreenPoint(0,0);g._pointerState=new Map;g._doubleTapDrag=g.registerOutgoing("double-tap-drag");g._dragEventSeparator=new q.DragEventSeparator({start:function(a,b){return g._dragStart(a,b)},update:function(a,b){return g._dragUpdate(b)},end:function(a,b){return g._dragEnd(b)}});g.registerIncoming("drag",function(a){return g._dragEventSeparator.handle(a)});g.registerIncoming("pointer-down",
function(a){return g._handlePointerDown(a)});g.registerIncoming("pointer-up",function(){return g._handlePointerUp()});return g}f(d,b);d.prototype.onUninstall=function(){this._pointerState.forEach(function(a){null!=a.doubleTapTimeout&&(a.doubleTapTimeout.remove(),a.doubleTapTimeout=null)})};Object.defineProperty(d.prototype,"hasPendingInputs",{get:function(){return e.someMap(this._pointerState,function(a){return null!=a.doubleTapTimeout})},enumerable:!0,configurable:!0});d.prototype._clearPointerDown=
function(a){var b=this._pointerState.get(a);b&&(b.doubleTapTimeout.remove(),b.doubleTapTimeout=null,this._pointerState.delete(a),this.refreshHasPendingInputs())};d.prototype._createDoubleTapDragData=function(a,b,c){return{action:a,delta:b,button:c.button,buttons:c.buttons,pointer:c.pointer,pointers:c.pointers,pointerType:c.pointerType,timestamp:c.timestamp}};d.prototype._dragStart=function(b,c){if(this._doubleTapDragReady&&1===b){this._doubleTapDragReady=!1;this._doubleTapDragActive=!0;var d=c.data;
b=c.modifiers;this._dragStartCenter=d.center;d=this._createDoubleTapDragData("begin",a.createScreenPoint(0,0),d);this._doubleTapDrag.emit(d,void 0,b);c.stopPropagation()}};d.prototype._dragUpdate=function(b){if(this._doubleTapDragActive){var c=b.data,d=b.modifiers,e=c.center,e=a.createScreenPoint(e.x-this._dragStartCenter.x,e.y-this._dragStartCenter.y),c=this._createDoubleTapDragData("update",e,c);this._doubleTapDrag.emit(c,void 0,d);b.stopPropagation()}};d.prototype._dragEnd=function(b){if(this._doubleTapDragActive){var c=
b.data,d=b.modifiers,e=c.center,e=a.createScreenPoint(e.x-this._dragStartCenter.x,e.y-this._dragStartCenter.y),c=this._createDoubleTapDragData("end",e,c);this._doubleTapDrag.emit(c,void 0,d);this._doubleTapDragActive=!1;b.stopPropagation()}};d.prototype._handlePointerDown=function(a){var b=a.data,c=this._pointerId(b),d=this._pointerState.get(c),e=b.native.pointerType;d?(e="touch"===e?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance,this._clearPointerDown(c),l.manhattanDistance(d.event.data,
b)>e?this._storePointerDown(a):this._doubleTapDragReady=!0):this._storePointerDown(a)};d.prototype._handlePointerUp=function(){this._doubleTapDragReady=!1};d.prototype._pointerId=function(a){var b=a.native;a=b.pointerId;var c=b.button,b=b.pointerType;return"mouse"===b?a+":"+c:""+b};d.prototype._storePointerDown=function(a){var b=this,c=a.data,d=c.native.pointerType,e=this._pointerId(c),c=this._clock.setTimeout(function(){return b._clearPointerDown(e)},"touch"===d?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay);
this._pointerState.set(e,{event:a,doubleTapTimeout:c});this.refreshHasPendingInputs()};return d}(m.InputHandler);d.DoubleTapDrag=b})},"esri/views/2d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(b,d,f,h,e,a,q){var m=0;return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.color=
new e([0,255,255]);b.haloOpacity=1;b.fillOpacity=.25;return b}f(b,a);Object.defineProperty(b.prototype,"version",{get:function(){return m++},enumerable:!0,configurable:!0});h([q.property({readOnly:!0,dependsOn:["color","haloColor","haloOpacity","fillOpacity"]})],b.prototype,"version",null);h([q.property({type:e})],b.prototype,"color",void 0);h([q.property({type:e})],b.prototype,"haloColor",void 0);h([q.property()],b.prototype,"haloOpacity",void 0);h([q.property()],b.prototype,"fillOpacity",void 0);
return b=h([q.subclass("esri.views.2d.support.HighlightOptions")],b)}(q.declared(a))})},"esri/views/ui/2d/DefaultUI2D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI".split(" "),function(b,d,f,h,e,a){return function(a){function b(b){b=a.call(this,b)||this;b.components=["attribution","zoom"];return b}f(b,a);h([e.property()],b.prototype,"components",void 0);return b=h([e.subclass("esri.views.ui.2d.DefaultUI2D")],
b)}(e.declared(a))})},"esri/widgets/Legend/support/colorRampUtils":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../Color ../../../core/promiseUtils ./utils @dojo/framework/shim/Promise".split(" "),function(b,d,f,h,e,a,q){function m(a,b){var c=[],d=a.length-1;5===a.length?c.push(0,2,4):c.push(0,d);return a.map(function(a,e){return-1<c.indexOf(e)?q.createStopLabel(a,e,d,b):null})}function c(a,c,d){void 0===d&&(d=n);return f(this,
void 0,void 0,function(){var f,g;return h(this,function(h){switch(h.label){case 0:return f=new e(d),[4,new Promise(function(a,c){b(["../../../renderers/visualVariables/support/visualVariableUtils"],a,c)})];case 1:return g=h.sent().getOpacity(c,a),null!=g&&(f.a=g),[2,f]}})})}function l(a,b){a=k(a,b);var c=a.startIndex,d=a.endIndex;if(c===d)return b[c].color;b=e.blendColors(b[c].color,b[d].color,a.weight);return new e(b)}function k(a,b){var c=0,d=b.length-1;b.some(function(b,e){if(a<b.value)return d=
e,!0;c=e;return!1});return{startIndex:c,endIndex:d,weight:(a-b[c].value)/(b[d].value-b[c].value)}}Object.defineProperty(d,"__esModule",{value:!0});var n=new e([64,64,64]);d.getRampStops=function(d,e,k){return f(this,void 0,void 0,function(){var g,l,n,q,p,r,v,z,x=this;return h(this,function(t){switch(t.label){case 0:g=!1;l=[];n=[];d.stops&&(q=d.stops,l=q.map(function(a){return a.value}),(g=q.some(function(a){return!!a.label}))&&(n=q.map(function(a){return a.label})));p=l[0];r=l[l.length-1];if(null==
p&&null==r)return[2,null];v=g?null:m(l,k);return[4,a.all(l.map(function(a,k){return f(x,void 0,void 0,function(){var f,l,m;return h(this,function(h){switch(h.label){case 0:return"opacity"!==d.type?[3,2]:[4,c(a,d,e)];case 1:return l=h.sent(),[3,4];case 2:return[4,new Promise(function(a,c){b(["../../../renderers/visualVariables/support/visualVariableUtils"],a,c)})];case 3:l=h.sent().getColor(d,a),h.label=4;case 4:return f=l,m=g?n[k]:v[k],[2,{value:a,color:f,label:m}]}})})}))];case 1:return z=t.sent(),
[2,z.reverse()]}})})};d.getRampStopsForPointCloud=function(a){var b=!1,c=[],d=[],c=a.map(function(a){return a.value});(b=a.some(function(a){return!!a.label}))&&(d=a.map(function(a){return a.label}));var e=c[c.length-1];if(null==c[0]&&null==e)return null;var f=b?null:m(c,!1);return c.map(function(c,e){var g=l(c,a);return{value:c,color:g,label:b?d[e]:f[e]}}).reverse()};d.getColorFromPointCloudStops=l;d.getStrectchRampStops=function(a,b){var c=[];if(a&&"multipart"===a.type)a.colorRamps.reverse().forEach(function(d,
f){0===f?c.push({value:b.max,color:new e(d.toColor),label:"high"}):c.push({value:null,color:new e(d.toColor),label:""});f===a.colorRamps.length-1?c.push({value:b.min,color:new e(d.fromColor),label:"low"}):c.push({value:null,color:new e(d.fromColor),label:""})});else{var d=void 0,f=void 0;a&&"algorithmic"===a.type?(d=a.fromColor,f=a.toColor):(d=[0,0,0,1],f=[255,255,255,1]);c=[{value:b.max,color:new e(f),label:"high"},{value:b.min,color:new e(d),label:"low"}]}return c}})},"esri/widgets/Legend/support/utils":function(){define(["require",
"exports","../../../intl/date","../../../renderers/support/numberUtils"],function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});var e=f.convertDateFormatToIntlOptions("short-date");d.createStopLabel=function(a,b,d,c){var l="";0===b?l="\x3c ":b===d&&(l="\x3e ");b=null;b=c?f.formatDate(a,e):h.format(a);return l+b};d.RGB_IMG_SOURCE=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII\x3d",
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII\x3d","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII\x3d"]})},"esri/widgets/Legend/support/heatmapRampUtils":function(){define(["require","exports","../../../renderers/support/HeatmapColorStop"],
function(b,d,f){Object.defineProperty(d,"__esModule",{value:!0});d.getHeatmapRampStops=function(b){b=b.colorStops;var d=b.length-1;if(b&&b[0]){var a=b[d];a&&1!==a.ratio&&(b=b.slice(0),b.push(new f.HeatmapColorStop({ratio:1,color:a.color})),d++)}return b.map(function(a,b){var c="";0===b?c="low":b===d&&(c="high");return{color:a.color,label:c,ratio:a.ratio}}).reverse()}})},"esri/widgets/Legend/support/relationshipRampUtils":function(){define(["require","exports","../../../symbols/support/gfxUtils","../../../symbols/support/previewSymbol3D"],
function(b,d,f,h){function e(a){if(a){var b=a.type;return-1<b.indexOf("3d")?h.getSymbolLayerFill(a.symbolLayers.getItemAt(0)):"simple-line"===b||"simple-marker"===a.type&&("x"===a.style||"cross"===a.style)?(a=f.getStroke(a))&&a.color:f.getFill(a)}}function a(a,b){var c=b.HH.label,d=b.LL.label,e=b.HL.label;b=b.LH.label;switch(a){case "HH":return{top:c,bottom:d,left:e,right:b};case "HL":return{top:e,bottom:b,left:d,right:c};case "LL":return{top:d,bottom:c,left:b,right:e};case "LH":return{top:b,bottom:e,
left:c,right:d};default:return{top:c,bottom:d,left:e,right:b}}}function q(a){var b=m[a];a&&null==b&&(b=m.HH);return b||0}Object.defineProperty(d,"__esModule",{value:!0});var m={HH:315,HL:45,LL:135,LH:225},c={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};d.getRelationshipRampElement=function(b){var d=b.focus,f=b.numClasses,h=c[f],g={};b.infos.forEach(function(a){g[a.value]=
{label:a.label,fill:e(a.symbol)}});b=[];for(var l=0;l<f;l++){for(var m=[],u=0;u<f;u++)m.push(g[h[l][u]].fill);b.push(m)}h=a(d,g);return{type:"relationship-ramp",numClasses:f,focus:d,colors:b,labels:h,rotation:q(d)}};d.getRotationAngleForFocus=q})},"esri/widgets/Legend/support/sizeRampUtils":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../symbols ../../../core/promiseUtils ../../../renderers/support/numberUtils ../../../symbols/support/utils ./utils @dojo/framework/shim/Promise".split(" "),
function(b,d,f,h,e,a,q,m,c){function l(a,b){var d=a.length-1;return a.map(function(a,e){return c.createStopLabel(a,e,d,b)})}function k(a,b){var c=null,d=null;"simple"===a.type?c=a.symbol:"class-breaks"===a.type?(c=(a=a.classBreakInfos)&&a[0]&&a[0].symbol,d=1<a.length):"unique-value"===a.type&&(c=(a=a.uniqueValueInfos)&&a[0]&&a[0].symbol,d=1<a.length);if(!c||n(c))return null;c=c.clone();if(b||d)-1<c.type.indexOf("3d")?r(c):(b=c,-1!==b.type.indexOf("line")?b.color=w:(b.color=A,"simple-marker"===b.type&&
(b.outline={color:w,width:1.5})));return c}function n(a){return a?e.isSymbol3D(a)?a.symbolLayers?a.symbolLayers.some(function(a){return a&&"fill"===a.type}):!1:-1!==a.type.indexOf("fill"):!1}function r(a){m.isVolumetricSymbol(a)||("line-3d"===a.type?a.symbolLayers.forEach(function(a){a.material={color:w}}):a.symbolLayers.forEach(function(a){"icon"!==a.type||a.resource&&a.resource.href?a.material={color:p}:(a.material={color:A},a.outline={color:w,size:1.5})}))}function g(a,c,d,e){return f(this,void 0,
void 0,function(){var f,g,k,l,m;return h(this,function(h){switch(h.label){case 0:return[4,new Promise(function(a,c){b(["../../../renderers/visualVariables/support/visualVariableUtils"],a,c)})];case 1:g=(f=h.sent().getSizeRangeAtScale(a,d,e))&&x(f);if(!f&&!g)return[2,void 0];k=g.map(function(b){var c=f.minSize,d=f.maxSize,e=a.minDataValue,g=a.maxDataValue;return b<=c?e:b>=d?g:(b-c)/(d-c)*(g-e)+e});k=q.round(k);l=1;h.label=2;case 2:return l<k.length-1?[4,t(a,c,k[l],k[l-1],d,e)]:[3,5];case 3:if(m=h.sent())k[l]=
m[0],g[l]=m[1];h.label=4;case 4:return l++,[3,2];case 5:return[2,k]}})})}function x(a){var b=a.minSize;a=(a.maxSize-b)/4;for(var c=[],d=0;5>d;d++)c.push(b+a*d);return c}function t(a,b,c,d,e,g){return f(this,void 0,void 0,function(){var f,k,l,m,n,p,r,t,w,v,x,z,B,y,C,A,D,G,Z,aa,W,Y;return h(this,function(h){switch(h.label){case 0:return[4,u(a,b,c,e,g)];case 1:return k=h.sent(),[4,u(a,b,d,e,g)];case 2:l=h.sent(),m=q.numDigits(c),n=m.fractional,p=20,r=m.integer,w=t=null,0<c&&1>c&&(t=Math.pow(10,n),c*=
t,r=q.numDigits(c).integer),v=r-1,h.label=3;case 3:if(!(0<=v))return[3,8];x=Math.pow(10,v);z=Math.floor(c/x)*x;B=Math.ceil(c/x)*x;null!=t&&(z/=t,B/=t);y=(z+B)/2;f=q.round([z,y,B],{indexes:[1]});y=f[1];return[4,u(a,b,z,e,g)];case 4:return C=h.sent(),[4,u(a,b,B,e,g)];case 5:return A=h.sent(),[4,u(a,b,y,e,g)];case 6:D=h.sent();G=q.percentChange(k,C,l,null);Z=q.percentChange(k,A,l,null);aa=q.percentChange(k,D,l,null);W=G.previous<=p;Y=Z.previous<=p;W&&Y&&(G.previous<=Z.previous?(W=!0,Y=!1):(Y=!0,W=!1));
W?w=[z,C]:Y?w=[B,A]:aa.previous<=p&&(w=[y,D]);if(w)return[3,8];h.label=7;case 7:return v--,[3,3];case 8:return[2,w]}})})}function u(a,c,d,e,g){return f(this,void 0,void 0,function(){var f;return h(this,function(h){switch(h.label){case 0:return[4,new Promise(function(a,c){b(["../../../renderers/visualVariables/support/visualVariableUtils"],a,c)})];case 1:return f=h.sent().getSize,[2,f(a,d,{scale:e,view:g,shape:"simple-marker"===c.type?c.style:null})]}})})}function y(a,b){a=a.clone();if(e.isSymbol3D(a))m.isVolumetricSymbol(a)||
a.symbolLayers.forEach(function(a){"fill"!==a.type&&(a.size=b)});else if("esri.symbols.SimpleMarkerSymbol"===a.declaredClass)a.size=b;else if("esri.symbols.PictureMarkerSymbol"===a.declaredClass){var c=a.width,d=a.height;a.height=b;a.width=c/d*b}else"esri.symbols.SimpleLineSymbol"===a.declaredClass?a.width=b:"esri.symbols.TextSymbol"===a.declaredClass&&a.font&&(a.font.size=b);return a}Object.defineProperty(d,"__esModule",{value:!0});d.REAL_WORLD_MAX_SIZE=30;d.REAL_WORLD_MIN_SIZE=12;var A=[255,255,
255],p=[200,200,200],w=[128,128,128];d.getRampStops=function(b,c,e,n,p,r){return f(this,void 0,void 0,function(){var t,w,v,x,z,B,A,C,D,G,P,U,T,S,R,O,V,X=this;return h(this,function(E){switch(E.label){case 0:w=(t=c.legendOptions)&&t.customValues;v=k(b,e);x=!!v;z=!!w;B=null!=c.minSize&&null!=c.maxSize;A=c.stops&&1<c.stops.length;C=!!c.target;if(!x||!(z||B||A&&!C))return[2,void 0];D=m.isVolumetricSymbol(v);U=P=G=null;if(!D||A)return[3,1];P=q.round([c.minDataValue,c.maxDataValue]);return[3,4];case 1:return(T=
w)?[3,3]:[4,g(c,v,n,p)];case 2:T=E.sent(),E.label=3;case 3:P=T,E.label=4;case 4:!P&&A&&(P=c.stops.map(function(a){return a.value}),(G=c.stops.some(function(a){return!!a.label}))&&(U=c.stops.map(function(a){return a.label})));D&&P&&2<P.length&&(P=[P[0],P[P.length-1]]);if(!P)return[2,null];S=[d.REAL_WORLD_MIN_SIZE,d.REAL_WORLD_MAX_SIZE];R=m.getSymbolOutlineSize(v);O=G?null:l(P,r);return[4,a.all(P.map(function(a,b){return f(X,void 0,void 0,function(){var d,e,f,g;return h(this,function(h){switch(h.label){case 0:if(!D)return[3,
1];f=S[b];return[3,3];case 1:return[4,u(c,v,a,n,p)];case 2:f=h.sent(),h.label=3;case 3:return d=f,e=y(v,d),g=G?U[b]:O[b],[2,{value:a,symbol:e,label:g,size:d,outlineSize:R}]}})})}))];case 5:return V=E.sent(),[2,V.reverse()]}})})}})},"esri/widgets/Legend/styles/Card":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper dojo/i18n!../../../nls/common dojo/i18n!../../Legend/nls/Legend ../../../intl ../../../core/Handles ../../../core/screenUtils ../../../core/accessorSupport/decorators ../../../symbols/support/svgUtils ../../Widget ./support/utils ../support/styleUtils ../../support/colorUtils ../../support/widget".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k,n,r,g,x,t,u){var y=window.devicePixelRatio;return function(b){function d(a){a=b.call(this,a)||this;a._handles=new c;a._hasIndicators=!1;a._selectedSectionName=null;a._sectionNames=[];a._sectionMap=new Map;a.activeLayerInfos=null;a.layout="stack";a.type="card";a.view=null;return a}f(d,b);d.prototype.postInitialize=function(){var a=this;this.own([this.watch("activeLayerInfos",function(b){a._handles.removeAll();a._watchForSectionChanges(b)})])};d.prototype.destroy=function(){this._handles.destroy();
this._handles=null};d.prototype.render=function(){var b=this,c;this._hasIndicators="auto"===this.layout&&768>=this.view.container.clientWidth||"stack"===this.layout;var d=this.activeLayerInfos,e=d&&d.toArray().map(function(a){return b._renderLegendForLayer(a)}).filter(function(a){return!!a});this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;
var f=this._sectionNames.length,d=this._sectionNames.map(function(c,d){var e;d=m.substitute(a.pagination.pageText,{index:d+1,total:f});return u.tsx("div",{key:c,"aria-label":d,title:d,tabIndex:0,onclick:b._selectSection,onkeydown:b._selectSection,bind:b,class:b.classes("esri-legend--card__carousel-indicator",(e={},e["esri-legend--card__carousel-indicator--activated"]=b._selectedSectionName===c,e)),"data-section-name":c})}),d=this._hasIndicators&&1<f?u.tsx("div",{class:"esri-legend--card__carousel-indicator-container",
key:"carousel-navigation"},d):null,e=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):e&&e.length?e:null,g=(c={},c["esri-legend--stacked"]=this._hasIndicators,c);return u.tsx("div",{class:this.classes("esri-legend--card esri-widget",g)},d,e?e:u.tsx("div",{class:"esri-legend--card__message"},q.noLegend))};d.prototype._selectSection=function(a){if(a=a.target.getAttribute("data-section-name"))this._selectedSectionName=a};d.prototype._watchForSectionChanges=function(a){var b=this;this._generateSectionNames();
a&&(a.forEach(function(a){var c="activeLayerInfo-"+a.layer.uid+"-version-change";b._handles.remove(c);b._watchForSectionChanges(a.children);b._handles.add(a.watch("version",function(){return b._generateSectionNames()}),c)}),this._handles.remove("activeLayerInfos-collection-change"),this._handles.add(a.on("change",function(){return b._watchForSectionChanges(a)}),"activeLayerInfos-collection-change"))};d.prototype._generateSectionNames=function(){this._sectionNames.length=0;this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,
this)};d.prototype._generateSectionNamesForActiveLayerInfo=function(a){var b=this;a.children.forEach(this._generateSectionNamesForActiveLayerInfo,this);a.legendElements&&a.legendElements.forEach(function(c,d){b._sectionNames.push("esri-legend--card__"+a.layer.uid+"-type-"+c.type+"-"+d)})};d.prototype._renderLegendForLayer=function(a){var b=this,c;if(!a.ready)return null;if(a.children.length)return c=a.children.map(function(a){return b._renderLegendForLayer(a)}).toArray(),u.tsx("div",{key:a.layer.uid,
class:this.classes("esri-legend--card__service","esri-legend--card__group-layer")},u.tsx("div",{class:"esri-legend--card__service-caption-container"},a.title),c);var d=a.legendElements;if(d&&!d.length)return null;var e=d.some(function(a){return"relationship-ramp"===a.type}),d=d.map(function(c,d){return b._renderLegendForElement(c,a,d,e)}).filter(function(a){return!!a});if(!d.length)return null;var f=(c={},c["esri-legend--card__group-layer-child"]=!!a.parent,c);return u.tsx("div",{key:a.layer.uid,
class:this.classes("esri-legend--card__service",f)},u.tsx("div",{class:"esri-legend--card__service-caption-container"},u.tsx("div",{class:"esri-legend--card__service-caption-text"},a.title)),u.tsx("div",{class:"esri-legend--card__service-content"},d))};d.prototype._renderLegendForElement=function(a,b,c,d){var e=this;void 0===d&&(d=!1);var f,h="color-ramp"===a.type,k="opacity-ramp"===a.type,l="size-ramp"===a.type,m=b.layer,n=a.title,p=null;"string"===typeof n?p=n:n&&(p=x.getTitle(n,h||k),p=n.title?
n.title+" ("+p+")":p);c="esri-legend--card__"+m.uid+"-type-"+a.type+"-"+c;n=this._hasIndicators?u.tsx("div",null,u.tsx("h3",{class:this.classes("esri-widget__heading","esri-legend--card__carousel-title")},b.title),u.tsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},p)):p?u.tsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},p):null;p=null;"symbol-table"===a.type?(l=a.infos.map(function(c,d){return e._renderLegendForElementInfo(c,
b,a.legendType,d)}).filter(function(a){return!!a}),l.length&&(m=l[0].properties.classes&&l[0].properties.classes["esri-legend--card__symbol-row"],d=(f={},f["esri-legend--card__label-container"]=!m&&!d,f["esri-legend--card__relationship-label-container"]=d,f),p=u.tsx("div",{key:c,class:"esri-legend--card__section"},n,u.tsx("div",{class:this.classes(d)},l)))):"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?p=u.tsx("div",{key:c,class:"esri-legend--card__section"},n,this._renderLegendForRamp(a,
m.opacity)):l?p=u.tsx("div",{key:c,class:"esri-legend--card__section"},n,this._renderSizeRamps(a,m.opacity)):"relationship-ramp"===a.type&&(p=u.tsx("div",{key:c,class:this.classes("esri-legend--card__section","esri-legend--card__relationship-section")},n,g.renderRelationshipRamp(a,this.id,m.opacity)));if(!p)return null;this._sectionMap.set(c,p);return p};d.prototype._renderLegendForElementInfo=function(a,b,c,d){var e,f,g,h=b.layer;if(a.type)return this._renderLegendForElement(a,b,d);b=x.isImageryStretchedLegend(h,
c);if(a.symbol&&a.preview){if(-1===a.symbol.type.indexOf("simple-fill")){if(!a.label)return u.tsx("div",{key:d,bind:a.preview,afterCreate:x.attachToNode});h=(e={},e["esri-legend--card__symbol-cell"]=this._hasIndicators,e);return u.tsx("div",{key:d,class:this.classes("esri-legend--card__layer-row",(f={},f["esri-legend--card__symbol-row"]=this._hasIndicators,f))},u.tsx("div",{class:this.classes(h),bind:a.preview,afterCreate:x.attachToNode}),u.tsx("div",{class:this.classes("esri-legend--card__image-label",
(g={},g["esri-legend--card__label-cell"]=this._hasIndicators,g))},x.getTitle(a.label,!1)||""))}g=f=e=255;b=0;var k=c=255,l=255,m=0,n=a.symbol.color&&a.symbol.color.a,p=a.symbol.outline&&a.symbol.outline.color&&a.symbol.outline.color.a;n&&(e=a.symbol.color.r,f=a.symbol.color.g,g=a.symbol.color.b,b=a.symbol.color.a*h.opacity);p&&(c=a.symbol.outline.color.r,k=a.symbol.outline.color.g,l=a.symbol.outline.color.b,m=a.symbol.outline.color.a*h.opacity);var q=(h=a.symbol.color?t.isBright(a.symbol.color):!0)?
"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return u.tsx("div",{key:d,class:"esri-legend--card__layer-row"},u.tsx("div",{class:"esri-legend--card__label-element",styles:{background:n?"rgba("+e+", "+f+", "+g+", "+b+")":"none",color:h?"black":"white",textShadow:"-1px -1px 0 "+q+",\n                                              1px -1px 0 "+q+",\n                                              -1px 1px 0 "+q+",\n                                              1px 1px 0 "+q,border:p?"1px solid rgba("+c+
", "+k+", "+l+", "+m+")":"none"}}," ",a.label," "))}if(a.src)return h=this._renderImage(a,h,b),u.tsx("div",{key:d,class:"esri-legend--card__layer-row"},h,u.tsx("div",{class:"esri-legend--card__image-label"},a.label||""))};d.prototype._renderImage=function(a,b,c){var d,e=a.label,f=a.src,g=a.opacity;c=(d={},d["esri-legend--card__imagery-layer-image--stretched"]=c,d["esri-legend--card__symbol"]=!c,d);b={opacity:""+(null!=g?g:b.opacity)};return u.tsx("img",{alt:x.getTitle(e,!1),src:f,border:0,width:a.width,
height:a.height,class:this.classes(c),styles:b})};d.prototype._drawImageOnSizeRamp=function(a,b,c){var d=c.x,e=c.y,f=c.width,g=c.height,h=new Image;h.src=b;h.onload=function(){a.drawImage(h,d,e,f,g);URL.revokeObjectURL(b)}};d.prototype._attachSizeRampToNode=function(a){var b=a["data-layer-opacity"];null!=b&&(a.style.opacity=b.toString());var b=a["data-legend-element"].infos,c=b[0],d=b[b.length-1],e=c.symbol,f=d.symbol,g="picture-marker"===e.type;e?-1<e.type.indexOf("3d")?(b=e.symbolLayers&&e.symbolLayers.length)?
(b=e.symbolLayers.getItemAt(b-1).get("resource.primitive"),b="triangle"===b||"cone"===b||"tetrahedron"===b):b=void 0:b="triangle"===e.style:b=void 0;var h;e?-1<e.type.indexOf("3d")?(h=e.symbolLayers&&e.symbolLayers.length)?(h=e.symbolLayers.getItemAt(h-1),h=h.resource&&h.resource.primitive,h="circle"===h||"cross"===h||"kite"===h||"sphere"===h||"cube"===h||"diamond"===h):h=void 0:(h=e.style,h="circle"===h||"diamond"===h||"cross"===h):h=void 0;var k,m;g?(k=e.url,m=f.url):(c.preview&&(k=new Blob([c.preview.innerHTML],
{type:"image/svg+xml"}),k=URL.createObjectURL(k)),d.preview&&(m=new Blob([d.preview.innerHTML],{type:"image/svg+xml"}),m=URL.createObjectURL(m)));var n=l.pt2px(c.size+c.outlineSize)*y,e=l.pt2px(d.size+d.outlineSize)*y,f=this._hasIndicators?n:n+100*y,g=this._hasIndicators?f+50*y:n,c=document.createElement("canvas");c.width=f;c.height=g;c.style.width=c.width/y+"px";c.style.height=c.height/y+"px";d=c.getContext("2d");this._hasIndicators?(this._drawImageOnSizeRamp(d,k,{x:0,y:0,width:n,height:n}),this._drawImageOnSizeRamp(d,
m,{x:f/2-e/2,y:g-e,width:e,height:e}),d.beginPath(),k=f/2-e/2,m=g-(b?0:h?e/2:e),d.moveTo(0,h?f/2:f),d.lineTo(k,m),k=f/2+e/2,b=g-(b?0:h?e/2:e),d.moveTo(f,h?f/2:f),d.lineTo(k,b)):(this._drawImageOnSizeRamp(d,k,{x:f-n,y:0,width:n,height:n}),this._drawImageOnSizeRamp(d,m,{x:0,y:g/2-e/2,width:e,height:e}),d.beginPath(),k=f-(h||b?n/2:n),d.moveTo(e-(h||b?e/2:0),g/2-e/2),d.lineTo(k,0),b=f-(h?n/2:n),d.moveTo(e-(h?e/2:0),g/2+e/2),d.lineTo(b,g));d.strokeStyle="#ddd";d.stroke();a.appendChild(c)};d.prototype._renderSizeRamps=
function(a,b){var c,d=a.infos,e=d[0].label,d=d[d.length-1].label;return u.tsx("div",{class:this.classes("esri-legend--card__layer-row",(c={},c["esri-legend--card__size-ramp-row"]=this._hasIndicators,c))},u.tsx("div",{class:"esri-legend--card__ramp-label"},this._hasIndicators?e:d),u.tsx("div",{class:"esri-legend--card__size-ramp-container"},u.tsx("div",{bind:this,"data-layer-opacity":b,"data-legend-element":a,afterCreate:this._attachSizeRampToNode})),u.tsx("div",{class:"esri-legend--card__ramp-label"},
this._hasIndicators?d:e))};d.prototype._renderLegendForRamp=function(a,b){var c=a.infos,d="heatmap-ramp"===a.type,e=c.length-1;a=2<e&&!d?25*e:100;var f=a+20,g=c.slice(0).reverse();g.forEach(function(a,b){a.offset=d?a.ratio:b/e});var h=g.length-1,k=0!==g.length%2&&g[g.length/2|0],k=k&&u.tsx("div",{class:"esri-legend--card__interval-separators-container"},u.tsx("div",{class:"esri-legend--card__interval-separator"},"|"),u.tsx("div",{class:"esri-legend--card__ramp-label"},k.label)),l=c[c.length-1].label,
c=c[0].label,m=null;null!=b&&(m="opacity: "+b);b=n.renderSVG([[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:g[0].color,stroke:{width:0}},{shape:{type:"rect",x:10,y:0,width:a,height:25},fill:{type:"linear",x1:10,y1:0,x2:a+10,y2:0,colors:g},stroke:{width:0}},{shape:{type:"path",path:"M"+(a+10)+" 0 L"+f+" 12.5 L"+(a+10)+" 25 Z"},fill:g[h].color,stroke:{width:0}}]],f,25);return u.tsx("div",{class:"esri-legend--card__layer-row"},u.tsx("div",{class:"esri-legend--card__ramp-label"},d?q[l]:l),
u.tsx("div",{class:"esri-legend--card__symbol-container"},u.tsx("div",{style:m},b),k),u.tsx("div",{class:"esri-legend--card__ramp-label"},d?q[c]:c))};h([u.renderable(),k.property()],d.prototype,"activeLayerInfos",void 0);h([k.property()],d.prototype,"layout",void 0);h([k.property({readOnly:!0})],d.prototype,"type",void 0);h([k.property()],d.prototype,"view",void 0);h([u.accessibleHandler()],d.prototype,"_selectSection",null);return d=h([k.subclass("esri.widgets.Legend.styles.Card")],d)}(k.declared(r))})},
"esri/widgets/Legend/styles/support/utils":function(){define(["require","exports","../../../../symbols/support/svgUtils","../../../support/widget"],function(b,d,f,h){function e(a,b,d){var c=d+"_arrowStart";d+="_arrowEnd";a="left"===a;var e={markerStart:null,markerEnd:null};switch(b){case "HL":a?e.markerStart="url(#"+d+")":e.markerEnd="url(#"+c+")";break;case "LL":e.markerStart="url(#"+d+")";break;case "LH":a?e.markerEnd="url(#"+c+")":e.markerStart="url(#"+d+")";break;default:e.markerEnd="url(#"+c+
")"}return e}Object.defineProperty(d,"__esModule",{value:!0});d.renderRelationshipRamp=function(a,b,d){var c=a.labels,l=!!a.focus,k=void 0;void 0===k&&(k=60);var m=a.focus,q=a.numClasses,g=a.colors,x=a.rotation;a=!!m;var t=Math.sqrt(Math.pow(k,2)+Math.pow(k,2))+(a?0:5),u=null;null!=d&&(u="opacity: "+d);d=[];for(var y=[],A=[],p=(k||75)/q,w=0;w<q;w++)for(var v=w*p,z=0;z<q;z++){var B=z*p,C=f.generateFillAttributes(g[w][z]),D=f.generateStrokeAttributes(null),B={type:"rect",x:B,y:v,width:p,height:p};d.push(f.renderDef(C));
y.push(f.renderShape(B,C.fill,D,null));A.push(f.getBoundingBox(B))}q=null;a||(q="margin: -15px -15px -18px -15px");g=e("left",m,b);m=e("right",m,b);A=f.computeBBox(A);x=f.getTransformMatrix(A,t,t,0,!1,x);A=f.getTransformMatrix(A,t,t,0,!1,a?-45:null);b=h.tsx("div",{style:u,class:a?"esri-relationship-ramp--diamond__middle-column--ramp":"esri-relationship-ramp--square__table-cell"},h.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,style:q},h.tsx("defs",null,h.tsx("marker",{id:b+"_arrowStart",
markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},h.tsx("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),h.tsx("marker",{id:b+"_arrowEnd",markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},h.tsx("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),d),h.tsx("g",{transform:x},y),h.tsx("g",{transform:A},h.tsx("line",{fill:"none",stroke:"#555555","stroke-width":"1",
"marker-start":g.markerStart,"marker-end":g.markerEnd,x1:-10,y1:k-15,x2:-10,y2:15}),h.tsx("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":m.markerStart,"marker-end":m.markerEnd,x1:15,y1:k+10,x2:k-15,y2:k+10}))));return l?h.tsx("div",{class:"esri-relationship-ramp--diamond__container"},h.tsx("div",{class:"esri-relationship-ramp--diamond__left-column"},c.left),h.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column"},h.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},
c.top),b,h.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},c.bottom)),h.tsx("div",{class:"esri-relationship-ramp--diamond__right-column"},c.right)):h.tsx("div",{class:"esri-relationship-ramp--square__table"},h.tsx("div",{class:"esri-relationship-ramp--square__table-row"},h.tsx("div",{class:h.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--right-bottom")},c.left),h.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),
h.tsx("div",{class:h.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--left-bottom")},c.top)),h.tsx("div",{class:"esri-relationship-ramp--square__table-row"},h.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),b,h.tsx("div",{class:"esri-relationship-ramp--square__table-cell"})),h.tsx("div",{class:"esri-relationship-ramp--square__table-row"},h.tsx("div",{class:h.classes("esri-relationship-ramp--square__table-cell",
"esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--right-top")},c.bottom),h.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),h.tsx("div",{class:h.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--left-top")},c.right)))}})},"esri/widgets/Legend/support/styleUtils":function(){define(["require","exports","dojo/i18n!../../Legend/nls/Legend","../../../intl"],
function(b,d,f,h){Object.defineProperty(d,"__esModule",{value:!0});d.attachToNode=function(b){b.appendChild(this)};d.getTitle=function(b,a){if(b){if("string"===typeof b)return b;if("value"in b||"unit"in b)return h.substitute(f.dotValue,b);if("colorName"in b||"bandName"in b)return f[b.colorName]+": "+(f[b.bandName]||b.bandName);var d=null;a?d=b.ratioPercentTotal?"showRatioPercentTotal":b.ratioPercent?"showRatioPercent":b.ratio?"showRatio":b.normField?"showNormField":b.field?"showField":null:a||(d=
b.normField?"showNormField":b.normByPct?"showNormPct":b.field?"showField":null);return d?h.substitute("showField"===d?"{field}":f[d],{field:b.field,normField:b.normField}):null}};d.isRendererTitle=function(b,a){return!a};d.isImageryStretchedLegend=function(b,a){return!!(a&&"Stretched"===a&&10.3<=b.version&&"esri.layers.ImageryLayer"===b.declaredClass)}})},"esri/widgets/support/colorUtils":function(){define(["require","exports","../../Color"],function(b,d,f){function h(a){return new f(a)}function e(a){return!!a&&
4===a.length&&k.test(a)}function a(a){return!!a&&7===a.length&&n.test(a)}function q(a){return 127<=.299*a.r+.587*a.g+.114*a.b}function m(a,b){void 0===b&&(b=1);b=Math.pow(.7,b);return new f([Math.round(a.r*b),Math.round(a.g*b),Math.round(a.b*b),a.a])}function c(a,b){void 0===b&&(b=1);b=Math.pow(.7,b);var c=a.r,d=a.g,e=a.b;30>c&&(c=30);30>d&&(d=30);30>e&&(e=30);return new f([Math.min(255,Math.round(c/b)),Math.min(255,Math.round(d/b)),Math.min(255,Math.round(e/b)),a.a])}function l(a,b){var c=a.r,d=
a.g,e=a.b;a=a.a;1>a&&(c=Math.round(a*c+(1-a)*b.r),d=Math.round(a*d+(1-a)*b.g),e=Math.round(a*e+(1-a)*b.b));return new f({r:c,g:d,b:e})}Object.defineProperty(d,"__esModule",{value:!0});var k=/^#[0-9A-F]{3}$/i,n=/^#[0-9A-F]{6}$/i,r=new f({r:255,g:255,b:255});d.equal=function(a,b){return a&&b&&a.r===b.r&&a.g===b.g&&a.b===b.b&&a.a===b.a};d.normalizeHex=function(a){return a?"#"+a.trim().replace(/#/g,"").substr(0,6):""};d.normalizeColor=h;d.isValidHex=function(b){return e(b)||a(b)};d.isShorthandHex=e;d.isLonghandHex=
a;d.toHex=function(a){return h(a).toHex()};d.getContrastingColor=function(a){return q(a)?m(a):c(a,3)};d.isBright=q;d.darker=m;d.brighter=c;d.blendWithBackground=l;d.getColorTheme=function(a,b){void 0===b&&(b=r);a=l(a,b);return q(a)?"light":"dark"}})},"esri/widgets/Legend/styles/Classic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/i18n!../../Legend/nls/Legend ../../../intl ../../../core/accessorSupport/decorators ../../Widget ./support/utils ../support/styleUtils ../../support/widget".split(" "),
function(b,d,f,h,e,a,q,m,c,l,k){return function(b){function d(a){a=b.call(this,a)||this;a.activeLayerInfos=null;a.type="classic";return a}f(d,b);d.prototype.render=function(){var a=this,b=this.activeLayerInfos,c=this.classes("esri-legend esri-widget--panel","esri-widget"),b=b&&b.toArray().map(function(b){return a._renderLegendForLayer(b)}).filter(function(a){return!!a});return k.tsx("div",{class:c},b&&b.length?b:k.tsx("div",{class:"esri-legend__message"},e.noLegend))};d.prototype._renderLegendForLayer=
function(a){var b=this,c;if(!a.ready)return null;var d=!!a.children.length,e="esri-legend__"+a.layer.uid+"-version-"+a.version,f=a.title?k.tsx("h3",{class:this.classes("esri-widget__heading","esri-legend__service-label")},a.title):null;if(d)return c=a.children.map(function(a){return b._renderLegendForLayer(a)}).toArray(),k.tsx("div",{key:e,class:this.classes("esri-legend__service","esri-legend__group-layer")},f,c);if((d=a.legendElements)&&!d.length)return null;d=d.map(function(c){return b._renderLegendForElement(c,
a.layer)}).filter(function(a){return!!a});if(!d.length)return null;var g=(c={},c["esri-legend__group-layer-child"]=!!a.parent,c);return k.tsx("div",{key:e,class:this.classes("esri-legend__service",g)},f,k.tsx("div",{class:"esri-legend__layer"},d))};d.prototype._renderLegendForElement=function(a,b,d){var e=this,f,g="color-ramp"===a.type,h="opacity-ramp"===a.type,m="size-ramp"===a.type,n=null;if("symbol-table"===a.type||m){var q=a.infos.map(function(c){return e._renderLegendForElementInfo(c,b,m,a.legendType)}).filter(function(a){return!!a});
q.length&&(n=k.tsx("div",{class:"esri-legend__layer-body"},q))}else"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type||"stretch-ramp"===a.type?n=this._renderLegendForRamp(a,b.opacity):"relationship-ramp"===a.type&&(n=c.renderRelationshipRamp(a,this.id,b.opacity));if(!n)return null;var q=a.title,r=null;"string"===typeof q?r=q:q&&(r=l.getTitle(q,g||h),r=l.isRendererTitle(q,g||h)&&q.title?q.title+" ("+r+")":r);g=d?"esri-legend__layer-child-table":"esri-legend__layer-table";h=r?k.tsx("div",
{class:"esri-legend__layer-caption"},r):null;d=(f={},f["esri-legend__layer-table--size-ramp"]=m||!d,f);return k.tsx("div",{class:this.classes(g,d)},h,n)};d.prototype._renderLegendForRamp=function(a,b){var c=this,d=a.infos,f="heatmap-ramp"===a.type,g="stretch-ramp"===a.type,h=a.preview;h.className="esri-legend__color-ramp "+("opacity-ramp"===a.type?"esri-legend__opacity-ramp":"");null!=b&&(h.style.opacity=b.toString());a=d.map(function(a){return k.tsx("div",{class:a.label?"esri-legend__ramp-label":
null},f?e[a.label]:g?c._getStretchStopLabel(a):a.label)});b={height:h.style.height};return k.tsx("div",{class:"esri-legend__layer-row"},k.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--symbols",styles:{width:"24px"}},k.tsx("div",{class:"esri-legend__ramps",bind:h,afterCreate:l.attachToNode})),k.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--info"},k.tsx("div",{class:"esri-legend__ramp-labels",styles:b},a)))};d.prototype._getStretchStopLabel=function(b){return b.label?
e[b.label]+": "+a.formatNumber(b.value,{style:"decimal"}):""};d.prototype._renderLegendForElementInfo=function(a,b,c,d){var e,f;if(a.type)return this._renderLegendForElement(a,b,!0);var g=null;d=l.isImageryStretchedLegend(b,d);a.symbol&&a.preview?g=k.tsx("div",{class:"esri-legend__symbol",bind:a.preview,afterCreate:l.attachToNode}):a.src&&(g=this._renderImage(a,b,d));if(!g)return null;b=(e={},e["esri-legend__imagery-layer-info--stretched"]=d,e);c=(f={},f["esri-legend__imagery-layer-info--stretched"]=
d,f["esri-legend__size-ramp"]=!d&&c,f);return k.tsx("div",{class:"esri-legend__layer-row"},k.tsx("div",{class:this.classes("esri-legend__layer-cell esri-legend__layer-cell--symbols",c)},g),k.tsx("div",{class:this.classes("esri-legend__layer-cell esri-legend__layer-cell--info",b)},l.getTitle(a.label,!1)||""))};d.prototype._renderImage=function(a,b,c){var d,e=a.label,f=a.src,g=a.opacity;c=(d={},d["esri-legend__imagery-layer-image--stretched"]=c,d["esri-legend__symbol"]=!c,d);b={opacity:""+(null!=g?
g:b.opacity)};return k.tsx("img",{alt:l.getTitle(e,!1),src:f,border:0,width:a.width,height:a.height,class:this.classes(c),styles:b})};h([k.renderable(),q.property()],d.prototype,"activeLayerInfos",void 0);h([q.property({readOnly:!0})],d.prototype,"type",void 0);return d=h([q.subclass("esri.widgets.Legend.styles.Classic")],d)}(q.declared(m))})},"widgets/Legend/_build-generate_module":function(){define(["dojo/i18n!./nls/strings"],function(){})},"*now":function(b){b(['dojo/i18n!*preload*widgets/Legend/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","uk","zh-hk","zh-tw","ROOT"]'])}}});
define(["dojo/_base/declare","jimu/BaseWidget","esri/widgets/Legend"],function(b,d,f){return b([d],{name:"Legend",baseClass:"jimu-widget-legend",templateString:"\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d'legendDiv'\x3e\x3c/div\x3e\x3c/div\x3e",postCreate:function(){this.inherited(arguments);this.legend=new f({container:this.legendDiv,view:this.sceneView})},destroy:function(){this.legend&&this.legend.destroy();this.inherited(arguments)}})});