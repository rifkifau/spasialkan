// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/BasemapGallery":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./BasemapGallery/nls/BasemapGallery ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./BasemapGallery/BasemapGalleryViewModel ./support/widget".split(" "),function(r,u,l,a,v,p,n,c,t,k,b){var h=r.toUrl("../themes/base/images/basemap-toggle-64.svg");return function(m){function f(e){e=m.call(this,e)||this;e._handles=
new p;e.activeBasemap=null;e.disabled=!1;e.iconClass="esri-icon-basemap";e.label=v.widgetLabel;e.source=null;e.view=null;e.viewModel=new k;return e}l(f,m);f.prototype.postInitialize=function(){var e=this,a=this._handles;this.own([n.on(this,"viewModel.items","change",function(d){var b=d.added;d=d.moved;a.remove("basemap-gallery-item-changes");a.add(b.concat(d).map(function(a){return a.watch("state",function(){return e.scheduleRender()})}),"basemap-gallery-item-changes");e.scheduleRender()}),a,n.whenOnce(this,
"source",function(){return e.viewModel.load()})])};f.prototype.render=function(){var e,a="loading"===this.get("source.state"),d=this.disabled||"disabled"===this.get("viewModel.state"),f=this.get("viewModel.items").toArray().map(this._renderBasemapGalleryItem,this),d=(e={},e["esri-basemap-gallery--source-loading"]=a,e["esri-disabled"]=d,e);e=a?b.tsx("div",{class:"esri-basemap-gallery__loader",key:"esri-basemap-gallery__loader"}):null;a=a?null:0<f.length?b.tsx("ul",{class:"esri-basemap-gallery__item-container",
key:"esri-basemap-gallery__item-container",role:"menu"},f):b.tsx("div",{class:"esri-widget__content--empty",key:"esri-basemap-gallery__empty-message"},b.tsx("h2",{class:"esri-widget__heading"},v.noBasemaps));return b.tsx("div",{class:this.classes("esri-basemap-gallery esri-widget esri-widget--panel-height-only",d)},e,a)};f.prototype._handleClick=function(a){a=a.currentTarget["data-item"];"ready"===a.state&&(this.activeBasemap=a.basemap)};f.prototype._renderBasemapGalleryItem=function(a){var e,d=a.get("basemap.thumbnailUrl")||
h,f=a.get("basemap.title"),g=a.get("basemap.portalItem.snippet"),g=a.get("error.message")||g||f,q=this.viewModel,m=this.disabled||"ready"!==q.state||"ready"!==a.state?-1:0,q=q.basemapEquals(a.basemap,this.activeBasemap),c=(e={},e["esri-basemap-gallery__item--selected"]=q,e["esri-basemap-gallery__item--loading"]="loading"===a.state,e["esri-basemap-gallery__item--error"]="error"===a.state,e);return b.tsx("li",{"aria-selected":q,bind:this,class:this.classes("esri-basemap-gallery__item",c),"data-item":a,
onkeydown:this._handleClick,onclick:this._handleClick,role:"menuitem",tabIndex:m,title:g},b.tsx("img",{alt:"",class:"esri-basemap-gallery__item-thumbnail",src:d}),b.tsx("div",{class:"esri-basemap-gallery__item-title"},f))};a([c.aliasOf("viewModel.activeBasemap"),b.renderable()],f.prototype,"activeBasemap",void 0);a([c.property(),b.renderable()],f.prototype,"disabled",void 0);a([c.property()],f.prototype,"iconClass",void 0);a([c.property()],f.prototype,"label",void 0);a([c.aliasOf("viewModel.source"),
b.renderable("source.state")],f.prototype,"source",void 0);a([c.aliasOf("viewModel.view"),b.renderable()],f.prototype,"view",void 0);a([c.property(),b.renderable(["viewModel.state"])],f.prototype,"viewModel",void 0);a([b.accessibleHandler()],f.prototype,"_handleClick",null);return f=a([c.subclass("esri.widgets.BasemapGallery")],f)}(c.declared(t))})},"esri/widgets/BasemapGallery/BasemapGalleryViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/Handles ../../core/Loadable ../../core/Loadable ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../support/basemapUtils ./support/basemapCompatibilityUtils ./support/BasemapGalleryItem ./support/LocalBasemapsSource ./support/PortalBasemapsSource".split(" "),
function(r,u,l,a,v,p,n,c,t,k,b,h,m,f,e,w){var d=v.ofType(f);return function(c){function g(a){a=c.call(this,a)||this;a._handles=new p;a.activeBasemap=null;a.items=new d;a.source=new w;a.view=null;return a}l(g,c);g.prototype.initialize=function(){var a=this;this._handles.add([k.init(this,["compatibilityFunction","state"],function(){return a._updateItems()}),k.on(this,"source.basemaps","change",function(){return a._updateItems()})])};g.prototype.destroy=function(){this._handles.destroy();this._handles=
null};Object.defineProperty(g.prototype,"compatibilityFunction",{get:function(){return void 0===this._get("compatibilityFunction")?"3d"===this.get("view.type")?m.default3DCompatibility:m.default2DCompatibility:this._get("compatibilityFunction")},set:function(a){this._set("compatibilityFunction",a)},enumerable:!0,configurable:!0});g.prototype.castSource=function(a){return Array.isArray(a)||v.isCollection(a)?new e({basemaps:a}):a&&"esri.portal.Portal"===a.declaredClass?new w({portal:a}):!a||a instanceof
w||!a.portal&&!a.query?a&&"basemaps"in a&&"state"in a&&"refresh"in a?a:null:new w(a)};Object.defineProperty(g.prototype,"state",{get:function(){return this.get("view.ready")&&this.source?"ready":"disabled"},enumerable:!0,configurable:!0});g.prototype.basemapEquals=function(a,e){return h.contentEquals(a,e)};g.prototype.refresh=function(){this._updateItems()};g.prototype.load=function(a){this.addResolvingPromise(n.isLoadable(this.source)?this.source.load(a):t.resolve());return t.resolve(this)};g.prototype._updateItems=
function(){var a=this.get("source.basemaps"),e=this.view,d=this.compatibilityFunction;this.items.removeAll().forEach(function(a){return a.destroy()});this.items.addMany(a.map(function(a){return new f({basemap:a,compatibilityFunction:d,view:e})}))};a([b.property({aliasOf:"view.map.basemap"})],g.prototype,"activeBasemap",void 0);a([b.property({dependsOn:["view.type"]})],g.prototype,"compatibilityFunction",null);a([b.property({readOnly:!0,type:d})],g.prototype,"items",void 0);a([b.property()],g.prototype,
"source",void 0);a([b.cast("source")],g.prototype,"castSource",null);a([b.property({readOnly:!0,dependsOn:["view.ready"]})],g.prototype,"state",null);a([b.property()],g.prototype,"view",void 0);return g=a([b.subclass("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],g)}(b.declared(c))})},"esri/widgets/BasemapGallery/support/basemapCompatibilityUtils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/compilerUtils ../../../core/Error ../../../core/promiseUtils ../../../layers/support/layerUtils ../../../views/3d/terrain/terrainUtils ../../../views/3d/terrain/TilingScheme ../../../views/support/spatialReferenceSupport".split(" "),
function(r,u,l,a,v,p,n,c,t,k,b){function h(){throw new p("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view");}function m(e,m){return a(this,void 0,void 0,function(){var a,c,g,h,w,n,z,A,r,u,B;return l(this,function(d){switch(d.label){case 0:return a=e.basemap,c=e.view,[4,a.load(m)];case 1:d.sent();if(0===a.baseLayers.length)return[2,void 0];g=a.baseLayers.concat(a.referenceLayers);h=f(g);if(h.length)throw h[0];w=v.typeCast(a.baseLayers.getItemAt(0))();
d.label=2;case 2:return d.trys.push([2,4,,5]),[4,w.load(m)];case 3:return d.sent(),[3,5];case 4:throw n=d.sent(),z=n.name,A=void 0===z?"basemap-compatibility:unknown-error":z,r=n.message,u=void 0===r?"Unknown basemap compatibility error":r,B=n.details,new p(A,u,B);case 5:d=w;var l=c,q=d.tileInfo;if(q){var y=l.get("viewingMode");if(y){if(!b.isSpatialReferenceSupported(q.spatialReference,y))throw new p("basemapgalleryitem:spatial-reference-unsupported-"+y,"Basemap spatial reference is unsupported in "+
y+" mode");if("global"===y){var x=t.checkIfTileInfoSupportedForView(q,d.fullExtent,null,y);x&&d.compatibleTileInfo256&&!t.checkIfTileInfoSupportedForView(d.compatibleTileInfo256,d.fullExtent,null,y)&&(x=null);if(x)throw new p("basemapgalleryitem:tiling-scheme-unsupported-"+(q.spatialReference.isWebMercator?"web-mercator":"wgs84")+"-global","Basemap tiling scheme is unsupported in global mode",{error:x});}else if(k.checkUnsupported(q))throw new p("basemapgalleryitem:tiling-scheme-unsupported-local",
"Basemap tiling scheme is unsupported in local mode");l=l.get("basemapTerrain.tilingScheme");if(!(!l||l.compatibleWith(q)||d.compatibleTileInfo256&&l.compatibleWith(d.compatibleTileInfo256)))throw new p("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");}}return[2]}})})}function f(a){var e=["ArcGISTiledImageServiceLayer","ArcGISTiledMapServiceLayer","OpenStreetMap","VectorTileLayer","WebTiledLayer"];return a.toArray().filter(function(a){return-1===
e.indexOf(a.operationalLayerType)}).map(function(a){return new p("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:a,operationalLayerType:a.operationalLayerType||"unknown"})})}Object.defineProperty(u,"__esModule",{value:!0});u.default3DCompatibility=function(e,b){void 0===b&&(b={});return a(this,void 0,void 0,function(){return l(this,function(a){switch(a.label){case 0:return[4,m(e,b)];case 1:return a.sent(),n.throwIfAborted(b),[2]}})})};
u.default2DCompatibility=function(e,b){void 0===b&&(b={});return a(this,void 0,void 0,function(){var a,f,m,k;return l(this,function(d){switch(d.label){case 0:return a=e.basemap,f=e.view,[4,a.load(b)];case 1:d.sent();n.throwIfAborted(b);if(0===a.baseLayers.length)return[2,void 0];m=a.baseLayers.getItemAt(0);if(!c.isTiledLayer(m))return[2,void 0];if(a.spatialReference){if(f.spatialReference.equals(a.spatialReference))return[2,void 0];h()}return[4,m.load(b)];case 2:d.sent();n.throwIfAborted(b);k=(m.get("supportedSpatialReferences")||
[m.get("tileInfo.spatialReference")]).filter(Boolean);if(0===k.length)return[2,void 0];k.every(function(a){return!f.spatialReference.equals(a)})&&h();return[2,void 0]}})})}})},"esri/widgets/BasemapGallery/support/BasemapGalleryItem":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper @dojo/framework/shim/AbortController ../../../core/Accessor ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators".split(" "),
function(r,u,l,a,v,p,n,c,t,k){return function(b){function h(a){a=b.call(this,a)||this;a._handles=new n;a.compatibilityFunction=null;a.error=null;a.state="loading";a.view=null;return a}l(h,b);h.prototype.initialize=function(){var a=this;this._handles.add(t.init(this,["basemap.loadStatus","compatibilityFunction","view.basemapTerrain?.tilingScheme","view.ready","view.spatialReference"],function(){return a.refresh()}))};h.prototype.destroy=function(){this._cancelCompatibilityCheck();this._handles.destroy();
this.view=this.compatibilityFunction=this.basemap=this._handles=null};Object.defineProperty(h.prototype,"basemap",{set:function(a){var b=this._get("basemap");b&&b.cancelLoad();a&&a.load().catch(function(){});this._set("basemap",a)},enumerable:!0,configurable:!0});h.prototype.refresh=function(){var a=this;this._cancelCompatibilityCheck();this._set("state","loading");var b=this.get("basemap.loadStatus");if("loaded"===b||"failed"===b)this.compatibilityFunction?(b=new v.default,this.compatibilityFunction(this,
{signal:b.signal}).then(function(){a._set("state","ready");a._set("error",null)}).catch(function(b){c.isAbortError(b)||(a._set("state","error"),a._set("error",b))}),this._lastCompatibilityCheckController=b):"loaded"===b?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError))};h.prototype._cancelCompatibilityCheck=function(){this._lastCompatibilityCheckController&&(this._lastCompatibilityCheckController.abort(),this._lastCompatibilityCheckController=
null)};a([k.property()],h.prototype,"basemap",null);a([k.property()],h.prototype,"compatibilityFunction",void 0);a([k.property({readOnly:!0})],h.prototype,"error",void 0);a([k.property({readOnly:!0})],h.prototype,"state",void 0);a([k.property()],h.prototype,"view",void 0);return h=a([k.subclass("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],h)}(k.declared(p))})},"esri/widgets/BasemapGallery/support/LocalBasemapsSource":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Basemap ../../../core/Accessor ../../../core/Collection ../../../core/accessorSupport/decorators".split(" "),
function(r,u,l,a,v,p,n,c){var t=n.ofType(v);return function(k){function b(a){a=k.call(this,a)||this;a.basemaps=new t;return a}l(b,k);Object.defineProperty(b.prototype,"state",{get:function(){return"ready"},enumerable:!0,configurable:!0});b.prototype.refresh=function(){};a([c.property({type:t})],b.prototype,"basemaps",void 0);a([c.property({readOnly:!0})],b.prototype,"state",null);return b=a([c.subclass("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],b)}(c.declared(p))})},"esri/widgets/BasemapGallery/support/PortalBasemapsSource":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/AbortController ../../../Basemap ../../../core/Collection ../../../core/Error ../../../core/Handles ../../../core/Loadable ../../../core/Logger ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../portal/Portal ./LocalBasemapsSource".split(" "),
function(r,u,l,a,v,p,n,c,t,k,b,h,m,f,e,w,d,x,g){var q=t.ofType(c),C=m.getLogger("esri.widgets.BasemapGallery.support.PortalBasemapsSource");return function(f){function c(a){a=f.call(this,a)||this;a._handles=new b;a.basemaps=new q;a.filterFunction=null;a.portal=x.getDefault();a.query=null;a.updateBasemapsCallback=null;return a}l(c,f);c.prototype.initialize=function(){var a=this;this._handles.add([w.init(this,"filterFunction loadStatus portal.basemapGalleryGroupQuery portal.user query updateBasemapsCallback".split(" "),
function(){return a.refresh()})])};c.prototype.destroy=function(){this._handles.destroy();this.portal=this.filterFunction=this._handles=null};Object.defineProperty(c.prototype,"state",{get:function(){return"not-loaded"===this.loadStatus?"not-loaded":"loading"===this.loadStatus||this._lastPortalBasemapFetchController?"loading":"ready"},enumerable:!0,configurable:!0});c.prototype.load=function(a){this.addResolvingPromise(this.portal.load(a));this.notifyChange("state");return e.resolve(this)};c.prototype.refresh=
function(){return p(this,void 0,void 0,function(){var a,b,c,d;return v(this,function(f){switch(f.label){case 0:if("ready"!==this.state)return[2];this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);a=this.portal;this._lastPortalBasemapFetchController=b=new n.default;this.notifyChange("state");f.label=1;case 1:return f.trys.push([1,3,,4]),[4,a.fetchBasemaps(this._toQueryString(this.query),b)];case 2:return c=f.sent(),this._updateBasemaps(c),
[3,4];case 3:d=f.sent();if(e.isAbortError(d))throw d;C.warn(new k("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:d}));this._updateBasemaps();return[3,4];case 4:return this._lastPortalBasemapFetchController=null,this.notifyChange("state"),[2]}})})};c.prototype._toQueryString=function(a){return a&&"string"!==typeof a?Object.keys(a).map(function(b){return b+":"+a[b]}).join(" AND "):a};c.prototype._updateBasemaps=function(a){void 0===a&&(a=[]);a=this.filterFunction?
a.filter(this.filterFunction):a;a=this.updateBasemapsCallback?this.updateBasemapsCallback(a):a;this.basemaps.removeAll();this.basemaps.addMany(a)};a([d.property({readOnly:!0,type:q})],c.prototype,"basemaps",void 0);a([d.property()],c.prototype,"filterFunction",void 0);a([d.property({type:x})],c.prototype,"portal",void 0);a([d.property()],c.prototype,"query",void 0);a([d.property({dependsOn:["loadStatus"],readOnly:!0})],c.prototype,"state",null);a([d.property()],c.prototype,"updateBasemapsCallback",
void 0);return c=a([d.subclass("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],c)}(d.declared(h.LoadableMixin(f.EsriPromiseMixin(g))))})},"widgets/BasemapGallery/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/BasemapGallery/Widget.html":"\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d'basemapGalleryNode'\x3e\x3c/div\x3e\r\n\x3c/div\x3e","url:widgets/BasemapGallery/css/style.css":".jimu-widget-basemap-gallery{width: 100%; height: 100%;}.jimu-widget-basemap-gallery .esri-basemap-gallery.esri-widget{width: 100%; height: 100%; max-height: 100%; background-color: transparent;}.jimu-widget-basemap-gallery .esri-basemap-gallery {max-width: none;}",
"*now":function(r){r(['dojo/i18n!*preload*widgets/BasemapGallery/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","uk","zh-hk","zh-tw","ROOT"]'])}}});
define(["dojo/_base/declare","jimu/BaseWidget","esri/widgets/BasemapGallery","esri/widgets/BasemapGallery/BasemapGalleryViewModel"],function(r,u,l,a){return r([u],{name:"BasemapGallery",baseClass:"jimu-widget-basemap-gallery",postCreate:function(){this.inherited(arguments)},startup:function(){this.basemapGallery=new l({container:this.basemapGalleryNode,viewModel:new a({view:this.sceneView})});this.basemapGallery.render()},destroy:function(){this.basemapGallery&&this.basemapGallery.destroy();this.inherited(arguments)}})});