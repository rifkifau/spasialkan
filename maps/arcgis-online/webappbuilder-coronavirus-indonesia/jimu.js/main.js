// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
/*
 Chen, Yi-Cyuan 2015-2017
 @license MIT
*/
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./dijit/AGOLLoading ./portalUtils esri/config esri/tasks/GeometryService".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d){function u(a,d){var b=f.clone(a),g=k.widgetProperties;"undefined"===typeof d&&(d=!1);delete b.mode;delete b.configWabVersion;k.visitElement(b,
function(a,e){a.widgets?(delete a.isOnScreen,delete a.gid,"jimu.js/images/group_icon.png"===a.icon&&delete a.icon,delete a.openType,e.isOnScreen&&a.panel&&k.isEqual(a.panel,b.widgetOnScreen.panel)&&delete a.panel):(a.icon&&a.icon===a.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete a.icon,delete a.panel,delete a.folderUrl,delete a.amdFolder,delete a.thumbnail,delete a.configFile,delete a.gid,delete a.isOnScreen,delete a.isRemote,delete a.featureActions,g.forEach(function(d){delete a[d]}),
d?"undefined"===typeof a.openAtStart&&(a.openAtStart=!1):(a.visible&&delete a.visible,a.manifest&&a.label===a.manifest.label&&delete a.label,a.isDefaultConfig&&(delete a.config,delete a.isDefaultConfig)),delete a.manifest,a.itemId&&delete a.uri)});delete b.rawAppConfig;delete b._ssl;delete b.getConfigElementById;delete b.getConfigElementsByName;delete b.processNoUriWidgets;delete b.addElementId;delete b.getCleanConfig;delete b.visitElement;delete b.agolConfig;delete b._itemData;delete b.oldWabVersion;
delete b.titleColor;return b}var v=null,B;B=r(null,{urlParams:null,appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a){this.urlParams=a||{};this.listenBuilderEvents();this.versionManager=new t;this.widgetManager=h.getInstance();this.configLoader=e.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&f.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(c);
"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&f.isFunction(window.parent.setPreviewViewerTopic)&&window.parent.setPreviewViewerTopic(c);k.isMobileUa()||n(window,"resize",f.hitch(this,this._onWindowResize));n(window,"orientationchange",f.hitch(this,this._onOrientationChange))},listenBuilderEvents:function(){c.subscribe("builder/widgetChanged",f.hitch(this,this._onWidgetChanged));c.subscribe("builder/groupChanged",f.hitch(this,this._onGroupChanged));c.subscribe("builder/layoutDefinitionChanged",
f.hitch(this,this._onLayoutDefinitionChanged));c.subscribe("builder/onScreenGroupsChanged",f.hitch(this,this._onOnScreenGroupsChanged));c.subscribe("builder/widgetPoolChanged",f.hitch(this,this._onWidgetPoolChanged));c.subscribe("builder/openAtStartChange",f.hitch(this,this._onOpenAtStartChanged));c.subscribe("builder/onScreenOrderChanged",f.hitch(this,this._onScreenOrderChanged));c.subscribe("builder/mapContentModified",f.hitch(this,this._onMapContentModified));c.subscribe("builder/mapChanged",f.hitch(this,
this._onMapChanged));c.subscribe("builder/mapOptionsChanged",f.hitch(this,this._onMapOptionsChanged));c.subscribe("builder/mapRefreshIntervalChanged",f.hitch(this,this._onMapRefreshIntervalChanged));c.subscribe("builder/appAttributeChanged",f.hitch(this,this._onAppAttributeChanged));c.subscribe("builder/dataSourceChanged",f.hitch(this,this._onDataSourceChanged));c.subscribe("builder/setAppConfig",f.hitch(this,this._onAppConfigSet));c.subscribe("builder/themeChanged",f.hitch(this,this._onThemeChanged));
c.subscribe("builder/layoutChanged",f.hitch(this,this._onLayoutChanged));c.subscribe("builder/styleChanged",f.hitch(this,this._onStyleChanged));c.subscribe("builder/syncExtent",f.hitch(this,this._onSyncExtent));c.subscribe("builder/loadingPageChanged",f.hitch(this,this._onLoadingPageChanged));c.subscribe("builder/templateConfigChanged",f.hitch(this,this._onTemplateConfigChanged));c.subscribe("builder/appProxyForMapChanged",f.hitch(this,this._onAppProxyForMapChanged));c.subscribe("builder/appProxyForUrlChanged",
f.hitch(this,this._onAppProxyForUrlChanged));c.subscribe("builder/sharedThemeChanged",f.hitch(this,this._onSharedThemeChanged))},loadConfig:function(){if("preview"!==this.urlParams.mode&&"config"!==this.urlParams.mode){var a=new m;a.placeAt(window.jimuConfig.layoutId);return this.configLoader.loadConfig().then(f.hitch(this,function(d){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(d);console.timeEnd("Load Config");window.appInfo.isRunInMobile=k.inMobileSize();d=
this.getAppConfig();a.destroy();c.publish("appConfigLoaded",d);return d}),f.hitch(this,function(d){a.destroy();console.error(d);d&&d.message&&"string"===typeof d.message&&this._showErrorMessage(d.message)}))}},_showErrorMessage:function(a){p.create("div",{"class":"app-error",innerHTML:k.sanitizeHTML(a)},document.body);p.setStyle(jimuConfig.loadingId,"display","none")},getAppConfig:function(){var a;window.appInfo.isRunInMobile?(a=f.clone(this._getMobileConfig(this.appConfig)),a._originConfig=f.clone(this.appConfig)):
a=f.clone(this.appConfig);a.getConfigElementById=function(a){return k.getConfigElementById(this,a)};a.getConfigElementsByName=function(a){return k.getConfigElementsByName(this,a)};a.getCleanConfig=function(a){return this._originConfig?u(this._originConfig,a):u(this,a)};a.visitElement=function(a){k.visitElement(this,a)};return a},_onOrientationChange:function(){this.appConfig&&c.publish("appConfigChanged",this.getAppConfig(),"layoutChange")},_onWindowResize:function(){var a=k.inMobileSize();window.appInfo.isRunInMobile!==
a&&(window.appInfo.isRunInMobile=a,this.appConfig&&c.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_getMobileConfig:function(a){return k.mixinAppConfigPosition(a,a.mobileLayout)},_updateDataSourceForWidget:function(a){this._deleteDataSourcesFromWidget(a);this._addDataSourcesForWidget(a)},_deleteDataSourcesFromWidget:function(a){for(var d in this.appConfig.dataSource.dataSources)d.startWith("widget~"+a.id+"~")&&delete this.appConfig.dataSource.dataSources[d]},_addDataSourcesForWidget:function(a){l.forEach(a.provideDataSources,
function(d){var b="widget~"+a.id+"~"+d.id;d.id=b;this.appConfig.dataSource.dataSources[b]=d},this);delete a.provideDataSources},_addIdForWidgets:function(a){var d=0,b;this.getAppConfig().visitElement(function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var g=a.id.lastIndexOf("_");-1<g&&(b=a.id.substr(g+1),d=Math.max(d,b))}});l.forEach(a,function(a){a.id||(d++,a.id=a.itemId?a.itemId+"_"+d:a.uri?a.uri.replace(/\//g,"_")+"_"+d:"_"+d)})},_onWidgetChanged:function(a){var d=k.reCreateObject(a);a=k.getConfigElementById(this.appConfig,
a.id);this._updateDataSourceForWidget(d);!1!==d.inPanel||a.uri||(d.closeable=!0);for(var b in d)a[b]=d[b];delete a.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"widgetChange",d)},_onGroupChanged:function(a){var d=k.reCreateObject(a);a=k.getConfigElementById(this.appConfig,a.id);this._handleDataSourceForWidgets(a,d);for(var b in d)a[b]=d[b];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
c.publish("appConfigChanged",this.getAppConfig(),"groupChange",d)},_handleDataSourceForWidgets:function(a,d){var b=l.filter(d.widgets,function(d){return d.id?0===l.filter(a.widgets,function(a){return d.id===a.id}).length:!0},this);this._addIdForWidgets(b);l.forEach(b,function(a){this._addDataSourcesForWidget(a)},this);b=l.filter(a.widgets,function(a){return 0===l.filter(d.widgets,function(d){return d.id===a.id}).length},this);l.forEach(b,function(a){this._deleteDataSourcesFromWidget(a)},this);l.forEach(d.widgets,
function(d){l.forEach(a.widgets,function(a){d.id===a.id&&d.provideDataSources&&this._updateDataSourceForWidget(d)},this)},this)},_onWidgetPoolChanged:function(a){var d=k.reCreateObject(a);this._handleDataSourceForWidgetsSection(this.appConfig.widgetPool,d);1===this.widgetManager.getControllerWidgets().length?(this.appConfig.widgetPool.widgets=d.widgets,this.appConfig.widgetPool.groups=d.groups):(a=k.getConfigElementById(this.appConfig,d.controllerId),l.forEach(a.controlledWidgets,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,
a)},this),l.forEach(a.controlledGroups,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,a)},this),this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?d.widgets:this.appConfig.widgetPool.widgets.concat(d.widgets),this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?d.groups:this.appConfig.widgetPool.groups.concat(d.groups),a.controlledWidgets=l.map(d.widgets,function(a){return a.id}),a.controlledGroups=l.map(d.groups,
function(a){return a.id}));this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(f.hitch(this,function(a){this.appConfig=a;this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",d)}))},_handleDataSourceForWidgetsSection:function(a,d){var b=d.widgets;l.forEach(d.groups,function(a){b=b.concat(a.widgets)},this);var g=a.widgets;l.forEach(a.groups,function(a){g=g.concat(a.widgets)},this);
this._handleDataSourceForWidgets({widgets:g},{widgets:b})},_removeWidgetOrGroupFromPoolById:function(a,d){l.some(a.widgetPool.widgets,function(b,g){if(b.id===d)return a.widgetPool.widgets.splice(g,1),!0});l.some(a.widgetPool.groups,function(b,g){if(b.id===d)return a.widgetPool.groups.splice(g,1),!0})},_onOpenAtStartChanged:function(a){var d=k.reCreateObject(a),b=this.appConfig;a.isOnScreen?(b=b.widgetOnScreen&&b.widgetOnScreen.widgets)&&0<b.length&&l.forEach(b,f.hitch(this,function(d){d.id===a.id?
d.openAtStart=!d.openAtStart:delete d.openAtStart})):((b=b.widgetPool)&&b.groups&&0<b.groups.length&&l.forEach(b.groups,f.hitch(this,function(d){d.id===a.id?d.openAtStart=!d.openAtStart:delete d.openAtStart})),b&&b.widgets&&0<b.widgets.length&&l.forEach(b.widgets,f.hitch(this,function(d){d.id===a.id?d.openAtStart=!d.openAtStart:delete d.openAtStart})));c.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",d)},_onScreenOrderChanged:function(a){var d=k.reCreateObject(a);l.forEach(this.appConfig.widgetOnScreen.widgets,
function(a){a.isController||(!1!==a.inPanel||!0!==a.closeable)&&!0!==a.inPanel&&a.uri||l.some(d,function(d){if(a.id===d.id)return a.position=d.position,!0})},this);c.publish("appConfigChanged",this.getAppConfig(),"onScreenOrderChange",d)},_onAppAttributeChanged:function(a){a=k.reCreateObject(a);f.mixin(this.appConfig,a);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),
"attributeChange",a)},_onDataSourceChanged:function(a){var d=k.reCreateObject(a);this.appConfig.dataSource=d;c.publish("appConfigChanged",this.getAppConfig(),"dataSourceChange",a)},_onLoadingPageChanged:function(a){a=k.reCreateObject(a);var d;"backgroundColor"in a?this.appConfig.loadingPage.backgroundColor=a.backgroundColor:"backgroundImage"in a?(d=this.appConfig.loadingPage.backgroundImage||{},this.appConfig.loadingPage.backgroundImage=f.mixin(d,a.backgroundImage)):"loadingGif"in a&&(d=this.appConfig.loadingPage.loadingGif||
{},this.appConfig.loadingPage.loadingGif=f.mixin(d,a.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",a)},_onAppProxyForMapChanged:function(a){a=k.reCreateObject(a);"appProxy"in this.appConfig.map?this.appConfig.map.appProxy.mapItemId!==a.mapItemId?this.appConfig.map.appProxy=a:l.forEach(a.proxyItems,f.hitch(this,function(a){if(!l.some(this.appConfig.map.appProxy.proxyItems,function(d){if(d.sourceUrl===
a.sourceUrl)return d.useProxy=a.useProxy,d.proxyUrl=a.proxyUrl||"",d.proxyId=a.proxyId||"",isNaN(a.hitsPerInterval)||(d.hitsPerInterval=a.hitsPerInterval),isNaN(a.intervalSeconds)||(d.intervalSeconds=a.intervalSeconds),!0})&&a.useProxy&&a.proxyUrl){var d=this.appConfig.map.appProxy.proxyItems||[];d.push(a);this.appConfig.map.appProxy.proxyItems=d}})):this.appConfig.map.appProxy=a;c.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",a)},_onAppProxyForUrlChanged:function(a){a=k.reCreateObject(a);
this.appConfig.appProxies=a;c.publish("appConfigChanged",this.getAppConfig(),"appProxyChange",a)},_onTemplateConfigChanged:function(a){a=k.reCreateObject(a);this.appConfig.templateConfig=a;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",a)},_onMapContentModified:function(){c.publish("mapContentModified")},_onMapChanged:function(a){var d=k.reCreateObject(a);this.appConfig.map.mapOptions&&
k.deleteMapOptions(this.appConfig.map.mapOptions);this.appConfig.map.mapRefreshInterval={useWebMapRefreshInterval:!0};f.mixin(this.appConfig.map,d);this._deleteDataSourcesFromMap();this.configLoader.addNeedValues(this.appConfig);this.configLoader.loadAndUpgradeAllWidgetsConfig(this.appConfig).then(f.hitch(this,function(a){this.appConfig=a;this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"mapChange",d)}))},_deleteDataSourcesFromMap:function(){l.forEach(Object.keys(this.appConfig.dataSource.dataSources),
function(a){a.startWith("map")&&delete this.appConfig.dataSource.dataSources[a]},this)},_onMapOptionsChanged:function(a){a=k.reCreateObject(a);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});f.mixin(this.appConfig.map.mapOptions,a);c.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",a)},_onMapRefreshIntervalChanged:function(a){a=k.reCreateObject(a);this.appConfig.map.mapRefreshInterval||(this.appConfig.map.mapRefreshInterval={});f.mixin(this.appConfig.map.mapRefreshInterval,
a);this.appConfig.map.mapRefreshInterval.useWebMapRefreshInterval&&delete this.appConfig.map.mapRefreshInterval.minutes;c.publish("appConfigChanged",this.getAppConfig(),"mapRefreshIntervalChange",a)},_onThemeChanged:function(a){this._getAppConfigFromTheme(a).then(f.hitch(this,function(d){var b=f.clone(this.appConfig.widgetOnScreen);this.appConfig=d;this._handleDataSourceForWidgetsSection(b,{});c.publish("appConfigChanged",this.getAppConfig(),"themeChange",a.getName())}))},_onLayoutChanged:function(a){this.appConfig=
k.mixinAppConfigPosition(this.appConfig,a.layoutConfig);this.appConfig.layoutDefinition=a.layoutConfig.layoutDefinition;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"layoutChange",a.name)},_onStyleChanged:function(a){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,a.name);a.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:a.styleColor}:(delete this.appConfig.theme.customStyles,
delete this.appConfig.titleColor,this.appConfig.theme.sharedTheme={isPortalSupport:this.appConfig.theme.sharedTheme.isPortalSupport,useHeader:!1,useLogo:!1});c.publish("appConfigChanged",this.getAppConfig(),"styleChange",a.name)},_onOnScreenGroupsChanged:function(a){a=k.reCreateObject(a);this.appConfig.widgetOnScreen.groups=a.groups;c.publish("appConfigChanged",this.getAppConfig(),"onScreenGroupsChange",a.groups)},_onLayoutDefinitionChanged:function(a){a=k.reCreateObject(a);k.isEqual(this.appConfig.layoutDefinition,
a.layoutDefinition)||(this.appConfig.layoutDefinition=a.layoutDefinition,this.appConfig.widgetOnScreen.groups=k.handleGridLayoutOnScreenGroupChange(this.appConfig.widgetOnScreen.groups,a.groupIds),this.configLoader.addNeedValues(this.appConfig),this._addDefaultValues(this.appConfig),c.publish("appConfigChanged",this.getAppConfig(),"layoutDefinitionChange",a.layoutDefinition))},_onSharedThemeChanged:function(a){var d=this.appConfig.theme.sharedTheme;a=k.reCreateObject(a);a.useHeader&&!d.useHeader&&
(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},this.appConfig.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor})):console.error("Portal does not support sharedTheme."));!a.useHeader&&d.useHeader&&(delete this.appConfig.titleColor,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor}));
a.useLogo&&!d.useLogo&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",this.appConfig.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link,this._onAppAttributeChanged({logo:this.appConfig.logo,logoLink:this.appConfig.logoLink})):console.error("Portal does not support sharedTheme."));!a.useLogo&&d.useLogo&&
this._onAppAttributeChanged({logo:this.appConfig.logo});f.mixin(d,a);c.publish("appConfigChanged",this.getAppConfig(),"sharedThemeChange",a)},_onSyncExtent:function(a){c.publish("syncExtent",a)},_genStyles:function(a,d){var b=[];b.push(d);l.forEach(a,function(a){0>b.indexOf(a)&&b.push(a)});return b},_getAppConfigFromTheme:function(a){var d=new q,b,g=[],e=this.getAppConfig().getCleanConfig();e.mode=this.urlParams.mode;l.forEach(e.widgetPool.groups,function(a){delete a.panel},this);if(a.appConfig)b=
f.clone(a.appConfig),b.map=e.map,b.map.position=a.appConfig.map.position,this._copyPoolToThemePool(e,b),b.links=e.links,b.title=e.title,b.subtitle=e.subtitle,b.logo=e.logo;else{var m=a.getCurrentLayout(),g=a.getCurrentStyle();b=f.clone(e);m=f.clone(m.layoutConfig);b.widgetOnScreen=m.widgetOnScreen;m.widgetPool&&(l.forEach(m.widgetPool.widgets,function(a){a.isPreconfiguredInTheme=!0}),l.forEach(m.widgetPool.groups,function(a){a.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(e,m);b.widgetPool=
m.widgetPool;m.map&&m.map.position&&(b.map.position=m.map.position);b.mobileLayout=m.mobileLayout;b.layoutDefinition=m.layoutDefinition;g=this._genStyles(l.map(a.getStyles(),function(a){return a.name}),g.name);b.theme={name:a.getName(),styles:g,version:a.getVersion()};this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(b.theme.sharedTheme={useHeader:!0,useLogo:!0,isPortalSupport:!0},b.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background}):
(b.theme.sharedTheme={useHeader:!1,useLogo:!1,isPortalSupport:!1},b.theme.customStyles={mainBackgroundColor:""});b.titleColor=e.titleColor;b.logoLink=e.logoLink}this.configLoader.addNeedValues(b);this.configLoader.loadWidgetsManifest(b).then(f.hitch(this,function(a){return this.configLoader.loadAndUpgradeAllWidgetsConfig(a)})).then(f.hitch(this,function(){this._addDefaultValues(b);d.resolve(b)}));return d},_copyPoolToThemePool:function(a,d){var b=a.widgetPool;d.widgetPool||(d.widgetPool={});a=d.widgetPool;
var g=l.filter(a.widgets,function(a){if(a.isPreconfiguredInTheme||!l.some(b.widgets,function(d){return d.name===a.name}))return!0}),e=l.filter(a.groups,function(a){return a.isPreconfiguredInTheme}),m=l.filter(b.widgets,function(a){return!a.isPreconfiguredInTheme}),u=l.filter(b.groups,function(a){return!a.isPreconfiguredInTheme}),m=this._getPoolWidgetsWithoutDuplicated(m,d.widgetOnScreen.widgets||[]);a.widgets=m.concat(g);a.groups=u.concat(e)},_getPoolWidgetsWithoutDuplicated:function(a,d){for(var b=
f.clone(a),g=this.getAppConfig(),e=a.length-1;0<=e;e--)for(var m=d.length-1;0<=m;m--)if(d[m].uri){var u=d[m].name;u||(u=k.getWidgetNameFromUri(d[m].uri));var h=g.getConfigElementById(a[e].id);a[e]&&a[e].name===u&&!1===h.supportMultiInstance&&(console.log("Widget",a[e].name,"is not copied to new theme because this widget exists in new theme."),b.splice(e,1))}return b},_onAppConfigSet:function(d){d=k.reCreateObject(d);window.appInfo.isRunInMobile=k.inMobileSize();this.configLoader.processProxy(d);this.configLoader.addNeedValues(d);
this.configLoader.loadAndUpgradeAllWidgetsConfig(d).then(f.hitch(this,function(d){this._addDefaultValues(d);b.setPortalUrl(d.portalUrl);window.portalUrl=d.portalUrl;this.appConfig?(k.deleteMapOptions(d.map.mapOptions),this.appConfig=d,this._deleteDataSourcesFromMap(),c.publish("appConfigChanged",this.getAppConfig(),"resetConfig",d)):(this.appConfig=d,a.getPortal(d.portalUrl).loadSelfInfo().then(f.hitch(this,function(a){this.portalSelf=a;c.publish("appConfigLoaded",this.getAppConfig())})))}))},_addDefaultValues:function(a){this._addDefaultPortalUrl(a);
this._addDefaultGeometryService(a);this._addDefaultStyle(a);this._addDefaultMap(a);this._addDefaultVisible(a);this._addDefaultDataSource(a);this._addDefaultSharedTheme(a);"undefined"===typeof a.widgetOnScreen&&(a.widgetOnScreen={});"undefined"===typeof a.widgetPool&&(a.widgetPool={});this._addDefaultPanelAndPosition(a);this._addDefaultOfWidgetGroup(a);(a.widgetPool.widgets&&0<a.widgetPool.widgets.length&&void 0===a.widgetPool.widgets[0].index||a.widgetPool.groups&&0<a.widgetPool.groups.length&&void 0===
a.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(a);return a},_addDefaultDataSource:function(a){a.dataSource?(a.dataSource.dataSources||(a.dataSource.dataSources={}),a.dataSource.settings||(a.dataSource.settings={})):a.dataSource={dataSources:{},settings:{}}},_addDefaultPortalUrl:function(a){"undefined"===typeof a.portalUrl&&(a.portalUrl="http://www.arcgis.com/");a.portalUrl&&"/"!==a.portalUrl.substr(a.portalUrl.length-1)&&(a.portalUrl+="/")},_addDefaultGeometryService:function(a){var b=
a&&a.geometryService,b=b&&"string"===typeof b&&f.trim(b)?f.trim(b):this.portalSelf.helperServices.geometry.url;a.geometryService=b;g.defaults.geometryService=new d(a.geometryService)},_addDefaultStyle:function(a){!a.theme||a.theme.styles&&0!==a.theme.styles.length||(a.theme.styles=["default"])},_addDefaultMap:function(a){a.map.id="map";"undefined"===typeof a.map["3D"]&&"undefined"===typeof a.map["2D"]&&(a.map["2D"]=!0);"undefined"===typeof a.map.position&&(a.map.position={left:0,right:0,top:0,bottom:0});
"undefined"===typeof a.map.portalUrl&&(a.map.portalUrl=a.portalUrl)},_addDefaultVisible:function(a){k.visitElement(a,function(a){void 0===a.visible&&(a.visible=!0)})},_addDefaultSharedTheme:function(a){a.theme.sharedTheme?("undefined"===typeof a.theme.sharedTheme.useHeader&&(a.theme.sharedTheme.useHeader=!1),"undefined"===typeof a.theme.sharedTheme.useLogo&&(a.theme.sharedTheme.useLogo=!1)):a.theme.sharedTheme={useHeader:!1,useLogo:!1}},_addDefaultPanelAndPosition:function(a){this._addOnScreenDefaultPanelAndPosition(a);
this._addPoolDefaultPanelAndPosition(a)},_addOnScreenDefaultPanelAndPosition:function(a){var d,b;if(a=a.widgetOnScreen){d=a.panel&&a.panel.positionRelativeTo?a.panel.positionRelativeTo:"map";"undefined"===typeof a.panel||"undefined"===typeof a.panel.uri?a.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:d}}:"undefined"===typeof a.panel.position?a.panel.position={relativeTo:d}:"undefined"===typeof a.panel.position.relativeTo&&(a.panel.position.relativeTo=d);if(a.widgets)for(d=0;d<a.widgets.length;d++)a.widgets[d].position||
(a.widgets[d].position={}),a.widgets[d].position.relativeTo||(a.widgets[d].position.relativeTo=a.widgets[d]&&a.widgets[d].positionRelativeTo?a.widgets[d].positionRelativeTo:"map"),!0!==a.widgets[d].inPanel||a.widgets[d].panel||(a.widgets[d].panel=f.clone(a.panel),a.widgets[d].panel.position=a.widgets[d].position,a.widgets[d].panel.position.relativeTo=a.widgets[d].position.relativeTo);if(a.groups)for(d=0;d<a.groups.length;d++)for(a.groups[d].panel||(a.groups[d].panel=a.panel),a.groups[d].panel&&!a.groups[d].panel.position&&
(a.groups[d].panel.position={}),a.groups[d].panel.position.relativeTo||(a.groups[d].panel.position.relativeTo=a.groups[d].panel.positionRelativeTo?a.groups[d].panel.positionRelativeTo:"map"),a.groups[d].widgets||(a.groups[d].widgets=[]),b=0;b<a.groups[d].widgets.length;b++)a.groups[d].widgets[b].panel=a.groups[d].panel}},_addPoolDefaultPanelAndPosition:function(a){var d,b,g=a.widgetPool;if(g){d=g.panel&&g.panel.positionRelativeTo?g.panel.positionRelativeTo:"map";"undefined"===typeof g.panel||"undefined"===
typeof g.panel.uri?g.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:d}}:"undefined"===typeof g.panel.position?g.panel.position={relativeTo:d}:"undefined"===typeof g.panel.position.relativeTo&&(g.panel.position.relativeTo=d);if(g.groups)for(d=0;d<g.groups.length;d++)for(g.groups[d].panel?g.groups[d].panel.position.relativeTo||(g.groups[d].panel.position.relativeTo=g.groups[d].panel.positionRelativeTo?g.groups[d].panel.positionRelativeTo:"map"):g.groups[d].panel=g.panel,g.groups[d].widgets||
(g.groups[d].widgets=[]),b=0;b<g.groups[d].widgets.length;b++)g.groups[d].widgets[b].panel=g.groups[d].panel;if(g.widgets)for(d=0;d<g.widgets.length;d++)!1===g.widgets[d].inPanel?(b=g.widgets[d].positionRelativeTo?g.widgets[d].positionRelativeTo:"map",g.widgets[d].position)?g.widgets[d].position.relativeTo||(g.widgets[d].position.relativeTo=b):g.widgets[d].position={relativeTo:b}:g.widgets[d].panel||(g.widgets[d].panel=a.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(a){k.visitElement(a,f.hitch(this,
function(a,d){a.isOnScreen=d.isOnScreen;a.widgets?(a.gid=a.id,1===a.widgets.length?(a.label||(a.label=a.widgets[0].label?a.widgets[0].label:window.apiNls.common.groupLabel),a.icon||(a.icon=a.widgets[0].uri?this._getDefaultIconFromUri(a.widgets[0].uri):"jimu.js/images/group_icon.png")):(a.icon=a.icon?a.icon:"jimu.js/images/group_icon.png",a.label=a.label?a.label:window.apiNls.common.groupLabel+" "+d.index)):a.gid=d.groupId}))},_getDefaultIconFromUri:function(a){a=a.split("/");a.pop();return a.join("/")+
"/images/icon.png?wab_dv\x3d"+window.deployVersion},_addIndexForWidgetPool:function(a){var d=0,b,g;if(a.widgetPool.widgets)for(b=0;b<a.widgetPool.widgets.length;b++)a.widgetPool.widgets[b].index=d,d++;if(a.widgetPool.groups)for(b=0;b<a.widgetPool.groups.length;b++)for(a.widgetPool.groups[b].index=d,d++,g=0;g<a.widgetPool.groups[b].widgets.length;g++)a.widgetPool.groups[b].widgets[g].index=g}});B.getInstance=function(a){null===v?v=new B(a):a&&(v.urlParams=a,v.configLoader&&(v.configLoader.urlParams=
a));window.getAppConfig=f.hitch(v,v.getAppConfig);return v};return B})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/lang moment/moment esri/arcgis/utils esri/dijit/PopupTemplate esri/SpatialReference esri/geometry/Extent esri/geometry/geometryEngine esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils esri/tasks/GeometryService esri/tasks/ProjectParameters esri/tasks/FeatureSet esri/symbols/PictureMarkerSymbol esri/urlUtils esri/request esri/tasks/query esri/tasks/QueryTask esri/graphicsUtils esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils ./shared/utils ./accessibleUtils ./zoomToUtils libs/caja-html-sanitizer-minified".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C,D,y,w,A,G,E,F,H,L,N,M,J,K,O,Q,P,R,I,V,X,T,Y){function Z(a,d){a=a||"";var b=0,g=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!x.file.isEnabledFlash(),failure:[a+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){b++;b===g.length&&d()}}];for(a=0;a<g.length;a++)testLoad(g[a])}function ba(a,d){var b=a.match(/url\([^)]+\)/gi),g,e;if(null===b||""===d)return a;for(g=0;g<b.length;g++)if(e=b[g].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),
4<=e.length){var m=e[2];/^data:image\/.*;/.test(m)||(d.endWith("/")||(d+="/"),a=a.replace(e[1]+m+e[3],e[1]+d+m+e[3]))}return a}function W(a,d){var b=Array.isArray(d),g=b&&[]||{};b?(a=a||[],g=g.concat(a),d.forEach(function(d,b){"undefined"===typeof a[b]?g[b]=d:"object"===typeof d?g[b]=W(a[b],d):-1===a.indexOf(d)&&g.push(d)})):(a&&"object"===typeof a&&Object.keys(a).forEach(function(d){g[d]=a[d]}),Object.keys(d).forEach(function(b){g[b]="object"===typeof d[b]&&d[b]?a[b]?W(a[b],d[b]):d[b]:d[b]}));return g}
function aa(a,d){var b=a.map(function(a){return a.id});f.forEach(d,function(d){0>b.indexOf(d)&&a.push({id:d,widgets:[]})},this);var g=[];a=f.filter(a,function(a){return 0>d.indexOf(a.id)?(g.push(a),!1):!0},this);if(0===a.length)return[];var e=a[a.length-1];f.forEach(g,function(a){e.widgets=e.widgets.concat(a.widgets)},this);return a=a.sort(function(a,b){return d.indexOf(a.id)-d.indexOf(b.id)})}function S(a,d,b){function g(a,d){return r.isArray(a[d.key])?a[d.key][d.index]:a[d.key]}d=function(a){var d=
[];a.split("_").forEach(function(a){var b=!1,g;"--"===a.slice(a.length-2)&&(b=!0,a=a.slice(0,a.length-2));g=a.search(/\[[0-9]+\]/);-1===g&&(g=a.length);d.push({key:a.slice(0,g),index:Number(a.slice(g+1,-1)),deleteFlag:b})});return d}(d);for(var e=1;e<d.length-1;e++)if(a=g(a,d[e]),!a)return;if(d[d.length-1].deleteFlag)!0===b&&(r.isArray(a[d[d.length-1].key])?delete a[d[d.length-1].key][d[d.length-1].index]:delete a[d[d.length-1].key]);else if(r.isArray(a[d[d.length-1].key])){if(void 0===b)return a[d[d.length-
1].key][d[d.length-1].index];a[d[d.length-1].key][d[d.length-1].index]=b}else{if(void 0===b)return a[d[d.length-1].key];a[d[d.length-1].key]=b}}function ca(a,d,b){function g(b){b=x.template.getSearchRange(d,b,"]");var g=d.slice(b.firstPos,b.lastPos);return-1!==b.firstPos?(g=d.slice(b.firstPos+g.indexOf("[")+1,b.lastPos-1),b=d.slice(b.lastPos+1),(g=x.getConfigElementById(a,g))?{object:g,key:"section_"+b,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var e=a,m=d=d.replace(/\//g,"_"),u=
g("groups\\[.+\\]");if("deleted"!==u.state&&("isSection"===u.state&&(e=u.object,m=u.key),u=g("widgets\\[.+\\]"),"delete"!==u.state))return"isSection"===u.state&&(e=u.object,m=u.key),S(e,m,b)}var x={},U={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};r.mixin(x,X);r.mixin(x,T);r.mixin(x,Y);window.atob||(window.atob=function(a){a=u.decode(a);for(var d="",b=0,g=a.length;b<g;b++)d+=String.fromCharCode(a[b]);return d});window.btob||(window.btob=function(a){for(var d=
[],b=0,g=a.length;b<g;b++)d.push(String.charCodeAt(a[b]));return u.encode(d)});var ha="unload",la=[];require.on("error",function(a){f.forEach(la,function(d){a.info[0]&&-1<a.info[0].indexOf(d.resKey)&&d.def.reject(a);for(var b in a.info)-1<b.indexOf(d.resKey)&&d.def.reject(a)})});x.checkError=function(a,d){la.push({resKey:a,def:d})};x.replacePlaceHolder=function(a,d){var g=b.stringify(a),e=g.match(/\$\{(\w)+\}/g);if(null===e)return a;for(a=0;a<e.length;a++){var m=e[a].match(/(\w)+/g)[0];d[m]&&(g=g.replace(e[a],
d[m]))}return b.parse(g)};x.changeUnit=function(a){var d=Math.abs(a),b;a=Math.floor(d);b=Math.floor(60*(d-a));d=(60*(60*(d-a)-b)).toFixed(2);return a+"\u00b0"+(10>b?"0"+b:b)+"'"+(10>d?"0"+d:d)+'"'};x.formatTime=function(a){var d=a/1E3;a=Math.floor(d/60);d=Number(d-60*a).toFixed(1);return(10>a?"0"+a:a)+":"+(10>d?"0"+d:d)};x.parseTime=function(a){var d=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!d.test(a))return console.log("wrong time format."),-1;a=a.match(d);return 1E3*(60*parseInt(a[1],10)+parseInt(a[2],10)+
parseInt(a[3],10)/10)};x.preloadImg=function(a,d){var b=[],b="string"===typeof a?[a]:a;f.forEach(b,function(a){(new Image).src=d?d+a:a})};x.setWABLogoDefaultAlt=function(a){if(a){a=n("img",a);for(var d=["img_1412759111499","img_1545621838463","img_1560482577021"],b=0,g=a.length;b<g;b++){var e=a[b];-1<d.indexOf(l.getAttr(e,"id"))&&!l.getAttr(e,"alt")&&l.setAttr(e,"alt","Web AppBuilder for ArcGIS.png")}}};var ea=null;x.getImagesSize=function(a){var d=new h;if(!a||0!==a.indexOf("http"))return d.reject(),
d;null===ea&&(ea=l.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var b=e(ea,"load",function(){clearTimeout(g);g=null;b.remove();var a=l.getContentBox(ea);1===a.w&&1===a.h||0===a.w||0===a.h?d.reject():d.resolve([a.w,a.h])},{}),g=setTimeout(function(){clearTimeout(g);g=null;d.reject()},5E3);l.setAttr(ea,"src",a);return d};x.getPositionStyle=function(a){var d={};if(!a)return d;a=r.clone(a);if(window.isRTL){var b;"undefined"!==typeof a.left&&
"undefined"!==typeof a.right?(b=a.left,a.left=a.right,a.right=b):"undefined"!==typeof a.left?(a.right=a.left,delete a.left):"undefined"!==typeof a.right&&(a.left=a.right,delete a.right);"undefined"!==typeof a.paddingLeft&&"undefined"!==typeof a.paddingRight?(b=a.paddingLeft,a.paddingLeft=a.paddingRight,a.paddingRight=b):"undefined"!==typeof a.paddingLeft?(a.paddingRight=a.paddingLeft,delete a.paddingLeft):"undefined"!==typeof a.paddingRight&&(a.paddingLeft=a.paddingRight,delete a.paddingRight);"undefined"!==
typeof a.marginLeft&&"undefined"!==typeof a.marginRight?(b=a.marginLeft,a.marginLeft=a.marginRight,a.marginRight=b):"undefined"!==typeof a.marginLeft?(a.marginRight=a.marginLeft,delete a.marginLeft):"undefined"!==typeof a.marginRight&&(a.marginLeft=a.marginRight,delete a.marginRight)}b="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom margin marginLeft marginRight marginTop marginBottom".split(" ");for(var g=0;g<b.length;g++){var e=b[g];"number"===typeof a[e]?
d[e]=a[e]+"px":"undefined"!==typeof a[e]?d[e]=a[e]:"padding"===e.substr(0,7)||"margin"===e.substr(0,7)?d[e]=0:d[e]="auto"}d.zIndex="undefined"===typeof a.zIndex?"auto":a.zIndex;return d};x.isEqual=function(a,d){function b(a,d){var m;if(null===a&&null===d||"undefined"===typeof a&&"undefined"===typeof d)return!0;if(null===a&&null!==d||null===d&&null!==a||"undefined"===typeof a&&"undefined"!==typeof d||"undefined"===typeof d&&"undefined"!==typeof a)return!1;if(isNaN(a)&&isNaN(d)&&"number"===typeof a&&
"number"===typeof d||a===d)return!0;if("function"===typeof a&&"function"===typeof d||a instanceof Date&&d instanceof Date||a instanceof RegExp&&d instanceof RegExp||a instanceof String&&d instanceof String||a instanceof Number&&d instanceof Number)return a.toString()===d.toString();if(-1<g.indexOf(a)||-1<e.indexOf(d))return!1;if(null!==d){for(m in d)if(d.hasOwnProperty(m)!==a.hasOwnProperty(m)||typeof d[m]!==typeof a[m])return!1;for(m in a){if(d.hasOwnProperty(m)!==a.hasOwnProperty(m)||typeof d[m]!==
typeof a[m])return!1;switch(typeof a[m]){case "object":case "function":g.push(a);e.push(d);if(!b(a[m],d[m]))return!1;g.pop();e.pop();break;default:if(!(isNaN(a[m])&&isNaN(d[m])&&"number"===typeof a[m]&&"number"===typeof d[m]||a[m]===d[m]))return!1}}}return!0}var g,e;g=[];e=[];return b(a,d)?!0:!1};x.file={loadFileAPI:function(){var a=new h;if("unload"===ha){var d=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:d+"libs/polyfills/fileAPI/",flashUrl:d+"libs/polyfills/fileAPI/FileAPI.flash.swf",
flashImageUrl:d+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};Z(d,r.hitch(this,function(){ha="loaded";a.resolve()}));ha="loading"}else"loaded"===ha&&a.resolve();return a},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return p("safari")&&6>p("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var a=null;if(document.all)try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(fa){a=
null}else navigator.plugins&&0<navigator.plugins.length&&(a=navigator.plugins["Shockwave Flash"]);return!!a},containSeparator:function(a){return 0<=a.indexOf("/")?!0:0<=a.indexOf("\\")?!0:!1},getNameFromPath:function(a){var d="",d=0<=a.indexOf("/")?"/":"\\";a=a.split(d);return 0<a.length?a[a.length-1]:null},getFolderFromPath:function(a){return a.substr(0,a.length-x.file.getNameFromPath(a).length)},readFile:function(a,d,b,g){if(this.supportHTML5()){var e=a.target.files[0];e&&(e.type.match(d)?e.size>=
b?g({errCode:"exceed"}):(a=new FileReader,a.onload=function(a){g(null,e.name,a.target.result)},a.readAsDataURL(e)):g({errCode:"invalidType"}))}else if(this.supportFileAPI()){var m=window.FileAPI.getFiles(a);m[0].type.match(d)?m[0].size>=b?g({errCode:"exceed"}):window.FileAPI.readAsDataURL(m[0],function(a){a&&a.result?g(null,m[0].name,a.result):g({errCode:"readError"})}):g({errCode:"invalidType"})}}};x.getUriInfo=function(a){var d,b={};d=a.indexOf("/");a.substring(0,d);d=a.substring(0,a.lastIndexOf("/")+
1);b.folderUrl=require(x.getRequireConfig()).toUrl(d);b.amdFolder=d;b.url=b.folderUrl;if(/^http(s)?:\/\//.test(a)||/^\/\//.test(a))b.isRemote=!0;return b};x.widgetJson=function(){var a={addManifest2WidgetJson:function(a,d){r.mixin(a,d.properties);a.name=d.name;a.label||(a.label=d.label);a.manifest=d;a.isRemote=d.isRemote;a.isRemote&&(a.itemId=d.itemId);d.featureActions&&(a.featureActions=d.featureActions);a.icon||(a.icon=d.icon);a.thumbnail||(a.thumbnail=d.thumbnail);a.folderUrl=d.folderUrl;a.amdFolder=
d.amdFolder},removeManifestFromWidgetJson:function(a){if(a.manifest){for(var d in a.manifest.properties)a[d]=void 0;a.name=void 0;a.label=void 0;a.featureActions=void 0;a.manifest=void 0}},getUriFromItem:function(d){return d.url?a.getFolderUrlFromItem(d)+"Widget":null},getFolderUrlFromItem:function(a){if(!a.url)return null;a=/manifest\.json$/.test(a.url)?a.url.substring(0,a.url.length-13):/\/$/.test(a.url)?a.url:a.url+"/";"https:"===window.location.protocol&&(a=a.replace(/^http:\/\//,"https://"));
return a}};return a}();x.getRequireConfig=function(){if(jimuConfig){var a=[];jimuConfig.widgetsPackage&&(a=a.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(a=a.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(a=a.concat(jimuConfig.configsPackage));return{packages:a}}return{}};x.getTypeByGeometryType=function(a){var d="",b="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),g=["esriGeometryRing",
"esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(a)?d="point":0<=b.indexOf(a)?d="polyline":0<=g.indexOf(a)&&(d="polygon");return d};x.getSymbolTypeByGeometryType=function(a){var d=null;a=x.getTypeByGeometryType(a);"point"===a?d="marker":"polyline"===a?d="line":"polygon"===a&&(d="fill");return d};x.getServices=function(){return U};x.getArcGISDefaultGeometryService=function(){return new H(U.geometryService)};x.restoreToDefaultWebMapExtent=function(a,
d,b){var g=new h;if(!a||"esri.Map"!==a.declaredClass)return setTimeout(function(){g.reject("Invalid map.")},0),g;d=d&&d.itemInfo;if(!d)return setTimeout(function(){g.reject("Invalid itemInfo")},0),g;d=d.item&&d.item.extent;if(!d)return setTimeout(function(){g.reject("Invalid itemInfo.item.extent")}),g;var e=new D({wkid:4326}),e=new y(d[0][0],d[0][1],d[1][0],d[1][1],e);if(4326===parseInt(a.spatialReference.wkid,10))return a.setExtent(e);if(a.spatialReference.isWebMercator())return e=F.geographicToWebMercator(e),
a.setExtent(e);d=new L;d.geometries=[e];d.outSR=a.spatialReference;e=esriConfig&&esriConfig.defaults&&esriConfig.defaults.geometryService;e&&"esri.tasks.GeometryService"===e.declaredClass||(b&&"string"===typeof b&&r.trim(b)?(b=r.trim(b),e=new H(b)):e=x.getArcGISDefaultGeometryService());e.project(d).then(function(d){if(d=d&&d[0])return a.setExtent(d);g.reject("Invalid projected geometry.");return g},function(a){console.error(a);g.reject(a);return g});return g};x.getAncestorWindow=function(){for(var a=
window;a&&a.parent&&a!==a.parent;)a=a.parent;return a};x.getAncestorDom=function(a,d,b){if(a&&1===a.nodeType&&d&&"function"===typeof d){var g=100,e=document.body;b&&("number"===typeof b?(b=parseInt(b,10),0<b&&(g=b)):1===b.nodeType&&(e=b));for(b=0;a.parentNode&&b<g&&l.isDescendant(a.parentNode,e);){if(d(a.parentNode))return a.parentNode;a=a.parentNode;b++}}return null};x.bindClickAndDblclickEvents=function(a,d,b,g){var m=null;if(a&&1===a.nodeType&&d&&"function"===typeof d&&b&&"function"===typeof b){var u=
200;g&&"number"===typeof g&&(g=parseInt(g,10),0<g&&(u=g));var h=0,m=e(a,"click",function(a){h++;1===h?setTimeout(function(){1===h&&(h=0,d(a))},u):2===h&&(h=0,b(a))})}return m};x.isScrollToBottom=function(a){var d=l.getContentBox(a);return 1>a.scrollHeight-(a.scrollTop+d.h)};x.getAllItemTypes=function(){var a=[],a=a.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service",
"Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return a=a.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer",
"Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};x.getItemQueryStringByTypes=function(a){var d="",b=x.getAllItemTypes();if(a&&0<a.length&&0<a.length){var g="";f.forEach(a,function(d,b){g+=' type:"'+d+'" ';b!==a.length-1&&(g+=" OR ")});d=" ( "+g+" ) ";b=a.concat(b);b=f.filter(b,function(d){return f.every(a,
function(a){return 0>a.toLowerCase().indexOf(d.toLowerCase())})});f.forEach(b,function(a){d+=' -type:"'+a+'" '})}return d};x.getItemQueryStringByTypeKeywords=function(a){var d="";a&&0<a.length&&(d=' typekeywords:"'+a.join(",")+'" ');return d};x.isNotEmptyString=function(a,d){var b=a&&"string"===typeof a;return b?d?b&&r.trim(a):!0:!1};x.isNotEmptyStringArray=function(a,d){for(var b=0;b<a.length;b++){var g=a[b];if(!x.isNotEmptyString(g.value?g.value:g,d))return!1}return!0};x.isValidNumber=function(a){return"number"===
typeof a&&!isNaN(a)};x.isValidNumberArray=function(a){for(var d=0;d<a.length;d++){var b=a[d],b=b.value||0===b.value?b.value:b;if(!x.isValidNumber(b))return!1}return!0};x.isValidDate=function(a){if(a)try{var d=x.getDateByDateTimeStr(a);return!isNaN(d.getTime())}catch(da){return console.error(da),!1}else return!1};x.isObject=function(a){return a&&"object"===typeof a};x.createWebMap=function(a,d,b,g){a=V.getStandardPortalUrl(a);a=V.getBaseItemUrl(a);z.arcgisUrl=a;return z.createMap(d,b,g)};x.getRandomString=
function(){var a=Math.random().toString();return a=a.slice(2,a.length)};x._getDomainsByServerName=function(a){var d=a.split("."),b=d.length;return f.map(d,r.hitch(this,function(a,g){a=d.slice(g,b);var e="",m=a.length-1;f.forEach(a,r.hitch(this,function(a,d){e+=a;d!==m&&(e+=".")}));return e}))};x.removeCookie=function(a,d){var b=this._getDomainsByServerName(window.location.hostname);f.forEach(b,r.hitch(this,function(b){m(a,null,{expires:-1,path:d});m(a,null,{expires:-1,path:d,domain:b});m(a,null,{expires:-1,
path:d,domain:"."+b})}))};x.isLocaleChanged=function(a,d){return!a.startWith(d)};x.hashToObject=function(a){a=a.replace("#","");a=q.queryToObject(a);for(var d in a)if(a.hasOwnProperty(d))try{a[d]=b.parse(a[d])}catch(da){}return a};x.reCreateObject=function(a){function d(a){var g=[];a.forEach(function(a){Array.isArray(a)?g.push(d(a)):"object"===typeof a?g.push(b(a)):g.push(a)});return g}function b(a){var g={},e;for(e in a)a.hasOwnProperty(e)&&(null===a[e]?g[e]=null:Array.isArray(a[e])?g[e]=d(a[e]):
g[e]="object"===typeof a[e]?b(a[e]):a[e]);return g}return Array.isArray(a)?d(a):b(a)};x.setVerticalCenter=function(a){setTimeout(function(){var d=n(".jimu-vcenter-text",a),b,g;f.forEach(d,function(a){b=l.getContentBox(a).h;l.setStyle(a,{lineHeight:b+"px"})},this);d=n(".jimu-vcenter",a);f.forEach(d,function(a){b=l.getContentBox(a).h;g=l.getContentBox(n(a).parent()[0]).h;l.setStyle(a,{marginTop:(g-b)/2+"px"})},this)},10)};x.merge=W;x.loadStyleLink=function(a,d,b){var g=new h,m,u=require(x.getRequireConfig()).toUrl(d);
if(require.cache["url:"+u]){m=require.cache["url:"+u];var k=u.split("/").pop(),u=u.substr(0,u.length-k.length);m=ba(m,u);a=b?l.create("style",{id:a,type:"text/css"},l.byId(b),"before"):l.create("style",{id:a,type:"text/css"},document.getElementsByTagName("head")[0]);a.styleSheet&&!a.sheet?a.styleSheet.cssText=m:a.appendChild(l.toDom(m));g.resolve("load");return g}m=b?l.create("link",{id:a,rel:"stylesheet",type:"text/css",href:u+"?wab_dv\x3d"+window.deployVersion},l.byId(b),"before"):l.create("link",
{id:a,rel:"stylesheet",type:"text/css",href:u+"?wab_dv\x3d"+window.deployVersion},document.getElementsByTagName("head")[0]);e(m,"load",function(){g.resolve("load")});var v=setInterval(function(){var a;if(f.some(document.styleSheets,function(b){if(b.href&&b.href.substr(b.href.indexOf(d),b.href.length)===d)return a=b,!0}))try{!g.isFulfilled()&&(a.cssRules&&a.cssRules.length||a.rules&&a.rules.length)&&g.resolve("load"),clearInterval(v)}catch(ga){}},50);return g};x.changeLocation=function(a){window.history.pushState&&
window.history.pushState({path:a},"",encodeURI(a))};x.urlToObject=function(a){var d=null;-1===a.indexOf("#")?(d=J.urlToObject(a),d.hash=null):(a=a.split("#"),d=J.urlToObject(a[0]),d.hash=a[1]?-1<a[1].indexOf("\x3d")?q.queryToObject(a[1]):a[1]:null);return d};x.manifest=function(){function a(a){a.panels.forEach(function(a){a.uri="panels/"+a.name+"/Panel.js"});a.styles.forEach(function(a){a.uri="styles/"+a.name+"/style.css"});a.layouts.forEach(function(a){a.uri="layouts/"+a.name+"/config.json";a.icon=
"layouts/"+a.name+"/icon.png";a.RTLIcon="layouts/"+a.name+"/icon_rtl.png"})}return{addManifestProperies:function(d){d.icon||(d.icon=d.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion);d.thumbnail||(d.thumbnail=d.folderUrl+"images/thumbnail.png");"theme"===d.category?a(d):("undefined"!==typeof d["2D"]&&(d.support2D=d["2D"]),"undefined"!==typeof d["3D"]&&(d.support3D=d["3D"]),"undefined"===typeof d["2D"]&&"undefined"===typeof d["3D"]&&(d.support2D=!0),delete d["2D"],delete d["3D"],"undefined"===
typeof d.properties&&(d.properties={}),X.processWidgetProperties(d))},processManifestLabel:function(a,d){var b=d.split("-")[0];a.label=a.i18nLabels&&(a.i18nLabels[d]||a.i18nLabels[b]||a.i18nLabels.defaultLabel)||a.label||a.name;a.layouts&&f.forEach(a.layouts,function(b){var g="i18nLabels_layout_"+b.name;b.label=a[g]&&(a[g][d]||a[g].defaultLabel)||b.label||b.name});a.styles&&f.forEach(a.styles,function(b){var g="i18nLabels_style_"+b.name;b.label=a[g]&&(a[g][d]||a[g].defaultLabel)||b.label||b.name})},
addI18NLabel:function(a){var d=new h;if(a.i18nLabels)return d.resolve(a),d;a.i18nLabels={};if(a.properties&&!1===a.properties.hasLocale)return d.resolve(a),d;var b;b=a.isRemote?a.amdFolder+"nls/strings.js":a.amdFolder+"nls/strings";require(x.getRequireConfig(),["dojo/i18n!"+b],function(b){var g={};g[dojoConfig.locale]=b;X.addI18NLabelToManifest(a,null,g);d.resolve(a)});return d}}}();x.isNumberField=function(a){return 0<=["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle",
"esriFieldTypeDouble"].indexOf(a)};x.getTime=function(a){var d=a.getTimezoneOffset(),d=0>d?"+"+Math.abs(d)/60:"-"+d/60;return a.getTime()+36E5*d};x.getUniqueValues=function(a,d,b,g,e){return function(){var d=new h,b={};g?(b.layerDefinition=g,e&&(b.fieldPopupInfo=e),d.resolve(b)):d=K({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(a){b.layerDefinition=a;return b},function(a){console.log("Error: ",a.message)});return d}().then(function(g){return x._getUniqueValues(a,
d,b,g.layerDefinition).then(function(a){return x._getValues(g.layerDefinition,g.fieldPopupInfo,d,a)})})};x._getValues=function(a,d,b,g){var e=[],e=x.getFieldInfoByFieldName(a.fields,b),m=null,u=x.isNumberField(e.type),h="esriFieldTypeDate"===e.type?!0:!1;if(e){if(u)g=f.map(g,function(a){a=parseFloat(a);isNaN(a)&&(a=null);return a});else if(h)return e=f.map(g,r.hitch(this,function(a){var b=a,g=a;x.isValidDate(a)&&(b=x.getDateTimeStrByFieldInfo(a,d),g=x.localizeDateByFieldInfo(a,d));return{value:b,
label:g}}));a=x.getCodedValueListForCodedValueOrSubTypes(a,b);if(null!==a)for(m={},b=0;b<a.length;b++)m[a[b].value]=a[b].label}return e=f.map(g,function(a){var b=null,b=null===a||void 0===a?"\x3cNull\x3e":m&&m.hasOwnProperty(a)?m[a]:u?d?x.localizeNumberByFieldInfo(a,d):x.localizeNumber(a):h?x.localizeDateByFieldInfo(new Date(a),d):a;return{value:a,label:b}})};x._getUniqueValues=function(a,d,b,g){var e=new h;a=a.replace(/\/*$/g,"");b||(b="1\x3d1");var e=/\/ImageServer$/gi.test(a),m=-1<a.indexOf("MapServer/dynamicLayer");
e||m?e=x._getUniqueValuesByQueryTask(a,d,b):(e=x.getFieldInfoByFieldName(g.fields,d),e=0<x.getCodedValuesOrTypesCount(e,g)?x._getUniqueValuesByQueryTask(a,d,b):x._getUniqueValuesByGenerateRenderer(a,d,b));return e};x.getCodedValuesOrTypesCount=function(a,d){return a?d.typeIdField&&d.typeIdField.toUpperCase()===a.name.toUpperCase()&&d.types?d.types.length:(a=x._getAllCodedValue(d,a))?a.length:0:0};x._getUniqueValuesByQueryTask=function(a,d,b){var g=new O;g.where=b;g.returnDistinctValues=!0;g.returnGeometry=
!1;g.outFields=[d];return(new Q(a)).execute(g).then(function(a){var b=[];a.features&&0<a.features.length&&f.forEach(a.features,function(a){a&&a.attributes&&b.push(a.attributes[d])});return b})};x._getUniqueValuesByGenerateRenderer=function(a,d,g){var e=new h,m=a.split("?");a=1<m.length?m[0].replace(/\/*$/g,"")+"/generateRenderer?"+m[1]:a.replace(/\/*$/g,"")+"/generateRenderer";d=b.stringify({type:"uniqueValueDef",uniqueValueFields:[d]});K({url:a,content:{classificationDef:d,f:"json",where:g},handleAs:"json",
callbackParamName:"callback"}).then(r.hitch(this,function(a){var d=[];(a=a&&a.uniqueValueInfos)&&0<a.length&&(d=f.map(a,r.hitch(this,function(a){return a.value})));e.resolve(d)}),r.hitch(this,function(a){e.reject(a)}));return e};x.isCodedValuesSupportFilter=function(a,d){a=a.currentVersion?a:a.toJson().layerDefinition;var b=parseFloat(a.currentVersion);return d<=parseFloat(a.maxRecordCount)&&10.1<b};x.combineRadioCheckBoxWithLabel=function(a,d){var b=!1;if(a&&1===a.nodeType&&"input"===a.tagName.toLowerCase()){var g=
a.getAttribute("type")||"",g=g.toLowerCase();if("radio"===g||"checkbox"===g)b=!0}g=!1;d&&1===d.nodeType&&"label"===d.tagName.toLowerCase()&&(g=!0);b&&g&&(b=a.getAttribute("id"),b||(b="input_"+x.getRandomString(),a.setAttribute("id",b)),d.setAttribute("for",b),l.setStyle(d,"cursor","pointer"))};x.groupRadios=function(a,d){var b=[],g="radiogroup_"+x.getRandomString();f.forEach(a,function(a){a.name=g;d&&(a=e(a,"change",d),b.push(a))});return b};x.convertExtentToPolygon=function(a){var d=a.xmin,b=a.xmax,
g=a.ymin,e=a.ymax;return new E({rings:[[[d,e],[b,e],[b,g],[d,g],[d,e]]],spatialReference:a.toJson()})};x.combineGeometries=function(a){function d(a){var d={points:[],spatialReference:a[0].spatialReference.toJson()};f.forEach(a,function(a){"point"===a.type?d.points=d.points.concat([[a.x,a.y]]):"multipoint"===a.type&&(d.points=d.points.concat(a.points))});return new A(d)}function b(a){var d={paths:[],spatialReference:a[0].spatialReference.toJson()};f.forEach(a,function(a){d.paths=d.paths.concat(a.paths)});
return new G(d)}function g(a){var d={rings:[],spatialReference:a[0].spatialReference.toJson()};f.forEach(a,function(a){"polygon"===a.type?d.rings=d.rings.concat(a.rings):"extent"===a.type&&(a=x.convertExtentToPolygon(a),d.rings=d.rings.concat(a.rings))});return new E(d)}var e=null;if(a&&0<a.length)if(1===a.length)e=a[0];else{for(var m=null,u=null,h=null,k=null,v=0;v<a.length;v++){m=a[v];switch(m.type){case "point":case "multipoint":k="point";break;case "polyline":k="polyline";break;case "polygon":case "extent":k=
"polygon";break;default:return null}if(0===v)h=k;else if(h!==k)return null;if(v!==a.length-1&&(u=a[v+1],!m.spatialReference.equals(u.spatialReference)))return null}"point"===k?e=d(a):"polyline"===k?e=b(a):"polygon"===k&&(e=g(a))}return e};x.combineGeometriesByGraphics=function(a){var d=null;a&&0<a.length&&(a=f.map(a,function(a){return a.geometry}),d=x.combineGeometries(a));return d};x.isFeaturelayerUrlSupportQuery=function(a,d){var b=!1,g=/\/featureserver\//gi.test(a);a=/\/mapserver\//gi.test(a);
d=(d||"").toLowerCase();g?b=0<=d.indexOf("query"):a&&(b=0<=d.indexOf("data"));return b};x.isImageServiceSupportQuery=function(a){return 0<=(a||"").toLowerCase().indexOf("catalog")};x.isStringEndWith=function(a,d){return a.lastIndexOf(d)+d.length===a.length};x._localizeNumber=function(d,b){var g=(d.toString().split(".")[1]||"").length,e="",e=b&&isFinite(b.places)&&b.places,e=0<e||0<g?"#,###,###,##0.0"+Array.prototype.join.call({length:0<e?e+1:g},"0"):"#,###,###,##0",g={locale:b&&b.locale||c.locale,
pattern:e};r.mixin(g,b||{});try{return a.format(d,g)}catch(ka){return console.error(ka),d.toLocaleString()}};x.localizeNumber=function(a,d){if(!x.isNumberOrNumberString(a))return a;a=Number(a);var b=!1;0>a&&(b=!0,a=Math.abs(a));a=x._localizeNumber(a,d);b&&(a=window.isRTL?a+"-":"-"+a);return a};x.parseNumber=function(d,b){var g={locale:c.locale};r.mixin(g,b||{});try{return a.parse(d,g)}catch(ia){return console.error(ia),d}};x.localizeDate=function(a,d){var b={locale:c.locale,fullYear:!0};r.mixin(b,
d||{});"ar"===c.locale&&"long"!==b.formatLength&&"full"!==b.formatLength&&(b.formatLength="long");try{return g.format(a,b)}catch(ia){return console.error(ia),"date"===b.selector?a.toLocaleDateString():"time"===b.selector?a.toLocaleTimeString():a.toLocaleString()}};x.localizeNumberByFieldInfo=function(a,b){var g=null,g=r.exists("format.places",b)&&b.format.places,g=x.localizeNumber(a,{places:g});return r.exists("format.digitSeparator",b)&&!b.format.digitSeparator?g.toString().replace(new RegExp("\\"+
d.group,"g"),""):g};x.localizeDateByFieldInfo=function(a,d){var b=null;try{var g={date:a instanceof Date?a.getTime():a},e=r.exists("format.dateFormat",d)?d.format.dateFormat:"longMonthDayYear",b=v.substitute(g,"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+C.prototype._dateFormats[e]}})}catch(ja){console.error(ja),b=a}return b};x.getDatePatternsByFormat=function(a){return C.prototype._dateFormatsJson[a]};x.localizeDateTimeByFieldInfo=function(a,d,b,g){var e={h:"h",m:"h:mm",s:"h:mm:ss"},
m={h:"H",m:"H:mm",s:"H:mm:ss"},u=function(a,d,b){a=x.getDatePatternsByFormat(a).datePattern;var g=e[d],g=b||"h"===d?e[d]+" a":m[d];return"(datePattern: '"+a+"', timePattern: '"+g+"', selector: 'date and time')"},h,k,c=null;try{var t={date:a instanceof Date?a.getTime():a};if(r.exists("format.dateFormat",d)){var D=d.format.dateFormat;b?k=0<D.indexOf("Time")?u(D,g,0>D.indexOf("24")):u(D,g):h=D.split("ShortTime")[0].split("LongTime")[0]}else b?k=u("longMonthDayYear",g):h="longMonthDayYear";k=k?k:C.prototype._dateFormats[h];
c=v.substitute(t,"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+k}})}catch(pa){console.error(pa),c=a}return c};x.getDateTimeStr=function(a,d){d=d?d:"YYYY-MM-DD HH:mm:ss";return B(a).format(d)};x.getDateByDateTimeStr=function(a){return B(a).toDate()};x.getDateByDateTimeStrAndFormat=function(a,d){a=x.getDateByDateTimeStr(a);r.exists("format.dateFormat",d)&&(d=d.format.dateFormat,0<=d.indexOf("ShortTime")?a.setSeconds(0):0>d.indexOf("Time")&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0)));
return a};x.getDateTimeStrByFieldInfo=function(a,d){var b="YYYY-MM-DD";r.exists("format.dateFormat",d)&&(d=d.format.dateFormat,0<=d.indexOf("LongTime")?b+=" HH:mm:ss":0<=d.indexOf("ShortTime")&&(b+=" HH:mm"));return B(a).format(b)};x.fieldFormatter={getFormattedUrl:function(a){if(a&&"string"===typeof a){var d=a.indexOf("http:");-1===d&&(d=a.indexOf("https:"));if(-1<d&&-1===a.indexOf("href\x3d")){var b=a.indexOf(" ",d);-1===b&&(b=a.length);var g=-1<a.indexOf("\r\n",d)?a.indexOf("\r\n",d):-1<a.indexOf("\n",
d)?a.indexOf("\n",d):b,b=g<b?g:b,g=a.substring(d,b);a=a.substring(0,d)+'\x3cA href\x3d"'+g+'" target\x3d"_blank"\x3e'+g+"\x3c/A\x3e"+a.substring(b,a.length)}}return null===a?"":a},getFormattedNumber:function(a,d){if("number"===typeof a){var b=(a.toString().split(".")[1]||"").length;a=x.localizeNumberByFieldInfo(a,{format:{places:d&&"number"===typeof d.places?parseInt(d.places,10):b,digitSeparator:d&&d.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(a||"")+"\x3c/span\x3e"}return a},
getFormattedDate:function(a,d){if("number"===typeof a||a instanceof Date)a=x.localizeDateByFieldInfo(a,{format:d});return a||""},getCodedValue:function(a,d){if(a&&a.codedValues){for(var b=0,g=a.codedValues.length;b<g;b++){var e=a.codedValues[b];if(v.isDefined(d)&&r.exists("code",e)&&d.toString()===e.code.toString())return e.name}return d}return d||null},getTypeName:function(a,d){for(var b=d.length,g=0;g<b;g++)if(a===d[g].id)return d[g].name;return a}};x.addRelativePathInCss=ba;x.url={isAbsolute:function(a){return a?
a.startWith("http")||a.startWith("/"):!1},removeQueryParamFromUrl:function(a,d){a=J.urlToObject(a);a.query&&delete a.query[d];d=a.path;for(var b in a.query)d=d===a.path?d+"?"+b+"\x3d"+a.query[b]:d+"\x26"+b+"\x3d"+a.query[b];return d},addQueryParamToUrl:function(a,d,b){a=J.urlToObject(a);a.query||(a.query={});a.query[d]=b;d=a.path;for(var g in a.query)d=d===a.path?d+"?"+g+"\x3d"+a.query[g]:d+"\x26"+g+"\x3d"+a.query[g];return d},compareUrl:function(a,d){a=this.getUrlPath(a);d=this.getUrlPath(d);a=V.removeProtocol(a.toString().toLowerCase()).replace(/\/+/g,
"/");d=V.removeProtocol(d.toString().toLowerCase()).replace(/\/+/g,"/");return a===d},getUrlPath:function(a){return J.urlToObject(a).path}};x.processUrlInWidgetConfig=function(a,d){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:a.startWith("${appPath}")?a.replace("${appPath}",window.appInfo.appPath):d+a};x.processUrlInAppConfig=function(a){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:window.appInfo.appPath+a};x.getLocationUrlWithoutHashAndQueryParams=
function(){var a=window.location,d=a.protocol+"//"+a.host+a.pathname,a=J.urlToObject(a.href);a.query&&a.query.apiurl&&(d=x.url.addQueryParamToUrl(d,"apiurl",a.query.apiurl));return d};x.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};x.invertColor=function(a){a=a.substring(1);3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?"#000000":"#ffffff"};x.isLightColor=function(a){a=a.substring(1);
3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?!0:!1};x.mixinAppConfigPosition=function(a,d){var b=r.clone(a);if(!d)return b;d=r.clone(d);var g=b.widgetOnScreen,e=d.widgetOnScreen;e&&e.widgets&&("[object Object]"===Object.prototype.toString.call(e.widgets)?f.forEach(g.widgets,function(a,d){d=a.uri?a.uri:"ph_"+d;e.widgets[d]&&e.widgets[d].position&&(e.widgets[d].position.relativeTo||(e.widgets[d].position.relativeTo=
"map"),a.position=e.widgets[d].position)},this):f.forEach(e.widgets,function(a,d){a.position&&!a.position.relativeTo&&(a.position.relativeTo="map");g.widgets[d]&&a.position&&(g.widgets[d].position=a.position)}));e&&e.groups&&("[object Object]"===Object.prototype.toString.call(e.groups)?f.forEach(g.groups,function(a,d){d=a.label?a.label:"g_"+d;e.groups[d]&&e.groups[d].panel&&e.groups[d].panel.position&&(e.groups[d].panel.position.relativeTo||(e.groups[d].panel.position.relativeTo="map"),a.panel.position=
e.groups[d].panel.position)},this):(a=a.layoutDefinition?a.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager","jimu/layoutManagers/AbsolutePositionLayoutManager"===a?f.forEach(e.groups,function(a,d){a.panel&&a.panel.position&&!a.panel.position.relativeTo&&(a.panel.position.relativeTo="map");g.groups[d]&&a.panel&&a.panel.position&&(g.groups[d].panel.position=a.panel.position)}):"jimu/layoutManagers/GridLayoutManager"===a&&(g.groups=aa(g.groups,e.groups.map(function(a){return a.id})))));
d.map&&d.map.position&&(b.map?b.map.position=d.map.position:b.map={position:d.map.position});d.widgetPool&&d.widgetPool.panel&&(d.widgetPool.panel.position&&!d.widgetPool.panel.position.relativeTo&&(d.widgetPool.panel.position.relativeTo="map"),b.widgetPool.panel.position=d.widgetPool.panel.position);d.mobileLayout&&(b.mobileLayout=d.mobileLayout);return b};x.handleGridLayoutOnScreenGroupChange=aa;x.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(a,
d,b){var g=-1;d=a.search(new RegExp(d));0<=d&&(a=a.slice(d,a.length),a=a.indexOf(b),g=d+a+b.length);return{firstPos:d,lastPos:g}},setConfigValue:function(a,d,b){S(a,d,b)},getConfigValue:function(a,d){return S(a,d)},setConfigValueWithId:function(a,d,b){ca(a,d,b)},getConfigValueWithId:function(a,d){return ca(a,d)},getKeyInfo:function(a){var d=this.getWidgetIdByKey(a);if(null!==d)return{type:"widget",id:d};a=this.getGroupIdByKey(a);return null!==a?{type:"group",id:a}:{type:"unknow",id:null}},getWidgetIdByKey:function(a){var d=
x.template.getSearchRange(a,x.template.widgetIdentification,"]");if(-1===d.firstPos)a=null;else{var b=a.slice(d.firstPos,d.lastPos);a=a.slice(d.firstPos+b.indexOf("[")+1,d.lastPos-1)}return a},getGroupIdByKey:function(a){var d=x.template.getSearchRange(a,x.template.groupIdentification,"]");if(-1===d.firstPos)a=null;else{var b=a.slice(d.firstPos,d.lastPos);a=a.slice(d.firstPos+b.indexOf("[")+1,d.lastPos-1)}return a},getConfigedWidgetsByTemplateConfig:function(a){var d=[],b=x.template.widgetIdentification+
"_config",g;f.forEach(a.configurationSettings,function(a){f.forEach(a.fields,function(a){a.fieldName&&(g=x.template.getSearchRange(a.fieldName,b,"]"),0<=g.firstPos&&(a=x.template.getWidgetIdByKey(a.fieldName),-1===d.indexOf(a)&&d.push(a)))},this)},this);return d},mergeTemplateAppConfigToAppConfig:function(a,d,b){function g(a){var d=[];f.forEach(a,function(a){a&&d.push(a)},this);return d}var e=a.widgetOnScreen,m=a.portalUrl;d.values.webmap&&(a.map.itemId=d.values.webmap);b&&(a.map.mapOptions&&x.deleteMapOptions(a.map.mapOptions),
a.map.portalUrl=m,d.values.app_title||(d.values.app_title=b.title),d.values.app_subtitle||(d.values.app_subtitle=b.snippet));for(var u in d.values)"webmap"!==u&&x.template.setConfigValueWithId(a,u,d.values[u]);a.widgetPool.widgets=g(a.widgetPool.widgets);e.widgets=g(e.widgets);if(a.widgetPool.groups)for(d=0;d<a.widgetPool.groups.length;d++)a.widgetPool.groups[d].widgets=g(a.widgetPool.groups[d].widgets);if(e.groups)for(d=0;d<e.groups.length;d++)e.groups[d].widgets=g(e.groups[d].widgets);return a}};
x.deleteMapOptions=function(a){a&&(delete a.extent,delete a.lods,delete a.center,delete a.scale,delete a.zoom,delete a.maxScale,delete a.maxZoom,delete a.minScale,delete a.minZoom)};x.sanitizeHTML=function(a){return a?html_sanitize(a,function(a){return a},function(a){return a}):a};x.stripHTML=function(a){return a?-1<a.indexOf("\x3c")&&-1<a.indexOf("\x3e")?a.replace(/<(?:.|\s)*?>/g,""):a:a};x.encodeHTML=function(a){return String(a).replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,
"\x26quot;").replace(/'/g,"\x26#39;")};x.removeSuffixSlashes=function(a){return a.replace(/\/*$/g,"")};x.getBestDisplayAttributes=function(a,d){var b={},g=null,e;for(e in a)g=x.getBestDisplayValue(e,a,d),b[e]=g;return b};x.getBestDisplayValue=function(a,d,b){var g="",e=null;r.isArrayLike(b)?e=x.getFieldInfoByFieldName(b,a):"object"===typeof b&&b.name===a&&(e=b);e&&(g=d[a],"esriFieldTypeDate"===e.type?g&&(a=new Date(parseInt(g,10)),g=x._tryLocaleDate(a)):"number"===typeof g&&(e.domain&&"codedValue"===
e.domain.type?f.some(e.domain.codedValues,function(a){if(a.code===g)return g=a.name,!0}):g=x._tryLocaleNumber(g)));if(null===g||void 0===g)g="";return g};x._getCodedValues=function(a){var d=null;(a=a.domain)&&"codedValue"===a.type&&a.codedValues&&0<a.codedValues.length&&(d=a.codedValues,d=f.map(d,r.hitch(this,function(a){return{value:a.code,label:a.name}})));return d};x._getSubTypes=function(a){var d=null;a.subtypeField&&a.subtypes&&0<a.subtypes.length&&(d=f.map(a.subtypes,r.hitch(this,function(a){return{value:a.id,
label:a.name}})));return d};x._getRenderTypes=function(a){var d=null;a.typeIdField&&a.types&&0<a.types.length&&(d=f.map(a.types,r.hitch(this,function(a){return{value:a.id,label:a.name}})));return d};x._getCodedValueOrSubtypes=function(a,d,b){var g=x.getFieldInfoByFieldName(a.fields,d);return void 0!==b&&null!==b?x._getCodedValueBySubTypeId(a,d,b,g):x._getAllCodedValue(a,g)};x._getDisplayValueForCodedValueOrSubtype=function(a,d,b,g){var e={isCodedValueOrSubtype:!1,displayValue:b+""};(a=x._getCodedValueOrSubtypes(a,
d,g))&&0<a.length&&f.some(a,r.hitch(this,function(a){return a.value===b?(e={isCodedValueOrSubtype:!0,displayValue:a.label},!0):!1}));return e};x._deleteSubtypePropertiesTemp=function(a){delete a.subtypeField;delete a.subtypes};x.getDisplayValueForCodedValueOrSubtype=function(a,d,b){x._deleteSubtypePropertiesTemp(a);var g=b[d],e,m=a.typeIdField;b.hasOwnProperty(m)&&(e=b[m]);(m=a.subtypeField)&&a.subtypes&&0<a.subtypes.length&&b.hasOwnProperty(m)&&(e=b[m]);g=x._getDisplayValueForCodedValueOrSubtype(a,
d,g,e);a.typeIdField===d&&(g.displayValue=x._updateCodedValueListFromRender(a,[{value:b[d],label:g.displayValue}])[0].label);return g};x._getDisplayValueFromCodedValues=function(a,d){var b={isCodedValueOrSubtype:!1,displayValue:a+""};d&&0<d.length&&f.some(d,r.hitch(this,function(d){return d.value===a?(b={isCodedValueOrSubtype:!0,displayValue:d.label},!0):!1}));b.value=a;return b};x.getDisplayValueForCodedValueOrSubtypeBatch=function(a,d,b){x._deleteSubtypePropertiesTemp(a);var g={},e=a.typeIdField,
m=a.subtypeField,u=x.getFieldInfoByFieldName(a.fields,d);m&&a.subtypes&&0<a.subtypes.length?(g.subType=x._getSubTypes(a),e=m,g.all=x._getAllCodedValueNew(a,u)):(g.all=x._getAllCodedValue(a,u),g.subType=x._getRenderTypes(a));if(g.subType&&0<g.subType.length){var m=g.subType,h;for(h in m){var k=m[h].value,v=x._getCodedValueBySubTypeId(a,d,k,u);g[k]=a.typeIdField===d?x._updateCodedValueListFromRender(a,v):v}}a.typeIdField===d&&(g.subType=x._updateCodedValueListFromRender(a,g.subType),g.all=x._updateCodedValueListFromRender(a,
g.all));k=[];h=[];for(var c in b)k=b[c],m=k[d],e===d?k=g.subType:k.hasOwnProperty(e)?(k=k[e],k=g[k],k||(k=x._getCodedValues(u),a.typeIdField===d&&(k=x._updateCodedValueListFromRender(a,k)))):k=g.all,m=x._getDisplayValueFromCodedValues(m,k),h.push(m);return h};x._getUniquCodedValue=function(a,d,b){a[d]?b!==a[d]&&(a[d]=a[d]+", "+b):a[d]=b;return a};x._getAllCodedValue=function(a,d){var b=d.name,g={},e=null,m=!0;if(a.typeIdField&&a.types&&0<a.types.length)f.map(a.types,r.hitch(this,function(a){a.domains&&
a.domains[b]&&(a=a.domains[b],"inherited"===a.type?m&&(m=!1,a=x._getCodedValues(d),f.map(a,r.hitch(this,function(a){g=x._getUniquCodedValue(g,a.value,a.label)}))):a.codedValues&&0<a.codedValues.length&&f.map(a.codedValues,r.hitch(this,function(a){g=x._getUniquCodedValue(g,a.code,a.name)})))})),e||(e=x._getCodedValues(d));else return this._getCodedValues(d);a=[];var u=x.isNumberField(d.type),h;for(h in g){var k=u?parseFloat(h):h;a.push({value:k,label:g[h]})}0<a.length&&(e=a);return e};x._getAllCodedValueNew=
function(a,d){var b=d.name,g={},e=null,m=!0;if(a.subtypeField&&a.subtypes&&0<a.subtypes.length)f.map(a.subtypes,r.hitch(this,function(a){a.domains&&a.domains[b]&&(a=a.domains[b],"inherited"===a.type?m&&(m=!1,a=x._getCodedValues(d),f.map(a,r.hitch(this,function(a){g=x._getUniquCodedValue(g,a.value,a.label)}))):a.codedValues&&0<a.codedValues.length&&f.map(a.codedValues,r.hitch(this,function(a){g=x._getUniquCodedValue(g,a.code,a.name)})))})),e||(e=x._getCodedValues(d));else return this._getCodedValues(d);
a=[];var u=x.isNumberField(d.type),h;for(h in g){var k=u?parseFloat(h):h;a.push({value:k,label:g[h]})}0<a.length&&(e=a);return e};x._getCodedValueBySubTypeId=function(a,d,b,g){var e="typeIdField",m="types";a.subtypeField&&a.subtypes&&0<a.subtypes.length&&(e="subtypeField",m="subtypes");var u=null;g=g?g:x.getFieldInfoByFieldName(a.fields,d);a[e]&&a[m]&&0<a[m].length?(f.map(a[m],r.hitch(this,function(m){if(m.id===b){if(d===a[e])return u=[{value:m.id,label:m.name}],!0;m.domains&&m.domains[d]?(m=m.domains[d],
"inherited"===m.type?u=x._getCodedValues(g):m.codedValues&&0<m.codedValues.length&&(u=f.map(m.codedValues,r.hitch(this,function(a){return{value:a.code,label:a.name}})))):m.domains&&(u=x._getCodedValues(g))}})),u||(u=x._getCodedValues(g))):u=x._getCodedValues(g);return u};x.getCodedValueListForCodedValueOrSubTypes=function(a,d,b){x._deleteSubtypePropertiesTemp(a);var g=null,g=x.getFieldInfoByFieldName(a.fields,d),e,m;b&&(e=b[a.typeIdField],m=b[a.subtypeField]);if(a.subtypeField&&a.subtypes&&0<a.subtypes.length)return d===
a.subtypeField?(g=x._getSubTypes(a),void 0!==m&&(b=x._getDisplayValueFromCodedValues(m,g),g=[{value:b.value,label:b.displayValue}])):g=void 0===m?x._getAllCodedValueNew(a,g):x._getCodedValueBySubTypeId(a,d,m,g),d===a.typeIdField&&(g=x._updateCodedValueListFromRender(a,g)),g;a.subtypeField="";a.subtypes=[];a.typeIdField&&a.typeIdField.toUpperCase()===d.toUpperCase()?(g=x._getRenderTypes(a),b&&void 0!==e&&null!==e&&(b=x._getDisplayValueFromCodedValues(e,g),g=[{value:b.value,label:b.displayValue}])):
g=b&&void 0!==e&&null!==e?x._getCodedValueBySubTypeId(a,d,e,g):x._getAllCodedValue(a,g);d===a.typeIdField&&(g=x._updateCodedValueListFromRender(a,g));return g};x._verifyIfFieldIsSubtypeField=function(a,d){var b={isSubtypeField:!1,subtypeField:""};if(a.subtypeField)return b={isSubtypeField:a.subtypeField===d.name,subtypeField:a.subtypeField};["esriFieldTypeSmallInteger","esriFieldTypeInteger"].indexOf(d.type)&&a.typeIdField===d.name&&a.types&&0<a.types.length&&(void 0===a.types[0].domains[d.name]?
b={isSubtypeField:!0,subtypeField:d.name}:b.isSubtypeField=!1);return!1};x._getRendererFromLayerDef=function(a){var d=null;a.drawingInfo&&a.drawingInfo.renderer&&"uniqueValue"===a.drawingInfo.renderer.type&&(d=a.drawingInfo.renderer);return d};x._getRenderValueLabelsForUnique=function(a){var d=null,b=null,g=x._getRendererFromLayerDef(a);g?(d={},b=g.uniqueValueInfos):a.renderer&&(g=a.toJson().layerDefinition,g=x._getRendererFromLayerDef(g),a=a.renderer.toJson(),"uniqueValue"===a.type&&g&&g.field1===
a.field1?(d={},b=a.uniqueValueInfos):g&&(d={},b=g.uniqueValueInfos));if(b)for(a=0;a<b.length;a++)g=b[a],d[g.value]=g.label;return d};x._updateCodedValueListFromRender=function(a,d){if((a=x._getRenderValueLabelsForUnique(a))&&d)for(var b=0;b<d.length;b++){var g=d[b];a[g.value]&&(g.label=a[g.value])}return d};x.getDefaultPortalFieldInfo=function(a){var d=a.name,d={fieldName:d,label:a.alias||d,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(a.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":d.format=
{places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":d.format={places:2,digitSeparator:!0};break;case "esriFieldTypeDate":d.format={dateFormat:"longMonthDayYear"}}return d};x.getDefaultPopupInfo=function(a,d,b){var g=null;a&&a.fields&&(g={title:d,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},f.forEach(a.fields,function(a){var d=!1;b?f.some(b,r.hitch(this,function(d){return d&&a.name.toLowerCase()===d.toLowerCase()}))&&(d=!0):d=!0;d&&(d=this.getDefaultPortalFieldInfo(a),
d.visible=!0,d.isEditable=a.editable,g.fieldInfos.push(d))},this));return g};x._tryLocaleNumber=function(a){var d=x.localizeNumber(a);if(null===d||void 0===d)d=a;return d};x._tryLocaleDate=function(a){var d=x.localizeDate(a);d||(d=a.toLocaleDateString());return d};x.getFieldInfoByFieldName=function(a,d){var b=null;a&&0<a.length&&f.some(a,r.hitch(this,function(a){return a.name===d?(b=a,!0):!1}));return b};x.getDateFieldFormatByFieldName=function(a,d){if(a&&0<a.length)for(var b=0;b<a.length;b++){var g=
a[b];if(g.fieldName===d){if(g.format&&g.format.dateFormat)return g.format.dateFormat;break}}return""};x.completePopupFieldFromLayerField=function(a,d){if(!d)return a;for(var b in a){var g=a[b].name,e=!1,m;for(m in d)if(d[m].fieldName===g){e=!0;break}e||(g=x.getPopupFieldFromLayerField(a[b]),d.push(g))}return d};x.getPopupFieldFromLayerField=function(a){return{fieldName:a.name,isEditable:a.editable,label:a.alias,visible:a.visible?a.visible:!1,stringFieldOption:"esriFieldTypeString"===a.type?"textbox":
null,tooltips:"",domain:a.domain?a.domain:null}};x.containsNonLatinCharacter=function(a){for(var d=0;d<a.length;d++)if(255<a.charCodeAt(d))return!0;return!1};x.has=function(a){var d=p(a);if(d)return d;if("ie"===a.toLowerCase()){a=0;var b=/MSIE (\d+\.\d+);/.test(navigator.userAgent),g=!!navigator.userAgent.match(/Trident\/7.0/),e=navigator.userAgent.indexOf("rv:11.0");b&&(a=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(a=10);g&&-1!==e&&(a=11);return 11===a&&11||d}if("edge"===a.toLowerCase())return navigator.userAgent.split("Edge/")[1]||
d};x.detectUserAgent=function(){return window.userAgent};x.isMobileUa=function(){return window.isMobileUa};x.inMobileSize=function(){var a=l.getMarginBox(document.body);if(a.w<=window.jimuConfig.breakPoints[0]||a.h<=window.jimuConfig.breakPoints[0])return l.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;l.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1};x.getObjectIdField=function(a){if(a.objectIdField)return a.objectIdField;a=a.fields;for(var d=0;d<a.length;d++){var b=a[d];
if("esriFieldTypeOID"===b.type)return b.name}return null};x.isNeedHttpsButNot=function(){var a=navigator.geolocation,d=window.hasOwnProperty("isSecureContext");return(d&&window.isSecureContext||!d&&"https:"===window.location.protocol)&&a?!1:!0};x.toFeatureSet=function(a){var d=new N;"[object Object]"===Object.prototype.toString.call(a)&&(a=[a]);d.features=a;if(0<a.length){var b;f.some(a,function(a){if(a.geometry)return b=a,!0});if(b){a=b.getLayer();var g={};a&&(d.displayFieldName=a.displayField,f.forEach(a.fields,
r.hitch(this,function(a){var d=a.name;g[d]=a.alias||d})),d.fieldAliases=g);d.geometryType=b.geometry.type;d.spatialReference=b.geometry.spatialReference}}return d};x.showValidationErrorTipForFormDijit=function(a){try{!a.validate()&&a.domNode&&a.focusNode&&(a.focusNode.focus(),setTimeout(r.hitch(this,function(){a.focusNode.blur()}),100))}catch(fa){console.error(fa)}};x.getFeatureLayerDefinition=function(a){var d=null,b=a.graphics;a.graphics=[];var g=a.toJson();a.graphics=b;g&&(d=g.layerDefinition);
return d};x.simulateClickEvent=function(a){if(p("safari")){var d=document.createEvent("MouseEvents");d.initEvent("click",!0,!0);a.dispatchEvent(d)}else a.click()};x.getFeatureSetByLayerAndFeatures=function(a,d){var b=new N;b.fields=r.clone(a.fields);b.features=d;b.geometryType=a.geometryType;b.fieldAliases={};f.forEach(b.fields,r.hitch(this,function(a){var d=a.name;b.fieldAliases[d]=a.alias||d}));return b};x.featureAction=function(){return{zoomTo:function(a,d,b){b||(b={});if(a&&d&&0<d.length){var g=
f.every(d,function(a){return a&&a.spatialReference&&a.type});if(f.every(d,function(a){return a&&a.geometry&&a.geometry.spatialReference&&a.geometry.type})||g)g&&(d=f.map(d,function(a){return{geometry:a}})),x.zoomToFeatureSet(a,{features:d},b.extentFactor)}},flash:function(a,d){function b(a,d){f.forEach(e,function(b,g){b.setSymbol(d?a:m[g]||u)})}function g(a){return function(){setTimeout(function(){b(h,!0);e[0]&&d&&d.redraw();setTimeout(function(){b(null,!1);e[0]&&d&&d.redraw();a()},200)},200)}}if(f.every(a||
[],function(a){return a&&a.geometry})){var e=a;a=e[0];var m=f.map(e,function(a){return a.symbol}),u=a.symbol||r.getObject("renderer.symbol",!1,d),h=null;d&&"esriGeometryPoint"===d.geometryType?h=new M(require.toUrl("jimu")+"/images/flash.gif",20,20):(h=r.clone(u))&&(h.outline?h.outline.setColor("#ffc500"):h.setColor("#ffc500"));a&&u&&h&&d&&("esriGeometryPoint"===d.geometryType?(b(h,!0),d.redraw(),setTimeout(function(){b(null,!1);d.redraw()},2E3)):g(g(g(function(){})))())}},panTo:function(a,d){f.every(d||
[],function(a){return a&&a.geometry})&&(0<d.length?d=P.graphicsExtent(d).getCenter():(d=d[0].geometry,d="polyline"===d.type||"polygon"===d.type?d.getExtent().getCenter():"extent"===d.type?d.getCenter():"multipoint"===d.type?1<d.points.length?d.getExtent().getCenter():d.getPoint(0):d),a.centerAt(d))},showPopup:function(a,d){f.every(d||[],function(a){return a&&a.geometry})&&(a=a.infoWindow,a.setFeatures(d),d=d[0],"point"===d.geometry.type?a.show(d.geometry,{closetFirst:!0}):a.show(d.geometry.getExtent().getCenter(),
{closetFirst:!0}))}}}();x.isInConfigOrPreviewWindow=function(){var a=!1;try{a=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(fa){a=!1}return!!a};x.getAppHref=function(){var a="";return a=x.isInConfigOrPreviewWindow()?window.parent.location.href:window.location.href};x.getAppIdFromUrl=function(){var a=!0,d=x.getAppHref();if(-1!==d.indexOf("id\x3d")||-1!==d.indexOf("appid\x3d")||-1!==d.indexOf("apps"))a=!1;if(!0===a)return d;a=this.urlToObject(window.location.href);
if(a.query&&(a.query.id||a.query.appid))return a.query.id||a.query.appid;if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(a=window.appInfo.appPath.split("/"),a.length&&2<a.length)return a[a.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};x.getEditorContentHeight=function(a,d,b){var g=new h;this._content=a;this._dom=d;this._domParam=b;var e=setTimeout(r.hitch(this,function(){clearTimeout(e);e=null;var a=0,d=this._domParam.contentWidth;try{var b=
document.createElement("div");b.setAttribute("id","fakeContent");l.setStyle(b,"background-size","contain");b.innerHTML=this._content;this._dom.appendChild(b);if(b){var m=n("img",b);m&&m.length&&m.style({maxWidth:d-20+"px"});l.setStyle(b,"position","absolute");l.setStyle(b,"width",d+"px");l.setStyle(b,"left","-99999px");l.setStyle(b,"top","-99999px");l.setStyle(b,"visibility","hidden");var u=l.getContentBox(b);u.h&&(a=u.h,a+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(na){console.error("can't getEditorContentHeight"+
na),a=200}g.resolve(a)}),1500);return g};x.getBase64Data=function(a){var d=new h;if(a&&a.startWith("data:image"))d.resolve(a);else try{K({url:a,handleAs:"arraybuffer"}).then(function(a){var b=new FileReader;b.onloadend=function(){d.resolve(b.result)};b.onerror=function(){d.resolve(null)};b.readAsDataURL(new Blob([a],{type:"image/png"}))},function(){d.resolve(null)})}catch(da){console.warn(da),d.resolve(null)}return d};x.getEditorTextColor=function(a,d){return{name:"dijit.editor.plugins.EditorTextColor",
custom:{recordUID:x.getColorRecordName(a),forceAttr:d}}};x.getEditorBackgroundColor=function(a){return{name:"dijit.editor.plugins.EditorBackgroundColor",custom:{recordUID:x.getColorRecordName(a)}}};x.getColorRecordName=function(a){return"wab_cr_"+(a||"")};x.b64toBlob=function(a,d,b){d=d||"";b=b||512;a=window.atob(a.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""));for(var g=[],e=0;e<a.length;e+=b){for(var m=a.slice(e,e+b),u=Array(m.length),h=0;h<m.length;h++)u[h]=m.charCodeAt(h);m=new Uint8Array(u);
g.push(m)}return new Blob(g,{type:d})};x.subtractionArray=function(a,d){for(var b=a.length-1;0<=b;b--)for(var g=a[b],e=d.length-1;0<=e;e--)if(g===d[e]){a.splice(b,1);d.splice(e,1);break}return a};x.resourcesUrlToBlob=function(a){return K({url:a,handleAs:"blob"})};x.processItemResourceOfAppConfig=function(a,d){function b(a){var d=a.obj,b=a.key,g={obj:d,key:b};"number"===typeof a.i?(g.i=a.i,g.value=d[b][a.i]):g.value=d[b];return g}function g(a){for(var d in a)if("object"===typeof a[d])if(Array.isArray(a[d]))for(var b=
a,m=d,u=0;u<b[m].length;u++)"string"===typeof b[m][u]?e(b,m,u):"object"===typeof b[m][u]&&g(b[m][u]);else g(a[d]);else"string"===typeof a[d]&&e(a,d)}function e(a,g,e){"number"===typeof e?d.test(a[g][e])&&(h=d.func(b({obj:a,key:g,i:e})),"function"===typeof h.then?u.push(h):m.push(h)):d.test(a[g])&&(h=d.func(b({obj:a,key:g})),"function"===typeof h.then?u.push(h):m.push(h))}var m=[],u=[],h;g(a);return 0<u.length?t(u).then(function(d){0<m.length&&(d=d.concat(m));return{appConfig:a,result:d}}):{appConfig:a,
result:m}};x.isEsriDomain=function(a){return/^https?:\/\/(?:[\w\-\_]+\.)+(?:esri|arcgis)\.com/.test(a)};x.uniqueArray=function(a){for(var d=[],b=0;b<a.length;b++)-1===d.indexOf(a[b])&&d.push(a[b]);return d};x.isNotEmptyObject=function(a,d){return d?x.isObject(a)&&0<Object.keys(a).length&&Array.isArray(a):x.isObject(a)&&0<Object.keys(a).length};x.getMinOfArray=function(a){return Number(Math.min.apply(Math,a))};x.getDataSchemaFromLayerDefinition=function(a){var d=a.fields.filter(function(a){return"esriFieldTypeOID"===
a.type}),d=0<d.length?d[0]:null;return{geometryType:a.geometryType,fields:a.fields,displayField:a.displayField,objectIdField:d,typeIdField:a.typeIdField}};x.isValidPointGeometry=function(a){return a&&"point"===a.type&&x.isTrueOrZero(a.x)&&x.isTrueOrZero(a.y)};x.isVaildPointGeometry=x.isValidPointGeometry;x.isNumberOrNumberString=function(a){return/^-?[1-9]\d*$/.test(a)||/^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$/.test(a)};x.convertNumberToPercentage=function(a,d,b){if(!x.isNumberOrNumberString(a))return a;
"undefined"===typeof b&&(b=!0);"undefined"===typeof d&&(d=2);d={format:{places:d,digitSeparator:b}};b=c.locale;b="ar"===b||"tr"===b;a=Number(a);var g=!1;0>a&&(g=!0,a=Math.abs(a));a=x.localizeNumberByFieldInfo(100*a,d);a=b?"%"+a:a+"%";g&&(a=window.isRTL?a+"-":"-"+a);return a};x.getClientFeaturesFromMap=function(a,d,b,g){var e=[],m=!1;if(d){b?0<d.getSelectedFeatures().length?(e=d.getSelectedFeatures(),m=!0):e=d.graphics:e=d.graphics;g&&(e=x.filterFeaturesByExtent(a.extent,e));if(e&&0<e.length){var u=
x.getObjectIdField(d);u&&(a=e[0])&&a.attributes&&a.attributes.hasOwnProperty(u)&&e.sort(function(a,d){a.attributes||(a.attributes={});d.attributes||(d.attributes={});a=a.attributes[u];d=d.attributes[u];return a<d?-1:a>d?1:0})}e.isSelectedFeatures=m;return e}};x.filterFeaturesByExtent=function(a,d){var b=a.normalize();return d=f.filter(d,r.hitch(this,function(a){try{if(a.geometry){var d="point"===a.geometry.type||"multipoint"===a.geometry;return f.some(b,r.hitch(this,function(b){return d?b.contains(a.geometry):
w.intersects(b,a.geometry)}))}}catch(ja){console.error(ja)}return!1}))};x.upperCaseString=function(a){return a&&"string"===typeof a?a.toUpperCase():a};x.lowerCaseString=function(a){return a&&"string"===typeof a?a.toLowerCase():a};x.getSubstituteString=function(a,d){return v.substitute({value:a},d)};x.getUUID=function(){function a(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return a()+a()+"_"+a()+"_"+a()+"_"+a()+"_"+a()+a()+a()};x.checkEssentialAppsLicense=function(a,d,b){var g=V.getStandardPortalUrl(window.portalUrl),
e=V.getSharingUrl(g),g=new I({appId:"arcgisWebApps",portalUrl:g});R.registerOAuthInfos([g]);return b?R.checkAppAccess(e,"arcgisWebApps"):d.getItemById(a).then(function(a){return"public"===a.access?{}:R.checkAppAccess(e,"arcgisWebApps")})};x.getStyleColorInTheme=function(a){var d=new h,b,g;window&&window.isBuilder?(g="./stemapp/themes/",b=window.appConfig):(g="./themes/",b=window.getAppConfig());if(b&&b.theme.customStyles&&b.theme.customStyles.mainBackgroundColor)return d.resolve(b.theme.customStyles.mainBackgroundColor),
d.promise;var e=b.theme.name,m=b.theme.styles[0];a&&(m=a);K({url:g+e+"/manifest.json",handleAs:"json"}).then(r.hitch(this,function(a){if(a&&a.styles){a=a.styles;for(var b=0;b<a.length;b++){var g=a[b];g.name===m&&d.resolve(g.styleColor)}}}),r.hitch(this,function(a){console.error(a);d.reject(null)}));return d.promise};x.themesHeaderLogoA11y=function(a,d,b){a.logoLink?(l.setAttr(b.link,"href",a.logoLink),l.setAttr(b.link,"tabIndex",d),l.setAttr(b.link,"target","_blank"),l.setAttr(b.logo,"alt",a.logoLink),
l.setStyle(b.icon,"cursor","pointer")):(l.setAttr(b.link,"href","javascript:void(0)"),l.setAttr(b.link,"tabIndex",-1),l.setAttr(b.link,"target",""),l.removeAttr(b.logo,"alt"),l.setAttr(b.logo,"role","presentation"),l.setStyle(b.icon,"cursor","default"));a.logoAlt&&l.setAttr(b.logo,"alt",a.logoAlt)};return x})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(r,f,l){var p=r.NodeList;f.extend(p,{_buildArrayFromCallback:function(c){for(var f=[],n=0;n<this.length;n++){var k=
c.call(this[n],this[n],f);k&&(f=f.concat(k))}return f},_getUniqueAsNodeList:function(c){for(var f=[],n=0,k;k=c[n];n++)1==k.nodeType&&-1==l.indexOf(f,k)&&f.push(k);return this._wrap(f,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(c,f){c=this._getUniqueAsNodeList(c);c=f?r._filterResult(c,f):c;return c._stash(this)},_getRelatedUniqueNodes:function(c,f){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(f),c)},children:function(c){return this._getRelatedUniqueNodes(c,
function(c,n){return f._toArray(c.childNodes)})},closest:function(c,f){return this._getRelatedUniqueNodes(null,function(n,k){do if(r._filterResult([n],c,f).length)return n;while(n!=f&&(n=n.parentNode)&&1==n.nodeType);return null})},parent:function(c){return this._getRelatedUniqueNodes(c,function(c,f){return c.parentNode})},parents:function(c){return this._getRelatedUniqueNodes(c,function(c,f){for(f=[];c.parentNode;)c=c.parentNode,f.push(c);return f})},siblings:function(c){return this._getRelatedUniqueNodes(c,
function(c,f){f=[];for(var k=c.parentNode&&c.parentNode.childNodes,h=0;h<k.length;h++)k[h]!=c&&f.push(k[h]);return f})},next:function(c){return this._getRelatedUniqueNodes(c,function(c,f){for(c=c.nextSibling;c&&1!=c.nodeType;)c=c.nextSibling;return c})},nextAll:function(c){return this._getRelatedUniqueNodes(c,function(c,f){for(f=[];c=c.nextSibling;)1==c.nodeType&&f.push(c);return f})},prev:function(c){return this._getRelatedUniqueNodes(c,function(c,f){for(c=c.previousSibling;c&&1!=c.nodeType;)c=c.previousSibling;
return c})},prevAll:function(c){return this._getRelatedUniqueNodes(c,function(c,f){for(f=[];c=c.previousSibling;)1==c.nodeType&&f.push(c);return f})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(c,f){return 0!=f%2})},odd:function(){return this.filter(function(c,f){return 0==f%2})}});return p})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],
function(r){r=r.getObject("dojox.encoding.base64",!0);r.encode=function(f){for(var l=[],p=f.length,c=p%3,p=p-c,q=0;q<p;){var n=f[q++]<<16|f[q++]<<8|f[q++];l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>18&63));l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>12&63));l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>6&63));l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n&
63))}switch(c){case 2:n=f[q++]<<16|f[q++]<<8;l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>18&63));l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>12&63));l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>6&63));l.push("\x3d");break;case 1:n=f[q++]<<16,l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>18&63)),l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(n>>>
12&63)),l.push("\x3d"),l.push("\x3d")}return l.join("")};r.decode=function(f){f=f.split("");for(var l=[],p=f.length;"\x3d"==f[--p];);for(var c=0;c<p;){var q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[c++])<<18;c<=p&&(q|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[c++])<<12);c<=p&&(q|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[c++])<<6);c<=p&&(q|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[c++]));
l.push(q>>>16&255);l.push(q>>>8&255);l.push(q&255)}for(;0==l[l.length-1];)l.pop();return l};return r})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(r,f,l,p,c,q,n,k){r=r(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var h=l.map(this.geometries,function(e){return e.toJson()}),
c={};c.outSR=this.outSR.wkid||p.toJson(this.outSR.toJson());c.inSR=this.geometries[0].spatialReference.wkid||p.toJson(this.geometries[0].spatialReference.toJson());c.geometries=p.toJson({geometryType:k.getJsonType(this.geometries[0]),geometries:h});this.transformation&&(c.transformation=this.transformation.wkid||p.toJson(this.transformation));n.isDefined(this.transformForward)&&(c.transformForward=this.transformForward);return c}});c("extend-esri")&&f.setObject("tasks.ProjectParameters",r,q);return r})},
"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(r,f){var l=r.clone(f);l.declaredClass="jimu.portalUrlUtils";l.getPortalUrlFromLocation=function(){return l.getPortalServerFromLocation()+l.getDeployContextFromLocation()};l.getPortalSignInUrlFromLocation=function(){var f=l.getPortalUrlFromLocation();return l.setHttpsProtocol(f+"home/signin.html")};l.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};
l.getDeployContextFromLocation=function(){var f=window.location.href.split("?")[0],c=f.indexOf("/home/");0>c&&(c=f.indexOf("/apps/"));f=f.substring(f.indexOf(window.location.host)+window.location.host.length+1,c);"/"!==f&&(f="/"+f+"/");return f};l.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+l.getDeployContextFromLocation()+"sharing/rest/"};return l})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var r={declaredClass:"jimu.shared.basePortalUrlUtils"};
"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(f){return this.substr(0,f.length)===f});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(f){return this.substr(this.length-f.length,f.length)===f});r.getServerByUrl=function(f){f=(f||"").trim();f=f.replace(/^(http(s?):?)\/\//gi,"");0===f.indexOf("//")&&
(f=f.slice(2));return f.split("/")[0]};r.getServerWithProtocol=function(f){var l="";if(f=(f||"").trim()){var p=r.getServerByUrl(f);if(!p)return l;var c=r.getProtocol(f);c?l=c+"://"+p:0===f.indexOf("//")&&(l="//"+p)}return l};r.isSameServer=function(f,l){f=r.getServerByUrl(f)||"";l=r.getServerByUrl(l)||"";return f.toLowerCase()===l.toLowerCase()};r.getDomain=function(f){var l="";if(f=r.getServerByUrl(f))f=f.replace(/:\d+$/,""),f=f.match(/[^.]\w+\.\w+$/),null!==f&&(l=f[0],/^\d+\.\d+$/.test(l)&&(l=""));
return l};r.isSameDomain=function(f,l){f=r.getDomain(f);l=r.getDomain(l);return""!==f&&f===l};r.isOrgOnline=function(f){return 0<=r.getServerByUrl(f).toLowerCase().indexOf(".maps.arcgis.com")};r.isOnline=function(f){return 0<=r.getServerByUrl(f).toLowerCase().indexOf(".arcgis.com")};r.isArcGIScom=function(f){f=r.getServerByUrl(f).toLowerCase();return"www.arcgis.com"===f||"arcgis.com"===f};r.getStandardPortalUrl=function(f){var l=r.getServerByUrl(f);if(""===l)return"";r.isOnline(l)?(r.isArcGIScom(l)&&
(l="www.arcgis.com"),f=r.addProtocol(f),f=r.getProtocol(f)+"://"+l):(f=(f||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),f=r.addProtocol(f),f.replace(new RegExp("http(s?)://"+l,"g"),"")||(f+="/arcgis"));return f};r.isSamePortalUrl=function(f,l){var p=/^http(s?):\/\//gi,c=/^\/\//gi;f=r.getStandardPortalUrl(f).toLowerCase().replace(p,"").replace(c,"");l=r.getStandardPortalUrl(l).toLowerCase().replace(p,"").replace(c,"");return f===l};r.addProtocol=function(f){if(-1>=f.toLowerCase().indexOf("http://")&&
-1>=f.toLowerCase().indexOf("https://")){var l="";"undefined"!==typeof window&&window.location?(l=window.location.protocol,f=f.startWith("//")?l+f:f.startWith("/")?l+"//"+window.location.host+f:l+"//"+f):(l="http:",f=f.startWith("//")?l+f:l+"//"+f)}return f};r.getProtocol=function(f){var l="";f=f.toLowerCase();0===f.indexOf("https://")?l="https":0===f.indexOf("http://")&&(l="http");return l};r.updateUrlProtocolByOtherUrl=function(f,l){l=l.toLowerCase();0===l.indexOf("https://")?f=r.setHttpsProtocol(f):
0===l.indexOf("http://")&&(f=r.setHttpProtocol(f));return f};r.removeProtocol=function(f){return f.replace(/^http(s?):\/\//i,"//")};r.setHttpProtocol=function(f){f=r.addProtocol(f);return f.replace(/^https:\/\//,"http://")};r.setHttpsProtocol=function(f){f=r.addProtocol(f);return f.replace(/^http:\/\//,"https://")};r.setProtocol=function(f,l){return 0<=l.indexOf("https")?r.setHttpsProtocol(f):0<=l.indexOf("http")?r.setHttpProtocol(f):f};r.getSharingUrl=function(f){var l="";(f=r.getStandardPortalUrl(f))&&
(l=f+"/sharing/rest");return l};r.getOAuth2Url=function(f){var l="";(f=r.getStandardPortalUrl(f))&&(l=f+"/sharing/rest/oauth2");return l};r.getAppIdUrl=function(f,l){var p="";(f=r.getStandardPortalUrl(f))&&(p=f+"/sharing/rest/oauth2/apps/"+l);return p};r.getSignInUrl=function(f){var l="";(f=r.getStandardPortalUrl(f))&&(l=f+"/home/signin.html");return l};r.getBaseSearchUrl=function(f){var l="";f=r.getStandardPortalUrl(f);(f=f.replace(/\/*$/g,""))&&(l=f+"/sharing/rest/search");return l};r.getBaseItemUrl=
function(f){var l="";(f=r.getStandardPortalUrl(f))&&(l=f+"/sharing/rest/content/items");return l};r.getItemUrl=function(f,l){var p="";(f=r.getBaseItemUrl(f))&&l&&(p=f+"/"+l);return p};r.getItemDataUrl=function(f,l){var p="";(f=r.getItemUrl(f,l))&&(p=f+"/data");return p};r.getItemGroupsUrl=function(f,l){var p="";(f=r.getItemUrl(f,l))&&(p=f+"/groups");return p};r.getGenerateTokenUrl=function(f){var l="";(f=r.getStandardPortalUrl(f))&&(l=f+"/sharing/generateToken");return l};r.getItemDetailsPageUrl=
function(f,l){var p="";f&&l&&(f=r.getStandardPortalUrl(f),p=f+"/home/item.html?id\x3d"+l);return p};r.getUserProfilePageUrl=function(f,l){var p="";f&&l&&(f=r.getStandardPortalUrl(f),p=f+"/home/user.html?user\x3d"+l);return p};r.getBaseGroupUrl=function(f){var l="";(f=r.getStandardPortalUrl(f))&&(l=f+"/sharing/rest/community/groups");return l};r.getPortalSelfInfoUrl=function(f){var l="";(f=r.getStandardPortalUrl(f||""))&&(l=f+"/sharing/rest/portals/self");return l};r.getPortalHelpMapUrl=function(f){var l=
"";(f=r.getStandardPortalUrl(f||""))&&(l=f+"/sharing/rest/portals/helpmap");return l};r.getCommunitySelfUrl=function(f){var l="";(f=r.getStandardPortalUrl(f||""))&&(l=f+"/sharing/rest/community/self");return l};r.getBaseUserUrl=function(f){var l="";(f=r.getStandardPortalUrl(f))&&(l=f+"/sharing/rest/community/users");return l};r.getUserUrl=function(f,l){var p="",c=r.getBaseUserUrl(f);f&&l&&(p=c+"/"+l);return p};r.getUserTagsUrl=function(f,l){var p="",c=r.getUserUrl(f,l);f&&l&&(p=c+"/tags");return p};
r.getUserThumbnailUrl=function(f,l,p){var c="";(f=r.getUserUrl(f,l))&&p&&(c=f+"/info/"+p);return c};r.getContentUrl=function(f){var l="";f&&(f=r.getStandardPortalUrl(f),l=f+"/sharing/rest/content");return l};r.getUserContentUrl=function(f,l,p){var c="",c="";f&&l&&(c=r.getContentUrl(f),c=p?c+"/users/"+l+"/"+p:c+"/users/"+l);return c};r.getUserContentItemUrl=function(f,l,p){var c="",c="";f&&l&&p&&(c=r.getUserContentUrl(f,l),c=c+"/items/"+p);return c};r.getItemResourceUrl=function(f,l,p){var c="",c=
"";f&&l&&(c=r.getContentUrl(f),c=p?c+"/items/"+l+"/resources/"+p:c+"/items/"+l+"/resources");return c};r.getAddItemUrl=function(f,l,p){var c="",c="";f&&l&&(c=r.getUserContentUrl(f,l,p),c+="/addItem");return c};r.getDeleteItemUrl=function(f,l,p){var c="";(f=r.getUserItemsUrl(f,l))&&(c=f+"/"+p+"/delete");return c};r.getUserItemsUrl=function(f,l,p){var c="",c="";f&&l&&(c=r.getUserContentUrl(f,l,p),c+="/items");return c};r.getUpdateItemUrl=function(f,l,p,c){var q="",q="";f&&l&&(q=r.getUserItemsUrl(f,
l,c),q=q+"/"+p+"/update");return q};r.shareItemUrl=function(f,l,p,c){var q="",q="";f&&l&&(q=r.getUserItemsUrl(f,l,c),q=q+"/"+p+"/share");return q};r.getHomeIndexUrl=function(f){var l="";(f=r.getStandardPortalUrl(f))&&(l=f+"/home/index.html");return l};r.getHomeMapViewerUrl=function(f,l){var p="";if(f=r.getStandardPortalUrl(f))p=f+"/home/webmap/viewer.html",p=l?p+("?webmap\x3d"+l):p+"?useExisting\x3d1";return p};r.getHomeSceneViewerUrl=function(f,l){var p="";if(f=r.getStandardPortalUrl(f))p=f+"/home/webscene/viewer.html",
l&&(p+="?webscene\x3d"+l);return p};r.getHomeGalleryUrl=function(f){var l="";(f=r.getStandardPortalUrl(f))&&(l=f+"/home/gallery.html");return l};r.getHomeGroupsUrl=function(f){var l="";(f=r.getStandardPortalUrl(f))&&(l=f+"/home/groups.html");return l};r.getHomeMyContentUrl=function(f){var l="";(f=r.getStandardPortalUrl(f))&&(l=f+"/home/content.html");return l};r.getHomeMyOrganizationUrl=function(f){var l="";(f=r.getStandardPortalUrl(f))&&(l=f+"/home/organization.html");return l};r.getHomeUserUrl=
function(f){var l="";(f=r.getStandardPortalUrl(f))&&(l=f+"/home/user.html");return l};r.getPortalHelpUrl=function(f,l){var p="";(f=r.getStandardPortalUrl(f))&&(p=f+"/portalhelp/"+(l||"en")+"/portal/");return p};r.getPortalAdminHelpUrl=function(f,l){var p="";(f=r.getStandardPortalUrl(f))&&(p=f+"/portalhelp/"+(l||"en")+"/admin/help/");return p};r.getPortalProxyUrl=function(f){var l="";(f=r.getStandardPortalUrl(f))&&(l=f+"/sharing/proxy");return l};r.getOAuth2SignOutUrl=function(f){var l="";(f=r.getStandardPortalUrl(f))&&
(l=f+"/sharing/rest/oauth2/signout");return l};r.getNewPrintUrl=function(f){var l="";if(f=r.getStandardPortalUrl(f))f=r.setHttpProtocol(f),l=f+"/sharing/tools/newPrint";return l};r.getSwitchAccoutnsUrl=function(f,l,p){var c="";if(f=r.getStandardPortalUrl(f))c=f+"/home/pages/Account/manage_accounts.html#client_id\x3d"+l,p&&(c+="\x26redirect_uri\x3d"+p);c&&(c=r.setHttpsProtocol(c));return c};return r})},"jimu/shared/utils":function(){define([],function(){function r(f,c){function q(c,k){var h,t,e,b,
m="widgetOnScreen"===c;if(f[c]){if(f[c].groups)for(h=0;h<f[c].groups.length;h++)if(e=f[c].groups[h],k(e,{index:h,isWidget:!1,groupId:e.id,isThemeWidget:!1,isOnScreen:m}),f[c].groups[h].widgets)for(t=0;t<f[c].groups[h].widgets.length;t++)b=f[c].groups[h].widgets[t],k(b,{index:t,isWidget:!0,groupId:e.id,isThemeWidget:b.uri&&-1<b.uri.indexOf("themes/"+f.theme.name),isOnScreen:m});if(f[c].widgets)for(h=0;h<f[c].widgets.length;h++)b=f[c].widgets[h],k(f[c].widgets[h],{index:h,isWidget:!0,groupId:c,isThemeWidget:b.uri&&
-1<b.uri.indexOf("themes/"+f.theme.name),isOnScreen:m})}}q("widgetOnScreen",c);q("widgetPool",c)}var f={},l="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance mirrorIconForRTL".split(" ");f.visitElement=r;f.getConfigElementById=function(f,c){var q;if("map"===c)return f.map;r(f,function(f){if(f.id===c)return q=f,!0});return q};f.getConfigElementByLabel=
function(f,c){var q;if("map"===c)return f.map;r(f,function(f){if(f.label||f.name===c)return q=f,!0});return q};f.getConfigElementsByName=function(f,c){var q=[];if("map"===c)return[f.map];r(f,function(f){f.name===c&&q.push(f)});return q};f.getWidgetNameFromUri=function(f){f=f.split("/");f.pop();return f.pop()};f.getAmdFolderFromUri=function(f){f=f.split("/");f.pop();return f.join("/")+"/"};f.widgetProperties=l;f.processWidgetProperties=function(f){"undefined"===typeof f.properties.isController&&(f.properties.isController=
!1);"undefined"===typeof f.properties.isThemeWidget&&(f.properties.isThemeWidget=!1);"undefined"===typeof f.properties.hasVersionManager&&(f.properties.hasVersionManager=!1);"undefined"===typeof f.properties.mirrorIconForRTL&&(f.properties.mirrorIconForRTL=!1);l.forEach(function(c){"undefined"===typeof f.properties[c]&&(f.properties[c]=!0)})};f.getControllerWidgets=function(f){var c=[];f.visitElement(function(f){f.isController&&c.push(f)});return c};f.addI18NLabelToManifest=function(f,c,q){function n(h,
e){e[k]&&(f.i18nLabels[h]=e[k]);"theme"===f.category&&(f.layouts&&f.layouts.forEach(function(b){f["i18nLabels_layout_"+b.name]||(f["i18nLabels_layout_"+b.name]={});f["i18nLabels_layout_"+b.name][h]=e["_layout_"+b.name]}),f.styles&&f.styles.forEach(function(b){f["i18nLabels_style_"+b.name]||(f["i18nLabels_style_"+b.name]={});f["i18nLabels_style_"+b.name][h]=e["_style_"+b.name]}));"widget"===f.category&&f.featureActions&&f.featureActions.forEach(function(b){f["i18nLabels_featureAction_"+b.name]||(f["i18nLabels_featureAction_"+
b.name]={});f["i18nLabels_featureAction_"+b.name][h]=e["_featureAction_"+b.name]})}f.i18nLabels={};var k="widget"===f.category?"_widgetLabel":"_themeLabel";c&&c.root&&c.root[k]&&(f.i18nLabels.defaultLabel=c.root[k],"theme"===f.category&&(f.layouts&&f.layouts.forEach(function(h){f["i18nLabels_layout_"+h.name]={};f["i18nLabels_layout_"+h.name].defaultLabel=c.root["_layout_"+h.name]}),f.styles&&f.styles.forEach(function(h){f["i18nLabels_style_"+h.name]={};f["i18nLabels_style_"+h.name].defaultLabel=c.root["_style_"+
h.name]})),"widget"===f.category&&f.featureActions&&f.featureActions.forEach(function(h){f["i18nLabels_featureAction_"+h.name]={};f["i18nLabels_featureAction_"+h.name].defaultLabel=c.root["_featureAction_"+h.name]}));for(var h in q)n(h,q[h])};f.isHostedService=function(f){if(!f)return!1;var c=-1!==f.indexOf(".arcgis.com/");f=-1!==f.indexOf("//services")||-1!==f.indexOf("//tiles")||-1!==f.indexOf("//features");return c&&f};return f})},"jimu/accessibleUtils":function(){define("dojo/_base/lang dojo/_base/html dojo/query esri/lang dojo/keys dojo/on".split(" "),
function(r,f,l,p,c,q){var n={firstFocusNodeClass:"firstFocusNode",lastFocusNodeClass:"lastFocusNode",lastFocusNodeClassInDOM:"lastFocusNodeInDOM",isInNavMode:function(){return f.hasClass(document.body,"jimu-nav-mode")?!0:!1},initTabIndexAndOrder:function(k){var h=n.getFirstFocusNode(k.domNode,k.inPanel),c=n.getLastFocusNode(k.domNode);h&&!c&&(c=h);k.isController&&(h=c=null);n.initFirstFocusNode(k.domNode,h);n.initLastFocusNode(k.domNode,c);n.addLabelToWidgetDOM(k)},addLabelToWidgetDOM:function(k){if(0<=
["ZoomSlider","AttributeTable","Search","ExtentNavigate","OverviewMap"].indexOf(k.name)){console.log(k.name);var h=p.substitute({widgetLabel:k.name},window.jimuNls.widgetToolTip);f.setAttr(k.domNode,"aria-label",h)}},isOnScreenNotCloseableOffPanel:function(k){return k.isOnScreen&&!k.inPanel&&!0!==k.closeable},preventMapNavigation:function(k){0<=[c.NUMPAD_PLUS,61,187,c.NUMPAD_MINUS,173,189,c.UP_ARROW,c.NUMPAD_8,c.RIGHT_ARROW,c.NUMPAD_6,c.DOWN_ARROW,c.NUMPAD_2,c.LEFT_ARROW,c.NUMPAD_4,c.PAGE_UP,c.NUMPAD_9,
c.PAGE_DOWN,c.NUMPAD_3,c.END,c.NUMPAD_1,c.HOME,c.NUMPAD_7].indexOf(k.keyCode)&&k.stopPropagation()},_addAttrsOnWidgetDom:function(k){var h=0<=["MyLocation","HomeButton","FullScreen"].indexOf(k.name)?"button":"";k.inPanel||f.setAttr(k.domNode,"role",h)},initWidgetCancelEvent:function(k){this._addAttrsOnWidgetDom(k);q(k.domNode,"keydown",r.hitch(this,function(h){n.preventMapNavigation(h);var t=h.target;k.inPanel||0>[c.ENTER,c.ESCAPE].indexOf(h.keyCode)||(n.isOnScreenNotCloseableOffPanel(k)?h.keyCode===
c.ENTER&&f.hasClass(t,k.baseClass)?(h.preventDefault(),n.focusFirstFocusNode(k.domNode)):h.keyCode===c.ESCAPE&&(f.hasClass(t,k.baseClass)?"Splash"!==k.name&&(t=k.domNode.parentNode,"map"===f.getAttr(t,"id")?(h.preventDefault(),t.focus()):(h="jimu-layout-manager"===f.getAttr(t,"id")?k.domNode:k.domNode.parentNode,n.trapToNextFocusContainer(h))):(h.stopPropagation(),k.domNode.focus())):h.keyCode!==c.ESCAPE||f.hasClass(t,k.baseClass)||(k.domNode.focus(),k.onClose(),h.preventDefault(),h.stopPropagation()))}))},
initFirstFocusNode:function(k,h){var t=n.getFirstFocusNode(k);t&&(f.removeClass(t,n.firstFocusNodeClass),t.firstNodeEvent&&t.firstNodeEvent.remove(),t===k&&(f.setAttr(t,"tabindex",null),f.setAttr(t,"role","")));h&&(h===k&&(f.setAttr(h,"tabindex",0),f.setAttr(h,"role","document")),f.addClass(h,n.firstFocusNodeClass),h.firstNodeEvent=q(h,"keydown",r.hitch(this,function(e){f.hasClass(e.target,n.firstFocusNodeClass)&&e.keyCode===c.TAB&&(window.currentMsgPopup&&window.currentMsgPopup.firstFocusNode?(window.currentMsgPopup.focusedNodeBeforeOpen=
e.target,e.preventDefault(),window.currentMsgPopup.firstFocusNode.focus()):!n.tryToFocusSplashWidget(e,k)&&e.shiftKey&&(e.preventDefault(),e=n.getLastFocusNode(k),n.isDomFocusable(e)?e.focus():(e=n.getFocusNodesInDom(e),1<=e.length&&e[e.length-1].focus())))})))},tryToFocusSplashWidget:function(k,h){var c=l(".jimu-widget-splash",l("#jimu-layout-manager")[0])[0];return c&&"none"!==f.getStyle(c,"display")&&c!==h?(k.stopPropagation(),k.preventDefault(),l("."+n.firstFocusNodeClass,c)[0].focus(),!0):!1},
initLastFocusNode:function(k,h){var t=n.getLastFocusNode(k);t&&(f.removeClass(t,n.lastFocusNodeClass),t.lastNodeEvent&&t.lastNodeEvent.remove(),t===k&&f.setAttr(t,"tabindex",null));h&&(h===k&&f.setAttr(h,"tabindex",0),f.addClass(h,n.lastFocusNodeClass),h.lastNodeEvent=q(h,"keydown",r.hitch(this,function(e){if(!e.shiftKey&&e.keyCode===c.TAB)if(k===h||f.hasClass(e.target,n.lastFocusNodeClass)&&n.isDomFocusable(e.target))e.preventDefault(),this.focusFirstFocusNode(k);else{var b=this.getFocusNodesInDom(h);
if(0===b.length||n._isLastFromInnerNodes(b,e.target))e.preventDefault(),this.focusFirstFocusNode(k)}})))},_isLastFromInnerNodes:function(k,h){var c=!1;if(h===k[k.length-1])c=!0;else for(var e=0;e<k.length;e++)if(h===k[e]&&f.hasClass(k[e],n.lastFocusNodeClassInDOM)){c=!0;break}return c},focusFirstFocusNode:function(k){var h=l("."+n.firstFocusNodeClass,k)[0];(h?h:k).focus()},getFirstFocusNode:function(k,h){var c=f.hasClass(k,n.firstFocusNodeClass)?k:l("."+n.firstFocusNodeClass,k)[0];!c&&h&&(c=k,null===
f.getAttr(c,"tabindex")&&f.setAttr(c,"tabindex","0"));return c},getLastFocusNode:function(k){return f.hasClass(k,n.lastFocusNodeClass)?k:l("."+n.lastFocusNodeClass,k)[0]},getFirstSkipLink:function(){return l("#skipContainer a")[0]},focusOnFirstSkipLink:function(){n.getFirstSkipLink().focus()},traversalDom:function(k,h){h=h?h:[];for(var c=k.childNodes,e=0;e<c.length;e++)k=c[e],1===k.nodeType&&(h.push(k),n.traversalDom(k,h));return h},getFocusNodesInDom:function(c){c=n.traversalDom(c);for(var h=[],
k=0;k<c.length;k++){var e=c[k];n.isDomFocusable(e)&&h.push(e)}return h},isDomFocusable:function(c){var h=["A","INPUT","BUTTON","SELECT","TEXTAREA"],k="hidden"!==f.getAttr(c,"type")&&"none"!==f.getStyle(c,"display"),e=!0!==f.getAttr(c,"disabled"),b=parseInt(f.getAttr(c,"tabindex"),10);return k&&e&&(0<=h.indexOf(c.tagName)&&-1!==b||0>h.indexOf(c.tagName)&&0<=b)?!0:!1},getFrameNodesByAsc:function(){for(var c=l("#jimu-layout-manager")[0].children,h=[],t=0;t<c.length;t++){var e=c[t];0<parseInt(f.getAttr(e,
"tabindex"),10)&&"none"!==f.getStyle(e,"display")&&h.push(e)}h.sort(function(b,e){b=parseInt(f.getAttr(b,"tabindex"),10);e=parseInt(f.getAttr(e,"tabindex"),10);return b<e?-1:b===e?0:1});return h},trapToNextFocusContainer:function(c){var h=n.getFrameNodesByAsc(),k=null;if("skipContainer"===f.getAttr(c,"id"))return(k=h[0])&&k.focus(),k;h.unshift(n.getFirstSkipLink());c=parseInt(f.getAttr(c,"tabindex"),10);for(var e=0;e<h.length;e++)if(parseInt(f.getAttr(h[e],"tabindex"),10)===c){k=e===h.length-1?h[0]:
h[e+1];break}k&&k.focus();return k},isAutoFocusFirstNodeWidget:function(c){var h=!0;n.isOnScreenNotCloseableOffPanel(c)?h=!1:c.openAtStart?c.openAtStartAysn?h=c.openAtStartAysn=!1:c._isFirstOpenAtStart||(c._isFirstOpenAtStart=!0,h=!1):c.isOnScreen&&"widgetOnScreen"!==c.gid?h=!1:c.inGroupPanel&&(h=!1);return h},_getTooltipLabel:function(c,h){var k=f.getAttr(c,"aria-label");c=f.getAttr(c,"title");return k||c||h},addTooltipByDomNode:function(c,h,t){c.defaultPosition=["below-centered","above-centered",
"after-centered","before-centered"];var e;q(h,"focus",r.hitch(this,function(b){n.isInNavMode()&&(e&&f.setAttr(e,"role","presentation"),c.show(n._getTooltipLabel(h,t)+"\x26nbsp;\x26nbsp;",b.target),e||(e=l(".dijitTooltipContainer",document.body)[0],f.setAttr(e,"role","presentation")))}));q(h,"blur",r.hitch(this,function(b){c&&c.hide(b.target)}))}};return n})},"jimu/zoomToUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred esri/config esri/graphic esri/graphicsUtils esri/geometry/Extent esri/geometry/Point esri/SpatialReference esri/geometry/webMercatorUtils esri/tasks/ProjectParameters".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e){var b={zoomToFeatureSet:function(e,a,g){var d=a.features&&0<a.features.length&&a.features[0].getLayer&&a.features[0].getLayer(),d=d?d.id:null;a=b.graphicsExtent(a.features,g);return b.zoomToExtent(e,a,d)},zoomToExtent:function(e,a,g){var d;if(!e||!b.isValidExtent(a))return d=new l,d.reject(),d;g?(d=new l,require(["jimu/LayerStructure"],function(m){(m=m.getInstance().getNodeById(g))?m.zoomTo(a).then(function(){d.resolve()},function(){d.reject()}):b.projectToMapSpatialReference(e,
a).then(function(g){a.isSinglePoint&&(g=b.convertSinglePointExtent(e,g));e.setExtent(g,!0);d.resolve()},function(){d.reject()})})):d=b.projectToMapSpatialReference(e,a).then(function(d){a.isSinglePoint&&(d=b.convertSinglePointExtent(e,d));return e.setExtent(d,!0)});return d},isValidExtent:function(e){return e&&b.isTrueOrZero(e.xmin)&&b.isTrueOrZero(e.ymin)&&b.isTrueOrZero(e.xmax)&&b.isTrueOrZero(e.ymax)}};b.isVaildExtent=b.isValidExtent;b.isTrueOrZero=function(b){return 0===b?!0:!!b};b.convertSinglePointExtent=
function(e,a){var g=e.getScale();if(g=b.getMedianScale(e,g,0))a=b.adjustHeightToAspectRatio(e,a),a=b.getExtentForScale(a,e.width,g);return a};b.graphicsExtent=function(b,a){var g=null;try{if(b&&1===b.length&&b[0].geometry&&"esri.geometry.Multipoint"===b[0].geometry.declaredClass&&1===b[0].geometry.points.length){var d=b[0].geometry.points[0],e=new k(d[0],d[1],b[0].geometry.spatialReference);b=[new c(e)]}if(b&&1===b.length&&b[0].geometry&&"esri.geometry.Point"===b[0].geometry.declaredClass){var m=
b[0].geometry,g=new n(m.x-1E-4,m.y-1E-4,m.x+1E-4,m.y+1E-4,m.spatialReference);g.isSinglePoint=!0}else b&&0<b.length&&(g=q.graphicsExtent(b))&&"number"===typeof a&&0<a&&(g=g.expand(a))}catch(B){console.error(B)}return g};b.projectToMapSpatialReference=function(e,a){return b.projectToSpatialReference(a,e.spatialReference)};b.projectToSpatialReference=function(b,a){var g=new l,d=b;if(a&&b)if(a.equals(b.spatialReference))g.resolve(d);else if(a.isWebMercator()&&b.spatialReference.equals(new h(4326)))d=
t.geographicToWebMercator(b),d.isSinglePoint=b.isSinglePoint,g.resolve(d);else if(a.equals(new h(4326))&&b.spatialReference.isWebMercator())d=t.webMercatorToGeographic(b),d.isSinglePoint=b.isSinglePoint,g.resolve(d);else{var m=p&&p.defaults&&p.defaults.geometryService;if(m&&"esri.tasks.GeometryService"===m.declaredClass){var c=new e;c.geometries=[b];c.outSR=a;m.project(c).then(function(a){(d=a&&0<a.length&&a[0])?(d.isSinglePoint=b.isSinglePoint,g.resolve(d)):g.reject()},function(){})}else g.reject()}else g.reject();
return g};b.getMapLods=function(b){var a=null;b._params&&b._params.lods&&(a=f.map(b._params.lods,r.hitch(this,function(a){return a.toJson()})));return a};b.getMedianScale=function(e,a,g){return b.getTargetScale(e,2,a,g)};b.getTargetScale=function(e,a,g,d){e=b.getMapLods(e);var m=1;if(e){var h=[],c=[];f.forEach(e,function(a){0<g&&a.scale>g||(a.scale<d?c.push(a.scale):h.push(a.scale))});h.reverse();1<=h.length?(m=c.length?c.length/e.length:1,a=Math.floor((h.length-1)/(a/m)),a=h[a]):a=null}else a=0===
g?null:(g-d)/a;return a};b.getScaleForNextTileLevel=function(e,a,g){if(e=b.getMapLods(e)){if(g){for(g=0;g<e.length;g++)if(e[g].scale<a)return e[g].scale-1;return e[e.length-1].scale-1}for(g=e.length-1;0<=g;g--)if(e[g].scale>a)return e[g].scale+1;return e[0].scale+1}return g?a-1:a+1};b.adjustExtentToAspectRatio=function(b,a){b=b.width/b.height;var g=a.getWidth()/a.getHeight();g>b?(b=a.getWidth()/b/2,r.mixin(a,{ymin:a.getCenter().y-b,ymax:a.getCenter().y+b})):g<b&&(b=a.getHeight()*b/2,r.mixin(a,{xmin:a.getCenter().x-
b,xmax:a.getCenter().x+b}));return a};b.adjustHeightToAspectRatio=function(b,a){b=a.getWidth()*(b.height/b.width)/5;r.mixin(a,{ymin:a.getCenter().y-b,ymax:a.getCenter().y+b});return a};b.getExtentForScale=function(b,a,g){var d=20015077/180,e=esri.config.defaults,m=esri.WKIDUnitConversion,h,c,k=b.spatialReference;k&&(h=k.wkid,c=k.wkt);k=null;h?k=m.values[m[h]]:c&&-1!==c.search(/^PROJCS/i)&&(m=/UNIT\[([^\]]+)\]\]$/i.exec(c))&&m[1]&&(k=parseFloat(m[1].split(",")[1]));return b.expand(g*a/(39.37*(k||d)*
e.screenDPI)/b.getWidth())};b.getScaleForExtent=function(b,a){var g=20015077/180,d=esri.config.defaults,e=esri.WKIDUnitConversion,m,h,c=b.spatialReference;c&&(m=c.wkid,h=c.wkt);c=null;m?c=e.values[e[m]]:h&&-1!==h.search(/^PROJCS/i)&&(e=/UNIT\[([^\]]+)\]\]$/i.exec(h))&&e[1]&&(c=parseFloat(e[1].split(",")[1]));return b.getWidth()/a*(c||g)*39.37*d.screenDPI};return b})},"libs/caja-html-sanitizer-minified":function(){(function(){var r=function(){function f(a){return(a=(""+a).match(m))?new h(t(a[1]),t(a[2]),
t(a[3]),t(a[4]),t(a[5]),t(a[6]),t(a[7])):null}function c(a,b){return"string"==typeof a?encodeURI(a).replace(b,q):null}function q(a){a=a.charCodeAt(0);return"%"+"0123456789ABCDEF".charAt(a>>4&15)+"0123456789ABCDEF".charAt(a&15)}function n(a){if(null===a)return null;a=a.replace(/(^|\/)\.(?:\/|$)/g,"$1").replace(/\/{2,}/g,"/");for(var d=e,b;(b=a.replace(d,"$1"))!=a;a=b);return a}function k(a,g){a=a.R();var d=g.K();d?a.fa(g.j):d=g.V();d?a.ca(g.m):d=g.W();d?a.da(g.k):d=g.Y();var e=g.g,m=n(e);if(d)a.ba(g.T()),
m=m&&m.replace(b,"");else if(d=!!e){if(47!==m.charCodeAt(0))var m=n(a.g||"").replace(b,""),u=m.lastIndexOf("/")+1,m=n((u?m.substring(0,u):"")+n(e)).replace(b,"")}else m=m&&m.replace(b,""),m!==e&&a.G(m);d?a.G(m):d=g.Z();d?a.M(g.l):d=g.X();d&&a.ea(g.n);return a}function h(a,b,g,e,m,h,c){this.j=a;this.m=b;this.k=g;this.h=e;this.g=m;this.l=h;this.n=c}function t(a){return"string"==typeof a&&0<a.length?a:null}var e=RegExp(/(\/|^)(?:[^./][^/]*|\.{2,}(?:[^./][^/]*)|\.{3,}[^/]*)\/\.\.(?:\/|$)/),b=/^(?:\.\.\/)*(?:\.\.$)?/;
h.prototype.toString=function(){var a=[];null!==this.j&&a.push(this.j,":");null!==this.k&&(a.push("//"),null!==this.m&&a.push(this.m,"@"),a.push(this.k),null!==this.h&&a.push(":",this.h.toString()));null!==this.g&&a.push(this.g);null!==this.l&&a.push("?",this.l);null!==this.n&&a.push("#",this.n);return a.join("")};h.prototype.R=function(){return new h(this.j,this.m,this.k,this.h,this.g,this.l,this.n)};h.prototype.U=function(){return this.j&&decodeURIComponent(this.j).toLowerCase()};h.prototype.fa=
function(a){this.j=a?a:null};h.prototype.K=function(){return null!==this.j};h.prototype.ca=function(a){this.m=a?a:null};h.prototype.V=function(){return null!==this.m};h.prototype.da=function(a){this.k=a?a:null;this.G(this.g)};h.prototype.W=function(){return null!==this.k};h.prototype.T=function(){return this.h&&decodeURIComponent(this.h)};h.prototype.ba=function(a){if(a){a=Number(a);if(a!==(a&65535))throw Error("Bad port number "+a);this.h=""+a}else this.h=null};h.prototype.Y=function(){return null!==
this.h};h.prototype.S=function(){return this.g&&decodeURIComponent(this.g)};h.prototype.G=function(a){a?(a=""+a,this.g=!this.k||/^\//.test(a)?a:"/"+a):this.g=null};h.prototype.M=function(a){this.l=a?a:null};h.prototype.Z=function(){return null!==this.l};h.prototype.aa=function(a){if("object"===typeof a&&!(a instanceof Array)&&(a instanceof Object||"[object Array]"!==Object.prototype.toString.call(a))){var d=[],b=-1,g;for(g in a){var e=a[g];"string"===typeof e&&(d[++b]=g,d[++b]=e)}a=d}for(var d=[],
b="",m=0;m<a.length;)g=a[m++],e=a[m++],d.push(b,encodeURIComponent(g.toString())),b="\x26",e&&d.push("\x3d",encodeURIComponent(e.toString()));this.l=d.join("")};h.prototype.ea=function(a){this.n=a?a:null};h.prototype.X=function(){return null!==this.n};var m=/^(?:([^:/?#]+):)?(?:\/\/(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/,a=/[#\/\?@]/g,g=/[\#\?]/g;h.parse=f;h.create=function(d,b,e,m,k,f,D){d=new h(c(d,a),c(b,a),"string"==typeof e?encodeURIComponent(e):null,0<m?
m.toString():null,c(k,g),null,"string"==typeof D?encodeURIComponent(D):null);f&&("string"===typeof f?d.M(f.replace(/[^?&=0-9A-Za-z_\-~.%]/g,q)):d.aa(f));return d};h.$=k;h.ja=n;h.ua={oa:function(a){return/\.html$/.test(f(a).S())?"text/html":"application/javascript"},$:function(a,b){return a?k(f(a),f(b)).toString():""+b}};return h}();"undefined"!==typeof window&&(window.URI=r);var f={e:{NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,HTML:12,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,
FRAME_TARGET:10,MEDIA_QUERY:13}};f.atype=f.e;f.w={"*::class":9,"*::dir":0,"*::draggable":0,"*::hidden":0,"*::id":4,"*::inert":0,"*::itemprop":0,"*::itemref":6,"*::itemscope":0,"*::lang":0,"*::onblur":2,"*::onchange":2,"*::onclick":2,"*::ondblclick":2,"*::onerror":2,"*::onfocus":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::onreset":2,"*::onscroll":2,"*::onselect":2,"*::onsubmit":2,"*::ontouchcancel":2,
"*::ontouchend":2,"*::ontouchenter":2,"*::ontouchleave":2,"*::ontouchmove":2,"*::ontouchstart":2,"*::onunload":2,"*::spellcheck":0,"*::style":3,"*::tabindex":0,"*::title":0,"*::translate":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::shape":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::target":10,"audio::controls":0,
"audio::loop":0,"audio::mediagroup":5,"audio::muted":0,"audio::preload":0,"audio::src":1,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,
"colgroup::width":0,"command::checked":0,"command::command":5,"command::disabled":0,"command::icon":1,"command::label":0,"command::radiogroup":0,"command::type":0,"data::value":0,"del::cite":1,"del::datetime":0,"details::open":0,"dir::compact":0,"div::align":0,"dl::compact":0,"fieldset::disabled":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::novalidate":0,"form::onreset":2,"form::onsubmit":2,
"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,
"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::inputmode":0,"input::ismap":0,"input::list":5,"input::max":0,"input::maxlength":0,"input::min":0,"input::multiple":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::pattern":0,"input::placeholder":0,"input::readonly":0,"input::required":0,"input::size":0,"input::src":1,"input::step":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,
"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"menu::label":0,"menu::type":0,"meter::high":0,"meter::low":0,"meter::max":0,"meter::min":0,"meter::optimum":0,"meter::value":0,"ol::compact":0,"ol::reversed":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"output::for":6,"output::name":8,
"p::align":0,"pre::width":0,"progress::max":0,"progress::min":0,"progress::value":0,"q::cite":1,"select::autocomplete":0,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::required":0,"select::size":0,"source::type":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,
"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::autocomplete":0,"textarea::cols":0,"textarea::disabled":0,"textarea::inputmode":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::placeholder":0,"textarea::readonly":0,"textarea::required":0,
"textarea::rows":0,"textarea::wrap":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"track::default":0,"track::kind":0,"track::label":0,
"track::srclang":0,"ul::compact":0,"ul::type":0,"video::controls":0,"video::height":0,"video::loop":0,"video::mediagroup":5,"video::muted":0,"video::poster":1,"video::preload":0,"video::src":1,"video::width":0};f.ATTRIBS=f.w;f.c={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128,VIRTUALIZED:256};f.eflags=f.c;f.f={a:0,abbr:0,acronym:0,address:0,applet:272,area:2,article:0,aside:0,audio:0,b:0,base:274,basefont:274,bdi:0,bdo:0,big:0,blockquote:0,body:305,br:2,button:0,
canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,command:2,data:0,datalist:0,dd:1,del:0,details:0,dfn:0,dialog:272,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:0,figure:0,font:0,footer:0,form:0,frame:274,frameset:272,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:305,header:0,hgroup:0,hr:2,html:305,i:0,iframe:4,img:2,input:2,ins:0,isindex:274,kbd:0,keygen:274,label:0,legend:0,li:1,link:274,map:0,mark:0,menu:0,meta:274,meter:0,nav:0,nobr:0,noembed:276,noframes:276,noscript:276,object:272,ol:0,optgroup:0,
option:1,output:0,p:1,param:274,pre:0,progress:0,q:0,s:0,samp:0,script:84,section:0,select:0,small:0,source:2,span:0,strike:0,strong:0,style:148,sub:0,summary:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:0,title:280,tr:1,track:2,tt:0,u:0,ul:0,"var":0,video:0,wbr:2};f.ELEMENTS=f.f;f.O={a:"HTMLAnchorElement",abbr:"HTMLElement",acronym:"HTMLElement",address:"HTMLElement",applet:"HTMLAppletElement",area:"HTMLAreaElement",article:"HTMLElement",aside:"HTMLElement",audio:"HTMLAudioElement",
b:"HTMLElement",base:"HTMLBaseElement",basefont:"HTMLBaseFontElement",bdi:"HTMLElement",bdo:"HTMLElement",big:"HTMLElement",blockquote:"HTMLQuoteElement",body:"HTMLBodyElement",br:"HTMLBRElement",button:"HTMLButtonElement",canvas:"HTMLCanvasElement",caption:"HTMLTableCaptionElement",center:"HTMLElement",cite:"HTMLElement",code:"HTMLElement",col:"HTMLTableColElement",colgroup:"HTMLTableColElement",command:"HTMLCommandElement",data:"HTMLElement",datalist:"HTMLDataListElement",dd:"HTMLElement",del:"HTMLModElement",
details:"HTMLDetailsElement",dfn:"HTMLElement",dialog:"HTMLDialogElement",dir:"HTMLDirectoryElement",div:"HTMLDivElement",dl:"HTMLDListElement",dt:"HTMLElement",em:"HTMLElement",fieldset:"HTMLFieldSetElement",figcaption:"HTMLElement",figure:"HTMLElement",font:"HTMLFontElement",footer:"HTMLElement",form:"HTMLFormElement",frame:"HTMLFrameElement",frameset:"HTMLFrameSetElement",h1:"HTMLHeadingElement",h2:"HTMLHeadingElement",h3:"HTMLHeadingElement",h4:"HTMLHeadingElement",h5:"HTMLHeadingElement",h6:"HTMLHeadingElement",
head:"HTMLHeadElement",header:"HTMLElement",hgroup:"HTMLElement",hr:"HTMLHRElement",html:"HTMLHtmlElement",i:"HTMLElement",iframe:"HTMLIFrameElement",img:"HTMLImageElement",input:"HTMLInputElement",ins:"HTMLModElement",isindex:"HTMLUnknownElement",kbd:"HTMLElement",keygen:"HTMLKeygenElement",label:"HTMLLabelElement",legend:"HTMLLegendElement",li:"HTMLLIElement",link:"HTMLLinkElement",map:"HTMLMapElement",mark:"HTMLElement",menu:"HTMLMenuElement",meta:"HTMLMetaElement",meter:"HTMLMeterElement",nav:"HTMLElement",
nobr:"HTMLElement",noembed:"HTMLElement",noframes:"HTMLElement",noscript:"HTMLElement",object:"HTMLObjectElement",ol:"HTMLOListElement",optgroup:"HTMLOptGroupElement",option:"HTMLOptionElement",output:"HTMLOutputElement",p:"HTMLParagraphElement",param:"HTMLParamElement",pre:"HTMLPreElement",progress:"HTMLProgressElement",q:"HTMLQuoteElement",s:"HTMLElement",samp:"HTMLElement",script:"HTMLScriptElement",section:"HTMLElement",select:"HTMLSelectElement",small:"HTMLElement",source:"HTMLSourceElement",
span:"HTMLSpanElement",strike:"HTMLElement",strong:"HTMLElement",style:"HTMLStyleElement",sub:"HTMLElement",summary:"HTMLElement",sup:"HTMLElement",table:"HTMLTableElement",tbody:"HTMLTableSectionElement",td:"HTMLTableDataCellElement",textarea:"HTMLTextAreaElement",tfoot:"HTMLTableSectionElement",th:"HTMLTableHeaderCellElement",thead:"HTMLTableSectionElement",time:"HTMLTimeElement",title:"HTMLTitleElement",tr:"HTMLTableRowElement",track:"HTMLTrackElement",tt:"HTMLElement",u:"HTMLElement",ul:"HTMLUListElement",
"var":"HTMLElement",video:"HTMLVideoElement",wbr:"HTMLElement"};f.ELEMENT_DOM_INTERFACES=f.O;f.N={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2};f.ueffects=f.N;f.J={"a::href":2,"area::href":2,"audio::src":1,"blockquote::cite":0,"command::icon":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0,"video::poster":1,"video::src":1};f.URIEFFECTS=f.J;f.L={UNSANDBOXED:2,SANDBOXED:1,DATA:0};f.ltypes=f.L;f.I={"a::href":2,"area::href":2,"audio::src":2,"blockquote::cite":2,"command::icon":1,
"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2,"video::poster":1,"video::src":2};f.LOADERTYPES=f.I;"undefined"!==typeof window&&(window.html4=f);var l=function(f){function c(a,d){d=p.hasOwnProperty(d)?p[d]:(a=d.match(w))?String.fromCharCode(parseInt(a[1],10)):(a=d.match(l))?String.fromCharCode(parseInt(a[1],16)):E&&G.test(d)?(E.innerHTML="\x26"+d+";",a=E.textContent,p[d]=a):"\x26"+d+";";return d}function q(a){return a.replace(H,c)}function n(a){return(""+a).replace(N,
"\x26amp;").replace(J,"\x26lt;").replace(K,"\x26gt;").replace(O,"\x26#34;")}function k(a){return a.replace(M,"\x26amp;$1").replace(J,"\x26lt;").replace(K,"\x26gt;")}function h(a){var d={z:a.z||a.cdata,A:a.A||a.comment,B:a.B||a.endDoc,r:a.r||a.endTag,d:a.d||a.pcdata,F:a.F||a.rcdata,H:a.H||a.startDoc,v:a.v||a.startTag};return function(a,b){var g=/(<\/|<\!--|<[!?]|[&<>])/g;a+="";if(P)a=a.split(g);else{for(var m=[],u=0,h;null!==(h=g.exec(a));)m.push(a.substring(u,h.index)),m.push(h[0]),u=h.index+h[0].length;
m.push(a.substring(u));a=m}e(d,a,0,{o:!1,C:!1},b)}}function t(a,d,b,g,m){return function(){e(a,d,b,g,m)}}function e(a,d,g,e,u){try{a.H&&0==g&&a.H(u);for(var h,c,k,v=d.length;g<v;){var D=d[g++],z=d[g];switch(D){case "\x26":L.test(z)?(a.d&&a.d("\x26"+z,u,I,t(a,d,g,e,u)),g++):a.d&&a.d("\x26amp;",u,I,t(a,d,g,e,u));break;case "\x3c/":if(h=/^([-\w:]+)[^\'\"]*/.exec(z))if(h[0].length===z.length&&"\x3e"===d[g+1])g+=2,k=h[1].toLowerCase(),a.r&&a.r(k,u,I,t(a,d,g,e,u));else{var B=d,n=g,w=a,q=u,C=I,p=e,y=m(B,
n);y?(w.r&&w.r(y.name,q,C,t(w,B,n,p,q)),g=y.next):g=B.length}else a.d&&a.d("\x26lt;/",u,I,t(a,d,g,e,u));break;case "\x3c":if(h=/^([-\w:]+)\s*\/?/.exec(z))if(h[0].length===z.length&&"\x3e"===d[g+1]){g+=2;k=h[1].toLowerCase();a.v&&a.v(k,[],u,I,t(a,d,g,e,u));var l=f.f[k];l&R&&(g=b(d,{name:k,next:g,c:l},a,u,I,e))}else{var B=d,n=a,w=u,q=I,C=e,A=m(B,g);A?(n.v&&n.v(A.name,A.P,w,q,t(n,B,A.next,C,w)),g=A.c&R?b(B,A,n,w,q,C):A.next):g=B.length}else a.d&&a.d("\x26lt;",u,I,t(a,d,g,e,u));break;case "\x3c!--":if(!e.C){for(c=
g+1;c<v&&("\x3e"!==d[c]||!/--$/.test(d[c-1]));c++);if(c<v){if(a.A){var r=d.slice(g,c).join("");a.A(r.substr(0,r.length-2),u,I,t(a,d,c+1,e,u))}g=c+1}else e.C=!0}e.C&&a.d&&a.d("\x26lt;!--",u,I,t(a,d,g,e,u));break;case "\x3c!":if(/^\w/.test(z)){if(!e.o){for(c=g+1;c<v&&"\x3e"!==d[c];c++);c<v?g=c+1:e.o=!0}e.o&&a.d&&a.d("\x26lt;!",u,I,t(a,d,g,e,u))}else a.d&&a.d("\x26lt;!",u,I,t(a,d,g,e,u));break;case "\x3c?":if(!e.o){for(c=g+1;c<v&&"\x3e"!==d[c];c++);c<v?g=c+1:e.o=!0}e.o&&a.d&&a.d("\x26lt;?",u,I,t(a,d,
g,e,u));break;case "\x3e":a.d&&a.d("\x26gt;",u,I,t(a,d,g,e,u));break;case "":break;default:a.d&&a.d(D,u,I,t(a,d,g,e,u))}}a.B&&a.B(u)}catch(ga){if(ga!==I)throw ga;}}function b(a,d,b,g,e,m){var u=a.length;V.hasOwnProperty(d.name)||(V[d.name]=RegExp("^"+d.name+"(?:[\\s\\/]|$)","i"));for(var h=V[d.name],c=d.next,v=d.next+1;v<u&&("\x3c/"!==a[v-1]||!h.test(a[v]));v++);v<u&&--v;u=a.slice(c,v).join("");if(d.c&f.c.CDATA)b.z&&b.z(u,g,e,t(b,a,v,m,g));else if(d.c&f.c.RCDATA)b.F&&b.F(k(u),g,e,t(b,a,v,m,g));else throw Error("bug");
return v}function m(a,d){var b=/^([-\w:]+)/.exec(a[d]),g={};g.name=b[1].toLowerCase();g.c=f.f[g.name];var e=a[d].substr(b[0].length);d+=1;for(var m=a.length;d<m&&"\x3e"!==a[d];d++)e+=a[d];if(!(m<=d)){for(var u=[];""!==e;)if(b=Q.exec(e))if(b[4]&&!b[5]||b[6]&&!b[7]){for(var b=b[4]||b[6],h=!1,e=[e,a[d++]];d<m;d++){if(h){if("\x3e"===a[d])break}else 0<=a[d].indexOf(b)&&(h=!0);e.push(a[d])}if(m<=d)break;e=e.join("")}else{var h=b[1].toLowerCase(),c;if(b[2]){c=b[3];var k=c.charCodeAt(0);if(34===k||39===k)c=
c.substr(1,c.length-2);c=q(c.replace(F,""))}else c="";u.push(h,c);e=e.substr(b[0].length)}else e=e.replace(/^[\s\S][^a-z\s]*/,"");g.P=u;g.next=d+1;return g}}function a(a){function d(a,d){g||d.push(a)}var b,g;return h({startDoc:function(){b=[];g=!1},startTag:function(d,e,m){if(!g&&f.f.hasOwnProperty(d)){var u=f.f[d];if(!(u&f.c.FOLDABLE)){var h=a(d,e);if(h){if("object"!==typeof h)throw Error("tagPolicy did not return object (old API?)");if("attribs"in h)e=h.attribs;else throw Error("tagPolicy gave no attribs");
var c;"tagName"in h?(c=h.tagName,h=f.f[c]):(c=d,h=u);if(u&f.c.OPTIONAL_ENDTAG){var k=b[b.length-1];k&&k.D===d&&(k.t!==c||d!==c)&&m.push("\x3c/",k.t,"\x3e")}u&f.c.EMPTY||b.push({D:d,t:c});m.push("\x3c",c);d=0;for(k=e.length;d<k;d+=2){var v=e[d],D=e[d+1];null!==D&&void 0!==D&&m.push(" ",v,'\x3d"',n(D),'"')}m.push("\x3e");u&f.c.EMPTY&&!(h&f.c.EMPTY)&&m.push("\x3c/",c,"\x3e")}else g=!(u&f.c.EMPTY)}}},endTag:function(a,d){if(g)g=!1;else if(f.f.hasOwnProperty(a)){var e=f.f[a];if(!(e&(f.c.EMPTY|f.c.FOLDABLE))){if(e&
f.c.OPTIONAL_ENDTAG)for(e=b.length;0<=--e;){var m=b[e].D;if(m===a)break;if(!(f.f[m]&f.c.OPTIONAL_ENDTAG))return}else for(e=b.length;0<=--e&&b[e].D!==a;);if(!(0>e)){for(m=b.length;--m>e;){var u=b[m].t;f.f[u]&f.c.OPTIONAL_ENDTAG||d.push("\x3c/",u,"\x3e")}e<b.length&&(a=b[e].t);b.length=e;d.push("\x3c/",a,"\x3e")}}}},pcdata:d,rcdata:d,cdata:d,endDoc:function(a){for(;b.length;b.length--)a.push("\x3c/",b[b.length-1].t,"\x3e")}})}function g(a,d,b,g,e){if(!e)return null;try{var m=r.parse(""+a);if(m&&(!m.K()||
X.test(m.U()))){var u=e(m,d,b,g);return u?u.toString():null}}catch(x){}return null}function d(a,d,b,g,e){b||a(d+" removed",{Q:"removed",tagName:d});if(g!==e){var m="changed";g&&!e?m="removed":!g&&e&&(m="added");a(d+"."+b+" "+m,{Q:m,tagName:d,ia:b,oldValue:g,newValue:e})}}function u(a,d,b){d=d+"::"+b;if(a.hasOwnProperty(d))return a[d];d="*::"+b;if(a.hasOwnProperty(d))return a[d]}function v(a,b,e,m,h){for(var c=0;c<b.length;c+=2){var k=b[c],v=b[c+1],t=v,z=null,B;if((B=a+"::"+k,f.w.hasOwnProperty(B))||
(B="*::"+k,f.w.hasOwnProperty(B)))z=f.w[B];if(null!==z)switch(z){case f.e.NONE:break;case f.e.SCRIPT:v=null;h&&d(h,a,k,t,v);break;case f.e.STYLE:if("undefined"===typeof C){v=null;h&&d(h,a,k,t,v);break}var n=[];C(v,{declaration:function(a,d){var b=a.toLowerCase();D(b,d,e?function(a){return g(a,f.N.ga,f.L.ha,{TYPE:"CSS",CSS_PROP:b},e)}:null);d.length&&n.push(b+": "+d.join(" "))}});v=0<n.length?n.join(" ; "):null;h&&d(h,a,k,t,v);break;case f.e.ID:case f.e.IDREF:case f.e.IDREFS:case f.e.GLOBAL_NAME:case f.e.LOCAL_NAME:case f.e.CLASSES:v=
m?m(v):v;h&&d(h,a,k,t,v);break;case f.e.URI:v=g(v,u(f.J,a,k),u(f.I,a,k),{TYPE:"MARKUP",XML_ATTR:k,XML_TAG:a},e);h&&d(h,a,k,t,v);break;case f.e.URI_FRAGMENT:v&&"#"===v.charAt(0)?(v=v.substring(1),v=m?m(v):v,null!==v&&void 0!==v&&(v="#"+v)):v=null;h&&d(h,a,k,t,v);break;default:v=null,h&&d(h,a,k,t,v)}else v=null,h&&d(h,a,k,t,v);b[c+1]=v}return b}function B(a,b,g){return function(e,m){if(f.f[e]&f.c.UNSAFE)g&&d(g,e,void 0,void 0,void 0);else return{attribs:v(e,m,a,b,g)}}}function z(d,b){var g=[];a(b)(d,
g);return g.join("")}var C,D;"undefined"!==typeof window&&(C=window.parseCssDeclarations,D=window.sanitizeCssProperty);var p={lt:"\x3c",LT:"\x3c",gt:"\x3e",GT:"\x3e",amp:"\x26",AMP:"\x26",quot:'"',apos:"'",nbsp:"\u00a0"},w=/^#(\d+)$/,l=/^#x([0-9A-Fa-f]+)$/,G=/^[A-Za-z][A-za-z0-9]+$/,E="undefined"!==typeof window&&window.document?window.document.createElement("textarea"):null,F=/\0/g,H=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,L=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/,N=/&/g,M=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,
J=/[<]/g,K=/>/g,O=/\"/g,Q=/^\s*([-.:\w]+)(?:\s*(=)\s*((")[^"]*("|$)|(')[^']*('|$)|(?=[a-z][-\w]*\s*=)|[^"'\s]*))?/i,P=3==="a,b".split(/(,)/).length,R=f.c.CDATA|f.c.RCDATA,I={},V={},X=/^(?:https?|mailto)$/i,T={};T.ka=T.escapeAttrib=n;T.la=T.makeHtmlSanitizer=a;T.ma=T.makeSaxParser=h;T.na=T.makeTagPolicy=B;T.pa=T.normalizeRCData=k;T.qa=T.sanitize=function(a,d,b,g){return z(a,B(d,b,g))};T.ra=T.sanitizeAttribs=v;T.sa=T.sanitizeWithPolicy=z;T.ta=T.unescapeEntities=q;return T}(f),f=l.sanitize;"undefined"!==
typeof window&&(window.html=l,window.html_sanitize=f);"function"===typeof define&&define.amd&&define([],function(){return l})})()},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dijit/Tooltip dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all dijit/registry ./utils jimu/tokenUtils ./dijit/Message ./DataSourceManager".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B){var z=
null,C=r(n,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(q.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),q.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(q.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),q.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?(q.subscribe("app/sceneViewLoaded",f.hitch(this,this._onSceneViewLoaded)),q.subscribe("app/sceneViewChanged",f.hitch(this,this._onSceneViewChanged))):
(q.subscribe("sceneViewLoaded",f.hitch(this,this._onSceneViewLoaded)),q.subscribe("sceneViewChanged",f.hitch(this,this._onSceneViewChanged)));window.isBuilder?(q.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),q.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(q.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),q.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));q.subscribe("userSignIn",f.hitch(this,this._onUserSignIn));
q.subscribe("userSignOut",f.hitch(this,this._onUserSignOut));q.subscribe("builder/actionTriggered",f.hitch(this,this._onActionTriggered));q.subscribe("/dnd/move/start",f.hitch(this,this._onMoveStart))},loadWidget:function(d){var b=new c,e;d=f.clone(d);(e=this.getWidgetById(d.id))?b.resolve(e):a([this.loadWidgetClass(d),this.loadWidgetManifest(d)]).then(f.hitch(this,function(a){var d=a[0],e=a[1];this.loadWidgetResources(e).then(f.hitch(this,function(a){try{var m=this.createWidget(e,d,a);p.setAttr(m.domNode,
"data-widget-name",e.name);console.log("widget ["+e.uri+"] created.")}catch(L){console.log("create ["+e.uri+"] error:"+L.stack),new v({message:window.jimuNls.widgetManager.createWidgetError+": "+e.uri}),g.byId(e.id)&&g.byId(e.id).destroy(),b.reject(L)}setTimeout(f.hitch(this,function(){b.resolve(m);this.emit("widget-created",m);q.publish("widgetCreated",m)}),50)}),function(a){b.reject(a)})}),function(a){b.reject(a)});return b},loadWidgetClass:function(a){var b=new c,g;g=a.isRemote?a.uri+".js":a.uri;
require(d.getRequireConfig(),[g],f.hitch(this,function(a){b.resolve(a)}));d.checkError(a.uri,b);return b},loadWidgetResources:function(d){var b=new c,g,e,m,u=[];m=f.clone(d);d=this.tryLoadWidgetConfig(m);g=this._tryLoadResource(m,"i18n");e=this._tryLoadResource(m,"style");m=this._tryLoadResource(m,"template");u.push(d);u.push(g);u.push(m);u.push(e);a(u).then(f.hitch(this,function(a){var d={};d.config=a[0];d.i18n=a[1];d.template=a[2];d.style=a[3];b.resolve(d)}),function(a){b.reject(a)});return b},
loadWidgetManifest:function(a){var b=new c,g=d.getUriInfo(a.uri),g=g.isRemote?g.folderUrl+"manifest.json?f\x3djson":g.folderUrl+"manifest.json";if(a.manifest)return b.resolve(a),b;m(g,{handleAs:"json",headers:{"X-Requested-With":null}}).then(f.hitch(this,function(g){if(g.error&&g.error.code)return b.reject(g.error);g.category="widget";f.mixin(g,d.getUriInfo(a.uri));d.manifest.addI18NLabel(g).then(f.hitch(this,function(){this._processManifest(g);d.widgetJson.addManifest2WidgetJson(a,g);b.resolve(a)}))}),
function(a){b.reject(a)});return b},getWidgetMarginBox:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return{};if(a._marginBox)return a._marginBox;var d={left:-9999,top:-9999,relativeTo:a.position.relativeTo};a._isTestSizeFlag=!0;a.setPosition(d);this.openWidget(a);a._marginBox=a.getMarginBox();this.closeWidget(a);"undefined"!==typeof a._isTestSizeFlag&&delete a._isTestSizeFlag;return a._marginBox},_processManifest:function(a){d.manifest.addManifestProperies(a);d.manifest.processManifestLabel(a,
window.dojoConfig.locale)},createWidget:function(a,b,g){if(this.getWidgetById(a.id))return this.getWidgetById(a.id);g.config&&g.i18n&&(g.config=d.replacePlaceHolder(g.config,g.i18n));a.rawConfig=a.config;a.config=g.config||{};this.appConfig._appData&&this._mergeAgolConfig(a);a.nls=g.i18n||{};g.template&&(a.templateString=g.template);a["class"]="jimu-widget";a.label||(a.label=a.name);this.map&&(a.map=this.map);a.appConfig=this.appConfig;g={};for(var e in a)a.hasOwnProperty(e)&&(g[e]=a[e]);g.widgetManager=
this;a=new b(g);a.clazz=b;t.after(a,"startup",f.hitch(this,this._postWidgetStartup,a));t.before(a,"destroy",f.hitch(this,this._onDestroyWidget,a));a.domNode.addEventListener(this._getActiveEventName(),f.hitch(this,this._onClickWidget,a),{capture:!0});this.loaded.push(a);return a},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var a=l.map(this.loaded,function(a){return a.id});l.forEach(a,function(a){this.destroyWidget(a)},this);this.loaded=[]},loadWidgetSettingPage:function(d){var b=
new c;d=f.clone(d);d.id+="_setting";a([this.loadWidgetSettingClass(d)]).then(f.hitch(this,function(a){var e=a[0];this.loadWidgetSettingPageResources(d).then(f.hitch(this,function(a){var m,u={nls:a.i18n,appConfig:this.appConfig,"class":"jimu-widget-setting"};null!==a.template&&(u.templateString=a.template);"HTML3D"===window.appInfo.appType?u.sceneView=this.sceneView:u.map=this.map;for(var h in d)d.hasOwnProperty(h)&&(u[h]=d[h]);try{m=new e(u),p.setAttr(m.domNode,"data-widget-name-setting",u.name),
t.before(m,"destroy",f.hitch(this,this._onDestroyWidgetSetting,m)),b.resolve(m)}catch(L){new v({message:window.jimuNls.widgetManager.createWidgetSettingPageError+":"+d.uri}),g.byId(u.id)&&g.byId(u.id).destroy(),b.reject(L)}}),function(a){console.log(a)})}),function(a){b.reject(a)});return b},loadWidgetSettingClass:function(a){var b=new c,g;g=a.isRemote?a.folderUrl+"setting/Setting.js":a.amdFolder+"setting/Setting";require(d.getRequireConfig(),[g],f.hitch(this,function(a){b.resolve(a)}));d.checkError(a.folderUrl+
"setting/Setting.js",b);return b},loadWidgetSettingPageResources:function(d){var b=new c,g,e,m=[];d=f.clone(d);g=this._tryLoadResource(d,"settingI18n");e=this._tryLoadResource(d,"settingTemplate");d=this._tryLoadResource(d,"settingStyle");m.push(g);m.push(e);m.push(d);a(m).then(f.hitch(this,function(a){var d={};d.i18n=a[0]||{};d.template=a[1];d.style=a[2];b.resolve(d)}),function(a){console.log(a)});return b},getWidgetById:function(a){var d;l.some(this.loaded,function(b){if(b.id===a)return d=b,!0},
this);return d},getWidgetByLabel:function(a){var d;l.some(this.loaded,function(b){if(b.label===a)return d=b,!0},this);return d},getWidgetsByName:function(a){var d=[];l.some(this.loaded,function(b){b.name===a&&d.push(b)},this);return d},changeWindowStateTo:function(a,d){"normal"===d?this.normalizeWidget(a):"minimized"===d?this.minimizeWidget(a):"maximized"===d?this.maximizeWidget(a):console.log("error state: "+d)},closeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;
if("closed"!==a.state){this.activeWidget&&this.activeWidget.id===a.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);p.setStyle(a.domNode,"display","none");a.setState("closed");try{a.onClose()}catch(y){console.log(console.error("fail to close widget "+a.name+". "+y.stack))}}this.appConfig.mode||this._removeDataSourceUsage(a)},openWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if(!a.started)try{a.started=!0,a.startup()}catch(y){console.error("fail to startup widget "+
a.name+". "+y.stack)}if("closed"===a.state){p.setStyle(a.domNode,"display","");a.setState("opened");try{a.onOpen()}catch(y){console.error("fail to open widget "+a.name+". "+y.stack)}d.isAutoFocusFirstNodeWidget(a)&&d.focusFirstFocusNode(a.domNode);this.appConfig.mode||this._addDataSourceUsage(a)}},activateWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"opened"===a.state&&this._activeWidget(a)},maximizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),
!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("maximized");try{a.onMaximize()}catch(y){console.log(console.error("fail to maximize widget "+a.name+". "+y.stack))}},minimizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("minimized");try{a.onMinimize()}catch(y){console.log(console.error("fail to minimize widget "+a.name+". "+y.stack))}},normalizeWidget:function(a){if("string"===typeof a&&(a=
this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("normal");try{a.onNormalize()}catch(y){console.log(console.error("fail to normalize widget "+a.name+". "+y.stack))}},destroyWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this._removeWidget(a);try{a.destroy()}catch(y){console.log(console.error("fail to destroy widget "+a.name+". "+y.stack))}},tryLoadWidgetConfig:function(a){return this._tryLoadWidgetConfig(a).then(f.hitch(this,
function(d){return this._upgradeWidgetConfig(a,d).then(function(d){return a.config=d})}))},triggerWidgetOpen:function(a){function d(a){var d=t.after(a,"onOpen",function(){d.remove();b.resolve(a)})}var b=new c,g=this.getWidgetById(a);if(g){if("closed"!==g.state)return b.resolve(g),b;d(g)}else var e=q.subscribe("widgetCreated",f.hitch(this,function(d){d.id===a&&(e.remove(),b.resolve(d))}));q.publish("openWidget",a);return b},_tryLoadWidgetConfig:function(a){var b=new c;if(a.config&&f.isObject(a.config))return b.resolve(a.config),
b;if(a.config){if(require.cache["url:"+a.config])return b.resolve(e.parse(require.cache["url:"+a.config])),b;b=d.processUrlInAppConfig(a.config);b=b.split("/");b[b.length-1]=encodeURIComponent(b[b.length-1]);b=b.join("/");return m(b,{handleAs:"json",headers:{"X-Requested-With":null}})}return this._tryLoadResource(a,"config").then(function(d){a.isDefaultConfig=!0;return d})},_upgradeWidgetConfig:function(a,b){var g=new c,e=a.manifest.version,m=a.version,u;if(e===m)return g.resolve(b),g;if(!1===a.hasVersionManager)return a.version=
e,g.resolve(b),g;require(d.getRequireConfig(),[a.amdFolder+(a.isRemote?"VersionManager.js":"VersionManager")],f.hitch(this,function(d){d=new d;var h=d.getVersionIndex(m),c=d.getVersionIndex(e);if(h>c)g.reject("Bad widget version number, "+a.name+","+m);else try{u=d.upgrade(b,m,e),a.version=e,g.resolve(u)}catch(N){console.log("Read widget ["+a.name+"] old config error,"+N.stack),g.resolve(b)}}));return g},loadWidgetStyle:function(a){var b=this._getStyleIdFromWidgetJson(a,!1),g=new c;return p.byId(b)?
(g.resolve("load"),g):d.loadStyleLink(b,a.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(a){var b=this._getStyleIdFromWidgetJson(a,!0),g=new c;return p.byId(b)?(g.resolve("load"),g):d.loadStyleLink(b,a.settingStyleFile)},loadWidgetConfig:function(a){a=require(d.getRequireConfig()).toUrl(a.configFile);if(require.cache["url:"+a]){var b=new c;b.resolve(e.parse(require.cache["url:"+a]));return b}return m(a,{handleAs:"json",headers:{"X-Requested-With":null}})},
loadWidgetI18n:function(a){var b=new c;require(d.getRequireConfig(),["dojo/i18n!"+a.i18nFile],function(a){b.resolve(a)});return b},loadWidgetSettingI18n:function(a){var b=new c;require(d.getRequireConfig(),["dojo/i18n!"+a.settingI18nFile],function(a){b.resolve(a)});return b},loadWidgetTemplate:function(a){var b=new c;require(d.getRequireConfig(),["dojo/text!"+a.templateFile],function(a){b.resolve(a)});d.checkError(a.templateFile,b);return b},loadWidgetSettingTemplate:function(a){var b=new c;require(d.getRequireConfig(),
["dojo/text!"+a.settingTemplateFile],function(a){b.resolve(a)});d.checkError(a.settingTemplateFile,b);return b},removeWidgetStyle:function(a){this._removeStyle(this._getStyleIdFromWidgetJson(a,!1))},removeWidgetSettingStyle:function(a){this._removeStyle(this._getStyleIdFromWidgetJson(a,!0))},_removeStyle:function(a){if(p.byId(a)){var d=p.attr(a,"data-import-styles");if(d)for(var b=0;b<parseInt(d,10);b++)p.destroy(a+"_import_"+b);p.destroy(a)}},_getStyleIdFromWidgetJson:function(a,d){return this._replaceId("widget/style/"+
(a.itemId?a.itemId:a.uri)+(d?"/setting":""))},getControllerWidgets:function(){return l.filter(this.loaded,function(a){return a.isController})},getOffPanelWidgets:function(){return l.filter(this.loaded,function(a){return!a.inPanel})},getOnScreenOffPanelWidgets:function(){return l.filter(this.loaded,function(a){return a.isOnScreen&&!a.inPanel})},closeOtherWidgetsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;for(var d=0;d<this.loaded.length;d++)this.loaded[d].gid===
a.gid&&this.loaded[d].id!==a.id&&this.closeWidget(this.loaded[d])},closeAllWidgetsInGroup:function(a){for(var d=0;d<this.loaded.length;d++)this.loaded[d].gid===a&&this.closeWidget(this.loaded[d])},_addDataSourceUsage:function(a){l.forEach(this._getUsedDataSourceIdFromWidget(a),function(d){B.getInstance().addDataSourceUsage(d,a.id)})},_removeDataSourceUsage:function(a){l.forEach(this._getUsedDataSourceIdFromWidget(a),function(d){B.getInstance().removeDataSourceUsage(d,a.id)})},_getUsedDataSourceIdFromWidget:function(a){if((a=
this.appConfig.getConfigElementById(a.id))&&a.config){var d=e.stringify(a.config);return l.filter(Object.keys(this.appConfig.dataSource.dataSources),function(a){return-1<d.indexOf(a)},this)}},_mergeAgolConfig:function(a){var b=this.appConfig._appData.values,g="widgets["+a.id+"]",e;for(e in b){var m=e.replace(/\//g,"_").indexOf(g+"_config");0<=m&&d.template.setConfigValue(a,e.replace(/\//g,"_").substr(m,e.length).replace(g,"widget"),b[e])}},_onUserSignIn:function(a){l.forEach(this.loaded,function(d){d.onSignIn(a)},
this)},_onUserSignOut:function(){l.forEach(this.loaded,function(a){a.onSignOut()},this)},_activeWidget:function(a){if(this.activeWidget){if(this.activeWidget.id===a.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&p.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&p.setStyle(a.domNode,"zIndex","zIndex"in a.position?a.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=
a;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&p.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),q.publish("widgetActived",a))},_onClickWidget:function(a,d){var g=b(".jimu-widget",a.domNode);if(0<g.length)for(var e=0;e<g.length;e++)if(d.target===g[e]||p.isDescendant(d.target,g[e]))return;this._activeWidget(a)},_onMoveStart:function(a){l.forEach(this.loaded,function(d){d.domNode===
a.node&&this._activeWidget(d)},this)},_onAppConfigLoaded:function(a){this.appConfig=a=f.clone(a);u.setPortalUrl(a.portalUrl)},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=a},_onSceneViewLoaded:function(a){this.sceneView=a},_onSceneViewChanged:function(a){this.sceneView=a},_onAppConfigChanged:function(a,d,b,g){var e=f.clone(a);this.appConfig=e;l.forEach(this.loaded,function(a){a&&(a.onAppConfigChanged(e,d,b,g),"widgetChange"===d&&this._onConfigChanged(b.id,b.config,g))},
this)},_onConfigChanged:function(a,d){if(a=this.getWidgetById(a))a.onConfigChanged(d),f.mixin(a.config,d)},_onActionTriggered:function(a){if("map"!==a.elementId&&"app"!==a.elementId){var d=this.getWidgetById(a.elementId);if(d)d.onAction(a.action,a.data);else this.missedActions.push({id:a.elementId,action:{name:a.action,data:a.data}});l.forEach(this.getControllerWidgets(),function(d){if(d.widgetIsControlled(a.elementId))d.onAction(a.action,{widgetId:a.elementId,data:a.data})},this)}},_resetFirstFocusNode:function(a){if(window.isMoveFocusWhenInit){var b=
this.getWidgetsByName("Splash")[0];if(b&&"none"!==p.getStyle(b.domNode,"display"))window.isMoveFocusWhenInit=!1,a&&"Splash"===a.name||b.domNode.focus();else if(window.currentMsgPopup&&window.currentMsgPopup.firstFocusNode)window.isMoveFocusWhenInit=!1,window.currentMsgPopup.focusedNodeBeforeOpen=d.getFirstSkipLink(),window.currentMsgPopup.firstFocusNode.focus();else if(window.isMoveFocusWhenInit)window.isMoveFocusWhenInit=!1,d.isInNavMode()&&d.focusOnFirstSkipLink();else return!1;return!0}},_postWidgetStartup:function(a){a.started=
!0;d.setVerticalCenter(a.domNode);t.after(a,"resize",f.hitch(this,d.setVerticalCenter,a.domNode));d.initTabIndexAndOrder(a);d.initWidgetCancelEvent(a);var b=a.position||a.panel&&a.panel.position;b&&"browser"===b.relativeTo&&k(a.domNode,"focus",f.hitch(this,function(){this._resetFirstFocusNode()}));this.openWidget(a);if(b=u.getPortalCredential(this.appConfig.portalUrl))a.onSignIn(b);else a.onSignOut();this._triggerMissedAction(a);a.inPanel||d.addTooltipByDomNode(h,a.domNode,a.label)},_triggerMissedAction:function(a){this.missedActions.forEach(function(d){if(d.id===
a.id)a.onAction(d.action.name,d.action.data)})},_remove:function(a){return l.some(this.loaded,function(d,b){if(d.id===a)return this.loaded.splice(b,1),!0},this)},_tryLoadResource:function(a,d){var b,g=new c;if("config"===d)b=a.amdFolder+"config.json",a.configFile=b,b="hasConfig";else if("style"===d)b=a.amdFolder+"css/style.css",a.styleFile=b,b="hasStyle";else if("i18n"===d)b=a.amdFolder+"nls/strings.js",a.i18nFile=a.isRemote?b:a.amdFolder+"nls/strings",b="hasLocale";else if("template"===d)b=a.amdFolder+
"Widget.html",a.templateFile=b,b="hasUIFile";else if("settingTemplate"===d)b=a.amdFolder+"setting/Setting.html",a.settingTemplateFile=b,b="hasSettingUIFile";else if("settingI18n"===d)b=a.amdFolder+"setting/nls/strings.js",a.settingI18nFile=a.isRemote?b:a.amdFolder+"setting/nls/strings",b="hasSettingLocale";else if("settingStyle"===d)b=a.amdFolder+"setting/css/style.css",a.settingStyleFile=b,b="hasSettingStyle";else return g;a[b]?function(){var b;if("config"===d)b=this.loadWidgetConfig(a);else if("style"===
d)b=this.loadWidgetStyle(a);else if("i18n"===d)b=this.loadWidgetI18n(a);else if("template"===d)b=this.loadWidgetTemplate(a);else if("settingTemplate"===d)b=this.loadWidgetSettingTemplate(a);else if("settingStyle"===d)b=this.loadWidgetSettingStyle(a);else if("settingI18n"===d)b=this.loadWidgetSettingI18n(a);else return g;b.then(function(a){g.resolve(a)},function(b){console.error("Load widget resource error. resource:",d);console.error(b);new v({message:window.jimuNls.widgetManager.loadWidgetResourceError+
": "+a.uri});g.reject(b)})}.apply(this):g.resolve(null);return g},_replaceId:function(a){return a.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(a){"closed"!==a.state&&this.closeWidget(a);this._removeWidget(a);this.emit("widget-destroyed",a.id);q.publish("widgetDestroyed",a.id);console.log("destroy widget ["+a.uri+"].")},_onDestroyWidgetSetting:function(a){this.removeWidgetSettingStyle(a)},_removeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this.activeWidget&&
this.activeWidget.id===a.id&&(this.activeWidget=null);this._remove(a.id);0===this.getWidgetsByName(a.name).length&&this.removeWidgetStyle(a)},_getActiveEventName:function(){var a="PointerEvent"in window?"pointer":"MSPointerEvent"in window?"MSPointer":!1,d=a&&"MS"===a.slice(0,2);return a?a+(d?"Down":"down"):"mousedown"}});C.getInstance=function(a){null===z&&(z=new C(a),window._widgetManager=z);return z};return C})},"jimu/tokenUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/config esri/request esri/urlUtils esri/sniff esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils jimu/utils esri/layers/vectorTiles/kernel".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v){"function"!==typeof c.getAll&&(c.getAll=function(a){var d=[];(a=c(a))&&d.push(a);return d});a={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return u.isInConfigOrPreviewWindow()},isStringStartWith:function(a,d){return a.substr(0,d.length)===d},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(a){(a=d.getStandardPortalUrl(a))&&
(a+="/");this.portalUrl=a},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(a){var b=new p,g=d.getStandardPortalUrl(a);a=g+"/sharing";var e=d.setHttpsProtocol(g+"/sharing/generateToken?f\x3djson"),m=d.setHttpsProtocol(a);k.get(e,{jsonp:"callback"}).then(r.hitch(this,function(a){a.token?(this.webTierPortalUrls.push(g),this.removeWabAuthCookie(),h.id.getCredential(m).then(r.hitch(this,function(m){function u(a){var d=a.creationTime||(new Date).getTime(),b=a.expires;0<d&&0<b&&b>
d&&setTimeout(function(){k.get(e,{jsonp:"callback"}).then(function(d){d.token&&(a.token=d.token,a.expires=d.expires,a.creationTime=(new Date).getTime(),a.refreshServerTokens(),u(a))},function(a){console.error(a)})},.8*(b-d))}m.token||(m.token=a.token);m.expires||(m.expires=a.expires);var h=this.findServerFromCorsEnabledServers(m.server);-1<h&&t.defaults.io.corsEnabledServers.splice(h,1);this._pushCorsEnabledServerInfo({host:d.getServerByUrl(g),withCredentials:!0});b.resolve(!0);u(m)}),r.hitch(this,
function(){b.resolve(!0)}))):b.resolve(!1)}),r.hitch(this,function(a){console.error(a);b.reject(a)}));return b},addAuthorizedCrossOriginDomains:function(a){if(a&&0<a.length)for(var d=0;d<a.length;d++)this.addWithCredentialDomain(a[d])},addWithCredentialDomain:function(a){if(a&&"string"===typeof a){var b=t.defaults.io.corsEnabledServers,g=d.getServerByUrl(a);(a=d.getServerWithProtocol(a))||(a="http://"+g);a=this.findServerFromCorsEnabledServers(a);-1<a&&b.splice(a,1);this._pushCorsEnabledServerInfo({host:g,
withCredentials:!0})}},findServerFromCorsEnabledServers:function(a){var d=t.defaults.io.corsEnabledServers,g,e=-1;m("esri-cors")&&d&&d.length&&f.some(d,function(d,m){d=!d||"object"!==typeof d||d instanceof RegExp?d:d.host;return!(d instanceof RegExp)&&d&&(g=0!==d.trim().toLowerCase().indexOf("http"),b.hasSameOrigin(a,g?"http://"+d:d)||g&&b.hasSameOrigin(a,"https://"+d))?(e=m,!0):!1});return e},_pushCorsEnabledServerInfo:function(a){if(a){var d=t.defaults.io.corsEnabledServers,b="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");
if("object"===typeof a&&"string"===typeof a.host){for(var g in a.host)a[g]="function"===typeof a.host[g]?function(){return a.host[g].apply(a.host,arguments)}:a.host[g];a.length=a.host.length;f.forEach(b,function(d){"function"===typeof a.host[d]&&(a[d]=function(){return a.host[d].apply(a.host,arguments)})})}d.push(a)}},tryRegisterCredential:function(a){return this.isValidCredential(a)?f.some(h.id.credentials,r.hitch(this,function(d){return a.token===d.token}))?!1:(h.id.credentials.push(a),!0):!1},
registerToken:function(a){var b=d.getSharingUrl(this.portalUrl);h.id.findCredential(b)&&f.some(h.id.credentials,r.hitch(this,function(a,d){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a))return h.id.credentials.splice(d,1),!0}));return this._getTokenInfo(a).then(function(a){a&&h.id.registerToken(a)})},_getTokenInfo:function(a){var b=d.getPortalSelfInfoUrl(this.portalUrl);return k.get(b+("?f\x3djson\x26token\x3d"+a),{jsonp:"callback"}).then(r.hitch(this,function(b){return b.user?{server:d.getSharingUrl(this.portalUrl),
ssl:b.allSSL,token:a,userId:b.user.username}:null}),function(a){console.error(a);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(a){return a&&"string"===typeof a&&r.trim(a)},signInPortal:function(a){var b=new p;if(this._isInvalidPortalUrl(a)){a=d.getStandardPortalUrl(a);var g=d.getSharingUrl(a),e=this.getPortalCredential(a);e?setTimeout(r.hitch(this,function(){b.resolve(e)}),0):b=h.id.getCredential(g)}else setTimeout(r.hitch(this,function(){b.reject("Invalid portalurl.")}),
0);return b},_loadPortalSelfInfo:function(a){a=d.getPortalSelfInfoUrl(a);return e({url:a,handleAs:"json",content:{f:"json"},callbackParamName:"callback"})},registerOAuthInfo:function(a,d){if(!a||"string"!==typeof a||!d||"string"!==typeof d)return null;var b=h.id.findOAuthInfo(a);b||(b=window.location.protocol+"//"+window.location.host+require.toUrl("jimu")+"/oauth-callback.html",b=new g({appId:d,expiration:20159,portalUrl:a,authNamespace:"/",popup:!0,popupCallbackUrl:b}),h.id.registerOAuthInfos([b]));
b.appId=d;return b},signOutAll:function(){var a=d.getStandardPortalUrl(this.portalUrl),b=!!h.id.findCredential(a+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():this.removeWabAuthCookie();h.id.destroyCredentials();h.id._oAuthHash=null;b&&this._publishCurrentPortalUserSignOut(a)},userHaveSignInPortal:function(a){return!!this.getPortalCredential(r.trim(a||""))},isValidCredential:function(a){var d=!1;if(a){var d=a.token,b=a.server,g=a.scope,d=d&&"string"===typeof d&&
r.trim(d),b=b&&"string"===typeof b&&r.trim(b),g="portal"===g||"server"===g,e=!0;a.expires&&(a=parseInt(a.expires,10),e=(new Date).getTime(),e=a>e);d=d&&b&&g&&e}return d},isValidPortalCredentialOfPortalUrl:function(a,b){var g=!1;this.isValidCredential(b)&&(g="portal"===b.scope,a=d.isSameServer(a,b.server),g=g&&a);return g},getPortalCredential:function(a){var b=null;a=r.trim(a||"");if(!a)return null;a=d.getStandardPortalUrl(a);(b=this._filterPortalCredential(a,h.id.credentials))||this._tryConvertArcGIScomCrendentialToOrgCredential();
return b},_tryConvertArcGIScomCrendentialToOrgCredential:function(){var a=this.portalUrl;if(a&&(a=d.getStandardPortalUrl(a),d.isOrgOnline(a)&&!this._filterPortalCredential(a,h.id.credentials))){var b=this._filterPortalCredential("http://www.arcgis.com",h.id.credentials);b&&h.id.registerToken({token:b.token,scope:"portal",userId:b.userId,server:a+"/sharing/rest",expires:b.expires})}},saveAndRegisterCookieToCredential:function(a){a=r.clone(a);a.referer=window.location.host;a.scope="portal";a.isAdmin=
!!a.isAdmin;this.saveWabCookie(a);var d=a.server+"/sharing/rest";a.server=d;h.id.registerToken(a);return h.id.findCredential(d,a.userId)},registerAuth2Hash:function(a){a=r.clone(a);var b=1E3*parseInt(a.expires_in,10),b=(new Date).getTime()+b,g=d.getStandardPortalUrl(a.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:g,token:a.access_token,expires:b,userId:a.username,scope:"portal",isAdmin:!!a.isAdmin})},saveWabCookie:function(a){this.removeCookie("wab_auth");
c("wab_auth",q.stringify(a),{expires:new Date(a.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(a,b){var g=null;a=d.getStandardPortalUrl(a);b&&0<b.length&&(b=f.filter(b,r.hitch(this,function(d){return this.isValidPortalCredentialOfPortalUrl(a,
d)})),0<b.length&&(g=b[b.length-1]));return g},_removePortalCredential:function(a){var b=r.trim(a||"");if(b){b=d.getStandardPortalUrl(b);for(a=f.filter(h.id.credentials,r.hitch(this,function(a){return this.isValidPortalCredentialOfPortalUrl(b,a)}));0<a.length;)a[0].destroy(),a.splice(0,1);h.id.credentials=f.filter(h.id.credentials,r.hitch(this,function(a){return!this.isValidPortalCredentialOfPortalUrl(b,a)}))}},getUserIdByToken:function(a,b){var g=new p;if(a&&"string"===typeof a&&b&&"string"===typeof b){var m=
d.getStandardPortalUrl(b);b=f.filter(h.id.credentials,r.hitch(this,function(b){var g=b.token===a&&b.userId;b=d.isSameServer(m,b.server);return g&&b}));if(0<b.length){var u=b[0];setTimeout(r.hitch(this,function(){g.resolve(u.userId)}),0);return g}b=d.getCommunitySelfUrl(m);e({url:b,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(r.hitch(this,function(a){g.resolve(a&&a.username||"")}),r.hitch(this,function(a){console.error(a);g.reject("fail to get userId by token")}))}else setTimeout(r.hitch(this,
function(){g.reject("invalid parameters")}),0);return g},xtGetCredentialFromCookie:function(a){var b=c("wab_auth"),g=null;if(b)try{g=q.parse(b)}catch(D){console.error(D)}if(!g||"object"!==typeof g||!d.isSameServer(a,g.server)||window.location.host!==g.referer)return null;g.expires=parseInt(g.expires,10);b=(new Date).getTime();if(!(g.expires>b))return this.removeCookie("wab_auth"),null;a+="/sharing/rest";g.server=a;(b=h.id.findCredential(a))||h.id.registerToken(g);return b=h.id.findCredential(a)},
removeCookie:function(a){var d=this.getCookiePath();u.removeCookie(a,d)},_getDomainsByServerName:function(a){var d=a.split("."),b=d.length;return f.map(d,r.hitch(this,function(a,g){a=d.slice(g,b);var e="",m=a.length-1;f.forEach(a,r.hitch(this,function(a,d){e+=a;d!==m&&(e+=".")}));return e}))},_publishCurrentPortalUserSignIn:function(a){if(this.isValidCredential(a))try{n.publish("userSignIn",a)}catch(z){console.error(z)}},_publishAnyUserSignIn:function(a){if(this.isValidCredential(a))try{n.publish("anyUserSignIn",
a)}catch(z){console.error(z)}},_publishCurrentPortalUserSignOut:function(a){try{n.publish("userSignOut",a)}catch(z){console.error(z)}},_signInSuccess:function(a){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a)&&this._publishCurrentPortalUserSignIn(a),this._publishAnyUserSignIn(a)}catch(z){console.error(z)}},_bindEvents:function(){l.after(h.id,"signIn",r.hitch(this,function(a,d){console.log(d[1]);l.after(a,"callback",r.hitch(this,function(a,d){this._signInSuccess(d[0],!1)}));return a}))},
isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var a=window.parent;if(a){var d=a.esri&&a.esri.id;d._wab="builder";if(d){h.id=d;var b=window.esriConfig.defaults.io,a=a.esriConfig.defaults.io;b.corsEnabledServers=a.corsEnabledServers;b.webTierAuthServers=a.webTierAuthServers;b._processedCorsServers=a._processedCorsServers;b.corsStatus=a.corsStatus;Object.defineProperty(v,"id",{get:function(){return d},enumerable:!0,configurable:!0})}}}this._bindEvents();
this._started=!0}}};a.startup();return a})},"esri/layers/vectorTiles/kernel":function(){define(["require","exports","esri/kernel","./identity/IdentityManager"],function(r,f,l,p){return function(){function c(){}Object.defineProperty(c,"id",{get:function(){return l.id?p:null},enumerable:!0,configurable:!0});c.workerMessages={};return c}()})},"esri/layers/vectorTiles/identity/IdentityManager":function(){define(["require","exports","esri/IdentityManager"],function(r,f,l){Object.defineProperty(f,"__esModule",
{value:!0});f.findCredential=function(f){return l.findCredential(f)}})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),function(r,f,l,p,c,q){return r(q,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,customZIndex:null,postMixInProperties:function(){this.content=this.message;window.currentMsgPopup=this},_createTitleNode:function(){this.titleLabel&&
(this.titleNode=l.create("div",{"class":"title"},this.domNode),this.titleLabeNode=l.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=l.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing",role:"button",tabindex:0},this.titleNode),this.own(c(this.closeBtnNode,"click",f.hitch(this,this.close))),this.own(c(this.closeBtnNode,"keydown",f.hitch(this,function(c){c.keyCode===p.ENTER&&(this.close(),this.focusLastActiveNode())}))))},
_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:p.ENTER,onClick:f.hitch(this,this.close)})},_increaseZIndex:function(){l.setStyle(this.domNode,"zIndex",501);l.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/Evented dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/keys dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a){var g=0;return r([m,l],{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",classNames:[],titleLabel:"",content:null,container:null,customZIndex:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,isResize:!0,horizontalWidthRate:0,maxHeight:800,maxWidth:1024,enableMoveable:!0,hasTitle:!0,contentHasNoMargin:!1,hasOverlay:!0,moveToCenter:!0,customPosition:null,hiddenAfterInit:!1,useFocusLogic:!0,constructor:function(){this.buttons=
[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},focusLastActiveNode:function(){this.focusedNodeBeforeOpen&&this.useFocusLogic&&this.focusedNodeBeforeOpen.focus()},postCreate:function(){this.focusedNodeBeforeOpen=document.activeElement;this._preProcessing();this.inherited(arguments);this._initDomNode();this._addStylesByHeightType();this._calcAndSetPosition();c.place(this.domNode,this.container);setTimeout(f.hitch(this,function(){this._calcAndSetPosition(!0,
!1);this.initFocusNodes()}),50);this.isResize&&this.own(n(window,"resize",f.hitch(this,function(){this._calcAndSetPosition(!0,!0)})));this.hasOverlay&&(this.overlayNode=c.create("div",{"class":"jimu-overlay"},this.container));this.customZIndex||0===this.customZIndex?(c.setStyle(this.domNode,"zIndex",this.customZIndex+1),this.overlayNode&&c.setStyle(this.overlayNode,"zIndex",this.customZIndex)):this._increaseZIndex();this.hiddenAfterInit&&this.hide();q.animateProperty({node:this.domNode,properties:{opacity:1},
duration:200}).play();c.setAttr(this.domNode,"aria-label",window.jimuNls.common.popup);this.own(n(this.domNode,"keydown",f.hitch(this,function(d){d.keyCode===k.ESCAPE&&(this.closeBtnNode?this.closeBtnNode.focus():(this.close(),this.focusLastActiveNode()));a.preventMapNavigation(d)})))},initFocusNodes:function(){if(this.useFocusLogic){if("string"===typeof this.content){var d="uniqMsgId_"+a.getUUID();c.setAttr(this.contentContainerNode,"id",d);c.setAttr(this.domNode,"tabindex","0");c.setAttr(this.domNode,
"aria-labelledby",d)}this.firstFocusNode=this._getFirstFocusNode();this.lastFocusNode=this._getLastFocusNode();this.firstFocusNode&&(this.own(n(this.firstFocusNode,"keydown",f.hitch(this,function(a){a.shiftKey&&a.keyCode===k.TAB&&(a.preventDefault(),this.firstFocusNode.focus())}))),this.firstFocusNode.focus());this.lastFocusNode&&this.own(n(this.lastFocusNode,"keydown",f.hitch(this,function(a){a.shiftKey||a.keyCode!==k.TAB||(a.preventDefault(),this.firstFocusNode.focus())})))}},_getFirstFocusNode:function(){var d=
this.closeBtnNode;"string"===typeof this.content&&(d=this.domNode);if(!d){var b=[];this.content.domNode?b=a.getFocusNodesInDom(this.content.domNode):1===this.content.nodeType&&(b=a.getFocusNodesInDom(this.content));0<b.length?d=b[0]:this.buttons.length&&(d=this._getFirstBtn())}return d},_getLastFocusNode:function(){var d=this._getLastBtn();if(!d)if(this.content&&"string"!==typeof this.content){var b;this.content.domNode?b=a.getFocusNodesInDom(this.content.domNode):1===this.content.nodeType&&(b=a.getFocusNodesInDom(this.content));
d=0<b.length?b[b.length-1]:this.closeBtnNode}else d=this.closeBtnNode;return d},_getFirstBtn:function(){for(var a=null,b=e(".jimu-btn",this.buttonContainer),g=0;g<=b.length-1;g++)if("none"!==c.getStyle(b[g],"display")){a=b[g];break}return a},_getLastBtn:function(){for(var a=null,b=e(".jimu-btn",this.buttonContainer),g=b.length-1;0<=g;g--)if("none"!==c.getStyle(b[g],"display")){a=b[g];break}return a},_preProcessing:function(){"number"!==typeof this.width&&(this.width=this.maxWidth);"number"===typeof this.height&&
(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=c.create("div",{"class":"title"},this.domNode);this.titleLabeNode=c.create("span",{"class":"title-label jimu-float-leading",innerHTML:a.sanitizeHTML(this.titleLabel)||"\x26nbsp"},this.titleNode);this.closeBtnNode=c.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing",tabindex:0,"aria-label":window.jimuNls.common.close,role:"button"},this.titleNode);
var d=null,d="ontouchstart"in document?t.press:"click";this.own(n(this.closeBtnNode,d,f.hitch(this,this.close)));this.own(n(this.closeBtnNode,"keydown",f.hitch(this,function(a){a.keyCode!==k.ENTER&&a.keyCode!==k.SPACE||this.close()})))},_initDomNode:function(){for(var a=0;a<=this.classNames.length-1;a++)c.addClass(this.domNode,this.classNames[a]);this.hasTitle&&this._createTitleNode();this.contentContainerNode=c.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?
this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&c.place(this.content,this.contentContainerNode));this.buttonContainer=c.create("div",{"class":"button-container"},this.domNode);0===this.buttons.length&&c.setStyle(this.buttonContainer,"display","none");for(a=0;a<=this.buttons.length-1;a++)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=
this.enabledButtons.length;if(0!==a){var b=c.getContentBox(this.buttonContainer),g=c.getMarginExtents(this.enabledButtons[0]),e=c.getPadBorderExtents(this.enabledButtons[0]),m=0,e=8===h("ie")?e.l+e.r:0,m=(b.w-(g.l+g.r+e)*a)/a;0<m&&(p.forEach(this.enabledButtons,f.hitch(this,function(a){c.setStyle(a,"maxWidth",m+"px")})),p.forEach(this.disabledButtons,f.hitch(this,function(a){c.setStyle(a,"maxWidth",m+"px")})))}},_moveableNode:function(a,g){this.moveable&&(this.moveable.destroy(),this.moveable=null);
var d=c.getMarginBox(this.container);d.l=d.l-a+g;d.w+=2*(a-g);this.moveable=new b.boxConstrainedMoveable(this.domNode,{box:d,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(n(this.moveable,"Moving",f.hitch(this,this.onMoving)));this.own(n(this.moveable,"MoveStop",f.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===e("#header").length?{t:0,l:0,w:0,h:0}:c.getMarginBox("header")},_getFooterBox:function(){return 0===e(".footer",this.container).length?{t:0,l:0,w:0,
h:0}:c.getMarginBox(e(".footer",this.container)[0])},_calcAndSetPosition:function(a,b){var d=c.getMarginBox(this.domNode);if("string"!==typeof this.container||c.byId(this.container)){var g=c.getContentBox(this.container),e=this._getHeaderBox(),m=this._getFooterBox(),m=g.h-e.h-m.h-40,h=0,u=0;this.customPosition&&this.customPosition.height?(this.height=this.customPosition.height,u="number"===typeof this.height?this.height+"px":this.height):(this.height=this._fixedHeight?this.height>m?m:this.height:
this.autoHeight?(d.h>m?m:d.h)||m-200:m>this.maxHeight?this.maxHeight:m,u=this.height+"px");this.customPosition&&this.customPosition.width?(this.width=this.customPosition.width,h="number"===typeof this.width?this.width+"px":this.width):("number"===typeof this.horizontalWidthRate&&0<this.horizontalWidthRate?(h=c.getMarginBox(window.document.body).w*this.horizontalWidthRate,this.width=h=h>this.maxWidth?h:this.maxWidth):this.width=this.width||this.maxWidth,h=this.width+"px");var k=d=0;this.customPosition?
(d="number"===typeof this.customPosition.left?this.customPosition.left+"px":this.customPosition.left,k="number"===typeof this.customPosition.top?this.customPosition.top+"px":this.customPosition.top):this.moveToCenter&&(k=(m-this.height)/2+e.h+20,k=k<e.h?e.h:k,d=(g.w-this.width)/2+"px",k+="px");c.setStyle(this.domNode,{width:h,height:this.autoHeight?"auto":u,left:d,top:k});this.enableMoveable&&this._moveableNode(this.width,100);!this.moveToCenter&&a&&"block"===c.getStyle(this.domNode,"display")&&this.emit("popupHasInitedSuccessfully",
b)}},setDomNodeStyls:function(a){c.setStyle(this.domNode,a)},setCustomPosition:function(a,b,g,e){this.width=g||this.width||this.maxWidth;this.height=e||this.height||this.maxHeight;g="number"===typeof this.width?this.width+"px":this.width;e="number"===typeof this.height?this.height+"px":this.height;c.setStyle(this.domNode,{left:"number"===typeof a?a+"px":a,top:"number"===typeof b?b+"px":b,width:g,height:this.autoHeight?"auto":e})},_addStylesByHeightType:function(){this.autoHeight?(c.addClass(this.contentContainerNode,
"content-static"),0===this.buttons.length&&c.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(c.addClass(this.contentContainerNode,"content-absolute"),this.hasTitle||c.addClass(this.contentContainerNode,"no-popup-title-content-absolute"),c.addClass(this.buttonContainer,"button-container-absolute"),0===this.buttons.length&&c.setStyle(this.contentContainerNode,{bottom:"15px"}));this.contentHasNoMargin&&c.addClass(this.contentContainerNode,"content-fill-Popup")},_increaseZIndex:function(){c.setStyle(this.domNode,
"zIndex",g+200+1);this.overlayNode&&c.setStyle(this.overlayNode,"zIndex",g+200);g++},setTitleLabel:function(d){this.titleNode.innerHTML=a.stripHTML(d)},onMoving:function(a){c.setStyle(a.node,"opacity",.9)},onMoveStop:function(a){c.setStyle(a.node,"opacity",1)},show:function(){this.overlayNode&&c.setStyle(this.overlayNode,"display","block");c.setStyle(this.domNode,"display","block")},hide:function(){this.overlayNode&&c.setStyle(this.overlayNode,"display","none");c.setStyle(this.domNode,"display","none")},
close:function(){if(!this.onClose||!1!==this.onClose()){var a=this.domNode.parentNode,b=f.clone(this.domNode);c.setStyle(this.domNode,"display","none");this.overlayNode&&c.destroy(this.overlayNode);this.destroy();this.moveable&&this.moveable.destroy();c.place(b,a);q.animateProperty({node:b,properties:{opacity:0},duration:200,onEnd:function(){c.destroy(b)}}).play();this.focusLastActiveNode();window.currentMsgPopup=null}},addButton:function(a){this._createButton(a)},_createButton:function(a){var d=
" ";a.classNames&&0<a.classNames.length&&"function"===typeof a.classNames.join&&(d+=a.classNames.join(" "));var b=c.create("div",{"class":"jimu-btn jimu-popup-action-btn jimu-float-trailing jimu-trailing-margin1 "+d,innerHTML:a.label,tabindex:0,role:"button",title:a.title||a.label},this.buttonContainer);this.enabledButtons.push(b);d=c.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+d,title:a.title||a.label,innerHTML:a.label,tabindex:0,role:"button",
"aria-disabled":"true",style:{display:"none"}},this.buttonContainer);this.disabledButtons.push(d);this.own(n(b,"click",f.hitch(this,function(d){if(a.onClick)a.onClick(d);else this.close()})));this.own(n(b,"keydown",f.hitch(this,function(d){if(d.keyCode===k.ENTER||d.keyCode===k.SPACE)if(a.onClick)a.onClick(d);else this.close()})))},setButtonProps:function(a,b){"number"===typeof a&&isFinite(a)||(b=a,a=0);if(b&&0!==this.enabledButtons.length)for(var d in b)"title"===d?(c.setAttr(this.enabledButtons[a],
"title",b[d]),c.setAttr(this.disabledButtons[a],"title",b[d])):"label"===d&&(c.setProp(this.enabledButtons[a],"innerHTML",b[d]),c.setProp(this.disabledButtons[a],"innerHTML",b[d]))},enableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.enabledButtons.length?(c.setStyle(this.enabledButtons[a],"display","inline-block"),c.setStyle(this.disabledButtons[a],"display","none")):(p.forEach(this.enabledButtons[a],f.hitch(this,function(a){c.setStyle(a,"display","inline-block")})),p.forEach(this.disabledButtons[a],
f.hitch(this,function(a){c.setStyle(a,"display","none")})))},disableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(c.setStyle(this.disabledButtons[a],"display","inline-block"),c.setStyle(this.enabledButtons[a],"display","none")):(p.forEach(this.disabledButtons,f.hitch(this,function(a){c.setStyle(a,"display","inline-block")})),p.forEach(this.enabledButtons,f.hitch(this,function(a){c.setStyle(a,"display","none")})))},showButton:function(a){this.enableButton(a)},
hideButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(c.setStyle(this.disabledButtons[a],"display","none"),c.setStyle(this.enabledButtons[a],"display","none")):(p.forEach(this.disabledButtons,f.hitch(this,function(a){c.setStyle(a,"display","none")})),p.forEach(this.enabledButtons,f.hitch(this,function(a){c.setStyle(a,"display","none")})))},resize:function(a){a&&(this.width=a.w,this.height=a.h);this._calcAndSetPosition();this.content&&this.content.domNode&&this.content.resize&&
this.content.resize()}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(r,f,l,p,c,q){p=r("dojo.dnd.move.constrainedMoveable",q,{constraints:function(){},within:!1,constructor:function(c,k){k||(k={});this.constraints=k.constraints;this.within=k.within},onFirstMove:function(c){var k=this.constraintBox=this.constraints.call(this,c);k.r=k.l+k.w;k.b=k.t+k.h;this.within&&(c=f.getMarginSize(c.node),k.r-=c.w,k.b-=c.h)},
onMove:function(c,k){var h=this.constraintBox,f=c.node.style;this.onMoving(c,k);k.l=k.l<h.l?h.l:h.r<k.l?h.r:k.l;k.t=k.t<h.t?h.t:h.b<k.t?h.b:k.t;f.left=k.l+"px";f.top=k.t+"px";this.onMoved(c,k)}});c=r("dojo.dnd.move.boxConstrainedMoveable",p,{box:{},constructor:function(c,k){var h=k&&k.box;this.constraints=function(){return h}}});r=r("dojo.dnd.move.parentConstrainedMoveable",p,{area:"content",constructor:function(c,k){var h=k&&k.area;this.constraints=function(){var c=this.node.parentNode,e=l.getComputedStyle(c),
b=f.getMarginBox(c,e);if("margin"==h)return b;var m=f.getMarginExtents(c,e);b.l+=m.l;b.t+=m.t;b.w-=m.w;b.h-=m.h;if("border"==h)return b;m=f.getBorderExtents(c,e);b.l+=m.l;b.t+=m.t;b.w-=m.w;b.h-=m.h;if("padding"==h)return b;m=f.getPadExtents(c,e);b.l+=m.l;b.t+=m.t;b.w-=m.w;b.h-=m.h;return b}}});return{constrainedMoveable:p,boxConstrainedMoveable:c,parentConstrainedMoveable:r}})},"jimu/DataSourceManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Evented dojo/when ./utils jimu/LayerInfos/LayerInfos jimu/portalUtils jimu/portalUrlUtils jimu/filterUtils esri/tasks/query esri/tasks/QueryTask esri/tasks/StatisticDefinition ./Query".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g){var d=null,u=r(c,{constructor:function(){this._listeners=[];this._refreshTimers=[];this._dataStore={};this._jimuQueryObject={};this._dataSourceUsage={};this._itemsFilter={};this.filterUtils=new e;window.isBuilder?(p.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),p.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(p.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),p.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));window.isBuilder?
(p.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),p.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(p.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),p.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));p.subscribe("updateDataSourceData",f.hitch(this,this._onUpdataDataSourceData));window.isBuilder&&p.subscribe("app/dataSourceDataUpdated",f.hitch(this,this._onDataSourceDataUpdatedInApp))},getData:function(a){return this._dataStore[a]},
getDataSourceConfig:function(a){return this.appConfig.dataSource.dataSources[a]},parseDataSourceId:function(a){var d=a.split("~"),b={};if(2>d.length)return console.error("Bad data source id:",a),b;switch(d[0]){case "map":return d=a.lastIndexOf("~"),b={from:"map",layerId:a.substring(4,d)};case "widget":return b={from:"widget",widgetId:d[1]};case "external":return b={from:"external"};default:console.error("Bad data source id:",a)}},addDataSourceUsage:function(a,d){this._dataSourceUsage[a]?(0>this._dataSourceUsage[a].indexOf(d)&&
this._dataSourceUsage[a].push(d),1===this._dataSourceUsage[a].length&&this._startOneDataSource(this.appConfig.dataSource.dataSources[a])):(this._dataSourceUsage[a]=[d],this._startOneDataSource(this.appConfig.dataSource.dataSources[a]))},removeDataSourceUsage:function(a,d){this._dataSourceUsage[a]&&0<=this._dataSourceUsage[a].indexOf(d)&&(this._dataSourceUsage[a]=l.filter(this._dataSourceUsage[a],function(a){return a!==d}))},_onUpdataDataSourceData:function(a,d){this.appConfig.dataSource.dataSources[a]?
"widget"!==this.parseDataSourceId(a).from?console.error("Please update data source from widget only.",a):this._updateDataSourceData(a,d):console.error("Not found data source id:",a)},_updateDataSourceData:function(a,d){this._dataStore[a]=d;p.publish("dataSourceDataUpdated",a,d);this.emit("update",a,d)},_onDataSourceDataUpdatedInApp:function(a,d){this._updateDataSourceData(a,d)},_onMapLoaded:function(a){this.map=a;window.isBuilder||this._handleDataSourceConfigChange(this.appConfig,this.appConfig,"mapLoaded")},
_onMapChanged:function(a){this.map=a;window.isBuilder||this._handleDataSourceConfigChange(this.appConfig,this.appConfig,"mapChanged")},_onAppConfigLoaded:function(a){this.appConfig=f.clone(a)},_onAppConfigChanged:function(a,d){a=f.clone(a);window.isBuilder||("dataSourceChange"===d?this._handleDataSourceConfigChange(this.appConfig,a,d):"mapChange"===d&&this._cleanForConfigChangedDataSource(this.appConfig,a));this.appConfig=a},_handleDataSourceConfigChange:function(a,d,b){a&&(this._removeListeners(),
this._removeTimers(),this._cleanForConfigChangedDataSource(a,d));l.forEach(Object.keys(d.dataSource.dataSources),function(a){d.dataSource.dataSources[a].idObj=this.parseDataSourceId(a)},this);this._listenDataSourceChange(d.dataSource.dataSources);this._startRefreshTimer(d.dataSource,b);this._initStaticDataSource(d.dataSource)},_cleanForConfigChangedDataSource:function(a,d){var b=a.dataSource.dataSources,g=d.dataSource.dataSources;l.forEach(Object.keys(b),function(a){if(!g[a]||g[a]&&!n.isEqual(g[a],
b[a]))delete this._jimuQueryObject[a],this._updateDataSourceData(a,{features:[]}),delete this._dataStore[a]},this)},_isGlobalRefresh:function(a){return a.unifiedRefreshInterval&&0<a.unifiedRefreshInterval},_startOneDataSource:function(a){var d;d=this._isGlobalRefresh(this.appConfig.dataSource.settings)?this.appConfig.dataSource.settings.unifiedRefreshInterval:a.refreshInterval;if("map"===a.idObj.from)this._listenMapDataSourceChange(a);else if("external"===a.idObj.from&&a.filterByExtent){var b={};
b.handle=this.map.on("extent-change",f.hitch(this,this._onLayerDataChange,a));b.dsId=a.id;this._listeners.push(b)}if("map"===a.idObj.from||"external"===a.idObj.from)this._refeshDataSource(a),a.isDynamic&&(b={},b.handle=setInterval(f.hitch(this,this._refeshDataSource,a),6E4*d),b.dsId=a.id,this._refreshTimers.push(b))},_stopAndCleanOneDataSource:function(a){this._listeners=l.filter(this._listeners,function(d){return d.dsId===a.id?(d.handle.remove(),!1):!0},this);this._refreshTimers=l.filter(this._refreshTimers,
function(d){return d.dsId===a.id?(clearInterval(d.handle),!1):!0},this);this._updateDataSourceData(a.id,{features:[]})},_listenDataSourceChange:function(a){l.forEach(Object.keys(a),function(d){d=a[d];if("map"===d.idObj.from)this._listenMapDataSourceChange(d);else if("external"===d.idObj.from&&d.filterByExtent){var b={};b.handle=this.map.on("extent-change",f.hitch(this,this._onLayerDataChange,d));b.dsId=d.id;this._listeners.push(b)}},this)},_listenMapDataSourceChange:function(a){this._getLayerObject(a.idObj.layerId).then(f.hitch(this,
function(d){if(d){var b={};b.handle=d.on("edits-complete",f.hitch(this,this._onLayerDataChange,a));b.dsId=a.id;this._listeners.push(b);b={};b.handle=this._getLayerInfo(a.idObj.layerId).on("filterChanged",f.hitch(this,this._onLayerDataChange,a));b.dsId=a.id;this._listeners.push(b);a.filterByExtent&&(b={},b.handle=this.map.on("extent-change",f.hitch(this,this._onLayerDataChange,a)),b.dsId=a.id,this._listeners.push(b))}else console.error("Can not find layer that data source depends on.",a.id)}))},_onLayerDataChange:function(a){this._doQueryForDataSource(a)},
_doQueryForDataSource:function(a){("config"===this.appConfig.mode||this._dataSourceUsage[a.id]&&0!==this._dataSourceUsage[a.id].length)&&this.doQuery(a).then(f.hitch(this,function(d){this._updateDataSourceData(a.id,{features:d.features})}))},_getLayerObject:function(a){return(a=k.getInstanceSync().getLayerOrTableInfoById(a))?a.getLayerObject():q(null)},_getLayerInfo:function(a){return k.getInstanceSync().getLayerOrTableInfoById(a)},_startRefreshTimer:function(a,d){var b=a.dataSources,g=a.settings;
l.forEach(Object.keys(b),function(e){e=b[e];if("widget"!==e.idObj.from&&e.isDynamic&&e.url){var m;m=this._isGlobalRefresh(g)?g.unifiedRefreshInterval:e.refreshInterval;"dataSourceChange"===d?"external"!==e.idObj.from&&"map"!==e.idObj.from||this._refeshDataSource(e):"external"===e.idObj.from&&this._refeshDataSource(e);e={handle:setInterval(f.hitch(this,this._refeshDataSource,e),6E4*m),dsId:a.id};this._refreshTimers.push(e)}},this)},_initStaticDataSource:function(a){l.forEach(Object.keys(a.dataSources),
function(d){d=a.dataSources[d];"widget"!==d.idObj.from&&!d.isDynamic&&d.url&&this._doQueryForDataSource(d)},this)},_refeshDataSource:function(a){this._doQueryForDataSource(a)},_getDataSourceFilter:function(a){if("map"===a.idObj.from){var d=k.getInstanceSync().getLayerOrTableInfoById(a.idObj.layerId),b;d&&(b=d.getFilter());var d=a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1",g;g=b?"("+b+") and ("+d+")":d;return q(g)}return"external"===a.idObj.from?a.portalUrl&&a.itemId?this._getFilterFromItem(a.portalUrl,
a.itemId,a.url).then(f.hitch(this,function(d){var b=a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1";return g=d?"("+d+") and ("+b+")":b})):q(a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1"):q(a.filter?this._getFilterExpr(a.filter,a.url):"1\x3d1")},_getFilterExpr:function(a,d){return this.filterUtils.hasVirtualDate(a)?(this.filterUtils.isHosted=n.isHostedService(d),this.filterUtils.getExprByFilterObj(a)):a.expr},_getFilterFromItem:function(a,d,b){var g=t.getItemUrl(a,d);if(this._itemsFilter[g])return q(this._itemsFilter[g]);
var e=h.getPortal(a);return e.getItemById(d).then(f.hitch(this,function(a){return"Feature Service"!==a.type?this._itemsFilter[g]=null:e.getItemData(d).then(f.hitch(this,function(a){var d=b.split("/"),e=d.pop();e||(e=d.pop());if(!a.layers)return this._itemsFilter[g]=null;a=a.layers.filter(function(a){return a.id+""===e})[0];return a&&a.layerDefinition?this._itemsFilter[g]=a.layerDefinition.definitionExpression:this._itemsFilter[g]=null}))}))},doQuery:function(d){d.idObj||(d.idObj=this.parseDataSourceId(d.id));
this.emit("begin-update",d.id);return this._getQueryObjectFromDataSource(d).then(f.hitch(this,function(e){var h,u;if("Features"===d.type){if("serviceLimitation"===d.resultRecordType)return h=e,u=new m(d.url),u.execute(h);var c=this._jimuQueryObject[d.id];!c||c.url===d.url&&n.isEqual(c.query.toJson(),e.toJson())||(delete this._jimuQueryObject[d.id],c=null);c||(c={},c.url=d.url,c.query=e,"all"!==d.resultRecordType&&(c.pageSize=d.resultRecordCount),c=new g(c),this._jimuQueryObject[d.id]=c);return"all"===
d.resultRecordType?c.getAllFeatures():c.queryByPage(1)}u=new m(d.url);h=new b;return this._getDataSourceFilter(d).then(f.hitch(this,function(b){h.where=b;d.filterByExtent&&(h.geometry=this.map.extent);d.dataSchema.groupByFields&&0<d.dataSchema.groupByFields.length&&(h.groupByFieldsForStatistics=d.dataSchema.groupByFields);d.dataSchema.orderByFields&&0<d.dataSchema.orderByFields.length&&(h.orderByFields=d.dataSchema.orderByFields);h.outStatistics=d.dataSchema.statistics.map(function(d){var b=d.onStatisticField+
"_"+d.statisticType;"count"===d.statisticType&&(b="STAT_COUNT");var b=n.upperCaseString(b),g=new a;g.statisticType=d.statisticType;g.onStatisticField=d.onStatisticField;g.outStatisticFieldName=b;return g});return u.execute(h)}))}))},_getQueryObjectFromDataSource:function(a){return this._getDataSourceFilter(a).then(f.hitch(this,function(d){var g=new b;g.where=d;a.filterByExtent&&(g.geometry=this.map.extent);g.outFields=a.dataSchema.fields.map(function(a){return a.name});a.dataSchema.orderByFields&&
0<a.dataSchema.orderByFields.length&&(g.orderByFields=a.dataSchema.orderByFields);g.returnGeometry=!0;g.outSpatialReference=this.map.spatialReference;return q(g)}))},_removeListeners:function(){this._listeners.forEach(f.hitch(this,function(a){a.handle.remove()}));this._listeners=[]},_removeTimers:function(){this._refreshTimers.forEach(f.hitch(this,function(a){clearInterval(a.handle)}));this._refreshTimers=[]}});u.getInstance=function(){null===d&&(d=new u,window._datasourceManager=d);return d};return u})},
"jimu/LayerInfos/LayerInfos":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/on dojo/topic dojo/Evented dojo/promise/all ./LayerInfoFactory libs/crc".split(" "),function(r,f,l,p,c,q,n,k,h,t){var e=r([n],{declaredClass:"jimu.LayerInfos",map:null,_operLayers:null,_layerInfos:null,_finalLayerInfos:null,_tableInfos:null,_basemapLayerInfos:null,_finalBasemapLayerInfos:null,_basemapLayers:null,_unreachableLayersTitleOfWebmap:null,_objectId:null,_layerInfoFactory:null,
_previousLayerOrder:null,constructor:function(a,b){this._objectId=Math.random();this._unreachableLayersTitleOfWebmap=[];this._basemapLayers=b.baseMap.baseMapLayers;this._operLayers=b.operationalLayers;this._tables=b.tables;this._layerInfoFactory=new h(a,this);this.map=a;this._previousLayerOrder=[].concat(this.map.layerIds,this.map.graphicsLayerIds);this._initLayerInfos();this._initBasemapLayerInfos();this._initTablesInfos();this.update();this._bindEvents()},update:function(){this._extraSetLayerInfos();
this._clearAddedFlag(this._finalLayerInfos);this._clearAddedFlag(this._finalBasemapLayerInfos);this._initFinalLayerInfos();this._initFinalBasemapLayerInfos();this._markFirstOrLastNode()},getLayerInfoArrayOfWebmap:function(){var a=[];f.forEach(this.getLayerInfoArray(),function(b){for(var d=0;d<this._operLayers.length;d++)if(b.id===this._operLayers[d].id){a.push(b);break}d===this._operLayers.length&&0<=this._removedLayerInfoIdsFromFeatureCollection.indexOf(b.id)&&a.push(b)},this);return a},getTableInfoArrayOfWebmap:function(){var a=
[];f.forEach(this.getTableInfoArray(),function(b){for(var d=0;d<this._tables.length;d++)if(b.id===this._tables[d].id){a.push(b);break}},this);return a},getLayerInfoArray:function(){return f.filter(this._finalLayerInfos,function(a){l.getObject("_wabProperties.isTemporaryLayer",!1,a.layerObject)&&(a._flag._isTemporaryLayerInfo=!0);return!a._flag._isTemporaryLayerInfo})},getTableInfoArray:function(){return this._tableInfos},getBasemapLayerInfoArray:function(){return this._finalBasemapLayerInfos},addFeatureCollection:function(a,
b){var d=this._getUniqueTopLayerInfoId(b),g={layers:[]};f.forEach(a,function(a,b){a.id=d+"_"+b;g.layers.push({id:a.id,layerObject:a})},this);this.map.addLayers(a);var e;try{e=this._layerInfoFactory.create({featureCollection:g,title:b||d,id:d},this.map),e.init()}catch(B){console.warn(B.message),e=null}e&&(e._extraOfWebmapLayerInfo=!0,this._layerInfos.push(e),this.update(),this._onLayersUpdated(e,e.getRootLayerInfo()))},addTable:function(a){a=this._addTables([a],this._tableInfos);return a[0]?a[0]:null},
removeTable:function(a){var b=-1;f.forEach(this._tableInfos,function(d,g){a.id===d.id&&(b=g)});if(0<=b){var d=this._tableInfos[b];this._tableInfos.splice(b,1);d.destroy();this._onTableChange([a],e.REMOVED)}},_addTables:function(a,b){var d=[],g=[];f.forEach(a,function(a){var e;try{a.layerObject={url:a.url,featureCollectionData:a.featureCollectionData,empty:!0},a.id=this._getUniqueTableId(a.id),a.selfType="table",e=this._layerInfoFactory.create(a),e.init()}catch(z){console.warn(z.message),e=null}e&&
(d.push(e),b.push(e),g.push(e.getLayerObject()))},this);k(g).then(l.hitch(this,function(a){var b=[];f.forEach(a,function(a,g){g=d[g];a?b.push(g):(this.removeTable(g),g.destroy())},this);this._onTableChange(b,e.ADDED)}));return d},_getUniqueTableId:function(a){var b=this._tableInfos.concat(this._tableInfos||[]);return this._getUniqueLayerOrTableId(a,b)},_getUniqueTopLayerInfoId:function(a){return this._getUniqueLayerOrTableId(a,this._finalLayerInfos)},_getUniqueLayerOrTableId:function(a,b){var d=1,
g;a||(a="table");for(g=a;;){for(var e=0;e<b.length&&b[e].id!==g;e++);if(e===b.length)return g;g=a+"_"+d.toString();d++}},_traversal:function(a,b){for(var d=0;d<b.length;d++)if(b[d].traversal(a))return!0;return!1},traversal:function(a){var b=this.getLayerInfoArray();return this._traversal(a,b)},traversalLayerInfosOfWebmap:function(a){var b=this.getLayerInfoArrayOfWebmap();return this._traversal(a,b)},traversalAll:function(a){var b=this.getLayerInfoArray(),d=this.getBasemapLayerInfoArray(),e=this.getTableInfoArray(),
b=b.concat(d.concat(e));return this._traversal(a,b)},_traversalAllWithSpecialLayerInfo:function(a){return this._traversal(a,this._finalLayerInfos.concat(this._tableInfos))},getLayerInfoById:function(a){return this._findLayerInfoById(a)},getTableInfoById:function(a){var b=null;f.some(this.getTableInfoArray(),function(d){if(d.id===a)return b=d,!0});return b},getLayerOrTableInfoById:function(a){var b=null;this.traversalAll(function(d){if(d.id===a)return b=d,!0});return b},getLayerInfoByTopLayerId:function(a){return this._findTopLayerInfoById(a)},
moveUpLayer:function(a,b){var d=null;b=b?b:1;a=this._getTopLayerInfoIndexById(a.id);0<=a-b&&(d=this._finalLayerInfos[a-b].obtainLayerIndexesInMap().length,this._finalLayerInfos[a].moveRightOfIndex(this._finalLayerInfos[a-b].obtainLayerIndexesInMap()[d-1].index),d=this._finalLayerInfos[a-b]);return d},_reorderLayerInfosArray:function(a,b,d){"moveup"===d?(d=this._finalLayerInfos[a],this._finalLayerInfos.splice(a,1),this._finalLayerInfos.splice(a-b,0,d)):(d=this._finalLayerInfos[a],this._finalLayerInfos.splice(a+
b+1,0,d),this._finalLayerInfos.splice(a,1));this._markFirstOrLastNode();return d},moveDownLayer:function(a,b){var d=null;b=b?b:1;a=this._getTopLayerInfoIndexById(a.id);a+b<=this._finalLayerInfos.length-1&&(this._finalLayerInfos[a].moveLeftOfIndex(this._finalLayerInfos[a+b].obtainLayerIndexesInMap()[0].index),d=this._finalLayerInfos[a+b]);return d},getBasemapLayers:function(){var a=[];f.forEach(this.map.layerIds.concat(this.map.graphicsLayerIds||[]),function(b){b=this.map.getLayer(b);"basemap"!==b._basemapGalleryLayerType&&
"reference"!==b._basemapGalleryLayerType||a.push(b)},this);return a.reverse()},getMapNotesLayerInfoArray:function(){return f.filter(this.getLayerInfoArray(),function(a){return a.isMapNotesLayerInfo()},this)},restoreState:function(a){var b=a&&a.layerOptions?a.layerOptions:null;f.forEach(this._finalLayerInfos,function(a){a.resetLayerObjectVisibility(b)},this)},_getEncodedLayerIdsOfCurrentMap:function(){this._encodedLayerIds||(this._encodedLayerIds={encodedToLayerIds:{},layerIdsToEncoded:{}},this.traversal(l.hitch(this,
function(a){var b=this._encodeLayerId(a.id);this._encodedLayerIds.encodedToLayerIds[b]=a.id;this._encodedLayerIds.layerIdsToEncoded[a.id]=b})));return this._encodedLayerIds},_getShowOrHideLayerIdsBySimpleState:function(a){var b=[],d=[],e={showLayerIds:null,hideLayerIds:null},m=this._getEncodedLayerIdsOfCurrentMap().encodedToLayerIds;a&&a.showLayersEncoded&&m?(f.forEach(a.showLayersEncoded,function(a){(a=m[a])&&b.push(a)}),e.showLayerIds=b):a&&a.showLayers?e.showLayerIds=a.showLayers:a&&a.hideLayersEncoded&&
m?(f.forEach(a.hideLayersEncoded,function(a){(a=m[a])&&d.push(a)}),e.hideLayerIds=d):a&&a.hideLayers&&(e.hideLayerIds=a.hideLayers);return e},setSimplificationState:function(a){var b={layerOptions:{}},d=this._getShowOrHideLayerIdsBySimpleState(a);this.traversal(l.hitch(this,function(a){b.layerOptions[a.id]={};var g,e,m=null;d.showLayerIds?(g=d.showLayerIds,e=!0):(g=d.hideLayerIds,e=!1);f.some(g,function(d){if(a.id===d)return m=a.id,!0;if(a.title.trim&&d.trim&&a.title.trim()===d.trim())return m=a.id,
!1});b.layerOptions[a.id].visible=e?null!==m?!0:!1:null===m?!0:!1}));this.restoreState(b)},getSimplificationState:function(){var a={showLayers:[],showLayersEncoded:[],hideLayers:[],hideLayersEncoded:[]};this.traversal(l.hitch(this,function(b){b.isVisible()?(a.showLayers.push(b.id),a.showLayersEncoded.push(this._encodeLayerId(b.id))):(a.hideLayers.push(b.id),a.hideLayersEncoded.push(this._encodeLayerId(b.id)))}));return a},_encodeLayerId:function(a){var b=t.crc24;a=b(a);a=parseInt(a,16);return a=a.toString(36)},
getUnreachableLayersTitle:function(){return this._unreachableLayersTitleOfWebmap},getObjectId:function(){return this._objectId},_initLayerInfos:function(){this._layerInfos=[];this._initSpecifiedLayerInfos(this._operLayers,this._layerInfos)},_initBasemapLayerInfos:function(){this._basemapLayerInfos=[];this._initSpecifiedLayerInfos(this._basemapLayers,this._basemapLayerInfos)},_initSpecifiedLayerInfos:function(a,b){var d;f.forEach(a,function(a){try{d=this._layerInfoFactory.create(a),d.init()}catch(v){console.warn(v.message),
d=null,0<=v.message.indexOf("declaredClass")&&this._unreachableLayersTitleOfWebmap.push(a.title)}d&&b.push(d)},this)},_extraSetLayerInfos:function(){this._removedLayerInfoIdsFromFeatureCollection=[];f.forEach(this._finalLayerInfos||this._layerInfos,function(a,b){var d;if(a._needToRenew()){try{d=this._layerInfoFactory.create(a.originOperLayer),d.init()}catch(v){console.warn(v.message),d=null}d&&(a.destroy(),this._finalLayerInfos[b]=d)}else if(a.originOperLayer.featureCollection){var g=[];f.forEach(a.getSubLayers(),
function(a){g.push(a.id)});f.forEach(g,function(d){this.map.getLayer(d)||a.removeSubLayerById(d)},this);1===a.getSubLayers().length&&(b=a.getSubLayers()[0],this.map.getLayer(b.id).title=a.title,a.removeSubLayerById(b.id),this._removedLayerInfoIdsFromFeatureCollection.push(b.id),a.id+="_logically_removed")}},this)},_refineFinalLayerInfos:function(){this._finalLayerInfos&&(this._finalLayerInfos=f.filter(this._finalLayerInfos,function(a){return!a._flag._invalid}))},_initFinalLayerInfos:function(){var a,
b,d=this._finalLayerInfos||this._layerInfos;this._finalLayerInfos=[];for(a=this.map.graphicsLayerIds.length-1;0<=a;a--)b=this.map.graphicsLayerIds[a],this._isBasemap(b)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(b,d),b,!0);for(a=this.map.layerIds.length-1;0<=a;a--)b=this.map.layerIds[a],this._isBasemap(b)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(b,d),b,!1);this._refineFinalLayerInfos()},_initTablesInfos:function(){this._tableInfos=[];var a=this._tables&&
this._tables.reverse();a&&this._addTables(a,this._tableInfos)},_initFinalBasemapLayerInfos:function(){var a=this._finalBasemapLayerInfos||this._basemapLayerInfos;this._finalBasemapLayerInfos=[];f.forEach(this.getBasemapLayers(),function(b){var d;f.some(a,function(a){if(a.id===b.id)return d=a,!0},this);this._addToFinalBasemapLayerInfos(d,b.id,!1)},this)},_isBasemap:function(a){for(var b=!1,d=this.getBasemapLayers(),e=0;e<d.length;e++)d[e].id===a&&(b=!0);return b},_addToFinalBasemapLayerInfos:function(a,
b,d){this._addToSpecifiedLayerInfos(a,b,d,this._finalBasemapLayerInfos)},_addToFinalLayerInfos:function(a,b,d){this._addToSpecifiedLayerInfos(a,b,d,this._finalLayerInfos)},_addToSpecifiedLayerInfos:function(a,b,d,e){var g;if(a)a._addedFlag||a.isGraphicLayer()!==d||(e.push(a),a._addedFlag=!0);else{a=this.map.getLayer(b);if("esri.layers.GraphicsLayer"!==a.declaredClass&&"esri.layers.LabelLayer"!==a.declaredClass){try{var m={layerObject:a,title:this._getLayerTitle(a),id:a.id||" "};l.mixin(m,l.getObject("_wabProperties.originOperLayer",
!1,a));g=this._layerInfoFactory.create(m,this.map);g.init()}catch(z){console.warn(z.message),g=null}g&&(l.getObject("_wabProperties.isTemporaryLayer",!1,a)&&(g._flag._isTemporaryLayerInfo=!0),e.push(g))}("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass)&&g&&g._getServiceDefinition().then(l.hitch(this,function(a){var d=[];f.forEach(a.tables,function(a){a.url=g.getUrl()+"/"+a.id;a.id=g.id+"_"+a.id;a.title=this._getLayerTitle(a);
d.push(a)},this);this._addTables(d,this._tableInfos)}))}},_getLayerTitle:function(a){if(a.title)return a.title;if(l.getObject("_wabProperties.originalLayerName",!1,a))return a.name||a.id;var b=a.label||a.name||"";if(a.url&&!l.getObject("_wabProperties.itemLayerInfo",!1,a)){var d;d=a.url.indexOf("/FeatureServer");-1===d&&(d=a.url.indexOf("/MapServer"));-1===d&&(d=a.url.indexOf("/service"));-1<d&&(d=a.url.substring(0,d),d=d.substring(d.lastIndexOf("/")+1,d.length),b=b?d+" - "+b:d)}return b||a.id},_findLayerInfoByIdAndReturnTopLayer:function(a,
b){var d,g=null;b||(b=this._finalLayerInfos);for(d=0;d<b.length;d++)if(g=b[d].findLayerInfoById(a)){g=b[d];break}return g},_findLayerInfoById:function(a,b){var d,g=null;b||(b=this._finalLayerInfos);for(d=0;d<b.length&&!(g=b[d].findLayerInfoById(a));d++);return g},_findTopLayerInfoById:function(a){var b,d=null,e=[].concat(this._finalLayerInfos||[],this._tableInfos||[]);for(b=0;b<e.length;b++)if(e[b].id===a){d=e[b];break}return d},_getTopLayerInfoIndexById:function(a){var b,d=-1;for(b=0;b<this._finalLayerInfos.length;b++)if(this._finalLayerInfos[b].id===
a){d=b;break}return d},_clearAddedFlag:function(a){f.forEach(a,function(a){a._addedFlag=!1})},_markFirstOrLastNode:function(){var a;if(this._finalLayerInfos.length){for(a=0;a<this._finalLayerInfos.length;a++)this._finalLayerInfos[a].isFirst=!1,this._finalLayerInfos[a].isLast=!1;this._finalLayerInfos[0].isFirst=!0;this._finalLayerInfos[this._finalLayerInfos.length-1].isLast=!0;for(a=0;a<this._finalLayerInfos.length;a++)if(!this._finalLayerInfos[a].isGraphicLayer()){a&&(this._finalLayerInfos[a-1].isLast=
!0);this._finalLayerInfos[a].isFirst=!0;break}}},_onReceiveBasemapGalleryeData:function(a,b,d){"BasemapGallery"===a&&(this._basemapLayers.length=0,f.forEach(d,l.hitch(this,function(a){this._basemapLayers.push({layerObject:a,id:a.id})}),this),this.update(),this.emit("layerInfosChanged"))},_onBasemapChange:function(a){var b;for(b=this._basemapLayers.length=0;b<a.layers.length;b++)this._basemapLayers.push({layerObject:a.layer[b],id:a.layers[b].id})},_destroyLayerInfos:function(){f.forEach(this._finalLayerInfos,
l.hitch(this,function(a){a.destroy()}))},_bindEvents:function(){var a,b,d,m,h,k,f,t,n,p,w;a=c(this.map,"layer-add-result",l.hitch(this,this._onLayersChange,e.ADDED));b=c(this.map,"layer-remove",l.hitch(this,this._onLayersChange,e.REMOVED));f=c(this.map,"layer-reorder",l.hitch(this,this._onLayerReorder));m=q.subscribe("layerInfos/layerInfo/isShowInMapChanged",l.hitch(this,this._onShowInMapChanged));h=q.subscribe("layerInfos/layerInfo/visibleChanged",l.hitch(this,this._onVisibleChanged));k=q.subscribe("layerInfos/layerInfo/filterChanged",
l.hitch(this,this._onFilterChanged));t=q.subscribe("layerInfos/layerInfo/rendererChanged",l.hitch(this,this._onRendererChanged));n=q.subscribe("layerInfos/layerInfo/opacityChanged",l.hitch(this,this._onOpacityChanged));w=q.subscribe("layerInfos/layerInfo/scaleRangeChanged",l.hitch(this,this._onScaleRangeChanged));p=q.subscribe("layerInfos/layerInfo/timeExtentChanged",l.hitch(this,this._onTimeExtentChanged));d=c(this.map,"before-unload",l.hitch(this,function(){a.remove();b.remove();f.remove();m.remove();
h.remove();k.remove();t.remove();d.remove();n.remove();w.remove();p.remove();this._destroyLayerInfos()}))},_emitEvent:function(){try{this.emit.apply(this,arguments)}catch(a){console.warn(a)}},_emitEventForEveryLayerInfo:function(a,b,d){try{f.forEach(b,function(b){b.emitEvent(a,d)},this)}catch(u){console.warn(u)}},_onLayersChange:function(a,b){var d=null,g;b.error||"esri.layers.GraphicsLayer"===b.layer.declaredClass||"esri.layers.LabelLayer"===b.layer.declaredClass||(a===e.ADDED?(this.update(),d=a=
this._findLayerInfoById(b.layer.id,b.layer._basemapGalleryLayerType?this._finalBasemapLayerInfos:this._finalLayerInfos),g=e.ADDED,a&&!a.isRootLayer()&&(d=a.getRootLayerInfo(),g=e.SUBLAYER_ADDED)):(d=a=this._findLayerInfoById(b.layer.id,b.layer._basemapGalleryLayerType?this._finalBasemapLayerInfos:this._finalLayerInfos),g=e.REMOVED,a&&!a.isRootLayer()&&(d=a.getRootLayerInfo(),g=e.SUBLAYER_REMOVED),a&&a.destroy(),this.update()),d&&(b.layer._basemapGalleryLayerType?(this._emitEvent("basemapLayersChanged"),
this._emitEvent("basemapLayerInfosChanged",d,g,a)):this._emitEvent("layerInfosChanged",d,g,a)))},_onTableChange:function(a,b){this._emitEvent("tableInfosChanged",a,b,a)},_onLayersUpdated:function(a,b){a.isTable?this._emitEvent("tableInfosChanged",[a],e.UPDATED,[b]):this._emitEvent("layerInfosChanged",a,e.UPDATED,b)},_onShowInMapChanged:function(a){this._emitEvent("layerInfosIsShowInMapChanged",a);this._emitEventForEveryLayerInfo("isShowInMapChanged",a)},_onVisibleChanged:function(a){this._emitEvent("layerInfosIsVisibleChanged",
a);this._emitEventForEveryLayerInfo("isVisibleChanged",a)},_onFilterChanged:function(a,b){this._emitEvent("layerInfosFilterChanged",a,b);this._emitEventForEveryLayerInfo("filterChanged",a,b)},_onLayerReorder:function(){var a=[].concat(this.map.layerIds,this.map.graphicsLayerIds),b=f.some(a,l.hitch(this,function(a,b){return a===this._previousLayerOrder[b]?!1:!0}));a.length===this._previousLayerOrder.length&&b&&(this.update(),this._emitEvent("layerInfosReorder",null,e.REORDERED));this._previousLayerOrder=
a},_onRendererChanged:function(a){this._emitEvent("layerInfosRendererChanged",a);this._emitEventForEveryLayerInfo("rendererChanged",a)},_onOpacityChanged:function(a){this._emitEvent("layerInfosOpacityChanged",a);this._emitEventForEveryLayerInfo("opacityChanged",a)},_onScaleRangeChanged:function(a){this._emitEvent("layerInfosScaleRangeChanged",a);this._emitEventForEveryLayerInfo("scaleRangeChanged",a)},_onTimeExtentChanged:function(a){this._emitEvent("layerInfosTimeExtentChanged",a);this._emitEventForEveryLayerInfo("timeExtentChanged",
a)}});e.getLayerInfoArrayByType=function(a,b){var d=new p,g=[],m=[];e.getInstance(a,a.iteminfo).then(function(a){a.traversal(function(a){var d=a.getLayerType();d.layerInfo=a;g.push(d)});k(g).then(function(a){f.forEach(a,function(a,d){b===a&&m.push(g[d].layerInfo)});d.resolve(m)})});return d};var b=null,m=null;e.getInstance=function(a,b){var d=new p;d.resolve(e.getInstanceSyncForInit(a,b));return d};e.getInstanceSyncForInit=function(a,g){b&&b!==a&&(m=b=null);m||(m=new e(a,g.itemData),b=a);return m};
e.getInstanceSync=function(){return m};e.setInstance=function(a,g){b=a;m=g};e.createInstance=function(a){var b=null;return b=new e(a,a.itemInfo.itemData)};l.mixin(e,{ADDED:"added",REMOVED:"removed",SUBLAYER_ADDED:"subLayerAdded",SUBLAYER_REMOVED:"subLayerRemoved",UPDATED:"updated",REORDERED:"reordered"});return e})},"jimu/LayerInfos/LayerInfoFactory":function(){define("dojo/_base/declare jimu/LayerInfos/LayerInfoForCollection jimu/LayerInfos/LayerInfoForMapService jimu/LayerInfos/LayerInfoForKML jimu/LayerInfos/LayerInfoForGeoRSS jimu/LayerInfos/LayerInfoForDefault jimu/LayerInfos/LayerInfoForWMS jimu/LayerInfos/LayerInfoForDefaultDynamic jimu/LayerInfos/LayerInfoForDefaultDynamicShipFeatureLayer jimu/LayerInfos/LayerInfoForDefaultTile jimu/LayerInfos/LayerInfoForDefaultWMS jimu/LayerInfos/LayerInfoForDefaultTable jimu/LayerInfos/LayerInfoForDefaultImage jimu/LayerInfos/LayerInfoForDefaultStream jimu/LayerInfos/LayerInfoForDefaultKML".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g){return r(null,{constructor:function(a,b){this.map=a;this.layerInfos=b},create:function(d){var u=null;if(d.featureCollection)u=new f(d,this.map,this,this.layerInfos);else if("esri.layers.KMLLayer"===d.layerObject.declaredClass)u=new p(d,this.map,this,this.layerInfos);else if("esri.layers.GeoRSSLayer"===d.layerObject.declaredClass)u=new c(d,this.map,this,this.layerInfos);else if("esri.layers.WMSLayer"!==d.layerObject.declaredClass||d.selfType)if("esri.layers.ArcGISDynamicMapServiceLayer"===
d.layerObject.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===d.layerObject.declaredClass)u=new l(d,this.map,this,this.layerInfos);else if("esri.layers.ArcGISImageServiceLayer"===d.layerObject.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===d.layerObject.declaredClass)u=new m(d,this.map,this,this.layerInfos);else if("esri.layers.StreamLayer"===d.layerObject.declaredClass)u=new a(d,this.map,this,this.layerInfos);else switch("Table"===d.layerObject.type&&(d.selfType="table"),
d.selfType){case "mapservice_dynamic_ship_featurelayer":u=new h(d,this.map,this,this.layerInfos);break;case "mapservice_dynamic_group":case "mapservice_dynamic":u=new k(d,this.map,this,this.layerInfos);break;case "mapservice_tiled_group":case "mapservice_tiled":u=new t(d,this.map,this,this.layerInfos);break;case "wms":u=new e(d,this.map,this,this.layerInfos);break;case "kml":u=new g(d,this.map,this,this.layerInfos);break;case "table":u=new b(d,this.map,this,this.layerInfos);break;default:u=new q(d,
this.map,this,this.layerInfos)}else u=new n(d,this.map,this,this.layerInfos);return u}})})},"jimu/LayerInfos/LayerInfoForCollection":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/promise/all esri/lang jimu/utils ./LayerInfo".split(" "),function(r,f,l,p,c,q,n){return r(n,{constructor:function(){this.layerObject={declaredClass:"esri.layers.FeatureCollection",type:"FeatureCollection",empty:!0}},_getExtent:function(){var c=null,h=[];f.forEach(this.getSubLayers(),function(c){h.push(c._getExtent())},
this);return p(h).then(l.hitch(this,function(h){f.forEach(h,function(e){q.isValidExtent(e)&&(c=c?c.union(e):e)},this);return c}))},_resetLayerObjectVisiblity:function(c){var h=c?c[this.id]:null;if(h){var k={},e;for(e in c)c.hasOwnProperty(e)&&"function"!==typeof c[e]&&(k[e]=c[e].visible);this._setSubLayerVisibleByCheckedInfo(k);this._setTopLayerVisible(h.visible)}},_setSubLayerVisibleByCheckedInfo:function(k){f.forEach(this.newSubLayers,function(h){c.isDefined(k[h.id])&&h.layerObject.setVisibility(k[h.id])},
this)},_initVisible:function(){var c=!1,h;for(h=0;h<this.newSubLayers.length;h++)c=c||this.newSubLayers[h].layerObject.visible;c&&(this._visible=!0)},_setTopLayerVisible:function(c){this._visible=c?!0:!1;f.forEach(this.newSubLayers,function(h){h.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var c=[];f.forEach(this.originOperLayer.featureCollection.layers,function(h){this._getLayerIndexesInMapByLayerId(h.layerObject.id)&&(l.setObject("_wabProperties.originOperLayer.showLegend",
this.originOperLayer.featureCollection.showLegend,h.layerObject),h=this._layerInfoFactory.create({layerObject:h.layerObject,title:h.layerObject.label||h.layerObject.title||h.layerObject.name||h.layerObject.id||" ",id:h.id||"-",subId:h.id||"-",collection:{layerInfo:this},selfType:"collection",showLegend:!0,parentLayerInfo:this}),c.push(h),h.init())},this);c.reverse();return c},_obtainLayerIndexesInMap:function(){var c=[],h,f;for(f=this.newSubLayers.length-1;0<=f;f--)(h=this._getLayerIndexesInMapByLayerId(this.newSubLayers[f].layerObject.id))&&
c.push(h);return c},moveLeftOfIndex:function(c){var h;for(h=0;h<this.newSubLayers.length;h++)this.map.reorderLayer(this.newSubLayers[h].layerObject,c)},moveRightOfIndex:function(c){var h;for(h=this.newSubLayers.length-1;0<=h;h--)this.map.reorderLayer(this.newSubLayers[h].layerObject,c)},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.featureCollection.showLegend?this.originOperLayer.featureCollection.showLegend:!0},getOpacity:function(){var c,h=0;for(c=0;c<this.newSubLayers.length;c++)if(this.newSubLayers[c].layerObject.opacity)h=
this.newSubLayers[c].layerObject.opacity>h?this.newSubLayers[c].layerObject.opacity:h;else return 1;return h},setOpacity:function(c){f.forEach(this.newSubLayers,function(h){h.layerObject.setOpacity&&h.layerObject.setOpacity(c)})},getScaleRange:function(){var c=this.getSubLayers();return c[0]?c[0].getScaleRange():{minScale:0,maxScale:0}}})})},"jimu/LayerInfos/LayerInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/dom-construct dojo/topic dojo/aspect dojo/Evented dojo/request/script jimu/portalUrlUtils jimu/portalUtils jimu/LayerNode jimu/utils ./RequestBuffer esri/kernel esri/tasks/query esri/request".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v){var B=r([h],{declaredClass:"jimu.LayerInfo",originOperLayer:null,layerObject:null,map:null,title:null,id:null,subId:null,newSubLayers:null,parentLayerInfo:null,isTable:null,isTiled:null,_oldIsShowInMap:null,_oldFilter:null,_eventHandles:null,_subLayerInfoIndex:null,_serviceDefinitionBuffer:null,_flag:null,_objectId:null,_itemInfo:null,_adaptor:null,constructor:function(a,d,b,g){this.originOperLayer=a;this.layerObject=a.layerObject;this.map=d;this.title=
this.originOperLayer.title||this.originOperLayer.id||"";this.id=this.originOperLayer.id;this.subId=void 0!==this.originOperLayer.subId?this.originOperLayer.subId:this.id;this.parentLayerInfo=a.parentLayerInfo?a.parentLayerInfo:null;this.isTiled=this.isTable=!1;this._eventHandles=[];this._layerInfoFactory=b;this._layerInfos=g;this._flag={};this._objectId=Math.random();this._adaptor=new m(this)},init:function(){this.newSubLayers=this.obtainNewSubLayers();this._initSubLayerInfoIndex();this._initVisible();
this.originOperLayer.popupInfo&&(this.popupVisible=!0);this._oldIsShowInMap=this.isShowInMap();this._initOldFilter();this._initServiceDefinitionBuffer();this._bindEvent()},_initOldFilter:function(){this._oldFilter=null},_initServiceDefinitionBuffer:function(){this._serviceDefinitionBuffer=new g(l.hitch(this,this._serviceDefinitionRequest))},isGraphicLayer:function(){var a=this._obtainLayerIndexesInMap();return a.length?a[0].isGraphicLayer:!1},obtainLayerIndexesInMap:function(){return this._obtainLayerIndexesInMap()},
getObjectId:function(){return this._objectId},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},moveLeftOfIndex:function(a){this.map.reorderLayer(this.layerObject,a)},moveRightOfIndex:function(a){this.map.reorderLayer(this.layerObject,a)},traversal:function(a){if(a(this))return!0;for(var d=this.getSubLayers(),b=0;b<d.length;b++)if(d[b].traversal(a))return!0},findLayerInfoById:function(a){var d=
null,b=0;if(this.id&&this.id===a)return this;for(b=0;b<this.newSubLayers.length&&!(d=this.newSubLayers[b].findLayerInfoById(a));b++);return d},setTopLayerVisible:function(a){this._setTopLayerVisible(a)},_setTopLayerVisible:function(a){},_setSubLayerVisible:function(a,d){},setLayerVisiblefromTopLayer:function(){},_resetLayerObjectVisiblity:function(){},resetLayerObjectVisibility:function(a){var d=a?a[this.id]:null;this.isRootLayer()&&d&&this._resetLayerObjectVisiblity(a)},_initVisible:function(){},
isVisible:function(){return this._visible?!0:!1},show:function(){this._setTopLayerVisible(!0)},hide:function(){this._setTopLayerVisible(!1)},_obtainLayerIndexesInMap:function(){var a=[],d;(d=this._getLayerIndexesInMapByLayerId(this.id))&&a.push(d);return a},_getLayerIndexesInMapByLayerId:function(a){var d;for(d=0;d<this.map.graphicsLayerIds.length;d++)if(this.map.graphicsLayerIds[d]===a)return{isGraphicLayer:!0,index:d};for(d=0;d<this.map.layerIds.length;d++)if(this.map.layerIds[d]===a)return{isGraphicLayer:!1,
index:d};return null},_isShowInMapChanged:function(){var a=!1,d=this.isShowInMap();!1===d&&this.map.infoWindow.hide();this._oldIsShowInMap!==d&&(this._oldIsShowInMap=d,a=!0);return a},_isShowInMapChanged2:function(){var a=[];this.traversal(function(d){d._isShowInMapChanged()&&a.push(d)});n.publish("layerInfos/layerInfo/isShowInMapChanged",a)},_visibleChanged:function(){n.publish("layerInfos/layerInfo/visibleChanged",[this])},_initSubLayerInfoIndex:function(){var a={};this.isRootLayer()&&this.traversal(function(d){d.isRootLayer()||
(a[d.subId]=d)});this._subLayerInfoIndex=a},_getLayerInfosObj:function(){return this._layerInfos},obtainNewSubLayers:function(){return[]},createLegendsNode:function(){return q.create("div",{"class":"legends-div"})},drawLegends:function(a,d){},_getLayerTypesOfSupportTable:function(){return"FeatureLayer,CSVLayer,Table,ArcGISImageServiceLayer,StreamLayer,ArcGISImageServiceVectorLayer"},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.showLegend?this.originOperLayer.showLegend:!0},
_needToRenew:function(){return!1},_getServiceDefinition:function(){var a=new p;a.resolve(null);return a},_serviceDefinitionRequest:function(a){return this._normalRequest(a,{f:"json"},"json")},getServiceDefinition:function(){return this._getServiceDefinition()},_normalRequest:function(a,d,b){return v({url:a,content:d,handleAs:b,callbackParamName:"callback"})},getLayerObject:function(){var a=new p;this.layerObject?a.resolve(this.layerObject):a.resolve(null);return a},getLayerObjectTryUsingFeatureService:function(){return this.getLayerObject()},
getSubLayers:function(){return this.newSubLayers},isLeaf:function(){return 0===this.getSubLayers().length?!0:!1},isRootLayer:function(){return this.parentLayerInfo?!1:!0},getLayerLevel:function(){for(var a=0,d=this;d.parentLayerInfo;)a++,d=d.parentLayerInfo;return a},getRootLayerInfo:function(){for(var a=this;a.parentLayerInfo;)a=a.parentLayerInfo;return a},isShowInMap:function(){for(var a=!0,d=this;d;)a=a&&d.isVisible(),d=d.parentLayerInfo;return a},getLayerType:function(){var a=[null],d=new p;this.layerObject.declaredClass&&
(a=this.layerObject.declaredClass.split("."));d.resolve(a[a.length-1]);return d},getPopupInfo:function(){return this.originOperLayer.popupInfo},getPopupInfoFromLayerObject:function(){var a=this.getInfoTemplate(),d=null;a&&(d=a.info);return d},loadPopupInfo:function(){var a=new p;this.loadInfoTemplate().then(l.hitch(this,function(d){var b=null;d&&(b=d.info);a.resolve(b)}));return a},loadInfoTemplate:function(){var a=new p;a.resolve(null);return a},getInfoTemplate:function(){return null},getFilterOfWebmap:function(){return this.originOperLayer.layerDefinition?
this.originOperLayer.layerDefinition.definitionExpression:null},getFilter:function(){return null},setFilter:function(){},getShowLegendOfWebmap:function(){for(var a=this,d=!0;a;)d=d&&a._getShowLegendOfWebmap(),a=a.parentLayerInfo;return d},getUrl:function(){return this.layerObject.url||this.layerObject._url},hasLayerTypes:function(a){},getSupportTableInfo:function(){var a=new p,d={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},b=this.getLayerType(),g=this.getLayerObject();c({type:b,layerObject:g}).then(l.hitch(this,
function(b){var g=b.type;b=b.layerObject;d.layerType=g;0<=this._getLayerTypesOfSupportTable().indexOf(g)&&(d.isSupportedLayer=!0);if(!b)d.isSupportQuery=!1;else if(this.parentLayerInfo&&this.parentLayerInfo.isMapNotesLayerInfo())d.isSupportQuery=!1;else if(!b.url||b.capabilities&&b.capabilities.indexOf&&0<=b.capabilities.indexOf("Query"))d.isSupportQuery=!0;a.resolve(d)}),function(){a.resolve(d)});return a},getRelatedTableInfoArray:function(a){a=new p;a.resolve([]);return a},getRelatedRecords:function(a,
d){a=new p;a.resolve([]);return a},removeSubLayerById:function(a){var d=[];f.forEach(this.newSubLayers,function(b){b.id!==a?d.push(b):b.destroy()});this.newSubLayers=d},releaseResource:function(){f.forEach(this._eventHandles,function(a){a.remove()});this.destroyLabelLayer();this._adaptor&&this._adaptor.destroy()},destroy:function(){f.forEach(this.newSubLayers,function(a){a.destroy()});this.releaseResource();this.inherited(arguments)},update:function(){f.forEach(this.newSubLayers,function(a){a.destroy()});
this.releaseResource();this.init()},isMapNotesLayerInfo:function(){return this.originOperLayer.featureCollection&&0===this.id.indexOf("mapNotes_")&&"ArcGISFeatureLayer"===this.originOperLayer.layerType&&!this.map.getLayer(this.id)?!0:!1},getMSShipFeatures:function(){var a=new p;a.resolve(null);return a},_getExtent:function(){var a=new p;a.resolve(this.layerObject.fullExtent||this.layerObject.initialExtent);return a},getExtent:function(){var d=new p;this._getExtent().then(l.hitch(this,function(b){a.projectToMapSpatialReference(this.map,
b).then(l.hitch(this,function(a){d.resolve(a)}),l.hitch(this,function(){d.resolve(null)}))}),l.hitch(this,function(){d.resolve(null)}));return d},_requerySelectdFeatures:function(){var a=new p;this.getLayerObject().then(l.hitch(this,function(d){var b=[],g;if(d&&d.isEditable&&!d.isEditable()){g=d.objectIdField;var b=d.getSelectedFeatures(),e=d.on("update-end",l.hitch(this,function(){var m=new u,h=[];f.forEach(b,function(a){h.push(a.attributes[g])},this);m.objectIds=h;m.maxAllowableOffset=0;d.queryFeatures(m,
l.hitch(this,function(d){f.forEach(d.features,function(a){f.some(b,function(d){return d.attributes[g]===a.attributes[g]?(d.setGeometry(a.geometry),!0):!1})},this);a.resolve()}),l.hitch(this,function(){a.resolve()}));e&&e.remove&&e.remove()}))}}));return a},zoomTo:function(d){this._requerySelectdFeatures();return d?a.projectToMapSpatialReference(this.map,d).then(l.hitch(this,function(a){return this._zoomTo(a)})):this.getExtent().then(l.hitch(this,function(a){return this._zoomTo(a)}))},_zoomTo:function(d){if(a.isValidExtent(d)){d=
l.clone(d);var b=this.getLayerScaleRange(),g=b.minScale,b=b.maxScale;if(d.isSinglePoint){if(g=a.getTargetScale(this.map,3,g,b))d=a.adjustHeightToAspectRatio(this.map,d),d=a.getExtentForScale(d,this.map.width,g),this.map.setExtent(d)}else{d=a.adjustExtentToAspectRatio(this.map,d);var e=a.getScaleForExtent(d,this.map.width);0<g&&e>g?(g=a.getScaleForNextTileLevel(this.map,g,!0),d=a.adjustHeightToAspectRatio(this.map,d),d=a.getExtentForScale(d,this.map.width,g),this.map.setExtent(d)):e<b?(b=a.getScaleForNextTileLevel(this.map,
b,!1),d=a.adjustHeightToAspectRatio(this.map,d),d=a.getExtentForScale(d,this.map.width,b),this.map.setExtent(d)):this.map.setExtent(d,!0)}}},mergeScale:function(a,d,b,g){var e=0,m=0;0===a&&0<b?e=b:0<a&&0===b?e=a:0<a&&0<b&&(e=Math.min(a,b));m=Math.max(d,g);return{minScale:e,maxScale:m}},unionScale:function(a,d,b,g){var e=0,m=0,e=0===a||0===b?0:Math.max(a,b),m=Math.min(d,g);return{minScale:e,maxScale:m}},getScaleRange:function(){return this.layerObject&&0<=this.layerObject.minScale&&0<=this.layerObject.maxScale?
{minScale:this.layerObject.minScale,maxScale:this.layerObject.maxScale}:{minScale:0,maxScale:0}},setScaleRange:function(a,d){this.layerObject&&this.layerObject.setScaleRange&&this.layerObject.setScaleRange(a,d)},getLayerScaleRange:function(){var a,d=this.getScaleRange();this.traversal(l.hitch(this,function(d){d.id!==this.id&&(d=d.getScaleRange(),a=a?this.unionScale(a.minScale,a.maxScale,d.minScale,d.maxScale):d)}));return a?this.mergeScale(d.minScale,d.maxScale,a.minScale,a.maxScale):d},isCurrentScaleInTheScaleRange:function(){var a=
this.getScaleRange(),d=this.map.getScale();return 0===a.minScale&&0===a.maxScale?!0:(0===a.minScale||a.minScale>=d)&&(0===a.maxScale||d>=a.maxScale)?!0:!1},isInScale:function(){for(var a=!0,d=this;d&&(a=d.isCurrentScaleInTheScaleRange(),d=d.parentLayerInfo,a););return a},enablePopup:function(){},disablePopup:function(){},isPopupEnabled:function(){return!1},enablePopupNested:function(){this.isLeaf()?this.enablePopup():this.traversal(l.hitch(this,function(a){a.isLeaf()&&a.enablePopup()}))},isSupportPopup:function(){var a=
new p;a.resolve(!1);return a},disablePopupNested:function(){this.isLeaf()?this.disablePopup():this.traversal(l.hitch(this,function(a){a.isLeaf()&&a.disablePopup()}))},isPopupNestedEnabled:function(){var a=!1;this.isLeaf()?a=this.isPopupEnabled():this.traversal(l.hitch(this,function(d){return d.isLeaf()&&d.isPopupEnabled()?a=!0:!1}));return a},isSupportPopupNested:function(){var a=new p,d=[];this.traversal(function(a){a.isLeaf()&&d.push(a.isSupportPopup())});c(d).then(function(d){f.some(d,function(d){if(d)return a.resolve(!0),
!0;a.resolve(!1);return!1})});return a},getCapabilitiesOfWebMap:function(){return this.originOperLayer.capabilities},isItemLayer:function(){return this._getBasicItemInfo()},isPublicService:function(){var a=new p,d=this.getUrl();(d=d&&d+"?f\x3djson")?("https"===e.getProtocol(window.location.href)&&(d=e.setHttpsProtocol(d)),t.get(d,{jsonp:"callback"}).then(l.hitch(this,function(d){d&&d.error?a.resolve(!1):a.resolve(!0)}),l.hitch(this,function(){a.resolve(!1)}))):a.resolve(!0);return a},_checkUserLicense:function(d){var b=
"";!window.isXT&&window.queryObject&&(window.queryObject.id&&!/^(stemapp|stemapp3d)$/gi.test(window.queryObject.id)?b=window.queryObject.id:window.queryObject.appid&&(b=window.queryObject.appid));return window.isXT||!b?(d=new p,d.resolve(!0),d):a.checkEssentialAppsLicense(b,d,!1).then(l.hitch(this,function(a){return!(a&&a.viewOnly)}),l.hitch(this,function(){return!1}))},isEditable:function(){var a=!1,g=!0,e=!0,m=getAppConfig().portalUrl,h=b.getPortal(m),m=this.isPublicService(),u=new p,k=new p;h.getUser().then(l.hitch(this,
function(a){k.resolve(a)}),l.hitch(this,function(){k.resolve(null)}));h=this._checkUserLicense(h);c({user:k,isPublicService:m,license:h}).then(l.hitch(this,function(b){var m=b.user&&b.user.privileges,h=b.isPublicService;b=b.license;m&&-1===f.indexOf(m,"features:user:edit")&&d.id&&!h&&(g=!1);h||b||(e=!1);a=this.layerObject&&this.layerObject.isEditable?this.layerObject.isEditable()&&g&&e?!0:!1:!1;u.resolve(a)}),l.hitch(this,function(){u.resolve(!1)}));return u},_getBasicItemInfo:function(){var a=null,
d=this.getRootLayerInfo(),b=window.appConfig||window.getAppConfig(),g=l.getObject("_wabProperties.itemLayerInfo",!1,d.layerObject);d.originOperLayer.itemId?(a={},a.itemId=d.originOperLayer.itemId,a.portalUrl=e.getStandardPortalUrl(b.map.portalUrl||b.portalUrl)):g&&g.portalUrl&&g.itemId&&(a={},a.itemId=g.itemId,a.portalUrl=e.getStandardPortalUrl(g.portalUrl));return a},getItemInfo:function(){var a=new p,d=this.getRootLayerInfo();d.isItemLayer()?(d._itemInfo||(d._itemInfo=new B.ItemInfo(this,d)),d._itemInfo.onLoad().then(l.hitch(this,
function(){a.resolve(d._itemInfo)}),l.hitch(this,function(){a.resolve(null)}))):a.resolve(null);return a},isHostedService:function(){var a=new p;this._getServiceDefinition().then(l.hitch(this,function(d){a.resolve(d&&d.serviceItemId?!0:!1)}));return a},isHostedLayer:function(){var a;this.isItemLayer()?a=this.isHostedService():(a=new p,a.resolve(!1));return a},obtainLabelControl:function(){},restoreLabelControl:function(){},destroyRealtedLabelLayer:function(){},destroyLabelLayer:function(){},canShowLabel:function(){},
isShowLabels:function(){},showLabels:function(){},hideLabels:function(){},isBasemap:function(){return this.getRootLayerInfo().layerObject._basemapGalleryLayerType?!0:!1},emitEvent:function(){try{this.emit.apply(this,arguments),this._adaptor&&this._adaptor.emitEvent.apply(this._adaptor,arguments)}catch(z){console.error(z)}},_bindEvent:function(){var a;this.layerObject&&!this.layerObject.empty&&(a=this.layerObject.on("visibility-change",l.hitch(this,this._onVisibilityChanged)),this._eventHandles.push(a),
a=k.after(this.layerObject,"setDefinitionExpression",l.hitch(this,this._onFilterChanged)),this._eventHandles.push(a),a=k.after(this.layerObject,"setRenderer",l.hitch(this,this._onRendererChanged)),this._eventHandles.push(a),this.isRootLayer()&&(a=this.layerObject.on("opacity-change",l.hitch(this,this._onOpacityChanged)),this._eventHandles.push(a)),a=this.layerObject.on("scale-range-change",l.hitch(this,this._onScaleRangeChanged)),this._eventHandles.push(a),this.isRootLayer()&&(a=this.map.on("time-extent-change",
l.hitch(this,function(){this.layerObject&&this.layerObject.useMapTime&&this._onTimeExtentChanged()})),this._eventHandles.push(a)),this.isRootLayer()&&(a=k.after(this.layerObject,"setTimeDefinition",l.hitch(this,function(){this.layerObject&&this.layerObject.timeInfo&&this.layerObject.mode===esri.layers.FeatureLayer.MODE_SNAPSHOT&&this._onTimeExtentChanged()})),this._eventHandles.push(a)))},_onVisibilityChanged:function(){this._initVisible();this._visibleChanged();this._isShowInMapChanged2()},_onFilterChanged:function(){var a=
this._oldFilter?this._oldFilter:null,d=this.layerObject.getDefinitionExpression(),d=d?d:null;a!==d&&(n.publish("layerInfos/layerInfo/filterChanged",[this],l.getObject("_wabProperties.objectPassWithFilterChangeEvent",!0,this.layerObject)),this._oldFilter=d,l.setObject("_wabProperties.objectPassWithFilterChangeEvent",{},this.layerObject))},_onRendererChanged:function(){n.publish("layerInfos/layerInfo/rendererChanged",[this])},_onOpacityChanged:function(){n.publish("layerInfos/layerInfo/opacityChanged",
[this])},_onScaleRangeChanged:function(){n.publish("layerInfos/layerInfo/scaleRangeChanged",[this])},_onTimeExtentChanged:function(){var a=[],d=[];this.traversal(function(b){var g=b.getServiceDefinition().then(function(d){d&&d.timeInfo&&a.push(b)});d.push(g)});c(d).then(l.hitch(this,function(){n.publish("layerInfos/layerInfo/timeExtentChanged",a)}))}});B.ItemInfo=r(null,{_currentLayerInfo:null,_rootLayerInfo:null,_portalUrl:null,_itemId:null,_item:null,_itemData:null,_serviceDefinition:null,_itemInfoLoadedDef:null,
constructor:function(a,d){this._currentLayerInfo=a;this._rootLayerInfo=d;this._loadResource()},_loadResource:function(){this._itemInfoLoadedDef=new p;var a=this._rootLayerInfo.isItemLayer();if(a){this._portalUrl=a.portalUrl;this._itemId=a.itemId;var d=b.getPortal(this._portalUrl),a=d.getItemById(this._itemId),d=d.getItemData(this._itemId),g=this._currentLayerInfo._getServiceDefinition();c({item:a,itemData:d,serviceDefinition:g}).then(l.hitch(this,function(a){this._item=a.item;this._itemData=a.itemData;
this._serviceDefinition=a.serviceDefinition;this._itemInfoLoadedDef.resolve(this)}),l.hitch(this,function(a){a&&a.message&&console.log(a.message);this._itemInfoLoadedDef.reject()}))}else this._itemInfoLoadedDef.reject()},onLoad:function(){return this._itemInfoLoadedDef},getPortalUrl:function(){return this._portalUrl},getItemId:function(){return this._itemId},getItem:function(){return this._item},getItemData:function(){return this._itemData},isHostedLayer:function(){return this._serviceDefinition&&
this._serviceDefinition.serviceItemId?!0:!1}});return B})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json dojo/request/xhr esri/request ./Role ./utils ./portalUrlUtils ./tokenUtils ./ServiceDefinitionManager".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m,a){var g=r([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(a){this.portalUrl=
b.getStandardPortalUrl(a);this.selfUrl=b.getPortalSelfInfoUrl(a)},loadSelfInfo:function(){var d=this.selfUrl;this.isValidCredential()&&(d=-1<d.indexOf("?")?d+("\x26token\x3d"+this.credential.token):d+("?token\x3d"+this.credential.token));return a.getInstance().getServiceDefinition(d).then(f.hitch(this,function(a){var d=a.user;delete a.user;f.mixin(this,a);a.user=d;return a}))},_checkCredential:function(){var a=m.isValidCredential(this.credential);a||this.clearCredentialAndUser();return a},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=m.getPortalCredential(this.portalUrl))},signIn:function(){var a=new c;this.updateCredential();this.isValidCredential()?setTimeout(f.hitch(this,function(){a.resolve(this.credential)}),0):a=m.signInPortal(this.portalUrl);return a},haveSignIn:function(){return m.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=this.credential=null},getUser:function(){this.updateCredential();
var a=new c;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(f.hitch(this,function(){this.user.updateCredential();a.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(f.hitch(this,function(d){this.user=d;a.resolve(this.user)}),f.hitch(this,function(d){console.error(d);a.reject(d)})):m.getUserIdByToken(this.credential.token,this.portalUrl).then(f.hitch(this,function(d){this.credential.userId=d;this._getUser(this.credential.userId).then(f.hitch(this,
function(d){this.user=d;a.resolve(this.user)}),f.hitch(this,function(d){console.error(d);a.reject(d)}))}),f.hitch(this,function(d){console.error(d);a.reject(d)})):setTimeout(f.hitch(this,function(){a.reject("credential is null.")}),0);return a},queryItems:function(a){this.updateCredential();var d=new c,g=b.getBaseSearchUrl(this.portalUrl),e={f:"json"};a&&(e=f.mixin(e,a));this.isValidCredential()&&(e.token=this.credential.token);e.sortField||e.sortOrder||(e.sortField="title",e.sortOrder="asc");h({url:g,
handleAs:"json",content:e,callbackParamName:"callback"}).then(f.hitch(this,function(a){a.results=l.map(a.results,f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new v(a)}));d.resolve(a)}),f.hitch(this,function(a){console.error(a);d.reject(a)}));return d},getItemData:function(a){this.updateCredential();a={url:b.getItemDataUrl(this.portalUrl,a),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};return h(a)},_getItemById:function(a,
d){a={url:b.getItemUrl(this.portalUrl,a),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};d&&(a.content.token=d);return h(a).then(f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new v(a)}))},getItemById:function(a,d){this.updateCredential();return this._getItemById(a).then(f.hitch(this,function(b){return d&&b.owner&&this.isValidCredential()&&this.credential&&this.credential.userId===b.owner?this._getItemById(a,this.credential.token):
b}))},getAppById:function(a){var d=new c;this.updateCredential();this.isValidCredential()?(a=b.getAppIdUrl(this.portalUrl,a),d=h({url:a,handleAs:"json",content:{f:"json",token:this.credential.token}})):setTimeout(f.hitch(this,function(){d.reject("token is null.")}),0);return d},queryGroups:function(a){this.updateCredential();var d=new c,g=b.getBaseGroupUrl(this.portalUrl),e={f:"json"};a&&(e=f.mixin(e,a));this.isValidCredential()&&(e.token=this.credential.token);h({url:g,handleAs:"json",content:e,
callbackParamName:"callback"}).then(f.hitch(this,function(a){a.results=l.map(a.results,f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new u(a)}));d.resolve(a)}),f.hitch(this,function(a){console.error(a);d.reject(a)}));return d},registerApp:function(a,d,g){var e=new c;this.updateCredential();if(this.isValidCredential())var m=this.credential&&this.credential.token,u=b.getOAuth2Url(this.portalUrl),e=h({url:u+"/registerApp",content:{itemId:a,appType:d,
redirect_uris:n.stringify(g),token:m,f:"json"},handleAs:"json"},{usePost:!0});else setTimeout(f.hitch(this,function(){e.reject("token is null.")}),0);return e},createAndRegisterApp:function(a){var d=new c;this.updateCredential();this.isValidCredential()?this.getUser().then(f.hitch(this,function(b){b.addItem({title:"Web AppBuilder for ArcGIS",type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(f.hitch(this,function(b){b.success?this.registerApp(b.id,"browser",
a).then(f.hitch(this,function(a){d.resolve(a)}),f.hitch(this,function(a){console.error(a);d.reject(a)})):d.reject("create app failed")}),f.hitch(this,function(a){console.error(a);d.reject(a)}))}),f.hitch(this,function(a){console.error(a);d.reject(a)})):setTimeout(f.hitch(this,function(){d.reject("token is null.")}),0);return d},_getUser:function(a){this.updateCredential();var g=new c;a={url:b.getUserUrl(this.portalUrl,a),content:{f:"json"},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&
(a.content.token=this.credential&&this.credential.token);h(a).then(f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;this.user=new d(a);g.resolve(this.user)}),f.hitch(this,function(a){console.error(a);g.reject(a)}));return g},getHelpMap:function(){this.updateCredential();var a={url:b.getPortalHelpMapUrl(this.portalUrl),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};return h(a)}}),d=r([],{declaredClass:"jimu.PortalUser",portalUrl:null,
credential:null,portal:null,constructor:function(a){a&&f.mixin(this,a)},_checkCredential:function(){var a=m.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},canCreateItem:function(){var a=new t({id:this.roleId?this.roleId:this.role,role:this.role});this.privileges&&a.setPrivileges(this.privileges);
return a.canCreateItem()},canCreateNotebooks:function(){var a=new t({id:this.roleId?this.roleId:this.role,role:this.role});this.privileges&&a.setPrivileges(this.privileges);return a.canCreateNotebooks()},getGroups:function(){var a=[];this.groups&&(a=l.map(this.groups,f.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this.portal;return new u(a)})));return a},getItemsByKeywords:function(a,d){return this.portal.queryItems({start:d||1,num:100,q:"owner:"+this.username+
' AND typekeywords:"'+a+'"'})},getContent:function(){this.updateCredential();var a={url:b.getUserContentUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(a.content.token=this.credential.token);return h(a)},getTags:function(){this.updateCredential();var a={url:b.getUserTagsUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(a.content.token=this.credential.token);
return h(a)},addItem:function(a,d){this.updateCredential();var g=new c;if(this.isValidCredential()){var e={f:"json",token:this.credential.token};a&&(e=f.mixin(e,a));h({url:b.getAddItemUrl(this.portalUrl,this.username,d),handleAs:"json",callbackParamName:"callback",content:e},{usePost:!0}).then(f.hitch(this,function(a){g.resolve(a)}),f.hitch(this,function(a){console.error(a);g.reject(a)}))}else setTimeout(f.hitch(this,function(){g.reject("token is null.")}),0);return g},deleteItem:function(a){this.updateCredential();
var d=new c;this.isValidCredential()?(a=b.getDeleteItemUrl(this.portalUrl,this.username,a),d=h({url:a,content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})):setTimeout(f.hitch(this,function(){d.reject("token is null.")}),0);return d},getItemById:function(a,d){this.updateCredential();var g=new c;a={url:b.getUserItemsUrl(this.portalUrl,this.username,d)+"/"+a,handleAs:"json",content:{f:"json"},callbackParamName:"callback"};h(a).then(f.hitch(this,function(a){a.portalUrl=this.portalUrl;
a.credential=this.credential;a.portal=this;a=new v(a);g.resolve(a)}),f.hitch(this,function(a){console.error(a);g.reject(a)}));return g},shareItem:function(a,d,g){this.updateCredential();var e=new c;this.isValidCredential()?(d={url:b.shareItemUrl(this.portalUrl,this.username,d,g),handleAs:"json",callbackParamName:"callback",content:{f:"json",token:this.credential.token}},a&&(d.content=f.mixin(d.content,a)),h(d,{usePost:!0}).then(f.hitch(this,function(a){e.resolve(a)}),f.hitch(this,function(a){console.error(a);
e.reject(a)}))):setTimeout(f.hitch(this,function(){e.reject("token is null.")}),0);return e},updateItem:function(a,d){this.updateCredential();var g=new c;this.isValidCredential()?this.portal.getItemById(a).then(f.hitch(this,function(e){var m={f:"json",token:this.credential.token};d&&(m=f.mixin(m,d));h({url:b.getUpdateItemUrl(this.portalUrl,e.owner,a,e.ownerFolder),handleAs:"json",callbackParamName:"callback",timeout:1E5,content:m},{usePost:!0}).then(f.hitch(this,function(a){g.resolve(a)}),f.hitch(this,
function(a){console.error(a);g.reject(a)}))}),f.hitch(this,function(a){console.error(a);g.reject(a)})):setTimeout(f.hitch(this,function(){g.reject("token is null.")}),0);return g},isAdminRole:function(){return"org_admin"===this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role},getRegisteredAppInfo:function(a,d){var g=new c;this.updateCredential();
d=b.getUserItemsUrl(this.portalUrl,this.username,d);return g=h({url:d+"/"+a+"/registeredAppInfo",content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})},getRegisteredAppInfoWithXhr:function(a,d){var g=new c;this.updateCredential();d=b.getUserItemsUrl(this.portalUrl,this.username,d);return g=k(d+"/"+a+"/registeredAppInfo",{data:{token:this.credential.token,f:"json"},method:"POST",handleAs:"json"})}}),u=r([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,
constructor:function(a){a&&f.mixin(this,a)},_checkCredential:function(){var a=m.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(a){a.q="group:"+this.id+" AND "+a.q;return this.portal.queryItems(a)}}),v=r([],{declaredClass:"jimu.PortalItem",itemUrl:null,
detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(a){a&&f.mixin(this,a);this.itemUrl=b.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&this.thumbnail&&this.itemUrl&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=b.getItemDetailsPageUrl(this.portalUrl,
this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=b.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var a=m.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)},getItemGroups:function(){this.updateCredential();
var a={url:b.getItemGroupsUrl(this.portalUrl,this.id),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(a.content.token=this.credential.token);return h(a)}}),B={portals:[],webMapQueryStr:" "+e.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+e.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(a){for(var d=0;d<this.portals.length;d++){var g=this.portals[d];if(b.isSamePortalUrl(a,g.portalUrl))return g.updateCredential(),g}return null},
getPortal:function(a){if(!a||"string"!==typeof a||!f.trim(a))return null;a=b.getStandardPortalUrl(a);var d=this._findPortal(a);d||(d=new g(a),d.credential=m.getPortalCredential(d.portalUrl),d.updateCredential(),this.portals.push(d));return d},getPortalSelfInfo:function(a){return this.getPortal(a).loadSelfInfo()},getBasemapGalleryGroup:function(a){return this._getPortalSelfGroup(a,"basemapGalleryGroupQuery")},getTemplatesGroup:function(a){return this._getPortalSelfGroup(a,"templatesGroupQuery")},getUnits:function(a){var d=
"english",b="",g=new c;this.getPortal(a).getUser().then(f.hitch(this,function(a){a&&a.units?d=a.units:(b=p.locale,d=b.startWith("en")?"english":"metric");g.resolve(d)}),f.hitch(this,function(e){console.warn(e);this.getPortalSelfInfo(a).then(f.hitch(this,function(a){var d=null;a&&a.units?d=a.units:(b=a&&a.culture||p.locale,d=b.startWith("en")?"english":"metric");g.resolve(d)}),f.hitch(this,function(a){console.warn(a);b=p.locale;d=b.startWith("en")?"english":"metric";g.resolve(d)}))}));return g.promise},
_getPortalSelfGroup:function(a,d){var b=new c,g=this.getPortal(a);g||setTimeout(f.hitch(this,function(){b.reject()}),0);this.getPortalSelfInfo(a).then(f.hitch(this,function(a){g.queryGroups({f:"json",q:a[d]}).then(f.hitch(this,function(a){0<a.results.length?(a=a.results[0],a.portalUrl=g.portalUrl,a.credential=g.credential,a.portal=g,a=new u(a),b.resolve(a)):b.reject("Can't find portal self group.")}),f.hitch(this,function(a){console.error(a);b.reject(a)}))}),f.hitch(this,function(a){console.error(a);
b.reject(a)}));return b},getWebMapsFromBasemapGalleryGroup:function(a){var d=new c;this.getBasemapGalleryGroup(a).then(f.hitch(this,function(a){a?a.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(f.hitch(this,function(a){d.resolve(a)}),f.hitch(this,function(a){console.error(a);d.reject(a)})):d.reject()}),f.hitch(this,function(a){console.error(a);d.reject(a)}));return d},getDefaultWebScene:function(a){var d=b.getStandardPortalUrl(a);return this._searchWABDefaultWebScene(d).then(f.hitch(this,
function(a){return a?a:this._createWABDefaultWebScene(d).then(f.hitch(this,function(a){return this.getPortal(d).getUser().then(f.hitch(this,function(d){var b=!1;d&&d.privileges&&0<d.privileges.length&&(b=l.some(d.privileges,function(a){return 0<=a.indexOf("shareToPublic")}));return b?d.shareItem({everyone:!0},a).then(f.hitch(this,function(){return a}),f.hitch(this,function(){return a})):a}),f.hitch(this,function(d){console.error(d);return a}))}))}))},_searchWABDefaultWebScene:function(a){var d=new c;
a=b.getStandardPortalUrl(a);a=this.getPortal(a);a.queryItems({q:'typekeywords:"WABDefaultWebScene" orgid:'+a.user.orgId+" access:public "+this.webSceneQueryStr}).then(f.hitch(this,function(a){a&&a.results&&0<a.results.length?d.resolve(a.results[0].id):d.resolve(null)}),f.hitch(this,function(a){console.error("_searchWABDefaultWebScene error:",a);d.reject(a)}));return d},_createWABDefaultWebScene:function(a){var d=new c;a=b.getStandardPortalUrl(a);this.getPortal(a).getUser().then(f.hitch(this,function(a){var b=
{title:"Default Web Scene",type:"Web Scene",typeKeywords:"WABDefaultWebScene",tags:"default",text:n.stringify({operationalLayers:[],baseMap:{baseMapLayers:[{id:"World_Hillshade_3689",title:"World Hillshade",url:"https://services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer"},{id:"VectorTile_6451",title:"World Topographic Map",layerType:"VectorTileLayer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json"}],
id:"7677a8cc22b7463eac3321e810289ee1",title:"Topographic",elevationLayers:[{id:"globalElevation",listMode:"hide",title:"Terrain3D",url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}]},ground:{layers:[{id:"globalElevation",listMode:"hide",title:"Terrain3D",url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}],transparency:0,
navigationConstraint:{type:"stayAbove"}},heightModelInfo:{heightModel:"gravity_related_height",heightUnit:"meter"},version:"1.19",initialState:{environment:{lighting:{datetime:1584297035E3,displayUTCOffset:-7},atmosphereEnabled:!0,starsEnabled:!0},viewpoint:{camera:{position:{spatialReference:{latestWkid:3857,wkid:102100},x:-1.086995865773382E7,y:4499271.779598768,z:1.1136000213552397E7},heading:0,tilt:.18208338510745917}}},spatialReference:{latestWkid:3857,wkid:102100},viewingMode:"global",authoringApp:"WebAppBuilder",
authoringAppVersion:"2.16"}),snippet:""};a.addItem(b,"").then(f.hitch(this,function(a){a.success?d.resolve(a.id):(console.error("Can't create default web scene:",a),d.reject())}))}),f.hitch(this,function(a){console.error("Can't create default web scene");d.reject(a)}));return d},getDefaultWebMap:function(a){var d=new c;this.getPortalSelfInfo(a).then(f.hitch(this,function(b){var g=b.defaultBasemap&&b.defaultBasemap.id;g?d.resolve(g):this._getDefaultWebMapByBasemapGallery(a,b).then(f.hitch(this,function(b){b?
d.resolve(b):this._getMostNumViewsWebMap(a).then(f.hitch(this,function(a){a?d.resolve(a):d.reject()}),f.hitch(this,function(a){console.error(a);d.reject(a)}))}),f.hitch(this,function(a){console.error(a);d.reject(a)}))}),f.hitch(this,function(a){console.error(a);d.reject(a)}));return d},_getDefaultWebMapByBasemapGallery:function(a,d){var b=new c,g=this.getPortal(a),e=d.defaultBasemap&&d.defaultBasemap.title;g.queryGroups({f:"json",q:d.basemapGalleryGroupQuery}).then(f.hitch(this,function(a){a=a.results;
0<a.length?g.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+a[0].id+" AND title:"+e}).then(f.hitch(this,function(a){a=a.results;a=l.filter(a,f.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?b.resolve(a[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),g.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+e}).then(f.hitch(this,function(a){a=a.results;a=l.filter(a,f.hitch(this,function(a){return a.type&&
"web map"===a.type.toLowerCase()}));if(0<a.length){var d=a[0];g.getItemData(d.id).then(f.hitch(this,function(a){a&&(a.operationalLayers||a.baseMap||a.version)?b.resolve(d.id):b.resolve(null)}),f.hitch(this,function(){b.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),b.resolve(null)}),f.hitch(this,function(a){console.error(a);b.reject(a)})))}),f.hitch(this,function(a){console.error(a);b.reject(a)})):(console.log("Can't find group by basemapGalleryGroupQuery."),b.resolve(null))}),
f.hitch(this,function(a){console.error(a);b.reject(a)}));return b},_getMostNumViewsWebMap:function(a){var d=new c;this.getPortal(a).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(f.hitch(this,function(a){a=a.results;a=l.filter(a,f.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?d.resolve(a[0].id):d.reject("Can't find most-num-views web map.")}),f.hitch(this,function(a){console.error(a);
d.reject(a)}));return d},comparePortalVersion:function(a,d){var b=a.split(".");a=parseInt(b[0],10);var b=1<b.length?parseInt(b[1],10):0,g=d.split(".");d=parseInt(g[0],10);g=1<g.length?parseInt(g[1],10):0;return a>d?1:a<d?-1:b>g?1:b<g?-1:0},getItemResources:function(a,d,g){g||(g=100);a=b.getStandardPortalUrl(a);a=b.getItemResourceUrl(a,d);return h({url:a,content:{f:"json",num:g}}).then(function(a){if(a&&a.resources)return a.resources})},addResource:function(a,d,g,e,m){a=b.getStandardPortalUrl(a);var u=
this.getPortal(a),c=new FormData;c.append("file",g,e);c.append("fileName",e);c.append("f","json");var f="";m?(c.append("resourcesPrefix",m),f=m+"/"+e):f=e;return u.getItemById(d,!0).then(function(g){g=b.getUserContentItemUrl(a,g.owner,d);return h({url:g+"/addResources",form:c}).then(function(d){var g="";d&&d.success&&(g=b.getItemResourceUrl(a,"${itemId}",f));return g},function(a){console.error(a.message||a);return a})})},removeResources:function(a,d,g,e){var m={resource:e?e+"/"+g:g,f:"json"};a=b.getStandardPortalUrl(a);
return this.getPortal(a).getItemById(d,!0).then(function(g){g=b.getUserContentItemUrl(a,g.owner,d);return h({url:g+"/removeResources",content:m},{usePost:!0}).then(function(a){return a},function(a){console.error(a.message||a);return a})})}};q.subscribe("userSignOut",function(a){(a=B._findPortal(a))&&a.clearCredentialAndUser()});return B})},"jimu/Role":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/json","esri/lang"],function(r,f,l,p,c){return r(null,{id:null,baseRole:null,
name:null,description:null,privileges:[],privilegeObj:null,constructor:function(c){c=c||{};this.id=c.id;this.baseRole=c.role;this.name=c.name;this.description=c.description},_initPrivilegesObject:function(){this.privilegeObj={portal:{admin:{inviteUsers:!1,disableUsers:!1,viewUsers:!1,updateUsers:!1,deleteUsers:!1,changeUserRoles:!1,viewGroups:!1,updateGroups:!1,deleteGroups:!1,reassignGroups:!1,assignToGroups:!1,manageEnterpriseGroups:!1,viewItems:!1,updateItems:!1,deleteItems:!1,reassignItems:!1,
manageLicenses:!1},publisher:{publishFeatures:!1,publishTiles:!1,publishScenes:!1},user:{createGroup:!1,joinGroup:!1,joinNonOrgGroup:!1,createItem:!1,shareToGroup:!1,shareToOrg:!1,shareToPublic:!1,shareGroupToOrg:!1,shareGroupToPublic:!1}},features:{user:{edit:!1,fullEdit:!1}},opendata:{user:{openDataAdmin:!1,designateGroup:!1}},premium:{user:{geocode:!1,networkanalysis:!1,spatialanalysis:!1,geoenrichment:!1,demographics:!1,elevation:!1},publisher:{createNotebooks:!1}},marketplace:{admin:{manage:!1,
purchase:!1,startTrial:!1}}}},_readPrivileges:function(q){c.isDefined(q)&&q instanceof Array&&l.forEach(q,f.hitch(this,function(c){this._readPrivilege(c)}))},_readPrivilege:function(c){this._applyEffectToAction(!0,c)},_applyEffectToAction:function(c,f){switch(f){case "portal:admin:inviteUsers":this.privilegeObj.portal.admin.inviteUsers=c;break;case "portal:admin:disableUsers":this.privilegeObj.portal.admin.disableUsers=c;break;case "portal:admin:viewUsers":this.privilegeObj.portal.admin.viewUsers=
c;break;case "portal:admin:updateUsers":this.privilegeObj.portal.admin.updateUsers=c;break;case "portal:admin:deleteUsers":this.privilegeObj.portal.admin.deleteUsers=c;break;case "portal:admin:changeUserRoles":this.privilegeObj.portal.admin.changeUserRoles=c;break;case "portal:admin:viewGroups":this.privilegeObj.portal.admin.viewGroups=c;break;case "portal:admin:updateGroups":this.privilegeObj.portal.admin.updateGroups=c;break;case "portal:admin:deleteGroups":this.privilegeObj.portal.admin.deleteGroups=
c;break;case "portal:admin:reassignGroups":this.privilegeObj.portal.admin.reassignGroups=c;break;case "portal:admin:assignToGroups":this.privilegeObj.portal.admin.assignToGroups=c;break;case "portal:admin:manageEnterpriseGroups":this.privilegeObj.portal.admin.manageEnterpriseGroups=c;break;case "portal:admin:viewItems":this.privilegeObj.portal.admin.viewItems=c;break;case "portal:admin:updateItems":this.privilegeObj.portal.admin.updateItems=c;break;case "portal:admin:deleteItems":this.privilegeObj.portal.admin.deleteItems=
c;break;case "portal:admin:reassignItems":this.privilegeObj.portal.admin.reassignItems=c;break;case "portal:admin:manageLicenses":this.privilegeObj.portal.admin.manageLicenses=c;break;case "portal:publisher:publishFeatures":this.privilegeObj.portal.publisher.publishFeatures=c;break;case "portal:publisher:publishTiles":this.privilegeObj.portal.publisher.publishTiles=c;break;case "portal:publisher:publishScenes":this.privilegeObj.portal.publisher.publishScenes=c;break;case "portal:user:createGroup":this.privilegeObj.portal.user.createGroup=
c;break;case "portal:user:joinGroup":this.privilegeObj.portal.user.joinGroup=c;break;case "portal:user:joinNonOrgGroup":this.privilegeObj.portal.user.joinNonOrgGroup=c;break;case "portal:user:createItem":this.privilegeObj.portal.user.createItem=c;break;case "portal:user:shareToGroup":this.privilegeObj.portal.user.shareToGroup=c;break;case "portal:user:shareToOrg":this.privilegeObj.portal.user.shareToOrg=c;break;case "portal:user:shareToPublic":this.privilegeObj.portal.user.shareToPublic=c;break;case "portal:user:shareGroupToOrg":this.privilegeObj.portal.user.shareGroupToOrg=
c;break;case "portal:user:shareGroupToPublic":this.privilegeObj.portal.user.shareGroupToPublic=c;break;case "features:user:edit":this.privilegeObj.features.user.edit=c;break;case "features:user:fullEdit":this.privilegeObj.features.user.fullEdit=c;break;case "opendata:user:openDataAdmin":this.privilegeObj.opendata.user.openDataAdmin=c;break;case "opendata:user:designateGroup":this.privilegeObj.opendata.user.designateGroup=c;break;case "premium:user:geocode":this.privilegeObj.premium.user.geocode=c;
break;case "premium:user:networkanalysis":this.privilegeObj.premium.user.networkanalysis=c;break;case "premium:user:spatialanalysis":this.privilegeObj.premium.user.spatialanalysis=c;break;case "premium:user:geoenrichment":this.privilegeObj.premium.user.geoenrichment=c;break;case "premium:user:demographics":this.privilegeObj.premium.user.demographics=c;break;case "premium:user:elevation":this.privilegeObj.premium.user.elevation=c;break;case "premium:publisher:createNotebooks":this.privilegeObj.premium.publisher.createNotebooks=
c;break;case "marketplace:admin:purchase":this.privilegeObj.marketplace.admin.purchase=c;break;case "marketplace:admin:manage":this.privilegeObj.marketplace.admin.manage=c;break;case "marketplace:admin:startTrial":this.privilegeObj.marketplace.admin.startTrial=c}},_applyToAll:function(c){this.privilegeObj.portal.admin.inviteUsers=c;this.privilegeObj.portal.admin.disableUsers=c;this.privilegeObj.portal.admin.viewUsers=c;this.privilegeObj.portal.admin.updateUsers=c;this.privilegeObj.portal.admin.deleteUsers=
c;this.privilegeObj.portal.admin.changeUserRoles=c;this.privilegeObj.portal.admin.viewGroups=c;this.privilegeObj.portal.admin.updateGroups=c;this.privilegeObj.portal.admin.deleteGroups=c;this.privilegeObj.portal.admin.reassignGroups=c;this.privilegeObj.portal.admin.assignToGroups=c;this.privilegeObj.portal.admin.manageEnterpriseGroups=c;this.privilegeObj.portal.admin.viewItems=c;this.privilegeObj.portal.admin.updateItems=c;this.privilegeObj.portal.admin.deleteItems=c;this.privilegeObj.portal.admin.reassignItems=
c;this.privilegeObj.portal.admin.manageLicenses=c;this.privilegeObj.portal.publisher.publishFeatures=c;this.privilegeObj.portal.publisher.publishTiles=c;this.privilegeObj.portal.publisher.publishScenes=c;this.privilegeObj.portal.user.createGroup=c;this.privilegeObj.portal.user.joinGroup=c;this.privilegeObj.portal.user.joinNonOrgGroup=c;this.privilegeObj.portal.user.createItem=c;this.privilegeObj.portal.user.shareToGroup=c;this.privilegeObj.portal.user.shareToOrg=c;this.privilegeObj.portal.user.shareToPublic=
c;this.privilegeObj.portal.user.shareGroupToOrg=c;this.privilegeObj.portal.user.shareGroupToPublic=c;this.privilegeObj.features.user.edit=c;this.privilegeObj.opendata.user.openDataAdmin=c;this.privilegeObj.opendata.user.designateGroup=c;this.privilegeObj.premium.user.geocode=c;this.privilegeObj.premium.user.networkanalysis=c;this.privilegeObj.premium.user.spatialanalysis=c;this.privilegeObj.premium.user.geoenrichment=c;this.privilegeObj.premium.user.demographics=c;this.privilegeObj.premium.user.elevation=
c;this.privilegeObj.premium.publisher.createNotebooks=c;this.privilegeObj.marketplace.admin.purchase=c;this.privilegeObj.marketplace.admin.manage=c;this.privilegeObj.marketplace.admin.startTrial=c},_buildPrivilegesArray:function(){var c=[];!0===this.privilegeObj.portal.admin.inviteUsers&&c.push("portal:admin:inviteUsers");!0===this.privilegeObj.portal.admin.disableUsers&&c.push("portal:admin:disableUsers");!0===this.privilegeObj.portal.admin.viewUsers&&c.push("portal:admin:viewUsers");!0===this.privilegeObj.portal.admin.updateUsers&&
c.push("portal:admin:updateUsers");!0===this.privilegeObj.portal.admin.deleteUsers&&c.push("portal:admin:deleteUsers");!0===this.privilegeObj.portal.admin.changeUserRoles&&c.push("portal:admin:changeUserRoles");!0===this.privilegeObj.portal.admin.viewGroups&&c.push("portal:admin:viewGroups");!0===this.privilegeObj.portal.admin.updateGroups&&c.push("portal:admin:updateGroups");!0===this.privilegeObj.portal.admin.deleteGroups&&c.push("portal:admin:deleteGroups");!0===this.privilegeObj.portal.admin.reassignGroups&&
c.push("portal:admin:reassignGroups");!0===this.privilegeObj.portal.admin.assignToGroups&&c.push("portal:admin:assignToGroups");!0===this.privilegeObj.portal.admin.manageEnterpriseGroups&&c.push("portal:admin:manageEnterpriseGroups");!0===this.privilegeObj.portal.admin.viewItems&&c.push("portal:admin:viewItems");!0===this.privilegeObj.portal.admin.updateItems&&c.push("portal:admin:updateItems");!0===this.privilegeObj.portal.admin.deleteItems&&c.push("portal:admin:deleteItems");!0===this.privilegeObj.portal.admin.reassignItems&&
c.push("portal:admin:reassignItems");!0===this.privilegeObj.portal.admin.manageLicenses&&c.push("portal:admin:manageLicenses");!0===this.privilegeObj.portal.publisher.publishFeatures&&c.push("portal:publisher:publishFeatures");!0===this.privilegeObj.portal.publisher.publishTiles&&c.push("portal:publisher:publishTiles");!0===this.privilegeObj.portal.publisher.publishScenes&&c.push("portal:publisher:publishScenes");!0===this.privilegeObj.portal.user.createGroup&&c.push("portal:user:createGroup");!0===
this.privilegeObj.portal.user.joinGroup&&c.push("portal:user:joinGroup");!0===this.privilegeObj.portal.user.joinNonOrgGroup&&c.push("portal:user:joinNonOrgGroup");!0===this.privilegeObj.portal.user.createItem&&c.push("portal:user:createItem");!0===this.privilegeObj.portal.user.shareToGroup&&c.push("portal:user:shareToGroup");!0===this.privilegeObj.portal.user.shareToOrg&&c.push("portal:user:shareToOrg");!0===this.privilegeObj.portal.user.shareToPublic&&c.push("portal:user:shareToPublic");!0===this.privilegeObj.portal.user.shareGroupToOrg&&
c.push("portal:user:shareGroupToOrg");!0===this.privilegeObj.portal.user.shareGroupToPublic&&c.push("portal:user:shareGroupToPublic");!0===this.privilegeObj.features.user.edit&&c.push("features:user:edit");!0===this.privilegeObj.features.user.fullEdit&&c.push("features:user:fullEdit");!0===this.privilegeObj.opendata.user.openDataAdmin&&c.push("opendata:user:openDataAdmin");!0===this.privilegeObj.opendata.user.designateGroup&&c.push("opendata:user:designateGroup");!0===this.privilegeObj.premium.user.geocode&&
c.push("premium:user:geocode");!0===this.privilegeObj.premium.user.networkanalysis&&c.push("premium:user:networkanalysis");!0===this.privilegeObj.premium.user.spatialanalysis&&c.push("premium:user:spatialanalysis");!0===this.privilegeObj.premium.user.geoenrichment&&c.push("premium:user:geoenrichment");!0===this.privilegeObj.premium.user.demographics&&c.push("premium:user:demographics");!0===this.privilegeObj.premium.user.elevation&&c.push("premium:user:elevation");!0===this.privilegeObj.premium.publisher.createNotebooks&&
c.push("premium:publisher:createNotebooks");!0===this.privilegeObj.marketplace.admin.purchase&&c.push("marketplace:admin:purchase");!0===this.privilegeObj.marketplace.admin.manage&&c.push("marketplace:admin:manage");!0===this.privilegeObj.marketplace.admin.startTrial&&c.push("marketplace:admin:startTrial");return c},isUser:function(){return c.isDefined(this.id)&&("org_user"===this.id||"account_user"===this.id)},isPublisher:function(){return c.isDefined(this.id)&&("org_publisher"===this.id||"account_publisher"===
this.id)},isAdmin:function(){return c.isDefined(this.id)&&("org_admin"===this.id||"account_admin"===this.id)},isBasedOnUser:function(){return this.isUser()||c.isDefined(this.baseRole)&&("org_user"===this.baseRole||"account_user"===this.baseRole)},isBasedOnPublisher:function(){return this.isPublisher()||c.isDefined(this.baseRole)&&("org_publisher"===this.baseRole||"account_publisher"===this.baseRole)},isBasedOnAdmin:function(){return this.isAdmin()||c.isDefined(this.baseRole)&&("org_admin"===this.baseRole||
"account_admin"===this.baseRole)},isCustom:function(){return!this.isUser()&&!this.isPublisher()&&!this.isAdmin()&&c.isDefined(this.id)&&0<this.id.length},canInviteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.inviteUsers},canDisableUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.disableUsers},canViewUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewUsers},canUpdateUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateUsers},
canDeleteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteUsers},canChangeUserRoles:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.changeUserRoles},canViewOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewGroups},canUpdateOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateGroups},canDeleteOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteGroups},canReassignOrgGroups:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.reassignGroups},canAssignUsersToOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.assignToGroups},canManageEnterpriseGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageEnterpriseGroups},canViewOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewItems},canUpdateOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateItems},canDeleteOrgItems:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.deleteItems},canReassignOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignItems},canManageLicenses:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageLicenses},canCreateGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createGroup},canJoinOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinGroup},canJoinNonOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinNonOrgGroup},
canPublishFeatures:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishFeatures},canPublishTiles:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishTiles},canPublishScenes:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishScenes},canCreateItem:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createItem},canShareItemToGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToGroup},
canShareItemToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToOrg},canShareItemToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToPublic},canShareGroupToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToOrg},canShareGroupToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToPublic},canEditFeatures:function(){return this.privilegeObj&&this.privilegeObj.features.user.edit},
canEditFeaturesFullControl:function(){return this.privilegeObj&&this.privilegeObj.features.user.fullEdit},canManageOpenData:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.openDataAdmin},canDesignateOpenDataGroups:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.designateGroup},canUseGeocode:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geocode},canUseNetworkAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.networkanalysis},
canUseSpatialAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.spatialanalysis},canUseGeoenrichment:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geoenrichment},canUseDemographics:function(){return this.privilegeObj&&this.privilegeObj.premium.user.demographics},canCreateNotebooks:function(){return this.privilegeObj&&this.privilegeObj.premium.publisher.createNotebooks},canPurchaseMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.purchase},
canManageMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.manage},canTrialMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.startTrial},setPrivileges:function(f){this.privileges=f;this._initPrivilegesObject();c.isDefined(f)&&this._readPrivileges(f)},stringify:function(){return p.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()})},stringifyRole:function(){return p.stringify({id:this.id,
name:this.name,description:this.description})},stringifyPrivileges:function(){return p.stringify({privileges:this._buildPrivilegesArray()})},stringifyPretty:function(){return p.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()},null,"  ")}})})},"jimu/ServiceDefinitionManager":function(){define(["dojo/_base/declare","esri/request"],function(r,f){var l=null,p=r(null,{cache:{},getServiceDefinition:function(c,q){q||(q="json");var n=this.cache[c];
0>=this._getDefStatus(n)&&(n=f({url:c,handleAs:q,content:{f:q},callbackParamName:"callback"}),this.cache[c]=n);return n},_getDefStatus:function(c){return c?c.isFulfilled()?c.isResolved()?2:-1:1:0}});p.getInstance=function(){l||(l=new p,window._serviceDefinitionManager=l);return l};return p})},"jimu/LayerNode":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/Deferred","dojo/Evented"],function(r,f,l,p,c){var q=r([c],{declaredClass:"jimu.LayerNode",_layerInfo:null,map:null,
title:null,id:null,subId:null,layerObject:null,constructor:function(c){this._layerInfo=c;this.map=c.map;this.title=c.title;this.id=c.id;this.subId=c.subId},isLeaf:function(){return this._layerInfo.isLeaf()},isRoot:function(){return this._layerInfo.isRootLayer()},toggle:function(){this._layerInfo.setTopLayerVisible(!this.isToggledOn())},isToggledOn:function(){return this._layerInfo.isVisible()},show:function(){this._layerInfo.show()},hide:function(){this._layerInfo.hide()},isVisible:function(){return this._layerInfo.isShowInMap()},
traversal:function(c){return this._layerInfo.traversal(function(f){return c(f._adaptor)})},getNodeById:function(c){var f=null;if(c=this._layerInfo.findLayerInfoById(c))f=c._adaptor;return f},getExtent:function(){return this._layerInfo.getExtent()},getOpacity:function(){return this._layerInfo.getOpacity()},setOpacity:function(c){this._layerInfo.setOpacity(c)},getServiceDefinition:function(){return this._layerInfo.getServiceDefinition()},getLayerObject:function(){return this._layerInfo.getLayerObject()},
getRootNode:function(){return this._layerInfo.getRootLayerInfo()._adaptor},getParentNode:function(){var c=this._layerInfo.parentLayerInfo;return c?c._adaptor:null},getSubNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfo.getSubLayers())},getNodeLevel:function(){return this._layerInfo.getLayerLevel()},getLayerType:function(){return this._layerInfo.getLayerType()},getPopupInfoFromWebmap:function(){return this._layerInfo.getPopupInfo()},getPopupInfo:function(){return this._layerInfo.getPopupInfoFromLayerObject()},
loadPopupInfo:function(){return this._layerInfo.loadPopupInfo()},getInfoTemplate:function(){return this._layerInfo.getInfoTemplate()},loadInfoTemplate:function(){return this._layerInfo.loadInfoTemplate()},getFilterFromWebmap:function(){return this._layerInfo.getFilterOfWebmap()},getFilter:function(){return this._layerInfo.getFilter()},setFilter:function(c){this._layerInfo.setFilter(c)},isShowLegend:function(){return this.isShowLegendFromWebmap()},isShowLegendFromWebmap:function(){return this._layerInfo.getShowLegendOfWebmap()},
isToggledOnLegendFromWebMap:function(){return this._layerInfo._getShowLegendOfWebmap()},getUrl:function(){return this._layerInfo.getUrl()},getRelatedNodes:function(){var c=new p;this._layerInfo.getRelatedTableInfoArray().then(l.hitch(this,function(f){c.resolve(this._getNodesArrayFromInfosArray(f))}));return c},isVisibleAtMapScale:function(){return this._layerInfo.isInScale()},enablePopup:function(){return this._layerInfo.enablePopup()},disablePopup:function(){return this._layerInfo.disablePopup()},
isPopupEnabled:function(){return this._layerInfo.isPopupEnabled()},isItemLayer:function(){return this._layerInfo.isItemLayer()},getItemInfo:function(){return this._layerInfo.getItemInfo()},isHostedService:function(){return this._layerInfo.isHostedService()},isHostedLayer:function(){return this._layerInfo.isHostedLayer()},canShowLabel:function(){return this._layerInfo.canShowLabel()},isLabelVisble:function(){return this._layerInfo.isShowLabels()},showLabel:function(){this._layerInfo.showLabels()},
hideLabel:function(){this._layerInfo.hideLabels()},isTable:function(){return!!this._layerInfo.isTable},isTiled:function(){return!!this._layerInfo.isTiled},isBasemap:function(){return this._layerInfo.isBasemap()},isEditable:function(c){return this._layerInfo.isEditable(c)},zoomTo:function(c){return this._layerInfo.zoomTo(c)},emitEvent:function(c){try{var f=null;switch(c){case "isVisibleChanged":f=q.EVENT_TOOGLE_CHANGE;break;case "isShowInMapChanged":f=q.EVENT_VISIBILITY_CHANGE;break;case "filterChanged":f=
q.EVENT_FILTER_CHANGE;break;case "rendererChanged":f=q.EVENT_RENDERER_CHANGE;break;case "opacityChanged":f=q.EVENT_OPACITY_CHANGE;break;case "timeExtentChanged":f=q.EVENT_TIME_EXTENT_CHANGE}f&&this.emit(f)}catch(h){console.error(h)}},destroy:function(){this.inherited(arguments)},_getNodesArrayFromInfosArray:function(c){var k=[];f.forEach(c,function(c){k.push(c._adaptor)},this);return k}});l.mixin(q,{EVENT_TOOGLE_CHANGE:"toggle-change",EVENT_VISIBILITY_CHANGE:"visibility-change",EVENT_FILTER_CHANGE:"filter-change",
EVENT_RENDERER_CHANGE:"renderer-change",EVENT_OPACITY_CHANGE:"opacity-change",EVENT_TIME_EXTENT_CHANGE:"time-extent-change"});return q})},"jimu/LayerInfos/RequestBuffer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred"],function(r,f,l){var p=r(null,{_realRequest:null,_buffer:null,constructor:function(c){this._buffer={};this._realRequest=c?c:function(){return new l}},getRequest:function(c){this._buffer[c]||(this._buffer[c]=new p.RequestProxy(this._realRequest,c));return this._buffer[c]},
request:function(c){var f=Array.prototype.slice.apply(arguments);f.splice(0,1);var n=this.getRequest(c);return n.request.apply(n,f)},setResponse:function(c,f){this.getRequest(c).setResponse(f)},isResolved:function(c){return this.getRequest(c).isResolved()}});p.RequestProxy=r(null,{_key:null,_deferred:null,_realRequest:null,constructor:function(c,f){this._realRequest=c;this._key=f},request:function(){this._deferred||(this._deferred=new l,this._realRequest.apply(null,arguments).then(f.hitch(this,function(c){this._deferred.resolve(c)}),
f.hitch(this,function(c){c&&console.warn(c.message||c);c=this._deferred;this._deferred=null;c.resolve(null)})));return this._deferred},fakeRequest:function(){this._deferred||(this._deferred=new l);return this._deferred},setResponse:function(c,f){this._deferred||(this._deferred=new l);null===c||void 0===c?(this._deferred.resolve(null),f&&(this._deferred=null)):this._deferred.resolve(c)},isResolved:function(){return this._deferred&&this._deferred.isResolved()}});return p})},"jimu/LayerInfos/LayerInfoForMapService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/json dojo/aspect dojo/topic ./LayerInfo esri/request esri/layers/FeatureLayer esri/lang".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e){return r(k,{_legendInfo:null,_sublayerIdent:null,controlPopupInfo:null,_jsapiLayerInfos:null,_oldFilter:null,_subLayerVisible:null,constructor:function(){},init:function(){this._initJsapiLayerInfos();this._initSubLayerVisible();this._initSubLayerIdent();this._initControlPopup();this.inherited(arguments);this._initAfterRootLayerInfo();this._needToRefresh().then(l.hitch(this,function(b){b&&(this.update(),this._getLayerInfosObj()._onLayersUpdated(this,this))}))},_initAfterRootLayerInfo:function(){this.traversal(function(b){!b.isRootLayer()&&
b._initAfterRootLayerInfo&&b._initAfterRootLayerInfo()})},_needToRefresh:function(){var b=new p;this.layerObject.dynamicLayerInfos&&this.isRootLayer()&&this.isItemLayer()&&!this.originOperLayer.thematicGroup?this.getItemInfo().then(l.hitch(this,function(e){(e=(e=e.getItemData())&&e.thematicGroup)?(this.originOperLayer.thematicGroup=e,b.resolve(!0)):b.resolve(!1)})):b.resolve(!1);return b},_initOldFilter:function(){this._oldFilter=this.layerObject&&this.layerObject.layerDefinitions?this.layerObject.layerDefinitions:
[]},_initJsapiLayerInfos:function(){var b=f.filter(this.originOperLayer.layers,function(b){return e.isDefined(b.id)&&e.isDefined(b.name)&&e.isDefined(b.minScale)&&e.isDefined(b.maxScale)&&e.isDefined(b.parentLayerId)&&e.isDefined(b.defaultVisibility)});this._jsapiLayerInfos=this.layerObject.dynamicLayerInfos?this.originOperLayer.thematicGroup&&this.originOperLayer.thematicGroup.layerIds&&0<=this.originOperLayer.thematicGroup.layerIds.length?f.filter(this.layerObject.dynamicLayerInfos,function(b){return-1<
this.originOperLayer.thematicGroup.layerIds.indexOf(b.id)?!0:!1},this):this.layerObject.dynamicLayerInfos:0<b.length?b:this.layerObject.layerInfos},_cloneInfoTemplates:function(b){var e={},a;for(a in b)if(b.hasOwnProperty(a)&&"function"!==typeof b[a]){var g=b[a];g.infoTemplate&&g.infoTemplate.toJson&&(e[a]={infoTemplate:new g.infoTemplate.constructor(g.infoTemplate.toJson()),layerUrl:g.layerUrl,resourceInfo:g.resourceInfo})}return e},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,
infoTemplates:this._cloneInfoTemplates(this.layerObject.infoTemplates)};this.layerObject._infoTemplates=this._cloneInfoTemplates(this.layerObject.infoTemplates);q.after(this.layerObject,"setInfoTemplates",l.hitch(this,function(){this.layerObject._infoTemplates=this._cloneInfoTemplates(this.layerObject.infoTemplates);this.controlPopupInfo.infoTemplates=this._cloneInfoTemplates(this.layerObject.infoTemplates);this.traversal(function(b){b._afterSetInfoTemplates&&b._afterSetInfoTemplates()})}))},_initSubLayerIdent:function(){this._sublayerIdent=
{definitions:{},empty:!0,defLoad:new p}},_initSubLayerVisible:function(b){this._subLayerVisible={};for(var e=0;e<this._jsapiLayerInfos.length;e++)this._subLayerVisible[this._jsapiLayerInfos[e].id]=!1;b?f.forEach(b,function(a){this._subLayerVisible[a]=!0},this):this.originOperLayer.visibleLayers?f.forEach(this.originOperLayer.visibleLayers,function(a){this._subLayerVisible[a]=!0},this):f.forEach(this._jsapiLayerInfos,function(a){a.defaultVisibility&&(this._subLayerVisible[a.id]=!0)},this)},_initVisible:function(){this._visible=
this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(b){this.originOperLayer.layerObject.setVisibility(b);this._visible=b},_setSubLayerVisible:function(b){var e=[-1,-1,-1],a,g=[],d=f.filter(this.originOperLayer.layerObject.visibleLayers,function(a){return-1!==a});f.forEach(d,function(a){if(!this._isGroupLayerBySubId(a)){var d=this._subLayerInfoIndex[a];d&&d._isAllSubLayerVisibleOnPath()&&g.push(a)}},this);var d=g,c;for(c in b)if(b.hasOwnProperty(c)&&"function"!==typeof b[c]){var h=
Number(c);b[c]?(a=f.indexOf(d,h),0>a&&d.push(h)):(a=f.indexOf(d,h),0<=a&&d.splice(a,1))}e=e.concat(d);this.originOperLayer.layerObject.setVisibleLayers(e)},_resetLayerObjectVisiblity:function(b){var e=b?b[this.id]:null,a=!1;if(b&&(e&&this.layerObject.setVisibility(e.visible),"esri.layers.ArcGISDynamicMapServiceLayer"===this.layerObject.declaredClass)){var e={},g;for(g in b)b.hasOwnProperty(g)&&"function"!==typeof b[g]&&(a=!0,e[g]=b[g].visible);a&&this._setSubLayerVisibleByCheckedInfo(e)}},_setSubLayerVisibleByCheckedInfo:function(b){var m=
[];f.forEach(this._jsapiLayerInfos,function(a){var d=this.id+"_"+a.id;e.isDefined(b[d])?b[d]&&m.push(a.id):this._subLayerVisible[a.id]&&m.push(a.id)},this);this._initSubLayerVisible(m);this.traversal(function(a){a._initVisible()});var a={};this.traversal(function(b){0!==b.getSubLayers().length||b.isRootLayer()||(a[b.originOperLayer.mapService.subId]=b._isAllSubLayerVisibleOnPath())});this._setSubLayerVisible(a)},_subLayerVisibleChanged:function(){var b=[];this.traversal(function(e){b.push(e)});n.publish("layerInfos/layerInfo/visibleChanged",
b)},obtainNewSubLayers:function(){var b=[],e=this.originOperLayer.layerObject,a=null,a="esri.layers.ArcGISDynamicMapServiceLayer"===e.declaredClass?"dynamic":"tiled";f.forEach(this._jsapiLayerInfos,function(d){this._addNewSubLayer(b,e.url+"/"+d.id,e.id+"_"+d.id,d,d.subLayerIds&&0<d.subLayerIds.length?a+"_group":a)},this);var g=[];f.forEach(this._jsapiLayerInfos,function(a,g){a=a.parentLayerId;if(-1!==a){for(var d=null,e=0;e<b.length;e++)if(b[e].mapService.subId===a){d=b[e];break}(a=d)&&a.subLayers.push(b[g])}},
this);f.forEach(this._jsapiLayerInfos,function(a,e){-1===a.parentLayerId&&(a=this._layerInfoFactory.create(b[e]),g.push(a),a.init())},this);return g},_addNewSubLayer:function(b,e,a,g,d){var m=g.source&&g.source.mapLayerId;if(void 0===m||null===m)m=g.id;var c=this.getMSShipFeatureLayer(e,g.id);b.push({layerObject:{url:e,empty:!0},title:g.name||g.id||" ",id:a||"-",subId:g.id,subLayers:[],mapService:{layerInfo:this,subId:g.id,mapServiceSubId:m},selfType:c?"mapservice_"+d+"_ship_featurelayer":"mapservice_"+
d,msShipFLayerId:c&&c.id,parentLayerInfo:this})},_handleErrorSubLayer:function(b,e,a,g,d,c){b[e]={layerObject:null,title:c.name||c.id||" ",id:a||" ",subLayers:[],mapService:{layerInfo:this,subId:g}}},getMSShipFeatureLayer:function(b,e){var a=null,g=b.indexOf("/MapServer");if(-1<g){var d=this.map.graphicsLayerIds.map(l.hitch(this,function(a){return this.map.getLayer(a)})),m=b.substring(0,g+1);d.some(l.hitch(this,function(d){var b=d.url;return b&&-1<b.indexOf(m+"FeatureServer/"+e)&&d&&!d.empty&&d.mode===
t.MODE_SELECTION&&!l.getObject("_wabProperties.isMSOwnedFeatureLayer",!1,d)?(a=d,!0):!1}))}return a},getLegendInfo:function(b){var e=new p;this._legendInfo?e.resolve(this._legendInfo):this._legendRequest(b).then(l.hitch(this,function(a){this._legendInfo=a.layers;e.resolve(this._legendInfo)}),function(){e.reject()});return e},_legendRequest:function(b){return 10.01<=this.layerObject.version?this._legendRequestServer():this._legendRequestTools(b)},_legendRequestServer:function(){var b=this.layerObject.url+
"/legend",e={f:"json"};this.layerObject._params.dynamicLayers&&(e.dynamicLayers=c.stringify(this._createDynamicLayers(this.layerObject)),"[{}]"===e.dynamicLayers&&(e.dynamicLayers="[]"));return h({url:b,content:e,handleAs:"json",callbackParamName:"callback"})},_legendRequestTools:function(b){return h({url:b+"sharing/tools/legend?soapUrl\x3d"+this.layerObject.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_createDynamicLayers:function(b){var e=[],a;f.forEach(b.dynamicLayerInfos||
b.layerInfos,function(g){a={id:g.id};a.source=g.source&&g.source.toJson();var d;b.layerDefinitions&&b.layerDefinitions[g.id]&&(d=b.layerDefinitions[g.id]);d&&(a.definitionExpression=d);var m;b.layerDrawingOptions&&b.layerDrawingOptions[g.id]&&(m=b.layerDrawingOptions[g.id]);m&&(a.drawingInfo=m.toJson());a.minScale=g.minScale||0;a.maxScale=g.maxScale||0;e.push(a)});return e},_getServiceDefinition:function(){var b=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(b)},
_getSubserviceDefinition:function(b){return 10.11<=this.layerObject.version?this._getAllLayerAndTable(b):this._getLayerAndTable(b)},_getAllLayerAndTable:function(b){var e=this.layerObject.url+"/layers",a=this._serviceDefinitionBuffer.getRequest("_all_layer_and_table_request");a.isResolved()||a.request(e).then(l.hitch(this,function(a){a||(a={layers:[]});this.traversal(l.hitch(this,function(d){if(!d.isRootLayer()){var b=d.originOperLayer.mapService.mapServiceSubId;d=this._serviceDefinitionBuffer.getRequest(b);
var g=null;f.some(a.layers,function(a){if(a.id===b)return g=a,!0},this);d.setResponse(g)}}))}));return this._serviceDefinitionBuffer.getRequest(b).fakeRequest()},_getLayerAndTable:function(b){var e=this.layerObject.url+"/"+b;return this._serviceDefinitionBuffer.getRequest(b).request(e)},_getSublayerSettingOfWebmap:function(b){var e=f.filter(this.originOperLayer.layers,function(a){return a.id===b});return 1===e.length?e[0]:null},_getSublayerShowLegendOfWebmap:function(b){return(b=this._getSublayerSettingOfWebmap(b))?
void 0!==b.showLegend?b.showLegend:!0:!0},_idIsInJsapiLayerInfos:function(b){return null===this._getJsapiLayerInfoById(b)?!1:!0},_getJsapiLayerInfoById:function(b){for(var e=null,a=0;a<this._jsapiLayerInfos.length;a++)if(this._jsapiLayerInfos[a].id===b){e=this._jsapiLayerInfos[a];break}return e},_isGroupLayerBySubId:function(b){return(b=this._getJsapiLayerInfoById(b))&&b.subLayerIds&&0<b.subLayerIds.length?!0:!1},_bindEvent:function(){var b;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&
(b=this.layerObject.on("visible-layers-change",l.hitch(this,this._onVisibleLayersChanged)),this._eventHandles.push(b),b=q.after(this.layerObject,"setLayerDefinitions",l.hitch(this,this._onFilterChanged)),this._eventHandles.push(b))},_onVisibleLayersChanged:function(b){var e=b.visibleLayers;if(-1===e[0]&&-1===e[1]&&-1===e[2])this._subLayerVisibleChanged(),this._isShowInMapChanged2();else{b=[];var a=[-1,-1,-1],e=this._converVisibleLayers(e);b=e.visibleLayersForUpdateSubLayerVisible;a=a.concat(e.visibleLayersForSetVisibleLayers);
this._initSubLayerVisible(b);this.traversal(function(a){a._initVisible()});this.layerObject.setVisibleLayers(a)}},_converVisibleLayers:function(b){var e={visibleLayersForUpdateSubLayerVisible:[],visibleLayersForSetVisibleLayers:[]};f.forEach(b,function(a){var g=this.findLayerInfoById(this.id+"_"+a);if(this._isGroupLayerBySubId(a))g.traversal(function(a){b.push(a.originOperLayer.mapService.subId)});else for(;g&&g.originOperLayer.mapService;)b.push(g.originOperLayer.mapService.subId),g=g.parentLayerInfo},
this);f.forEach(b,function(a){0<=a&&0>e.visibleLayersForUpdateSubLayerVisible.indexOf(a)&&e.visibleLayersForUpdateSubLayerVisible.push(a)},this);f.forEach(e.visibleLayersForUpdateSubLayerVisible,function(a){this._isGroupLayerBySubId(a)||e.visibleLayersForSetVisibleLayers.push(a)},this);return e},_onFilterChanged:function(){for(var b,e=[],a=this.layerObject.layerDefinitions,g=a.length>this._oldFilter.length?a.length:this._oldFilter.length,d=0;d<g;d++)(a[d]?a[d]:null)!==(this._oldFilter[d]?this._oldFilter[d]:
null)&&(b=this.findLayerInfoById(this.id+"_"+d))&&b.isLeaf()&&e.push(b);0<e.length&&(n.publish("layerInfos/layerInfo/filterChanged",e,l.getObject("_wabProperties.objectPassWithFilterChangeEvent",!0,this.layerObject)),this._oldFilter=a,l.setObject("_wabProperties.objectPassWithFilterChangeEvent",{},this.layerObject))}})})},"jimu/LayerInfos/LayerInfoForKML":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils dojo/aspect dojo/topic ./LayerInfo ./LayerInfoForDefault jimu/utils dojo/Deferred esri/lang".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e){return r(n,{constructor:function(){},_getExtentAsync:function(){var b=this.layerObject.getLayers(),e=null,a=null;if(0<b.length&&"esri.layers.KMLLayer"===b[0].declaredClass){var g=[];this.traversal(l.hitch(this,function(a){a.id!==this.id&&"esri.layers.KMLLayer"===a.layerObject.declaredClass&&g.push(a)}));f.forEach(g,function(d){a=d._getExtentAsync();e=e?e.union(a):a},this)}else f.forEach(b,function(d){a=h.graphicsExtent(d.graphics);e=e?e.union(a):a},this);return e},
_getExtent:function(){var b=new t;b.resolve(this._getExtentAsync());return b},_resetLayerObjectVisiblity:function(b){var e=b?b[this.id]:null;if(e){var a={},g;for(g in b)b.hasOwnProperty(g)&&"function"!==typeof b[g]&&(a[g]=b[g].visible);this._setSubLayerVisibleByCheckedInfo(a);this._setTopLayerVisible(e.visible)}},_setSubLayerVisibleByCheckedInfo:function(b){this.traversal(l.hitch(this,function(m){e.isDefined(b[m.id])&&m._setTopLayerVisible(b[m.id])}))},_initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},
_setTopLayerVisible:function(b){b?this.layerObject.show():this.layerObject.hide()},obtainNewSubLayers:function(){var b=[];f.forEach(this._getOperLayerByParentFolderId(-1,this),function(e){e=this._layerInfoFactory.create(e);b.push(e);e.init()},this);return b},_getOperLayerByParentFolderId:function(b,e){var a=[],g=this.layerObject.getLayers()||[],d=f.filter(this.layerObject.folders||[],function(a){return a.parentFolderId===b?!0:!1}),m=[],m=0===d.length?f.filter(g,function(a){return this._flag.kmzSubLayersWereHandled?
!1:!0},this):d;f.forEach(m,function(d){var b;"esri.layers.KMLFolder"===d.declaredClass?b={layerObject:d,title:d.label||d.title||d.name||"\x26lt;no name\x26gt;",id:this._getSubLayerInfoIdForSubFolder(d),subId:d.id,kml:{layerInfo:this,currentFolder:d},selfType:"kml",parentLayerInfo:e}:"esri.layers.KMLLayer"===d.declaredClass?(b=l.getObject("linkInfo.name",!1,d),b={layerObject:d,title:d.label||d.title||b||d.name||d.id||" ",id:d.id||"-",subId:d.id||"-",kml:{layerInfo:this,currentFolder:null},selfType:"kml",
parentLayerInfo:e},l.setObject("_wabProperties.kmllayerWasHandled",!0,d),this._flag.kmzSubLayersWereHandled=!0):(l.setObject("_wabProperties.kmllayerWasHandled",!0,d),l.setObject("_wabProperties.isTemporaryLayer",!0,d));b&&a.push(b)},this);return a},_getAllSubLayerObject:function(){var b=[];this.traversal(l.hitch(this,function(e){e.layerObject&&e.layerObject.getLayers&&(b=b.concat(e.layerObject.getLayers()))}));return b},_getSubLayerInfoIdForSubFolder:function(b){return this.id+"_folder_"+b.id},_needToRenew:function(){return f.some(this._getAllSubLayerObject(),
function(b){if(!l.getObject("_wabProperties.kmllayerWasHandled",!1,b))return!0},this)},_bindEvent:function(){var b;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(b=c.after(this.layerObject,"setFolderVisibility",l.hitch(this,this._onSubFolderVisibleChanged),!0),this._eventHandles.push(b))},_onSubFolderVisibleChanged:function(b){b=this._getSubLayerInfoIdForSubFolder(b);(b=this.findLayerInfoById(b))&&q.publish("layerInfos/layerInfo/visibleChanged",[b])}})})},"jimu/LayerInfos/LayerInfoForDefault":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all ./LayerInfo dojox/gfx dojo/dom-construct dojo/dom-attr dojo/dom-class dojo/aspect jimu/portalUrlUtils jimu/portalUtils jimu/utils esri/symbols/jsonUtils esri/layers/LabelLayer esri/layers/LabelClass esri/dijit/PopupTemplate esri/dijit/Legend esri/graphic esri/geometry/Point esri/tasks/query esri/tasks/RelationshipQuery esri/tasks/QueryTask".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C,D,y,w){return r(q,{_legendsNode:null,controlPopupInfo:null,constructor:function(){this._initControlPopup();this._updateLayerObjectName();try{this._initToShowLabels()}catch(A){console.warn(A.message)}},_updateLayerObjectName:function(){if(this.layerObject&&!this.layerObject.empty&&this.layerObject.name&&!l.getObject("_wabProperties.originalLayerName",!1,this.layerObject)){l.setObject("_wabProperties.originalLayerName",this.layerObject.name,this.layerObject);
this.layerObject.name=this.title;if(void 0===this.layerObject.arcgisProps||null===this.layerObject.arcgisProps)this.layerObject.arcgisProps={};l.setObject("arcgisProps.title",this.title,this.layerObject)}},_initToShowLabels:function(){var a=l.getObject("_wabProperties.itemLayerInfo",!1,this.layerObject);a&&!this.layerObject.empty&&m.getPortal(a.portalUrl).getItemData(a.itemId).then(l.hitch(this,function(a){var d;a&&a.layers&&(f.some(a.layers,function(a){return a.id===this.layerObject.layerId?(d=a,
!0):!1},this),d&&d.showLabels&&((a=l.getObject("layerDefinition.drawingInfo.labelingInfo",!1,d))&&!this.layerObject.labelingInfo&&this.layerObject.setLabelingInfo&&(a=f.map(a,function(a){return new u(a)},this),this.layerObject.setLabelingInfo(a)),this.showLabels()))}),l.hitch(this,function(a){a&&a.message&&console.log(a.message)}))},_initOldFilter:function(){this._oldFilter=this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():
null},_getLayerOptionsForCreateLayerObject:function(){var a={};a.id=this.id;var d=[],b=this.getInfoTemplate();b&&b.info&&b.info.fieldInfos?f.forEach(b.info.fieldInfos,function(a){a.visible&&d.push(a.fieldName)},this):d=["*"];a.outFields=d;return a},_getExtent:function(){var d=new p,b;b=this.layerObject.graphics&&0<this.layerObject.graphics.length?a.graphicsExtent(this.layerObject.graphics):this.layerObject.fullExtent||this.layerObject.initialExtent;this.layerObject.url?this.getServiceDefinition().then(l.hitch(this,
function(g){var e=new w(this.layerObject.url),m=new D,c=this.getFilter();m.where=c?c:"1\x3d1";m.outSpatialReference=this.map.spatialReference;m.returnGeometry=!0;g&&g.advancedQueryCapabilities&&g.advancedQueryCapabilities.supportsReturningQueryExtent?e.executeForExtent(m,l.hitch(this,function(b){var g=b.extent;1===b.count&&"esriGeometryPoint"===this.layerObject.geometryType&&(b=new C(b.extent.xmin,b.extent.ymin,b.extent.spatialReference),g=a.graphicsExtent([new z(b)]));d.resolve(g)}),l.hitch(this,
function(){d.resolve(b);console.log("executeForExtent failed.")})):this.getSupportTableInfo().then(l.hitch(this,function(g){g.isSupportQuery?e.execute(m).then(l.hitch(this,function(b){b=a.graphicsExtent(b.features);d.resolve(b)}),l.hitch(this,function(){d.resolve(b);console.log("query execute failed.")})):d.resolve(b)}))})):d.resolve(b);return d},_resetLayerObjectVisiblity:function(a){a=a?a[this.id]:null;!this.originOperLayer.collection&&a&&(this.layerObject.setVisibility(a.visible),this._visible=
this.layerObject.visible)},_initVisible:function(){var a=!1;if(this.originOperLayer.collection&&this._notFirstInitVisilbeFlag){var a=this.originOperLayer.collection.layerInfo,d=this.layerObject.visible;if(a._oldIsShowInMap!==a.isShowInMap())return;this._visible=d?!0:!1;a._onVisibilityChanged()}else this._visible=a=this.originOperLayer.layerObject.visible;this._notFirstInitVisilbeFlag=!0},_setTopLayerVisible:function(a){this.originOperLayer.collection?this.originOperLayer.collection.layerInfo._visible?
a?(this.layerObject.show(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):a?(this.layerObject.hide(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):(a?this.layerObject.show():this.layerObject.hide(),this._visible=a)},setLayerVisiblefromTopLayer:function(){this.originOperLayer.collection.layerInfo._visible?this._visible&&this.layerObject.show():this.layerObject.hide()},_prepareCheckedInfoForShowOrHide:function(a){for(var d={},b=this;b.parentLayerInfo;)d[b.id]=a,b=b.parentLayerInfo;
return d},show:function(){if(this.isRootLayer())this._setTopLayerVisible(!0);else{var a=this.getRootLayerInfo();if(a._setSubLayerVisibleByCheckedInfo){var d=this._prepareCheckedInfoForShowOrHide(!0);a._setSubLayerVisibleByCheckedInfo(d);a.show()}}},_initControlPopup:function(){this.controlPopupInfo={enablePopup:this.layerObject.infoTemplate?!0:!1,infoTemplate:this.layerObject.infoTemplate};this.layerObject._infoTemplate=this.layerObject.infoTemplate;var a=e.after(this.layerObject,"setInfoTemplate",
l.hitch(this,function(){this.layerObject._infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.enablePopup||(this.layerObject.infoTemplate=null)}));this._eventHandles.push(a)},_getServiceDefinition:function(){var a;(a=this.getUrl())&&this.isRootLayer()&&"esri.layers.FeatureLayer"===this.layerObject.declaredClass?a=this._serviceDefinitionBuffer.getRequest(this.subId).request(a):(a=new p,a.resolve(null));return a},createLegendsNode:function(){var a=
k.create("div",{"class":"legends-div jimu-legends-div-flag jimu-leading-margin1",legendsDivId:this.id},document.body);k.create("img",{"class":"legends-loading-img",src:require.toUrl("jimu")+"/images/loading.gif"},a);return a},drawLegends:function(a){this._initLegendsNodeByLegendDijit(a)},_initLegendsNodeByLegendDijit:function(a){if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length)&&this.layerObject.loaded){k.empty(a);t.remove(a,
"jimu-legends-div-flag");var d=new B({map:this.map,layerInfos:[{layer:this.layerObject}],arrangement:B.ALIGN_LEFT,respectCurrentMapScale:!1,respectVisibility:!1},k.create("div",{},a));d.startup();a._legendDijit=d}},_initLegendsNode:function(d){var b=[],e=this.layerObject;!this.layerObject||this.layerObject.empty||this.originOperLayer.subLayer&&0!==this.originOperLayer.subLayers.length||(k.empty(d),e.renderer&&(e.renderer.infos?b=l.clone(e.renderer.infos):b.push({label:e.renderer.label,symbol:e.renderer.symbol}),
e.renderer&&e.renderer.defaultSymbol&&0<b.length&&b.push({label:e.renderer.defaultLabel||"others",symbol:e.renderer.defaultSymbol}),f.forEach(b,function(b){b.legendDiv=k.create("div",{"class":"legend-div"},d);b.symbolDiv=k.create("div",{"class":"legend-symbol jimu-float-leading"},b.legendDiv);b.labelDiv=k.create("div",{"class":"legend-label jimu-float-leading",innerHTML:a.sanitizeHTML(b.label)||" "},b.legendDiv);if("textsymbol"===b.symbol.type)h.set(b.symbolDiv,"innerHTML",a.sanitizeHTML(b.symbol.text));
else{var e=n.createSurface(b.symbolDiv,50,50);b=g.getShapeDescriptors(b.symbol);e.createShape(b.defaultShape).setFill(b.fill).setStroke(b.stroke).setTransform(n.matrix.translate(25,25))}},this)))},obtainNewSubLayers:function(){var a=[];f.forEach(this.originOperLayer.subLayers,function(d){d.parentLayerInfo=this;d=this._layerInfoFactory.create(d);a.push(d);d.init()},this);return a},_isAllSubLayerVisibleOnPath:function(){for(var a=!0,d=this;!d.isRootLayer();)a=a&&d.isVisible(),d=d.parentLayerInfo;return a},
_getCustomPopupInfo:function(d,b){var g=null;d&&d.fields&&(g={title:d.name,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},f.forEach(d.fields,function(d){var e=!1;b?f.some(b,l.hitch(this,function(a){return a&&d.name.toLowerCase()===a.toLowerCase()}))&&(e=!0):e=!0;e&&(e=a.getDefaultPortalFieldInfo(d),e.visible=!0,e.isEditable=d.editable,g.fieldInfos.push(e))},this));return g},_getDefaultPopupInfo:function(a){if(a=this._getCustomPopupInfo(a))a.fieldInfos=f.filter(a.fieldInfos,l.hitch(this,
function(a){return(a=a.fieldName&&a.fieldName.toLowerCase())&&0>a.indexOf("object")&&0>a.indexOf("globalid")&&0>a.indexOf("shape")&&0>a.indexOf("perimeter")?!0:!1}));return a},_getDefaultPopupTemplate:function(a){var d=null;(a=this.getPopupInfo()||this._getDefaultPopupInfo(a))&&(d=new v(a));return d},enablePopup:function(){return this.loadInfoTemplate().then(l.hitch(this,function(){return this.controlPopupInfo.infoTemplate?(this.controlPopupInfo.enablePopup=!0,this.layerObject.infoTemplate=this.controlPopupInfo.infoTemplate,
!0):!1}))},disablePopup:function(){this.controlPopupInfo.enablePopup=!1;this.layerObject.infoTemplate=null},isPopupEnabled:function(){return this.controlPopupInfo&&this.controlPopupInfo.enablePopup?!0:!1},isSupportPopup:function(){var a=new p;this.loadInfoTemplate().then(l.hitch(this,function(d){d?a.resolve(!0):a.resolve(!1)}));return a},loadInfoTemplate:function(){var a=new p;this.controlPopupInfo.infoTemplate?a.resolve(this.controlPopupInfo.infoTemplate):this.getLayerObject().then(l.hitch(this,
function(){this.controlPopupInfo.infoTemplate=this._getDefaultPopupTemplate(this.layerObject);a.resolve(this.controlPopupInfo.infoTemplate)}),l.hitch(this,function(){a.resolve(null)}));return a},getInfoTemplate:function(){return this.controlPopupInfo.infoTemplate},_getRelatedUrls:function(a,d){var b=[];if(!a||!a.url||!a.relationships)return b;var g=a.url.lastIndexOf("/"),e=a.url.slice(0,g);f.forEach(a.relationships,function(a){d&&a.role&&"esriRelCardinalityManyToMany"!==a.cardinality&&d!==a.role||
b.push(e+"/"+a.relatedTableId.toString())},this);return b},getRelatedTableInfoArray:function(a){var d=[],g=new p;this.getLayerObject().then(l.hitch(this,function(e){var m=this._getRelatedUrls(e,a);0!==m.length&&this._getLayerInfosObj().traversalAll(l.hitch(this,function(a){if(0===m.length)return!0;f.forEach(m,function(g,e){l.getObject("layerObject.url",!1,a)&&g&&b.removeProtocol(g.toString().toLowerCase()).replace(/\/+/g,"/")===b.removeProtocol(a.layerObject.url.toString().toLowerCase()).replace(/\/+/g,
"/")&&(d.push(a),m[e]="")},this);return!1}));g.resolve(d)}),l.hitch(this,function(){g.resolve(d)}));return g},_getOrderByFields:function(a){var d=null;if(void 0===a||null===a)return d;var b=this.getPopupInfo();b&&b.relatedRecordsInfo&&b.relatedRecordsInfo.orderByFields&&f.some(b.relatedRecordsInfo.orderByFields,function(b){var g=b.field.split("/");if(g[1]===a.toString())return d=[g[2]+" "+b.order],!0},this);return d},getOriRelationshipByDestLayer:function(a,d,b){var g=null;a=f.filter(a.relationships,
function(a){if(a.relatedTableId===d.layerId)return!0},this);return g=a[b]?a[b]:a[0]},getRelatedRecords:function(a,d,b){var g=new p,e=new y,m=this.getLayerObject(),h=d.getLayerObject();c({originalLayerObject:m,relatedLayerObject:h}).then(l.hitch(this,function(m){m.originalLayerObject&&m.relatedLayerObject||g.resolve([]);m=this.getOriRelationshipByDestLayer(this.layerObject,m.relatedLayerObject,b);e.outFields=["*"];e.relationshipId=m&&m.id;var c=a.attributes[this.layerObject.objectIdField];e.objectIds=
[c];e.definitionExpression=d.getFilter();e.orderByFields=this._getOrderByFields(m&&m.id);this.layerObject.queryRelatedFeatures(e,l.hitch(this,function(a){(a=a[c]&&a[c].features)?g.resolve(a):g.resolve([])}),l.hitch(this,function(){g.resolve([])}))}));return g},getFilter:function(){return this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?this.layerObject.getDefinitionExpression():null},setFilter:function(a,d){this.layerObject&&!this.layerObject.empty&&this.layerObject.setDefinitionExpression&&
(d=l.mixin({},d),l.setObject("_wabProperties.objectPassWithFilterChangeEvent",d,this.layerObject),this.layerObject.setDefinitionExpression(a))},_isAlreadyInLabelLayerOfMap:function(a){var d=!1;a&&(d=f.some(a.getFeatureLayers(),function(a){return this.id===a.id},this));return d},_addToLabelLayerOfMap:function(){var a=this.getLabelLayerOfMap();a&&!this._isAlreadyInLabelLayerOfMap(a)&&(a.addFeatureLayer(this.layerObject),this.map.removeLayer(a),this.map.addLayer(a))},_removeFromLabelLayerOfMap:function(){this.getLabelLayerOfMap().removeFeatureLayer(this.id)},
_isSupportLabelControl:function(){return this.isRootLayer()&&!this.layerObject.empty&&"esri.layers.FeatureLayer"===this.layerObject.declaredClass&&this.layerObject.labelingInfo&&0<this.layerObject.labelingInfo.length?!0:!1},getLabelLayerOfMap:function(){var a;this.map._labels?a=this.map._labels:(a=this.map.getLayer("labels"),a||(a=new d({id:"labels"}),this.map.addLayer(a)));return a},obtainLabelControl:function(){var a=this.id+"_labelLayer",b=this.map.getLayer(a);if(!b&&this._isSupportLabelControl()){var g=
this.getLabelLayerOfMap();g&&this._isAlreadyInLabelLayerOfMap(g)&&(b=new d({id:a}),b.addFeatureLayer(this.layerObject),this.map.addLayer(b),this._removeFromLabelLayerOfMap())}return b?b:null},restoreLabelControl:function(){this._isSupportLabelControl()&&(this.destroyRealtedLabelLayer(),this._addToLabelLayerOfMap())},destroyRealtedLabelLayer:function(){var a=this.map.getLayer(this.id+"_labelLayer");a&&this.map.removeLayer(a)},destroyLabelLayer:function(){this.map.getLayer(this.id)||(this._removeFromLabelLayerOfMap(),
this.destroyRealtedLabelLayer())},canShowLabel:function(){return this._isSupportLabelControl()},isShowLabels:function(){var a=this.map.getLayer(this.id+"_labelLayer"),d=this.getLabelLayerOfMap();return this._isSupportLabelControl()&&(a||d&&this._isAlreadyInLabelLayerOfMap(d))?this.layerObject.showLabels:!1},showLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&(this.map.getLayer(this.id+"_labelLayer")||this._addToLabelLayerOfMap(),this.layerObject.setShowLabels(!0))},
hideLabels:function(){this._isSupportLabelControl()&&this.layerObject.setShowLabels&&this.layerObject.setShowLabels(!1)}})})},"esri/layers/LabelLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/i18n!dojo/cldr/nls/number dojo/number dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ../ArcadeExpression ../core/timerUtils ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ../renderers/SimpleRenderer ../arcadeProfiles/labelingProfile ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ./GraphicsLayer ./LabelClass".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C,D,y,w,A){function G(a){return"sizeInfo"===a.type}r=r(w,{declaredClass:"esri.layers.LabelLayer",constructor:function(a){this._refreshLabels=f.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];a&&(a.id&&(this.id=a.id),a.mode&&(this._engineType="DYNAMIC"===a.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(a){this._mapEventHandlers.push(a.on("extent-change",
f.hitch(this,"_handleLevelChange")));var d=this.inherited(arguments);this.refresh();return d},_unsetMap:function(){var d;for(d=0;d<this._mapEventHandlers.length;d++)p.disconnect(this._mapEventHandlers[d]);this.refresh();a.clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(a){this._engineType=a&&"DYNAMIC"===a.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(a,d,b,g){if(!this.getFeatureLayer(a.layerId)){var e=[];e.push(a.on("update-end",
f.hitch(this,"refresh")));e.push(a.on("suspend",f.hitch(this,"refresh")));e.push(a.on("resume",f.hitch(this,"refresh")));e.push(a.on("edits-complete",f.hitch(this,"refresh")));e.push(a.on("labeling-info-change",f.hitch(this,"refresh")));e.push(a.on("time-extent-change",f.hitch(this,"refresh")));e.push(a.on("show-labels-change",f.hitch(this,"refresh")));e.push(a.on("feature-reduction-change",f.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:a,LabelExpressionInfo:b,LabelingOptions:g,
LabelRenderer:d,EventHandlers:e});this.featureLayers.push(a);this.refresh()}},getFeatureLayer:function(a){var d,b;for(d=0;d<this.featureLayers.length;d++)if(b=this.featureLayers[d],void 0!==b&&b.id==a)return b;return null},removeFeatureLayer:function(a){var d;a=this.getFeatureLayer(a);if(void 0!==a&&(d=l.indexOf(this.featureLayers,a),-1<d)){this.featureLayers.splice(d,1);for(a=0;a<this._featureLayerInfos[d].EventHandlers.length;a++)p.disconnect(this._featureLayerInfos[d].EventHandlers[a]);this._featureLayerInfos.splice(d,
1);this.refresh()}},removeAllFeatureLayers:function(){var a;for(a=0;a<this.featureLayers.length;a++){for(var d=0;d<this._featureLayerInfos[a].EventHandlers.length;d++)p.disconnect(this._featureLayerInfos[a].EventHandlers[d]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(a){var d,b;for(d=0;d<this.featureLayers.length;d++)if(b=this.featureLayers[d],void 0!==b&&b.id==a)return this._featureLayerInfos[d];
return null},refresh:function(){null==this._refreshHandle&&(this._refreshHandle=a.setTimeout(this._refreshLabels,a.priority.LOW))},_handleLevelChange:function(a){a.levelChange&&this.clear();this.refresh()},_refreshLabels:function(a){this._refreshHandle=null;var d,b,g,e,m,c=[],h,u="DYNAMIC"===this._engineType?new D:new y;if(this._map){u.setMap(this._map,this);this._preparedLabels=[];for(a=0;a<this.featureLayers.length;a++)if(b=this.featureLayers[a],b.visible&&b.showLabels&&b.visibleAtMapScale&&!b._suspended)if(d=
this._featureLayerInfos[a],m=this._convertOptions(null),d.LabelRenderer){if(c=b.labelingInfo)if(h=c[0])e=this._getLabelExpression(h),m=this._convertOptions(h);g=d.LabelRenderer;d.LabelExpressionInfo&&(e=d.LabelExpressionInfo);d.LabelingOptions&&(m=this._convertOptions(null),void 0!==d.LabelingOptions.pointPriorities&&(c=d.LabelingOptions.pointPriorities,m.pointPriorities="above-center"==c||"AboveCenter"==c||"esriServerPointLabelPlacementAboveCenter"==c?"AboveCenter":"above-left"==c||"AboveLeft"==
c||"esriServerPointLabelPlacementAboveLeft"==c?"AboveLeft":"above-right"==c||"AboveRight"==c||"esriServerPointLabelPlacementAboveRight"==c?"AboveRight":"below-center"==c||"BelowCenter"==c||"esriServerPointLabelPlacementBelowCenter"==c?"BelowCenter":"below-left"==c||"BelowLeft"==c||"esriServerPointLabelPlacementBelowLeft"==c?"BelowLeft":"below-right"==c||"BelowRight"==c||"esriServerPointLabelPlacementBelowRight"==c?"BelowRight":"center-center"==c||"CenterCenter"==c||"esriServerPointLabelPlacementCenterCenter"==
c?"CenterCenter":"center-left"==c||"CenterLeft"==c||"esriServerPointLabelPlacementCenterLeft"==c?"CenterLeft":"center-right"==c||"CenterRight"==c||"esriServerPointLabelPlacementCenterRight"==c?"CenterRight":"AboveRight"),void 0!==d.LabelingOptions.lineLabelPlacement&&(m.lineLabelPlacement=d.LabelingOptions.lineLabelPlacement),void 0!==d.LabelingOptions.lineLabelPosition&&(m.lineLabelPosition=d.LabelingOptions.lineLabelPosition),void 0!==d.LabelingOptions.labelRotation&&(m.labelRotation=d.LabelingOptions.labelRotation),
void 0!==d.LabelingOptions.howManyLabels&&(m.howManyLabels=d.LabelingOptions.howManyLabels));g instanceof A&&(e=this._getLabelExpression(g),g=new z(g.symbol),m=this._convertOptions(g));this._addLabels(b,g,e,m)}else if(c=b.labelingInfo)for(d=c.length-1;0<=d;d--)if(h=c[d])g=new A(h instanceof A?h.toJson():h),e=this._getLabelExpression(h),m=this._convertOptions(h),this._addLabels(b,g,e,m);e=u._process(this._preparedLabels);this.clear();this.drawLabels(this._map,e)}},drawLabels:function(a,d){this._scale=
(a.extent.xmax-a.extent.xmin)/a.width;var b;for(b=0;b<d.length;b++){var m=d[b],c=m.x,h=m.y,u=m.text,f=m.angle,k=m.layer.labelSymbol;"polyline"==m.layer.geometry.type&&m.layer.options.labelRotation&&k.setAngle(180/Math.PI*f);k.setText(u);k instanceof g&&(u=k.getHeight(),c-=.25*u*this._scale*Math.sin(f),h-=.33*u*this._scale);f=new e(new v(c,h,a.extent.spatialReference));f.setParentGraphic(m.layer.graphic);f.setSymbol(k);this.add(f)}},_addLabels:function(a,d,b,g){var e,m,c,h;if(this._isWithinScaleRange(d.minScale,
d.maxScale)&&b&&""!==b){var u=this._map,f=!a.url&&!u.spatialReference.equals(a.spatialReference);for(e=0;e<a.graphics.length;e++)if(m=a.graphics[e],!1!==m.visible&&!m._suspended){c=m.geometry;if(f){if(!B.canProject(c,u))continue;c=B.project(c,u)}c&&this._isWhere(d.where,m.attributes)&&this._isWithinScreenArea(c)&&(h=this._buildLabelText(b,m,a.fields,g),this._addLabel(h,d,a.renderer,m,g,c,u))}}},_isWithinScreenArea:function(a){a="point"===a.type?new u(a.x,a.y,a.x,a.y,a.spatialReference):a.getExtent();
if(void 0===a)return!1;a=this._intersects(this._map,a);return null===a||0===a.length?!1:!0},_isWithinScaleRange:function(a,d){var b=this._map.getScale();return 0<a&&b>=a||0<d&&b<d?!1:!0},_isWhere:function(a,d){try{if(!a)return!0;if(a){var b=a.split(" ");if(3===b.length)return this._sqlEquation(d[this._removeQuotes(b[0])],b[1],this._removeQuotes(b[2]));if(7===b.length){var g=this._sqlEquation(d[this._removeQuotes(b[0])],b[1],this._removeQuotes(b[2])),e=b[3],m=this._sqlEquation(d[this._removeQuotes(b[4])],
b[5],this._removeQuotes(b[6]));switch(e){case "AND":return g&&m;case "OR":return g||m}}}return!1}catch(J){console.log("Error.: can't parse \x3d "+a)}},_sqlEquation:function(a,d,b){switch(d){case "\x3d":return a==b?!0:!1;case "\x3c\x3e":return a!=b?!0:!1;case "\x3e":return a>b?!0:!1;case "\x3e\x3d":return a>=b?!0:!1;case "\x3c":return a<b?!0:!1;case "\x3c\x3d":return a<=b?!0:!1}return!1},_removeQuotes:function(a){var d=a.indexOf('"'),b=a.lastIndexOf('"');if(-1!=d&&-1!=b)return a.substr(1,a.length-
2);d=a.indexOf("'");b=a.lastIndexOf("'");return-1!=d&&-1!=b?a.substr(1,a.length-2):a},_getSizeInfo:function(a){return a?a.sizeInfo||l.filter(a.visualVariables,G)[0]:null},_addLabel:function(a,b,e,m,c,h,u){var t,n,v,q;if(a&&""!==f.trim(a)&&b){a=a.replace(/[\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/g," ");t=b.getSymbol(m);t instanceof g?(t=new g(t.toJson()),t.setVerticalAlignment("baseline"),t.setHorizontalAlignment("center")):t=t instanceof d?new d(t.toJson()):new g;
t.setText(a);b.symbol=t;if(v=this._getProportionalSize(b.sizeInfo,m.attributes))t instanceof g?t.setSize(v):t instanceof d&&(t.setWidth(v),t.setHeight(v));q=v=0;if(e){n=e.getSymbol(m);var p=this._getSizeInfo(e);if((e=p?e.getSize(m,{sizeInfo:p,resolution:u.getResolutionInMeters()}):m.size)&&null!==e)v=q=e;else if(n)if("simplemarkersymbol"==n.type)q=v=n.size;else if("picturemarkersymbol"==n.type)v=n.width,q=n.height;else if("simplelinesymbol"==n.type||"cartographiclinesymbol"==n.type)v=n.width}e={};
e.graphic=m;e.options=c;e.geometry=h;e.labelRenderer=b;e.labelSymbol=t;e.labelWidth=t.getWidth()/2;e.labelHeight=t.getHeight()/2;e.symbolWidth=k.normalizedLength(v)/2;e.symbolHeight=k.normalizedLength(q)/2;e.text=a;e.angle=t.angle;this._preparedLabels.push(e)}},_buildLabelText:function(a,d,e,g){if(g.hasExpression)return a=C.getEvalOptions({expression:g.arcadeExpr,feature:d,layer:d.getLayer(),spatialReference:this._map.spatialReference}),d=d.evaluateExpression(g.arcadeExpr,a),t.isDefined(d)?""+d:"";
var m=d.attributes;return a.replace(/{[^}]*}/g,function(a){var d,h=a;for(d=0;d<e.length;d++)if("{"+e[d].name+"}"==a){var h=m[e[d].name],u=e[d].domain;if(u&&f.isObject(u)){if("codedValue"==u.type&&g.useCodedValues)for(d=h,a=0;a<u.codedValues.length;a++)if(u.codedValues[a].code==d){h=u.codedValues[a].name;break}break}u=e[d].type;if(g.fieldInfos){var k=g.fieldInfos;for(d=0;d<k.length;d++)if("{"+k[d].fieldName+"}"==a){a=k[d].format;"esriFieldTypeDate"==u?h=t.substitute({myKey:h},"${myKey}",{format:{myKey:f.mixin({formatType:"DateFormat"},
b.prototype._dateFormatsJson[a&&a.dateFormat||"shortDate"])}}):"esriFieldTypeInteger"!=u&&"esriFieldTypeSingle"!=u&&"esriFieldTypeSmallInteger"!=u&&"esriFieldTypeLong"!=u&&"esriFieldTypeDouble"!=u||!a||(h=q.format(h,{places:a.places}),a.digitSeparator||c.group&&(h=h.replace(new RegExp("\\"+c.group,"g"),"")));break}}break}else h="";return null==h?"":h})},_getLabelExpression:function(a){var d="";a.labelExpressionInfo?d=a.labelExpressionInfo.value||a.labelExpressionInfo.expression:this._validSyntax(a.labelExpression)&&
(d=this._convertLabelExpression(a.labelExpression));return d},_validSyntax:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(/\[/g,"{").replace(/\]/g,"}")},_getProportionalSize:function(a,d){if(!a)return null;d=t.substitute(d,"${"+a.field+"}",{first:!0});return!(a.minSize&&a.maxSize&&a.minDataValue&&a.maxDataValue&&d)||0>=a.maxDataValue-a.minDataValue?null:(a.maxSize-a.minSize)/(a.maxDataValue-a.minDataValue)*(d-a.minDataValue)+a.minSize},_convertOptions:function(a){var d=
!0,b="shortDate",e=null,g=null,c="",h=!0,u,f;if(a&&(a.format&&(b=a.format.dateFormat,e={places:a.format.places,digitSeparator:a.format.digitSeparator}),g=a.fieldInfos,c=a.labelPlacement,null!=a.useCodedValues&&(d=a.useCodedValues),a=a.labelExpressionInfo)){var k=a.expression;k&&!a.value&&(f=!0,u=new m({expression:k,returnType:"string",profile:C}))}if("always-horizontal"==c||"esriServerPolygonPlacementAlwaysHorizontal"==c)h=!1;return{useCodedValues:d,dateFormat:b,numberFormat:e,fieldInfos:g,pointPriorities:"above-center"==
c||"esriServerPointLabelPlacementAboveCenter"==c?"AboveCenter":"above-left"==c||"esriServerPointLabelPlacementAboveLeft"==c?"AboveLeft":"above-right"==c||"esriServerPointLabelPlacementAboveRight"==c?"AboveRight":"below-center"==c||"esriServerPointLabelPlacementBelowCenter"==c?"BelowCenter":"below-left"==c||"esriServerPointLabelPlacementBelowLeft"==c?"BelowLeft":"below-right"==c||"esriServerPointLabelPlacementBelowRight"==c?"BelowRight":"center-center"==c||"esriServerPointLabelPlacementCenterCenter"==
c?"CenterCenter":"center-left"==c||"esriServerPointLabelPlacementCenterLeft"==c?"CenterLeft":"center-right"==c||"esriServerPointLabelPlacementCenterRight"==c?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==c||"below-start"==c||"center-start"==c?"PlaceAtStart":"above-end"==c||"below-end"==c||"center-end"==c?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==c||"esriServerLinePlacementAboveAfter"==c||"above-along"==c||"esriServerLinePlacementAboveAlong"==c||"above-before"==c||
"esriServerLinePlacementAboveBefore"==c||"above-start"==c||"esriServerLinePlacementAboveStart"==c||"above-end"==c||"esriServerLinePlacementAboveEnd"==c?"Above":"below-after"==c||"esriServerLinePlacementBelowAfter"==c||"below-along"==c||"esriServerLinePlacementBelowAlong"==c||"below-before"==c||"esriServerLinePlacementBelowBefore"==c||"below-start"==c||"esriServerLinePlacementBelowStart"==c||"below-end"==c||"esriServerLinePlacementBelowEnd"==c?"Below":"center-after"==c||"esriServerLinePlacementCenterAfter"==
c||"center-along"==c||"esriServerLinePlacementCenterAlong"==c||"center-before"==c||"esriServerLinePlacementCenterBefore"==c||"center-start"==c||"esriServerLinePlacementCenterStart"==c||"center-end"==c||"esriServerLinePlacementCenterEnd"==c?"OnLine":"Above",labelRotation:h,howManyLabels:"OneLabel",hasExpression:f,arcadeExpr:u}}});n("extend-esri")&&f.setObject("layers.LabelLayer",r,h);return r})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),
function(r,f,l,p,c,q){r=r(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(c,f){this._labelLayer=f;this._xmin=c.extent.xmin;this._xmax=c.extent.xmax;this._ymin=c.extent.ymin;this._ymax=c.extent.ymax;this._scale=(this._xmax-this._xmin)/c.width},_process:function(c){this._preparedLabels=
c;this._placedLabels=[];var f;for(c=this._preparedLabels.length-1;0<=c;c--){var h=this._preparedLabels[c],t=Math.min(h.labelWidth,h.labelHeight),e=h.labelWidth+0*t,t=h.labelHeight+0*t,b=(f=h.options)&&void 0!==f.lineLabelPlacement?f.lineLabelPlacement:"PlaceAtCenter",m=f&&void 0!==f.lineLabelPosition?f.lineLabelPosition:"Above",a=f&&void 0!==f.pointPriorities?f.pointPriorities:"AboveRight",g=[2,2,1,3,0,2,3,3,2];"AboveLeft"==a?g=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==a?g=[2,1,2,2,0,2,3,3,3]:"AboveRight"==
a?g=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==a?g=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==a?g=[0,0,0,0,1,0,0,0,0]:"CenterRight"==a?g=[3,2,2,3,0,1,3,2,2]:"BelowLeft"==a?g=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==a?g=[3,3,3,2,0,2,2,1,2]:"BelowRight"==a&&(g=[3,3,2,3,0,2,2,2,1]);var d=f&&void 0!==f.labelRotation?f.labelRotation:!0,a=Math.PI/180*h.angle;f=f&&void 0!==f.howManyLabels?f.howManyLabels:"OneLabel";if("point"==h.geometry.type)this._generatePointPositions(h,h.geometry.x,h.geometry.y,h.text,a,e,t,h.symbolWidth,
h.symbolHeight,g);else if("multipoint"==h.geometry.type)for(b=h.geometry,m=0;m<b.points.length;m++)this._generatePointPositions(h,b.points[m][0],b.points[m][1],h.text,a,e,t,h.symbolWidth,h.symbolHeight,g);else"polyline"==h.geometry.type?this._generateLinePositions(h,h.geometry,h.text,e,t,2*h.symbolHeight+t,b,m,d):"polygon"==h.geometry.type&&this._generatePolygonPositions(h,f,h.geometry,h.text,a,e,t)}return this._placedLabels},_generatePointPositions:function(c,f,h,t,e,b,m,a,g,d){a=(a+b)*this._scale;
g=(g+m)*this._scale;var u,k;for(u=1;3>=u;u++)for(k=1;9>=k;k++)if(d[k-1]==u)switch(k){case 1:if(this._findPlace(c,t,f-a,h+g,e,b,m))return;break;case 2:if(this._findPlace(c,t,f,h+g,e,b,m))return;break;case 3:if(this._findPlace(c,t,f+a,h+g,e,b,m))return;break;case 4:if(this._findPlace(c,t,f-a,h,e,b,m))return;break;case 5:if(this._findPlace(c,t,f,h,e,b,m))return;break;case 6:if(this._findPlace(c,t,f+a,h,e,b,m))return;break;case 7:if(this._findPlace(c,t,f-a,h-g,e,b,m))return;break;case 8:if(this._findPlace(c,
t,f,h-g,e,b,m))return;break;case 9:if(this._findPlace(c,t,f+a,h-g,e,b,m))return}},_generateLinePositions:function(c,f,h,t,e,b,m,a,g){var d=t*this._scale*t*this._scale,u,k,n;for(u=0;u<f.paths.length;u++){var q=f.paths[u],p=q.length,l=Math.floor((p-1)/2),y=0!==(p-1)%2?1:-1;"PlaceAtStart"==m&&(l=0,y=1);"PlaceAtEnd"==m&&(l=p-2,y=-1);for(;0<=l&&l<p-1;){for(k=l;k<p;k++){var w=q[l][0],A=q[l][1],r=q[k][0]-w,E=q[k][1]-A;if(r*r+E*E>d){for(var F=Math.atan2(E,r);F>Math.PI/2;)F-=Math.PI;for(;F<-(Math.PI/2);)F+=
Math.PI;var H=Math.sin(F),L=Math.cos(F),N=0,M=0;"Above"==a&&(N=b*H*this._scale,M=b*L*this._scale);"Below"==a&&(N=-b*H*this._scale,M=-b*L*this._scale);if(1==k-l){if(this._clipLine(w,A,q[k][0],q[k][1])&&(w=this._x1-this._x0,n=this._y1-this._y0,w*w+n*n>d&&(k=Math.atan2(n,w),r=t/2+2*e,A=r*this._scale*Math.cos(k),r=r*this._scale*Math.sin(k),"PlaceAtStart"==m?(w=this._x0+A,n=this._y0+r):"PlaceAtEnd"==m?(w=this._x1-A,n=this._y1-r):(w=this._x0+w/2,n=this._y0+n/2),this._findPlace(c,h,w-N,n+M,g?-k:0,t,e))))return}else{var J=
0;for(n=l;n<=k;n++)J=Math.max(J,Math.abs((q[n][1]-A)*L-(q[n][0]-w)*H));if(J<e&&this._findPlace(c,h,w+r/2-N,A+E/2+M,g?-F:0,t,e))return}break}}l+=y}}},_generatePolygonPositions:function(c,f,h,t,e,b,m){var a;if("ManyLabels"==f)for(f=0;f<h.rings.length;f++)a=h.rings[f],q.prototype.isClockwise(a)&&(a=this._findCentroid(a,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(c,t,a[0],a[1],e,b,m));else{a=this._findCentroidForFeature(h,this._xmin,this._ymin,this._xmax,this._ymax);var g=a[1],d=0;for(f=
0;10>f;f++){d+=m/4;a=this._findCentroidForFeature(h,this._xmin,g+(d-m/4),this._xmax,g+(d+m/4));if(this._findPlace(c,t,a[0],a[1],e,b,m))break;a=this._findCentroidForFeature(h,this._xmin,g-(d+m/4),this._xmax,g-(d-m/4));if(this._findPlace(c,t,a[0],a[1],e,b,m))break}}},_findCentroid:function(c,f,h,t,e){var b=c.length,m=[0,0],a=0,g=c[0][0],d=c[0][1];g>t&&(g=t);g<f&&(g=f);d>e&&(d=e);d<h&&(d=h);for(var u=1;u<b-1;u++){var k=c[u][0],n=c[u][1],q=c[u+1][0],p=c[u+1][1];k>t&&(k=t);k<f&&(k=f);n>e&&(n=e);n<h&&(n=
h);q>t&&(q=t);q<f&&(q=f);p>e&&(p=e);p<h&&(p=h);var l=(k-g)*(p-d)-(q-g)*(n-d);m[0]+=l*(g+k+q);m[1]+=l*(d+n+p);a+=l}m[0]/=3*a;m[1]/=3*a;if(isNaN(m[0])||isNaN(m[1]))return m;h=[];this._fillBuffer(c,h,m);m[0]=this._sortBuffer(h,m[0],f,t);return m},_findCentroidForFeature:function(c,f,h,t,e){for(var b,m=0,a=[0,0],g=0;g<c.rings.length;g++){var d=c.rings[g],u=d.length,k=d[0][0],n=d[0][1];k>t&&(k=t);k<f&&(k=f);n>e&&(n=e);n<h&&(n=h);for(b=1;b<u-1;b++){var q=d[b][0],p=d[b][1],l=d[b+1][0],y=d[b+1][1];q>t&&(q=
t);q<f&&(q=f);p>e&&(p=e);p<h&&(p=h);l>t&&(l=t);l<f&&(l=f);y>e&&(y=e);y<h&&(y=h);var w=(q-k)*(y-n)-(l-k)*(p-n);a[0]+=w*(k+q+l);a[1]+=w*(n+p+y);m+=w}}a[0]/=3*m;a[1]/=3*m;if(isNaN(a[0])||isNaN(a[1]))return a;h=[];for(b=0;b<c.rings.length;b++)this._fillBuffer(c.rings[b],h,a);a[0]=this._sortBuffer(h,a[0],f,t);return a},_fillBuffer:function(c,f,h){for(var k=c.length-1,e=c[0][1]>=c[k][1]?1:-1,b=0;b<=k;b++){var m=b,a=b+1;b==k&&(a=0);var g=c[m][0],m=c[m][1],d=c[a][0],a=c[a][1],u=a>=m?1:-1;if(m<=h[1]&&h[1]<=
a||a<=h[1]&&h[1]<=m)h[1]!=m&&h[1]!=a?(f.push((h[1]-m)*(d-g)/(a-m)+g),e=u):h[1]==m&&h[1]!=a?(e!=u&&f.push(g),e=u):h[1]!=m&&h[1]==a?(f.push(d),e=u):h[1]==m&&h[1]==a&&(1==e&&f.push(g),f.push(d),e=u)}},_sortBuffer:function(c,f,h,t){var e=c.length;c.sort();if(0<e){for(var b=0,m=f=0;m<e-1;m+=2){var a=Math.abs(c[m+1]-c[m]);!(c[m]<=h&&c[m+1]<=h||c[m]>=t&&c[m+1]>=t)&&a>b&&(b=a,f=m)}e=c[f];c=c[f+1];e>t&&(e=t);e<h&&(e=h);c>t&&(c=t);c<h&&(c=h);f=(e+c)/2}return f},_findPlace:function(f,k,h,t,e,b,m){if(isNaN(h)||
isNaN(t))return!1;for(var a=0;a<this._placedLabels.length;a++){var g=this._placedLabels[a].angle,d=this._placedLabels[a].width*this._scale,u=this._placedLabels[a].height*this._scale,n=this._placedLabels[a].x-h,p=this._placedLabels[a].y-t;if(0===e&&0===g){if(this._findPlace2(-b*this._scale,-m*this._scale,b*this._scale,m*this._scale,n-d,p-u,n+d,p+u))return!1}else{var l=new c(-b*this._scale,-m*this._scale,b*this._scale,m*this._scale,null),C=0,D=1;0!==e&&(C=Math.sin(e),D=Math.cos(e));var y=n*D-p*C,n=
n*C+p*D,g=g-e,C=Math.sin(g),D=Math.cos(g),w=-d*D- -u*C,p=-d*C+-u*D,g=+d*D- -u*C,A=+d*C+-u*D,d=y+w,u=n-p,C=y+g,D=n-A,w=y-w,p=n+p,y=y-g,n=n+A,g=new q;g.addRing([[d,u],[C,D],[w,p],[y,n],[d,u]]);if(l.intersects(g))return!1}}for(;e>Math.PI/2;)e-=Math.PI;for(;e<-(Math.PI/2);)e+=Math.PI;a={};a.layer=f;a.text=k;a.angle=e;a.x=h;a.y=t;a.width=b;a.height=m;this._placedLabels.push(a);return!0},_findPlace2:function(c,f,h,t,e,b,m,a){return(c>=e&&c<=m||h>=e&&h<=m||c<=e&&h>=m)&&(f>=b&&f<=a||t>=b&&t<=a||f<=b&&t>=
a)?!0:!1},_clipLine:function(c,f,h,t){for(var e=this._code(c,f),b=this._code(h,t);0!==e||0!==b;){if(0!==(e&b))return!1;var m=h-c,a=t-f;0!==e?(c<this._xmin?(f+=a*(this._xmin-c)/m,c=this._xmin):c>this._xmax?(f+=a*(this._xmax-c)/m,c=this._xmax):f<this._ymin?(c+=m*(this._ymin-f)/a,f=this._ymin):f>this._ymax&&(c+=m*(this._ymax-f)/a,f=this._ymax),e=this._code(c,f)):(h<this._xmin?(t+=a*(this._xmin-h)/m,h=this._xmin):h>this._xmax?(t+=a*(this._xmax-h)/m,h=this._xmax):t<this._ymin?(h+=m*(this._ymin-t)/a,t=
this._ymin):t>this._ymax&&(h+=m*(this._ymax-t)/a,t=this._ymax),b=this._code(h,t))}this._x0=c;this._y0=f;this._x1=h;this._y1=t;return!0},_code:function(c,f){var h=0;c<this._xmin&&(h+=8);c>this._xmax&&(h+=4);f<this._ymin&&(h+=2);f>this._ymax&&(h+=1);return h}});l("extend-esri")&&f.setObject("layers.labelLayerUtils.DynamicLabelClass",r,p);return r})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),
function(r,f,l,p,c,q,n){return r(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(c,h){this._labelLayer=h;this._map=c;this._xmin=c.extent.xmin;this._xmax=c.extent.xmax;this._ymin=c.extent.ymin;this._ymax=c.extent.ymax;this._scale=
(this._xmax-this._xmin)/c.width},_process:function(c){var h,f,e,b,m,a,g,d,u;this._preparedLabels=c;this._placedLabels=[];for(c=this._preparedLabels.length-1;0<=c;c--){h=this._preparedLabels[c];m=h.labelWidth;a=h.labelHeight;d=(g=h.options)&&g.lineLabelPlacement?g.lineLabelPlacement:"PlaceAtCenter";u=g&&g.lineLabelPosition?g.lineLabelPosition:"Above";f=g&&g.labelRotation?g.labelRotation:!0;e=Math.PI/180*h.angle;b=g&&g.howManyLabels?g.howManyLabels:"OneLabel";var k=[];if("point"===h.geometry.type)this._generatePointPositions(h.geometry.x,
h.geometry.y,h.text,e,m,a,h.symbolWidth,h.symbolHeight,g,k);else if("multipoint"===h.geometry.type)for(f=0;f<h.geometry.points.length;f++)this._generatePointPositions(h.geometry.points[f][0],h.geometry.points[f][1],h.text,e,m,a,h.symbolWidth,h.symbolHeight,g,k);else if("polyline"===h.geometry.type)if("PlaceAtStart"===d)this._generateLinePositionsPlaceAtStart(h.geometry,!0,h.text,m,a,2*h.symbolHeight+a,d,u,f,k);else if("PlaceAtEnd"===d)this._generateLinePositionsPlaceAtEnd(h.geometry,!0,h.text,m,a,
2*h.symbolHeight+a,d,u,f,k);else{g=[];var p=h.geometry.getExtent(),l=this._map.extent;if(p.getWidth()<m*this._scale/this._OVERRUN&&p.getHeight()<m*this._scale/this._OVERRUN)continue;else.5*p.getWidth()<l.getWidth()&&.5*p.getHeight()<l.getHeight()?this._generateLinePositionsPlaceAtCenter(h.geometry,!1,.1*Math.min(this._map.width,this._map.height)*this._scale,h.text,m,a,2*h.symbolHeight+a,d,u,f,g):this._generateLinePositionsPlaceAtCenter(h.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,
h.text,m,a,2*h.symbolHeight+a,d,u,f,g);this._postSorting(l,g,k)}else if("polygon"===h.geometry.type){d=[];for(f=0;f<h.geometry.rings.length;f++)u=h.geometry.rings[f],1<h.geometry.rings.length&&!n.prototype.isClockwise(u)||(g=this._calcRingExtent(u),g.xmax-g.xmin<4*m*this._scale/this._OVERRUN&&g.ymax-g.ymin<4*a*this._scale/this._OVERRUN||d.push(u));d.sort(function(a,d){return d.length-a.length});for(f=0;f<d.length;f++)this._generatePolygonPositionsForManyLabels(d[f],h.geometry.spatialReference,h.text,
e,m,a,k)}for(f=0;f<k.length&&(d=k[f].x,u=k[f].y,void 0!==k[f].angle&&(e=k[f].angle),g=this._findPlace(h,h.text,d,u,e,m,a),"OneLabel"!==b||!g||!this._labelLayer._isWithinScreenArea(new q(d,u,h.geometry.spatialReference)));f++);}return this._placedLabels},_generatePointPositions:function(c,h,f,e,b,m,a,g,d,u){f=d&&d.pointPriorities?d.pointPriorities:"AboveRight";b=(a+b)*this._scale;m=(g+m)*this._scale;switch(f.toLowerCase()){case "aboveleft":c-=b;h+=m;break;case "abovecenter":h+=m;break;case "aboveright":c+=
b;h+=m;break;case "centerleft":c-=b;break;case "centercenter":break;case "centerright":c+=b;break;case "belowleft":c-=b;h-=m;break;case "belowcenter":h-=m;break;case "belowright":c+=b;h-=m;break;default:return}u.push({x:c,y:h})},_generateLinePositionsPlaceAtStart:function(c,h,f,e,b,m,a,g,d,u){a=e*this._scale;var k=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,t,n,q,p,l,w,A,r;for(t=0;t<c.paths.length;t++){var E=c.paths[t],F=a,H=0;for(n=0;n<E.length-1;n++)q=E[n][0],p=
E[n][1],l=E[n+1][0],w=E[n+1][1],A=l-q,r=w-p,A=Math.sqrt(A*A+r*r),H+A>F?(H=this._generatePositionsOnLine(c.spatialReference,h,F,k,H,q,p,l,w,f,e,b,m,g,d,u),F=k):H+=A}},_generateLinePositionsPlaceAtEnd:function(c,h,f,e,b,m,a,g,d,u){a=e*this._scale;var k=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,t,n,q,p,l,w,A,r;for(t=0;t<c.paths.length;t++){var E=c.paths[t],F=a,H=0;for(n=E.length-2;0<=n;n--)q=E[n+1][0],p=E[n+1][1],l=E[n][0],w=E[n][1],A=l-q,r=w-p,A=Math.sqrt(A*A+r*r),
H+A>F?(H=this._generatePositionsOnLine(c.spatialReference,h,F,k,H,q,p,l,w,f,e,b,m,g,d,u),F=k):H+=A}},_generateLinePositionsPlaceAtCenter:function(c,h,f,e,b,m,a,g,d,u,n){var k,t,v,q,p,w,l,r;for(g=0;g<c.paths.length;g++){var E=c.paths[g];if(!(2>E.length)){if(2==E.length){q=E[0];k=E[1];v=q[0];q=q[1];E=k[0];w=k[1];p=(E-v)*(E-v)+(w-q)*(w-q);l=Math.atan2(w-q,E-v);w=Math.cos(l);l=Math.sin(l);E=[];r=v;for(var F=q;(r-v)*(r-v)+(F-q)*(F-q)<p;)E.push([r,F]),r+=f/2*w,F+=f/2*l;E.push(k)}var H=0;for(k=0;k<E.length-
1;k++)v=E[k][0],q=E[k][1],p=E[k+1][0],w=E[k+1][1],l=p-v,r=w-q,H+=Math.sqrt(l*l+r*r);for(k=F=0;k<E.length-1;k++){v=E[k][0];q=E[k][1];p=E[k+1][0];w=E[k+1][1];l=p-v;r=w-q;l=Math.sqrt(l*l+r*r);if(F+l>H/2)break;F+=l}k==E.length-1&&k--;v=E[k][0];q=E[k][1];p=E[k+1][0];w=E[k+1][1];l=p-v;r=w-q;F=H/2-F;l=Math.atan2(r,l);r=v+F*Math.cos(l);l=q+F*Math.sin(l);v=this._angleAndShifts(v,q,p,w,a,d,u);n.push({x:r+v.shiftX,y:l+v.shiftY,angle:v.angle});var H=r,L=l,F=0;for(t=k;t<E.length-1;t++)t==k?(v=H,q=L):(v=E[t][0],
q=E[t][1]),p=E[t+1][0],w=E[t+1][1],l=p-v,r=w-q,l=Math.sqrt(l*l+r*r),F=F+l>f?this._generatePositionsOnLine(c.spatialReference,h,f,f,F,v,q,p,w,e,b,m,a,d,u,n):F+l;F=0;for(t=k;0<=t;t--)t==k?(v=H,q=L):(v=E[t+1][0],q=E[t+1][1]),p=E[t][0],w=E[t][1],l=p-v,r=w-q,l=Math.sqrt(l*l+r*r),F=F+l>f?this._generatePositionsOnLine(c.spatialReference,h,f,f,F,v,q,p,w,e,b,m,a,d,u,n):F+l}}},_generatePositionsOnLine:function(f,h,t,e,b,m,a,g,d,u,n,q,p,l,D,y){u=Math.atan2(d-a,g-m);n=m;q=a;var k=n,v=q;do if(b=t-b,n+=b*Math.cos(u),
q+=b*Math.sin(u),this._belongs(n,q,m,a,g,d))b=this._angleAndShifts(m,a,g,d,p,l,D),t=n+b.shiftX,v=q+b.shiftY,h?this._labelLayer._isWithinScreenArea(new c(t,v,t,v,f))&&y.push({x:t,y:v,angle:b.angle}):y.push({x:t,y:v,angle:b.angle}),k=n,v=q,b=0,t=e;else return f=g-k,d-=v,Math.sqrt(f*f+d*d);while(1)},_postSorting:function(c,h,f){if(c&&0<h.length){var e=.5*(c.xmin+c.xmax);c=.5*(c.ymin+c.ymax);for(var b=h[0].x,m=h[0].y,a=Math.sqrt((b-e)*(b-e)+(m-c)*(m-c)),g=h[0].angle,d=0;d<h.length;d++){var u=h[d].x,k=
h[d].y,t=Math.sqrt((u-e)*(u-e)+(k-c)*(k-c));t<a&&(b=u,m=k,a=t,g=h[d].angle)}f.push({x:b,y:m,angle:g})}},_belongs:function(c,h,f,e,b,m){if(b==f&&m==e)return!1;if(b>f){if(c>b||c<f)return!1}else if(c<b||c>f)return!1;if(m>e){if(h>m||h<e)return!1}else if(h<m||h>e)return!1;return!0},_angleAndShifts:function(c,h,f,e,b,m,a){for(c=Math.atan2(e-h,f-c);c>Math.PI/2;)c-=Math.PI;for(;c<-(Math.PI/2);)c+=Math.PI;e=Math.sin(c);var g=Math.cos(c);f=h=0;"Above"==m&&(h=b*e*this._scale,f=b*g*this._scale);"Below"==m&&(h=
-b*e*this._scale,f=-b*g*this._scale);b=[];b.angle=a?-c:0;b.shiftX=-h;b.shiftY=f;return b},_generatePolygonPositionsForManyLabels:function(c,h,f,e,b,m,a){b=this._findCentroidForRing(c);e=b[0];var g=b[1],d=this._calcRingExtent(c);b=d.xmin;m=d.ymin;var u=d.xmax,d=d.ymax,k=(d-m)/(this._map.height*this._scale);if(!(10<(u-b)/(this._map.width*this._scale)&&10<k)){var t=!0;if(u-b>this._map.width*this._scale||d-m>this._map.height*this._scale)t=!1;var k=this._map.width*this._scale*(t?.1875:.5),t=this._map.height*
this._scale*(t?.1875:.5),n=!0,q=!0,p=0;do{g+=(p%2?-1:1)*p*t;if(this._scanRingByX(f,h,c,e,g,b,u,k,a))break;g<m&&(n=!1);g>d&&(q=!1);p++}while(n||q)}},_scanRingByX:function(f,h,t,e,b,m,a,g,d){var u=!0,k=!0,n=0,q=1E3;do{e+=(n%2?-1:1)*n*g;var p=this._movePointInsideRing(t,e,b),l=this._labelLayer._isWithinScreenArea(new c(p,b,p,b,h)),y=this._isPointWithinRing(f,t,p,b);if(l&&y)return d.push({x:p,y:b}),!0;e<m&&(u=!1);e>a&&(k=!1);n++;q--;if(0>=q)return!0}while(u||k);return!1},_movePointInsideRing:function(c,
h,f){for(var e=[],b=c.length-1,m=c[0][1]>=c[b][1]?1:-1,a=0;a<=b;a++){var g=a,d=a+1;a==b&&(d=0);var u=c[g][0],g=c[g][1],k=c[d][0],d=c[d][1],t=d>=g?1:-1;if(g<=f&&f<=d||d<=f&&f<=g)f!=g&&f!=d?(e.push((f-g)*(k-u)/(d-g)+u),m=t):f==g&&f!=d?(m!=t&&e.push(u),m=t):f!=g&&f==d?(e.push(k),m=t):f==g&&f==d&&(1==m&&e.push(u),e.push(k),m=t)}e.sort(function(a,d){return a-d});c=e.length;if(0<c){for(a=f=h=0;a<c-1;a+=2)b=Math.abs(e[a+1]-e[a]),b>h&&(h=b,f=a);h=(e[f]+e[f+1])/2}return h},_calcRingExtent:function(f){var h,
k;k=new c;for(h=0;h<f.length-1;h++){var e=f[h][0],b=f[h][1];if(void 0===k.xmin||e<k.xmin)k.xmin=e;if(void 0===k.ymin||b<k.ymin)k.ymin=b;if(void 0===k.xmax||e>k.xmax)k.xmax=e;if(void 0===k.ymax||b>k.ymax)k.ymax=b}return k},_isPointWithinPolygon:function(c,h,f,e){var b;for(b=0;b<h.rings.length;b++)if(this._isPointWithinRing(c,h.rings[b],f,e))return!0;return!1},_isPointWithinRing:function(c,h,f,e){var b,m,a,g,d=[],u=h.length;for(c=0;c<u-1;c++)if(b=h[c][0],m=h[c][1],a=h[c+1][0],g=h[c+1][1],b!=a||m!=g){if(m==
g)if(e==m)d.push(b);else continue;b==a?(m<g&&e>=m&&e<g&&d.push(b),m>g&&e<=m&&e>g&&d.push(b)):(m=(a-b)/(g-m)*(e-m)+b,b<a&&m>=b&&m<a&&d.push(m),b>a&&m<=b&&m>a&&d.push(m))}d.sort(function(a,d){return a-d});for(c=0;c<d.length-1;c++)if(b=d[c],a=d[c+1],f>=b&&f<a)if(c%2)break;else return!0;return!1},_findCentroidForRing:function(c){for(var h=c.length,f=[0,0],e=0,b=c[0][0],m=c[0][1],a=1;a<h-1;a++){var g=c[a][0],d=c[a][1],u=c[a+1][0],k=c[a+1][1],n=(g-b)*(k-m)-(u-b)*(d-m);f[0]+=n*(b+g+u);f[1]+=n*(m+d+k);e+=
n}f[0]/=3*e;f[1]/=3*e;return f},_findCentroidForFeature:function(c){for(var h=0,f=[0,0],e=0;e<c.rings.length;e++)for(var b=c.rings[e],m=b.length,a=b[0][0],g=b[0][1],d=1;d<m-1;d++){var u=b[d][0],k=b[d][1],n=b[d+1][0],q=b[d+1][1],p=(u-a)*(q-g)-(n-a)*(k-g);f[0]+=p*(a+u+n);f[1]+=p*(g+k+q);h+=p}f[0]/=3*h;f[1]/=3*h;return f},_findPlace:function(f,h,t,e,b,m,a){if(isNaN(t)||isNaN(e))return!1;for(var g=0;g<this._placedLabels.length;g++){var d=this._placedLabels[g].angle,u=this._placedLabels[g].width*this._scale,
k=this._placedLabels[g].height*this._scale,q=this._placedLabels[g].x-t,p=this._placedLabels[g].y-e;if(0===b&&0===d){if(this._findPlace2(-m*this._scale,-a*this._scale,m*this._scale,a*this._scale,q-u,p-k,q+u,p+k))return!1}else{var l=new c(-m*this._scale,-a*this._scale,m*this._scale,a*this._scale,null),D=0,y=1;0!==b&&(D=Math.sin(b),y=Math.cos(b));var w=q*y-p*D,q=q*D+p*y,d=d-b,D=Math.sin(d),y=Math.cos(d),r=-u*y- -k*D,p=-u*D+-k*y,d=+u*y- -k*D,G=+u*D+-k*y,u=w+r,k=q-p,D=w+d,y=q-G,r=w-r,p=q+p,w=w-d,q=q+G,
d=new n;d.addRing([[u,k],[D,y],[r,p],[w,q],[u,k]]);if(l.intersects(d))return!1}}for(;b>Math.PI/2;)b-=Math.PI;for(;b<-(Math.PI/2);)b+=Math.PI;g={};g.layer=f;g.text=h;g.angle=b;g.x=t;g.y=e;g.width=m;g.height=a;this._placedLabels.push(g);return!0},_findPlace2:function(c,h,f,e,b,m,a,g){return(c>=b&&c<=a||f>=b&&f<=a||c<=b&&f>=a)&&(h>=m&&h<=g||e>=m&&e<=g||h<=m&&e>=g)?!0:!1}})})},"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/Deferred dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/utils ../symbols/jsonUtils ../renderers/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C,D,y,w,A,G,E,F,H,L,N,M,J,K,O,Q,P,R,I,V,X,T,Y){var Z=E.getClassValuesForRelationship(),ba={defaultShape:{type:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15"},stroke:{width:1,color:"#555555"}},W={HH:315,HL:45,LL:135,LH:225},aa=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,S=f([T,v],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new n([64,
64,64]),defaultText:"Aa",sizeRampLightColor:new n([255,255,255]),sizeRampDarkColor:new n([128,128,128]),gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,_preserveCacheOnDestroy:!1,_layerConnects:null,_mapConnects:null,constructor:function(a,d){l.mixin(this,Y.widgets.legend);this._i18n=Y.widgets.legend;a=a||{};a.map?d?(this.map=a.map,this.layerInfos=a.layerInfos,this._respectCurrentMapScale=!1===a.respectCurrentMapScale?
!1:!0,this._respectVisibility=!1===a.respectVisibility?!1:!0,this._preserveCacheOnDestroy=a.preserveCacheOnDestroy?!0:!1,this.arrangement=a.arrangement===S.ALIGN_RIGHT?S.ALIGN_RIGHT:S.ALIGN_LEFT,this.arrangement===S.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===a.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={},this.refresh=k(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},
postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],d,b;for(d=0;d<a.length;d+=1)b=a[d],r.locale&&-1!==r.locale.indexOf(b)&&(-1!==r.locale.indexOf("-")?-1!==r.locale.indexOf(b+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},
startup:function(){this.inherited(arguments);this._initialize();9>h("ie")&&(this._repaintItems=l.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeCachedLegendResponses();this._removeHoverHandlers();this.inherited(arguments)},_removeCachedLegendResponses:function(){this._preserveCacheOnDestroy||p.forEach(this.layers,function(a){delete a.legendResponse})},refresh:function(a){if(this.domNode){a?(this.layerInfos=a,this.layers=
[],p.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(a=
this.domNode.children.length-1;0<=a;a--)g.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],p.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):
this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],d=[];p.forEach(this.map.layerIds,function(b){b=this.map.getLayer(b);var e;this._isSupportedLayerType(b)&&(b.arcgisProps&&b.arcgisProps.title&&(b._titleForLegend=b.arcgisProps.title),this.layers.push(b));"esri.layers.KMLLayer"==b.declaredClass&&
(e=b.getLayers(),p.forEach(e,function(d){a.push(d.id)},this));"esri.layers.GeoRSSLayer"==b.declaredClass&&(e=b.getFeatureLayers(),p.forEach(e,function(a){d.push(a.id)},this))},this);p.forEach(this.map.graphicsLayerIds,function(b){var e=this.map.getLayer(b);-1==p.indexOf(a,b)&&-1==p.indexOf(d,b)&&this._isSupportedLayerType(e)&&this._isLayerDrawingEnabled(e)&&(e.arcgisProps&&e.arcgisProps.title&&(e._titleForLegend=e.arcgisProps.title),this.layers.push(e))},this)}this._createLegend()},_isLayerDrawingEnabled:function(a){return a&&
(a._params&&a._params.drawMode||a.isFeatureReductionActive&&a.isFeatureReductionActive())},_activate:function(){this._deactivate();if(this.autoUpdate){this._mapConnects=[];this._layerConnects={};var a=this._mapConnects;this._respectCurrentMapScale&&a.push(c.connect(this.map,"onZoomEnd",this,"_refreshLayers"));this.useAllMapLayers&&(a.push(c.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers")),a.push(c.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers")),a.push(c.connect(this.map,"onLayersReordered",
this,"_updateAllMapLayers")));p.forEach(this.layers,function(a){var d=[c.connect(a,"onFeatureReductionRendererChange",this,"_refreshLayers"),c.connect(a,"onFeatureReductionChange",this,"_refreshLayers"),c.connect(a,"onVisibilityChange",this,"_refreshLayers"),c.connect(a,"onOpacityChange",this,"_refreshLayers"),c.connect(a,"onScaleRangeChange",this,"_refreshLayers")];"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&d.push(c.connect(a,"_onDynamicLayersChange",l.hitch(this,
"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(d.push(c.connect(a,"onRenderingChange",l.partial(this._updateImageServiceLayers,this,a))),d.push(c.connect(a,"onRendererChange",l.partial(this._updateImageServiceLayers,this,a))));("esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||a.setWebGLEnabled)&&d.push(c.connect(a,"onRendererChange",l.hitch(this,"_refreshLayers")));this._layerConnects[a.id]=d},this)}},_deactivate:function(){p.forEach(this._mapConnects,
function(a){c.disconnect(a)});p.forEach(this.layers,function(a){var d=this._layerConnects;d&&p.forEach(d[a.id],function(a){c.disconnect(a)})},this);this._mapConnects=this._layerConnects=null},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,d){delete d.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];p.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);
this._isSupportedLayerType(a)&&this.layers.push(a)},this);p.forEach(this.map.graphicsLayerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this._isLayerDrawingEnabled(a)&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var e=!1,m=!1;d.set(this.domNode,"position","relative");g.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var h=[];p.forEach(this.layers,function(a){if("esri.layers.KMLLayer"==
a.declaredClass||"esri.layers.GeoRSSLayer"==a.declaredClass){var d;a.loaded?("esri.layers.KMLLayer"==a.declaredClass?d=a.getLayers():"esri.layers.GeoRSSLayer"==a.declaredClass&&(d=a.getFeatureLayers(),this.hideLayersInLegend[a.id]&&(d=p.filter(d,function(d){return-1==p.indexOf(this.hideLayersInLegend[a.id],d.id)},this))),p.forEach(d,function(d){"esri.layers.FeatureLayer"==d.declaredClass&&a._titleForLegend&&(d._titleForLegend=a._titleForLegend+" - ","esriGeometryPoint"==d.geometryType?d._titleForLegend+=
this.NLS_points:"esriGeometryPolyline"==d.geometryType?d._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==d.geometryType&&(d._titleForLegend+=this.NLS_areas),h.push(d))},this)):c.connect(a,"onLoad",l.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===a.declaredClass)if(!a.loaded)c.connect(a,"onLoad",l.hitch(this,function(){this.refresh(this.layerInfos)}));else{if((!this._respectVisibility||this._respectVisibility&&a.visible)&&0<a.layerInfos.length&&p.some(a.layerInfos,
function(a){return a.legendURL})){var b=!1;p.forEach(a.layerInfos,function(d){if(d.legendURL&&-1<p.indexOf(a.visibleLayers,d.name)){b||(g.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(a._titleForLegend||a.name||a.id)+"\x3c/span\x3e"},this.domNode),b=!0);var c;d=d.legendURL;if(a.customParameters||a.customLayerParameters){var m=l.clone(a.customParameters||{});l.mixin(m,a.customLayerParameters||{});for(c in m)d+=(-1===d.indexOf("?")?"?":"\x26")+c+"\x3d"+m[c]}g.create("div",
{innerHTML:"\x3cimg src\x3d'"+d+"'/\x3e"},this.domNode);e=!0}},this)}}else"esri.layers.WFSLayer"!==a.declaredClass||a.renderer?h.push(a):(d=g.create("div",{id:this.id+"_"+a.id,"class":"esriLegendService"}),g.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},g.create("td",{align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%"},d))))),g.place(d,this.id,"first"),d=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},
d),d=g.create("tbody",{},d),"esriGeometryComplex"===a.geometryType?(this._buildRow_Renderer(a,a._pointSymbol,null,this.NLS_points,null,d),this._buildRow_Renderer(a,a._lineSymbol,null,this.NLS_lines,null,d),this._buildRow_Renderer(a,a._polygonSymbol,null,this.NLS_areas,null,d)):"esriGeometryPoint"===a.geometryType?this._buildRow_Renderer(a,a._pointSymbol,null,"",null,d):"esriGeometryPolyline"===a.geometryType?this._buildRow_Renderer(a,a._lineSymbol,null,"",null,d):"esriGeometryPolygon"===a.geometryType&&
this._buildRow_Renderer(a,a._polygonSymbol,null,"",null,d),m=!0)},this);var f=[];p.forEach(h,function(a){if(!a.loaded)var d=c.connect(a,"onLoad",this,function(a){c.disconnect(d);d=null;this.refresh()});else if((!this._respectVisibility||this._respectVisibility&&a.visible)&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var b=g.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});g.create("span",{innerHTML:this._getServiceTitle(a),
"class":"esriLegendServiceLabel"},g.create("td",{align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%"},b)))));g.place(b,this.id,"first");a.legendResponse||a.renderer&&"esri.renderer.StretchRenderer"!==a.renderer.declaredClass||a.renderer&&"esri.renderer.StretchRenderer"===a.renderer.declaredClass&&1===a.bandCount?this._createLegendForLayer(a):this.isHostedTileService(a)?this._getLayerInfos(a).then(l.hitch(this,function(a){this._createLegendForLayer(a)}),l.hitch(this,
function(a){f.push(this._legendRequest(a))})):f.push(this._legendRequest(a))}},this);0!==f.length||e||m?(new b(f)).addCallback(l.hitch(this,function(d){e||m?a.byId(this.id+"_msg").innerHTML="":a.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()})):(a.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate())},_createLegendForLayer:function(b){if(b.legendResponse||b.renderer||this.isHostedTileService(b)){var e=!1;if(b.legendResponse||this.isHostedTileService(b)){var g=b.dynamicLayerInfos||
b.layerInfos;g&&g.length?p.forEach(g,function(a,d){this.hideLayersInLegend[b.id]&&-1!==p.indexOf(this.hideLayersInLegend[b.id],a.id)||(a=this._buildLegendItems(b,a,d),e=e||a)},this):"esri.layers.ArcGISImageServiceLayer"==b.declaredClass&&(e=this._buildLegendItems(b,{id:0,name:null,title:b.name,subLayerIds:null,parentLayerId:-1},0))}else b.renderer&&(g=b.url?b.url.substring(b.url.lastIndexOf("/")+1,b.url.length):"fc_"+b.id,e=this._buildLegendItems(b,{id:g,name:null,subLayerIds:null,parentLayerId:-1},
0));e&&(d.set(a.byId(this.id+"_"+b.id),"display","block"),d.set(a.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);c.connect(a,"onLoad",l.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var d=a.url,b=d.indexOf("?"),d=-1<b?d.substring(0,b)+"/legend"+d.substring(b):d+"/legend";(b=a._getToken())&&(d+="?token\x3d"+b);var e=l.hitch(this,"_processLegendResponse"),g={f:"json"};
a._params.dynamicLayers&&(g.dynamicLayers=m.stringify(this._createDynamicLayers(a)),"[{}]"===g.dynamicLayers&&(g.dynamicLayers="[]"));a._params.bandIds&&(g.bandIds=a._params.bandIds);a._params.renderingRule?g.renderingRule=a._params.renderingRule:a.rasterFunctionInfos&&0<a.rasterFunctionInfos.length&&p.forEach(a.rasterFunctionInfos,function(a){a&&a.name&&"none"===a.name.toLowerCase()&&(g.renderingRule=m.stringify({rasterFunction:a.name}))});return w({url:d,content:g,callbackParamName:"callback",load:function(d,
b){e(a,d,b)},error:y.defaults.io.errorHandler})},_legendRequestTools:function(a){var d=a.url.toLowerCase().indexOf("/rest/"),d=a.url.substring(0,d)+a.url.substring(d+5,a.url.length),d=this._legendUrl+"?soapUrl\x3d"+window.escape(d);if(!h("ie")||8<h("ie"))d+="\x26returnbytes\x3dtrue";var b=l.hitch(this,"_processLegendResponse");return w({url:d,content:{f:"json"},callbackParamName:"callback",load:function(d,e){b(a,d,e)},error:y.defaults.io.errorHandler})},_processLegendResponse:function(d,b){b&&b.layers?
(d.legendResponse=b,a.byId(this.id+"_"+d.id)&&g.empty(a.byId(this.id+"_"+d.id)),g.create("span",{innerHTML:this._getServiceTitle(d),"class":"esriLegendServiceLabel"},g.create("td",{align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%"},a.byId(this.id+"_"+d.id)))))),this._createLegendForLayer(d)):console.log("Legend could not get generated for "+d.url+": "+q.toJson(b))},_buildLegendItems:function(d,b,e){var c=!1,m=a.byId(this.id+"_"+d.id),h=b.parentLayerId;if(b.subLayerIds)d=
g.create("div",{id:this.id+"_"+d.id+"_"+b.id+"_group",style:{display:"none"},"class":-1==h?0<e?"esriLegendGroupLayer":"":this._legendAlign},-1==h?m:a.byId(this.id+"_"+d.id+"_"+h+"_group")),g.create("td",{innerHTML:C.encode(b.name),align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%","class":"esriLegendLayerLabel"},d))));else{if(this._respectVisibility&&d.visibleLayers)if(e=d.dynamicLayerInfos||d.layerInfos)if(d._params&&d._params.layers){if(-1===p.indexOf(d.visibleLayers,
b.id))return c}else{if(e=this._getReallyVisibleLayers(e,d.visibleLayers),-1===p.indexOf(e,b.id))return c}else if(-1===p.indexOf(d.visibleLayers,b.id))return c;m=g.create("div",{id:this.id+"_"+d.id+"_"+b.id,style:{display:"none"},"class":-1<h?this._legendAlign:""},-1==h?m:a.byId(this.id+"_"+d.id+"_"+h+"_group"));g.create("td",{innerHTML:C.encode(b.name)||"",align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%","class":"esriLegendLayerLabel"},m))));e=d.dynamicLayerInfos||
d.layerInfos;h=!1;e&&e.length&&(h=p.some(e,function(a){return!!a.drawingInfo}));if(d.legendResponse)c=c||this._buildLegendItems_Tools(d,b,m);else if(d.renderer||h)c=c||this._buildLegendItems_Renderer(d,b,m)}return c},_getReallyVisibleLayers:function(a,d){if(!a||!d||!d.length)return[];var b=[],e=[],g;for(g=0;g<a.length;g++)if(a[g].subLayerIds){if(-1===p.indexOf(d,a[g].id)||-1<p.indexOf(e,a[g].id))e=e.concat(a[g].subLayerIds)}else-1<p.indexOf(d,a[g].id)&&-1===p.indexOf(e,a[g].id)&&b.push(a[g].id);return b},
_buildLegendItems_Tools:function(b,e,c){var m=e.parentLayerId,h=this.map.getScale(),f=!1,u=function(a,d){var b,e;for(b=0;b<a.length;b++)if(d.dynamicLayerInfos)for(e=0;e<d.dynamicLayerInfos[e].length;e++){if(d.dynamicLayerInfos[e].mapLayerId==a[b].layerId)return a[b]}else if(d.id==a[b].layerId)return a[b];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(b,e,h)){var k=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===b.declaredClass||
"esri.layers.ArcGISMapServiceLayer"===b.declaredClass)){var t=this._getEffectiveScale(b,e);if(t.minScale&&t.minScale<h||t.maxScale&&t.maxScale>h)k=!1}if(k){var h=u(b.legendResponse.layers,e),n=h.legendType,v=h.layerType,q=h.legend;if(q){"esri.layers.ArcGISImageServiceLayer"!==b.declaredClass&&this._sanitizeLegendResponse(b,h,e);c=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);var w=g.create("tbody",{},c);(b._hoverLabel||b._hoverLabels)&&this._createHoverAction(c,
b,e);var l=[];p.forEach(q,function(a){if(!(10.1<=b.version&&!a.values&&1<q.length)||!b._hideDefaultSymbol&&"\x3call other values\x3e"!==a.label&&(a.label||"esri.layers.ArcGISImageServiceLayer"===b.declaredClass&&10.3<=b.version||"Raster Layer"===v)){var d=a.label;if(a.url&&0===a.url.indexOf("http")||a.imageData&&0<a.imageData.length)f=!0,d&&-1!==p.indexOf(l,d)||(l.push(d),this._buildRow_Tools(a,w,b,e.id,n))}},this)}}}f&&(d.set(a.byId(this.id+"_"+b.id+"_"+e.id),"display","block"),-1<m&&(d.set(a.byId(this.id+
"_"+b.id+"_"+m+"_group"),"display","block"),this._findParentGroup(b.id,b,m)));return f},_getLayerInfos:function(a){var d=new e,b=a.dynamicLayerInfos||a.layerInfos;if(b&&b.length)if(p.some(b,function(a){return!!a.drawingInfo}))d.resolve(a);else{var g=a.url,c=g.indexOf("?"),g=-1==c?g+"/layers":g.substring(0,c)+"/layers"+g.substring(c,g.length);w({url:g,content:{f:"json"},callbackParamName:"callback",load:function(e,g){e.layers?(p.forEach(b,function(a){var d=p.filter(e.layers,function(d){return a.source?
d.id===a.source.mapLayerId:d.id===a.id});d&&d[0]&&d[0].drawingInfo&&(a.drawingInfo=d[0].drawingInfo,a.fields=d[0].fields)}),d.resolve(a)):d.reject(a)},error:function(b){d.reject(a)}})}return d},_sanitizeLegendResponse:function(a,d,b){var e=d.legend;if(10.1<=a.version&&1<e.length&&!d._sanitized){a=l.getObject("layerDefinition.drawingInfo.renderer",!1,b);var g,c;a||(a=l.getObject("drawingInfo.renderer",!1,b));p.some(e,function(a){if(a.values)return!0})&&p.some(e,function(a,d){a.values||(c=d,g=a);return!!g});
a?"uniqueValue"===a.type?g&&(e.splice(c,1),e.push(g)):"classBreaks"===a.type&&(g&&e.splice(c,1),e.reverse(),g&&e.push(g)):g&&(e.splice(c,1),e.push(g));d._sanitized=!0}},_buildRow_Tools:function(a,d,b,e,c){var m=g.create("tr",{},d),f;this.alignRight?(d=g.create("td",{align:this._isRightToLeft?"left":"right"},m),f=g.create("td",{align:this._isRightToLeft?"left":"right",width:35},m)):(f=g.create("td",{width:35,align:"center"},m),d=g.create("td",{},m));m=a.url;(!h("ie")||9<=h("ie")||9>h("ie")&&"esri.layers.ArcGISImageServiceLayer"===
b.declaredClass)&&a.imageData&&0<a.imageData.length?m="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(m=b.url+"/"+e+"/images/"+a.url,(e=b._getToken())&&(m+="?token\x3d"+e));e=g.create("img",{src:m,border:0,style:"opacity:"+b.opacity},f);a=g.create("td",{innerHTML:C.encode(a.label),align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%",dir:"ltr"},d))));c&&"Stretched"===c&&10.3<=b.version&&"esri.layers.ArcGISImageServiceLayer"===b.declaredClass&&(a.style.verticalAlign=
"top",a.style.lineHeight="1",e.style.marginBottom="-1px",e.style.display="block",d.style.verticalAlign="top");9>h("ie")&&(e.style.filter="alpha(opacity\x3d"+100*b.opacity+")")},_getVariable:function(a,d,b){var e;a&&(e=(a=a.getVisualVariablesForType(d,b))&&a[0]);return e},_getVariables:function(a,d,b){a=[this._getVariable(a,"colorInfo",!1),this._getVariable(a,"opacityInfo",!1),this._getVariable(a,"sizeInfo",!1)];return d?p.filter(a,function(a){return!(!a||a.field!==d||a.normalizationField!=b)}):a},
_getFieldAlias:function(a,d,b){var e=d.infoTemplate||(d.infoTemplates&&b&&d.infoTemplates[b.id]?d.infoTemplates[b.id].infoTemplate:null),e=e&&e.getFieldInfo&&e.getFieldInfo(a);a=l.isFunction(a)?null:this.getField(d,a,b);d=e||a;b="";d&&(b=e&&e.label||a&&a.alias||d.name||d.fieldName);return b},_getDomainName:function(a,d,b,e){var g;a&&!l.isFunction(a)&&(g=(b=(a=this.getField(b,a,e))&&b.getDomain?b.getDomain(a.name):null)&&b.codedValues?b.getName(d):null);return g},_getRampTitle:function(a,d,b){var e,
g=a.field,c=a.normalizationField,m=!1,h=!1,f=!1,g=l.isFunction(g)?null:g,c=l.isFunction(c)?null:c;if(a.legendOptions&&a.legendOptions.title)e=a.legendOptions.title;else if(a.valueExpressionTitle)e=a.valueExpressionTitle;else{if(d.renderer&&d.renderer.authoringInfo&&d.renderer.authoringInfo.visualVariables){var u=d.renderer.authoringInfo.visualVariables;for(a=0;a<u.length;a++){var k=u[a];if("colorInfo"===k.type&&"ratio"===k.style){m=!0;break}else if("colorInfo"===k.type&&"percent"===k.style){h=!0;
break}else if("colorInfo"===k.type&&"percentTotal"===k.style){f=!0;break}}}(m=f&&"showRatioPercentTotal"||h&&"showRatioPercent"||m&&"showRatio"||c&&"showNormField"||g&&"showField"||null)&&(e=A.substitute({field:g&&this._getFieldAlias(g,d,b),normField:c&&this._getFieldAlias(c,d,b)},"showField"===m?"${field}":this._i18n[m]))}return e},_getRendererTitle:function(a,d,b){var e;if(a){var g,c,m;"esri.renderer.ClassBreaksRenderer"===a.declaredClass&&(g=a.attributeField,c=a.normalizationField,m="percent-of-total"===
a.normalizationType);g=l.isFunction(g)?null:g;c=l.isFunction(c)?null:c;a.legendOptions&&a.legendOptions.title?e=a.legendOptions.title:a.valueExpressionTitle?e=a.valueExpressionTitle:(a=c&&"showNormField"||(m?"showNormPct":null)||g&&"showField"||null)&&(e=A.substitute({field:g&&this._getFieldAlias(g,d,b),normField:c&&this._getFieldAlias(c,d,b)},"showField"===a?"${field}":this._i18n[a]))}return e},_buildLegendItems_Renderer:function(b,e,c){var m=e.parentLayerId,h=this.map,f=h.getScale(),u,k=!1;if(!this._respectCurrentMapScale||
this._isLayerInScale(b,e,f)){var t,n,v,q,w,B,D;n="esri.layers.ArcGISImageServiceVectorLayer"===b.declaredClass?b.renderer.renderer:e&&e.drawingInfo?X.fromJson(l.clone(e.drawingInfo.renderer)):b.isFeatureReductionActive&&b.isFeatureReductionActive()?b.getFeatureReductionRenderer():b.renderer;if("esri.renderer.ScaleDependentRenderer"===n.declaredClass&&(n=(h="zoom"===n.rangeType?n.getRendererInfoByZoom(h.getZoom()):n.getRendererInfoByScale(f))&&h.renderer,!n))return!1;h=n&&n.authoringInfo&&"relationship"===
n.authoringInfo.type;if("esri.renderer.StretchRenderer"!==n.declaredClass){var z=this._getVariables(n),y=p.filter(z,function(a){return!!a}).length,r=z[0],M=z[1],z=z[2],G,F,E,N,H;r&&(v=this._getMedianColor(n,r),r.field&&(w=l.isFunction(r.field)?null:this.getField(b,r.field,e)),G=!(r.legendOptions&&!1===r.legendOptions.showLegend));M&&(M.field&&(D=l.isFunction(M.field)?null:this.getField(b,M.field,e)),F=!(M.legendOptions&&!1===M.legendOptions.showLegend));z&&(z.field&&(B=l.isFunction(z.field)?null:
this.getField(b,z.field,e)),E=!(z.legendOptions&&!1===z.legendOptions.showLegend))}if("esri.renderer.HeatmapRenderer"===n.declaredClass)u=k=!0,this._showHeatRamp(b,e,n,c);else if("esri.renderer.DotDensityRenderer"===n.declaredClass)u=k=!0,this._showDotDensityLegend(b,e,n,c);else if("esri.renderer.TemporalRenderer"===n.declaredClass)u=k=!0,f=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),t=g.create("tbody",{},f),(b._hoverLabel||b._hoverLabels)&&this._createHoverAction(f,
b,e),n.latestObservationRenderer&&"esri.renderer.SimpleRenderer"===n.latestObservationRenderer.declaredClass&&this._buildRow_Renderer(b,n.latestObservationRenderer.symbol,v,C.encode(n.latestObservationRenderer.label)||this.NLS_currentObservations,null,t),n.observationRenderer&&"esri.renderer.SimpleRenderer"===n.observationRenderer.declaredClass&&this._buildRow_Renderer(b,n.observationRenderer.symbol,v,C.encode(n.observationRenderer.label)||this.NLS_previousObservations,null,t);else if("esri.renderer.UniqueValueRenderer"===
n.declaredClass){if(n.infos&&0<n.infos.length){u=k=!0;if(n.legendOptions&&n.legendOptions.title||n.valueExpressionTitle)f=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),t=g.create("tbody",{},f),y=n.legendOptions&&n.legendOptions.title?n.legendOptions.title:n.valueExpressionTitle,this._buildRow_Renderer(b,null,v,C.encode(y),null,t);f=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);t=g.create("tbody",{},f);(b._hoverLabel||
b._hoverLabels)&&this._createHoverAction(f,b,e);n.attributeField&&z&&this._addSubHeader(t,this._getFieldAlias(n.attributeField,b,e));if(h){var x=n.authoringInfo;H=x.focus;var y=x.numClasses,J=x.field1.field,f=x.field2.field;if(y&&J&&f){var L=x.field1.normalizationField,x=x.field2.normalizationField,O=L&&this._i18n.showNormField||J&&"${field}",Q=x&&this._i18n.showNormField||f&&"${field}",J=A.substitute({field:this._getFieldAlias(J,b,e),normField:L&&this._getFieldAlias(L,b,e)},O),f=A.substitute({field:this._getFieldAlias(f,
b,e),normField:x&&this._getFieldAlias(x,b,e)},Q),L={shapeDescriptor:ba,rotation:this._getRotationAngleForFocus(H)||0};this._buildRow_Renderer(b,null,null,C.encode(J),null,t,null,L);L.rotation+=90;this._buildRow_Renderer(b,null,null,C.encode(f),null,t,null,L);this._drawRelationshipLegend(c,{numClasses:y,focus:H,uvInfos:n.infos})}}else{var ca=[];p.forEach(n.infos,function(a){var d=null;this._isLayerEditable(b)&&b.types&&(d=this._getTemplateFromTypes(b.types,a.value));var g=a.label;null==g&&(g=this._getDomainName(n.attributeField,
a.value,b,e)||a.value);-1===p.indexOf(ca,g)&&(ca.push(g),this._buildRow_Renderer(b,a.symbol,v,C.encode(g),d,t))},this)}}H=!h&&this._displayDefaultSymbol(b,n,c)}else if("esri.renderer.ClassBreaksRenderer"===n.declaredClass){if(n.infos&&0<n.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===b.declaredClass)u=k=!0,N=this._isUnclassedRenderer(n),r||1!==n.infos.length||(q=(q=n.infos[0])&&q.symbol),N||(f=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),t=
g.create("tbody",{},f),y=this._getRendererTitle(n,b,e),this._buildRow_Renderer(b,null,v,C.encode(y),null,t)),f=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),t=g.create("tbody",{},f),(b._hoverLabel||b._hoverLabels)&&this._createHoverAction(f,b,e),N&&z&&E||(h=n.infos.slice(0).reverse(),p.forEach(h,function(a){var d=a.label;null!=d||N||(d=a.minValue+" - "+a.maxValue);this._buildRow_Renderer(b,a.symbol,v,C.encode(d),null,t)},this)),"esri.layers.ArcGISImageServiceVectorLayer"!==
b.declaredClass||b.renderer.style!==K.STYLE_SCALAR&&b.renderer.style!==K.STYLE_SINGLE_ARROW||(this._buildRow_Renderer(b,n.defaultSymbol,null,"",null,t),b._hideDefaultSymbol=!0);N||(H=this._displayDefaultSymbol(b,n,c))}else if("esri.renderer.StretchRenderer"===n.declaredClass){u=k=!0;f=g.create("table",{cellpadding:0,cellspacing:0,width:"95%",class:"esriLegendLayer"},c);t=g.create("tbody",{},f);var P=this;b.renderingRule?b.getRenderingRuleServiceInfo(b.renderingRule).then(function(a){var d=a&&a.minValues&&
0<a.minValues.length&&a.maxValues&&0<a.maxValues.length;a&&1<a.bandCount||!d?P._legendRequest(b).then(function(a){P._processLegendResponse(b,a)}):P._createStretchLegend(t,n,a.minValues[0],a.maxValues[0])}):this.createStretchLegend(t,n,b.serviceInfo.minValues[0],b.serviceInfo.maxValues[0])}else"esri.renderer.SimpleRenderer"===n.declaredClass&&(u=k=!0,f=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),t=g.create("tbody",{},f),(b._hoverLabel||b._hoverLabels)&&this._createHoverAction(f,
b,e),q=null,this._isLayerEditable(b)&&b.templates&&0<b.templates.length&&(q=b.templates[0]),h=1<y?null:w&&G||D&&F||B&&E,this._buildRow_Renderer(b,n.symbol,v,C.encode(h?this._getRampTitle(1<y?null:r||M||z,b,e):n.label),q,t),q=r?null:n.symbol,h&&(w=D=B=null));u&&(r&&G&&(r.field||r.valueExpression)&&this._showGradientRamp(b,e,n,null,c,r,w,null,z&&E?!0:!1),z&&E&&(z.field||z.valueExpression&&!aa.test(z.valueExpression))&&(u=r&&G||"esri.renderer.UniqueValueRenderer"===n.declaredClass?!1:!0,this._showSizeLegend(b,
e,n,z,v,c,B,null,u)),M&&F&&(M.field||M.valueExpression)&&this._showGradientRamp(b,e,n,q&&!q.url&&q.color?q.color:this.transparencyRampColor,c,M,D,null,!1));H||N&&!G&&!E&&!F||(H=this._displayDefaultSymbol(b,n,c));k=k||H}k&&(d.set(a.byId(this.id+"_"+b.id+"_"+e.id),"display","block"),-1<m&&(d.set(a.byId(this.id+"_"+b.id+"_"+m+"_group"),"display","block"),this._findParentGroup(b.id,m)));return k},_createStretchLegend:function(a,d,b,e){var c=g.create("tr",{},a),m;m=g.create("td",{rowspan:2,"class":"esriStretchLegend"},
c);d=g.toDom(this._addColorRamp(d.colorRamp));g.place(d,m);g.create("td",{},c).innerHTML=this._i18n.high+": "+Math.round(e*Math.pow(10,3))/Math.pow(10,3);a=g.create("tr",{},a);g.create("td",{},a).innerHTML=this._i18n.low+": "+Math.round(b*Math.pow(10,3))/Math.pow(10,3)},_addColorRamp:function(a){a||(a={algorithm:"hsv",fromColor:[0,0,0,1],toColor:[255,255,255,1]});var d=this._generateColorRampDivs(a);a.label="\x3cdiv class\x3d'esriStretchLegendGradientLabel'\x3e"+d+"\x3c/div\x3e";return a.label},_generateColorRampDivs:function(a){if(a){var d,
b="";"multipart"===a.type?(d=100/a.colorRamps.length,p.forEach(a.colorRamps.reverse(),function(a){b+=this._generateSingleGradientDiv(a.fromColor,a.toColor,d)},this)):b=this._generateSingleGradientDiv(a.fromColor,a.toColor,100);return b}},_generateSingleGradientDiv:function(a,d,b){if(a&&d){var e,g="";a=a.toRgb?a.toRgb():a;d=d.toRgb?d.toRgb():d;e="(0deg, rgb("+a.slice(0,3).join()+"), rgb("+d.slice(0,3).join()+"));";p.forEach(["-webkit-linear-gradient","-o-linear-gradient","-moz-linear-gradient","linear-gradient"],
function(a){g+="background: "+a+e});return"\x3cdiv class\x3d'esriStretchLegendSingleGradient' style\x3d'height:"+b+"%;"+g+"'\x3e\x3c/div\x3e"}},_isLayerEditable:function(a){return"function"===typeof a.isEditable&&a.isEditable()},_isUnclassedRenderer:function(a,d){var b;if("esri.renderer.ClassBreaksRenderer"===a.declaredClass&&a.infos&&1===a.infos.length){b=a.attributeField;var e=a.normalizationField;b=d?b===d:!!this._getVariables(a,b,e).length}return b},_displayDefaultSymbol:function(a,d,b){var e;
!a._hideDefaultSymbol&&d.defaultSymbol&&(e=!0,b=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},b),b=g.create("tbody",{},b),this._buildRow_Renderer(a,d.defaultSymbol,null,C.encode(d.defaultLabel)||"others",null,b));return e},_showGradientRamp:function(a,d,b,e,c,m,h,f,u){u=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(u?"":" esriLegendSubFragment")},c);c=g.create("tbody",{},u);(a._hoverLabel||a._hoverLabels||f)&&this._createHoverAction(u,
a,d,f);(h||m.valueExpression||m.legendOptions&&m.legendOptions.title)&&this._addSubHeader(c,this._getRampTitle(m,a,d));h=m.field;var k;h&&(k=l.isFunction(h)?null:this.getField(a,h,d));if(m=(d=this._getRampStops(b,m,e,k&&"esriFieldTypeDate"===k.type))?d.length:0)m=10<m,this._drawGradientRamp(c,d,!m,a,this._getRampBorderColor(b),!!e,m)},_getMedianColor:function(a,d){var b,e;d.colors?(b=d.minDataValue,e=d.maxDataValue):d.stops&&(b=d.stops[0].value,e=d.stops[d.stops.length-1].value);return a.getColor(b+
(e-b)/2,{colorInfo:d})},_getRampStops:function(a,d,b,e){var g,c,m,h,f=!1;d.colors||d.opacityValues?(c=d.maxDataValue-d.minDataValue,g=p.map([0,.25,.5,.75,1],function(a){m=d.minDataValue+a*c;return Number(m.toFixed(6))}),this._checkPrecision(0,4,g)):d.stops&&(g=p.map(d.stops,function(a){return a.value}),(f=p.some(d.stops,function(a){return!!a.label}))&&(h=p.map(d.stops,function(a){return a.label})));var u=g[0],k,t;c=g[g.length-1]-u;return p.map(g,function(m,v){b?(k=new n(b.toRgba()),t=a.getOpacity(m,
{opacityInfo:d}),null!=t&&(k.a=t)):k=a.getColor(m,{colorInfo:d});var q="";if(f)q=h[v];else{var q=e?E.formatDate(m,E.timelineDateFormatOptions):G.format(m),p="";0===v?p=this._specialChars.lt+" ":v===g.length-1&&(p=this._specialChars.gt+" ");q=p+q}return{value:m,color:k,offset:1-(m-u)/c,label:q}},this).reverse()},_checkPrecision:function(a,d,b){var e=a+(d-a)/2,g=b[a],c=b[e],m=b[d],h=Math.floor(g),f=Math.floor(c),u=Math.floor(m);h===g&&u===m&&f!==c&&h!==f&&u!==f&&(b[e]=f);a+1!==e&&this._checkPrecision(a,
e,b);e+1!==d&&this._checkPrecision(e,d,b)},_getRampBorderColor:function(a){var d;if("esri.renderer.SimpleRenderer"===a.declaredClass)d=a.symbol;else if("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)d=a.infos[0].symbol;return(a=d&&-1===d.type.indexOf("linesymbol")?d.getStroke():null)&&a.color},_drawGradientRamp:function(a,b,e,c,m,f,u){var k=g.create("tr",{},a),t,v,q,w,l,D=b.length-1,z;w=0;this.alignRight?(a=g.create("td",{align:this._isRightToLeft?
"left":"right"},k),t=g.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},k)):(t=g.create("td",{width:this.gradientWidth,align:"center"},k),a=g.create("td",{},k));k=m&&0<m.a&&!(240<=m.r&&240<=m.g&&240<=m.b);v=g.create("div",{"class":k?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},t);t=g.create("div",{"class":"esriLegendColorRamp"+(f?" esriLegendTransparencyRamp":"")},v);f=d.get(t,"width");k&&(m=9>h("ie")?m.toHex():"rgba("+
m.toRgba().join(",")+")",d.set(t,"border",this.colorRampBorder+" "+m));e?(m=this.gradientHeight*D,d.set(t,"height",m+"px")):m=d.get(t,"height");d.set(v,"height",m+"px");k=B.createSurface(t,f,m);9>h("ie")&&(w=k.getEventSource(),d.set(w,"position","relative"),d.set(w.parentNode,"position","relative"),w=1);try{e&&p.forEach(b,function(a,d){a.offset=d/D}),l=k.createRect({x:-w,y:-w,width:f+w,height:m+w}),l.setFill({type:"linear",x1:0,y1:0,x2:0,y2:m,colors:b}).setStroke(null),k.createRect({width:f,height:m}).setFill(new n([255,
255,255,1-c.opacity])).setStroke(null),this._surfaceItems.push(k)}catch(ga){k.clear(),k.destroy()}p.forEach(b,function(a,d){a.label&&(z="top:"+100*a.offset+"%;",a="",0===d&&(a+=" esriLegendColorRampTickFirst"),d===b.length-1&&(a+=" esriLegendColorRampTickLast"),g.create("div",{"class":"esriLegendColorRampTick"+a,innerHTML:"\x26nbsp;",style:z},v))});q=g.create("div",{"class":"esriLegendColorRampLabels",style:{height:m+this.gradientHeight+"px"}},a);e?p.forEach(b,function(a){g.create("div",{"class":"esriLegendColorRampLabel",
innerHTML:C.encode(a.label)||"\x26nbsp;"},q)}):(g.create("div",{"class":"esriLegendColorRampLabel",innerHTML:u?C.encode(b[0].label)||"\x26nbsp;":this._i18n.high},q),g.create("div",{"class":"esriLegendColorRampLabel",innerHTML:u?C.encode(b[b.length-1].label)||"\x26nbsp;":this._i18n.low,style:"top: "+(m+this.gradientHeight-2*this.gradientHeight)+"px;"},q))},_showHeatRamp:function(a,d,b,e,c){var m,h=b.field;m=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);e=g.create("tbody",
{},m);(a._hoverLabel||a._hoverLabels||c)&&this._createHoverAction(m,a,d,c);(h=h&&this.getField(a,h,d))&&this._addSubHeader(e,this._getFieldAlias(h.name,a,d));d=this._getHeatmapStops(b);d.length&&this._drawGradientRamp(e,d,!1,a)},_getHeatmapStops:function(a){var d=a.colorStops;a=a.colors;var b,e,g,c;d&&d[0]?(b=d.length-1,(a=d[0]&&null!=d[0].ratio)?(a=d[b])&&1!==a.ratio&&(d=d.slice(0),d.push({ratio:1,color:a.color}),b++):(e=d[0].value,g=d[b].value-e,d=p.map(d,function(a){return{color:a.color,ratio:(a.value-
e)/g}}))):a&&a[0]&&(b=a.length-1,c=1/(a.length-1),d=p.map(a,function(a,d){return{color:a,ratio:d*c}}));d=p.map(d,function(a,d){var e="";0===d?e="Low":d===b&&(e="High");return{color:a.color,label:e,offset:1-a.ratio}});return d.reverse()},_showDotDensityLegend:function(a,d,b,e){var c=b.legendOptions,m,h,f,u,k,t,n,v=this.dotDensitySwatchSize,q=Math.round(v/2);c&&(h=c.backgroundColor,f=c.outline,u=c.valueUnit,k=c.dotCoverage);k=(k||this.dotCoverage)/100;n=Math.round(v*v/Math.pow(b.dotSize,2)*k);e=g.create("table",
{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);t=g.create("tbody",{},e);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(e,a,d);this._addSubHeader(t,A.substitute({value:b.dotValue,unit:u||""},this.NLS_dotValue));p.forEach(b.fields,function(e){e=l.mixin({},e);e.numPoints=n;m=new Q(b._generateImageSrc(v,v,[e],{x:0,y:0},{x:v,y:v},h),f||b.outline,v,v);e=this.getField(a,e.name,d)||e;this._buildRow_Renderer(a,m,null,C.encode(this._getFieldAlias(e.name,a,d)),null,t,{type:"path",
path:"M "+-q+","+-q+" L "+q+","+-q+" L "+q+","+q+" L "+-q+","+q+" L "+-q+","+-q+" E"})},this)},_showSizeLegend:function(a,d,b,e,c,m,h,f,u){var k=e.legendOptions,k=k&&k.customValues;c=this._getSizeSymbol(b,c);if((!e.valueUnit||"unknown"===e.valueUnit)&&c&&(k||null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue||e.stops&&!(1>=e.stops.length))){u=g.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(u?"":" esriLegendSubFragment")},m);m=g.create("tbody",
{},u);(a._hoverLabel||a._hoverLabels||f)&&this._createHoverAction(u,a,d,f);(h||e.valueExpression||e.legendOptions&&e.legendOptions.title)&&this._addSubHeader(m,this._getRampTitle(e,a,d));h=(u=(f=e.field)&&!l.isFunction(f))&&"cluster_count"===f.toLowerCase();d=(d=u?a.isFeatureReductionActive&&a.isFeatureReductionActive()?a.getFeatureReductionField(f):this.getField(a,f,d):null)&&"esriFieldTypeDate"===d.type;var k=k||this._getDataValues(b,c,e,d,h),t,n=k.length-1;for(f=n;0<=f;f--)u=k[f],c=V.fromJson(c.toJson()),
this._applySize(c,b,e,u),u=d?E.formatDate(u,E.timelineDateFormatOptions):G.format(u),t="",f===n?t=this._specialChars.gt+" ":0===f&&(t=h&&1===k[f]?"":this._specialChars.lt+" "),t="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+C.encode(t+u)+"\x3c/span\x3e",this._buildRow_Renderer(a,c,null,t,null,m)}},_getSizeSymbol:function(a,d){var b,e;if("esri.renderer.SimpleRenderer"===a.declaredClass)b=a.symbol;else if("esri.renderer.VectorFieldRenderer"===a.declaredClass)b=a.defaultSymbol;else if("esri.renderer.UniqueValueRenderer"===
a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)b=a.infos[0].symbol,e=1<a.infos.length;if(b=b&&-1!==b.type.indexOf("fillsymbol")?null:b)if(b=V.fromJson(b.toJson()),d||e)-1!==b.type.indexOf("linesymbol")?b.setColor(new n(this.sizeRampDarkColor)):(b.setColor(new n(this.sizeRampLightColor)),b.setOutline&&(a=new R,a.setColor(new n(this.sizeRampDarkColor)),a.setWidth(1.5),b.setOutline(a)));return b},_getDataValues:function(a,d,b,e,g){if(g){var c;p.some([5,3,2],function(g){g=this._getDataValuesByCount(a,
d,b,e,g);this._hasFractionalValues(g)||(c=g);return!!c},this);return c}return this._getDataValuesByCount(a,d,b,e,5)},_getDataValuesByCount:function(a,d,b,e,g,c){g=null==g?5:g;c=null==c?20:c;var m=a.getSizeRangeAtScale(b,this.map.getScale());g=this._interpolateSizeRange(m,g);var h=this._getDataRange(b),f=p.map(g,function(a){return this._getDataValueFromSize(a,h,m)},this);if(!e){var u,f=G.round(f);for(e=1;e<f.length-1;e++)if(u=this._roundDataValue(a,d,b,f[e],f[e-1],c))f[e]=u[0],g[e]=u[1]}return f},
_hasFractionalValues:function(a){return p.some(a,function(a){return a!==Math.floor(a)})},_getDataRange:function(a){var d=a.stops;return d?{min:d[0].value,max:d[d.length-1].value}:{min:a.minDataValue,max:a.maxDataValue}},_interpolateSizeRange:function(a,d){var b=a.minSize;a=(a.maxSize-b)/(d-1);var e,g=[];for(e=0;e<d;e++)g.push(b+a*e);return g},_getDataValueFromSize:function(a,d,b){var e=b.minSize;b=b.maxSize;var g=d.min;d=d.max;return a<=e?g:a>=b?d:(a-e)/(b-e)*(d-g)+g},_roundDataValue:function(a,d,
b,e,g,c){var m=this._getSize(d,a,b,e);g=this._getSize(d,a,b,g);var h,f=G.getDigits(e),u=f.integer,f=f.fractional,k,t,n,v,q,p,w,l,B,D,z;0<e&&1>e&&(h=Math.pow(10,f),e*=h,u=G.getDigits(e).integer);for(--u;0<=u&&(k=Math.pow(10,u),f=Math.floor(e/k)*k,k*=Math.ceil(e/k),null!=h&&(f/=h,k/=h),t=(f+k)/2,t=G.round([f,t,k],{indexes:[1]})[1],n=this._getSize(d,a,b,f),v=this._getSize(d,a,b,k),q=this._getSize(d,a,b,t),p=G.getPctChange(m,n,g,null),w=G.getPctChange(m,v,g,null),l=G.getPctChange(m,q,g,null),B=p.prev<=
c,D=w.prev<=c,B&&D&&(p.prev<=w.prev?(B=!0,D=!1):(D=!0,B=!1)),B?z=[f,n]:D?z=[k,v]:l.prev<=c&&(z=[t,q]),!z);u--);return z},_applySize:function(a,d,b,e){var g=a.type;d=this._getSize(a,d,b,e);switch(g){case "simplemarkersymbol":a.setSize(d);break;case "picturemarkersymbol":g=a.width;b=a.height;a.setHeight(d);a.setWidth(g/b*d);break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(d);break;case "textsymbol":a.font&&a.font.setSize(d)}},_getSize:function(a,d,b,e){return d.getSize(e,{sizeInfo:b,
scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?a.style:null})},_buildRow_Renderer:function(a,d,b,e,c,m,h,f){var u=!!f,k=g.create("tr",{},m),t;if(this.alignRight){if(m=g.create("td",{align:this._isRightToLeft?"left":"right"},k),d||u)t=g.create("td",{align:this._isRightToLeft?"left":"right",width:35},k)}else{if(d||u)t=g.create("td",{width:35,align:"center"},k);m=g.create("td",{},k)}var n=k=30,v;if(d)if("simplemarkersymbol"==d.type)k=Math.min(Math.max(k,d.size+12),125),n=Math.min(Math.max(n,
d.size+12),125);else if("picturemarkersymbol"==d.type)k=Math.min(Math.max(k,d.width),125),n=Math.min(d.height||n,125);else if("textsymbol"==d.type){var q,p;d.text||(q=d.text,p=!0,d.setText(this.defaultText));k=Math.min(Math.max(k,d.getWidth()+12),125);n=Math.min(Math.max(n,d.getHeight()+12),125);p&&d.setText(q)}if(d||u)v=g.create("div",{style:"width:"+k+"px;height:"+n+"px;"},t);A.isDefined(e)&&"number"===typeof e&&(e=""+e);g.create("td",{innerHTML:e||"",align:this._align},g.create("tr",{},g.create("tbody",
{},g.create("table",{width:"95%"},m))));if(d||u)a=this._drawSymbol(v,d,b,k,n,c,a,h,f),this._surfaceItems.push(a)},_addSubHeader:function(a,d){a=g.create("tr",{},a);a=g.create("td",{align:this._align,colspan:2},a);g.create("td",{innerHTML:C.encode(d)||"",align:this._align},g.create("tr",{},g.create("tbody",{},g.create("table",{width:"95%"},a))))},_drawSymbol:function(a,b,e,g,c,m,f,u,k){var t=b&&V.fromJson(b.toJson()),v=f.opacity;b=!!k;if(t)if(e&&t.setColor(new n(e.toRgba())),"simplelinesymbol"===t.type||
"cartographiclinesymbol"===t.type||"textsymbol"===t.type){if(!t.color)return;e=t.color.toRgba();e[3]*=v;t.color.setColor(e)}else"simplemarkersymbol"===t.type||"simplefillsymbol"===t.type?(t.color&&(e=t.color.toRgba(),e[3]*=v,t.color.setColor(e)),t.outline&&t.outline.color&&(e=t.outline.color.toRgba(),e[3]*=v,t.outline.color.setColor(e))):"picturemarkersymbol"===t.type&&(a.style.opacity=v,a.style.filter="alpha(opacity\x3d("+100*v+"))");a=B.createSurface(a,g,c);9>h("ie")&&(e=a.getEventSource(),d.set(e,
"position","relative"),d.set(e.parentNode,"position","relative"));m=b?k.shapeDescriptor:this._getDrawingToolShape(t,m)||V.getShapeDescriptors(t);var q,v=(e=m.defaultShape)&&"text"===e.type;try{v&&!e.text&&(e.text=this.defaultText),q=a.createShape(u||e).setFill(m.fill).setStroke(m.stroke),v&&q.setFont(m.font)}catch(qa){a.clear();a.destroy();return}var p=q.getBoundingBox();u=p.width;m=p.height;var v=-(p.x+u/2),w=-(p.y+m/2);e=a.getDimensions();v={dx:v+e.width/2,dy:w+e.height/2};if(t&&"simplemarkersymbol"===
t.type&&"path"===t.style)g=f._getScaleMatrix(p,t.size),q.applyTransform(z.scaleAt(g.xx,g.yy,{x:e.width/2,y:e.height/2}));else if(u>g||m>c)f=u/g>m/c,g=((f?g:c)-5)/(f?u:m),l.mixin(v,{xx:g,yy:g});q.applyTransform(v);b&&q.applyTransform(z.rotategAt(k.rotation,u/2,m/2));return a},_getDrawingToolShape:function(a,d){switch(d?d.drawingTool||null:null){case "esriFeatureEditToolArrow":d={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};break;case "esriFeatureEditToolTriangle":d=
{type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};break;case "esriFeatureEditToolRectangle":d={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};break;case "esriFeatureEditToolCircle":d={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":d={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:d,fill:a.getFill(),stroke:a.getStroke()}},_drawRelationshipLegend:function(a,d){var b=d.focus,e=d.numClasses,g=Z[e],c=!!b,m=Math.sqrt(Math.pow(75,
2)+Math.pow(75,2)),h={};d.uvInfos.forEach(function(a){h[a.value]={label:a.label,fill:this._getSymbolColor(a.symbol)}},this);d=[];for(var f=0;f<e;f++){for(var u=[],k=0;k<e;k++)u.push(h[g[f][k]].fill);d.push(u)}g=this._getRelationshipCornerLabels(b,h);a=this._drawRampLayout(a,g,m,c);a=B.createSurface(a,m,m);c||(a.rawNode.style.margin="-15px -15px -18px -15px");d=I.create2DColorRamp({surface:a,colors:d,numClasses:e,size:75});e=(m-75)/2;m=(m-75)/2;d.applyTransform(z.translate(e,m));c&&d.applyTransform(z.rotategAt(this._getRotationAngleForFocus(b),
37.5,37.5));d=a.createGroup();g={width:1,color:"#555555"};f=a.defNode;this._createArrowMarker(f,"start");this._createArrowMarker(f,"end");f=d.createLine({x1:-10,y1:60,x2:-10,y2:15}).setStroke(g);g=d.createLine({x1:15,y1:85,x2:60,y2:85}).setStroke(g);this._setLineArrow(f.rawNode,"left",b);this._setLineArrow(g.rawNode,"right",b);d.applyTransform(z.translate(e,m));c&&d.applyTransform(z.rotategAt(-45,37.5,37.5));this._surfaceItems.push(a)},_drawRampLayout:function(a,d,b,e){var c=g.create("div",{style:{padding:"10px"}},
a);a=b+"px";b+="px";e?(e=g.create("div",{style:{display:"flex"}},c),g.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a,textAlign:"right"},innerHTML:d.left},e),c=g.create("div",{style:{display:"flex",flexDirection:"column",textAlign:"center"}},e),g.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:d.right},e),e=g.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:d.top},
c),e=g.create("div",{style:{height:b,width:b}},c),c=g.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:a},innerHTML:d.bottom},c)):(c=g.create("div",{style:{display:"table",color:"#555555"}},c),e=g.create("div",{style:{display:"table-row"}},c),b=g.create("div",{style:{display:"table-row"}},c),c=g.create("div",{style:{display:"table-row"}},c),g.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"right",verticalAlign:"bottom"},
innerHTML:d.left},e),g.create("div",{style:{display:"table-cell"}},e),g.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"left",verticalAlign:"bottom"},innerHTML:d.top},e),g.create("div",{style:{display:"table-cell"}},b),e=g.create("div",{style:{display:"table-cell"}},b),g.create("div",{style:{display:"table-cell"}},b),g.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"right",verticalAlign:"top"},
innerHTML:d.bottom},c),g.create("div",{style:{display:"table-cell"}},c),g.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:a,textAlign:"left",verticalAlign:"top"},innerHTML:d.right},c));return e},_getSymbolColor:function(a){if(a)return"simplelinesymbol"===a.type||"simplemarkersymbol"===a.type&&(a.style===P.STYLE_X||a.style===P.STYLE_CROSS)?(a=a.getStroke())&&a.color:a.getFill()},_getRotationAngleForFocus:function(a){var d=W[a];a&&null==d&&(d=W.HH);return d},_setLineArrow:function(a,
d,b){var e=this.id+"_arrowStart",g=this.id+"_arrowEnd";d="left"===d;switch(b){case "HL":a.setAttribute(d?"marker-start":"marker-end","url(#"+(d?g:e)+")");break;case "LL":a.setAttribute("marker-start","url(#"+g+")");break;case "LH":a.setAttribute(d?"marker-end":"marker-start","url(#"+(d?e:g)+")");break;default:a.setAttribute("marker-end","url(#"+e+")")}},_createArrowMarker:function(a,d){var b="start"===d,e=this.id+(b?"_arrowStart":"_arrowEnd");d=b?"0,0 5,5 0,10":"5,0 0,5 5,10";var g=b?5:0,b=document.createElementNS("http://www.w3.org/2000/svg",
"marker");b.setAttribute("id",e);b.setAttribute("markerWidth","10");b.setAttribute("markerHeight","10");b.setAttribute("refX",g);b.setAttribute("refY","5");b.setAttribute("markerUnits","strokeWidth");b.setAttribute("orient","auto");e=document.createElementNS("http://www.w3.org/2000/svg","polyline");e.setAttribute("points",d);e.setAttribute("fill","none");e.setAttribute("stroke","#555555");e.setAttribute("stroke-width","1");b.appendChild(e);a.appendChild(b)},_getRelationshipCornerLabels:function(a,
d){var b=d.HH.label,e=d.LL.label,g=d.HL.label;d=d.LH.label;switch(a){case "HH":return{top:b,bottom:e,left:g,right:d};case "HL":return{top:g,bottom:d,left:e,right:b};case "LL":return{top:e,bottom:b,left:d,right:g};case "LH":return{top:d,bottom:g,left:b,right:e};default:return{top:b,bottom:e,left:g,right:d}}},_repaintItems:function(){p.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&
a.setFill(a.getFill())}catch(x){}a.children&&l.isArray(a.children)&&p.forEach(a.children,this._repaint,this)}},_createHoverAction:function(b,e,m,h){if(h=e._hoverLabel||e._hoverLabels&&e._hoverLabels[m.id]||h)h=C.encode(h),e.mouseMoveHandler=e.mouseMoveHandler||{},e.mouseMoveHandler[m.id]=c.connect(b,"onmousemove",l.hitch(this,function(b,e){this.mouseX=e.clientX;this.mouseY=e.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,d.set(a.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(l.hitch(this,
function(b,e,c){if(b==this.mouseX&&e==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,a.byId(this.id+"_hoverLabel")){var m=a.byId(this.id+"_hoverLabel");m.innerHTML="\x3cspan\x3e"+c+"\x3c/span\x3e";d.set(m,"top",e+"px");d.set(m,"left",b+15+"px");d.set(m,"display","")}else g.create("div",{innerHTML:"\x3cspan\x3e"+c+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:e+"px",left:b+15+"px"}},document.body)},e.clientX,e.clientY,b),500)},h)),e.mouseOutHandler=
e.mouseOutHandler||{},e.mouseOutHandler[m.id]=c.connect(b,"onmouseout",l.hitch(this,function(b){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,d.set(a.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;p.forEach(this.layers,function(d){if(d.mouseMoveHandler)for(a in d.mouseMoveHandler)c.disconnect(d.mouseMoveHandler[a]);if(d.mouseOutHandler)for(a in d.mouseOutHandler)c.disconnect(d.mouseOutHandler[a])})},_createDynamicLayers:function(a){var d=
[],b;p.forEach(a.dynamicLayerInfos||a.layerInfos,function(e){b={id:e.id};b.source=e.source&&e.source.toJson();var g;a.layerDefinitions&&a.layerDefinitions[e.id]&&(g=a.layerDefinitions[e.id]);g&&(b.definitionExpression=g);var c;a.layerDrawingOptions&&a.layerDrawingOptions[e.id]&&(c=a.layerDrawingOptions[e.id]);c&&(b.drawingInfo=c.toJson());b.minScale=e.minScale||0;b.maxScale=e.maxScale||0;d.push(b)});return d},_getTemplateFromTypes:function(a,d){var b;for(b=0;b<a.length;b++)if(a[b].id==d&&a[b].templates&&
0<a[b].templates.length)return a[b].templates[0];return null},_findParentGroup:function(b,e,g){var c,m=e.dynamicLayerInfos||e.layerInfos;for(c=0;c<m.length;c++)if(g==m[c].id){-1<m[c].parentLayerId&&(d.set(a.byId(this.id+"_"+b+"_"+m[c].parentLayerId+"_group"),"display","block"),this._findParentGroup(b,e,m[c].parentLayerId));break}},_addSubLayersToHide:function(a){function d(b,e){var g=a.layer.dynamicLayerInfos||a.layer.layerInfos,c,m;for(c=0;c<g.length;c++)if(g[c].id===b&&g[c].subLayerIds)for(m=0;m<
g[c].subLayerIds.length;m++){var h=g[c].subLayerIds[m];-1===p.indexOf(e,h)&&(e.push(h),d(h,e))}}a.layer.layerInfos&&p.forEach(this.hideLayersInLegend[a.layer.id],function(b){d(b,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,d,b){var e,g=!0;if(a.legendResponse&&a.legendResponse.layers)for(e=0;e<a.legendResponse.layers.length;e++){var c=a.legendResponse.layers[e];if(d.id==c.layerId){var m,h;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==c.minScale&&a.tileInfo&&
(m=a.tileInfo.lods[0].scale),0==c.maxScale&&a.tileInfo&&(h=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(m=Math.min(a.minScale,c.minScale)||a.minScale||c.minScale,h=Math.max(a.maxScale,c.maxScale));if(0<m&&m<b||h>b)g=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<b||a.maxScale&&a.maxScale>b)g=!1;return g},_getServiceTitle:function(a){var d=a._titleForLegend;d||(d=a.url,a.url?-1<a.url.indexOf("/MapServer")?(d=a.url.substring(0,a.url.indexOf("/MapServer")),d=d.substring(d.lastIndexOf("/")+
1,d.length)):-1<a.url.indexOf("/ImageServer")?(d=a.url.substring(0,a.url.indexOf("/ImageServer")),d=d.substring(d.lastIndexOf("/")+1,d.length)):-1<a.url.indexOf("/FeatureServer")&&(d=a.url.substring(0,a.url.indexOf("/FeatureServer")),d=d.substring(d.lastIndexOf("/")+1,d.length)):d="",a.name&&(d=0<d.length?d+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+a.vectorFieldPixelFilter.outputUnit]:
this["NLS_"+a.vectorFieldPixelFilter.inputUnit],A.isDefined(a)&&(d+=" ("+a+")"));return C.encode(d)},_getEffectiveScale:function(a,d){var b=d.minScale,e=d.maxScale;if(A.isDefined(d.parentLayerId)){a=a.layerInfos;d=d.parentLayerId;var g;for(g=a.length-1;0<=g;g--)if(a[g].id==d)if(0==b&&0<a[g].minScale?b=a[g].minScale:0<b&&0==a[g].minScale||0<b&&0<a[g].minScale&&(b=Math.min(b,a[g].minScale)),e=Math.max(e||0,a[g].maxScale||0),-1<a[g].parentLayerId)d=a[g].parentLayerId;else break}return{minScale:b,maxScale:e}},
_isSupportedLayerType:function(a){return!(!a||!("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===
a.declaredClass||"esri.layers.WFSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass))},isHostedTileService:function(a){var d=/(https?:)?\/\/services.*\.arcgis\.com/i;return!("esri.layers.ArcGISTiledMapServiceLayer"!==a.declaredClass||!d.test(a.url))},getField:function(a,d,b){if(a.getField)return a.getField(d);if(b&&b.fields){var e;p.forEach(b.fields,function(a){a.name===d&&(e=a)});return e}return null}});l.mixin(S,{ALIGN_LEFT:0,ALIGN_RIGHT:1});h("extend-esri")&&l.setObject("dijit.Legend",
S,D);return S})},"dojo/debounce":function(){define([],function(){return function(r,f){var l;return function(){l&&clearTimeout(l);var p=this,c=arguments;l=setTimeout(function(){r.apply(p,c)},f)}}})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(r,f,l,p){var c=function(c,f){return c-f},q={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(c){var f=String(c),h=f.match(q._reNumber);c={integer:0,fractional:0};h&&h[1]?(c.integer=h[1].split("").length,
c.fractional=h[3]?h[3].split("").length:0):-1<f.toLowerCase().indexOf("e")&&(h=f.split("e"),f=h[0],h=h[1],f&&h&&(f=Number(f),h=Number(h),(c=0<h)||(h=Math.abs(h)),f=q.getDigits(f),c?(f.integer+=h,f.fractional=h>f.fractional?0:f.fractional-h):(f.fractional+=h,f.integer=h>f.integer?1:f.integer-h),c=f));return c},getFixedNumbers:function(c,f){var h;h=Number(c.toFixed(f));h<c?c=h+1/Math.pow(10,f):(c=h,h-=1/Math.pow(10,f));h=Number(h.toFixed(f));c=Number(c.toFixed(f));return[h,c]},getPctChange:function(c,
f,h,t){var e={prev:null,next:null},b;null!=h&&(b=c-h,e.prev=Math.floor(Math.abs(100*(f-h-b)/b)));null!=t&&(b=t-c,e.next=Math.floor(Math.abs(100*(t-f-b)/b)));return e},round:function(f,k){f=f.slice(0);var h,t,e,b,m,a,g,d,u=k&&null!=k.tolerance?k.tolerance:2,n=k&&k.indexes,p=k&&null!=k.strictBounds?k.strictBounds:!1;if(n)n.sort(c);else for(n=[],m=0;m<f.length;m++)n.push(m);for(m=0;m<n.length;m++)if(d=n[m],k=f[d],h=0===d?null:f[d-1],t=d===f.length-1?null:f[d+1],e=q.getDigits(k),e=e.fractional){a=0;for(g=
!1;a<=e&&!g;)b=q.getFixedNumbers(k,a),b=p&&0===m?b[1]:b[0],g=q.hasMinimalChange(k,b,h,t,u),a++;g&&(f[d]=b)}return f},hasMinimalChange:function(c,f,h,t,e){c=q.getPctChange(c,f,h,t);f=null==c.prev||c.prev<=e;h=null==c.next||c.next<=e;return f&&h||c.prev+c.next<=2*e},_reAllZeros:new RegExp("\\"+l.decimal+"0+$","g"),_reSomeZeros:/(\d)0*$/g,format:function(c,k){k=k||{places:20,round:-1};(c=f.format(c,k))&&(c=c.replace(q._reSomeZeros,"$1").replace(q._reAllZeros,""));return c}};r("extend-esri")&&(p.numberUtils=
q);return q})},"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!dojo/cldr/nls/gregorian".split(" "),function(r,f,l,p,c,q,n,k){function h(a){return a&&f.map(a,function(a){return new n(a)})}function t(a,d,e){var g="";0===d?g=b.lt+" ":d===e&&(g=b.gt+" ");return g+a}var e={},b={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},m={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},a={millisecond:{dateOptions:{formatLength:"long"},
timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},g={formatLength:"short",fullYear:!0},d={formatLength:"short"};r.mixin(e,
{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(a,b){var e=[];null==a||a instanceof Date||(a=new Date(a));b=b||{};b=r.mixin({},b);var c=b.selector?b.selector.toLowerCase():null,m=!c||-1<c.indexOf("time"),c=!c||-1<c.indexOf("date");m&&(b.timeOptions=b.timeOptions||d,b.timeOptions&&(b.timeOptions=r.mixin({},b.timeOptions),b.timeOptions.selector=b.timeOptions.selector||"time",e.push(b.timeOptions)));c&&(b.dateOptions=b.dateOptions||g,b.dateOptions&&
(b.dateOptions=r.mixin({},b.dateOptions),b.dateOptions.selector=b.dateOptions.selector||"date",e.push(b.dateOptions)));e&&e.length?(e=f.map(e,function(d){return p.format(a,d)}),b=1==e.length?e[0]:k["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,d){return e[d]})):b=p.format(a);return b},createColorStops:function(a){var d=a.values,b=a.colors,g=a.labelIndexes,c=a.isDate,m=a.dateFormatOptions;a=[];return a=f.map(d,function(a,h){var u=null;if(!g||-1<f.indexOf(g,h)){var k;(k=
c?e.formatDate(a,m):q.format(a))&&(u=t(k,h,d.length-1))}return{value:a,color:b[h],label:u}})},updateColorStops:function(a){var d=a.stops,b=a.changes,g=a.isDate,c=a.dateFormatOptions,m=[],h,u=f.map(d,function(a){return a.value});f.forEach(b,function(a){m.push(a.index);u[a.index]=a.value});h=q.round(u,{indexes:m});f.forEach(d,function(a,b){a.value=u[b];if(null!=a.label){var m,f=null;(m=g?e.formatDate(h[b],c):q.format(h[b]))&&(f=t(m,b,d.length-1));a.label=f}})},createClassBreakLabel:function(a){var d=
a.minValue,e=a.maxValue,g=a.isFirstBreak?"":b.gt+" ";a="percent-of-total"===a.normalizationType?b.pct:"";d=null==d?"":q.format(d);e=null==e?"":q.format(e);return g+d+a+" \u2013 "+e+a},setLabelsForClassBreaks:function(a){var d=a.classBreaks,b=a.classificationMethod,g=a.normalizationType,c=[];d&&d.length&&("standard-deviation"===b?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):a.round?(c.push(d[0].minValue),f.forEach(d,function(a){c.push(a.maxValue)}),
c=q.round(c),f.forEach(d,function(a,d){a.label=e.createClassBreakLabel({minValue:0===d?c[0]:c[d],maxValue:c[d+1],isFirstBreak:0===d,normalizationType:g})})):f.forEach(d,function(a,d){a.label=e.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===d,normalizationType:g})}))},updateClassBreak:function(a){var d=a.classBreaks,b=a.normalizationType,g=a.change,c=g.index,g=g.value,m=-1,h=-1,f=d.length;"standard-deviation"===a.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):
(0===c?m=c:c===f?h=c-1:(h=c-1,m=c),-1<m&&m<f&&(a=d[m],a.minValue=g,a.label=e.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===m,normalizationType:b})),-1<h&&h<f&&(a=d[h],a.maxValue=g,a.label=e.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===h,normalizationType:b})))},calculateDateFormatInterval:function(a){var d,b,e=a.length,g,c,h,u,k,t,n=Infinity,q;a=f.map(a,function(a){return new Date(a)});for(d=0;d<e-1;d++){g=a[d];h=[];k=Infinity;t=
"";for(b=d+1;b<e;b++)c=a[b],c=g.getFullYear()!==c.getFullYear()&&"year"||g.getMonth()!==c.getMonth()&&"month"||g.getDate()!==c.getDate()&&"day"||g.getHours()!==c.getHours()&&"hour"||g.getMinutes()!==c.getMinutes()&&"minute"||g.getSeconds()!==c.getSeconds()&&"second"||"millisecond",u=m[c],u<k&&(k=u,t=c),h.push(c);k<n&&(n=k,q=t)}return q},createUniqueValueLabel:function(d){var b=d.value,g=d.fieldInfo,c=d.domain;d=d.dateFormatInterval;var m=String(b);(c=c&&c.codedValues?c.getName(b):null)?m=c:"number"===
typeof b&&(m=g&&"esriFieldTypeDate"===g.type?e.formatDate(b,d&&a[d]):q.format(b));return m},cloneColorInfo:function(a){var d;a&&(d=r.mixin({},a),d.colors=h(d.colors),d.stops=d.stops&&f.map(d.stops,function(a){a=r.mixin({},a);a.color&&(a.color=new n(a.color));return a}),d.legendOptions&&(d.legendOptions=r.mixin({},d.legendOptions)));return d},cloneOpacityInfo:function(a){var d;if(a){d=r.mixin({},a);if(a=d.opacityValues)d.opacityValues=a.slice(0);if(a=d.stops)d.stops=f.map(a,function(a){return r.mixin({},
a)});if(a=d.legendOptions)d.legendOptions=r.mixin({},a)}return d},cloneSizeInfo:function(a){var d;a&&(d=r.mixin({},a),d.stops&&(d.stops=f.map(d.stops,function(a){return r.mixin({},a)})),(a=d.minSize)&&"object"===typeof a&&(d.minSize=e.cloneSizeInfo(a)),(a=d.maxSize)&&"object"===typeof a&&(d.maxSize=e.cloneSizeInfo(a)),a=d.legendOptions)&&(d.legendOptions=r.mixin({},a),a=a.customValues)&&(d.legendOptions.customValues=a.slice(0));return d},getClassCodesForRelationship:function(){return r.clone({2:["L",
"H"],3:["L","M","H"],4:["L","M1","M2","H"]})},getClassValuesForRelationship:function(){return r.clone({2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]})}});l("extend-esri")&&r.setObject("renderer.utils",e,c);return e})},"jimu/LayerInfos/LayerInfoForGeoRSS":function(){define("dojo/_base/declare dojo/_base/array dojo/Deferred esri/lang jimu/utils ./LayerInfo".split(" "),
function(r,f,l,p,c,q){return r(q,{constructor:function(){},_getExtent:function(){var f=new l,k=this.layerObject.items,h=this.layerObject.fullExtent||this.layerObject.initialExtent;0===k.length?f.resolve(h):f.resolve(c.graphicsExtent(k));return f},_resetLayerObjectVisiblity:function(c){var f=c?c[this.id]:null;if(f){var h={},t;for(t in c)c.hasOwnProperty(t)&&"function"!==typeof c[t]&&(h[t]=c[t].visible);this._setSubLayerVisibleByCheckedInfo(h);this._setTopLayerVisible(f.visible)}},_setSubLayerVisibleByCheckedInfo:function(c){f.forEach(this.newSubLayers,
function(f){p.isDefined(c[f.id])&&f.layerObject.setVisibility(c[f.id])},this)},_initVisible:function(){var c=!1,f;for(f=0;f<this.newSubLayers.length;f++)c=c||this.newSubLayers[f].layerObject.visible;c&&(this._visible=!0)},_setTopLayerVisible:function(c){this._visible=c?!0:!1;f.forEach(this.newSubLayers,function(c){c.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var c=[],k=this.layerObject.getFeatureLayers();f.forEach(k,function(h){h=this._layerInfoFactory.create({layerObject:h,
title:h.label||h.title||h.name||h.id||" ",id:h.id||" ",subId:h.id||" ",collection:{layerInfo:this},selfType:"geo_rss",parentLayerInfo:this});c.push(h);h.init()},this);this._markInvalidSubLayerInfoThatAsRootLayer(k);return c},_markInvalidSubLayerInfoThatAsRootLayer:function(c){var k;f.forEach(c,function(c){if(k=this._getLayerInfosObj()._findTopLayerInfoById(c.id))k._flag._invalid=!0},this)},_needToRenew:function(){var c=this.layerObject.getFeatureLayers();return(c?c.length:0)===this.newSubLayers.length?
!1:!0},_obtainLayerIndexesInMap:function(){var c=[],f,h;for(h=0;h<this.newSubLayers.length;h++)(f=this._getLayerIndexesInMapByLayerId(this.newSubLayers[h].layerObject.id))&&c.push(f);return c},moveLeftOfIndex:function(c){var f;for(f=this.newSubLayers.length-1;0<=f;f--)this.map.reorderLayer(this.newSubLayers[f].layerObject,c)},moveRightOfIndex:function(c){var f;for(f=0;f<this.newSubLayers.length;f++)this.map.reorderLayer(this.newSubLayers[f].layerObject,c)}})})},"jimu/LayerInfos/LayerInfoForWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/topic dojo/Deferred esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefaultWMS esri/layers/FeatureLayer esri/lang".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e){return r(k,{constructor:function(b,e){},_getExtent:function(){var b=new c;b.resolve(this.layerObject.extent||this.layerObject.fullExtent);return b},_initVisible:function(){this._visible=this.layerObject.visible},_setTopLayerVisible:function(b){this._visible=b;this.layerObject.setVisibility(b)},_setSubLayerVisible:function(b){var e=[],a,e=l.clone(this.originOperLayer.layerObject.visibleLayers),g;for(g in b)if(b.hasOwnProperty(g)&&"function"!==typeof b[g]){var d=b[g],
c=g.toString();a=f.indexOf(e,c);d?0>a&&e.push(c):0<=a&&e.splice(a,1)}this._setVisibleLayersBySelfFlag=!0;this.layerObject.setVisibleLayers(e)},_resetLayerObjectVisiblity:function(b){var e=b?b[this.id]:null,a=!1;if(b){e&&this.layerObject.setVisibility(e.visible);var e={},g;for(g in b)b.hasOwnProperty(g)&&"function"!==typeof b[g]&&(a=!0,e[g]=b[g].visible);a&&this._setSubLayerVisibleByCheckedInfo(e)}},_setSubLayerVisibleByCheckedInfo:function(b){var c={};this.traversal(function(a){a.isRootLayer()||e.isDefined(b[a.id])&&
a._setVisible(b[a.id])});this.traversal(function(a){0===a.getSubLayers().length&&(c[a.subId]=a._isAllSubLayerVisibleOnPath())});this._setSubLayerVisible(c)},_getServiceDefinition:function(){var b=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(b)},_serviceDefinitionRequest:function(b){return this._normalRequest(b,{SERVICE:"WMS",REQUEST:"GetCapabilities"},"xml")},obtainNewSubLayers:function(){var b=[];f.forEach(this.layerObject.layerInfos,function(e,a){e=this._getOperLayerFromWMSLayerInfo(e,
this);e=this._layerInfoFactory.create(e);b.push(e);e.init()},this);b.reverse();return b},_getOperLayerFromWMSLayerInfo:function(b,e){return{layerObject:this.layerObject,title:b.label||b.title||b.name||" ",id:this.id+"_"+(b.name||b.title+"-"+Math.random()),subId:b.name||"-",wms:{layerInfo:this,subId:b.name||"-",wmsLayerInfo:b},selfType:"wms",parentLayerInfo:e}},_bindEvent:function(){this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&n.after(this.layerObject,"setVisibleLayers",l.hitch(this,
this._onVisibleLayersChanged))},_onVisibleLayersChanged:function(){var b=[];this._setVisibleLayersBySelfFlag||(this.traversal(function(b){b.isRootLayer()||b._initVisible()}),this._setVisibleLayersBySelfFlag=!1);this.traversal(function(e){e.isRootLayer()||b.push(e)});this._setVisibleLayersBySelfFlag=!1;p.publish("layerInfos/layerInfo/visibleChanged",b);this._isShowInMapChanged2()}})})},"jimu/LayerInfos/LayerInfoForDefaultWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/Deferred dojo/dom-construct dojo/on ./LayerInfoForDefault".split(" "),
function(r,f,l,p,c,q,n){return r(n,{constructor:function(c,h){this.layerObject=c.layerObject},_resetLayerObjectVisiblity:function(){},_initVisible:function(){var c=!1;this.traversal(function(h){if(0<=f.indexOf(h.layerObject.visibleLayers,h.subId))return c=!0});this._visible=c},_setVisible:function(c){this._visible=c?!0:!1},_setTopLayerVisible:function(c){var h=this.originOperLayer.wms;this._visible=c?!0:!1;var f={};this.traversal(function(e){0===e.getSubLayers().length&&(f[e.subId]=e._isAllSubLayerVisibleOnPath())});
h.layerInfo._setSubLayerVisible(f)},_getServiceDefinition:function(){var c=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(c)},_serviceDefinitionRequest:function(c){return this._normalRequest(c,{SERVICE:"WMS",REQUEST:"GetCapabilities"},"xml")},obtainNewSubLayers:function(){var c=[],h=this.originOperLayer.wms;f.forEach(h.wmsLayerInfo.subLayers,function(f){f=h.layerInfo._getOperLayerFromWMSLayerInfo(f,this);f=this._layerInfoFactory.create(f);c.push(f);f.init()},this);
return c},drawLegends:function(c){this._initLegendsNode(c)},_initLegendsNode:function(f){if(this.originOperLayer.wms.wmsLayerInfo.legendURL){var h=c.create("img",{"class":"legend-div-image",src:this.originOperLayer.wms.wmsLayerInfo.legendURL});q(h,"load",function(){c.empty(f);var k=c.create("div",{"class":"legend-div"},f);l.place(h,k)})}else c.empty(f)},getOpacity:function(){},setOpacity:function(c){},enablePopup:function(){this.originOperLayer.wms.wmsLayerInfo.showPopup=!0},disablePopup:function(){this.originOperLayer.wms.wmsLayerInfo.showPopup=
!1},isPopupEnabled:function(){return this.originOperLayer.wms.wmsLayerInfo.showPopup},isSupportPopup:function(){var c=new p;this.originOperLayer.wms.wmsLayerInfo.queryable?c.resolve(!0):c.resolve(!1);return c},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.originOperLayer.wms.layerInfo.getScaleRange()}})})},"jimu/LayerInfos/LayerInfoForDefaultDynamic":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(r,f){return r(f,
{constructor:function(f,p){},_initVisible:function(){var f=!1,p=this.originOperLayer.mapService;p&&p.layerInfo._subLayerVisible[p.subId]&&(f=!0);this._visible=f},_setTopLayerVisible:function(f){var p=this.originOperLayer.mapService;if(p){p.layerInfo._subLayerVisible[p.subId]=f?!0:!1;this._visible=f;var c={};this.traversal(function(f){0===f.getSubLayers().length&&(c[f.originOperLayer.mapService.subId]=f._isAllSubLayerVisibleOnPath())});p.layerInfo._setSubLayerVisible(c)}}})})},"jimu/LayerInfos/LayerInfoForDefaultService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/topic dojo/dom-construct ./LayerInfoForDefault ./LayerObjectFacory ../utils".split(" "),
function(r,f,l,p,c,q,n,k,h){return r(n,{_legendsNode:null,_layerObjectFacory:null,constructor:function(){this._layerObjectFacory=new k(this)},_resetLayerObjectVisiblity:function(){},_loadLegends:function(c){var e=new p;this.originOperLayer.mapService.layerInfo.getLegendInfo(c).then(l.hitch(this,function(b){e.resolve(b)}));return e},drawLegends:function(c,e){this._loadLegends(e).then(l.hitch(this,function(b){this._initLegendsNode(b,c)}))},_initLegendsNode:function(c,e){var b=this.originOperLayer.mapService;
if(c){q.empty(e);for(var m=null,a=0;a<c.length;a++)if(c[a].layerId===b.subId){m=c[a];break}if(m){var g=q.create("table",{"class":"legend-table",style:"font-size: 12px"},e);f.forEach(m.legend,function(a){if("\x3call other values\x3e"!==a.label){var d=q.create("tr",{"class":"legend-tr",style:"border: 1px solid"},g),b=q.create("td",{"class":"legend-symbol-td",style:""},d),e=null,e=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;q.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;top:0;left:0;bottom:0;right:0",
src:e},b);q.create("td",{"class":"legend-label-td",innerHTML:h.sanitizeHTML(a.label)||" ",style:"padding-left: 5px"},d)}},this)}}},_initControlPopup:function(){var c=this.originOperLayer.mapService.layerInfo.layerObject,e=this.originOperLayer.mapService.subId;this.controlPopupInfo={enablePopup:c.infoTemplates&&c.infoTemplates[e]?!0:!1,infoTemplates:void 0}},_afterSetInfoTemplates:function(){var c=this.originOperLayer.mapService.layerInfo.layerObject,e=this.originOperLayer.mapService.subId;!this.controlPopupInfo.enablePopup&&
c.infoTemplates&&delete c.infoTemplates[e]},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},_getServiceDefinition:function(){return this.originOperLayer.mapService.layerInfo._getSubserviceDefinition(this.originOperLayer.mapService.mapServiceSubId)},_getLayerObject:function(c){var e=new p;(c?this._layerObjectFacory.getLayerObjectWithUrl(c):this._layerObjectFacory.getLayerObject()).then(l.hitch(this,
function(b){this.layerObject.empty&&b&&(this.layerObject=b);e.resolve(b)}));return e},getLayerObject:function(){return this._getLayerObject()},getLayerObjectTryUsingFeatureService:function(){var c;return this.isItemLayer()?this.getItemInfo().then(l.hitch(this,function(e){e&&e.getItemData()&&e.getItemData().layers&&f.some(e.getItemData().layers,function(b){if(b.id===this.subId)return c=b.layerUrl,!0},this);return c?this._getLayerObject(c):this._getLayerObject()})):this.getLayerObject()},getPopupInfo:function(){var c=
null,e=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(e)for(var b=0;b<e.length;b++)if(e[b].id===this.originOperLayer.mapService.subId){c=e[b].popupInfo;break}return c},getFilterOfWebmap:function(){var c=null,e=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(e)for(var b=0;b<e.length;b++)if(e[b].id===this.originOperLayer.mapService.subId){c=e[b].layerDefinition?e[b].layerDefinition.definitionExpression:null;break}return c},getFilter:function(){var c=this.originOperLayer.mapService;
return c.layerInfo.layerObject&&c.layerInfo.layerObject.layerDefinitions?c.layerInfo.layerObject.layerDefinitions[c.subId]:null},setFilter:function(c,e){var b,m=this.originOperLayer.mapService;m.layerInfo.layerObject&&m.layerInfo.layerObject.setLayerDefinitions&&(b=m.layerInfo.layerObject.layerDefinitions?f.map(m.layerInfo.layerObject.layerDefinitions,function(a){return a}):[],e=l.mixin({},e),l.setObject("_wabProperties.objectPassWithFilterChangeEvent",e,m.layerInfo.layerObject),b[m.subId]=c,m.layerInfo.layerObject.setLayerDefinitions(b))},
getLayerType:function(){var c=new p;0<this.getSubLayers().length?c.resolve("GroupLayer"):this._getServiceDefinition().then(l.hitch(this,function(e){e?c.resolve(e.type.replace(/\ /g,"")):c.resolve(null)}),function(){c.resolve(null)});return c},getSupportTableInfo:function(){var c=new p,e={isSupportedLayer:!1,isSupportQuery:!1,layerType:null};this.getLayerType().then(l.hitch(this,function(b){e.layerType=b;0<=this._getLayerTypesOfSupportTable().indexOf(b)&&(e.isSupportedLayer=!0);this._getServiceDefinition().then(l.hitch(this,
function(b){b&&0<=b.capabilities.indexOf("Data")&&(e.isSupportQuery=!0);c.resolve(e)}),function(){c.resolve(e)})}),function(){c.resolve(e)});return c},enablePopup:function(){var c=this.originOperLayer.mapService.layerInfo,e=c.layerObject,b=this.originOperLayer.mapService.subId;return this.loadInfoTemplate().then(l.hitch(this,function(){return c.controlPopupInfo.infoTemplates&&c.controlPopupInfo.infoTemplates[b]?(this.controlPopupInfo.enablePopup=!0,e.infoTemplates||(e.infoTemplates={}),e.infoTemplates[b]=
c.controlPopupInfo.infoTemplates[b],!0):!1}))},disablePopup:function(){var c=this.originOperLayer.mapService.layerInfo.layerObject,e=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!1;c.infoTemplates&&delete c.infoTemplates[e]},loadInfoTemplate:function(){var c=new p,e=this.originOperLayer.mapService.layerInfo,b=this.originOperLayer.mapService.subId;e.controlPopupInfo.infoTemplates&&e.controlPopupInfo.infoTemplates[b]&&e.controlPopupInfo.infoTemplates[b].infoTemplate?c.resolve(e.controlPopupInfo.infoTemplates[b].infoTemplate):
(e.controlPopupInfo.infoTemplates||(e.controlPopupInfo.infoTemplates={}),this.getLayerObject().then(l.hitch(this,function(m){m=this._getDefaultPopupTemplate(m);e.controlPopupInfo.infoTemplates[b]={infoTemplate:m,layerUrl:null};c.resolve(m)}),l.hitch(this,function(){c.resolve(null)})));return c},getInfoTemplate:function(){var c=this.originOperLayer.mapService.layerInfo,e=this.originOperLayer.mapService.subId;return c.controlPopupInfo.infoTemplates&&c.controlPopupInfo.infoTemplates[e]&&c.controlPopupInfo.infoTemplates[e].infoTemplate?
c.controlPopupInfo.infoTemplates[e].infoTemplate:null},getScaleRange:function(){var c=this.originOperLayer.mapService;return(c=c.layerInfo._getJsapiLayerInfoById(c.subId))&&0<=c.minScale&&0<=c.maxScale?{minScale:c.minScale,maxScale:c.maxScale}:{minScale:0,maxScale:0}},setScaleRange:function(h,e){var b=this.originOperLayer.mapService,m=b.layerInfo._getJsapiLayerInfoById(b.subId);b.layerInfo.layerObject&&b.layerInfo.layerObject.supportsDynamicLayers&&b.layerInfo.layerObject.setDynamicLayerInfos&&m&&
(m.minScale!==h||m.maxScale!==e)&&(m.minScale=h,m.maxScale=e,b.layerInfo.layerObject.setDynamicLayerInfos(b.layerInfo._jsapiLayerInfos),c.publish("layerInfos/layerInfo/scaleRangeChanged",[this]))},_onVisibilityChanged:function(){}})})},"jimu/LayerInfos/LayerObjectFacory":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred ./RequestBuffer esri/layers/FeatureLayer esri/layers/RasterLayer esri/layers/StreamLayer esri/layers/ArcGISImageServiceLayer esri/layers/ArcGISImageServiceVectorLayer".split(" "),
function(r,f,l,p,c,q,n,k,h,t){return r(null,{_layerInfo:null,_layerObjectBuffer:null,constructor:function(e){this._layerInfo=e;this._initLayerObjectBuffer()},_initLayerObjectBuffer:function(){this._layerObjectBuffer=new c(f.hitch(this,this._getLayerObject))},getLayerObject:function(){var e=this._layerInfo.getUrl();return this._layerObjectBuffer.getRequest(this._layerInfo.subId).request(e)},getLayerObjectWithUrl:function(e){return this._layerObjectBuffer.getRequest(this._layerInfo.subId+"_url").request(e)},
_getLayerObject:function(e){var b,c=new p;this._layerInfo.getLayerType().then(f.hitch(this,function(a){var g=f.mixin(this._getLayerOptionsForCreateLayerObject(),this._layerInfo.originOperLayer.options||{})||{};switch(a){case "FeatureLayer":b=new q(e,g);break;case "RasterLayer":b=new n(e);break;case "StreamLayer":b=new k(e);break;case "ArcGISImageServiceLayer":b=new h(e);break;case "ArcGISImageServiceVectorLayer":b=new t(e);break;case "Table":if(this._layerInfo.layerObject&&!this._layerInfo.layerObject.empty)return this._setLayerObjectProperties(this._layerInfo.layerObject),
c.resolve(this._layerInfo.layerObject),c;if(this._layerInfo.layerObject&&this._layerInfo.layerObject.url)b=new q(e,g);else return this._layerInfo.layerObject&&this._layerInfo.layerObject.featureCollectionData?(b=new q(this._layerInfo.layerObject.featureCollectionData,g),this._setLayerObjectProperties(b),c.resolve(b)):c.resolve(null),c;break;case "GroupLayer":return c=this._getGroupLayerObject();default:return c.resolve(null),c}var d=b.on("load",f.hitch(this,function(){this._setLayerObjectProperties(b);
c.resolve(b);d.remove&&d.remove()})),m=b.on("error",f.hitch(this,function(a){c.reject(a);m.remove&&m.remove()}))}),f.hitch(this,function(){c.reject()}));return c},_getGroupLayerObject:function(){var e=new p;this._layerInfo._getServiceDefinition().then(f.hitch(this,function(b){if(null===b)e.reject();else{var c=this._layerInfo.getUrl();b.url=c;b.id=this._layerInfo.id;e.resolve(b)}}));return e},_getLayerOptionsForCreateLayerObject:function(){var e={},b=[],c=this._layerInfo.getInfoTemplate();c&&c.info&&
c.info.fieldInfos?l.forEach(c.info.fieldInfos,function(a){a.visible&&b.push(a.fieldName)},this):b=["*"];e.outFields=b;return e},_setLayerObjectProperties:function(e){e.name&&!f.getObject("_wabProperties.originalLayerName",!1,e)&&(f.setObject("_wabProperties.originalLayerName",e.name,e),e.name=this._layerInfo.title);e.id=this._layerInfo.id;this._layerInfo.loadInfoTemplate().then(f.hitch(this,function(b){e.infoTemplate=b}))}})})},"esri/layers/RasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../kernel ../lang ../domUtils ./BaseRasterLayer ./ImageServiceLayerMixin ./pixelFilters/StretchFilter ../SpatialReference ../geometry/Point".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d){r=r([b,m],{declaredClass:"esri.layers.RasterLayer",constructor:function(a,d){this.pixelData=null;null!==this.format&&void 0!==this.format||this.setImageFormat("LERC",!0)},_setDefaultFilter:function(){if(this.loaded&&this.drawType&&!this._isVectorData()&&(!this.pixelFilter||this._isDefaultPixelFilter))if("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))this._isDefaultPixelFilter&&(this.pixelFilter=
null,this._isDefaultPixelFilter=!1);else{var d,b;if(this.minValues&&this.maxValues&&this.stdvValues&&this.meanValues){d=[];for(b=0;b<this.minValues.length;b++)d.push([this.minValues[b],this.maxValues[b],this.meanValues[b],this.stdvValues[b]]);this.bandCount!==d.length&&(d=null)}b=0;var e=!1;"U8"===this.pixelType?(b=5,e=d?!1:!0):d?(b=5,e=!1):(b=6,e=!0);this.renderingRule&&(b=5,e=!0);this.pixelFilter=(new a({stretchType:b,min:0,max:255,dra:e,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,
statistics:d,numberOfStandardDeviations:2.5})).filter;this._isDefaultPixelFilter=!0}}});c("extend-esri")&&f.setObject("layers.RasterLayer",r,h);return r})},"esri/layers/BaseRasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojox/gfx/matrix ../kernel ../config ../lang ../domUtils ../geometry/Point ./layer".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m,a){var g=t.defaults.map.zoomDuration;return r([a],
{declaredClass:"esri.layers.BaseRasterLayer",managedSuspension:!0,opacity:1,constructor:function(a,b){this.drawMode=b&&void 0!==b.drawMode?b.drawMode:!0;this.drawType=b&&b.drawType?b.drawType:"2d";this.pixelData=null;this._initialize(a,b)},setDrawMode:function(a){this.drawMode=a},setOpacity:function(a){this.opacity!==a&&(this.opacity=a,this.onOpacityChange(a))},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>c("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));
else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(){this._canDraw()&&"2d"===this.drawType&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();if("css-transforms"===this._map.navigationMode){var a=this._map.__visibleDelta;this._left=this._tdx=a.x;this._top=this._tdy=a.y;n.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top))}this._displayTimer=
this._displayTimer||setTimeout(f.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getCurrentResolution:function(){var a=this._map.extent;return new m((a.xmax-a.xmin)/this._map.width,(a.ymax-a.ymin)/this._map.height,a.spatialReference)},setPixelFilter:function(a,
b){this.pixelFilter=a;b||this.redraw()},_toggleTime:function(){},_setMap:function(a,b){this.inherited(arguments);this._dragOrigin={x:0,y:0};var d=this._div=q.create("div",null,b),g={width:a.width+"px",height:a.height+"px",position:"absolute"};"css-transforms"===a.navigationMode?(g[h._css.names.transform]=h._css.translate(a.__visibleDelta.x,a.__visibleDelta.y),this._left=a.__visibleDelta.x,this._top=a.__visibleDelta.y):this._left=this._top=0;n.set(d,g);this._canvas=q.create("canvas",{id:"canvas",width:a.width+
"px",height:a.height+"px",style:"position: absolute;"},d);e.isDefined(this.opacity)&&n.set(d,"opacity",this.opacity);(this._context=this._canvas.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=a.width;this._mapHeight=a.height;this._connects=[];this._connects.push(l.connect(a,"onPan",this,this._panHandler));this._connects.push(l.connect(a,"onPanEnd",this,this._panEndHandler));"css-transforms"===a.navigationMode?
this._connects.push(l.connect(a,"onScale",this,this._onScaleHandler)):(this._connects.push(l.connect(a,"onZoom",this,this._onZoomHandler)),this._connects.push(l.connect(a,"onZoomEnd",this,this._onZoomEndHandler)));this._connects.push(l.connect(a,"onResize",this,this._onResizeHandler));this._connects.push(l.connect(a,"onExtentChange",this,this._extentChangeHandler));this._connects.push(l.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(l.connect(this,"onOpacityChange",
this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:a.width,height:a.height};this.evaluateSuspension();if(this.suspended&&!a.loaded)var c=l.connect(a,"onLoad",this,function(){l.disconnect(c);c=null;this.evaluateSuspension()});return d},_unsetMap:function(a,b){p.forEach(this._connects,l.disconnect,this);var d=this._div;d&&(b.removeChild(d),q.destroy(d));this.updating&&a._jobs&&a._jobs--;this._rasterReadPromise&&this._rasterReadPromise.cancel();this._map=this._canvas=this._context=
this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_drawPixelData:function(){if(this._map){this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};var a=this._useBrowserDecoding();!a&&this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=
this._left,this._tdy=this._top,this._multiply=null,n.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top)),n.set(this._canvas,h._css.names.transform,h._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});if(this._canDraw&&this.drawMode)if(a)this._fireUpdateEnd();else if(this.drawMode)if(this.pixelData&&this.pixelData.pixelBlock){var a=this.pixelData.pixelBlock,b=this._context,e=b.createImageData(a.width,a.height);e.data.set(a.getAsRGBA());var g=this.pixelData.extent,
c=this._map.extent,m=this.getCurrentResolution(),f=0,k=0;Math.abs(g.xmin-c.xmin)>m.x&&(f=Math.round((g.xmin-c.xmin)/m.x));Math.abs(c.ymax-g.ymax)>m.y&&(k=Math.round((c.ymax-g.ymax)/m.y));this.clear();"css-transforms"===this._map.navigationMode?(this._tdx=this._left,this._tdy=this._top,this._multiply=null,n.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top)),n.set(this._canvas,h._css.names.transform,h._css.translate(-this._left,-this._top))):(n.set(this._div,{left:"0px",top:"0px",
width:this._map.width+"px",height:this._map.height+"px"}),n.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};b.putImageData(e,f,k,0,0,a.width,a.height);this._fireUpdateEnd()}else this.clear()}},_panHandler:function(a,b){"css-transforms"===this._map.navigationMode?(this._left=this._map.__visibleDelta.x+b.x,this._top=this._map.__visibleDelta.y+b.y,n.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top))):
n.set(this._div,{left:this._startRect.left+b.x+"px",top:this._startRect.top+b.y+"px"})},_panEndHandler:function(a,b){b&&(this._startRect.left+=b.x,this._startRect.top+=b.y)},_onScaleHandler:function(a,b){var d={},e=h._css.names;n.set(this._canvas,e.transition,b?"none":e.transformName+" "+g+"ms ease");this._matrix=a;a=this._multiply?k.multiply(a,this._multiply):a;if(this._tdx||this._tdy)a=k.multiply(a,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});d[e.transform]=h._css.matrix(a);n.set(this._canvas,
d)},_onZoomHandler:function(a,b,e){var d=this._startRect;a=d.width*b;b*=d.height;var g=d.left-(a-d.width)*(e.x-d.left)/d.width;e=d.top-(b-d.height)*(e.y-d.top)/d.height;n.set(this._canvas,{left:g+"px",top:e+"px",width:a+"px",height:b+"px"});this._endRect={left:g,top:e,width:a,height:b}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(a,b,e){n.set(this._div,{width:b+"px",height:e+"px"});n.set(this._canvas,{width:b+"px",height:e+"px"});this._startRect.width=
this._canvas.width=b;this._startRect.height=this._canvas.height=e},_extentChangeHandler:function(a,b,e,g){this.suspended||b&&0===b.x&&0===b.y&&!e||("css-transforms"===this._map.navigationMode&&(b&&(this._dragOrigin.x+=b.x,this._dragOrigin.y+=b.y),e||(this._left=this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,n.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top))),e&&(n.set(this._canvas,h._css.names.transition,"none"),this._multiply=this._multiply?k.multiply(this._matrix,
this._multiply):this._matrix)),this._fireUpdateStart(),a=this._map,this._requestData(a.extent,a.width,a.height))},_visibilityChangeHandler:function(a){a?b.show(this._div):b.hide(this._div)},_opacityChangeHandler:function(a){n.set(this._div,"opacity",a)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query dojo/DeferredList ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C,D,y,w,A,G,E,F,H,L,N){r=r(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_rasterFunctionServiceInfoProps:"bandCount pixelType hasRasterAttributeTable hasHistograms minValues maxValues meanValues stdvValues serviceDataType".split(" "),_pixelTypeRanges:{U1:[0,1],U2:[0,3],U4:[0,15],U8:[0,255],S8:[-128,127],U16:[0,65535],S16:[-32768,32767]},_eventMap:{"rendering-change":!0,
"mosaic-rule-change":!0,"spatial-reference-change":!0,"renderer-change":!0},constructor:function(a,d){this.useMapTime=d&&d.hasOwnProperty("useMapTime")?!!d.useMapTime:!0},_initialize:function(b,e){this._url=d.urlToObject(b);this.raster=new y(this._url.path);this._rasterFunctionTemplateInfos={};this._customRenderingRuleId={};this.infoTemplate=e&&e.infoTemplate;this.format=(b=e&&e.imageServiceParameters)&&b.format;this.compressionTolerance=b&&b.compressionTolerance?b.compressionTolerance:.01;this.interpolation=
b?b.interpolation:null;this.compressionQuality=b?b.compressionQuality:null;this.bandIds=b?b.bandIds:null;this.mosaicRule=b?b.mosaicRule:null;this.renderingRule=b?b.renderingRule:null;this.renderer=b?b.renderer:null;this.useMapDimensionValue=e&&e.hasOwnProperty("useMapDimensionValue")?!!e.useMapDimensionValue:!0;this.hasImageFilter=e&&e.hasImageFilter;this.activeMapDimensions=e&&e.activeMapDimensions;this._params=f.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,
compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},b?b.toJson():{});this.pixelFilter=e&&e.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=f.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=f.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=f.hitch(this,this._initLayer);this._queryVisibleRastersHandler=f.hitch(this,this._queryVisibleRastersHandler);
this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=e&&e.loadCallback;b&&b.renderer&&(b.renderer.outputUnit||b.renderer.inputUnit)&&(this.vectorFieldPixelFilter=new A,this.vectorFieldPixelFilter.setUnits(b.renderer.inputUnit,b.renderer.outputUnit));(e=e&&e.resourceInfo)?this._initLayer(e):a({url:this._url.path,content:f.mixin({f:"json"},this._url.query),callbackParamName:"callback",
load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,d){if(null!==a&&void 0!==a){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();d=this.minScale;var b=this.maxScale;f.mixin(this,a);this.minScale=d;this.maxScale=b;this.initialExtent=this.fullExtent=this.extent=new u(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=
parseFloat(this.pixelSizeY);var e=this.minValues,g=this.maxValues,c=this.meanValues,h=this.stdvValues,k=this.bands=[];d=0;for(b=this.bandCount;d<b;d++)k[d]={min:e[d],max:g[d],mean:c[d],stddev:h[d]};this.timeInfo=(d=this.timeInfo)&&d.timeExtent?new E(d):null;b=this.fields=[];if(e=a.fields)for(d=0;d<e.length;d++)b.push(new F(e[d]));this._updateInfoTemplateFields(this.fields);this.version=a.currentVersion;this.version||(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);m.isDefined(a.minScale)&&
!this._hasMin&&this.setMinScale(a.minScale);m.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);d={};a.defaultMosaicMethod?(d.method=a.defaultMosaicMethod,d.operation=a.mosaicOperator,d.sortField=a.sortField,d.sortValue=a.sortValue):d.method=z.METHOD_NONE;this.defaultMosaicRule=new z(d);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===this.serviceDataType;this._setDefaultRenderingRule(!0);this.renderingRule&&
this.getRenderingRuleServiceInfo(this.renderingRule).then(f.hitch(this,function(a){a.hasRasterAttributeTable&&this.getRenderingRuleAttributeTable({renderingRule:this.renderingRule}).then(f.hitch(this,function(){!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh()}))}));this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);
10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(f.hitch(this,function(a){a&&(a.features&&a.fields&&(this.rasterAttributeTable=f.clone(a)),a.features&&0<a.features.length&&(this._rasterAttributeTableFeatures=f.clone(a.features)),a.fields&&0<a.fields.length&&(this._rasterAttributeTableFields=f.clone(a.fields)),this.renderingRule||!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||
this.refresh())}));this._initVectorPixelFilter();10.3<=this.version&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&this.getRasterFunctionInfos().then(f.hitch(this,function(a){if(a&&a.length){this.rasterFunctionInfos=a;var d=[],b;p.forEach(a,function(a){if(a){var e=a.functionType;b=b||1===e||2===e;d.push(a.name)}},this);this._hasItemLevelRFT=b;this._rasterFunctionNames=d;b&&(this._initVectorPixelFilter(),this.refresh())}}));this.loaded=!0;this._setDefaultFilter();this.onLoad(this);if(a=
this._loadCallback)delete this._loadCallback,a(this)}},_updateInfoTemplateFields:function(a){if(a&&!(1>a.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var d,b,e,g;g=this.infoTemplate.info.fieldInfos;for(d=0;d<a.length;d++)for(e=a[d],b=0;b<g.length;b++)if(g[b].fieldName.toLowerCase()===e.name.toLowerCase()&&g[b].fieldName!==e.name){g[b].fieldName=e.name;break}}},getKeyProperties:function(d){var b=this._url.path+
"/keyProperties",e=new l(g._dfdCanceller),m={f:"json"};d&&d.renderingRule&&(m.renderingRule=c.toJson(d.renderingRule.toJson()));10<this.version?(e._pendingDfd=a({url:b,content:m,handleAs:"json",callbackParamName:"callback"}),e._pendingDfd.then(function(a){e.callback(a)},function(a){e.errback(a)})):(d=Error("Layer does not have key properties"),d.log=!!q.isDebug,e.errback(d));return e},getRasterAttributeTable:function(d){var b=this._url.path+"/rasterAttributeTable",e=new l(g._dfdCanceller),m={f:"json"},
h=this.hasRasterAttributeTable;d&&d.renderingRule&&(m.renderingRule=c.toJson(d.renderingRule.toJson()),h=!0);10<this.version&&h?(e._pendingDfd=a({url:b,content:m,handleAs:"json",callbackParamName:"callback"}),e._pendingDfd.then(function(a){e.callback(a)},function(a){e.errback(a)})):(d=Error("Layer does not support raster attribute table"),d.log=!!q.isDebug,e.errback(d));return e},getRenderingRuleAttributeTable:function(a){var d=new l(g._dfdCanceller);if(!a||!a.renderingRule)return d.errback(Error("Rendering rule is not specified")),
d;a=a.renderingRule;var b=this._getRenderingRuleId(a);this._renderingRuleAttributeTable&&b&&this._renderingRuleAttributeTable.hasOwnProperty(b)?d.resolve(this._renderingRuleAttributeTable[b]):d=this.getRasterAttributeTable({renderingRule:a}).then(f.hitch(this,function(a){var d;a&&a.features&&a.features.length&&a.fields&&a.fields.length&&(d={features:f.clone(a.features),fields:f.clone(a.fields)},b&&(this._renderingRuleAttributeTable[b]=d));return d}));return d},_initVectorPixelFilter:function(){var a;
this._hasItemLevelRFT&&this.renderingRule&&(a=this._getItemLevelRenderingRule(this.renderingRule));if(a=a||this.renderingRule)return this.getRenderingRuleServiceInfo(a).then(f.hitch(this,function(a){a&&this._isVectorData(a)&&!m.isDefined(this.pixelFilter)&&"esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&(this.vectorFieldPixelFilter=this.vectorFieldPixelFilter||new A,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===a.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,
this.getKeyProperties().then(f.hitch(this,this._setFlowRepresentation)),this._applyVectorResamplingType(a.serviceDataType))}))},_applyVectorResamplingType:function(a){if(a){var d=this.renderingRule;d&&"Resample"===d.functionName&&((d.functionArguments||{}).ResamplingType="esriImageServiceDataTypeVector-UV"===a?7:10,this.setRenderingRule(new C(d.toJson())))}},_getRasterAttributeTableFeatures:function(){var a=new l;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),
a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(f.hitch(this,function(a){a&&a.features&&0<a.features.length&&(this._rasterAttributeTableFeatures=f.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},_getRenderingRuleAttributeTableFeatures:function(a){a=a&&a.renderingRule;return a?this.getRenderingRuleAttributeTable({renderingRule:a}).then(function(a){return a&&a.features}):(a=new l,a.errback(Error("Rendering rule is not specified")),
a)},getCustomRasterFields:function(a){var d=a?a.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;a=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var b={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:a},e={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:a},g={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,
editable:!1,length:50,type:"esriFieldTypeDouble"},c=this.fields?f.clone(this.fields):[];a=c.length;c[a]=e;10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRenderingRuleAProcessingTemplate({functionName:"none"}))&&(a++,c[a]=g);if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)a++,c[a]=b;!m.isDefined(this.pixelFilter)||"esriImageServiceDataTypeVector-UV"!==
this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(b={name:this._rasterFieldPrefix+"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},e={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},a++,c[a]=b,a++,c[a]=e);a=this._rasterAttributeTableFields;(b=this.renderingRule&&this._getRenderingRuleId(this.renderingRule))&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(b)&&
(a=this._renderingRuleAttributeTable[b].fields);a&&0<a.length&&(a=p.filter(a,function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}),a=p.map(a,function(a){var b=f.clone(a);b.name=d+a.name;return b}),c=c.concat(a));var h=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&p.forEach(this.rasterFunctionInfos,function(a){a&&a.name&&"none"!==a.name.toLowerCase()&&(a={name:h+a.name.replace(/ /gi,"_"),alias:a.name,domain:null,editable:!1,
type:"esriFieldTypeDouble"},c.push(a))});return c},_applyTimeToMultidimensionalCRF:function(a,d){var b=this.timeInfo&&this.timeInfo.startTimeField;if((d=d||this._params.time)&&b&&this._isMultidimensionalCRF()){a=f.clone(a||this.defaultMosaicRule)||new z;a.multidimensionalDefinition=a.multidimensionalDefinition||[];var e=a.multidimensionalDefinition.filter(function(a){return a.dimensionName===b}),g=d.split(",").map(function(a){return parseInt(a,10)});0<e.length?a.multidimensionalDefinition.forEach(function(a){a.dimensionName===
b&&(a.isSlice=1===g.length,a.values=1===g.length?g:[g])}):a.multidimensionalDefinition.push(new D({dimensionName:b,isSlice:1===g.length,values:1===g.length?g:[g]}))}return a},_prepareGetImageParameters:function(a,d,b,e){e=m.isDefined(e)?e:this._params;if(this.renderer||this._hasItemLevelRFT&&this.renderingRule){var g=this.getExportImageRenderingRule();e.renderingRule=g?c.toJson(g.toJson()):null}g=this.getExportImageMosaicRule(e);e.mosaicRule=g?c.toJson(g.toJson()):null;g=a.spatialReference.wkid||
c.toJson(a.spatialReference.toJson(!1));delete e._ts;f.mixin(e,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:g,bboxSR:g,size:d+","+b},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete e.compressionTolerance;e.format&&"LERC"===e.format.toUpperCase()&&(e.compressionTolerance=this.compressionTolerance);e.token=this._getToken()},getImageUrl:function(e,g,c,u,k){k=m.isDefined(k)?k:this._params;this._prepareGetImageParameters(e,g,c,k);e=f.clone(k);this._cleanupRequestParams(e);g=this._url.path+
"/exportImage?";c=d.addProxy(g+h.objectToQuery(f.mixin(e,{f:"image"})));var t=e.token;c.length>b.defaults.io.postLength||this.useMapImage?this._jsonRequest=a({url:g,content:f.mixin(e,{f:"json"}),callbackParamName:"callback",load:function(a,b){a=a.href;t&&(a+=-1===a.indexOf("?")?"?token\x3d"+t:"\x26token\x3d"+t);u(d.addProxy(a))},error:this._errorHandler}):u(c)},onRenderingChange:function(){},onMosaicRuleChange:function(){},onRendererChange:function(){},setInterpolation:function(a,d){this.interpolation=
this._params.interpolation=a;d||this.refresh(!0)},setCompressionQuality:function(a,d){this.compressionQuality=this._params.compressionQuality=a;d||this.refresh(!0)},setCompressionTolerance:function(a,d){this.compressionTolerance=a;d||this.refresh(!0)},setBandIds:function(a,d){var b=!1;this.bandIds!==a&&(b=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(b&&!d)this.onRenderingChange();d||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},
setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,d){var b=!1;this.mosaicRule!==a&&(b=!0);this.mosaicRule=a;this._params.mosaicRule=c.toJson(a.toJson());if(b&&!d)this.onMosaicRuleChange();d||this.refresh(!0)},getRasterFunctionInfos:function(){if(10.3>this.version||!this.rasterFunctionInfos||!this.rasterFunctionInfos.length)console.log("Layer doesn't support /rasterFunctionInfos resource.");else return a({url:this._url.path+"/rasterFunctionInfos",content:{f:"json"},
handleAs:"json",load:function(a){return a&&a.rasterFunctionInfos}})},setRenderingRule:function(a,d){var b=!1;this.renderingRule!==a&&(b=!0);this.renderingRule=a;this._params.renderingRule=a?c.toJson(a.toJson()):null;this._useRenderingRuleAttributeTable&&this.getRenderingRuleAttributeTable({renderingRule:a});if(b)this.onRenderingChange();this._setDefaultFilter();d||this.refresh(!0)},setImageFormat:function(a,d){this.format=this._params.format=a;this._setDefaultFilter();d||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=
a;this._updateInfoTemplateFields(this.fields)},setDefinitionExpression:function(a,d){var b=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?b=this.defaultMosaicRule.toJson():b.method=z.METHOD_NONE);b.where=a;a=new z(b);this.setMosaicRule(a,d);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(a){this.pixelFilter=a;this._isDefaultPixelFilter=!1},getPixelData:function(a){return a?(this._useBrowserDecoding()&&
(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},getExportImageRenderingRule:function(){var a;this._hasItemLevelRFT&&this.renderingRule&&(a=this._getServiceLevelRenderingRule(this.renderingRule));a=a||this.renderingRule;this._isItemLevelRasterFunction(this.renderingRule)&&(a=void 0);return this._combineRenderingRule(this._convertRendererToRenderingRule(this.renderer),
a)},getExportImageMosaicRule:function(){var a=this.mosaicRule,d;this._hasItemLevelRFT&&this.renderingRule&&(d=this._getItemLevelRenderingRule(this.renderingRule));d&&(a=a||this.defaultMosaicRule||new z,a.itemRenderingRule=d);return a=this._applyTimeToMultidimensionalCRF(a)},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getHistograms:function(){var d=new l(g._dfdCanceller);if(this.hasHistograms)d._pendingDfd=a({url:this._url.path+"/histograms",content:{f:"json"},
handleAs:"json",callbackParamName:"callback"}),d._pendingDfd.then(function(a){d.callback(a)},function(a){d.errback(a)});else{var b=Error("Layer does not have histograms.");b.log=!!q.isDebug;d.errback(b)}return d},computeHistograms:function(d){var b=new l(g._dfdCanceller);if(10.1<=this.currentVersion){d=d||{};var e=d.geometry||this.fullExtent,c=(d.geometry||this.fullExtent).toJson(),e="extent"===e.type?"esriGeometryEnvelope":"esriGeometryPolygon",m=d.renderingRule||this.renderingRule||this.defaultRenderingRule,
m=m?m.toJson():null,h=d.mosaicRule||this.mosaicRule||this.defaultMosaicRule,h=h?h.toJson():null;d=d.pixelSize||{x:this.pixelSizeX,y:this.pixelSizeY};b._pendingDfd=a({url:this._url.path+"/computeHistograms",content:f.mixin({f:"json",geometry:JSON.stringify(c),geometryType:e,renderingRule:JSON.stringify(m),mosaicRule:JSON.stringify(h),pixelSize:JSON.stringify(d),callbackParamName:"callback"}),handleAs:"json"});b._pendingDfd.then(function(a){b.callback(a)},function(a){b.errback(a)})}else c=Error("Layer doesn't support computeHistograms."),
c.log=!!q.isDebug,b.errback(c);return b},getRenderingRuleServiceInfo:function(d){var b=new g._fixDfd(new l(g._dfdCanceller));if(!d)return b.errback(Error("Rendering rule is not specified")),b;var e=this._getRenderingRuleId(d);return e&&this._rasterFunctionTemplateInfos[e]?(b.resolve(this._rasterFunctionTemplateInfos[e]),b):a({url:this._url.path,content:f.mixin(f.mixin({f:"json",renderingRule:JSON.stringify(d.toJson())},this._url.query)),callbackParamName:"callback",load:f.hitch(this,function(a){var d=
{};p.forEach(this._rasterFunctionServiceInfoProps,function(b){d[b]=a[b]});return this._rasterFunctionTemplateInfos[e]=d}),error:this._errorHandler})},queryVisibleRasters:function(a,d,b,e){var c=this._map,m=g._fixDfd(new l(g._dfdCanceller));this._visibleRasters=[];var h,u,k=!0,t=!0,n=null,q=this.infoTemplate?this.infoTemplate.info:null,w=q?f.clone(this.infoTemplate.info.fieldInfos):null;d=d||{};if(q&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var B=[];p.forEach(this.infoTemplate.info.mediaInfos,
function(a){B=B.concat(a&&a.value&&a.value.fields||[])});B.length&&p.forEach(w,function(a){a&&-1<B.indexOf(a.fieldName)&&(a.visible=!0)})}if(w&&0<w.length)for(k=!1,h=0;h<w.length;h++)if((u=w[h])&&u.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(u.visible||q.title&&-1<q.title.toLowerCase().indexOf(u.fieldName.toLowerCase()))){k=!0;break}this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("returnTopmostRaster")&&
(n=this.infoTemplate.info.layerOptions.returnTopmostRaster?1:null);w&&0<w.length&&(t=!1,p.some(w,function(a){if(a&&a.fieldName.toLowerCase()===this._rasterFieldPrefix.toLowerCase()+"itempixelvalue"&&a.visible)return t=!0},this));var D=(u=this._removeVisualizationStretchFunction(this.renderingRule))&&u.functionName,z=[];if(10.4<=this.version){var y=!1;if(this.rasterFunctionInfos&&w){var r=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;p.forEach(this.rasterFunctionInfos,function(a){var d=
r+a.name.replace(/ /gi,"_");p.some(w,function(a){return a.visible&&a.fieldName===d})&&(y=y||D&&D===a.name,z.push(new C({rasterFunction:a.name})))})}u&&!y&&z.push(u)}h=new N;h.geometry=a.geometry;h.returnGeometry=this._map.spatialReference.equals(this.spatialReference);h.returnCatalogItems=k;h.timeExtent=a.timeExtent;h.returnPixelValues=t;h.maxItemCount=n||a.maxItemCount;this._params.time&&this.mosaicRule?(a=f.clone(this.mosaicRule),a=this._filterOutTimeDimension(a),h.mosaicRule=a):h.mosaicRule=this.mosaicRule||
null;this._isMultidimensionalCRF()&&h.timeExtent&&(h.mosaicRule=this._applyTimeToMultidimensionalCRF(h.mosaicRule,h.timeExtent.toJson().join(",")),delete h.timeExtent);h.renderingRule=10.4>this.version&&u||null;h.renderingRules=z||null;10.61>this.version&&(h.returnPixelValues=void 0,h.maxItemCount=void 0);c&&(c=new v((c.extent.xmax-c.extent.xmin)/c.width,(c.extent.ymax-c.extent.ymin)/c.height,c.extent.spatialReference),h.pixelSize=c);d.requestParams=h;var A=this,c=new L(this.url);(m._pendingDfd=c.execute(h)).addCallbacks(function(a){A._queryVisibleRastersHandler(a,
d,b,e,m)},function(a){A._resolve([a],null,e,m,!0)});return m},_queryVisibleRastersHandler:function(d,b,e,g,h){function k(){var a=this.getCustomRasterFields(b),d=this._getDomainFields(a),g=b?b.returnDomainValues:!1,c=b&&b.rasterAttributeTableFieldPrefix,k,l,B,D,z,y,C,r,G,F,a=(a=this._getRenderingRuleId(this.renderingRule))&&this._rasterFunctionTemplateInfos[a];this.renderingRule&&(this._useRenderingRuleAttributeTable||a)?(a=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),
this.hasRasterAttributeTable||(F=t)):a=this._getRasterAttributeTableFeatures();a.then(f.hitch(this,function(a){for(k=0;k<v.length;k++){O=v[k];O.setInfoTemplate(this.infoTemplate);O._layer=this;if(t){G=t.replace(/ /gi,"").split(",");l=t;B=G;q&&q.length>=k&&(l=q[k].replace(/ /gi,", "),B=q[k].split(" "));O.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=B;O.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=G;n&&(O.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=n.replace(/ /gi,
"").split(","));if(this.pixelFilter){var b=new w({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});p.forEach(B,function(a){b.addData({pixels:[a],statistics:{minValue:a,maxValue:a,noDataValue:null}})});this.pixelFilter({pixelBlock:b,extent:new u(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)O.attributes[this._rasterFieldPrefix+"Magnitude"]=b.pixels[0][0],O.attributes[this._rasterFieldPrefix+
"Direction"]=b.pixels[1][0]}p.forEach(A,function(a){O.attributes[a.name]=a.value});var E;E=0<this.fields.length?F||l:F||n;if(a&&0<a.length&&(D=p.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==E:a.attributes.VALUE==E}),0<D.length&&(z=f.clone(D[0]),c&&z))){r={};for(y in z.attributes)z.attributes.hasOwnProperty(y)&&(C=c+y,r[C]=z.attributes[y]);z.attributes=r;O.attributes=f.mixin(O.attributes,z.attributes)}}g&&d&&0<d.length&&p.forEach(d,function(a){if(a){var d=
O.attributes[a.name];m.isDefined(d)&&(d=this._getDomainValue(a.domain,d),m.isDefined(d)&&(O.attributes[a.name]=d))}},this);K.push(O);this._visibleRasters.push(O)}this._resolve([K,null,!0],null,e,h)}))}var t=d.value,n=d.value,q,v,l=0,D=0,z=this,y=this.objectIdField,C,r,A=[];g=b.requestParams.renderingRules;var G=d.processedValues,F=this.renderingRule&&c.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());if(g&&G&&g.length===G.length){var E=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;
p.forEach(g,function(a,d){if(a.functionName){var b={name:E+a.functionName.replace(/ /gi,"_"),value:G[d].replace(/ /gi,"").split(",")};A.push(b);F&&F===c.toJson(a.toJson())&&(t=G[d])}})}g=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(d.catalogItems){var N=0,M,L,J=d.catalogItems.features.length;r=0;v=Array(J);q=Array(J);C=Array(J);if(d.properties&&
d.properties.Values){J=d.properties.Values.length;for(l=0;l<J;l++)-1<d.properties.Values[l].toLowerCase().indexOf("nodata")&&r++;M=J-r;for(l=0;l<J;l++)r=!0,-1<d.properties.Values[l].toLowerCase().indexOf("nodata")?(L=M++,g||(r=!1,v.length--,q.length--,C.length--)):L=N++,r&&(v[L]=d.catalogItems.features[l],q[L]=d.properties.Values[l],C[L]=v[L].attributes[y])}else{for(l=0;l<J;l++)v[l]=d.catalogItems.features[l],C[l]=v[l].attributes[y];q=null}}this._visibleRasters=[];var O;(d=-1<t.toLowerCase().indexOf("nodata"))&&
!g&&(v=[],q=[],C=[]);!t||v||d||(y="ObjectId",v=[],O=new H(new u(this.fullExtent),null,{ObjectId:0}),v.push(O));var K=[];v?!this._map.spatialReference.equals(this.spatialReference)&&C&&0<C.length?a({url:this._url.path+"/query",content:{f:"json",objectIds:C.join(","),returnGeometry:!0,outSR:c.toJson(z._map.spatialReference.toJson()),outFields:y},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===a.features.length)z._resolve([K,null,null],null,e,h);else{for(l=0;l<a.features.length;l++)for(D=
0;D<v.length;D++)v[D].attributes[y]==a.features[l].attributes[y]&&(v[D].geometry=new B(a.features[l].geometry),v[D].geometry.setSpatialReference(z._map.spatialReference));k.call(z)}},error:function(a){z._resolve([K,null,null],null,e,h)}}):k.call(this):this._resolve([K,null,null],null,e,h)},getVisibleRasters:function(){var a=this._visibleRasters,d=[],b;for(b in a)a.hasOwnProperty(b)&&d.push(a[b]);return d},_getDomainFields:function(a){if(a){var d=[];p.forEach(a,function(a){if(a.domain){var b={};b.name=
a.name;b.domain=a.domain;d.push(b)}});return d}},_getDomainValue:function(a,d){if(a&&a.codedValues){var b;p.some(a.codedValues,function(a){return a.code===d?(b=a.name,!0):!1});return b}},_requestData:function(a,d,b){this._rasterReadPromise&&this._rasterReadPromise.cancel();a=f.clone(a);var e=a._normalize(!0);this._prepareGetImageParameters(e,d,b);d=f.clone(this._params);this._cleanupRequestParams(d);d.extent=a;d.format=d.format||(10.3<=this.version?"lerc":"jpgpng");"lerc"===d.format.toLowerCase()&&
!d.lercVersion&&10.5<=this.version&&(d.lercVersion=2);this._params.time&&this._isMultidimensionalCRF()&&delete d.time;b=null;this._useBrowserDecoding()&&(b=new G({ctx:this._context}));d={imageServiceParameters:d,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:b?f.hitch(b,"decode"):null};this._rasterReadPromise=this.raster.read(d,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(a){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||
(this.originalPixelData=a,this.hasDataChanged=!0,this._setPixelData(a))},_setPixelData:function(a){a=this._clonePixelData(a);this.pixelFilter&&this.pixelFilter(a);this.pixelData=a;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this._drawPixelData(),this._rasterReadPromise=null)},_clonePixelData:function(a){if(null===a||void 0===a)return a;var d={};a.extent&&(d.extent=f.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return d;d.pixelBlock=a.clone();return d},_setDefaultFilter:function(){},
_getPixelBlockFromCanvas:function(a,d,b){a=a.getImageData(0,0,d,b).data;for(var e=d*b,g=0,c=0,m=new Uint8Array(e),h=new Uint8Array(e),f=new Uint8Array(e),u=new Uint8Array(e),k=Infinity,t=Infinity,n=Infinity,q=-Infinity,p=-Infinity,v=-Infinity,l,B,D,g=0;g<e;g++)l=a[c++],B=a[c++],D=a[c++],k=k<l?k:l,q=q>l?q:l,t=t<B?t:B,p=p>B?p:B,n=n<D?n:D,v=v>D?v:D,m[g]=l,h[g]=B,f[g]=D,u[g]=a[c++]&1;return new w({width:d,height:b,pixels:[m,h,f],pixelType:"U8",mask:u,statistics:[{minValue:k,maxValue:q},{minValue:t,maxValue:p},
{minValue:n,maxValue:v}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var d=this._url.path+"/multiDimensionalInfo",b=new l(g._dfdCanceller);if(this._multidimensionalInfo)return b.resolve(this._multidimensionalInfo),b;10.3<=this.version&&this.hasMultidimensions?(b._pendingDfd=a({url:d,content:{f:"json"},
handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(f.hitch(this,function(a){this._multidimensionalInfo=a.multidimensionalInfo;b.callback(a.multidimensionalInfo)}),function(a){b.errback(a)})):(d=Error("Layer does not support multidimensional info"),d.log=!!q.isDebug,b.errback(d));return b},getDefaultMultidimensionalDefinition:function(){var a,d,b,e=[],c=new l(g._dfdCanceller),m;if(this._defaultMultidimensionalDefinition)return c.resolve(f.clone(this._defaultMultidimensionalDefinition)),
c;c._pendingDfd=this.getMultidimensionalInfo();c._pendingDfd.then(f.hitch(this,function(g){a=g;d=a.variables[0].dimensions;for(b in d)d.hasOwnProperty(b)&&"StdTime"!==d[b].name&&(m=d[b],e.push(new D({variableName:"",dimensionName:m.name,isSlice:!m.hasRanges,values:[this._getDefaultDimensionValue(m)]})));this._defaultMultidimensionalDefinition=e;c.callback(f.clone(e))}),function(a){c.errback(a)});return c},_getDefaultDimensionValue:function(a){if(a&&a.values&&a.values.length){var d,b,e=Infinity,g,
c;if(a.hasRanges)return a.values[0];if(a.name&&"stdz"===a.name.toLowerCase()){for(c=0;c<a.values.length&&(g=a.values[c],b=Math.abs(g-0),b<e&&(e=b,d=g),0!==b);c++);return d}return a.extent[0]}},_setDefaultMultidimensionalDefinition:function(a){var d,b={};this.getDefaultMultidimensionalDefinition().then(f.hitch(this,function(e){d=e;0<d.length&&(this.mosaicRule?(b=f.clone(this.mosaicRule),b.multidimensionalDefinition=d):this.defaultMosaicRule?(b=f.clone(this.defaultMosaicRule),b.multidimensionalDefinition=
d):b=new z({multidimensionalDefinition:d}),this.setMosaicRule(b,a))}))},_setDefaultRenderingRule:function(a){var d={},b=this.renderingRule;if(!b&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&!this.bandIds&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())d.rasterFunction=this.rasterFunctionInfos[0].name;else if("esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version&&(!b||"Resample"!==
b.functionName)){var e="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;d.rasterFunction="Resample";d.rasterFunctionArguments={ResamplingType:e,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}};b&&(d.rasterFunctionArguments.Raster=b.toJson())}d.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new C(d),this.setRenderingRule(this.defaultRenderingRule,a))},_cleanupRequestParams:function(a){if(!a)return a;if(a.time&&a.mosaicRule){var d=new z(c.fromJson(a.mosaicRule)),d=this._filterOutTimeDimension(d);
a.mosaicRule=c.toJson(d.toJson())}var d="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent renderer".split(" "),b;for(b in d)a.hasOwnProperty(d[b])&&delete a[d[b]];return a},_filterOutTimeDimension:function(a){if(this._isMultidimensionalCRF())return a;if(a&&a.multidimensionalDefinition&&0<a.multidimensionalDefinition.length){var d=p.filter(a.multidimensionalDefinition,function(a){return"StdTime"!==a.dimensionName});a.multidimensionalDefinition=d}return a},_removeVisualizationStretchFunction:function(a){var d=
a&&a.functionName;if(!d||"stretch"!==d.toLowerCase())return a;var b=a.functionArguments.Raster;return b&&b.functionName&&p.some(this.rasterFunctionInfos,function(a){return b.functionName===a.name})?b:a},_isMultidimensionalCRF:function(){return 10.71<=this.version&&this.hasMultidimensions&&this.timeInfo&&!(this.objectIdField&&this.fields&&1<this.fields.length)},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||
"esriImageServiceDataTypeScientific"===this.serviceDataType},_isVectorData:function(a){a=(a=a||this)&&a.serviceDataType;return"esriImageServiceDataTypeVector-UV"===a||"esriImageServiceDataTypeVector-MagDir"===a},_isRenderingRuleAProcessingTemplate:function(a){var d=a&&a.functionName;return!d||a.functionArguments?!1:p.some(d&&(this.rasterFunctionInfos||[]),function(a){return a&&a.name&&a.name.toLowerCase()===d.toLowerCase()})},_getRenderingRuleId:function(a){var d=a&&a.functionName;if(d){if(this._isRenderingRuleAProcessingTemplate(a))return d;
var b=this._customRenderingRuleId[d];if(b){if(b!==a){for(var e in this._customRenderingRuleId)if(this._customRenderingRuleId[e]===a)return e;for(b=0;this._customRenderingRuleId[g];)b+=1;var g;this._customRenderingRuleId[d+b]=a}}else this._customRenderingRuleId[d]=a;return d}},_createPixelData:function(a){a=new w({width:2,height:2,pixels:a,pixelType:this.pixelType,statistics:a});var d=this.fullExtent.getCenter(),d=new u(d.x,d.y,d.x+this.pixelSizeX,d.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:a,
extent:d}},_convertRendererToRenderingRule:function(a){var d=a&&a.declaredClass;if(!d||"esri.renderer.UniqueValueRenderer"!==d&&"esri.renderer.ClassBreaksRenderer"!==d&&"esri.renderer.StretchRenderer"!==d)return null;var b=null;"esri.renderer.StretchRenderer"===d?b=a.toRenderingRule({convertToColormap:10.6>this.version}):"esri.renderer.ClassBreaksRenderer"===d?b=this._convertClassifyRenderer(a):"esri.renderer.UniqueValueRenderer"===d&&(b=this._convertUniqueValueRenderer(a));return b},_getValueField:function(a){if(a&&
a.length){var d,b;p.some(a,function(a){if((b=a.name)&&"value"===b.toLowerCase())return d=b,!0});return d}},_convertClassifyRenderer:function(a){var d,b=[],e=[],g=[],c=[],m;d=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);var h,f,u=this.hasRasterAttributeTable,k,t;d&&(u=this._rasterFunctionTemplateInfos[d]?this._rasterFunctionTemplateInfos[d].hasRasterAttributeTable:this.hasRasterAttributeTable,f=this._renderingRuleAttributeTable[d],t=this._rasterFunctionTemplateInfos[d]);h=f&&f.features?
f.features:this._rasterAttributeTableFeatures;k=this._getValueField(f&&f.fields?f.fields:this._rasterAttributeTableFields);u&&h?(p.forEach(a.infos,function(d,b){var e,g=d.symbol.color;g.a&&p.forEach(h,function(m){e=m.attributes[a.attributeField];(e>=d.minValue&&e<d.maxValue||b===a.infos.length-1&&e>=d.minValue)&&c.push([m.attributes[k],g.r,g.g,g.b])},this)},this),d=t&&t.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(c,d),d=new C,d.functionName="Colormap",d.functionArguments={},d.functionArguments.Colormap=
c,d.variableName="Raster"):(p.forEach(a.infos,function(a,d){m=a.symbol&&a.symbol.color;m.a?(0===d?b.push.call(b,a.minValue,a.maxValue+1E-4):b.push.call(b,a.minValue+1E-4,a.maxValue+1E-4),e.push(d),c.push([d,m.r,m.g,m.b])):g.push(a.minValue,a.maxValue)}),d=t&&t.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(c,d),d=new C,d.functionName="Remap",d.functionArguments={InputRanges:b,OutputValues:e,NoDataRanges:g},d.variableName="Raster",f=new C,f.functionName="Colormap",f.functionArguments=
{Colormap:c,Raster:d},d=f);return d},_convertUniqueValueRenderer:function(a){var d=[],b=this.renderingRule&&this._getRenderingRuleId(this.renderingRule),e,g,c,m;b&&(g=this._renderingRuleAttributeTable[b],m=this._rasterFunctionTemplateInfos[b]);e=g&&g.features?g.features:this._rasterAttributeTableFeatures;c=(b=g&&g.fields?g.fields:this._rasterAttributeTableFields)&&b.length?this._getValueField(b):"Value";p.forEach(a.infos,function(b){var g=b.symbol.color;g.a&&(a.attributeField!==c&&e?p.forEach(e,function(e){e.attributes[a.attributeField]==
b.value&&d.push([e.attributes[c],g.r,g.g,g.b])},this):d.push([b.value,g.r,g.g,g.b]))},this);this._adjustColormapToPixelTypeRange(d,m&&m.pixelType||this.pixelType);m=new C;m.functionName="Colormap";m.functionArguments={};m.functionArguments.Colormap=d;m.variableName="Raster";return m},_adjustColormapToPixelTypeRange:function(a,d){(d=this._pixelTypeRanges[d])&&a.push([Math.floor(d[0]-1),0,0,0],[Math.ceil(d[1]+1),0,0,0]);return a},_combineRenderingRule:function(a,d){if(!a||!d)return a||d;var b=function(a){var d=
a.Raster;return d=d&&"esri.layers.RasterFunction"===d.declaredClass?b(d.functionArguments):a};a=f.clone(a);"none"!==d.functionName.toLocaleLowerCase()&&(b(a.functionArguments).Raster=d);return a},_isItemLevelRasterFunction:function(a){var d=a&&a.functionName;if(!d||!this._hasItemLevelRFT)return!1;var b=!1;p.some(this.rasterFunctionInfos,function(a){if(a&&a.name===d){if(1===a.functionType||2===a.functionType)b=!0;return!0}});return b},_getServiceLevelRenderingRule:function(a){if(!this._hasItemLevelRFT||
!a)return a;a=new C(a.toJson());var d;d=a.functionArguments;for(var b;;)if((b=d&&d.Raster)&&b.functionArguments&&b.functionArguments.Raster)d=b,d=d.functionArguments;else{this._isItemLevelRasterFunction(b)&&delete d.Raster;break}return a},_getItemLevelRenderingRule:function(a){if(!this._hasItemLevelRFT||!a)return null;if(this._isItemLevelRasterFunction(a))return a;a=new C(a.toJson());for(a=a.functionArguments;;)if((a=a&&a.Raster)&&a.functionArguments&&a.functionArguments.Raster)a=a.functionArguments;
else{if(this._isItemLevelRasterFunction(a))return a;break}},_resolve:function(a,d,b,e,c){d&&this[d].apply(this,a);b&&b.apply(null,a);e&&g._resDfd(e,a,c)},_toggleTime:function(){var a=this._map;this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=n.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(n.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(a,d){this.useMapTime=
a;this._toggleTime();!d&&this._map&&this.refresh(!0)},_setTime:function(a){this._params&&(this._params.time=a?a.toJson().join(","):null)},_onTimeExtentChangeHandler:function(a){this.suspended||(this._setTime(a),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()}});k("extend-esri")&&f.setObject("layers.ImageServiceLayerMixin",r,e);return r})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point ./RasterFunction".split(" "),
function(r,f,l,p,c,q,n){var k=r(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],itemRenderingRule:null,constructor:function(c){f.isObject(c)&&(f.mixin(this,c),c.mosaicMethod&&(this.method=c.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),c.mosaicOperation&&(this.operation=
c.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),c.fids&&(this.objectIds=c.fids),c.viewpoint&&(this.viewpoint=new q(c.viewpoint)),c.itemRenderingRule&&(this.itemRenderingRule=new n(c.itemRenderingRule)),this.multidimensionalDefinition=c.multidimensionalDefinition||[])},toJson:function(){var h=null,k=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(k)for(var h=[],e=0;e<k;e++)h.push("esri.layers.DimensionalDefinition"===
this.multidimensionalDefinition[e].declaredClass?this.multidimensionalDefinition[e].toJson():this.multidimensionalDefinition[e]);h={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:f.clone(this.lockRasterIds),viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:f.clone(this.objectIds),mosaicOperation:this.operation,multidimensionalDefinition:h,itemRenderingRule:this.itemRenderingRule?this.itemRenderingRule.toJson():
null};return c.filter(h,function(b){if(null!==b)return!0})},_getMethodEnum:function(c){if(c){var h=k.METHOD_NONE;switch(c.toLowerCase()){case "byattribute":h=k.METHOD_ATTRIBUTE;break;case "center":h=k.METHOD_CENTER;break;case "lockraster":h=k.METHOD_LOCKRASTER;break;case "nadir":h=k.METHOD_NADIR;break;case "northwest":h=k.METHOD_NORTHWEST;break;case "seamline":h=k.METHOD_SEAMLINE;break;case "viewpoint":h=k.METHOD_VIEWPOINT}return h}},_getOperatorEnum:function(c){if(c)switch(c.toLowerCase()){case "first":return k.OPERATION_FIRST;
case "last":return k.OPERATION_LAST;case "max":return k.OPERATION_MAX;case "min":return k.OPERATION_MIN;case "blend":return k.OPERATION_BLEND;case "mean":return k.OPERATION_MEAN;case "sum":return k.OPERATION_SUM}}});f.mixin(k,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",
OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});l("extend-esri")&&f.setObject("layers.MosaicRule",k,p);return k})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(r,f,l,p,c){r=r(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,
constructor:function(c){f.isObject(c)&&f.mixin(this,c)},toJson:function(){var q={variableName:this.variableName,dimensionName:this.dimensionName,values:f.clone(this.values),isSlice:this.isSlice};return c.filter(q,function(c){return null!==c})}});l("extend-esri")&&f.setObject("layers.DimensionalDefinition",r,p);return r})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u){var v,B,z,C,D,y;f=f(t,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(a){this.imageServiceUrl=a;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(d,b,g){var m=this,h=new p(a._dfdCanceller);if(10>k("ie"))throw"This browser is not supported.";
if(!d.imageServiceParameters)throw"Insufficient parameters to read data";var f=l.clone(d.imageServiceParameters),u=d.pixelType;c.some(this.validPixelTypes,function(a){return a===u})||(f.pixelType="F32");c.some(this.validFormats,function(a){return a.toLowerCase()===f.format.toLowerCase()})||(f.format="lerc");var t=d.decodeFunc,n;this._prepareGetImageParameters(f);var q=f.width,v=f.height,w=f.extent;delete f.width;delete f.height;delete f.extent;h._pendingDfd=e({url:this.imageServiceUrl+"/exportImage",
handleAs:"arraybuffer",content:l.mixin(f,{f:"image"}),load:function(a){m.decode(a,{width:q,height:v,planes:null,pixelType:u,noDataValue:f.noData,format:f.format,decodeFunc:t}).then(function(a){n={pixelBlock:a,extent:w};m._resolve([n,f],"onRasterReadComplete",b,h)},function(a){m._resolve([a],null,g,h,!0)})},error:function(a){m._resolve([a],null,g,h,!0)}});return h.promise},decode:function(a,d){if(void 0===d||null===d)throw"missing decode options";var b,e;d.format&&(b=d.format.toUpperCase());"BSQ"!==
b&&"BIP"!==b&&(b=this._getFormat(a));e=d.decodeFunc;if(void 0===e||null===e)e=this._getFormatDecoderDfd(b);return e(a,d)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(a){if(a.size&&a.bbox){var d=a.size.split(",");a.width=parseFloat(d[0]);a.height=parseFloat(d[1]);a.extent||(d=a.bbox.split(","),a.extent=new b(parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]),new m(a.bboxSR)))}else{if(!a.width||Math.floor(a.width)!==a.width||!a.height||Math.floor(a.height)!==
a.height)throw"Incorrect Image Dimensions";if(!a.extent||"esri.geometry.Extent"!==a.extent.declaredClass)throw"Incorrect extent";var d=a.extent,e=d.spatialReference.wkid||n.toJson(d.spatialReference.toJson());delete a._ts;l.mixin(a,{bbox:d.xmin+","+d.ymin+","+d.xmax+","+d.ymax,imageSR:e,bboxSR:e,size:a.width+","+a.height},a.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(a,d,b){var e=a.ymax-a.ymin,g=a.xmax-a.xmin;b>=d?a.ymax=a.ymin+g*d/b:a.xmax=a.xmin+e*b/d;return a},
_resolve:function(d,b,e,g,c){b&&this[b].apply(this,d);e&&e.apply(null,d);g&&a._resDfd(g,d,c)},_getFormatDecoderDfd:function(a){var d=null;switch(a){case "LERC":d=this._decodeLerc;break;case "LERC2":d=this._decodeLerc2;break;case "JPEG":d=this._decodeJpeg;break;case "PNG":d=this._decodePng;break;case "BSQ":d=this._decodeBsq;break;case "BIP":d=this._decodeBip;break;case "TIFF":d=this._decodeTiff;break;default:d=function(a,d){throw"The raster format is not supported";}}d=l.hitch(this,d);return function(b,
e){var g=new p;try{var c;"LERC"===a||!0===D?(c=d(b,e),g.resolve(c)):y.then(function(){c=d(b,e);g.resolve(c)})}catch(K){g.reject(K)}return g}},_getFormat:function(a){a=new Uint8Array(a,0,10);var d="";if(255===a[0]&&216===a[1])d="JPEG";else if(137===a[0]&&80===a[1]&&78===a[2]&&71===a[3])d="PNG";else if(67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9])d="LERC";else if(76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5])d=
"LERC2";else if(-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error"))d="ERROR";else if(73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3])d="TIFF";return d},_validateDecodeParams:function(a){if(!a.height||Math.floor(a.height)!==a.height)throw"Height not provided.";if(!a.width||Math.floor(a.width)!==a.width)throw"Width not provided.";},_decodeJpeg:function(a,d){if(!v)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(d);a=(new v).decode(a);
if(!E(a,d))throw"The decoded image dimensions are incorrect.";d=[];var b,e;for(b=0;b<a.pixels.length;b++)e=a.pixels[b],d.push(this._calculateBandStatistics(e));return new g({width:a.width,height:a.height,pixels:a.pixels,pixelType:"U8",mask:a.mask,statistics:d})},_decodePng:function(a,d){if(!B)throw"The png decoder module is not loaded.";this._validateDecodeParams(d);a=new Uint8Array(a);var b=new B(a);a=new Uint8Array(d.width*d.height*4);b.copyToImageData(a,b.decodePixels());for(var e=b=0,c,e=new Uint8Array(d.width*
d.height),b=0;b<d.width*d.height;b++)e[b]=a[4*b+3];for(var m=new g({width:d.width,height:d.height,pixels:[],pixelType:"U8",mask:e,statistics:[]}),b=0;3>b;b++){c=new Uint8Array(d.width*d.height);for(e=0;e<d.width*d.height;e++)c[e]=a[4*e+b];m.addData({pixels:c,statistics:this._calculateBandStatistics(c)})}return m},_decodeBsq:function(a,d){if(!z)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(d);A=d.noDataValue;d.pixelType=G(d.pixelType);a=z.decodeBSQ(a,{bandCount:d.planes,width:d.width,
height:d.height,pixelType:w,noDataValue:A});var b=[],e,c=null;for(e=0;e<a.pixels.length;e++)c=a.pixels[e],b.push(this._calculateBandStatistics(c));return new g({width:d.width,height:d.height,pixels:a.pixels,pixelType:d.pixelType,mask:a.maskData,statistics:b})},_decodeBip:function(a,d){this._validateDecodeParams(d);A=d.noDataValue;d.pixelType=G(d.pixelType);a=z.decodeBIP(a,{bandCount:d.planes,width:d.width,height:d.height,pixelType:w,noDataValue:A});var b=[],e,c=null;for(e=0;e<a.pixels.length;e++)c=
a.pixels[e],b.push(this._calculateBandStatistics(c));return new g({width:d.width,height:d.height,pixels:a.pixels,pixelType:d.pixelType,mask:a.maskData,statistics:b})},_decodeTiff:function(a,d){this._validateDecodeParams(d);A=d.noDataValue;d.pixelType=G(d.pixelType);a=C.decode(a);d=[];var b,e=null;for(b=0;b<a.pixels.length;b++)e=a.pixels[b],d.push(this._calculateBandStatistics(e,a.maskData));return new g({width:a.width,height:a.height,pixels:a.pixels,pixelType:a.pixelType,mask:a.maskData,statistics:d})},
_decodeLerc:function(a,b){this._validateDecodeParams(b);A=b.noDataValue;b.pixelType=G(b.pixelType);for(var e=0,c,m=0,h,f=a.byteLength-10;m<f;){var u=d.decode(a,{inputOffset:m,encodedMaskData:c,returnMask:0===e?!0:!1,returnEncodedMask:0===e?!0:!1,returnFileInfo:!0,pixelType:w,noDataValue:A}),m=u.fileInfo.eofOffset;0===e&&(c=u.encodedMaskData,h=new g({width:b.width,height:b.height,pixels:[],pixelType:b.pixelType,mask:u.maskData,statistics:[]}));e++;if(!E(u,b))throw"The decoded image dimensions are incorrect";
h.addData({pixels:u.pixelData,statistics:{minValue:u.minValue,maxValue:u.maxValue,noDataValue:u.noDataValue}})}return h},_decodeLerc2:function(a,d){this._validateDecodeParams(d);A=d.noDataValue;d.pixelType=G(d.pixelType);for(var b=0,e,c,m=0,h,f=a.byteLength-10,k=[];m<f;){c=u.decode(a,{inputOffset:m,maskData:e,returnFileInfo:!0});m=c.fileInfo.eofOffset;0===b&&(e=c.maskData,h=new g({width:d.width,height:d.height,pixels:[],pixelType:c.fileInfo.pixelType,mask:c.maskData,statistics:[]}));c.fileInfo.mask&&
0<c.fileInfo.mask.numBytes&&k.push(c.maskData);b++;if(!E(c,d))throw"The decoded image dimensions are incorrect";h.addData({pixels:c.pixelData,statistics:{minValue:c.minValue,maxValue:c.maxValue,noDataValue:c.noDataValue}})}if(1<k.length){c=h.width*h.height;h.bandMasks=k;e=new Uint8Array(c);e.set(k[0]);for(d=1;d<k.length;d++)for(a=k[d],b=0;b<c;b++)e[b]&=a[b];h.maskData=e}return h},_calculateBandStatistics:function(a,d){var b=Infinity,e=-Infinity,g=a.length,c,m=0;if(d)for(c=0;c<g;c++)d[c]&&(m=a[c],
b=m<b?m:b,e=m>e?m:e);else for(c=0;c<g;c++)m=a[c],b=m<b?m:b,e=m>e?m:e;return{minValue:b,maxValue:e}},_loadRasterFormatModules:function(){D||(y||(y=new p),10>k("ie")?y.isRejected()||y.reject("unsupported browser version"):r(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(a,d,b,e){v=a;B=d;z=b;C=e;D=!0;y.isResolved()||y.resolve(!0)}))}});var w=null,A=null,G=function(a){if("U1"===a||"U2"===a||"U4"===a||"U8"===a)return A=
Math.pow(2,8)-1,w=Uint8Array,"U8";"U16"===a?(A=A||Math.pow(2,16)-1,w=Uint16Array):"U32"===a?(A=A||Math.pow(2,32)-1,w=Uint32Array):"S8"===a?(A=A||0-Math.pow(2,7),w=Int8Array):"S16"===a?(A=A||0-Math.pow(2,15),w=Int16Array):"S32"===a?(A=A||0-Math.pow(2,31),w=Int32Array):w=Float32Array;return a},E=function(a,d){return a.height!==d.height||a.width!==d.width?!1:!0};k("extend-esri")&&l.setObject("layers.Raster",f,h);return f})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/has","../kernel"],function(r,f,l,p){r=r([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],maskIsAlpha:!1,validPixelCount:null,constructor:function(c){if(c){if(!c.width||Math.floor(c.width)!==c.width)throw"PixelBlock: incorrect width";if(!c.height||Math.floor(c.height)!==c.height)throw"PixelBlock: incorrect height";if(!c.pixels)throw"PixelBlock: pixel data not present";this.width=c.width;this.height=c.height;this.pixels=c.pixels;
this.pixelType=c.pixelType||null;this.statistics=c.statistics;this.mask=c.mask||null;this.maskIsAlpha=c.maskIsAlpha||!1;c=c.validPixelCount;null==c&&(c=this.mask?this._getValidPixelCount(this.mask):this.width*this.height);this.validPixelCount=c}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(c){if(!c.pixels||!c.statistics)throw"Pixel data or statistics are not present";if(c.pixels.length!==
this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(c.statistics);this.pixels.push(c.pixels)},getAsRGBA:function(){var c=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(c);break;default:this._fillFrom8Bit(c)}return new Uint8ClampedArray(c)},getAsRGBAFloat:function(){var c=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(c);return c},clone:function(c){c=
c||this;var q=new this.constructor;q.width=c.width;q.height=c.height;q.pixelType=c.pixelType;q.maskIsAlpha=c.maskIsAlpha;c.mask&&(q.mask=new Uint8Array(c.mask));var n,k,h;if(c.pixels)for(q.pixels=[],h=(k=c.pixels.length)&&c.pixels[0].slice,n=0;n<k;n++)q.pixels[n]=h?c.pixels[n].slice(0,c.pixels[n].length):new c.pixels[n].constructor(c.pixels[n]);if(c.statistics)for(q.statistics=[],k=c.statistics.length,n=0;n<k;n++)q.statistics[n]=f.clone(c.statistics[n]);c=c.validPixelCount;null==c&&(c=q.mask?this._getValidPixelCount(q.mask):
q.width*q.height);return q},clamp:function(c){if("F64"!==c&&"F32"!==c){var f;switch(c){case "U8":f=[0,255];break;case "U16":f=[0,65535];break;case "U32":f=[0,4294967295];break;case "S8":f=[-128,127];break;case "S16":f=[-32768,32767];break;case "S32":f=[-2147483648,2147483647];break;default:f=[-3.4*1E39,3.4*1E39]}var n=f[0];f=f[1];var k=this.pixels,h=this.width*this.height,t=k.length,e,b,m,a,g,d=[];for(a=0;a<t;a++){m=this._createEmptyBand(c,h);e=k[a];for(g=0;g<h;g++)b=e[g],m[g]=b>f?f:b<n?n:b;d.push(m)}this.pixels=
d;this.pixelType=c}},calculateStatistics:function(){var c,f=[],n,k=this.mask;for(c=0;c<this.pixels.length;c++)n=this.pixels[c],f.push(this._calculateBandStatistics(n,k));this.statistics=f},_getValidPixelCount:function(c){var f,n=0;for(f=0;f<c.length;f++)c[f]&&n++;return n},_createEmptyBand:function(c,f){switch(c){case "U8":c=new Uint8Array(f);break;case "U16":c=new Uint16Array(f);break;case "U32":c=new Uint32Array(f);break;case "S8":c=new Int8Array(f);break;case "S16":c=new Int16Array(f);break;case "S32":c=
new Int32Array(f);break;case "U32":c=new Uint32Array(f);break;case "F32":c=new Float32Array(f);break;case "F64":c=new Float64Array(f);break;default:c=new Float32Array(f)}return c},_fillFrom8Bit:function(c){var f=this.pixels,n=this.mask;if(!c||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var k,h,t;k=h=t=f[0];3<=f.length&&(h=f[1],t=f[2]);var f=new Uint32Array(c),e=this.width*this.height;if(k.length!==e)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");
if(n&&n.length===e)if(this.maskIsAlpha)for(c=0;c<e;c++)n[c]&&(f[c]=n[c]<<24|t[c]<<16|h[c]<<8|k[c]);else for(c=0;c<e;c++)n[c]&&(f[c]=-16777216|t[c]<<16|h[c]<<8|k[c]);else for(c=0;c<e;c++)f[c]=-16777216|t[c]<<16|h[c]<<8|k[c]},_fillFromNon8Bit:function(c){var f=this.pixels,n=this.mask,k=this.statistics;if(!c||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var h=1,t=0,h=1;k&&0<k.length?(t=k.map(function(a){return a.minValue}).reduce(function(a,b){return Math.min(a,
b)}),h=k.map(function(a){return a.maxValue-a.minValue}).reduce(function(a,b){return Math.max(a,b)}),h=255/h):(h=255,"S8"===this.pixelType?(t=-128,h=127):"U16"===this.pixelType?h=65535:"S16"===this.pixelType?(t=-32768,h=32767):"U32"===this.pixelType?h=4294967295:"S32"===this.pixelType?(t=-2147483648,h=2147483647):"F32"===this.pixelType?(t=-3.4*1E39,h=3.4*1E39):"F64"===this.pixelType&&(t=-Number.MAX_VALUE,h=Number.MAX_VALUE),h=255/(h-t));c=new Uint32Array(c);var k=this.width*this.height,e,b,m;e=f[0];
if(e.length!==k)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=f.length)if(b=f[1],m=f[2],n&&n.length===k)for(f=0;f<k;f++)n[f]&&(c[f]=-16777216|(m[f]-t)*h<<16|(b[f]-t)*h<<8|(e[f]-t)*h);else for(f=0;f<k;f++)c[f]=-16777216|(m[f]-t)*h<<16|(b[f]-t)*h<<8|(e[f]-t)*h;else if(n&&n.length===k)for(f=0;f<k;f++)b=(e[f]-t)*h,n[f]&&(c[f]=-16777216|b<<16|b<<8|b);else for(f=0;f<k;f++)b=(e[f]-t)*h,c[f]=-16777216|b<<16|b<<8|b},_fillFrom32Bit:function(c){var f=this.pixels,n=this.mask;
if(!c||!f||!f.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var k,h,t;k=h=t=f[0];3<=f.length&&(h=f[1],t=f[2]);var e=this.width*this.height;if(k.length!==e)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var b=0;if(n&&n.length===e)for(f=0;f<e;f++)c[b++]=k[f],c[b++]=h[f],c[b++]=t[f],c[b++]=n[f]&1;else for(f=0;f<e;f++)c[b++]=k[f],c[b++]=h[f],c[b++]=t[f],c[b++]=1},_calculateBandStatistics:function(c,f){var n=Infinity,k=-Infinity,
h=c.length,t,e=0;if(f)for(t=0;t<h;t++)f[t]&&(e=c[t],n=e<n?e:n,k=e>k?e:k);else for(t=0;t<h;t++)e=c[t],n=e<n?e:n,k=e>k?e:k;return{minValue:n,maxValue:k}}});l("extend-esri")&&f.setObject("layers.PixelBlock",r,p);return r})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var r={defaultNoDataValue:-3.4027999387901484E38,decode:function(l,p){var c;p=p||{};var q=p.inputOffset||0,n=p.encodedMaskData||null===p.encodedMaskData,k={},h=new Uint8Array(l,q,10);k.fileIdentifierString=String.fromCharCode.apply(null,
h);if("CntZImage"!=k.fileIdentifierString.trim())throw"Unexpected file identifier string: "+k.fileIdentifierString;q+=10;h=new DataView(l,q,24);k.fileVersion=h.getInt32(0,!0);k.imageType=h.getInt32(4,!0);k.height=h.getUint32(8,!0);k.width=h.getUint32(12,!0);k.maxZError=h.getFloat64(16,!0);q+=24;if(!n)if(h=new DataView(l,q,16),k.mask={},k.mask.numBlocksY=h.getUint32(0,!0),k.mask.numBlocksX=h.getUint32(4,!0),k.mask.numBytes=h.getUint32(8,!0),k.mask.maxValue=h.getFloat32(12,!0),q+=16,0<k.mask.numBytes){var n=
new Uint8Array(Math.ceil(k.width*k.height/8)),h=new DataView(l,q,k.mask.numBytes),t=h.getInt16(0,!0),e=2,b=0;do{if(0<t)for(;t--;)n[b++]=h.getUint8(e++);else for(var m=h.getUint8(e++),t=-t;t--;)n[b++]=m;t=h.getInt16(e,!0);e+=2}while(e<k.mask.numBytes);if(-32768!==t||b<n.length)throw"Unexpected end of mask RLE encoding";k.mask.bitset=n;q+=k.mask.numBytes}else 0===(k.mask.numBytes|k.mask.numBlocksY|k.mask.maxValue)&&(n=new Uint8Array(Math.ceil(k.width*k.height/8)),k.mask.bitset=n);h=new DataView(l,q,
16);k.pixels={};k.pixels.numBlocksY=h.getUint32(0,!0);k.pixels.numBlocksX=h.getUint32(4,!0);k.pixels.numBytes=h.getUint32(8,!0);k.pixels.maxValue=h.getFloat32(12,!0);q+=16;n=k.pixels.numBlocksX;h=k.pixels.numBlocksY;n+=0<k.width%n?1:0;t=h+(0<k.height%h?1:0);k.pixels.blocks=Array(n*t);for(b=e=0;b<t;b++)for(m=0;m<n;m++){var a=0,h=new DataView(l,q,Math.min(10,l.byteLength-q)),g={};k.pixels.blocks[e++]=g;var d=h.getUint8(0);a++;g.encoding=d&63;if(3<g.encoding)throw"Invalid block encoding ("+g.encoding+
")";if(2===g.encoding)q++;else{if(0!==d&&2!==d){d>>=6;g.offsetType=d;if(2===d)g.offset=h.getInt8(1),a++;else if(1===d)g.offset=h.getInt16(1,!0),a+=2;else if(0===d)g.offset=h.getFloat32(1,!0),a+=4;else throw"Invalid block offset type";if(1===g.encoding)if(d=h.getUint8(a),a++,g.bitsPerPixel=d&63,d>>=6,g.numValidPixelsType=d,2===d)g.numValidPixels=h.getUint8(a),a++;else if(1===d)g.numValidPixels=h.getUint16(a,!0),a+=2;else if(0===d)g.numValidPixels=h.getUint32(a,!0),a+=4;else throw"Invalid valid pixel count type";
}q+=a;if(3!=g.encoding)if(0===g.encoding){d=(k.pixels.numBytes-1)/4;if(d!==Math.floor(d))throw"uncompressed block has invalid length";h=new ArrayBuffer(4*d);a=new Uint8Array(h);a.set(new Uint8Array(l,q,4*d));h=new Float32Array(h);g.rawData=h;q+=4*d}else 1===g.encoding&&(d=Math.ceil(g.numValidPixels*g.bitsPerPixel/8),h=new ArrayBuffer(4*Math.ceil(d/4)),a=new Uint8Array(h),a.set(new Uint8Array(l,q,d)),g.stuffedData=new Uint32Array(h),q+=d)}}k.eofOffset=q;l=null!=p.noDataValue?p.noDataValue:r.defaultNoDataValue;
var n=p.encodedMaskData,d=p.returnMask,t=0,e=k.pixels.numBlocksX,b=k.pixels.numBlocksY,m=Math.floor(k.width/e),g=Math.floor(k.height/b),a=2*k.maxZError,q=Number.MAX_VALUE,u,n=n||(k.mask?k.mask.bitset:null),v,h=new (p.pixelType||Float32Array)(k.width*k.height);d&&n&&(v=new Uint8Array(k.width*k.height));for(var d=new Float32Array(m*g),B,z,C=0;C<=b;C++){var D=C!==b?g:k.height%b;if(0!==D)for(var y=0;y<=e;y++){var w=y!==e?m:k.width%e;if(0!==w){var A=C*k.width*g+y*m,G=k.width-w,E=k.pixels.blocks[t],F,H;
if(2>E.encoding){if(0===E.encoding)F=E.rawData;else{F=E.stuffedData;H=E.bitsPerPixel;u=E.numValidPixels;B=E.offset;z=a;var L=d,N=k.pixels.maxValue,M=(1<<H)-1,J=0,K=void 0,O=0,Q=void 0,P=void 0,R=Math.ceil((N-B)/z);F[F.length-1]<<=8*(4*F.length-Math.ceil(H*u/8));for(K=0;K<u;K++)0===O&&(P=F[J++],O=32),O>=H?(Q=P>>>O-H&M,O-=H):(O=H-O,Q=(P&M)<<O&M,P=F[J++],O=32-O,Q+=P>>>O),L[K]=Q<R?B+Q*z:N;F=d}H=0}else c=2===E.encoding?0:E.offset;var I;if(n)for(z=0;z<D;z++){A&7&&(I=n[A>>3],I<<=A&7);for(B=0;B<w;B++)A&7||
(I=n[A>>3]),I&128?(v&&(v[A]=1),u=2>E.encoding?F[H++]:c,q=q>u?u:q,h[A++]=u):(v&&(v[A]=0),h[A++]=l),I<<=1;A+=G}else if(2>E.encoding)for(z=0;z<D;z++){for(B=0;B<w;B++)u=F[H++],q=q>u?u:q,h[A++]=u;A+=G}else for(q=q>c?c:q,z=0;z<D;z++){for(B=0;B<w;B++)h[A++]=c;A+=G}if(1===E.encoding&&H!==E.numValidPixels)throw"Block and Mask do not match";t++}}}c=v;v={width:k.width,height:k.height,pixelData:h,minValue:q,maxValue:k.pixels.maxValue,noDataValue:l};c&&(v.maskData=c);p.returnEncodedMask&&k.mask&&(v.encodedMaskData=
k.mask.bitset?k.mask.bitset:null);if(p.returnFileInfo&&(v.fileInfo=f(k),p.computeUsedBitDepths)){p=v.fileInfo;c=k.pixels.numBlocksX*k.pixels.numBlocksY;I={};for(F=0;F<c;F++)H=k.pixels.blocks[F],0===H.encoding?I.float32=!0:1===H.encoding?I[H.bitsPerPixel]=!0:I[0]=!0;k=Object.keys(I);p.bitDepths=k}return v}},f=function(f){return{fileIdentifierString:f.fileIdentifierString,fileVersion:f.fileVersion,imageType:f.imageType,height:f.height,width:f.width,maxZError:f.maxZError,eofOffset:f.eofOffset,mask:f.mask?
{numBlocksX:f.mask.numBlocksX,numBlocksY:f.mask.numBlocksY,numBytes:f.mask.numBytes,maxValue:f.mask.maxValue}:null,pixels:{numBlocksX:f.pixels.numBlocksX,numBlocksY:f.pixels.numBlocksY,numBytes:f.pixels.numBytes,maxValue:f.pixels.maxValue,noDataValue:this.noDataValue}}};return r})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var r={unstuff:function(f,c,q,n,k,h,t,e){var b=(1<<q)-1,m=0,a,g=0,d,u;f[f.length-1]<<=8*(4*f.length-Math.ceil(q*n/8));if(k)for(a=0;a<n;a++)0===g&&(u=
f[m++],g=32),g>=q?(d=u>>>g-q&b,g-=q):(g=q-g,d=(u&b)<<g&b,u=f[m++],g=32-g,d+=u>>>g),c[a]=k[d];else for(k=Math.ceil((e-h)/t),a=0;a<n;a++)0===g&&(u=f[m++],g=32),g>=q?(d=u>>>g-q&b,g-=q):(g=q-g,d=(u&b)<<g&b,u=f[m++],g=32-g,d+=u>>>g),c[a]=d<k?h+d*t:e},unstuffLUT:function(f,c,q,n,k,h){var t=(1<<c)-1,e=0,b=0,m=0,a=m=0,g,d=[];f[f.length-1]<<=8*(4*f.length-Math.ceil(c*q/8));for(var u=Math.ceil((h-n)/k),b=0;b<q;b++)0===m&&(g=f[e++],m=32),m>=c?(a=g>>>m-c&t,m-=c):(m=c-m,a=(g&t)<<m&t,g=f[e++],m=32-m,a+=g>>>m),
d[b]=a<u?n+a*k:h;d.unshift(n);return d},unstuff2:function(f,c,q,n,k,h,t,e){var b=(1<<q)-1,m=0,a,g=0,d=0,u,v,p;if(k)for(a=0;a<n;a++)0===g&&(v=f[m++],g=32,d=0),g>=q?(u=v>>>d&b,g-=q,d+=q):(p=q-g,u=v>>>d&b,v=f[m++],g=32-p,u|=(v&(1<<p)-1)<<q-p,d=p),c[a]=k[u];else for(k=Math.ceil((e-h)/t),a=0;a<n;a++)0===g&&(v=f[m++],g=32,d=0),g>=q?(u=v>>>d&b,g-=q,d+=q):(p=q-g,u=v>>>d&b,v=f[m++],g=32-p,u|=(v&(1<<p)-1)<<q-p,d=p),c[a]=u<k?h+u*t:e;return c},unstuffLUT2:function(f,c,q,n,k,h){for(var t=(1<<c)-1,e=0,b=0,m=0,
a=0,g=0,d=0,u,v=[],p=Math.ceil((h-n)/k),b=0;b<q;b++)0===a&&(u=f[e++],a=32,d=0),a>=c?(g=u>>>d&t,a-=c,d+=c):(m=c-a,g=u>>>d&t,u=f[e++],a=32-m,g|=(u&(1<<m)-1)<<c-m,d=m),v[b]=g<p?n+g*k:h;v.unshift(n);return v},originalUnstuff:function(f,c,q,n){var k=(1<<q)-1,h=0,t,e=0,b,m;f[f.length-1]<<=8*(4*f.length-Math.ceil(q*n/8));for(t=0;t<n;t++)0===e&&(m=f[h++],e=32),e>=q?(b=m>>>e-q&k,e-=q):(e=q-e,b=(m&k)<<e&k,m=f[h++],e=32-e,b+=m>>>e),c[t]=b;return c},originalUnstuff2:function(f,c,q,n){var k=(1<<q)-1,h=0,t,e=0,
b=0,m,a,g;for(t=0;t<n;t++)0===e&&(a=f[h++],e=32,b=0),e>=q?(m=a>>>b&k,e-=q,b+=q):(g=q-e,m=a>>>b&k,a=f[h++],e=32-g,m|=(a&(1<<g)-1)<<q-g,b=g),c[t]=m;return c}},f={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(f){for(var c=65535,q=65535,n=f.length,k=Math.floor(n/2),h=0;k;){var t=359<=k?359:k,k=k-t;do c+=f[h++]<<8,q+=c+=f[h++];while(--t);c=(c&65535)+(c>>>16);q=(q&65535)+(q>>>16)}n&1&&(q+=c+=f[h]<<8);return((q&65535)+(q>>>16)<<16|(c&65535)+(c>>>16))>>>0},readHeaderInfo:function(f,c){var q=
c.ptr,n=new Uint8Array(f,q,6),k={};k.fileIdentifierString=String.fromCharCode.apply(null,n);if(0!==k.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+k.fileIdentifierString;var q=q+6,n=new DataView(f,q,8),h=n.getInt32(0,!0);k.fileVersion=h;q+=4;3<=h&&(k.checksum=n.getUint32(4,!0),q+=4);n=new DataView(f,q,12);k.height=n.getUint32(0,!0);k.width=n.getUint32(4,!0);q+=8;4<=h?(k.numDims=n.getUint32(8,!0),q+=4):k.numDims=1;n=new DataView(f,q,40);k.numValidPixel=
n.getUint32(0,!0);k.microBlockSize=n.getInt32(4,!0);k.blobSize=n.getInt32(8,!0);k.imageType=n.getInt32(12,!0);k.maxZError=n.getFloat64(16,!0);k.zMin=n.getFloat64(24,!0);k.zMax=n.getFloat64(32,!0);q+=40;c.headerInfo=k;c.ptr=q;if(3<=h&&(f=this.computeChecksumFletcher32(new Uint8Array(f,q-(4<=h?52:48),k.blobSize-14)),f!==k.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(f,c){var q=c.headerInfo,n=this.getDataTypeArray(q.imageType),k=q.numDims*this.getDataTypeSize(q.imageType),h=
this.readSubArray(f,c.ptr,n,k);f=this.readSubArray(f,c.ptr+k,n,k);c.ptr+=2*k;k=!0;for(c=0;c<q.numDims;c++)if(h[c]!==f[c]){k=!1;break}q.minValues=h;q.maxValues=f;return k},readSubArray:function(f,c,q,n){if(q===Uint8Array)f=new Uint8Array(f,c,n);else{var k=new ArrayBuffer(n);(new Uint8Array(k)).set(new Uint8Array(f,c,n));f=new q(k)}return f},readMask:function(f,c){var q=c.ptr,n=c.headerInfo,k=n.width*n.height,h=n.numValidPixel,t=new DataView(f,q,4),n={};n.numBytes=t.getUint32(0,!0);q+=4;if((0===h||
k===h)&&0!==n.numBytes)throw"invalid mask";if(0===h)h=new Uint8Array(Math.ceil(k/8)),n.bitset=h,t=new Uint8Array(k),c.pixels.resultMask=t,q+=n.numBytes;else if(0<n.numBytes){h=new Uint8Array(Math.ceil(k/8));t=new DataView(f,q,n.numBytes);f=t.getInt16(0,!0);var e=2,b=0,m=0;do{if(0<f)for(;f--;)h[b++]=t.getUint8(e++);else for(m=t.getUint8(e++),f=-f;f--;)h[b++]=m;f=t.getInt16(e,!0);e+=2}while(e<n.numBytes);if(-32768!==f||b<h.length)throw"Unexpected end of mask RLE encoding";t=new Uint8Array(k);for(e=
e=f=0;e<k;e++)e&7?(f=h[e>>3],f<<=e&7):f=h[e>>3],f&128&&(t[e]=1);c.pixels.resultMask=t;n.bitset=h;q+=n.numBytes}c.ptr=q;c.mask=n;return!0},readDataOneSweep:function(p,c,q){var n=c.ptr,k=c.headerInfo,h=k.numDims,t=k.width*k.height,k=k.numValidPixel*f.getDataTypeSize(k.imageType)*h,e=c.pixels.resultMask;if(q===Uint8Array)p=new Uint8Array(p,n,k);else{var b=new ArrayBuffer(k);(new Uint8Array(b)).set(new Uint8Array(p,n,k));p=new q(b)}if(p.length===t*h)c.pixels.resultPixels=p;else{c.pixels.resultPixels=
new q(t*h);var m=b=q=0,a=0;if(1<h)for(m=0;m<h;m++)for(a=m*t,b=0;b<t;b++)e[b]&&(c.pixels.resultPixels[a+b]=p[q++]);else for(b=0;b<t;b++)e[b]&&(c.pixels.resultPixels[b]=p[q++])}c.ptr=n+k;return!0},readHuffmanTree:function(p,c){var q=this.HUFFMAN_LUT_BITS_MAX,n=new DataView(p,c.ptr,16);c.ptr+=16;if(2>n.getInt32(0,!0))throw"unsupported Huffman version";var k=n.getInt32(4,!0),h=n.getInt32(8,!0),n=n.getInt32(12,!0);if(h>=n)return!1;var t=new Uint32Array(n-h);f.decodeBits(p,c,t);var e=[],b,m,a;for(b=h;b<
n;b++)m=b-(b<k?0:k),e[m]={first:t[b-h],second:null};b=p.byteLength-c.ptr;t=new ArrayBuffer(4*Math.ceil(b/4));(new Uint8Array(t)).set(new Uint8Array(p,c.ptr,b));p=new Uint32Array(t);c=0;var g,t=0;g=p[0];for(b=h;b<n;b++)m=b-(b<k?0:k),a=e[m].first,0<a&&(e[m].second=g<<c>>>32-a,32-c>=a?(c+=a,32===c&&(c=0,t++,g=p[t])):(c+=a-32,t++,g=p[t],e[m].second|=g>>>32-c));var d=g=0,u=new l;for(b=0;b<e.length;b++)void 0!==e[b]&&(g=Math.max(g,e[b].first));var d=g>=q?q:g,q=[],v,B;for(b=h;b<n;b++)if(m=b-(b<k?0:k),a=
e[m].first,0<a)if(h=[a,m],a<=d)for(m=e[m].second<<d-a,v=1<<d-a,a=0;a<v;a++)q[m|a]=h;else for(m=e[m].second,v=u,--a;0<=a;a--)(B=m>>>a&1)?(v.right||(v.right=new l),v=v.right):(v.left||(v.left=new l),v=v.left),0!==a||v.val||(v.val=h[1]);return{decodeLut:q,numBitsLUTQick:d,numBitsLUT:g,tree:u,stuffedData:p,srcPtr:t,bitPos:c}},readHuffman:function(f,c,q){var n=c.headerInfo,k=n.numDims,h=c.headerInfo.height,t=c.headerInfo.width,e=t*h,b=this.readHuffmanTree(f,c);f=b.decodeLut;var m=b.tree,a=b.stuffedData,
g=b.srcPtr,d=b.bitPos,u=b.numBitsLUTQick,b=b.numBitsLUT,v=0===c.headerInfo.imageType?128:0,p,l,C=c.pixels.resultMask,D,y,w,r,G,E,F=0;0<d&&(g++,d=0);var H=a[g],L=1===c.encodeMode,N=new q(e*k),M=N,J;for(J=0;J<n.numDims;J++){1<k&&(M=new q(N.buffer,e*J,e),F=0);if(c.headerInfo.numValidPixel===t*h)for(w=G=0;w<h;w++)for(r=0;r<t;r++,G++){l=0;p=D=H<<d>>>32-u;32-d<u&&(p=D|=a[g+1]>>>64-d-u);if(f[p])l=f[p][1],d+=f[p][0];else for(p=D=H<<d>>>32-b,32-d<b&&(p=D|=a[g+1]>>>64-d-b),p=m,E=0;E<b;E++)if(p=(y=D>>>b-E-1&
1)?p.right:p.left,!p.left&&!p.right){l=p.val;d=d+E+1;break}32<=d&&(d-=32,g++,H=a[g]);l-=v;L?(l=0<r?l+F:0<w?l+M[G-t]:l+F,l&=255,F=M[G]=l):M[G]=l}else for(w=G=0;w<h;w++)for(r=0;r<t;r++,G++)if(C[G]){l=0;p=D=H<<d>>>32-u;32-d<u&&(p=D|=a[g+1]>>>64-d-u);if(f[p])l=f[p][1],d+=f[p][0];else for(p=D=H<<d>>>32-b,32-d<b&&(p=D|=a[g+1]>>>64-d-b),p=m,E=0;E<b;E++)if(p=(y=D>>>b-E-1&1)?p.right:p.left,!p.left&&!p.right){l=p.val;d=d+E+1;break}32<=d&&(d-=32,g++,H=a[g]);l-=v;L?(l=0<r&&C[G-1]?l+F:0<w&&C[G-t]?l+M[G-t]:l+F,
l&=255,F=M[G]=l):M[G]=l}c.ptr=c.ptr+4*(g+1)+(0<d?4:0)}c.pixels.resultPixels=N},decodeBits:function(f,c,q,n,k){var h=c.headerInfo,t=h.fileVersion,e=0,b=new DataView(f,c.ptr,5<=f.byteLength-c.ptr?5:f.byteLength-c.ptr),m=b.getUint8(0);e++;var a=m>>6,g=0===a?4:3-a,d=0<(m&32)?!0:!1,a=m&31,m=0;if(1===g)m=b.getUint8(e),e++;else if(2===g)m=b.getUint16(e,!0),e+=2;else if(4===g)m=b.getUint32(e,!0),e+=4;else throw"Invalid valid pixel count type";var g=2*h.maxZError,u,v;k=1<h.numDims?h.maxValues[k]:h.zMax;if(d){c.counter.lut++;
d=b.getUint8(e);e++;h=Math.ceil((d-1)*a/8);u=Math.ceil(h/4);u=new ArrayBuffer(4*u);v=new Uint8Array(u);c.ptr+=e;v.set(new Uint8Array(f,c.ptr,h));e=new Uint32Array(u);c.ptr+=h;for(b=0;d-1>>>b;)b++;h=Math.ceil(m*b/8);u=Math.ceil(h/4);u=new ArrayBuffer(4*u);v=new Uint8Array(u);v.set(new Uint8Array(f,c.ptr,h));f=new Uint32Array(u);c.ptr+=h;c=3<=t?r.unstuffLUT2(e,a,d-1,n,g,k):r.unstuffLUT(e,a,d-1,n,g,k);3<=t?r.unstuff2(f,q,b,m,c):r.unstuff(f,q,b,m,c)}else c.counter.bitstuffer++,b=a,c.ptr+=e,0<b&&(h=Math.ceil(m*
b/8),u=Math.ceil(h/4),u=new ArrayBuffer(4*u),v=new Uint8Array(u),v.set(new Uint8Array(f,c.ptr,h)),f=new Uint32Array(u),c.ptr+=h,3<=t?null==n?r.originalUnstuff2(f,q,b,m):r.unstuff2(f,q,b,m,!1,n,g,k):null==n?r.originalUnstuff(f,q,b,m):r.unstuff(f,q,b,m,!1,n,g,k))},readTiles:function(p,c,q){var n=c.headerInfo,k=n.width,h=n.height,t=n.microBlockSize,e=n.imageType,b=f.getDataTypeSize(e),m=Math.ceil(k/t),a=Math.ceil(h/t);c.pixels.numBlocksY=a;c.pixels.numBlocksX=m;for(var g=c.pixels.ptr=0,d=0,u=0,v=0,l=
0,z=0,C=0,D=0,y=0,w=0,r=0,G=0,E=0,C=E=C=0,F,H=new q(t*t),L=h%t||t,N=k%t||t,M=n.numDims,J,K=c.pixels.resultMask,O=c.pixels.resultPixels,Q=5<=n.fileVersion?14:15,P=n.zMax,u=0;u<a;u++)for(l=u!==a-1?t:L,v=0;v<m;v++)for(z=v!==m-1?t:N,r=u*k*t+v*t,G=k-z,J=0;J<M;J++){1<M?(E=O,r=u*k*t+v*t,O=new q(c.pixels.resultPixels.buffer,k*h*J*b,k*h),P=n.maxValues[J]):E=null;C=p.byteLength-c.ptr;g=new DataView(p,c.ptr,Math.min(10,C));d={};C=0;D=g.getUint8(0);C++;F=5<=n.fileVersion?D&4:0;y=D>>6&255;w=D>>2&Q;if(w!==(v*t>>
3&Q))throw"integrity issue";if(F&&0===J)throw"integrity issue";D&=3;if(3<D)throw c.ptr+=C,"Invalid block encoding ("+D+")";if(2===D){if(F)if(K)for(g=0;g<l;g++)for(d=0;d<z;d++)K[r]&&(O[r]=E[r]),r++;else for(g=0;g<l;g++)for(d=0;d<z;d++)O[r]=E[r],r++;c.counter.constant++;c.ptr+=C}else if(0===D){if(F)throw"integrity issue";c.counter.uncompressed++;c.ptr+=C;E=l*z*b;C=p.byteLength-c.ptr;E=E<C?E:C;C=new ArrayBuffer(0===E%b?E:E+b-E%b);F=new Uint8Array(C);F.set(new Uint8Array(p,c.ptr,E));C=new q(C);E=0;if(K)for(g=
0;g<l;g++){for(d=0;d<z;d++)K[r]&&(O[r]=C[E++]),r++;r+=G}else for(g=0;g<l;g++){for(d=0;d<z;d++)O[r++]=C[E++];r+=G}c.ptr+=E*b}else if(y=f.getDataTypeUsed(F&&6>e?4:e,y),w=f.getOnePixel(d,C,y,g),C+=f.getDataTypeSize(y),3===D)if(c.ptr+=C,c.counter.constantoffset++,K)for(g=0;g<l;g++){for(d=0;d<z;d++)K[r]&&(O[r]=F?Math.min(P,E[r]+w):w),r++;r+=G}else for(g=0;g<l;g++){for(d=0;d<z;d++)O[r]=F?Math.min(P,E[r]+w):w,r++;r+=G}else if(c.ptr+=C,f.decodeBits(p,c,H,w,J),C=0,F)if(K)for(g=0;g<l;g++){for(d=0;d<z;d++)K[r]&&
(O[r]=H[C++]+E[r]),r++;r+=G}else for(g=0;g<l;g++){for(d=0;d<z;d++)O[r]=H[C++]+E[r],r++;r+=G}else if(K)for(g=0;g<l;g++){for(d=0;d<z;d++)K[r]&&(O[r]=H[C++]),r++;r+=G}else for(g=0;g<l;g++){for(d=0;d<z;d++)O[r++]=H[C++];r+=G}}},formatFileInfo:function(p){return{fileIdentifierString:p.headerInfo.fileIdentifierString,fileVersion:p.headerInfo.fileVersion,imageType:p.headerInfo.imageType,height:p.headerInfo.height,width:p.headerInfo.width,numValidPixel:p.headerInfo.numValidPixel,microBlockSize:p.headerInfo.microBlockSize,
blobSize:p.headerInfo.blobSize,maxZError:p.headerInfo.maxZError,pixelType:f.getPixelType(p.headerInfo.imageType),eofOffset:p.eofOffset,mask:p.mask?{numBytes:p.mask.numBytes}:null,pixels:{numBlocksX:p.pixels.numBlocksX,numBlocksY:p.pixels.numBlocksY,maxValue:p.headerInfo.zMax,minValue:p.headerInfo.zMin,noDataValue:p.noDataValue}}},constructConstantSurface:function(f){var c=f.headerInfo.zMax,q=f.headerInfo.numDims,n=f.headerInfo.height*f.headerInfo.width,k=0,h=0,t=0,e=f.pixels.resultMask,b=f.pixels.resultPixels;
if(e)if(1<q)for(k=0;k<q;k++)for(t=k*n,c=f.headerInfo.maxValues[k],h=0;h<n;h++)e[h]&&(b[t+h]=c);else for(h=0;h<n;h++)e[h]&&(b[h]=c);else if(1<q)for(k=0;k<q;k++)for(t=k*n,c=f.headerInfo.maxValues[k],h=0;h<n;h++)b[t+h]=c;else for(h=0;h<n;h++)b[h]=c},getDataTypeArray:function(f){switch(f){case 0:f=Int8Array;break;case 1:f=Uint8Array;break;case 2:f=Int16Array;break;case 3:f=Uint16Array;break;case 4:f=Int32Array;break;case 5:f=Uint32Array;break;case 6:f=Float32Array;break;case 7:f=Float64Array;break;default:f=
Float32Array}return f},getPixelType:function(f){switch(f){case 0:f="S8";break;case 1:f="U8";break;case 2:f="S16";break;case 3:f="U16";break;case 4:f="S32";break;case 5:f="U32";break;case 6:f="F32";break;case 7:f="F64";break;default:f="F32"}return f},isValidPixelValue:function(f,c){if(null==c)return!1;switch(f){case 0:f=-128<=c&&127>=c;break;case 1:f=0<=c&&255>=c;break;case 2:f=-32768<=c&&32767>=c;break;case 3:f=0<=c&&65536>=c;break;case 4:f=-2147483648<=c&&2147483647>=c;break;case 5:f=0<=c&&4294967296>=
c;break;case 6:f=-3.4027999387901484E38<=c&&3.4027999387901484E38>=c;break;case 7:f=4.9E-324<=c&&1.7976931348623157E308>=c;break;default:f=!1}return f},getDataTypeSize:function(f){var c=0;switch(f){case 0:case 1:c=1;break;case 2:case 3:c=2;break;case 4:case 5:case 6:c=4;break;case 7:c=8;break;default:c=f}return c},getDataTypeUsed:function(f,c){var q=f;switch(f){case 2:case 4:q=f-c;break;case 3:case 5:q=f-2*c;break;case 6:q=0===c?f:1===c?2:1;break;case 7:q=0===c?f:f-2*c+1;break;default:q=f}return q},
getOnePixel:function(f,c,q,n){f=0;switch(q){case 0:f=n.getInt8(c);break;case 1:f=n.getUint8(c);break;case 2:f=n.getInt16(c,!0);break;case 3:f=n.getUint16(c,!0);break;case 4:f=n.getInt32(c,!0);break;case 5:f=n.getUInt32(c,!0);break;case 6:f=n.getFloat32(c,!0);break;case 7:f=n.getFloat64(c,!0);break;default:throw"the decoder does not understand this pixel type";}return f}},l=function(f,c,q){this.val=f;this.left=c;this.right=q};return{decode:function(l,c){c=c||{};var q=c.noDataValue,n=0,k={};k.ptr=c.inputOffset||
0;k.pixels={};if(f.readHeaderInfo(l,k)){var n=k.headerInfo,h=n.fileVersion,t=f.getDataTypeArray(n.imageType);if(5<h)throw"unsupported lerc version 2."+h;f.readMask(l,k);n.numValidPixel===n.width*n.height||k.pixels.resultMask||(k.pixels.resultMask=c.maskData);var e=n.width*n.height;k.pixels.resultPixels=new t(e*n.numDims);k.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==n.numValidPixel)if(n.zMax===n.zMin)f.constructConstantSurface(k);else if(4<=h&&f.checkMinMaxRanges(l,
k))f.constructConstantSurface(k);else{var b=new DataView(l,k.ptr,2),m=b.getUint8(0);k.ptr++;if(m)f.readDataOneSweep(l,k,t);else if(1<h&&1>=n.imageType&&1E-5>Math.abs(n.maxZError-.5)){b=b.getUint8(1);k.ptr++;k.encodeMode=b;if(2<b||4>h&&1<b)throw"Invalid Huffman flag "+b;b?f.readHuffman(l,k,t):f.readTiles(l,k,t)}else f.readTiles(l,k,t)}k.eofOffset=k.ptr;c.inputOffset?(l=k.headerInfo.blobSize+c.inputOffset-k.ptr,1<=Math.abs(l)&&(k.eofOffset=c.inputOffset+k.headerInfo.blobSize)):(l=k.headerInfo.blobSize-
k.ptr,1<=Math.abs(l)&&(k.eofOffset=k.headerInfo.blobSize));l={width:n.width,height:n.height,pixelData:k.pixels.resultPixels,minValue:n.zMin,maxValue:n.zMax,validPixelCount:n.numValidPixel,dimCount:n.numDims,dimStats:{minValues:n.minValues,maxValues:n.maxValues},maskData:k.pixels.resultMask};if(k.pixels.resultMask&&f.isValidPixelValue(n.imageType,q)){h=k.pixels.resultMask;for(n=0;n<e;n++)h[n]||(l.pixelData[n]=q);l.noDataValue=q}k.noDataValue=q;c.returnFileInfo&&(l.fileInfo=f.formatFileInfo(k));return l}},
getBandCount:function(l){for(var c=0,q=0,n={ptr:0,pixels:{}};q<l.byteLength-58;)f.readHeaderInfo(l,n),q+=n.headerInfo.blobSize,c++,n.ptr=q;return c}}})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),function(r,f,l,p,c,q){r=r(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond",
"esriMilesPerHour"],constructor:function(c){f.mixin(this,c);this.isDataUV=c&&c.isDataUV?c.isDataUV:!1;this.computeMagnitudeAndDirection=f.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(c,f){this.inputUnit=c;this.outputUnit=f;this.unitConversionFactor=1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var c=q.indexOf(this.speedUnits,this.inputUnit),f=q.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&
this.outputUnit&&0<=c&&0<=f){var h=[1,.277778,.514444,.3048,.44704,0];this.unitConversionFactor=h[c]/h[f]}},computeMagnitudeAndDirection:function(f){if(!c.isDefined(f))throw"Could not compute magnitude and direction. No pixel data is available.";var k=f.pixelBlock;if(!c.isDefined(k)||2!==k.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";var h=f.extent,t=(h.xmax-h.xmin)/k.width,e=(h.ymax-h.ymin)/k.height,b=h.xmin+t/2,h=h.ymax-e/2;k.statistics[0].minValue=
0;k.statistics[0].maxValue=0;var m=180/Math.PI,a=[],g=0,d=0,u=0,n=!c.isDefined(k.mask),q,l,p,D,y,w,r,G;y=r=Infinity;w=G=-Infinity;for(g=0;g<k.height;g++)for(d=0;d<k.width;d++,u++)if(a.push([b+t*d,h-e*g]),n||k.mask[u])p=q=k.pixels[0][u]*this.unitConversionFactor,D=l=k.pixels[1][u],this.isDataUV&&(p=Math.sqrt(q*q+l*l),D=90-m*Math.atan2(l,q),k.pixels[0][u]=p*this.unitConversionFactor,k.pixels[1][u]=D),p>w&&(w=p),p<y&&(y=p),D>G&&(G=D),D<r&&(r=D);k.statistics[0].maxValue=w;k.statistics[0].minValue=y;k.statistics[1].maxValue=
G;k.statistics[1].minValue=r;f.locations=a;return f}});l("extend-esri")&&f.setObject("layers.pixelFilters.VectorFieldPixelFilter",r,p);return r})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(r,f,l,p){var c;return f(null,{constructor:function(c){this.ctx=c.ctx;this._loadRasterFormatModule()},decode:function(c,f){if(!f.width||!f.height)throw"Native decoding requires the image format, width and height";var k=
new l,h,t=new Uint8Array(c);c=this._getFormat(c);if("error"===c)throw"invalid format";"jpeg"===c&&(h=this._getMask(t,f));var e="",b,m;for(b=0;b<t.length;b+=65535)m=t.subarray(b,b+65535>t.length-1?t.length-1:b+65535),e+=String.fromCharCode.apply(null,m);var t="data:image/"+c+";base64,"+window.btoa(e),a=new Image,g;a.src=t;var d=this;a.onload=function(){d.ctx.clearRect(0,0,f.width,f.height);d.ctx.drawImage(a,0,0);var e=d.ctx.getImageData(0,0,a.width,a.height);g=e.data;if(h)for(b=0;b<h.length;b++)g[4*
b+3]=h[b]?255:0;d.ctx.putImageData(e,0,0);k.resolve(null)};a.onerror=function(){k.reject("cannot load image")};return k},_getFormat:function(c){c=new Uint8Array(c,0,10);var f="error";255===c[0]&&216===c[1]?f="jpeg":137===c[0]&&80===c[1]&&78===c[2]&&71===c[3]&&(f="png");return f},_getMask:function(f,n){var k;try{if(!c)throw"The zlib decoder module is not loaded.";var h=0,t=0,e=Math.round(f.length/2);1===e%2&&(e+=1);for(var b=f.length-2,h=e;h<b&&(255!==f[h]||217!==f[h+1]);h++);e=h+=2;if(e<f.length-
1){var m=(new c(f.subarray(e))).getBytes();k=new Uint8Array(n.width*n.height);for(h=f=0;h<m.length;h++)for(t=7;0<=t;t--)k[f++]=m[h]>>t&1}}catch(a){}return k},_loadRasterFormatModule:function(){10>p("ie")||r(["./Zlib"],function(f){c=f})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),function(r,f,l,p,c,q,n,k){r=r(n,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",
constructor:function(c){this._url.path+="/identify";this._handler=f.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(c,f,e,b,m){try{var a=new k(c);this._successHandler([a],"onComplete",e,m)}catch(g){this._errorHandler(g,b,m)}},execute:function(h,k,e,b){var m=b.assembly;h=this._encode(f.mixin({},this._url.query,{f:"json"},h.toJson(m&&m[0])));var a=this._handler,g=this._errorHandler;return c({url:this._url.path,content:h,callbackParamName:"callback",
load:function(d,g){a(d,g,k,e,b.dfd)},error:function(a){g(a,e,b.dfd)}})},onComplete:function(){}});q._createWrappers(r);l("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyTask",r,p);return r})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(r,f,l,p,c,q){r=r(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(f){f.catalogItems&&(this.catalogItems=
new q(f.catalogItems));f.location&&(this.location=c.fromJson(f.location));this.catalogItemVisibilities=f.catalogItemVisibilities;this.name=f.name;this.objectId=f.objectId;this.value=f.value;this.processedValues=f.processedValues;this.properties=f.properties}});l("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyResult",r,p);return r})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),
function(r,f,l,p,c,q,n,k){r=r(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,maxItemCount:null,returnPixelValues:!0,toJson:function(c){var f=c&&c.geometry||this.geometry;c={geometry:f,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?l.toJson(this.mosaicRule.toJson()):
null,renderingRule:this.renderingRule?l.toJson(this.renderingRule.toJson()):null};f&&(c.geometryType=k.getJsonType(f));f=this.timeExtent;c.time=f?f.toJson().join(","):null;n.isDefined(this.pixelSizeX)&&n.isDefined(this.pixelSizeY)?c.pixelSize=l.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(c.pixelSize=this.pixelSize?l.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(c.renderingRules=l.toJson(p.map(this.renderingRules,function(e){return e.toJson()})));
n.isDefined(this.returnPixelValues)&&(c.returnPixelValues=this.returnPixelValues);n.isDefined(this.maxItemCount)&&(c.maxItemCount=this.maxItemCount);return c}});c("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyParameters",r,q);return r})},"esri/layers/pixelFilters/StretchFilter":function(){define(["dojo/_base/declare","dojo/_base/lang","../PixelBlock"],function(r,f,l){var p;return r(null,{stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,
maxPercent:.5,useGamma:!1,gamma:null,raster:null,outputPixelType:"U8",computeGamma:!1,constructor:function(c){this.stretchType=c.stretchType||c.StretchType||this.stretchType;this.min=c.min||c.Min||this.min;this.max=c.max||c.Max||this.max;this.numberOfStandardDeviations=c.numberOfStandardDeviations||c.NumberOfStandardDeviations||this.numberOfStandardDeviations;this.statistics=c.statistics||c.Statistics||this.statistics;this.dra=c.dra||c.DRA||c.dRA||this.dra;this.minPercent=c.minPercent||c.MinPercent||
this.minPercent;this.maxPercent=c.maxPercent||c.MaxPercent||this.maxPercent;this.useGamma=c.useGamma||c.UseGamma||this.useGamma;this.gamma=c.gamma||c.Gamma||this.gamma;this.computeGamma=c.computeGamma||c.ComputeGamma||this.computeGamma;this.raster=c.raster||c.Raster||this.raster;this.outputPixelType=c.outputPixelType||c.OutputPixelType||this.outputPixelType;this.raster=c.raster||c.Raster||this.raster;p=this},filter:function(c){if(void 0!==c&&null!==c&&null!==c.pixelBlock&&null!==c.pixelBlock.pixels){var f=
c.pixelBlock,n=f.pixels,k=f.width*f.height,h=n.length,t;(t=6===p.stretchType||3===p.stretchType&&p.dra)&&p._calculateStatisticsHistograms(c);if(p.dra)if(t)p._statistics=f.statistics,p._histograms=f.histograms;else{var e=f.statistics;p._statistics=[];for(t=0;t<h;t++)p._statistics[t]=[e[t].minValue,e[t].maxValue,0,0]}else p._statistics=p.statistics,p._histograms=p.histograms;p.computeGamma&&(p.gamma=p._computeGammaValues(f.pixelType),p.useGamma=!0);p._createLUT(c);if(void 0===p.LUT||null===p.LUT)return p._filterNoLUT(c);
var e=p.LUT,b=p.LUTOffset,m,a;for(t=0;t<h;t++)for(a=e[t],f=0;f<k;f++)m=n[t][f],n[t][f]=a[m-b];c.pixelBlock.pixelType="U8";return c}},_calculateStatisticsHistograms:function(c){c=c.pixelBlock;var q=c.pixelType,n=c.pixels,k=c.mask,h=n.length,t,e,b,m,a=function(a){this.min=-.5;this.max=255.5;this.size=256;f.mixin(this,a);this.counts=this.counts||new Uint32Array(this.size)},g=[],d,u,v,l,p,C;for(b=0;b<h;b++){d=new a;u=d.counts;l=n[b];if("U8"===q)if(k)for(m=0;m<c.width*c.height;m++)k[m]&&u[l[m]]++;else for(m=
0;m<c.width*c.height;m++)u[l[m]]++;else{t=c.statistics[b].minValue;e=c.statistics[b].maxValue;d.min=t;d.max=e;e=(e-t)/256;v=new Uint32Array(257);if(k)for(m=0;m<c.width*c.height;m++)k[m]&&v[Math.floor((l[m]-t)/e)]++;else for(m=0;m<c.width*c.height;m++)v[Math.floor((l[m]-t)/e)]++;for(m=0;255>m;m++)u[m]=v[m];u[255]=v[255]+v[256]}g.push(d);l=[];t=c.statistics[b].minValue;e=c.statistics[b].maxValue;for(m=C=p=v=0;m<d.size;m++)v+=u[m],p+=m*u[m];p/=v;for(m=0;m<d.size;m++)C+=u[m]*Math.pow(m-p,2);u=Math.sqrt(C/
(v-1));m=(p+.5)*(d.max-d.min)/d.size+d.min;d=u*(d.max-d.min)/d.size;l.push(t);l.push(e);l.push(m);l.push(d);c.statistics[b]=l}c.histograms=g},_getCutOffPoints:function(c){c=c.pixelBlock.pixels.length;var f=[],n=[],k,h,t,e,b,m;switch(p.stretchType){case 5:for(b=0;b<c;b++)f[b]=p._statistics[b][0],n[b]=p._statistics[b][1];break;case 3:for(b=0;b<c;b++)f[b]=p._statistics[b][2]-p.numberOfStandardDeviations*p._statistics[b][3],n[b]=p._statistics[b][2]+p.numberOfStandardDeviations*p._statistics[b][3],f[b]<
p._statistics[b][0]&&(f[b]=p._statistics[b][0]),n[b]>p._statistics[b][1]&&(n[b]=p._statistics[b][1]);break;case 6:for(b=0;b<c;b++){k=p._histograms[b];e=new Uint32Array(k.size);t=k.counts;for(m=h=0;m<k.size;m++)h+=t[m],e[m]=h;t=p.minPercent*h/100;for(m=1;m<k.size;m++)if(e[m]>t){f[b]=k.min+(k.max-k.min)/k.size*(m-.5);break}t=(1-p.maxPercent/100)*h;for(m=k.size-2;0<=m;m--)if(e[m]<t){n[b]=k.min+(k.max-k.min)/k.size*(m+.5);break}}break;default:for(b=0;b<c;b++)f[b]=0,n[b]=255}return{minCutOff:f,maxCutOff:n}},
_createLUT:function(c){var f=c.pixelBlock,n=f.pixelType;if("U8"===n||"U16"===n||"S8"===n||"S16"===n){if(p._LUTSignature&&(n=p._computeLutSignature(),n.length===p._LUTSignature.length&&!n.some(function(a,d){return a!==p._LUTSignature[d]})))return;var n=f.pixels.length,k=[],h=[],t=[],e,b,m,a=p.max,g=p.min,d=p.gamma,u=a-g,v=p._getCutOffPoints(c);c=v.minCutOff;var v=v.maxCutOff,l=0,z=256,C;"S8"===f.pixelType?l=-127:"S16"===f.pixelType&&(l=-32767);if("U16"===f.pixelType||"S16"===f.pixelType)z=65536;for(f=
0;f<n;f++)k[f]=v[f]-c[f];if(p.useGamma&&null!==d&&d.length===n)for(f=0;f<n;f++)t[f]=1<d[f]?2<d[f]?6.5+Math.pow(d[f]-2,2.5):6.5+100*Math.pow(2-d[f],4):1;if(p.useGamma)for(var D,f=0;f<n;f++){C=[];for(e=0;e<z;e++)b=e+l,D=(b-c[f])/k[f],m=1,1<d[f]&&(m-=Math.pow(1/u,D*t[f])),b<v[f]&&b>c[f]?C[e]=Math.floor(m*u*Math.pow(D,1/d[f]))+g:b>v[f]?C[e]=a:b<c[f]&&(C[e]=g);h[f]=C}else for(f=0;f<n;f++){C=[];for(e=0;e<z;e++)b=e+l,C[e]=b<c[f]?g:b>v[f]?a:Math.floor((b-c[f])/k[f]*u)+g;h[f]=C}p.LUT=h;p.LUTOffset=l;p._LUTSignature=
p._computeLutSignature()}},_computeLutSignature:function(){var c=[],f,n;c.push(p.stretchType);c.push(p.min);c.push(p.max);c.push(p.numberOfStandardDeviations);if(p._statistics)for(f=0;f<p._statistics.length;f++)for(n=0;n<p._statistics[f].length;n++)c.push(p._statistics[f][n]);c.push(p.dra?1:0);c.push(p.minPercent);c.push(p.maxPercent);if(p.gamma)for(f=0;f<p._statistics.length;f++)c.push(p.gamma[f]);c.push(p.useGamma?1:0);return c},_filterNoLUT:function(c){if(null!==c&&null!==c.pixelBlock&&null!==
c.pixelBlock.pixels){var f=c.pixelBlock,n=f.pixels,k=f.mask,f=f.width*f.height,h=n.length,t=[],e=[],b,m,a,g,d,u=p.max,v=p.min,l=p.gamma,z=u-v;b=p._getCutOffPoints(c);var C=b.minCutOff,D=b.maxCutOff;for(b=0;b<h;b++)t[b]=D[b]-C[b];if(p.useGamma&&null!==l&&l.length===h)for(b=0;b<h;b++)e[b]=1<l[b]?2<l[b]?6.5+Math.pow(l[b]-2,2.5):6.5+100*Math.pow(2-l[b],4):1;if(p.useGamma)if(void 0!==k&&null!==k)for(m=0;m<f;m++){if(k[m])for(b=0;b<h;b++)a=n[b][m],d=(a-C[b])/t[b],g=1,1<l[b]&&(g-=Math.pow(1/z,d*e[b])),a<
D[b]&&a>C[b]?n[b][m]=Math.floor(g*z*Math.pow(d,1/l[b]))+v:a>D[b]?n[b][m]=u:a<C[b]&&(n[b][m]=v)}else for(m=0;m<f;m++)for(b=0;b<h;b++)a=n[b][m],d=(a-C[b])/t[b],g=1,1<l[b]&&(g-=Math.pow(1/z,d*e[b])),a<D[b]&&a>C[b]?n[b][m]=Math.floor(g*z*Math.pow(d,1/l[b]))+v:a>D[b]?n[b][m]=u:a<C[b]&&(n[b][m]=v);else if(void 0!==k&&null!==k)for(m=0;m<f;m++){if(k[m])for(b=0;b<h;b++)a=n[b][m],a<D[b]&&a>C[b]?n[b][m]=Math.floor((a-C[b])/t[b]*z)+v:a>D[b]?n[b][m]=u:a<C[b]&&(n[b][m]=v)}else for(m=0;m<f;m++)for(b=0;b<h;b++)a=
n[b][m],a<D[b]&&a>C[b]?n[b][m]=Math.floor((a-C[b])/t[b]*z)+v:a>D[b]?n[b][m]=u:a<C[b]&&(n[b][m]=v);c.pixelBlock.pixelType="U8";return c}},_computeGammaValues:function(c){var f=this._statistics.length,n,k=[],h;for(n=0;n<f;n++)h=this._statistics[n][2],"U8"!==c&&(h=255*(h-this._statistics[n][0])/(this._statistics[n][1]-this._statistics[n][0])),k.push(this._computeGammaValue(h));return k},_computeGammaValue:function(c){if(0!==c&&!(255<c||0>c)){var f=0;0<c&&150!=c&&255>c&&(f=150>=c?45*Math.cos(.01047*c):
17*Math.sin(.021*c));f=Math.log((c+f)/255);if(0!==f&&(c=Math.log(c/255)/f,!isNaN(c)))return Math.min(9.9,Math.max(.01,c))}}})})},"esri/layers/StreamLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/_base/lang dojo/Deferred dojo/has dojo/io-query dojo/on dojo/aspect ../kernel ../request ../graphic ./FeatureLayer ./StreamMode ./StreamTrackManager ../geometry/jsonUtils ../symbols/SimpleFillSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleMarkerSymbol ../renderers/SimpleRenderer ./PurgeOptions".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C,D){r=r([a],{declaredClass:"esri.layers.StreamLayer",_preventInit:!0,constructor:function(d,e){e=e||{};e.mode&&e.mode!==a.MODE_STREAM||(this._isStream=!0,this.currentMode=this.mode=a.MODE_STREAM,this._mode=new g(this));this.purgeOptions=new D(this,e.purgeOptions||{});this.purgeInterval=e.purgeInterval||0;this._reconnectAttempts=0;this.maxReconnectAttempts=10;this.socket=this._reconnectTimeoutId=null;this._keepLatestQueried=!1;this._keepLatestUrl=null;
this._relatedQueried=!1;this._joinField=this._relatedUrl=null;this._refreshing=!1;this._attemptReconnect=c.hitch(this,this._attemptReconnect);this._purge=c.hitch(this,this._purge);this._processServiceJson=c.hitch(this,this._processServiceJson);if(c.isObject(d)&&d.layerDefinition)this._initFeatureLayer(d,e);else{var f=this;b({url:d,content:c.mixin({f:"json"}),callbackParamName:"callback"}).then(function(a){f._processServiceJson(a,e)},function(a){f._errorHandler(a)})}},_processServiceJson:function(a,
d){var e=this;a.relatedFeatures&&a.relatedFeatures.featuresUrl&&a.relatedFeatures.joinField?(this._relatedUrl=a.relatedFeatures.featuresUrl,this.objectIdField=this._joinField=a.relatedFeatures.joinField,b({url:this._relatedUrl,content:{f:"json"},callbackParamName:"callback"}).then(function(b){b=b.fields||[];var g=l.map(a.fields,function(a){return a.name.toLowerCase()});l.forEach(b,function(d){-1===l.indexOf(g,d.name.toLowerCase())&&a.fields.push(d)});d.resourceInfo=a;e._initFeatureLayer(e._url,d)},
function(a){e.onError({error:a})})):(d.resourceInfo=a,this._initFeatureLayer(this._url,d))},_initLayer:function(a,d){this.inherited(arguments);if(a){var b;if(a.layerDefinition)this.purgeOptions=new D(this,this._params.purgeOptions||{}),this.socketUrl=this._params.socketUrl||a.layerDefinition.socketUrl||void 0;else{if(this._params.socketUrl)this.socketUrl=this._params.socketUrl;else{var e=this._getWebsocketConnectionInfo(a),g=e.urls;g&&g.length?(this._socketUrls=g,this.socketUrl=g[0],this.socketDirection=
"broadcast"===this._params.socketDirection?"broadcast":"subscribe",this.socketUrl+="/"+this.socketDirection,this._websocketToken=e.token,g.length>this.maxReconnectAttempts&&(this.maxReconnectAttempts=g.length)):(this.socketUrl=void 0,e="No web socket urls were retrieved from the Stream Service. Layer will not attempt to connect.","https:"===location.protocol&&(e+=" An insecure web socket connection cannot be made from a secure web page."),this.onError(Error(e)))}if(this._params.filter)try{this._filter=
b=this._makeFilter(this._params.filter)}catch(F){this.onError(Error("Error trying to create filter object: "+F+". Layer will not have filter applied")),this._filter=null}if(this._params.geometryDefinition||this._outFields||this._defnExpr){b=b||{};b.geometry=this._params.geometryDefinition;b.outFields=this._outFields;b.where=this._defnExpr;try{this._filter=b=this._makeFilter(b)}catch(F){this.onError(Error("Error trying to create filter object: "+F+". Layer will not have filter applied")),this._filter=
null}}}this.maximumTrackPoints=this._params.maximumTrackPoints||0===this._params.maximumTrackPoints?this._params.maximumTrackPoints:1;(this._params.refreshRate||0===this._params.refreshRate)&&this._mode&&this._mode._setRefreshRate&&this._mode._setRefreshRate(this._params.refreshRate);this._keepLatestUrl=a.keepLatestArchive?a.keepLatestArchive.featuresUrl:null;a.relatedFeatures&&a.relatedFeatures.featuresUrl&&a.relatedFeatures.joinField&&(this._relatedUrl=a.relatedFeatures.featuresUrl,this.objectIdField=
this._joinField=a.relatedFeatures.joinField);this.objectIdField||this._makeObjectIdField();this._map&&this.socketUrl&&!this._connected&&this.connect()}},_isWebGLCompatible:function(){return!1},_setMap:function(a){var b=this.inherited(arguments),e=this._getRenderer();this.timeInfo&&(this._trackIdField||e&&(e.latestObservationRenderer||e.trackRenderer))&&(this._trackManager=new d(this),this._trackManager.initialize(a));this.socketUrl&&!this._connected&&this._map&&this.connect();return b},_unsetMap:function(a,
d){l.forEach(this._connects,f.disconnect);(this._connected||this._reconnecting||this.socket)&&this.disconnect();this._togglePurgeT();this.inherited(arguments);this._map=null},_suspend:function(){this._togglePurgeT();this.inherited(arguments)},_resume:function(){this.inherited(arguments);this._togglePurgeT(!0)},clear:function(){try{this._mode&&this._mode._clearDrawBuffer&&this._mode._clearDrawBuffer(),this._mode&&this._mode._clearTimeBin&&this._mode._clearTimeBin(),this._mode&&this._mode._clearFeatureMap&&
this._mode._clearFeatureMap(),this._trackManager&&this._trackManager.clearTracks()}catch(y){}this.inherited(arguments);this._trackManager&&this._trackManager.createTracklineContainer()},redraw:function(){this._mode&&this._mode._flushDrawBuffer&&this._mode._flushDrawBuffer();this.inherited(arguments)},setDefinitionExpression:function(a){this.setFilter({where:a})},getDefinitionExpression:function(){var a;this._filter&&(a=this._filter.where);return a},destroy:function(){this.disconnect();this.inherited(arguments)},
onResume:function(a){this.inherited(arguments)},setGeometryDefinition:function(a){this.setFilter({geometry:a})},getGeometryDefinition:function(){var a;this._filter&&(a=this._filter.geometry);return a},connect:function(a){var d=new q,b={},e=this._filter,g,c,f=this.socketUrl,m;try{this._connected||this._connecting?d.reject(Error("Cannot start new connection process. Layer is connecting.")):(this._connecting=!0,this._getRelatedFeatures().then(function(){return this._getKeepLatestFeatures()}.bind(this)).then(function(){this._websocketToken&&
(b.token=this._websocketToken);this._map&&this._map.spatialReference&&this.spatialReference&&this._map.spatialReference.wkid!==this.spatialReference.wkid&&(b.outSR=this._map.spatialReference.wkid);if(e)for(c in e)null!==e[c]&&(g="geometry"===c?JSON.stringify(e[c]):e[c],b[c]=g);f+="?"+k.objectToQuery(b);m=this._createConnection(f,a);d.resolve(m)}.bind(this)).otherwise(function(a){d.reject(a)}))}catch(N){a&&(a(N,!1),d.reject(N)),this.onConnectionError({error:N})}return d.promise},disconnect:function(a){var d=
this._refreshing?"Disconnecting as part of layer refresh cycle":"Connection closed from client",b=this._refreshing?!0:!1;this._reconnectTimeoutId&&clearTimeout(this._reconnectTimeoutId);this._refreshing=this._reconnecting=this._connecting=this._connected=!1;this.socket&&this.socket.close();this.onDisconnect({willReconnect:b,message:d});a&&a(null,!0)},setFilter:function(a){var d,b;if(this._collection)return this.onError("Filter can only be set when the source of the layer is a Stream Service"),!1;
try{if(void 0!==a.outFields)return b=Error("Outfields property cannot be changed after layer is created"),this.onFilterChange({filter:this.getFilter(),error:b}),!1;d=this._makeFilter(a)}catch(G){return b=Error(G),this.onFilterChange({filter:this.getFilter(),error:b}),!1}if(this.socket)a={filter:d},this.socket.send(JSON.stringify(a));else h.once(this,"connect",function(a){this.setFilter(d)});return!0},getFilter:function(){var a=this._filter,d={},b=["geometry","outFields","where"];a&&l.forEach(b,function(b){var e=
a[b];e&&("geometry"===b?e=u.fromJson(e):"outFields"===b&&(e=e.split(",")),d[b]=e)});return d},setMaximumTrackPoints:function(a){if(!a&&0!==a)return!1;this.maximumTrackPoints=a;this._mode.propertyChangeHandler(3)},getUniqueValues:function(a){var d,b={},e=[];d=this._getField(a,!0);if(!d)return e;a=d.name;l.forEach(this.graphics||[],function(d){d=(d.attributes||{})[a];void 0===d||b[d]||(b[d]=1,e.push(d))});e.sort(function(a,d){return a<d?-1:a>d?1:0});return e},getLatestObservations:function(){var a=
[];return a=this._trackManager?this._trackManager.getLatestObservations():this.graphics},setPurgeInterval:function(a){var d=this.purgeInterval;this.purgeInterval=a;this._togglePurgeT();a&&this._togglePurgeT(!0);if(d!==a)this.onPurgeIntervalChange();return this},_togglePurgeT:function(a){if(a&&this.purgeInterval){var d=this;clearTimeout(this._purgeT);this._mode&&this._mode._flushDrawBuffer&&(this._purgeT=setTimeout(function(){d.updating||d.suspended||(d._mode._flushDrawBuffer(),d._togglePurgeT(!0))},
6E4*this.purgeInterval))}else this._purgeT&&(clearTimeout(this._purgeT),this._purgeT=null)},onMessage:function(){},onConnect:function(){},onDisconnect:function(){},onFilterChange:function(){},onAttemptReconnect:function(){},onConnectionError:function(){},onPurgeIntervalChange:function(){},_createConnection:function(a,d){var b=this,e=new WebSocket(a);e.onopen=function(){b.socket=e;b._connected=!0;b._connecting=!1;b._reconnecting=!1;b._reconnectAttempts=0;b._bind();b.onConnect();d&&d(null,!0)};e.onclose=
function(a){var d,e=!0,g=b._connected,c=null;if(b._connected||b._reconnecting){if(a.code)if(d="Connection failed: ",1001===a.code)d+=a.reason||"Service is going away.",e=!1;else if(4400===a.code)d+=a.reason||"Invalid url parameters. Check filter properties.",e=!1;else if(4404===a.code)d+="Service not found",e=!1;else if(4401===a.code||4403===a.code)d+="Not authorized",e=!1;e&&(b._reconnectAttempts+=1,b._reconnectAttempts>b.maxReconnectAttempts&&(d="Maximum reconnect attempts exceeded",e=!1,g=!0));
b._connected=!1;g&&(d&&(c=Error(d)),b.onDisconnect({error:c,willReconnect:e}));e?b._attemptReconnect():b.socket=null}else b.socket||(c=Error("Could not make connection to service"),b.onConnectionError({error:c})),b.socket=null,b._connected=!1};e.onerror=function(a){console.log("Socket error")};return e},_getKeepLatestFeatures:function(){var a=new q;this._map&&this._keepLatestUrl&&!this._keepLatestQueried&&this._mode._fetchArchive?this._mode._fetchArchive(this._keepLatestUrl).then(function(){a.resolve()}.bind(this)).otherwise(function(d){a.reject(d)}).always(function(){this._keepLatestQueried=
!0}.bind(this)):a.resolve();return a.promise},_getRelatedFeatures:function(){var a=new q;this._map&&this._relatedUrl&&!this._relatedQueried&&this._mode._fetchArchive?this._mode._fetchArchive(this._relatedUrl).then(function(){a.resolve()}.bind(this)).otherwise(function(d){a.reject(d)}).always(function(){this._relatedQueried=!0}.bind(this)):a.resolve();return a.promise},_purge:function(){var a,d=[],b;if(this.purgeOptions.displayCount&&this.graphics.length>this.purgeOptions.displayCount)for(a=0;a<this.graphics.length-
this.purgeOptions.displayCount;a++)b=this.graphics[a],d.push(b);0<d.length&&(this._mode._removeFeatures(d),this._trackManager&&this._trackManager.removeFeatures(d))},_bind:function(){var a=this;this.socket.onmessage=function(d){a._onMessage(JSON.parse(d.data))}},_onMessage:function(a){var d=this;this.onMessage(a);var b={create:function(a){d._create(a)},update:function(a){d._update(a)},"delete":function(a){d._delete(a)}};if(a.type)b[a.type](a.feature);else a.hasOwnProperty("filter")?d._handleFilterMessage(a):
this._create(a)},_create:function(a){function d(a){if(!b._featureHasOID(a,e)){if(!a.geometry)return!1;a.attributes=a.attributes||{};a.attributes[e]=b._nextId++}a=a.declaredClass?a:new m(a);b._mode.drawFeature(a)}var b=this,e=b.objectIdField;a.length?a.forEach(function(a){a&&d(a)}):a&&d(a)},_delete:function(a){var d=this,b=a[d.objectIdField]||a.attributes[d.objectIdField],e=!1;this.graphics.forEach(function(a){a.attributes[d.objectIdField]==b&&(e=a)});e&&this.remove(e)},_update:function(a){var d=this,
b=!1;this.graphics.forEach(function(e){e.attributes[d.objectIdField]==a.attributes[d.objectIdField]&&(b=e)});b&&(a.attributes&&b.setAttributes(a.attributes),a.geometry&&b.setGeometry(u.fromJson(a.geometry)))},_makeFilter:function(a){var d,b=null;a=a||{};if(void 0!==a.geometry)if(b=b||{},null===a.geometry)b.geometry=null;else{d="string"===typeof a.geometry?u.fromJson(JSON.parse(a.geometry)):a.geometry.declaredClass?a.geometry:u.fromJson(a.geometry);if(!d||"point"===d.type)throw"Query object contains invalid geometry";
"extent"!==d.type&&(d=d.getExtent());if(!d||0===d.getHeight()&&0===d.getWidth())throw"Invalid filter geometry: Extent cannot have a height and width of 0";b.spatialRel="esriSpatialRelIntersects";b.geometryType="esriGeometryEnvelope";b.geometry=d.toJson()}void 0!==a.where&&(b=b||{},b.where=a.where);if(void 0!==a.outFields&&(b=b||{},a="string"===typeof a.outFields?"*"===a.outFields?null:a.outFields.replace(/,\s+/g,",").split(","):null===a.outFields?null:a.outFields,a=this._makeOutFields(a))){if(a.errors&&
0<a.errors.length)throw"Invalid filter outFields. "+a.errors.join(",");b.outFields=a.fields?a.fields.join(","):null}return b},_makeOutFields:function(a){var d=this,b=[],e=[],g={fields:null};if(!a||0===a.length)return g;l.forEach(a,function(a){if("*"===a)return g;var c=d._getField(a,!0);c?b.push(c.name):e.push("Field named "+a+" not found in schema.")});a=d._getOutFields();l.forEach(a,function(a){d._getField(a)&&-1===l.indexOf(b,a)&&b.push(a)});g.fields=b;g.errors=e;return g},_handleFilterMessage:function(a){a.error?
(a=Error(a.error.join(",")),this.onFilterChange({filter:this.getFilter(),error:a})):(a=a.filter,a.geometry&&"string"===typeof a.geometry&&(a.geometry=JSON.parse(a.geometry)),this._filter=a,this.onFilterChange({filter:this.getFilter()}))},_getWebsocketConnectionInfo:function(a){var d={urls:[]},b,e=[],g=[],c,f,m;a.streamUrls&&l.forEach(a.streamUrls,function(a){"ws"===a.transport&&(b=a.urls,d.token=a.token)});if(!b)return d;l.forEach(b,function(a){0===a.lastIndexOf("wss",0)?g.push(a):e.push(a)});a="https:"===
location.protocol||0===this.url.lastIndexOf("https:",0)?g:0===e.length?g:e;if(1<a.length)for(c=0;c<a.length-1;c++)f=c+Math.floor(Math.random()*(a.length-c)),m=a[f],a[f]=a[c],a[c]=m;d.urls=a;return d},_attemptReconnect:function(){var a=this,d;this._reconnectTimeoutId=null;a._connected=!1;if(!a._socketUrls)return!1;if(!a._collection&&!a._reconnecting&&a.socket&&a.credential)return a._reconnecting=!0,a._getServiceConnectionMetadata(a._attemptReconnect),!1;a._reconnecting=!0;a.socket=null;if(a._reconnectAttempts>
a.maxReconnectAttempts)return a._reconnecting=!1;a.socketUrl=a._socketUrls[a._reconnectAttempts>a._socketUrls.length-1?a._reconnectAttempts%a._socketUrls.length:a._reconnectAttempts];a.socketUrl+="/"+a.socketDirection;d=a._randomIntFromInterval(0,1E3);this._reconnectTimeoutId=setTimeout(function(){a.onAttemptReconnect({count:a._reconnectAttempts,url:a.socketUrl});a.connect()},1E3*a._reconnectAttempts+d)},_getServiceConnectionMetadata:function(a){var d=this,e=d._url.path;a="function"===typeof a?a:
null;b({url:e,content:c.mixin({f:"json"},this._url.query),callbackParamName:"callback"}).then(function(b){b=d._getWebsocketConnectionInfo(b);d._websocketToken=b.token;a&&a()},function(a){d.onError(Error(a))})},_setDefaultRenderer:function(){var a=this.geometryType,d=new p([5,112,176,.8]),b=new p([255,255,255]),b=new B(B.STYLE_SOLID,b,1),e;if("esriGeometryPoint"===a||"esriGeometryMultipoint"===a)e=new z(z.STYLE_CIRCLE,10,b,d);else if("esriGeometryPolyline"===a)e=new B(B.STYLE_SOLID,d,2);else if("esriGeometryPolygon"===
a||"esriGeometryEnvelope"===a)d=new p([5,112,176,.2]),b=new p([5,112,176,.8]),b=new B(B.STYLE_SOLID,b,1),e=new v(v.STYLE_SOLID,b,d);e&&this.setRenderer(new C(e))},_makeObjectIdField:function(){var a=1,d,b,e=[];if(!this.objectIdField){d=this.fields.length;for(b=0;b<d;b++)e.push(this.fields[b].name.toLowerCase());for(;-1!==l.indexOf(e,"objectid_"+a);)a+=1;this.objectIdField="objectid_"+a;this.fields.push({name:"objectid_"+a,type:"esriFieldTypeOID",alias:"objectid_"+a,nullable:!1})}},_featureHasOID:function(a,
d){return a.attributes&&(a.attributes[d]||0===a.attributes[d])},_randomIntFromInterval:function(a,d){return Math.floor(Math.random()*(d-a+1)+a)}});n("extend-esri")&&c.setObject("layers.StreamLayer",r,e);return r})},"esri/layers/StreamTrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Point ../geometry/Polyline ./TrackManager".split(" "),function(r,f,l,p,c,q,n,k,h){r=r([h],{declaredClass:"esri.layers._StreamTrackManager",constructor:function(c){this.inherited(arguments);
var e=c.getMap().spatialReference;this.isWebMercator=e.isWebMercator();this.canWrap=e._isWrappable();this.wrapThreshold=this.isWebMercator?2.0037508342788905E7:180},initialize:function(c){this.inherited(arguments)},addFeatures:function(c,e){function b(a,b){var e,g,c;f[a]||(f[a]=[]);a=f[a];0<d&&(b.length>d&&b.splice(0,b.length-d),g=b.length+a.length,g>d&&(e=a.splice(0,g-d)));g=b.length;for(c=0;c<g;c+=1)a.push(b[c]);return{deletes:e,adds:b}}var f,a,g,d,h={},k={},t;if(e)return this.inherited(arguments),
h;f=this.trackMap;a=this.layer;g=a._trackIdField;d=a.maximumTrackPoints||0;l.forEach(c,function(a){var d=a.attributes[g];a.visible&&(k[d]||(k[d]=[]),k[d].push(a))});for(t in k)k.hasOwnProperty(t)&&(a=b(t,k[t]),h[t]=a);return h},removeFeatures:function(c){var e=[],b=this.layer.objectIdField,f=this.layer._trackIdField;c&&(l.forEach(c,function(a){var g,d,c,m;d=a.attributes[f];g=a.attributes[b];if(c=this.trackMap[d])for(a=0;a<c.length;a+=1)if(m=c[a],m.attributes[b]===g){this.trackMap[d].splice(a,1);-1===
l.indexOf(d)&&e.push(d);break}},this),0<c.length&&this.refreshTracks(e))},drawTracks:function(c){function e(e){var c=a[e],m=c&&1<c.length,h=b.trackLineMap[e];h&&!m&&(f.remove(h),delete b.trackLineMap[e],h=null);if(!m)return!1;for(var u,m=[],t=[],l,v=c.length,p=0;p<v;p++)if(l=c[p].geometry){l=l.normalize();var r=l.x,F=0,H=!1;u&&b.canWrap&&(F=r-u.x,Math.abs(F)>b.wrapThreshold&&(H=!0));H?(t.push([b.getWrappedX(r),l.y]),m.push(t.slice(0)),t=[[r,l.y]]):t.push([r,l.y]);u=new n(r,l.y,g)}1<t.length&&m.push(t);
c={};c[d]=e;if(m.length)if(h){for(var L=h.geometry;L.paths.length;)L.removePath(L.paths.length-1);m.forEach(function(a){L.addPath(a)});h.setGeometry(L)}else h=new q(new k({paths:m,spatialReference:g}),null,c),f.add(h),b.trackLineMap[e]=h}var b=this,f=this.container,a,g,d,h;if(f)if(a=this.trackMap,g=this.map.spatialReference,d=this.layer._trackIdField,c)l.forEach(c,function(a){e(a)});else for(h in a)a.hasOwnProperty(h)&&e(h)},refreshTracks:function(c){function e(a){var d,e;a=b[a]||[];d=a.length;for(e=
0;e<d;e++)f._repaint(a[e],null,!0)}var b=this.trackMap,f=this.layer,a;this.drawTracks(c);if(c)l.forEach(c,function(a){e(a)});else for(a in b)b.hasOwnProperty(a)&&e(a)},getLatestObservations:function(){var c,e,b=this.trackMap,f=[];for(c in b)b.hasOwnProperty(c)&&(e=b[c],f.push(e[e.length-1]));return f},destroy:function(){this.inherited(arguments);this.trackLineMap=null},getWrappedX:function(c){var e=this.isWebMercator,b=e?2.0037508342788905E7:180,e=e?-2.0037508342788905E7:-180;return(0<c?e:b)-((0<
c?b:e)-c)}});p("extend-esri")&&f.setObject("layers._StreamTrackManager",r,c);return r})},"esri/layers/PurgeOptions":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Stateful","dojo/has","../kernel"],function(r,f,l,p,c){r=r([l],{declaredClass:"esri.layers.PurgeOptions",constructor:function(c,f){this.parent=c;for(var k in f)this[k]=f[k]},_displayCountSetter:function(c){this.displayCount=c;this.parent.refresh()}});p("extend-esri")&&f.setObject("layers.PurgeOptions",r,c);return r})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),
function(r,f,l,p,c,q,n){r=r([q,n],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(c,f){this._initialize(c,f);this.useMapImage=f&&f.useMapImage||!1},refresh:function(c){if(c)this.inherited(arguments);else{var f=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=f}},setRenderer:function(c,f){this.renderer=c;this.onRendererChange();f||this.refresh(!0)},exportMapImage:function(k,h){var t=c.defaults.map;k=f.mixin({size:t.width+
","+t.height},this._params,k?k.toJson(this.normalization):{},{f:"json"});delete k._ts;this._exportMapImage(this._url.path+"/exportImage",k,h)}});l("extend-esri")&&f.setObject("layers.ArcGISImageServiceLayer",r,p);return r})},"esri/layers/ArcGISImageServiceVectorLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/sniff ../kernel ../lang ./GraphicsLayer ./ImageServiceLayerMixin ../renderers/VectorFieldRenderer ../geometry/Point ../geometry/Extent ../graphic dojox/gfx".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a){r=r([k,h],{declaredClass:"esri.layers.ArcGISImageServiceVectorLayer",constructor:function(a,d){this.symbolTileSize=d&&d.symbolTileSize?d.symbolTileSize:50;this._maxMag=this._minMag=null;var b=f.clone(this._params);delete b.imageServiceParameters;delete b.pixelFilter;delete b.rendererStyle;delete b.symbolTileSize;this._initialize(a,d);this.renderer||this.setVectorRendererStyle(d&&d.rendererStyle?d.rendererStyle:t.STYLE_SINGLE_ARROW);this.geometryType="esriGeometryPoint";
this.symbolTileSizeUnits="Pixels";f.mixin(this._params,b)},getField:function(a){return this._getField(a,!0)},setVectorRendererStyle:function(a){this.rendererStyle=a;this._updateVectorFieldRenderer();this.useDefaultRenderer=!0},setRenderer:function(){this.useDefaultRenderer=!1;this.inherited(arguments)},getFlowRepresentation:function(){return this._vectorFlowRepresentation},onResume:function(){this.inherited(arguments);this._toggleTime()},onSuspend:function(){this.inherited(arguments);this._toggleTime()},
_refresh:function(a){if(10>c("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else if(this._map){this.setImageFormat("LERC",!0);a=this.fullExtent&&this.fullExtent.xmin;var d=this.fullExtent&&this.fullExtent.ymax,b=f.clone(this._map.extent),e=1/this.symbolTileSize*this._map.width,e=e?Math.ceil(e):50,g=1/this.symbolTileSize*this._map.height,g=g?Math.ceil(g):Math.ceil((b.ymax-b.ymin)/(b.xmax-b.xmin)*e),m=(b.xmax-b.xmin)/e,h=(b.ymax-b.ymin)/g;b.xmin=
a+Math.floor((b.xmin-a)/m)*m;b.xmax=a+Math.ceil((b.xmax-a)/m)*m;b.ymin=d+Math.floor((b.ymin-d)/h)*h;b.ymax=d+Math.ceil((b.ymax-d)/h)*h;this._requestData(b,e,g)}},_drawPixelData:function(){this.clear();if(this.pixelData){var g=this.pixelData.pixelBlock,d=this.pixelData.extent,c=this.pixelData.locations,f=n.isDefined(g.mask)&&0<g.mask.length;if(g&&d&&c){if(this.useDefaultRenderer&&this.renderer&&(!n.isDefined(this._minMag)||!n.isDefined(this._maxMag))){var h=this._getServiceMinMaxStats();h?(this._minMag=
h.min,this._maxMag=h.max):(this._minMag=g.statistics[0].minValue,this._maxMag=g.statistics[0].maxValue);var h={type:"sizeInfo",minSize:a.px2pt(.2*this.symbolTileSize),maxSize:a.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},k=[];k.push(h);k.push({type:"colorInfo"});this.renderer.setVisualVariables(k)}for(var t=k=h=0,l,q=d.spatialReference?d.spatialReference._getInfo():null,h=0;h<g.height;h++)for(k=0;k<g.width;k++,t++)if(l=c[t],(!f||g.mask[t])&&l&&2===l.length){l=
new e(l[0],l[1],d.spatialReference);q&&(l.x=b.prototype._normalizeX(l.x,q).x);var w={Magnitude:g.pixels[0][t],Direction:g.pixels[1][t],Location:p.toJson(l.toJson())};l=new m(l,null,w);this.add(l)}}}},_getServiceMinMaxStats:function(){if(!n.isDefined(this.minValues)||!n.isDefined(this.maxValues)||2>this.minValues.length||2>this.maxValues.length)return null;var a=this.minValues[0],d=this.maxValues[0],b=this.minValues[1],e=this.maxValues[1];if(this.pixelFilter&&a&&d&&b&&e){var c=[];c.push([a,d]);c.push([b,
e]);b=this._createPixelData(c);this.pixelFilter(b);b&&b.pixelBlock&&b.pixelBlock.pixels&&0<b.pixelBlock.pixels.length&&(a=b.pixelBlock.pixels[0][0],d=b.pixelBlock.pixels[0][1])}return a&&d?{min:a,max:d}:null},_updateVectorFieldRenderer:function(){var b={type:"sizeInfo",minSize:a.px2pt(.2*this.symbolTileSize),maxSize:a.px2pt(.8*this.symbolTileSize),minDataValue:this._minMag,maxDataValue:this._maxMag},d=[];d.push(b);b=new t({style:this.rendererStyle,visualVariables:d,flowRepresentation:this._vectorFlowRepresentation});
this.setRenderer(b)},_getField:function(a,d){if(n.isDefined(a))return d&&(a=a.toLowerCase()),"magnitude"!==a&&"direction"!==a?null:{name:a,alias:a,domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"}},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_setFlowRepresentation:function(a){this.renderer&&this.renderer.flowRepresentation?this._vectorFlowRepresentation=this.renderer.flowRepresentation:a&&this.renderer&&n.isDefined(a.FlowDirection)&&a.FlowDirection&&
(this._vectorFlowRepresentation="oceanographic"===a.FlowDirection.toLowerCase()?this.renderer.FLOW_TO:this.renderer.FLOW_FROM);this.renderer&&(this.renderer.flowRepresentation=this._vectorFlowRepresentation)}});c("extend-esri")&&f.setObject("layers.ArcGISImageServiceVectorLayer",r,q);return r})},"jimu/LayerInfos/LayerInfoForDefaultDynamicShipFeatureLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred esri/layers/FeatureLayer esri/tasks/query ./LayerInfoForDefaultDynamic".split(" "),
function(r,f,l,p,c,q){return r(q,{_msShipFeatureLayerId:null,_msOwnedFeatureLayerDef:null,_msOwnedLayerInfo:null,constructor:function(c,f){this._msShipFeatureLayerId=c.msShipFLayerId},_initAfterRootLayerInfo:function(){var c=this.map.getLayer(this._msShipFeatureLayerId);c&&this._initPopupInfo(c)},_initPopupInfo:function(c){var f=this.originOperLayer.mapService.layerInfo,h=this.originOperLayer.mapService.subId;c&&(c.infoTemplate?(f.controlPopupInfo.infoTemplates[h]={infoTemplate:c.infoTemplate,layerUrl:this.getUrl()},
this.enablePopup()):(f.controlPopupInfo.infoTemplates[h]={infoTemplate:null,layerUrl:this.getUrl()},this.disablePopup()))},_initMSOwnedFeatureLayer:function(){var c=this.map.getLayer(this.id),k=this.map.getLayer(this._msShipFeatureLayerId);if(k&&!c){this._msOwnedFeatureLayerDef=new l;c=new p(k.url,f.mixin({},k));c.id=this.id;c.visible=this.isShowInMap();f.setObject("_wabProperties.isMSOwnedFeatureLayer",!0,c);this.map.addLayer(c);this._initMsOwnedLayerInfo(c);var h=c.on("load",f.hitch(this,function(){this.layerObject=
c;this._msOwnedFeatureLayerDef.resolve(c);h.remove&&h.remove()}))}},_initMsOwnedLayerInfo:function(c){this._msOwnedLayerInfo=this._layerInfoFactory.create({layerObject:c,title:this.title+"_owned_",id:c.id},this.map)},_msShipIsValid:function(){var c=this.map.getLayer(this._msShipFeatureLayerId),f=this.map.getLayer(this.id);return c&&f},getMSShipFeatures:function(n){var k=new l,h=this.map.getLayer(this._msShipFeatureLayerId);if(n&&h){var t=new c;t.objectIds=n.map(f.hitch(this,function(e){return e.attributes[h.objectIdField]}));
h.queryFeatures(t,f.hitch(this,function(e){k.resolve(e.features)}),f.hitch(this,function(){k.resolve(null)}))}else k.resolve(null);return k}})})},"jimu/LayerInfos/LayerInfoForDefaultTile":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(r,f){return r(f,{constructor:function(f,p){this.isTiled=!0},_initVisible:function(){},_setTopLayerVisible:function(f){},setLayerVisiblefromTopLayer:function(){},getOpacity:function(){},setOpacity:function(f){},isShowInMap:function(){return this.originOperLayer.mapService.layerInfo.layerObject.visible}})})},
"jimu/LayerInfos/LayerInfoForDefaultTable":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred dojo/aspect ./LayerInfoForDefault ./LayerObjectFacory esri/dijit/PopupTemplate".split(" "),function(r,f,l,p,c,q,n,k){return r(q,{_layerObjectFacory:null,constructor:function(){this.newSubLayers=[];this.isTable=!0;this._layerObjectFacory=new n(this)},init:function(){},_getLayerObject:function(){var c=new p;this._layerObjectFacory.getLayerObject().then(f.hitch(this,function(f){this.layerObject.empty&&
f&&(this.layerObject=f,this._bindEventAfterLayerObjectLoaded());c.resolve(f)}));return c},getLayerObject:function(){return this._getLayerObject()},getPopupInfoFromLayerObject:function(){var c=this.getPopupInfo();c||!this.layerObject||this.layerObject.empty||(c=this._getDefaultPopupInfo(this.layerObject));return c},loadPopupInfo:function(){var c=new p,k=this.getPopupInfo();k?c.resolve(k):this.getLayerObject().then(f.hitch(this,function(){k=this._getDefaultPopupInfo(this.layerObject);c.resolve(k)}));
return c},getLayerType:function(){var c=new p;c.resolve("Table");return c},isVisible:function(){return!1},isLeaf:function(){return!0},isRootLayer:function(){return!1},createLegendsNode:function(){return l.create("div",{"class":"legends-div"})},_initControlPopup:function(){this.inherited(arguments);this.controlPopupInfo={enablePopup:this.originOperLayer.popupInfo?!0:!1,infoTemplate:this.originOperLayer.popupInfo?new k(this.originOperLayer.popupInfo):null}},_bindEventAfterLayerObjectLoaded:function(){var h=
c.after(this.layerObject,"setDefinitionExpression",f.hitch(this,this._onFilterChanged));this._eventHandles.push(h)},getFilter:function(){var c;this.layerObject&&!this.layerObject.empty&&this.layerObject.getDefinitionExpression?(c=this.layerObject.getDefinitionExpression(),void 0===c&&(c=this.getFilterOfWebmap())):c=this.getFilterOfWebmap();return c}})})},"jimu/LayerInfos/LayerInfoForDefaultImage":function(){define("dojo/_base/declare dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/aspect esri/request ./LayerInfoForDefault ../utils".split(" "),
function(r,f,l,p,c,q,n,k,h,t){return r(h,{constructor:function(){this._addImageServiceLayerType()},_addImageServiceLayerType:function(){this.layerObject.type=!this.layerObject.serviceDataType||"esriImageServiceDataTypeVector-UV"!==this.layerObject.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.layerObject.serviceDataType?"ArcGISImageServiceLayer":"ArcGISImageServiceVectorLayer"},_initLegendsNode:function(e){10.2<=this.layerObject.version?this._legendRequestServer().then(p.hitch(this,
function(b){f.empty(e);l.forEach(b.layers,function(b){l.forEach(b.legend,function(a){if("\x3call other values\x3e"!==a.label){var b=f.create("div",{"class":"legend-div"},e),d=f.create("div",{"class":"legend-symbol jimu-float-leading",style:"width:50px;height:50px;position:relative"},b),c=null,c=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;f.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;position:absolute;top:0;left:0;bottom:0;right:0",src:c},d);f.create("div",
{"class":"legend-label jimu-float-leading",innerHTML:t.sanitizeHTML(a.label)||" "},b)}},this)},this)}),p.hitch(this,function(){f.empty(e)})):f.empty(e)},_legendRequestServer:function(){var e=this.layerObject.url+"/legend",b={f:"json"};this.layerObject._params.bandIds&&(b.bandIds=this.layerObject._params.bandIds);this.layerObject._params.renderingRule&&(b.renderingRule=this.layerObject._params.renderingRule);return k({url:e,content:b,handleAs:"json",callbackParamName:"callback"})},getSupportTableInfo:function(){var e=
new c,b={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},f=this.getLayerType(),a=this.getLayerObject();q({type:f,layerObject:a}).then(p.hitch(this,function(a){var d=a.type;a=a.layerObject;b.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(b.isSupportedLayer=!0);a.capabilities&&0<=a.capabilities.indexOf("Catalog")?b.isSupportQuery=!0:b.isSupportedLayer=!1;e.resolve(b)}),function(){e.resolve(b)});return e},_getServiceDefinition:function(){var e=this.getUrl();return this._serviceDefinitionBuffer.getRequest(this.subId).request(e)},
_bindEvent:function(){var e;this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&(e=n.after(this.layerObject,"setRenderingRule",p.hitch(this,this._onRendererChanged)),this._eventHandles.push(e))}})})},"jimu/LayerInfos/LayerInfoForDefaultStream":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/promise/all","./LayerInfoForDefault"],function(r,f,l,p,c){return r(c,{getSupportTableInfo:function(){var c=new l,n={isSupportedLayer:!1,isSupportQuery:!0,layerType:null,
otherReasonCanNotSupport:!0},k=this.getLayerType(),h=this.getLayerObject();p({type:k,layerObject:h}).then(f.hitch(this,function(f){var e=f.type;f=f.layerObject;n.layerType=e;0<=this._getLayerTypesOfSupportTable().indexOf(e)&&(n.isSupportedLayer=!0);(e=f.getLatestObservations())&&0<e.length&&(n.otherReasonCanNotSupport=!1);c.resolve(n)}),function(){c.resolve(n)});return c}})})},"jimu/LayerInfos/LayerInfoForDefaultKML":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/dom-construct",
"./LayerInfoForDefault"],function(r,f,l,p){return r(p,{constructor:function(c,f){this.layerObject=c.layerObject},_resetLayerObjectVisiblity:function(){},_initVisible:function(){var c=this.originOperLayer.kml,f=c.layerInfo.originOperLayer.visibleFolders;c.layerInfo.isRootLayer()&&f?-1<f.indexOf(this.subId)?this._visible=!0:this._visible=!1:this._visible=this.originOperLayer.kml.currentFolder.visible},_setTopLayerVisible:function(c){var f=this.originOperLayer.kml.currentFolder;this._visible=c;this.originOperLayer.kml.layerInfo.layerObject.setFolderVisibility(f,
c)},obtainNewSubLayers:function(){var c=[],l=this.originOperLayer.kml;l.currentFolder&&f.forEach(l.layerInfo._getOperLayerByParentFolderId(l.currentFolder.id,this),function(f){f=this._layerInfoFactory.create(f);c.push(f);f.init()},this);return c},getOpacity:function(){},setOpacity:function(c){},drawLegends:function(c){l.empty(c)},_bindEvent:function(){},_onVisibleLayersChanged:function(){},getScaleRange:function(){return this.getRootLayerInfo().getScaleRange()}})})},"libs/crc":function(){(function(){var r=
"object"===typeof window?window:{};!r.JS_CRC_NO_NODE_JS&&"object"===typeof process&&process.versions&&process.versions.node&&(r=global);var f=!r.JS_CRC_NO_COMMON_JS&&"object"===typeof module&&module.exports,l="function"===typeof define&&define.amd,p=!r.JS_CRC_NO_ARRAY_BUFFER&&"undefined"!==typeof ArrayBuffer,c="0123456789abcdef".split(""),q=[{name:"crc32",polynom:3988292384,initValue:-1,bytes:4},{name:"crc16",polynom:40961,initValue:0,bytes:2},{name:"crc24",polynom:720895,initValue:1,bytes:3}],n,
k,h,t;for(n=0;n<q.length;++n){var e=q[n];e.method=function(b){return function(a){var e=a,d="string"!==typeof e;d&&p&&e instanceof ArrayBuffer&&(e=new Uint8Array(e));a=b.initValue;var f,m=e.length,h=b.table;if(d)for(f=0;f<m;++f)a=h[(a^e[f])&255]^a>>>8;else for(f=0;f<m;++f)d=e.charCodeAt(f),128>d?a=h[(a^d)&255]^a>>>8:(2048>d?a=h[(a^(192|d>>6))&255]^a>>>8:(55296>d||57344<=d?a=h[(a^(224|d>>12))&255]^a>>>8:(d=65536+((d&1023)<<10|e.charCodeAt(++f)&1023),a=h[(a^(240|d>>18))&255]^a>>>8,a=h[(a^(128|d>>12&
63))&255]^a>>>8),a=h[(a^(128|d>>6&63))&255]^a>>>8),a=h[(a^(128|d&63))&255]^a>>>8);a^=b.initValue;e="";3<b.bytes?e+=c[a>>28&15]+c[a>>24&15]+c[a>>20&15]+c[a>>16&15]:2<b.bytes&&(e+=c[a>>20&15]+c[a>>16&15]);return e+=c[a>>12&15]+c[a>>8&15]+c[a>>4&15]+c[a&15]}}(e);e.table=[];for(k=0;256>k;++k){t=k;for(h=0;8>h;++h)t=t&1?e.polynom^t>>>1:t>>>1;e.table[k]=t>>>0}}var b={};for(n=0;n<q.length;++n)e=q[n],b[e.name]=e.method;if(f)module.exports=b;else{for(n=0;n<q.length;++n)e=q[n],r[e.name]=e.method;l&&define(function(){return b})}})()},
"jimu/filterUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/date/locale dojo/number esri/lang dojo/data/ItemFileWriteStore jimu/utils moment/moment".split(" "),function(r,f,l,p,c,q,n,k,h){var t=r([],{_stringFieldType:"esriFieldTypeString",_dateFieldType:"esriFieldTypeDate",_numberFieldTypes:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_supportFieldTypes:[],dayInMS:864E5,HourInMS:36E5,MinuteInMS:6E4,
SecInMS:1E3,fieldsStore:null,isHosted:!1,constructor:function(){String.prototype.startsWith=function(e){return 0===this.indexOf(e)};String.prototype.endsWith=function(e){return this.substring(this.length-e.length)===e};String.prototype.count=function(e){return this.split(e).length-1};String.prototype.trim||(String.prototype.trim=f.trim);this._supportFieldTypes=[];this._supportFieldTypes.push(this._stringFieldType);this._supportFieldTypes.push(this._dateFieldType);this._supportFieldTypes=this._supportFieldTypes.concat(this._numberFieldTypes);
this.filterBuilderNls=window.jimuNls.filterBuilder},OPERATORS:{stringOperatorIs:"stringOperatorIs",stringOperatorIsNot:"stringOperatorIsNot",stringOperatorStartsWith:"stringOperatorStartsWith",stringOperatorEndsWith:"stringOperatorEndsWith",stringOperatorContains:"stringOperatorContains",stringOperatorDoesNotContain:"stringOperatorDoesNotContain",stringOperatorIsAnyOf:"stringOperatorIsAnyOf",stringOperatorIsNoneOf:"stringOperatorIsNoneOf",stringOperatorIsBlank:"stringOperatorIsBlank",stringOperatorIsNotBlank:"stringOperatorIsNotBlank",
numberOperatorIs:"numberOperatorIs",numberOperatorIsNot:"numberOperatorIsNot",numberOperatorIsAtLeast:"numberOperatorIsAtLeast",numberOperatorIsLessThan:"numberOperatorIsLessThan",numberOperatorIsAtMost:"numberOperatorIsAtMost",numberOperatorIsGreaterThan:"numberOperatorIsGreaterThan",numberOperatorIsBetween:"numberOperatorIsBetween",numberOperatorIsNotBetween:"numberOperatorIsNotBetween",numberOperatorIsAnyOf:"numberOperatorIsAnyOf",numberOperatorIsNoneOf:"numberOperatorIsNoneOf",numberOperatorIsBlank:"numberOperatorIsBlank",
numberOperatorIsNotBlank:"numberOperatorIsNotBlank",dateOperatorIsOn:"dateOperatorIsOn",dateOperatorIsNotOn:"dateOperatorIsNotOn",dateOperatorIsBefore:"dateOperatorIsBefore",dateOperatorIsAfter:"dateOperatorIsAfter",dateOperatorIsOnOrBefore:"dateOperatorIsOnOrBefore",dateOperatorIsOnOrAfter:"dateOperatorIsOnOrAfter",dateOperatorIsBetween:"dateOperatorIsBetween",dateOperatorIsNotBetween:"dateOperatorIsNotBetween",dateOperatorIsBlank:"dateOperatorIsBlank",dateOperatorIsNotBlank:"dateOperatorIsNotBlank",
dateOperatorInTheLast:"dateOperatorInTheLast",dateOperatorNotInTheLast:"dateOperatorNotInTheLast",dateOperatorIsIn:"dateOperatorIsIn",dateOperatorIsNotIn:"dateOperatorIsNotIn",dateOperatorMinutes:"dateOperatorMinutes",dateOperatorHours:"dateOperatorHours",dateOperatorDays:"dateOperatorDays",dateOperatorWeeks:"dateOperatorWeeks",dateOperatorMonths:"dateOperatorMonths",dateOperatorYears:"dateOperatorYears"},prepare:function(e,b){this.isHosted=k.isHostedService(e);b=b||[];this.setFieldsStoreByFieldInfos(b)},
isPartsObjHasError:function(e){var b=!1;e&&(b=e.parts&&0<=e.parts.length?l.every(e.parts,f.hitch(this,function(b){return b.parts?0<b.parts.length?l.every(b.parts,f.hitch(this,function(a){return!a.error})):!1:!b.error})):!1);return!b},isAskForValues:function(e){return t.isAskForValues(e)},hasVirtualDate:function(e){return t.hasVirtualDate(e)},setFieldsStoreByFieldInfos:function(e){e=l.filter(e,f.hitch(this,function(b){return 0<=this._supportFieldTypes.indexOf(b.type)}));e=l.map(e,function(b,e){var a;
switch(b.type){case "esriFieldTypeString":a="string";break;case "esriFieldTypeDate":a="date";break;default:a="number"}return{id:e,label:b.name,shortType:a,alias:b.alias,editable:b.editable,name:b.name,nullable:b.nullable,type:b.type}},this);this.fieldsStore=new n({data:{identifier:"id",label:"label",items:e}});return e.length},_validatePartsObj:function(e){return e&&"object"===typeof e},_isObject:function(e){return e&&"object"===typeof e},_isString:function(e){return e&&"string"===typeof e},containsNonLatinCharacter:function(e){for(var b=
0;b<e.length;b++)if(255<e.charCodeAt(b))return!0;return!1},getExprByFilterObj:function(e){if(!l.every(e.parts,function(a){return!!a}))return null;if(!this.isPartsObjReadyToBuild(e))return e.expr="",e.displaySQL="",e.expr;this._handleVirtualDate(e);var b="",c="",a,g;if(0===e.parts.length)c=b="1\x3d1";else if(1===e.parts.length)a=e.parts[0],a.valueObj&&f.isArray(a.valueObj.value)&&"multiple"!==a.valueObj.type?(g=this._checkIfValObjArrayAndChecked(a.valueObj.value))?(b=this.builtFilterString(a),c=a.displaySQL):
c=b="1\x3d1":(b=this.builtFilterString(a),c=a.displaySQL);else for(var d="",h=0;h<e.parts.length;h++){a=e.parts[h];a.valueObj&&f.isArray(a.valueObj.value)&&"multiple"!==a.valueObj.type?(g=this._checkIfValObjArrayAndChecked(a.valueObj.value))?(g=this.builtFilterString(a),a=a.displaySQL):a=g="1\x3d1":(g=this.builtFilterString(a),a=a.displaySQL);if(!q.isDefined(g))return null;b+=d+"("+g+")";c+=d+"("+a+")";d=d||" "+e.logicalOperator+" "}e.expr=b;e.displaySQL=c;return b},_checkIfValObjArrayAndChecked:function(e){var b=
!1,c;for(c in e)if(e[c].isChecked){b=!0;break}return b},_handleVirtualDate:function(e){this.hasVirtualDate(e)&&l.forEach(e.parts,f.hitch(this,function(b){b.parts?l.forEach(b.parts,f.hitch(this,function(b){this._updateRealDateByVirtualDate(b)})):this._updateRealDateByVirtualDate(b)}))},_updateRealDateByVirtualDate:function(e){var b;b=[this.OPERATORS.dateOperatorIsOn,this.OPERATORS.dateOperatorIsNotOn,this.OPERATORS.dateOperatorIsBefore,this.OPERATORS.dateOperatorIsAfter,this.OPERATORS.dateOperatorIsOnOrBefore,
this.OPERATORS.dateOperatorIsOnOrAfter];e.valueObj.virtualDate?e.operator===this.OPERATORS.dateOperatorIsIn||e.operator===this.OPERATORS.dateOperatorIsNotIn?(b=t.getRealDateByVirtualDate(e.valueObj.virtualDate),e.value1=b[0],e.value2=b[1]):-1<b.indexOf(e.operator)&&(b=t.getRealDateByVirtualDate(e.valueObj.virtualDate),e.value=b):(e.valueObj.virtualDate1&&(b=t.getRealDateByVirtualDate(e.valueObj.virtualDate1),e.value1=b),e.valueObj.virtualDate2&&(b=t.getRealDateByVirtualDate(e.valueObj.virtualDate2),
e.value2=b))},isPartsObjReadyToBuild:function(e){return l.every(e.parts,f.hitch(this,function(b){return b.parts?l.every(b.parts,f.hitch(this,function(b){return this._isPartReadyToBuild(b)})):this._isPartReadyToBuild(b)}))},_isPartReadyToBuild:function(e){var b=e.fieldObj.shortType,c=e.operator,a=e.valueObj;e=a.type||"value";var g=a.value,d=a.value1,a=a.value2;if("value"===e){if("string"===b)return c===this.OPERATORS.stringOperatorIsBlank||c===this.OPERATORS.stringOperatorIsNotBlank?!0:k.isNotEmptyString(g);
if("number"===b)return c===this.OPERATORS.numberOperatorIsBlank||c===this.OPERATORS.numberOperatorIsNotBlank?!0:c===this.OPERATORS.numberOperatorIsBetween||c===this.OPERATORS.numberOperatorIsNotBetween?k.isValidNumber(d)&&k.isValidNumber(a):k.isValidNumber(g);if("date"===b)return c===this.OPERATORS.dateOperatorIsBlank||c===this.OPERATORS.dateOperatorIsNotBlank?!0:c===this.OPERATORS.dateOperatorIsBetween||c===this.OPERATORS.dateOperatorIsNotBetween||c===this.OPERATORS.dateOperatorIsIn||c===this.OPERATORS.dateOperatorIsNotIn?
k.isNotEmptyString(d)&&k.isNotEmptyString(a):c===this.OPERATORS.dateOperatorInTheLast||c===this.OPERATORS.dateOperatorNotInTheLast?void 0!==g&&null!==g:k.isNotEmptyString(g)}else{if("field"===e)return k.isNotEmptyString(g);if("unique"===e){if("string"===b)return k.isNotEmptyString(g);if("number"===b)return k.isValidNumber(g);if("date"===b)return k.isValidDate(g)}else if("multiple"===e){if("string"===b)return k.isNotEmptyStringArray(g);if("number"===b)return k.isValidNumberArray(g)}else if("values"!==
e&&("uniquePredefined"===e||"multiplePredefined"===e)){if("string"===b)return k.isNotEmptyStringArray(g);if("number"===b)return k.isValidNumberArray(g)}}return!1},builtFilterString:function(e){var b="",c="";if(e.parts)for(var a="",g=0;g<e.parts.length;g++){var d=e.parts[g],f=this.builtSingleFilterString(d);d.expr=f.whereClause;if(!q.isDefined(f.whereClause))return null;b+=a+f.whereClause;c+=a+d.displaySQL;a=" "+e.logicalOperator+" "}else e&&e.valueObj&&"multiple"===e.valueObj.type&&0===e.valueObj.value.length?
b=c="1\x3d1":(b=this.builtSingleFilterString(e).whereClause,c=e.displaySQL);e.expr=b;e.displaySQL=c;return b},_preBuiltSingleFilterString:function(e){if("string"===e.fieldObj.shortType&&"\x3cNull\x3e"===e.valueObj.value){if(e.operator===this.OPERATORS.stringOperatorIs)return{whereClause:e.fieldObj.name+" IS NULL"};if(e.operator===this.OPERATORS.stringOperatorIsNot)return{whereClause:e.fieldObj.name+" IS NOT NULL"}}if("number"===e.fieldObj.shortType&&"\x3cNull\x3e"===e.valueObj.value){if(e.operator===
this.OPERATORS.numberOperatorIs)return{whereClause:e.fieldObj.name+" IS NULL"};if(e.operator===this.OPERATORS.numberOperatorIsNot)return{whereClause:e.fieldObj.name+" IS NOT NULL"}}return null},_handlePrefixStringsForIn:function(e,b){for(var c=[],a=0;a<e.length;a++){var g=e[a],g=g.replace(/\'/g,"''"),d=this.isHosted&&this.containsNonLatinCharacter(g)?"N":"",g=b||this.isHosted?g:g.toUpperCase(),g=""+d+"'"+g+"'";c.push(g)}return c.join(",")},builtSingleFilterString:function(e){this.isHosted&&(e.caseSensitive=
!1);if(q.isDefined(e.valueObj.isValid)&&!e.valueObj.isValid)return{whereClause:null};var b=this._preBuiltSingleFilterString(e);if(b)return b;var b=e.valueObj.value,c=e.valueObj.value1,a=e.valueObj.value2,g="",d="",h=[];if("string"===e.fieldObj.shortType){c="";b&&"field"!==e.valueObj.type&&this.isHosted&&!f.isArray(b)&&this.containsNonLatinCharacter(b)&&(c="N");!b||"multiplePredefined"!==e.valueObj.type&&"uniquePredefined"!==e.valueObj.type||(h=[],l.forEach(b,f.hitch(this,function(a){a.isChecked&&
h.push(a.value)})),e.operator===this.OPERATORS.stringOperatorIs||e.operator===this.OPERATORS.stringOperatorIsNot?(b=h[0],this.isHosted&&this.containsNonLatinCharacter(b)&&(c="N")):b=h);var t=[];switch(e.operator){case this.OPERATORS.stringOperatorIs:g="field"===e.valueObj.type?e.fieldObj.name+" \x3d "+b:e.caseSensitive||this.isHosted?e.fieldObj.name+" \x3d "+c+"'"+b.replace(/\'/g,"''")+"'":"UPPER("+e.fieldObj.name+") \x3d "+c+"'"+b.replace(/\'/g,"''").toUpperCase()+"'";break;case this.OPERATORS.stringOperatorIsNot:g=
"field"===e.valueObj.type?e.fieldObj.name+" \x3c\x3e "+b:e.caseSensitive||this.isHosted?e.fieldObj.name+" \x3c\x3e "+c+"'"+b.replace(/\'/g,"''")+"'":"UPPER("+e.fieldObj.name+") \x3c\x3e "+c+"'"+b.replace(/\'/g,"''").toUpperCase()+"'";break;case this.OPERATORS.stringOperatorStartsWith:t=[];"multiplePredefined"===e.valueObj.type||"uniquePredefined"===e.valueObj.type?(l.forEach(b,f.hitch(this,function(a){var d=this.isHosted&&this.containsNonLatinCharacter(a)?"N":"";e.caseSensitive||this.isHosted?t.push(e.fieldObj.name+
" LIKE "+d+"'"+a.replace(/\'/g,"''")+"%'"):t.push("UPPER("+e.fieldObj.name+") LIKE "+d+"'"+a.replace(/\'/g,"''").toUpperCase()+"%'")})),g="(("+t.join(") OR (")+"))"):g=e.caseSensitive||this.isHosted?e.fieldObj.name+" LIKE "+c+"'"+b.replace(/\'/g,"''")+"%'":"UPPER("+e.fieldObj.name+") LIKE "+c+"'"+b.replace(/\'/g,"''").toUpperCase()+"%'";break;case this.OPERATORS.stringOperatorEndsWith:t=[];"multiplePredefined"===e.valueObj.type||"uniquePredefined"===e.valueObj.type?(l.forEach(b,f.hitch(this,function(a){var d=
this.isHosted&&this.containsNonLatinCharacter(a)?"N":"";e.caseSensitive||this.isHosted?t.push(e.fieldObj.name+" LIKE "+d+"'%"+a.replace(/\'/g,"''")+"'"):t.push("UPPER("+e.fieldObj.name+") LIKE "+d+"'%"+a.replace(/\'/g,"''").toUpperCase()+"'")})),g="(("+t.join(") OR (")+"))"):g=e.caseSensitive||this.isHosted?e.fieldObj.name+" LIKE "+c+"'%"+b.replace(/\'/g,"''")+"'":"UPPER("+e.fieldObj.name+") LIKE "+c+"'%"+b.replace(/\'/g,"''").toUpperCase()+"'";break;case this.OPERATORS.stringOperatorContains:t=[];
"multiplePredefined"===e.valueObj.type||"uniquePredefined"===e.valueObj.type?(l.forEach(b,f.hitch(this,function(a){var d=this.isHosted&&this.containsNonLatinCharacter(a)?"N":"";e.caseSensitive||this.isHosted?t.push(e.fieldObj.name+" LIKE "+d+"'%"+a.replace(/\'/g,"''")+"%'"):t.push("UPPER("+e.fieldObj.name+") LIKE "+d+"'%"+a.replace(/\'/g,"''").toUpperCase()+"%'")})),g="(("+t.join(") OR (")+"))"):g=e.caseSensitive||this.isHosted?e.fieldObj.name+" LIKE "+c+"'%"+b.replace(/\'/g,"''")+"%'":"UPPER("+e.fieldObj.name+
") LIKE "+c+"'%"+b.replace(/\'/g,"''").toUpperCase()+"%'";break;case this.OPERATORS.stringOperatorDoesNotContain:t=[];"multiplePredefined"===e.valueObj.type||"uniquePredefined"===e.valueObj.type?(l.forEach(b,f.hitch(this,function(a){var d=this.isHosted&&this.containsNonLatinCharacter(a)?"N":"";e.caseSensitive||this.isHosted?t.push(e.fieldObj.name+" NOT LIKE "+d+"'%"+a.replace(/\'/g,"''")+"%'"):t.push("UPPER("+e.fieldObj.name+") NOT LIKE "+d+"'%"+a.replace(/\'/g,"''").toUpperCase()+"%'")})),g="(("+
t.join(") AND (")+"))"):g=e.caseSensitive||this.isHosted?e.fieldObj.name+" NOT LIKE "+c+"'%"+b.replace(/\'/g,"''")+"%'":"UPPER("+e.fieldObj.name+") NOT LIKE "+c+"'%"+b.replace(/\'/g,"''").toUpperCase()+"%'";break;case this.OPERATORS.stringOperatorIsAnyOf:b=this._handlePrefixStringsForIn(b,e.caseSensitive);g=e.caseSensitive||this.isHosted?e.fieldObj.name+" IN ("+b+")":"UPPER("+e.fieldObj.name+") IN ("+b+")";break;case this.OPERATORS.stringOperatorIsNoneOf:b=this._handlePrefixStringsForIn(b,e.caseSensitive);
g=e.caseSensitive||this.isHosted?e.fieldObj.name+" NOT IN ("+b+")":"UPPER("+e.fieldObj.name+") NOT IN ("+b+")";break;case this.OPERATORS.stringOperatorIsBlank:g=e.fieldObj.name+" IS NULL";break;case this.OPERATORS.stringOperatorIsNotBlank:g=e.fieldObj.name+" IS NOT NULL"}}else if("number"===e.fieldObj.shortType)switch(!b||"uniquePredefined"!==e.valueObj.type&&"multiplePredefined"!==e.valueObj.type?b&&"multiple"===e.valueObj.type&&(b=b.join(",")):(h=[],l.forEach(b,f.hitch(this,function(a){a.isChecked&&
h.push(a.value)})),b=h.join(",")),e.operator){case this.OPERATORS.numberOperatorIs:g=e.fieldObj.name+" \x3d "+b;break;case this.OPERATORS.numberOperatorIsNot:g=e.fieldObj.name+" \x3c\x3e "+b;break;case this.OPERATORS.numberOperatorIsAtLeast:g=e.fieldObj.name+" \x3e\x3d "+b;break;case this.OPERATORS.numberOperatorIsLessThan:g=e.fieldObj.name+" \x3c "+b;break;case this.OPERATORS.numberOperatorIsAtMost:g=e.fieldObj.name+" \x3c\x3d "+b;break;case this.OPERATORS.numberOperatorIsGreaterThan:g=e.fieldObj.name+
" \x3e "+b;break;case this.OPERATORS.numberOperatorIsAnyOf:g=e.fieldObj.name+" IN ("+b+")";break;case this.OPERATORS.numberOperatorIsNoneOf:g=e.fieldObj.name+" NOT IN ("+b+")";break;case this.OPERATORS.numberOperatorIsBetween:g=e.fieldObj.name+" BETWEEN "+c+" AND "+a;break;case this.OPERATORS.numberOperatorIsNotBetween:g=e.fieldObj.name+" NOT BETWEEN "+c+" AND "+a;break;case this.OPERATORS.numberOperatorIsBlank:g=e.fieldObj.name+" IS NULL";break;case this.OPERATORS.numberOperatorIsNotBlank:g=e.fieldObj.name+
" IS NOT NULL"}else{"field"!==e.valueObj.type&&(b&&(b=k.getDateByDateTimeStr(b)),c&&(c=k.getDateByDateTimeStr(c)),a&&(a=k.getDateByDateTimeStr(a)));var d=e.valueObj.enableTime,n=e.valueObj.timeAccuracy;switch(e.operator){case this.OPERATORS.dateOperatorIsOn:"field"===e.valueObj.type?g=e.fieldObj.name+" \x3d "+b:(g="unique"===e.valueObj.type?this._getEndDateByTimeForUnique(b,e.fieldObj.dateFormat):this._getEndDateByTime(b,d,n),g="("+e.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(b)+
"' AND "+(this.isHosted?"":"timestamp ")+"'"+g+"') AND ("+e.fieldObj.name+" \x3c\x3e "+(this.isHosted?"":"timestamp ")+"'"+g+"')");break;case this.OPERATORS.dateOperatorIsNotOn:"field"===e.valueObj.type?g=e.fieldObj.name+" \x3c\x3e "+b:(g="unique"===e.valueObj.type?this._getEndDateByTimeForUnique(b,e.fieldObj.dateFormat):this._getEndDateByTime(b,d,n),g="("+e.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(b)+"') OR ("+e.fieldObj.name+" \x3e\x3d "+(this.isHosted?"":"timestamp ")+
"'"+g+"')");break;case this.OPERATORS.dateOperatorIsBefore:g="field"===e.valueObj.type?e.fieldObj.name+" \x3c "+b:e.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(b)+"'";break;case this.OPERATORS.dateOperatorIsAfter:"field"===e.valueObj.type?g=e.fieldObj.name+" \x3e "+b:(g="unique"===e.valueObj.type?this._getEndDateByTimeForUnique(b,e.fieldObj.dateFormat):this._getEndDateByTime(b,d,n),g=e.fieldObj.name+" \x3e\x3d "+(this.isHosted?"":"timestamp ")+"'"+g+"'");break;case this.OPERATORS.dateOperatorIsOnOrBefore:"field"===
e.valueObj.type?g=e.fieldObj.name+" \x3c\x3d "+b:(g="unique"===e.valueObj.type?this._getEndDateByTimeForUnique(b,e.fieldObj.dateFormat):this._getEndDateByTime(b,d,n),g=e.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+g+"'");break;case this.OPERATORS.dateOperatorIsOnOrAfter:g="field"===e.valueObj.type?e.fieldObj.name+" \x3e\x3d "+b:e.fieldObj.name+" \x3e\x3d "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(b)+"'";break;case this.OPERATORS.dateOperatorInTheLast:g=e.fieldObj.name+" BETWEEN CURRENT_TIMESTAMP - "+
this._convertRangeToDays(e.valueObj.value,e.valueObj.range)+" AND CURRENT_TIMESTAMP";break;case this.OPERATORS.dateOperatorNotInTheLast:g=e.fieldObj.name+" NOT BETWEEN CURRENT_TIMESTAMP - "+this._convertRangeToDays(e.valueObj.value,e.valueObj.range)+" AND CURRENT_TIMESTAMP";break;case this.OPERATORS.dateOperatorIsBetween:case this.OPERATORS.dateOperatorIsIn:g=this._getEndDateByTime(a,e.valueObj.enableTime2,e.valueObj.timeAccuracy2);g="("+e.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+
"'"+this.formatDate(c)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+g+"') AND ("+e.fieldObj.name+" \x3c\x3e "+(this.isHosted?"":"timestamp ")+"'"+g+"')";break;case this.OPERATORS.dateOperatorIsNotBetween:case this.OPERATORS.dateOperatorIsNotIn:g=this._getEndDateByTime(a,e.valueObj.enableTime2,e.valueObj.timeAccuracy2);g="("+e.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(c)+"') OR ("+e.fieldObj.name+" \x3e\x3d "+(this.isHosted?"":"timestamp ")+"'"+g+"')";break;case this.OPERATORS.dateOperatorIsBlank:g=
e.fieldObj.name+" IS NULL";break;case this.OPERATORS.dateOperatorIsNotBlank:g=e.fieldObj.name+" IS NOT NULL"}}"date"===e.fieldObj.shortType?(b=f.clone(e.valueObj),b.dateFormat=e.fieldObj.dateFormat,d=this.getDisplaySQL(e.fieldObj.name,b,e.operator)):d=g;e.displaySQL=d;return{whereClause:g}},_getEndDateByTime:function(e,b,c){e=b?"s"===c?this.addSec(e):"m"===c?this.addMinute(e):this.addHour(e):this.addDay(e);return this.formatDate(e)},_getEndDateByTimeForUnique:function(e,b){e=b&&0<=b.indexOf("ShortTime")?
this.addMinute(e):b&&0<=b.indexOf("LongTime")?this.addSec(e):this.addDay(e);return this.formatDate(e)},_getDisplayDates:function(e){var b={value:e.virtualDate,value1:e.virtualDate1,value2:e.virtualDate2},c=""===e.dateFormat?{}:{format:{dateFormat:e.dateFormat}};b.value=""===e.virtualDate||void 0===e.virtualDate?"field"===e.type?e.value:"unique"===e.type?k.localizeDateByFieldInfo(k.getDateByDateTimeStr(e.value),c):k.localizeDateTimeByFieldInfo(k.getDateByDateTimeStr(e.value),c,e.enableTime,e.timeAccuracy):
this.filterBuilderNls[e.virtualDate];b.value1=""===e.virtualDate1?k.localizeDateTimeByFieldInfo(k.getDateByDateTimeStr(e.value1),c,e.enableTime1,e.timeAccuracy1):this.filterBuilderNls[e.virtualDate1];b.value2=""===e.virtualDate2?k.localizeDateTimeByFieldInfo(k.getDateByDateTimeStr(e.value2),c,e.enableTime2,e.timeAccuracy2):this.filterBuilderNls[e.virtualDate2];return b},getDisplaySQL:function(e,b,c){var a="";0<c.indexOf("InTheLast")?a=this.filterBuilderNls[c]+" "+b.value+" "+this._getDateRangeEnum(b.value,
b.range):(b=this._getDisplayDates(b,c),a=0<c.indexOf("Between")?this.filterBuilderNls[c]+" "+b.value1+" "+this.filterBuilderNls.and+" "+b.value2:0<c.indexOf("Blank")?this.filterBuilderNls[c]:this.filterBuilderNls[c]+" "+b.value);return e+" "+a},_getDateRangeEnum:function(e,b){b={dateOperatorYears:"year",dateOperatorDays:"day",dateOperatorMonths:"month",dateOperatorWeeks:"week",dateOperatorHours:"hour",dateOperatorMinutes:"minute"}[b];return window.jimuNls.timeUnit[1<e?b+"s":b].toLowerCase()},_convertRangeToDays:function(e,
b){var c=e;b===this.OPERATORS.dateOperatorYears?c=365*e:b===this.OPERATORS.dateOperatorMonths?c=30*e:b===this.OPERATORS.dateOperatorWeeks?c=7*e:b===this.OPERATORS.dateOperatorHours?c=e/24:b===this.OPERATORS.dateOperatorMinutes&&(c=e/1440);return c=Math.round(1E6*c)/1E6},formatDate:function(e){e=new Date(e);return""+e.getUTCFullYear()+"-"+c.format(e.getUTCMonth()+1,{pattern:"00"})+"-"+c.format(e.getUTCDate(),{pattern:"00"})+" "+c.format(e.getUTCHours(),{pattern:"00"})+":"+c.format(e.getUTCMinutes(),
{pattern:"00"})+":"+c.format(e.getUTCSeconds(),{pattern:"00"})},addDay:function(e){return new Date(e.getTime()+this.dayInMS)},addHour:function(e){return new Date(e.getTime()+this.HourInMS)},addMinute:function(e){return new Date(e.getTime()+this.MinuteInMS)},addSec:function(e){return new Date(e.getTime()+this.SecInMS)},getFilterObjByExpr:function(e){if(e&&this.fieldsStore){var b=this.replaceStrings(e);e=b.defExpr;var c=this.findParts(e,"AND");1===c.parts.length&&(c=this.findParts(e,"OR"),1===c.parts.length&&
(c.logicalOperator="AND"));l.forEach(c.parts,function(a){a.expr=a.expr.trim();if(a.expr.startsWith("(")&&-1<a.expr.search(/\)$/)){var b=a.expr.substring(1,a.expr.length-1),d=b.indexOf("("),e=b.indexOf(")");if(-1===d&&-1===e||d<e)a.expr=b}b=this.findParts(a.expr,"AND");1===b.parts.length&&(b=this.findParts(a.expr,"OR"));1<b.parts.length&&(a.parts=b.parts,a.logicalOperator=b.logicalOperator)},this);this.parseExpr(c);this.reReplaceStrings(b,c,f.hitch(this,function(){c&&c.parts&&l.forEach(c.parts,f.hitch(this,
function(a){a&&(a.parts?l.forEach(a.parts,f.hitch(this,function(a){this._handleParsedValuesForSinglePart(a);this._addDefalutValueTypeForSinglePart(a)})):(this._handleParsedValuesForSinglePart(a),this._addDefalutValueTypeForSinglePart(a)))}))}));this.isPartsObjHasError(c)&&(c=null);return c}},_handleParsedValuesForSinglePart:function(e){e&&e.fieldObj&&"number"===e.fieldObj.shortType&&e.valueObj&&(e.valueObj.hasOwnProperty("value")&&(e.valueObj.value=parseFloat(e.valueObj.value)),e.valueObj.hasOwnProperty("value1")&&
(e.valueObj.value1=parseFloat(e.valueObj.value1)),e.valueObj.hasOwnProperty("value2")&&(e.valueObj.value2=parseFloat(e.valueObj.value2)))},_addDefalutValueTypeForSinglePart:function(e){e&&e.valueObj&&!e.valueObj.type&&(e.valueObj.type="value")},replaceStrings:function(e){for(var b=e,c=function(a,d,b){var e=-1,e=a.indexOf("'",b+1);return e===b+1?(e=a.indexOf("'",e+1),c(a,d,e)):b},a=[],g=e.indexOf("'");-1<g;){var d=g,g=e.indexOf("'",g+1),f=0,g=c(e,d,g);"%"===e[d+1]&&d++;"%"===e[g-1]&&(--g,f++);var h=
e.substring(d+1,g);"N"===e[d-1]&&(e=e.substring(0,d-1)+e.substring(d),--d,--g);this.isDateString(h)||-1!==h.indexOf("{")?g=e.indexOf("'",g+1+f):(a.push(h),e=e.substring(0,d+1)+"#"+(a.length-1)+"#"+e.substring(g),g=e.indexOf("'",e.lastIndexOf("#")+2+f))}return{origDefExpr:b,defExpr:e,savedStrings:a}},reReplaceStrings:function(e,b,c){var a=e.savedStrings;if(!a.length)c&&"function"===typeof c&&c();else if(a.length){var g=function(a,d){if(void 0===a.valueObj||null===a.valueObj||void 0===a.valueObj.value||
null===a.valueObj.value||"string"!==a.fieldObj.shortType)return!1;var b=a.valueObj.value.indexOf("#"),e=a.valueObj.value.lastIndexOf("#");return q.isDefined(a.valueObj.value)&&-1<b?(a.valueObj.value=d[parseInt(a.valueObj.value.substring(b+1,e),10)].replace(/\'\'/g,"'"),this.builtSingleFilterString(a),!0):!1},g=f.hitch(this,g),d=!1;l.forEach(b.parts,function(b){if(b.parts){var e=!1;l.forEach(b.parts,function(d){e=g(d,a)||e});e&&(d=e,b.expr=this.builtFilterString(b))}else(d=g(b,a)||d)&&this.builtFilterString(b)},
this);c&&"function"===typeof c&&c();d&&(b.expr=null,this.getExprByFilterObj(b))}},isDateString:function(e){return 19===e.length&&"-"===e.charAt(4)&&"-"===e.charAt(7)&&" "===e.charAt(10)&&":"===e.charAt(13)&&":"===e.charAt(16)?!0:!1},findParts:function(e,b){for(var c=e.toLowerCase(),a=" "+b.toLowerCase()+" ",g=[],d=0,f=c.indexOf(a);0<f;){var h=e.substring(d,f),k=h.toLowerCase(),t=h.count("("),n=h.count(")"),l=h.count("'");t!==n||1===l%2?f=c.indexOf(a,f+1):-1<k.indexOf(" between ")&&-1===k.indexOf(" and ")?
f=c.indexOf(a,f+1):(g.push({expr:h}),d=f+a.length,f=c.indexOf(a,d))}g.push({expr:e.substring(d)});for(c=g.length-1;0<=c;c--)!this.hasOperator(g[c].expr)&&0<c&&(g[c-1].expr+=" "+b+" "+g[c].expr,g.splice(c,1));return{expr:e,parts:g,logicalOperator:b}},hasOperator:function(e){e=e.toLowerCase();return-1<e.indexOf("{")&&-1<e.indexOf("}")||-1<e.indexOf(" \x3d ")||-1<e.indexOf(" \x3c ")||-1<e.indexOf(" \x3e ")||-1<e.indexOf(" \x3c\x3e ")||-1<e.indexOf(" \x3c\x3d ")||-1<e.indexOf(" \x3e\x3d ")||-1<e.indexOf(" like ")||
-1<e.indexOf(" between ")||-1<e.indexOf(" date")||-1<e.indexOf(" is null")||-1<e.indexOf(" is not null")?!0:!1},parseExpr:function(e){l.forEach(e.parts,function(b){b.parts?this.parseExpr(b):this.parseSingleExpr(b)},this)},_preParseSingleExpr:function(e){var b=null;try{if(b=f.clone(e),b.expr=b.expr.trim(),/^UPPER\((.*)\)(\s+|\s+NOT\s+)LIKE\s+UPPER\(N?'(.*)'\)$/i.test(b.expr)){var c=e="",a=b.expr.match(/^UPPER\((.*)\)\s+/i);if(a&&2<=a.length)e=a[1];else return null;var g=b.expr.match(/UPPER\(N?'(.*)'\)$/i);
if(g&&2<=g.length)c="'"+g[1]+"'";else return null;b.expr=b.expr.replace(/^UPPER\((.*)\)\s+/i,e+" ");b.expr=b.expr.replace(/UPPER\(N?'(.*)'\)$/i,c);b.caseSensitive=!1}else/^(.+)(\s+|\s+NOT\s+)LIKE\s+N?'(.*)'$/i.test(b.expr)&&(b.caseSensitive=!0)}catch(d){return console.log(d),null}b&&this.isHosted&&(b.caseSensitive=!1);return b},_removeOperator:function(e,b,c){b=b.substring(c).trim();"date"===e&&!this.isHosted&&b.toLowerCase().startsWith("timestamp ")&&(b=b.substring(10).trim());return b},parseSingleExpr:function(e){var b=
this._preParseSingleExpr(e);b&&(e=f.mixin(e,b));var b=e.expr.trim(),c=b.indexOf(" "),a=b.substring(0,c);e.fieldObj={name:a};e.valueObj={};this.getFieldItemByName({name:a},function(a){e.fieldObj.shortType=a.shortType[0];e.fieldObj.label=a.label[0]},function(){e.error={msg:"unknown field name ("+a+")",code:1}});b=b.substring(c+1).trim();c=b.toLowerCase();c.startsWith("\x3d ")?(b=this._removeOperator(e.fieldObj.shortType,b,2),this.storeValue(b,e),e.operator="date"===e.fieldObj.shortType?this.OPERATORS.dateOperatorIsOn:
"string"===e.fieldObj.shortType?this.OPERATORS.stringOperatorIs:this.OPERATORS.numberOperatorIs):c.startsWith("\x3c ")?(b=this._removeOperator(e.fieldObj.shortType,b,2),this.storeValue(b,e),"date"===e.fieldObj.shortType?e.operator=this.OPERATORS.dateOperatorIsBefore:"number"===e.fieldObj.shortType?e.operator=this.OPERATORS.numberOperatorIsLessThan:e.error={msg:"operator ("+c+") not supported for string",code:3}):c.startsWith("\x3e ")?(b=this._removeOperator(e.fieldObj.shortType,b,2),this.storeValue(b,
e),"date"===e.fieldObj.shortType?e.operator=this.OPERATORS.dateOperatorIsAfter:"number"===e.fieldObj.shortType?e.operator=this.OPERATORS.numberOperatorIsGreaterThan:e.error={msg:"operator ("+c+") not supported for string",code:3}):c.startsWith("\x3c\x3e ")?(b=this._removeOperator(e.fieldObj.shortType,b,3),this.storeValue(b,e),e.operator="date"===e.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotOn:"string"===e.fieldObj.shortType?this.OPERATORS.stringOperatorIsNot:this.OPERATORS.numberOperatorIsNot):
c.startsWith("\x3c\x3d ")?(b=this._removeOperator(e.fieldObj.shortType,b,3),this.storeValue(b,e),"date"===e.fieldObj.shortType?e.operator=this.OPERATORS.dateOperatorIsOnOrBefore:"number"===e.fieldObj.shortType?e.operator=this.OPERATORS.numberOperatorIsAtMost:e.error={msg:"operator ("+c+") not supported for string",code:3}):c.startsWith("\x3e\x3d ")?(b=this._removeOperator(e.fieldObj.shortType,b,3),this.storeValue(b,e),"date"===e.fieldObj.shortType?e.operator=this.OPERATORS.dateOperatorIsOnOrAfter:
"number"===e.fieldObj.shortType?e.operator=this.OPERATORS.numberOperatorIsAtLeast:e.error={msg:"operator ("+c+") not supported for string",code:3}):c.startsWith("like ")?(b=b.substring(5).trim(),b.startsWith("N'")&&(b=b.substring(1,b.length)),b.startsWith("'%")&&b.endsWith("%'")?(this.storeValue(b.substring(2,b.length-2),e),e.operator=this.OPERATORS.stringOperatorContains):b.startsWith("'%")&&b.endsWith("'")?(this.storeValue(b.substring(2,b.length-1),e),e.operator=this.OPERATORS.stringOperatorEndsWith):
b.startsWith("'")&&b.endsWith("%'")?(this.storeValue(b.substring(1,b.length-2),e),e.operator=this.OPERATORS.stringOperatorStartsWith):e.error={msg:"value ("+c+") not supported for LIKE",code:3}):c.startsWith("not like ")?(b=b.substring(9).trim(),b.startsWith("N'")&&(b=b.substring(1,b.length)),b.startsWith("'%")&&b.endsWith("%'")?(this.storeValue(b.substring(2,b.length-2),e),e.operator=this.OPERATORS.stringOperatorDoesNotContain):e.error={msg:"value ("+c+") not supported for NOT LIKE",code:3}):c.startsWith("between ")?
this._updatePartForBetween(b,!0,e):c.startsWith("not between ")?this._updatePartForBetween(b,!1,e):"is null"===c?(e.valueObj.value=null,e.operator="date"===e.fieldObj.shortType?this.OPERATORS.dateOperatorIsBlank:"string"===e.fieldObj.shortType?this.OPERATORS.stringOperatorIsBlank:this.OPERATORS.numberOperatorIsBlank):"is not null"===c?(e.valueObj.value=null,e.operator="date"===e.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotBlank:"string"===e.fieldObj.shortType?this.OPERATORS.stringOperatorIsNotBlank:
this.OPERATORS.numberOperatorIsNotBlank):e.error={msg:"unknown operator ("+c+")",code:2};if(q.isDefined(e.valueObj.value)&&"string"===typeof e.valueObj.value&&e.valueObj.value.startsWith("{")&&e.valueObj.value.endsWith("}")||q.isDefined(e.valueObj.value1)&&"string"===typeof e.valueObj.value1&&e.valueObj.value1.startsWith("{")&&e.valueObj.value1.endsWith("}"))e.isInteractive=!0},getFieldItemByName:function(e,b,c){this.fieldsStore.fetch({query:e,onComplete:f.hitch(this,function(a){a&&a.length?b(a[0]):
c()})})},subtractDay:function(e){return new Date(e.getTime()-this.dayInMS)},_updatePartForBetween:function(e,b,c){var a,g,d,f,m;e=this._removeOperator(c.fieldObj.shortType,e,(b?"between ":"not between ").length);a=e.toLowerCase().indexOf(" and ");if(-1<a)if(g=e.substring(0,a).trim(),g.startsWith("CURRENT_TIMESTAMP "))if(g=g.substring(18).trim(),g.startsWith("-")){c.operator=b?this.OPERATORS.dateOperatorInTheLast:this.OPERATORS.dateOperatorNotInTheLast;try{m=parseFloat(g.substring(1).trim()),1<=m?
(d=this.OPERATORS.dateOperatorDays,f=m/365,1E-4>Math.abs(f-Math.round(f))?(m=Math.round(f),d=this.OPERATORS.dateOperatorYears):(f=m/30,1E-4>Math.abs(f-Math.round(f))?(m=Math.round(f),d=this.OPERATORS.dateOperatorMonths):(f=m/7,1E-4>Math.abs(f-Math.round(f))&&(m=Math.round(f),d=this.OPERATORS.dateOperatorWeeks)))):(d=this.OPERATORS.dateOperatorMinutes,m*=24,1E-4>Math.abs(m-Math.round(m))?d=this.OPERATORS.dateOperatorHours:m*=60),c.valueObj.value=m,c.valueObj.range=d}catch(B){c.error={msg:"missing count for '"+
(b?"":"not ")+"in the last'",code:3}}}else c.error={msg:"'"+(b?"":"not ")+"in the next' not supported",code:3};else if(e=this._removeOperator(c.fieldObj.shortType,e.substring(a),5),this.storeValue1(g,c),this.storeValue2(e,c),"date"===c.fieldObj.shortType){if(c.operator=b?this.OPERATORS.dateOperatorIsBetween:this.OPERATORS.dateOperatorIsNotBetween,"object"===typeof c.valueObj.value1&&"object"===typeof c.valueObj.value2)try{1E3>Math.abs(this.subtractDay(c.valueObj.value2).getTime()-c.valueObj.value1.getTime())&&
(c.valueObj.value=c.valueObj.value1,delete c.valueObj.value1,delete c.valueObj.value2,c.operator=b?this.OPERATORS.dateOperatorIsOn:this.OPERATORS.dateOperatorIsNotOn)}catch(B){}}else"number"===c.fieldObj.shortType||"oid"===c.fieldObj.shortType?c.operator=b?this.OPERATORS.numberOperatorIsBetween:this.OPERATORS.numberOperatorIsNotBetween:c.error={msg:c.fieldObj.shortType+" field not supported for "+(b?"":"NOT ")+"BETWEEN",code:3};else c.error={msg:"missing AND operator for "+(b?"":"NOT ")+"BETWEEN",
code:3}},storeValue:function(e,b){if(e.startsWith("{")&&e.endsWith("}"))b.valueObj.value=e;else if(e.startsWith("'{")&&e.endsWith("}'"))b.valueObj.value=e.substring(1,e.length-1);else if("date"===b.fieldObj.shortType)if(e.startsWith("'")&&e.endsWith("'")){var c=e.substring(1,e.length-1);b.valueObj.value=this.parseDate(c)}else b.valueObj.value=e,b.valueObj.type="field";else"string"===b.fieldObj.shortType?(e.startsWith("#")||e.startsWith("%#"))&&(e.endsWith("#")||e.endsWith("#%"))?b.valueObj.value=
e:e.startsWith("'")&&e.endsWith("'")?b.valueObj.value=e.substring(1,e.length-1).replace(/\'\'/g,"'"):(b.valueObj.value=e,b.valueObj.type="field",this.getFieldItemByName({name:e},function(a){b.valueObj.label=a.label[0]},function(){b.error={msg:"unknown field name ("+e+")",code:1}})):(b.valueObj.value=e,isNaN(e)&&(b.valueObj.type="field",this.getFieldItemByName({name:e},function(a){b.valueObj.label=a.label[0]},function(){b.error={msg:"unknown field name ("+e+")",code:1}})))},storeValue1:function(e,
b){e.startsWith("{")&&e.endsWith("}")?b.valueObj.value1=e:e.startsWith("'{")&&e.endsWith("}'")?b.valueObj.value1=e.substring(1,e.length-1):"date"===b.fieldObj.shortType?e.startsWith("'")&&e.endsWith("'")?(e=e.substring(1,e.length-1),b.valueObj.value1=this.parseDate(e)):(b.valueObj.value1=e,b.valueObj.type="field"):(b.valueObj.value1=e,isNaN(e)&&(b.valueObj.type="field"))},storeValue2:function(e,b){e.startsWith("{")&&e.endsWith("}")?b.valueObj.value2=e:e.startsWith("'{")&&e.endsWith("}'")?b.valueObj.value2=
e.substring(1,e.length-1):"date"===b.fieldObj.shortType?e.startsWith("'")&&e.endsWith("'")?(e=e.substring(1,e.length-1),b.valueObj.value2=this.parseDate(e)):(b.valueObj.value2=e,b.valueObj.type="field"):(b.valueObj.value2=e,isNaN(e)&&(b.valueObj.type="field"))},parseDate:function(e){var b=p.parse(e,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});b||(b=p.parse(e.replace(" ",", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||(b=p.parse(e.replace(" "," - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));
return b}});t.VIRTUAL_DATE_CUSTOM="custom";t.VIRTUAL_DATE_TODAY="today";t.VIRTUAL_DATE_YESTERDAY="yesterday";t.VIRTUAL_DATE_TOMORROW="tomorrow";t.VIRTUAL_DATE_THIS_WEEK="thisWeek";t.VIRTUAL_DATE_THIS_MONTH="thisMonth";t.VIRTUAL_DATE_THIS_QUARTER="thisQuarter";t.VIRTUAL_DATE_THIS_YEAR="thisYear";t.isAskForValues=function(e){var b=!1;return b=l.some(e.parts,function(b){return b.parts?l.some(b.parts,function(a){return!!a.interactiveObj}):!!b.interactiveObj})};t.hasVirtualDate=function(e){var b=!1;return b=
l.some(e.parts,function(b){return b.parts?l.some(b.parts,function(a){return!!a.valueObj.virtualDate||!!a.valueObj.virtualDate1||!!a.valueObj.virtualDate2}):!!b.valueObj.virtualDate||!!b.valueObj.virtualDate1||!!b.valueObj.virtualDate2})};t.getRealDateByVirtualDate=function(e){var b=null,c=new Date,a=c.getTime();switch(e){case t.VIRTUAL_DATE_TODAY:b=c;break;case t.VIRTUAL_DATE_YESTERDAY:b=new Date(a-864E5);break;case t.VIRTUAL_DATE_TOMORROW:b=new Date(a+864E5);break;case t.VIRTUAL_DATE_THIS_WEEK:b=
[h().startOf("week").toDate(),h().endOf("week").toDate()];break;case t.VIRTUAL_DATE_THIS_MONTH:b=[h().startOf("month").toDate(),h().endOf("month").toDate()];break;case t.VIRTUAL_DATE_THIS_QUARTER:b=[h().startOf("quarter").toDate(),h().endOf("quarter").toDate()];break;case t.VIRTUAL_DATE_THIS_YEAR:b=[h().startOf("year").toDate(),h().endOf("year").toDate()]}return b};return t})},"dojo/data/ItemFileWriteStore":function(){define("../_base/lang ../_base/declare ../_base/array ../_base/json ../_base/kernel ./ItemFileReadStore ../date/stamp".split(" "),
function(r,f,l,p,c,q,n){return f("dojo.data.ItemFileWriteStore",q,{constructor:function(c){this._features["dojo.data.api.Write"]=!0;this._features["dojo.data.api.Notification"]=!0;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};this._datatypeMap.Date.serialize||(this._datatypeMap.Date.serialize=function(c){return n.toISOString(c,{zulu:!0})});c&&!1===c.referenceIntegrity&&(this.referenceIntegrity=!1);this._saveInProgress=!1},referenceIntegrity:!0,_assert:function(c){if(!c)throw Error("assertion failed in ItemFileWriteStore");
},_getIdentifierAttribute:function(){return this.getFeatures()["dojo.data.api.Identity"]},newItem:function(c,f){this._assert(!this._saveInProgress);this._loadFinished||this._forceLoad();if("object"!=typeof c&&"undefined"!=typeof c)throw Error("newItem() was passed something other than an object");var h=null,e=this._getIdentifierAttribute();if(e===Number)h=this._arrayOfAllItems.length;else{h=c[e];if("undefined"===typeof h)throw Error("newItem() was not passed an identity for the new item");if(r.isArray(h))throw Error("newItem() was not passed an single-valued identity");
}this._itemsByIdentity&&this._assert("undefined"===typeof this._itemsByIdentity[h]);this._assert("undefined"===typeof this._pending._newItems[h]);this._assert("undefined"===typeof this._pending._deletedItems[h]);var b={};b[this._storeRefPropName]=this;b[this._itemNumPropName]=this._arrayOfAllItems.length;this._itemsByIdentity&&(this._itemsByIdentity[h]=b,b[e]=[h]);this._arrayOfAllItems.push(b);e=null;if(f&&f.parent&&f.attribute){var e={item:f.parent,attribute:f.attribute,oldValue:void 0},m=this.getValues(f.parent,
f.attribute);if(m&&0<m.length){var a=m.slice(0,m.length);e.oldValue=1===m.length?m[0]:m.slice(0,m.length);a.push(b);this._setValueOrValues(f.parent,f.attribute,a,!1);e.newValue=this.getValues(f.parent,f.attribute)}else this._setValueOrValues(f.parent,f.attribute,b,!1),e.newValue=b}else b[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(b);this._pending._newItems[h]=b;for(var g in c){if(g===this._storeRefPropName||g===this._itemNumPropName)throw Error("encountered bug in ItemFileWriteStore.newItem");
f=c[g];r.isArray(f)||(f=[f]);b[g]=f;if(this.referenceIntegrity)for(h=0;h<f.length;h++)m=f[h],this.isItem(m)&&this._addReferenceToMap(m,b,g)}this.onNew(b,e);return b},_removeArrayElement:function(c,f){f=l.indexOf(c,f);return-1!=f?(c.splice(f,1),!0):!1},deleteItem:function(c){this._assert(!this._saveInProgress);this._assertIsItem(c);var f=c[this._itemNumPropName],k=this.getIdentity(c);if(this.referenceIntegrity){var e=this.getAttributes(c);c[this._reverseRefMap]&&(c["backup_"+this._reverseRefMap]=r.clone(c[this._reverseRefMap]));
l.forEach(e,function(a){l.forEach(this.getValues(c,a),function(d){this.isItem(d)&&(c["backupRefs_"+this._reverseRefMap]||(c["backupRefs_"+this._reverseRefMap]=[]),c["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(d),attr:a}),this._removeReferenceFromMap(d,c,a))},this)},this);if(e=c[this._reverseRefMap])for(var b in e){var m=null;if(m=this._itemsByIdentity?this._itemsByIdentity[b]:this._arrayOfAllItems[b])for(var a in e[b]){var g=this.getValues(m,a)||[],d=l.filter(g,function(a){return!(this.isItem(a)&&
this.getIdentity(a)==k)},this);this._removeReferenceFromMap(c,m,a);d.length<g.length&&this._setValueOrValues(m,a,d,!0)}}}this._arrayOfAllItems[f]=null;c[this._storeRefPropName]=null;this._itemsByIdentity&&delete this._itemsByIdentity[k];this._pending._deletedItems[k]=c;c[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,c);this.onDelete(c);return!0},setValue:function(c,f,t){return this._setValueOrValues(c,f,t,!0)},setValues:function(c,f,t){return this._setValueOrValues(c,
f,t,!0)},unsetAttribute:function(c,f){return this._setValueOrValues(c,f,[],!0)},_setValueOrValues:function(c,f,t,e){this._assert(!this._saveInProgress);this._assertIsItem(c);this._assert(r.isString(f));this._assert("undefined"!==typeof t);var b=this._getIdentifierAttribute();if(f==b)throw Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");var b=this._getValueOrValues(c,f),m=this.getIdentity(c);if(!this._pending._modifiedItems[m]){var a={},g;for(g in c)a[g]=
g===this._storeRefPropName||g===this._itemNumPropName||g===this._rootItemPropName?c[g]:g===this._reverseRefMap?r.clone(c[g]):c[g].slice(0,c[g].length);this._pending._modifiedItems[m]=a}m=!1;if(r.isArray(t)&&0===t.length){if(m=delete c[f],t=void 0,this.referenceIntegrity&&b){g=b;r.isArray(g)||(g=[g]);for(var d=0;d<g.length;d++)a=g[d],this.isItem(a)&&this._removeReferenceFromMap(a,c,f)}}else{m=r.isArray(t)?t.slice(0,t.length):[t];if(this.referenceIntegrity)if(b){g=b;r.isArray(g)||(g=[g]);var h={};l.forEach(g,
function(a){this.isItem(a)&&(a=this.getIdentity(a),h[a.toString()]=!0)},this);l.forEach(m,function(a){if(this.isItem(a)){var d=this.getIdentity(a);h[d.toString()]?delete h[d.toString()]:this._addReferenceToMap(a,c,f)}},this);for(d in h)this._removeReferenceFromMap(this._itemsByIdentity?this._itemsByIdentity[d]:this._arrayOfAllItems[d],c,f)}else for(d=0;d<m.length;d++)a=m[d],this.isItem(a)&&this._addReferenceToMap(a,c,f);c[f]=m;m=!0}if(e)this.onSet(c,f,b,t);return m},_addReferenceToMap:function(c,
f,t){f=this.getIdentity(f);var e=c[this._reverseRefMap];e||(e=c[this._reverseRefMap]={});(c=e[f])||(c=e[f]={});c[t]=!0},_removeReferenceFromMap:function(c,f,t){f=this.getIdentity(f);var e=c[this._reverseRefMap],b;if(e){for(b in e)b==f&&(delete e[b][t],this._isEmpty(e[b])&&delete e[b]);this._isEmpty(e)&&delete c[this._reverseRefMap]}},_dumpReferenceMap:function(){var c;for(c=0;c<this._arrayOfAllItems.length;c++){var f=this._arrayOfAllItems[c];f&&f[this._reverseRefMap]&&console.log("Item: ["+this.getIdentity(f)+
"] is referenced by: "+p.toJson(f[this._reverseRefMap]))}},_getValueOrValues:function(c,f){var h=void 0;this.hasAttribute(c,f)&&(c=this.getValues(c,f),h=1==c.length?c[0]:c);return h},_flatten:function(c){if(this.isItem(c))return{_reference:this.getIdentity(c)};if("object"===typeof c)for(var f in this._datatypeMap){var k=this._datatypeMap[f];if(r.isObject(k)&&!r.isFunction(k)){if(c instanceof k.type){if(!k.serialize)throw Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+f+"]");
return{_type:f,_value:k.serialize(c)}}}else if(c instanceof k)return{_type:f,_value:c.toString()}}return c},_getNewFileContentString:function(){var c={},f=this._getIdentifierAttribute();f!==Number&&(c.identifier=f);this._labelAttr&&(c.label=this._labelAttr);c.items=[];for(f=0;f<this._arrayOfAllItems.length;++f){var t=this._arrayOfAllItems[f];if(null!==t){var e={},b;for(b in t)if(b!==this._storeRefPropName&&b!==this._itemNumPropName&&b!==this._reverseRefMap&&b!==this._rootItemPropName){var m=this.getValues(t,
b);if(1==m.length)e[b]=this._flatten(m[0]);else for(var a=[],g=0;g<m.length;++g)a.push(this._flatten(m[g])),e[b]=a}c.items.push(e)}}return p.toJson(c,!0)},_isEmpty:function(c){var f=!0;if(r.isObject(c))for(var k in c){f=!1;break}else r.isArray(c)&&0<c.length&&(f=!1);return f},save:function(f){this._assert(!this._saveInProgress);this._saveInProgress=!0;var h=this,k=function(){h._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};h._saveInProgress=!1;f&&f.onComplete&&f.onComplete.call(f.scope||
c.global)},e=function(b){h._saveInProgress=!1;f&&f.onError&&f.onError.call(f.scope||c.global,b)};if(this._saveEverything){var b=this._getNewFileContentString();this._saveEverything(k,e,b)}this._saveCustom&&this._saveCustom(k,e);this._saveEverything||this._saveCustom||k()},revert:function(){this._assert(!this._saveInProgress);for(var c in this._pending._modifiedItems){var f=this._pending._modifiedItems[c],t=null,t=this._itemsByIdentity?this._itemsByIdentity[c]:this._arrayOfAllItems[c];f[this._storeRefPropName]=
this;for(var e in t)delete t[e];r.mixin(t,f)}var b;for(c in this._pending._deletedItems)b=this._pending._deletedItems[c],b[this._storeRefPropName]=this,f=b[this._itemNumPropName],b["backup_"+this._reverseRefMap]&&(b[this._reverseRefMap]=b["backup_"+this._reverseRefMap],delete b["backup_"+this._reverseRefMap]),this._arrayOfAllItems[f]=b,this._itemsByIdentity&&(this._itemsByIdentity[c]=b),b[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(b);for(c in this._pending._deletedItems)b=this._pending._deletedItems[c],
b["backupRefs_"+this._reverseRefMap]&&(l.forEach(b["backupRefs_"+this._reverseRefMap],function(e){this._addReferenceToMap(this._itemsByIdentity?this._itemsByIdentity[e.id]:this._arrayOfAllItems[e.id],b,e.attr)},this),delete b["backupRefs_"+this._reverseRefMap]);for(c in this._pending._newItems)f=this._pending._newItems[c],f[this._storeRefPropName]=null,this._arrayOfAllItems[f[this._itemNumPropName]]=null,f[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,f),this._itemsByIdentity&&
delete this._itemsByIdentity[c];this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return!0},isDirty:function(c){return c?(c=this.getIdentity(c),(new Boolean(this._pending._newItems[c]||this._pending._modifiedItems[c]||this._pending._deletedItems[c])).valueOf()):!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)},onSet:function(c,f,t,e){},onNew:function(c,f){},onDelete:function(c){},close:function(c){if(this.clearOnClose){if(this.isDirty())throw Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");
this.inherited(arguments)}}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),function(r,f,l,p,c,q,n,k,h){l=l("dojo.data.ItemFileReadStore",[q],{constructor:function(c){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=c.url;this._jsonData=c.data;this.data=null;this._datatypeMap=c.typeMap||
{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(e){return h.fromISOString(e)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName="_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==c.urlPreventCache&&(this.urlPreventCache=c.urlPreventCache?!0:!1);void 0!==c.hierarchical&&(this.hierarchical=c.hierarchical?
!0:!1);c.clearOnClose&&(this.clearOnClose=!0);"failOk"in c&&(this.failOk=c.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(c){if(!this.isItem(c))throw Error(this.declaredClass+": Invalid item argument.");},_assertIsAttribute:function(c){if("string"!==typeof c)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(c,e,b){c=this.getValues(c,e);return 0<c.length?c[0]:b},getValues:function(c,
e){this._assertIsItem(c);this._assertIsAttribute(e);return(c[e]||[]).slice(0)},getAttributes:function(c){this._assertIsItem(c);var e=[],b;for(b in c)b!==this._storeRefPropName&&b!==this._itemNumPropName&&b!==this._rootItemPropName&&b!==this._reverseRefMap&&e.push(b);return e},hasAttribute:function(c,e){this._assertIsItem(c);this._assertIsAttribute(e);return e in c},containsValue:function(c,e,b){var f=void 0;"string"===typeof b&&(f=n.patternToRegExp(b,!1));return this._containsValue(c,e,b,f)},_containsValue:function(c,
e,b,m){return p.some(this.getValues(c,e),function(a){if(null!==a&&!f.isObject(a)&&m){if(a.toString().match(m))return!0}else if(b===a)return!0})},isItem:function(c){return c&&c[this._storeRefPropName]===this&&this._arrayOfAllItems[c[this._itemNumPropName]]===c?!0:!1},isItemLoaded:function(c){return this.isItem(c)},loadItem:function(c){this._assertIsItem(c.item)},getFeatures:function(){return this._features},getLabel:function(c){if(this._labelAttr&&this.isItem(c))return this.getValue(c,this._labelAttr)},
getLabelAttributes:function(c){return this._labelAttr?[this._labelAttr]:null},filter:function(c,e,b){var f=[],a,g;if(c.query){var d;a=c.queryOptions?c.queryOptions.ignoreCase:!1;var h={};for(g in c.query)d=c.query[g],"string"===typeof d?h[g]=n.patternToRegExp(d,a):d instanceof RegExp&&(h[g]=d);for(a=0;a<e.length;++a){var k=!0,t=e[a];if(null===t)k=!1;else for(g in c.query)d=c.query[g],this._containsValue(t,g,d,h[g])||(k=!1);k&&f.push(t)}}else for(a=0;a<e.length;++a)g=e[a],null!==g&&f.push(g);b(f,c)},
_fetchItems:function(h,e,b){var m=this;if(this._loadFinished)this.filter(h,this._getItemsArray(h.queryOptions),e);else if(this._jsonFileUrl!==this._ccUrl?(r.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:h,
filter:f.hitch(m,"filter"),findCallback:f.hitch(m,e)});else{this._loadInProgress=!0;var a=c.get({url:m._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});a.addCallback(function(a){try{m._getItemsFromLoadedData(a),m._loadFinished=!0,m._loadInProgress=!1,m.filter(h,m._getItemsArray(h.queryOptions),e),m._handleQueuedFetches()}catch(u){m._loadFinished=!0,m._loadInProgress=!1,b(u,h)}});a.addErrback(function(a){m._loadInProgress=!1;b(a,h)});var g=null;h.abort&&
(g=h.abort);h.abort=function(){var d=a;d&&-1===d.fired&&(d.cancel(),d=null);g&&g.call(h)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,m.filter(h,this._getItemsArray(h.queryOptions),e)}catch(d){b(d,h)}else b(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),h)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var c=0;c<this._queuedFetches.length;c++){var e=
this._queuedFetches[c],b=e.args,f=e.filter,e=e.findCallback;f?f(b,this._getItemsArray(b.queryOptions),e):this.fetchItemByIdentity(b)}this._queuedFetches=[]}},_getItemsArray:function(c){return c&&c.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(c){this.clearOnClose&&this._loadFinished&&!this._loadInProgress&&(""!=this._jsonFileUrl&&null!=this._jsonFileUrl||""!=this.url&&null!=this.url||null!=this.data||console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),
this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(c){function e(d){return null!==d&&"object"===typeof d&&(!f.isArray(d)||m)&&!f.isFunction(d)&&(d.constructor==Object||f.isArray(d))&&"undefined"===typeof d._reference&&"undefined"===typeof d._type&&"undefined"===typeof d._value&&a.hierarchical}function b(d){a._arrayOfAllItems.push(d);for(var c in d){var g=d[c];if(g)if(f.isArray(g))for(var m=
0;m<g.length;++m){var h=g[m];e(h)&&b(h)}else e(g)&&b(g)}}var m=!1,a=this;this._labelAttr=c.label;var g,d;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=c.items;for(g=0;g<this._arrayOfTopLevelItems.length;++g)d=this._arrayOfTopLevelItems[g],f.isArray(d)&&(m=!0),b(d),d[this._rootItemPropName]=!0;var h={},k;for(g=0;g<this._arrayOfAllItems.length;++g)for(k in d=this._arrayOfAllItems[g],d){if(k!==this._rootItemPropName){var n=d[k];null!==n?f.isArray(n)||(d[k]=[n]):d[k]=[null]}h[k]=k}for(;h[this._storeRefPropName];)this._storeRefPropName+=
"_";for(;h[this._itemNumPropName];)this._itemNumPropName+="_";for(;h[this._reverseRefMap];)this._reverseRefMap+="_";if(h=c.identifier)for(this._itemsByIdentity={},this._features["dojo.data.api.Identity"]=h,g=0;g<this._arrayOfAllItems.length;++g)if(d=this._arrayOfAllItems[g],c=d[h],c=c[0],Object.hasOwnProperty.call(this._itemsByIdentity,c)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+
h+"].  Value collided: ["+c+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+h+"].  Value collided: ["+c+"]");}else this._itemsByIdentity[c]=d;else this._features["dojo.data.api.Identity"]=Number;for(g=0;g<this._arrayOfAllItems.length;++g)d=this._arrayOfAllItems[g],d[this._storeRefPropName]=this,d[this._itemNumPropName]=g;for(g=0;g<this._arrayOfAllItems.length;++g)for(k in d=this._arrayOfAllItems[g],
d)for(c=d[k],h=0;h<c.length;++h)if(n=c[h],null!==n&&"object"==typeof n){if("_type"in n&&"_value"in n){var t=n._type,l=this._datatypeMap[t];if(l)if(f.isFunction(l))c[h]=new l(n._value);else if(f.isFunction(l.deserialize))c[h]=l.deserialize(n._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+
t+"'");}if(n._reference){n=n._reference;if(f.isObject(n))for(t=0;t<this._arrayOfAllItems.length;++t){var l=this._arrayOfAllItems[t],q=!0,p;for(p in n)l[p]!=n[p]&&(q=!1);q&&(c[h]=l)}else c[h]=this._getItemByIdentity(n);this.referenceIntegrity&&(n=c[h],this.isItem(n)&&this._addReferenceToMap(n,d,k))}else this.isItem(n)&&this.referenceIntegrity&&this._addReferenceToMap(n,d,k)}},_addReferenceToMap:function(c,e,b){},getIdentity:function(c){var e=this._features["dojo.data.api.Identity"];return e===Number?
c[this._itemNumPropName]:(c=c[e])?c[0]:null},fetchItemByIdentity:function(f){var e,b;if(this._loadFinished)e=this._getItemByIdentity(f.identity),f.onItem&&(b=f.scope?f.scope:r.global,f.onItem.call(b,e));else{var m=this;this._jsonFileUrl!==this._ccUrl?(r.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=
this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:f}):(this._loadInProgress=!0,b=c.get({url:m._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),b.addCallback(function(a){var b=f.scope?f.scope:r.global;try{m._getItemsFromLoadedData(a),m._loadFinished=!0,m._loadInProgress=!1,e=m._getItemByIdentity(f.identity),f.onItem&&f.onItem.call(b,e),m._handleQueuedFetches()}catch(d){m._loadInProgress=
!1,f.onError&&f.onError.call(b,d)}}),b.addErrback(function(a){m._loadInProgress=!1;f.onError&&f.onError.call(f.scope?f.scope:r.global,a)})):this._jsonData&&(m._getItemsFromLoadedData(m._jsonData),m._jsonData=null,m._loadFinished=!0,e=m._getItemByIdentity(f.identity),f.onItem&&(b=f.scope?f.scope:r.global,f.onItem.call(b,e)))}},_getItemByIdentity:function(c){var e=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,c)&&(e=this._itemsByIdentity[c]):Object.hasOwnProperty.call(this._arrayOfAllItems,
c)&&(e=this._arrayOfAllItems[c]);void 0===e&&(e=null);return e},getIdentityAttributes:function(c){c=this._features["dojo.data.api.Identity"];return c===Number?null:[c]},_forceLoad:function(){var f=this;this._jsonFileUrl!==this._ccUrl?(r.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=
this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var e=c.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:!0});e.addCallback(function(b){try{if(!0!==f._loadInProgress&&!f._loadFinished)f._getItemsFromLoadedData(b),f._loadFinished=!0;else if(f._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(m){throw console.log(m),m;}});e.addErrback(function(b){throw b;
})}else this._jsonData&&(f._getItemsFromLoadedData(f._jsonData),f._jsonData=null,f._loadFinished=!0)}});f.extend(l,k);return l})},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(r){var f={};r.setObject("dojo.data.util.filter",f);f.patternToRegExp=function(f,p){for(var c="^",l=null,n=0;n<f.length;n++)switch(l=f.charAt(n),l){case "\\":c+=l;n++;c+=f.charAt(n);break;case "*":c+=".*";break;case "?":c+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":c+=
"\\";default:c+=l}c+="$";return p?new RegExp(c,"mi"):new RegExp(c,"m")};return f})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(r,f,l){var p={};r.setObject("dojo.data.util.simpleFetch",p);p.errorHandler=function(c,l){l.onError&&l.onError.call(l.scope||f.global,c,l)};p.fetchHandler=function(c,q){var n=q.abort||null,k=!1,h=q.start?q.start:0,t=q.count&&Infinity!==q.count?h+q.count:c.length;q.abort=function(){k=!0;n&&n.call(q)};var e=q.scope||
f.global;q.store||(q.store=this);q.onBegin&&q.onBegin.call(e,c.length,q);q.sort&&c.sort(l.createSortFunction(q.sort,this));if(q.onItem)for(var b=h;b<c.length&&b<t;++b){var m=c[b];k||q.onItem.call(e,m,q)}q.onComplete&&!k&&(b=null,q.onItem||(b=c.slice(h,t)),q.onComplete.call(e,b,q))};p.fetch=function(c){c=c||{};c.store||(c.store=this);this._fetchItems(c,r.hitch(this,"fetchHandler"),r.hitch(this,"errorHandler"));return c};return p})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(r){var f=
{};r.setObject("dojo.data.util.sorter",f);f.basicComparator=function(f,p){var c=-1;null===f&&(f=void 0);null===p&&(p=void 0);if(f==p)c=0;else if(f>p||null==f)c=1;return c};f.createSortFunction=function(l,p){function c(b,a,e,d){return function(c,g){c=d.getValue(c,b);g=d.getValue(g,b);return a*e(c,g)}}for(var q=[],n,k=p.comparatorMap,h=f.basicComparator,t=0;t<l.length;t++){n=l[t];var e=n.attribute;if(e){n=n.descending?-1:1;var b=h;k&&("string"!==typeof e&&"toString"in e&&(e=e.toString()),b=k[e]||h);
q.push(c(e,n,b,p))}}return function(b,a){for(var e=0;e<q.length;){var d=q[e++](b,a);if(0!==d)return d}return 0}};return f})},"jimu/Query":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/promise/all dojo/Deferred jimu/utils jimu/ServiceDefinitionManager esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet".split(" "),function(r,f,l,p,c,q,n,k,h,t){var e=r(null,{queryType:0,nextPageIndex:1,pageSizeOption:null,layerDefinition:null,layerDefinitionDef:null,type1CountDef:null,
type2ObjectIdsDef:null,type3QueryDef:null,sdf:null,url:null,query:null,pageSize:1E3,constructor:function(b){this.sdf=n.getInstance();this.url=b.url;this.query=b.query;this.pageSizeOption=b.pageSize;this.query.outFields&&0!==this.query.outFields.length||(this.query.outFields=["*"]);this.pageSize=0<b.pageSize?b.pageSize:1E3;this.getFeatureCount()},getFeatureCount:function(){return this._getQueryType().then(f.hitch(this,function(b){return 1===b?this._getCountForQueryType1():2===b?this._getCountForQueryType2():
this._getCountForQueryType3()}))},getPageCount:function(){return this.getFeatureCount().then(f.hitch(this,function(b){return 0===b?0:Math.ceil(b/this.pageSize)}))},getAllFeatures:function(){return this.getPageCount().then(f.hitch(this,function(b){if(0<b){for(var e=[],a=1;a<=b;a++)e.push(this.queryByPage(a));return p(e).then(f.hitch(this,function(a){for(var d=[],b=0;b<a.length;b++)a[b].features&&0<a[b].features.length&&(d=d.concat(a[b].features));d=this._setOrderByFieldValue(d);a=a[0];a.features=d;
return a}))}this._getEmptyFeatureSet().then(f.hitch(this,function(a){return a}))}))},_setOrderByFieldValue:function(b){if(2===this.queryType||3===this.queryType){var e=this.query.outFields;b.sort(function(a,b){a=a.attributes[e];b=b.attributes[e];return"string"===typeof a&&"string"===typeof b?a.localeCompare(b):a<b?-1:a===b?0:1})}return b},_getEmptyFeatureSet:function(){var b=new c;this.layerDefinition&&this.layerDefinition.geometryType?b.resolve(this._getEmptyFeatureSetHandler()):this._getLayerDefinition().then(f.hitch(this,
function(){b.resolve(this._getEmptyFeatureSetHandler())}));return b},_getEmptyFeatureSetHandler:function(){var b=new t;b.features=[];b.geometryType=this.layerDefinition.geometryType;b.fields=[];var e=f.clone(this.layerDefinition.fields);0<=this.query.outFields.indexOf("*")?b.fields=e:b.fields=l.filter(e,f.hitch(this,function(a){return 0<=this.query.outFields.indexOf(a.name)}));return b},getCurrentPageIndex:function(){return this.nextPageIndex},queryNextPage:function(){var b=this.nextPageIndex;this.nextPageIndex++;
return this.queryByPage(b)},queryByPage:function(b){var e=null;0>=b?(e=new c,this._getEmptyFeatureSet().then(f.hitch(this,function(a){e.resolve(a)}))):e=this.getPageCount().then(f.hitch(this,function(a){b>a&&this._getEmptyFeatureSet().then(f.hitch(this,function(a){return a}));return 1===this.queryType?this._queryPageForType1(b):2===this.queryType?this._queryPageForType2(b):this._queryPageForType3(b)}));return e},_getQueryType:function(){var b=new c;if(0<this.queryType)b.resolve(this.queryType);else return this._getLayerDefinition().then(f.hitch(this,
function(b){return this.queryType=e.getQueryType(b)}));return b},_getDefStatus:function(b){return b?b.isFulfilled()?b.isResolved()?2:-1:1:0},_getLayerDefinition:function(){0>=this._getDefStatus(this.layerDefinitionDef)&&(this.layerDefinitionDef=this.sdf.getServiceDefinition(this.url).then(f.hitch(this,function(b){this.layerDefinition=b;var e=b.maxRecordCount;0<e&&(!(0<this.pageSizeOption)||this.pageSize>b.maxRecordCount)&&(this.pageSize=e);return this.layerDefinition})));return this.layerDefinitionDef},
_getCountForQueryType1:function(){0>=this._getDefStatus(this.type1CountDef)&&(this.type1CountDef=this._queryCount());return this.type1CountDef},_getCountForQueryType2:function(){return this._getObjectIdsForQueryType2().then(f.hitch(this,function(b){return b.length}))},_getObjectIdsForQueryType2:function(){0>=this._getDefStatus(this.type2ObjectIdsDef)&&(this.type2ObjectIdsDef=this._queryIds());return this.type2ObjectIdsDef},_getCountForQueryType3:function(){return this._doQueryForQueryType3().then(f.hitch(this,
function(b){return(b.features||[]).length}))},_doQueryForQueryType3:function(){0>=this._getDefStatus(this.type3QueryDef)&&(this.type3QueryDef=this._query());return this.type3QueryDef},_queryPageForType1:function(b){return this._queryWithPaginationAndOrder((b-1)*this.pageSize)},_queryPageForType2:function(b){return this._getObjectIdsForQueryType2().then(f.hitch(this,function(e){var a=(b-1)*this.pageSize;e=e.slice(a,a+this.pageSize);return this._queryByObjectIds(e)}))},_queryPageForType3:function(b){return this._doQueryForQueryType3().then(f.hitch(this,
function(e){var a=f.mixin({},e);a.features=[];var c=(b-1)*this.pageSize;a.features=(e.features||[]).slice(c,c+this.pageSize);return a}))},_tryLocaleNumber:function(b){var e=q.localizeNumber(b);if(null===e||void 0===e)e=b;return e},_tryLocaleDate:function(b){var e=q.localizeDate(b);e||(e=b.toLocaleDateString());return e},_getLayerIndexByLayerUrl:function(b){var e=b.lastIndexOf("/");b=b.slice(e+1,b.length);return parseInt(b,10)},_getServiceUrlByLayerUrl:function(b){var e=b.lastIndexOf("/");return b.slice(0,
e)},_isImageServiceLayer:function(b){return-1<b.indexOf("/ImageServer")},_isTable:function(b){return"Table"===b.type},_getObjectIdField:function(){return this.layerDefinition.objectIdField},_query:function(b){var e=new k;e.where=b||this.query.where;e.geometry=this.query.geometry;e.outSpatialReference=this.query.outSpatialReference;e.returnGeometry=this.query.returnGeometry;e.spatialRelationship=this.query.spatialRelationship;e.outFields=this.query.outFields;e.returnDistinctValues=this.query.returnDistinctValues;
return(new h(this.url)).execute(e)},_queryIds:function(){var b=new k;b.where=this.query.where;b.geometry=this.query.geometry;b.returnGeometry=!1;b.spatialRelationship=this.query.spatialRelationship;b.outSpatialReference=this.query.outSpatialReference;return(new h(this.url)).executeForIds(b).then(f.hitch(this,function(b){b||(b=[]);return b}))},_queryByObjectIds:function(b){var e=new c,a=new k;a.returnGeometry=this.query.returnGeometry;a.outSpatialReference=this.query.outSpatialReference;a.spatialRelationship=
this.query.spatialRelationship;a.outFields=this.query.outFields;a.objectIds=b;(new h(this.url)).execute(a).then(f.hitch(this,function(a){e.resolve(a)}),f.hitch(this,function(a){if(400===a.code){var d=this._getObjectIdField(),c="",g=b.length;l.forEach(b,f.hitch(this,function(a,b){c+=d+" \x3d "+a;b!==g-1&&(c+=" OR ")}));this._query(c).then(f.hitch(this,function(a){e.resolve(a)}),f.hitch(this,function(a){e.reject(a)}))}else e.reject(a)}));return e},_queryCount:function(){var b=new k;b.where=this.query.where;
b.geometry=this.query.geometry;b.outSpatialReference=this.query.outSpatialReference;b.spatialRelationship=this.query.spatialRelationship;b.returnGeometry=!1;return(new h(this.url)).executeForCount(b)},_queryWithPaginationAndOrder:function(b){var e=new k;e.where=this.query.where;e.geometry=this.query.geometry;e.outSpatialReference=this.query.outSpatialReference;e.returnGeometry=this.query.returnGeometry;e.spatialRelationship=this.query.spatialRelationship;e.outFields=this.query.outFields;e.returnDistinctValues=
this.query.returnDistinctValues;e.start=b;e.num=this.pageSize;(b=this.query.orderByFields)&&0<b.length&&(e.orderByFields=b,b=l.map(b,f.hitch(this,function(a){return a.split(" ")[0]})),l.forEach(b,f.hitch(this,function(a){0>e.outFields.indexOf(a)&&e.outFields.push(a)})));return(new h(this.url)).execute(e)}});e._isServiceSupportsOrderBy=function(b){var e=!1;b.advancedQueryCapabilities&&b.advancedQueryCapabilities.supportsOrderBy&&(e=!0);return e};e._isServiceSupportsPagination=function(b){var e=!1;
b.advancedQueryCapabilities&&b.advancedQueryCapabilities.supportsPagination&&(e=!0);return e};e._isSupportObjectIds=function(b){var e=0;b=b.currentVersion?b:b.toJson().layerDefinition;b.currentVersion&&(e=parseFloat(b.currentVersion));return 10<=e||b.hasOwnProperty("typeIdField")};e.getQueryType=function(b){var c=-1;return c=e._isServiceSupportsOrderBy(b)&&e._isServiceSupportsPagination(b)?1:e._isSupportObjectIds(b)?2:3};return e})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager",
"./utils"],function(r,f){function l(){this.versions=[{version:"1.0",description:"The version embedded in portal 10.3 final.",upgrader:function(f){return f},compatible:!0},{version:"1.1",description:"The version embedded in online3.6, and used in developer edition 1.0.",upgrader:function(f){f.widgetOnScreen&&f.widgetOnScreen.panel&&("themes/FoldableTheme/panels/TitlePanel/Panel"===f.widgetOnScreen.panel.uri||"jimu/BaseWidgetPanel"===f.widgetOnScreen.panel.uri)&&(f.widgetOnScreen.panel.uri="jimu/PreloadWidgetIconPanel");
return f},compatible:!0},{version:"1.2",description:"The version embedded in online3.7.",upgrader:function(f){var c=0;if(f.widgetOnScreen&&f.widgetOnScreen.widgets){for(var l=!1,c=0;c<f.widgetOnScreen.widgets.length;c++)"widgets/Splash/Widget"===f.widgetOnScreen.widgets[c].uri&&(l=!0);l||f.widgetOnScreen.widgets.push({uri:"widgets/Splash/Widget",visible:!1,positionRelativeTo:"browser",version:"1.2"});l=!1;for(c=0;c<f.widgetOnScreen.widgets.length;c++)"widgets/TimeSlider/Widget"===f.widgetOnScreen.widgets[c].uri&&
(l=!0);l||f.widgetOnScreen.widgets.push({uri:"widgets/TimeSlider/Widget",visible:!1,position:{bottom:55,left:7},version:"1.2"});l=!1;for(c=0;c<f.widgetOnScreen.widgets.length;c++)"widgets/Swipe/Widget"===f.widgetOnScreen.widgets[c].uri&&(l=!0);l||f.widgetOnScreen.widgets.push({uri:"widgets/Swipe/Widget",visible:!1,position:{top:145,left:7},version:"1.2"})}return f},compatible:!0},{version:"1.3",description:"The version embedded in online3.8 \x26 online3.9.",upgrader:function(l){(function(c){f.visitElement(c,
function(c){c.positionRelativeTo&&(c.position?c.position.relativeTo=c.positionRelativeTo:c.position={relativeTo:c.positionRelativeTo},c.panel&&(c.panel.position?c.panel.position.relativeTo=c.panel.positionRelativeTo:c.panel.position={relativeTo:c.panel.positionRelativeTo}))});var l=c.widgetOnScreen;l&&l.panel&&l.panel.positionRelativeTo&&(l.panel.position?l.panel.position.relativeTo=l.panel.positionRelativeTo:l.panel.position={relativeTo:l.panel.positionRelativeTo});(l=c.widgetPool)&&l.panel&&l.panel.positionRelativeTo&&
(l.panel.position?l.panel.position.relativeTo=l.panel.positionRelativeTo:l.panel.position={relativeTo:l.panel.positionRelativeTo})})(l);l.widgetOnScreen&&l.widgetOnScreen.panel&&"jimu/PreloadWidgetIconPanel"===l.widgetOnScreen.panel.uri&&(l.widgetOnScreen.panel.uri="jimu/OnScreenWidgetPanel");(function(c){if(c.widgetOnScreen&&c.widgetOnScreen.widgets&&c.theme&&"FoldableTheme"===c.theme.name){var f=null,n=null;if(f=c.widgetOnScreen.widgets[4])void 0!==f.position.top?(f={position:{left:205,top:45}},
n={position:{left:255,top:45}}):(f={position:{left:205,bottom:55}},n={position:{left:255,bottom:55}}),c.widgetOnScreen.widgets.splice(7,0,f,n)}})(l);(function(){for(var c=0,f=0,n=!1,c=0;c<l.widgetOnScreen.widgets.length;c++)if("widgets/Geocoder/Widget"===l.widgetOnScreen.widgets[c].uri){n=!0;break}for(var k=!1,f=0;f<l.widgetOnScreen.widgets.length;f++)if("widgets/Search/Widget"===l.widgetOnScreen.widgets[f].uri){k=!0;break}!k&&n&&(c=l.widgetOnScreen.widgets[c],c.uri="widgets/Search/Widget",c.name=
"Search")})(l);(function(c){for(var f=0,f=c.widgetOnScreen.widgets.length-1;0<=f;f--){var n=c.widgetOnScreen.widgets[f];if("widgets/Swipe/Widget"===n.uri&&!n.closeable&&(c.widgetOnScreen.widgets.splice(f,1),!1!==n.visible)){n.closeable=!0;var k;a:{for(k=k=0;k<c.widgetOnScreen.widgets.length;k++)if(!c.widgetOnScreen.widgets[k].uri)break a;k=-1}0<=k&&(n.position=c.widgetOnScreen.widgets[k].position,c.widgetOnScreen.widgets[k]=n)}"widgets/TimeSlider/Widget"===n.uri&&(!1===n.visible?c.widgetOnScreen.widgets.splice(f,
1):n.closeable=!0)}})(l);l.widgetOnScreen.widgets.push({uri:"widgets/ZoomSlider/Widget",position:{top:5,left:7},version:"1.3"});l.loadingPage||(l.loadingPage={backgroundColor:"#508dca",backgroundImage:{visible:!1},loadingGif:{visible:!0,uri:"configs/loading/images/predefined_loading_1.gif",width:58,height:58}});return l},compatible:!0},{version:"1.4",description:"The version embedded in online3.10.",upgrader:function(f){if(f.theme){var c=f.theme.name;if(("FoldableTheme"===c||"JewelryBoxTheme"===c)&&
f.widgetOnScreen){var l=f.widgetOnScreen.widgets;if(l&&0<l.length)for(var c="themes/"+c+"/widgets/HeaderController/Widget",n=null,k=0;k<l.length;k++)(n=l[k])&&n.uri===c&&n.position&&310===n.position.paddingRight&&(n.position.paddingRight=275)}}return f},compatible:!0},{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(f){f.keepAppState=!0;return f},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(f){return f},compatible:!0},
{version:"2.0.1",description:"The version for Developer Edition 2.0.",upgrader:function(f){return f},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(f){return f},compatible:!0},{version:"2.2",description:"The version for Online 4.3.",upgrader:function(f){return f},compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(f){function c(f,h){if(!f||!h)return!1;for(var k in h)if(h.hasOwnProperty(k))if("object"===typeof h[k]){if(!c(f[k],
h[k]))return!1}else if(f[k]!==h[k])return!1;return!0}function l(f){function h(){var b=c(f[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),e=c(f[12],{position:{top:10,right:195}});return b&&e}function k(){var b=c(f[3],{uri:"widgets/MyLocation/Widget",position:{left:15,bottom:45}}),e=c(f[12],{position:{left:15,top:233}});return b&&e}function e(){var b=c(f[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),e=c(f[12],{position:{right:15,top:195}});return b&&e}(function(){var b=
c(f[3],{uri:"widgets/MyLocation/Widget",position:{left:15,top:120}}),e=c(f[12],{position:{left:240,top:53}});return b&&e})()?f.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):h()?f.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,top:159},version:"2.3"}):k()?f.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,bottom:195},version:"2.3"}):e()&&f.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:15,
top:159},version:"2.3"})}function n(f){function h(){var e=c(f[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),b=c(f[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),h=c(f[4],{position:{left:7,bottom:70}});return e&&b&&h}function k(){var e=c(f[9],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}),b=c(f[2],{uri:"widgets/Search/Widget",position:{right:2,top:2,relativeTo:"browser"}}),h=c(f[4],{position:{left:7,bottom:70}});return e&&b&&h}(function(){var e=c(f[9],{uri:"widgets/MyLocation/Widget",
position:{left:7,top:110}}),b=c(f[2],{uri:"widgets/Search/Widget",position:{left:55,top:5}}),h=c(f[4],{position:{left:55,top:45}});return e&&b&&h}()||h()||k())&&f.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:148,left:7},version:"2.3"})}(function(f,h,t){f=f.theme&&f.theme.name;if("FoldableTheme"===f)if(c(h[11],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}}))h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:150,left:7},version:"2.3"});else if(c(h[11],
{uri:"widgets/MyLocation/Widget",position:{left:12,bottom:164}}))h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:203},version:"2.3"}),t&&t.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{right:12,top:211},version:"2.3"});else{if(c(h[11],{uri:"widgets/MyLocation/Widget",position:{left:164,bottom:14}})){h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:203,bottom:14,height:30},version:"2.3"});for(f=0;f<h.length;f++){var e=h[f];c(e,{uri:"widgets/Scalebar/Widget",
position:{left:220,bottom:5}})&&(e.position.left=288);c(e,{uri:"widgets/Coordinate/Widget",position:{left:395,bottom:5}})&&(e.position.left=463)}t&&t.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:209,left:12},version:"2.3"})}}else if("BillboardTheme"===f)l(h);else if("BoxTheme"===f)h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:10,top:131},version:"2.3"});else if("JewelryBoxTheme"===f)n(h);else if("LaunchpadTheme"===f){if(c(h[6],{uri:"widgets/MyLocation/Widget",
position:{left:25,top:215}})||c(h[6],{uri:"widgets/MyLocation/Widget",position:{left:25,top:215}}))h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:255,left:25},version:"2.3"}),t&&t.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{right:10,bottom:238},version:"2.3"})}else"PlateauTheme"===f?(c(h[6],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}})&&h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:2.3}),c(h[6],{uri:"widgets/MyLocation/Widget",
position:{left:12,bottom:164}})&&h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{left:12,bottom:201},version:2.3})):"TabTheme"===f&&c(h[11],{uri:"widgets/MyLocation/Widget",position:{left:7,top:110}})&&h.push({uri:"widgets/ExtentNavigate/Widget",visible:!1,position:{top:149,left:7},version:"2.3"})})(f,f.widgetOnScreen.widgets,f.mobileLayout&&f.mobileLayout.widgetOnScreen&&f.mobileLayout.widgetOnScreen.widgets);return f},compatible:!0},{version:"2.4",description:"The version for Online 5.1.",
upgrader:function(f){return f},compatible:!0},{version:"2.5",description:"The version for Online 5.2.",upgrader:function(f){function c(f,n){if(!f||!n)return!1;for(var k in n)if(n.hasOwnProperty(k))if("object"===typeof n[k]){if(!c(f[k],n[k]))return!1}else if(f[k]!==n[k])return!1;return!0}(function(f,n){f=f.theme&&f.theme.name;if("BillboardTheme"===f){f=c(n[8],{position:{left:60,top:53}});var k=c(n[8],{position:{left:15,top:53}});f||k?n.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,
top:8},version:"2.5"}):n.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:55},version:"2.5"})}else if("BoxTheme"===f){a:{f=0;for(k=n.length;f<k;f++){var h=n[f];if(h&&h.uri&&"themes/BoxTheme/widgets/BoxController/Widget"===h.uri){f=h;break a}}f=null}c(f,{position:{right:0,bottom:0}})?n.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):n.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:8},version:"2.5"})}else"DartTheme"===
f?n.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"FoldableTheme"===f?n.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"DashboardTheme"===f?n.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"JewelryBoxTheme"===f?n.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"LaunchpadTheme"===f?n.push({uri:"widgets/FullScreen/Widget",visible:!1,
position:{right:70,top:20},version:"2.5"}):"PlateauTheme"===f?n.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):"TabTheme"===f&&(c(n[7],{position:{left:45,top:45}})?n.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,top:8},version:"2.5"}):n.push({uri:"widgets/FullScreen/Widget",visible:!1,position:{right:8,bottom:55},version:"2.5"}))})(f,f.widgetOnScreen.widgets);return f},compatible:!0},{version:"2.6",description:"The version for Online 5.3.",
upgrader:function(f){return f},compatible:!0},{version:"2.7",description:"The version for Online 5.4.",upgrader:function(f){return f},compatible:!0},{version:"2.8",description:"The version for Online 6.1.",upgrader:function(f){function c(c){var f=[];if("object"===typeof c)for(var k in c){var h=c[k];"FeatureStatistics"===h.type&&f.push(h)}return f}(function(f){(f=f.dataSource&&f.dataSource.dataSources)&&(f=c(f))&&f.length&&f.forEach(function(c){(c=c.dataSchema&&c.dataSchema.statistics)&&c.length&&
c.forEach(function(c){if(c&&"count"===c.statisticType&&"count"===c.outStatisticFieldName)c.outStatisticFieldName="STAT_COUNT";else{var f;f=(f=c.outStatisticFieldName)&&f.toUpperCase();c.outStatisticFieldName=f}})})})(f);return f},compatible:!0},{version:"2.9",description:"The version for Online 6.2.",upgrader:function(f){return f},compatible:!0},{version:"2.10",description:"The version for Online 6.3.",upgrader:function(f){return f},compatible:!0},{version:"2.11",description:"The version for Online 6.4.",
upgrader:function(f){return f},compatible:!0},{version:"2.12",description:"The version for Online 7.1",upgrader:function(f){return f},compatible:!0},{version:"2.13",description:"The version for Online 7.2",upgrader:function(f){if(f.theme&&"PlateauTheme"===f.theme.name&&f.widgetOnScreen&&f.widgetOnScreen.widgets)for(var c=f.widgetOnScreen.widgets,l=0;l<c.length;l++)if("widgets/AttributeTable/Widget"===c[l].uri&&c[l].position){c[l].position.relativeTo="browser";break}return f},compatible:!0},{version:"2.14",
description:"The version for Online 7.3",upgrader:function(f){return f},compatible:!0},{version:"2.15",description:"The version for Online 7.4",upgrader:function(f){return f},compatible:!0},{version:"2.16",description:"The version for Online 8.1",upgrader:function(f){return f},compatible:!0}];this.isCompatible=function(f,c){f=this.getVersionIndex(f);c=this.getVersionIndex(c);for(f+=1;f<=c;f++)if(!1===this.versions[f].compatible)return!1;return!0}}l.prototype=new r;return l.prototype.constructor=l})},
"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=[];this.upgrade=function(r,f,l){f=this.getVersionIndex(f);l=this.getVersionIndex(l);if(f>l)throw Error("New version should higher than old version.");for(f+=1;f<=l;f++)this.versions[f].upgrader&&(r=this.versions[f].upgrader(r));return r};this.getVersionIndex=function(r){r=this.fixVersion(r);var f,l;for(l=0;l<this.versions.length;l++)this.versions[l].version===r&&(f=l);null===r&&(f=-1);void 0===f&&(f=this.versions.length-
1);return f};this.fixVersion=function(r){return r?r:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./appConfigResourceUtils ./portalUrlUtils ./AppStateManager esri/IdentityManager esri/config esri/urlUtils esri/arcgis/utils".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C){var D=
null,y;y=r(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a,d){this._removeHash(a);this.urlParams=a||{};this.widgetManager=e.getInstance();f.mixin(this,d)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(f.hitch(this,function(b){var e=this.checkConfig(b);if(e)throw Error(e);this.rawAppConfig=f.clone(b);u.getInstance().setRawAppConfig(this.rawAppConfig);b=this._upgradeAppConfig(b);this._processAfterTryLoad(b);
this.appConfig=b;if(this.urlParams.id)return this.loadWidgetsManifest(b).then(f.hitch(this,function(){return this.loadAndUpgradeAllWidgetsConfig(b)})).then(f.hitch(this,function(a){return this.updateNecessaryAttrOfResourceUrlInAppConfig(a,this.urlParams.id)})).then(f.hitch(this,function(){this._configLoaded=!0;this._setDocumentTitle(b);this._readAndSetSharedTheme(b);return this.getAppConfig()}));m.setPortalUrl(b.portalUrl);C.arcgisUrl=d.getBaseItemUrl(b.portalUrl);return this._proesssWebTierAndSignin(b).then(f.hitch(this,
function(){if(this.urlParams.appid){if(window.appInfo.isRunInPortal){var e=d.getStandardPortalUrl(b.portalUrl),e=a.getPortal(e);return t.checkEssentialAppsLicense(this.urlParams.appid,e,m.isInBuilderWindow()).then(f.hitch(this,function(){return this._getAppConfigFromTemplateAppId(b.portalUrl,this.urlParams.appid).then(f.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)}))}),f.hitch(this,function(a){console.error(a);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);
}))}return this._processNotInPortalAppProtocol(b).then(f.hitch(this,function(a){return this._getAppDataAddTemplateDataFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(f.hitch(this,function(d){d.appData.appConfig&&(a=d.appData.appConfig);a._appData=d.appData;a.templateConfig=d.templateData;a.isTemplateApp=!0;return a}))}))}return this._processNotInPortalAppProtocol(b)})).then(f.hitch(this,function(d){this._processAfterTryLoad(d);this.appConfig=d;return d.map.itemId?d:(d.map["3D"]?a.getDefaultWebScene(d.portalUrl):
a.getDefaultWebMap(d.portalUrl)).then(function(a){d.map.itemId=a;return d})})).then(f.hitch(this,function(a){return this.loadWidgetsManifest(a)})).then(f.hitch(this,function(d){return d._appData?d._appData.values&&d._appData.values.webmap?a.getPortal(d.portalUrl).getItemById(d._appData.values.webmap).then(f.hitch(this,function(a){return t.template.mergeTemplateAppConfigToAppConfig(d,d._appData,a)})):t.template.mergeTemplateAppConfigToAppConfig(d,d._appData):d})).then(f.hitch(this,function(a){return this.loadAndUpgradeAllWidgetsConfig(a)})).then(f.hitch(this,
function(a){return a._wabAppId?this.processResourceInAppConfigForConfigLoader(a,this.urlParams):a.appItemId&&-1<window.JSON.stringify(a).indexOf("${itemId}")?this.updateNecessaryAttrOfResourceUrlInAppConfig(a,a.appItemId):a})).then(f.hitch(this,function(a){this.appConfig=a;this._configLoaded=!0;this._setDocumentTitle(a);this._readAndSetSharedTheme(a);return this.getAppConfig()}))}),f.hitch(this,function(a){var d=new n;d.reject(a);return d}))},processResourceInAppConfigForConfigLoader:function(d,b){var e=
d.portalUrl,c=d.appItemId,h=b.appid,m=new n,u=f.clone(d);this.updateNecessaryAttrOfResourceUrlInAppConfig(u,h).then(function(){if("config"===b.mode){var f=this.getResourceUrlsOfAppConfig(d).result;0!==f.length?a.getItemResources(e,h).then(function(a){if(0===a.length)return f=f.map(function(a){return{resUrl:a}}),g.AddResourcesToItemForAppSave(e,f,c,h).then(function(){m.resolve(u)},function(a){console.warn("Add resource to template based app error:"+a.message||a);m.resolve(u)});m.resolve(u)},function(a){console.warn("Get resource of template based item error:"+
a.message||a);m.resolve(u)}):m.resolve(u)}else m.resolve(u)}.bind(this),function(a){console.warn("Insert appId to resource url of appConfig error:"+a.message||a);m.resolve(u)});return m},getResourceUrlsOfAppConfig:function(a){var d={test:function(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items\/(.)+\/resources\/inConfig\//.test(a)},func:f.hitch(this,function(a){return a.value})};return t.processItemResourceOfAppConfig(a,d)},updateNecessaryAttrOfResourceUrlInAppConfig:function(d,b){function e(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items\/(.)+\/resources\/inConfig\//.test(a)}
function c(a,d){a=h.processItemIDAndTokenOfResources(d.value,a);a=h.setResouceProtocolForHttps(a);var b=d.obj,e=d.key;"number"===typeof d.i?b[e][d.i]=a:b[e]=a;return!0}var g=d.portalUrl,h=this;return a.getPortal(g).getItemById(b).then(f.hitch(this,function(a){a={test:e,func:f.hitch(this,c,{appId:b,isPublic:"public"===a.access,portalUrl:g})};return t.processItemResourceOfAppConfig(d,a).appConfig}))},setResouceProtocolForHttps:function(a){var d=a;"https:"===window.location.protocol&&(d=a.replace(/^http(s?):\/\//i,
"https://"));return d},processItemIDAndTokenOfResources:function(a,d){0<a.indexOf("${itemId}")&&(a=a.replace("${itemId}",d.appId));/(\?|\&)token=.+/.test(a)&&(a=a.replace(/(\?|\&)token=.+/,""));d.isPublic||(d=m.getPortalCredential(d.portalUrl))&&(a+="?token\x3d"+d.token);return a},_setDocumentTitle:function(a){!window.isBuilder&&a&&a.title&&(document.title=t.stripHTML(a.title))},getAppConfig:function(){var a=f.clone(this.appConfig);a.getConfigElementById=function(a){return t.getConfigElementById(this,
a)};a.getConfigElementsByName=function(a){return t.getConfigElementsByName(this,a)};a.visitElement=function(a){t.visitElement(this,a)};this._addAuthorizedCrossOriginDomains(this.portalSelf,a);return a},_addAuthorizedCrossOriginDomains:function(a,d){a&&a.authorizedCrossOriginDomains&&m.addAuthorizedCrossOriginDomains(a.authorizedCrossOriginDomains);d&&d.authorizedCrossOriginDomains&&m.addAuthorizedCrossOriginDomains(d.authorizedCrossOriginDomains)},checkConfig:function(){return!1},processProxy:function(a){B.defaults.io.alwaysUseProxy=
a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.alwaysUseProxy;B.defaults.io.proxyUrl="";B.defaults.io.proxyRules=[];a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.url&&(B.defaults.io.proxyUrl=a.httpProxy.url);a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.rules&&l.forEach(a.httpProxy.rules,function(a){z.addProxyRule(a)})},addNeedValues:function(a){this._processNoUriWidgets(a);this._processEmptyGroups(a);this._addElementId(a);this._fixRepeatedId(a)},showError:function(a){a&&a.message&&(p.create("div",
{"class":"app-error",innerHTML:t.sanitizeHTML(a.message)},document.body),p.setStyle(jimuConfig.loadingId,"display","none"))},_tryLoadConfig:function(){"stemapp"===this.urlParams.id&&(this.urlParams.config=window.appInfo.appPath+"config.json",delete this.urlParams.id);if(this.urlParams.config)return this.configFile=this.urlParams.config,h(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(f.hitch(this,function(a){m.setPortalUrl(a.portalUrl);a.portalUrl&&(window.portalUrl=a.portalUrl);
return this.urlParams.token?m.registerToken(this.urlParams.token).then(function(){return a}):a}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var b=d.getPortalUrlFromLocation(),e=new n;m.setPortalUrl(b);window.portalUrl=b;C.arcgisUrl=d.getBaseItemUrl(b);var c;this.urlParams.token?c=m.registerToken(this.urlParams.token):(c=new n,c.resolve());c.then(f.hitch(this,function(){var c=a.getPortal(b);c.loadSelfInfo().then(f.hitch(this,function(a){this.portalSelf=a;a.allSSL&&"http:"===window.location.protocol?
(console.log("redirect from http to https"),window.location.href=d.setHttpsProtocol(window.location.href),e.reject()):this._processSignIn(b).then(f.hitch(this,function(){this._getAppConfigFromAppId(b,this.urlParams.id).then(f.hitch(this,function(a){return t.checkEssentialAppsLicense(this.urlParams.id,c,m.isInBuilderWindow()).then(f.hitch(this,function(){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)}),f.hitch(this,function(a){console.error(a);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);
}))})).then(function(a){e.resolve(a)},function(a){e.reject(a)})}))}))}),f.hitch(this,function(a){this.showError(a)}));return e}this.configFile="config.json";return h(this.configFile,{handleAs:"json"}).then(f.hitch(this,function(a){m.setPortalUrl(a.portalUrl);a.portalUrl&&(window.portalUrl=a.portalUrl);return this.urlParams.token?m.registerToken(this.urlParams.token).then(function(){return a}):a}))},_upgradeAppConfig:function(a){var d=window.wabVersion,b=a.wabVersion;a.configWabVersion=a.wabVersion;
if(d===b)return a;var e=this.versionManager.getVersionIndex(b),c=this.versionManager.getVersionIndex(d);if(e>c)throw Error("Bad version number, "+b);a=this.versionManager.upgrade(a,b,d);a.wabVersion=d;return a},loadAndUpgradeAllWidgetsConfig:function(a){var d=new n,e=[];b.visitElement(a,f.hitch(this,function(a){a.uri&&(a=this.widgetManager.tryLoadWidgetConfig(a),e.push(a))}));k(e).then(f.hitch(this,function(){d.resolve(a)}),function(a){d.reject(a)});return d},_processAfterTryLoad:function(a){this._setPortalUrl(a);
this._tryUpdateAppConfigByLocationUrl(a);this._processUrlParams(a);this.addNeedValues(a);this.processProxy(a);v.tokenValidity=10080;return a},_readAndSetSharedTheme:function(a){a.theme.sharedTheme?this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme||(a.theme.sharedTheme.isPortalSupport=!1):(a.theme.sharedTheme={useHeader:!1,useLogo:!1},a.theme.sharedTheme.isPortalSupport=this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?!0:!1);a.theme.sharedTheme.useHeader&&
(a.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(a.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},a.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text):console.error("Portal does not support sharedTheme."));a.theme.sharedTheme.useLogo&&(a.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(a.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:
"images/app-logo.png",!a.logoLink&&this.portalSelf.portalProperties.sharedTheme.logo.link&&(a.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link)):(console.error("Portal does not support sharedTheme, use default logo."),a.logo="images/app-logo.png"))},_tryUpdateAppConfigByLocationUrl:function(a){if(!(this.urlParams.config&&-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var b=d.getPortalUrlFromLocation(),b=d.getStandardPortalUrl(b);d.isOnline(b)&&(b=d.updateUrlProtocolByOtherUrl(b,
a.portalUrl),a.map.portalUrl&&d.isSamePortalUrl(a.portalUrl,a.map.portalUrl)&&(a.map.portalUrl=b),a.portalUrl=b,a.httpProxy&&a.httpProxy.url&&(a.httpProxy.url=d.getPortalProxyUrl(b)))}},_processWidgetJsons:function(a){b.visitElement(a,function(a,d){d.isWidget&&a.uri&&t.widgetJson.processWidgetJson(a)})},_processNoUriWidgets:function(a){var d=0;b.visitElement(a,function(a,b){b.isWidget&&!a.uri&&(d++,a.placeholderIndex=d)})},_processEmptyGroups:function(a){var d=0;a.widgetOnScreen.groups&&l.forEach(a.widgetOnScreen.groups,
function(a){if(!a.widgets||a.widgets&&0===a.widgets.length)d++,a.placeholderIndex=d})},_addElementId:function(a){var d=0,e;b.visitElement(a,function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var b=a.id.lastIndexOf("_");-1<b&&(e=a.id.substr(b+1),d=Math.max(d,e))}});b.visitElement(a,function(a){a.id||(d++,a.id=a.itemId?a.itemId+"_"+d:a.uri?a.uri.replace(/\//g,"_")+"_"+d:"_"+d)})},_setPortalUrl:function(a){if(a.portalUrl){var b=d.getPortalUrlFromLocation(),e=d.isOnline(b);d.isSamePortalUrl(a.portalUrl,
b)||e||(window.appInfo.isRunInPortal=!1)}else window.isXT&&q("wab_portalurl")?a.portalUrl=q("wab_portalurl"):(window.appInfo.isRunInPortal=!0,a.portalUrl=d.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(a,b){a.portalUrl=d.setProtocol(a.portalUrl,b);a.map.portalUrl&&(a.map.portalUrl=d.setProtocol(a.map.portalUrl,b));a.httpProxy&&(a.httpProxy.url=d.setProtocol(a.httpProxy.url,b),a.httpProxy&&a.httpProxy.rules&&l.forEach(a.httpProxy.rules,f.hitch(this,function(a){a.proxyUrl=d.setProtocol(a.proxyUrl,
b)})))},_processInPortalAppProtocol:function(b){var e=new n,c=a.getPortal(b.portalUrl),g=f.hitch(this,function(a){if("https:"===window.location.protocol)this._changePortalUrlProtocol(b,"https");else{if(a){console.log("redirect from http to https");window.location.href=d.setHttpsProtocol(window.location.href);e.reject();return}this._changePortalUrlProtocol(b,"http")}this._checkLocale();e.resolve(b)});c.loadSelfInfo().then(f.hitch(this,function(a){this.portalSelf=a;"private"===a.access?(a=0===b.portalUrl.toLowerCase().indexOf("https://"),
g(a)):g(a.allSSL)}),f.hitch(this,function(a){e.reject(a)}));return e},_processNotInPortalAppProtocol:function(b){var e=new n;b.portalUrl?a.getPortal(b.portalUrl).loadSelfInfo().then(f.hitch(this,function(a){this.portalSelf=a;var c="https:"===window.location.protocol;(a.allSSL||c)&&this._changePortalUrlProtocol(b,"https");0!==b.portalUrl.toLowerCase().indexOf("https://")||c||m.isInConfigOrPreviewWindow()?e.resolve(b):(console.log("redirect from http to https"),window.location.href=d.setHttpsProtocol(window.location.href),
e.reject())}),f.hitch(this,function(a){e.reject(a)})):e.resolve(b);return e},_proesssWebTierAndSignin:function(d){var b=new n,e=!1,c=d.portalUrl;this._processWebTier(d).then(f.hitch(this,function(d){e=d;return a.getPortal(c).loadSelfInfo()})).then(f.hitch(this,function(a){this.portalSelf=a;return this._processSignIn(c,e)})).then(f.hitch(this,function(){b.resolve()}),function(a){b.reject(a)});return b},_processWebTier:function(a){var b=new n,e=a.portalUrl;a.isWebTier?(m.addAuthorizedCrossOriginDomains([e]),
m.isWebTierPortal(e).then(f.hitch(this,function(){var c=m.getPortalCredential(e);c&&c.ssl&&"http:"===window.location.protocol&&!m.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=d.setHttpsProtocol(window.location.href)):b.resolve(a.isWebTier)}),f.hitch(this,function(a){b.reject(a)}))):b.resolve(!1);return b},_processSignIn:function(b,e){var c=new n,g=a.getPortal(b),h=d.getSharingUrl(b);window.appInfo.isRunInPortal?(e=v.checkSignInStatus(h),e.promise.always(f.hitch(this,
function(){c.resolve()}))):(!m.isInBuilderWindow()&&!m.isInConfigOrPreviewWindow()&&this.portalSelf.supportsOAuth&&this.rawAppConfig&&this.rawAppConfig.appId&&!e&&m.registerOAuthInfo(b,this.rawAppConfig.appId),e=v.checkSignInStatus(h),e.promise.always(f.hitch(this,function(){m.xtGetCredentialFromCookie(b);g.loadSelfInfo().then(f.hitch(this,function(a){this.portalSelf=a;this._checkLocale();c.resolve()}))})));return c},_checkLocale:function(){if(!m.isInConfigOrPreviewWindow()){var a=this.portalSelf.user&&
this.portalSelf.user.culture||c.locale,a="hi"===a?"en":a.toLowerCase();!this.urlParams.locale&&t.isLocaleChanged(c.locale,a)&&(q("wab_app_locale",a),window.location.reload())}},_getAppConfigFromTemplateAppId:function(d,b){var e=a.getPortal(d);return this._getWabAppIdAndDataFromTemplateAppId(d,b).then(f.hitch(this,function(a){var b=a.appId,c=a.appData;return k([this._getAppConfigFromAppId(d,b),e.getItemData(c.source)]).then(f.hitch(this,function(a){var d;c.appConfig?(d=c.appConfig,delete c.appConfig):
d=a[0];d=this._upgradeAppConfig(d);a=a[1];d._appData=c;d._wabAppId=b;d.templateConfig=a;d.isTemplateApp=!0;return d}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(d,b){var e=a.getPortal(d);return e.getItemData(b).then(function(a){return e.getItemData(a.source).then(function(d){return{appData:a,templateData:d}})})},_getWabAppIdAndDataFromTemplateAppId:function(d,b){var e=new n,c=a.getPortal(d);c.getItemData(b).then(f.hitch(this,function(a){c.getItemById(a.source).then(f.hitch(this,function(d){d=
z.urlToObject(d.url);e.resolve({appId:d.query.id,appData:a})}))}),function(a){e.reject(a)});return e},_getAppConfigFromAppId:function(d,b){return a.getPortal(d).getItemData(b)},_removeHash:function(a){for(var d in a)a[d]&&(a[d]=a[d].replace("#",""))},loadWidgetsManifest:function(d){function e(b,e,g){function f(a){return b.loadWidgetManifest(a).then(function(a){return a},function(b){console.log("Widget failed to load, it is removed.",a.name);b.stack?console.error(b.stack):console.log(b);c(d,a)})}return e.itemId?
a.getPortal(g).getItemById(e.itemId).then(function(a){e.uri=t.widgetJson.getUriFromItem(a);return f(e)},function(a){console.log("Widget is not loaded, it is removed.",e.name,a);c(d,e)}):f(e)}function c(a,d){function b(b){a[b]&&a[b].widgets&&(a[b].widgets=a[b].widgets.filter(function(a){if(d)return a.id!==d.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}));a[b]&&a[b].groups&&a[b].groups.forEach(function(a){a.widgets&&(a.widgets=
a.widgets.filter(function(a){if(d)return a.id!==d.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}))})}b("widgetOnScreen");b("widgetPool")}var g=[],h=new n;this.urlParams.manifest&&d._buildInfo&&d._buildInfo.widgetManifestsMerged&&delete d._buildInfo.widgetManifestsMerged;d._buildInfo&&d._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(f.hitch(this,function(a){b.visitElement(d,f.hitch(this,function(b){b.widgets||
!b.uri&&!b.itemId||(b.uri&&a[b.uri]?(this._addNeedValuesForManifest(a[b.uri],b.uri),t.widgetJson.addManifest2WidgetJson(b,a[b.uri])):g.push(e(this.widgetManager,b,d.portalUrl)))}));k(g).then(function(){h.resolve(d)})})):(b.visitElement(d,f.hitch(this,function(a){a.widgets||!a.uri&&!a.itemId||g.push(e(this.widgetManager,a,d.portalUrl))})),k(g).then(function(){h.resolve(d)}));setTimeout(function(){h.isResolved()||(c(d),h.resolve(d))},6E4);return h},_addNeedValuesForManifest:function(a,d){f.mixin(a,
t.getUriInfo(d));t.manifest.addManifestProperies(a);t.manifest.processManifestLabel(a,c.locale)},_loadMergedWidgetManifests:function(){return h(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_fixRepeatedId:function(a){var d=[];b.visitElement(a,function(a){0<=d.indexOf(a.id)&&(a.id+="_");d.push(a.id)})},_processUrlParams:function(a){var d=this.urlParams.itemid||this.urlParams.webmap;d&&a.map.itemId!==d&&(a.map.mapOptions&&t.deleteMapOptions(a.map.mapOptions),a.map.itemId=
d);this.urlParams.mode&&(a.mode=this.urlParams.mode);a.map.mapOptions||(a.map.mapOptions={});this.urlParams.scale&&(a.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)a.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});y.getInstance=function(a,d){null===D?D=new y(a,d):(D.urlParams=a||{},D.options=d);return D};return y})},"jimu/appConfigResourceUtils":function(){define(["dojo/Deferred","dojo/promise/all","jimu/portalUtils","jimu/utils"],function(r,
f,l,p){return{AddResourcesToItemForAppSave:function(c,q,n,k){q=q||[];if(0===q.length){var h=new r;h.resolve(q);return h}q=q.map(function(c){var e=c.resUrl.split("resources/")[1],b=new r;c.b64?(c=p.b64toBlob(c.b64),b.resolve({blob:c,fileName:e.split("/")[1],prefixName:e.split("/")[0]})):(c=c.resUrl,0<c.indexOf("${itemId}")&&(c=c.replace("${itemId}",n)),p.resourcesUrlToBlob(c).then(function(c){b.resolve({blob:c,fileName:e.split("/")[1],prefixName:e.split("/")[0]},function(a){console.error(a.message||
a);b.reject(a)})}));return b});return f(q).then(function(h){if(h instanceof Array&&0<h.length)return h=h.map(function(e){var b=n;k&&(b=k);return l.addResource(c,b,e.blob,e.fileName,e.prefixName)}.bind(this)),f(h).then(function(e){return e})}.bind(this))}}})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(r,f,l,p,c,q,n,k,h){var t=null,
e=r(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(b){this.rawAppConfig=b},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var b=p.stringify(this.rawAppConfig.map);this.mapMd5=k(b)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var b=new l,e={};if(h.isInConfigOrPreviewWindow()||!this.rawAppConfig||!this.rawAppConfig.map)return b.resolve(e),
b;var a=this._getAppStateKey(),g=n.get(a);g&&g.appStateMd5===this._getAppStateMd5()?(a=g.map&&g.map.extent,g=g.map&&g.map.layers,a&&(e.extent=new c(a.xmin,a.ymin,a.xmax,a.ymax,new q(a.spatialReference))),g&&(e.layers=g)):n.remove(a);b.resolve(e);return b},saveWabAppState:function(b,e){if(b&&!h.isInConfigOrPreviewWindow()){var a=this._getAppStateKey(),c={extent:{xmin:b.extent.xmin,xmax:b.extent.xmax,ymin:b.extent.ymin,ymax:b.extent.ymax,spatialReference:{wkid:b.extent.spatialReference.wkid,wkt:b.extent.spatialReference.wkt}},
layers:{}};e&&e.traversal&&e.traversal(f.hitch(this,function(a){c.layers[a.id]={visible:a.isVisible()}}));n.set(a,{map:c,appStateMd5:this._getAppStateMd5()})}}});e.getInstance=function(b){null===t&&(t=new e);t.urlParams=b;return t};return e})},"libs/storejs/store":function(){!function(r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?
self:this).store=r()}(function(){return function f(l,p,c){function q(h,k){if(!p[h]){if(!l[h]){var e="function"==typeof require&&require;if(!k&&e)return e(h,!0);if(n)return n(h,!0);k=Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k;}k=p[h]={exports:{}};l[h][0].call(k.exports,function(b){var e=l[h][1][b];return q(e?e:b)},k,k.exports,f,l,p,c)}return p[h].exports}for(var n="function"==typeof require&&require,k=0;k<c.length;k++)q(c[k]);return q}({1:[function(f,l,p){p=f("../src/store-engine");
var c=f("../storages/all");f=f("../plugins/all");l.exports=p.createStore(c,f)},{"../plugins/all":2,"../src/store-engine":15,"../storages/all":17}],2:[function(f,l,p){l.exports=[f("./defaults"),f("./dump"),f("./events"),f("./observe"),f("./expire"),f("./json2"),f("./operations"),f("./update"),f("./v1-backcompat")]},{"./compression":3,"./defaults":4,"./dump":5,"./events":6,"./expire":7,"./json2":8,"./observe":11,"./operations":12,"./update":13,"./v1-backcompat":14}],3:[function(f,l,p){var c=f("./lib/lz-string");
l.exports=function(){return{get:function(f,n){f=f(n);if(!f)return f;n=c.decompress(f);return null==n?f:this._deserialize(n)},set:function(f,n,k){k=c.compress(this._serialize(k));f(n,k)}}}},{"./lib/lz-string":10}],4:[function(f,l,p){l.exports=function(){var c={};return{defaults:function(f,n){c=n},get:function(f,n){f=f();return void 0!==f?f:c[n]}}}},{}],5:[function(f,l,p){l.exports=function(){return{dump:function(c){var f={};return this.each(function(c,k){f[k]=c}),f}}}},{}],6:[function(f,l,p){f=f("../src/util");
var c=f.bind,q=f.each,n=f.create,k=f.slice;l.exports=function(){var f=n(h,{_id:0,_subSignals:{},_subCallbacks:{}});return{watch:function(e,b,h){return f.on(b,c(this,h))},unwatch:function(e,b){f.off(b)},once:function(e,b,h){f.once(b,c(this,h))},set:function(e,b,c){var a=this.get(b);e();f.fire(b,c,a)},remove:function(e,b){var c=this.get(b);e();f.fire(b,void 0,c)},clearAll:function(e){var b={};this.each(function(e,a){b[a]=e});e();q(b,function(b,a){f.fire(a,void 0,b)})}}};var h={_id:null,_subCallbacks:null,
_subSignals:null,on:function(c,e){return this._subCallbacks[c]||(this._subCallbacks[c]={}),this._id+=1,this._subCallbacks[c][this._id]=e,this._subSignals[this._id]=c,this._id},off:function(c){delete this._subCallbacks[this._subSignals[c]][c];delete this._subSignals[c]},once:function(f,e){var b=this.on(f,c(this,function(){e.apply(this,arguments);this.off(b)}))},fire:function(c){var e=k(arguments,1);q(this._subCallbacks[c],function(b){b.apply(this,e)})}}},{"../src/util":16}],7:[function(f,l,p){l.exports=
function(){function c(c){f.get(c,Number.MAX_VALUE)<=(new Date).getTime()&&(this.raw.remove(c),f.remove(c))}var f=this.createStore(this.storage,null,this._namespacePrefix+"expire_mixin");return{set:function(c,k,h,l){return this.hasNamespace("expire_mixin")||f.set(k,l),c()},get:function(f,k){return this.hasNamespace("expire_mixin")||c.call(this,k),f()},remove:function(c,k){return this.hasNamespace("expire_mixin")||f.remove(k),c()},getExpiration:function(c,k){return f.get(k)},removeExpiredKeys:function(f){var k=
[];this.each(function(c,f){k.push(f)});for(f=0;f<k.length;f++)c.call(this,k[f])}}}},{}],8:[function(f,l,p){l.exports=function(){return f("./lib/json2"),{}}},{"./lib/json2":9}],9:[function(f,l,p){var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(c){return typeof c}:function(c){return c&&"function"==typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c};"object"!==("undefined"==typeof JSON?"undefined":c(JSON))&&(JSON={});(function(){function f(a){return 10>
a?"0"+a:a}function n(){return this.valueOf()}function k(d){return a.lastIndex=0,a.test(d)?'"'+d.replace(a,function(a){var d=v[a];return"string"==typeof d?d:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+d+'"'}function h(a,b){var e,g,f,m=d,n=b[a];switch(n&&"object"===("undefined"==typeof n?"undefined":c(n))&&"function"==typeof n.toJSON&&(n=n.toJSON(a)),"function"==typeof p&&(n=p.call(b,a,n)),"undefined"==typeof n?"undefined":c(n)){case "string":return k(n);case "number":return isFinite(n)?
String(n):"null";case "boolean":case "null":return String(n);case "object":if(!n)return"null";if(d+=u,f=[],"[object Array]"===Object.prototype.toString.apply(n)){b=n.length;for(a=0;a<b;a+=1)f[a]=h(a,n)||"null";return g=0===f.length?"[]":d?"[\n"+d+f.join(",\n"+d)+"\n"+m+"]":"["+f.join(",")+"]",d=m,g}if(p&&"object"===("undefined"==typeof p?"undefined":c(p)))for(b=p.length,a=0;a<b;a+=1)"string"==typeof p[a]&&(e=p[a],g=h(e,n),g&&f.push(k(e)+(d?": ":":")+g));else for(e in n)Object.prototype.hasOwnProperty.call(n,
e)&&(g=h(e,n),g&&f.push(k(e)+(d?": ":":")+g));return g=0===f.length?"{}":d?"{\n"+d+f.join(",\n"+d)+"\n"+m+"}":"{"+f.join(",")+"}",d=m,g}}var l=/^[\],:{}\s]*$/,e=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,b=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,m=/(?:^|:|,)(?:\s*\[)+/g,a=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=n,Number.prototype.toJSON=n,String.prototype.toJSON=n);var d,u,v,p;"function"!=typeof JSON.stringify&&(v={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(a,
b,e){var g;if(d="",u="","number"==typeof e)for(g=0;g<e;g+=1)u+=" ";else"string"==typeof e&&(u=e);if(p=b,b&&"function"!=typeof b&&("object"!==("undefined"==typeof b?"undefined":c(b))||"number"!=typeof b.length))throw Error("JSON.stringify");return h("",{"":a})});"function"!=typeof JSON.parse&&(JSON.parse=function(a,d){function f(a,b){var e,g,h=a[b];if(h&&"object"===("undefined"==typeof h?"undefined":c(h)))for(e in h)Object.prototype.hasOwnProperty.call(h,e)&&(g=f(h,e),void 0!==g?h[e]=g:delete h[e]);
return d.call(a,b,h)}var h;if(a=String(a),g.lastIndex=0,g.test(a)&&(a=a.replace(g,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),l.test(a.replace(e,"@").replace(b,"]").replace(m,"")))return h=eval("("+a+")"),"function"==typeof d?f({"":h},""):h;throw new SyntaxError("JSON.parse");})})()},{}],10:[function(f,l,p){f=function(){function c(c,f){if(!n[c]){n[c]={};for(var e=0;e<c.length;e++)n[c][c.charAt(e)]=e}return n[c][f]}var f=String.fromCharCode,n={},k={compressToBase64:function(c){if(null==
c)return"";c=k._compress(c,6,function(c){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(c)});switch(c.length%4){default:case 0:return c;case 1:return c+"\x3d\x3d\x3d";case 2:return c+"\x3d\x3d";case 3:return c+"\x3d"}},decompressFromBase64:function(f){return null==f?"":""==f?null:k._decompress(f.length,32,function(h){return c("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d",f.charAt(h))})},compressToUTF16:function(c){return null==c?"":k._compress(c,
15,function(c){return f(c+32)})+" "},decompressFromUTF16:function(c){return null==c?"":""==c?null:k._decompress(c.length,16384,function(f){return c.charCodeAt(f)-32})},compressToUint8Array:function(c){c=k.compress(c);for(var f=new Uint8Array(2*c.length),e=0,b=c.length;e<b;e++){var h=c.charCodeAt(e);f[2*e]=h>>>8;f[2*e+1]=h%256}return f},decompressFromUint8Array:function(c){if(null===c||void 0===c)return k.decompress(c);for(var h=Array(c.length/2),e=0,b=h.length;e<b;e++)h[e]=256*c[2*e]+c[2*e+1];var m=
[];return h.forEach(function(a){m.push(f(a))}),k.decompress(m.join(""))},compressToEncodedURIComponent:function(c){return null==c?"":k._compress(c,6,function(c){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(c)})},decompressFromEncodedURIComponent:function(f){return null==f?"":""==f?null:(f=f.replace(/ /g,"+"),k._decompress(f.length,32,function(h){return c("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",f.charAt(h))}))},compress:function(c){return k._compress(c,
16,function(c){return f(c)})},_compress:function(c,f,e){if(null==c)return"";var b,h,a,g={},d={},u="",k="",n="",l=2,t=3,p=2,q=[],w=0,A=0;for(a=0;a<c.length;a+=1)if(u=c.charAt(a),Object.prototype.hasOwnProperty.call(g,u)||(g[u]=t++,d[u]=!0),k=n+u,Object.prototype.hasOwnProperty.call(g,k))n=k;else{if(Object.prototype.hasOwnProperty.call(d,n)){if(256>n.charCodeAt(0)){for(b=0;b<p;b++)w<<=1,A==f-1?(A=0,q.push(e(w)),w=0):A++;h=n.charCodeAt(0);for(b=0;8>b;b++)w=w<<1|1&h,A==f-1?(A=0,q.push(e(w)),w=0):A++,
h>>=1}else{h=1;for(b=0;b<p;b++)w=w<<1|h,A==f-1?(A=0,q.push(e(w)),w=0):A++,h=0;h=n.charCodeAt(0);for(b=0;16>b;b++)w=w<<1|1&h,A==f-1?(A=0,q.push(e(w)),w=0):A++,h>>=1}l--;0==l&&(l=Math.pow(2,p),p++);delete d[n]}else for(h=g[n],b=0;b<p;b++)w=w<<1|1&h,A==f-1?(A=0,q.push(e(w)),w=0):A++,h>>=1;l--;0==l&&(l=Math.pow(2,p),p++);g[k]=t++;n=String(u)}if(""!==n){if(Object.prototype.hasOwnProperty.call(d,n)){if(256>n.charCodeAt(0)){for(b=0;b<p;b++)w<<=1,A==f-1?(A=0,q.push(e(w)),w=0):A++;h=n.charCodeAt(0);for(b=
0;8>b;b++)w=w<<1|1&h,A==f-1?(A=0,q.push(e(w)),w=0):A++,h>>=1}else{h=1;for(b=0;b<p;b++)w=w<<1|h,A==f-1?(A=0,q.push(e(w)),w=0):A++,h=0;h=n.charCodeAt(0);for(b=0;16>b;b++)w=w<<1|1&h,A==f-1?(A=0,q.push(e(w)),w=0):A++,h>>=1}l--;0==l&&(l=Math.pow(2,p),p++);delete d[n]}else for(h=g[n],b=0;b<p;b++)w=w<<1|1&h,A==f-1?(A=0,q.push(e(w)),w=0):A++,h>>=1;l--;0==l&&(l=Math.pow(2,p),p++)}h=2;for(b=0;b<p;b++)w=w<<1|1&h,A==f-1?(A=0,q.push(e(w)),w=0):A++,h>>=1;for(;;){if(w<<=1,A==f-1){q.push(e(w));break}A++}return q.join("")},
decompress:function(c){return null==c?"":""==c?null:k._decompress(c.length,32768,function(f){return c.charCodeAt(f)})},_decompress:function(c,k,e){var b,h,a,g,d,u,n=[],l=4,t=4,p=3;h="";var q=[],y=e(0),w=k,A=1;for(b=0;3>b;b+=1)n[b]=b;h=0;g=Math.pow(2,2);for(d=1;d!=g;)a=y&w,w>>=1,0==w&&(w=k,y=e(A++)),h|=(0<a?1:0)*d,d<<=1;switch(h){case 0:h=0;g=Math.pow(2,8);for(d=1;d!=g;)a=y&w,w>>=1,0==w&&(w=k,y=e(A++)),h|=(0<a?1:0)*d,d<<=1;u=f(h);break;case 1:h=0;g=Math.pow(2,16);for(d=1;d!=g;)a=y&w,w>>=1,0==w&&(w=
k,y=e(A++)),h|=(0<a?1:0)*d,d<<=1;u=f(h);break;case 2:return""}b=n[3]=u;for(q.push(u);;){if(A>c)return"";h=0;g=Math.pow(2,p);for(d=1;d!=g;)a=y&w,w>>=1,0==w&&(w=k,y=e(A++)),h|=(0<a?1:0)*d,d<<=1;switch(u=h){case 0:h=0;g=Math.pow(2,8);for(d=1;d!=g;)a=y&w,w>>=1,0==w&&(w=k,y=e(A++)),h|=(0<a?1:0)*d,d<<=1;n[t++]=f(h);u=t-1;l--;break;case 1:h=0;g=Math.pow(2,16);for(d=1;d!=g;)a=y&w,w>>=1,0==w&&(w=k,y=e(A++)),h|=(0<a?1:0)*d,d<<=1;n[t++]=f(h);u=t-1;l--;break;case 2:return q.join("")}if(0==l&&(l=Math.pow(2,p),
p++),n[u])h=n[u];else{if(u!==t)return null;h=b+b.charAt(0)}q.push(h);n[t++]=b+h.charAt(0);l--;b=h;0==l&&(l=Math.pow(2,p),p++)}}};return k}();"undefined"!=typeof l&&null!=l&&(l.exports=f)},{}],11:[function(f,l,p){f=f("./events");l.exports=[f,function(){return{observe:function(c,f,n){c=this.watch(f,n);return n(this.get(f)),c},unobserve:function(c,f){this.unwatch(f)}}}]},{"./events":6}],12:[function(f,l,p){var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(c){return typeof c}:
function(c){return c&&"function"==typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c};p=f("../src/util");var q=p.slice,n=p.assign;f=f("./update");l.exports=[f,function(){function f(c,f){var e,b=f[1],h=q(f,2);return this.update(b,[],function(a){e=Array.prototype[c].apply(a,h)}),e}return{push:function(c,k,e,b,m,a){return f.call(this,"push",arguments)},pop:function(c,k){return f.call(this,"pop",arguments)},shift:function(c,k){return f.call(this,"shift",arguments)},unshift:function(c,
k,e,b,m,a){return f.call(this,"unshift",arguments)},assign:function(f,k,e,b,m,a){var g=q(arguments,2);return this.update(k,{},function(a){if("object"!=("undefined"==typeof a?"undefined":c(a)))throw Error('store.assign called for non-object value with key "'+k+'"');return g.unshift(a),n.apply(Object,g)})}}}]},{"../src/util":16,"./update":13}],13:[function(f,l,p){l.exports=function(){return{update:function(c,f,n,k){3==arguments.length&&(k=n,n=void 0);var h=this.get(f,n),l=k(h);this.set(f,void 0!=l?
l:h)}}}},{}],14:[function(f,l,p){function c(b,e){return void 0!==this.get(e)}function q(b,e,a,c){null==c&&(c=a,a=null);null==a&&(a={});b=this.get(e,a);c=c(b);this.set(e,void 0===c?b:c)}function n(b){return this.clearAll.call(this)}function k(b,e){return this.each.call(this,function(a,b){e(b,a)})}function h(b){return this.dump.call(this)}function t(b,e){return JSON.stringify(e)}function e(b,e){if("string"==typeof e)try{return JSON.parse(e)}catch(a){return e||void 0}}p=f("./dump");f=f("./json2");l.exports=
[p,f,function(){return this.disabled=!this.enabled,{has:c,transact:q,clear:n,forEach:k,getAll:h,serialize:t,deserialize:e}}]},{"./dump":5,"./json2":8}],15:[function(f,l,p){function c(){var a="undefined"==typeof console?null:console;a&&(a.warn?a.warn:a.log).apply(a,arguments)}function q(d,f,l){l||(l="");d&&!b(d)&&(d=[d]);f&&!b(f)&&(f=[f]);var u=l?"__storejs_"+l+"_":"",v=l?new RegExp("^"+u):null;if(!/^[a-zA-Z0-9_\-]*$/.test(l))throw Error("store.js namespaces can only have alphanumerics + underscores and dashes");
var p=e({_namespacePrefix:u,_namespaceRegexp:v,_testStorage:function(a){try{a.write("__storejs__test__","__storejs__test__");var d="__storejs__test__"===a.read("__storejs__test__");return a.remove("__storejs__test__"),d}catch(w){return!1}},_assignPluginFnProp:function(a,d){var b=this[d];this[d]=function(){var d=n(arguments,0),e=this,c=[function(){if(b)return h(arguments,function(a,b){d[b]=a}),b.apply(e,d)}].concat(d);return a.apply(e,c)}},_serialize:function(a){return JSON.stringify(a)},_deserialize:function(a,
d){if(!a)return d;var b="";try{b=JSON.parse(a)}catch(A){b=a}return void 0!==b?b:d},_addStorage:function(a){this.enabled||this._testStorage(a)&&(this.storage=a,this.enabled=!0)},_addPlugin:function(d){var e=this;if(b(d))return void h(d,function(a){e._addPlugin(a)});if(!k(this.plugins,function(a){return d===a})){if(this.plugins.push(d),!m(d))throw Error("Plugins must be function values that return objects");var c=d.call(this);if(!a(c))throw Error("Plugins must return an object of function properties");
h(c,function(a,b){if(!m(a))throw Error("Bad plugin property: "+b+" from plugin "+d.name+". Plugins should only return functions.");e._assignPluginFnProp(a,b)})}},addStorage:function(a){c("store.addStorage(storage) is deprecated. Use createStore([storages])");this._addStorage(a)}},g,{plugins:[]});return p.raw={},h(p,function(a,d){m(a)&&(p.raw[d]=t(p,a))}),h(d,function(a){p._addStorage(a)}),h(f,function(a){p._addPlugin(a)}),p}f=f("./util");var n=f.slice,k=f.pluck,h=f.each,t=f.bind,e=f.create,b=f.isList,
m=f.isFunction,a=f.isObject;l.exports={createStore:q};var g={version:"2.0.12",enabled:!1,get:function(a,b){a=this.storage.read(this._namespacePrefix+a);return this._deserialize(a,b)},set:function(a,b){return void 0===b?this.remove(a):(this.storage.write(this._namespacePrefix+a,this._serialize(b)),b)},remove:function(a){this.storage.remove(this._namespacePrefix+a)},each:function(a){var d=this;this.storage.each(function(b,e){a.call(d,d._deserialize(b),(e||"").replace(d._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},
hasNamespace:function(a){return this._namespacePrefix=="__storejs_"+a+"_"},createStore:function(){return q.apply(this,arguments)},addPlugin:function(a){this._addPlugin(a)},namespace:function(a){return q(this.storage,this.plugins,a)}}},{"./util":16}],16:[function(f,l,p){(function(c){function f(b,a){return Array.prototype.slice.call(b,a||0)}function n(b,a){k(b,function(b,d){return a(b,d),!1})}function k(b,a){if(h(b))for(var e=0;e<b.length;e++){if(a(b[e],e))return b[e]}else for(e in b)if(b.hasOwnProperty(e)&&
a(b[e],e))return b[e]}function h(b){return null!=b&&"function"!=typeof b&&"number"==typeof b.length}var t=function(){return Object.assign?Object.assign:function(b,a,e,d){for(var c=1;c<arguments.length;c++)n(Object(arguments[c]),function(a,d){b[d]=a});return b}}(),e=function(){if(Object.create)return function(a,b,d,e){var c=f(arguments,1);return t.apply(this,[Object.create(a)].concat(c))};var b=function(){};return function(a,e,d,c){var g=f(arguments,1);return b.prototype=a,t.apply(this,[new b].concat(g))}}(),
b=function(){return String.prototype.trim?function(b){return String.prototype.trim.call(b)}:function(b){return b.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}();l.exports={assign:t,create:e,trim:b,bind:function(b,a){return function(){return a.apply(b,Array.prototype.slice.call(arguments,0))}},slice:f,each:n,map:function(b,a){var e=h(b)?[]:{};return k(b,function(d,b){return e[b]=a(d,b),!1}),e},pluck:k,isList:h,isFunction:function(b){return b&&"[object Function]"==={}.toString.call(b)},isObject:function(b){return b&&
"[object Object]"==={}.toString.call(b)},Global:"undefined"!=typeof window?window:c}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],17:[function(f,l,p){l.exports=[f("./localStorage"),f("./oldFF-globalStorage"),f("./oldIE-userDataStorage"),f("./cookieStorage"),f("./sessionStorage"),f("./memoryStorage")]},{"./cookieStorage":18,"./localStorage":19,"./memoryStorage":20,"./oldFF-globalStorage":21,"./oldIE-userDataStorage":22,"./sessionStorage":23}],
18:[function(f,l,p){function c(c){for(var e=h.cookie.split(/; ?/g),b=e.length-1;0<=b;b--)if(k(e[b])){var f=e[b].split("\x3d"),a=unescape(f[0]),f=unescape(f[1]);c(f,a)}}function q(c){c&&n(c)&&(h.cookie=escape(c)+"\x3d; expires\x3dThu, 01 Jan 1970 00:00:00 GMT; path\x3d/")}function n(c){return(new RegExp("(?:^|;\\s*)"+escape(c).replace(/[\-\.\+\*]/g,"\\$\x26")+"\\s*\\\x3d")).test(h.cookie)}f=f("../src/util");p=f.Global;var k=f.trim;l.exports={name:"cookieStorage",read:function(c){if(!c||!n(c))return null;
c="(?:^|.*;\\s*)"+escape(c).replace(/[\-\.\+\*]/g,"\\$\x26")+"\\s*\\\x3d\\s*((?:[^;](?!;))*[^;]?).*";return unescape(h.cookie.replace(new RegExp(c),"$1"))},write:function(c,e){c&&(h.cookie=escape(c)+"\x3d"+escape(e)+"; expires\x3dTue, 19 Jan 2038 03:14:07 GMT; path\x3d/")},each:c,remove:q,clearAll:function(){c(function(c,e){q(e)})}};var h=p.document},{"../src/util":16}],19:[function(f,l,p){function c(c){return q.localStorage.getItem(c)}var q=f("../src/util").Global;l.exports={name:"localStorage",
read:c,write:function(c,f){return q.localStorage.setItem(c,f)},each:function(f){for(var k=q.localStorage.length-1;0<=k;k--){var h=q.localStorage.key(k);f(c(h),h)}},remove:function(c){return q.localStorage.removeItem(c)},clearAll:function(){return q.localStorage.clear()}}},{"../src/util":16}],20:[function(f,l,p){l.exports={name:"memoryStorage",read:function(f){return c[f]},write:function(f,n){c[f]=n},each:function(f){for(var n in c)c.hasOwnProperty(n)&&f(c[n],n)},remove:function(f){delete c[f]},clearAll:function(f){c=
{}}};var c={}},{}],21:[function(f,l,p){function c(c){for(var f=q.length-1;0<=f;f--){var h=q.key(f);c(q[h],h)}}f=f("../src/util").Global;l.exports={name:"oldFF-globalStorage",read:function(c){return q[c]},write:function(c,f){q[c]=f},each:c,remove:function(c){return q.removeItem(c)},clearAll:function(){c(function(c,f){delete q[c]})}};var q=f.globalStorage},{"../src/util":16}],22:[function(f,l,p){function c(e){return e.replace(/^\d/,"___$\x26").replace(t,"___")}f=f("../src/util").Global;l.exports={name:"oldIE-userDataStorage",
write:function(e,b){if(!h){var f=c(e);k(function(a){a.setAttribute(f,b);a.save(q)})}},read:function(e){if(!h){var b=c(e),f=null;return k(function(a){f=a.getAttribute(b)}),f}},each:function(e){k(function(b){for(var c=b.XMLDocument.documentElement.attributes,a=c.length-1;0<=a;a--){var f=c[a];e(b.getAttribute(f.name),f.name)}})},remove:function(e){var b=c(e);k(function(e){e.removeAttribute(b);e.save(q)})},clearAll:function(){k(function(e){var b=e.XMLDocument.documentElement.attributes;e.load(q);for(var c=
b.length-1;0<=c;c--)e.removeAttribute(b[c].name);e.save(q)})}};var q="storejs",n=f.document,k=function(){if(!n||!n.documentElement||!n.documentElement.addBehavior)return null;var e,b,c;try{b=new ActiveXObject("htmlfile"),b.open(),b.write('\x3cscript\x3edocument.w\x3dwindow\x3c/script\x3e\x3ciframe src\x3d"/favicon.ico"\x3e\x3c/iframe\x3e'),b.close(),e=b.w.frames[0].document,c=e.createElement("div")}catch(a){c=n.createElement("div"),e=n.body}return function(a){var b=[].slice.call(arguments,0);b.unshift(c);
e.appendChild(c);c.addBehavior("#default#userData");c.load(q);a.apply(this,b);e.removeChild(c)}}(),h=(f.navigator?f.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./),t=/[!"#$%&'()*+,/\\:;<=>?@[\]^`{|}~]/g},{"../src/util":16}],23:[function(f,l,p){function c(c){return q.sessionStorage.getItem(c)}var q=f("../src/util").Global;l.exports={name:"sessionStorage",read:c,write:function(c,f){return q.sessionStorage.setItem(c,f)},each:function(f){for(var k=q.sessionStorage.length-1;0<=k;k--){var h=
q.sessionStorage.key(k);f(c(h),h)}},remove:function(c){return q.sessionStorage.removeItem(c)},clearAll:function(){return q.sessionStorage.clear()}}},{"../src/util":16}]},{},[1])(1)})},"libs/md5/md5":function(){(function(r){function f(a,b){var d=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(d>>16)<<16|d&65535}function l(a,b,d,e,c,h){a=f(f(b,a),f(e,h));return f(a<<c|a>>>32-c,d)}function p(a,b,d,e,c,f,h){return l(b&d|~b&e,a,b,c,f,h)}function c(a,b,d,e,c,f,h){return l(b&e|d&~e,a,b,c,f,h)}function q(a,b,
d,e,c,f,h){return l(d^(b|~e),a,b,c,f,h)}function n(a,b){a[b>>5]|=128<<b%32;a[(b+64>>>9<<4)+14]=b;var d,e,g,h,m=1732584193,k=-271733879,n=-1732584194,t=271733878;for(b=0;b<a.length;b+=16)d=m,e=k,g=n,h=t,m=p(m,k,n,t,a[b],7,-680876936),t=p(t,m,k,n,a[b+1],12,-389564586),n=p(n,t,m,k,a[b+2],17,606105819),k=p(k,n,t,m,a[b+3],22,-1044525330),m=p(m,k,n,t,a[b+4],7,-176418897),t=p(t,m,k,n,a[b+5],12,1200080426),n=p(n,t,m,k,a[b+6],17,-1473231341),k=p(k,n,t,m,a[b+7],22,-45705983),m=p(m,k,n,t,a[b+8],7,1770035416),
t=p(t,m,k,n,a[b+9],12,-1958414417),n=p(n,t,m,k,a[b+10],17,-42063),k=p(k,n,t,m,a[b+11],22,-1990404162),m=p(m,k,n,t,a[b+12],7,1804603682),t=p(t,m,k,n,a[b+13],12,-40341101),n=p(n,t,m,k,a[b+14],17,-1502002290),k=p(k,n,t,m,a[b+15],22,1236535329),m=c(m,k,n,t,a[b+1],5,-165796510),t=c(t,m,k,n,a[b+6],9,-1069501632),n=c(n,t,m,k,a[b+11],14,643717713),k=c(k,n,t,m,a[b],20,-373897302),m=c(m,k,n,t,a[b+5],5,-701558691),t=c(t,m,k,n,a[b+10],9,38016083),n=c(n,t,m,k,a[b+15],14,-660478335),k=c(k,n,t,m,a[b+4],20,-405537848),
m=c(m,k,n,t,a[b+9],5,568446438),t=c(t,m,k,n,a[b+14],9,-1019803690),n=c(n,t,m,k,a[b+3],14,-187363961),k=c(k,n,t,m,a[b+8],20,1163531501),m=c(m,k,n,t,a[b+13],5,-1444681467),t=c(t,m,k,n,a[b+2],9,-51403784),n=c(n,t,m,k,a[b+7],14,1735328473),k=c(k,n,t,m,a[b+12],20,-1926607734),m=l(k^n^t,m,k,a[b+5],4,-378558),t=l(m^k^n,t,m,a[b+8],11,-2022574463),n=l(t^m^k,n,t,a[b+11],16,1839030562),k=l(n^t^m,k,n,a[b+14],23,-35309556),m=l(k^n^t,m,k,a[b+1],4,-1530992060),t=l(m^k^n,t,m,a[b+4],11,1272893353),n=l(t^m^k,n,t,a[b+
7],16,-155497632),k=l(n^t^m,k,n,a[b+10],23,-1094730640),m=l(k^n^t,m,k,a[b+13],4,681279174),t=l(m^k^n,t,m,a[b],11,-358537222),n=l(t^m^k,n,t,a[b+3],16,-722521979),k=l(n^t^m,k,n,a[b+6],23,76029189),m=l(k^n^t,m,k,a[b+9],4,-640364487),t=l(m^k^n,t,m,a[b+12],11,-421815835),n=l(t^m^k,n,t,a[b+15],16,530742520),k=l(n^t^m,k,n,a[b+2],23,-995338651),m=q(m,k,n,t,a[b],6,-198630844),t=q(t,m,k,n,a[b+7],10,1126891415),n=q(n,t,m,k,a[b+14],15,-1416354905),k=q(k,n,t,m,a[b+5],21,-57434055),m=q(m,k,n,t,a[b+12],6,1700485571),
t=q(t,m,k,n,a[b+3],10,-1894986606),n=q(n,t,m,k,a[b+10],15,-1051523),k=q(k,n,t,m,a[b+1],21,-2054922799),m=q(m,k,n,t,a[b+8],6,1873313359),t=q(t,m,k,n,a[b+15],10,-30611744),n=q(n,t,m,k,a[b+6],15,-1560198380),k=q(k,n,t,m,a[b+13],21,1309151649),m=q(m,k,n,t,a[b+4],6,-145523070),t=q(t,m,k,n,a[b+11],10,-1120210379),n=q(n,t,m,k,a[b+2],15,718787259),k=q(k,n,t,m,a[b+9],21,-343485551),m=f(m,d),k=f(k,e),n=f(n,g),t=f(t,h);return[m,k,n,t]}function k(a){var b,d="";for(b=0;b<32*a.length;b+=8)d+=String.fromCharCode(a[b>>
5]>>>b%32&255);return d}function h(a){var b,d=[];d[(a.length>>2)-1]=void 0;for(b=0;b<d.length;b+=1)d[b]=0;for(b=0;b<8*a.length;b+=8)d[b>>5]|=(a.charCodeAt(b/8)&255)<<b%32;return d}function t(a){return k(n(h(a),8*a.length))}function e(a,b){var d=h(a),e=[],c=[];e[15]=c[15]=void 0;16<d.length&&(d=n(d,8*a.length));for(a=0;16>a;a+=1)e[a]=d[a]^909522486,c[a]=d[a]^1549556828;b=n(e.concat(h(b)),512+8*b.length);return k(n(c.concat(b),640))}function b(a){var b="",d,e;for(e=0;e<a.length;e+=1)d=a.charCodeAt(e),
b+="0123456789abcdef".charAt(d>>>4&15)+"0123456789abcdef".charAt(d&15);return b}function m(a,c,d){c?d?a=e(unescape(encodeURIComponent(c)),unescape(encodeURIComponent(a))):(a=e(unescape(encodeURIComponent(c)),unescape(encodeURIComponent(a))),a=b(a)):a=d?t(unescape(encodeURIComponent(a))):b(t(unescape(encodeURIComponent(a))));return a}"function"===typeof define&&define.amd?define(function(){return m}):r.md5=m})(this)},"jimu/dijit/AGOLLoading":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/AGOLLoading.html dojo/_base/html ../utils".split(" "),
function(r,f,l,p,c,q){return r([f,l],{baseClass:"jimu-agol-loading",declaredClass:"jimu.dijit.AGOLLoading",templateString:p,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&c.setStyle(this.domNode,"display","none");c.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||c.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=
q.sanitizeHTML(this.loadingText))},show:function(f){this.domNode&&this.hidden&&("string"===typeof f&&(this.textNode.innerHTML=f),c.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(c.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/Deferred dojo/promise/all dojo/debounce require ./MapManager ./utils".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m){var a=null,g;g=r([p],{constructor:function(a,b){this.own(c.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)));this.own(c.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));this.own(c.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)));this.own(c.subscribe("mapChanged",f.hitch(this,this._onMapChanged)));this.own(c.subscribe("beforeMapDestory",f.hitch(this,this._onBeforeMapDestory)));this.own(c.subscribe("preloadModulesLoaded",
f.hitch(this,this._onPreloadModulesLoaded)));this.own(c.subscribe("openWidget",f.hitch(this,this._onOpenWidgetRequest)));this.own(c.subscribe("builder/actionTriggered",f.hitch(this,this._onActionTriggered)));m.isMobileUa()||this.own(q(window,"resize",t(f.hitch(this,this.resize),200)));this.id=b;this.preloadModulesLoadDef=new k},postCreate:function(){this.containerNode=this.domNode},map:null,mapId:"map",mapDiv:null,hlDiv:null,layoutManager:null,animTime:500,resize:function(){this.layoutManager&&this.layoutManager.resize()},
_onAppConfigLoaded:function(a){this.appConfig=f.clone(a);this.preloadModulesLoadDef.then(f.hitch(this,function(){this._loadLayoutManager(this.appConfig).then(f.hitch(this,function(a){this.layoutManager=a;this.layoutManager.onEnter(this.appConfig,this.mapId).then(f.hitch(this,function(){this.mapDiv=this.layoutManager.getMapDiv();this._loadingAnim();this._loadMap(this.mapId);this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))}))}))},_loadLayoutManager:function(a){a=a.layoutDefinition?a.layoutDefinition.manager:
"jimu/layoutManagers/AbsolutePositionLayoutManager";var d=new k;e([a],f.hitch(this,function(a){a=a.getInstance();this.map&&a.setMap(this.map);d.resolve(a)}));return d},_loadingAnim:function(){window.isXT&&"config"===this.appConfig.mode||(l.addClass(jimuConfig.loadingId,"loading-fadeOut"),this.own(q(document.getElementById(jimuConfig.loadingId),"animationend",f.hitch(this,function(){l.setStyle(jimuConfig.loadingId,"display","none")}))))},_loadMap:function(a){this.mapManager=b.getInstance({appConfig:this.appConfig,
urlParams:this.urlParams},a);this.mapManager.showMap();this._lazyLoadResources()},_lazyLoadResources:function(){jimuConfig.lazyLoadCss&&e(jimuConfig.lazyLoadCss);e(["dynamic-modules/commonResources"])},_onMapLoaded:function(a){this.map=a;this.layoutManager.setMap(a);this.layoutManager.loadAndLayout(this.appConfig)},_onPreloadModulesLoaded:function(){this.preloadModulesLoadDef.resolve()},_loadTheme:function(a){var d=new k;e(["themes/"+a.name+"/main"],f.hitch(this,function(){h([this._loadThemeCommonStyle(a),
this._loadThemeCurrentStyle(a)]).then(f.hitch(this,function(){this._addCustomStyle(a);this.layoutManager.onThemeLoad();d.resolve()}))}));return d},_loadThemeCommonStyle:function(a){l.addClass(this.domNode,a.name);return m.loadStyleLink(this._getThemeCommonStyleId(a),"themes/"+a.name+"/common.css")},_loadThemeCurrentStyle:function(a){l.addClass(this.domNode,a.styles[0]);return m.loadStyleLink(this._getThemeCurrentStyleId(a),"themes/"+a.name+"/styles/"+a.styles[0]+"/style.css")},_addCustomStyle:function(a){var d=
f.getObject("customStyles",!1,a);if(d){var b=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(a=this._getFixedThemeStyles(a))&&(b+=a);b=f.replace(b,d,/\$\{([^\}]+)\}/g);d=l.create("style",{type:"text/css"});try{d.appendChild(document.createTextNode(b))}catch(B){d.styleSheet.cssText=b}d.setAttribute("source","custom");document.head.appendChild(d)}},_getFixedThemeStyles:function(a){var d=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";if(a.customStyles.mainBackgroundColor&&
m.isLightColor(a.customStyles.mainBackgroundColor))var b=e.toUrl("jimu")+"/css/images/api_popup_light.png",d=d+(".esriPopup .titleButton {background: url("+b+") no-repeat}")+".esriPopup .titlePane {color: black}";"PlateauTheme"===a.name?d+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}.jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important}":
"BillboardTheme"===a.name?d+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen, .jimu-widget-mylocation .place-holder.nohttps:hover, .jimu-widget-extent-navigate .operation.jimu-state-disabled:hover{background-color: ${mainBackgroundColor} !important; opacity: 0.8;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important; opacity: 0.8;}.jimu-widget-homebutton .HomeButton .home:hover, .jimu-widget-mylocation .place-holder:not(.nohttps):hover, .jimu-widget-zoomslider.vertical .zoom-in:hover, .jimu-widget-zoomslider.vertical .zoom-out:hover, .jimu-widget-extent-navigate .operation:not(.jimu-state-disabled):hover, .jimu-widget-fullScreen .fullScreen:hover, .jimu-widget-onscreen-icon:hover, .jimu-widget-onscreen-icon.jimu-state-selected{opacity: 1;}":
"BoxTheme"===a.name?d+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important; opacity: 0.8;}.jimu-main-background.jimu-widget-zoomslider{background-color: transparent !important}.jimu-widget-homebutton .HomeButton .home:hover, .jimu-widget-mylocation .place-holder:not(.nohttps):hover, .jimu-widget-zoomslider.vertical .zoom-in:hover, .jimu-widget-zoomslider.vertical .zoom-out:hover, .jimu-widget-zoomslider .zoom:hover, .jimu-widget-extent-navigate .operation:not(.jimu-state-disabled):hover, .jimu-widget-fullScreen .fullScreen:hover{background-color: ${mainBackgroundColor} !important; opacity: 1;}":
"TabTheme"===a.name?d+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}":"DashboardTheme"===a.name?d+=".jimu-widget-dnd-header{background-color: ${mainBackgroundColor} !important;}":"DartTheme"===a.name?d+=".jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation.jimu-state-disabled,.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation.jimu-state-disabled:hover{color: ${mainBackgroundColor} !important; opacity: 0.6;}.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation,.dart-controller-extent-navigate .jimu-widget-extent-navigate .operation:hover{color: ${mainBackgroundColor} !important; opacity: 1;}":
"PocketTheme"===a.name&&(d+=".jimu-main-background, .jimu-widget-homebutton, .jimu-widget-mylocation, .jimu-widget-onscreen-icon, .jimu-widget-onscreen-icon.jimu-state-selected, .jimu-widget-zoomslider .zoom, .jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation .place-holder, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen, .esriPopup .titlePane, .esriPopupMobile .titlePane, .esriPopup .pointer.top{background-color: ${mainBackgroundColor} !important;}.esriMobileNavigationBar{background-color: ${mainBackgroundColor} !important; background-image: none !important;}");
return d},_onAppConfigChanged:function(a,b,e){a=f.clone(a);switch(b){case "themeChange":this._onThemeChange(a);break;case "styleChange":this._onStyleChange(a);break;case "layoutChange":this._onLayoutChange(a);break;case "widgetChange":this._onWidgetChange(a,e);break;case "groupChange":this._onGroupChange(a,e);break;case "widgetPoolChange":this._onWidgetPoolChange(a,e);break;case "resetConfig":this._onResetConfig(a);break;case "loadingPageChange":this._onLoadingPageChange(a,e);break;case "layoutDefinitionChange":this._onLayoutDefinitionChange(a,
e);break;case "onScreenGroupsChange":this._onOnScreenGroupsChange(a,e);break;case "onScreenOrderChange":this._onOnScreenOrderChange(a,e)}this.appConfig=a},_onMapChanged:function(a){this.map=a;this.layoutManager.setMap(a);this.layoutManager.loadAndLayout(this.appConfig)},_onBeforeMapDestory:function(){this.layoutManager.destroyOnScreenWidgetsAndGroups()},_onThemeChange:function(a){this.layoutManager.destroyOnScreenWidgetsAndGroups();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);
this._removeCustomStyle();h([this._loadLayoutManager(a),this._loadTheme(a.theme)]).then(f.hitch(this,function(d){var b=d[0];this.layoutManager.name!==b.name?(this.layoutManager.onLeave(),b.onEnter(a,this.mapId).then(f.hitch(this,function(){this.layoutManager=b;this.layoutManager.loadAndLayout(a)}))):this.layoutManager.loadAndLayout(a)}))},_onResetConfig:function(a){var d=this.appConfig;c.publish("appConfigChanged",a,"mapChange",a);this.appConfig=d;this._loadLayoutManager(a).then(f.hitch(this,function(a){this.layoutManager=
a;this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();this._loadTheme(this.appConfig.theme)}))},_onLoadingPageChange:function(a,b){"backgroundColor"in b?l.setStyle(jimuConfig.loadingId,"background-color",a.loadingPage.backgroundColor):"backgroundImage"in b?(a=a.loadingPage.backgroundImage,a.visible&&a.uri?(l.setStyle(jimuConfig.loadingImageId,"background-image","url('"+a.uri+"')"),l.setStyle(jimuConfig.loadingImageId,"width",
a.width+"px"),l.setStyle(jimuConfig.loadingImageId,"height",a.height+"px")):(l.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),l.setStyle(jimuConfig.loadingImageId,"width","0px"),l.setStyle(jimuConfig.loadingImageId,"height","0px"))):"loadingGif"in b&&(a=a.loadingPage.loadingGif,a.visible&&a.uri?(l.setStyle(jimuConfig.loadingGifId,"background-image","url('"+a.uri+"')"),l.setStyle(jimuConfig.loadingGifId,"width",a.width+"px"),l.setStyle(jimuConfig.loadingGifId,"height",a.height+"px")):
(l.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),l.setStyle(jimuConfig.loadingGifId,"width","0px"),l.setStyle(jimuConfig.loadingGifId,"height","0px")))},_onStyleChange:function(a){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(a.theme);this._removeCustomStyle();this._addCustomStyle(a.theme)},_onLayoutChange:function(a){this.layoutManager.onLayoutChange(a)},_onWidgetChange:function(a,b){this.layoutManager.onWidgetChange(a,b)},_onGroupChange:function(a,
b){this.layoutManager.onGroupChange(a,b)},_onWidgetPoolChange:function(a,b){this.layoutManager.onWidgetPoolChange(a,b)},_onActionTriggered:function(a){this.layoutManager.onActionTriggered(a)},_onLayoutDefinitionChange:function(a,b){this.layoutManager.onLayoutDefinitionChange(a,b)},_onOnScreenGroupsChange:function(a,b){this.layoutManager.onOnScreenGroupsChange(a,b)},_onOnScreenOrderChange:function(a,b){this.layoutManager.onOnScreenOrderChange(a,b)},_removeThemeCommonStyle:function(a){l.removeClass(this.domNode,
a.name);l.destroy(this._getThemeCommonStyleId(a))},_removeThemeCurrentStyle:function(a){l.removeClass(this.domNode,a.styles[0]);l.destroy(this._getThemeCurrentStyleId(a))},_removeCustomStyle:function(){n('style[source\x3d"custom"]',document.head).forEach(function(a){l.destroy(a)})},_getThemeCommonStyleId:function(a){return"theme_"+a.name+"_style_common"},_getThemeCurrentStyleId:function(a){return"theme_"+a.name+"_style_"+a.styles[0]},_doPostLoad:function(){e(["dynamic-modules/postload"])},_onOpenWidgetRequest:function(a){this.layoutManager.openWidget(a)}});
g.getInstance=function(d,b){null===a&&(a=new g(d,b),window._layoutManager=a);return a};return g})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/query dojo/topic dojo/on dojo/aspect dojo/keys dojo/i18n dojo/_base/config esri/dijit/InfoWindow esri/dijit/PopupMobile esri/InfoTemplate esri/request esri/arcgis/utils esri/geometry/Extent esri/geometry/Point esri/layers/FeatureLayer require ./utils jimu/LayerInfos/LayerInfos jimu/dijit/Message jimu/dijit/AppStatePopup ./MapUrlParamsHandler ./AppStateManager ./PopupManager ./FilterManager".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C,D,y,w,A,G,E,F){var H=null,L=r(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(a,d){this.appConfig=a.appConfig;this.urlParams=a.urlParams;this.id=this.mapDivId=d;this.appStateManager=G.getInstance(this.urlParams);this.popupManager=E.getInstance(this);this.filterManager=F.getInstance();this.nls=window.jimuNls;q.subscribe("appConfigChanged",f.hitch(this,
this.onAppConfigChanged));q.subscribe("syncExtent",f.hitch(this,this.onSyncExtent));q.subscribe("mapContentModified",f.hitch(this,this.onMapContentModified));n(window,"resize",f.hitch(this,this.onWindowResize));n(window,"unload",f.hitch(this,this.onUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(a){console.time("Load Map");a.map["3D"]?a.map.itemId?this._show3DWebScene(a):this._show3DLayersMap(a):a.map.itemId?this._show2DWebMap(a):console.log("No webmap found. Please set map.itemId in config.json.")},
onUnload:function(){this.appConfig.keepAppState&&this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(a){a&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&(this._mapMobileInfoWindow.destroy(),c("div.esriMobileInfoView.esriMobilePopupInfoView").forEach(function(a){p.destroy(a)}),
c("div.esriMobileNavigationBar").forEach(function(a){p.destroy(a)})),this._mapMobileInfoWindow=new m(null,p.create("div",null,null,this.map.root)),this.isMobileInfoWindow=!1);C.inMobileSize()&&!this.isMobileInfoWindow?(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapMobileInfoWindow),this.isMobileInfoWindow=!0):!C.inMobileSize()&&this.isMobileInfoWindow&&(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapInfoWindow),this.isMobileInfoWindow=!1)},onSyncExtent:function(a){this.map&&
(a=new u(a.extent),this.map.setExtent(a))},_visitConfigMapLayers:function(a,d){l.forEach(a.map.basemaps,function(a,b){a.isOperationalLayer=!1;d(a,b)},this);l.forEach(a.map.operationallayers,function(a,b){a.isOperationalLayer=!0;d(a,b)},this)},_show3DLayersMap:function(a){z(["esri3d/Map"],f.hitch(this,function(d){var b;b=new d(this.mapDivId,{camera:a.map.mapOptions.camera});this._visitConfigMapLayers(a,f.hitch(this,function(a){this.createLayer(b,"3D",a)}));b.usePlugin=d.usePlugin;this._publishMapEvent(b)}))},
_show3DWebScene:function(a){this._getWebsceneData(a.map.itemId).then(f.hitch(this,function(d){z(["esri3d/Map"],f.hitch(this,function(b){var e=new b(this.mapDivId,a.map.mapOptions);l.forEach(d.itemData.operationalLayers,function(a){this.createLayer(e,"3D",a)},this);l.forEach(d.itemData.baseMap.baseMapLayers,function(a){a.type="tile";this.createLayer(e,"3D",a)},this);l.forEach(d.itemData.baseMap.elevationLayers,function(a){a.type="elevation";this.createLayer(e,"3D",a)},this);e.toc=d.itemData.toc;e.bookmarks=
d.itemData.bookmarks;e.tours=d.itemData.tours}))}))},_publishMapEvent:function(a){window._viewerMap=a;A.postProcessUrlParams(this.urlParams,a);console.timeEnd("Load Map");this.map?(this.map=a,this.resetInfoWindow(!0),console.log("map changed."),q.publish("mapChanged",this.map,this.layerInfosObj)):(this.map=a,this.resetInfoWindow(!0),q.publish("mapLoaded",this.map,this.layerInfosObj))},_getWebsceneData:function(a){return g({url:"http://184.169.133.166/sharing/rest/content/items/"+a+"/data",handleAs:"json"})},
_show2DWebMap:function(a){this._increasePointCount(a);a.map.mapOptions||(a.map.mapOptions={});var d=this._processMapOptions(a.map.mapOptions)||{};d.slider=!1;var b=a.map.portalUrl,e=a.map.itemId,d={mapOptions:d,bingMapsKey:a.bingMapsKey,usePopupManager:!0};if(!window.isBuilder&&!a.mode&&a.map.appProxy&&a.map.appProxy.mapItemId===a.map.itemId){var c=[];l.forEach(a.map.appProxy.proxyItems,function(a){a.useProxy&&a.proxyUrl&&c.push({url:a.sourceUrl,mixin:{url:a.proxyUrl}})});0<c.length&&(d.layerMixins=
c)}this._createWebMapRaw(b,e,this.mapDivId,d).then(f.hitch(this,function(d){var b=d.map;b.hideZoomSlider();b.infoWindow.resize(270,316);b.itemId=a.map.itemId;b.itemInfo=d.itemInfo;b.webMapResponse=d;b.enableSnapping({snapKey:h.copyKey});p.setStyle(b.root,"zIndex",0);b._initialExtent=b.extent;this.layerInfosObj=D.getInstanceSyncForInit(b,b.itemInfo);this.layerInfosObj.getLayerInfoArrayOfWebmap().forEach(function(a){a.getLayerObject().then(f.hitch(this,function(a){a&&f.setObject("_wabProperties.originalRefreshinterval",
a.refreshInterval,a)}),f.hitch(this,function(a){console.error("can't get layerObject",a)}))},this);a.map.mapRefreshInterval&&!a.map.mapRefreshInterval.useWebMapRefreshInterval&&this._updateRefreshInterval(a.map.mapRefreshInterval);this._showUnreachableLayersTitleMessage();this._publishMapEvent(b);setTimeout(f.hitch(this,this._checkAppState),500);this._addDataLoadingOnMapUpdate(b);this._hideError()}),f.hitch(this,function(a){console.error(a);this._showError(a);q.publish("mapCreatedFailed")}))},_increasePointCount:function(a){if("1"!==
window.queryObject.disableLargePointCountForTimeSlider&&"true"!==window.queryObject.disableLargePointCountForTimeSlider){var d=!1;C.visitElement(a,function(a){"widgets/TimeSlider/Widget"===a.uri&&(d=!0)});d&&(B.prototype.maxPointCountForAuto=35E3)}},_handleRefreshLayer:function(a){var d=a._mode._drawFeatures,b=a._mode._clearIIf,e=null;a._mode._drawFeatures=function(b,e){e&&"number"===typeof e.row&&"number"===typeof e.col&&a._mode._removeCell(e.row,e.col);d.apply(a._mode,arguments)};k.before(a,"refresh",
function(){e=a._mode._cellMap;a._mode._clearIIf=function(){}});k.after(a,"refresh",function(){a._mode._cellMap=e;a._mode._clearIIf=b});n(a,"update-start",function(){a.isUpdating=!0});n(a,"update-end",function(){a.isUpdating=!1})},_showError:function(a){a&&a.message&&p.create("div",{"class":"app-error load-map-error",innerHTML:a.message},document.body)},_hideError:function(){c("div.load-map-error",document.body).forEach(function(a){document.body.removeChild(a)})},_createWebMapRaw:function(a,b,c,g){return C.createWebMap(a,
b,c,g).then(f.hitch(this,function(a){return a}),f.hitch(this,function(h){console.error(h);if(h&&h instanceof Error&&h.message){var m=f.getObject("arcgis.utils.baseLayerError",!1,t.cache["esri/nls/jsapi/"+e.locale]);if(m&&0<=h.message.indexOf(m))return new y({message:window.jimuNls.map.basemapNotAvailable+window.jimuNls.map.displayDefaultBasemap}),d.getItem(b).then(f.hitch(this,function(d){d.itemData.spatialReference={wkid:102100,latestWkid:3857};d.itemData.baseMap={baseMapLayers:[{url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",
opacity:1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,id:"defaultBasemap_0"}],title:"Topographic"};return C.createWebMap(a,d,c,g)}))}throw h;}))},_showUnreachableLayersTitleMessage:function(){var a=this.layerInfosObj.getUnreachableLayersTitle(),d="",b=window.jimuNls.map.layerLoadedError||"The layer, ${layers} cannot be added to the map.";b&&a&&0<a.length&&(l.forEach(a,f.hitch(this,function(a){d=d+a+", "})),new y({message:b.replace("${layers}",d)}))},_addDataLoadingOnMapUpdate:function(a){var d=
p.toDom('\x3cdiv class\x3d"map-loading"\x3eLoading...\x3c/div\x3e');p.place(d,a.root);a.updating&&p.addClass(d,"loading");n(a,"update-start",f.hitch(this,function(){p.addClass(d,"loading")}));n(a,"update-end",f.hitch(this,function(){p.removeClass(d,"loading")}));n(a,"unload",f.hitch(this,function(){p.destroy(d);d=null}))},_checkAppState:function(){var a="extent center marker find query scale level".split(" "),d=this.appConfig.keepAppState;d&&l.forEach(a,function(a){a in this.urlParams&&(d=!1)},this);
d&&this.appStateManager.getWabAppState().then(f.hitch(this,function(a){if(a.extent||a.layers){var d=new w({nls:{title:this.nls.appState.title,restoreMap:this.nls.appState.restoreMap}});d.placeAt("main-page");n(d,"applyAppState",f.hitch(this,function(){this._applyAppState(a,this.map)}));d.startup();d.show()}}))},_applyAppState:function(a,d){this.layerInfosObj.restoreState({layerOptions:a.layers||null});a.extent&&d.setExtent(a.extent)},_processMapOptions:function(a){if(a)return a.lods||delete a.lods,
a.lods&&0===a.lods.length&&delete a.lods,a=f.clone(a),a.extent&&(a.extent=new u(a.extent)),a.center&&!f.isArrayLike(a.center)&&(a.center=new v(a.center)),a.infoWindow&&(a.infoWindow=new b(a.infoWindow,p.create("div",{},this.mapDivId))),a},createLayer:function(d,b,e){z([{"2D_tiled":"esri/layers/ArcGISTiledMapServiceLayer","2D_dynamic":"esri/layers/ArcGISDynamicMapServiceLayer","2D_image":"esri/layers/ArcGISImageServiceLayer","2D_feature":"esri/layers/FeatureLayer","2D_rss":"esri/layers/GeoRSSLayer",
"2D_kml":"esri/layers/KMLLayer","2D_webTiled":"esri/layers/WebTiledLayer","2D_wms":"esri/layers/WMSLayer","2D_wmts":"esri/layers/WMTSLayer","3D_tiled":"esri3d/layers/ArcGISTiledMapServiceLayer","3D_dynamic":"esri3d/layers/ArcGISDynamicMapServiceLayer","3D_image":"esri3d/layers/ArcGISImageServiceLayer","3D_feature":"esri3d/layers/FeatureLayer","3D_elevation":"esri3d/layers/ArcGISElevationServiceLayer","3D_3dmodle":"esri3d/layers/SceneLayer"}[b+"_"+e.type]],f.hitch(this,function(b){var c,g={};c="label url type icon infoTemplate isOperationalLayer".split(" ");
for(var h in e)0>c.indexOf(h)&&(g[h]=e[h]);e.infoTemplate?(c=new a(e.infoTemplate.title,e.infoTemplate.content),g.infoTemplate=c,b=new b(e.url,g),e.infoTemplate.width&&e.infoTemplate.height&&k.after(b,"onClick",f.hitch(this,function(){d.infoWindow.resize(e.infoTemplate.width,e.infoTemplate.height)}),!0)):b=new b(e.url,g);b.isOperationalLayer=e.isOperationalLayer;b.label=e.label;b.icon=e.icon;d.addLayer(b)}))},onAppConfigChanged:function(a,d,b){this.appConfig=a;"mapChange"===d?this._recreateMap(a):
"mapOptionsChange"===d?b.lods&&this._recreateMap(a):"mapRefreshIntervalChange"===d&&this.map&&this.map.itemInfo.itemData&&this.layerInfosObj&&this._updateRefreshInterval(b)},onMapContentModified:function(){this._recreateMap(this.appConfig)},_updateRefreshInterval:function(a){var d=-1,d=a.useWebMapRefreshInterval?-1:a.minutes;this.layerInfosObj.getLayerInfoArrayOfWebmap().forEach(function(a){a.getLayerObject().then(f.hitch(this,function(a){if(a){var b=f.getObject("_wabProperties.originalRefreshinterval",
!1,a);0<b&&"function"===typeof a.setRefreshInterval&&(0>d?a.setRefreshInterval(b):a.setRefreshInterval(d))}}),f.hitch(this,function(a){console.error("can't get layerObject",a)}))},this)},_recreateMap:function(a){this.map&&(q.publish("beforeMapDestory",this.map),this.map.destroy());this._showMap(a)},disableWebMapPopup:function(){this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map.setInfoWindowOnClick(!0)}});L.getInstance=function(a,d){null===H&&(H=new L(a,d));return H};return L})},
"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B){var z=r([v,b,m,a,u],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,templateString:B,
anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(a){this.inherited(arguments);t.place(this.domNode,a.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[z.ANCHOR_UPPERRIGHT,z.ANCHOR_LOWERRIGHT,z.ANCHOR_LOWERLEFT,z.ANCHOR_UPPERLEFT];if(7>q("ie")){var a="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+
e.getComputedStyle(this._sprite).backgroundImage.replace(/url\(\"/i,"").replace(/\"\)/,"")+"')",d=t.create("div",null,p.body());e.set(d,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:a});var b=setTimeout(function(){t.destroy(d);clearTimeout(b);b=d=null},100);c.query(".sprite",this.domNode).forEach(function(d){d.style.backgroundImage="none";d.style.filter=a})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),
this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(a,d){if(a&&d){var b=e.set;b(this._topleft,{height:d+"px",marginLeft:a+"px"});b(this._topright,{width:a+"px",height:d+"px"});b(this._user,"width",a-8+"px");b(this._hide,"marginLeft",a-22+"px");b(this._title,"width",a-25+"px");b(this._content,"height",d-37+"px");b(this._bottomleft,{marginLeft:a+"px",marginTop:d+"px"});b(this._bottomright,{width:a-
5+"px",marginTop:d+"px"});this.width=a;this.height=d;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(a,d)}},_adjustPosition:function(a,d){var b=e.set;b(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+"px"});d===z.ANCHOR_UPPERLEFT?b(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):d===z.ANCHOR_UPPERRIGHT?b(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):d===z.ANCHOR_LOWERRIGHT?b(this._window,{left:"6px",
right:null,top:"43px",bottom:null}):d===z.ANCHOR_LOWERLEFT&&b(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(a){var d=this.map;return d&&a?(a.y<d.height/2?"lower":"upper")+(a.x<d.width/2?"right":"left"):"upperright"},show:function(a,b,e){if(a){a.spatialReference?(this.mapCoords=a,a=this.coords=this.map.toScreen(a,!0)):(this.mapCoords=null,this.coords=a);var c=this.map._getFrameWidth();if(-1!==c&&(a.x%=c,0>a.x&&(a.x+=c),this.map.width>c))for(var f=(this.map.width-
c)/2;a.x<f;)a.x+=c;b&&-1!==l.indexOf(this._ANCHORS,b)||(b=this._getAnchor(a));h.remove(this._pointer,this.anchor);b=this.anchor=this.fixedAnchor||b;this._adjustPosition(a,b);h.add(this._pointer,b);d.show(this.domNode);this.isShowing=!0;if(!e)this.onShow()}},hide:function(a,b){d.hide(this.domNode);this.isShowing=!1;if(!b)this.onHide()},showTitleBar:function(){d.show(this._titlebar);d.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){d.hide(this._titlebar);d.hide(this._border);this.isTitleBarShowing=
!1},showContent:function(){d.show(this._content);d.show(this._border);this.isContentShowing=!0},hideContent:function(){d.hide(this._content);d.hide(this._border);this.isContentShowing=!1},move:function(a,d){d?a=this.coords.offset(a.x,a.y):(this.coords=a,this.mapCoords&&(this.mapCoords=this.map.toMap(a)));e.set(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+"px"})},setFixedAnchor:function(a){a&&-1===l.indexOf(this._ANCHORS,a)||(this.fixedAnchor=a,this.isShowing&&this.show(this.mapCoords||
this.coords,a),this.onAnchorChange(a))},setTitle:function(a){this.destroyDijits(this._title);this.__setValue("_title",a);return this},setContent:function(a){this.destroyDijits(this._content);this.__setValue("_content",a);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},onResize:function(){},onAnchorChange:function(){}});f.mixin(z,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",
ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});q("extend-esri")&&f.setObject("dijit.InfoWindow",z,g);return z})},"esri/dijit/PopupMobile":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style ../InfoWindowBase ../PopupBase ./InfoView ./NavigationBar ../kernel ../domUtils dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C,D){r=f([d,u],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:r.toUrl("./images/whitex.png"),dArrowIcon:r.toUrl("./images/whitedown.png"),lArrowIcon:r.toUrl("./images/whitel.png"),rArrowIcon:r.toUrl("./images/whiter.png"),constructor:function(a,d){this.initialize();l.mixin(this,a);this.domNode=t.byId(d);this._nls=l.mixin({},
D.widgets.popup);a=this.domNode;b.add(a,"esriPopupMobile");e.set(a,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
d=n.query(".titlePane",a)[0];this._arrowButton=n.query(".arrow",d)[0];this._pointerTop=n.query(".top",a)[0];this._pointerBottom=n.query(".bottom",a)[0];this._title=n.query(".title",d)[0];this._footer=n.query(".footer",d)[0];this._prev=n.query(".prev",d)[0];this._next=n.query(".next",d)[0];this._spinner=n.query(".spinner",d)[0];this._eventConnections=[p.connect(n.query(".close",d)[0],"onclick",this,this.hide),p.connect(this._arrowButton,"onclick",this,this._toggleView),p.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),p.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();C.hide(a);this.isShowing=!1},setMap:function(a){this.inherited(arguments);m.place(this.domNode,a.root);this.highlight&&this.enableHighlight(a)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(a,d){this.destroyDijits(this._title);this.place(a,this._title);
this.destroyDijits(this._footer);this.place(d,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(a){this.destroyDijits(this._contentPane);this.place(a,this._contentPane);this.startupDijits(this._contentPane)},show:function(a){if(a){var d=this.map;a.spatialReference?(this.location=a,a=d.toScreen(a)):this.location=d.toMap(a);this._maximized?this.restore():this._setPosition(a);this.isShowing||(C.show(this.domNode),this.isShowing=!0,this.onShow())}else C.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(C.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);c.forEach(this._eventConnections,p.disconnect);m.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");b.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var a=this.selectedIndex;this._updateUI();0<=a&&(this.setContent(this.features[a].getContent()),this.updateHighlight(this.map,this.features[a]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var a=this.map;this._handles=[p.connect(a,"onPanStart",this,this._onPanStart),p.connect(a,"onPan",this,this._onPan),p.connect(a,"onZoomStart",this,this._onZoomStart),p.connect(a,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var a=this._handles;a&&(c.forEach(a,p.disconnect),this._handles=null)},_onPanStart:function(){var a=this.domNode.style;this._panOrigin={left:a.left,top:a.top,right:a.right,
bottom:a.bottom}},_onPan:function(a,d){var b=this._panOrigin;a=d.x;d=d.y;var e=b.left,c=b.top,f=b.right,b=b.bottom;e&&(e=parseFloat(e)+a+"px");c&&(c=parseFloat(c)+d+"px");f&&(f=parseFloat(f)-a+"px");b&&(b=parseFloat(b)-d+"px");g.set(this.domNode,{left:e,top:c,right:f,bottom:b})},_onZoomStart:function(){C.hide(this.domNode)},_onExtentChange:function(a,d,b){b&&(C.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(d){var e=d.x;d=d.y;var c=
a.getContentBox(this.map.container),f=c.w,c=c.h,h=0,m=d+10,k=118,u=f-18;18<e&&e<u?(h=e-130,0>h?h=0:h>f-260&&(h=f-260)):18>=e?h=e-18:e>=u&&(h=f-260+(e-u));118<e&&e<f-130?k=118:118>=e?18<e?k=e-12:18>=e&&(k=6):e>=f-130&&(e<u?k=118+e-(f-130):e>=u&&(k=118+u-(f-130)));d<=c/2?(g.set(this.domNode,{left:h+"px",top:m+"px",bottom:null}),g.set(this._pointerTop,{left:k+"px"}),b.add(this._pointerBottom,"hidden"),b.remove(this._pointerTop,"hidden")):(g.set(this.domNode,{left:h+"px",top:m-64+"px",bottom:null}),g.set(this._pointerBottom,
{left:k+"px"}),b.add(this._pointerTop,"hidden"),b.remove(this._pointerBottom,"hidden"))},_showPointer:function(a){c.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(d){d===a?n.query(".pointer."+d,this.domNode).removeClass("hidden"):n.query(".pointer."+d,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();C.show(this.popupNavigationBar.container);C.show(this.popupInfoView.container);
0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(a){this.popupInfoView.animateTo(0);switch(a.name){case "CloseButton":C.hide(this.popupNavigationBar.container);C.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":C.hide(this.popupNavigationBar.container);C.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();break;case "NextButton":this.selectNext(),
this._updateUI()}},_initPopupNavigationBar:function(){var a={};a.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:this.lArrowIcon,srcAlt:this.lArrowIcon,position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",src:this.rArrowIcon,srcAlt:this.rArrowIcon,
position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new B(a,m.create("div",{},q.body()));p.connect(this.popupNavigationBar,"onCreate",this,function(a){this._prevFeatureButton=a[3]._node;this._nextFeatureButton=a[4]._node});p.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);p.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();C.hide(this.popupNavigationBar.container)},_initPopupInfoView:function(){this.popupInfoView=
new v({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},m.create("div",{},q.body()));b.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();p.connect(this.popupInfoView,"onCreate",this,function(a){this._contentPane=a[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});p.connect(this.popupInfoView,"onSwipeLeft",this,function(){});p.connect(this.popupInfoView,
"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var a="\x26nbsp;",d="\x26nbsp;",e=this.selectedIndex,c=this.features,f=this.deferreds,g=this._prevFeatureButton.parentNode,h=this._nextFeatureButton.parentNode,m=this._spinner,k=this._nls;c&&1<=c.length?(a=c[e].getTitle(),d=e+1+" of "+c.length,b.remove(this._arrowButton,"hidden"),0===e?(b.add(g,"hidden"),b.add(this._prev,"hidden")):(b.remove(g,"hidden"),b.remove(this._prev,"hidden")),e===c.length-1?(b.add(h,"hidden"),
b.add(this._next,"hidden")):(b.remove(h,"hidden"),b.remove(this._next,"hidden"))):(b.add(this._arrowButton,"hidden"),b.add(g,"hidden"),b.add(h,"hidden"),b.add(this._prev,"hidden"),b.add(this._next,"hidden"));this.setTitle(a,d);this.popupNavigationBar.getItems()[1]._node.innerHTML=d;f&&f.length?(b.remove(m,"hidden"),this.setTitle(k.NLS_searching+"...","\x26nbsp;")):(b.add(m,"hidden"),c&&c.length||this.setTitle("No Information","\x26nbsp;"))}});k("extend-esri")&&l.setObject("dijit.PopupMobile",r,z);
return r})},"esri/dijit/InfoView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry ../kernel ./_TouchBase".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m){r=r(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],_isDecelerate:!1,constructor:function(a,b){this.container=k.byId(b);this._touchBase=m(this.container,null);this._slideDiv=t.create("div",
null,this.container,"first");this.events=[];this._items=a.items;a.sections&&(this._sections=a.sections);h.add(this.container,"esriMobileInfoView");if(0===this._sections.length)t.create("div",{},this._slideDiv);else for(a=0;a<this._sections.length;a++)b=t.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv),t.create("div",{innerHTML:this._sections[a].title},b);for(a=0;a<this._items.length;a++){var d;b=0;this._items[a].section&&(b=this._items[a].section);switch(this._items[a].type){case "div":d=
t.create("div",{"class":"esriMobileInfoViewItem",style:this._items[a].style},this._slideDiv.childNodes[b]),d=t.create("div",{innerHTML:this._items[a].text},d)}this._items[a].className&&h.add(d,this._items[a].className);d._index=a;d._item=this._items[a];this._items[a]._node=d}this.startTouchY=0},startup:function(){this.onCreate(this._items);this._animateTo(0)},destroy:function(){l.forEach(this.events,p.disconnect);this._touchBase=null;c.query("img",this.container).forEach(function(a){a._index=null;
a._item=null;t.destroy(a);a=null});this._items=null;t.destroy(this._slideDiv);t.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(a){this._touchBase.setPreventDefault(a)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);this.events.push(p.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));this.events.push(p.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(p.connect(this._touchBase,
"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){p.disconnect(this.events.pop());p.disconnect(this.events.pop());p.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},
onClick:function(a){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(a){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=a.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},_onTouchMoveHandler:function(a){this._moveDirection||(this._moveDirection=Math.abs(a.curY)>Math.abs(a.curX)?"vertical":"horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&this._animateTo(a.touches[0].clientY-
this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(a){this._endTime=new Date;this._deltaMovement=a.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===this._moveDirection)if("left"===a.swipeDirection)this.onSwipeLeft();else if("right"===a.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;return.2<
Math.abs(this._velocity)&&200>this._diff?!0:!1},_doMomentum:function(){var a,b;a=e.getContentBox(this.container);var d=0>this._velocity?.001:-.001;b=-(this._velocity*this._velocity)/(2*d);var c=-this._velocity/d,d=3*.6-0,f=1-d,h=0,m=0;if(a.h>this._slideDiv.scrollHeight)this.contentOffsetY=0,m=300;else if(0<this.contentOffsetY+b){a=0;for(b=Math.floor(c/20);a<b;a++)if(h=(20*f*a^3)+(20*d*a^2)+0*a+0,h=0>this._velocity?-h:h,0<this.contentOffsetY+h){m=20*a;break}0===m&&(m=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+
b)+a.h>this._slideDiv.scrollHeight)for(this.contentOffsetY=a.h-this._slideDiv.scrollHeight,a=0,b=Math.floor(c/20);a<b;a++){if(h=(20*f*a^3)+(20*d*a^2)+0*a+0,h=0>this._velocity?-h:h,Math.abs(this.contentOffsetY+h)>this._slideDiv.scrollHeight){m=20*a;break}}else m=c,this.contentOffsetY+=b;this._slideDiv.style.webkitTransition="-webkit-transform "+m+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},_snapToBounds:function(){var a=e.getContentBox(this.container);a.h>this._slideDiv.scrollHeight?
this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+a.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=a.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration="0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(a){this.contentOffsetY=a;this._slideDiv.style.webkitTransform="translate3d(0, "+a+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var a=document.defaultView.getComputedStyle(this._slideDiv,null),
a=new WebKitCSSMatrix(a.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(a.m42)}},_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(a,b){"ON"===b.toggleState?(b.toggleState="OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(a.src=b.srcAlt),this.onSelect(b))}});q("extend-esri")&&f.setObject("dijit.InfoView",r,b);return r})},"esri/dijit/_TouchBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom dojo/has ../kernel".split(" "),
function(r,f,l,p,c,q){r=r(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(c,f){this.domNode=p.byId(c);this.events=[l.connect(this.domNode,"touchstart",this,this._touchStartHandler),l.connect(this.domNode,"touchmove",this,this._touchMoveHandler),l.connect(this.domNode,"touchend",this,this._touchEndHandler),l.connect(this.domNode,"onclick",this,this._clickHandler)]},setPreventDefault:function(c){this._preventDefault=c},disableOnClick:function(){l.disconnect(this.events.pop())},
_clickHandler:function(c){if(this._moved)c.preventDefault();else this.onclick(c)},_touchStartHandler:function(c){this._moved=!1;this.client_x=c.targetTouches[0].clientX;this.client_y=c.targetTouches[0].clientY;this.down_x=c.targetTouches[0].pageX;this.down_y=c.targetTouches[0].pageY;c.downX=this.down_x;c.downY=this.down_y;this.onTouchStart(c)},_touchMoveHandler:function(c){this._preventDefault&&c.preventDefault();this._moved=!0;this.up_x=c.targetTouches[0].pageX;this.cur_x=c.targetTouches[0].pageX-
this.down_x;this.cur_y=c.targetTouches[0].pageY-this.down_y;c.curX=this.cur_x;c.curY=this.cur_y;this.onTouchMove(c)},_touchEndHandler:function(c){this._moved?(c.curX=this.cur_x,c.curY=this.cur_y,this.down_x-this.up_x>this._swipeThreshold?c.swipeDirection="left":this.up_x-this.down_x>this._swipeThreshold&&(c.swipeDirection="right")):(c.clientX=this.client_x,c.clientY=this.client_y);this.onTouchEnd(c)},onTouchStart:function(c){},onTouchMove:function(c){},onTouchEnd:function(c){},onclick:function(c){}});
c("extend-esri")&&f.setObject("dijit._TouchBase",r,q);return r})},"esri/dijit/NavigationBar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct ./_TouchBase ../kernel".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b){r=r(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(b,a){this.container=k.byId(a);this._touchBase=e(this.container,null);this._slideDiv=t.create("div",
{},this.container,"first");this.events=[l.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._items=b.items;h.add(this.container,"esriMobileNavigationBar");a=t.create("div",{},this._slideDiv);for(b=0;b<this._items.length;b++){var c,d;switch(this._items[b].type){case "img":d=t.create("div",{"class":"esriMobileNavigationItem"},a);c=t.create("img",{src:this._items[b].src.toString(),style:{width:"100%",height:"100%"}},d);break;case "span":d=t.create("div",{"class":"esriMobileNavigationItem"},
a);c=t.create("span",{innerHTML:this._items[b].text},d);break;case "div":d=t.create("div",{"class":"esriMobileNavigationInfoPanel"},a),c=t.create("div",{innerHTML:this._items[b].text},d)}h.add(d,this._items[b].position);this._items[b].className&&h.add(c,this._items[b].className);c._index=b;c._item=this._items[b];this._items[b]._node=c}},startup:function(){this.onCreate(this._items)},destroy:function(){p.forEach(this.events,l.disconnect);this._touchBase=null;c.query("img",this.container).forEach(function(b){b._index=
null;b._item=null;t.destroy(b);b=null});this._items=null;t.destroy(this._slideDiv);t.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(b){this._markSelected(b._node,b)},onSelect:function(b){},onUnSelect:function(b){},onCreate:function(b){},_onClickHandler:function(b){if("img"===b.target.tagName.toLowerCase()){var a=b.target,e=a._item;c.query("img",this.container).forEach(function(d){d!==a&&d._item.toggleGroup===e.toggleGroup&&this._markUnSelected(d,
d._item)},this);this._toggleNode(a,e)}},_toggleNode:function(b,a){"ON"===a.toggleState?(a.toggleState="OFF",a.src&&(b.src=a.src.toString()),this.onUnSelect(a)):(a.toggleState="ON",a.srcAlt&&(b.src=a.srcAlt),this.onSelect(a))},_markSelected:function(b,a){a.toggleState="ON";a.srcAlt&&(b.src=a.srcAlt);this.onSelect(a)},_markUnSelected:function(b,a){"ON"===a.toggleState&&(a.toggleState="OFF",a.src&&(b.src=a.src.toString()),this.onUnSelect(a))}});q("extend-esri")&&f.setObject("dijit.NavigationBar",r,b);
return r})},"jimu/dijit/AppStatePopup":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/on dojo/mouse dojo/_base/fx dojo/topic dojo/Evented".split(" "),function(r,f,l,p,c,q,n,k,h){var t=1E3,e=1E4;return r([f,h],{baseClass:"jimu-appstate-popup",declaredClass:"jimu.dijit.AppStatePopup",currentState:0,timeoutHandler:void 0,constructor:function(b){this.inherited(arguments);"animationDuration"in b&&(t=b.animationDuration);"autoCloseInterval"in b&&(e=b.autoCloseInterval)},
postCreate:function(){window.appInfo.isRunInMobile&&p.addClass(this.domNode,"mobile");var b=p.create("div",{"class":"appstate-header"});p.create("div",{"class":"appstate-title",innerHTML:this.nls.title},b);var e=p.create("div",{"class":"appstate-close"},b);p.place(b,this.domNode);b=p.create("div",{"class":"appstate-tips",innerHTML:this.nls.restoreMap});p.place(b,this.domNode);this.own(c(b,"click",l.hitch(this,function(){this.emit("applyAppState");this.hide()})));this.own(c(e,"click",l.hitch(this,
function(){this.hide()})));this.own(c(this.domNode,q.enter,l.hitch(this,function(){this._timerStop()})));this.own(c(this.domNode,q.leave,l.hitch(this,function(){this._timerStart()})))},show:function(){n.animateProperty({node:this.domNode,duration:t,properties:window.appInfo.isRunInMobile?{top:{start:-120,end:0}}:{bottom:{start:-100,end:10}},onEnd:l.hitch(this,function(){this.currentState=1})}).play();k.subscribe("splashPopupShow",l.hitch(this,function(){this._timerStop()}));k.subscribe("splashPopupHide",
l.hitch(this,function(){this._timerStart()}));this.timeoutHandler=setTimeout(l.hitch(this,this.hide),e)},hide:function(){0!==this.currentState&&n.animateProperty({node:this.domNode,duration:t,properties:window.appInfo.isRunInMobile?{top:{start:0,end:-120}}:{bottom:{start:10,end:-100}},onEnd:l.hitch(this,function(){this.currentState=0;p.setStyle(this.domNode,"display","none")})}).play()},_timerStart:function(){1!==this.currentState||this.timeoutHandler||(this.timeoutHandler=setTimeout(l.hitch(this,
this.hide),e))},_timerStop:function(){this.timeoutHandler&&(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0)}})})},"jimu/MapUrlParamsHandler":function(){define("dojo/_base/lang dojo/_base/array dojo/Deferred dojo/topic dojo/promise/all esri/geometry/Point esri/geometry/Extent esri/geometry/scaleUtils esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils esri/symbols/jsonUtils esri/graphic esri/layers/GraphicsLayer esri/InfoTemplate esri/tasks/query ./utils ./LayerInfos/LayerInfos ./shareUtils".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z){function C(a,d){var b=a.center.split(";");1===b.length&&(b=a.center.split(","));if(2===b.length||3===b.length){a=parseFloat(b[0]);var e=parseFloat(b[1]);if(isNaN(a)||isNaN(e))a=parseFloat(b[0]),e=parseFloat(b[1]);if(!isNaN(a)&&!isNaN(e)){var c=4326;3!==b.length||isNaN(b[2])||(c=parseInt(b[2],10));b=new q(a,e,new h(c));M(b.spatialReference,d.spatialReference)?d.centerAt(b):N(b,d.spatialReference,function(a){d.centerAt(a[0])},function(){console.error("Project center point error.")})}}}
function D(a,d){var b=a.extent.split("wkt\x3d"),e=null;2===b.length?(e=b[1],b=b[0],b=b.split(",")):(b=a.extent.split(";"),1===b.length&&(b=a.extent.split(",")));if(4===b.length||5===b.length){a=parseFloat(b[0]);var c=parseFloat(b[1]),f=parseFloat(b[2]),g=parseFloat(b[3]);if(isNaN(a)||isNaN(a)||isNaN(a)||isNaN(a))a=parseFloat(b[0]),c=parseFloat(b[1]),f=parseFloat(b[2]),g=parseFloat(b[3]);if(isNaN(a)||isNaN(c)||isNaN(f)||isNaN(g))console.error("Wrong extent parameters.");else{var m=4326;5!==b.length||
isNaN(b[4])||(m=parseInt(b[4],10));b=null;b=e?new n(a,c,f,g,new h({wkt:e})):new n(a,c,f,g,new h({wkid:m}));M(d.spatialReference,b.spatialReference)?d.setExtent(b):N(b,d.spatialReference,function(a){d.setExtent(a[0])},function(){console.error("Project extent error.")})}}else console.error("Wrong extent parameters.")}function y(a,d){var b=null;if(a.markertemplate){b={title:"",content:"",isIncludeShareUrl:!1};try{var e=JSON.parse(decodeURIComponent(a.markertemplate));r.mixin(b,e)}catch(W){console.error("urlParams: \x26markertemplate JSON.parse error."+
W.stack)}}e=a.marker.split(";");1===e.length&&(e=a.marker.split(","));if(2<=e.length&&6>=e.length&&e[0].length&&!isNaN(e[0])&&e[1].length&&!isNaN(e[1])){var c=parseFloat(e[0]),f=parseFloat(e[1]),g=4326;3<=e.length&&e[2].length&&!isNaN(e[2])&&(g=parseInt(e[2],10));var k="";4<=e.length&&(k=e[3]);a=null;5<=e.length&&0===e[4].indexOf("http")&&(a=e[4]);var u=null;6===e.length&&(u=e[5]);var n=m.fromJson({type:"esriPMS",url:a,contentType:"image/png"}),l=null;u&&(l=m.fromJson({color:[0,0,0,255],type:"esriTS",
verticalAlignment:"baseline",horizontalAlignment:"left",angle:0,xoffset:0,yoffset:0,rotated:!1,kerning:!0,font:{size:12,style:"normal",weight:"bold",family:"Arial"},text:u}));A(n).then(function(){var a=new q(c,f,new h({wkid:g}));M(a.spatialReference,d.spatialReference)?w(a,n,l,k,b,d):N(a,d.spatialReference,function(a){w(a[0],n,l,k,b,d)},function(){console.error("Project center point error.")})})}}function w(b,e,c,f,h,m){f=new d("",f);if(h){var k=z.getXyContent(h);h.isIncludeShareUrl&&(h=z.getShareUrl(m,
h,!0),h=z.getShareUrlContent(h),k+=h);f.setContent(k)}k=new g({id:"marker-feature-action-layer"});m.addLayer(k);f=new a(b,e,null,f);k.add(f);c&&(c.xoffset=e.width/2,c.yoffset=e.height/2+e.yoffset,e=new a(new q(b.toJson()),c),k.add(e),f._textSymbol=e);m.centerAt(b)}function A(a){var d=new l;a.url?v.getImagesSize(a.url).then(function(b){a.width=b[0];a.height=b[1];d.resolve(a)},function(){a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png";a.width=26;a.height=26;a.setOffset(0,a.height/2);d.resolve(a)}):
(a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png",a.width=26,a.height=26,a.setOffset(0,a.height/2),d.resolve(a));return d}function G(a,d){var b=a.query.split(";");1===b.length&&(b=a.query.split(","));if(2!==b.length&&3!==b.length)console.error("query URL parameter is not correct.");else{var e=b[0];L("name",e,d).then(function(a){null===a?L("id",e,d).then(function(a){null===a?console.error("Invalid layer name or id."):E(d,a,b)}):E(d,a,b)})}}function E(a,d,b){var e=new u,c="";e.outSpatialReference=
a.spatialReference;if(2===b.length)e.where=b[1];else if(3===b.length&&(d.layerObject.url&&v.isHostedService(d.layerObject.url)&&v.containsNonLatinCharacter(b[2])&&(c="N"),f.forEach(d.layerObject.fields,function(a){if(a.alias.toLowerCase()===b[1].toLowerCase()||a.name.toLowerCase()===b[1].toLowerCase())-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeOID"].indexOf(a.type)?e.where=a.name+"\x3d"+b[2]:-1<["esriFieldTypeString"].indexOf(a.type)&&
(e.where=b[1]+"\x3d"+c+"'"+b[2].replace(/\'/g,"''")+"'")},this),!e.where)){console.error("Invalid field name or type in query URL parameter.");return}e.maxAllowableOffset=1E-5;d.layerObject.queryFeatures(e).then(function(b){b=b.features;if(0===b.length)console.log("No result from query URL parameter.");else{if("esriGeometryPoint"===d.layerObject.geometryType&&1===b.length)a.setExtent(k.getExtentForScale(a,1E3)),a.centerAt(b[0].geometry);else{var e=v.graphicsExtent(b);a.setExtent(e)}F(a,d,b)}},function(a){console.error(a)})}
function F(a,d,b){function e(a){f.forEach(b,function(d){d.setInfoTemplate(a)})}function c(){a.infoWindow.setFeatures(b);a.infoWindow.show(H(b[0]))}if(a.getLayer(d.layerInfo.id))c();else{var g=d.layerInfo.getInfoTemplate();g?(e(g),c()):d.layerInfo.loadInfoTemplate().then(function(a){e(a);c()})}}function H(a){a=a.geometry;if("point"!==a.type)if("multipoint"===a.type)a=a.getPoint(0);else if("polyline"===a.type)a=a.getExtent().getCenter();else if("polygon"===a.type)a=a.getExtent().getCenter();else if("extent"===
a.type)a=a.getCenter();else return console.error("Can not get layer geometry type, unknow error."),null;return a}function L(a,d,b){var e=new l,f=[];B.getInstance(b,b.itemInfo).then(function(b){b.traversal(function(b){if(e.isResolved())return!0;("id"===a&&b.id.toLowerCase()===d.toLowerCase()||"name"===a&&b.title.toLowerCase()===d.toLowerCase())&&f.push(c({layerType:b.getLayerType(),layerObject:b.getLayerObject()}).then(function(a){"FeatureLayer"===a.layerType&&e.resolve({layerInfo:b,layerObject:a.layerObject})},
function(a){console.error("Find layer error from query URL parameter",a);e.resolve(null)}))});c(f).then(function(){e.isResolved()||e.resolve(null)})});return e}function N(a,d,c,f){var g=[102113,102100,3857],h;4326===a.spatialReference.wkid&&J(g,d.wkid)?(a.ymin=Math.max(a.ymin,-89.99),a.ymax=Math.min(a.ymax,89.99),a=b.geographicToWebMercator(a),(f=a.spatialReference._getInfo())&&a.xmin>a.xmax&&(g=f.valid[1]-a.xmin,h=a.xmax-f.valid[0],g>h?a.xmax=f.valid[1]+h:a.xmin=f.valid[0]-g),a.spatialReference.wkid=
d.wkid,c([a],null)):J(g,a.spatialReference.wkid)&&4326===d.wkid?(a=b.webMercatorToGeographic(a),(f=a.spatialReference._getInfo())&&a.xmin>a.xmax&&(g=f.valid[1]-a.xmin,h=a.xmax-f.valid[0],g>h?a.xmax=f.valid[1]+h:a.xmin=f.valid[0]-g),c([a],null)):(g=new t,g.geometries=[a],g.outSR=d,e.defaults.geometryService.project(g,function(a){!(a&&0<a.length&&a[0]&&"extent"===a[0].type)||isNaN(a[0].xmin)||isNaN(a[0].ymin)||isNaN(a[0].xmax)||isNaN(a[0].ymax)?a&&0<a.length&&a[0]&&"point"===a[0].type&&!isNaN(a[0].x)&&
!isNaN(a[0].y)&&c(a,null):c(a,null)},f))}function M(a,d){var b=[102113,102100,3857];return a&&d&&a.wkt===d.wkt&&(a.wkid===d.wkid||a.latestWkid&&a.latestWkid===d.wkid||d.latestWkid&&a.wkid===d.latestWkid||a.latestWkid&&a.latestWkid===d.latestWkid)||a&&d&&a.wkid&&d.wkid&&J(b,a.wkid)&&J(b,d.wkid)?!0:!1}function J(a,d){for(var b=a.length;b--;)if(a[b]===d)return!0;return!1}function K(a,d,b,e){var c=[];a&&a[d]&&a[d].split&&(c=a[d].split(";"));if(c&&0<c.length){var f={};f[b]=c;B.getInstance(e,e.itemInfo).then(function(a){a.setSimplificationState(f)})}}
return{postProcessUrlParams:function(a,d){a:for(var b=["showLayers","hideLayers","showLayersEncoded","hideLayersEncoded"],e=0,c=b.length;e<c;e++){var f=b[e],g=f.toLowerCase(),h;for(h in a){var m=h.toLowerCase();if(g===m){K(a,h,f,d);break a}}}if("extent"in a)return D(a,d);if("center"in a)return C(a,d);if("marker"in a)return y(a,d);if("find"in a)p.publish("publishData","framework","framework",{searchString:a.find},!0);else if("query"in a)return G(a,d)}}})},"jimu/shareUtils":function(){define("dojo/_base/lang esri/request dojo/promise/all jimu/shared/basePortalUrlUtils dojo/Deferred esri/lang jimu/portalUtils jimu/Role jimu/utils esri/urlUtils".split(" "),
function(r,f,l,p,c,q,n,k,h,t){var e={getBaseHrefUrl:function(b){var e="HTML3D"===window.appInfo.appType?"webappviewer3d":"webappviewer",a="";window.isXT?a=window.location.protocol+"//"+window.location.host+window.appInfo.appPath:(a=h.urlToObject(window.location.href).query||{},a=a.appid?b+"apps/"+e+"/index.html?appid\x3d"+a.appid:a.id?b+"apps/"+e+"/index.html?id\x3d"+a.id:h.getAppHref());return a},addQueryParamToUrl:function(b,e,a,c){b=t.urlToObject(b);b.query||(b.query={});b.query[e]=a;e=b.path;
for(var d in b.query)a=b.query[d],!0===c&&(a=encodeURIComponent(a)),e=e===b.path?e+"?"+d+"\x3d"+a:e+"\x26"+d+"\x3d"+a;return e},getQueryParamFromUrl:function(b,e){b=t.urlToObject(b);b.query||(b.query={});return b.query[e]},removeQueryParamFromUrl:function(b,e,a){b=t.urlToObject(b);b.query&&delete b.query[e];e=b.path;for(var c in b.query){var d=b.query[c];!0===a&&(d=encodeURIComponent(d));e=e===b.path?e+"?"+c+"\x3d"+d:e+"\x26"+c+"\x3d"+d}return e},getShareUrlContent:function(b){return"\x3cdiv class\x3d'marker-feature-action-popup'\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title jimu-float-leading'\x3e"+
window.jimuNls.common.url+"\x3c/span\x3e\x3cinput type\x3d'text' class\x3d'jimu-float-leading' readonly\x3d'readonly' value\x3d"+b+"\x3e\x3c/input\x3e\x3c/div\x3e\x3c/div\x3e"},getShareUrl:function(b,c,a){var f=e.getBaseHrefUrl(window.portalUrl),d="",h,m,k,n,l;c&&(c.longitude&&c.latitude?(h=c.longitude,m=c.latitude,d=c.longitude+","+c.latitude+","):c.x&&c.y&&c.spatialReference&&c.spatialReference.wkid&&(k=c.x,n=c.y,l=c.spatialReference.wkid,d=c.x+","+c.y+","+c.spatialReference.wkid));f=e.addQueryParamToUrl(f,
"marker",d,!0);f=e.addQueryParamToUrl(f+",,,","markertemplate",encodeURIComponent(JSON.stringify({title:c.title,x:k,y:n,wkid:l,longitude:h,latitude:m,isIncludeShareUrl:a})));c=b.getLevel();return f="number"===typeof c&&-1!==c?e.addQueryParamToUrl(f,"level",b.getLevel(),!0):e.addQueryParamToUrl(f,"scale",b.getScale(),!0)},getXyContent:function(b){var e="\x3cdiv class\x3d'marker-feature-action-popup'\x3e";b.longitude&&b.latitude?e+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+
window.jimuNls.common.longitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+h.localizeNumber(parseFloat(b.longitude).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3e"+window.jimuNls.common.latitude+"\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+h.localizeNumber(parseFloat(b.latitude).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e":b.x&&b.y&&(e+="\x3cdiv class\x3d'item clearFix'\x3e\x3cspan class\x3d'sub-title'\x3ex\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+
h.localizeNumber(parseFloat(b.x).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'item'\x3e\x3cspan class\x3d'sub-title'\x3ey\x3c/span\x3e\x3cspan class\x3d'val'\x3e"+h.localizeNumber(parseFloat(b.y).toFixed(4))+"\x3c/span\x3e\x3c/div\x3e");return e+"\x3c/div\x3e"},_isUserOwnTheApp:function(b){return b&&b.username&&b.username===window.appInfo.appOwner?!0:!1},getItemByUserAndItemId:function(b,e,a,g){var d=new c;g=p.getStandardPortalUrl(g);g=g+"/sharing/rest/content/users/"+(e?e.username?e.username:
e.email:a.email);if(q.isDefined(b.folderId)&&"/"!==b.folderId||q.isDefined(b.ownerFolder)&&"/"!==b.ownerFolder)g+="/"+(b.folderId||b.ownerFolder);g+="/items/"+b.id;f({url:g,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(r.hitch(this,function(a){d.resolve(a)}),r.hitch(this,function(a){console.error(a);d.reject(a)}));return d},_getProfile:function(b,e){var a=new c;b=p.getUserUrl(e,b.owner);f({url:b,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(r.hitch(this,
function(b){a.resolve(b)}),r.hitch(this,function(b){console.error(b);a.reject(b)}));return a},_unshareItemById:function(b,e,a){var g=new c;a=p.getStandardPortalUrl(a);a+="/sharing/rest/content/items/"+e+"/unshare";e={f:"json"};e=r.mixin(e,b);f({url:a,handleAs:"json",content:e,callbackParamName:"callback"},{usePost:!0}).then(r.hitch(this,function(a){g.resolve(a)}),r.hitch(this,function(a){console.error(a);g.reject(a)}));return g},canSharePublic:function(b){return!b.selfUrl||!0!==b.canSharePublic&&
!1!==b.canSharePublic?!0:b.canSharePublic},unshareItemsByUser:function(b,e,a){var g=new c;a=p.getStandardPortalUrl(a);a+="/sharing/rest/content/users/"+b+"/unshareItems";b={f:"json"};b=r.mixin(b,e);f({url:a,handleAs:"json",content:b,callbackParamName:"callback"},{usePost:!0}).then(r.hitch(this,function(a){g.resolve(a)}),r.hitch(this,function(a){console.error(a);g.reject(a)}));return g},unshareItems:function(b,e,a){var g=new c;a=p.getStandardPortalUrl(a);a+="/sharing/rest/content/users/"+(e.owner||
b.email)+"/unshareItems";b={f:"json"};b=r.mixin(b,e);f({url:a,handleAs:"json",content:b,callbackParamName:"callback"},{usePost:!0}).then(r.hitch(this,function(a){g.resolve(a)}),r.hitch(this,function(a){console.error(a);g.reject(a)}));return g},shareItemsByUser:function(b,e,a){var g=new c;a=p.getStandardPortalUrl(a);a+="/sharing/rest/content/users/"+b+"/shareItems";b={f:"json"};b=r.mixin(b,e);f({url:a,handleAs:"json",content:b,callbackParamName:"callback"},{usePost:!0}).then(r.hitch(this,function(a){g.resolve(a)}),
r.hitch(this,function(a){console.error(a);g.reject(a)}));return g},shareItems:function(b,e,a){var g=new c;a=p.getStandardPortalUrl(a);a+="/sharing/rest/content/users/"+(e.owner||b.email)+"/shareItems";b={f:"json"};b=r.mixin(b,e);f({url:a,handleAs:"json",content:b,callbackParamName:"callback"},{usePost:!0}).then(r.hitch(this,function(a){g.resolve(a)}),r.hitch(this,function(a){console.error(a);g.reject(a)}));return g},getItemsGroups:function(b,e){var a=new c;e=p.getStandardPortalUrl(e);e+="/sharing/rest/content/items/"+
b.id+"/groups";f({url:e,handleAs:"json",content:{f:"json"},callbackParamName:"callback"},{usePost:!0}).then(r.hitch(this,function(b){a.resolve(b)}),r.hitch(this,function(b){console.error(b);a.reject(b)}));return a},isSharedToPublic:function(b){return window.isXT?!1:null===b?!0:"undefined"!==typeof b&&"undefined"!==typeof b.item&&"undefined"!==typeof b.item.access&&"public"===b.item.access?!0:!1},isShowSocialMediaLinks:function(b){return window.isXT?!0:null===b?!0:"undefined"!==typeof b&&"undefined"!==
typeof b.item&&"undefined"!==typeof b.item.access&&"private"===b.item.access?!1:!0},getItemShareInfo:function(b){var e=new c,a="";if(window.isXT)return e.resolve(null);a=h.urlToObject(h.getAppHref()).query||{};a=a.id||a.appid;if("undefined"===typeof a||""===a)return e.resolve(null);n.getPortal(b).getItemById(a).then(r.hitch(this,function(a){var d={};d.item=a;d.item&&"undefined"===typeof d.item.sharing&&d.item.access&&(d.item.sharing={access:d.item.access});e.resolve(d)}),r.hitch(this,function(a){console.log(a);
e.resolve(null)}));return e},getShareInfo:function(b){var f=n.getPortal(b),a=new c,g="";if(window.isXT)return a.resolve(null);g=h.urlToObject(h.getAppHref()).query||{};g=g.id||g.appid;if("undefined"===typeof g||""===g)return a.resolve(null);l({getUser:f.getUser(),loadSelfInfo:f.loadSelfInfo(),getItem:f.getItemById(g)}).then(r.hitch(this,function(d){var c={};c.item=d.getItem;c.item&&c.item.ownerFolder&&c.item.ownerFolder.length&&"/"!==c.item.ownerFolder&&(c.item.folderId=c.item.ownerFolder);"undefined"===
typeof c.item.sharing&&c.item.access&&(c.item.sharing={access:c.item.access});c.user=d.getUser;e._setUserRole(d.loadSelfInfo,c);c.currentUser=c.user;c.isAdmin=!1;c.userRole&&(c.userRole.isAdmin()||c.userRole.isCustom()&&c.userRole.canUpdateOrgItems())?(c.isAdmin=!0,c.item.owner!==c.currentUser.name?e._getProfile(c.item,b).then(r.hitch(this,function(d){c.itemUser=d;c.itemUser.orgId!==c.currentUser.orgId&&(c.isAdmin=!1);a.resolve(c)})):(c.itemUser=c.currentUser,a.resolve(c))):(c.currentUser&&(c.itemUser=
c.currentUser),a.resolve(c))}),r.hitch(this,function(d){console.log(d);a.resolve(null)}));return a},_setUserRole:function(b,e){e.userPortalUrl=b.urlKey?b.urlKey+"."+b.customBaseUrl:this.portalUrl;!b||b.code||b.message||(e.organization=b);if(b&&b.user)e.userRole=new k({id:b.user.roleId?b.user.roleId:b.user.role,role:b.user.role}),e._isCustomRole=e.userRole.isCustom(),e._roleCanShareToGroup=e._isCustomRole&&e.userRole.canShareItemToGroup(),e._roleCanShareToOrg=e._isCustomRole&&e.userRole.canShareItemToOrg(),
e._roleCanSharePublic=e._isCustomRole&&e.userRole.canShareItemToPublic(),e._roleCanShare=e._roleCanShareToGroup||e._roleCanShareToOrg||e._roleCanShareToPublic,e._roleCanUpdateItems=e._isCustomRole&&e.userRole.canUpdateOrgItems(),e._roleCanShareOthersItemsToGroup=e._isCustomRole&&e.userRole.canShareOthersItemsToGroup(),e._roleCanShareOthersItemsToOrg=e._isCustomRole&&e.userRole.canShareOthersItemsToOrg(),e._roleCanShareOthersItemsToPublic=e._isCustomRole&&e.userRole.canShareOthersItemsToPublic(),e._roleCanShareOthersItems=
e._isCustomRole&&(e.userRole.canShareOthersItemsToGroup()||e.userRole.canShareOthersItemsToOrg()||e._roleCanShareOthersItemsToPublic),e._orgUserCanSharePublicOrOverride=e.organization&&(!0===e.organization.canSharePublic&&(!e._isCustomRole||e._roleCanSharePublic||e._roleCanShareOthersItemsToPublic)||e.userRole.isAdmin());else return!1},getItemById:function(b,e){var a=new c;e=p.getStandardPortalUrl(e);e+="/sharing/rest/content/items/"+b.id;f({url:e,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(r.hitch(this,
function(b){a.resolve(b)}),r.hitch(this,function(b){console.error(b);a.reject(b)}));return a},disableWebMapPopup:function(b){b&&b.setInfoWindowOnClick&&b.setInfoWindowOnClick(!1)},enableWebMapPopup:function(b){b&&b.setInfoWindowOnClick&&b.setInfoWindowOnClick(!0)}};return e})},"jimu/PopupManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred dojo/topic dojo/on dojo/query ./FeatureActionManager ./utils ./dijit/FeatureActionPopupMenu ./RelatedRecordsPopupProjector ./LayerInfos/LayerInfos".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b){var m=null,a=r(null,{mapManager:null,popupUnion:null,_relatedRecordsPopupProjector:null,constructor:function(a){f.mixin(this,a);this.popupMenu=t.getInstance();this.isInited=!1;this.featureActionManager=k.getInstance();c.subscribe("mapLoaded",f.hitch(this,this.onMapLoadedOrChanged));c.subscribe("mapChanged",f.hitch(this,this.onMapLoadedOrChanged));c.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged));c.subscribe("widgetsActionsRegistered",f.hitch(this,
this._onWidgetsActionsRegistered))},init:function(){this.popupUnion=this.mapManager.getMapInfoWindow();this.popupUnion.bigScreen&&this.popupUnion.mobile&&this.popupUnion.bigScreen.domNode&&this.popupUnion.mobile.domNode&&!this.isInited&&(this._createPopupMenuButton(),this._bindSelectionChangeEvent(),this.isInited=!0)},_createPopupMenuButton:function(){this.popupMenuButtonDesktop&&l.destroy(this.popupMenuButtonDesktop);this.popupMenuButtonMobile&&l.destroy(this.popupMenuButtonMobile);this.popupMenuButtonDesktop=
l.create("span",{"class":"popup-menu-button"},n(".actionList",this.popupUnion.bigScreen.domNode)[0]);var a=n("div.esriMobileInfoView.esriMobilePopupInfoView .esriMobileInfoViewItem").parent()[0],a=l.create("div",{"class":"esriMobileInfoViewItem"},a);this.popupMenuButtonMobile=l.create("span",{"class":"popup-menu-button"},a);q(this.popupMenuButtonMobile,"click",f.hitch(this,this._onPopupMenuButtonClick));q(this.popupMenuButtonDesktop,"click",f.hitch(this,this._onPopupMenuButtonClick))},_onPopupMenuButtonClick:function(a){a=
l.position(a.target);this.menuActionsOfSelectedFeature&&this.popupMenu.setActions(this.menuActionsOfSelectedFeature);this.popupMenu.show(a)},_bindSelectionChangeEvent:function(){q(this.popupUnion.bigScreen,"selection-change",f.hitch(this,this._onSelectionChange));q(this.popupUnion.mobile,"selection-change",f.hitch(this,this._onSelectionChange))},_onSelectionChange:function(a){(this.selectedFeature=a.target.getSelectedFeature())?(this.initPopupMenu([this.selectedFeature]),a=this.selectedFeature.getLayer(),
(this.selectedFeature.infoTemplate||a&&a.infoTemplate)&&this._createRelatedRecordsPopupProjector(this.selectedFeature)):this._disablePopupMenu()},_disablePopupMenu:function(){l.addClass(this.popupMenuButtonDesktop,"disabled");l.addClass(this.popupMenuButtonMobile,"disabled")},_enablePopupMenu:function(){l.removeClass(this.popupMenuButtonDesktop,"disabled");l.removeClass(this.popupMenuButtonMobile,"disabled")},convertFeatures:function(a){var d=new p,e=b.getInstanceSync(),c=a&&a[0]&&a[0].getLayer();
(e=e.getLayerInfoById(c&&c.id))?d=e.getMSShipFeatures(a):d.resolve(null);return d},initPopupMenu:function(a){a?this.convertFeatures(a).then(f.hitch(this,function(d){var b=h.toFeatureSet(d||a);this.featureActionManager.getSupportedActions(b).then(f.hitch(this,function(a){var d="ZoomTo ShowPopup Flash ExportToCSV ExportToFeatureCollection ExportToGeoJSON ShowRelatedRecords SaveToMyContent CreateLayer".split(" ");a=a.filter(f.hitch(this,function(a){return 0>d.indexOf(a.name)}));0===a.length?this._disablePopupMenu():
this._enablePopupMenu();this.menuActionsOfSelectedFeature=a=a.map(f.hitch(this,function(a){a.data=b;return a}));this.popupMenu.setActions(a)}))})):(this._disablePopupMenu(),this.popupMenu.setActions([]))},onMapLoadedOrChanged:function(){this.isInited=!1;this.init()},_onAppConfigChanged:function(){this.popupUnion&&(this.popupUnion.bigScreen&&this.popupUnion.bigScreen.hide&&(this.popupUnion.bigScreen.hide(),this.popupMenu.hide()),this.popupUnion.mobile&&this.popupUnion.mobile.hide&&(this.popupUnion.mobile.hide(),
this.popupMenu.hide()))},_onWidgetsActionsRegistered:function(){this.init()},_createRelatedRecordsPopupProjector:function(a){try{this._relatedRecordsPopupProjector&&this._relatedRecordsPopupProjector.domNode&&(this._relatedRecordsPopupProjector.destroy(),this._relatedRecordsPopupProjector=null),this._relatedRecordsPopupProjector=new e({originalFeature:a,popup:this.mapManager.map.infoWindow,popupManager:this})}catch(d){console.warn(d.message)}}});a.getInstance=function(b){null===m&&(m=new a({mapManager:b}));
return m};return a})},"jimu/FeatureActionManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dojo/Deferred dojo/promise/all ./featureActions/main ./utils".split(" "),function(r,f,l,p,c,q,n,k){var h=null,t=r(null,{constructor:function(){this._actions=[];window.isBuilder?(p.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),p.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(p.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),p.subscribe("mapChanged",
f.hitch(this,this._onMapChanged)));window.isBuilder?(p.subscribe("app/appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),p.subscribe("app/appConfigChanged",f.hitch(this,this._onAppConfigChanged))):(p.subscribe("appConfigLoaded",f.hitch(this,this._onAppConfigLoaded)),p.subscribe("appConfigChanged",f.hitch(this,this._onAppConfigChanged)));this._registerFrameworkActions()},getAllActions:function(){return this._actions},getSupportedActions:function(e){e=this._getFeatureSet(e);var b=[];l.forEach(this._actions,
function(c){var a=this.testActionSupportFeature(c,e);a.action=c;b.push(a)},this);return q(b).then(f.hitch(this,function(b){return b.map(f.hitch(this,function(a,b){return{result:a,action:this._actions[b]}})).filter(function(a){return a.result}).map(function(a){return a.action})}))},testActionSupportFeature:function(e,b){b=this._getFeatureSet(b);var f;b.features&&0<b.features.length&&(f=b.features[0].getLayer());e=e.isFeatureSupported(b,f);var a=new c;e&&"function"===typeof e.then?e.then(function(b){a.resolve(b)},
function(b){console.error(b);a.resolve(!1)}):a.resolve(e);return a},registerAction:function(e){var b=new c;require([e.uri],f.hitch(this,function(c){var a=new c({map:this.map,appConfig:this.appConfig,label:e.label,name:e.name,widgetId:e.widgetId});l.some(this._actions,function(b){return a.name===b.name&&a.widgetId===b.widgetId})?(console.warn("Feature/FeatureSet action has been registered.",a.name),b.reject("Feature/FeatureSet action has been registered.",a.name)):(this._actions.push(a),b.resolve(a))}));
return b},removeActionsByWidgetId:function(e){this._actions=l.filter(this._actions,function(b){return b.widgetId!==e},this)},getActionsByWidgetId:function(e){return l.filter(this._actions,function(b){return b.widgetId===e},this)},getActionsByActionName:function(e){return l.filter(this._actions,function(b){return b.name===e},this)},registerWidgetFeatureActions:function(e){var b=new c;if(!e.featureActions||!e.uri)return b.resolve(),b;var f=[];l.forEach(e.featureActions,function(a){f.push(this.registerAction({uri:e.isRemote?
e.amdFolder+a.uri+".js":e.amdFolder+a.uri,widgetId:e.id,name:a.name,label:e.manifest["i18nLabels_featureAction_"+a.name][window.dojoConfig.locale]||e.manifest["i18nLabels_featureAction_"+a.name].defaultLabel}))},this);return q(f)},registerAllWidgetFeatureActions:function(e){var b=[];e.visitElement(f.hitch(this,function(e){e.uri&&e.visible&&b.push(this.registerWidgetFeatureActions(e))}));return q(b).then(function(){p.publish("widgetsActionsRegistered")})},_reRegisterWidgetActions:function(e){var b=
[];l.forEach(this.getAllActions(),function(b){var a=e.getConfigElementById(b.widgetId);"framework"===b.widgetId||a&&a.uri&&!1!==a.visible||this.removeActionsByWidgetId(b.widgetId)},this);e.visitElement(f.hitch(this,function(e){e.uri&&e.visible&&0===this.getActionsByWidgetId(e.id).length&&b.push(this.registerWidgetFeatureActions(e))}));0<b.length&&q(b).then(function(){p.publish("widgetsActionsRegistered")})},_registerFrameworkActions:function(){l.forEach(n,function(e){this.registerAction({uri:e.uri,
widgetId:"framework",label:window.jimuNls.featureActions[e.name],name:e.name})},this)},_getFeatureSet:function(e){return"[object Object]"===Object.prototype.toString.call(e)?e.features?e:k.toFeatureSet([e]):k.toFeatureSet(e)},_onAppConfigLoaded:function(e){this.appConfig=e=f.clone(e);this._setActionsAppConfig(e);this.registerAllWidgetFeatureActions(this.appConfig)},_onAppConfigChanged:function(e){this.appConfig=e=f.clone(e);this._reRegisterWidgetActions(this.appConfig);this._setActionsAppConfig(e)},
_onMapLoaded:function(e){this.map=e;this._setActionsMap(e)},_onMapChanged:function(e){this.map=e;this._setActionsMap(e)},_setActionsMap:function(e){l.forEach(this._actions,function(b){b.setMap(e)},this)},_setActionsAppConfig:function(e){l.forEach(this._actions,function(b){b.setAppConfig(e)},this)}});t.getInstance=function(){null===h&&(h=new t,window._featureActionManager=h);return h};return t})},"jimu/featureActions/main":function(){define("./ZoomTo ./PanTo ./Flash ./ShowPopup ./ExportToCSV ./ExportToFeatureCollection ./ExportToGeoJSON ./ShowStatistics ./CreateLayer ./AddMarker ./RemoveMarker ./SaveToMyContent".split(" "),
function(){return[{name:"ZoomTo",uri:"jimu/featureActions/ZoomTo"},{name:"PanTo",uri:"jimu/featureActions/PanTo"},{name:"Flash",uri:"jimu/featureActions/Flash"},{name:"ShowPopup",uri:"jimu/featureActions/ShowPopup"},{name:"ExportToCSV",uri:"jimu/featureActions/ExportToCSV"},{name:"ExportToFeatureCollection",uri:"jimu/featureActions/ExportToFeatureCollection"},{name:"ExportToGeoJSON",uri:"jimu/featureActions/ExportToGeoJSON"},{name:"ShowStatistics",uri:"jimu/featureActions/ShowStatistics"},{name:"CreateLayer",
uri:"jimu/featureActions/CreateLayer"},{name:"AddMarker",uri:"jimu/featureActions/AddMarker"},{name:"RemoveMarker",uri:"jimu/featureActions/RemoveMarker"},{name:"SaveToMyContent",uri:"jimu/featureActions/SaveToMyContent"}]})},"jimu/featureActions/ZoomTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(r,f,l){return r(f,{name:"ZoomTo",iconClass:"icon-zoomto",isFeatureSupported:function(f){return 0<f.features.length&&f.features[0].geometry},onExecute:function(f){l.featureAction.zoomTo(this.map,
f.features)}})})},"jimu/BaseFeatureAction":function(){define(["dojo/_base/declare","dojo/_base/lang"],function(r,f){return r(null,{name:void 0,label:void 0,iconFormat:"svg",iconClass:"",map:null,appConfig:{},widgetId:null,constructor:function(l){f.mixin(this,l)},isFeatureSupported:function(f,p){return!0},onExecute:function(f,p){},setMap:function(f){this.map=f},setAppConfig:function(f){this.appConfig=f},getIcon:function(f){return"framework"===this.widgetId?require.toUrl("jimu")+"/images/feature_actions/"+
this.name+"_"+f+"."+this.iconFormat:this.appConfig.getConfigElementById(this.widgetId).folderUrl+"images/"+this.name+"_"+f+"."+this.iconFormat}})})},"jimu/featureActions/PanTo":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(r,f,l){return r(f,{name:"PanTo",iconClass:"icon-panto",isFeatureSupported:function(f){return 0<f.features.length&&f.geometryType},onExecute:function(f){l.featureAction.panTo(this.map,f.features)}})})},"jimu/featureActions/Flash":function(){define(["dojo/_base/declare",
"dojo/_base/lang","../BaseFeatureAction","jimu/utils"],function(r,f,l,p){return r([l],{name:"Flash",iconClass:"icon-flash",isFeatureSupported:function(c,l){if(1>c.features.length||!l)return!1;c=c.features[0];var n=f.getObject("renderer.symbol",!1,l);return c&&c.geometry&&(c.symbol||n)&&this.map.getLayer(l.id)},onExecute:function(c,f){p.featureAction.flash(c&&c.features,f)}})})},"jimu/featureActions/ShowPopup":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/utils"],function(r,
f,l){return r([f],{name:"ShowPopup",iconClass:"icon-show-popup",isFeatureSupported:function(f,c){return f&&f.features&&1===f.features.length&&c&&c.infoTemplate},onExecute:function(f){l.featureAction.showPopup(this.map,f.features)}})})},"jimu/featureActions/ExportToCSV":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(r,f,l){return r(f,{name:"ExportToCSV",iconClass:"icon-export",isFeatureSupported:function(f){return 0<f.features.length},onExecute:function(f){f=
l.createDataSource({type:l.TYPE_FEATURESET,filename:"features",data:f});f.setFormat(l.FORMAT_CSV);f.download()}})})},"jimu/exportUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/graphic esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils jimu/LayerInfos/LayerInfos ./utils ./CSVUtils ./GeojsonConverters libs/polyfills/FileSaver".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u){function v(a,d){10>dojo.isIE?saveTextAs(d,a,"utf-8"):(d=new Blob([d],{type:"text/plain;charset\x3dutf-8"}),saveAs(d,a,!0))}var B={createDataSource:function(a){return new z(a)},TYPE_TABLE:"table",TYPE_FEATURESET:"FeatureSet",FORMAT_CSV:"CSV",FORMAT_FEATURESET:"FeatureSet",FORMAT_GEOJSON:"GeoJSON"},z=r(null,{filename:void 0,format:void 0,nls:void 0,data:null,url:null,constructor:function(a){this.nls=window.jimuNls.exportTo;this.data=a.data;this.url=a.url;
this.filename=a.filename},setFormat:function(a){this.format=a},download:function(){if(this.format===B.FORMAT_CSV)return this.exportCSV();if(this.format===B.FORMAT_FEATURESET)return this.exportFeatureCollection();if(this.format===B.FORMAT_GEOJSON)return this.exportGeoJSON()},getFeatureSet:function(){var a=new c;if(this.data)a.resolve(this.data);else if(this.url){var d=new q;d.returnGeometry=!0;d.outFields=["*"];this.queryTask=new n(this.url);this.queryTask.execute(d,f.hitch(this,function(d){a.resolve(d)}),
f.hitch(this,function(){a.resolve(null)}))}else a.resolve(null);return a},findPopupInfo:function(d){if(!d||!d.features||0===d.features.length)return null;d=d.features[0];if(d._layer&&(d=d._layer.id,d=a.getInstanceSync().getLayerInfoById(d))){var b=d.getPopupInfo();b||(b=d.layerObject.infoTemplate&&d.layerObject.infoTemplate.info);return b}return null},findLayerDefinition:function(a){if(!a||!a.features||0===a.features.length)return null;var d=a.features[0];if(d._layer)return{geometryType:a.geometryType,
fields:d._layer.fields};var b=[],d=d.attributes,e;for(e in d)d.hasOwnProperty(e)&&b.push({name:e});return{geometryType:a.geometryType,fields:b}},formatAttributes:function(a){var b=new c,e=this.findPopupInfo(a),g=this.findLayerDefinition(a);if(e&&g){var m=l.map(a.features,function(a){return a.attributes});d._formattedData(a.features[0]._layer,{data:m,outFields:g.fields},{formatNumber:!0,formatDate:!0,formatCodedValue:!0,popupInfo:e,richText:{}}).then(f.hitch(this,function(d){var e=d.datas;d=new k;
var c=[];l.forEach(a.features,function(a,d){a=new h(a.toJson());a.attributes=e[d];c.push(a)});d.features=c;d.geometryType=a.geometryType;d.fieldAliases=a.fieldAliases;d.fields=a.fields;b.resolve(d)}))}else b.resolve(a);return b},exportCSV:function(){return this.getFeatureSet().then(f.hitch(this,function(a){var b=this.findPopupInfo(a),e=this.findLayerDefinition(a),c=a.features;if(e&&e.fields){var g=f.clone(e.fields);this._addXYAttribute(g,"x");this._addXYAttribute(g,"y");e.fields=g;c=[];l.forEach(a.features,
f.hitch(this,function(a){a=new h(a.toJson());a.attributes=this._getAttrsWithXY(a);c.push(a)}))}return d.exportCSVByGraphics(this.filename,e,c,{formatNumber:!0,formatDate:!0,formatCodedValue:!0,popupInfo:b})}))},exportGeoJSON:function(){return this.getFeatureSet().then(f.hitch(this,function(a){return this.formatAttributes(a)})).then(f.hitch(this,function(a){return this._projectToWGS84(a)})).then(f.hitch(this,function(a){var d="";if(a&&a.features&&0<a.features.length){var b={type:"FeatureCollection",
features:[]};l.forEach(a.features,function(a){b.features.push(u.arcgisToGeoJSON(a))});d=p.stringify(b)}return d})).then(f.hitch(this,function(a){v(this.filename+".geojson",a)}))},exportFeatureCollection:function(){return this.getFeatureSet().then(f.hitch(this,function(a){return this.formatAttributes(a)})).then(f.hitch(this,function(a){var d="";a&&(a=a.toJson())&&(d=p.stringify(a));return d})).then(f.hitch(this,function(a){v(this.filename+".json",a)}))},exportToPortal:function(a,d){},_projectToWGS84:function(a){var d=
new c,f=this._getSpatialReference(a);if(f)if(4326===parseInt(f.wkid,10))d.resolve(a);else if(f.isWebMercator()){var f=new k,u=[];l.forEach(a.features,function(a){var d=new h(a.toJson());d.geometry=m.webMercatorToGeographic(a.geometry);u.push(d)});f.features=u;f.geometryType=a.geometryType;f.fieldAliases=a.fieldAliases;f.fields=a.fields;d.resolve(f)}else{f=new e;f.geometries=l.map(a.features,function(a){return a.geometry});f.outSR=new t(4326);var n=b&&b.defaults&&b.defaults.geometryService;n&&"esri.tasks.GeometryService"===
n.declaredClass||(n=g.getArcGISDefaultGeometryService());n.project(f).then(function(b){var e=new k,c=[];l.forEach(a.features,function(a,d){a=new h(a.toJson());a.geometry=b[d];c.push(a)});e.features=c;e.geometryType=a.geometryType;e.fieldAliases=a.fieldAliases;e.fields=a.fields;d.resolve(e)},function(a){console.error(a);d.resolve([])})}else d.resolve([]);return d},_getSpatialReference:function(a){if(a.spatialReference)return a.spatialReference;var d;l.some(a.features,function(a){if(a.geometry&&a.geometry.spatialReference)return d=
a.geometry.spatialReference,!0});return d},_getAttrsWithXY:function(a){var d=a.geometry;return d&&"point"===d.type?(a=f.clone(a.attributes),"x"in a?a._x=d.x:a.x=d.x,"y"in a?a._y=d.y:a.y=d.y,a):a.attributes},_addXYAttribute:function(a,d){var b;b=l.some(a,function(a){return a.name===d})?"_"+d:d;a.push({name:b,alias:b,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});return a}});return B})},"jimu/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/kernel dojo/has dojo/number dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query esri/graphic jimu/ArcadeUtils".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a){function g(a){var d=f.clone(a.attributes);(a=a.geometry)&&"point"===a.type&&("x"in d?d._x=a.x:d.x=a.x,"y"in d?d._y=a.y:d.y=a.y);return d}r.exportCSV=function(a,b,e){return r._createCSVStr(b,e).then(function(d){return r._download(a+".csv",d)})};r.exportCSVFromFeatureLayer=function(a,b,e){e=e||{};return r._getExportData(b,{datas:e.datas,objectIds:e.objectIds,fromClient:e.fromClient,withGeometry:e.withGeometry,outFields:e.outFields,filterExpression:e.filterExpression,
outSpatialReference:e.outSpatialReference,arcadeExpressions:e.arcadeExpressions,geometry:e.geometry,orderByFields:e.orderByFields,start:e.start,num:e.num}).then(function(d){return r._formattedData(b,d,{formatNumber:e.formatNumber,formatDate:e.formatDate,formatCodedValue:e.formatCodedValue,richText:{clearFormat:e.richTextFieldsToClear&&!!e.richTextFieldsToClear.length,fieldsToClear:e.richTextFieldsToClear||[]},popupInfo:e.popupInfo}).then(function(d){return r.exportCSV(a,d.datas,d.columns)})})};r.exportCSVByAttributes=
function(a,b,e,c){c=f.mixin({},c);c.datas=e;return r.exportCSVFromFeatureLayer(a,b,c)};r.exportCSVByGraphics=function(a,b,e,c){e=l.map(e,function(a){return a.attributes});return r.exportCSVByAttributes(a,b,e,c)};r._createCSVStr=function(a,b){var d=new k,e="",f=0,g=0,h="",m="",u=","===n.format(1.1,{locale:c.locale}).substring(1,2)?";":",";try{b=l.map(b,function(a){return"string"===typeof a?{name:a}:a});l.forEach(b,function(a){a=a.alias||a.name;-1<a.toString().indexOf(u)&&(a='"'+a+'"');e=e+h+a;h=u});
for(var e=e+"\r\n",f=a.length,g=b.length,t=0;t<f;t++){for(var h="",p=0;p<g;p++){(m=a[t][b[p].name])||"number"===typeof m||(m="");if("string"===typeof m){var q=!1;(q=";"===u?/[";\r\n]/g.test(m):/[",\r\n]/g.test(m))&&(m='"'+m.replace(/(")/g,'""')+'"')}e=e+h+m;h=u}e+="\r\n"}d.resolve(e)}catch(F){console.error(F),d.resolve("")}return d};r._isIE11=function(){return 11===h.has("ie")};r._isEdge=function(){return h.has("edge")};r._getDownloadUrl=function(a){return window.Blob&&window.URL&&window.URL.createObjectURL?
(a=new Blob(["\ufeff"+a],{type:"text/csv"}),URL.createObjectURL(a)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(a)};r._download=function(a,b){var d=new k;try{if(q("ie")&&10>q("ie")){var e=window.top.open("about:blank","_blank");e.document.write("sep\x3d,\r\n"+b);e.document.close();e.document.execCommand("SaveAs",!0,a);e.close()}else if(10===q("ie")||r._isIE11()||r._isEdge()){var c=new Blob(["\ufeff"+b],{type:"text/csv"});navigator.msSaveBlob(c,a)}else{var f=p.create("a",{href:r._getDownloadUrl(b),
target:"_blank",download:a},document.body);if(q("safari")){var g=document.createEvent("MouseEvents");g.initEvent("click",!0,!0);f.dispatchEvent(g)}else f.click();p.destroy(f)}d.resolve()}catch(y){d.reject(y)}return d};r._getExportData=function(a,b){var d=new k,e=null,c=[],h=b.datas,m=b.withGeometry,u=!!b.arcadeExpressions,e=b.outFields;e&&e.length||(e=a.fields);e=f.clone(e);if(m&&!(h&&0<h.length)){u?(c=l.filter(a.fields,function(a){return-1===a.name.indexOf("expression/")}),c=f.clone(c)):c=f.clone(e);
var n="",n=-1!==e.indexOf("x")?"_x":"x";e.push({name:n,alias:n,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"});n=-1!==e.indexOf("y")?"_y":"y";e.push({name:n,alias:n,format:{digitSeparator:!1,places:6},show:!0,type:"esriFieldTypeDouble"})}h&&0<h.length?(u&&(h=r._getAttrsWithExpressionsBatch(h,b.arcadeExpressions)),d.resolve({data:h||[],outFields:e})):b.fromClient?(h=l.map(a.graphics,function(a){a=m?g(a):f.clone(a);return a=u?r._getAttrsWithExpressions(a,b.arcadeExpressions):
a}),d.resolve({data:h||[],outFields:e})):r._getExportDataFromServer(a,c,b).then(function(a){u&&(a=r._getAttrsWithExpressionsBatch(a,b.arcadeExpressions));d.resolve({data:a||[],outFields:e})});return d};r._getExportDataFromServer=function(a,c,f){var d=new k;if("esri.layers.FeatureLayer"!==a.declaredClass)return d.resolve([]),d;var h=new e(a.url),m=new b;m.where=f.filterExpression||a.getDefinitionExpression&&a.getDefinitionExpression()||"1\x3d1";0<c.length?(a=l.map(c,function(a){return a.name}),m.outFields=
a):m.outFields=["*"];m.objectIds=f.objectIds;m.returnGeometry=f.withGeometry;m.outSR=f.spatialReference;m.geometry=f.geometry;m.orderByFields=f.orderByFields;m.start=f.start;m.num=f.num;h.execute(m,function(a){a=l.map(a.features,function(a){return g(a)});d.resolve(a)},function(a){console.error(a);d.resolve([])});return d};r._formattedData=function(a,b,e){var d=new k,c=[],f=b.data;b=b.outFields;for(var g=0,h=f.length;g<h;g++){for(var m={},u=0;u<b.length;u++){var n=b[u];m[n.name]=r._getExportValue(f[g][n.name],
n,a.objectIdField,a.typeIdField,f[g][a.typeIdField],a.types,e)}c.push(m)}a=l.map(b,function(a){return{alias:a.alias,name:a.name}});d.resolve({datas:c,columns:a});return d};r._getExportValue=function(a,b,e,c,f,g,m){function d(a){if(u&&t.isDefined(u.fieldInfos))for(var d=0,b=u.fieldInfos.length;d<b;d++){var e=u.fieldInfos[d];if(e.fieldName===a)return e.format}return null}function k(a){for(var d=0,b=n.length;d<b;d++)if(n[d].fieldName===a)return!0;return!1}var u=m.popupInfo,n=m.richText.fieldsToClear,
p=!!b.domain&&m.formatCodedValue,q="esriFieldTypeDate"===b.type&&m.formatDate,v=e&&b.name===e;c=c&&b.name===c;k="esriFieldTypeString"===b.type&&m.richText.clearFormat&&k(b.name);return q?h.fieldFormatter.getFormattedDate(a,d(b.name)):c?h.fieldFormatter.getTypeName(a,g):p?h.fieldFormatter.getCodedValue(b.domain,a):k?a?(b=document.createElement("span"),b.innerHTML=a,b.textContent||b.innerText||""):a:p||q||v||c||k?a:(m=null,e&&g&&0<g.length&&(e=(e=l.filter(g,function(a){return a.id===f}))&&e[0])&&e.domains&&
e.domains[b.name]&&e.domains[b.name].codedValues&&(m=h.fieldFormatter.getCodedValue(e.domains[b.name],a)),null!==m?m:a)};r._getAttrsWithExpressions=function(d,b){var e=f.getObject("expressionInfos",!1,b);b=f.getObject("layerDefinition",!1,b);var c=new m(null,null,d);return a.customExpr.getAttributesFromCustomArcadeExpr(e,c,b)||d};r._getAttrsWithExpressionsBatch=function(a,b){var d=[];return d=l.map(a,function(a){return r._getAttrsWithExpressions(a,b)})}})},"jimu/ArcadeUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/string esri/arcade/arcade esri/arcade/Feature esri/tasks/RelationshipQuery jimu/utils jimu/LayerStructure".split(" "),
function(r,f,l,p,c,q,n,k,h,t){var e={readExprInfo:{}};e.readExprInfo.getArcadeProfilesByType=function(b,c,a){b={map:b,layer:c};return"render"===a?e.readExprInfo._getArcadeRender(b):"label"===a?e.readExprInfo._getArcadeLabel(b):"infoTemplate"===a?e.readExprInfo._getArcadeInfoTemplate(b):e.readExprInfo._getAllArcade(b)};e.readExprInfo._getArcadeRender=function(b){return e.readExprInfo._lookupArcadeRender({layers:e.readExprInfo._checkPassInLayer(b)})};e.readExprInfo._getArcadeInfoTemplate=function(b){return e.readExprInfo._lookupArcadeInfoTemplate({layers:e.readExprInfo._checkPassInLayer(b)})};
e.readExprInfo._getArcadeLabel=function(b){return e.readExprInfo._lookupArcadeLabel({layers:e.readExprInfo._checkPassInLayer(b)})};e.readExprInfo._getAllArcade=function(b){var c=e.readExprInfo._getArcadeRender(b),a=e.readExprInfo._getArcadeInfoTemplate(b);b=e.readExprInfo._getArcadeLabel(b);return{render:c,infoTemplate:a,label:b}};e.readExprInfo._checkPassInLayer=function(b){var c=[];return c="undefined"!==typeof b?"undefined"!==typeof b.layer?null!==b.layer&&""!==b.layer?e.readExprInfo._getAllMapLayers(b):
e.readExprInfo._getAllMapLayers():e.readExprInfo._getAllMapLayers():e.readExprInfo._getAllMapLayers()};e.readExprInfo._getAllMapLayers=function(b){var e="",a=[],c=t.getInstance();b&&b.layer&&(e=b.layer.id);""!==e?(b=c.getNodeById(e))&&a.push(b._layerInfo.layerObject):c.traversal(function(d){"undefined"!==typeof d._layerInfo.layerObject.type?-1===d._layerInfo.layerObject.type.indexOf("tile")&&a.push(d._layerInfo.layerObject):a.push(d._layerInfo.layerObject)});return a};e.readExprInfo._lookupArcadeRender=
function(b){var e=[];0<b.layers.length&&r.forEach(b.layers,f.hitch(this,function(a){var b={};if("undefined"!==typeof a.renderer){var d=a.renderer;"undefined"!==typeof d.valueExpression&&(b.layer=a.id,b.valueExpression=d.valueExpression,b.valueExpressionTitle=d.valueExpressionTitle,"undefined"!==typeof d.values&&(b.values=d.values),"undefined"!==typeof d.visualVariables&&(b.visualVariables=d.visualVariables));1<Object.keys(b).length&&b.constructor===Object?e.push(b):e.push({layer:a.id,valueExpression:null,
valueExpressionTitle:null,values:null,visualVariables:null})}}));return e};e.readExprInfo._lookupArcadeInfoTemplate=function(b){var e=[];0<b.layers.length&&r.forEach(b.layers,f.hitch(this,function(a){var b={};if("undefined"!==typeof a.infoTemplate)"undefined"!==typeof a.infoTemplate.info.expressionInfos&&0<a.infoTemplate.info.expressionInfos.length&&(b.layer=a.id,b.expressionInfos=a.infoTemplate.info.expressionInfos);else if("undefined"!==typeof a.infoTemplates)for(var d in a.infoTemplates)if(a.infoTemplates.hasOwnProperty(d)&&
"undefined"!==typeof a.infoTemplates[d].infoTemplate.info.expressionInfos){var c=a.infoTemplates[d].infoTemplate;0<c.info.expressionInfos.length&&(b.layer=a.id,b.expressionInfos=c.info.expressionInfos)}1<Object.keys(b).length&&b.constructor===Object?e.push(b):e.push({layer:a.id,expressionInfos:null})}));return e};e.readExprInfo._lookupArcadeLabel=function(b){var e=[];0<b.layers.length&&r.forEach(b.layers,f.hitch(this,function(a){var b={};"undefined"!==typeof a.labelingInfo&&r.forEach(a.labelingInfo,
f.hitch(this,function(d){"undefined"!==typeof d.name&&(b.layer=a.id,b.name=d.name,b.labelingInfo=d,b.expression=d.labelExpressionInfo.expression)}));1<Object.keys(b).length&&b.constructor===Object?e.push(b):e.push({layer:a.id,name:null,labelingInfo:null,expression:null})}));return e};e.customExpr={};e.customExpr.getAttributesFromCustomArcadeExpr=function(b,c,a){b=e.InfoTemplate._parseArcadeExpressions(b);return e.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(c,b,a)};e.customExpr.getAttributesValueFromCustomArcadeExprBatch=
function(b,c,a){var f=[],d;for(d in c)f.push(c[d]);c=e.InfoTemplate._parseArcadeExpressions(b);b=e.InfoTemplate._getExprNamesArrayFromPopupExprInfos(b);b.relationships=null;b.parsedExpressions=c;var h=new l;e.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(f,b,a).then(function(a){h.resolve(a)});return h};e.InfoTemplate={};e.InfoTemplate.getAttributesFromInfoTemplate=function(b,c,a){var f={fields:[]};c.layerObject&&c.layerObject.fields&&(f.fields=c.layerObject.fields);b=e.readExprInfo.getArcadeProfilesByType(b,
c,"infoTemplate")[0].expressionInfos;if(!b)return a.attributes;b=e.InfoTemplate._parseArcadeExpressions(b);return e.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(a,b,f)};e.InfoTemplate.getAttributesValueFromInfoTemplateBatch=function(b,c,a){var f={fields:[]};c.layerObject&&c.layerObject.fields&&(f.fields=c.layerObject.fields);var d=[],h;for(h in a)d.push(a[h]);b=e.readExprInfo.getArcadeProfilesByType(b,c,"infoTemplate")[0].expressionInfos;var m=new l;if(!b)return m.resolve([]),m;
a=e.InfoTemplate._parseArcadeExpressions(b);h=null;h=c.getPopupInfo().description;null!==h?(h=e.InfoTemplate._convertPopupDescToFieldNamesArray(h),h.relationships=e.InfoTemplate._getRelationshipQueries(c)):(h=e.InfoTemplate._getExprNamesArrayFromPopupExprInfos(b),h.relationships=null);h.parsedExpressions=a;e.InfoTemplate._getPopupFieldsValueFromArcadeFeatures(d,h,f).then(function(a){m.resolve(a)});return m};e.InfoTemplate._getRelationshipQueries=function(b){var e=!1,a={},c=/\d+/,d;if(d=b.getPopupInfo().description.match(/\{relationships\/\d+\//gm))e=
!0,r.forEach(d,function(d){var e=d.match(c)[0];a.hasOwnProperty(e)||(d=new k,d.outFields=["*"],d.relationshipId=e,d.returnGeometry=!1,a[e]={operLayer:b,relatedQuery:d})});return e?a:null};e.InfoTemplate._getExprNamesArrayFromPopupExprInfos=function(b){var e=[],a;for(a in b)e.push("${expression/"+b[a].name+"}");return e};e.InfoTemplate._convertPopupDescToFieldNamesArray=function(b){b=e.InfoTemplate._convertEndParasToEOLs(b);b=e.InfoTemplate._convertBreaksToEOLs(b);b=e.InfoTemplate._sanitizeNoTags(b).trim();
b=b.replace(/\{/gi,"${");b=b.replace(/\u00a0/gi," ");b=b.split("\n");return b=r.map(b,function(b){return b.trim()})};e.InfoTemplate._sanitizeNoTags=function(b){var e;e=h.sanitizeHTML(b);b=/<(?:!--(?:(?:-*[^->])*--+|-?)|script\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/script\s*|style\b(?:[^"'>]|"[^"]*"|'[^']*')*>[\s\S]*?<\/style\s*|\/?[a-z](?:[^"'>]|"[^"]*"|'[^']*')*)>/gi;var a;do a=e,e=e.replace(b,"");while(e!==a);return e=e.replace(/</g,"\x26lt;")};e.InfoTemplate._getPopupFieldsValueFromArcadeFeatures=
function(b,f,a){var g=new l,d=[],h=[],m=0;f.relationships?(r.forEach(b,function(d){e.InfoTemplate._objEach(f.relationships,function(b,g){var m=new l,k=b.relatedQuery,u;h.push(m);u=d.attributes[b.operLayer.layerObject.objectIdField];k.objectIds=[u];b.operLayer.layerObject.queryRelatedFeatures(k,function(b){var h=[];b[u]&&b[u].features&&(b=b[u].features,r.forEach(b,function(b){var m=[],k,u,n;k=d.attributes;u="relationships/"+g+"/";e.InfoTemplate._objEach(b.attributes,function(a,b){n=u+b;k[n]=a});r.forEach(f,
function(b){m.push(c.substitute(b,e.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(d,f.parsedExpressions,a),e.InfoTemplate._useEmptyStringForNull))});h.push(m)}));m.resolve(h)})})}),p(h).then(function(a){r.forEach(a,function(a){r.forEach(a,function(a){++m;d.push(a)})});console.log(m+" related address features found");g.resolve(d)})):(r.forEach(b,function(b){var g=[];r.forEach(f,function(d){g.push(c.substitute(d,e.InfoTemplate._combineFeatureAttributesAndExpressionResolutions(b,f.parsedExpressions,
a),e.InfoTemplate._useEmptyStringForNull))});d.push(g)}),g.resolve(d));return g};e.InfoTemplate._parseArcadeExpressions=function(b){var e;Array.isArray(b)&&0<b.length&&(e={},r.forEach(b,function(a){e[a.name]=q.parseScript(a.expression)}));return e};e.InfoTemplate._initArcadeContext=function(b,e){var a={vars:{}};a.vars.$feature=n.createFromGraphicLikeObject(b.geometry,b.attributes,e);return a};e.InfoTemplate._combineFeatureAttributesAndExpressionResolutions=function(b,c,a){var g,d;g=f.mixin({},b.attributes);
if(c)for(d in b=e.InfoTemplate._initArcadeContext(b,a),c)a=q.executeScript(c[d],b),g["expression/"+d]=a?a.toString():"";return g};e.InfoTemplate._convertEndParasToEOLs=function(b){var e=b;b=b.match(/<\/p>/gi);r.forEach(b,function(a){e=e.replace(a,"\n")});return e};e.InfoTemplate._convertBreaksToEOLs=function(b){var e=b;b=b.match(/<br\s*\/?>/gi);r.forEach(b,function(a){e=e.replace(a,"\n")});return e};e.InfoTemplate._useEmptyStringForNull=function(b){return b?b:""};e.InfoTemplate._objEach=function(b,
e,a){for(var c in b)b.hasOwnProperty(c)&&e.call(a,b[c],c)};return e})},"jimu/LayerStructure":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/on dojo/Evented ./LayerInfos/LayerInfos".split(" "),function(r,f,l,p,c,q){var n=r([c],{declaredClass:"jimu.LayerStructure",map:null,_layerInfos:null,_eventHandles:null,constructor:function(c){this._layerInfos=c;this.map=this._layerInfos.map;this._eventHandles=[];this._bindEvents()},getLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getLayerInfoArray())},
getTableNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getTableInfoArray())},getBasemapLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getBasemapLayerInfoArray())},getWebmapLayerNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getLayerInfoArrayOfWebmap())},getWebmapTableNodes:function(){return this._getNodesArrayFromInfosArray(this._layerInfos.getTableInfoArrayOfWebmap())},addTable:function(c){var f=null;if(c=this._layerInfos.addTable(c))f=
c._adaptor;return f},removeTable:function(c){(c=this.getNodeById(c))&&this._layerInfos.removeTable(c._layerInfo)},_traversal:function(c,f){for(var e=0;e<f.length;e++)if(f[e].traversal(c))return!0;return!1},traversal:function(c){return this._traversal(c,this.getLayerNodes().concat(this.getBasemapLayerNodes().concat(this.getTableNodes())))},traversalWithNodes:function(c,f){return this._traversal(c,f)},getNodeById:function(c){var f=null;this.traversal(function(e){if(e.id===c)return f=e,!0});return f},
getBasemapLayerObjects:function(){return this._layerInfos.getBasemapLayers()},restoreState:function(c){this._layerInfos.restoreState(c)},destroy:function(){f.forEach(this._eventHandles,function(c){c.remove()});this.inherited(arguments)},_getNodesArrayFromInfosArray:function(c){var h=[];f.forEach(c,function(e){h.push(e._adaptor)},this);return h},_emitEvent:function(){try{this.emit.apply(this,arguments)}catch(h){console.warn(h)}},_bindEvents:function(){var c;c=p(this._layerInfos,"layerInfosChanged",
l.hitch(this,this._onLayerNodesStructureChanged));this._eventHandles.push(c);c=p(this._layerInfos,"basemapLayerInfosChanged",l.hitch(this,this._onLayerNodesStructureChanged));this._eventHandles.push(c);c=p(this._layerInfos,"tableInfosChanged",l.hitch(this,this._onTableNdoesStructureChanged));this._eventHandles.push(c);c=p(this._layerInfos,"layerInfosReorder",l.hitch(this,this._onLayerReordered));this._eventHandles.push(c);c=p(this._layerInfos,"layerInfosIsShowInMapChanged",l.hitch(this,this._onVisibilityChanged));
this._eventHandles.push(c);c=p(this._layerInfos,"layerInfosIsVisibleChanged",l.hitch(this,this._onToggleChanged));this._eventHandles.push(c);c=p(this._layerInfos,"layerInfosFilterChanged",l.hitch(this,this._onFilterChanged));this._eventHandles.push(c);c=p(this._layerInfos,"layerInfosRendererChanged",l.hitch(this,this._onRendererChanged));this._eventHandles.push(c);c=p(this._layerInfos,"layerInfosOpacityChanged",l.hitch(this,this._onOpacityChanged));this._eventHandles.push(c);c=p(this._layerInfos,
"layerInfosTimeExtentChanged",l.hitch(this,this._onTimeExtentChanged));this._eventHandles.push(c)},_onLayerNodesStructureChanged:function(c,f,e){this._emitEvent(n.EVENT_STRUCTURE_CHANGE,{type:f,layerNodes:[e._adaptor],rootLayerNodes:[c._adaptor]})},_onTableNdoesStructureChanged:function(c,f){c=this._getNodesArrayFromInfosArray(c);this._emitEvent(n.EVENT_STRUCTURE_CHANGE,{type:f,layerNodes:c,rootLayerNodes:c})},_onLayerReordered:function(c,f){c=c?[c._adaptor]:[];this._emitEvent(n.EVENT_STRUCTURE_CHANGE,
{type:f,layerNodes:c,rootLayerNodes:c})},_onVisibilityChanged:function(c){c={layerNodes:this._getNodesArrayFromInfosArray(c)};this._emitEvent(n.EVENT_VISIBILITY_CHANGE,c)},_onToggleChanged:function(c){c={layerNodes:this._getNodesArrayFromInfosArray(c)};this._emitEvent(n.EVENT_TOOGLE_CHANGE,c)},_onFilterChanged:function(c){c={layerNodes:this._getNodesArrayFromInfosArray(c)};this._emitEvent(n.EVENT_FILTER_CHANGE,c)},_onRendererChanged:function(c){c={layerNodes:this._getNodesArrayFromInfosArray(c)};
this._emitEvent(n.EVENT_RENDERER_CHANGE,c)},_onOpacityChanged:function(c){c={layerNodes:this._getNodesArrayFromInfosArray(c)};this._emitEvent(n.EVENT_OPACITY_CHANGE,c)},_onTimeExtentChanged:function(c){c={layerNodes:this._getNodesArrayFromInfosArray(c)};this._emitEvent(n.EVENT_TIME_EXTENT_CHANGE,c)}}),k=null;n.getInstance=function(){k&&k._layerInfos._objectId===q.getInstanceSync()._objectId||(k&&k.destroy(),k=new n(q.getInstanceSync()));return k};n.createInstance=function(c){return new n(q.createInstance(c))};
l.mixin(n,{STRUCTURE_CHANGE_ADD:q.ADDED,STRUCTURE_CHANGE_REMOVE:q.REMOVED,STRUCTURE_CHANGE_SUBNODE_ADD:q.SUBLAYER_ADDED,STRUCTURE_CHANGE_SUBNODE_REMOVE:q.SUBLAYER_REMOVED,STRUCTURE_CHANGE_NODE_UPDATE:q.UPDATED,STRUCTURE_CHANGE_REORDER:q.REORDERED,EVENT_STRUCTURE_CHANGE:"structure-change",EVENT_TOOGLE_CHANGE:"toggle-change",EVENT_VISIBILITY_CHANGE:"visibility-change",EVENT_FILTER_CHANGE:"filter-change",EVENT_RENDERER_CHANGE:"renderer-change",EVENT_OPACITY_CHANGE:"opacity-change",EVENT_TIME_EXTENT_CHANGE:"time-extent-change"});
return n})},"jimu/GeojsonConverters":function(){define([],function(){function r(c){var f;a:{f=c[0];for(var h=0;h<f.length;h++)if(f[h]!==c[c.length-1][h]){f=!1;break a}f=!0}f||c.push(c[0]);return c}function f(c){var f=0,h=0,n=c.length,e=c[h],b;for(h;h<n-1;h++)b=c[h+1],f+=(b[0]-e[0])*(b[1]+e[1]),e=b;return 0<=f}function l(c,f){for(var h=0;h<c.length-1;h++)for(var k=0;k<f.length-1;k++){var e;a:{var b=c[h],m=c[h+1],a=f[k],g=f[k+1],d=(g[0]-a[0])*(b[1]-a[1])-(g[1]-a[1])*(b[0]-a[0]);e=(m[0]-b[0])*(b[1]-
a[1])-(m[1]-b[1])*(b[0]-a[0]);b=(g[1]-a[1])*(m[0]-b[0])-(g[0]-a[0])*(m[1]-b[1]);if(0!==b&&(d/=b,e/=b,0<=d&&1>=d&&0<=e&&1>=e)){e=!0;break a}e=!1}if(e)return!0}return!1}function p(c){var k=[];c=c.slice(0);var h=r(c.shift().slice(0));if(4<=h.length)for(f(h)||h.reverse(),k.push(h),h=0;h<c.length;h++){var n=r(c[h].slice(0));4<=n.length&&(f(n)&&n.reverse(),k.push(n))}return k}function c(c){var f={},h;for(h in c)c.hasOwnProperty(h)&&(f[h]=c[h]);return f}var q={arcgisToGeoJSON:function(n,k){var h={};"number"===
typeof n.x&&"number"===typeof n.y&&(h.type="Point",h.coordinates=[n.x,n.y]);n.points&&(h.type="MultiPoint",h.coordinates=n.points.slice(0));n.paths&&(1===n.paths.length?(h.type="LineString",h.coordinates=n.paths[0].slice(0)):(h.type="MultiLineString",h.coordinates=n.paths.slice(0)));if(n.rings){var t=n.rings.slice(0),h=[],e=[],b,m;for(m=0;m<t.length;m++){var a=r(t[m].slice(0));4>a.length||(f(a)?h.push([a]):e.push(a))}for(a=[];e.length;){m=e.pop();for(var g=!1,t=h.length-1;0<=t;t--){var d=b=h[t][0],
u=m;b=l(d,u);for(var u=u[0],p=!1,B=-1,z=d.length,C=z-1;++B<z;C=B)(d[B][1]<=u[1]&&u[1]<d[C][1]||d[C][1]<=u[1]&&u[1]<d[B][1])&&u[0]<(d[C][0]-d[B][0])*(u[1]-d[B][1])/(d[C][1]-d[B][1])+d[B][0]&&(p=!p);d=p;if(!b&&d){h[t].push(m);g=!0;break}}g||a.push(m)}for(;a.length;){m=a.pop();e=!1;for(t=h.length-1;0<=t;t--)if(b=h[t][0],l(b,m)){h[t].push(m);e=!0;break}e||h.push([m.reverse()])}h=1===h.length?{type:"Polygon",coordinates:h[0]}:{type:"MultiPolygon",coordinates:h}}if(n.geometry||n.attributes)h.type="Feature",
h.geometry=n.geometry?q.arcgisToGeoJSON(n.geometry):null,h.properties=n.attributes?c(n.attributes):null,n.attributes&&(h.id=n.attributes[k]||n.attributes.OBJECTID||n.attributes.FID);return h},geojsonToArcGIS:function(f,k){k=k||"OBJECTID";var h={wkid:4326},n={};switch(f.type){case "Point":n.x=f.coordinates[0];n.y=f.coordinates[1];n.spatialReference=h;break;case "MultiPoint":n.points=f.coordinates.slice(0);n.spatialReference=h;break;case "LineString":n.paths=[f.coordinates.slice(0)];n.spatialReference=
h;break;case "MultiLineString":n.paths=f.coordinates.slice(0);n.spatialReference=h;break;case "Polygon":n.rings=p(f.coordinates.slice(0));n.spatialReference=h;break;case "MultiPolygon":k=n;f=f.coordinates.slice(0);for(var e=[],b=0;b<f.length;b++)for(var m=p(f[b]),a=m.length-1;0<=a;a--){var g=m[a].slice(0);e.push(g)}k.rings=e;n.spatialReference=h;break;case "Feature":f.geometry&&(n.geometry=q.geojsonToArcGIS(f.geometry,k));n.attributes=f.properties?c(f.properties):{};f.id&&(n.attributes[k]=f.id);break;
case "FeatureCollection":n=[];for(h=0;h<f.features.length;h++)n.push(q.geojsonToArcGIS(f.features[h],k));break;case "GeometryCollection":for(n=[],h=0;h<f.geometries.length;h++)n.push(q.geojsonToArcGIS(f.geometries[h],k))}return n}};return q})},"libs/polyfills/FileSaver":function(){(function(r,f){"function"==typeof define&&define.amd?define([],f):"undefined"!=typeof exports?f():(f(),r.FileSaver={})})(this,function(){function r(c,f){return"undefined"==typeof f?f={autoBom:!1}:"object"!=typeof f&&(console.warn("Depricated: Expected third argument to be a object"),
f={autoBom:!f}),f.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(c.type)?new Blob(["\ufeff",c],{type:c.type}):c}function f(c,f,h){var k=new XMLHttpRequest;k.open("GET",c);k.responseType="blob";k.onload=function(){q(k.response,f,h)};k.onerror=function(){console.error("could not download file")};k.send()}function l(c){var f=new XMLHttpRequest;return f.open("HEAD",c,!1),f.send(),200<=f.status&&299>=f.status}function p(c){try{c.dispatchEvent(new MouseEvent("click"))}catch(h){var f=
document.createEvent("MouseEvents");f.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null);c.dispatchEvent(f)}}var c="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,q=c.saveAs||("object"!=typeof window||window!==c?function(){}:"download"in HTMLAnchorElement.prototype?function(n,k,h){var t=c.URL||c.webkitURL,e=document.createElement("a");k=k||n.name||"download";e.download=
k;e.rel="noopener";"string"==typeof n?(e.href=n,e.origin===location.origin?p(e):l(e.href)?f(n,k,h):p(e,e.target="_blank")):(e.href=t.createObjectURL(n),setTimeout(function(){t.revokeObjectURL(e.href)},4E4),setTimeout(function(){p(e)},0))}:"msSaveOrOpenBlob"in navigator?function(c,k,h){if(k=k||c.name||"download","string"!=typeof c)navigator.msSaveOrOpenBlob(r(c,h),k);else if(l(c))f(c,k,h);else{var n=document.createElement("a");n.href=c;n.target="_blank";setTimeout(function(){p(n)})}}:function(n,k,
h,l){if(l=l||open("","_blank"),l&&(l.document.title=l.document.body.innerText="downloading..."),"string"==typeof n)return f(n,k,h);k="application/octet-stream"===n.type;h=/constructor/i.test(c.HTMLElement)||c.safari;var e=/CriOS\/[\d]+/.test(navigator.userAgent);if((e||k&&h)&&"object"==typeof FileReader){var b=new FileReader;b.onloadend=function(){var a=b.result,a=e?a:a.replace(/^data:[^;]*;/,"data:attachment/file;");l?l.location.href=a:location=a;l=null};b.readAsDataURL(n)}else{var m=c.URL||c.webkitURL,
a=m.createObjectURL(n);l?l.location=a:location.href=a;l=null;setTimeout(function(){m.revokeObjectURL(a)},4E4)}});c.saveAs=q.saveAs=q;"undefined"!=typeof module&&(module.exports=q)})},"jimu/featureActions/ExportToFeatureCollection":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(r,f,l){return r(f,{name:"ExportToFeatureCollection",iconClass:"icon-export",isFeatureSupported:function(f){return 0<f.features.length&&f.features[0].geometry},onExecute:function(f){f=
l.createDataSource({type:l.TYPE_FEATURESET,filename:"features",data:f});f.setFormat(l.FORMAT_FEATURESET);f.download()}})})},"jimu/featureActions/ExportToGeoJSON":function(){define(["dojo/_base/declare","../BaseFeatureAction","../exportUtils"],function(r,f,l){return r(f,{name:"ExportToGeoJSON",iconClass:"icon-export",isFeatureSupported:function(f){return 0<f.features.length&&f.features[0].geometry},onExecute:function(f){f=l.createDataSource({type:l.TYPE_FEATURESET,filename:"features",data:f});f.setFormat(l.FORMAT_GEOJSON);
f.download()}})})},"jimu/featureActions/ShowStatistics":function(){define(["dojo/_base/declare","../BaseFeatureAction","jimu/dijit/FieldStatistics"],function(r,f,l){return r(f,{iconClass:"icon-statistics",isFeatureSupported:function(f,c){return 1<f.features.length&&c&&"esri.layers.GraphicsLayer"!==c.declaredClass&&0<this.getNumbericFields(c).length},onExecute:function(f,c){var p=new l;f={featureSet:f,layer:c,fieldNames:this.getNumbericFields(c).map(function(c){return c.name})};p.showContentAsPopup(f)},
getNumbericFields:function(f){return f.fields.filter(function(c){return-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(c.type)})}})})},"jimu/dijit/FieldStatistics":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/NodeList-manipulate dojo/when jimu/dijit/formSelect esri/lang jimu/dijit/Popup jimu/dijit/LoadingIndicator jimu/utils jimu/statisticsUtils".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g){return r([f],{statInfo:null,postMixInProperties:function(){this.nls=window.jimuNls.fieldStatistics;l.mixin(this.nls,window.jimuNls.common)},showContent:function(a){this.statInfo=a;0!==this.statInfo.fieldNames.length&&(a=p.create("div",{className:"stat-container"},this.domNode),this._createFieldDom(a),1===this.statInfo.fieldNames.length&&(this.statInfo.fieldName=this.statInfo.fieldNames[0],this._showOneFieldStatContent(this.statInfo,a)))},showContentAsPopup:function(a){this.statInfo=
a;this._statisticsPopup&&this._statisticsPopup.domNode&&this._statisticsPopup.close();this._statisticsPopup=null;this._statisticsPopup=new b({titleLabel:this.nls.statistics,content:this.domNode,width:270,height:265,buttons:[{label:this.nls.ok}]});this.showContent(a)},_showOneFieldStatContent:function(a,b){var d;g.isStatFromServer(this.statInfo)&&(d=new m,d.placeAt(b),d.show());g.getStatisticsResult(this.statInfo).then(l.hitch(this,function(a){d&&d.destroy();n(".esriAGOTableStatistics",b).remove();
a=this._createStatContent(a);p.place(a,b)}))},_getFieldAliaseFromStatInfo:function(a){var b=this.statInfo.featureSet;(b=b&&b.fieldAliases)&&"undefined"!==typeof b[a]?b=b[a]:this.statInfo.layer?(b=c.filter(this.statInfo.layer.fields,function(b){return b.name===a}),b=b[0]?b[0].alias:""):b=a;return b},_createFieldDom:function(a){var b;if(1<this.statInfo.fieldNames.length){b=p.create("div",{className:"header"},a);p.create("span",{innerHTML:this.nls.field+": "},b);var d=new t({options:this.statInfo.fieldNames.map(l.hitch(this,
function(a){return{value:a,label:this._getFieldAliaseFromStatInfo(a)}})),style:{width:"150px"},"aria-label":this.nls.field});this.own(q(d,"change",l.hitch(this,function(b){this.statInfo.fieldName=b;this._showOneFieldStatContent(this.statInfo,a)})));d.placeAt(b);this.statInfo.fieldName=this.statInfo.fieldNames[0];this._showOneFieldStatContent(this.statInfo,a)}else b=p.create("div",{className:"header",innerHTML:"\x3cspan\x3e"+this.nls.field+"\x3c/span\x3e: "+this._getFieldAliaseFromStatInfo(this.statInfo.fieldNames[0])},
a);return b},_createStatContent:function(a){var b={},d="count sum min max ave stddev".split(" "),e,f,g,h,m,k,n,l;e=p.create("div",{className:"esriAGOTableStatistics",innerHTML:""});p.create("div",{className:"hzLine",innerHTML:""},e);f=p.create("table",{className:"attrTable",tabindex:"0",innerHTML:"",style:{cellpadding:0,cellspacing:0}},e);for(m in a)a.hasOwnProperty(m)&&(b[m.toLowerCase()]=a[m]);m=b.countfield;l=b.sumfield||"";n=b.minfield||"";k=b.maxfield||"";a=b.avgfield||"";b=b.stddevfield||"";
g=p.create("tbody",{},f);var t=this;c.forEach([m,l,n,k,a,b],function(a,b){""!==a&&(h=p.create("tr",{valign:"top"},g),p.create("td",{"class":"attrName",innerHTML:t.nls[d[b]]},h),p.create("td",{"class":"attrValue",innerHTML:a},h))});p.create("div",{className:"break",innerHTML:""},e);return e}})})},"jimu/dijit/formSelect":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/query dojo/_base/array dojo/dom-construct dijit/form/Select".split(" "),function(r,f,l,p,c,q,n,k){return r([k],
{postCreate:function(){this.inherited(arguments);var h=this["aria-label"],k=this["aria-labelledby"],e;h&&"focusNode"!==h?(e='\x3ccaption class\x3d"screen-readers-only-no-position"\x3e'+h+"\x3c/caption\x3e",h=f.toDom(e),n.place(h,this.domNode,"first")):k?setTimeout(l.hitch(this,function(){var b=k.split(" "),h=[];q.forEach(b,function(a){(a=c("#"+a)[0])&&""!==a&&a.innerHTML&&h.push(a.innerHTML)});0<h.length&&(e='\x3ccaption class\x3d"screen-readers-only-no-position"\x3e'+h.join(" ")+"\x3c/caption\x3e",
b=f.toDom(e),n.place(b,this.domNode,"first"))}),1E3):(this.setAttrs=function(){this.domNode.title="";var b=this.get("value");b&&(b=this.getOptions(b),this.domNode.title=b.label,f.setAttr(this.domNode,"aria-label",b.label))},this.setAttrs(),p(this,"change",l.hitch(this,this.setAttrs)))}})})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B){function z(a){return function(b){this._isLoaded?this.inherited(a,arguments):this.loadDropDown(k.hitch(this,a,b))}}var C=f("dijit.form._SelectMenu",m,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(h(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}))},focus:function(){var a=!1,b=this.parentWidget.value;
k.isArray(b)&&(b=b[b.length-1]);b&&r.forEach(this.parentWidget._getChildren(),function(d){d.option&&b===d.option.value&&(a=!0,this.focusChild(d,!1))},this);a||this.inherited(arguments)}});c=f("dijit.form.Select"+(t("dojo-bidi")?"_NoBidi":""),[e,b,u],{baseClass:"dijitSelect dijitValidationTextBox",templateString:B,_buttonInputDisabled:t("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=a?a:0].value)}this.dropDown=new C({id:this.id+"_menu",parentWidget:this});p.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(b){if(b.value||b.label){var d=k.hitch(this,"_setValueAttr",b);b=new a({option:b,label:("text"===this.labelType?(b.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):b.label)||this.emptyLabel,
onClick:d,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:b.disabled||!1});b.focusNode.setAttribute("role","option");return b}return new g({ownerDocument:this.ownerDocument})},_addOptionItem:function(a){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(a))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(D){}},focusChild:function(a){a&&this.set("value",
a.option)},_getFirst:function(){var a=this._getChildren();return a.length?a[0]:null},_getLast:function(){var a=this._getChildren();return a.length?a[a.length-1]:null},childSelector:function(a){return(a=v.byNode(a))&&a.getParent()==this.dropDown},onKeyboardSearch:function(a,b,d,e){a&&this.focusChild(a)},_loadChildren:function(b){if(!0===b)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{r.forEach(this._getChildren(),function(a){a.destroyRecursive()});
var d=new a({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(d)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(a){this.inherited(arguments);l.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",
_setDisabledAttr:function(a){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(a){this._set("required",a);this.focusNode.setAttribute("aria-required",a);this._refreshState()},_setOptionsAttr:function(a){this._isLoaded=!1;this._set("options",a)},_setDisplay:function(a){a=("text"===this.labelType?(a||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+a+"\x3c/span\x3e"},validate:function(a){a=this.disabled||this.isValid(a);this._set("state",a?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",a?"false":"true");var b=a?"":this._missingMsg;b&&this.focused&&this._hasBeenBlurred?d.show(b,this.domNode,this.tooltipPosition,!this.isLeftToRight()):d.hide(this.domNode);this._set("message",b);return a},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);d.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=q.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(h(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var a=this._keyNavCodes;delete a[n.LEFT_ARROW];delete a[n.RIGHT_ARROW]},_setStyleAttr:function(a){this.inherited(arguments);
p.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(a){this._loadChildren(!0);this._isLoaded=!0;a()},destroy:function(a){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(a),delete this.dropDown);d.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){d.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
t("dojo-bidi")&&(c=f("dijit.form.Select",c,{_setDisplay:function(a){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));c._Menu=C;c.prototype._onContainerKeydown=z("_onContainerKeydown");c.prototype._onContainerKeypress=z("_onContainerKeypress");return c})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m){return c("dijit.form._FormSelectWidget",m,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var b=this.options||[];if(null==a)return b;if(h.isArrayLike(a))return r.map(a,"return this.getOptions(item);",this);h.isString(a)&&(a={value:a});h.isObject(a)&&(r.some(b,function(b,e){for(var d in a)if(!(d in b)||b[d]!=a[d])return!1;a=e;return!0})||(a=-1));return 0<=a&&a<b.length?b[a]:null},addOption:function(a){r.forEach(h.isArrayLike(a)?a:[a],function(a){a&&h.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(h.isArrayLike(a)?
a:[a]);r.forEach(a,function(a){a&&(this.options=r.filter(this.options,function(b){return b.value!==a.value||b.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){r.forEach(h.isArrayLike(a)?a:[a],function(a){var b=this.getOptions({value:a.value}),e;if(b)for(e in a)b[e]=a[e]},this);this._loadChildren()},setStore:function(a,b,d){k.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(a,b,d)},_deprecatedSetStore:function(a,c,d){var g=this.store;d=d||{};if(g!==a){for(var m;m=this._notifyConnections.pop();)m.remove();a.get||(h.mixin(a,{_oldAPI:!0,get:function(a){var b=new f;this.fetchItemByIdentity({identity:a,onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(a,d){var e=new f(function(){c.abort&&c.abort()});e.total=new f;var c=this.fetch(h.mixin({query:a,onBegin:function(a){e.total.resolve(a)},
onComplete:function(a){e.resolve(a)},onError:function(a){e.reject(a)}},d));return new b(e)}}),a.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[l.after(a,"onNew",h.hitch(this,"_onNewItem"),!0),l.after(a,"onDelete",h.hitch(this,"_onDeleteItem"),!0),l.after(a,"onSet",h.hitch(this,"_onSetItem"),!0)]));this._set("store",a)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);d.query&&this._set("query",d.query);d.queryOptions&&this._set("queryOptions",d.queryOptions);a&&a.query&&(this._loadingStore=!0,this.onLoadDeferred=new f,this._queryRes=a.query(this.query,this.queryOptions),e(this._queryRes,h.hitch(this,function(b){if(this.sortByLabel&&!d.sort&&b.length)if(a.getValue)b.sort(p.createSortFunction([{attribute:a.getLabelAttributes(b[0])[0]}],a));else{var e=this.labelAttr;b.sort(function(a,b){return a[e]>b[e]?1:b[e]>
a[e]?-1:0})}d.onFetch&&(b=d.onFetch.call(this,b,d));r.forEach(b,function(a){this._addOptionForItem(a)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(h.hitch(this,function(a,b,d){b==d?this._onSetItem(a):(-1!=b&&this._onDeleteItem(a),-1!=d&&this._onNewItem(a))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:c);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(b):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),h.hitch(this,function(a){console.error("dijit.form.Select: "+a.toString());this.onLoadDeferred.reject(a)})));return g},_setValueAttr:function(a,b){this._onChangeActive||(b=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=h.isArrayLike(a)?r.map(a,function(a){return h.isObject(a)?a:{value:a}}):h.isObject(a)?[a]:[{value:a}];a=r.filter(this.getOptions(a),function(a){return a&&a.value});var d=this.getOptions()||[];this.multiple||a[0]&&a[0].value||!d.length||(a[0]=
d[0]);r.forEach(d,function(b){b.selected=r.some(a,function(a){return a.value===b.value})});d=r.map(a,function(a){return a.value});if("undefined"!=typeof d&&"undefined"!=typeof d[0]){var e=r.map(a,function(a){return a.label});this._setDisplay(this.multiple?e:e[0]);this.inherited(arguments,[this.multiple?d:d[0],b]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=r.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?
a:a[0]},_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(r.forEach(this._getChildren(),function(a){a.destroyRecursive()}),r.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;r.forEach(this._getChildren(),function(d){var e=r.some(a,function(a){return d.option&&
a===d.option.value});e&&!b.multiple&&(b.focusedChild=d);n.toggle(d.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),e);d.domNode.setAttribute("aria-selected",e?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=r.filter(a,function(a){return a.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?r.map(r.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,b){b&&b.parent||this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,d=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:d?b.getIdentity(a):null,label:d,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);q.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?t("\x3e *",this.srcNodeRef).map(function(a){return"separator"===a.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:a.getAttribute("data-"+k._scopeName+"-value")||a.getAttribute("value"),
label:String(a.innerHTML),selected:a.getAttribute("selected")||!1,disabled:a.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);l.after(this,"onChange",h.hitch(this,"_updateSelection"));var a=this.store;a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(r,f,l,p){return r("dijit.DropDownMenu",p,{templateString:l,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(c){this._moveToPopup(c);c.stopPropagation();c.preventDefault()},
_onLeftArrow:function(c){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else c.stopPropagation(),c.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g){return f("dijit._MenuBase",[b,
g,a,m],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){c.toggle(this.domNode,"dijitMenuActive",a);c.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(a){var b=e.byNode(a);return a.parentNode==this.containerNode&&
b&&b.focus},postCreate:function(){var a=this,b="string"==typeof this.childSelector?this.childSelector:q.hitch(this,"childSelector");this.own(k(this.containerNode,k.selector(b,n.enter),function(){a.onItemHover(e.byNode(this))}),k(this.containerNode,k.selector(b,n.leave),function(){a.onItemUnhover(e.byNode(this))}),k(this.containerNode,k.selector(b,t),function(b){a.onItemClick(e.byNode(this),b);b.stopPropagation()}),k(this.containerNode,k.selector(b,"focusin"),function(){a._onItemFocus(e.byNode(this))}));
this.inherited(arguments)},onKeyboardSearch:function(a,b,e,c){this.inherited(arguments);if(a&&(-1==c||a.popup&&1==c))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},
_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=
a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&
(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;a.popup?(this.set("selected",a),this.set("activated",!0),b=/^key/.test(b._origType||b.type)||0==b.clientX&&0==b.clientY,this._openItemPopup(a,
b)):(this.onExecute(),a._onClick?a._onClick(b):a.onClick(b))},_openItemPopup:function(a,b){if(a!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var d=a.popup;d.parentMenu=this;this.own(this._mouseoverHandle=k.once(d.domNode,"mouseover",q.hitch(this,"_onPopupHover")));var e=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){b&&e.focusChild(a);e._cleanUp()},onExecute:q.hitch(this,
"_cleanUp",!0),onClose:function(){e._mouseoverHandle&&(e._mouseoverHandle.remove(),delete e._mouseoverHandle)}},b);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(p.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),
this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(r,f,l,p,c,q,n,k,h,t){return f("dijit._KeyNavContainer",[h,t,k],{connectKeyNavHandlers:function(e,b){var f=this._keyNavCodes={},a=q.hitch(this,"focusPrev"),g=q.hitch(this,"focusNext");r.forEach(e,function(b){f[b]=a});r.forEach(b,function(a){f[a]=g});f[c.HOME]=q.hitch(this,"focusFirstChild");f[c.END]=q.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){p.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);r.forEach(this.getChildren(),
q.hitch(this,"_startupChild"))},addChild:function(e,b){this.inherited(arguments);this._startupChild(e)},_startupChild:function(e){e.set("tabIndex","-1")},_getFirst:function(){var e=this.getChildren();return e.length?e[0]:null},_getLast:function(){var e=this.getChildren();return e.length?e[e.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(e){return(e=
n.byNode(e))&&e.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(r,f,l,p,c,q,n,k){return f("dijit._KeyNavMixin",k,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);l.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var f=this._keyNavCodes={};f[p.HOME]=c.hitch(this,"focusFirstChild");f[p.END]=c.hitch(this,
"focusLastChild");f[this.isLeftToRight()?p.LEFT_ARROW:p.RIGHT_ARROW]=c.hitch(this,"_onLeftArrow");f[this.isLeftToRight()?p.RIGHT_ARROW:p.LEFT_ARROW]=c.hitch(this,"_onRightArrow");f[p.UP_ARROW]=c.hitch(this,"_onUpArrow");f[p.DOWN_ARROW]=c.hitch(this,"_onDownArrow")}var k=this,f="string"==typeof this.childSelector?this.childSelector:c.hitch(this,"childSelector");this.own(q(this.domNode,"keypress",c.hitch(this,"_onContainerKeypress")),q(this.domNode,"keydown",c.hitch(this,"_onContainerKeydown")),q(this.domNode,
"focus",c.hitch(this,"_onContainerFocus")),q(this.containerNode,q.selector(f,"focusin"),function(e){k._onChildFocus(n.getEnclosingWidget(this),e)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(c,f){c&&(this.focusedChild&&c!==this.focusedChild&&this._onChildBlur(this.focusedChild),c.set("tabIndex",this.tabIndex),c.focus(f?"end":"start"))},_onContainerFocus:function(c){c.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){l.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(c){l.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(c){c&&c!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),c.set("tabIndex",this.tabIndex),this.lastFocused=c,this._set("focusedChild",c))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(c,f,e,b){c&&this.focusChild(c)},_keyboardSearchCompare:function(c,f){var e=c.domNode;c=(c.label||(e.focusNode?
e.focusNode.label:"")||e.innerText||e.textContent||"").replace(/^\s+/,"").substr(0,f.length).toLowerCase();return f.length&&c==f?-1:0},_isFormElement:function(c){return"INPUT"===c.tagName||"TEXTAREA"===c.tagName||"SELECT"===c.tagName||"BUTTON"===c.tagName},_onContainerKeydown:function(c){if(!this._isFormElement(document.activeElement)){var f=this._keyNavCodes[c.keyCode];f?(f(c,this.focusedChild),c.stopPropagation(),c.preventDefault(),this._searchString=""):c.keyCode!=p.SPACE||!this._searchTimer||
c.ctrlKey||c.altKey||c.metaKey||(c.stopImmediatePropagation(),c.preventDefault(),this._keyboardSearch(c," "))}},_onContainerKeypress:function(c){this._isFormElement(document.activeElement)||c.charCode<=p.SPACE||c.ctrlKey||c.altKey||c.metaKey||(c.preventDefault(),c.stopPropagation(),this._keyboardSearch(c,String.fromCharCode(c.charCode).toLowerCase()))},_keyboardSearch:function(f,k){var e=null,b,h=0;c.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=k;var a=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;b=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var c=this.focusedChild||null;if(1==a||!c)if(c=this._getNextFocusableChild(c,1),!c)return;a=c;do{var d=this._keyboardSearchCompare(c,b);d&&0==h++&&(e=c);if(-1==d){h=-1;break}c=this._getNextFocusableChild(c,1)}while(c&&c!=a)})();this.onKeyboardSearch(e,f,b,h)},_onChildBlur:function(){},_getNextFocusableChild:function(c,f){var e=
c;do{if(c)c=this._getNext(c,f);else if(c=this[0<f?"_getFirst":"_getLast"](),!c)break;if(null!=c&&c!=e&&c.isFocusable())return c}while(c!=e);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(c,f){if(c)for(c=c.domNode;c;)if((c=c[0>f?"previousSibling":"nextSibling"])&&"getAttribute"in c){var e=n.byNode(c);if(e)return e}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b){n=r("dijit.MenuItem"+(q("dojo-bidi")?"_NoBidi":""),[k,h,t,e],{templateString:b,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(b){this._set("label",b);var a="",e;e=b.search(/{\S}/);if(0<=e){var a=b.charAt(e+1),d=b.substr(0,e);b=b.substr(e+3);e=d+a+b;b=d+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+a+"\x3c/span\x3e"+b}else e=b;this.domNode.setAttribute("aria-label",e+" "+this.accelKey);this.containerNode.innerHTML=b;this._set("shortcutKey",a)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(b){!b||"label"in this.params||this._set("label",b.innerHTML)},buildRendering:function(){this.inherited(arguments);l.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&l.set(this.accelKeyNode,"id",this.id+"_accel");f.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==q("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(m){}},_setSelected:function(b){p.toggle(this.domNode,
"dijitMenuItemSelected",b)},setLabel:function(b){c.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",b)},setDisabled:function(b){c.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",b)},_setDisabledAttr:function(b){this.focusNode.setAttribute("aria-disabled",b?"true":"false");this._set("disabled",b)},_setAccelKeyAttr:function(b){this.accelKeyNode&&(this.accelKeyNode.style.display=
b?"":"none",this.accelKeyNode.innerHTML=b,l.set(this.containerNode,"colSpan",b?"1":"2"));this._set("accelKey",b)}});q("dojo-bidi")&&(n=r("dijit.MenuItem",n,{_setLabelAttr:function(b){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return n})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(r,f){return r("dijit._Contained",null,{_getSibling:function(f){var l=this.getParent();return l&&l._getSiblingOfChild&&l._getSiblingOfChild(this,
"previous"==f?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var f=this.getParent();return f&&f.getIndexOfChild?f.getIndexOfChild(this):-1}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(r,f,l,p,c,q){return r("dijit.MenuSeparator",[l,p,c],{templateString:q,
buildRendering:function(){this.inherited(arguments);f.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(r,f,l,p){return r(f,{baseClass:"jimu-loading-indicator jimu-agol-loading",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&l.set(this.domNode,{display:"none"});
l.set(this.domNode,{width:"100%",height:"100%"});p.place(' \x3cdiv class\x3d"loading-container"\x3e\x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\x3c/div\x3e\x3c/div\x3e',this.domNode)},show:function(){this.domNode&&this.hidden&&(l.set(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(l.set(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/statisticsUtils":function(){define("dojo/_base/array dojo/when esri/tasks/StatisticDefinition esri/tasks/QueryTask esri/tasks/query esri/lang jimu/utils jimu/LayerInfos/LayerInfos exports".split(" "),
function(r,f,l,p,c,q,n,k,h){function t(a){var d;d=new c;d.outFields=[a.fieldName];d.outStatistics=[];d.geometry=a.geometry;var e=b(a);r.forEach(e,function(b){var e=new l;e.statisticType=b;e.displayFeildName=a.fieldName;e.onStatisticField=a.fieldName;e.outStatisticFieldName=u[b];d.outStatistics.push(e)});d.where=a.filterExpression?a.filterExpression:a.layer.getDefinitionExpression()?a.layer.getDefinitionExpression():"1\x3d1";a.geometry&&(d.geometry=a.geometry);return(new p(a.layer.url)).execute(d).then(function(b){return b&&
b.features&&0<b.features.length?(b=b.features[0].attributes,g(a,b),b):[]})}function e(a){var d={countField:0,sumField:0},e=b(a),c=0,f=0;a.featureSet.features.forEach(function(b){var g=b.attributes[a.fieldName];null!==g&&"undefined"!==typeof g&&e.forEach(function(a){switch(a){case "count":d.countField++;break;case "sum":d.sumField+=g;break;case "min":d.minField="undefined"===typeof d.minField?g:Math.min(d.minField,g);break;case "max":d.maxField="undefined"===typeof d.maxField?g:Math.max(d.maxField,
g);break;case "avg":c++,f+=g}})});d.avgField=0===c?0:0===c?"":f/c;var h=a.featureSet.features.filter(function(b){b=b.attributes[a.fieldName];return null===b||"undefined"===typeof b?!1:!0}).map(function(b){return b.attributes[a.fieldName]});d.stddevField=m(h);g(a,d);return d}function b(a){return a.statisticTypes&&0<a.statisticTypes.length?d.filter(function(b){return-1<a.statisticTypes.indexOf(b)}):d}function m(a){var b=a.length;if(1>=b)return 0;var d=0;a.forEach(function(a){d+=a});var e=d/b,c=0;a.forEach(function(a){c+=
Math.pow(a-e,2)});return Math.sqrt(1/(b-1)*c)}function a(a){var b=k.getInstanceSync();return a.layer?b.getLayerOrTableInfoById(a.layer.id).loadInfoTemplate().then(function(a){var b={};a.info&&a.info.fieldInfos&&a.info.fieldInfos.forEach(function(a){b[a.fieldName]=a});return b}):f({})}function g(a,b){if(a.fieldInfos&&a.fieldInfos[a.fieldName])for(var d in b)"countField"!==d&&q.isDefined(b[d])&&(b[d]=null===b[d]||"undefined"===typeof b[d]?"":n.localizeNumberByFieldInfo(b[d],a.fieldInfos[a.fieldName]))}
var d="count sum min max avg stddev".split(" "),u={count:"countField",sum:"sumField",min:"minField",max:"maxField",avg:"avgField",stddev:"stddevField"};h.getStatisticsResult=function(b){return a(b).then(function(a){b.fieldInfos=a;if(b.featureSet)return f(e(b));if(b.layer){if(b.layer.url)return t(b);b.featureSet=n.toFeatureSet(b.layer.graphics);return f(e(b))}})};h.isStatFromServer=function(a){return a.layer&&a.layer.url};h.getStddevVal=m;h.getStatisticsResultFromClientSync=e})},"jimu/featureActions/CreateLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/json dojo/on esri/layers/FeatureLayer esri/renderers/jsonUtils esri/symbols/jsonUtils ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/Search jimu/LayerInfos/LayerInfos jimu/utils".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m){return r(h,{name:"CreateLayer",iconClass:"icon-create-layer",isFeatureSupported:function(a,b){return 0<a.features.length&&a.features[0].geometry&&b&&b.geometryType&&b.fields&&b.objectIdField},onExecute:function(a,b){var d;a={layerDefinition:{geometryType:b.geometryType,fields:f.clone(b.fields),objectIdField:b.objectIdField},featureSet:a.toJson()};a=new q(a);(d=b._json?p.parse(b._json):null)&&d.drawingInfo&&d.drawingInfo.renderer?(d=d.drawingInfo.renderer,d=n.fromJson(d)):
d=n.fromJson(b.renderer.toJson());a.setRenderer(d);(b=b.getSelectionSymbol())&&a.setSelectionSymbol(k.fromJson(b.toJson()));this._popupAddLayer(a)},_popupAddLayer:function(a){var b,d=l.create("div",{style:"padding: 0 10px 0 10px;"}),h=(new e({placeholder:window.jimuNls.layerInfosMenu.labelLayer})).placeAt(d);l.setStyle(h.searchBtn,"display","none");var k=new t({content:d,titleLabel:window.jimuNls.featureActions.CreateLayer,width:525,height:180,buttons:[{label:window.jimuNls.common.ok,onClick:f.hitch(this,
function(){a.name=m.stripHTML(h.getValue());this._addLayerToMap(a);k.close();b&&b.remove&&b.remove()})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:f.hitch(this,function(){k.close();b&&b.remove&&b.remove()})}]});h.inputSearch.focus();k.disableButton(0);b=c(h.inputSearch,"keyup",function(){h.getValue()?k.enableButton(0):k.disableButton(0)})},_addLayerToMap:function(a){var e=b.getInstanceSync(),d=c(e,"layerInfosChanged",f.hitch(this,function(b){a.id===b.id&&(b.enablePopup(),
d.remove())}));this.map.addLayer(a)}})})},"jimu/dijit/Search":function(){define("dojo/_base/declare dojo/_base/html dojo/string dojo/keys dijit/_WidgetBase dijit/_TemplatedMixin".split(" "),function(r,f,l,p,c,q){return r([c,q],{baseClass:"jimu-search",declaredClass:"jimu.dijit.Search",templateString:'\x3cdiv\x3e\x3cspan class\x3d"jimu-input-wrapper" style\x3d"left:0;right:0;"\x3e\x3cinput class\x3d"jimu-input" style\x3d"background:#fafafc;" data-dojo-attach-point\x3d"inputSearch" data-dojo-attach-event\x3d"onKeydown: _onKeyDown, onKeyUp: _onKeyUp"/\x3e\x3c/span\x3e\x3cdiv class\x3d"search-btn jimu-icon jimu-icon-search" data-dojo-attach-point\x3d"searchBtn" data-dojo-attach-event\x3d"onClick: _onBtnClick"\x3e\x3c/div\x3e\x3c/div\x3e',
placeholder:"",onSearch:null,searchWhenInput:!1,postCreate:function(){this.inherited(arguments);this.placeholder&&f.setAttr(this.inputSearch,"placeholder",this.placeholder)},getValue:function(){return l.trim(this.inputSearch.value)},doSearch:function(){if(this.onSearch)this.onSearch(this.getValue())},_onKeyDown:function(c){this.doChange();(void 0!==c.keyCode?c.keyCode:c.which)===p.ENTER&&this.doSearch();c.stopPropagation()},_onKeyUp:function(){this.searchWhenInput&&this.doSearch()},_onBtnClick:function(){this.doSearch()},
doChange:function(){if(this.onChange)this.onChange(this.getValue())}})})},"jimu/featureActions/AddMarker":function(){define("dojo/_base/declare ../BaseFeatureAction esri/graphic esri/layers/GraphicsLayer esri/symbols/PictureMarkerSymbol esri/InfoTemplate jimu/shareUtils".split(" "),function(r,f,l,p,c,q,n){return r(f,{name:"AddMarker",iconClass:"icon-add",_markerLayer:null,isFeatureSupported:function(c){this._getMarkerLayer();return this._isSupportType(c)&&0<c.features.length&&c.features[0]&&c.features[0].geometry&&
!1===this._isFeatureInMarkerFeatureActionLayer(c)},onExecute:function(c,f){this._addMarker(c,f)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new p({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var c=this.map.snappingManager.layerInfos;c.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(c)}},_addMarker:function(f,
h){var k=f.features[0].geometry,e={};h=h.displayField||f.displayFieldName||h.objectIdField;e.title="";f.features[0].attributes&&h&&(e.title=f.features[0].attributes[h],e.title||(e.title=""));h={};if("point"===k.type)h=k;else if("polygon"===k.type||"polyline"===k.type||"multipoint"===k.type)h=this.map.infoWindow&&this.map.infoWindow.isShowing?this.map.infoWindow.location:k.getExtent().getCenter();h.getLongitude()&&h.getLatitude()?(e.longitude=h.getLongitude(),e.latitude=h.getLatitude()):h.x&&h.y&&
(e.x=h.x,e.y=h.y);var b="";k&&k.spatialReference&&k.spatialReference.wkid&&(b=k.spatialReference.wkid);e.spatialReference={wkid:b};k=n.getXyContent(e);e=n.getShareUrl(this.map,e,!0);e=n.getShareUrlContent(e);e=k+e;k=new c(require.toUrl("jimu")+"/images/EsriBluePinCircle26.png");k.width=26;k.height=26;k.setOffset(0,k.height/2);h=new l(h,k,null,null);h._markerFeatureactionGraphic=f.features[0];h.infoTemplate=this._setInfoTemplate(e);this._markerLayer.add(h);this._closePopupWindow()},_setInfoTemplate:function(c){var f=
new q;f.setContent(c);return f},_closePopupWindow:function(){this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(c){return c.features[0]&&c.features[0]._graphicsLayer&&c.features[0]._graphicsLayer.id&&"marker-feature-action-layer"===c.features[0]._graphicsLayer.id?!0:!1},_isSupportType:function(c){if(c&&c.geometryType){if(c.features&&c.features.length&&1<c.features.length)return!1;c=c.geometryType;return"point"===c||"polygon"===c||"polyline"===
c||"multipoint"===c}return!1}})})},"jimu/featureActions/RemoveMarker":function(){define(["dojo/_base/declare","../BaseFeatureAction","esri/layers/GraphicsLayer"],function(r,f,l){return r(f,{name:"RemoveMarker",iconClass:"icon-close",_markerLayer:null,isFeatureSupported:function(f){this._getMarkerLayer();return 0<f.features.length&&f.geometryType&&f.features[0]&&f.features[0].geometry&&!0===this._isFeatureInMarkerFeatureActionLayer(f)},onExecute:function(f){this._removeMarker(f)},_getMarkerLayer:function(){if(this.map.getLayer("marker-feature-action-layer"))this._markerLayer=
this.map.getLayer("marker-feature-action-layer");else if(this._markerLayer=new l({id:"marker-feature-action-layer"}),this.map.addLayer(this._markerLayer),this.map.snappingManager){var f=this.map.snappingManager.layerInfos;f.push({layer:this._markerLayer});this.map.snappingManager.setLayerInfos(f)}},_removeMarker:function(f){f=f.features[0];f._textSymbol&&this._markerLayer.remove(f._textSymbol);this._markerLayer.remove(f);this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_isFeatureInMarkerFeatureActionLayer:function(f){return f.features[0]&&
f.features[0]._graphicsLayer&&f.features[0]._graphicsLayer.id?"marker-feature-action-layer"===f.features[0]._graphicsLayer.id:!1}})})},"jimu/featureActions/SaveToMyContent":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/graphicsUtils esri/IdentityManager jimu/portalUtils jimu/portalUrlUtils jimu/Role jimu/dijit/Message ../BaseFeatureAction jimu/dijit/Popup jimu/dijit/AddItemForm".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m,a){return r(b,{name:"SaveToMyContent",
iconClass:"icon-save",isFeatureSupported:function(a){return 0>=a.features.length||!a.features[0].geometry?!1:!0},onExecute:function(b,d){this.checkPrivilege().then(f.hitch(this,function(c){if(c)var g=new a({appConfig:this.appConfig}),h=new m({content:g,titleLabel:window.jimuNls.featureActions.SaveToMyContent,width:525,height:220,buttons:[{label:window.jimuNls.common.ok,onClick:f.hitch(this,function(){g.showBusy();h.disableButton(0);g.validate().then(f.hitch(this,function(a){a.valid?this._addItem(b,
d,g):(g.hideBusy(),h.enableButton(0))}))})},{label:window.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:f.hitch(this,function(){h.close()})}]});else new e({message:window.jimuNls.noEditPrivileges})}))},checkPrivilege:function(){var a=h.getStandardPortalUrl(this.appConfig.portalUrl),b=k.getPortal(a);if(b){if(b.haveSignIn())return this._hasPrivilege(b);n.useSignInPage=!1;return b.signIn().then(f.hitch(this,function(){n.useSignInPage=!0;return this._hasPrivilege(b)}),f.hitch(this,function(){n.useSignInPage=
!0}))}a=new c;a.resolve(!1);return a},_hasPrivilege:function(a){return a.loadSelfInfo().then(f.hitch(this,function(a){if(a&&a.user){var b=new t({id:a.user.roleId?a.user.roleId:a.user.role,role:a.user.role});a.user.privileges&&b.setPrivileges(a.user.privileges);return b.canCreateItem()&&b.canPublishFeatures()}return!1}),function(){return!1})},_addItem:function(a,b,c){var d=c.getName(),g=c.getFolderId(),h=c.popup;b=b||{};var m={name:b.name||b.id,type:b.type||"Feature Layer",displayField:b.displayField,
description:b.description,copyrightText:b.copyright,geometryType:b.geometryType||a.geometryType,fields:b.fields||a.fields,objectIdField:b.objectIdField};a.features[0].geometry&&(b=q.graphicsExtent(a.features),m.initialExtent=b,m.fullExtent=b,m.extent=b);!m.objectIdField&&m.fields&&l.some(m.fields,function(a){if("esriFieldTypeOID"===a.type)return m.objectIdField=a.name,!0});a={layers:[{layerDefinition:m,featureSet:a.toJson()}]};c.addItem({name:d,title:d,type:"Feature Collection",typeKeywords:"WAB_created",
text:p.stringify(a)},g).then(f.hitch(this,function(a){!0===a.success?h.close():(c.hideBusy(),h.enableButton(0),new e({message:a.error?a.error.message:""}))}),function(a){c.hideBusy();h.enableButton(0);new e({message:a.message})})}})})},"jimu/dijit/AddItemForm":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/AddItemForm.html jimu/portalUtils jimu/portalUrlUtils dojo/data/ItemFileWriteStore dijit/form/ValidationTextBox dijit/form/FilteringSelect jimu/dijit/LoadingShelter".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e){return r([c,q,n],{baseClass:"jimu-item-form",templateString:k,appConfig:null,folderStore:null,portalUser:null,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);var b=t.getStandardPortalUrl(this.appConfig.portalUrl);h.getPortal(b).getUser().then(f.hitch(this,function(b){this.portalUser=b;return b.getContent()})).then(f.hitch(this,function(b){this.folderStore=this._createFolderStore(b.folders,this.portalUser.username);
this.itemFolder.set("store",this.folderStore);this.itemFolder.set("required",!0);this.itemFolder.set("searchAttr","name");this.itemFolder.set("displayedValue",this.portalUser.username)}))},getName:function(){return this.itemName.get("value")},getFolderId:function(){return this.itemFolder.item?this.folderStore.getValue(this.itemFolder.item,"id"):""},showBusy:function(){this.shelter.show()},hideBusy:function(){this.shelter.hide()},validate:function(){var b=new p;this.itemForm.validate()?b.resolve({valid:!0}):
b.resolve({valid:!1,message:"param requried"});return b},addItem:function(b,e){if(this.portalUser)return this.portalUser.addItem(b,e);b=new p;b.resolve({error:{message:"portalUser is null"}});return b},_createFolderStore:function(b,c){var a=new e({data:{identifier:"id",label:"name",items:[]}});a.newItem({name:c,id:""});l.forEach(b,function(b){a.newItem({name:b.title,id:b.id})});return a}})})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","./MappedTextBox",
"./ComboBoxMixin"],function(r,f,l,p,c){return r("dijit.form.FilteringSelect",[p,c],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(c,f,k,h){f&&f[this.searchAttr]!==this._lastQuery||!f&&c.length&&this.store.getIdentity(c[0])!=this._lastQuery||(c.length?this.set("item",c[0],h):this.set("value",
"",h||void 0===h&&!this.focused,this.textbox.value,null))},_openResultList:function(c,f,k){f[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(c,n,k,h){this._onChangeActive||(n=null);if(void 0===h){if(null===c||""===c)if(c="",!f.isString(k)){this._setDisplayedValueAttr(k||"",n);return}var t=this;this._lastQuery=c;l(this.store.get(c),
function(e){t._callbackSetLabel(e?[e]:[],void 0,void 0,n)})}else this.valueNode.value=c,this.inherited(arguments,[c,n,k,h])},_setItemAttr:function(c,f,k){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(c){return c.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(c,n){null==c&&(c="");if(!this._created){if(!("displayedValue"in this.params))return;n=!1}if(this.store){this.closeDropDown();var k=f.clone(this.query),h=this._getDisplayQueryString(c),
t;this.store._oldAPI?t=h:(t=this._patternToRegExp(h),t.toString=function(){return h});this._lastQuery=k[this.searchAttr]=t;this._lastDisplayedValue=this.textbox.value=c;this._set("displayedValue",c);var e=this,b={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};f.mixin(b,this.fetchProperties);this._fetchHandle=this.store.query(k,b);l(this._fetchHandle,function(c){e._fetchHandle=null;e._callbackSetLabel(c||[],k,b,n)},function(b){e._fetchHandle=null;e._cancelingQuery||console.error("dijit.form.FilteringSelect: "+
b.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(r,f,l,p){return r("dijit.form.MappedTextBox",p,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(c){return c.toString?c.toString():""},toString:function(){var c=this.filter(this.get("value"));return null!=
c?"string"==typeof c?c:this.serialize(c,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=l.place("\x3cinput type\x3d'hidden'"+(this.name&&!f("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(r,f,l,p,c,q,n,k,h){return r("dijit.form.ComboBoxMixin",[k,q],{dropDownClass:n,hasDownArrow:!0,templateString:h,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(c){this._set("hasDownArrow",c);this._buttonNode.style.display=c?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(h){h.get||p.mixin(h,{_oldAPI:!0,get:function(e){var b=new f;this.fetchItemByIdentity({identity:e,
onItem:function(e){b.resolve(e)},onError:function(e){b.reject(e)}});return b.promise},query:function(e,b){var h=new f(function(){a.abort&&a.abort()});h.total=new f;var a=this.fetch(p.mixin({query:e,onBegin:function(a){h.total.resolve(a)},onComplete:function(a){h.resolve(a)},onError:function(a){h.reject(a)}},b));return c(h)}});this._set("store",h)},postMixInProperties:function(){var c=this.params.store||this.store;c&&this._setStoreAttr(c);this.inherited(arguments);if(!this.params.store&&this.store&&
!this.store._oldAPI){var e=this.declaredClass;p.mixin(this.store,{getValue:function(b,c){l.deprecated(e+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return b[c]},getLabel:function(b){l.deprecated(e+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return b.name},fetch:function(b){l.deprecated(e+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],
p.hitch(this,function(e){(new e({objectStore:this})).fetch(b)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(r,f,l,p,c,q,n,k,h,t,e){f=f("dijit.form._AutoCompleterMixin",e,{item:null,
autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(b){var e=0;if("number"==typeof b.selectionStart)e=b.selectionStart;else if(k("ie")){var a=b.ownerDocument.selection.createRange().duplicate();b=b.createTextRange();a.move("character",0);b.move("character",0);try{b.setEndPoint("EndToEnd",a),e=String(b.text).replace(/\r/g,"").length}catch(g){}}return e},_setCaretPos:function(b,e){e=parseInt(e);t.selectInputText(b,e,e)},_setDisabledAttr:function(b){this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",b?"true":"false")},_onKey:function(b){if(!(32<=b.charCode)){var e=b.charCode||b.keyCode;if(e!=p.ALT&&e!=p.CTRL&&e!=p.META&&e!=p.SHIFT){var a=this.dropDown,c=null;this._abortQuery();this.inherited(arguments);if(!(b.altKey||b.ctrlKey||b.metaKey))switch(this._opened&&(c=a.getHighlightedOption()),e){case p.PAGE_DOWN:case p.DOWN_ARROW:case p.PAGE_UP:case p.UP_ARROW:this._opened&&this._announceOption(c);b.stopPropagation();b.preventDefault();break;case p.ENTER:if(c){if(c==
a.nextButton){this._nextSearch(1);b.stopPropagation();b.preventDefault();break}else if(c==a.previousButton){this._nextSearch(-1);b.stopPropagation();b.preventDefault();break}b.stopPropagation();b.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case p.TAB:e=this.get("displayedValue");if(a&&(e==a._messages.previousMessage||e==a._messages.nextMessage))break;c&&this._selectOption(c);case p.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},
_autoCompleteText:function(b){var e=this.focusNode;t.selectInputText(e,e.value.length);var a=this.ignoreCase?"toLowerCase":"substr";0==b[a](0).indexOf(this.focusNode.value[a](0))?(a=this.autoComplete?this._getCaretPos(e):e.value.length,a+1>e.value.length&&(e.value=b,t.selectInputText(e,a))):(e.value=b,t.selectInputText(e))},_openResultList:function(b,e,a){var f=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();b.length||0!=a.start?(this._nextSearch=this.dropDown.onPage=c.hitch(this,
function(a){b.nextPage(-1!==a);this.focus()}),this.dropDown.createOptions(b,a,c.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in a?(a.direction?this.dropDown.highlightFirstOption():a.direction||this.dropDown.highlightLastOption(),f&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(e[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},
_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var b=this.get("displayedValue"),e=this.dropDown;!e||b!=e._messages.previousMessage&&b!=e._messages.nextMessage?"undefined"==typeof this.item?
(this.item=null,this.set("displayedValue",b)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(b,e,a){var c="";b&&(a||(a=this.store._oldAPI?this.store.getValue(b,this.searchAttr):b[this.searchAttr]),c=this._getValueField()!=this.searchAttr?this.store.getIdentity(b):a);this.set("value",c,e,a,b)},_announceOption:function(b){if(b){var e;
if(b==this.dropDown.nextButton||b==this.dropDown.previousButton)e=b.innerHTML,this.item=void 0,this.value="";else{var a=this.dropDown.items[b.getAttribute("item")];e=(this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]).toString();this.set("item",a,!1,e)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",l.get(b,"id"));this._autoCompleteText(e)}},_selectOption:function(b){this.closeDropDown();b&&
this._announceOption(b);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(b){if(!this.dropDown){var e=this.id+"_popup";this.dropDown=new (c.isString(this.dropDownClass)?c.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:c.hitch(this,
this._selectOption),id:e,dir:this.dir,textDir:this.textDir})}this._lastInput=b;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new h({},this.srcNodeRef),!("value"in this.params))){var b=this.item=this.store.fetchSelectedItem();if(b){var e=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(b,e):b[e]}}},postCreate:function(){var b=q('label[for\x3d"'+
this.id+'"]');b.length&&(b[0].id||(b[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",b[0].id));this.inherited(arguments);r.after(this,"onSearch",c.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(b){b=this.labelFunc(b,this.store);var e=this.labelType;"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(b=this.doHighlight(b,this._lastInput),e="html");return{html:"html"==e,label:b}},doHighlight:function(b,e){var a=(this.ignoreCase?"i":"")+("all"==
this.highlightMatch?"g":""),c=this.queryExpr.indexOf("${0}");e=n.escapeString(e);return this._escapeHtml(b.replace(new RegExp((0==c?"^":"")+"("+e+")"+(c==this.queryExpr.length-4?"$":""),a),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(b){return b=String(b).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},
labelFunc:function(b,e){return(e._oldAPI?e.getValue(b,this.labelAttr||this.searchAttr):b[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(b,e,a,c){this._set("item",c||null);null==b&&(b="");this.inherited(arguments)}});k("dojo-bidi")&&f.extend({_setTextDirAttr:function(b){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",b)}});return f})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),
function(r,f,l,p,c,q){function n(c){return{id:c.value,value:c.value,name:l.trim(c.innerText||c.textContent||"")}}return r("dijit.form.DataList",c,{constructor:function(c,h){this.domNode=f.byId(h);l.mixin(this,c);this.id&&q.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:p("option",this.domNode).map(n)}])},destroy:function(){q.remove(this.id)},fetchSelectedItem:function(){var c=p("\x3e option[selected]",this.domNode)[0]||p("\x3e option",this.domNode)[0];return c&&n(c)}})})},
"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(r,f,l,p,c,q,n){return r("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(c){this._set("list",c)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(c){return new RegExp("^"+c.replace(/(\\.)|(\*)|(\?)|\W/g,function(c,f,e,b){return e?".*":
b?".":f?f:"\\"+c})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(c){if(!this.disabled&&
!this.readOnly){c=c.charOrCode;this._prev_key_backspace=!1;if(c==f.DELETE||c==f.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(f){this._abortQuery();var h=this,k=l.clone(this.query),e={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},b=c.substitute(this.queryExpr,
[f.replace(/([\\\*\?])/g,"\\$1")]),m,a=function(){var b=h._fetchHandle=h.store.query(k,e);h.disabled||h.readOnly||m!==h._lastQuery||q(b,function(d){h._fetchHandle=null;h.disabled||h.readOnly||m!==h._lastQuery||q(b.total,function(b){d.total=b;var c=h.pageSize;if(isNaN(c)||c>d.total)c=d.total;d.nextPage=function(b){e.direction=b=!1!==b;e.count=c;b?(e.start+=d.length,e.start>=d.total&&(e.count=0)):(e.start-=c,0>e.start&&(e.count=Math.max(c+e.start,0),e.start=0));0>=e.count?(d.length=0,h.onSearch(d,k,
e)):a()};h.onSearch(d,k,e)})},function(a){h._fetchHandle=null;h._cancelingQuery||console.error(h.declaredClass+" "+a.toString())})};l.mixin(e,this.fetchProperties);this.store._oldAPI?m=b:(m=this._patternToRegExp(b),m.toString=function(){return b});this._lastQuery=k[this.searchAttr]=m;this._queryDeferHandle=this.defer(a,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var c=this.list;c&&(this.store=n.byId(c))}this.inherited(arguments)}})})},
"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(r,f,l,p,c,q,n,k){return r("dijit.form._ComboBoxMenu",[c,q,k,n],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(f.add(this.previousButton,"dijitMenuItemRtl"),f.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var c=this.ownerDocument.createElement("div");c.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");c.setAttribute("role","option");return c},onHover:function(c){f.add(c,"dijitMenuItemHover")},onUnhover:function(c){f.remove(c,
"dijitMenuItemHover")},onSelect:function(c){f.add(c,"dijitMenuItemSelected")},onDeselect:function(c){f.remove(c,"dijitMenuItemSelected")},_page:function(c){var f=0,e=this.domNode.scrollTop,b=l.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();f<b;){var h=this.getHighlightedOption();if(c){if(!h.previousSibling||"none"==h.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!h.nextSibling||"none"==h.nextSibling.style.display)break;this.selectNextNode()}h=
this.domNode.scrollTop;f+=(h-e)*(c?-1:1);e=h}},handleKey:function(c){switch(c.keyCode){case p.DOWN_ARROW:return this.selectNextNode(),!1;case p.PAGE_DOWN:return this._page(!1),!1;case p.UP_ARROW:return this.selectPreviousNode(),!1;case p.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(r,f,l,p,c){var q=f("dijit.form._ComboBoxMenuMixin"+
(p("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=c.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(c){this._set("value",c);this.onChange(c)},onClick:function(c){if(c==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(c==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(c)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(c,f){var h=this._createMenuItem();c=f(c);c.html?h.innerHTML=c.label:h.appendChild(h.ownerDocument.createTextNode(c.label));""==h.innerHTML&&(h.innerHTML="\x26#160;");return h},createOptions:function(c,f,h){this.items=c;this.previousButton.style.display=0==f.start?"none":"";l.set(this.previousButton,"id",this.id+
"_prev");r.forEach(c,function(e,b){e=this._createOption(e,h);e.setAttribute("item",b);l.set(e,"id",this.id+b);this.nextButton.parentNode.insertBefore(e,this.nextButton)},this);var k=!1;c.total&&!c.total.then&&-1!=c.total?f.start+f.count<c.total?k=!0:f.start+f.count>c.total&&f.count==c.length&&(k=!0):f.count==c.length&&(k=!0);this.nextButton.style.display=k?"":"none";l.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var c=this.containerNode;2<c.childNodes.length;)c.removeChild(c.childNodes[c.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});p("dojo-bidi")&&(q=f("dijit.form._ComboBoxMenuMixin",
q,{_createOption:function(){var c=this.inherited(arguments);this.applyTextDir(c);return c}}));return q})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(r,f,l,p){return r("dijit.form._ListMouseMixin",p,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(c,f){this._setSelectedAttr(f,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(f)})},_onMouseDown:function(c,f){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(f,!1)},_onMouseUp:function(c,f){this._isDragging=!1;var n=this.selected,k=this._hoveredNode;n&&f==n?this.defer(function(){this._onClick(c,
n)}):k&&this.defer(function(){this._onClick(c,k)})},_onMouseOut:function(c,f){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(c,f){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=f;this.onHover(f);this._isDragging&&this._setSelectedAttr(f,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(r,f,l){return r("dijit.form._ListBase",null,{selected:null,_listConnect:function(l,c){var p=this;return p.own(f(p.containerNode,f.selector(function(c,f,h){return c.parentNode==h},l),function(f){p[c](f,this)}))},selectFirstNode:function(){for(var f=this.containerNode.firstChild;f&&"none"==f.style.display;)f=f.nextSibling;this._setSelectedAttr(f,!0)},selectLastNode:function(){for(var f=this.containerNode.lastChild;f&&"none"==f.style.display;)f=f.previousSibling;this._setSelectedAttr(f,
!0)},selectNextNode:function(){var f=this.selected;if(f){for(f=f.nextSibling;f&&"none"==f.style.display;)f=f.nextSibling;f?this._setSelectedAttr(f,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var f=this.selected;if(f){for(f=f.previousSibling;f&&"none"==f.style.display;)f=f.previousSibling;f?this._setSelectedAttr(f,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(f,c){if(this.selected!=f){var p=this.selected;if(p)this.onDeselect(p);
f&&(c&&l.scrollIntoView(f),this.onSelect(f));this._set("selected",f)}else if(f)this.onSelect(f)}})})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(r,f,l,p,c){return r([f,l],{baseClass:"jimu-loading-shelter jimu-agol-loading",declaredClass:"jimu.dijit.LoadingShelter",templateString:p,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=
window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&c.setStyle(this.domNode,"display","none");c.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||c.setStyle(this.loadingNode,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(f){this.domNode&&this.hidden&&("string"===typeof f&&(this.textNode.innerHTML=f),c.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&
!this.hidden&&(c.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/dijit/FeatureActionPopupMenu":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/array jimu/accessibleUtils dojo/on dojo/keys dijit/a11yclick dojo/dom-geometry dijit/_WidgetBase dijit/_TemplatedMixin jimu/FeatureActionManager ./FeatureActionPopupMenuItem".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m){var a=null,g=r([t,e],{baseClass:"popup-menu",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"menuNode" class\x3d"menu-content"\x3e\x3cdiv class\x3d"menu-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv role\x3d"title" class\x3d"label jimu-float-leading" data-dojo-attach-point\x3d"labelNode" tabindex\x3d"0"\x3e\x3c/div\x3e\x3cdiv class\x3d"feature-action icon-close close-btn jimu-float-trailing" data-dojo-attach-point\x3d"closeBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"menu-items" data-dojo-attach-point\x3d"menuContent" tabindex\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._setFocusedNodeBeforeOpen();this.inherited(arguments);this.hide();this.menuItems=[];this.own(q(this.domNode,"click",l.hitch(this,function(a){a=a.target||a.srcElement;a===this.menuNode||f.isDescendant(a,this.menuNode)||this.hide()})));this._a11y_addEvents()},_setFocusedNodeBeforeOpen:function(){this.focusedNodeBeforeOpen=document.activeElement},_a11y_addEvents:function(){this.own(q(this.labelNode,"keydown",l.hitch(this,function(a){a.shiftKey&&a.keyCode===n.TAB&&(a.preventDefault(),
this.hide())})));this.own(q(this.closeBtn,k,l.hitch(this,this.hide)));this.own(q(this.menuContent,"focus",l.hitch(this,function(){this.currentMenuItem=this.menuItems[0].domNode;p.forEach(this.menuItems,function(a){f.hasClass(a.domNode,"selected")&&(this.currentMenuItem=a.domNode)});this.currentMenuItem.focus()})));this.own(q(this.menuContent,"keydown",l.hitch(this,function(a){a.keyCode===n.ESCAPE&&(a.stopPropagation(),this.hide());if(f.hasClass(a.target,"popup-menu-item"))if(a.keyCode!==n.TAB||(!a.shiftKey||
this.hasTitle)&&a.shiftKey){var b;a.keyCode===n.DOWN_ARROW?b=this.currentMenuItem.nextSibling?this.currentMenuItem.nextSibling:this.currentMenuItem:a.keyCode===n.UP_ARROW?b=this.currentMenuItem.previousSibling?this.currentMenuItem.previousSibling:this.currentMenuItem:a.keyCode===n.HOME?b=this.menuItems[0].domNode:a.keyCode===n.END&&(b=this.menuItems[this.menuItems.length-1].domNode);b&&(this.currentMenuItem=b,b.focus())}else a.preventDefault(),this.hide()})))},setActions:function(a){this.clearActions();
p.forEach(a,l.hitch(this,this._addMenuItem))},appendAction:function(a){this._addMenuItem(a)},clearActions:function(){this.menuItems=[];f.empty(this.menuContent)},_addMenuItem:function(a){var b=new m({action:a});f.place(b.domNode,this.menuContent);b.startup();this.menuItems.push(b);this.own(q(b,"click",l.hitch(this,function(a){a?(a=0<=["ShowStatistics","SaveToMyContent","ChangeSymbol"].indexOf(b.action.name),c.isInNavMode()&&a||this.hide()):this.hide()})))},markAsSelected:function(a){p.forEach(this.menuItems,
function(b){b.action.label===a.label?b.setSelected(!0):b.setSelected(!1)})},prepareActions:function(a,e){return b.getInstance().getSupportedActions(a).then(l.hitch(this,function(b){!1===e&&(b=p.filter(b,function(a){return 0!==a.name.indexOf("Export")&&"SaveToMyContent"!==a.name}));p.forEach(b,function(b){b.data=a},this);this.setActions(b)}))},hide:function(){f.setStyle(this.domNode,"display","none");this.focusedNodeBeforeOpen&&this.focusedNodeBeforeOpen.focus()},show:function(a,b){if(0===this.menuItems.length)f.setStyle(this.domNode,
"display","none");else{"string"===typeof b&&""!==b?(this.labelNode.innerHTML=b,f.setStyle(this.titleNode,"display","")):(this.labelNode.innerHTML="",f.setStyle(this.titleNode,"display","none"));var d=a.y+a.h,e;a=window.isRTL?a.x:a.x+a.w;f.setStyle(this.domNode,"display","");f.setStyle(this.menuNode,{left:"-1000px",top:"0px",display:"block"});e=h.getMarginSize(this.menuNode);f.setStyle(this.menuNode,{left:(window.isRTL?a+e.w>window.innerWidth?window.innerWidth-e.w:0>a?0:a:0>a-e.w?0:a>window.innerWidth?
window.innerWidth-e.w:a-e.w)+"px",top:(e.h>window.innerHeight?0:d+e.h>window.innerHeight?window.innerHeight-e.h:d+e.h+5<window.innerHeight?d+5:d)+"px"});"string"===typeof b&&""!==b?(this.labelNode.focus(),this.hasTitle=!0):(this.menuContent.focus(),this.hasTitle=!1)}}});g.getInstance=function(){null===a&&(a=new g,f.place(a.domNode,document.body),a.startup());a.setActions([]);return a};return g})},"jimu/dijit/FeatureActionPopupMenuItem":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/_base/event dojo/on dojo/keys dojo/mouse dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin".split(" "),
function(r,f,l,p,c,q,n,k,h,t){return r([h,t,k],{baseClass:"popup-menu-item",templateString:'\x3cdiv role\x3d"option" tabindex\x3d"-1"\x3e\x3cdiv class\x3d"icon jimu-float-leading" data-dojo-attach-point\x3d"iconContainer"\x3e\x3cdiv class\x3d"feature-action" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"label" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\x3c/div\x3e',action:null,postCreate:function(){this.inherited(arguments);this.action&&(this.labelNode.innerHTML=
this.action.label,this.labelNode.title=this.action.label,this.action.iconClass?("no-icon"===this.action.iconClass&&f.addClass(this.iconContainer,"no-icon"),f.addClass(this.iconNode,this.action.iconClass)):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")"),this.own(c(this.domNode,n.enter,l.hitch(this,this._useHoverIcon))),this.own(c(this.domNode,n.leave,l.hitch(this,this._useNormalIcon))));this.own(c(this.domNode,"click",l.hitch(this,this._clickHandler)));this.own(c(this.domNode,
"keydown",l.hitch(this,function(e){e.keyCode===q.ENTER&&this._clickHandler(e,!0)})))},setSelected:function(e){e?f.addClass(this.domNode,"selected"):f.removeClass(this.domNode,"selected")},_useNormalIcon:function(){this.action.iconClass?f.removeClass(this.iconNode,"highlight"):f.setStyle(this.iconNode,"background-image","url("+this.action.getIcon("default")+")")},_useHoverIcon:function(){this.action.iconClass?f.addClass(this.iconNode,"highlight"):f.setStyle(this.iconNode,"background-image","url("+
this.action.getIcon("hover")+")")},_clickHandler:function(e,b){p.stop(e);if(this.action){var c;this.action.data.features&&0<this.action.data.features.length&&(c=this.action.data.features[0].getLayer());this.action.onExecute(this.action.data,c)}this.emit("click",{isEnter:b})}})})},"jimu/RelatedRecordsPopupProjector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/has dojo/query dojo/Deferred dojo/promise/all dijit/_WidgetBase dijit/_TemplatedMixin esri/undoManager esri/OperationBase esri/tasks/RelationshipQuery esri/dijit/Popup esri/dijit/PopupMobile esri/graphicsUtils esri/dijit/PopupTemplate jimu/utils jimu/ConfigManager jimu/dijit/DropdownMenu jimu/LayerInfos/LayerInfos".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C,D){var y=r([t,e],{baseClass:"related-records-popup-projector",templateString:"\x3cdiv\x3e\x3cdiv class\x3d'operation-box' data-dojo-attach-point\x3d'operationBox' style\x3d'display: none'\x3e\x3cdiv class\x3d'previos-btn feature-action' data-dojo-attach-point\x3d'previouBtn'data-dojo-attach-event\x3d'click:_onPreviouBtnClick'\x3e\x3c/div\x3e\x3cdiv class\x3d'operation-title' data-dojo-attach-point\x3d'operationTitle'\x3eabc\x3c/div\x3e\x3cdiv class\x3d'add-new-btn' data-dojo-attach-point\x3d'addNewBtn'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'content-box' data-dojo-attach-point\x3d'contentBox'\x3e\x3c/div\x3e\x3c/div\x3e",
popup:null,popupManager:null,undoManager:null,originalFeature:null,originalJimuLayerInfo:null,_temporaryData:null,postCreate:function(){this.undoManager=new b;this.layerInfosObj=D.getInstanceSync();var a=f.getObject("_wabProperties.referToFeatureLayerId",!1,this.originalFeature)||this.originalFeature.getLayer().id;this.originalJimuLayerInfo=this.layerInfosObj.getLayerInfoById(a);this._temporaryData={eventHandles:[],dijits:[]};window.isRTL?p.addClass(this.previouBtn,"icon-arrow-forward"):p.addClass(this.previouBtn,
"icon-arrow-back");a=this._createOperation({feature:this.originalFeature,oriJimuLayerInfo:this.originalJimuLayerInfo});this.showRelatedTables(a);this.popupUIController="esri.dijit.Popup"===this.popup.declaredClass?new y.PopupUIController(this):new y.PopupMobileUIController(this);this.popupUIController.addDomNode(this.domNode)},destroy:function(){this._clearPage();this.undoManager.destroy();this.popupUIController.destroy();this.inherited(arguments)},_getRelatedTableInfoArray:function(a){a=a.data.oriJimuLayerInfo;
var b=new k;a.getRelatedTableInfoArray().then(f.hitch(this,function(a){b.resolve(a)}));return b},_getRelatedRecordsByRelatedQuery:function(a){return a.oriJimuLayerInfo.getRelatedRecords(a.feature,a.destJimuLayerInfo,a.relationshipIndex)},_ignoreCaseToGetFieldObject:function(a,b){var d=null;b&&a&&a.fields&&l.some(a.fields,function(a){if(a.name.toLowerCase()===b.toLowerCase())return d=a,!0});return d},getLocaleDateTime:function(a){return B.localizeDate(new Date(a),{fullYear:!0,formatLength:"medium"})},
_getDisplayTitleOfRelatedRecord:function(a,b,d){var e=a.getInfoTemplate();return(a="popupTitle"===d&&e?"function"===typeof e.title?e.title(b):e.title:this._getDisplayTitleFromPopup(a,b,d))?a:" "},_getDisplayTitleFromPopup:function(a,b,d){(a=this._getPopupTemplateWithOnlyDisplayField(a,d))?(b.setInfoTemplate(a),d=this.popupUIController.getDisplayTitle(b),b.setInfoTemplate(null)):d=b.attributes[d];return d},_getPopupTemplateWithOnlyDisplayField:function(a,b){a=a.getPopupInfo()||a._getDefaultPopupInfo(a.layerObject);
var d={title:"",fieldInfos:[],description:"",showAttachments:!1,mediaInfos:[]};try{a&&a.fieldInfos&&b&&l.some(a.fieldInfos,function(a){return a.fieldName.toLowerCase()===b.toLowerCase()?(a=f.clone(a),a.visible=!0,d.fieldInfos.push(a),!0):!1},this)}catch(E){console.error(E)}return new v(d)},_canShowRelatedData:function(a){var b=!0;(a=a.getPopupInfo())&&a.relatedRecordsInfo&&(b=!1!==a.relatedRecordsInfo.showRelatedRecords);return b},setPopupContent:function(a){this._clearPage();a.data.destJimuLayerInfo?
a.data.relatedFeature||this.showRelatedRecords(a):this.showFeature(a);this.undoManager.peekUndo()?this.popupUIController.changeRefDomNode():this.popupUIController.revertRefDomNode()},showFeature:function(a){var b=a.data,d=b.oriJimuLayerInfo.layerObject,e=f.getObject("_wabProperties.originalLayerName",!1,d)||b.oriJimuLayerInfo.title,d=f.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,d),c=this._getDisplayTitleOfRelatedRecord(b.oriJimuLayerInfo,b.feature,d);"popupTitle"!==d&&
(c=e+": "+c);this._setOperationTitle(c);f.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",null,b.oriJimuLayerInfo.layerObject);b.oriJimuLayerInfo.loadInfoTemplate().then(f.hitch(this,function(d){b.oriJimuLayerInfo.layerObject.infoTemplate||a.data.feature.setInfoTemplate(d);this.popupUIController.setFeature(a.data.feature);b.oriJimuLayerInfo.layerObject.infoTemplate||a.data.feature.setInfoTemplate(null)}));this.showRelatedTables(a);this.popupManager.initPopupMenu([a.data.feature]);
this.popupUIController.updateZoomToBtn([a.data.feature])},showRelatedRecords:function(a){var b=a.data,d=f.getObject("_wabProperties.originalLayerName",!1,b.destJimuLayerInfo.layerObject)||b.destJimuLayerInfo.title;this._setOperationTitle(d);this._clearPage();f.setObject("_wabProperties.popupInfo.operationDataForListRelatedRecords",b,b.destJimuLayerInfo.layerObject);f.setObject("_wabProperties.popupInfo.originalFeature",this.originalFeature,b.destJimuLayerInfo.layerObject);f.setObject("_wabProperties.popupInfo.layerForActionWithEmptyFeatures",
b.destJimuLayerInfo.layerObject,this.popup);this._getRelatedRecordsByRelatedQuery(b).then(f.hitch(this,function(d){0<d.length?this._setTitle(window.jimuNls.popup.relatedRecords):this._setTitle(window.jimuNls.popup.noRelatedRecotds,"font-normal");var e=this._showFieldSelector(b.destJimuLayerInfo);l.forEach(d,function(d,g){d._layer=b.destJimuLayerInfo.layerObject;var h=this._getDisplayTitleOfRelatedRecord(b.destJimuLayerInfo,d,e);g=p.create("div",{"class":"item record-item "+(0===g%2?"oddLine":"evenLine"),
innerHTML:h},this.contentBox);g.relatedRecord=d;g=c(g,"click",f.hitch(this,function(){this._addOperation(a);var e=this._createOperation({feature:d,oriJimuLayerInfo:b.destJimuLayerInfo,relationshipIndex:b.relationshipIndex});this.setPopupContent(e)}));this._temporaryData.eventHandles.push(g)},this);this.popupManager.initPopupMenu(d);this.popupUIController.updateZoomToBtn(d)}));this.popupUIController.setContent(this.domNode)},showRelatedTables:function(a){this._canShowRelatedData(a.data.oriJimuLayerInfo)&&
this._getRelatedTableInfoArray(a).then(f.hitch(this,function(b){0<b.length&&this._setTitle(window.jimuNls.popup.relatedTables);var d={};l.forEach(b,function(a){void 0===d[a.id]?d[a.id]=0:d[a.id]++},this);var e={};l.forEach(b,function(b,g){void 0===e[b.id]?e[b.id]=0:e[b.id]++;var m='\x3cdiv title\x3d"'+b.title+'"\x3e'+b.title+"\x3c/div\x3e",k=p.create("div",{"class":"item table-item "+(0===g%2?"oddLine":"evenLine"),innerHTML:m},this.contentBox),u=e[b.id];if(0<d[b.id]){g=a.data.oriJimuLayerInfo.getLayerObject();
var n=b.getLayerObject();h({oriLayerObject:g,relatedLayerObject:n}).then(f.hitch(this,function(b){b=a.data.oriJimuLayerInfo.getOriRelationshipByDestLayer(b.oriLayerObject,b.relatedLayerObject,u);b=b.name||b.id;k.innerHTML=m+('\x3cdiv class\x3d"relationshipName" title\x3d"'+b+'"\x3e('+b+")\x3c/div\x3e")}))}g=c(k,"click",f.hitch(this,function(){b.getLayerObject().then(f.hitch(this,function(){this._addOperation(a);var d=this._createOperation({feature:a.data.feature,oriJimuLayerInfo:a.data.oriJimuLayerInfo,
destJimuLayerInfo:b,relationshipIndex:u});this.setPopupContent(d)}))}));this._temporaryData.eventHandles.push(g)},this)}))},_createOperation:function(a){return new y.Operation({feature:a.feature||null,oriJimuLayerInfo:a.oriJimuLayerInfo||null,destJimuLayerInfo:a.destJimuLayerInfo||null,relatedFeature:a.relatedFeature||null,relationshipIndex:a.relationshipIndex||0},this)},_addOperation:function(a){this.undoManager.add(a)},_onPreviouBtnClick:function(){this.undoManager.undo()},_clearPage:function(){p.empty(this.contentBox);
l.forEach(this._temporaryData.eventHandles,function(a){a&&a.remove&&a.remove()},this);this._temporaryData.eventHandles=[];l.forEach(this._temporaryData.dijits,function(a){a&&a.destroy&&a.destroy()},this);this._temporaryData.dijits=[]},_setTitle:function(a,b){a&&p.create("div",{"class":"title-box "+(b?b:""),innerHTML:a},this.contentBox)},_setOperationTitle:function(a){p.setAttr(this.operationTitle,"innerHTML",a);p.setAttr(this.operationTitle,"title",a)},_showFieldSelector:function(a){var b="objecid",
d=n(".title-box",this.contentBox)[0],e=a.layerObject,g=[];if(!d||!a)return b;var h=a.getPopupInfo();h&&h.title&&g.push({label:window.jimuNls.popup.saveAsPopupTitle,value:"popupTitle"});var m=[];h&&h.fieldInfos?l.forEach(h.fieldInfos,function(a){var b={};a.visible&&(b.name=a.fieldName,b.alias=a.label,m.push(b))}):m=e.fields;l.forEach(m,function(a){"globalid"!==a.name.toLowerCase()&&"shape"!==a.name.toLowerCase()&&g.push({label:a.alias||a.name,value:a.name})});d=(new C({items:g})).placeAt(d);d.domNode.title=
window.jimuNls.popup.chooseFieldTip;var k=f.getObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",!1,e),u=this._ignoreCaseToGetFieldObject(a.layerObject,a.layerObject.displayField||a.layerObject.objectIdField),t=z.getInstance().getAppConfig();k?b=k:"2.3"===t.configWabVersion&&u&&u.name?b=u.name:h&&h.title?b="popupTitle":u&&u.name?b=u.name:0<g.length&&(b=g[0].value);b&&(d.setHighlightValue(b),f.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",b,e));this._temporaryData.dijits.push(d);
a=c(d,"click-item",f.hitch(this,function(a,b){n(".item.record-item",this.contentBox).forEach(f.hitch(this,function(d){f.setObject("_wabProperties.popupInfo.displayFieldOfRelatedRecordList",b,e);var c=this._getDisplayTitleOfRelatedRecord(a,d.relatedRecord,b);d.innerHTML=c}))},a));this._temporaryData.eventHandles.push(a);return b}});y.Operation=r([m],{constructor:function(a,b){this.data=a;this.relatedRecordsPopupProjector=b},performUndo:function(){this.relatedRecordsPopupProjector.setPopupContent(this)}});
y.PopupUIController=r([],{constructor:function(a){this.rrPopupProjector=a;this.popup=a.popup;this.initTempPopup();this._initTempPopupForDisplayTitle();this._initZoomToBtn();this._setScrollable()},initTempPopup:function(){this._tempPopup=new g({},p.create("div"))},_initTempPopupForDisplayTitle:function(){this._tempPopupForDisplayTitle=new g({},p.create("div"));this._tempPopupForDisplayTitle.show()},destroy:function(){this._tempPopup.destroy();this._tempPopupForDisplayTitle.destroy();this._zoomToBtnClickHandle&&
this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove();this._zoomToBtnANode&&p.destroy(this._zoomToBtnANode);this.toucemoveScrollHandle&&this.toucemoveScrollHandle.remove&&this.toucemoveScrollHandle.remove()},addDomNode:function(a){setTimeout(f.hitch(this,function(){var b=this._getRefDomNode();b&&p.place(a,b,"after")}),1)},setFeature:function(a){this._tempPopup.setFeatures([a]);if(a=n(".esriViewPopup",this._tempPopup.domNode)[0])this.setContent(a),p.place(this.rrPopupProjector.domNode,
a,"after"),this._unsetScrollable()},setContent:function(a){var b=n(".related-records-popup-projector").parent()[0];b&&b.removeChild(this.rrPopupProjector.domNode);this.popup.setContent(a);this._unsetScrollable()},_setScrollable:function(){var a=n(".contentPane",this.popup.domNode)[0];q("esri-touch")&&a&&(this.toucemoveScrollHandle=c(a,"touchmove",f.hitch(this,function(b){b.preventDefault();n(".esriViewPopup",this.popup.domNode)[0]&&(b=a.firstChild,b instanceof Text&&(b=a.childNodes[1]),this.rrPopupProjector.domNode&&
p.setStyle(this.rrPopupProjector.contentBox,{"-webkit-transition-property":"-webkit-transform","-webkit-transform":"translate("+b._currentX+"px, "+b._currentY+"px)"}))})))},_unsetScrollable:function(){p.setStyle(this.rrPopupProjector.contentBox,{"-webkit-transition-property":"none","-webkit-transform":"none"});p.setStyle(this.rrPopupProjector.domNode,{"-webkit-transition-property":"none","-webkit-transform":"none"})},getDisplayTitle:function(a){this._tempPopupForDisplayTitle.setFeatures([a]);return(a=
n("td.attrValue",this._tempPopupForDisplayTitle.domNode)[0])&&a.innerHTML},_getRefDomNode:function(){return this._getViewPopupDomNode()},_getViewPopupDomNode:function(){return n(".esriViewPopup",this.popup.domNode)[0]},_setPopupTitleInBody:function(){this.rrPopupProjector.undoManager.peekUndo()?this._tempPopup.set("titleInBody",!1):this._tempPopup.set("titleInBody",!0)},_initZoomToBtn:function(){var a=n(".actionList",this.popup.domNode)[0];this._oldZoomToBtnANdoe=n(".action",a)[0];this._zoomToBtnANode=
p.create("a",{"class":"action",style:"display: none",href:"javascript:void(0)"},a);this._zoomToBtn=p.create("span",{innerHTML:window.jimuNls.common.zoomTo},this._zoomToBtnANode);this._showOldZoomToBtn()},_hideZoomToBtn:function(){this._zoomToBtnANode&&p.setStyle(this._zoomToBtnANode,"display","none")},_showZoomToBtn:function(){this._zoomToBtnANode&&p.setStyle(this._zoomToBtnANode,"display","inline-block")},_hideOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&p.setStyle(this._oldZoomToBtnANdoe,"display",
"none")},_showOldZoomToBtn:function(){this._oldZoomToBtnANdoe&&p.setStyle(this._oldZoomToBtnANdoe,"display","inline-block")},updateZoomToBtn:function(a){this._hideOldZoomToBtn();!a||1>a.length||!a[0].geometry?this._hideZoomToBtn():(this._showZoomToBtn(),this._zoomToBtnClickHandle&&this._zoomToBtnClickHandle.remove&&this._zoomToBtnClickHandle.remove(),this._zoomToBtnClickHandle=c(this._zoomToBtn,"click",f.hitch(this,function(){var b=null;try{b=u.graphicsExtent(a)}catch(G){console.error(G)}b&&(this.rrPopupProjector.popupManager.mapManager.map.setExtent(b),
this.popup.hide())})))},changeRefDomNode:function(){p.setStyle(this.rrPopupProjector.operationBox,"display","block");p.addClass(this.rrPopupProjector.domNode,"second-page-mode");var a=this._getViewPopupDomNode();a&&p.addClass(a,"second-page-mode")},revertRefDomNode:function(){p.setStyle(this.rrPopupProjector.operationBox,"display","none");p.removeClass(this.rrPopupProjector.domNode,"second-page-mode");this._hideZoomToBtn();this._showOldZoomToBtn()}});y.PopupMobileUIController=r([y.PopupUIController],
{initTempPopup:function(){this._tempPopup=new d({},p.create("div"))},setFeature:function(a){this._tempPopup.setFeatures([a]);a=n(".esriMobileInfoView.esriMobilePopupInfoView",this._tempPopup.domNode)[0];if(a=n(".esriViewPopup",a)[0])this.setContent(a),p.place(this.rrPopupProjector.domNode,a,"after")},updateZoomToBtn:function(){},_initZoomToBtn:function(){},_getRefDomNode:function(){return n(".esriMobilePopupInfoView .esriMobileInfoViewItem")[1]},_getViewPopupDomNode:function(){var a=n(".esriMobileInfoView.esriMobilePopupInfoView")[0];
return n(".esriViewPopup",a)[0]}});return y})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented dojo/has!extend-esri?./OperationBase".split(" "),function(r,f,l,p,c,q){r=r([q],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(c){c=c||{};c.maxOperations&&
(this.maxOperations=c.maxOperations);this._historyStack=[]},add:function(c){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,0,c);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var c=this.peekUndo();this.position--;c?(c=c.performUndo(),this.onUndo(),this._checkAvailability(),p(c).then(f.hitch(this,this.onUndoComplete))):(this.onUndo(),
this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var c=this.peekRedo();this.position++;c?(c=c.performRedo(),this.onRedo(),this._checkAvailability(),p(c).then(f.hitch(this,this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=!0,this.canRedo=
!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<this._historyStack.length)return this.get(this.position)},
get:function(c){return this._historyStack[c]},remove:function(c){0<this._historyStack.length&&(this._historyStack.splice(c,1),0<this.position&&c<this.position&&this.position--,this._checkAvailability())},destroy:function(){this._historyStack=null}});l("extend-esri")&&(c.UndoManager=r);return r})},"esri/OperationBase":function(){define(["dojo/_base/declare","dojo/has","./kernel"],function(r,f,l){r=r(null,{declaredClass:"esri.OperationBase",type:"not implemented",label:"not implemented",constructor:function(f){f=
f||{};f.label&&(this.label=f.label)},performUndo:function(){console.log("performUndo has not been implemented")},performRedo:function(){console.log("performRedo has not been implemented")}});f("extend-esri")&&(l.OperationBase=r);return r})},"jimu/dijit/DropdownMenu":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/query dojo/Evented".split(" "),function(r,f,l,p,c,q,n,k,h){return r([f,l,h],{baseClass:"jimu-dijit-dropdownmenu",
declaredClass:"jimu.dijit.DropdownMenu",templateString:"\x3cdiv\x3e\x3c/div\x3e",itemHeight:24,iconSize:16,offsetY:5,shelter:null,paddingOffsetY:8,dropdownMenuClass:"",dropdownMenuItemClass:"dropdown-menu-item",items:null,highlightValue:"",highlightSelectedItemAfterClick:!0,menuLeadingIcon:!0,maxDisplayItems:10,postCreate:function(){this.inherited(arguments);this.items||(this.items=[]);this.shelter=q.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-shelter"\x3e\x3c/div\x3e');this.itemsContainer=q.toDom('\x3cdiv class\x3d"jimu-dijit-dropdownmenu-items-container '+
this.dropdownMenuClass+'"\x3e\x3c/div\x3e');0>=this.maxDisplayItems&&(this.maxDisplayItems=20);this.itemsContainer.style.maxHeight=this.itemHeight*this.maxDisplayItems+2*this.paddingOffsetY+"px";c.forEach(this.items,p.hitch(this,function(c){var e=q.toDom('\x3cdiv class\x3d"'+this.dropdownMenuItemClass+' jimu-ellipsis"\x3e'+c.label+"\x3c/div\x3e");e.itemInfo=c;e.title=c.label;q.place(e,this.itemsContainer)}));this.own(n(this.domNode,"click",p.hitch(this,this._onIconClick)));this.own(n(this.shelter,
"click",p.hitch(this,this._onShelterClick)));this.own(n(this.itemsContainer,"click",p.hitch(this,this._onItemsContainerClick)));this.highlightValue&&this.setHighlightValue(this.highlightValue)},_onIconClick:function(c,e){c.stopPropagation();this.isShowing()?this.hideMenu():(c=q.position(e||c.target||c.srcElement),this.showMenu(c))},_onShelterClick:function(){this.hideMenu()},_onItemsContainerClick:function(c){c.stopPropagation();c=c.target||c.srcElement;q.hasClass(c,this.dropdownMenuItemClass)&&(c=
c.itemInfo.value,this.highlightSelectedItemAfterClick&&this.setHighlightValue(c),this.emit("click-item",c));this.hideMenu()},clearHighlightValue:function(){k("."+this.dropdownMenuItemClass,this.itemsContainer).removeClass("selected")},setHighlightValue:function(c){this.clearHighlightValue();k("."+this.dropdownMenuItemClass,this.itemsContainer).some(p.hitch(this,function(e){return e.itemInfo.value===c?(q.addClass(e,"selected"),!0):!1}))},getHighlightValue:function(){var c=k("."+this.dropdownMenuItemClass+
".selected",this.itemsContainer)[0];return c?c.itemInfo.value:null},getHighlightLabel:function(){var f=this.getHighlightValue(),e="";c.some(this.items,function(b){return b.value===f?(e=b.label,!0):!1},this);return e},isShowing:function(){return q.hasClass(this.domNode,"showing")},showMenu:function(c){this.itemsContainer.style.top=c.y+this.iconSize+this.offsetY+"px";this.menuLeadingIcon===window.isRTL?(this.itemsContainer.style.left=c.x+"px",this.itemsContainer.style.right="auto"):(this.itemsContainer.style.right=
window.innerWidth-(c.x+this.iconSize)+"px",this.itemsContainer.style.left="auto");q.place(this.shelter,document.body);q.place(this.itemsContainer,document.body);q.addClass(this.domNode,"showing")},hideMenu:function(){this.itemsContainer.parentNode&&this.itemsContainer.parentNode.removeChild(this.itemsContainer);this.shelter.parentNode&&this.shelter.parentNode.removeChild(this.shelter);q.removeClass(this.domNode,"showing")},destroy:function(){this.hideMenu();q.destroy(this.itemsContainer);q.destroy(this.shelter);
this.inherited(arguments)}})})},"jimu/FilterManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","esri/lang","./LayerInfos/LayerInfos"],function(r,f,l,p,c){var q=null,n=r(null,{_filters:null,layerInfos:null,constructor:function(){this._filters={};window.isBuilder?(l.subscribe("app/mapLoaded",f.hitch(this,this._onMapLoaded)),l.subscribe("app/mapChanged",f.hitch(this,this._onMapChanged))):(l.subscribe("mapLoaded",f.hitch(this,this._onMapLoaded)),l.subscribe("mapChanged",f.hitch(this,
this._onMapChanged)));l.subscribe("widgetDestroyed",f.hitch(this,this._onWidgetDestroyed))},getWidgetFilter:function(c,h){return f.getObject(c+".filterExprs."+h,!1,this._filters)},applyWidgetFilter:function(c,f,l,e,b,m){var a="object"===typeof c?c:null;a&&(c=a.layerId,f=a.widgetId,l=a.expression,e=a.enableMapFilter,b=a.useAND,m=a.zoomAfterFilter);this._setFilterExp(c,f,l,e,b);f=this.layerInfos.getLayerInfoById(c)||this.layerInfos.getTableInfoById(c);c=this.getFilterExp(c);null!==c&&f&&f.setFilter(c,
{zoomAfterFilter:m})},_onMapLoaded:function(){this.layerInfos=c.getInstanceSync();this._traversalFilter()},_onMapChanged:function(){this.layerInfos=c.getInstanceSync();this._traversalFilter()},_onWidgetDestroyed:function(c){for(var f in this._filters)if(this._filters[f]){var k=this._filters[f];if(k){var e=k.filterExprs,k=k.mapFilterControls;e&&delete e[c];k&&delete k[c]}}},_traversalFilter:function(){this.layerInfos.traversalAll(f.hitch(this,function(c){this._filters[c.id]||(this._filters[c.id]={definitionExpression:c.getFilter(),
filterExprs:{},mapFilterControls:{}})}))},_getPriorityOfMapFilter:function(c){c=f.getObject(c+".mapFilterControls",!1,this._filters);var h=0,k;for(k in c){var e=c[k];e.priority>h&&(h=e.priority)}return h},_getMapFilterControl:function(c){c=f.getObject(c+".mapFilterControls",!1,this._filters);var h=0,k=null,e;for(e in c){var b=c[e];b.priority>h&&(h=b.priority,k=b)}return k},_setFilterExp:function(c,h,l,e,b){var m=c+".filterExprs."+h,a=c+".mapFilterControls."+h;l?(f.setObject(m,l,this._filters),p.isDefined(e)&&
(c=this._getPriorityOfMapFilter(c),f.setObject(a,{enable:e,useAND:b,priority:c+1},this._filters))):(f.getObject(m,!1,this._filters)&&delete this._filters[c].filterExprs[h],f.getObject(a,!1,this._filters)&&delete this._filters[c].mapFilterControls[h])},getFilterExp:function(c,f){if(!this._filters[c])return null;var h=[],e=this._filters[c].definitionExpression,b=this._filters[c].filterExprs;c=this._getMapFilterControl(c);for(var m in b){var a=b[m];f&&0<=m.indexOf(f)||a&&h.push("("+a+")")}f=h.join(" AND ");
return e&&c&&c.enable||e&&null===c?f?c&&!1===c.useAND?"("+e+") OR "+f:"("+e+") AND "+f:e:f}});n.getInstance=function(){if(null===q)q=new n,window._filterManager=q;else return q};return n})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic"],function(r,f,l){var p=null,c;c=r(null,{constructor:function(c){l.subscribe("publishData",f.hitch(this,this.onDataPublished));l.subscribe("fetchData",f.hitch(this,this.onFetchData));l.subscribe("clearAllData",f.hitch(this,
this.onClearAllData));l.subscribe("removeData",f.hitch(this,this.onRemoveData));l.subscribe("clearDataHistory",f.hitch(this,this.onClearDataHistory));this.widgetManager=c},_dataStore:{},onDataPublished:function(c,f,k,h){"undefined"===typeof h&&(h=!1);this._dataStore[f]?(this._dataStore[f].current=k,h&&(this._dataStore[f].history?this._dataStore[f].history.push(k):this._dataStore[f].history=[k])):(this._dataStore[f]={current:k},h&&(this._dataStore[f].history=[k]))},onFetchData:function(c){var f;if(c)"framework"===
c?this._dataStore[c]?l.publish("dataFetched","framework","framework",this._dataStore[c].current,this._dataStore[c].history):l.publish("noData","framework","framework"):(f=this.widgetManager.getWidgetById(c))?this._dataStore[c]?l.publish("dataFetched",f.name,c,this._dataStore[c].current,this._dataStore[c].history):l.publish("noData",f.name,c):l.publish("noData",void 0,c);else{for(var k in this._dataStore)(f=this.widgetManager.getWidgetById(k))&&l.publish("dataFetched",f.name,k,this._dataStore[k].current,
this._dataStore[k].history);f||l.publish("noData",void 0,void 0)}},onClearAllData:function(){this._dataStore={};l.publish("allDataCleared")},onRemoveData:function(c){delete this._dataStore[c];l.publish("dataRemoved",c)},onClearDataHistory:function(c){this._dataStore[c]&&(this._dataStore[c].history=[]);l.publish("dataHistoryCleared",c)}});c.getInstance=function(f){null===p&&(p=new c(f));return p};return c})},"jimu/SelectionManager":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/_base/lang dojo/_base/array dojo/topic dojo/on esri/layers/FeatureLayer esri/layers/GraphicsLayer esri/geometry/geometryEngine esri/graphic esri/Color esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a){var g=null,d=r(null,{constructor:function(){window.isBuilder?(c.subscribe("app/mapLoaded",l.hitch(this,this._onMapLoaded)),c.subscribe("app/mapChanged",l.hitch(this,this._onMapChanged))):(c.subscribe("mapLoaded",l.hitch(this,this._onMapLoaded)),c.subscribe("mapChanged",l.hitch(this,this._onMapChanged)))},_displayLayers:{},previousMapScale:null,setSelectionSymbol:function(d){var c=d.geometryType,f=new b(b.STYLE_CIRCLE,16,null,e.fromArray([0,255,255])),g=new m(m.STYLE_SOLID,
e.fromArray([0,255,255]),2),h=new a(a.STYLE_SOLID,g,e.fromArray([0,255,255,.3]));"esriGeometryPoint"===c?d.setSelectionSymbol(f):"esriGeometryPolyline"===c?d.setSelectionSymbol(g):"esriGeometryPolygon"===c&&d.setSelectionSymbol(h)},updateSelectionByFeatures:function(a,b,d){0<b.length&&(b=p.map(b,l.hitch(this,function(b){var d=null,d=0<=a.graphics.indexOf(b)?new t(b.toJson()):b;d.wabIsTemp=!0;return d})));a.getSelectionSymbol()||this.setSelectionSymbol(a);var c=new f;a._selectHandler({features:b},
d,null,null,c);this._isLayerNeedDisplayLayer(a)&&(this._displayLayers[a.id]||(this._displayLayers[a.id]=this._createDisplayLayer(a)),this._updateDisplayLayer(a,b,d));return c},getDisplayLayer:function(a){return this._displayLayers[a]},setSelection:function(a,b){return this.updateSelectionByFeatures(a,b,n.SELECTION_NEW)},addFeaturesToSelection:function(a,b){return this.updateSelectionByFeatures(a,b,n.SELECTION_ADD)},removeFeaturesFromSelection:function(a,b){return this.updateSelectionByFeatures(a,
b,n.SELECTION_SUBTRACT)},clearSelection:function(a){var b=new f;this.clearDisplayLayer(a);a.clearSelection();b.resolve();return b},clearDisplayLayer:function(a){(a=this._displayLayers[a.id])&&a.clear()},getClientFeaturesByGeometry:function(a,b,d){return p.filter(a.graphics,l.hitch(this,function(a){return d?h.contains(b,a.geometry):h.intersects(b,a.geometry)}))},getUnionGeometryBySelectedFeatures:function(a){var b=null;a=a.getSelectedFeatures();0<a.length&&(b=p.map(a,l.hitch(this,function(a){return a.geometry})),
b=h.union(b));return b},_createDisplayLayer:function(a){var b=new k,d=a.objectIdField;b.fields=a.fields;b.id="displayLayer_of_"+a.id;this.map.addLayer(b);if(!this.map.spatialReference.equals(a.spatialReference)||a.hasWebGLSurface()){var c=a.getSelectionSymbol();q(a,"update-end",l.hitch(this,function(){var e=Math.round(this.map.getScale());if(this.previousMapScale!==e&&b.graphics&&0<b.graphics.length){this.previousMapScale=e;var f=p.map(b.graphics,function(a){return a.attributes[d]}),e=p.filter(a.graphics,
function(a){return 0<=f.indexOf(a.attributes[d])});b.clear();p.forEach(e,l.hitch(this,function(a){a=new t(a.toJson());a.setSymbol(c);b.add(a)}))}}))}return b},_updateDisplayLayer:function(a,b,d){var c=this._displayLayers[a.id],e=a.getSelectionSymbol();a.hasWebGLSurface()?this._updateDisplayLayerWebGL(a,c,e,b,d):(b=a.getSelectedFeatures(),this.clearDisplayLayer(a),p.forEach(b,l.hitch(this,function(a){a.visible&&(a.setSymbol(null),a=new t(a.toJson()),a.setSymbol(e),c.add(a))})))},_updateDisplayLayerWebGL:function(a,
b,d,c,e){e===n.SELECTION_NEW&&(a._selectedFeaturesWebGL={});e===n.SELECTION_NEW||e===n.SELECTION_ADD?p.forEach(c,l.hitch(this,function(b){b.visible&&(a._selectedFeaturesWebGL[b.attributes[a.objectIdField]]=b)})):e===n.SELECTION_SUBTRACT&&p.forEach(c,l.hitch(this,function(b){b=b.attributes[a.objectIdField];b in a._selectedFeaturesWebGL&&delete a._selectedFeaturesWebGL[b]}));this.clearDisplayLayer(a);for(var f in a._selectedFeaturesWebGL)c=new t(a._selectedFeaturesWebGL[f].toJson()),c.setSymbol(d),
b.add(c)},_isLayerNeedDisplayLayer:function(a){return a.hasWebGLSurface()||!a.getMap()},_onMapLoaded:function(a){this.map=a},_onMapChanged:function(a){this.map=a}});d.getInstance=function(){g||(g=new d,window._selectionManager=g);return g};return d})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase jimu/dijit/BindLabelPropsMixin dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(r,f,l,p,c,q,n,k,
h,t){return r([q,n,k],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,map:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(c.subscribe("publishData",f.hitch(this,this._onReceiveData)));this.own(c.subscribe("dataFetched",f.hitch(this,this._onReceiveData)));
this.own(c.subscribe("noData",f.hitch(this,this._onNoData)));this.own(c.subscribe("dataSourceDataUpdated",f.hitch(this,this.onDataSourceDataUpdate)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(c){},onSignOut:function(){},onPositionChange:function(c){this.setPosition(c)},setPosition:function(c,b){this.position=
c;var e=h.getPositionStyle(this.position);e.position="absolute";b||(b="map"===c.relativeTo?this.map.id:window.jimuConfig.layoutId);p.place(this.domNode,b);p.setStyle(this.domNode,e);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return p.getMarginBox(this.domNode)},setMap:function(c){this.map=c},setState:function(c){this.state=c},setWindowState:function(c){this.windowState=c},resize:function(){},onConfigChanged:function(c){},onAppConfigChanged:function(c,
b,f){},onAction:function(c,b){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return t.getInstance().getPanelById(this.id+"_panel");var c=t.getInstance().getPanelById(this.gid+"_panel");return c?c:t.getInstance().getPanelById(this.id+"_panel")},publishData:function(e,b){"undefined"===typeof b&&(b=!1);c.publish("publishData",this.name,this.id,e,b)},fetchData:function(e){e?c.publish("fetchData",e):0!==this.listenWidgetIds.length?l.forEach(this.listenWidgetIds,
function(b){c.publish("fetchData",b)},this):c.publish("fetchData")},fetchDataByName:function(c){c=this.widgetManager.getWidgetsByName(c);l.forEach(c,function(b){this.fetchData(b.id)},this)},openWidgetById:function(c){return this.widgetManager.triggerWidgetOpen(c)},_onReceiveData:function(c,b,f,a){if(b!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(b)))this.onReceiveData(c,b,f,a)},onReceiveData:function(c,b,f,a){},updateDataSourceData:function(e,b){c.publish("updateDataSourceData",
"widget~"+this.id+"~"+e,b)},onDataSourceDataUpdate:function(c,b){},_onNoData:function(c,b){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(b)))this.onNoData(c,b)},onNoData:function(c,b){}})})},"jimu/dijit/BindLabelPropsMixin":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/query","dojo/_base/array","jimu/utils"],function(r,f,l,p,c){return r("jimu-bind-label-props-mixin",null,{isRenderIdForAttrs:!1,buildRendering:function(){this.inherited(arguments);if(this.isRenderIdForAttrs){var q=
l("[data-a11y-label-id],[data-a11y-label-by], [data-label-for], [data-label-id]",this.domNode);(f.getAttr(this.domNode,"data-a11y-label-id")||f.getAttr(this.domNode,"data-a11y-label-by")||f.getAttr(this.domNode,"data-label-for")||f.getAttr(this.domNode,"data-label-id"))&&q.unshift(this.domNode);var n={},k=[],h={},t,e=0,b="jimuUniqName_"+c.getUUID();p.forEach(q,function(a){var d=f.getAttr(a,"data-a11y-label-id"),c=f.getAttr(a,"data-a11y-label-by"),g=f.getAttr(a,"data-label-for"),m=f.getAttr(a,"data-label-id");
d?(f.removeAttr(a,"data-a11y-label-id"),t=b+"_"+e,f.setAttr(a,"id",t),n[d]=t,e++):c?k.push(a):g?(h.hasOwnProperty(g)||(h[g]={}),h[g].forDom=a):(h.hasOwnProperty(m)||(h[m]={}),h[m].idDom=a)});for(var m in k){var q=k[m],a=f.getAttr(q,"data-a11y-label-by").split(" "),g=[];p.forEach(a,function(a){g.push(n[a])});f.removeAttr(q,"data-a11y-label-by");f.setAttr(q,"aria-labelledby",g.join(" "))}for(var d in h)t=b+"_"+e,m=h[d].forDom,q=h[d].idDom,m&&(f.removeAttr(m,"data-label-for"),f.setAttr(m,"for",t)),q&&
(f.removeAttr(q,"data-label-id"),f.setAttr(q,"id",t)),e++}}})})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m){var a,g=null;a=r(null,{constructor:function(){this.panels=[];this.widgetManager=m.getInstance();k(window,"resize",f.hitch(this,this.onWindowResize));this.activePanel=null;h.subscribe("/dnd/move/start",
f.hitch(this,this._onMoveStart));h.subscribe("widgetActived",f.hitch(this,this._onWidgetActived))},showPanel:function(a){var d=new q,c=this.getPanelById(a.id+"_panel");c?("closed"===c.state&&this.openPanel(c),d.resolve(c)):n({Panel:this._loadPanelClass(a.panel.uri),nls:this._loadThemeI18N(a.panel.uri)}).then(f.hitch(this,function(c){var e=a.id+"_panel",g=this.getPanelById(e),h={label:a.label,config:a,uri:a.panel.uri,position:a.panel.position,map:this.map,widgetManager:this.widgetManager,panelManager:this,
id:e,gid:a.gid,nls:c.nls};f.mixin(h,a.panel.options);try{g=new c.Panel(h),console.log("panel ["+e+"] created.")}catch(y){console.log("create panel error: "+y+", panelId: "+e);d.reject(y);return}g.setPosition(a.panel.position);b.setVerticalCenter(g.domNode);this.openPanel(g);g.domNode.addEventListener("click",f.hitch(this,this._onPanelClick,g),{capture:!0});d.resolve(g)}));return d},setMap:function(a){this.map=a;k(this.map,"resize",f.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a))return;for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a&&this.closePanel(this.panels[b])},openPanel:function(a){var b=new q;if("string"===typeof a){if(a=this.getPanelById(a),!a)return b.reject(),b}else this.panels.some(function(b){return b.id===a.id})||this.panels.push(a);if(!a.started)try{a.started=
!0,a.startup()}catch(v){console.error("fail to startup panel "+a.id+". "+v.stack)}if("opened"===a.state)return this._activePanel(a),b.resolve(a),b;a.setState("opened");return this.playOpenPanelAnimation(a).then(f.hitch(this,function(){p.setStyle(a.domNode,"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var b=new q;return"string"===typeof a&&(a=this.getPanelById(a),!a)||"closed"===a.state?(b.resolve(),b):this.playClosePanelAnimation(a).then(f.hitch(this,function(){this.activePanel&&
this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&p.setStyle(a.domNode,"display","none")}))},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(u){console.log(console.error("fail to minimize panel "+a.id+". "+u.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;
"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(u){console.log(console.error("fail to maximize panel "+a.id+". "+u.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(u){console.log(console.error("fail to noralize panel "+a.id+". "+u.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),
!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==
this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(u){console.log(console.error("fail to destroy panel "+a.id+". "+u.stack))}}},destroyAllPanels:function(){var a=l.map(this.panels,function(a){return a.id});l.forEach(a,function(a){this.destroyPanel(a)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return t();var b=new q;"string"===typeof a.openAnimation?"fadeIn"===a.openAnimation?(p.setStyle(a.domNode,{opacity:0,display:""}),c.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play()):b.resolve():b.resolve();return b},playClosePanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return t();var b=new q;"string"===
typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?c.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play():b.resolve());return b},getPositionOnMobile:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return{};var b=p.getMarginBox(window.jimuConfig.layoutId),d=b.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:b.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,
borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?(d=0,this.panels.filter(function(b){return"minimized"===b.windowState&&"closed"!==b.state&&b.id!==a.id}).some(function(a){return 0===a._mobileBottom})&&(d=a.titleHeight),a._mobileBottom=d,b.h>b.w?{left:0,right:0,top:"auto",bottom:d,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:
{left:b.w-b.w/2,right:0,top:"auto",bottom:d,width:b.w/2,height:a.titleHeight,contentHeight:b.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}):b.h>b.w?{left:0,right:0,top:d,bottom:0,width:"auto",height:"auto",contentHeight:b.h-d-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",
borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:0,bottom:0,width:b.w/2,height:"auto",contentHeight:b.h-d-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},activatePanel:function(a){"closed"!==a.state&&this._activePanel(a)},
_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&p.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),p.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var b=this.widgetManager.activeWidget;b&&"active"===b.state&&b.getPanel()!==a&&(b.setState("opened"),
!1===b.inPanel&&p.setStyle(b.domNode,"zIndex","undefined"!==typeof b.position.zIndex?b.position.zIndex:"auto"),b.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&p.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var b=this.panels.indexOf(a);-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=
null)},_onMoveStart:function(a){l.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},this)},_onWidgetActived:function(a){this.activePanel&&"active"===this.activePanel.state&&a.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),p.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(a){var b=new q;
e([a],function(a){b.resolve(a)});return b},_loadThemeI18N:function(a){var b=new q;a.startWith("themes")?(a=a.split("/"),e(["dojo/i18n!"+(a[0]+"/"+a[1]+"/nls/strings")],function(a){b.resolve(a)})):b.resolve({});return b}});a.getInstance=function(){null===g&&(g=new a,window._panelManager=g);return g};return a})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(r,f,l,p){return r([p],{widget:null,baseClass:"jimu-widget-frame jimu-container",
postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&"closed"!==this.widget.state&&f.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(c){this.loading=c;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(c){this.widget=c;this.loading&&
this.loading.destroy();l.place(c.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(c){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+c.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./a11y/BaseWidgetPanel ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),
function(r,f,l,p,c,q,n,k,h,t){r=r([c,q],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var c=this.getAllWidgetConfigs();Array.isArray(this.config.widgets)?(c=this.config.widgets,1<c.length&&this._addTagToGroupPanel()):c=[this.config];l.forEach(c,function(b,c){var a,
e;!1!==b.visible&&(e=new k,a=this.createFrame(b),this._initFrameEvents(a,b,c),this.addChild(a),a.setLoading(e),this.widgetManager.loadWidget(b).then(f.hitch(this,function(b){a.setWidget(b);b.startup()})))},this)},getAllWidgetConfigs:function(){var c=[];return c=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(c){for(var b=this.getChildren(),e=0;e<b.length;e++)if(b[e].getWidget()&&b[e].getWidget().id===c)return b[e].getWidget()},getWidgets:function(){return this.getChildren().map(function(c){return c.getWidget()})},
createFrame:function(c){return new h},setPosition:function(c,b){this.position=c;var e=t.getPositionStyle(this.position);e.position="absolute";b||(b="map"===c.relativeTo?this.map.id:window.jimuConfig.layoutId);this.started?this.resize():this.openAnimation&&(e.display="none");p.place(this.domNode,b);p.setStyle(this.domNode,e)},getPosition:function(){return this.position},setState:function(c){this.state=c},setWindowState:function(c){this.windowState=c},resize:function(){this.getChildren().forEach(function(c){c.resize()})},
onPositionChange:function(c){this.setPosition(c)},onOpen:function(){l.forEach(this.getChildren(),function(c){c.getWidget()&&this.widgetManager.openWidget(c.getWidget())},this);this._onOpenAndFocus()},onClose:function(){l.forEach(this.getChildren(),function(c){c.getWidget()&&this.widgetManager.closeWidget(c.getWidget())},this)},onMaximize:function(){l.forEach(this.getChildren(),function(c){c.getWidget()&&this.widgetManager.maximizeWidget(c.getWidget())},this)},onMinimize:function(){l.forEach(this.getChildren(),
function(c){c.getWidget()&&this.widgetManager.minimizeWidget(c.getWidget())},this)},onNormalize:function(){l.forEach(this.getChildren(),function(c){c.getWidget()&&this.widgetManager.normalizeWidget(c.getWidget())},this)},onActive:function(){},onDeActive:function(){},updateConfig:function(c){this._updateConfig(c)},reloadWidget:function(c){this.isWidgetInPanel(c)&&(this._updateConfig(c),this.getChildren().forEach(function(b){b.getWidget()&&b.getWidget().id===c.id&&(b.getWidget().destroy(),b.setLoading(new k),
this.widgetManager.loadWidget(c).then(f.hitch(this,function(c){b.setWidget(c);c.startup();"closed"===this.state&&this.widgetManager.closeWidget(c)})))},this))},isWidgetInPanel:function(c){return l.some(this.getAllWidgetConfigs(),function(b){if(c.id===b.id)return!0})?!0:!1},_updateConfig:function(c){if(Array.isArray(this.config.widgets)){for(var b=-1,e=0;e<this.config.widgets.length;e++)this.config.widgets[e].id===c.id&&(b=e);0<b&&(this.config.widgets[b]=c)}else this.config=c},destroy:function(){this.getChildren().forEach(function(c){try{c.domNode&&
c.destroy()}catch(b){console.error("destroy widget frame error."+b.stack)}});this.inherited(arguments)}});r.extend(n);return r})},"jimu/a11y/BaseWidgetPanel":function(){define("dojo/_base/lang dojo/_base/html dojo/query dojo/on dojo/keys ./../utils".split(" "),function(r,f,l,p,c,q){var n={frameSectionIndex:"91"};n.panelNls=window.jimuNls.panelHeader;n._addTagToGroupPanel=function(){var c=this.config.widgets;this.isGroupPanel=!0;c.forEach(function(c){c.inGroupPanel=!0})};n._setAriaLabel=function(c,
h){var k;c.folded?(k=n.panelNls.expanded,f.setStyle(c.containerNode,"display","inherit")):(k=n.panelNls.collapsed,f.setStyle(c.containerNode,"display","none"));h=q.getSubstituteString(h,k);f.setAttr(c.titleNode,"aria-label",h)};n._initFrameEvents=function(k,h,t){if(this.isGroupPanel){var e=q.getSubstituteString(h.label,n.panelNls.expanded);h=q.getSubstituteString(h.label,n.panelNls.pressToFocus);f.setAttr(k.titleNode,"aria-label",e);f.setAttr(k.titleNode,"tabindex",n.frameSectionIndex);f.setAttr(k.containerNode,
"aria-label",h);f.setAttr(k.containerNode,"tabindex",n.frameSectionIndex);0===t?this.firstTitleNode=k.titleNode:t===this.config.widgets.length-1&&(this.lastTitleNode=k.titleNode,this.lastContent=k.containerNode);this.own(p(k.titleNode,"click",r.hitch(this,function(){k.foldEnable&&this._setAriaLabel(k,k.label)})));this.own(p(k.titleNode,"keydown",r.hitch(this,function(b){f.hasClass(b.target,"title")&&(b.keyCode===c.TAB?b.target===this.firstTitleNode&&b.shiftKey?(b.preventDefault(),this.lastContent.focus()):
b.target!==this.lastTitleNode||b.shiftKey||"none"!==f.getStyle(this.lastContent,"display")||(b.preventDefault(),this.firstTitleNode.focus()):!k.foldEnable||b.keyCode!==c.ENTER&&b.keyCode!==c.SPACE||(b.stopPropagation(),this._setAriaLabel(k,k.label),k.onFoldableNodeClick()))})));this.own(p(k.containerNode,"keydown",r.hitch(this,function(b){var e=b.target;f.hasClass(e,"jimu-panel-content")?b.keyCode===c.ENTER?(b=l(".jimu-widget",e)[0])&&q.focusFirstFocusNode(b):b.target!==this.lastContent||b.shiftKey||
b.keyCode!==c.TAB||(b.preventDefault(),this.firstTitleNode.focus()):b.keyCode===c.ESCAPE&&(b.stopPropagation(),k.containerNode.focus())})))}};n._onOpenAndFocus=function(){this.config.openAtStart&&!this._isFirstOpenAtStart?this._isFirstOpenAtStart=!0:this.isGroupPanel&&this.firstTitleNode&&this.firstTitleNode.focus()};return n})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(r,f,l,p,c){return r([p,
c],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(l(window,"resize",f.hitch(this,this._onWindowResize)))},getConfig:function(){},getDataSources:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/symbolUtils":function(){define("require dojo/_base/lang dojo/_base/html dojox/gfx esri/symbols/jsonUtils esri/symbols/PictureMarkerSymbol".split(" "),function(r,f,l,p,c,q){return{cloneSymbol:function(f){if(!f)return null;var k=null;try{var h=f.toJson(),
k=c.fromJson(h)}catch(t){console.error(t)}return k},getDefaultMarkerSymbol:function(){return c.fromJson({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})},getDefaultLineSymbol:function(){return c.fromJson({tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"})},getDefaultFillSymbol:function(){return c.fromJson({tags:["opaque"],title:"Blue",style:"esriSFSSolid",color:[79,
129,189,255],name:"Blue 6",type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}})},getHightlightMarkerSymbol:function(){return c.fromJson({color:[255,255,255,128],size:18,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"}})},getHightlightLineSymbol:function(){return c.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"})},getHightlightFillSymbol:function(){return c.fromJson({color:[255,
255,255,128],outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"})},getGreyPinMarkerSymbol:function(){var c=r.toUrl("jimu/css/images/grey_pin.png"),c=new q(c,16,16);c.setOffset(0,8);return c},createSymbolNode:function(n,k){var h=32,t=32,e=l.create("div",{},document.body);l.setStyle(e,"display","inline-block");if(k)h=k.width,t=k.height;else if(h=80,t=30,this.isSimpleMarkerSymbol(n))t=h=Math.min(n.size+12,125);else if(this.isPictureMarkerSymbol(n)){if(!n.url||
"http://"===n.url||-1===n.url.indexOf("http://")&&-1===n.url.indexOf("https://")&&-1===n.url.indexOf("data:"))return;t=h=Math.min(Math.max(n.width,n.height),125)}else if(this.isSimpleLineSymbol(n)||this.isCartographicLineSymbol(n))h=190,t=20;var b=p.createSurface(e,h,t);if("vml"===p.renderer){var m=b.getEventSource();l.setStyle(m,"position","relative");l.setStyle(m.parentNode,"position","relative")}var m=null,m=k?c.getShapeDescriptors(n):this.isSimpleLineSymbol(n)||this.isCartographicLineSymbol(n)?
this._getLineShapeDesc(n):c.getShapeDescriptors(n),a;try{a=b.createShape(m.defaultShape),m.fill&&a.setFill(m.fill),m.stroke&&a.setStroke(m.stroke)}catch(g){b.clear();b.destroy();return}n=b.getDimensions();n={dx:n.width/2,dy:n.height/2};b=a.getBoundingBox();k=b.width;b=b.height;if(k>h||b>t)h=((h<t?h:t)-5)/(k>b?k:b),f.mixin(n,{xx:h,yy:h});a.applyTransform(n);e&&l.addClass(e,"symbol");return e},_getLineShapeDesc:function(c){var f=null;if(this.isSimpleLineSymbol(c)||this.isCartographicLineSymbol(c))f=
{defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:c.getStroke()};return f},isSimpleMarkerSymbol:function(c){return c&&"esri.symbol.SimpleMarkerSymbol"===c.declaredClass},isPictureMarkerSymbol:function(c){return c&&"esri.symbol.PictureMarkerSymbol"===c.declaredClass},isSimpleLineSymbol:function(c){return c&&"esri.symbol.SimpleLineSymbol"===c.declaredClass},isCartographicLineSymbol:function(c){return c&&"esri.symbol.CartographicLineSymbol"===c.declaredClass},isSimpleFillSymbol:function(c){return c&&
"esri.symbol.SimpleFillSymbol"===c.declaredClass},isPictureFillSymbol:function(c){return c&&"esri.symbol.PictureFillSymbol"===c.declaredClass},isTextSymbol:function(c){return c&&"esri.symbol.TextSymbol"===c.declaredClass}}})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(r,f,l){return r(null,{constructor:function(){this.panelManager=l.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||
(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(f){},getConfigById:function(f){for(var c=this.getAllConfigs(),l=0;l<c.length;l++)if(c[l].id===f)return c[l]},getAllConfigs:function(){var l=[],l=l.concat(this.getWidgetConfigs(),this.getGroupConfigs()),l=f.filter(l,function(c){return c.visible});return l.sort(function(c,f){return c.index-f.index})},getAllConfigsIncludeInvisible:function(){var f=[],f=f.concat(this.getWidgetConfigs(),this.getGroupConfigs());return f.sort(function(c,
f){return c.index-f.index})},isControlled:function(l){return f.some(this.getAllConfigsIncludeInvisible(),function(c){return c.id===l})},widgetIsControlled:function(l){return f.some(this.getAllConfigsIncludeInvisible(),function(c){return c.id===l?!0:f.some(c.widgets,function(c){return c.id===l})})},getGroupConfigs:function(){var l=[];if(!this.appConfig.widgetPool)return l;this.appConfig.widgetPool.groups&&f.forEach(this.appConfig.widgetPool.groups,function(c){this.controlledGroups&&(Array.isArray(this.controlledGroups)?
-1<this.controlledGroups.indexOf(c.id)&&l.push(c):"all"===this.controlledGroups&&l.push(c))},this);return l},getWidgetConfigs:function(){var l=[];if(!this.appConfig.widgetPool)return l;this.appConfig.widgetPool.widgets&&f.forEach(this.appConfig.widgetPool.widgets,function(c){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(c.id)&&l.push(c):"all"===this.controlledWidgets&&l.push(c))},this);return l}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/SpatialReference ./unitUtils".split(" "),
function(r,f,l,p,c,q,n,k){var h=null,t=null,e=!1;r=r(null,function(){});var b=require.toUrl("jimu"),m=q(b+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),a=q(b+"/SpatialReference/transform.json",{handleAs:"json"});r.loadResource=function(){var b=new p;if(h&&t)return b.resolve(),b;c([m,a]).then(function(a){h=a[0];t=a[1];e=!0;b.resolve()},function(a){console.error(a);e=!1;b.reject(a)});return b};r.getAllCSUnits=function(){if(e){var a=[];l.forEach(h.wkids,f.hitch(this,function(b){b=this.getCSUnit(b);
-1===l.indexOf(a,b)&&a.push(b)}));return a}};r.convertUnit=function(a,b,c){if(e)return k.convertUnit(a,b,c)};r.getUnitRate=function(a,b){if(e)return k.getUnitRate(a,b)};r.isProjectUnit=function(a){if(e)return k.isProjectUnit(a)};r.isGeographicUnit=function(a){if(e)return k.isGeographicUnit(a)};r.getGeographicUnits=function(){if(e)return k.getGeographicUnits()};r.getProjectUnits=function(){if(e)return k.getProjectUnits()};r.getCSUnit=function(a){if(e){a=this.getCSStr(a);var b=0,c=0,b=a.lastIndexOf("UNIT"),
c=a.indexOf(",",b);return a.slice(b+6,c-1)}};r.isSameSR=function(a,b){if(e)return a=this.indexOfWkid(a),b=this.indexOfWkid(b),h.labels[a]===h.labels[b]};r.isValidWkid=function(a){if(e)return-1<this.indexOfWkid(a)};r.getSRLabel=function(a){if(e&&this.isValidWkid(a))return a=this.indexOfWkid(a),h.labels[a]};r.indexOfWkid=function(a){if(e)return l.indexOf(h.wkids,a)};r.isWebMercator=function(a){return n.prototype._isWebMercator?n.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new n(parseInt(a,
10))).isWebMercator()};r.standardizeWkid=function(a){return this.isWebMercator(a)?3857:parseInt(a,10)};r.isValidTfWkid=function(a){if(e)return-1<this.indexOfTfWkid(a)};r.getTransformationLabel=function(a){if(e)return this.isValidTfWkid(a)?(a=this.indexOfTfWkid(a),t.labels[a]):""};r.indexOfTfWkid=function(a){if(e)return l.indexOf(t.tfWkids,a)};r.isGeographicCS=function(a){if(e)return this.isValidWkid(a)?h.details[this.indexOfWkid(a)].startWith("GEOGCS"):!1};r.isProjectedCS=function(a){if(e)return this.isValidWkid(a)?
h.details[this.indexOfWkid(a)].startWith("PROJCS"):!1};r.getGeoCSByProj=function(a){if(e&&this.isProjectedCS(a))return a=this.getSpheroidStr(a),a=l.indexOf(h.details,a),h.wkids[a]};r.getSpheroidStr=function(a){if(e){if(this.isGeographicCS(a))return h.details[this.indexOfWkid(a)];if(this.isProjectedCS(a)){a=h.details[this.indexOfWkid(a)];var b=a.indexOf("GEOGCS"),c=a.indexOf("PROJECTION")-1;return a.slice(b,c)}return null}};r.getCSStr=function(a){if(e)return h.details[this.indexOfWkid(a)]};r.isSameSpheroid=
function(a,b){if(e)return a=this.getSpheroidStr(a),b=this.getSpheroidStr(b),a&&b&&a===b?!0:!1};return r})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(r,f){var l="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),
p="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),c={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:.001,CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,
YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897};r=r(null,function(){});r.convertUnit=function(f,l,k){return c[f.toUpperCase()]/c[l.toUpperCase()]*k};r.getUnitRate=function(f,l){return c[f.toUpperCase()]/c[l.toUpperCase()]};r.isProjectUnit=function(c){return-1<f.indexOf(l,c.toUpperCase())};r.isGeographicUnit=function(c){return-1<
f.indexOf(p,c.toUpperCase())};r.getGeographicUnits=function(){return p};r.getProjectUnits=function(){return l};return r})},"jimu/dijit-all":function(){define([],1)},"jimu/dijit/RadioBtn":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dijit/registry".split(" "),function(r,f,l,p,c,q,n,k){return r(f,{baseClass:"jimu-radio",declaredClass:"jimu.dijit.RadioBtn",checked:!1,group:null,constructor:function(){},postCreate:function(){n.create("div",
{"class":"jimu-radio-inner"},this.domNode);this.checked&&q.add(this.domNode,"jimu-radio-checked");this.own(c(this.domNode,"click",l.hitch(this,function(){this.checked||this.check()})))},check:function(c){void 0===c&&(c=!0);this.checked=!0;q.add(this.domNode,"jimu-radio-checked");c&&this._changeOthersState(!1);this.onStateChange()},uncheck:function(c){void 0===c&&(c=!0);this.checked=!1;q.remove(this.domNode,"jimu-radio-checked");c&&this._changeOthersState(!1);this.onStateChange()},_changeOthersState:function(c){null!==
this.group&&p.forEach(k.toArray(),function(f){f.id!==this.id&&f["class"]===this["class"]&&f.group===this.group&&(c?f.check(!1):f.uncheck(!1))},this)},onStateChange:function(){}})})},"jimu/dijit/CheckBox":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/dom-class dojo/Evented ./a11y/CheckBox".split(" "),function(r,f,l,p,c,q,n){r=r([f,q],{baseClass:"jimu-checkbox",declaredClass:"jimu.dijit.CheckBox",checked:!1,disabled:!1,status:!0,label:"",title:"",postCreate:function(){this.checkNode=
p.create("div",{"class":"checkbox jimu-float-leading jimu-icon jimu-icon-checkbox"},this.domNode);this.labelNode=p.create("div",{"class":"label jimu-float-leading",innerHTML:this.label||""},this.domNode);this.checked&&(p.addClass(this.checkNode,"checked"),p.addClass(this.checkNode,"jimu-icon-checked"));this.status=this._getStatusByDisabled(this.disabled);this.status||(p.addClass(this.domNode,"jimu-state-disabled"),p.addClass(this.checkNode,"jimu-state-disabled"));this.a11y_setDisabled(!this.status);
this.own(this.watch("disabled",l.hitch(this,function(){this.setStatus(this._getStatusByDisabled(this.disabled))})));this._udpateLabelClass();this.a11y_init()},setLabel:function(c){this.label=c;this.labelNode.innerHTML=this.label;this.labelNode.title=this.label;this.a11y_updateAriaLabel(c);this._udpateLabelClass()},_udpateLabelClass:function(){this.labelNode&&(this.labelNode.innerHTML?p.removeClass(this.labelNode,"not-visible"):p.addClass(this.labelNode,"not-visible"))},setValue:function(c){this.status&&
(!0===c?this.check():this.uncheck())},getValue:function(){return this.checked},setStatus:function(f){f=!!f;var h=this.status!==f;(this.status=f)?(c.remove(this.domNode,"jimu-state-disabled"),p.removeClass(this.checkNode,"jimu-state-disabled")):(c.add(this.domNode,"jimu-state-disabled"),p.addClass(this.checkNode,"jimu-state-disabled"));this.a11y_setDisabled(!this.status);h&&this.emit("status-change",f)},getStatus:function(){return this.status},check:function(c){if(this.status&&(this.checked=!0,this.a11y_changeAriaCheckedAttr(),
p.addClass(this.checkNode,"checked jimu-icon-checked"),p.removeClass(this.checkNode,"checked jimu-icon-checkbox"),!c))this.onStateChange()},uncheck:function(c){if(this.status&&(this.checked=!1,this.a11y_changeAriaCheckedAttr(),p.removeClass(this.checkNode,"checked"),p.removeClass(this.checkNode,"jimu-icon-checked"),p.addClass(this.checkNode,"jimu-icon-checkbox"),!c))this.onStateChange()},onStateChange:function(){if(this.onChange&&l.isFunction(this.onChange))this.onChange(this.checked);this.emit("change",
this.checked)},focus:function(){this.checkNode&&this.checkNode.focus&&this.checkNode.focus()},_getStatusByDisabled:function(c){return!0===c||"true"===c||"disabled"===c?!1:!0}});r.extend(n);return r})},"jimu/dijit/a11y/CheckBox":function(){define(["dojo/_base/lang","dojo/on","dojo/_base/html","dijit/a11yclick"],function(r,f,l,p){return{a11y_init:function(){l.setAttr(this.domNode,"tabindex","0");l.setAttr(this.domNode,"role","checkbox");this.setLabel(this.label);this.a11y_changeAriaCheckedAttr();this.own(f(this.domNode,
"focus",r.hitch(this,function(){l.addClass(this.checkNode,"dijitCheckBoxFocused")})));this.own(f(this.domNode,"blur",r.hitch(this,function(){l.removeClass(this.checkNode,"dijitCheckBoxFocused")})));this.own(f(this.domNode,p,r.hitch(this,function(){this.status&&(this.checked?this.uncheck():this.check())})))},a11y_changeAriaCheckedAttr:function(){l.setAttr(this.domNode,"aria-checked",this.checked?"true":"false")},a11y_setDisabled:function(c){c=c.toString();"false"===c?l.removeAttr(this.domNode,"disabled"):
l.setAttr(this.domNode,"disabled",c);l.setAttr(this.domNode,"aria-disabled",c)},a11y_updateAriaLabel:function(c){""===this.label?(l.setAttr(this.domNode,"title",this.title),l.setAttr(this.domNode,"aria-label",this.title)):l.setAttr(this.domNode,"aria-label",this.title?this.title:c)}}})},"jimu/dijit/SymbolChooser":function(){define("dojo/_base/declare dijit/_WidgetBase jimu/dijit/BindLabelPropsMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SymbolChooser.html dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/sniff dojo/query dojo/request/xhr dojo/Deferred dojox/gfx dojo/promise/all jimu/utils jimu/symbolUtils jimu/portalUrlUtils esri/symbols/jsonUtils esri/symbols/SimpleMarkerSymbol esri/symbols/PictureMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/TextSymbol esri/symbols/Font esri/arcgis/Portal esri/request jimu/dijit/ImageChooser jimu/dijit/ColorPicker jimu/dijit/_Transparency jimu/dijit/LoadingIndicator jimu/dijit/formSelect dijit/form/NumberSpinner".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C,D,y,w,A,G,E,F,H,L){return r([f,l,p,c,n],{templateString:q,baseClass:"jimu-symbol-chooser",declaredClass:"jimu.dijit.SymbolChooser",nls:null,_pointEventsBinded:!1,_lineEventBinded:!1,_fillEventBinded:!1,_textEventBinded:!1,_invokeSymbolChangeEvent:!0,_customPictureMarkerSymbol:null,isArrow:!1,symbol:null,type:null,DEFAULT_PORTAL_URL:"//arcgis.com/",_portalLoadTimeoutInMs:3E3,_isOnline:!0,_localTypes:"basic A-Z arrows business cartographic nationalParkService outdoorRecreation peoplePlaces safetyHealth shapes transportation damage disasters emergencyManagement generalInfrastructure localGovernment numbers pointsOfInterest stateGovernment FireFly".split(" "),
cropImage:!1,postMixInProperties:function(){this.nls=window.jimuNls.symbolChooser;this._setTemplateNls()},postCreate:function(){this.inherited(arguments);this._initImageChooser();this.own(e(document.body,"click",k.hitch(this,this._onBodyClicked)));(this._isIE8=8===b("ie"))&&h.addClass(this.domNode,"ie8");this.symbol?this.showBySymbol(this.symbol):this.type&&this.showByType(this.type)},reset:function(){this.symbol=this.type=null;this._hideAllSections()},showBySymbol:function(a){this.reset();var b=
a&&a.declaredClass;b&&"string"===typeof b&&0<=b.indexOf("esri.symbol")&&(this.symbol=this._cloneSymbol(a),this.isSimpleMarkerSymbol(this.symbol)||this.isPictureMarkerSymbol(this.symbol)?(this.type="marker",this._initPointSection()):this.isSimpleLineSymbol(this.symbol)?(this.type="line",this._initLineSection()):this._isSimpleFillSymbol(this.symbol)?(this.type="fill",this._initFillSection()):this._isTextSymbol(this.symbol)&&(this.type="text",this._initTextSection()))},showByType:function(a){this.reset();
if("marker"===a||"line"===a||"fill"===a||"text"===a)this.type=a,"marker"===this.type?this._initPointSection():"line"===this.type?this._initLineSection():"fill"===this.type?this._initFillSection():"text"===this.type&&this._initTextSection()},getSymbol:function(){return this._getSymbol(!1)},getValidSymbol:function(){return this._getSymbol(!0)},_getSymbol:function(a){var b=null;"marker"===this.type?b=this._getPointSymbolBySetting(a):"line"===this.type?b=this._getLineSymbolBySetting(a):"fill"===this.type?
b=this._getFillSymbolBySetting(a):"text"===this.type&&(b=this._getTextSymbolBySetting(a));a=null;b&&(a=this._cloneSymbol(b));return a},hideColorPicker:function(){for(var a="pointColor pointOutlineColor lineColor fillColor fillOutlineColor textColor".split(" "),b=0,d=a.length;b<d;b++){var c=a[b];this[c]&&this[c].hideTooltipDialog()}},_onBodyClicked:function(a){a=a.target||a.srcElement;this._tryHideDropDownOfSelectDijit(a,this.pointSymClassSelect);this._tryHideDropDownOfSelectDijit(a,this.lineStylesSelect)},
_tryHideDropDownOfSelectDijit:function(a,b){var d=b.domNode,c=b.dropDown.domNode,d=a===d||h.isDescendant(a,d);a=a===c||h.isDescendant(a,c);if(!d&&!a)b.dropDown.onCancel()},_onChange:function(a){a=this._cloneSymbol(a);this.emit("change",a)},_hideAllSections:function(){m(".symbol-section",this.domNode).style("display","none")},_showSection:function(a){this._hideAllSections();m("."+a+"-symbol-section",this.domNode).style("display","block")},_getAncestor:function(a,b,d){return v.getAncestorDom(a,b,d)},
_getAbsoluteUrl:function(a){return window.location.protocol+"//"+window.location.host+require.toUrl(a)},_cloneSymbol:function(a){if(!a)return null;var b=a;try{var d=a.toJson(),b=C.fromJson(d);"fill"===this.type&&(b.arrowWidth=a.arrowWidth)}catch(K){console.error(K)}return b},_createSymbolIconTable:function(a,b,d){var c=this.type+"-icon-table";a=h.toDom('\x3ctable class\x3d"'+("icon-table "+c+" "+(c+"-"+a))+'"\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e');for(var c=m("tbody",a)[0],e=Math.ceil(b.length/
8),f=0;f<e;f++)h.create("tr",{},c);var g=m("tr",a);t.forEach(b,k.hitch(this,function(a,b){var c=k.clone(a),e=C.fromJson(a);b=h.create("td",{},g[Math.floor(b/8)]);h.addClass(b,"symbol-td-item");e=this._createSymbolNode(e);h.addClass(e,"symbol-div-item");var f=e.firstChild;h.addClass(f,"svg-node");if(this._isIE8&&"point"===d)if(window.isRTL){if("Cross"===a.name||"X"===a.name)h.setStyle(f,"right","-20px"),h.setStyle(e,"marginTop","20px")}else"Cross"!==a.name&&"X"!==a.name||h.setStyle(e,"marginTop","20px");
e.symbol=c;h.place(e,b)}));return a},_updatePreview:function(a){var b=this._cloneSymbol(this.symbol);h.empty(a);(b=B.createSymbolNode(b))||(b=h.create("div"));h.place(b,a)},_createSymbolNode:function(a){(a=B.createSymbolNode(a,{width:36,height:36}))||(a=h.create("div"));h.setStyle(a,{width:"36px",height:"36px"});return a},_getLineShapeDesc:function(a){var b=null;if(this.isSimpleLineSymbol(a)||this.isCartographicLineSymbol(a))b={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},fill:null,stroke:a.getStroke()};
return b},_initPointSection:function(){this._showSection("point");this._pointEventsBinded||(this._pointEventsBinded=!0,this._bindPointEvents(),this._onPointSymClassSelectChange());this.isPictureMarkerSymbol(this.symbol)?this._showBuildInPictureMarkerSymSettings():(this.isSimpleMarkerSymbol(this.symbol)||(this.symbol=new D({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})),this._showSimpleMarkerSymSettings());this._initPointSettings(this.symbol);
this._getPointSymbolBySetting()},_bindPointEvents:function(){this.own(e(this.pointIconTables,".symbol-div-item:click",k.hitch(this,this._onPointSymIconItemClick)));this.own(e(this.pointSymClassSelect,"change",k.hitch(this,this._onPointSymClassSelectChange)));this.own(e(this.pointSize,"change",k.hitch(this,this._onPointSymbolChange,!1)));this.own(e(this.pointColor,"change",k.hitch(this,this._onPointSymbolChange,!1)));this.own(e(this.pointAlpha,"change",k.hitch(this,this._onPointSymbolChange,!1)));
this.own(e(this.pointOutlineColor,"change",k.hitch(this,this._onPointSymbolChange,!1)));this.own(e(this.pointOutlineWidth,"change",k.hitch(this,this._onPointSymbolChange,!1)))},_onPointSymbolChange:function(a){this._invokeSymbolChangeEvent&&(this._getPointSymbolBySetting(a),this._onChange(this.symbol))},_initPointSettings:function(a){if(a){this._invokeSymbolChangeEvent=!1;if(this.isSimpleMarkerSymbol(a)){if(this.pointSize.set("value",a.size),this.pointColor.setColor(a.color),this.pointAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),
a=a.outline)this.pointOutlineColor.setColor(a.color),this.pointOutlineWidth.set("value",parseFloat(a.width.toFixed(0)))}else this.isPictureMarkerSymbol(a)&&this.pointSize.set("value",a.width);this._invokeSymbolChangeEvent=!0}},isSimpleMarkerSymbol:function(a){return a&&"esri.symbol.SimpleMarkerSymbol"===a.declaredClass},isPictureMarkerSymbol:function(a){return a&&"esri.symbol.PictureMarkerSymbol"===a.declaredClass},_isCustomImageOptionSelected:function(){return"custom"===this.pointSymClassSelect.get("value")},
_onPointSymClassSelectChange:function(){if(this._isCustomImageOptionSelected())this._showCustomPictureMarkerSymSettings(),this._customPictureMarkerSymbol&&(this.symbol=this._customPictureMarkerSymbol,this._onPointSymbolChange());else{this._showSimpleMarkerSymSettings();this._showSelectedPointSymIconTable();var a=this.pointSymClassSelect.get("value");this.pointSymClassSelect["def"+a]?(a=this.pointSymClassSelect.getOptions(a),this.pointSymClassSelect.domNode.title=a?a.label:""):this._requestPointSymJson(a)}},
_hideAllPointSymIconTable:function(){m(".marker-icon-table",this.pointIconTables).style("display","none")},_showSelectedPointSymIconTable:function(){this._hideAllPointSymIconTable();var a=this.pointSymClassSelect.get("value"),a=m(".marker-icon-table-"+a,this.pointIconTables);0<a.length&&a.style("display","table")},_getLocalSymbols:function(b){b=b||this.pointSymClassSelect.get("value");b=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json");return a(b,{handleAs:"json"})},_getPortalSymbolsByType:function(a){var b=
new g;a?this._fetchSymbols(a).then(k.hitch(this,function(a){b.resolve(a)}),k.hitch(this,function(a){b.reject(a)})):b.reject(null);return b},_requestPointSymJson:function(a){this.pointSymClassSelect["def"+a]||(this.loadingShelter.show(),!this._isOnline&&window.isXT?this._offLineGetSymbols(a):this._symbolTypes?this._handleGetPointSymbols(k.hitch(this,this._getPortalSymbolsByType),a):this._initPortal().then(k.hitch(this,this._fetchSymbolTypes)).then(k.hitch(this,function(b){this.domNode&&(this._clearOptions(),
this._createOptions(b),this._handleGetPointSymbols(k.hitch(this,this._getPortalSymbolsByType),a))}),k.hitch(this,function(b){this.domNode&&(window.isXT?this._offLineGetSymbols(a):(this.loadingShelter.hide(),console.error("Fetching symbols failed",b)))})))},_offLineGetSymbols:function(a){this._isOnline=!1;if(0===this.pointSymClassSelect.options.length){var b=[];t.forEach(this._localTypes,k.hitch(this,function(a,d){b.push({id:d,title:this.nls[a]||a})}));this._clearOptions();this._createOptions(b)}this._handleGetPointSymbols(k.hitch(this,
this._getLocalSymbols),a)},_clearOptions:function(){this.pointSymClassSelect&&this.pointSymClassSelect.removeOption(this.pointSymClassSelect.options)},_createOptions:function(a){if(this.pointSymClassSelect){var b=[],d="",c=!1;"[object Array]"===Object.prototype.toString.call(a)&&0<a.length&&t.forEach(a,k.hitch(this,function(a){d=a.title||a.name;c=d===this.nls.basic?!0:!1;d&&(a.id||0===a.id)&&b.push({label:d,value:a.id,selected:c})}));b.push({label:this.nls.customImage,value:"custom"});this.pointSymClassSelect.addOption(b)}},
_initPortal:function(){var a=new g;if(this._portal)a.resolve();else{var b=z.getStandardPortalUrl(window.portalUrl),d=new F.Portal(b?b:this.DEFAULT_PORTAL_URL);if(d.loaded)return this._portal=d,a.resolve(),a.promise;this.own(d.on("load",k.hitch(this,function(){this._portal=d;a.resolve()})));setTimeout(function(){a.reject()},this._portalLoadTimeoutInMs)}return a},_handleGetPointSymbols:function(a,b){if(this.pointSymClassSelect){var d=b||this.pointSymClassSelect.get("value");b="def"+d;a=a(d);this.pointSymClassSelect[b]=
a;a.then(k.hitch(this,function(a){this.domNode&&(this.loadingShelter.hide(),this._getPointSymbolsSucess(d,a))}),k.hitch(this,function(a){this.domNode&&(this.loadingShelter.hide(),console.error("Fetching symbols failed",a))}))}},_getPointSymbolsSucess:function(a,b){if(this.domNode){var d=this.pointSymClassSelect.getOptions(a);this.pointSymClassSelect.domNode.title=d?d.label:"";a=this._createSymbolIconTable(a,b,"point");h.place(a,this.pointIconTables);this._showSelectedPointSymIconTable()}},_fetchSymbols:function(a){var b=
[],d=new g,b=this._symbolTypes.filter(function(b){return b.id===a});this._getSymbolListData(b).then(k.hitch(this,function(a){d.resolve(a)}),k.hitch(this,function(a){console.warn("fetch symbols failed",a);d.reject(a)}));return d},_getSymbolListData:function(a){a=t.filter(a,function(a){return a.dataUrl});a=t.map(a,function(a){return H({url:a.dataUrl}).promise});return u(a).then(function(a){return a[0]})},_fetchSymbolTypes:function(){var a=new g;this._symbolTypes?a.resolve(this._symbolTypes):this._getSymbolListGroupId().then(k.hitch(this,
this._getSymbolListItems)).then(k.hitch(this,function(b){this._symbolTypes=b;a.resolve(b)}),k.hitch(this,function(b){console.warn("fetch symbol types failed",b);a.reject(b)}));return a},_getSymbolListGroupId:function(){var a=new g;this._portal||a.reject("no portal");this._portal.queryGroups({q:this._portal.symbolSetsGroupQuery}).then(function(b){a.resolve(b.results[0].id)},k.hitch(this,function(b){console.warn("get symbol list group id failed",b);a.reject(b)}));return a},_getSymbolListItems:function(a){var b=
new g,c=this._portal;a="group:"+a+' AND type:"Symbol Set"';var e=[];this._portal||b.reject("no portal");a="vml"===d.renderer?a+' AND -typekeywords:"by value"':a+' AND (typekeywords:"by value" AND typekeywords:"marker")';c.queryItems({q:a,num:20,sortField:"title"}).then(k.hitch(this,function(a){var d,c,f,g;t.forEach(a.results,function(a){d=a.typeKeywords.join(" ");-1<d.indexOf("marker")&&(c=a.title,f={name:c,id:a.id,title:a.title,keywords:d,dataUrl:a.itemDataUrl},(g=-1<d.indexOf("default"))?(f.defaultType=
!0,e.unshift(f)):e.push(f))},this);0<e.length?b.resolve(e):b.reject()}),function(){b.reject()});return b},_onPointSymIconItemClick:function(a){if(a=this._getAncestor(a.target||a.srcElement,function(a){return h.hasClass(a,"symbol-div-item")},5))if(m(".selected-symbol-div-item",a.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),h.addClass(a,"selected-symbol-div-item"),a=a.symbol){this.symbol=C.fromJson(a);a=h.getStyle(this.pointColorTr,"display");this.isSimpleMarkerSymbol(this.symbol)?
this._showSimpleMarkerSymSettings():this._showBuildInPictureMarkerSymSettings();this._onPointSymbolChange(!0);var b=h.getStyle(this.pointColorTr,"display");a!==b&&this.emit("resize")}},_showSimpleMarkerSymSettings:function(){h.addClass(this.pointCustomImageTr,"hidden");h.removeClass(this.pointIconTablesTr,"hidden");h.removeClass(this.pointColorTr,"hidden");h.removeClass(this.pointOpacityTr,"hidden");h.removeClass(this.pointOutlineColorTr,"hidden");h.removeClass(this.pointOulineWidthTr,"hidden")},
_showBuildInPictureMarkerSymSettings:function(){h.addClass(this.pointCustomImageTr,"hidden");h.removeClass(this.pointIconTablesTr,"hidden");h.addClass(this.pointColorTr,"hidden");h.addClass(this.pointOpacityTr,"hidden");h.addClass(this.pointOutlineColorTr,"hidden");h.addClass(this.pointOulineWidthTr,"hidden")},_showCustomPictureMarkerSymSettings:function(){h.removeClass(this.pointCustomImageTr,"hidden");h.addClass(this.pointIconTablesTr,"hidden");h.addClass(this.pointColorTr,"hidden");h.addClass(this.pointOpacityTr,
"hidden");h.addClass(this.pointOutlineColorTr,"hidden");h.addClass(this.pointOulineWidthTr,"hidden")},_getPointSymbolBySetting:function(a){if(!this.symbol||a&&!this.pointSize.validate())return null;var b=parseFloat(this.pointSize.get("value"));if(this.isSimpleMarkerSymbol(this.symbol)){if(a&&!this.pointOutlineWidth.validate())return null;this.symbol.setSize(b);a=this.pointColor.getColor();b=this.pointAlpha.getAlpha();a.a=b;this.symbol.setColor(a);a=this.pointOutlineColor.getColor();var b=(b=parseFloat(this.pointOutlineWidth.get("value")))?
b:0,d=new w;d.setStyle(w.STYLE_SOLID);d.setColor(a);d.setWidth(b);this.symbol.setOutline(d)}else this.isPictureMarkerSymbol(this.symbol)&&(this.symbol.setWidth(b),this.symbol.setHeight(b));this._updatePreview(this.pointSymPreview);return this.symbol},_initImageChooser:function(){this.imageChooser=new L({cropImage:this.cropImage,customZIndex:this.customZIndex,showSelfImg:!1,goldenWidth:16,goldenHeight:16,format:["image/gif","image/png","image/jpeg"],label:this.nls.chooseFile});h.addClass(this.imageChooser.domNode,
"custom-image-chooser");this.own(e(this.imageChooser,"change",k.hitch(this,this._onImageChange)));this.imageChooser.placeAt(this.customImageTd,"first")},_onImageChange:function(a,b){this.imageNameNode.innerHTML=b.fileName;a=a.replace(/^data:image\/.*;base64,/,"");b=parseFloat(this.pointSize.get("value"));this._customPictureMarkerSymbol=this.symbol=new y({type:"esriPMS",url:null,imageData:a,contentType:"image/png",color:null,width:b,height:b,angle:0,xoffset:0,yoffset:0});this._onPointSymbolChange()},
_initLineSection:function(){this._showSection("line");this._lineEventBinded||(this._lineEventBinded=!0,this._bindLineEvents(),this._requestLineSymJson("line"));this._initLineSettings(this.symbol);this._getLineSymbolBySetting()},_bindLineEvents:function(){this.own(e(this.lineIconTables,".symbol-div-item:click",k.hitch(this,this._onLineSymIconItemClick)));this.own(e(this.lineColor,"change",k.hitch(this,this._onLineSymbolChange)));this.own(e(this.lineStylesSelect,"change",k.hitch(this,this._onLineSymbolChange)));
this.own(e(this.lineAlpha,"change",k.hitch(this,this._onLineSymbolChange)));this.own(e(this.lineWidth,"change",k.hitch(this,this._onLineSymbolChange)))},_onLineSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getLineSymbolBySetting(),this._onChange(this.symbol))},_initLineSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.lineColor.setColor(a.color),this.lineAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),this.lineWidth.set("value",parseFloat(a.width.toFixed(0))),this.lineStylesSelect.set("value",
a.style),this._invokeSymbolChangeEvent=!0)},isSimpleLineSymbol:function(a){return a&&"esri.symbol.SimpleLineSymbol"===a.declaredClass},isCartographicLineSymbol:function(a){return a&&"esri.symbol.CartographicLineSymbol"===a.declaredClass},_requestLineSymJson:function(b){var d=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json");a(d,{handleAs:"json"}).then(k.hitch(this,function(a){this.domNode&&(a=this._createSymbolIconTable(b,a,"line"),h.place(a,this.lineIconTables))}),k.hitch(this,function(a){console.error("get line symbol failed",
a)}))},_onLineSymIconItemClick:function(a){if(a=this._getAncestor(a.target||a.srcElement,function(a){return h.hasClass(a,"symbol-div-item")},5))if(m(".selected-symbol-div-item",a.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),h.addClass(a,"selected-symbol-div-item"),a=a.symbol)a=C.fromJson(a),this._initLineSettings(a),this._onLineSymbolChange()},_getLineSymbolBySetting:function(a){if(a&&!this.lineWidth.validate())return null;this.symbol=new w;a=this.lineColor.getColor();
var b=this.lineStylesSelect.get("value");a.a=this.lineAlpha.getAlpha();var d=parseFloat(this.lineWidth.get("value"));this.symbol.setStyle(b);this.symbol.setColor(a);this.symbol.setWidth(d);this._updatePreview(this.lineSymPreview);return this.symbol},setFillSectionType:function(a){a?h.addClass(this.fillSection,"arrow-symbol-section"):h.removeClass(this.fillSection,"arrow-symbol-section");this.isArrow=a;this._onFillSymbolChange(!0)},_initFillSection:function(){this.setFillSectionType(this.isArrow);
this._showSection("fill");this._fillEventBinded||(this._fillEventBinded=!0,this._bindFillEvents(),this._requestFillSymJson("fill"));this._initFillSettings(this.symbol);this._getFillSymbolBySetting()},_bindFillEvents:function(){this.own(e(this.fillIconTables,".symbol-div-item:click",k.hitch(this,this._onFillSymIconItemClick)));this.own(e(this.fillColor,"change",k.hitch(this,this._onFillSymbolChange,!1)));this.own(e(this.fillAlpha,"change",k.hitch(this,this._onFillSymbolChange,!1)));this.own(e(this.fillOutlineColor,
"change",k.hitch(this,this._onFillSymbolChange,!1)));this.own(e(this.fillOutlineWidth,"change",k.hitch(this,this._onFillSymbolChange,!1)));this.own(e(this.arrowWidth,"change",k.hitch(this,this._onFillSymbolChange,!1)))},_onFillSymbolChange:function(a){this._invokeSymbolChangeEvent&&(this._getFillSymbolBySetting(a),this._onChange(this.symbol))},_initFillSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.fillColor.setColor(a.color),this.fillAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),
a.outline&&(this.fillOutlineColor.setColor(a.outline.color),this.fillOutlineWidth.set("value",parseInt(a.outline.width,10))),this._invokeSymbolChangeEvent=!0,this.arrowWidth.set("value",parseInt(a.arrowWidth,10)))},_isSimpleFillSymbol:function(a){return a&&"esri.symbol.SimpleFillSymbol"===a.declaredClass},_requestFillSymJson:function(b){var d=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json");a(d,{handleAs:"json"}).then(k.hitch(this,function(a){this.domNode&&(a=this._createSymbolIconTable(b,
a,"fill"),h.place(a,this.fillIconTables))}),k.hitch(this,function(a){console.error("get fill symbol failed",a)}))},_onFillSymIconItemClick:function(a){if(a=this._getAncestor(a.target||a.srcElement,function(a){return h.hasClass(a,"symbol-div-item")},5))if(m(".selected-symbol-div-item",a.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),h.addClass(a,"selected-symbol-div-item"),a=a.symbol)a=C.fromJson(a),a.arrowWidth=this.symbol.arrowWidth,this._initFillSettings(a),this._onFillSymbolChange()},
_getFillSymbolBySetting:function(a){if(a&&(!this.fillOutlineWidth.validate()||this.isArrow&&!this.arrowWidth.validate()))return null;this.symbol=new A;var b=this.fillColor.getColor();b.a=this.fillAlpha.getAlpha();a=this.fillOutlineColor.getColor();var d=parseInt(this.fillOutlineWidth.get("value"),10),d=d?d:0;this.symbol.setColor(b);this.symbol.setStyle(A.STYLE_SOLID);b=new w;b.setStyle(w.STYLE_SOLID);b.setColor(a);b.setWidth(d);this.symbol.setOutline(b);a=parseInt(this.arrowWidth.get("value"),10);
this.symbol.arrowWidth=a;this._updatePreview(this.fillSymPreview);return this.symbol},_initTextSection:function(){this._showSection("text");this._textEventBinded||(this._textEventBinded=!0,this._bindTextEvents());this._initTextSettings();this._getTextSymbolBySetting()},_bindTextEvents:function(){this.own(e(this.inputText,"change",k.hitch(this,this._onTextSymbolChange)));this.own(e(this.textColor,"change",k.hitch(this,this._onTextSymbolChange)));this.own(e(this.textFontSize,"change",k.hitch(this,this._onTextSymbolChange)))},
_onTextSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getTextSymbolBySetting(),this._onChange(this.symbol))},_initTextSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.inputText.value=a.text,this.textColor.setColor(a.color),a=parseInt(a.font.size,10),this.textFontSize.set("value",a),this._invokeSymbolChangeEvent=!0)},_isTextSymbol:function(a){return a&&"esri.symbol.TextSymbol"===a.declaredClass},_updateTextPreview:function(a,b){var d=this.textColor.getColor().toHex(),c=
parseInt(this.textFontSize.get("value"),10)+"px";h.setStyle(this.textPreview,{color:d,fontSize:c,fontFamily:b});this.textPreview.innerHTML=a},_getTextSymbolBySetting:function(a){var b=v.sanitizeHTML(this.inputText.value);if(a&&(""===b.replace(/^\s+|\s+$/g,"")||!this.textFontSize.validate()))return null;this.symbol=new G;a=this.textColor.getColor();var d=parseInt(this.textFontSize.get("value"),10),c=new E;c.setSize(d);this.symbol.setText(b);this.symbol.setColor(a);this.symbol.setFont(c);this._updateTextPreview(b,
c.family);return this.symbol},_setTemplateNls:function(){"undefined"===typeof this.nls.damage&&(this.nls.damage="Damage");"undefined"===typeof this.nls.disasters&&(this.nls.disasters="Disasters");"undefined"===typeof this.nls.emergencyManagement&&(this.nls.emergencyManagement="Emergency Management");"undefined"===typeof this.nls.generalInfrastructure&&(this.nls.generalInfrastructure="General Infrastructure");"undefined"===typeof this.nls.localGovernment&&(this.nls.localGovernment="Local Government");
"undefined"===typeof this.nls.numbers&&(this.nls.numbers="Numbers");"undefined"===typeof this.nls.pointsOfInterest&&(this.nls.pointsOfInterest="Points of Interest");"undefined"===typeof this.nls.stateGovernment&&(this.nls.stateGovernment="State Government")}})})},"esri/arcgis/Portal":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/_base/array dojo/_base/sniff require ../kernel ../lang ../request ../urlUtils ../Evented ../IdentityManager".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b){var m={options:{disableIdentityLookup:!0},requestParams:{f:"json"}},a=function(b){function d(d){b[d]||(b[d]=function(){var e=arguments;return p.when(b,function(b){Array.prototype.unshift.call(e,b.results||b);return a(c[d].apply(c,e))})})}if(!b)return b;b.then&&(b=f.delegate(b));b.total||(b.total=p.when(b,function(a){return h.isDefined(a.total)?a.total:a.length||0}));d("forEach");d("filter");d("map");d("some");d("every");return b},g={useSSL:function(a,b){var d=m&&
m.self||{};if(d&&!d.isPortal)return-1!==a.indexOf("https:")||d.allSSL?b.replace("http:","https:"):b;var c=g.getLocation(b);return-1<d.portalHostname.toLowerCase().indexOf(c.hostname.toLowerCase())&&c.port&&"80"!==c.port&&"443"!==c.port?(b=c.pathname,b=0===b.indexOf("/")?b:"/"+b,d.allSSL||-1<a.indexOf("https:")?"https://"+c.hostname+(d.httpsPort&&"443"!==d.httpsPort?":"+d.httpsPort:"")+b+c.search:"http://"+c.hostname+(d.httpPort&&"80"!==d.httpPort?":"+d.httpPort:"")+b+c.search):-1!==a.indexOf("https:")||
d.allSSL?b.replace("http:","https:"):b},formatUrl:function(a){var b=m.currentToken;return-1!==a.indexOf("null")?null:g.useSSL(window.location.protocol,b?a+(-1!==a.indexOf("?")?"\x26":"?")+("token\x3d"+b):a)},getLocation:function(a){var b=document.createElement("a");b.href=a;return{protocol:b.protocol,hostname:b.hostname,port:b.port,pathname:b.pathname,search:b.search,hash:b.hash,host:b.host}},resultsToTypedArray:function(a,b,d){d=d?d.listings||d.notifications||d.userInvitations||d.tags||d.items||
d.groups||d.comments||d.provisions||d.results||d:[];return c.map(d,function(d){d=f.mixin(d,b||{});return a?new a(d):d})},clearFieldsFromObject:function(a,b){var d,c=a.length;if(f.isArray(a))for(d=0;d<c;d++)delete b[a[d]];else for(d in a)delete b[d];return b},requestToTypedArray:function(b,d,c,e,h){return a(g.request(b,d,c).then(f.partial(g.resultsToTypedArray,e,h)))},request:function(a,b,d){var c;b&&b.portal&&delete b.portal;b&&b.form&&(c=b.form,delete b.form);b=f.mixin(f.mixin({},b||{}),m.requestParams);
d=f.mixin(d||{},m.options);return t({url:g.useSSL(window.location.protocol,a.url||a),content:b,callbackParamName:"callback",timeout:d&&d.timeout||0,form:c},d)},formatQueryParams:function(a,b,d){a=f.mixin(f.mixin({},a),f.isString(b)?{q:b}:b||{});a.q=!d&&m.extraQuery?"("+a.q+")"+m.extraQuery:a.q;return a}},d=r([],{declaredClass:"esri.arcgis.PortalComment",constructor:function(a){f.mixin(this,a);this.url=this.item.itemUrl+"/comments/"+this.id;this.created=this.created?new Date(this.created):null}}),
u=r([],{declaredClass:"esri.arcgis.PortalRating",constructor:function(a){f.mixin(this,a);this.url=this.item.itemUrl+"/rating";this.created=this.created?new Date(this.created):null}}),v=r([],{declaredClass:"esri.arcgis.PortalItem",constructor:function(a){f.mixin(this,a);this.folderId=this.ownerFolder||this.folderId;this.itemUrl=(this.portal&&this.portal.portalUrl)+"content/items/"+this.id;this.userItemUrl=this.hasOwnProperty("ownerFolder")?this.itemUrl.replace("/content/","/content/users/"+this.owner+
(this.folderId?"/"+this.folderId:"")+"/"):null;this.itemDataUrl=g.formatUrl(this.itemUrl+"/data");this.thumbnailUrl=g.formatUrl(this.itemUrl+"/info/"+this.thumbnail);this.displayName=this._getDisplayName();this.iconUrl=this._getIconUrl();this.isPremiumContent=this._getIsPremiumContent();this.created=this.created?new Date(this.created):null;this.uploaded=this.uploaded?new Date(this.uploaded):null;this.modified=this.modified?new Date(this.modified):null},getTypeInfo:function(){var a=this.type;return{source:-1<
c.indexOf(this.typeKeywords||[],"ArcGIS Server")||"Feature Collection"===a?a:null,displayName:this.displayName,iconUrl:this.iconUrl,isPremiumContent:this.isPremiumContent,premiumIconUrl:this._getPremiumIconUrl()}},addComment:function(a){var b=f.isString(a)?{comment:a}:a;return g.request(this.itemUrl+"/addComment",b,{usePost:!0}).then(f.hitch(this,function(a){return new d(f.mixin(b,{id:a.commentId,item:this}))}))},updateComment:function(a){if(a&&a.url&&a.comment)return g.request(a.url+"/update",{comment:a.comment},
{usePost:!0}).then(function(b){a.id=b.commentId;return a});throw Error();},getComments:function(){return g.requestToTypedArray(this.itemUrl+"/comments",null,null,d,{item:this})},deleteComment:function(a){if(a&&a.url)return g.request(a.url+"/delete",null,{usePost:!0});throw Error();},addRating:function(a){var b=f.isObject(a)?a:{rating:parseFloat(a)};return g.request(this.itemUrl+"/addRating",b,{usePost:!0}).then(f.hitch(this,function(a){return new u(f.mixin(b,{id:a.ratingId,item:this}))}))},getRating:function(){return g.request(this.itemUrl+
"/rating").then(f.hitch(this,function(a){return new u(f.mixin(a,{item:this}))}))},deleteRating:function(){return g.request(this.itemUrl+"/deleteRating",null,{usePost:!0})},_getDisplayName:function(){var a=this.type,b=this.typeKeywords||[],d=a;"Feature Service"===a||"Feature Collection"===a?d=-1<c.indexOf(b,"Table")?"Table":-1<c.indexOf(b,"Route Layer")?"Route Layer":-1<c.indexOf(b,"Markup")?"Markup":"Feature Layer":"Image Service"===a?d=-1<c.indexOf(b,"Elevation 3D Layer")?"Elevation Layer":"Imagery Layer":
"Scene Service"===a?d="Scene Layer":"Scene Package"===a?d="Scene Layer Package":"Stream Service"===a?d="Feature Layer":"Geoprocessing Service"===a&&this.portal&&this.portal.isPortal?d=-1<c.indexOf(b,"Web Tool")?"Tool":"Geoprocessing Service":"Geocoding Service"===a?d="Locator":"Microsoft Powerpoint"===a?d="Microsoft PowerPoint":"GeoJson"===a?this.type=d="GeoJSON":"Globe Service"===a?d="Globe Layer":"Vector Tile Service"===a?d="Tile Layer":"netCDF"===a?d="NetCDF":"Map Service"===a?d=-1===c.indexOf(b,
"Spatiotemporal")&&(-1<c.indexOf(b,"Hosted Service")||-1<c.indexOf(b,"Tiled"))&&-1===c.indexOf(b,"Relational")?"Tile Layer":"Map Image Layer":a&&-1<a.toLowerCase().indexOf("add in")?d=a.replace(/(add in)/ig,"Add-In"):"datastore catalog service"===a?d="Big Data File Share":"Compact Tile Package"===a?d="Tile Package (tpkx)":"Raster function template"===a&&(d="Raster Function Template");return d},_getIconUrl:function(){var a=this.type&&this.type.toLowerCase()||"",b=this.typeKeywords||[],d=!1,e=!1,f=
!1,g=!1,h=!1,e=!1;0<a.indexOf("service")||"feature collection"===a||"kml"===a||"wms"===a||"wmts"===a||"wfs"===a?(d=-1<c.indexOf(b,"Hosted Service"),"feature service"===a||"feature collection"===a||"kml"===a||"wfs"===a?(g=-1<c.indexOf(b,"Table"),e=-1<c.indexOf(b,"Route Layer"),f=-1<c.indexOf(b,"Markup"),a=(h=-1!==c.indexOf(b,"Spatiotemporal"))&&g?"spatiotemporaltable":g?"table":e?"routelayer":f?"markup":h?"spatiotemporal":d?"featureshosted":"features"):"map service"===a||"wms"===a||"wmts"===a?(h=-1!==
c.indexOf(b,"Spatiotemporal"),e=-1!==c.indexOf(b,"Relational"),a=h||e?"mapimages":d||-1<c.indexOf(b,"Tiled")||"wmts"===a?"maptiles":"mapimages"):a="scene service"===a?-1<c.indexOf(b,"Line")?"sceneweblayerline":-1<c.indexOf(b,"3DObject")?"sceneweblayermultipatch":-1<c.indexOf(b,"Point")?"sceneweblayerpoint":-1<c.indexOf(b,"IntegratedMesh")?"sceneweblayermesh":-1<c.indexOf(b,"PointCloud")?"sceneweblayerpointcloud":-1<c.indexOf(b,"Polygon")?"sceneweblayerpolygon":-1<c.indexOf(b,"Building")?"sceneweblayerbuilding":
"sceneweblayer":"image service"===a?-1<c.indexOf(b,"Elevation 3D Layer")?"elevationlayer":"imagery":"stream service"===a?"streamlayer":"vector tile service"===a?"vectortile":"datastore catalog service"===a?"datastorecollection":"geocoding service"===a?"geocodeservice":"geoprocessing service"===a?-1<c.indexOf(b,"Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":"layers"):a="web map"===a||"cityengine web scene"===a?"maps":"web scene"===a?-1<c.indexOf(b,"ViewingMode-Local")?"webscenelocal":
"websceneglobal":"web mapping application"===a||"mobile application"===a||"application"===a||"operation view"===a||"desktop application"===a?"apps":"map document"===a||"map package"===a||"published map"===a||"scene document"===a||"globe document"===a||"basemap package"===a||"mobile basemap package"===a||"mobile map package"===a||"project package"===a||"project template"===a||"pro map"===a||"layout"===a||"layer"===a&&-1<c.indexOf(b,"ArcGIS Pro")||"explorer map"===a&&c.indexOf(b,"Explorer Document")?
"mapsgray":"service definition"===a||"csv"===a||"shapefile"===a||"cad drawing"===a||"geojson"===a||"360 vr experience"===a||"netcdf"===a?"datafiles":"explorer add in"===a||"desktop add in"===a||"windows viewer add in"===a||"windows viewer configuration"===a?"appsgray":"arcgis pro add in"===a||"arcgis pro configuration"===a?"addindesktop":"rule package"===a||"file geodatabase"===a||"sqlite geodatabase"===a||"csv collection"===a||"kml collection"===a||"windows mobile package"===a||"map template"===
a||"desktop application template"===a||"arcpad package"===a||"code sample"===a||"form"===a||"document link"===a||"operations dashboard add in"===a||"rules package"===a||"image"===a||"workflow manager package"===a||"explorer map"===a&&-1<c.indexOf(b,"Explorer Mapping Application")||-1<c.indexOf(b,"Document")?"datafilesgray":"network analysis service"===a||"geoprocessing service"===a||"geodata service"===a||"geometry service"===a||"geoprocessing package"===a||"locator package"===a||"geoprocessing sample"===
a||"workflow manager service"===a?"toolsgray":"layer"===a||"layer package"===a||"explorer layer"===a?"layersgray":"scene package"===a?"scenepackage":"mobile scene package"===a?"mobilescenepackage":"tile package"===a||"compact tile package"===a?"tilepackage":"task file"===a?"taskfile":"report template"===a?"report-template":"statistical data collection"===a?"statisticaldatacollection":"insights workbook"===a?"workbook":"insights model"===a?"insightsmodel":"insights page"===a?"insightspage":"insights theme"===
a?"insightstheme":"hub initiative"===a?"hubinitiative":"hub page"===a?"hubpage":"hub site application"===a?"hubsite":"relational database connection"===a?"relationaldatabaseconnection":"big data file share"===a?"datastorecollection":"image collection"===a?"imagecollection":"desktop style"===a?"desktopstyle":"style"===a?"style":"dashboard"===a?"dashboard":"raster function template"===a?"rasterprocessingtemplate":"vector tile package"===a?"vectortilepackage":"ortho mapping project"===a?"orthomappingproject":
"ortho mapping template"===a?"orthomappingtemplate":"solution"===a?"solutions":"geopackage"===a?"geopackage":"deep learning package"===a?"deeplearningpackage":"real time analytic"===a?"realtimeanalytics":"big data analytic"===a?"bigdataanalytics":"feed"===a?"feed":"excalibur imagery project"===a?"excaliburimageryproject":"notebook"===a?"notebook":"storymap"===a?"storymap":"survey123 add in"===a?"survey123addin":"mission"===a?"mission":"quickcapture project"===a?"quickcaptureproject":"pro report"===
a?"proreport":"urban model"===a?"urbanmodel":"web experience"===a?"experiencebuilder":"web experience template"===a?"webexperiencetemplate":"workflow"===a?"workflow":"kernel gateway connection"===a?"kernelgatewayconnection":"insights script"===a?"insightsscript":"hub initiative template"===a?"hubinitiativetemplate":"maps";return a?n.toUrl("../css/images/item_type_icons/"+a+"16.png"):null},_getIsPremiumContent:function(){var a=this.typeKeywords,b=!1;if(-1<c.indexOf(a,"Requires Subscription")||-1<c.indexOf(a,
"Requires Credits"))b=!0;return b},_getPremiumIconUrl:function(){var a=this.typeKeywords,b;this.isPremiumContent&&(b=-1<c.indexOf(a,"Requires Credits")?"premiumcredits":"premiumitem");return b?n.toUrl("../css/images/item_type_icons/"+b+"16.png"):null},getThumbnailUrl:function(a){var b=this.thumbnailUrl;b&&a&&(b+=(-1===b.indexOf("?")?"?":"\x26")+"w\x3d"+a);return b}}),B=r([],{declaredClass:"esri.arcgis.PortalListing",constructor:function(a){f.mixin(this,a);this.id=this.itemId;this.url=(this.portal&&
this.portal.portalUrl)+"content/"+(this.userItemUrl?"items/":"listings/")+this.itemId;this.commentsUrl=this.url+"/comments";this.created=this.created?new Date(this.created):null;this.banner=this.banner?g.formatUrl(this.url+"/info/"+this.banner):"";this.thumbnail=this.thumbnail?g.formatUrl(this.url+"/info/"+this.thumbnail):"";this.largeThumbnail=this.largeThumbnail?g.formatUrl(this.url+"/info/"+this.largeThumbnail):"";this.avgRating=this.avgRating||0;this.numRatings=this.numRatings||0;this.numComments=
this.numComments||0;this.listingProperties=this.listingProperties||{priceDesc:"",creditsPerTransaction:0,licenseType:"free",trialSupported:!1,trialDuration:0,listingAccess:"private"};for(var b in this.listingProperties)this[b]&&(this.listingProperties[b]=this[b]);this.properties=this.properties||{systemRequirements:"",termsAndConditions:"",version:"1.0"};this.screenshots=c.map(this.screenshots,f.hitch(this,function(a){return g.formatUrl(this.url+"/info/"+a)}));this.vendorName=this.vendor.name;this.vendor.thumbnail=
this.vendor.thumbnail?this.userItemUrl?g.formatUrl(this.portal.portalUrl+"/portals/self/resources/"+this.vendor.thumbnail):g.formatUrl(this.url+"/vendorinfo/"+this.vendor.thumbnail):""},getComments:function(){return g.requestToTypedArray(this.commentsUrl,null,null,d,{item:this})},getVendor:function(){return this.vendor}}),z=r([],{declaredClass:"esri.arcgis.PortalProvision",constructor:function(a){f.mixin(this,a);this.created=this.created?new Date(this.created):null;this.startDate=this.startDate?new Date(this.startDate):
null;this.endDate=this.endDate&&-1!==this.endDate?new Date(this.endDate):null;this.listing=a.listing?new B(f.mixin(a.listing,{portal:this.portal})):null}}),C=r([],{declaredClass:"esri.arcgis.PortalGroup",constructor:function(a){f.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"community/groups/"+this.id;this.thumbnailUrl=g.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getMembers:function(){return g.request(this.url+
"/users")},queryItems:function(a,b){a=g.formatQueryParams({},a,b);a.q="group:"+this.id+(a.q?" "+a.q:"");return this.portal.queryItems(a)},getThumbnailUrl:function(a){var b=this.thumbnailUrl;b&&a&&(b+=(-1===b.indexOf("?")?"?":"\x26")+"w\x3d"+a);return b}}),D=r([],{declaredClass:"esri.arcgis.PortalFolder",constructor:function(a){f.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username+"/"+this.id;this.created=this.created?new Date(this.created):null},getItems:function(){return g.requestToTypedArray(this.url,
null,null,v,{portal:this.portal,folderId:this.id})}}),y=r([],{declaredClass:"esri.arcgis.PortalUser",constructor:function(a){f.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"community/users/"+this.username;this.userContentUrl=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username;this.thumbnailUrl=this.thumbnail?g.formatUrl(this.url+"/info/"+this.thumbnail):null;this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},
getGroups:function(){return a(g.request(this.url).then(f.hitch(this,function(a){return g.resultsToTypedArray(C,{portal:this.portal},a.groups)})))},getNotifications:function(){return g.requestToTypedArray(this.url+"/notifications",null,null,null,{portal:this.portal})},getGroupInvitations:function(){return g.requestToTypedArray(this.url+"/invitations",null,null,null,{portal:this.portal})},getTags:function(){return g.requestToTypedArray(this.url+"/tags",null,null,null,{portal:this.portal})},getFolders:function(){return a(this.getContent(null,
{num:1}).then(function(a){return a.folders}))},getItems:function(b){return a(this.getContent(b).then(function(a){return a.items}))},getItem:function(a){return g.request(this.portal.portalUrl+"content/items/"+a).then(f.hitch(this,function(a){return new v(f.mixin(a,{portal:this.portal}))}))},getContent:function(a,b){var d=this.url.replace("/community/","/content/")+(a?"/"+a:"");return g.request(d,b).then(f.hitch(this,function(b){b.folders=g.resultsToTypedArray(D,{portal:this.portal},b.folders);b.items=
g.resultsToTypedArray(v,{portal:this.portal,folderId:a},b.items);return b}))},getThumbnailUrl:function(a){var b=this.thumbnailUrl;b&&a&&(b+=(-1===b.indexOf("?")?"?":"\x26")+"w\x3d"+a);return b}});r={Portal:r([b],{declaredClass:"esri.arcgis.Portal",onLoad:function(){},onError:function(){},constructor:function(a){a=f.isObject(a)?a:{url:a};this.registerConnectEvents();m={options:{disableIdentityLookup:!0},requestParams:{f:"json"}};a.self?(m.self=a.self,f.mixin(this,{url:a.url||e.getProtocolForWebResource()+
"//"+(a.self.urlKey?a.self.urlKey+"."+a.self.customBaseUrl:a.self.portalHostname)}),this.portalUrl=-1!==this.url.indexOf("/sharing")?this.url+"/":this.url+"/sharing/rest/",a=a.self.user?this.signIn():this.init(this.url)):(a.url&&f.mixin(this,{url:a.url}),a=this.init(this.url));a.then(f.hitch(this,function(){this.emit("ready",this);this.onLoad(this)}))},init:function(a,b){a=(a||this.portalUrl).replace(/\/+$/,"");this.portalUrl=-1!==a.indexOf("/sharing")?a+"/":a+"/sharing/rest/";return this._getSelf(this.portalUrl).then(f.hitch(this,
function(a){m.self=f.mixin({},a);(a=a.user)&&b&&(m.currentToken=b&&b.token,m.loggedInUser=new y(f.mixin(a,{portal:this,credential:b})));m.self.id&&!1===m.self.canSearchPublic&&(m.extraQuery=" AND orgid:"+m.self.id);f.mixin(this,m.self);this.thumbnailUrl=g.formatUrl(this.portalUrl+"portals/self/resources/"+this.thumbnail);this.isOrganization=this.access&&this.access.length?!0:!1;this.created=this.created?new Date(this.created):null;this.modified=this.modified?new Date(this.modified):null;return this}),
f.hitch(this,function(a){this.onError(a);throw a;}))},signIn:function(){var a=new p,b=f.hitch(this,function(){this._onSignIn().then(f.hitch(this,function(){a.resolve(m.loggedInUser)}),f.hitch(this,function(b){a.reject(b)}))});if(m&&m.self)m&&m.loggedInUser?setTimeout(function(){a.resolve(m.loggedInUser)},0):b();else this.on("load",f.hitch(this,function(){b()}));return a},signOut:function(){m.loggedInUser.credential&&m.loggedInUser.credential.destroy();m.loggedInUser=null;m.options.disableIdentityLookup=
!0;g.clearFieldsFromObject(m.self,this);m.self=null;return this.init(this.url)},getPortalUser:function(){return m.loggedInUser},addResource:function(a,b){return g.request(this.portalUrl+"portals/self/addResource",{key:a,text:b},{usePost:!0})},update:function(a){return g.request(this.portalUrl+"portals/self/update",a,{usePost:!0})},queryGroups:function(a,b){return this._queryPortal(this.portalUrl+"community/groups",g.formatQueryParams({},a,b),C)},queryItems:function(a,b){return this._queryPortal(this.portalUrl+
"search",g.formatQueryParams({},a,b),v)},queryListings:function(a){a=g.formatQueryParams({},a,!0);var b="";a.q&&-1<a.q.toLowerCase().indexOf("mylistings:true")?(a.q=a.q.toLowerCase().replace("mylistings:true",""),b="?mylistings\x3dtrue"):a.q||(a.q='""');return this._queryPortal(this.portalUrl+"content/listings"+b,a,B)},queryCustomerList:function(a,b){a=g.formatQueryParams({},a,!0);return this._queryPortal(this.portalUrl+"portals/self/customersList",a)},getProvisions:function(){return this.getCustomers().then(f.hitch(this,
function(a){return a.purchases}))},getInterests:function(){return this.getCustomers().then(f.hitch(this,function(a){return a.interests}))},getTrials:function(){return this.getCustomers().then(f.hitch(this,function(a){return a.trials}))},getCustomers:function(a){return g.request(this.portalUrl+"portals/self/customers",{status:a||"all"})},getMyPurchases:function(){return this.getPurchases().then(function(a){return a.purchases})},getMyInterests:function(){return this.getPurchases().then(function(a){return a.interests})},
getPurchases:function(){return g.request(this.portalUrl+"portals/self/purchases").then(f.hitch(this,function(a){a.interests=c.map(a.interests,function(a){return f.mixin(a.provision,{listing:a.listing})});a.purchases=c.map(a.purchases,function(a){return f.mixin(a.provision,{listing:a.listing})});a.trials=c.map(a.trials,function(a){return f.mixin(a.provision,{listing:a.listing})});a.interests=g.resultsToTypedArray(z,{portal:this},a.interests);a.trials=g.resultsToTypedArray(z,{portal:this},a.trials);
a.purchases=g.resultsToTypedArray(z,{portal:this},a.purchases);return a}))},queryUsers:function(a,b){return this._queryPortal(this.portalUrl+"community/users",g.formatQueryParams({sortField:"username"},a,b),y)},_onSignIn:function(){m.options.disableIdentityLookup=!1;m.self=null;return k.id.getCredential(this.portalUrl).then(f.hitch(this,"init",this.url)).then(function(){return m.loggedInUser},f.hitch(this,function(a){m.options.disableIdentityLookup=!0;this.onError(a);throw a;}))},_getSelf:function(a){var b;
a+="portals/self";m.self?(b=new p,setTimeout(function(){b.resolve(m.self)},0)):b=g.request(a,{culture:l.locale});return b},_queryPortal:function(b,d,c){var e=f.mixin({num:10,start:0,sortField:"title",sortOrder:"asc"},d),h=["start","query","num","nextStart"];b=g.request(b,e).then(f.hitch(this,function(a){a.results=g.resultsToTypedArray(c,{portal:this},a);a.queryParams=f.mixin({},e);a.nextQueryParams=f.mixin(e,{start:a.nextStart});return g.clearFieldsFromObject(h,a)}));b=f.delegate(b);b.queryParams=
f.mixin({},e);b.nextQueryParams=p.when(b,function(a){return a.nextQueryParams});return a(b)}}),PortalFolder:D,PortalGroup:C,PortalItem:v,PortalUser:y,PortalComment:d,PortalRating:u,PortalUtil:g,PortalResult:a,PortalListing:B};q("extend-esri")&&f.mixin(f.getObject("arcgis",!0,k),r);return r})},"jimu/dijit/ImageChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/text!./templates/ImageChooser.html dojo/sniff esri/lang ../utils ./_CropImage jimu/dijit/Popup jimu/dijit/Message jimu/dijit/LoadingShelter".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g){var d=0;r=f([l,p,r],{templateString:k,declaredClass:"jimu.dijit.ImageChooser",cropImage:!0,displayImg:null,stretchImg:!0,defaultSelfSrc:null,showSelfImg:!1,label:null,showTip:!0,goldenWidth:400,goldenHeight:400,maxSize:1024,format:null,customZIndex:null,imageData:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.imageChooser;this.nls.common=window.jimuNls.common;this.nls.readError=this.nls.readError||"Failed to read the file."},
postCreate:function(){this._initial();e.file.supportHTML5()||h("safari")||!e.file.isEnabledFlash()||e.file.loadFileAPI().then(c.hitch(this,function(){q.setStyle(this.mask,"zIndex",1)}))},setImageSize:function(a){this.goldenWidth=a.width;this.goldenHeight=a.height},disableChooseImage:function(){q.setStyle(this.fileForm,"display","none");this.label&&"string"===typeof this.label&&q.addClass(this.displayText,"disable-label");q.removeAttr(this.domNode,"title")},enableChooseImage:function(){q.setStyle(this.fileForm,
"display","block");this.label&&"string"===typeof this.label&&q.removeClass(this.displayText,"disable-label");this._addTip()},setDefaultSelfSrc:function(a){this.defaultSelfSrc=a;this.imageData=this.selfImg.src=a},getImageData:function(){return this.imageData},_initial:function(){this._initFileForm();this._processProperties();this._addTip()},_processProperties:function(){this.fileProperty={};this.label&&"string"===typeof this.label&&(this.displayText.innerHTML=e.sanitizeHTML(this.label),q.setStyle(this.hintText,
"display","block"));this.showSelfImg&&q.setStyle(this.hintImage,"display","block");!1===this.stretchImg?q.addClass(this.selfImg,"no-stretch-img"):q.removeClass(this.selfImg,"no-stretch-img");this.defaultSelfSrc&&(this.imageData=this.selfImg.src=this.defaultSelfSrc);if(this.format){var a="image/*";"string"===typeof this.format&&/^image\/./.test(this.format)?a=this.format:"[object Array]"===Object.prototype.toString.call(this.format)&&0<this.format.length&&(a=this.format.join(","));q.setAttr(this.fileInput,
"accept",a)}e.file.supportHTML5()||h("safari")||!e.file.isEnabledFlash()||q.setStyle(this.fileInput,{width:"100%",height:"100%",position:"absolute",left:0,top:0,opacity:0,zIndex:9})},_newMessage:function(b){this.msgPopupOpen=!0;this.msgPopup=new a({customZIndex:this.customZIndex,message:b})},_porcessMaskClick:function(){q.setAttr(this.fileInput,"id","imageChooser_"+d);q.setAttr(this.mask,"for","imageChooser_"+d);d++;n.once(this.mask,"click",c.hitch(this,function(a){a.stopPropagation();if(h("safari")&&
7>h("safari"))this._newMessage(this.nls.unsupportReaderAPI),a.preventDefault();else{if(!e.file.supportHTML5()){if(!e.file.isEnabledFlash()){var b=q.create("a",{href:"http://helpx.adobe.com/flash-player.html",innerHTML:this.nls.enableFlash,target:"_blank"});this._newMessage(b);a.preventDefault();return}if(!e.file.supportFileAPI()){this._newMessage(this.nls.unsupportReaderAPI);a.preventDefault();return}}q.setStyle(this.fileInput,"display","none");setTimeout(c.hitch(this,function(){q.setStyle(this.fileInput,
"display","block")}),200)}}))},_addTip:function(){if(this.showTip){var a=t.substitute({width:this.goldenWidth||40,height:this.goldenHeight||40},this.nls.toolTip);q.setAttr(this.domNode,"title",a)}else q.setAttr(this.domNode,"title","")},_onFileInputChange:function(a){var b=a.target.files&&a.target.files[0]||a.files&&a.files[0];if(this.format&&-1===this.format.indexOf(b.type))this._newMessage(this.nls.invalidType),this._initFileForm();else{var d=1024*this.maxSize;e.file.readFile(a,"image/*",d,c.hitch(this,
function(a,c,e){a?(c=this.nls[a.errCode],"exceed"===a.errCode&&(c=c.replace("1024",d/1024)),this._newMessage(c)):(this.fileProperty.fileName=c,this.cropImage&&"image/gif"!==b.type?this._cropImageByUser(e,b.type):this._readFileData(e));this._initFileForm()}))}},_initFileForm:function(){this.mask&&q.destroy(this.mask);this.fileInput&&q.destroy(this.fileInput);this.fileForm&&q.destroy(this.fileForm);this.fileForm=q.create("form",{"data-dojo-attach-point":"fileForm"},this.domNode);this.mask=q.create("label",
{"data-dojo-attach-point":"mask"},this.fileForm);this.fileInput=q.create("input",{type:"file","data-dojo-attach-point":"fileInput"},this.fileForm);this._porcessMaskClick();n.once(this.fileInput,"change",c.hitch(this,this._onFileInputChange))},_readFileData:function(a){this.onImageChange(a,this.fileProperty);this.displayImg&&q.setAttr(this.displayImg,"src",a);this.showSelfImg&&(this.selfImg?q.setAttr(this.selfImg,"src",a):this.selfImg.src=a,(a=q.getMarginBox(this.hintImage))&&a.w&&a.h&&(q.style(this.selfImg,
"maxWidth",a.w+"px"),q.style(this.selfImg,"maxHeight",a.h+"px")))},_cropImageByUser:function(a,d){var e=new b({imageSrc:a,type:d,nls:c.clone(this.nls),goldenWidth:this.goldenWidth,goldenHeight:this.goldenHeight}),f=new g({hidden:!0});this.cropPopupOpen=!0;this.cropPopup=new m({titleLabel:this.nls.cropImage,content:e,customZIndex:this.customZIndex,width:500,height:480,buttons:[{label:this.nls.common.ok,onClick:c.hitch(this,function(){f.show();var a=e.getData();a&&this._readFileData(a);this.cropPopup.close();
e.destroy();f.hide()})}]});f.placeAt(this.cropPopup.domNode);e.startup();q.addClass(this.cropPopup.domNode,"image-chooser-crop-popup")},onImageChange:function(a){this.imageData=a;this.emit("imageChange",this.imageData,this.fileProperty);this.emit("change",this.imageData,this.fileProperty)}});r.GIF="image/gif";r.JPEG="image/jpeg";r.PNG="image/png";return r})},"jimu/dijit/_CropImage":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/_CropImage.html jimu/dijit/Message libs/cropperjs/cropperjs xstyle/css!libs/cropperjs/cropper.css dojo/NodeList-dom".split(" "),
function(r,f,l,p,c,q,n,k,h){return r([c,q],{templateString:n,imageSrc:null,type:null,goldenWidth:4,goldenHeight:3,_haveShowReadErrMsg:!1,postCreate:function(){this.type||(this.type="image/jpeg");this.setImageSrc(this.imageSrc);this.loadingImg.src=require.toUrl("jimu")+"/images/loading.gif";this._checkImgError();this.own(p(this.baseImage,"load",l.hitch(this,function(){f.setStyle(this.loadingImg,"display","none");this._initCropper()})))},_initCropper:function(){this.cropper&&this.cropper.destroy&&this.cropper.destroy();
this.cropper=new h(this.baseImage,{aspectRatio:this.goldenWidth/this.goldenHeight,preview:".img-preview"})},setImageSrc:function(c){f.setAttr(this.baseImage,"src",c)},getData:function(){try{var c=this.cropper.getCroppedCanvas();this.cropper.getCroppedCanvas();return c.toDataURL(this.type||"image/jpeg")}catch(e){return this._readError(),null}},destroy:function(){this.cropper&&this.cropper.destroy&&this.cropper.destroy();this.inherited(arguments)},_checkImgError:function(){setTimeout(l.hitch(this,function(){"none"!==
f.getStyle(this.loadingImg,"display")&&this._readError()}),5E3)},_readError:function(){this._haveShowReadErrMsg||(new k({message:this.nls.readError}),this._haveShowReadErrMsg=!0)}})})},"libs/cropperjs/cropperjs":function(){!function(r,f){"object"==typeof exports&&"undefined"!=typeof module?module.exports=f():"function"==typeof define&&define.amd?define(f):(r=r||self).Cropper=f()}(this,function(){function r(a){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:
function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function f(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}function l(a){if(!(a=function(a){if(Array.isArray(a)){for(var b=0,d=Array(a.length);b<a.length;b++)d[b]=a[b];return d}}(a)||function(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}(a)))throw new TypeError("Invalid attempt to spread non-iterable instance");
return a}function p(a){return"number"==typeof a&&!S(a)}function c(a){return"object"===r(a)&&null!==a}function q(a){if(!c(a))return!1;try{var b=a.constructor,d=b.prototype;return b&&d&&ca.call(d,"isPrototypeOf")}catch(na){return!1}}function n(a){return"function"==typeof a}function k(a){return Array.from?Array.from(a):x.call(a)}function h(a,b){return a&&n(b)&&(Array.isArray(a)||p(a.length)?k(a).forEach(function(d,c){b.call(a,d,c,a)}):c(a)&&Object.keys(a).forEach(function(d){b.call(a,a[d],d,a)})),a}
function t(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1E11;return ha.test(a)?Math.round(a*b)/b:a}function e(a,b){var d=a.style;h(b,function(a,b){la.test(b)&&p(a)&&(a="".concat(a,"px"));d[b]=a})}function b(a,d){if(d)if(p(a.length))h(a,function(a){b(a,d)});else if(a.classList)a.classList.add(d);else{var c=a.className.trim();c?0>c.indexOf(d)&&(a.className="".concat(c," ").concat(d)):a.className=d}}function m(a,b){b&&(p(a.length)?h(a,function(a){m(a,b)}):a.classList?a.classList.remove(b):
0<=a.className.indexOf(b)&&(a.className=a.className.replace(b,"")))}function a(d,c,e){c&&(p(d.length)?h(d,function(b){a(b,c,e)}):e?b(d,c):m(d,c))}function g(a){return a.replace(ea,"$1-$2").toLowerCase()}function d(a,b){return c(a[b])?a[b]:a.dataset?a.dataset[b]:a.getAttribute("data-".concat(g(b)))}function u(a,b,d){c(d)?a[b]=d:a.dataset?a.dataset[b]=d:a.setAttribute("data-".concat(g(b)),d)}function v(a,b,d){var c=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},e=d;b.trim().split(ma).forEach(function(b){if(!fa){var f=
a.listeners;f&&f[b]&&f[b][d]&&(e=f[b][d],delete f[b][d],0===Object.keys(f[b]).length&&delete f[b],0===Object.keys(f).length&&delete a.listeners)}a.removeEventListener(b,e,c)})}function B(a,b,d){var c=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},e=d;b.trim().split(ma).forEach(function(b){if(c.once&&!fa){var f=a.listeners,g=void 0===f?{}:f;e=function(){delete g[b][d];a.removeEventListener(b,e,c);for(var f=arguments.length,h=Array(f),m=0;m<f;m++)h[m]=arguments[m];d.apply(a,h)};g[b]||(g[b]=
{});g[b][d]&&a.removeEventListener(b,g[b][d],c);g[b][d]=e;a.listeners=g}a.addEventListener(b,e,c)})}function z(a,b,d){var c;return n(Event)&&n(CustomEvent)?c=new CustomEvent(b,{detail:d,bubbles:!0,cancelable:!0}):(c=document.createEvent("CustomEvent")).initCustomEvent(b,!0,!0,d),a.dispatchEvent(c)}function C(a){a=a.getBoundingClientRect();return{left:a.left+(window.pageXOffset-document.documentElement.clientLeft),top:a.top+(window.pageYOffset-document.documentElement.clientTop)}}function D(a){a=a.match(ia);
return null!==a&&(a[1]!==da.protocol||a[2]!==da.hostname||a[3]!==da.port)}function y(a){var b="timestamp\x3d".concat((new Date).getTime());return a+(-1===a.indexOf("?")?"?":"\x26")+b}function w(a){var b=a.rotate,d=a.scaleX,c=a.scaleY,e=a.translateX;a=a.translateY;var f=[];p(e)&&0!==e&&f.push("translateX(".concat(e,"px)"));p(a)&&0!==a&&f.push("translateY(".concat(a,"px)"));p(b)&&0!==b&&f.push("rotate(".concat(b,"deg)"));p(d)&&1!==d&&f.push("scaleX(".concat(d,")"));p(c)&&1!==c&&f.push("scaleY(".concat(c,
")"));b=f.length?f.join(" "):"none";return{WebkitTransform:b,msTransform:b,transform:b}}function A(a,b){var d=a.pageX;a=a.pageY;var c={endX:d,endY:a};return b?c:U({startX:d,startY:a},c)}function G(a){var b=a.aspectRatio,d=a.height,c=a.width,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"contain",f=0<c&&c<1/0,g=0<d&&d<1/0;f&&g?(f=d*b,"contain"===e&&c<f||"cover"===e&&f<c?d=c/b:c=d*b):f?d=c/b:g&&(c=d*b);return{width:c,height:d}}function E(a){var b;a=new DataView(a);try{var d,c,e;if(255===
a.getUint8(0)&&216===a.getUint8(1))for(var f=a.byteLength,g=2;g+1<f;){if(255===a.getUint8(g)&&225===a.getUint8(g+1)){c=g;break}g+=1}if(c){var f=c+10,h=c+4;c=4;g="";for(c+=h;h<c;h+=1)g+=ka(a.getUint8(h));if("Exif"===g){var m=a.getUint16(f);if(((d=18761===m)||19789===m)&&42===a.getUint16(f+2,d)){var k=a.getUint32(f+4,d);8<=k&&(e=f+k)}}}if(e){var l,n,u=a.getUint16(e,d);for(n=0;n<u;n+=1)if(l=e+12*n+2,274===a.getUint16(l,d)){l+=8;b=a.getUint16(l,d);a.setUint16(l,1,d);break}}}catch(ra){b=1}return b}var F=
"undefined"!=typeof window,H=F?window:{},L=!!F&&"ontouchstart"in H.document.documentElement,N=!!F&&"PointerEvent"in H,M="".concat("cropper","-crop"),J="".concat("cropper","-disabled"),K="".concat("cropper","-hidden"),O="".concat("cropper","-hide"),Q="".concat("cropper","-invisible"),P="".concat("cropper","-modal"),R="".concat("cropper","-move"),I="".concat("cropper","Action"),V="".concat("cropper","Preview"),X=N?"pointerdown":L?"touchstart":"mousedown",T=N?"pointermove":L?"touchmove":"mousemove",
Y=N?"pointerup pointercancel":L?"touchend touchcancel":"mouseup",Z=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,ba=/^data:image\/jpeg;base64,/,W=/^img|canvas$/i,aa={viewMode:0,dragMode:"crop",initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,
cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},S=Number.isNaN||H.isNaN,ca=Object.prototype.hasOwnProperty,x=Array.prototype.slice,U=Object.assign||function(a){for(var b=arguments.length,d=Array(1<b?b-1:0),e=1;e<b;e++)d[e-1]=arguments[e];return c(a)&&0<d.length&&d.forEach(function(b){c(b)&&Object.keys(b).forEach(function(d){a[d]=
b[d]})}),a},ha=/\.\d*(?:0|9){12}\d*$/,la=/^width|height|left|top|marginLeft|marginTop$/,ea=/([a-z\d])([A-Z])/g,ma=/\s\s*/,fa=function(){var a=!1;if(F){var b=!1,d=function(){},c=Object.defineProperty({},"once",{get:function(){return a=!0,b},set:function(a){b=a}});H.addEventListener("test",d,c);H.removeEventListener("test",d,c)}return a}(),da=H.location,ia=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i,ka=String.fromCharCode,ja=/^data:.*,/,oa=H.Cropper,L=function(){function a(b){var d=1<arguments.length&&void 0!==
arguments[1]?arguments[1]:{};if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");if(!b||!W.test(b.tagName))throw Error("The first argument is required and must be an \x3cimg\x3e or \x3ccanvas\x3e element.");this.element=b;this.options=U({},aa,q(d)&&d);this.disabled=this.cropped=!1;this.pointers={};this.sizing=this.sized=this.replaced=this.reloading=this.ready=!1;this.init()}var d,c;return c=[{key:"noConflict",value:function(){return window.Cropper=oa,a}},{key:"setDefaults",
value:function(a){U(aa,q(a)&&a)}}],d=[{key:"init",value:function(){var a,b=this.element,d=b.tagName.toLowerCase();if(!b.cropper){if(b.cropper=this,"img"===d){if(this.isImg=!0,a=b.getAttribute("src")||"",!(this.originalUrl=a))return;a=b.src}else"canvas"===d&&window.HTMLCanvasElement&&(a=b.toDataURL());this.load(a)}}},{key:"load",value:function(a){var b=this;if(a){this.url=a;this.imageData={};var d=this.element,c=this.options;if(c.rotatable||c.scalable||(c.checkOrientation=!1),c.checkOrientation&&window.ArrayBuffer)if(ba.test(a))this.read((e=
a.replace(ja,""),f=atob(e),g=new ArrayBuffer(f.length),h(m=new Uint8Array(g),function(a,b){m[b]=f.charCodeAt(b)}),g));else{var e,f,g,m,k=new XMLHttpRequest;e=this.clone.bind(this);this.reloading=!0;(this.xhr=k).onabort=e;k.onerror=e;k.ontimeout=e;k.onprogress=function(){"image/jpeg"!==k.getResponseHeader("content-type")&&k.abort()};k.onload=function(){b.read(k.response)};k.onloadend=function(){b.reloading=!1;b.xhr=null};c.checkCrossOrigin&&D(a)&&d.crossOrigin&&(a=y(a));k.open("GET",a);k.responseType=
"arraybuffer";k.withCredentials="use-credentials"===d.crossOrigin;k.send()}else this.clone()}}},{key:"read",value:function(a){var b=this.options,d=this.imageData,c=E(a),e=0,f=1,g=1;1<c&&(this.url=function(a,b){var d=[];for(a=new Uint8Array(a);0<a.length;)d.push(ka.apply(null,k(a.subarray(0,8192)))),a=a.subarray(8192);return"data:".concat(b,";base64,").concat(btoa(d.join("")))}(a,"image/jpeg"),a=function(a){var b=0,d=1,c=1;switch(a){case 2:d=-1;break;case 3:b=-180;break;case 4:c=-1;break;case 5:b=
90;c=-1;break;case 6:b=90;break;case 7:b=90;d=-1;break;case 8:b=-90}return{rotate:b,scaleX:d,scaleY:c}}(c),e=a.rotate,f=a.scaleX,g=a.scaleY);b.rotatable&&(d.rotate=e);b.scalable&&(d.scaleX=f,d.scaleY=g);this.clone()}},{key:"clone",value:function(){var a,d,c=this.element,e=this.url;this.options.checkCrossOrigin&&D(e)&&(d=(a=c.crossOrigin)?e:(a="anonymous",y(e)));this.crossOrigin=a;this.crossOriginUrl=d;var f=document.createElement("img");a&&(f.crossOrigin=a);f.src=d||e;(this.image=f).onload=this.start.bind(this);
f.onerror=this.stop.bind(this);b(f,O);c.parentNode.insertBefore(f,c.nextSibling)}},{key:"start",value:function(){var a=this,b=this.isImg?this.element:this.image;b.onload=null;b.onerror=null;this.sizing=!0;var d=H.navigator&&/^(?:.(?!chrome|android))*safari/i.test(H.navigator.userAgent),c=function(b,d){U(a.imageData,{naturalWidth:b,naturalHeight:d,aspectRatio:b/d});a.sizing=!1;a.sized=!0;a.build()};if(!b.naturalWidth||d){var e=document.createElement("img"),f=document.body||document.documentElement;
(this.sizingImage=e).onload=function(){c(e.width,e.height);d||f.removeChild(e)};e.src=b.src;d||(e.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",f.appendChild(e))}else c(b.naturalWidth,b.naturalHeight)}},{key:"stop",value:function(){var a=this.image;a.onload=null;a.onerror=null;a.parentNode.removeChild(a);this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var a=
this.element,d=this.options,c=this.image,e=a.parentNode,f=document.createElement("div");f.innerHTML='\x3cdiv class\x3d"cropper-container" touch-action\x3d"none"\x3e\x3cdiv class\x3d"cropper-wrap-box"\x3e\x3cdiv class\x3d"cropper-canvas"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"cropper-drag-box"\x3e\x3c/div\x3e\x3cdiv class\x3d"cropper-crop-box"\x3e\x3cspan class\x3d"cropper-view-box"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-dashed dashed-h"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-dashed dashed-v"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-center"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-face"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-e" data-cropper-action\x3d"e"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-n" data-cropper-action\x3d"n"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-w" data-cropper-action\x3d"w"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-line line-s" data-cropper-action\x3d"s"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-e" data-cropper-action\x3d"e"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-n" data-cropper-action\x3d"n"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-w" data-cropper-action\x3d"w"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-s" data-cropper-action\x3d"s"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-ne" data-cropper-action\x3d"ne"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-nw" data-cropper-action\x3d"nw"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-sw" data-cropper-action\x3d"sw"\x3e\x3c/span\x3e\x3cspan class\x3d"cropper-point point-se" data-cropper-action\x3d"se"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e';
var f=f.querySelector(".".concat("cropper","-container")),g=f.querySelector(".".concat("cropper","-canvas")),h=f.querySelector(".".concat("cropper","-drag-box")),k=f.querySelector(".".concat("cropper","-crop-box")),l=k.querySelector(".".concat("cropper","-face"));this.container=e;this.cropper=f;this.canvas=g;this.dragBox=h;this.cropBox=k;this.viewBox=f.querySelector(".".concat("cropper","-view-box"));this.face=l;g.appendChild(c);b(a,K);e.insertBefore(f,a.nextSibling);this.isImg||m(c,O);this.initPreview();
this.bind();d.initialAspectRatio=Math.max(0,d.initialAspectRatio)||NaN;d.aspectRatio=Math.max(0,d.aspectRatio)||NaN;d.viewMode=Math.max(0,Math.min(3,Math.round(d.viewMode)))||0;b(k,K);d.guides||b(k.getElementsByClassName("".concat("cropper","-dashed")),K);d.center||b(k.getElementsByClassName("".concat("cropper","-center")),K);d.background&&b(f,"".concat("cropper","-bg"));d.highlight||b(l,Q);d.cropBoxMovable&&(b(l,R),u(l,I,"all"));d.cropBoxResizable||(b(k.getElementsByClassName("".concat("cropper",
"-line")),K),b(k.getElementsByClassName("".concat("cropper","-point")),K));this.render();this.ready=!0;this.setDragMode(d.dragMode);d.autoCrop&&this.crop();this.setData(d.data);n(d.ready)&&B(a,"ready",d.ready,{once:!0});z(a,"ready")}}},{key:"unbuild",value:function(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),m(this.element,K))}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?
(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],f(a.prototype,d),c&&f(a,c),a}();return U(L.prototype,{render:function(){this.initContainer();this.initCanvas();this.initCropBox();this.renderCanvas();this.cropped&&this.renderCropBox()},initContainer:function(){var a=this.element,d=this.options,c=this.container,f=this.cropper;b(f,K);m(a,K);d={width:Math.max(c.offsetWidth,Number(d.minContainerWidth)||200),height:Math.max(c.offsetHeight,
Number(d.minContainerHeight)||100)};e(f,{width:(this.containerData=d).width,height:d.height});b(a,K);m(f,K)},initCanvas:function(){var a=this.containerData,b=this.imageData,d=this.options.viewMode,c=90==Math.abs(b.rotate)%180,e=c?b.naturalHeight:b.naturalWidth,f=c?b.naturalWidth:b.naturalHeight,g=e/f,c=a.width,h=a.height;a.height*g>a.width?3===d?c=a.height*g:h=a.width/g:3===d?h=a.width/g:c=a.height*g;e={aspectRatio:g,naturalWidth:e,naturalHeight:f,width:c,height:h};e.left=(a.width-c)/2;e.top=(a.height-
h)/2;e.oldLeft=e.left;e.oldTop=e.top;this.canvasData=e;this.limited=1===d||2===d;this.limitCanvas(!0,!0);this.initialImageData=U({},b);this.initialCanvasData=U({},e)},limitCanvas:function(a,b){var d=this.options,c=this.containerData,e=this.canvasData,f=this.cropBoxData,g=d.viewMode,h=e.aspectRatio,m=this.cropped&&f;a&&(a=Number(d.minCanvasWidth)||0,d=Number(d.minCanvasHeight)||0,1<g?(a=Math.max(a,c.width),d=Math.max(d,c.height),3===g&&(a<d*h?a=d*h:d=a/h)):0<g&&(a?a=Math.max(a,m?f.width:0):d?d=Math.max(d,
m?f.height:0):m&&((a=f.width)<(d=f.height)*h?a=d*h:d=a/h)),h=G({aspectRatio:h,width:a,height:d}),a=h.width,d=h.height,e.minWidth=a,e.minHeight=d,e.maxWidth=1/0,e.maxHeight=1/0);b&&((m?0:1)<g?(b=c.width-e.width,h=c.height-e.height,e.minLeft=Math.min(0,b),e.minTop=Math.min(0,h),e.maxLeft=Math.max(0,b),e.maxTop=Math.max(0,h),m&&this.limited&&(e.minLeft=Math.min(f.left,f.left+(f.width-e.width)),e.minTop=Math.min(f.top,f.top+(f.height-e.height)),e.maxLeft=f.left,e.maxTop=f.top,2===g&&(e.width>=c.width&&
(e.minLeft=Math.min(0,b),e.maxLeft=Math.max(0,b)),e.height>=c.height&&(e.minTop=Math.min(0,h),e.maxTop=Math.max(0,h))))):(e.minLeft=-e.width,e.minTop=-e.height,e.maxLeft=c.width,e.maxTop=c.height))},renderCanvas:function(a,b){var d=this.canvasData,c=this.imageData;if(b){var f;b=c.naturalWidth*Math.abs(c.scaleX||1);f=c.naturalHeight*Math.abs(c.scaleY||1);c=c.rotate||0;if(90==(c=Math.abs(c)%180))f={width:f,height:b};else{var g=c%90*Math.PI/180,h=Math.sin(g),m=Math.cos(g),g=b*m+f*h;b=b*h+f*m;f=90<c?
{width:b,height:g}:{width:g,height:b}}b=f.width;f=f.height;c=b/d.naturalWidth*d.width;h=f/d.naturalHeight*d.height;d.left-=(c-d.width)/2;d.top-=(h-d.height)/2;d.width=c;d.height=h;d.aspectRatio=b/f;d.naturalWidth=b;d.naturalHeight=f;this.limitCanvas(!0,!1)}(d.width>d.maxWidth||d.width<d.minWidth)&&(d.left=d.oldLeft);(d.height>d.maxHeight||d.height<d.minHeight)&&(d.top=d.oldTop);d.width=Math.min(Math.max(d.width,d.minWidth),d.maxWidth);d.height=Math.min(Math.max(d.height,d.minHeight),d.maxHeight);
this.limitCanvas(!1,!0);d.left=Math.min(Math.max(d.left,d.minLeft),d.maxLeft);d.top=Math.min(Math.max(d.top,d.minTop),d.maxTop);d.oldLeft=d.left;d.oldTop=d.top;e(this.canvas,U({width:d.width,height:d.height},w({translateX:d.left,translateY:d.top})));this.renderImage(a);this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(a){var b=this.canvasData,d=this.imageData,c=b.width/b.naturalWidth*d.naturalWidth,f=b.height/b.naturalHeight*d.naturalHeight;U(d,{width:c,height:f,left:(b.width-
c)/2,top:(b.height-f)/2});e(this.image,U({width:d.width,height:d.height},w(U({translateX:d.left,translateY:d.top},d))));a&&this.output()},initCropBox:function(){var a=this.options,b=this.canvasData,d=a.aspectRatio||a.initialAspectRatio,a=Number(a.autoCropArea)||.8,c={width:b.width,height:b.height};d&&(b.height*d>b.width?c.height=c.width/d:c.width=c.height*d);this.cropBoxData=c;this.limitCropBox(!0,!0);c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth);c.height=Math.min(Math.max(c.height,c.minHeight),
c.maxHeight);c.width=Math.max(c.minWidth,c.width*a);c.height=Math.max(c.minHeight,c.height*a);c.left=b.left+(b.width-c.width)/2;c.top=b.top+(b.height-c.height)/2;c.oldLeft=c.left;c.oldTop=c.top;this.initialCropBoxData=U({},c)},limitCropBox:function(a,b){var d=this.options,c=this.containerData,e=this.canvasData,f=this.cropBoxData,g=this.limited,h=d.aspectRatio;if(a){a=Number(d.minCropBoxWidth)||0;var d=Number(d.minCropBoxHeight)||0,m=g?Math.min(c.width,e.width,e.width+e.left,c.width-e.left):c.width,
k=g?Math.min(c.height,e.height,e.height+e.top,c.height-e.top):c.height;a=Math.min(a,c.width);d=Math.min(d,c.height);h&&(a&&d?a<d*h?d=a/h:a=d*h:a?d=a/h:d&&(a=d*h),m<k*h?k=m/h:m=k*h);f.minWidth=Math.min(a,m);f.minHeight=Math.min(d,k);f.maxWidth=m;f.maxHeight=k}b&&(f.maxTop=g?(f.minLeft=Math.max(0,e.left),f.minTop=Math.max(0,e.top),f.maxLeft=Math.min(c.width,e.left+e.width)-f.width,Math.min(c.height,e.top+e.height)-f.height):(f.minLeft=0,f.minTop=0,f.maxLeft=c.width-f.width,c.height-f.height))},renderCropBox:function(){var a=
this.options,b=this.containerData,d=this.cropBoxData;(d.width>d.maxWidth||d.width<d.minWidth)&&(d.left=d.oldLeft);(d.height>d.maxHeight||d.height<d.minHeight)&&(d.top=d.oldTop);d.width=Math.min(Math.max(d.width,d.minWidth),d.maxWidth);d.height=Math.min(Math.max(d.height,d.minHeight),d.maxHeight);this.limitCropBox(!1,!0);d.left=Math.min(Math.max(d.left,d.minLeft),d.maxLeft);d.top=Math.min(Math.max(d.top,d.minTop),d.maxTop);d.oldLeft=d.left;d.oldTop=d.top;a.movable&&a.cropBoxMovable&&u(this.face,I,
d.width>=b.width&&d.height>=b.height?"move":"all");e(this.cropBox,U({width:d.width,height:d.height},w({translateX:d.left,translateY:d.top})));this.cropped&&this.limited&&this.limitCanvas(!0,!0);this.disabled||this.output()},output:function(){this.preview();z(this.element,"crop",this.getData())}},{initPreview:function(){var a=this.crossOrigin,b=this.options.preview,d=a?this.crossOriginUrl:this.url,c=document.createElement("img");if(a&&(c.crossOrigin=a),c.src=d,this.viewBox.appendChild(c),this.viewBoxImage=
c,b)c=b,"string"==typeof b?c=this.element.ownerDocument.querySelectorAll(b):b.querySelector&&(c=[b]),h(this.previews=c,function(b){var c=document.createElement("img");u(b,V,{width:b.offsetWidth,height:b.offsetHeight,html:b.innerHTML});a&&(c.crossOrigin=a);c.src=d;c.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"';b.innerHTML="";b.appendChild(c)})},resetPreview:function(){h(this.previews,
function(a){var b=d(a,V);e(a,{width:b.width,height:b.height});a.innerHTML=b.html;if(c(a[V]))try{delete a[V]}catch(ga){a[V]=void 0}else if(a.dataset)try{delete a.dataset[V]}catch(ga){a.dataset[V]=void 0}else a.removeAttribute("data-".concat(g(V)))})},preview:function(){var a=this.imageData,b=this.canvasData,c=this.cropBoxData,f=c.width,g=c.height,m=a.width,k=a.height,l=c.left-b.left-a.left,n=c.top-b.top-a.top;this.cropped&&!this.disabled&&(e(this.viewBoxImage,U({width:m,height:k},w(U({translateX:-l,
translateY:-n},a)))),h(this.previews,function(b){var c=d(b,V),h=c.width,c=c.height,u=h,t=c,p=1;f&&(t=g*(p=h/f));g&&c<t&&(u=f*(p=c/g),t=c);e(b,{width:u,height:t});e(b.getElementsByTagName("img")[0],U({width:m*p,height:k*p},w(U({translateX:-l*p,translateY:-n*p},a))))}))}},{bind:function(){var a=this.element,b=this.options,d=this.cropper;n(b.cropstart)&&B(a,"cropstart",b.cropstart);n(b.cropmove)&&B(a,"cropmove",b.cropmove);n(b.cropend)&&B(a,"cropend",b.cropend);n(b.crop)&&B(a,"crop",b.crop);n(b.zoom)&&
B(a,"zoom",b.zoom);B(d,X,this.onCropStart=this.cropStart.bind(this));b.zoomable&&b.zoomOnWheel&&B(d,"wheel",this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0});b.toggleDragModeOnDblclick&&B(d,"dblclick",this.onDblclick=this.dblclick.bind(this));B(a.ownerDocument,T,this.onCropMove=this.cropMove.bind(this));B(a.ownerDocument,Y,this.onCropEnd=this.cropEnd.bind(this));b.responsive&&B(window,"resize",this.onResize=this.resize.bind(this))},unbind:function(){var a=this.element,b=this.options,d=this.cropper;
n(b.cropstart)&&v(a,"cropstart",b.cropstart);n(b.cropmove)&&v(a,"cropmove",b.cropmove);n(b.cropend)&&v(a,"cropend",b.cropend);n(b.crop)&&v(a,"crop",b.crop);n(b.zoom)&&v(a,"zoom",b.zoom);v(d,X,this.onCropStart);b.zoomable&&b.zoomOnWheel&&v(d,"wheel",this.onWheel,{passive:!1,capture:!0});b.toggleDragModeOnDblclick&&v(d,"dblclick",this.onDblclick);v(a.ownerDocument,T,this.onCropMove);v(a.ownerDocument,Y,this.onCropEnd);b.responsive&&v(window,"resize",this.onResize)}},{resize:function(){var a=this.options,
b=this.container,d=this.containerData,c=Number(a.minContainerWidth)||200,e=Number(a.minContainerHeight)||100;if(!(this.disabled||d.width<=c||d.height<=e)){var f,g,m=b.offsetWidth/d.width;if(1!==m||b.offsetHeight!==d.height)a.restore&&(f=this.getCanvasData(),g=this.getCropBoxData()),this.render(),a.restore&&(this.setCanvasData(h(f,function(a,b){f[b]=a*m})),this.setCropBoxData(h(g,function(a,b){g[b]=a*m})))}},dblclick:function(){var a;this.disabled||"none"===this.options.dragMode||this.setDragMode((a=
this.dragBox,(a.classList?a.classList.contains(M):-1<a.className.indexOf(M))?"move":"crop"))},wheel:function(a){var b=this,d=Number(this.options.wheelZoomRatio)||.1,c=1;this.disabled||(a.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(function(){b.wheeling=!1},50),a.deltaY?c=0<a.deltaY?1:-1:a.wheelDelta?c=-a.wheelDelta/120:a.detail&&(c=0<a.detail?1:-1),this.zoom(-c*d,a)))},cropStart:function(a){var c=a.buttons,e=a.button;if(!(this.disabled||p(c)&&1!==c||p(e)&&0!==e||a.ctrlKey)){var c=
this.options,f=this.pointers;a.changedTouches?h(a.changedTouches,function(a){f[a.identifier]=A(a)}):f[a.pointerId||0]=A(a);c=1<Object.keys(f).length&&c.zoomable&&c.zoomOnTouch?"zoom":d(a.target,I);Z.test(c)&&!1!==z(this.element,"cropstart",{originalEvent:a,action:c})&&(a.preventDefault(),this.action=c,this.cropping=!1,"crop"===c&&(this.cropping=!0,b(this.dragBox,P)))}},cropMove:function(a){var b=this.action;if(!this.disabled&&b){var d=this.pointers;a.preventDefault();!1!==z(this.element,"cropmove",
{originalEvent:a,action:b})&&(a.changedTouches?h(a.changedTouches,function(a){U(d[a.identifier]||{},A(a,!0))}):U(d[a.pointerId||0]||{},A(a,!0)),this.change(a))}},cropEnd:function(b){if(!this.disabled){var d=this.action,c=this.pointers;b.changedTouches?h(b.changedTouches,function(a){delete c[a.identifier]}):delete c[b.pointerId||0];d&&(b.preventDefault(),Object.keys(c).length||(this.action=""),this.cropping&&(this.cropping=!1,a(this.dragBox,P,this.cropped&&this.options.modal)),z(this.element,"cropend",
{originalEvent:b,action:d}))}}},{change:function(a){var b=this.canvasData,d=this.containerData,c=this.cropBoxData,e=this.pointers,f=this.action,g=this.options.aspectRatio,k=c.left,l=c.top,n=c.width,u=c.height,t=k+n,p=l+u,q=0,v=0,r=d.width,B=d.height,z=!0;!g&&a.shiftKey&&(g=n&&u?n/u:1);this.limited&&(q=c.minLeft,v=c.minTop,r=q+Math.min(d.width,b.width,b.left+b.width),B=v+Math.min(d.height,b.height,b.top+b.height));var D,w,b=e[Object.keys(e)[0]],y=b.endX-b.startX,A=b.endY-b.startY,d=function(a){switch(a){case "e":t+
y>r&&(y=r-t);break;case "w":k+y<q&&(y=q-k);break;case "n":l+A<v&&(A=v-l);break;case "s":p+A>B&&(A=B-p)}};switch(f){case "all":k+=y;l+=A;break;case "e":if(0<=y&&(r<=t||g&&(l<=v||B<=p))){z=!1;break}d("e");0>(n+=y)&&(f="w",k-=n=-n);g&&(u=n/g,l+=(c.height-u)/2);break;case "n":if(0>=A&&(l<=v||g&&(k<=q||r<=t))){z=!1;break}d("n");u-=A;l+=A;0>u&&(f="s",l-=u=-u);g&&(n=u*g,k+=(c.width-n)/2);break;case "w":if(0>=y&&(k<=q||g&&(l<=v||B<=p))){z=!1;break}d("w");n-=y;k+=y;0>n&&(f="e",k-=n=-n);g&&(u=n/g,l+=(c.height-
u)/2);break;case "s":if(0<=A&&(B<=p||g&&(k<=q||r<=t))){z=!1;break}d("s");0>(u+=A)&&(f="n",l-=u=-u);g&&(n=u*g,k+=(c.width-n)/2);break;case "ne":if(g){if(0>=A&&(l<=v||r<=t)){z=!1;break}d("n");u-=A;l+=A;n=u*g}else d("n"),d("e"),0<=y?t<r?n+=y:0>=A&&l<=v&&(z=!1):n+=y,0>=A?v<l&&(u-=A,l+=A):(u-=A,l+=A);0>n&&0>u?(f="sw",l-=u=-u,k-=n=-n):0>n?(f="nw",k-=n=-n):0>u&&(f="se",l-=u=-u);break;case "nw":if(g){if(0>=A&&(l<=v||k<=q)){z=!1;break}d("n");u-=A;l+=A;n=u*g;k+=c.width-n}else d("n"),d("w"),0>=y?q<k?(n-=y,k+=
y):0>=A&&l<=v&&(z=!1):(n-=y,k+=y),0>=A?v<l&&(u-=A,l+=A):(u-=A,l+=A);0>n&&0>u?(f="se",l-=u=-u,k-=n=-n):0>n?(f="ne",k-=n=-n):0>u&&(f="sw",l-=u=-u);break;case "sw":if(g){if(0>=y&&(k<=q||B<=p)){z=!1;break}d("w");n-=y;k+=y;u=n/g}else d("s"),d("w"),0>=y?q<k?(n-=y,k+=y):0<=A&&B<=p&&(z=!1):(n-=y,k+=y),0<=A?p<B&&(u+=A):u+=A;0>n&&0>u?(f="ne",l-=u=-u,k-=n=-n):0>n?(f="se",k-=n=-n):0>u&&(f="nw",l-=u=-u);break;case "se":if(g){if(0<=y&&(r<=t||B<=p)){z=!1;break}d("e");u=(n+=y)/g}else d("s"),d("e"),0<=y?t<r?n+=y:
0<=A&&B<=p&&(z=!1):n+=y,0<=A?p<B&&(u+=A):u+=A;0>n&&0>u?(f="nw",l-=u=-u,k-=n=-n):0>n?(f="sw",k-=n=-n):0>u&&(f="ne",l-=u=-u);break;case "move":this.move(y,A);z=!1;break;case "zoom":this.zoom((D=U({},e),w=[],h(e,function(a,b){delete D[b];h(D,function(b){var d=Math.abs(a.startX-b.startX),c=Math.abs(a.startY-b.startY),e=Math.abs(a.endX-b.endX);b=Math.abs(a.endY-b.endY);d=Math.sqrt(d*d+c*c);w.push((Math.sqrt(e*e+b*b)-d)/d)})}),w.sort(function(a,b){return Math.abs(a)<Math.abs(b)}),w[0]),a);z=!1;break;case "crop":y&&
A?(a=C(this.cropper),k=b.startX-a.left,l=b.startY-a.top,n=c.minWidth,u=c.minHeight,0<y?f=0<A?"se":"ne":0>y&&(k-=n,f=0<A?"sw":"nw"),0>A&&(l-=u),this.cropped||(m(this.cropBox,K),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))):z=!1}z&&(c.width=n,c.height=u,c.left=k,c.top=l,this.action=f,this.renderCropBox());h(e,function(a){a.startX=a.endX;a.startY=a.endY})}},{crop:function(){return!this.ready||this.cropped||this.disabled||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&b(this.dragBox,
P),m(this.cropBox,K),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=U({},this.initialImageData),this.canvasData=U({},this.initialCanvasData),this.cropBoxData=U({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(U(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),
m(this.dragBox,P),b(this.cropBox,K)),this},replace:function(a){var b=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return!this.disabled&&a&&(this.isImg&&(this.element.src=a),b?(this.url=a,this.image.src=a,this.ready&&(this.viewBoxImage.src=a,h(this.previews,function(b){b.getElementsByTagName("img")[0].src=a}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(a))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,m(this.cropper,J)),
this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,b(this.cropper,J)),this},destroy:function(){var a=this.element;return a.cropper&&(a.cropper=void 0,this.isImg&&this.replaced&&(a.src=this.originalUrl),this.uncreate()),this},move:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a,d=this.canvasData,c=d.left,d=d.top;return this.moveTo(void 0===a?a:c+Number(a),void 0===b?b:d+Number(b))},moveTo:function(a){var b=1<arguments.length&&void 0!==arguments[1]?
arguments[1]:a,d=this.canvasData,c=!1;return a=Number(a),b=Number(b),this.ready&&!this.disabled&&this.options.movable&&(p(a)&&(d.left=a,c=!0),p(b)&&(d.top=b,c=!0),c&&this.renderCanvas(!0)),this},zoom:function(a,b){var d=this.canvasData;return a=0>(a=Number(a))?1/(1-a):1+a,this.zoomTo(d.width*a/d.naturalWidth,null,b)},zoomTo:function(a,b,d){var c,e,f,g=this.options,m=this.canvasData,k=m.width,l=m.height,n=m.naturalWidth,u=m.naturalHeight;if(0<=(a=Number(a))&&this.ready&&!this.disabled&&g.zoomable){g=
n*a;u*=a;if(!1===z(this.element,"zoom",{ratio:a,oldRatio:k/n,originalEvent:d}))return this;d?(b=this.pointers,a=C(this.cropper),d=b&&Object.keys(b).length?(f=e=c=0,h(b,function(a){var b=a.startY;c+=a.startX;e+=b;f+=1}),{pageX:c/=f,pageY:e/=f}):{pageX:d.pageX,pageY:d.pageY},m.left-=(d.pageX-a.left-m.left)/k*(g-k),m.top-=(d.pageY-a.top-m.top)/l*(u-l)):q(b)&&p(b.x)&&p(b.y)?(m.left-=(b.x-m.left)/k*(g-k),m.top-=(b.y-m.top)/l*(u-l)):(m.left-=(g-k)/2,m.top-=(u-l)/2);m.width=g;m.height=u;this.renderCanvas(!0)}return this},
rotate:function(a){return this.rotateTo((this.imageData.rotate||0)+Number(a))},rotateTo:function(a){return p(a=Number(a))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=a%360,this.renderCanvas(!0,!0)),this},scaleX:function(a){var b=this.imageData.scaleY;return this.scale(a,p(b)?b:1)},scaleY:function(a){var b=this.imageData.scaleX;return this.scale(p(b)?b:1,a)},scale:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a,d=this.imageData,c=!1;return a=
Number(a),b=Number(b),this.ready&&!this.disabled&&this.options.scalable&&(p(a)&&(d.scaleX=a,c=!0),p(b)&&(d.scaleY=b,c=!0),c&&this.renderCanvas(!0,!0)),this},getData:function(){var a,b=0<arguments.length&&void 0!==arguments[0]&&arguments[0],d=this.options,c=this.imageData,e=this.canvasData,f=this.cropBoxData;if(this.ready&&this.cropped){a={x:f.left-e.left,y:f.top-e.top,width:f.width,height:f.height};var g=c.width/c.naturalWidth;if(h(a,function(b,d){a[d]=b/g}),b)b=Math.round(a.y+a.height),e=Math.round(a.x+
a.width),a.x=Math.round(a.x),a.y=Math.round(a.y),a.width=e-a.x,a.height=b-a.y}else a={x:0,y:0,width:0,height:0};return d.rotatable&&(a.rotate=c.rotate||0),d.scalable&&(a.scaleX=c.scaleX||1,a.scaleY=c.scaleY||1),a},setData:function(a){var b=this.options,d=this.imageData,c=this.canvasData,e={};if(this.ready&&!this.disabled&&q(a)){var f=!1;b.rotatable&&p(a.rotate)&&a.rotate!==d.rotate&&(d.rotate=a.rotate,f=!0);b.scalable&&(p(a.scaleX)&&a.scaleX!==d.scaleX&&(d.scaleX=a.scaleX,f=!0),p(a.scaleY)&&a.scaleY!==
d.scaleY&&(d.scaleY=a.scaleY,f=!0));f&&this.renderCanvas(!0,!0);b=d.width/d.naturalWidth;p(a.x)&&(e.left=a.x*b+c.left);p(a.y)&&(e.top=a.y*b+c.top);p(a.width)&&(e.width=a.width*b);p(a.height)&&(e.height=a.height*b);this.setCropBoxData(e)}return this},getContainerData:function(){return this.ready?U({},this.containerData):{}},getImageData:function(){return this.sized?U({},this.imageData):{}},getCanvasData:function(){var a=this.canvasData,b={};return this.ready&&h("left top width height naturalWidth naturalHeight".split(" "),
function(d){b[d]=a[d]}),b},setCanvasData:function(a){var b=this.canvasData,d=b.aspectRatio;return this.ready&&!this.disabled&&q(a)&&(p(a.left)&&(b.left=a.left),p(a.top)&&(b.top=a.top),p(a.width)?(b.width=a.width,b.height=a.width/d):p(a.height)&&(b.height=a.height,b.width=a.height*d),this.renderCanvas(!0)),this},getCropBoxData:function(){var a,b=this.cropBoxData;return this.ready&&this.cropped&&(a={left:b.left,top:b.top,width:b.width,height:b.height}),a||{}},setCropBoxData:function(a){var b,d,c=this.cropBoxData,
e=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&q(a)&&(p(a.left)&&(c.left=a.left),p(a.top)&&(c.top=a.top),p(a.width)&&a.width!==c.width&&(b=!0,c.width=a.width),p(a.height)&&a.height!==c.height&&(d=!0,c.height=a.height),e&&(b?c.height=c.width/e:d&&(c.width=c.height*e)),this.renderCropBox()),this},getCroppedCanvas:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var b,d,c,e,f,g,h,m,k,n,u,p,q,
v,r,B,z,D,C,y,w,A,E,F,H,x,L,N,M,Q,P,O,I,K,J,R,V,T,X,S=this.canvasData,Z=(b=this.image,d=this.imageData,c=d.aspectRatio,e=d.naturalWidth,f=d.naturalHeight,g=d.rotate,h=void 0===g?0:g,m=d.scaleX,k=void 0===m?1:m,n=d.scaleY,u=void 0===n?1:n,p=S.aspectRatio,q=S.naturalWidth,v=S.naturalHeight,r=a.fillColor,B=void 0===r?"transparent":r,z=a.imageSmoothingEnabled,D=void 0===z||z,C=a.imageSmoothingQuality,y=void 0===C?"low":C,w=a.maxWidth,A=void 0===w?1/0:w,E=a.maxHeight,F=void 0===E?1/0:E,H=a.minWidth,x=
void 0===H?0:H,L=a.minHeight,N=void 0===L?0:L,M=document.createElement("canvas"),Q=M.getContext("2d"),P=G({aspectRatio:p,width:A,height:F}),O=G({aspectRatio:p,width:x,height:N},"cover"),I=Math.min(P.width,Math.max(O.width,q)),K=Math.min(P.height,Math.max(O.height,v)),J=G({aspectRatio:c,width:A,height:F}),R=G({aspectRatio:c,width:x,height:N},"cover"),V=Math.min(J.width,Math.max(R.width,e)),T=Math.min(J.height,Math.max(R.height,f)),X=[-V/2,-T/2,V,T],M.width=t(I),M.height=t(K),Q.fillStyle=B,Q.fillRect(0,
0,I,K),Q.save(),Q.translate(I/2,K/2),Q.rotate(h*Math.PI/180),Q.scale(k,u),Q.imageSmoothingEnabled=D,Q.imageSmoothingQuality=y,Q.drawImage.apply(Q,[b].concat(l(X.map(function(a){return Math.floor(t(a))})))),Q.restore(),M);if(!this.cropped)return Z;c=this.getData();e=c.x;d=c.y;b=c.width;c=c.height;S=Z.width/Math.floor(S.naturalWidth);1!==S&&(e*=S,d*=S,b*=S,c*=S);h=b/c;f=G({aspectRatio:h,width:a.maxWidth||1/0,height:a.maxHeight||1/0});g=G({aspectRatio:h,width:a.minWidth||0,height:a.minHeight||0},"cover");
h=G({aspectRatio:h,width:a.width||(1!==S?Z.width:b),height:a.height||(1!==S?Z.height:c)});S=h.width;h=h.height;S=Math.min(f.width,Math.max(g.width,S));h=Math.min(f.height,Math.max(g.height,h));f=document.createElement("canvas");g=f.getContext("2d");f.width=t(S);f.height=t(h);g.fillStyle=a.fillColor||"transparent";g.fillRect(0,0,S,h);h=a.imageSmoothingEnabled;a=a.imageSmoothingQuality;g.imageSmoothingEnabled=void 0===h||h;a&&(g.imageSmoothingQuality=a);var Y,U,W,aa,ca,ba,a=Z.width;h=Z.height;e<=-b||
a<e?ca=W=Y=e=0:0>=e?(W=-e,e=0,ca=Y=Math.min(a,b+e)):e<=a&&(W=0,ca=Y=Math.min(b,a-e));0>=Y||d<=-c||h<d?ba=aa=U=d=0:0>=d?(aa=-d,d=0,ba=U=Math.min(h,c+d)):d<=h&&(aa=0,ba=U=Math.min(c,h-d));Y=[e,d,Y,U];0<ca&&0<ba&&(U=S/b,Y.push(W*U,aa*U,ca*U,ba*U));return g.drawImage.apply(g,[Z].concat(l(Y.map(function(a){return Math.floor(t(a))})))),f},setAspectRatio:function(a){var b=this.options;return this.disabled||void 0===a||(b.aspectRatio=Math.max(0,a)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),
this},setDragMode:function(b){var d=this.options,c=this.dragBox,e=this.face;if(this.ready&&!this.disabled){var f="crop"===b,g=d.movable&&"move"===b;b=f||g?b:"none";d.dragMode=b;u(c,I,b);a(c,M,f);a(c,R,g);d.cropBoxMovable||(u(e,I,b),a(e,M,f),a(e,R,g))}return this}}),L})},"xstyle/css":function(){define(["require"],function(r){function f(f,p,c){var l=document.documentElement;f=l.insertBefore(document.createElement(f),l.firstChild);f.id=p;p=(f.currentStyle||getComputedStyle(f,null)||{})[c];l.removeChild(f);
return p}return{load:function(l,p,c,q){function n(e){var b=f("x-parse",null,"content"),h=e&&(e.sheet||e.styleSheet);b&&"none"!=b&&"normal"!=b?p([eval(b)],function(a){e?a.process(e,c):(a.processAll(),c(h))}):c(h)}var k=p.toUrl(l),h;k.match(/!$/)&&(h={wait:!1},k=k.slice(0,-1));var t=p.cache&&p.cache["url:"+k];if(null!=t)t.xCss&&(t=t.cssText),"string"==typeof t?r(["./core/load-css"],function(c){n(c.insertCss(t))}):n();else{if("none"==f("div",l.replace(/\//g,"-").replace(/\..*/,"")+"-loaded","display"))return n();
r(["./core/load-css"],function(c){c(k,n,h)})}}}})},"jimu/dijit/ColorPicker":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/keys dojo/_base/Color dijit/TooltipDialog dijit/popup jimu/dijit/ColorSelector jimu/utils".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b){return r([f,l],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:'\x3cdiv role\x3d"button" tabindex\x3d"0"data-dojo-attach-event\x3d"onclick:_domNodeClick,onkeydown:_domNodeKeydown" aria-pressed\x3d"false"\x3e\x3c/div\x3e',
_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?this.color instanceof k||(this.color=new k(this.color)):this.color=new k("#ccc");c.setStyle(this.domNode,"backgroundColor",this.color.toHex());this.showLabel&&this._changeLabel(this.color);this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},destroy:function(){t.close(this.tooltipDialog);
this.picker.destroy();this.tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(b){var a=this.tooltipDialog.domNode;return b===a||c.isDescendant(b,a)},hideTooltipDialog:function(){this._hideTooltipDialog()},_showTooltipDialog:function(){t.open({parent:this.getParent(),popup:this.tooltipDialog,around:this.domNode});this._isTooltipDialogOpened=!0;this.picker.cursorNode.focus()},_hideTooltipDialog:function(){this._isTooltipDialogOpened=!1;this.onClose();t.close(this.tooltipDialog)},
_createTooltipDialog:function(){var b=c.create("div");this.tooltipDialog=new h({content:b});c.addClass(this.tooltipDialog.domNode,"jimu-color-picker-dialog");this.own(q(this.tooltipDialog.domNode,"keydown",p.hitch(this,function(a){a.keyCode===n.ESCAPE&&(this._hideTooltipDialog(),this.domNode.focus(),c.setAttr(this.domNode,"aria-pressed","false"))})));var a=new e({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:p.hitch(this,function(a){this.ensureMode||
(a=new k(a),this.setColor(a))})});a.placeAt(b);a.startup();if(this.ensureMode){var f=c.create("div",{"class":"jimu-btn jimu-btn-vacation jimu-float-trailing",title:this.nls.cancel,innerHTML:this.nls.cancel},b);this.own(q(f,"click",p.hitch(this,function(){this._hideTooltipDialog()})));"undefined"===typeof this.showOk&&(f=c.create("div",{"class":"jimu-btn jimu-float-trailing ok",title:this.nls.ok,innerHTML:this.nls.ok},b),this.own(q(f,"click",p.hitch(this,function(){var a=this.picker.get("value");this.setColor(new k(a));
this._hideTooltipDialog()}))));b=c.create("div",{"class":"jimu-btn jimu-float-trailing",title:this.nls.apply,innerHTML:this.nls.apply},b);this.own(q(b,"click",p.hitch(this,function(){var a=this.picker.get("value");this.setColor(new k(a))})))}this.own(q(document.body,"click",p.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})));this.picker=a},_domNodeClick:function(b){b.stopPropagation();b.preventDefault();this._isTooltipDialogOpened?(this._hideTooltipDialog(),
c.setAttr(this.domNode,"aria-pressed","false")):(this._showTooltipDialog(),c.setAttr(this.domNode,"aria-pressed","true"))},_domNodeKeydown:function(b){b.keyCode!==n.ENTER&&b.keyCode!==n.SPACE||this._domNodeClick(b)},setColor:function(b,a){if(b instanceof k){var e=this.color,d="";e&&(d=e.toHex());e=b.toHex();this.color=b;c.setStyle(this.domNode,"backgroundColor",e);if(d!==e&&(this.picker.set("value",e),!1!==a))this.onChange(new k(e))}},getColor:function(){return this.color},_changeLabel:function(e){c.empty(this.domNode);
c.create("span",{innerHTML:e.toHex(),className:"color-label",style:{color:b.invertColor(e.toHex())}},this.domNode)},onChange:function(b){this.showLabel&&this._changeLabel(b)},onClose:function(){},getPopup:function(){return this.tooltipDialog||null},setLabel:function(b){c.empty(this.domNode);c.create("span",{innerHTML:b||"",className:"text-label"},this.domNode)},isTooltipDialogOpened:function(){return this._isTooltipDialogOpened}})})},"jimu/dijit/ColorSelector":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dojox/widget/ColorPicker dijit/_base/focus dojo/fx dojo/_base/lang dojo/_base/html dojo/sniff".split(" "),
function(r,f,l,p,c,q,n,k,h){return f([l,p,r],{baseClass:"jimu-color-selector",declaredClass:"jimu.dijit.ColorSelector",_setPoint:function(f){f&&c.focus(f.target);if(!this._CURSOR_WIDTH||!this._CURSOR_HEIGHT){var e=k.getMarginBox(this.cursorNode);e.w&&e.h&&(this._CURSOR_WIDTH=e.w/2,this._CURSOR_HEIGHT=e.h/2)}this._BORDER_WIDTH&&this._BORDER_HEIGHT||(e=k.getBorderExtents(f.target||f.srcElement),e.w&&e.h&&(this._BORDER_WIDTH=e.w,this._BORDER_HEIGHT=e.h));var b=e=0;h("ff")||h("ie")||h("MSIE")?(e=f.offsetX,
b=f.offsetY):f.offsetX&&f.offsetY&&(e=f.offsetX+this._BORDER_WIDTH,b=f.offsetY+this._BORDER_HEIGHT);f=b-this._CURSOR_HEIGHT;e-=this._CURSOR_WIDTH;this.animatePoint?q.slideTo({node:this.cursorNode,duration:this.slideDuration,top:f,left:e,onEnd:n.hitch(this,function(){this._updateColor(!0);c.focus(this.cursorNode)})}).play():(k.style(this.cursorNode,{left:e+"px",top:f+"px"}),this._updateColor(!0))},_setHuePoint:function(f){f=f.offsetY-this.PICKER_HUE_SELECTOR_H/2;this.animatePoint?q.slideTo({node:this.hueCursorNode,
duration:this.slideDuration,top:f,left:0,onEnd:n.hitch(this,function(){this._updateColor(!0);c.focus(this.hueCursorNode)})}).play():(k.style(this.hueCursorNode,"top",f+"px"),this._updateColor(!0))}})})},"dojox/widget/ColorPicker":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/connect dojo/_base/sniff dojo/_base/window dojo/_base/event dojo/dom dojo/dom-class dojo/keys dojo/fx dojo/dnd/move dijit/registry dijit/_base/focus dijit/form/_FormWidget dijit/typematic dojox/color dojo/i18n dojo/i18n!./nls/ColorPicker dojo/i18n!dojo/cldr/nls/number dojo/text!./ColorPicker/ColorPicker.html".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C,D,y){r.experimental("dojox.widget.ColorPicker");return f("dojox.widget.ColorPicker",u,{showRgb:!0,showHsv:!0,showHex:!0,webSafe:!0,animatePoint:!0,slideDuration:250,liveUpdate:!1,PICKER_HUE_H:150,PICKER_SAT_VAL_H:150,PICKER_SAT_VAL_W:150,PICKER_HUE_SELECTOR_H:8,PICKER_SAT_SELECTOR_H:10,PICKER_SAT_SELECTOR_W:10,value:"#ffffff",_underlay:require.toUrl("dojox/widget/ColorPicker/images/underlay.png"),_hueUnderlay:require.toUrl("dojox/widget/ColorPicker/images/hue.png"),
_pickerPointer:require.toUrl("dojox/widget/ColorPicker/images/pickerPointer.png"),_huePickerPointer:require.toUrl("dojox/widget/ColorPicker/images/hueHandle.png"),_huePickerPointerAlly:require.toUrl("dojox/widget/ColorPicker/images/hueHandleA11y.png"),templateString:y,postMixInProperties:function(){e.contains(k.body(),"dijit_a11y")&&(this._huePickerPointer=this._huePickerPointerAlly);this._uId=g.getUniqueId(this.id);l.mixin(this,z.getLocalization("dojox.widget","ColorPicker"));l.mixin(this,z.getLocalization("dojo.cldr",
"number"));this.inherited(arguments)},postCreate:function(){this.inherited(arguments);7>n("ie")&&(this.colorUnderlay.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+this._underlay+"', sizingMethod\x3d'scale')",this.colorUnderlay.src=this._blankGif.toString());this.showRgb||(this.rgbNode.style.visibility="hidden");this.showHsv||(this.hsvNode.style.visibility="hidden");this.showHex||(this.hexNode.style.visibility="hidden");this.webSafe||(this.safePreviewNode.style.visibility=
"hidden")},startup:function(){this._started||(this._started=!0,this.set("value",this.value),this._mover=new a.boxConstrainedMoveable(this.cursorNode,{box:{t:-(this.PICKER_SAT_SELECTOR_H/2),l:-(this.PICKER_SAT_SELECTOR_W/2),w:this.PICKER_SAT_VAL_W,h:this.PICKER_SAT_VAL_H}}),this._hueMover=new a.boxConstrainedMoveable(this.hueCursorNode,{box:{t:-(this.PICKER_HUE_SELECTOR_H/2),l:0,w:0,h:this.PICKER_HUE_H}}),this._subs=[],this._subs.push(q.subscribe("/dnd/move/stop",l.hitch(this,"_clearTimer"))),this._subs.push(q.subscribe("/dnd/move/start",
l.hitch(this,"_setTimer"))),this._keyListeners=[],this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:b.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,l.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.hueCursorNode,{charOrCode:b.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,l.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:b.UP_ARROW,shiftKey:!1,metaKey:!1,
ctrlKey:!1,altKey:!1},this,l.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:b.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,l.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:b.LEFT_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,l.hitch(this,this._updateCursorNode),25,25)),this._connects.push(v.addKeyListener(this.cursorNode,{charOrCode:b.RIGHT_ARROW,shiftKey:!1,
metaKey:!1,ctrlKey:!1,altKey:!1},this,l.hitch(this,this._updateCursorNode),25,25)))},_setValueAttr:function(a,b){this._started&&this.setColor(a,b)},setColor:function(a,b){a=B.fromString(a);this._updatePickerLocations(a);this._updateColorInputs(a);this._updateValue(a,b)},_setTimer:function(a){if(a.node==this.cursorNode||a.node==this.hueCursorNode)d.focus(a.node),t.setSelectable(this.domNode,!1),this._timer=setInterval(l.hitch(this,"_updateColor"),45)},_clearTimer:function(a){this._timer&&(clearInterval(this._timer),
this._timer=null,this.onChange(this.value),t.setSelectable(this.domNode,!0))},_setHue:function(a){c.style(this.colorUnderlay,"backgroundColor",B.fromHsv(a,100,100).toHex())},_updateHueCursorNode:function(a,d,e){if(-1!==a){a=c.style(this.hueCursorNode,"top");d=this.PICKER_HUE_SELECTOR_H/2;a+=d;var f=!1;e.charOrCode==b.UP_ARROW?0<a&&(--a,f=!0):e.charOrCode==b.DOWN_ARROW&&a<this.PICKER_HUE_H&&(a+=1,f=!0);f&&c.style(this.hueCursorNode,"top",a-d+"px")}else this._updateColor(!0)},_updateCursorNode:function(a,
d,e){d=this.PICKER_SAT_SELECTOR_H/2;var f=this.PICKER_SAT_SELECTOR_W/2;if(-1!==a){a=c.style(this.cursorNode,"top");var g=c.style(this.cursorNode,"left");a+=d;var g=g+f,h=!1;e.charOrCode==b.UP_ARROW?0<a&&(--a,h=!0):e.charOrCode==b.DOWN_ARROW?a<this.PICKER_SAT_VAL_H&&(a+=1,h=!0):e.charOrCode==b.LEFT_ARROW?0<g&&(--g,h=!0):e.charOrCode==b.RIGHT_ARROW&&g<this.PICKER_SAT_VAL_W&&(g+=1,h=!0);h&&(g-=f,c.style(this.cursorNode,"top",a-d+"px"),c.style(this.cursorNode,"left",g+"px"))}else this._updateColor(!0)},
_updateColor:function(a){var b=this.PICKER_HUE_SELECTOR_H/2,d=this.PICKER_SAT_SELECTOR_H/2,e=this.PICKER_SAT_SELECTOR_W/2,b=c.style(this.hueCursorNode,"top")+b,d=c.style(this.cursorNode,"top")+d,e=c.style(this.cursorNode,"left")+e,b=Math.round(360-b/this.PICKER_HUE_H*360),e=B.fromHsv(b,e/this.PICKER_SAT_VAL_W*100,100-d/this.PICKER_SAT_VAL_H*100);this._updateColorInputs(e);this._updateValue(e,a);b!=this._hue&&this._setHue(b)},_colorInputChange:function(a){var b,d=!1;switch(a.target){case this.hexCode:b=
B.fromString(a.target.value);d=!0;break;case this.Rval:case this.Gval:case this.Bval:b=B.fromArray([this.Rval.value,this.Gval.value,this.Bval.value]);d=!0;break;case this.Hval:case this.Sval:case this.Vval:b=B.fromHsv(this.Hval.value,this.Sval.value,this.Vval.value),d=!0}d&&(this._updatePickerLocations(b),this._updateColorInputs(b),this._updateValue(b,!0))},_updateValue:function(a,b){a=a.toHex();this.value=this.valueNode.value=a;if(b&&(!this._timer||this.liveUpdate))this.onChange(a)},_updatePickerLocations:function(a){var b=
this.PICKER_HUE_SELECTOR_H/2,d=this.PICKER_SAT_SELECTOR_H/2,e=this.PICKER_SAT_SELECTOR_W/2;a=a.toHsv();b=Math.round(this.PICKER_HUE_H-a.h/360*this.PICKER_HUE_H)-b;e=Math.round(a.s/100*this.PICKER_SAT_VAL_W)-e;d=Math.round(this.PICKER_SAT_VAL_H-a.v/100*this.PICKER_SAT_VAL_H)-d;this.animatePoint?(m.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:b,left:0}).play(),m.slideTo({node:this.cursorNode,duration:this.slideDuration,top:d,left:e}).play()):(c.style(this.hueCursorNode,"top",b+"px"),
c.style(this.cursorNode,{left:e+"px",top:d+"px"}));a.h!=this._hue&&this._setHue(a.h)},_updateColorInputs:function(a){var b=a.toHex();this.showRgb&&(this.Rval.value=a.r,this.Gval.value=a.g,this.Bval.value=a.b);this.showHsv&&(a=a.toHsv(),this.Hval.value=Math.round(a.h),this.Sval.value=Math.round(a.s),this.Vval.value=Math.round(a.v));this.showHex&&(this.hexCode.value=b);this.previewNode.style.backgroundColor=b;this.webSafe&&(this.safePreviewNode.style.backgroundColor=b)},_setHuePoint:function(a){var b=
this.PICKER_HUE_SELECTOR_H/2;a=a.layerY||a.y-a.target.getBoundingClientRect().top;a-=b;this.animatePoint?m.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:a,left:0,onEnd:l.hitch(this,function(){this._updateColor(!0);d.focus(this.hueCursorNode)})}).play():(c.style(this.hueCursorNode,"top",a+"px"),this._updateColor(!0))},_setPoint:function(a){var b=this.PICKER_SAT_SELECTOR_H/2,e=this.PICKER_SAT_SELECTOR_W/2,f=a.layerY||a.y-a.target.getBoundingClientRect().top,f=f-b,b=a.layerX||a.x-
a.target.getBoundingClientRect().left,b=b-e;a&&d.focus(a.target);this.animatePoint?m.slideTo({node:this.cursorNode,duration:this.slideDuration,top:f,left:b,onEnd:l.hitch(this,function(){this._updateColor(!0);d.focus(this.cursorNode)})}).play():(c.style(this.cursorNode,{left:b+"px",top:f+"px"}),this._updateColor(!0))},_handleKey:function(a){},focus:function(){this.focused||d.focus(this.focusNode)},_stopDrag:function(a){h.stop(a)},destroy:function(){this.inherited(arguments);p.forEach(this._subs,function(a){q.unsubscribe(a)});
delete this._subs}})})},"dojox/color":function(){define(["./color/_base"],function(r){return r})},"dojox/color/_base":function(){define(["../main","dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(r,f,l,p){r=f.getObject("color",!0,r);r.Color=l;r.blend=l.blendColors;r.fromRgb=l.fromRgb;r.fromHex=l.fromHex;r.fromArray=l.fromArray;r.fromString=l.fromString;r.greyscale=p.makeGrey;f.mixin(r,{fromCmy:function(c,p,n){f.isArray(c)?(p=c[1],n=c[2],c=c[0]):f.isObject(c)&&(p=c.m,n=c.y,c=c.c);return new l({r:Math.round(255*
(1-c/100)),g:Math.round(255*(1-p/100)),b:Math.round(255*(1-n/100))})},fromCmyk:function(c,p,n,k){f.isArray(c)?(p=c[1],n=c[2],k=c[3],c=c[0]):f.isObject(c)&&(p=c.m,n=c.y,k=c.b,c=c.c);k/=100;return new l({r:Math.round(255*(1-Math.min(1,c/100*(1-k)+k))),g:Math.round(255*(1-Math.min(1,p/100*(1-k)+k))),b:Math.round(255*(1-Math.min(1,n/100*(1-k)+k)))})},fromHsl:function(c,p,n){f.isArray(c)?(p=c[1],n=c[2],c=c[0]):f.isObject(c)&&(p=c.s,n=c.l,c=c.h);p/=100;for(n/=100;0>c;)c+=360;for(;360<=c;)c-=360;var k,h;
120>c?(k=(120-c)/60,h=c/60,c=0):240>c?(k=0,h=(240-c)/60,c=(c-120)/60):(k=(c-240)/60,h=0,c=(360-c)/60);k=2*p*Math.min(k,1)+(1-p);h=2*p*Math.min(h,1)+(1-p);c=2*p*Math.min(c,1)+(1-p);.5>n?(k*=n,h*=n,c*=n):(k=(1-n)*k+2*n-1,h=(1-n)*h+2*n-1,c=(1-n)*c+2*n-1);return new l({r:Math.round(255*k),g:Math.round(255*h),b:Math.round(255*c)})}});r.fromHsv=function(c,p,n){f.isArray(c)?(p=c[1],n=c[2],c=c[0]):f.isObject(c)&&(p=c.s,n=c.v,c=c.h);360==c&&(c=0);p/=100;n/=100;var k,h,t;if(0==p)h=t=k=n;else{var e=c/60;c=Math.floor(e);
var b=e-c,e=n*(1-p),m=n*(1-p*b);p=n*(1-p*(1-b));switch(c){case 0:k=n;h=p;t=e;break;case 1:k=m;h=n;t=e;break;case 2:k=e;h=n;t=p;break;case 3:k=e;h=m;t=n;break;case 4:k=p;h=e;t=n;break;case 5:k=n,h=e,t=m}}return new l({r:Math.round(255*k),g:Math.round(255*h),b:Math.round(255*t)})};f.extend(l,{toCmy:function(){return{c:Math.round(100*(1-this.r/255)),m:Math.round(100*(1-this.g/255)),y:Math.round(100*(1-this.b/255))}},toCmyk:function(){var c,f=this.r/255,l=this.g/255,k=this.b/255;c=Math.min(1-f,1-l,1-
k);return{c:Math.round((1-f-c)/(1-c)*100),m:Math.round((1-l-c)/(1-c)*100),y:Math.round((1-k-c)/(1-c)*100),b:Math.round(100*c)}},toHsl:function(){var c=this.r/255,f=this.g/255,l=this.b/255,k=Math.min(c,l,f),h=Math.max(c,f,l),t=h-k,e=0,b=0,k=(k+h)/2;0<k&&1>k&&(b=t/(.5>k?2*k:2-2*k));0<t&&(h==c&&h!=f&&(e+=(f-l)/t),h==f&&h!=l&&(e+=2+(l-c)/t),h==l&&h!=c&&(e+=4+(c-f)/t),e*=60);return{h:e,s:Math.round(100*b),l:Math.round(100*k)}},toHsv:function(){var c=this.r/255,f=this.g/255,l=this.b/255,k=Math.max(c,f,
l),h=k-Math.min(c,l,f),t=null,e=0==k?0:h/k;0==e?t=0:(t=c==k?60*(f-l)/h:f==k?120+60*(l-c)/h:240+60*(c-f)/h,0>t&&(t+=360));return{h:t,s:Math.round(100*e),v:Math.round(100*k)}}});return r})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(r,f,l,p){var c={};f.setObject("dojo.colors",c);var q=function(c,f,l){0>l&&++l;1<l&&--l;var e=6*l;return 1>e?c+(f-c)*e:1>2*l?f:2>3*l?c+(f-c)*(2/3-l)*6:c};r.colorFromRgb=l.fromRgb=function(c,f){var h=c.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);
if(h){c=h[2].split(/\s*,\s*/);var e=c.length,h=h[1];if("rgb"==h&&3==e||"rgba"==h&&4==e)return h=c[0],"%"==h.charAt(h.length-1)?(h=p.map(c,function(a){return 2.56*parseFloat(a)}),4==e&&(h[3]=c[3]),l.fromArray(h,f)):l.fromArray(c,f);if("hsl"==h&&3==e||"hsla"==h&&4==e){var h=(parseFloat(c[0])%360+360)%360/360,b=parseFloat(c[1])/100,m=parseFloat(c[2])/100,b=.5>=m?m*(b+1):m+b-m*b,m=2*m-b,h=[256*q(m,b,h+1/3),256*q(m,b,h),256*q(m,b,h-1/3),1];4==e&&(h[3]=c[3]);return l.fromArray(h,f)}}return null};var n=
function(c,f,l){c=Number(c);return isNaN(c)?l:c<f?f:c>l?l:c};l.prototype.sanitize=function(){this.r=Math.round(n(this.r,0,255));this.g=Math.round(n(this.g,0,255));this.b=Math.round(n(this.b,0,255));this.a=n(this.a,0,1);return this};c.makeGrey=l.makeGrey=function(c,f){return l.fromArray([c,c,c,f])};f.mixin(l.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,
226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,
150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],
hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,
136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],
navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,
87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return l})},"jimu/dijit/_Transparency":function(){define("dojo/_base/declare dojo/_base/config dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/_Transparency.html dojo/_base/lang dojo/_base/html dojo/on dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/HorizontalRule ./a11y/_Transparency".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a){r=r([l,p,c,q],{baseClass:"jimu-transparency",declaredClass:"jimu.dijit.Transparency",templateString:n,nls:null,_nls0:"0%",_nls50:"50%",_nls100:"100%",alpha:1,postMixInProperties:function(){this.nls=window.jimuNls.transparency;var a=f.locale||"",a=a.toLowerCase();"ar"===a?(this._nls0="\u066a0",this._nls50="\u066a50",this._nls100="\u066a100"):"tr"===a&&(this._nls0="%0",this._nls50="%50",this._nls100="%100")},postCreate:function(){this.inherited(arguments);"number"===
typeof this.alpha&&this.setAlpha(this.alpha);this.a11y_initAriaAttrs()},setAlpha:function(a){this.opacitySlider.set("value",Math.round(100-100*a))},getAlpha:function(){return Math.round(100-this.opacitySlider.get("value"))/100},_onAlphaChanged:function(){var a=this.getAlpha();this.emit("change",a)}});r.extend(a);return r})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C){var D=f("dijit.form._SliderMover",e,{onMouseMove:function(a){var b=this.widget,d=b._abspos;d||(d=b._abspos=c.position(b.sliderBarContainer,!0),b._setPixelValue_=k.hitch(b,"_setPixelValue"),b._isReversed_=b._isReversed());a=a[b._mousePixelCoord]-d[b._startingPixelCoord];b._setPixelValue_(b._isReversed_?d[b._pixelCount]-a:a,d[b._pixelCount],!1)},destroy:function(a){e.prototype.destroy.apply(this,arguments);var b=this.widget;b._abspos=null;b._setValueAttr(b.value,
!0)}});l=f("dijit.form.HorizontalSlider",[B,z],{templateString:C,value:0,showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:g.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",
_onKeyUp:function(a){this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey||this._setValueAttr(this.value,!0)},_onKeyDown:function(a){if(!(this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey)){switch(a.keyCode){case n.HOME:this._setValueAttr(this.minimum,!1);break;case n.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?n.RIGHT_ARROW:n.LEFT_ARROW:case !1===this._descending?n.DOWN_ARROW:n.UP_ARROW:case !1===this._descending?n.PAGE_DOWN:n.PAGE_UP:this.increment(a);
break;case this._descending||this.isLeftToRight()?n.LEFT_ARROW:n.RIGHT_ARROW:case !1===this._descending?n.UP_ARROW:n.DOWN_ARROW:case !1===this._descending?n.PAGE_UP:n.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(a){this.disabled||this.readOnly||(h("ie")||d.focus(this.sliderHandle),a.stopPropagation(),a.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(a){if(!this.disabled&&!this.readOnly&&
this.clickSelect){d.focus(this.sliderHandle);a.stopPropagation();a.preventDefault();var b=c.position(this.sliderBarContainer,!0),e=a[this._mousePixelCoord]-b[this._startingPixelCoord];this._setPixelValue(this._isReversed()?b[this._pixelCount]-e:e,b[this._pixelCount],!0);this._movable.onMouseDown(a)}},_setPixelValue:function(a,b,d){if(!this.disabled&&!this.readOnly){var c=this.discreteValues;if(1>=c||Infinity==c)c=b;c--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(a/
(b/c))/c+this.minimum,this.maximum),this.minimum),d)}},_setValueAttr:function(a,b){this._set("value",a);this.valueNode.value=a;this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments);var d=this.maximum>this.minimum?(a-this.minimum)/(this.maximum-this.minimum):0,c=!1===this._descending?this.remainingBar:this.progressBar,e=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(b&&0<this.slideDuration&&
c.style[this._progressPixelSize]){var f=this,g={},h=parseFloat(c.style[this._progressPixelSize]),m=this.slideDuration*(d-h/100);0!=m&&(0>m&&(m=0-m),g[this._progressPixelSize]={start:h,end:100*d,units:"%"},this._inProgressAnim=p.animateProperty({node:c,duration:m,onAnimate:function(a){e.style[f._progressPixelSize]=100-parseFloat(a[f._progressPixelSize])+"%"},onEnd:function(){delete f._inProgressAnim},properties:g}),this._inProgressAnim.play())}else c.style[this._progressPixelSize]=100*d+"%",e.style[this._progressPixelSize]=
100*(1-d)+"%"},_bumpValue:function(a,b){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var d=q.getComputedStyle(this.sliderBarContainer),e=c.getContentBox(this.sliderBarContainer,d),d=this.discreteValues;if(1>=d||Infinity==d)d=e[this._pixelCount];d--;a=Math.round((this.value-this.minimum)*d/(this.maximum-this.minimum))+a;0>a&&(a=0);a>d&&(a=d);a=a*(this.maximum-this.minimum)/d+this.minimum;this._setValueAttr(a,b)}},_onClkBumper:function(a){this.disabled||this.readOnly||!this.clickSelect||
this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==n.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==n.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){this.focused&&(a.stopPropagation(),a.preventDefault(),this._bumpValue(0>a.wheelDelta?-1:1,!0))},
startup:function(){this._started||(r.forEach(this.getChildren(),function(a){this[a.container]!=this.containerNode&&this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,b,d){if(-1==a)this._setValueAttr(this.value,!0);else this[b==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](d)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display=
"");var a=b('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",a[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(u.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),u.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(a(this.domNode,
m.wheel,k.hitch(this,"_mouseWheeled")));var b=f(D,{widget:this});this._movable=new t(this.sliderHandle,{mover:b});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});l._Mover=D;return l})},"dijit/form/HorizontalRuleLabels":function(){define("dojo/_base/declare dojo/has dojo/number dojo/query dojo/_base/lang ./HorizontalRule".split(" "),function(r,f,l,p,c,q){r=r("dijit.form.HorizontalRuleLabels",
q,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH"\x3e\x3c/div\x3e',labelStyle:"",labels:[],numericMargin:0,minimum:0,maximum:1,constraints:{pattern:"#%"},_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerH" style\x3d"left:',_labelPrefix:'"\x3e\x3cdiv class\x3d"dijitRuleLabel dijitRuleLabelH"\x3e',_suffix:"\x3c/div\x3e\x3c/div\x3e",_calcPosition:function(c){return c},_genHTML:function(c,f){f=
this.labels[f];return this._positionPrefix+this._calcPosition(c)+this._positionSuffix+this.labelStyle+this._genDirectionHTML(f)+this._labelPrefix+f+this._suffix},_genDirectionHTML:function(c){return""},getLabels:function(){var c=this.labels;!c.length&&this.srcNodeRef&&(c=p("\x3e li",this.srcNodeRef).map(function(c){return String(c.innerHTML)}));if(!c.length&&1<this.count)for(var c=[],f=this.minimum,h=(this.maximum-f)/(this.count-1),t=0;t<this.count;t++)c.push(t<this.numericMargin||t>=this.count-this.numericMargin?
"":l.format(f,this.constraints)),f+=h;return c},postMixInProperties:function(){this.inherited(arguments);this.labels=this.getLabels();this.count=this.labels.length}});f("dojo-bidi")&&r.extend({_setTextDirAttr:function(f){this.textDir!=f&&(this._set("textDir",f),p(".dijitRuleLabelContainer",this.domNode).forEach(c.hitch(this,function(c){c.style.direction=this.getTextDir(c.innerText||c.textContent||"")})))},_genDirectionHTML:function(c){return this.textDir?"direction:"+this.getTextDir(c)+";":""}});
return r})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(r,f,l){return r("dijit.form.HorizontalRule",[f,l],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(f){return this._positionPrefix+f+this._positionSuffix+
this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var f;if(1==this.count)f=this._genHTML(50,0);else{var c,l=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){f=this._genHTML(0,0);for(c=1;c<this.count-1;c++)f+=this._genHTML(l*c,c);f+=this._genHTML(100,this.count-1)}else{f=this._genHTML(100,0);for(c=1;c<this.count-1;c++)f+=this._genHTML(100-l*c,c);f+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=f}})})},"jimu/dijit/a11y/_Transparency":function(){define(["dojo/_base/html"],
function(r){return{a11y_initAriaAttrs:function(){var f=this["aria-labelledby"];f&&(r.removeAttr(this.domNode,"aria-labelledby"),r.setAttr(this.opacitySlider.focusNode,"aria-labelledby",f))}}})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(r,f,l,p){return r("dijit.form.NumberSpinner",[l,p.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(c,f){var l=this.constraints,k=isNaN(c),h=!isNaN(l.max),t=
!isNaN(l.min);k&&0!=f&&(c=0<f?t?l.min:h?l.max:0:h?this.constraints.max:t?l.min:0);f=c+f;if(k||isNaN(f))return c;h&&f>l.max&&(f=l.max);t&&f<l.min&&(f=l.min);return f},_onKeyDown:function(c){if(!(this.disabled||this.readOnly||c.keyCode!=f.HOME&&c.keyCode!=f.END||c.ctrlKey||c.altKey||c.metaKey||"undefined"==typeof this.get("value"))){var l=this.constraints[c.keyCode==f.HOME?"min":"max"];"number"==typeof l&&this._setValueAttr(l,!1);c.stopPropagation();c.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),
function(r,f,l,p,c,q,n,k,h,t){return r("dijit.form._Spinner",k,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:h,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(c){return c},_arrowPressed:function(c,b,f){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),b*f),!1),t.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=
null},_typematicCallback:function(c,b,h){var a=this.smallDelta;b==this.textbox&&(b=h.keyCode,a=b==f.PAGE_UP||b==f.PAGE_DOWN?this.largeDelta:this.smallDelta,b=b==f.UP_ARROW||b==f.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==c?this._arrowReleased(b):this._arrowPressed(b,b==this.upArrowNode?1:-1,a)},_wheelTimer:null,_mouseWheeled:function(c){if(this.focused){c.stopPropagation();c.preventDefault();var b=c.wheelDelta/120;Math.floor(b)!=b&&(b=0<c.wheelDelta?1:-1);c=c.detail?-1*c.detail:b;if(0!==c){var e=
this[0<c?"upArrowNode":"downArrowNode"];this._arrowPressed(e,c,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(e)},50)}}},_setConstraintsAttr:function(c){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):
this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(c,b){this.focusNode.setAttribute("aria-valuenow",c);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(q(this.domNode,c.wheel,l.hitch(this,"_mouseWheeled")),n.addListener(this.upArrowNode,this.textbox,{keyCode:f.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),n.addListener(this.downArrowNode,this.textbox,
{keyCode:f.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),n.addListener(this.upArrowNode,this.textbox,{keyCode:f.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),n.addListener(this.downArrowNode,this.textbox,{keyCode:f.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,
this.defaultTimeout,this.minimumTimeout))}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(r,f,l){return r("dijit.form.RangeBoundTextBox",l,{rangeMessage:"",rangeCheck:function(f,c){return("min"in c?0<=this.compare(f,c.min):!0)&&("max"in c?0>=this.compare(f,c.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var f=this.get("value");
if(null==f)return!1;var c=!1;"min"in this.constraints&&(c=this.constraints.min,c=0>this.compare(f,"number"==typeof c&&0<=c&&0!=f?0:c));!c&&"max"in this.constraints&&(c=this.constraints.max,c=0<this.compare(f,"number"!=typeof c||0<c?c:0));return c},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(f){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(f))},getErrorMessage:function(f){var c=
this.get("value");return null==c||""===c||"number"==typeof c&&isNaN(c)||this.isInRange(f)?this.inherited(arguments):this.rangeMessage},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=f.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(r,f,l,p,c,q){var n=
function(c){c=c||{};var f=l.getLocalization("dojo.cldr","number",l.normalizeLocale(c.locale)),e=c.pattern?c.pattern:f[(c.type||"decimal")+"Format"];c="number"==typeof c.places?c.places:"string"===typeof c.places&&0<c.places.length?c.places.replace(/.*,/,""):-1!=e.indexOf(".")?e.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:f.decimal,places:c}},k=r("dijit.form.NumberTextBoxMixin",null,{pattern:function(c){return"("+(this.focused&&this.editOptions?this._regExpGenerator(f.delegate(c,this.editOptions))+
"|":"")+this._regExpGenerator(c)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:c.format,_regExpGenerator:c.regexp,_decimalInfo:n(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(c){var f="number"==typeof c.places?c.places:0;f&&f++;"number"!=typeof c.max&&(c.max=9*Math.pow(10,15-f));"number"!=typeof c.min&&(c.min=-9*Math.pow(10,15-f));this.inherited(arguments,[c]);this.focusNode&&this.focusNode.value&&!isNaN(this.value)&&
this.set("value",this.value);this._decimalInfo=n(c)},_onFocus:function(c){if(!this.disabled&&!this.readOnly){var f=this.get("value");"number"!=typeof f||isNaN(f)||(f=this.format(f,this.constraints),void 0!==f&&(this.textbox.value=f,"mouse"!==c&&this.textbox.select()));this.inherited(arguments)}},format:function(c,k){var e=String(c);if("number"!=typeof c)return e;if(isNaN(c))return"";if(!("rangeCheck"in this&&this.rangeCheck(c,k))&&!1!==k.exponent&&/\de[-+]?\d/i.test(e))return e;this.editOptions&&
this.focused&&(k=f.mixin({},k,this.editOptions));return this._formatter(c,k)},_parser:c.parse,parse:function(c,k){var e=f.mixin({},k,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=e.places){var b=e.places,b="number"===typeof b?b:Number(b.split(",").pop());e.places="0,"+b}e=this._parser(c,e);this.editOptions&&this.focused&&isNaN(e)&&(e=this._parser(c,k));return e},_getDisplayedValueAttr:function(){var c=this.inherited(arguments);return isNaN(c)?this.textbox.value:c},filter:function(f){if(null==
f||"string"==typeof f&&""==f)return NaN;"number"!=typeof f||isNaN(f)||0==f||(f=c.round(f,this._decimalInfo.places));return this.inherited(arguments,[f])},serialize:function(c,f){return"number"!=typeof c||isNaN(c)?"":this.inherited(arguments)},_setBlurValue:function(){var c=f.hitch(f.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(c,!0)},_setValueAttr:function(c,f,e){if(void 0!==c&&void 0===e)if(e=String(c),"number"==typeof c)if(isNaN(c))e="";else{if("rangeCheck"in this&&this.rangeCheck(c,
this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(e))e=void 0}else c?c=void 0:(e="",c=NaN);this.inherited(arguments,[c,f,e])},_getValueAttr:function(){var h=this.inherited(arguments);if(isNaN(h)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+c._realNumberRegexp(f.delegate(this.constraints))+"$")).test(this.textbox.value))return h=Number(this.textbox.value),isNaN(h)?void 0:h}else return h},isValid:function(c){if(!this.focused||
this._isEmpty(this.textbox.value))return this.inherited(arguments);var f=this.get("value");return!isNaN(f)&&this.rangeCheck(f,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var c="number"==typeof this.constraints.min,f="number"==typeof this.constraints.max,e=this.get("value");if(isNaN(e)||!c&&!f)return this.inherited(arguments);var b=e|0,m=0>e,a=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),
g=(this.maxLength||20)-this.textbox.value.length,d=a?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"",b=a?b+"."+d:b+"",g=p.rep("9",g),a=e;m?a=Number(b+g):e=Number(b+g);return!(c&&e<this.constraints.min||f&&a>this.constraints.max)}});r=r("dijit.form.NumberTextBox",[q,k],{baseClass:"dijitTextBox dijitNumberTextBox"});r.Mixin=k;return r})},"jimu/dijit/ServiceURLInput":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/Deferred dojo/aspect esri/request dijit/form/ValidationTextBox".split(" "),
function(r,f,l,p,c,q,n,k){return r([k],{_validatingNode:null,_validNode:null,_inValidNode:null,_fetchHandle:null,_fetchErrHandle:null,declaredClass:"jimu.dijit.ServiceURLInput",verify:!0,_status:null,postCreate:function(){this.inherited(arguments);this._validatingNode=f.create("div",{"class":"jimu-service-validating"},this.domNode);this._validNode=f.create("div",{"class":"jimu-service-valid"},this.domNode);this._inValidNode=f.create("div",{"class":"jimu-service-invalid jimu-icon jimu-icon-error"},
this.domNode);f.addClass(this.domNode,"jimu-serviceurl-input");this.verify&&this.own(p(this,"Change",l.hitch(this,"_onServiceUrlChange")))},setProcessFunction:function(c,f){this._fetchHandle&&this._fetchErrHandle&&this._removeProcessFunction();"function"===typeof c&&(this._fetchHandle=q.after(this,"onFetch",c),this.own(this._fetchHandle));"function"===typeof f&&(this._fetchErrHandle=q.after(this,"onFetchError",f),this.own(this._fetchErrHandle))},_removeProcessFunction:function(){this._fetchHandle&&
this._fetchHandle.remove&&(this._fetchHandle.remove(),this._fetchHandle=null);this._fetchErrHandle&&this._fetchErrHandle.remove&&(this._fetchErrHandle.remove(),this._fetchErrHandle=null)},onFetch:function(c){return c},onFetchError:function(c){},getStatus:function(){return this._status},_onServiceUrlChange:function(f){var h=new c;h.then(l.hitch(this,function(){this._valid()}),l.hitch(this,function(){this._inValid();this.onFetchError()}));this._validating();f?n({url:l.trim(f||""),handleAs:"json",content:{f:"json"},
callbackParamName:"callback"}).then(l.hitch(this,function(c){this.onFetch({url:this.getValue(),data:c})?h.resolve("success"):h.reject("error")}),l.hitch(this,function(c){h.reject(c)})):h.reject("error")},_validating:function(){this._status="validating";f.removeClass(this.domNode,"jimu-serviceurl-input-invalid");f.removeClass(this.domNode,"jimu-serviceurl-input-valid");f.addClass(this.domNode,"jimu-serviceurl-input-validating")},_valid:function(){this._status="valid";f.removeClass(this.domNode,"jimu-serviceurl-input-invalid");
f.removeClass(this.domNode,"jimu-serviceurl-input-validating");f.addClass(this.domNode,"jimu-serviceurl-input-valid")},_inValid:function(){this._status="invalid";f.removeClass(this.domNode,"jimu-serviceurl-input-validating");f.removeClass(this.domNode,"jimu-serviceurl-input-valid");f.addClass(this.domNode,"jimu-serviceurl-input-invalid")}})})},"jimu/dijit/SimpleTable":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dijit/registry jimu/utils jimu/dijit/CheckBox dijit/form/Select".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m){return r([f,l,p],{baseClass:"jimu-simple-table",declaredClass:"jimu.dijit.SimpleTable",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"headDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"headTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" data-dojo-attach-point\x3d"tableInHeadSection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"headColgroup"\x3e\x3c/colgroup\x3e\x3cthead class\x3d"simple-table-thead simple-table-title"  data-dojo-attach-point\x3d"thead"\x3e\x3c/thead\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"body-section" data-dojo-attach-point\x3d"bodyDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"bodyTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0"data-dojo-attach-point\x3d"tableInBodySection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"bodyColgroup"\x3e\x3c/colgroup\x3e\x3ctbody class\x3d"simple-table-tbody" data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
_name:null,_rowIndex:0,_rowHeight:30,_headHeight:36,REPEATING_ERROR:"REPEATING_ERROR",_classSimpleTableRow:"simple-table-row",_classFirstSimpleTableRow:"first-simple-table-row",_classLastSimpleTableRow:"last-simple-table-row",_classJimuStateDisabled:"jimu-state-disabled",_classRowUpDiv:"row-up-div",_classRowDownDiv:"row-down-div",_classVerticalScroll:"vertical-scroll",autoHeight:!0,selectable:!1,fields:null,singleClickEdit:!1,postMixInProperties:function(){this.nls=window.jimuNls.simpleTable},postCreate:function(){this.inherited(arguments);
this._initSelf()},startup:function(){this.inherited(arguments);this.updateUI()},_initSelf:function(){this.own(e.bindClickAndDblclickEvents(this.tableInBodySection,c.hitch(this,function(a){if(a=e.getAncestorDom(a.target||a.srcElement,function(a){return q.hasClass(a,"simple-table-row")&&q.hasClass(a,"not-empty")},this.tbody))this.selectRow(a),this._onClickRow(a)}),c.hitch(this,function(a){if(a=e.getAncestorDom(a.target||a.srcElement,function(a){return q.hasClass(a,"simple-table-row")&&q.hasClass(a,
"not-empty")},this.tbody))this.selectRow(a),this._onDblClickRow(a)})));var a=Math.random().toString();this._name="jimu_table_"+a.slice(2,a.length);if(this.fields&&0<this.fields.length){var f=q.create("tr",{},this.thead);n.forEach(this.fields,c.hitch(this,function(a){var d="auto";"actions"===a.type&&(a.name="actions");a.hidden?d=1:void 0!==a.width&&null!==a.width?d=a.width:"actions"!==a.type||a.name||(a.width=this._calculateActionsWidth(a)+20,d=a.width);q.create("col",{width:d},this.headColgroup);
q.create("col",{width:d},this.bodyColgroup);d=q.create("th",{innerHTML:e.sanitizeHTML(a.title),title:a.title},f);if("checkbox"===a.type){d.innerHTML="";var g=new b({label:a.title});this.own(k(g.domNode,"click",c.hitch(this,function(){g.getValue()?this._checkAllTdCheckBoxes(a.name):this._uncheckAllTdCheckBoxes(a.name)})));g.placeAt(d)}q.addClass(d,"simple-table-field");a.hidden&&q.addClass(d,"hidden-column");a["class"]&&q.addClass(d,a["class"]);q.addClass(d,a.name)}))}else this.fields=null},_getThCheckBox:function(a){var b=
null;a=h(".simple-table-field."+a+" .jimu-checkbox",this.thead)[0];return b=t.byNode(a)},_getAllEnabledTdCheckBoxes:function(a){a=h(".simple-table-cell."+a+" .jimu-checkbox",this.tbody);a=n.map(a,function(a){return t.byNode(a)});return a=n.filter(a,function(a){return a.getStatus()})},_checkAllTdCheckBoxes:function(a){a=this._getAllEnabledTdCheckBoxes(a);n.forEach(a,function(a){a.getValue()||a.setValue(!0)})},_uncheckAllTdCheckBoxes:function(a){a=this._getAllEnabledTdCheckBoxes(a);n.forEach(a,function(a){a.getValue()&&
a.setValue(!1)})},_delaySyncThCheckBoxStatusWithAllTdCheckBoxes:function(a){setTimeout(c.hitch(this,function(){this._syncThCheckBoxStatusWithAllTdCheckBoxes(a)}),100)},_syncThCheckBoxStatusWithAllTdCheckBoxes:function(a){var b=this._getAllEnabledTdCheckBoxes(a),b=n.filter(b,c.hitch(this,function(a){return a.getStatus()}));0!==b.length&&(a=this._getThCheckBox(a),n.every(b,function(a){return a.getValue()})?a.getValue()||a.setValue(!0):a.getValue()&&a.setValue(!1))},clear:function(){var a=this._getNotEmptyRows(),
b=n.map(a,c.hitch(this,function(a){return this.getRowData(a)}));q.empty(this.tbody);n.forEach(a,c.hitch(this,function(a,c){this._onDeleteRow(a,b[c])}));this.updateUI();this._rowIndex=0;this._onClearRows(a)},addRows:function(a){var b=[];this.fields&&a&&0<a.length&&n.forEach(a,c.hitch(this,function(a){b.push(this.addRow(a,-1,!0))}));this.updateUI();return b},addRow:function(a,b,d){this._rowIndex++;var e={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==
typeof a)return e;var f=n.filter(this.fields,c.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),f=n.filter(f,c.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,a[b.name]).length}));if(0<f.length)return e.errorCode=this.REPEATING_ERROR,e.errorMessage="repeating data",e.repeatFields=f,e;var g=q.create("tr",{"class":"simple-table-row not-empty"},this.tbody);q.setAttr(g,"rowId","row"+this._rowIndex);n.forEach(this.fields,c.hitch(this,function(b){var d=a[b.name],c=
b.type,e=null;"actions"===c?e=this._createActionsTd(g,b):("text"===c?e=this._createTextTd(g,b,d):"radio"===c?e=this._createRadioTd(g,b,d):"checkbox"===c?e=this._createCheckboxTd(g,b,d):"empty"===c?e=this._createEmptyTd(g,b):"extension"===c?e=this._createExtensionTd(g,b,d):"dropdown"===c&&(e=this._createDropdownTd(g,b,d)),b.hidden&&q.addClass(e,"hidden-column"))}));d||(this.updateUI(),d=this.getRows(),"number"===typeof b&&0<=b&&b<d.length&&q.place(g,d[b],"before"));e.success=!0;e.tr=g;e.errorMessage=
null;this._onAddRow(g);return e},deleteRow:function(a){if(a){var b=this.getRowData(a);q.destroy(a);this.updateUI();this._onDeleteRow(a,b)}},selectRow:function(a){this.selectable&&(h(".simple-table-row",this.tbody).removeClass("jimu-state-active"),q.addClass(a,"jimu-state-active"),this._onSelectRow(a))},updateUI:function(){this._updateRowClassName();this._updateHeight();q.removeClass(this.domNode,this._classVerticalScroll);0<this.bodyDiv.clientHeight&&this.bodyDiv.clientHeight<this.bodyDiv.scrollHeight&&
q.addClass(this.domNode,this._classVerticalScroll);n.forEach(this.fields,c.hitch(this,function(a){"checkbox"===a.type&&this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(a.name)}))},_updateHeadTableWidth:function(){if(this.domNode){var a=q.getContentBox(this.tableInBodySection).w,b="100%";"number"===typeof a&&0<a&&(b=a+"px");q.setStyle(this.tableInHeadSection,"width",b)}},_updateHeight:function(){var a=this.getRows();this.autoHeight&&q.setStyle(this.domNode,"height",this._headHeight+this._rowHeight*
(0<a.length?a.length:1)+1+"px");a&&0<a.length&&this.bodyTableDiv&&(a=q.getMarginSize(a[0]))&&a.h&&q.setStyle(this.bodyTableDiv,"backgroundSize","1px "+a.h+"px")},_updateRowClassName:function(){var a=h("."+this._classFirstSimpleTableRow,this.tbody)[0];a&&(a=h("."+this._classRowUpDiv,a)[0])&&q.removeClass(a,this._classJimuStateDisabled);(a=h("."+this._classLastSimpleTableRow,this.tbody)[0])&&(a=h("."+this._classRowDownDiv,a)[0])&&q.removeClass(a,this._classJimuStateDisabled);a=h("."+this._classSimpleTableRow,
this.tbody);a.removeClass("odd");a.removeClass("even");a.removeClass(this._classFirstSimpleTableRow);a.removeClass(this._classLastSimpleTableRow);n.forEach(a,c.hitch(this,function(a,b){0===b%2?q.addClass(a,"odd"):q.addClass(a,"even")}));if(0<a.length){var b=a[0];q.addClass(b,this._classFirstSimpleTableRow);(b=h("."+this._classRowUpDiv,b)[0])&&q.addClass(b,this._classJimuStateDisabled);a=a[a.length-1];q.addClass(a,this._classLastSimpleTableRow);(a=h("."+this._classRowDownDiv,a)[0])&&q.addClass(a,this._classJimuStateDisabled)}},
_createTextTd:function(a,b,d){var c=null;return c=b.editable?this._createEditableTextTd(a,b,d):this._createNormalTextTd(a,b,d)},_createNormalTextTd:function(a,b,d){var c=q.toDom('\x3ctd class\x3d"simple-table-cell normal-text-td"\x3e\x3cdiv class\x3d"normal-text-div"\x3e\x3c/div\x3e\x3c/td\x3e');q.addClass(c,b.name);var f=h("div",c)[0];f.innerHTML=e.sanitizeHTML(d)||"";f.title=d||"";b["class"]&&q.addClass(c,b["class"]);q.place(c,a);return c},_createEditableTextTd:function(a,b,d){var f=q.toDom('\x3ctd class\x3d"editable-text-td '+
b.name+'"\x3e\x3cdiv class\x3d"editable-div"\x3e\x3c/div\x3e\x3cinput class\x3d"editable-input" type\x3d"text" style\x3d"display:none;" /\x3e\x3c/td\x3e');q.addClass(f,"simple-table-cell");q.place(f,a);b["class"]&&q.addClass(f,b["class"]);var g=h("div",f)[0],m=h("input",f)[0];g.innerHTML=e.sanitizeHTML(d)||"";""!==g.innerHTML&&(g.title=g.innerText||g.innerHTML);m.value=g.innerHTML;this.own(k(g,this.singleClickEdit?"click":"dblclick",c.hitch(this,function(a){this.singleClickEdit||a.stopPropagation();
m.value=g.innerText||g.innerHTML;q.setStyle(g,"display","none");q.setStyle(m,"display","inline");m.focus();m.select&&m.select()})));this.own(k(m,"blur",c.hitch(this,function(){m.value=c.trim(e.sanitizeHTML(m.value));var d=g.innerText||g.innerHTML,f=m.value;""!==f?b.unique?0<this.getRowDataArrayByFieldValue(b.name,f,a).length?m.value=d:g.innerHTML=e.sanitizeHTML(f):g.innerHTML=e.sanitizeHTML(f):m.value=d;q.setStyle(m,"display","none");q.setStyle(g,"display","block")})));return f},_createRadioTd:function(a,
b,d){var c=q.toDom('\x3ctd class\x3d"radio-td '+b.name+'"\x3e\x3cinput class\x3d"jimu-radio-btn" type\x3d"radio" /\x3e\x3c/td\x3e');q.addClass(c,"simple-table-cell");q.place(c,a);b["class"]&&q.addClass(c,b["class"]);a=h("input",c)[0];a.name=b.radio&&"row"===b.radio?this._name+this._rowIndex:this._name+b.name;a.checked=!0===d;return c},_createCheckboxTd:function(a,e,d){var f=q.toDom('\x3ctd class\x3d"checkbox-td '+e.name+'"\x3e\x3c/td\x3e');q.addClass(f,"simple-table-cell");q.place(f,a);e["class"]&&
q.addClass(f,e["class"]);var g=new b({onChange:c.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(e.name);"function"===typeof e.onChange&&setTimeout(c.hitch(this,function(){e.onChange(a,g)}),200)})});this.own(k(g,"status-change",c.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(e.name)})));this._setValueForCheckBox(g,d);g.placeAt(f);return f},_createActionsTd:function(a,b){var d=q.toDom('\x3ctd class\x3d"actions-td"\x3e\x3cdiv class\x3d"action-item-parent jimu-float-leading"\x3e\x3c/div\x3e\x3c/td\x3e');
q.addClass(d,"simple-table-cell");var e=h(".action-item-parent",d)[0];q.place(d,a);b["class"]&&q.addClass(d,b["class"]);n.forEach(b.actions,c.hitch(this,function(b){"up"===b?(b=q.create("div",{"class":"action-item jimu-float-leading row-up-div jimu-icon jimu-icon-up"},e),b.title=this.nls.moveUp,this.own(k(b,"click",c.hitch(this,function(b){b.stopPropagation();if(this.onBeforeRowUp(a)){b=h(".simple-table-row",this.tbody);var d=n.indexOf(b,a);0<d&&(b=b[d-1])&&(q.place(a,b,"before"),this.updateUI(),
this.emit("row-up",a))}})))):"down"===b?(b=q.create("div",{"class":"action-item jimu-float-leading row-down-div jimu-icon jimu-icon-down"},e),b.title=this.nls.moveDown,this.own(k(b,"click",c.hitch(this,function(b){b.stopPropagation();if(this.onBeforeRowDown(a)){b=h(".simple-table-row",this.tbody);var d=n.indexOf(b,a);d<b.length-1&&(b=b[d+1])&&(q.place(a,b,"after"),this.updateUI(),this.emit("row-down",a))}})))):"edit"===b?(b=q.create("div",{"class":"action-item jimu-float-leading row-edit-div jimu-icon jimu-icon-edit"},
e),b.title=this.nls.edit,this.own(k(b,"click",c.hitch(this,function(b){b.stopPropagation();this.onBeforeRowEdit(a)&&this._onActionsEdit(a)})))):"delete"===b&&(b=q.create("div",{"class":"action-item jimu-float-leading row-delete-div jimu-icon jimu-icon-delete"},e),b.title=this.nls.deleteRow,this.own(k(b,"click",c.hitch(this,function(b){b.stopPropagation();this.onBeforeRowDelete(a)&&this.deleteRow(a)}))))}));b=this._calculateActionsWidth(b)+"px";q.setStyle(e,"width",b);return d},_calculateActionsWidth:function(a){return 20*
n.map(a.actions,function(a){return"up"===a||"down"===a||"edit"===a||"delete"===a}).length},_createEmptyTd:function(a,b){a=q.create("td",{"class":b.name},a);q.addClass(a,"simple-table-cell");q.addClass(a,"empty-text-td");b["class"]&&q.addClass(a,b["class"]);return a},_createExtensionTd:function(a,b,d){a=q.create("td",{"class":b.name},a);q.addClass(a,"simple-table-cell");q.addClass(a,"extension-td");b["class"]&&q.addClass(a,b["class"]);b.create&&"function"===typeof b.create&&b.create(a);b.setValue&&
"function"===typeof b.setValue&&b.setValue(a,d);return a},_createDropdownTd:function(a,b,d){a=q.create("td",{"class":b.name},a);q.addClass(a,"simple-table-cell");q.addClass(a,"dropdown-td");b["class"]&&q.addClass(a,b["class"]);(new m({options:d})).placeAt(a);return a},editRow:function(a,b){var d={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof b||!q.isDescendant(a,this.tbody))return d;var e=c.mixin([],this.fields),e=n.filter(e,c.hitch(this,
function(a){return"text"===a.type&&!0===a.unique})),e=n.filter(e,c.hitch(this,function(d){return 0<this.getRowDataArrayByFieldValue(d.name,b[d.name],a).length}));if(0<e.length)return d.errorCode=this.REPEATING_ERROR,d.errorMessage="repeating data",d.repeatFields=e,d;var f=h(".simple-table-cell",a);n.forEach(this.fields,c.hitch(this,function(a,d){if(b.hasOwnProperty(a.name)){d=f[d];var c=b[a.name],e=a.type;"text"===e?a.editable?this._editEditableText(d,a,c):this._editNormalText(d,a,c):"radio"===e?
this._editRadio(d,a,c):"checkbox"===e?this._editCheckbox(d,a,c):"extension"===e?this._editExtension(d,a,c):"dropdown"===e&&this._editDropdown(d,a,c)}}));d.success=!0;d.tr=a;d.errorMessage=null;this._onEditRow(a);return d},_editNormalText:function(a,b,d){a=h("div",a)[0];a.innerHTML=e.sanitizeHTML(d)||"";a.title=a.innerHTML},_editEditableText:function(a,b,d){b=h("div",a)[0];b.innerHTML=e.sanitizeHTML(d)||"";h("input",a)[0].value=b.innerHTML},_editRadio:function(a,b,d){h("input",a)[0].checked=!0===d},
_editCheckbox:function(a,b,d){a=h(".jimu-checkbox",a)[0];a=t.byNode(a);this._setValueForCheckBox(a,d)},_setValueForCheckBox:function(a,b){null===b?a.setStatus(!1):(a.setStatus(!0),b!==a.getValue()&&a.setValue(b))},_editExtension:function(a,b,d){b.setValue&&"function"===typeof b.setValue&&b.setValue(a,d)},_editDropdown:function(a,b,d){a=h(".dijitSelect",a)[0];t.byNode(a).set("value",d)},_getAllRows:function(){return h(".simple-table-row",this.tbody)},_getNotEmptyRows:function(){var a=this._getAllRows();
return n.filter(a,c.hitch(this,function(a){return!q.hasClass(a,"empty")}))},_getEmptyRows:function(){var a=this._getAllRows();return n.filter(a,c.hitch(this,function(a){return q.hasClass(a,"empty")}))},getRows:function(){return this._getNotEmptyRows()},getSelectedRow:function(){var a=null,b=h(".simple-table-row",this.tbody),b=n.filter(b,c.hitch(this,function(a){return!q.hasClass(a,"empty")&&q.hasClass(a,"jimu-state-active")}));0<b.length&&(a=b[0]);return a},getSelectedRowData:function(){var a=null,
b=this.getSelectedRow();b&&(a=this._getRowDataByTr(b));return a},getData:function(a){var b=this._getNotEmptyRows();a&&(b=n.filter(b,c.hitch(this,function(b){return b!==a})));return n.map(b,c.hitch(this,function(a){return this._getRowDataByTr(a)}))},getRowData:function(a){return this._getRowDataByTr(a)},_getRowDataByTr:function(a){var b=null;if(a)b={};else return null;n.forEach(this.fields,c.hitch(this,function(d){var c=d.type;if("actions"!==c){var e=d.name;b[e]=null;var f=h(".simple-table-cell."+
e,a)[0];f&&("text"===c?(d=h("div",f)[0],b[e]=d.innerText||d.innerHTML):"radio"===c?(d=h("input",f)[0],b[e]=d.checked):"checkbox"===c?(d=h(".jimu-checkbox",f)[0],d=t.byNode(d),d.getStatus()?b[e]=d.getValue():b[e]=null):"extension"===c?d.getValue&&"function"===typeof d.getValue&&(b[e]=d.getValue(f,d)):"dropdown"===c&&(d=h(".dijitSelect",f)[0],d=t.byNode(d),b[e]=d.get("value")))}}));return b},getRowDataArrayByFieldValue:function(a,b,d){var e=[];if(!this.fields||!n.some(this.fields,c.hitch(this,function(b){return b.name===
a})))return[];d=this.getData(d);return e=n.filter(d,c.hitch(this,function(d){return d[a]==b}))},moveToTop:function(a){a&&a.parentNode===this.tbody&&q.place(a,this.tbody,"first")},_onClickRow:function(a){this.emit("row-click",a)},_onDblClickRow:function(a){this.emit("row-dblclick",a)},_onSelectRow:function(a){this.emit("row-select",a)},_onAddRow:function(a){this.emit("row-add",a)},_onEditRow:function(a){this.emit("row-edit",a)},_onDeleteRow:function(a,b){this.emit("row-delete",a,b)},_onEnterRow:function(a){this.emit("row-enter",
a)},_onClearRows:function(a){this.emit("rows-clear",a)},_onActionsEdit:function(a){this.emit("actions-edit",a)},onBeforeRowUp:function(a){return!0},onBeforeRowDown:function(a){return!0},onBeforeRowEdit:function(a){return!0},onBeforeRowDelete:function(a){return!0}})})},"jimu/dijit/TabContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/keys dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin ./ViewStack ../utils".split(" "),function(r,f,l,
p,c,q,n,k,h,t,e){return r([k,h,n],{baseClass:"jimu-tab",declaredClass:"jimu.dijit.TabContainer",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"control" data-dojo-attach-point\x3d"controlNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.inherited(arguments);if(0!==this.tabs.length){this.controlNodes=[];this.viewStack=new t(null,this.containerNode);this.own(c(this.containerNode,"keydown",f.hitch(this,
function(b){b.keyCode===q.ESCAPE&&(b.stopPropagation(),this._currentCtrlNode.focus())})));var b=1/this.tabs.length*100;this.isNested&&p.addClass(this.domNode,"nested");l.forEach(this.tabs,function(c){this._createTab(c,b)},this);this.own(c(this.controlNode,"keydown",f.hitch(this,function(b){var a=b.target,c;b.keyCode===q.RIGHT_ARROW?c=a.nextElementSibling?a.nextElementSibling:this.controlNodes[0]:b.keyCode===q.LEFT_ARROW?c=a.previousElementSibling?a.previousElementSibling:this.controlNodes[this.controlNodes.length-
1]:b.keyCode===q.HOME?c=this.controlNodes[0]:b.keyCode===q.END&&(c=this.controlNodes[this.controlNodes.length-1]);c&&(a=c,c.focus())})))}},startup:function(){this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title);e.setVerticalCenter(this.domNode)},_createTab:function(b,h){h=p.create("div",{innerHTML:e.sanitizeHTML(b.title),"class":"tab jimu-vcenter-text",style:{width:this.isNested?"auto":h+"%"},label:b.title},this.controlNode);this.viewStack.viewType=b.content.domNode?
"dijit":"dom";b.content.label=b.title;this.viewStack.addView(b.content);this.own(c(h,"click",f.hitch(this,function(a){this.onSelect(b.title,a)})));this.own(c(h,"keydown",f.hitch(this,function(a){if(a.keyCode===q.ENTER||a.keyCode===q.SPACE)this.onSelect(b.title,a)})));h.label=b.title;this.controlNodes.push(h)},onSelect:function(b,c){p.hasClass(c.target,"jimu-state-selected")||this.selectTab(b,c)},selectTab:function(b){this._selectControl(b);this.viewStack.switchView(b);this.emit("tabChanged",b)},_selectControl:function(b){l.forEach(this.controlNodes,
function(c){p.removeClass(c,"jimu-state-selected");p.setAttr(c,"tabindex","-1");c.label===b&&(this._currentCtrlNode=c,p.addClass(c,"jimu-state-selected"),p.setAttr(c,"tabindex","0"))},this)}})})},"jimu/dijit/ViewStack":function(){define("dojo/_base/declare dojo/_base/fx dojo/_base/lang dojo/_base/html dojo/_base/array dijit/_WidgetBase".split(" "),function(r,f,l,p,c,q){return r(q,{baseClass:"jimu-viewstack",declaredClass:"jimu.dijit.ViewStack",_currentView:null,postCreate:function(){this.inherited(arguments);
this.views||(this.views=[]);c.forEach(this.views,l.hitch(this,function(c){1===c.nodeType?(p.place(c,this.domNode),p.addClass(c,"view"),p.setStyle(c,"display","none")):c.domNode&&(p.place(c.domNode,this.domNode),p.addClass(c.domNode,"view"),p.setStyle(c.domNode,"display","none"))}))},startup:function(){this.inherited(arguments);0<this.views.length&&this.switchView(0)},getSelectedView:function(){return this._currentView},getSelectedLabel:function(){var c="",f=this.getSelectedView();f&&(c=f.label);return c},
getViewByLabel:function(c){for(var f=0;f<this.views.length;f++)if(c===this.views[f].label)return this.views[f];return null},addView:function(c){this.views.push(c);1===c.nodeType?(p.place(c,this.domNode),p.addClass(c,"view")):c.domNode&&(p.place(c.domNode,this.domNode),p.addClass(c.domNode,"view"))},removeView:function(f){var k=this.views.length;this.views=c.filter(this.views,function(c){return f!==c});k!==this.views.length&&(1===f.nodeType?p.destroy(f):f.domNode&&f.destroyRecursive())},switchView:function(c){var k,
h;k="number"===typeof c?this.views[c]:"string"===typeof c?this.getViewByLabel(c):c;this.views.forEach(l.hitch(this,function(c){if(c)if(1===c.nodeType?h=c:c.domNode&&(h=c.domNode),c===k){if(p.setStyle(h,"display","block"),f.fadeIn({node:h}).play(),c.domNode)if(!c._started)c.startup(),c._started=!0;else if("function"===typeof c.onShown)c.onShown()}else if(p.setStyle(h,"display","none"),f.fadeOut({node:h}).play(),c.domNode&&"function"===typeof c.onHidden)c.onHidden()}));this._currentView=k;this.onViewSwitch(k)},
onViewSwitch:function(){}})})},"jimu/dijit/TabContainer3":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/keys dojo/Evented dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/TabContainer3.html jimu/dijit/ViewStack jimu/utils".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m){return r([h,t,n],{templateString:e,baseClass:"jimu-tab3",declaredClass:"jimu.dijit.TabContainer3",_currentIndex:-1,selected:"",tabs:null,average:!0,postCreate:function(){this.inherited(arguments);
this._initSelf();this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title)},selectTab:function(a){l.forEach(this.tabItems,f.hitch(this,function(b,d){p.removeClass(b,"jimu-state-active");p.setAttr(b,"tabindex","-1");b.label===a&&(p.addClass(b,"jimu-state-active"),p.setAttr(b,"tabindex","0"),this._currentIndex=d)}));this.viewStack.switchView(a);this.emit("tabChanged",a)},addTab:function(a){if(!this.average){var b=k("td:last-child",this.tabTr);0<b.length&&p.destroy(b[0])}0<
l.filter(this.tabs,function(b){return b.title===a.title}).length?console.error("tab title conflict: "+a.title):(this.tabs.push(a),this._createTab(a),this.average||this._addEmptyTab())},_addEmptyTab:function(){var a=p.toDom('\x3ctd nowrap class\x3d"tab-item-td tab-item-td-empty" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');p.place(a,this.tabTr)},removeTab:function(a){var b=-1;if(l.some(this.tabs,function(d,c){if(d.title===a)return b=c,!0})){var d=
this.tabs.splice(b,1)[0];l.some(this.tabItems,function(b,d){if(b.label===a)return this.tabItems.splice(d,1),p.destroy(b),!0},this);this.viewStack.removeView(d.content)}},showShelter:function(){p.setStyle(this.shelter,"display","block")},hideShelter:function(){p.setStyle(this.shelter,"display","none")},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},_initSelf:function(){this.viewStack=new b(null,this.containerNode);this.own(c(this.containerNode,
"keydown",f.hitch(this,function(a){a.keyCode===q.ESCAPE&&(a.stopPropagation(),this.tabItems[this._currentIndex].focus())})));this.tabItems=[];l.forEach(this.tabs,function(a){this._createTab(a)},this);this.own(c(this.tabTr,"keydown",f.hitch(this,function(a){var b=a.target,d;a.keyCode===q.RIGHT_ARROW?d=b.nextElementSibling?!this.average&&p.hasClass(b.nextElementSibling,"tab-item-td-empty")?this.tabItems[0]:b.nextElementSibling:this.tabItems[0]:a.keyCode===q.LEFT_ARROW?d=b.previousElementSibling?b.previousElementSibling:
this.tabItems[this.tabItems.length-1]:a.keyCode===q.HOME?d=this.tabItems[0]:a.keyCode===q.END&&(d=this.tabItems[this.tabItems.length-1]);d&&(b=d,d.focus())})));this.average?(this.controlTable.style.tableLayout="fixed",p.addClass(this.domNode,"average")):this._addEmptyTab()},startup:function(){this.inherited(arguments);this._started=!0},_createTab:function(a){var b=p.toDom('\x3ctd nowrap class\x3d"tab-item-td"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');b.label=a.title||"";b.title=
a.title;p.place(b,this.tabTr);var d=k(".tab-item-div",b)[0];d.innerHTML=m.sanitizeHTML(b.label);d.label=b.label;a.content.label=b.label;this.viewStack.addView(a.content);this.own(c(b,"click",f.hitch(this,function(b){this._onSelect(a.title,b)})));this.own(c(b,"keydown",f.hitch(this,function(b){b.keyCode!==q.ENTER&&b.keyCode!==q.SPACE||this._onSelect(a.title,b)})));this.tabItems.push(b)},_onSelect:function(a,b){p.hasClass(b.target,"jimu-state-active")||this.selectTab(a)}})})},"jimu/dijit/TileLayoutContainer":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(r,f,l,p){return r([p],{baseClass:"jimu-tile-container",declaredClass:"jimu.dijit.TileLayoutContainer",constructor:function(){this.items=[];this.vmargin=this.hmargin=15},startup:function(){this.inherited(arguments);this.items.forEach(f.hitch(this,function(c){this._placeItem(c)}));this.resize()},_placeItem:function(c){c.domNode?l.place(c.domNode,this.domNode):l.place(c,this.domNode)},addItem:function(c){this.items.push(c);this._placeItem(c);
this.resize()},addItems:function(c){this.items=this.items.concat(c);this.items.forEach(f.hitch(this,function(c){this._placeItem(c)}));this.resize()},removeItem:function(c){var f;for(f=0;f<this.items.length;f++)if(this.items[f].label===c){this.items[f].domNode?this.items[f].destroy():l.destroy(this.items[f]);this.items.splice(f,1);this.resize();break}},empty:function(){var c;for(c=0;c<this.items.length;c++)this.items[c].domNode?this.items[c].destroy():l.destroy(this.items[c]);this.items=[]},resize:function(){var c,
p,n;c=l.getMarginBox(this.domNode);p=this.getItemSize(c);n=Math.floor((c.w+this.hmargin)/(p.width+this.hmargin));this.items.forEach(f.hitch(this,function(c,f){this.setItemPosition(c,f,p,n)}))},getItemSize:function(c){var f={},l;if("fixWidth"===this.strategy)f.width=this.itemSize.width,f.height=this.itemSize.height;else if("breakWidth"===this.strategy)for(l=0;l<this.itemSize.length;l++){if(c.w<=this.itemSize[l].screenWidth){f.width=this.itemSize[l].width;f.height=this.itemSize[l].height;break}}else"fixCols"===
this.strategy&&(f.width=(c.w-this.hmargin*(this.maxCols-1))/this.maxCols,f.height="number"===typeof this.itemSize.height?this.itemSize.height:f.width*parseFloat(this.itemSize.height.substring(0,this.itemSize.height.length-1))/100);return f},setItemPosition:function(c,f,n,k){f++;var h=f%k;f=Math.ceil(f/k);0===h&&(h=k);k={position:"absolute",top:(this.vmargin+n.height)*(f-1)+"px"};k[window.isRTL?"right":"left"]=(this.hmargin+n.width)*(h-1)+"px";0<=n.width&&(k.width=n.width+"px");0<=n.height&&(k.height=
n.height+"px");l.setStyle(c.domNode?c.domNode:c,k)}})})},"jimu/dijit/DrawBox":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/DrawBox.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dijit/a11yclick dojo/query dojo/Evented esri/graphic esri/layers/GraphicsLayer jimu/dijit/Draw esri/symbols/jsonUtils esri/geometry/Polygon".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u){var v={};return r([f,l,p,b],
{templateString:c,baseClass:"jimu-draw-box",declaredClass:"jimu.dijit.DrawBox",nls:null,drawLayer:null,drawLayerId:null,drawToolBar:null,_isDisabled:!1,_shiftKey:!1,_ctrlKey:!1,_metaKey:!1,types:null,geoTypes:null,map:null,pointSymbol:null,polylineSymbol:null,polygonSymbol:null,textSymbol:null,showClear:!1,keepOneGraphic:!1,deactivateAfterDrawing:!0,postMixInProperties:function(){this.nls=window.jimuNls.drawBox},postCreate:function(){this.inherited(arguments);var b={};this.drawLayerId&&(b.id=this.drawLayerId);
this.drawLayer=new a(b);this._initDefaultSymbols();this._initTypes();b=e(".draw-item",this.domNode);b.forEach(function(a){n.setAttr(a,"role","button");n.setAttr(a,"tabindex","0")});this.own(b.on(t,q.hitch(this,this._onItemClick)));n.setAttr(this.btnClear,"role","button");n.setAttr(this.btnClear,"tabindex","0");this.own(h(this.btnClear,t,q.hitch(this,this._onClickClear)));this.own(h(document.body,"keydown",q.hitch(this,function(a){this._shiftKey=!!a.shiftKey;this._ctrlKey=!!a.ctrlKey;this._metaKey=
!!a.metaKey})));this.own(h(document.body,"keyup",q.hitch(this,function(a){this._shiftKey=!!a.shiftKey;this._ctrlKey=!!a.ctrlKey;this._metaKey=!!a.metaKey})));this.map&&this.setMap(this.map);n.setStyle(this.btnClear,"display",!0===this.showClear?"block":"none");this.enable();v[this.id]=this},enable:function(){this._isDisabled=!1;n.addClass(this.domNode,"enabled");n.removeClass(this.domNode,"disabled")},disable:function(){this._isDisabled=!0;n.addClass(this.domNode,"disabled");n.removeClass(this.domNode,
"enabled");this.deactivate()},hideLayer:function(){this.drawLayer&&this.drawLayer.hide()},showLayer:function(){this.drawLayer&&this.drawLayer.show()},isEnabled:function(){return!this._isDisabled},isActive:function(){var a=e(".draw-item.jimu-state-active",this.domNode);return a&&0<a.length},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},destroy:function(){this.deactivate();this.drawLayer&&this.map&&
this.map.removeLayer(this.drawLayer);this.drawLayer=this.map=this.drawToolBar=null;delete v[this.id];this.inherited(arguments)},setMap:function(a){a&&(this.map=a,this.map.addLayer(this.drawLayer),this.drawToolBar=new g(this.map),this.drawToolBar.setMarkerSymbol(this.pointSymbol),this.drawToolBar.setLineSymbol(this.polylineSymbol),this.drawToolBar.setFillSymbol(this.polygonSymbol),this.own(h(this.drawToolBar,"draw-end",q.hitch(this,this._onDrawEnd))))},setPointSymbol:function(a){this.pointSymbol=a;
this.drawToolBar.setMarkerSymbol(this.pointSymbol)},setLineSymbol:function(a){this.polylineSymbol=a;this.drawToolBar.setLineSymbol(a)},setPolygonSymbol:function(a){this.polygonSymbol=a;this.drawToolBar.setFillSymbol(a)},setTextSymbol:function(a){this.textSymbol=a},reset:function(){this.deactivate();this.clear()},clear:function(){this.drawLayer.clear();this.onClear()},deactivate:function(){this.enableWebMapPopup();e(".draw-item",this.domNode).removeClass("jimu-state-active");this.drawToolBar&&(this.drawToolBar.deactivate(),
this.emit("draw-deactivate"))},activate:function(a){var b=null,d=e(".draw-item",this.domNode);"TEXT"===a?(a="POINT",b=this.textIcon):(d=d.filter(function(b){return b.getAttribute("data-geotype")===a}),0<d.length&&(b=d[0]));b&&this._activate(b)},onIconSelected:function(a,b,d){this.emit("icon-selected",a,b,d)},onDrawEnd:function(a,b,d,c,e,f){this.emit("draw-end",a,b,d,c,e,f)},onClear:function(){this.emit("clear")},addGraphic:function(a){this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(a)},
removeGraphic:function(a){this.drawLayer.remove(a)},getFirstGraphic:function(){var a=null;this.drawLayer&&0<this.drawLayer.graphics.length&&(a=this.drawLayer.graphics[0]);return a},show:function(){n.removeClass(this.domNode,"hidden")},hide:function(){n.addClass(this.domNode,"hidden")},getDrawItemIcons:function(){return e(".draw-item",this.domNode)},_onClickClear:function(){this._isDisabled||(this.clear(),this.emit("user-clear"))},_initDefaultSymbols:function(){var a={style:"esriSMSCircle",color:[0,
0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},b={style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},c={style:"esriSFSSolid",color:[79,129,189,128],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};this.pointSymbol||(this.pointSymbol=d.fromJson(a));this.polylineSymbol||(this.polylineSymbol=d.fromJson(b));this.polygonSymbol||(this.polygonSymbol=d.fromJson(c))},_initTypes:function(){this.geoTypes&&
0<this.geoTypes.length?this.types=null:(this.geoTypes=[],this.types&&0<this.types.length||(this.types=["point","arrow","polyline","polygon"]),0<=this.types.indexOf("point")&&(this.geoTypes=this.geoTypes.concat(["POINT"])),0<=this.types.indexOf("arrow")&&(this.geoTypes=this.geoTypes.concat(["ARROW"])),0<=this.types.indexOf("polyline")&&(this.geoTypes=this.geoTypes.concat(["LINE","POLYLINE","FREEHAND_POLYLINE"])),0<=this.types.indexOf("polygon")&&(this.geoTypes=this.geoTypes.concat("TRIANGLE EXTENT CIRCLE ELLIPSE POLYGON FREEHAND_POLYGON".split(" "))),
0<=this.types.indexOf("text")&&(this.geoTypes=this.geoTypes.concat(["TEXT"])));var a=e(".draw-item",this.domNode);a.style("display","none");k.forEach(a,q.hitch(this,function(a){var b=a.getAttribute("data-geotype"),b=0<=k.indexOf(this.geoTypes,b);n.setStyle(a,"display",b?"block":"none")}))},_onItemClick:function(a){this._isDisabled||(a=a.target||a.srcElement,n.hasClass(a,"draw-item")&&(n.hasClass(a,"jimu-state-active")?this.deactivate():this._activate(a)))},_activate:function(a){this._deactiveAllDrawBoxes();
e(".draw-item",this.domNode).removeClass("jimu-state-active");n.addClass(a,"jimu-state-active");var b=a.getAttribute("data-geotype"),d=a.getAttribute("data-commontype"),c=g[b];"TEXT"===b&&(c=g.POINT);this.disableWebMapPopup();this.drawToolBar.activate(c);this.emit("draw-activate",c);this.onIconSelected(a,b,d)},_onDrawEnd:function(a){var b=e(".draw-item.jimu-state-active",this.domNode)[0],d=b.getAttribute("data-geotype"),b=b.getAttribute("data-commontype"),c=null,c="extent"===a.geometry.type?u.fromExtent(a.geometry):
a.geometry;c.geoType=d;c.commonType=b;a=c.type;var f=null,f="point"===a||"multipoint"===a?n.hasClass(this.textIcon,"jimu-state-active")?this.textSymbol:this.pointSymbol:"line"===a||"polyline"===a?this.polylineSymbol:this.polygonSymbol,c=new m(c,f,null,null);this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(c);this.deactivateAfterDrawing&&this.deactivate();this.onDrawEnd(c,d,b,this._shiftKey,this._ctrlKey,this._metaKey)},_deactiveAllDrawBoxes:function(){var a;k.forEach(Object.keys(v),
q.hitch(this,function(b){(a=v[b])&&a.drawToolBar&&b!==this.id&&a.deactivate()}))}})})},"jimu/dijit/Draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/has esri/kernel esri/toolbars/draw esri/graphic esri/geometry/Polyline esri/geometry/Polygon esri/geometry/Multipoint esri/geometry/Rect".split(" "),function(r,f,l,p,c,q,n,k,h,t,e){var b=r([q],{baseClass:"jimu-draw",declaredClass:"jimu.dijit.Draw",_onMouseDragHandler:function(c){if(this._graphic||this._points.length)if(p("esri-touch")&&
!this._points.length)c.preventDefault();else{this._dragged=!0;var a;this.map.snappingManager&&(a=this.map.snappingManager._snappingPoint);var g=this._points[0],d=a||c.mapPoint,m=this.map,k=m.spatialReference;a=this._graphic;var l=b,t=m.toScreen(g),q=m.toScreen(d),r=[],r=q.x-t.x,q=q.y-t.y,y=Math.sqrt(r*r+q*q);switch(this._geometryType){case l.CIRCLE:this._hideTooltip();a.geometry=h.createCircle({center:t,r:y,numberOfPoints:60,map:m});a.setGeometry(a.geometry);break;case l.ELLIPSE:this._hideTooltip();
a.geometry=h.createEllipse({center:t,longAxis:r,shortAxis:q,numberOfPoints:60,map:m});a.setGeometry(a.geometry);break;case l.TRIANGLE:this._hideTooltip();r=[[0,-y],[.8660254037844386*y,.5*y],[-.8660254037844386*y,.5*y],[0,-y]];a.geometry=this._toPolygon(r,t.x,t.y);a.setGeometry(a.geometry);break;case l.ARROW:this._hideTooltip();g=q/y;m=r/y;d=.25*m*y;k=.25*y/(q/r);y*=.25*g;l=this.fillSymbol?this.fillSymbol.arrowWidth:12;r=[[r,q],[r-d*(1+l/k),q+l*m-y],[r-d*(1+l/2/k),q+l/2*m-y],[-l/2*g,l/2*m],[l/2*g,
-l/2*m],[r-d*(1-l/2/k),q-l/2*m-y],[r-d*(1-l/k),q-l*m-y],[r,q]];a.geometry=this._toPolygon(r,t.x,t.y);a.setGeometry(a.geometry);break;case l.LEFT_ARROW:this._hideTooltip();r=0>=r?[[r,0],[.75*r,q],[.75*r,.5*q],[0,.5*q],[0,-.5*q],[.75*r,-.5*q],[.75*r,-q],[r,0]]:[[0,0],[.25*r,q],[.25*r,.5*q],[r,.5*q],[r,-.5*q],[.25*r,-.5*q],[.25*r,-q],[0,0]];a.geometry=this._toPolygon(r,t.x,t.y);a.setGeometry(a.geometry);break;case l.RIGHT_ARROW:this._hideTooltip();r=0<=r?[[r,0],[.75*r,q],[.75*r,.5*q],[0,.5*q],[0,-.5*
q],[.75*r,-.5*q],[.75*r,-q],[r,0]]:[[0,0],[.25*r,q],[.25*r,.5*q],[r,.5*q],[r,-.5*q],[.25*r,-.5*q],[.25*r,-q],[0,0]];a.geometry=this._toPolygon(r,t.x,t.y);a.setGeometry(a.geometry);break;case l.UP_ARROW:this._hideTooltip();r=0>=q?[[0,q],[-r,.75*q],[-.5*r,.75*q],[-.5*r,0],[.5*r,0],[.5*r,.75*q],[r,.75*q],[0,q]]:[[0,0],[-r,.25*q],[-.5*r,.25*q],[-.5*r,q],[.5*r,q],[.5*r,.25*q],[r,.25*q],[0,0]];a.geometry=this._toPolygon(r,t.x,t.y);a.setGeometry(a.geometry);break;case l.DOWN_ARROW:this._hideTooltip();r=
0<=q?[[0,q],[-r,.75*q],[-.5*r,.75*q],[-.5*r,0],[.5*r,0],[.5*r,.75*q],[r,.75*q],[0,q]]:[[0,0],[-r,.25*q],[-.5*r,.25*q],[-.5*r,q],[.5*r,q],[.5*r,.25*q],[r,.25*q],[0,0]];a.geometry=this._toPolygon(r,t.x,t.y);a.setGeometry(a.geometry);break;case l.RECTANGLE:this._hideTooltip();r=[[0,0],[r,0],[r,q],[0,q],[0,0]];a.geometry=this._toPolygon(r,t.x,t.y);a.setGeometry(a.geometry);break;case l.LINE:a.setGeometry(f.mixin(a.geometry,{paths:[[[g.x,g.y],[d.x,d.y]]]}));break;case l.EXTENT:a&&m.graphics.remove(a,!0);
a=new e(this._normalizeRect(g,d,k));a._originOnly=!0;this._graphic=m.graphics.add(new n(a,this.fillSymbol),!0);m.snappingManager&&m.snappingManager._setGraphic(this._graphic);break;case l.FREEHAND_POLYLINE:this._hideTooltip();if(!1===this._canDrawFreehandPoint(c)){p("esri-touch")&&c.preventDefault();return}this._points.push(c.mapPoint.offset(0,0));a.geometry._insertPoints([d.offset(0,0)],0);a.setGeometry(a.geometry);break;case l.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(c)){p("esri-touch")&&
c.preventDefault();return}this._points.push(c.mapPoint.offset(0,0));a.geometry._insertPoints([d.offset(0,0)],0);a.setGeometry(a.geometry)}p("esri-touch")&&c.preventDefault()}},_onClickHandler:function(c){var a;this.map.snappingManager&&(a=this.map.snappingManager._snappingPoint);var e=a||c.mapPoint;c=this.map;a=c.toScreen(e);var d=b;this._points.push(e.offset(0,0));switch(this._geometryType){case d.POINT:this.onDrawStart();this._drawEnd(e.offset(0,0));this._setTooltipMessage(0);break;case d.POLYLINE:1===
this._points.length?(a=new k(c.spatialReference),a.addPath(this._points),this._graphic=c.graphics.add(new n(a,this.lineSymbol),!0),c.snappingManager&&c.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=l.connect(c,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry._insertPoints([e.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol));break;case d.POLYGON:1===this._points.length?(a=new h(c.spatialReference),
a.addRing(this._points),this._graphic=c.graphics.add(new n(a,this.fillSymbol),!0),c.snappingManager&&c.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=l.connect(c,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry._insertPoints([e.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol));break;case d.MULTI_POINT:a=this._points;1===a.length?(e=new t(c.spatialReference),e.addPoint(a[a.length-1]),this._graphic=
c.graphics.add(new n(e,this.markerSymbol),!0),c.snappingManager&&c.snappingManager._setGraphic(this._graphic),this.onDrawStart()):(this._graphic.geometry.addPoint(a[a.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case d.ARROW:c=this.fillSymbol?this.fillSymbol.arrowWidth:12;this._addShape([[0,0],[-c,c],[-c,c/2],[-96,c/2],[-96,-c/2],[-c,-c/2],[-c,-c],[0,0]],a.x,a.y);break;case d.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,
-12],[24,-24],[0,0]],a.x,a.y);break;case d.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],a.x,a.y);break;case d.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],a.x,a.y);break;case d.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],a.x,a.y);break;case d.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],a.x,a.y);break;case d.RECTANGLE:this._addShape([[0,
-96],[96,-96],[96,0],[0,0],[0,-96]],a.x-48,a.y+48);break;case d.CIRCLE:this._clear();this.onDrawStart();this._drawEnd(h.createCircle({center:a,r:48,numberOfPoints:60,map:c}));break;case d.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(h.createEllipse({center:a,longAxis:48,shortAxis:24,numberOfPoints:60,map:c}))}this._setTooltipMessage(this._points.length)}});f.mixin(b,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",
FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});p("extend-esri")&&f.setObject("toolbars.Draw",b,c);return b})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C,D,y,w,A,G){var E=r(g,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(a,b){this.markerSymbol=new d(d.STYLE_SOLID,10,new u(u.STYLE_SOLID,new c([255,0,0]),2),new c([0,0,0,.25]));this.lineSymbol=new u(u.STYLE_SOLID,new c([255,0,0]),2);this.fillSymbol=new v(v.STYLE_SOLID,new u(u.STYLE_SOLID,new c([255,0,0]),2),new c([0,0,0,.25]));this._points=[];this._mouse=!n("esri-touch")&&!n("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=f.mixin(f.mixin({},this._defaultOptions),b||{});if(k("ios")||k("android"))this._options.showTooltips=!1;this._onKeyDownHandler=f.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=f.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=f.hitch(this,this._onMouseUpHandler);this._onClickHandler=f.hitch(this,this._onClickHandler);this._onMouseMoveHandler=f.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=f.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=f.hitch(this,this._onDblClickHandler);this._updateTooltip=f.hitch(this,this._updateTooltip);this._hideTooltip=f.hitch(this,this._hideTooltip);this._redrawGraphic=f.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(a){this.respectDrawingVertexOrder=a},setMarkerSymbol:function(a){this.markerSymbol=a},setLineSymbol:function(a){this.lineSymbol=a},
setFillSymbol:function(a){this.fillSymbol=a},activate:function(a,b){this._geometryType&&this.deactivate();var d=this.map,c=p.connect,e=E;this._options=f.mixin(f.mixin({},this._options),b||{});d.navigationManager.setImmediateClick(!1);switch(a){case e.ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.UP_ARROW:case e.DOWN_ARROW:case e.TRIANGLE:case e.CIRCLE:case e.ELLIPSE:case e.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=c(d,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=c(d,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=c(d,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=c(d,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=c(d,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=c(d,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=c(d,"onMouseDragEnd",this._onMouseUpHandler));n("esri-touch")&&(this._onMouseDownHandler2_connect=
c(d,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=c(d,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=c(d,"onSwipeEnd",this._onMouseUpHandler));break;case e.POINT:this._onClickHandler_connect=c(d,"onClick",this._onClickHandler);break;case e.LINE:case e.EXTENT:case e.FREEHAND_POLYLINE:case e.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=c(d,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=
c(d,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=c(d,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=c(d,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=c(d,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=c(d,"onMouseDragEnd",this._onMouseUpHandler));n("esri-touch")&&(this._onMouseDownHandler2_connect=c(d,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=c(d,"onSwipeMove",
this._onMouseDragHandler),this._onMouseUpHandler2_connect=c(d,"onSwipeEnd",this._onMouseUpHandler));break;case e.POLYLINE:case e.POLYGON:case e.MULTI_POINT:d.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=c(d,"onClick",this._onClickHandler);this._onDblClickHandler_connect=c(d,"onDblClick",this._onDblClickHandler);this._dblClickZoom=d.isDoubleClickZoom;d.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+a);return}this._onKeyDown_connect=c(d,"onKeyDown",
this._onKeyDownHandler);this._redrawConnect=c(d,"onExtentChange",this._redrawGraphic);this._geometryType=a;this._toggleTooltip(!0);d.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(d.snappingManager._startSelectionLayerQuery(),d.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var a=this.map;this._clear();var b=p.disconnect;b(this._onMouseMoveHandler_connect);b(this._onMouseDownHandler_connect);b(this._onMouseDragHandler_connect);
b(this._onMouseUpHandler_connect);b(this._onMouseDownHandler2_connect);b(this._onMouseDragHandler2_connect);b(this._onMouseUpHandler2_connect);b(this._onClickHandler_connect);b(this._onDblClickHandler_connect);b(this._onKeyDown_connect);b(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=this._onMouseUpHandler2_connect=this._onClickHandler_connect=
this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;a.snappingManager&&(a.snappingManager._stopSelectionLayerQuery(),a.snappingManager._killOffSnapping());switch(this._geometryType){case E.CIRCLE:case E.ELLIPSE:case E.TRIANGLE:case E.ARROW:case E.LEFT_ARROW:case E.RIGHT_ARROW:case E.UP_ARROW:case E.DOWN_ARROW:case E.RECTANGLE:case E.LINE:case E.EXTENT:case E.FREEHAND_POLYLINE:case E.FREEHAND_POLYGON:this._activateMapTools(!0,!1,!1,!0);break;case E.POLYLINE:case E.POLYGON:case E.MULTI_POINT:this._dblClickZoom&&
a.enableDoubleClickZoom()}b=this._geometryType;this._geometryType=null;a.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(b)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._graphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},finishDrawing:function(){var a,b=this._points,d=this.map.spatialReference,c=E,b=b.slice(0,b.length);switch(this._geometryType){case c.POLYLINE:if(!this._graphic||
2>b.length)return;a=new D(d);a.addPath([].concat(b));break;case c.POLYGON:if(!this._graphic||3>b.length)return;a=new y(d);b=[].concat(b,[b[0].offset(0,0)]);y.prototype.isClockwise(b)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),b.reverse());a.addRing(b);break;case c.MULTI_POINT:a=new w(d),l.forEach(b,function(b){a.addPoint(b)})}p.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);
this._drawEnd(a)},_drawEnd:function(a){if(a){var b=this.map.spatialReference,d;this.onDrawEnd(a);b&&(b.isWebMercator()?d=C.webMercatorToGeographic(a,!0):4326===b.wkid&&(d=z.fromJson(a.toJson())));this.onDrawComplete({geometry:a,geographicGeometry:d})}},_normalizeRect:function(a,b,d){var c=a.x;a=a.y;var e=b.x;b=b.y;return{x:Math.min(c,e),y:Math.max(a,b),width:Math.abs(c-e),height:Math.abs(a-b),spatialReference:d}},_onMouseDownHandler:function(a){this._dragged=!1;var b;this.map.snappingManager&&(b=
this.map.snappingManager._snappingPoint);var d=b||a.mapPoint,c=E;b=this.map;var e=b.spatialReference;this._points.push(d.offset(0,0));switch(this._geometryType){case c.LINE:this._graphic=b.graphics.add(new B(new D({paths:[[[d.x,d.y],[d.x,d.y]]],spatialReference:e}),this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);break;case c.FREEHAND_POLYLINE:this._oldPoint=a.screenPoint;d=new D(e);d.addPath(this._points);this._graphic=b.graphics.add(new B(d,this.lineSymbol),!0);
b.snappingManager&&b.snappingManager._setGraphic(this._graphic);break;case c.CIRCLE:case c.ELLIPSE:case c.TRIANGLE:case c.ARROW:case c.LEFT_ARROW:case c.RIGHT_ARROW:case c.UP_ARROW:case c.DOWN_ARROW:case c.RECTANGLE:case c.FREEHAND_POLYGON:this._oldPoint=a.screenPoint,d=new y(e),d.addRing(this._points),this._graphic=b.graphics.add(new B(d,this.fillSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)}n("esri-touch")&&a.preventDefault();if(1===this._points.length)this.onDrawStart()},
_onMouseMoveHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);a=b||a.mapPoint;b=this._graphic.geometry;switch(this._geometryType){case E.POLYLINE:case E.POLYGON:var d=this._points.length,c=!!b.getPoint(0,d);a=a.offset(0,0);c?b.setPoint(0,d,a):b.insertPoint(0,d,a);this._graphic.setGeometry(b)}},_onMouseDragHandler:function(a){if(this._graphic||this._points.length)if(n("esri-touch")&&!this._points.length)a.preventDefault();else{this._dragged=!0;var b;this.map.snappingManager&&
(b=this.map.snappingManager._snappingPoint);var d=this._points[0],c=b||a.mapPoint,e=this.map,g=e.spatialReference;b=this._graphic;var h=E,m=e.toScreen(d),k=e.toScreen(c),l=[],l=k.x-m.x,k=k.y-m.y,u=Math.sqrt(l*l+k*k);switch(this._geometryType){case h.CIRCLE:this._hideTooltip();b.geometry=y.createCircle({center:m,r:u,numberOfPoints:60,map:e});b.setGeometry(b.geometry);break;case h.ELLIPSE:this._hideTooltip();b.geometry=y.createEllipse({center:m,longAxis:l,shortAxis:k,numberOfPoints:60,map:e});b.setGeometry(b.geometry);
break;case h.TRIANGLE:this._hideTooltip();l=[[0,-u],[.8660254037844386*u,.5*u],[-.8660254037844386*u,.5*u],[0,-u]];b.geometry=this._toPolygon(l,m.x,m.y);b.setGeometry(b.geometry);break;case h.ARROW:this._hideTooltip();d=k/u;e=l/u;c=.25*e*u;g=.25*u/(k/l);u*=.25*d;l=[[l,k],[l-c*(1+24/g),k+24*e-u],[l-c*(1+12/g),k+12*e-u],[-12*d,12*e],[12*d,-12*e],[l-c*(1-12/g),k-12*e-u],[l-c*(1-24/g),k-24*e-u],[l,k]];b.geometry=this._toPolygon(l,m.x,m.y);b.setGeometry(b.geometry);break;case h.LEFT_ARROW:this._hideTooltip();
l=0>=l?[[l,0],[.75*l,k],[.75*l,.5*k],[0,.5*k],[0,-.5*k],[.75*l,-.5*k],[.75*l,-k],[l,0]]:[[0,0],[.25*l,k],[.25*l,.5*k],[l,.5*k],[l,-.5*k],[.25*l,-.5*k],[.25*l,-k],[0,0]];b.geometry=this._toPolygon(l,m.x,m.y);b.setGeometry(b.geometry);break;case h.RIGHT_ARROW:this._hideTooltip();l=0<=l?[[l,0],[.75*l,k],[.75*l,.5*k],[0,.5*k],[0,-.5*k],[.75*l,-.5*k],[.75*l,-k],[l,0]]:[[0,0],[.25*l,k],[.25*l,.5*k],[l,.5*k],[l,-.5*k],[.25*l,-.5*k],[.25*l,-k],[0,0]];b.geometry=this._toPolygon(l,m.x,m.y);b.setGeometry(b.geometry);
break;case h.UP_ARROW:this._hideTooltip();l=0>=k?[[0,k],[-l,.75*k],[-.5*l,.75*k],[-.5*l,0],[.5*l,0],[.5*l,.75*k],[l,.75*k],[0,k]]:[[0,0],[-l,.25*k],[-.5*l,.25*k],[-.5*l,k],[.5*l,k],[.5*l,.25*k],[l,.25*k],[0,0]];b.geometry=this._toPolygon(l,m.x,m.y);b.setGeometry(b.geometry);break;case h.DOWN_ARROW:this._hideTooltip();l=0<=k?[[0,k],[-l,.75*k],[-.5*l,.75*k],[-.5*l,0],[.5*l,0],[.5*l,.75*k],[l,.75*k],[0,k]]:[[0,0],[-l,.25*k],[-.5*l,.25*k],[-.5*l,k],[.5*l,k],[.5*l,.25*k],[l,.25*k],[0,0]];b.geometry=this._toPolygon(l,
m.x,m.y);b.setGeometry(b.geometry);break;case h.RECTANGLE:this._hideTooltip();l=[[0,0],[l,0],[l,k],[0,k],[0,0]];b.geometry=this._toPolygon(l,m.x,m.y);b.setGeometry(b.geometry);break;case h.LINE:b.setGeometry(f.mixin(b.geometry,{paths:[[[d.x,d.y],[c.x,c.y]]]}));break;case h.EXTENT:b&&e.graphics.remove(b,!0);b=new A(this._normalizeRect(d,c,g));b._originOnly=!0;this._graphic=e.graphics.add(new B(b,this.fillSymbol),!0);e.snappingManager&&e.snappingManager._setGraphic(this._graphic);break;case h.FREEHAND_POLYLINE:this._hideTooltip();
if(!1===this._canDrawFreehandPoint(a)){n("esri-touch")&&a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([c.offset(0,0)],0);b.setGeometry(b.geometry);break;case h.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){n("esri-touch")&&a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([c.offset(0,0)],0);b.setGeometry(b.geometry)}n("esri-touch")&&a.preventDefault()}},_canDrawFreehandPoint:function(a){if(!this._oldPoint)return!1;
var b=this._oldPoint.x-a.screenPoint.x,d=this._oldPoint.y-a.screenPoint.y,c=this._options.tolerance;if((0>b?-1*b:b)<c&&(0>d?-1*d:d)<c)return!1;b=new Date;if(b-this._startTime<this._options.drawTime)return!1;this._startTime=b;this._oldPoint=a.screenPoint;return!0},_onMouseUpHandler:function(a){if(this._dragged&&this._graphic){0===this._points.length&&this._points.push(a.mapPoint.offset(0,0));var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var d=this._points[0];b=b||a.mapPoint;
var c=this.map.spatialReference,e=E,f;switch(this._geometryType){case e.CIRCLE:case e.ELLIPSE:case e.TRIANGLE:case e.ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.UP_ARROW:case e.DOWN_ARROW:case e.RECTANGLE:f=this._graphic.geometry;break;case e.LINE:f=new D({paths:[[[d.x,d.y],[b.x,b.y]]],spatialReference:c});break;case e.EXTENT:f=(new A(this._normalizeRect(d,b,c))).getExtent();break;case e.FREEHAND_POLYLINE:f=new D(c);f.addPath([].concat(this._points,[b.offset(0,0)]));break;case e.FREEHAND_POLYGON:f=
new y(c),d=[].concat(this._points,[b.offset(0,0),this._points[0].offset(0,0)]),y.prototype.isClockwise(d)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),d.reverse()),f.addRing(d)}n("esri-touch")&&a.preventDefault();this._clear();this._drawEnd(f)}else this._clear()},_onClickHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);b=b||a.mapPoint;a=this.map;
var d=a.toScreen(b),c=E;this._points.push(b.offset(0,0));switch(this._geometryType){case c.POINT:this.onDrawStart();this._drawEnd(b.offset(0,0));this._setTooltipMessage(0);break;case c.POLYLINE:1===this._points.length?(b=new D(a.spatialReference),b.addPath(this._points),this._graphic=a.graphics.add(new B(b,this.lineSymbol),!0),a.snappingManager&&a.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=p.connect(a,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry._insertPoints([b.offset(0,
0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol));break;case c.POLYGON:1===this._points.length?(b=new y(a.spatialReference),b.addRing(this._points),this._graphic=a.graphics.add(new B(b,this.fillSymbol),!0),a.snappingManager&&a.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=p.connect(a,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry._insertPoints([b.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol));
break;case c.MULTI_POINT:b=this._points;1===b.length?(d=new w(a.spatialReference),d.addPoint(b[b.length-1]),this._graphic=a.graphics.add(new B(d,this.markerSymbol),!0),a.snappingManager&&a.snappingManager._setGraphic(this._graphic),this.onDrawStart()):(this._graphic.geometry.addPoint(b[b.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case c.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],d.x,d.y);break;case c.LEFT_ARROW:this._addShape([[0,
0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],d.x,d.y);break;case c.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],d.x,d.y);break;case c.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],d.x,d.y);break;case c.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],d.x,d.y);break;case c.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,
24],[0,-48]],d.x,d.y);break;case c.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],d.x-48,d.y+48);break;case c.CIRCLE:this._clear();this.onDrawStart();this._drawEnd(y.createCircle({center:d,r:48,numberOfPoints:60,map:a}));break;case c.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(y.createEllipse({center:d,longAxis:48,shortAxis:24,numberOfPoints:60,map:a}))}this._setTooltipMessage(this._points.length)},_addShape:function(a,b,d){this._setTooltipMessage(0);this._clear();this.onDrawStart();
this._drawEnd(this._toPolygon(a,b,d))},_toPolygon:function(a,b,d){var c=this.map,e=new y(c.spatialReference);e.addRing(l.map(a,function(a){return c.toMap({x:a[0]+b,y:a[1]+d})}));return e},_onDblClickHandler:function(a){var b,d=this._points,c=this.map.spatialReference,e=E;n("esri-touch")&&d.push(a.mapPoint);var f=d[d.length-1],g=d[d.length-2],d=f&&g&&f.x===g.x&&f.y===g.y?d.slice(0,d.length-1):d.slice(0,d.length);switch(this._geometryType){case e.POLYLINE:if(!this._graphic||2>d.length){p.disconnect(this._onMouseMoveHandler_connect);
this._clear();this._onClickHandler(a);return}b=new D(c);b.addPath([].concat(d));break;case e.POLYGON:if(!this._graphic||2>d.length){p.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new y(c);a=[].concat(d,[d[0].offset(0,0)]);y.prototype.isClockwise(a)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),a.reverse());b.addRing(a);break;case e.MULTI_POINT:b=new w(c),
l.forEach(d,function(a){b.addPoint(a)})}p.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(b)},_onKeyDownHandler:function(a){a.keyCode===h.ESCAPE&&(p.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(a){this._options.showTooltips&&(a?this._tooltip||(this._tooltip=t.create("div",{"class":"esriMapTooltip"},this.map.container),b.isBodyLtr()||e.set(this._tooltip,"direction","rtl"),this._tooltip.style.display=
"none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=p.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=p.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=p.connect(this.map,"onMouseMove",this._updateTooltip)):this._tooltip&&(p.disconnect(this._onTooltipMouseEnterHandler_connect),p.disconnect(this._onTooltipMouseLeaveHandler_connect),p.disconnect(this._onTooltipMouseMoveHandler_connect),
t.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var a=this._tooltip;a&&(a.style.display="none")},_setTooltipMessage:function(a){var b=this._tooltip;if(b){var d="";switch(this._geometryType){case E.POINT:d=G.toolbars.draw.addPoint;break;case E.ARROW:case E.LEFT_ARROW:case E.RIGHT_ARROW:case E.UP_ARROW:case E.DOWN_ARROW:case E.TRIANGLE:case E.RECTANGLE:case E.CIRCLE:case E.ELLIPSE:d=G.toolbars.draw.addShape;break;case E.LINE:case E.EXTENT:case E.FREEHAND_POLYLINE:case E.FREEHAND_POLYGON:d=
G.toolbars.draw.freehand;break;case E.POLYLINE:case E.POLYGON:d=G.toolbars.draw.start;1===a?d=G.toolbars.draw.resume:2<=a&&(d=G.toolbars.draw.complete);break;case E.MULTI_POINT:d=G.toolbars.draw.addMultipoint,1<=a&&(d=G.toolbars.draw.finish)}b.innerHTML=d}},_updateTooltip:function(a){var b=this._tooltip;if(b){var d;a.clientX||a.pageY?(d=a.clientX,a=a.clientY):(d=a.clientX+q.body().scrollLeft-q.body().clientLeft,a=a.clientY+q.body().scrollTop-q.body().clientTop);b.style.display="none";e.set(b,{left:d+
this._options.tooltipOffset+"px",top:a+"px"});b.style.display=""}},_redrawGraphic:function(a,b,d,c){(d||this.map.wrapAround180)&&(a=this._graphic)&&a.setGeometry(a.geometry)},onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawStart:function(){},onDrawEnd:function(){}});f.mixin(E,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",
LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});n("extend-esri")&&f.setObject("toolbars.Draw",E,m);return E})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(r,f,l,p,c){r=r([c],{declaredClass:"esri.toolbars._Toolbar",constructor:function(c){this.map=c},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",
box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(c,f,k,h){var l=this.map;c&&(this._mapNavState={isDoubleClickZoom:l.isDoubleClickZoom,isClickRecenter:l.isClickRecenter,isPan:l.isPan,isRubberBandZoom:l.isRubberBandZoom,isKeyboardNavigation:l.isKeyboardNavigation,isScrollWheelZoom:l.isScrollWheelZoom},l.disableDoubleClickZoom(),l.disableClickRecenter(),l.disablePan(),l.disableRubberBandZoom(),
l.disableKeyboardNavigation());f&&l.hideZoomSlider();k&&l.hidePanArrows();h&&l.graphics.disableMouseEvents()},_activateMapTools:function(c,f,k,h){var l=this.map,e=this._mapNavState;c&&e&&(e.isDoubleClickZoom&&l.enableDoubleClickZoom(),e.isClickRecenter&&l.enableClickRecenter(),e.isPan&&l.enablePan(),e.isRubberBandZoom&&l.enableRubberBandZoom(),e.isKeyboardNavigation&&l.enableKeyboardNavigation(),e.isScrollWheelZoom&&l.enableScrollWheelZoom());f&&l.showZoomSlider();k&&l.showPanArrows();h&&l.graphics.enableMouseEvents()},
_deactivateScrollWheel:function(){var c=this.map;this._scrollWheelState={isScrollWheelZoom:c.isScrollWheelZoom,isScrollWheelPan:c.isScrollWheelPan};c.disableScrollWheelZoom();c.disableScrollWheelPan()},_activateScrollWheel:function(){var c=this.map,f=this._scrollWheelState;f&&(f.isScrollWheelZoom&&c.enableScrollWheelZoom(),f.isScrollWheelPan&&c.enableScrollWheelPan())}});l("extend-esri")&&f.setObject("toolbars._Toolbar",r,p);return r})},"jimu/dijit/URLInput":function(){define(["dojo/_base/declare",
"dojo/_base/html","dijit/form/ValidationTextBox","dojox/validate/regexp"],function(r,f,l,p){return r([l],{declaredClass:"jimu.dijit.URLInput",required:!0,invalidMessage:"Invalid url.",trim:!0,rest:!0,allowNamed:!0,allowLocal:!0,postMixInProperties:function(){this.inherited(arguments);this.invalidMessage=(this.nls=window.jimuNls.urlInput)?this.nls.invalidUrl:"Invalid Url"},postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-url-input")},validator:function(c){if(!1===this.required&&
""===c)return!0;if(isFinite(c))return!1;var f="^"+p.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal}),f=new RegExp(f,"g");f.lastIndex=0;f=f.test(c);return this.rest?(c=/\/rest\/services/gi.test(c),f&&c):f}})})},"dojox/validate/regexp":function(){define(["dojo/_base/lang","dojo/regexp","dojox/main"],function(r,f,l){var p=r.getObject("validate.regexp",!0,l);return p=l.validate.regexp={ipAddress:function(c){c="object"==typeof c?c:{};"boolean"!=typeof c.allowDottedDecimal&&(c.allowDottedDecimal=
!0);"boolean"!=typeof c.allowDottedHex&&(c.allowDottedHex=!0);"boolean"!=typeof c.allowDottedOctal&&(c.allowDottedOctal=!0);"boolean"!=typeof c.allowDecimal&&(c.allowDecimal=!0);"boolean"!=typeof c.allowHex&&(c.allowHex=!0);"boolean"!=typeof c.allowIPv6&&(c.allowIPv6=!0);"boolean"!=typeof c.allowHybrid&&(c.allowHybrid=!0);var f=[];c.allowDottedDecimal&&f.push("((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");c.allowDottedHex&&f.push("(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]");
c.allowDottedOctal&&f.push("(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]");c.allowDecimal&&f.push("(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])");c.allowHex&&f.push("0[xX]0*[\\da-fA-F]{1,8}");c.allowIPv6&&f.push("([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}");c.allowHybrid&&f.push("([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
c="";0<f.length&&(c="("+f.join("|")+")");return c},host:function(c){c="object"==typeof c?c:{};"boolean"!=typeof c.allowIP&&(c.allowIP=!0);"boolean"!=typeof c.allowLocal&&(c.allowLocal=!1);"boolean"!=typeof c.allowPort&&(c.allowPort=!0);"boolean"!=typeof c.allowNamed&&(c.allowNamed=!1);var f=c.allowPort?"(\\:\\d+)?":"",l="((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.?)";c.allowIP&&(l+="|"+p.ipAddress(c));c.allowLocal&&(l+="|localhost");
c.allowNamed&&(l+="|^[^-][a-zA-Z0-9_-]*");return"("+l+")"+f},url:function(c){c="object"==typeof c?c:{};"scheme"in c||(c.scheme=[!0,!1]);return f.buildGroupRE(c.scheme,function(c){return c?"(https?|ftps?)\\://":""})+p.host(c)+"(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?"},emailAddress:function(c){c="object"==typeof c?c:{};"boolean"!=typeof c.allowCruft&&(c.allowCruft=!1);c.allowPort=!1;var f="([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@"+p.host(c);
c.allowCruft&&(f="\x3c?(mailto\\:)?"+f+"\x3e?");return f},emailAddressList:function(c){c="object"==typeof c?c:{};"string"!=typeof c.listSeparator&&(c.listSeparator="\\s;,");var f=p.emailAddress(c);return"("+f+"\\s*["+c.listSeparator+"]\\s*)*"+f+"\\s*["+c.listSeparator+"]?\\s*"},numberFormat:function(c){c="object"==typeof c?c:{};"undefined"==typeof c.format&&(c.format="###-###-####");return f.buildGroupRE(c.format,function(c){return f.escapeString(c,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d")})},
ca:{postalCode:function(){return"([A-Z][0-9][A-Z] [0-9][A-Z][0-9])"},province:function(){return"(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)"}},us:{state:function(c){c="object"==typeof c?c:{};"boolean"!=typeof c.allowTerritories&&(c.allowTerritories=!0);"boolean"!=typeof c.allowMilitary&&(c.allowMilitary=!0);var f="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";c.allowTerritories&&(f+="|AS|FM|GU|MH|MP|PW|PR|VI");
c.allowMilitary&&(f+="|AA|AE|AP");return"("+f+")"}}}})},"jimu/dijit/ColorPalette":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dojo/query jimu/dijit/ColorChooser jimu/dijit/CustomColorPicker jimu/dijit/ColorRecords dijit/popup jimu/utils dijit/a11yclick".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d){return f([l,c,p,r],{templateString:"\x3cdiv\x3e\x3c/div\x3e",
baseClass:"jimu-color-palette",declaredClass:"jimu.dijit.ColorPalette",_TRANSPARENT_STR:"rgba(0, 0, 0, 0)",value:"",_defaultAppearance:{showTransparent:!0,showColorPalette:!0,showCoustom:!0,showColorPickerOK:!1,showColorPickerApply:!0,showCoustomRecord:!0,closeDialogWhenChange:!1},recordUID:"",postMixInProperties:function(){this.nls=window.jimuNls.colorPalette},postCreate:function(){this.inherited(arguments);this.value=this.value?new h(this.value):new h("#fff");this._createContent()},initUI:function(){this._toggleCustomColorPicker("init",
!1)},_createContent:function(){this.appearance=q.mixin(this._defaultAppearance,this.appearance);var a=n.create("div",{"class":"jimu-colorpalette"},this.domNode);this.initPanel=n.create("div",{"class":"init-panel"},a);this.customPanel=n.create("div",{"class":"custom-panel hide"},a);this.appearance.showTransparent&&this._createSpecialColors(this.initPanel);this.appearance.showColorPalette&&this._createColorChooser(this.initPanel);this.appearance.showCoustom&&this._createCustomColorPicker(this.initPanel);
this.appearance.showCoustom&&this.appearance.showCoustomRecord&&this._createCoustomRecord(this.initPanel)},setColor:function(a){this._isColorEqual(a)||(this.value=new h(a),this._setSpatialColor(this.value),"undefined"!==typeof this.value.a&&0===this.value.a?(this.colorChooser.setColor(new h("transparent"),!1),this.picker.setColor(new h("#fff"),!1)):(this.colorChooser.setColor(this.value.toHex(),!1),this.picker.setColor(this.value,!1)),this.colorRecords&&this.colorRecords.selecteColor(this.value))},
getColor:function(){return this.value},changeColor:function(a){if("undefined"!==typeof this.value.a&&0===this.value.a)this.onChange(this.value);else this.onChange(this.value.toHex());this.emit("change",this.value);!0===this.appearance.closeDialogWhenChange&&!1!==a&&this._closeDialog()},refreshRecords:function(){this.colorRecords&&this.colorRecords.refresh()},destroy:function(){a.close(this.tooltipDialog);this.picker.destroy();this.inherited(arguments)},_createSpecialColors:function(a){a=n.create("div",
{"class":"special-color"},a);this.transparentBtn=n.create("div",{"class":"transparent btn",innerHTML:'\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"transparent icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"transparent text jimu-float-leading"\x3e'+this.nls.transparent+"\x3c/div\x3e\x3c/div\x3e"},a);this.own(k(this.transparentBtn,d,q.hitch(this,this._onTransparentClick)))},_onTransparentClick:function(){this.setColor(new h("transparent"));this.changeColor()},_setSpatialColor:function(a){if(this.transparentBtn){var b=
t(".btn-wapper",this.transparentBtn)[0];n.removeClass(b,"selected");a&&a.toString&&a.toString()===this._TRANSPARENT_STR&&n.addClass(b,"selected")}},_createColorChooser:function(a){this.colorChooser=new e({});this.colorChooser.placeAt(a);this.own(k(this.colorChooser,"change",q.hitch(this,function(a){a=new h(a);this.setColor(a);this.changeColor()})))},_createCustomColorPicker:function(){this.coustomtBtn=n.create("div",{"class":"coustom btn",innerHTML:'\x3cdiv class\x3d"btn-wapper"\x3e\x3cdiv class\x3d"custom icon jimu-float-leading"\x3e\x3c/div\x3e\x3cdiv class\x3d"custom text jimu-float-leading"\x3e'+
this.nls.custom+"\x3c/div\x3e\x3c/div\x3e"},this.initPanel);this.own(k(this.coustomtBtn,"click",q.hitch(this,function(){this._toggleCustomColorPicker("custom")})));this.picker=new b({showOk:this.appearance.showColorPickerOK,showApply:this.appearance.showColorPickerApply,value:this.value.toHex()});this.picker.placeAt(this.customPanel);this.picker.setColor(this.value);this.own(k(this.picker,"ok",q.hitch(this,function(a){this.setColor(new h(a));this.changeColor();this._addAColorRecord(a);this._toggleCustomColorPicker("init");
this._closeDialog()})));this.own(k(this.picker,"apply",q.hitch(this,function(a){this.setColor(new h(a));this.changeColor(!1);this._addAColorRecord(a)})));this.own(k(this.picker,"cancel",q.hitch(this,function(){this._toggleCustomColorPicker("init");this._closeDialog()})))},_toggleCustomColorPicker:function(a,b){"custom"===a?(n.removeClass(this.customPanel,"hide"),n.addClass(this.initPanel,"hide")):(n.addClass(this.customPanel,"hide"),n.removeClass(this.initPanel,"hide"));"undefined"!==typeof b&&!1===
b||this.emit("change-style")},_createCoustomRecord:function(a){this.colorRecords=new m({recordsLength:10,uid:this.recordUID||""});this.colorRecords.placeAt(a);this.own(k(this.colorRecords,"choose",q.hitch(this,function(a){this.setColor(new h(a));this.changeColor()})))},_addAColorRecord:function(a){this.colorRecords&&this.colorRecords.push&&this.colorRecords.push(a)},_isColorEqual:function(a){return this.value.toString()===(new h(a)).toString()?!0:!1},_changeLabel:function(a){n.empty(this.domNode);
n.create("span",{innerHTML:a.toHex(),className:"color-label",style:{color:g.invertColor(a.toHex())}},this.domNode)},onOpen:function(){this.openDialog()},openDialog:function(){this.initUI()},_closeDialog:function(){this.emit("close")},onClose:function(){this._closeDialog()}})})},"jimu/dijit/ColorChooser":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/i18n dojo/_base/Color dijit/a11yclick dojo/i18n!dojo/nls/colors".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b){return f([l,p,c,r],{templateString:'\x3cdiv\x3e\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\x3ctable class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e',baseClass:"jimu-color-chooser",declaredClass:"jimu.dijit.ColorChooser",uid:"",colorsArray:["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),
"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),
"rgb(0,0,1) darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],postCreate:function(){this.inherited(arguments);this.colorTitleNls=t.getLocalization("dojo","colors");this._createColorsBlocks()},_createColorsBlocks:function(){this._row=this.colorsArray.length;this._col=this.colorsArray[0].length;for(var c=0;c<this._row;c++)for(var a=n.create("tr",{role:"row"},this.gridNode),f=0;f<this._col;f++){var d=this.colorsArray[c][f],h=e.named[d],l="";h?l=d:"rgb(0,0,1)"===
d&&(l="black",h="rgb(0,0,1)");d=this.colorTitleNls[l];h=(new e(h)).toString();this["record"+f]=n.create("td",{"class":"dijitPaletteCell","data-title":h,role:"gridcell"},a);var p=n.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+f]);n.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),alt:d,title:d,"data-title":l,width:"16px",height:"16px",style:"background-color: "+h},p)}this.own(k(this.gridNode,b,q.hitch(this,this.onColorClick)))},onColorClick:function(b){for(var a=
b.target;"TD"!==a.tagName;){if(!a.parentNode||a===this.gridNode)return;a=a.parentNode}a=n.getAttr(a,"data-title");a=(new e(a)).toString();this.setColor(a);b.stopPropagation();b.preventDefault()},_onChange:function(b){this.emit("change",b)},setColor:function(b,a){b=new e(b);for(var c=null,d=h("td",this.domNode),f=0,m=d.length;f<m;f++)n.removeClass(d[f],"dijitPaletteCellSelected");f=0;for(m=d.length;f<m;f++)if(b.toString()===n.getAttr(d[f],"data-title")){c=d[f];break}c&&n.addClass(c,"dijitPaletteCellSelected");
(c&&"undefined"===typeof a||!0===a)&&this._onChange(b)}})})},"jimu/dijit/CustomColorPicker":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color jimu/dijit/ColorSelector".split(" "),function(r,f,l,p,c,q,n,k,h){return f([l,p,r],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:"\x3cdiv\x3e\x3c/div\x3e",_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,
ensureMode:!1,showLabel:!1,postMixInProperties:function(){this.nls=window.jimuNls.common},postCreate:function(){this.inherited(arguments);this.color?this.color instanceof k||(this.color=new k(this.color)):this.color=new k("#ccc");q.setStyle(this.domNode,"backgroundColor",this.color.toHex());this._createDialog(this.domNode)},destroy:function(){this.picker.destroy();this.inherited(arguments)},_handlerOk:function(c){c&&c.stopPropagation&&c.preventDefault&&(c.stopPropagation(),c.preventDefault());this.emit("ok",
this.color)},_handlerApply:function(c){c&&c.stopPropagation&&c.preventDefault&&(c.stopPropagation(),c.preventDefault());this.emit("apply",this.color)},_handlerCancel:function(c){c&&c.stopPropagation&&c.preventDefault&&(c.stopPropagation(),c.preventDefault());this.emit("cancel")},_createDialog:function(){var f=q.create("div",{"class":"dojox-color-picker-container"},this.domNode),e=new h({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:c.hitch(this,function(b){b=
new k(b);this.setColor(b)})});e.placeAt(f);e.startup();f=q.create("div",{"class":"btns-container jimu-float-trailing"},f);if(!0===this.showOk){var b=q.create("div",{"class":"jimu-btn jimu-float-leading ok",title:this.nls.ok,innerHTML:this.nls.ok},f);this.own(n(b,"click",c.hitch(this,function(b){var a=this.picker.get("value");this.setColor(new k(a));this._handlerOk(b)})))}!0===this.showApply&&(b=q.create("div",{"class":"jimu-btn jimu-float-leading apply",title:this.nls.apply,innerHTML:this.nls.apply},
f),this.own(n(b,"click",c.hitch(this,function(b){var a=this.picker.get("value");this.setColor(new k(a));this._handlerApply(b)}))));f=q.create("div",{"class":"jimu-btn jimu-btn-vacation jimu-float-leading",title:this.nls.cancel,innerHTML:this.nls.cancel},f);this.own(n(f,"click",c.hitch(this,function(b){this._handlerCancel(b)})));this.picker=e},setColor:function(c){if(c instanceof k){var e=this.color,b="";e&&(b=e.toHex());e=c.toHex();this.color=c;b!==e&&this.picker.set("value",e)}},getColor:function(){return this.color},
onClose:function(){}})})},"jimu/dijit/ColorRecords":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/on dojo/query dojo/_base/Color dojo/cookie dojo/text!./templates/ColorRecords.html dijit/a11yclick".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m){return f([l,p,c,r],{templateString:b,baseClass:"jimu-color-records",declaredClass:"jimu.dijit.ColorRecords",uid:"",recordsLength:10,colorList:null,
postCreate:function(){this.inherited(arguments);this.colorList=[];this._createCoustomRecord();""===this.uid&&(this.uid="wab_colorRecords");this.refresh()},push:function(a){this.colorList.unshift(a);this.colorList.length>this.recordsLength&&this.colorList.pop();this._setColors()},selecteColor:function(a){a=new t(a);for(var b=null,d=h("td",this.domNode),c=0,e=d.length;c<e;c++)n.removeClass(d[c],"dijitPaletteCellSelected");c=0;for(e=d.length;c<e;c++)if(a.toString()===n.getAttr(d[c],"title")){b=d[c];
break}b&&(n.addClass(b,"dijitPaletteCellSelected"),this.onChoose(a))},refresh:function(){this._getCookie(this.uid);this._setColors()},_setColors:function(){for(var a=0;a<this.recordsLength;a++){var b=this["record"+a];if(b&&this.colorList[a]&&this.colorList[a].toString){var d=this.colorList[a].toString();n.setAttr(b,"title",d);b=this._findImg(b);n.setStyle(b,"background-color",d);n.setAttr(b,"alt",d);n.setAttr(b,"title",d)}}this._setCookie(this.uid)},_createCoustomRecord:function(){for(var a=0;a<this.recordsLength;a++){this["record"+
a]=n.create("td",{"class":"dijitPaletteCell",tabindex:a,title:"",role:"gridcell"},this.container);var b=n.create("span",{"class":"dijitInline dijitPaletteImg"},this["record"+a]);n.create("img",{"class":"dijitColorPaletteSwatch",src:require.toUrl("dojo/resources/blank.gif"),style:"background-color: #ffffff"},b)}this.own(k(this.gridNode,m,q.hitch(this,this.onRecordClick)))},onRecordClick:function(a){for(var b=a.target;"TD"!==b.tagName;){if(!b.parentNode||b===this.gridNode)return;b=b.parentNode}b=n.getAttr(b,
"title");b=(new t(b)).toString();this.onChoose(b);a.stopPropagation();a.preventDefault()},onChoose:function(a){this.emit("choose",a)},_findImg:function(a){var b=null;return a.nodeName&&"IMG"===a.nodeName.toUpperCase()?a:b=h(".dijitColorPaletteSwatch",a)[0]},_setCookie:function(a){for(var b=[],d=0,c=this.recordsLength;d<c;d++){var f=this.colorList[d];f&&f.toString&&(b[d]=f.toString())}this._cleanCookie(a);try{var h=JSON.stringify(b);e(a,h,{expires:1E3,path:"/"})}catch(z){console.error("ColorRecords: cookieList JSON.stringify error."+
z.stack)}},_getCookie:function(a){a=e(a);if("undefined"!==typeof a)try{var b=JSON.parse(a);if(b&&"undefined"!==typeof b.length){a=0;for(var d=this.recordsLength;a<d;a++){var c=b[a];c&&c.toString&&(this.colorList[a]=new t(c.toString()))}}}catch(v){console.error("ColorRecords: cookieList JSON.parse error."+v.stack)}},_cleanCookie:function(a){e(a,null,{expires:-1})}})})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle ./a11y/OnScreenWidgetPanel dojo/touch".split(" "),
function(r,f,l,p,c,q,n,k,h,t){r=r([n,q],{baseClass:"jimu-panel jimu-on-screen-widget-panel jimu-main-background",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3ch2 class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode" tabindex\x3d"-1" data-dojo-attach-event\x3d"onkeydown:_onTitleLabelKeyDown"\x3e${label}\x3c/h2\x3e\x3cdiv class\x3d"btns-container"\x3e\x3cdiv tabindex\x3d"0" class\x3d"foldable-btn jimu-vcenter" aria-label\x3d"${headerNls.foldWindow}" role\x3d"button"data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked,onkeydown:_onFoldableBtnKeyDown"\x3e\x3c/div\x3e\x3cdiv tabindex\x3d"0" class\x3d"max-btn jimu-vcenter" aria-label\x3d"${headerNls.maxWindow}" role\x3d"button"data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked,onkeydown:_onMaxBtnKeyDown"\x3e\x3c/div\x3e\x3cdiv tabindex\x3d"0" class\x3d"close-btn jimu-vcenter" aria-label\x3d"${headerNls.closeWindow}" role\x3d"button"data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,onkeydown:_onCloseBtnKey"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postMixInProperties:function(){this.headerNls=window.jimuNls.panelHeader},postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w);this.a11y_init()},_onMaxBtnClicked:function(c){c.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?(l.setAttr(this.maxNode,"aria-label",
this.headerNls.maxWindow),this.panelManager.normalizePanel(this)):(l.setAttr(this.maxNode,"aria-label",this.headerNls.restoreWindow),this.panelManager.maximizePanel(this),l.removeClass(this.foldableNode,"fold-up"),l.addClass(this.foldableNode,"fold-down"),l.setAttr(this.foldableNode,"aria-label",this.headerNls.foldWindow)),this._setMobilePosition());this.panelManager.activatePanel(this)},_onFoldableBtnClicked:function(c){c&&c.stopPropagation();this._getPositionInfo().isRunInMobile&&("minimized"===
this.windowState?(l.removeClass(this.foldableNode,"fold-up"),l.addClass(this.foldableNode,"fold-down"),l.setAttr(this.foldableNode,"aria-label",this.headerNls.foldWindow),this.panelManager.normalizePanel(this)):(l.removeClass(this.foldableNode,"fold-down"),l.addClass(this.foldableNode,"fold-up"),l.setAttr(this.foldableNode,"aria-label",this.headerNls.unfoldWindow),this.panelManager.minimizePanel(this)),l.setAttr(this.maxNode,"aria-label",this.headerNls.maxWindow),this._setMobilePosition())},_onCloseBtnClicked:function(c){c.preventDefault();
c.stopPropagation();this.panelManager.closePanel(this)},_normalizePositionObj:function(c){var b=this._getLayoutBox();c.left=isFinite(c.left)?c.left:b.w-c.right;c.top=isFinite(c.top)?c.top:b.h-c.bottom;delete c.right;delete c.bottom;this.position=f.mixin(f.clone(this.position),c)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||
400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();this.resizeHandle=(new h({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(e,b){this.disableMoveable();var h=l.getMarginBox(jimuConfig.layoutId);h.l=h.l-e+
b;h.w+=2*(e-b);this.moveable=new c.boxConstrainedMoveable(this.domNode,{box:h,handle:this.titleNode,within:!0});this.own(p(this.moveable,"Moving",f.hitch(this,this.onMoving)));this.own(p(this.moveable,"MoveStop",f.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);window.appInfo.isRunInMobile&&(this._setMobilePosition(),
k.isInNavMode()&&"minimized"===this.windowState&&this._onFoldableBtnClicked());this.inherited(arguments)},_switchToMobileUI:function(){l.removeClass(this.titleNode,"title-normal");l.addClass(this.titleNode,"title-full");l.setStyle(this.foldableNode,"display","block");l.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(l.removeClass(this.foldableNode,"fold-up"),l.addClass(this.foldableNode,"fold-down"),l.setAttr(this.foldableNode,"aria-label",this.headerNls.foldWindow)):(l.removeClass(this.foldableNode,
"fold-down"),l.addClass(this.foldableNode,"fold-up"),l.setAttr(this.foldableNode,"aria-label",this.headerNls.unfoldWindow))},_switchToDesktopUI:function(){l.removeClass(this.titleNode,"title-full");l.addClass(this.titleNode,"title-normal");l.setStyle(this.foldableNode,"display","none");l.setStyle(this.maxNode,"display","none")},resize:function(c){var b=this._getPositionInfo(),e={left:b.position.left,top:b.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};c&&(c.t=this.domNode.offsetTop,
e.left=isFinite(c.l)?c.l:e.left,e.top=isFinite(c.t)?c.t:e.top,e.width=isFinite(c.w)?c.w:e.width,e.height=isFinite(c.h)?c.h:e.height,this._normalizePositionObj(f.clone(e)),this.makePositionInfoBox(),e.width=this._positionInfoBox.w,e.height=this._positionInfoBox.h);b.position=e;this._onResponsible(b);this.inherited(arguments)},_onResponsible:function(c){c.isRunInMobile?(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(c.position),
this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(c){this._normalizePositionObj(c);this.makePositionInfoBox();c=this._getPositionInfo();this._onResponsible(c)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var c=jimuConfig.layoutId,c="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return l.getMarginBox(c)},_getPositionInfo:function(){var c=
{isRunInMobile:!1,position:{left:0,top:5}},b=this._getLayoutBox(),f=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return c.isRunInMobile=!0,c;window.isRTL?(c.position.left=b.w-f,c.position.left+this._positionInfoBox.w>b.w&&(c.position.left-=this._positionInfoBox.w,0>c.position.left&&(c.position.left=b.w-this._positionInfoBox.w))):(c.position.left=f,c.position.left+this._positionInfoBox.w>b.w&&(c.position.left=b.w>this._positionInfoBox.w?b.w-this._positionInfoBox.w:0));f=this._positionInfoBox.t;
b=b.h-f;f>=b?f>=this._positionInfoBox.h&&(c.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):b>=this._positionInfoBox.h&&(c.position.top=this._positionInfoBox.t+40+3);return c},_setMobilePosition:function(){window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==l.byId(jimuConfig.layoutId)&&l.place(this.domNode,jimuConfig.layoutId);var c=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(c.zIndex=this.position.zIndex);var b=k.getPositionStyle(c);f.mixin(b,
c.borderRadiusStyle);l.setStyle(this.domNode,b)},_setDesktopPosition:function(c){!window.appInfo.isRunInMobile&&this.domNode&&this.domNode.parentNode!==l.byId(jimuConfig.mapId)&&l.place(this.domNode,jimuConfig.mapId);l.setStyle(this.domNode,{left:c.left+"px",right:"auto",top:c.top+"px",width:(c.width||this.position.width||this._originalBox.w)+"px",height:(c.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(c){l.setStyle(c.node,"opacity",.9)},onMoveStop:function(c){l.setStyle(c.node,
"opacity",1);c=l.getMarginBox(c.node);this._normalizePositionObj(f.clone({left:c.l,top:c.t,width:c.w,height:c.h}));this.makePositionInfoBox()}});r.extend(t);return r})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),function(r,
f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u){r.experimental("dojox.layout.ResizeHandle");var v=m("dojox.layout._ResizeHelper",d,{show:function(){b.set(this.domNode,"display","")},hide:function(){b.set(this.domNode,"display","none")},resize:function(a){e.setMarginBox(this.domNode,a)}});return m("dojox.layout.ResizeHandle",[d,u],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,minWidth:100,
constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,a.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=g.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new v({id:"dojoxGlobalResizeHelper"})).placeAt(n.body()),
t.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var b=f.partial(t.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;b("dojoxResizeNW");break;case "x":this._resizeX=!0;b("dojoxResizeW");break;case "y":this._resizeY=!0,b("dojoxResizeN")}},_beginSizing:function(d){if(!this._isSizing&&
(l.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=g.byId(this.targetId))?this.targetWidget.domNode:h.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var f=e.position(this.targetDomNode,!0);this._resizeHelper.resize({l:f.x,t:f.y,w:f.w,h:f.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:f.x,t:f.y})}this._isSizing=!0;this.startPoint={x:d.clientX,y:d.clientY};
var f=b.getComputedStyle(this.targetDomNode),m="border-model"===e.boxModel?{w:0,h:0}:e.getPadBorderExtents(this.targetDomNode,f),k=e.getMarginExtents(this.targetDomNode,f);this.startSize={w:b.get(this.targetDomNode,"width",f),h:b.get(this.targetDomNode,"height",f),pbw:m.w,pbh:m.h,mw:k.w,mh:k.h};this.isLeftToRight()||"absolute"!=b.get(this.targetDomNode,"position")||(f=e.position(this.targetDomNode,!0),this.startPosition={l:f.x,t:f.y});this._pconnects=[l.connect(n.doc,a.move,this,"_updateSizing"),
l.connect(n.doc,a.release,this,"_endSizing")];c.stop(d)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var b=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===b)return;this._resizeHelper.resize(b)}a.preventDefault()},_getNewCoords:function(a,b,d){try{if(!a.clientX||!a.clientY)return!1}catch(w){return!1}this._activeResizeLastEvent=a;var c=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),e=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?
c:0);e=this._checkConstraints(a,this.startSize.h-(this._resizeY?e:0));(d=d||this.startPosition)&&this._resizeX&&(e.l=d.l+c,e.w!=a&&(e.l+=a-e.w),e.t=d.t);switch(b){case "margin":e.w+=this.startSize.mw,e.h+=this.startSize.mh;case "border":e.w+=this.startSize.pbw,e.h+=this.startSize.pbh}return e},_checkConstraints:function(a,b){if(this.minSize){var d=this.minSize;a<d.w&&(a=d.w);b<d.h&&(b=d.h)}this.constrainMax&&this.maxSize&&(d=this.maxSize,a>d.w&&(a=d.w),b>d.h&&(b=d.h));if(this.fixedAspect){var d=this.startSize.w,
c=this.startSize.h,e=d*b-c*a;0>e?a=b*d/c:0<e&&(b=a*c/d)}return{w:a,h:b}},_changeSizing:function(a){var d=this.targetWidget&&f.isFunction(this.targetWidget.resize),c=this._getNewCoords(a,d&&"margin");if(!1!==c&&(d?this.targetWidget.resize(c):this.animateSizing?k[this.animateMethod]([q.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:c.w}},duration:this.animateDuration}),q.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:c.h}},
duration:this.animateDuration})]).play():b.set(this.targetDomNode,{width:c.w+"px",height:c.h+"px"}),this.intermediateChanges))this.onResize(a)},_endSizing:function(a){p.forEach(this._pconnects,l.disconnect);var b=f.partial(l.publish,this.endTopic,[this]);this.activeResize?b():(this._resizeHelper.hide(),this._changeSizing(a),setTimeout(b,this.animateDuration+15));this._isSizing=!1;this.onResize(a)},onResize:function(a){}})})},"jimu/a11y/OnScreenWidgetPanel":function(){define(["dojo/_base/lang","dojo/on",
"dojo/_base/html","dojo/keys"],function(r,f,l,p){return{a11y_init:function(){this.own(f(this.domNode,"keydown",r.hitch(this,function(c){l.hasClass(c.target,"close-btn")||c.keyCode!==p.ESCAPE||(c.stopPropagation(),this.closeNode.focus())})))},_onTitleLabelKeyDown:function(c){c.shiftKey&&c.keyCode===p.TAB&&c.preventDefault()},_onMaxBtnKeyDown:function(c){c.keyCode!==p.ENTER&&c.keyCode!==p.SPACE||this._onMaxBtnClicked(c)},_onFoldableBtnKeyDown:function(c){c.keyCode===p.ENTER||c.keyCode===p.SPACE?this._onFoldableBtnClicked(c):
c.keyCode===p.TAB&&c.shiftKey&&c.preventDefault()},_onCloseBtnKey:function(c){c.keyCode===p.ENTER||c.keyCode===p.SPACE?this._onCloseBtnClicked(c):c.keyCode===p.TAB&&c.shiftKey&&(window.appInfo.isRunInMobile||c.preventDefault())}}})},"jimu/LayerInfos/LayerInfoForGroup":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred esri/request ./LayerInfo".split(" "),function(r,f,l,p,c,q){return r(q,{constructor:function(c,f,h,l){this.noLegend=l},_initVisible:function(){var c=
!1,f=this.originOperLayer.mapService;this.originOperLayer.mapService&&f.layerInfo._subLayerVisible[f.subId]&&(c=!0);this._visible=c},_setTopLayerVisible:function(c){var f;if(this.originOperLayer.mapService&&(f=this.originOperLayer.mapService,0<this.originOperLayer.subLayers.length)){f.layerInfo._subLayerVisible[f.subId]=c?!0:!1;this._visible=c;var h={};this.traversal(function(c){0===c.getSubLayers().length&&(h[c.originOperLayer.mapService.subId]=c.isVisbleOrInvisilbe())});f.layerInfo._setSubLayerVisible(h)}},
setLayerVisiblefromTopLayer:function(){},_visibleChanged:function(c){},_sevVisible:function(c){this.visible=c},obtainNewSubLayers:function(){var c=[];f.forEach(this.originOperLayer.subLayers,function(f){f.parentLayerInfo=this;f=this._layerInfoFactory.create(f);c.push(f);f.init()},this);return c},getOpacity:function(){},setOpacity:function(c){},getLayerObject:function(){var f=new p;this.layerObject.empty?c({url:this.layerObject.url,handleAs:"json",callbackParamName:"callback",timeout:1E5,content:{f:"json"}}).then(l.hitch(this,
function(c){var h=this.layerObject.url;this.layerObject=c;this.layerObject.url=h;this.layerObject.id=this.id;f.resolve(this.layerObject)}),function(c){f.reject(c)}):f.resolve(this.layerObject);return f},getLayerType:function(){var c=new p;c.resolve("GroupLayer");return c},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},getScaleRange:function(){var c=this.originOperLayer.mapService;return(c=c.layerInfo._getJsapiLayerInfoById(c.subId))&&
0<=c.minScale&&0<=c.maxScale?{minScale:c.minScale,maxScale:c.maxScale}:{minScale:0,maxScale:0}}})})},"jimu/dijit/Filter":function(){define("dojo/on dijit/a11yclick dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/Filter.html jimu/filterUtils jimu/utils jimu/LayerInfos/LayerInfos jimu/dijit/_filter/ValueProviderFactory dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/aspect dojo/Deferred esri/request ./_SingleFilter ./_FilterSet jimu/dijit/formSelect ./LoadingIndicator".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C){return p([c,q,n,h,l],{templateString:k,baseClass:"jimu-filter",declaredClass:"jimu.dijit.Filter",nls:null,autoSwitchMode:!0,_validOptions:!1,_layerDefinition:null,_popupFieldsInfo:[],_def:null,valueProviderFactory:null,featureLayerId:null,layerInfosObj:null,mode:"desktop",noFilterTip:"",enableAskForValues:!1,mobileBreakWidth:600,runtime:!1,widgetId:"",postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this.nls.add=window.jimuNls.common.add;
this.nls.apply=window.jimuNls.common.apply;this.layerInfosObj=e.getInstanceSync();this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._setDesktopMode();this.noFilterTip&&"string"===typeof this.noFilterTip&&(this.noFilterTipSection.innerHTML=t.sanitizeHTML(this.noFilterTip));this._bindBtnsEvent()},startup:function(){this.inherited(arguments);this.autoUpdateMode()},resize:function(){this.autoUpdateMode()},_bindBtnsEvent:function(){this.own(r(this.btnAddExpDesktop,f,a.hitch(this,
function(){this._onBtnAddExpClick()})));this.own(r(this.btnAddSetDesktop,f,a.hitch(this,function(){this._onBtnAddSetClick()})));this.own(r(this.btnAddExpMobile,f,a.hitch(this,function(){this._onBtnAddExpClick()})));this.own(r(this.btnAddSetMobile,f,a.hitch(this,function(){this._onBtnAddSetClick()})))},autoUpdateMode:function(){this.autoSwitchMode&&(this._clearMode(),this.domNode.clientWidth>=this.mobileBreakWidth?this._setDesktopMode():this._setMobileMode())},setMode:function(a){"desktop"===a?this._setDesktopMode():
"mobile"===a&&this._setMobileMode()},_setMode:function(a){this.mode=a;this._setModeClass(this.mode)},_setModeClass:function(a){g.removeClass(this.domNode,"desktop-mode");g.removeClass(this.domNode,"mobile-mode");g.addClass(this.desktopAddSection,"hidden");g.addClass(this.mobileAddSection,"hidden");a&&g.addClass(this.domNode,a+"-mode")},_clearMode:function(){this._setModeClass("")},_setDesktopMode:function(){this._setMode("desktop");g.removeClass(this.desktopAddSection,"hidden")},_setMobileMode:function(){this._setMode("mobile");
g.removeClass(this.mobileAddSection,"hidden")},reset:function(){this.isBuilding()||(this.removeAllFilters(),this.url=null,this.isHosted=!1,this._layerDefinition=null,this._popupFieldsInfo=[],this.valueProviderFactory=this.partsObj=this.expr=this.featureLayerId=null)},isBuilding:function(){return this._def&&!this._def.isFulfilled()},build:function(a){var b=new v;this.isBuilding()?b.reject("Filter is already building."):(this._def=null,this.reset(),this.url=a.url,this.isHosted=t.isHostedService(this.url),
this._layerDefinition=a.layerDefinition,this.featureLayerId=a.featureLayerId,a.widgetId&&(this.widgetId=a.widgetId),a.partsObj?(this.partsObj=this._updatePartsObj(a.partsObj),this._def=this._init("partsObj")):(this.expr=a.expr||"1\x3d1",this._def=this._init("expr")),b=this._def);return b},buildByExpr:function(a,b,d){console.warn("Filter#buildByExpr() method is deprecated, please use Filter#build() instead.");return this.build({url:a,expr:b,layerDefinition:d,featureLayerId:this.featureLayerId})},buildByFilterObj:function(a,
b,d){console.warn("Filter#buildByFilterObj() method is deprecated, please use Filter#build() instead.");return this.build({url:a,partsObj:b,layerDefinition:d,featureLayerId:this.featureLayerId})},_updatePartsObj:function(b){d.forEach(b,a.hitch(this,function(b){b.parts?d.forEach(b.parts,a.hitch(this,function(a){a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")})):b.interactiveObj&&!0===b.interactiveObj.cascade?
b.interactiveObj.cascade="previous":!1===b.interactiveObj.cascade&&(b.interactiveObj.cascade="none")}));return b},removeAllFilters:function(){this._destroyAllFilters()},_getLayerDefinitionRaw:function(b,d){var c=new v;d?c.resolve(d):(this.loading.show(),B({url:b,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(a.hitch(this,function(a){this.domNode?(this.loading.hide(),c.resolve(a)):c.reject()}),a.hitch(this,function(a){console.error(a);c.reject();this.domNode&&this.loading.hide()})));
return c},_validateLayerDefinition:function(a){return this._isObject(a)},_init:function(c){var e=new v;if(!this._isString(this.url))return e.reject(),e;var f=a.hitch(this,function(){setTimeout(a.hitch(this,function(){this.emit("change");e.resolve()}),1500)}),h=a.hitch(this,function(){g.addClass(this.errorSection,"hidden");this.removeAllFilters();var h;this.featureLayerId&&(this._tryOverrideFieldAliases(this.featureLayerId,this._layerDefinition),h=this.layerInfosObj.getLayerOrTableInfoById(this.featureLayerId).getPopupInfo());
var m=this._layerDefinition.fields;m&&0<m.length?(this._popupFieldsInfo=h?t.completePopupFieldFromLayerField(m,h.fieldInfos):m,(m=d.filter(m,a.hitch(this,function(a){return 0<=this._supportFieldTypes.indexOf(a.type)})))&&0<m.length?(this._validOptions=!0,g.removeClass(this.btnAddSetDesktop,"jimu-state-disabled"),g.removeClass(this.btnAddExpDesktop,"jimu-state-disabled"),g.removeClass(this.btnAddSetMobile,"jimu-state-disabled"),g.removeClass(this.btnAddExpMobile,"jimu-state-disabled"),this.createFieldsStore(),
this.valueProviderFactory=new b({url:this.url,layerDefinition:this._layerDefinition,featureLayerId:this.featureLayerId}),"expr"===c?this._isString(this.expr)?("1\x3d1"===this.expr.replace(/\s/gi,"")&&this.removeAllFilters(),this._parseExpr(this.expr)?f():e.reject()):e.reject():"partsObj"===c?this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),f()):e.reject():this._validatePartsObj(this.partsObj)?(this._parsePartsObj(this.partsObj),f()):this._isString(this.expr)?this._parseExpr(this.expr)?
f():e.reject():(this.removeAllFilters(),f())):(this._showErrorOptions(this.nls.error.noFilterFields),e.reject())):(h&&(this._popupFieldsInfo=h.fieldInfos),e.reject())});this._validateLayerDefinition(this._layerDefinition)?h():(this.loading.show(),B({url:this.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(a.hitch(this,function(a){this.domNode?(this.loading.hide(),this._layerDefinition=a,h()):e.reject()}),a.hitch(this,function(a){console.error(a);e.reject();this.domNode&&
this.loading.hide()})));return e},_tryOverrideFieldAliases:function(b,c){if(b=this.layerInfosObj.getLayerOrTableInfoById(b))if(b=b.getPopupInfo())if(b=b.fieldInfos,c=c.fields,b&&0<b.length&&c&&0<c.length){var e={};d.forEach(b,a.hitch(this,function(a){a.fieldName&&(e[a.fieldName]=a)}));d.forEach(c,a.hitch(this,function(a){var b=e[a.name];b&&b.label&&(a.alias=b.label)}))}},toJson:function(){var b={logicalOperator:this.allAnySelect.value,parts:[]},c=this._getAllSingleFiltersAndFilterSets();if(0===c.length)return b.expr=
"1\x3d1",b;d.forEach(c,a.hitch(this,function(a){a=a.toJson();b.parts.push(a)}));return d.every(b.parts,a.hitch(this,function(a){return!!a}))&&0<b.parts.length?(b.expr=this.getExprByFilterObj(b),b):null},createFieldsStore:function(){if(this._layerDefinition.fields&&0!==this._layerDefinition.fields.length){var b=a.clone(this._layerDefinition.fields);0===this.setFieldsStoreByFieldInfos(b)&&this._showErrorOptions(this.nls.error.noFilterFields)}else this._showErrorOptions(this.nls.error.noFilterFields)},
_parsePartsObj:function(a){this._validatePartsObj(a)&&(this.removeAllFilters(),this._buildEditUIByPartsObj(a))},_parseExpr:function(a){this._destroyAllFilters();var b=null;if(!this._validateLayerDefinition(this._layerDefinition))return b;if(!a||"string"!==typeof a)return this._showErrorOptions(this.nls.error.invalidSQL),b;if("1\x3d1"===this.expr.replace(/\s/gi,""))return b={expr:"1\x3d1",parts:[],logicalOperator:"AND"};try{b=this.getFilterObjByExpr(a)}catch(w){b=null,console.error(w)}b?this._buildEditUIByPartsObj(b):
this._showErrorOptions(this.nls.error.cantParseSQL);return b},_buildEditUIByPartsObj:function(b){b&&(this._destroyAllFilters(),d.forEach(b.parts,a.hitch(this,function(a){a.parts?this._addFilterSet(a):a.fieldObj&&a.operator&&a.valueObj&&this._addSingleFilter(a)})),this.allAnySelect.value=b.logicalOperator,this._setFilterMsgUI(b.parts.length))},_addSingleFilter:function(b){b={widgetId:this.widgetId,url:this.url,layerInfo:this._layerDefinition,popupFieldsInfo:this._popupFieldsInfo,stringFieldType:this._stringFieldType,
dateFieldType:this._dateFieldType,numberFieldTypes:this._numberFieldTypes,part:b,OPERATORS:a.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,runtime:this.runtime};b=new z(b);b.placeAt(this.allExpsBox);b.startup();this.own(u.after(b,"_destroySelf",a.hitch(this,function(){this._checkFilterNumbers();this._focusOnMobileAdd();this.emit("change")})));this.own(r(b,"change",a.hitch(this,function(){this.emit("change")})));
this._checkFilterNumbers();return b},_focusOnMobileAdd:function(){g.hasClass(this.mobileAddSection,"hidden")||this.btnAddExpMobile.focus()},_addFilterSet:function(b){b={widgetId:this.widgetId,url:this.url,layerInfo:this._layerDefinition,popupFieldsInfo:this._popupFieldsInfo,stringFieldType:this._stringFieldType,dateFieldType:this._dateFieldType,numberFieldTypes:this._numberFieldTypes,partsObj:b,OPERATORS:a.mixin({},this.OPERATORS),enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,
valueProviderFactory:this.valueProviderFactory,runtime:this.runtime};b=new C(b);b.placeAt(this.allExpsBox);b.startup();this.own(u.after(b,"_destroySelf",a.hitch(this,function(){this._checkFilterNumbers();this._focusOnMobileAdd();this.emit("change")})));this.own(r(b,"change",a.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return b},_destroyAllFilters:function(){for(var a=this._getAllSingleFiltersAndFilterSets();0<a.length;)a[0].destroy(),a.splice(0,1);this._checkFilterNumbers()},
_getAllSingleFiltersAndFilterSetsDoms:function(){var b=[];this.allExpsBox.childNodes&&0<this.allExpsBox.childNodes.length&&d.forEach(this.allExpsBox.childNodes,a.hitch(this,function(a){(g.hasClass(a,"jimu-single-filter")||g.hasClass(a,"jimu-filter-set"))&&b.push(a)}));return b},_getAllSingleFiltersAndFilterSets:function(){var b=this._getAllSingleFiltersAndFilterSetsDoms();return d.map(b,a.hitch(this,function(a){return m.byNode(a)}))},_setFilterMsgUI:function(a){2>a?(this.allAnySelect.value="AND",
g.setStyle(this.allAnySelect.domNode,"display","none"),g.setStyle(this.oneOrZeroMsg,"display","block")):(g.setStyle(this.oneOrZeroMsg,"display","none"),g.setStyle(this.allAnySelect.domNode,"display","inline-table"))},_checkFilterNumbers:function(){var a=this._getAllSingleFiltersAndFilterSetsDoms();this._setFilterMsgUI(a.length);0<a.length?g.addClass(this.noFilterTipSection,"hidden"):g.removeClass(this.noFilterTipSection,"hidden");this.emit("filter-number-change")},_showErrorOptions:function(a){console.error(a);
g.addClass(this.errorSection,"hidden");this.errorTip.innerHTML=a;this.loading.hide()},_onBtnApplyClicked:function(){this.emit("apply")},_onBtnAddSetClick:function(){this._layerDefinition&&this._validOptions&&(this._addFilterSet(),this.emit("change"))},_onBtnAddExpClick:function(){this._layerDefinition&&this._validOptions&&(this._addSingleFilter(),this.emit("change"))}})})},"jimu/dijit/_filter/ValueProviderFactory":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare ./BlankValueProvider ./SimpleValueProvider ./TwoNumbersValueProvider ./TwoDatesValueProvider ./ListValueProvider ./AdvancedListValueProvider ./PredefinedValueProvider ./NumberListValueProvider ./DateIsInValueProvider jimu/utils jimu/LayerInfos/LayerInfos".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a){var g={stringOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorStartsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},
values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorEndsWith:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorContains:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorDoesNotContain:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsAnyOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},
multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsNoneOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0,supportCaseSensitive:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0,supportCaseSensitive:!0}},stringOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},stringOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIs:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0}},numberOperatorIsNot:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",codedValueProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsAtLeast:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},
field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsLessThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",
supportAskForValue:!0}},numberOperatorIsAtMost:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsGreaterThan:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},
unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0},uniquePredefined:{normalProviderType:"UNIQUE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsAnyOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsNoneOf:{values:{normalProviderType:"SIMPLE_VALUE_PROVIDER"},
multiple:{normalProviderType:"ADVANCED_LIST_VALUE_PROVIDER",supportAskForValue:!0},multiplePredefined:{normalProviderType:"MULTIPLE_PREDEFINED_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsNotBetween:{value:{normalProviderType:"TWO_NUMBERS_VALUE_PROVIDER",supportAskForValue:!0}},numberOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},numberOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},
dateOperatorIsOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsNotOn:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,
filterCodedValueIfPossible:!0}},dateOperatorIsIn:{value:{normalProviderType:"DATE_IS_IN_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsNotIn:{value:{normalProviderType:"DATE_IS_IN_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsOnOrBefore:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorIsOnOrAfter:{value:{normalProviderType:"SIMPLE_VALUE_PROVIDER",
supportAskForValue:!0,customVirtualDates:!0},field:{normalProviderType:"LIST_VALUE_PROVIDER"},unique:{normalProviderType:"LIST_VALUE_PROVIDER",supportAskForValue:!0,filterCodedValueIfPossible:!0}},dateOperatorInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorNotInTheLast:{value:{normalProviderType:"NUMBER_LIST_VALUE_PROVIDER",supportAskForValue:!0}},dateOperatorIsBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0,
customVirtualDates:!0}},dateOperatorIsNotBetween:{value:{normalProviderType:"TWO_DATES_VALUE_PROVIDER",supportAskForValue:!0,customVirtualDates:!0}},dateOperatorIsBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}},dateOperatorIsNotBlank:{value:{normalProviderType:"BLANK_VALUE_PROVIDER"}}},d=l([],{nls:null,layerInfo:null,popupInfo:null,url:null,layerDefinition:null,featureLayerId:null,constructor:function(b){r.mixin(this,b);this.nls=window.jimuNls.filterBuilder;b=a.getInstanceSync();this.featureLayerId&&
(this.layerInfo=b.getLayerOrTableInfoById(this.featureLayerId))&&(this.popupInfo=this.layerInfo.getPopupInfo())},getSupportedValueTypes:function(a,b){var d=[];if(b=g[b])b.value&&d.push("value"),b.field&&0<this._getSameShortTypeFieldNames(a).length&&d.push("field"),b.unique&&this.url&&(this._isStreamServer(this.url)||d.push("unique")),b.multiple&&this.url&&(this._isStreamServer(this.url)||d.push("multiple")),b.uniquePredefined&&this.url&&(this._isStreamServer(this.url)||d.push("uniquePredefined")),
b.multiplePredefined&&this.url&&(this._isStreamServer(this.url)||d.push("multiplePredefined"));return d},_isStreamServer:function(a){a=(a||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(a)},_getSameShortTypeFieldNames:function(a){var b=[],c=this._getFieldInfo(this.layerDefinition,a),e=d.getShortTypeByEsriType(c.type);f.forEach(this.layerDefinition.fields,r.hitch(this,function(c){c.name!==a&&d.getShortTypeByEsriType(c.type)===e&&b.push(c.name)}));return b},_getSameShortTypeFieldNameLabels:function(a){var b=
[],c=this._getFieldInfo(this.layerDefinition,a),e=d.getShortTypeByEsriType(c.type);f.forEach(this.layerDefinition.fields,r.hitch(this,function(c){c.name!==a&&d.getShortTypeByEsriType(c.type)===e&&b.push({value:c.name,label:c.alias})}));return b},getValueProvider:function(a,d){var f=null,l=r.clone(g[a.operator]);if(l){var u=a.valueObj.type,v=a.fieldObj.name,y=this._getFieldInfo(this.layerDefinition,v),w=l[u],A=w.normalProviderType,G=null,E=m.getCodedValueListForCodedValueOrSubTypes(this.layerDefinition,
v);"field"===u?(v=this._getSameShortTypeFieldNameLabels(v),0<v.length&&(G=v)):E&&0<E.length&&w.codedValueProviderType&&(A=w.codedValueProviderType);a={nls:this.nls,url:this.url,layerDefinition:this.layerDefinition,partObj:a,fieldInfo:y,codedValues:E,staticValues:G,layerInfo:this.layerInfo,popupInfo:this.popupInfo,operatorInfo:l,filterCodedValueIfPossible:!!w.filterCodedValueIfPossible,runtime:d};if("BLANK_VALUE_PROVIDER"===A)f=new p(a);else if("SIMPLE_VALUE_PROVIDER"===A)f=new c(a);else if("TWO_NUMBERS_VALUE_PROVIDER"===
A)f=new q(a);else if("TWO_DATES_VALUE_PROVIDER"===A)f=new n(a);else if("LIST_VALUE_PROVIDER"===A)a.showNullValues=!1,"value"===u||"field"===u?f=new k(a):(a.providerType=A,a.selectUI="dropdown",f=new h(a));else if("NUMBER_LIST_VALUE_PROVIDER"===A)f=new e(a);else if("DATE_IS_IN_VALUE_PROVIDER"===A)f=new b(a);else if("ADVANCED_LIST_VALUE_PROVIDER"===A)a.providerType=A,a.selectUI="dropdown",f=new h(a);else if("UNIQUE_PREDEFINED_VALUE_PROVIDER"===A||"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===A)a.providerType=
A,a.selectUI=a.partObj.valueObj?a.partObj.valueObj.selectUI:null,f=d?new h(a):new t(a)}return f},_getFieldInfo:function(a,b){a=a.fields;for(var d=0;d<a.length;d++){var c=a[d];if(b===c.name)return c}return null}});d.getOperatorInfo=function(a){return r.clone(g[a])};d.isSupportVirtualDates=function(a){var b=g[a];return b&&b.value&&b.value.customVirtualDates?{status:!0,num:"dateOperatorIsBetween"===a||"dateOperatorIsNotBetween"===a?2:1}:{status:!1}};d.getOperatorsByShortType=function(a,b){var d=[];"string"===
a?d="stringOperatorIs stringOperatorIsNot stringOperatorStartsWith stringOperatorEndsWith stringOperatorContains stringOperatorDoesNotContain stringOperatorIsAnyOf stringOperatorIsNoneOf stringOperatorIsBlank stringOperatorIsNotBlank".split(" "):"number"===a?d="numberOperatorIs numberOperatorIsNot numberOperatorIsAtLeast numberOperatorIsAtMost numberOperatorIsLessThan numberOperatorIsGreaterThan numberOperatorIsAnyOf numberOperatorIsNoneOf numberOperatorIsBetween numberOperatorIsNotBetween numberOperatorIsBlank numberOperatorIsNotBlank".split(" "):
"date"===a&&(d="dateOperatorIsOn dateOperatorIsNotOn dateOperatorIsIn dateOperatorIsNotIn dateOperatorIsBefore dateOperatorIsAfter dateOperatorIsOnOrBefore dateOperatorIsOnOrAfter dateOperatorIsBetween dateOperatorIsNotBetween dateOperatorIsBlank dateOperatorIsNotBlank".split(" "),b&&d.splice(8,0,"dateOperatorInTheLast","dateOperatorNotInTheLast"));return d};d.getShortTypeByEsriType=function(a){var b=null;"esriFieldTypeString"===a?b="string":"esriFieldTypeDate"===a?b="date":0<=["esriFieldTypeOID",
"esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a)&&(b="number");return b};return d})},"jimu/dijit/_filter/BlankValueProvider":function(){define(["dojo/_base/html","dojo/_base/declare","./ValueProvider"],function(r,f,l){return f([l],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.inherited(arguments);r.addClass(this.domNode,"jimu-filter-blank-value-provider")},getDijits:function(){return[]},getStatus:function(){return 1},
setValueObject:function(){},getValueObject:function(){return{isValid:!0,type:this.partObj.valueObj.type,value:null}},isBlankValueProvider:function(){return!0}})})},"jimu/dijit/_filter/ValueProvider":function(){define("dojo/on dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin jimu/FilterManager jimu/utils esri/lang".split(" "),function(r,f,l,p,c,q,n,k,h,t,e){return q([n,k,f],{baseClass:"jimu-filter-value-provider",fieldName:null,
shortType:null,_enabled:!1,cascade:"none",filterCodedValue:!1,fieldPopupInfo:null,nls:null,url:null,layerDefinition:null,fieldInfo:null,partObj:null,runtime:!0,staticValues:null,codedValues:null,layerInfo:null,popupInfo:null,operatorInfo:null,filterCodedValueIfPossible:!1,postMixInProperties:function(){this.inherited(arguments);this.shortType=this.partObj.fieldObj.shortType;this.fieldName=this.partObj.fieldObj.name;this.cascade=this.partObj.interactiveObj&&this.partObj.interactiveObj.cascade;this.runtime&&
this.codedValues&&this.filterCodedValueIfPossible&&t.isCodedValuesSupportFilter(this.layerDefinition,this.codedValues.length)?this.filterCodedValue=!0:this.filterCodedValue=!1;this.popupInfo&&this.popupInfo.fieldInfos&&0<this.popupInfo.fieldInfos.length&&c.some(this.popupInfo.fieldInfos,l.hitch(this,function(b){return b.fieldName===this.fieldName?(this.fieldPopupInfo=b,!0):!1}))},postCreate:function(){this.inherited(arguments);this.filterManager=h.getInstance()},getDijits:function(){return[]},bindChangeEvents:function(){var b=
this.getDijits();c.forEach(b,l.hitch(this,function(b){b.declaredClass&&0===b.declaredClass.indexOf("dijit.")&&p.addClass(b.domNode,b.declaredClass.replace(/\./g,"-"));this.own(r(b,"change",l.hitch(this,this._onChanged)));this.own(r(b,"enter",l.hitch(this,this._onEnter)))}))},_onChanged:function(){this._onEnterTriggered||this.emit("change")},_onEnterTriggered:!1,_onEnter:function(){this._onEnterTriggered=!0;this.emit("change");this.emit("enter");setTimeout(l.hitch(this,function(){this._onEnterTriggered=
!1}),100)},tryLocaleNumber:function(b){var c=t.localizeNumber(b);if(null===c||void 0===c)c=b;return c},getPartObject:function(){var b=this.getValueObject();if(!b)return null;var c=l.clone(this.partObj);c.valueObj=b;return c},setValueObject:function(){},getValueObject:function(){},tryGetValueObject:function(){return this.getValueObject()},setRequired:function(){},getStatus:function(){var b=1,e=this.getDijits();0<e.length&&(b=c.map(e,l.hitch(this,function(a){return"function"===typeof a.getStatus?a.getStatus():
this.getStatusForDijit(a)})),b=Math.min.apply(b,b));return b},getStatusForDijit:function(b){return b.validate()?b.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>this.getStatus()},isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},isBlankValueProvider:function(){return!1},getFilterExpr:function(){var b="1\x3d1",b=this.getLayerFilterExpr();if("all"===this.cascade||"previous"===this.cascade)var c=this.getCascadeFilterExpr(),b="("+
b+") AND ("+c+")";return b},getLayerFilterExpr:function(){var b="1\x3d1";this.layerInfo&&(b=this.layerInfo.getFilter());b||(b="1\x3d1");return b},_getWebMapFilterExpr:function(){var b="";this.layerInfo&&(b=this.layerInfo.getFilterOfWebmap());b||(b="1\x3d1");return b},getDropdownFilterExpr:function(b){var c="1\x3d1";b=this.layerInfo&&this.runtime&&b?this.filterManager.getFilterExp(this.layerInfo.id,b):this._getWebMapFilterExpr();"all"===this.cascade||"previous"===this.cascade?(c=this.getCascadeFilterExpr(),
c=b?"("+b+") AND ("+c+")":"("+c+")"):b&&(c=b);return c},getCascadeFilterExpr:function(){return"1\x3d1"},getDropdownFilterPartsObj:function(){var b={parts:[]};if("all"===this.cascade||"previous"===this.cascade)b=this.getCascadeFilterPartsObj();return b},getCascadeFilterPartsObj:function(){return{}},getCodedValueListByPartsObj:function(b,c,a,e){var d=t.getFieldInfoByFieldName(b.fields,c),f=b.typeIdField,g=null;a=a.parts;for(var h in a){var m=a[h];if(m.fieldObj.name===f){f=m.valueObj.value;g=t._getCodedValueBySubTypeId(b,
c,f,d);break}}var k;g||(g=e?e:t._getAllCodedValue(b,d));g&&0<g.length&&(k=g[0].value);return{selectedValue:k,valueLabels:g}},isDefined:function(b){return e.isDefined(b)},disable:function(){this._enabled=!1},enable:function(){this._enabled=!0},isEnabled:function(){return this._enabled},destroy:function(){this.inherited(arguments)}})})},"jimu/dijit/_filter/SimpleValueProvider":function(){define("dojo/_base/html dojo/_base/declare dojo/_base/lang dojo/on dojo/keys jimu/utils ./ValueProvider dijit/form/ValidationTextBox dijit/form/NumberTextBox ./DateValueSelector".split(" "),
function(r,f,l,p,c,q,n,k,h,t){return f([n],{templateString:"\x3cdiv\x3e\x3c/div\x3e",_dijit:null,customId:null,postCreate:function(){this.inherited(arguments);this.customId=this.partObj.vpId;r.addClass(this.domNode,"jimu-filter-simple-value-provider");var e=null;"string"===this.shortType?(e={required:!1,trim:!0,intermediateChanges:!1},this.customId&&(e.id=this.customId),this._dijit=new k(e),this._dijit.startup(),this._dijit.on("keydown",function(b){(b.keyCode||b.which)===c.ENTER&&this._dijit.emit("enter")}.bind(this))):
"number"===this.shortType?(e={required:!1,intermediateChanges:!1,constraints:{pattern:"#####0.##########"}},this.customId&&(e.id=this.customId),this._dijit=new h(e),this._dijit.startup(),this._dijit.on("keydown",function(b){(b.keyCode||b.which)===c.ENTER&&this._dijit.emit("enter")}.bind(this))):(e={runtime:this.runtime,popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo},this.runtime&&(e.virtualDates=this.partObj.interactiveObj.virtualDates),this.customId&&(e.customId=this.customId,e.prompt=this.partObj.interactiveObj.prompt+
" "+this.partObj.interactiveObj.hint),this._dijit=new t(e),this.own(p(this._dijit,"change",l.hitch(this,function(b){this.emit("change",b,"start")}))));!this.customId||"string"!==this.shortType&&"number"!==this.shortType||(e=r.toDom('\x3clabel for\x3d"'+this.customId+'" class\x3d"screen-readers-only"\x3e'+this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint+"\x3c/label\x3e"),r.place(e,this.domNode));r.setStyle(this._dijit.domNode,"width","100%");this._dijit.placeAt(this.domNode)},
getDijits:function(){return[this._dijit]},setValueObject:function(c){this.isDefined(c.value)&&("date"===this.shortType?this._dijit.setValueObject(c):this._dijit.set("value",c.value))},getValueObject:function(){if(this.isValidValue())if("date"===this.shortType){var c=this._dijit.getValueObject();if(c&&c.value)return c.isValid=!0,c.type=this.partObj.valueObj.type,c}else return c=this._dijit.get("value"),c="number"===this.shortType?parseFloat(c):q.sanitizeHTML(c),{isValid:!0,type:this.partObj.valueObj.type,
value:c};return null},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:null}:null},setRequired:function(c){this._dijit.set("required",c)}})})},"jimu/dijit/_filter/DateValueSelector":function(){define("dojo/aspect dojo/Evented dojo/on dojo/keys dojo/query dojo/_base/html dojo/_base/lang dojo/_base/array dojo/_base/declare dijit/_WidgetBase jimu/filterUtils jimu/utils jimu/dijit/Popup jimu/dijit/formSelect jimu/dijit/dateTimePicker".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g){return h([t,f],{virtualDates:null,customId:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);q.addClass(this.domNode,"jimu-date-value-selector");this.dateTypeSelect=new a({"aria-label":this.prompt});q.addClass(this.dateTypeSelect.domNode,"date-type-select");q.addClass(this.dateTypeSelect.domNode,"restrict-select-width");this.dateTypeSelect.placeAt(this.domNode);
this.own(l(this.dateTypeSelect,"change",n.hitch(this,function(){this._onDateTypeSelectChanged()})));this.virtualDates&&0<this.virtualDates.length||(this.virtualDates=[e.VIRTUAL_DATE_TODAY,e.VIRTUAL_DATE_YESTERDAY,e.VIRTUAL_DATE_TOMORROW],this.runtime&&this.virtualDates.unshift(e.VIRTUAL_DATE_CUSTOM));this.dateTypeSelect.addOption({value:"",label:"\x26nbsp;"});(!this.runtime||this.runtime&&0<=this.virtualDates.indexOf(e.VIRTUAL_DATE_CUSTOM))&&this.dateTypeSelect.addOption({value:"custom",label:this.nls.custom});
k.map(this.virtualDates,n.hitch(this,function(a){if("custom"!==a){var b={value:a,label:a};switch(a){case e.VIRTUAL_DATE_TODAY:b.label=this.nls.today;break;case e.VIRTUAL_DATE_YESTERDAY:b.label=this.nls.yesterday;break;case e.VIRTUAL_DATE_TOMORROW:b.label=this.nls.tomorrow}this.dateTypeSelect.addOption(b)}}));this.dateTypeSelect.startup();this.own(l(q.byId("main-page"),"click",n.hitch(this,function(){this.hideDateTimePopup()})));this.own(r.before(this.dateTypeSelect,"openDropDown",n.hitch(this,function(){this.hideDateTimePopup();
"custom"===this.dateTypeSelect.getValue()&&this.dateTimeObj&&this.dateTimeObj.value&&(this.dateTypeSelect.textDirNode.innerText=this.dateTimeObj.value);"custom"!==this.dateTypeSelect.getValue()&&this.dateTimePopup&&this.dateTimePopup.hide()})));this.own(r.after(this.dateTypeSelect,"closeDropDown",n.hitch(this,function(){this.customId||q.setAttr(this.dateTypeSelect,"aria-label",this.dateTypeSelect.textDirNode.innerText);this.dateTypeSelect.textDirNode.title="";setTimeout(n.hitch(this,function(){"custom"===
this.dateTypeSelect.getValue()&&this.dateTimeObj&&this.dateTimeObj.value&&this.dateTypeSelect.textDirNode&&(this.dateTypeSelect.textDirNode.innerText=this.dateTimeObj.value,this.dateTypeSelect.textDirNode.title=this.dateTimeObj.value);this.dateTimePopup&&this.dateTimePopup.domNode&&"block"===q.getStyle(this.dateTimePopup.domNode,"display")&&this.dateTimePicker&&this.dateTimePicker.calendar&&this.dateTimePicker.calendar.focus()}),200)})));this.own(r.after(this.dateTypeSelect.dropDown,"onItemClick",
n.hitch(this,function(a){a&&"custom"===a.option.value&&this.showDateTimePopup()}),!0));this.popupInfo&&this.popupInfo.fieldInfos&&(this.fieldInfo=this.popupInfo.fieldInfos.filter(n.hitch(this,function(a){return a.fieldName===this._fieldInfo.name}))[0])},hideDateTimePopup:function(){this.dateTimePopup&&this.dateTimePopup.domNode&&"block"===q.getStyle(this.dateTimePopup.domNode,"display")&&(this.dateTimePicker&&!0===this.dateTimePopupClick?this.dateTimePopupClick=!1:this.dateTimePopup.hide())},getDijits:function(){return[]},
setValueObject:function(a){if(a.virtualDate&&"custom"!==a.virtualDate)this.dateTypeSelect.set("value",a.virtualDate,!1),this.customId||q.setAttr(this.dateTypeSelect,"aria-label",a.virtualDate);else if(this.dateTypeSelect.set("value","custom",!1),a.value){var d=b.getDateByDateTimeStr(a.value),c=b.localizeDateTimeByFieldInfo(d,this.fieldInfo,a.enableTime,a.timeAccuracy);this.dateTimeObj={date:d,value:c};this.dateTypeSelect.textDirNode.innerText=c;this.dateTypeSelect.textDirNode.title=c;this.enableTime=
a.enableTime;this.timeAccuracy=a.timeAccuracy;this.customId||q.setAttr(this.dateTypeSelect,"aria-label",this.dateTypeSelect.textDirNode.innerText)}},getValueObject:function(){return this.isValidValue()?this.tryGetValueObject():null},tryGetValueObject:function(){if(this.isInvalidValue())return null;var a={value:null,virtualDate:""},c=this.dateTypeSelect.get("value"),f=null;"custom"===c?(f=this.dateTimeObj.date,a.value=f?b.getDateTimeStr(f):null,a.virtualDate="",a.enableTime=this.enableTime?this.enableTime:
!1,a.timeAccuracy=this.timeAccuracy?this.timeAccuracy:""):(f=e.getRealDateByVirtualDate(c),a.virtualDate=c,f?a.value=b.getDateTimeStr(f,"YYYY-MM-DD"):a=null);return a},setRequired:function(){},getStatus:function(){return"custom"===this.dateTypeSelect.get("value")?this.dateTimePicker?this._getStatusForDijit(this.dateTimePicker):this.dateTimeObj?1:0:""===this.dateTypeSelect.get("value")?0:1},_getStatusForDijit:function(a){return a.validate()?a.get("DisplayedValue")?1:0:-1},isInvalidValue:function(){return 0>
this.getStatus()},isEmptyValue:function(){return 0===this.getStatus()},isValidValue:function(){return 0<this.getStatus()},_onDateTypeSelectChanged:function(){"dateTime"===this.dateTypeSelect.get("value")&&this.showDateTimePopup();this.emit("change",this.dateTypeSelect.get("value"))},showDateTimePopup:function(){if(this.dateTimePopup)this.resize(),this.dateTimePicker.reset(),this.dateTimePopup.show();else{this.dateTimeObj||(this.dateTimeObj={date:null});this.dateTimePicker=new g({runtime:this.runtime,
value:this.dateTimeObj.date,fieldInfo:this.fieldInfo,enableTime:this.enableTime,timeAccuracy:this.timeAccuracy});this.own(l(this.dateTimePicker,"created",n.hitch(this,function(a){this.dateTypeSelect.textDirNode.innerText=a.value;this.dateTypeSelect.textDirNode.title=a.value;this.dateTimeObj=a})));this.own(l(this.dateTimePicker,"timeChange",n.hitch(this,function(a){a&&(this.dateTypeSelect.textDirNode.innerText=a.value,this.dateTypeSelect.textDirNode.title=a.value,this.enableTime=a.enableTime,this.timeAccuracy=
a.timeAccuracy,this.dateTimeObj=a,this.emit("change"))})));this.own(l(this.dateTimePicker,"timeStatusChanged",n.hitch(this,function(){this.popupH=this.enableTime?353:309})));this.own(l(this.dateTimePicker,"close",n.hitch(this,function(){this.dateTimePopup.hide();this.dateTypeSelect.focus()})));this.runtime?this._isOnlyShowDate()?(this.popupH=265,this.own(l(this.dateTimePicker,"calendarChange",n.hitch(this,function(a){a&&this.dateTypeSelect.textDirNode.innerText!==a.value&&(this.dateTypeSelect.textDirNode.innerText=
a.value,this.dateTypeSelect.textDirNode.title=a.value,this.enableTime=a.enableTime,this.timeAccuracy=a.timeAccuracy,this.dateTimeObj=a,this.emit("change"))})))):this.popupH=320:this.popupH=this.enableTime?353:309;var a=this._calculatePopup();this.dateTimePopup=new m({width:this.popupW,autoHeight:!0,classNames:["dijitCalendarPopup","jimu-popup-date-time-picker"],content:this.dateTimePicker.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:a.left,
top:a.top},useFocusLogic:!1,onClose:n.hitch(this,function(){this.dateTimePopup.hide();return!1}),buttons:[]});this._isOnlyShowDate()&&q.setStyle(this.dateTimePopup.contentContainerNode,{marginBottom:"-3px"});this.own(l(this.dateTimePopup.domNode,"click",n.hitch(this,function(){this.dateTimePopupClick=!0})));this.own(l(this.dateTimePopup.domNode,"keydown",n.hitch(this,function(a){a.keyCode===p.ESCAPE?(this.dateTimePopup.hide(),this.dateTypeSelect.focus()):this.runtime&&a.keyCode===p.TAB&&(a.preventDefault(),
this._isOnlyShowDate()||(q.hasClass(a.target,"dijitCalendarSelectedDate")?this.dateTimePicker.timeTextBox.focusNode:this.dateTimePicker.calendar).focus())})))}},_getLastBtnFromDTPopup:function(){for(var a=null,b=c(".jimu-btn",this.dateTimePopup.buttonContainer),e=b.length-1;0<=e;e--)if("none"!==q.getStyle(b[e],"display")){a=b[e];break}return a},_isOnlyShowDate:function(){return this.runtime&&!this.enableTime?!0:!1},_calculatePopup:function(){var a=q.getStyle(this.domNode,"width");this.popupW=210<
a?a:210;var b=q.position(this.domNode),c=q.position(document.body).h,e=b.y+30;c-e<this.popupH&&(e=b.y-this.popupH,e=0<e?e:(c-this.popupH)/2);c=q.position(document.body).w;b.x+this.popupW>c&&(b.x-=this.popupW-a);return{left:b.x,top:e-1}},resize:function(){var a=this._calculatePopup();this.dateTimePopup.setCustomPosition(a.left,a.top,this.popupW,this.popupH)},destroy:function(){this.dateTimePopup&&(this.dateTimePopup.onClose=n.hitch(this,function(){return!0}),this.dateTimePopup.close())}})})},"jimu/dijit/dateTimePicker":function(){define("dojo/_base/declare dojo/_base/html dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang jimu/utils dijit/Calendar dijit/form/TimeTextBox dojo/text!./templates/dateTimePicker.html dojo/on dojo/Evented jimu/dijit/CheckBox".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b){return r([l,p,c,b],{baseClass:"jimu-datetimepicker",declaredClass:"jimu.datetimepicker",templateString:t,value:null,fieldInfo:null,enableTime:!1,timeAccuracy:"",runtime:!1,postMixInProperties:function(){this.timeNls=window.apiNls.widgets.imageFilter.imageFilterSettings;this.timeUnit=window.jimuNls.timeUnit},postCreate:function(){this._initSelf()},_initSelf:function(){this.calendar=new k({value:this.value,"class":"jimu-calendar"},this.calendarDiv);this.own(e(this.calendar,
"change",q.hitch(this,function(){this._valueChange();this.runtime&&!this.enableTime&&this.emit("close")})));this.calendar.startup();if(this.runtime)if(f.setStyle(this.timeTextContainerSetting,"display","none"),this.enableTime){f.setStyle(this.timeTextContainerRuntime,"display","block");var b={constraints:{timePattern:"s"===this.timeAccuracy?"HH:mm:ss":"m"===this.timeAccuracy?"HH:mm":"HH",clickableIncrement:"T00:30:00",visibleIncrement:"T01:00:00",visibleRange:"T01:00:00"}};"h"===this.timeAccuracy&&
(b.constraints.clickableIncrement="T01:00:00");this.timeTextBox=new h(b,this.timeTextBoxDiv);this.own(e(this.timeTextBox,"change",q.hitch(this,function(){this.enableTime=""===this.timeTextBox.displayedValue?!1:!0;this._valueChange()})));this.timeTextBox.startup();this.timeTextBox.set("value",this.value)}else f.setStyle(this.timeTextContainerRuntime,"display","none");else f.setStyle(this.timeTextContainerRuntime,"display","none"),f.setStyle(this.timeTextContainerSetting,"display","block"),this._initTimePickers();
this._enableTime=this.enableTime;this.emit("created",this.getValueObj())},_initTimePickers:function(){this.timeCheckbox.setValue(this.enableTime);this.enableTime&&(f.setStyle(this.timeTableContainer,"display","block"),this.value&&this._setTimeBox_HMS(this.value));this.own(e(this.timeCheckbox,"change",q.hitch(this,function(){this._changeTimeCheckStatus();this._valueChange();this.emit("timeStatusChanged")})));this.own(e(this.hourSelect,"change",q.hitch(this,function(){this._valueChange()})));this.own(e(this.minuteSelect,
"change",q.hitch(this,function(){this._valueChange()})));this.own(e(this.secondSelect,"change",q.hitch(this,function(){this._valueChange()})))},_changeTimeCheckStatus:function(){(this._enableTime=this.timeCheckbox.checked)?f.setStyle(this.timeTableContainer,"display","block"):f.setStyle(this.timeTableContainer,"display","none")},_valueChange:function(){this.emit("timeChange",this.getValueObj())},isValid:function(){if(null===this.calendar.value)return!1;if(this.runtime){if(this._enableTime&&!this.timeTextBox.isValid())return!1}else if(this.timeCheckbox.checked){if(!this.hourSelect.isValid()||
!this.minuteSelect.isValid()||!this.secondSelect.isValid()||""===this.hourSelect.displayedValue||""!==this.hourSelect.displayedValue&&""!==this.secondSelect.displayedValue&&""===this.minuteSelect.displayedValue)return!1}else this.hourSelect.isValid()||this.hourSelect.set("value",null),this.minuteSelect.isValid()||this.minuteSelect.set("value",null),this.secondSelect.isValid()||this.secondSelect.set("value",null);return!0},getValueObj:function(){if(!this.isValid())return!1;var b=new Date(this.calendar.value.toDateString());
if(this.runtime){if(this.enableTime){var a=this.timeTextBox.get("value");a&&(b.setHours(a.getHours()),b.setMinutes(a.getMinutes()),b.setSeconds(a.getSeconds()))}}else if(this.enableTime=this._enableTime){var a=this.hourSelect.get("value"),c=this.minuteSelect.get("value"),d=this.secondSelect.get("value");this.timeAccuracy=d?"s":c?"m":"h";b.setHours(a?a.getHours():null);b.setMinutes(c?c.getMinutes():null);b.setSeconds(d?d.getSeconds():null)}else this.timeAccuracy="";a=n.localizeDateTimeByFieldInfo(b,
this.fieldInfo,this.enableTime,this.timeAccuracy);this.value=b;return{date:b,value:a,enableTime:this.enableTime,timeAccuracy:this.timeAccuracy}},validate:function(){this.set("DisplayedValue",this.calendar.value?1:0);return!0},reset:function(){var b=this.calendar.get("value");b&&this.value&&this.value.toDateString()===b.toDateString()||this.calendar.set("value",this.value);this.timeCheckbox.setValue(this.enableTime);this.runtime?this.enableTime&&this.timeTextBox.set("value",this.value):this._setTimeBox_HMS(this.enableTime?
this.value:null)},_setTimeBox_HMS:function(b){var a=null,c=null,d=null;"h"===this.timeAccuracy?a=b:"m"===this.timeAccuracy?a=c=b:"s"===this.timeAccuracy&&(a=c=d=b);this.hourSelect.set("value",a);this.minuteSelect.set("value",c);this.secondSelect.set("value",d)}})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u){var v=p("dijit.Calendar",[m,a,g],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(a){k.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",a)},_createMonthWidget:function(){return new v._MonthDropDownButton({id:this.id+"_mddb",
tabIndex:-1,onMonthSelect:t.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(e(this.domNode,"keydown",t.hitch(this,"_onKeyDown")),e(this.dateRowsNode,"mouseover",t.hitch(this,"_onDayMouseOver")),e(this.dateRowsNode,"mouseout",t.hitch(this,"_onDayMouseOut")),e(this.dateRowsNode,"mousedown",t.hitch(this,"_onDayMouseDown")),e(this.dateRowsNode,"mouseup",t.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(a){var b=
new this.dateClassObj(this.currentFocus);b.setDate(1);b.setMonth(a);a=this.dateModule.getDaysInMonth(b);var d=this.currentFocus.getDate();b.setDate(Math.min(d,a));this._setCurrentFocusAttr(b)},_onDayMouseOver:function(a){(a=q.contains(a.target,"dijitCalendarDateLabel")?a.target.parentNode:a.target)&&(a.dijitDateValue&&!q.contains(a,"dijitCalendarDisabledDate")||a==this.previousYearLabelNode||a==this.nextYearLabelNode)&&(q.add(a,"dijitCalendarHoveredDate"),this._currentNode=a)},_onDayMouseOut:function(a){!this._currentNode||
a.relatedTarget&&a.relatedTarget.parentNode==this._currentNode||(a="dijitCalendarHoveredDate",q.contains(this._currentNode,"dijitCalendarActiveDate")&&(a+=" dijitCalendarActiveDate"),q.remove(this._currentNode,a),this._currentNode=null)},_onDayMouseDown:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&!q.contains(a,"dijitCalendarDisabledDate")&&(q.add(a,"dijitCalendarActiveDate"),this._currentNode=a)},_onDayMouseUp:function(a){(a=a.target.parentNode)&&a.dijitDateValue&&q.remove(a,"dijitCalendarActiveDate")},
handleKey:function(a){var b=-1,d,c=this.currentFocus;switch(a.keyCode){case h.RIGHT_ARROW:b=1;case h.LEFT_ARROW:d="day";this.isLeftToRight()||(b*=-1);break;case h.DOWN_ARROW:b=1;case h.UP_ARROW:d="week";break;case h.PAGE_DOWN:b=1;case h.PAGE_UP:d=a.ctrlKey||a.altKey?"year":"month";break;case h.END:c=this.dateModule.add(c,"month",1),d="day";case h.HOME:c=new this.dateClassObj(c);c.setDate(1);break;default:return!0}d&&(c=this.dateModule.add(c,d,b));this._setCurrentFocusAttr(c);return!1},_onKeyDown:function(a){this.handleKey(a)||
(a.stopPropagation(),a.preventDefault())},onValueSelected:function(){},onChange:function(a){this.onValueSelected(a)},getClassForDate:function(){}});v._MonthDropDownButton=p("dijit.Calendar._MonthDropDownButton",u,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new v._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(a){var d=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.dropDown.set("months",
d);this.containerNode.innerHTML=(6==b("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+d[a.getMonth()]+"\x3c/div\x3e"}});v._MonthDropDown=p("dijit.Calendar._MonthDropDown",[a,d,g],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(a){this.domNode.innerHTML=
"";r.forEach(a,function(a,b){n.create("div",{className:"dijitCalendarMonthLabel",month:b,innerHTML:a},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(a){this.onChange(c.get(a.target,"month"))},onChange:function(){}});return v})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d){var u=f("dijit.CalendarLite",[a,g],{templateString:d,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(a){return a&&!isNaN(a)&&"object"==typeof a&&a.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var a=this._get("value");if(a&&!isNaN(a)){var b=
new this.dateClassObj(a);b.setHours(0,0,0,0);b.getDate()<a.getDate()&&(b=this.dateModule.add(b,"hour",1));return b}return null},_setValueAttr:function(a,b){"string"==typeof a&&(a=q.fromISOString(a));a=this._patchDate(a);if(this._isValidDate(a)&&!this.isDisabledDate(a,this.lang)){if(this._set("value",a),this.set("currentFocus",a),this._markSelectedDates([a]),this._created&&(b||"undefined"==typeof b))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(a){if(a||
0===a)a=new this.dateClassObj(a),a.setHours(1,0,0,0);return a},_setText:function(a,b){for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(a.ownerDocument.createTextNode(b))},_populateGrid:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);var a=this._patchDate(a),b=a.getDay(),d=this.dateModule.getDaysInMonth(a),e=this.dateModule.getDaysInMonth(this.dateModule.add(a,"month",-1)),f=new this.dateClassObj,g=0<=this.dayOffset?this.dayOffset:l.getFirstDayOfWeek(this.lang);g>
b&&(g-=7);if(!this.summary){var m=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a);this.gridNode.setAttribute("summary",m[a.getMonth()])}this._date2cell={};r.forEach(this.dateCells,function(m,k){var l=k+g,n=new this.dateClassObj(a),u="dijitCalendar",p=0;l<b?(l=e-b+l+1,p=-1,u+="Previous"):l>=b+d?(l=l-b-d+1,p=1,u+="Next"):(l=l-b+1,u+="Current");p&&(n=this.dateModule.add(n,"month",p));n.setDate(l);this.dateModule.compare(n,f,"date")||(u="dijitCalendarCurrentDate "+u);this.isDisabledDate(n,
this.lang)?(u="dijitCalendarDisabledDate "+u,m.setAttribute("aria-disabled","true")):(u="dijitCalendarEnabledDate "+u,m.removeAttribute("aria-disabled"),m.setAttribute("aria-selected","false"));(p=this.getClassForDate(n,this.lang))&&(u=p+" "+u);m.className=u+"Month dijitCalendarDateTemplate";u=n.valueOf();this._date2cell[u]=m;m.dijitDateValue=u;u=n.getDateLocalized?n.getDateLocalized(this.lang):n.getDate();this._setText(this.dateLabels[k],u);h.set(m,"aria-label",c.format(n,{selector:"date",formatLength:"long"}))},
this)},_populateControls:function(){var a=new this.dateClassObj(this.currentFocus);a.setDate(1);this.monthWidget.set("month",a);var b=a.getFullYear()-1,d=new this.dateClassObj;r.forEach(["previous","current","next"],function(a){d.setFullYear(b++);this._setText(this[a+"YearLabelNode"],this.dateLocaleModule.format(d,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(a){this.dateModule=a.datePackage?t.getObject(a.datePackage,
!1):p;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=a.datePackage?t.getObject(a.datePackage+".locale",!1):c},_createMonthWidget:function(){return u._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var a=this.dowTemplateString,b=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),d=0<=this.dayOffset?this.dayOffset:l.getFirstDayOfWeek(this.lang);this.dayCellsHtml=m.substitute([a,
a,a,a,a,a,a].join(""),{d:""},function(){return b[d++%7]});a=m.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[a,a,a,a,a,a].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);n.setSelectable(this.domNode,!1);a=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",a,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var a=t.hitch(this,function(a,
b,d){this[a].dojoClick=!0;return e(this[a],"click",t.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,b,d))}))});this.own(a("incrementMonth","month",1),a("decrementMonth","month",-1),a("nextYearLabelNode","year",1),a("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(a,d){var c=this.currentFocus,e=this._getNodeByDate(c);a=this._patchDate(a);this._set("currentFocus",a);this._date2cell&&0==this.dateModule.difference(c,a,"month")||(this._populateGrid(),
this._populateControls(),this._markSelectedDates([this.value]));a=this._getNodeByDate(a);a.setAttribute("tabIndex",this.tabIndex);(this.focused||d)&&a.focus();e&&e!=a&&(b("webkit")?e.setAttribute("tabIndex","-1"):e.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(a){a.stopPropagation();a.preventDefault();for(a=a.target;a&&!a.dijitDateValue&&0!==a.dijitDateValue;a=a.parentNode);a&&!k.contains(a,"dijitCalendarDisabledDate")&&this.set("value",
a.dijitDateValue)},_getNodeByDate:function(a){return(a=this._patchDate(a))&&this._date2cell?this._date2cell[a.valueOf()]:null},_markSelectedDates:function(a){function b(a,b){k.toggle(b,"dijitCalendarSelectedDate",a);b.setAttribute("aria-selected",a?"true":"false")}r.forEach(this._selectedCells||[],t.partial(b,!1));this._selectedCells=r.filter(r.map(a,this._getNodeByDate,this),function(a){return a});r.forEach(this._selectedCells,t.partial(b,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});
u._MonthWidget=f("dijit.CalendarLite._MonthWidget",a,{_setMonthAttr:function(a){var d=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,a),c=6==b("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+r.map(d,function(a){return"\x3cdiv\x3e"+a+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=c+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+d[a.getMonth()]+"\x3c/div\x3e"}});return u})},"dijit/form/TimeTextBox":function(){define("dojo/_base/declare dojo/keys dojo/query dojo/_base/lang ../_TimePicker ./_DateTimeTextBox".split(" "),
function(r,f,l,p,c,q){return r("dijit.form.TimeTextBox",q,{baseClass:"dijitTextBox dijitComboBox dijitTimeTextBox",popupClass:c,_selector:"time",value:new Date(""),maxHeight:-1,openDropDown:function(c){this.inherited(arguments);var f=l(".dijitTimePickerItemSelected",this.dropDown.domNode),h=this.dropDown.domNode.parentNode;h.scrollTop=f[0]?f[0].offsetTop-(h.clientHeight-f[0].clientHeight)/2:(h.scrollHeight-h.clientHeight)/2;this.dropDown.on("input",p.hitch(this,function(){this.set("value",this.dropDown.get("value"),
!1)}))},_onInput:function(){this.inherited(arguments);var c=this.get("displayedValue");this.filterString=c&&!this.parse(c,this.constraints)?c.toLowerCase():"";this._opened&&this.closeDropDown();this.openDropDown()}})})},"dijit/_TimePicker":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/sniff dojo/query dojo/mouse dojo/on ./_WidgetBase ./form/_ListMouseMixin".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d){return c("dijit._TimePicker",[g,d],{baseClass:"dijitTimePicker",pickerMin:"T00:00:00",pickerMax:"T23:59:59",clickableIncrement:"T00:15:00",visibleIncrement:"T01:00:00",value:new Date,_visibleIncrement:2,_clickableIncrement:1,_totalIncrements:10,constraints:{},serialize:p.toISOString,buildRendering:function(){this.inherited(arguments);this.timeMenu=this.containerNode=this.domNode},setValue:function(a){k.deprecated("dijit._TimePicker:setValue() is deprecated.  Use set('value', ...) instead.",
"","2.0");this.set("value",a)},_setValueAttr:function(a){this._set("value",a);this._showText()},_setFilterStringAttr:function(a){this._set("filterString",a);this._showText()},isDisabledDate:function(){return!1},_getFilteredNodes:function(a,b,d,c){a=this.ownerDocument.createDocumentFragment();for(b=0;b<this._maxIncrement;b++)(d=this._createOption(b))&&a.appendChild(d);return a},_showText:function(){var a=p.fromISOString;this.domNode.innerHTML="";this._clickableIncrementDate=a(this.clickableIncrement);
this._visibleIncrementDate=a(this.visibleIncrement);var b=function(a){return 3600*a.getHours()+60*a.getMinutes()+a.getSeconds()},d=b(this._clickableIncrementDate),b=b(this._visibleIncrementDate);(this.value||this.currentFocus).getTime();this._refDate=a(this.pickerMin);this._refDate.setFullYear(1970,0,1);this._clickableIncrement=1;this._visibleIncrement=b/d;a=a(this.pickerMax);a.setFullYear(1970,0,1);a=.001*(a.getTime()-this._refDate.getTime());this._maxIncrement=Math.ceil((a+1)/d);d=this._getFilteredNodes();
!d.firstChild&&this.filterString?(this.filterString="",this._showText()):this.domNode.appendChild(d)},constructor:function(){this.constraints={}},postMixInProperties:function(){this.inherited(arguments);this._setConstraintsAttr(this.constraints)},_setConstraintsAttr:function(a){for(var b in{clickableIncrement:1,visibleIncrement:1,pickerMin:1,pickerMax:1})b in a&&(this[b]=a[b]);a.locale||(a.locale=this.lang)},_createOption:function(a){var b=new Date(this._refDate),d=this._clickableIncrementDate;b.setHours(b.getHours()+
d.getHours()*a,b.getMinutes()+d.getMinutes()*a,b.getSeconds()+d.getSeconds()*a);"time"==this.constraints.selector&&b.setFullYear(1970,0,1);var c=l.format(b,this.constraints);if(this.filterString&&0!==c.toLowerCase().indexOf(this.filterString))return null;d=this.ownerDocument.createElement("div");d.className=this.baseClass+"Item";d.date=b;d.idx=a;n.create("div",{"class":this.baseClass+"ItemInner",innerHTML:c},d);c=1>a%this._visibleIncrement&&-1<a%this._visibleIncrement;a=!c&&!(a%this._clickableIncrement);
c?d.className+=" "+this.baseClass+"Marker":a&&(d.className+=" "+this.baseClass+"Tick");this.isDisabledDate(b)&&(d.className+=" "+this.baseClass+"ItemDisabled");this.value&&!f.compare(this.value,b,this.constraints.selector)&&(d.selected=!0,d.className+=" "+this.baseClass+"ItemSelected",this._selectedDiv=d,c?d.className+=" "+this.baseClass+"MarkerSelected":a&&(d.className+=" "+this.baseClass+"TickSelected"),this._highlightOption(d,!0));return d},onOpen:function(){this.inherited(arguments);this.set("selected",
this._selectedDiv)},_onOptionSelected:function(a,b){(a=a.target.date||a.target.parentNode.date)&&!this.isDisabledDate(a)&&(this._set("value",a),this.emit("input"),b&&(this._highlighted_option=null,this.set("value",a),this.onChange(a)))},onChange:function(){},_highlightOption:function(a,b){if(a){if(b)this._highlighted_option&&this._highlightOption(this._highlighted_option,!1),this._highlighted_option=a;else{if(this._highlighted_option!==a)return;this._highlighted_option=null}q.toggle(a,this.baseClass+
"ItemHover",b);q.contains(a,this.baseClass+"Marker")?q.toggle(a,this.baseClass+"MarkerHover",b):q.toggle(a,this.baseClass+"TickHover",b)}},handleKey:function(a){if(a.keyCode==h.DOWN_ARROW)return this.selectNextNode(),this._onOptionSelected({target:this._highlighted_option},!1),a.stopPropagation(),a.preventDefault(),!1;if(a.keyCode==h.UP_ARROW)return this.selectPreviousNode(),this._onOptionSelected({target:this._highlighted_option},!1),a.stopPropagation(),a.preventDefault(),!1;if(a.keyCode==h.ENTER||
a.keyCode===h.TAB){if(!this._keyboardSelected&&a.keyCode===h.TAB)return!0;this._highlighted_option&&this._onOptionSelected({target:this._highlighted_option},!0);return a.keyCode===h.TAB}},onHover:function(a){this._highlightOption(a,!0)},onUnhover:function(a){this._highlightOption(a,!1)},onSelect:function(a){this._highlightOption(a,!0)},onDeselect:function(a){this._highlightOption(a,!1)},onClick:function(a){this._onOptionSelected({target:a},!0)}})})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(r,f,l,p,c,q,n,k){new Date("X");return p("dijit.form._DateTimeTextBox",[q,n],{templateString:k,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:f.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(c,f){var e=this._isInvalidDate(c),b=this._isInvalidDate(f);if(e||b)return e&&b?0:e?-1:1;c=this.format(c,this._unboundedConstraints);f=this.format(f,this._unboundedConstraints);
e=this.parse(c,this._unboundedConstraints);b=this.parse(f,this._unboundedConstraints);return c==f?0:r.compare(e,b,this._selector)},autoWidth:!0,format:function(c,f){return c?this.dateLocaleModule.format(c,f):""},parse:function(c,f){return this.dateLocaleModule.parse(c,f)||(this._isEmpty(c)?null:void 0)},serialize:function(c,f){c.toGregorian&&(c=c.toGregorian());return l.toISOString(c,f)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(h){h=
h||{};this.dateModule=h.datePackage?c.getObject(h.datePackage,!1):r;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=h.datePackage?c.getObject(h.datePackage+".locale",!1):f;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(f){f.selector=this._selector;f.fullYear=!0;var h=l.fromISOString;"string"==typeof f.min&&(f.min=h(f.min),this.dateClassObj instanceof Date||(f.min=new this.dateClassObj(f.min)));"string"==typeof f.max&&(f.max=h(f.max),this.dateClassObj instanceof Date||(f.max=new this.dateClassObj(f.max)));this.inherited(arguments);this._unboundedConstraints=c.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(c){return!c||
isNaN(c)||"object"!=typeof c||c.toString()==this._invalidDate},_setValueAttr:function(c,f,e){void 0!==c&&("string"==typeof c&&(c=l.fromISOString(c)),this._isInvalidDate(c)&&(c=null),c instanceof Date&&!(this.dateClassObj instanceof Date)&&(c=new this.dateClassObj(c)));this.inherited(arguments,[c,f,e]);this.value instanceof Date&&(this.filterString="");!1!==f&&this.dropDown&&this.dropDown.set("value",c,!1)},_set:function(c,f){if("value"==c){f instanceof Date&&!(this.dateClassObj instanceof Date)&&
(f=new this.dateClassObj(f));var e=this._get("value");if(e instanceof this.dateClassObj&&0==this.compare(f,e))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(c){this._isInvalidDate(c)&&(c=new this.dateClassObj);this._set("dropDownDefaultValue",c)},openDropDown:function(f){this.dropDown&&this.dropDown.destroy();var h=c.isString(this.popupClass)?c.getObject(this.popupClass,!1):this.popupClass,e=this,b=this.get("value");this.dropDown=new h({onChange:function(b){e.set("value",
b,!0)},id:this.id+"_popup",dir:e.dir,lang:e.lang,value:b,textDir:e.textDir,currentFocus:this._isInvalidDate(b)?this.dropDownDefaultValue:b,constraints:e.constraints,filterString:e.filterString,datePackage:e.datePackage,isDisabledDate:function(b){return!e.rangeCheck(b,e.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(c,f){this._setValueAttr(this.parse(c,this.constraints),f,c)}})})},"jimu/dijit/_filter/TwoNumbersValueProvider":function(){define("dojo/_base/html dojo/_base/lang dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./TwoNumbersValueProvider.html dijit/form/NumberTextBox jimu/utils".split(" "),
function(r,f,l,p,c,q,n,k,h){return l([p,c,q],{templateString:n,customId:null,postCreate:function(){this.inherited(arguments);r.addClass(this.domNode,"jimu-two-numbers-filter-value-provider");this.customId=this.partObj.vpId;var c={required:!1,intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},e=f.clone(c),b;if(this.customId){c.id=this.customId+"_between";b=this.customId;var m=r.toDom('\x3clabel for\x3d"'+c.id+'" class\x3d"screen-readers-only"\x3e'+this.partObj.interactiveObj.prompt+
" "+this.partObj.interactiveObj.hint+"\x3c/label\x3e");r.place(m,this._dijit1_container)}else b=h.getUUID();e.id=b+"_and";b=r.toDom('\x3clabel for\x3d"'+e.id+'" class\x3d"screen-readers-only"\x3e'+this.nls.and+"\x3c/label\x3e");r.place(b,this._dijit2_container);this._dijit1=new k(c);this._dijit2=new k(e);this._dijit1.startup();this._dijit2.startup();this._dijit1.on("blur",function(){this._onRangeNumberBlur()}.bind(this));this._dijit2.on("blur",function(){this._onRangeNumberBlur()}.bind(this));r.setStyle(this._dijit1.domNode,
"width","100%");r.setStyle(this._dijit2.domNode,"width","100%");this._dijit1.placeAt(this._dijit1_container);this._dijit2.placeAt(this._dijit2_container)},_onRangeNumberBlur:function(){if(this._dijit1.validate()&&this._dijit2.validate()){var c=parseFloat(this._dijit1.get("value")),e=parseFloat(this._dijit2.get("value"));c>e&&(this._dijit1.set("value",e),this._dijit2.set("value",c))}},getDijits:function(){return[this._dijit1,this._dijit2]},setValueObject:function(c){this.isDefined(c.value1)&&this._dijit1.set("value",
c.value1);this.isDefined(c.value2)&&this._dijit2.set("value",c.value2)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))}:null},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();if(this.isEmptyValue()){var c={isValid:!0,type:this.partObj.valueObj.type,value1:parseFloat(this._dijit1.get("value")),value2:parseFloat(this._dijit2.get("value"))};
isNaN(c.value1)&&(c.value1=null);isNaN(c.value2)&&(c.value2=null);return c}return null},setRequired:function(c){this._dijit1.set("required",c);this._dijit2.set("required",c)}})})},"jimu/dijit/_filter/TwoDatesValueProvider":function(){define("dojo/Evented dojo/on dojo/_base/html dojo/_base/declare dojo/_base/lang ./ValueProvider dijit/_WidgetsInTemplateMixin ./DateValueSelector dojo/text!./TwoDatesValueProvider.html jimu/utils".split(" "),function(r,f,l,p,c,q,n,k,h,t){return p([q,n,r],{templateString:h,
customId:null,postCreate:function(){this.inherited(arguments);this.customId=this.partObj.vpId;l.addClass(this.domNode,"jimu-two-dates-filter-value-provider");var e={runtime:this.runtime,popupInfo:this.popupInfo,_fieldInfo:this.fieldInfo,style:{width:"100%"}},b=c.clone(e),h;this.customId?(e.customId=this.customId+"_between",e.prompt=this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint,h=this.customId):h=t.getUUID();b.customId=h+"_and";b.prompt=this.nls.and;this.runtime&&(e.virtualDates=
this.partObj.interactiveObj.virtualDates1,b.virtualDates=this.partObj.interactiveObj.virtualDates2);this._dijit1=new k(e,this._dijitDiv1);this._dijit2=new k(b,this._dijitDiv2);this.own(f(this._dijit1,"change",c.hitch(this,function(a){this.emit("change",a,"start")})));this.own(f(this._dijit2,"change",c.hitch(this,function(a){this.emit("change",a,"end")})))},_initDateSelectors:function(){},_onDateValueSelectorChanged:function(){this.emit("change")},getDijits:function(){return[this._dijit1,this._dijit2]},
setValueObject:function(c){this._setValueObject(this._dijit1,c,1);this._setValueObject(this._dijit2,c,2)},_setValueObject:function(c,b,f){var a="value"+f;if(this.isDefined(b[a])){var e={enableTime:b["enableTime"+f],timeAccuracy:b["timeAccuracy"+f],value:null,virtualDate:""};e.value=b[a];e.virtualDate=b["virtualDate"+f];c.setValueObject(e)}},getValueObject:function(){if(this.isValidValue()){var c=this._dijit1.getValueObject(),b=this._dijit2.getValueObject();if(c.value&&b.value)return{isValid:!0,type:this.partObj.valueObj.type,
enableTime1:c.enableTime?!0:!1,timeAccuracy1:c.timeAccuracy?c.timeAccuracy:"",enableTime2:b.enableTime?!0:!1,timeAccuracy2:b.timeAccuracy?b.timeAccuracy:"",value1:c.value,value2:b.value,virtualDate1:c.virtualDate,virtualDate2:b.virtualDate}}return null},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value1:null,value2:null,virtualDate1:null,virtualDate2:null}:null},getStatus:function(){return 1===this._dijit1.getStatus()&&
1===this._dijit2.getStatus()?1:-1===this._dijit1.getStatus()||-1===this._dijit2.getStatus()?-1:0},setRequired:function(c){this._dijit1.set("required",c);this._dijit2.set("required",c)}})})},"jimu/dijit/_filter/ListValueProvider":function(){define("dojo/aspect dojo/Deferred dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/_base/declare ./ValueProvider dojo/store/Memory jimu/utils dijit/form/FilteringSelect".split(" "),function(r,f,l,p,c,q,n,k,h,t,e){return n([k],{templateString:"\x3cdiv\x3e\x3c/div\x3e",
codedValues:null,staticValues:null,showNullValues:!1,layerDataChanged:!1,ifDropDown:!1,customId:null,postCreate:function(){this.inherited(arguments);p.addClass(this.domNode,"jimu-filter-list-value-provider");this.customId=this.partObj.vpId;this._initValueSelect();this._uniqueValueCache={};this.noDataTips='\x3cdiv class\x3d"error-tip-section" style\x3d"display: block;"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text"\x3e'+this.nls.noFilterValueTip+
"\x3c/span\x3e\x3c/div\x3e";var b=new h({idProperty:"id",data:[]});this.valuesSelect.set("store",b);this.isNumberField=t.isNumberField(this.fieldInfo.type);!this.staticValues&&"function"===typeof this.valuesSelect._onDropDownMouseDown&&(!this.codedValues||this.codedValues&&this.filterCodedValue)&&(this.own(r.before(this.valuesSelect,"_onDropDownMouseDown",l.hitch(this,this._onBeforeDropDownMouseDown))),this.own(q(document.body,"click",l.hitch(this,this._onBodyClick))),this.layerInfo&&this.layerInfo.getLayerObject().then(l.hitch(this,
function(b){b.on("edits-complete",l.hitch(this,function(){this.layerDataChanged=!0}))})))},_initValueSelect:function(){var b={searchAttr:"label",required:!1,intermediateChanges:!0};this.customId&&(b["aria-label"]=this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint);this.valuesSelect=new e(b);this.valuesSelect.startup();this.valuesSelect.on("input",l.hitch(this,this._onFilteringSelectInput));p.setStyle(this.valuesSelect.domNode,"width","100%");this.valuesSelect.placeAt(this.domNode)},
_onFilteringSelectInput:function(){this.emit("change")},_getCodedValueLabelsBySubTypeId:function(){var b=this.getDropdownFilterPartsObj();return this.getCodedValueListByPartsObj(this.layerDefinition,this.fieldName,b,this.codedValues)},_onBeforeDropDownMouseDown:function(){this.ifDropDown=!0;this._tryUpdatingUniqueValues(void 0,!0);return arguments},_onBodyClick:function(b){b=b.target||b.srcElement;b===this.domNode||p.isDescendant(b,this.domNode)||this.msgDiv&&p.setStyle(this.msgDiv,"display","none")},
getDijits:function(){return[this.valuesSelect]},isValidValue:function(){return 0<this.getStatus()},getStatus:function(){var b=this.valuesSelect.get("item");if(b&&void 0!==b.value){if(this.isNumberField&&!t.isValidNumber(b.value)&&"value"===this.partObj.valueObj.type){var c=parseFloat(b.value);return t.isValidNumber(c)?(b.value=c,this._getStatusForDijit(this.valuesSelect)):-1}return this._getStatusForDijit(this.valuesSelect)}return 0},_getStatusForDijit:function(b){return b.validate()?b.get("DisplayedValue")?
1:0:-1},setValueObject:function(b){return this.staticValues?this._setValueForStaticValues(b.value,this.staticValues):this.codedValues?this.filterCodedValue?this._tryUpdatingUniqueValues(b.value,!1):this._setValueForStaticValues(b.value,this.codedValues):this._tryUpdatingUniqueValues(b.value,!1)},getValueObject:function(){if(this.isValidValue()){var b=this.valuesSelect.get("item").value;return{isValid:!0,type:this.partObj.valueObj.type,value:b}}return null},tryGetValueObject:function(){return this.isValidValue()?
this.getValueObject():this.isEmptyValue()?{isValid:!0,type:this.partObj.valueObj.type,value:"string"===this.shortType?"":null}:null},setRequired:function(b){this.valuesSelect.set("required",b)},_setValueForStaticValues:function(b,e){var a=null,f=-1,a=null;e&&(a=c.map(e,l.hitch(this,function(a,c){a={id:c,value:a.value,label:a.label};a.value+""===b+""&&(f=c);return a})),this.valuesSelect.store.setData(a),0<=f&&(a=this.valuesSelect.store.get(f))&&this.valuesSelect.set("item",a),this._checkIfNoData())},
_uniqueValueLoadingDef:null,_uniqueValueLoadingExpr:"",_uniqueValueCache:null,_tryUpdatingUniqueValues:function(b,c){var a=new f;if(this.valuesSelect._opened)this._checkIfNoData(),a.resolve();else{var e=this.getDropdownFilterExpr();e!==this._uniqueValueLoadingExpr||this.layerDataChanged?(this.valuesSelect.readOnly=!0,this._uniqueValueLoadingDef&&(this._uniqueValueLoadingDef.reject(),this._uniqueValueLoadingDef=null),this._uniqueValueLoadingExpr=e,this._uniqueValueLoadingDef=this._getUniqueValues(e),
this._uniqueValueLoadingDef.then(l.hitch(this,function(d){this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._setValueForUniqueValues(b,d),this._hideLoadingIcon(),c&&this.valuesSelect.toggleDropDown(),this._checkIfNoData(),a.resolve())}),l.hitch(this,function(b){console.error(b);this.domNode&&(this._uniqueValueLoadingDef=null,this.valuesSelect.readOnly=!1,this._hideLoadingIcon(),this._checkIfNoData(),a.reject(b))}))):(this._checkIfNoData(),a.resolve())}return a},_setValueForUniqueValues:function(b,
e){e.sort(function(a,b){return a.value<b.value?-1:a.value===b.value?0:1});this.showNullValues||(e=c.filter(e,l.hitch(this,function(a){return"\x3cNull\x3e"!==a.value&&null!==a.value})));if(void 0===b){var a=this.getValueObject();a&&(b=a.value)}var f=-1,a=null;e=c.map(e,l.hitch(this,function(a,c){var d={id:c,value:a.value,label:a.label};a.value+""===b+""&&(f=c);return d}));this.valuesSelect.store.setData(e);0<=f&&(a=this.valuesSelect.store.get(f));this.valuesSelect.set("item",a)},_checkIfNoData:function(){this.runtime&&
this.ifDropDown&&(this.ifDropDown=!1,0===this.valuesSelect.store.data.length&&(this.msgDiv?p.setStyle(this.msgDiv,"display","block"):(this.msgDiv=document.createElement("div"),p.addClass(this.msgDiv,"jimu-filter-list-value-provider-tip-container"),this.msgDiv.innerHTML=this.noDataTips,this.valuesSelect.domNode.parentNode.appendChild(this.msgDiv))))},_showLoadingIcon:function(){p.addClass(this.valuesSelect.domNode,"loading")},_hideLoadingIcon:function(){p.removeClass(this.valuesSelect.domNode,"loading")},
_getUniqueValues:function(b){var c=new f;this._uniqueValueCache[b]&&!this.layerDataChanged?c.resolve(this._uniqueValueCache[b]):(this._showLoadingIcon(),t.getUniqueValues(this.url,this.fieldName,b,this.layerDefinition,this.fieldPopupInfo).then(l.hitch(this,function(a){this.domNode&&(this._uniqueValueCache[b]=a,c.resolve(a),this._hideLoadingIcon())}),l.hitch(this,function(a){this.domNode&&(c.reject(a),this._hideLoadingIcon())})));this.layerDataChanged=!1;return c}})})},"jimu/dijit/_filter/AdvancedListValueProvider":function(){define("dojo/Deferred dojo/_base/lang dojo/on dojo/keys dojo/Evented dojo/_base/html dojo/_base/array dojo/_base/declare dojo/query ./ValueProvider ./AdvancedListValueSelect dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./AdvancedListValueProvider.html jimu/utils jimu/dijit/_filter/pageControlForQuery jimu/dijit/Popup".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u){return k([t,b,m,c],{templateString:a,codedValues:null,staticValues:null,showNullValues:!1,cbxPopup:null,pageSize:1E3,pageIndex:1,emptyStr:"",postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.emptyStr=window.apiNls.widgets.FeatureTable.empty},postCreate:function(){this.inherited(arguments);this.noDataTips='\x3cdiv class\x3d"error-tip-section" style\x3d"display: block;"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text"\x3e'+
this.nls.noFilterValueTip+"\x3c/span\x3e\x3c/div\x3e";q.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");"ADVANCED_LIST_VALUE_PROVIDER"===this.providerType?(this.controlType="multipleDynamic",this.checkedNumDiv.style.display="block"):"LIST_VALUE_PROVIDER"===this.providerType?(this.controlType="uniqueDynamic",this.checkedNameDiv.style.display="block"):(this.runtime&&"dropdown"===this.selectUI&&("UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType?this.checkedNameDiv.style.display=
"block":this.checkedNumDiv.style.display="block"),this.controlType="MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"multiplePredefined":"uniquePredefined");this.selectType="MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"multiple":"UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType?"unique":"LIST_VALUE_PROVIDER"===this.providerType?"unique":"multiple";this.disPlayLabel="value";!this.runtime||"multiplePredefined"!==this.controlType&&"uniquePredefined"!==this.controlType||(this.disPlayLabel=
"alias");!this.runtime||"multipleDynamic"!==this.controlType&&"uniqueDynamic"!==this.controlType||(this.isLoadDataAdvanced=!0);this.runtime&&"esriFieldTypeDate"===this.fieldInfo.type&&this.partObj.fieldObj&&(this.fieldPopupInfo={format:{dateFormat:this.partObj.fieldObj.dateFormat}});this.isNumberField=g.isNumberField(this.fieldInfo.type);this.pageControlForQuery||(this.pageControlForQuery=new d({pageSize:this.pageSize,pageIndex:1,layerUrl:this.url,fieldInfo:this.fieldInfo,queryWhere:"1\x3d1",layerDefinition:this.layerDefinition,
fieldPopupInfo:this.fieldPopupInfo,isNumberField:this.isNumberField}),this.pageControlForQuery.on("query_getNewExpr",f.hitch(this,this._resetPageControlNewExpr)));this.listSelect||(this._resetPromptLabel(!1),this.listSelectDataList=this.partObj&&this.partObj.valueObj&&this.partObj.valueObj.value?this.partObj.valueObj.value:[],this.listSelect=new e({label:this.promptLabel.innerHTML,emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,selectUI:this.selectUI,controlType:this.controlType,
selectType:this.selectType,dataList:this.listSelectDataList,selectedDataList:[],isNumberField:this.isNumberField}),f.isArray(this.listSelectDataList)?this.getCheckedList(this.listSelectDataList):(this.listSelect.checkedList=[this.listSelectDataList],this.listSelect._updateCheckedLabelListFromCheckedList()),this.listSelect.on("advancedListValueSelect_itemChecked",f.hitch(this,this._createTarget)),this.listSelect.on("advancedListValueSelect_itemUnChecked",f.hitch(this,this._destoryTarget)),this.listSelect.on("advancedListValueSelect_addNextPage",
f.hitch(this,this._addNextPage)),this.listSelect.on("advancedListValueSelect_searchKey",f.hitch(this,this._searchKey)),this.listSelect.on("advancedListValueSelect_searchKeyLocal",f.hitch(this,this._searchKeyLocal)),this.listSelect.on("advancedListValueSelect_itemsConfirmed",f.hitch(this,function(){this.cbxPopup&&this.cbxPopup.domNode&&("block"===q.getStyle(this.cbxPopup.domNode,"display")&&(this._resetListSelectState(this),this.cbxPopup.hide()),this.checkedBtn.focus())})),this.own(l(this.checkedBtn,
"keydown",f.hitch(this,function(a){q.hasClass(a.target||a.srcElement,"checkBtn")&&a.keyCode===p.ENTER&&this._checkedBtnEvent()}))),this.staticValues||"function"!==typeof this._checkedBtnEvent||(!this.codedValues||this.codedValues&&this.filterCodedValue)&&this.layerInfo&&this.layerInfo.getLayerObject().then(f.hitch(this,function(a){a.on("edits-complete",f.hitch(this,function(){this.layerDataChanged=!0}))})));"dropdown"===this.selectUI?(q.setStyle(this.checkedBtn,"display","block"),this._multipleSelectProviderEventHandler=
f.hitch(this,this._multipleSelectProviderEvent),document.addEventListener("click",this._multipleSelectProviderEventHandler,{capture:!0})):this.listSelect.placeAt(this.listContent)},_resetPromptLabel:function(a){a=a?this.nls.noFilterValueTip+" ":"";"undefined"!==typeof this.promptLabel&&(this.promptLabel.innerHTML=g.sanitizeHTML(this.partObj.interactiveObj.prompt+" "+this.partObj.interactiveObj.hint+a))},filterExpr:null,_resetPageControlNewExpr:function(){var a=this.getDropdownFilterExpr(this.partObj.widgetId);
return this.filterExpr!==a?(this.pageControlForQuery.reset(),this.filterExpr=this.pageControlForQuery.cascadeFilterExprs=a,!0):!1},_multipleSelectProviderEvent:function(a){a=a.target||a.srcElement;if(this.cbxPopup&&this.cbxPopup.domNode){if(q.isDescendant(a,this.cbxPopup.domNode)||q.isDescendant(a,this.checkedBtn))return;"block"===q.getStyle(this.cbxPopup.domNode,"display")&&(this._resetListSelectState(this),this.cbxPopup.hide())}else!q.isDescendant(a,this.checkedBtn)&&this.isPopupLoading&&(this.isLoadDataAdvanced=
!0);this.msgDiv&&q.setStyle(this.msgDiv,"display","none")},_checkedBtnEvent:function(){this._showPopup()},_onBeforeDropDownMouseDown:function(){this._tryUpdatingUniqueValues(void 0,!0);return arguments},_isRestSelectList:!1,_resetListSelectState:function(a){"block"===q.getStyle(a.listSelect.searchKeyInput,"display")&&("multipleDynamic"===this.controlType&&this.listSelect.showAllList(),a.listSelect.listContainer.scrollTop=0,a.listSelect.queryState=!0,a.listSelect.valueInput.set("value",""),this._isRestSelectList=
!0)},_createTarget:function(a){this._checkedChanged(1,a);this.cbxPopup&&("uniqueDynamic"===this.controlType||"uniquePredefined"===this.controlType)&&this.cbxPopup.domNode&&(this._resetListSelectState(this),this.cbxPopup.close())},_destoryTarget:function(a){this._checkedChanged(-1,a)},_checkedChanged:function(a,b){if("multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType&&this.runtime&&"dropdown"===this.selectUI)b&&(a=parseInt(this.checkedNum.innerText,10)+a,this.checkedNum.innerText=
0<a?a:0);else if("uniqueDynamic"===this.controlType||"uniquePredefined"===this.controlType&&this.runtime&&"dropdown"===this.selectUI)"uniqueDynamic"===this.controlType&&(b===this.emptyStr?q.addClass(this.checkedNameDiv,"checkedEmptyNameDiv"):q.removeClass(this.checkedNameDiv,"checkedEmptyNameDiv")),a=b?b:this._getCheckedNameDivText(),this._setCheckedNameDivText(a);this.listSelect.set("displayedValue","12345678");this.emit("change")},_clearCheckedTxt:function(){this.runtime&&"dropdown"===this.selectUI&&
("multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType?this.checkedNum.textContent?this.checkedNum.textContent=0:this.checkedNum.innerText=0:"uniqueDynamic"!==this.controlType&&"uniquePredefined"!==this.controlType||this._setCheckedNameDivText(""),this.valueList=[],this.listSelect.checkedList=[],this.listSelect.checkedLabelList=[],this.listSelect.valueInput.set("value",""),"multipleDynamic"===this.controlType&&this.listSelect.showAllList());this.listSelect.set("displayedValue",
"12345678");this.emit("change")},_layerDataChangedCallback:function(){this.layerDataChanged&&(this.pageControlForQuery.reset(),this.listSelect.ifFristPage=!0,this.layerDataChanged=!1)},_addNextPage:function(){this.listSelect&&(this._showLoadingIcon(),this._layerDataChangedCallback(),this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage).then(f.hitch(this,function(a){this.listSelect.isCacheFinish=this.pageControlForQuery._isUniqueValueCacheFinish;this.listSelect.ifFristPage&&this._checkIfNoData(a)||
(this.listSelect.setCBXData(a,!0,this.listSelect.ifFristPage),this._hideLoadingIcon())}),f.hitch(this,function(a){console.log(a);this.listSelect.queryState=!1;this._hideLoadingIcon()})))},_searchKey:function(a){this.listSelect&&(this._showLoadingIcon(),this._layerDataChangedCallback(),this.pageControlForQuery._searchKey(a).then(f.hitch(this,function(a){this.listSelect.setCBXContentBySearch(a);this._resetPopupStyles(!a.length);this._hideLoadingIcon()}),f.hitch(this,function(a){console.log(a);this._hideLoadingIcon()})))},
_searchKeyLocal:function(a,b){if(this.listSelect){"uniqueDynamic"===this.controlType&&this._isRestSelectList&&(this.listSelect.keyQueryMode=!1,this._isRestSelectList=this.listSelect.cacheQueryMode=!1);this._showLoadingIcon();var d=this.pageControlForQuery._searchKeyLocal(a);""===a&&0===d.length?(this.layerDataChanged=!0,this._layerDataChangedCallback(),this._addNextPage()):this.listSelect.setCBXContentBySearch(d,b);this._resetPopupStyles(!0);this._hideLoadingIcon()}},queryByPage:function(){var a=
this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage);a.then(f.hitch(this,function(b){a.resolve(b)}),f.hitch(this,function(b){console.log(b);a.reject(b)}))},getCheckedList:function(a){this.listSelect.checkedList=[];this.listSelect.checkedLabelList=[];n.forEach(a,f.hitch(this,function(a){var b;f.isObject(a)?a.isChecked&&(b=a.value):b=a;if(b||0===b)b=this.isNumberField?parseFloat(b):b,this.listSelect.checkedList.push(b)}))},getCheckedStrsList:function(a){var b=[];n.forEach(a,f.hitch(this,
function(a){var d;f.isObject(a)?a.isChecked&&(d=a[this.disPlayLabel]):d=a;(d||0===d)&&b.push(d)}));return b},showContent:function(a){var b=new r;this.getCheckedList(this.valueList);this.listSelect.codedValues=!1;this.listSelect.disPlayLabel="value";var d;if("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType)return this.runtime&&(this.listSelect.disPlayLabel="alias"),d=this._checkIfNoData(this.valueList),d||(this.listSelect.setCBXData(this.valueList,!0,a),this.listSelect._updateCheckedLabelListFromCheckedList()),
this._hideLoadingIcon(),b.resolve(d),b;if(this.staticValues)return d=this._setValueForStaticValues(this.staticValues),b.resolve(d),b;if(this.codedValues)if(this.filterCodedValue)this.listSelect.codedValues=!0;else return d=this._setValueForStaticValues(this.codedValues),b.resolve(d),b;this._showLoadingIcon();if("multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType)this._layerDataChangedCallback(),this.pageControlForQuery.queryByPage(a).then(f.hitch(this,function(c){this.listSelect.isCacheFinish=
this.pageControlForQuery._isUniqueValueCacheFinish;c=this._handleCodedValue(c);(d=this._checkIfNoData(c))||this.listSelect.setCBXData(c,!0,a);this._hideLoadingIcon();b.resolve(d)}),f.hitch(this,function(a){console.log(a);this._hideLoadingIcon();b.reject(a)}));return b},_handleCodedValue:function(a){this.listSelect.disPlayLabel="label";if(!this.codedValues)return this.listSelect._updateCheckedLabelListFromCheckedList(),a;this.pageControlForQuery._codedvalueCache=a;"uniqueDynamic"===this.controlType&&
this._setCheckedName(this.listSelect.checkedList?this.listSelect.checkedList[0]:"",a);this.listSelect._updateCheckedLabelList(this.codedValues);return a},_showDropdown:function(a){var b=q.position(a.target),d;d=this.isInFilterSet?this.domNode.parentNode.parentNode.parentNode:this.domNode.parentNode;var c=q.position(d);if("none"!==q.getStyle(this.listContentPopup,"display"))q.setStyle(this.listContentPopup,"display","none");else{n.forEach(h(".value-type-popup",d),function(a){q.setStyle(a,"display",
"none")},this);q.place(this.listContentPopup,d);var e;e=q.hasClass(h(".desktop-add-section",d.parentNode)[0],"hidden")?-5:30;e=b.y-c.y-d.parentNode.scrollTop+e;e+170>d.parentNode.scrollHeight&&(e=d.parentNode.scrollHeight-170-40);window.isRTL?b=b.x-c.x+20:(b=b.x-c.x-100-90,b+150>d.clientWidth&&(b=d.clientWidth-150));q.setStyle(this.listContentPopup,{display:"block",left:b+"px",top:e+"px"});a.stopPropagation()}},_calculatePopup:function(){var a=q.position(this.domNode.parentNode),b=q.position(document.body).h,
d=a.y+30;b-d<this._cbxHeight&&(d=a.y-this._cbxHeight);return{left:a.x,top:d}},_cbxWidth:210,_cbxHeight:362,popupIsNoData:!1,isPopupLoading:!1,isLoadDataAdvanced:!1,_showPopup:function(){if(!this.isPopupLoading)if(this.cbxPopup&&this.cbxPopup.domNode&&"block"===q.getStyle(this.cbxPopup.domNode,"display"))this._resetListSelectState(this),this.cbxPopup.hide();else{var a=this._resetPageControlNewExpr();a&&this.cbxPopup&&(this.cbxPopup.close(),this._clearCheckedTxt());if(a||this.cbxPopup){var b=this._calculatePopup();
this._cbxWidth=q.getStyle(this.checkedBtn,"width");if(!a&&this.cbxPopup&&this.cbxPopup.domNode&&!this.layerDataChanged)this.popupIsNoData?this._checkIfNoData([]):(this.cbxPopup.show(),this._resetPopupStyles(),this.listSelect.valueInput&&"block"===q.getStyle(this.listSelect.searchKeyInput,"display")?this.listSelect.valueInput.focus():this.listSelect.listContent.focus(),this.listSelect.queryState=!1);else{this.isPopupLoading=!0;this.isLoadDataAdvanced||this._showDataQueryingIcon();var d=this.showContent(!0);
d.then(f.hitch(this,function(a){this.isPopupLoading=!1;this._hideDataQueryingIcon();(this.popupIsNoData=a)?this._clearCheckedTxt():(this.cbxPopup=new u({width:this._cbxWidth,height:this._cbxHeight,content:this.listSelect.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:b.left,top:b.top},hiddenAfterInit:this.isLoadDataAdvanced,useFocusLogic:!1,onClose:f.hitch(this,function(){this.cbxPopup.hide();return!1}),buttons:[]}),this.cbxPopup.setDomNodeStyls({"border-radius":0,
border:"1px solid #999"}),this.cbxPopup.on("popupHasInitedSuccessfully",f.hitch(this,function(a){this._resetPopupStyles(!1,!0);a||(this.listSelect.valueInput&&"block"===q.getStyle(this.listSelect.searchKeyInput,"display")?this.listSelect.valueInput.focus():this.listSelect.listContent.focus())})));this.isLoadDataAdvanced&&(this.isLoadDataAdvanced=!1)}),f.hitch(this,function(a){this.isPopupLoading=!1;console.log(a);d.reject(a)}))}}else q.setStyle(this.msgDiv,"display","block")}},_itemContainerH:300,
_resetPopupStyles:function(a,b){var d=this._itemContainerH,c=q.getStyle(this.listSelect.listContent,"height");0===c&&this.cbxPopup&&this.cbxPopup.domNode&&"none"===q.getStyle(this.cbxPopup.domNode,"display")&&(c=this.popupInitHeight);b&&(this.popupInitHeight=c);!a||this.listSelect.codedValues||this.pageControlForQuery._isUniqueValueCacheFinish||(c+=25);this.pageControlForQuery._isUniqueValueCacheFinish&&"block"===q.getStyle(this.listSelect.noDataTips,"display")&&(c+=30);d=c<d?c:d;q.setStyle(this.listSelect.listContainer,
"height",d+"px");q.setStyle(this.listSelect.selectedContainer,"height",d+30+"px");"multipleDynamic"===this.controlType?d=d+30+30:"uniqueDynamic"===this.controlType&&(d+=30);this._cbxHeight=d+10;a=this._calculatePopup();this._cbxWidth=q.getStyle(this.checkedBtn,"width");this.cbxPopup.setCustomPosition(a.left,a.top,this._cbxWidth,this._cbxHeight);this._resetItemWidth()},_resetItemWidth:function(){var a=this._cbxWidth-20;"uniqueDynamic"===this.controlType||this.runtime&&"uniquePredefined"===this.controlType&&
"dropdown"===this.selectUI||!this.runtime&&("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType)||(a=!this.runtime||"dropdown"===this.selectUI||"uniquePredefined"!==this.controlType&&"multiplePredefined"!==this.controlType?a-30:a-15);window.isRTL&&(a-=3);this.listSelect._itemLabelW=a;h(".item .label",this.listSelect.listContent).style({"max-width":a+"px"})},_setValueForStaticValues:function(a){this.listSelect.codedValues=!0;this.listSelect._updateCheckedLabelList(this.codedValues);
if(a){this.pageControlForQuery._codedvalueCache=a;var b=this._checkIfNoData(a);b||(this.listSelect.disPlayLabel="label",this.listSelect.setCBXData(a,!0,!0));return b}return!1},_checkIfNoData:function(a){if(this.runtime&&"dropdown"===this.selectUI){if(a&&0<a.length)return this._resetPromptLabel(!1),!1;this.msgDiv?q.setStyle(this.msgDiv,"display","block"):(this.msgDiv=document.createElement("div"),q.addClass(this.msgDiv,"jimu-filter-list-value-provider-tip-container"),this.msgDiv.innerHTML=this.noDataTips,
this.checkedBtn.parentNode.appendChild(this.msgDiv));this._resetPromptLabel(!0);return!0}this._resetPromptLabel(!1);return!1},getDijits:function(){return[this.listSelect]},_setCheckedName:function(a,b){var d=a;if(b=b?b:this.codedValues){for(var c=!1,e=0;e<b.length;e++){var f=b[e];if(f.value===a){d=f.label;c=!0;break}}c||(d=this.emptyStr,this.valueList=[],this.listSelect&&(this.listSelect.checkedList=[],this.listSelect.checkedLabelList=[]))}else void 0===a?(d=this.emptyStr,q.addClass(this.checkedNameDiv,
"checkedEmptyNameDiv")):q.removeClass(this.checkedNameDiv,"checkedEmptyNameDiv");this._setCheckedNameDivText(d)},setValueObject:function(a){a.value=a.value||0===a.value?a.value:[];this.valueList=a.value;this.enableEmpty=a.enableEmpty;this.listSelect.enableEmpty=a.enableEmpty;if("multipleDynamic"===this.controlType)this.checkedNum.innerText=this.valueList.length,this.isLoadDataAdvanced&&this._checkedBtnEvent();else if("uniqueDynamic"===this.controlType){a=this.valueList;f.isArray(a)&&0===a.length&&
(a=void 0);this._setCheckedName(a);this.valueList=[this.valueList];if(a&&"esriFieldTypeDate"===this.fieldInfo.type){var b=g.getDateByDateTimeStrAndFormat(a,this.fieldPopupInfo);a=g.getDateTimeStrByFieldInfo(b,this.fieldPopupInfo);b=g.localizeDateByFieldInfo(b,this.fieldPopupInfo);this._setCheckedName(b);this.valueList=[a]}this.isLoadDataAdvanced&&this._checkedBtnEvent()}else this.emptyStr=a.emptyLabel?a.emptyLabel:this.emptyStr,this.listSelect.emptyStr=this.emptyStr,this.runtime&&"dropdown"===this.selectUI&&
(b=[],"value"===this.disPlayLabel?(this.getCheckedList(this.valueList),b=this.listSelect.checkedList):b=this.getCheckedStrsList(this.valueList),"uniquePredefined"===this.controlType?0<this.listSelect.checkedList.length?this._setCheckedNameDivText(b[0]):this._setCheckedNameDivText(a.enableEmpty?this.emptyStr:""):this.checkedNum.innerText=b.length),this.showContent(!0),setTimeout(f.hitch(this,function(){this._cbxWidth=q.getStyle(this.listSelect.listContent,"width");this._resetItemWidth()}),50)},_getCheckedNameDivText:function(){return this.checkedNameDiv.textContent||
this.checkedNameDiv.innerText||""},_setCheckedNameDivText:function(a){this.isNumberField&&"number"===typeof a&&(a=g._getValues(this.layerDefinition,this.fieldPopupInfo,this.fieldName,[a])[0].label);this.checkedNameDiv.textContent?this.checkedNameDiv.textContent=a:this.checkedNameDiv.innerText=a},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();if(this.isEmptyValue()){var a=null,a="multipleDynamic"===this.controlType||"multiplePredefined"===this.controlType?[]:"string"===
this.shortType?"":null;return{isValid:!0,type:this.partObj.valueObj.type,value:a}}return null},getValueObject:function(){if(this.isValidValue()){var a;a="multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType?this.listSelect.getListCheckedValues():this.listSelect.getListValues();"uniqueDynamic"===this.controlType&&(a=f.isArray(a)?a[0]:a);return{isValid:!0,type:this.partObj.valueObj.type,value:a}}return null},setRequired:function(a){this.listSelect.set("required",a)},_showDataQueryingIcon:function(){this._validatingNode||
(this._validatingNode=q.create("div",{"class":"jimu-circle-loading"},this.checkedBtn));q.setStyle(this._validatingNode,"display","block")},_hideDataQueryingIcon:function(){this._validatingNode&&q.setStyle(this._validatingNode,"display","none")},_showLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&q.addClass(this.listSelect.listContainer,"jimu-circle-loading")},_hideLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&q.removeClass(this.listSelect.listContainer,
"jimu-circle-loading")},destroy:function(){this._multipleSelectProviderEventHandler&&document.removeEventListener("click",this._multipleSelectProviderEventHandler,{capture:!0});this.cbxPopup&&this.cbxPopup.domNode&&(this.cbxPopup.onClose=f.hitch(this,function(){return!0}),this.cbxPopup.close());this.inherited(arguments)},destroyProvider:function(){this.listSelect&&this.listSelect.destroy();this.listSelect=null}})})},"jimu/dijit/_filter/AdvancedListValueSelect":function(){define("dojo/_base/lang dojo/Evented dojo/_base/html dojo/_base/declare dijit/_WidgetBase dojo/on dojo/keys dojo/query dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./AdvancedListValueSelect.html jimu/utils".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b){return p([c,h,t,f],{templateString:e,selectType:null,dataList:[],checkedList:[],checkedLabelList:[],_itemLabelW:215,ifFristPage:!0,queryState:!0,isCacheFinish:!1,keyQueryMode:!1,cacheQueryMode:!1,emptyStr:"",postMixInProperties:function(){this.inherited(arguments);this.jimuCommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder;this.noDataNls=window.apiNls.widgets.FeatureTable.noData},postCreate:function(){this.inherited(arguments);this.inputType="unique"===
this.selectType?"radio":"checkbox";if("multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType)l.addClass(this.listContainer,"items-setting-dropdown-content"),this.searchKeyInput.style.display="block";"uniqueDynamic"===this.controlType&&l.addClass(this.listContainer,"items_content_no_selected_toggle");this.runtime?(l.addClass(this.listContainer,"items-widget-content"),"dropdown"!==this.selectUI&&(l.addClass(this.listContainer,"items-widget-expaned-content"),l.addClass(this.listContent,
"jimu-multiple-items-expanded-list"),l.setAttr(this.listContent,"aria-label",this.label),l.addClass(this.listContent,b.lastFocusNodeClassInDOM),l.removeAttr(this.multipleSelect,"tabindex"))):(l.addClass(this.listContainer,"items-setting-popup-content"),this.searchKeyInput.style.display="block");this.runtime||"predefined"!==this.controlType||(l.addClass(this.listContainer,"items-setting-dropdown-content"),l.addClass(this.listContainer,"items_content_no_selected_toggle"),this.searchKeyInput.style.display=
"block");this._addCBXClickEvent();this._addCBXHoverEvent();this.disPlayLabel="value";!this.runtime||"multiplePredefined"!==this.controlType&&"uniquePredefined"!==this.controlType||(this.disPlayLabel="alias");"multipleDynamic"===this.controlType&&(this.selectedToggleDiv.style.display="block",this.selectedToggle=k(".showAllIcon",this.selectedToggleDiv)[0],this.own(q(this.selectedToggleDiv,"click",r.hitch(this,"_toggleFilter"))),this.own(q(this.selectedToggleDiv,"keydown",r.hitch(this,function(b){b.keyCode===
n.ENTER&&this._toggleFilter(b)}))),this._addSelectedContainerEvent());this._addKeyDownEvent()},_addKeyDownEvent:function(){this.own(q(this.multipleSelect,"keydown",r.hitch(this,function(b){var a=b.which||b.keyCode,c=b.target;if(a===n.ESCAPE||"dropdown"===this.selectUI&&("INPUT"===c.tagName&&b.shiftKey&&a===n.TAB||("multipleDynamic"===this.controlType&&l.hasClass(c,"clearAllSelectedIcon")||"multipleDynamic"!==this.controlType&&l.hasClass(c,"item"))&&!b.shiftKey&&a===n.TAB))b.preventDefault(),this.currentHoverItem&&
(l.removeClass(this.currentHoverItem,"active"),this.currentHoverItem=null),this.emit("advancedListValueSelect_itemsConfirmed")})));this.own(q(this.listContent,"focus",r.hitch(this,function(){b.isInNavMode()&&(this.currentItem=(this.currentItem=this.getCurrentItem())?this.currentItem:this._getCheckInputItems()[0],this.currentHoverItem=this.currentItem.parentNode,"dropdown"===this.selectUI?this.currentHoverItem.focus():this._isFocusFirstItem=!0,l.addClass(this.currentHoverItem,"active"),setTimeout(r.hitch(this,
function(){l.addClass(this.currentHoverItem,"active")}),10))})));this.own(q(this.listContent,"blur",r.hitch(this,function(){this.currentHoverItem&&l.removeClass(this.currentHoverItem,"active")})));this.own(q(this.showAllIconBtn,"keydown",r.hitch(this,function(b){b.shiftKey&&b.keyCode===n.TAB&&(b.preventDefault(),"block"===l.getStyle(this.selectedContainer,"display")?this.selectedListContent.focus():this.listContent.focus())})));this.own(q(this.listContent,"keydown",r.hitch(this,function(c){if(b.isInNavMode()){var a=
c.which||c.keyCode;-1<[n.SPACE,n.UP_ARROW,n.DOWN_ARROW].indexOf(a)&&c.preventDefault();if(a===n.TAB&&l.hasClass(c.target,"item"))c.preventDefault(),this.currentHoverItem&&l.removeClass(this.currentHoverItem,"active"),"dropdown"===this.selectUI?(this.currentHoverItem=null,c.shiftKey?"block"===this.searchKeyInput.style.display?this.valueInput.focus():this.emit("advancedListValueSelect_itemsConfirmed"):"multipleDynamic"===this.controlType&&this.showAllIconBtn.focus()):this.listContent.focus();else if(a===
n.SPACE||a===n.ENTER)c=k(".checkInput",this.currentHoverItem)[0],a=k(".label",this.currentHoverItem)[0],this._setCBXChecked(c,this._getNodeText(a)),"radio"===this.inputType&&("dropdown"===this.selectUI&&(l.removeClass(this.currentHoverItem,"active"),this.currentHoverItem=null),this.emit("advancedListValueSelect_itemsConfirmed"));else if(a===n.UP_ARROW||a===n.DOWN_ARROW)if("dropdown"!==this.selectUI&&this._isFocusFirstItem)this._isFocusFirstItem=!1,this.currentHoverItem.focus(),setTimeout(r.hitch(this,
function(){l.addClass(this.currentHoverItem,"active")}),5);else{c=(c=a===n.UP_ARROW?this.currentHoverItem.previousSibling:this.currentHoverItem.nextSibling)?c:this.currentHoverItem;if(this.listContainer.scrollHeight>this.listContainer.clientHeight){var a=this.listContainer.clientHeight+this.listContainer.scrollTop,e=c.offsetTop+c.offsetHeight,e=e-30;e>a?this.listContainer.scrollTop=e-this.listContainer.clientHeight:c.offsetTop<this.listContainer.scrollTop+30&&(this.listContainer.scrollTop=c.offsetTop-
30)}l.removeClass(this.currentHoverItem,"active");this.currentHoverItem=c;l.addClass(this.currentHoverItem,"active");this.currentHoverItem.focus()}}})));this.own(q(this.selectedListContent,"focus",r.hitch(this,function(){if(b.isInNavMode()){var c=k(".item",this.selectedListContent);c.length&&(this.currentHoverItem=c[0],this.currentHoverItem.focus(),l.addClass(this.currentHoverItem,"active"),setTimeout(r.hitch(this,function(){l.addClass(this.currentHoverItem,"active")}),50))}})));this.own(q(this.selectedListContent,
"blur",r.hitch(this,function(){b.isInNavMode()&&this.currentHoverItem&&l.removeClass(this.currentHoverItem,"active")})));this.own(q(this.selectedContainer,"keydown",r.hitch(this,function(c){if(b.isInNavMode()){var a=c.which||c.keyCode;if(a===n.TAB)c.preventDefault(),this.currentHoverItem&&l.removeClass(this.currentHoverItem,"active"),this.showAllIconBtn.focus();else if(0!==k(".item",this.selectedListContent).length)if(-1<[n.SPACE,n.UP_ARROW,n.DOWN_ARROW].indexOf(a)&&c.preventDefault(),a===n.SPACE||
a===n.ENTER)c=k(".checkInput",this.currentHoverItem)[0],a=k(".label",this.currentHoverItem)[0],this._setCBXSelectedChecked(c,this._getNodeText(a));else if(a===n.UP_ARROW||a===n.DOWN_ARROW)c=(c=a===n.UP_ARROW?this.currentHoverItem.previousSibling:this.currentHoverItem.nextSibling)?c:this.currentHoverItem,this.selectedContainer.scrollHeight>this.selectedContainer.clientHeight&&(a=c.offsetTop+c.offsetHeight,a>this.selectedContainer.clientHeight+this.selectedContainer.scrollTop?this.selectedContainer.scrollTop=
a-this.selectedContainer.clientHeight:c.offsetTop<this.selectedContainer.scrollTop&&(this.selectedContainer.scrollTop=c.offsetTop)),l.removeClass(this.currentHoverItem,"active"),this.currentHoverItem=c,l.addClass(this.currentHoverItem,"active"),this.currentHoverItem.focus()}})))},_toggleFilter:function(b){var a=b.target;l.hasClass(a,"clearAllSelectedIcon")?(this._clearAllSelected(),this.currentHoverItem=this.currentItem=null):l.hasClass(a,"iconHover")||l.hasClass(a,"selectedToggleDiv")||(l.hasClass(a,
"showAllIcon")?(this.selectedContainer.style.display="none",this.listContent.focus()):(this._initSelectedContainerItems(),this.selectedContainer.style.display="block",this.selectedListContent.focus()),l.removeClass(this.selectedToggle,"iconHover"),this.selectedToggle=a,l.addClass(this.selectedToggle,"iconHover"),b.stopPropagation())},showAllList:function(){l.hasClass(this.selectedToggle,"showSelectedIcon")&&l.hasClass(this.selectedToggle,"iconHover")&&(l.removeClass(this.selectedToggle,"iconHover"),
this.selectedToggle=k(".showAllIcon",this.selectedToggleDiv)[0],l.addClass(this.selectedToggle,"iconHover"),l.setStyle(this.selectedContainer,"display","none"))},_clearAllSelected:function(){var b;b=l.hasClass(this.selectedToggle,"showAllIcon")?this.listContainer:this.selectedListContent;b=k(".item .checkInput.checked",b);for(var a=0;a<b.length;a++)b[a].click()},_initSelectedContainerItems:function(){for(var b=this.selectedListContent.innerHTML="",a=this.runtime?" labelRuntime":"",c=0;c<this.checkedList.length;c++)var d=
this.checkedList[c],e="value"===this.disPlayLabel?d:this.checkedLabelList[c],d='data\x3d"'+(this.isNumberField?d:encodeURIComponent(d))+'"',b=b+('\x3cdiv role\x3d"option" class\x3d"item" tabindex\x3d"-1" aria-selected\x3d"true" aria-checked\x3d"true"\x3e\x3cdiv class\x3d"checkInput '+this.inputType+' checked" '+d+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label jimu-ellipsis-Blanks'+a+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+e+"\x3c/div\x3e\x3c/div\x3e");this.selectedListContent.innerHTML=b},_addSelectedContainerEvent:function(){this.own(q(this.selectedListContent,
"click",r.hitch(this,function(b){var a=b.target,c;if(l.hasClass(a,"item"))c=a.firstElementChild,a=a.firstElementChild.nextSibling;else if(l.hasClass(a,"checkInput"))c=a,a=a.nextSibling;else if(l.hasClass(a,"label"))c=a.previousSibling;else{b.stopPropagation();return}this._setCBXSelectedChecked(c,this._getNodeText(a));b.stopPropagation()})))},_setCBXSelectedChecked:function(b,a){var c=a;if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)c=decodeURIComponent(l.getAttr(b,"data"));l.hasClass(b,
"checked")?(l.setAttr(b.parentNode,"aria-checked","false"),"radio"!==this.inputType&&(l.removeClass(b,"checked"),this._updateCheckedList("remove",c,a),this.checkCBXItems(),this.emit("advancedListValueSelect_itemUnChecked",a))):(l.setAttr(b.parentNode,"aria-checked","true"),"radio"===this.inputType&&this.currentItem&&(!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),l.removeClass(this.currentItem,"checked")),l.addClass(b,"checked"),this._updateCheckedList("add",c,a),this.checkCBXItems(),
this.emit("advancedListValueSelect_itemChecked",a))},_getNodeText:function(b){return b.textContent||b.innerText||""},_updateCheckedList:function(b,a,c){a!==this.emptyStr&&(a=this.isNumberField?parseFloat(a):a);if("remove"===b)for(var d in this.checkedList){if(this.checkedList[d]===a||this.isNumberField&&isNaN(this.checkedList[d])&&isNaN(a)){this.checkedList.splice(d,1);this.checkedLabelList.splice(d,1);break}}else"radio"===this.inputType?(this.checkedList=[a],this.checkedLabelList=[c]):(this.checkedList.push(a),
this.checkedLabelList.push(c));this._updateListContentLabel()},_updateListContentLabel:function(){if("dropdown"!==this.selectUI&&this.runtime){var b=this.checkedLabelList.join(" "),b=b?b:this.emptyStr;l.setAttr(this.listContent,"aria-label",this.label+b)}},_updateCheckedLabelList:function(b){this.checkedLabelList=[];for(var a=0;a<this.checkedList.length;a++)for(var c=0;c<b.length;c++)this.checkedList[a]===b[c].value&&this.checkedLabelList.push(b[c].label)},_updateCheckedLabelListFromCheckedList:function(){for(var b=
0;b<this.checkedList.length;b++)this.checkedLabelList.push(this.checkedList[b]+"");this._updateListContentLabel()},_createTarget:function(b){b=this._getNodeText(b.target).split(": ")[1];this.emit("advancedListValueSelect_itemChecked",b)},_deleteCBXItem:function(){},_getCheckInputItems:function(){return k(".item .checkInput",this.listContent)},getListCheckedValuesOrigin:function(){for(var b=[],a=this._getCheckInputItems(),c=0;c<a.length;c++){var d=a[c],e=this._getNodeText(d.nextSibling);l.hasClass(d,
"checked")&&b.push(e)}return b},getListCheckedValues:function(){for(var b=[],a=r.clone(this.checkedList),c=0;c<a.length;c++){var d=a[c],d=this.isNumberField?parseFloat(d):d;b.push(d)}return b},getListValues:function(){var b=[],a=this._getCheckInputItems();if(0===a.length)return this.dataList;for(var c=0;c<a.length;c++){var d=a[c],e=this._getNodeText(d.nextSibling);if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)e=decodeURIComponent(l.getAttr(d,"data"));e=this.isNumberField?parseFloat(e):
e;e={value:e,isChecked:!1};l.hasClass(d,"checked")&&(e.isChecked=!0);b.push(e)}return b},getIfValueExist:function(b){for(var a=this._getCheckInputItems(),c=0;c<a.length;c++){var d=this._getNodeText(a[c].nextSibling);if(b===d)return!0}return!1},getCurrentItem:function(){for(var b=this._getCheckInputItems(),a=0;a<b.length;a++){var c=b[a];if(l.hasClass(c,"checked"))return c}return null},checkCBXItems:function(b){b=b?"":this.valueInput.get("value");this.valueInput.set("value",b);b=k(".item .label",this.listContent);
for(var a=0;a<b.length;a++){var c=b[a],d="value"===this.disPlayLabel?this._getNodeText(c):decodeURIComponent(l.getAttr(c.previousSibling,"data")),d=this.isNumberField?parseFloat(d):d;0<=this.checkedList.indexOf(d)||this.isNumberField&&0<=this.checkedList.indexOf(parseFloat(d))?l.addClass(c.previousSibling,"checked"):l.removeClass(c.previousSibling,"checked")}},reset:function(){this.listContent.innerHTML=""},setCBXData:function(b,a,c,d){d||(this.queryState=!1);b=b?b:[];if(this.listContent){l.setStyle(this.noDataTips,
"display","none");var e=0,f="radio"===this.inputType?" labelBig":"",g=this.runtime?" labelRuntime":"";d=this.listContent.innerHTML;if(c){d=this.listContent.innerHTML="";if("uniquePredefined"===this.controlType&&this.enableEmpty||"uniqueDynamic"===this.controlType&&!this.keyQueryMode)c=d="",this.checkedList[0]===this.emptyStr&&(d=" checked",c=" active",e=1),0===this.checkedList.length&&(d=" checked",this.currentItem=!0,e=1),d='\x3cdiv role\x3d"option" class\x3d"item emptyItem'+c+'" aria-selected\x3d"true" tabindex\x3d"-1" '+
(d?'aria-checked\x3d"true"':'aria-checked\x3d"false"')+'\x3e\x3cdiv class\x3d"checkInput '+this.inputType+d+'" '+("data\x3d'"+this.emptyStr+"'")+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label'+f+" jimu-ellipsis-Blanks"+g+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+this.emptyStr+"\x3c/div\x3e\x3c/div\x3e";this.listContainer.scrollTop=0}if(0===b.length)return b=this.listContent.innerHTML.replace(/(^\s*)|(\s*$)/g,""),""!==b||this.cacheQueryMode&&!this.isCacheFinish||l.setStyle(this.noDataTips,"display",
"block"),""===b&&(this.listContent.innerHTML=d),this.listContent;c="";for(var h=0;h<b.length;h++){var k=b[h],m="";if(a)if(this.runtime&&("multiplePredefined"===this.controlType||"uniquePredefined"===this.controlType))k.isChecked&&(m=" checked",this.currentItem=!0,e++);else if(0<=this.checkedList.indexOf(k.value)||this.isNumberField&&0<=this.checkedList.indexOf(parseFloat(k.value)))m=" checked",this.currentItem=!0,e++;var n="",n=m?'aria-checked\x3d"true"':'aria-checked\x3d"false"',p='data\x3d"'+(this.isNumberField?
k.value:encodeURIComponent(k.value))+'"';c+='\x3cdiv class\x3d"item" role\x3d"option" tabindex\x3d"-1" aria-selected\x3d"true" '+n+'\x3e\x3cdiv class\x3d"checkInput '+this.inputType+m+'" '+p+'\x3e\x3c/div\x3e\x3cdiv class\x3d"label'+f+" jimu-ellipsis-Blanks"+g+'" style\x3d"max-width:'+this._itemLabelW+'px"\x3e'+k[this.disPlayLabel]+"\x3c/div\x3e\x3c/div\x3e"}b=this.checkedList.length-e;if(this.runtime&&0<b)for(a=0;a<b;a++)this.emit("advancedListValueSelect_itemUnChecked","");this.listContent.innerHTML=
d+c;return this.listContent}},setCBXContentBySearch:function(b,a){0===b.length?this.setCBXData([],!1,!0,a):this.setCBXData(b,!0,!0,a)},_onSearchKeyChange:function(){var b=this.valueInput.get("value");this.searchName=b;this.listContainer.scrollTop=0;this.reset();this.cacheQueryMode=this.keyQueryMode=this.ifFristPage=!0;this.emit("advancedListValueSelect_searchKeyLocal",b);this.codedValues||(this.isCacheFinish||l.setStyle(this.loadMoreDataBtn,"display","block"),0===b.length&&(this.queryState=this.cacheQueryMode=
this.keyQueryMode=!1,l.setStyle(this.loadMoreDataBtn,"display","none")))},_loadMoreDataFromServer:function(){this.keyQueryMode=this.ifFristPage=!0;this.cacheQueryMode=!1;this.queryState=!0;l.setStyle(this.loadMoreDataBtn,"display","none");var b=this.valueInput.get("value");this.searchName=b;this.listContainer.scrollTop=0;"multipleDynamic"===this.controlType||"uniqueDynamic"===this.controlType?this.emit("advancedListValueSelect_searchKey",b):this.runtime||this.emit("advancedListValueSelect_searchKey",
b)},currentHoverItem:null,_addCBXHoverEvent:function(){this.own(q(this.listContent,"mouseover",r.hitch(this,function(c){c=c.target||c.srcElement;if(c=l.hasClass(c,"item")?c:b.getAncestorDom(c,function(a){return l.hasClass(a,"item")},3))this.currentHoverItem&&l.removeClass(this.currentHoverItem,"active"),l.addClass(c,"active"),this.currentHoverItem=c})));this.own(q(this.listContent,"mouseout",r.hitch(this,function(){this.currentHoverItem&&l.removeClass(this.currentHoverItem,"active");this.currentHoverItem=
null})))},_addCBXClickEvent:function(){this.own(q(this.valueInput,"change",r.hitch(this,function(){this._onSearchKeyChange()})));this.own(q(this.loadMoreDataBtn,"click",r.hitch(this,function(){this._loadMoreDataFromServer()})));this.own(q(this.listContainer,"scroll",r.hitch(this,this.dropDownScroll)));this.own(q(this.searchKeyInput,"click",r.hitch(this,function(b){b.stopPropagation()})));this.own(q(this.listContainer,"click",r.hitch(this,function(b){var a=b.target,c;if(l.hasClass(a,"item"))c=a.firstElementChild,
a=a.firstElementChild.nextSibling;else if(l.hasClass(a,"checkInput"))c=a,a=a.nextSibling;else if(l.hasClass(a,"label"))c=a.previousSibling;else{b.stopPropagation();return}this._setCBXChecked(c,this._getNodeText(a));b.stopPropagation()})))},scrollDiff:100,dropDownScroll:function(b){this.runtime&&("uniquePredefined"===this.controlType||"multiplePredefined"===this.controlType)||this.cacheQueryMode||this.codedValues||(this.queryState?this.listContainer.scrollTop=this.containerScrollTop:(b=b.target,b.scrollHeight-
b.clientHeight-b.scrollTop<=this.scrollDiff&&!this.queryState&&(this.containerScrollTop=this.listContainer.scrollTop,this.queryState=!0,this.ifFristPage=!1,this.emit("advancedListValueSelect_addNextPage"))))},_setCBXChecked:function(b,a){var c=a;if("alias"===this.disPlayLabel||"label"===this.disPlayLabel)c=decodeURIComponent(l.getAttr(b,"data"));l.hasClass(b,"checked")?(l.setAttr(b.parentNode,"aria-checked","false"),"radio"===this.inputType?this.runtime||"predefined"!==this.controlType?this.emit("advancedListValueSelect_itemChecked",
a):this.emit("advancedListValueSelect_itemCheckedForPredefined",c,a):(l.removeClass(b,"checked"),this._updateCheckedList("remove",c,a),this.emit("advancedListValueSelect_itemUnChecked",a))):(l.setAttr(b.parentNode,"aria-checked","true"),"radio"===this.inputType&&this.currentItem&&(!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),this.currentItem&&(l.removeClass(this.currentItem,"checked"),l.setAttr(this.currentItem.parentNode,"aria-checked","false"))),l.addClass(b,"checked"),this.currentItem=
b,this._updateCheckedList("add",c,a),this.runtime||"predefined"!==this.controlType?this.emit("advancedListValueSelect_itemChecked",a):this.emit("advancedListValueSelect_itemCheckedForPredefined",c,a))},initDoms:function(b,a){this.setCBXData(b,a)},getData:function(){},refreshData:function(){this.checkCBXItems()},validate:function(){var b=this.checkedList.length?"12345678":null;1===this.checkedList.length&&this.checkedList[0]===this.emptyStr&&(b=null);if(this.isNumberField)for(var a=0;a<this.checkedList.length;a++){var c=
this.checkedList[a];if(c!==this.emptyStr&&isNaN(c)){b=null;break}}this.set("DisplayedValue",b);return!0},setRequired:function(b){this.mutiValuesSelect.set("required",b)},destroy:function(){l.destroy(this.domNode);this.inherited(arguments)}})})},"jimu/dijit/_filter/pageControlForQuery":function(){define("dojo/Deferred esri/tasks/query dojo/_base/array dojo/_base/lang dojo/_base/declare jimu/Query jimu/LayerStructure dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./pageControlForQuery.html jimu/filterUtils jimu/utils".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m){return c([k,h,t],{templateString:e,layerUrl:null,fieldInfo:null,fieldPopupInfo:null,spatialReference:null,layerDefinition:null,isNumberField:!1,showNullValues:!1,_isUniqueValueCacheFinish:!1,_uniqueValueCache:{},_uniqueValueCacheForOtherTypes:{},_codedvalueCache:[],cascadeFilterExprs:"1\x3d1",numbericFieldLength:{esriFieldTypeOID:32,esriFieldTypeSmallInteger:16,esriFieldTypeInteger:32,esriFieldTypeSingle:128,esriFieldTypeDouble:1024},pageIndex:1,pageSize:1E3,postCreate:function(){this.inherited(arguments);
this.spatialReference=n.getInstance().map.spatialReference;this.reset();this.queryType=q.getQueryType(this.layerDefinition);this.isNumberField?this.fieldLength=this.numbericFieldLength[this.fieldInfo.type]:(this.filterUtils=new b,this.isLayerHosted=m.isHostedService(this.layerUrl))},reset:function(){this.pageIndex=1;this._isUniqueValueCacheFinish=!1;this._uniqueValueCache={};this._uniqueValueCacheForOtherTypes={};this._codedvalueCache=[]},isKeyQueryLoader:!1,_searchKey:function(a){var b=new r,d=new f,
c="";this.isNumberField?c="CAST("+this.fieldInfo.name+" AS CHAR("+this.fieldLength+")) LIKE '%"+a+"%'":(c=this.isLayerHosted&&this.filterUtils.containsNonLatinCharacter(a)?"N":"",c=this.isLayerHosted?this.fieldInfo.name+" LIKE "+c+"'%"+a.replace(/\'/g,"''")+"%'":"UPPER("+this.fieldInfo.name+") LIKE "+c+"'%"+a.replace(/\'/g,"''").toUpperCase()+"%'");d.where="(("+this.cascadeFilterExprs+") AND ("+c+"))";d.geometry=null;d.outSpatialReference=this.spatialReference;d.outFields=[this.fieldInfo.name];d.returnDistinctValues=
!0;d.returnGeometry=!1;d.orderByFields=d.outFields;this.layerLoaderForKey=new q({url:this.layerUrl,query:d,pageSize:this.pageSize});this.isKeyQueryLoader=!0;this._uniqueValueCacheForOtherTypes={};this.queryByPage(!0).then(p.hitch(this,function(a){b.resolve(a)}),p.hitch(this,function(a){b.reject("reject:"+a)}));return b},_searchKeyLocal:function(a){a=a.toUpperCase();this.isKeyQueryLoader=!1;var b=[],d=this._codedvalueCache,c;if(0<d.length)for(var e=0;e<d.length;e++)c=d[e],c.label&&0<=c.label.toString().toUpperCase().indexOf(a)&&
b.push(c);else for(e in d=this._uniqueValueCache,d)for(var f=d[e],h=0;h<f.length;h++){c=f[h];var k=c.label;k&&0<=k.toString().toUpperCase().indexOf(a)&&b.push(c)}return b},queryByPage:function(a){var b=new r;this.layerLoader&&this.layerLoader.query.where!==this.cascadeFilterExprs&&(this.layerLoader=null,this.isKeyQueryLoader=!1,this.reset());if(!this.layerLoader){var d=new f;d.where=this.cascadeFilterExprs;d.geometry=null;d.outSpatialReference=this.spatialReference;d.outFields=[this.fieldInfo.name];
d.returnDistinctValues=!0;d.returnGeometry=!1;d.orderByFields=d.outFields;this.layerLoader=new q({url:this.layerUrl,query:d,pageSize:this.pageSize})}a&&(this.pageIndex=1);a=[];if(this.isKeyQueryLoader){if(this._uniqueValueCacheForOtherTypes[this.pageIndex])return a=this._resolveValueLabelsFromCache(this._uniqueValueCacheForOtherTypes),b.resolve(a),b;a=this.layerLoaderForKey}else{if(this._uniqueValueCache[this.pageIndex])return a=this._resolveValueLabelsFromCache(this._uniqueValueCache),b.resolve(a),
b;a=this.layerLoader}1===this.queryType?a.queryByPage(this.pageIndex).then(p.hitch(this,function(a){if(a){var d=a.features||[];a=d.length;this.showNullValues||(d=this._getNotNullValues(d));d=this._getValueLabelsFromFeatures(d);this.isKeyQueryLoader?(this._uniqueValueCacheForOtherTypes[this.pageIndex-1]=d,a<this.pageSize&&(this._uniqueValueCacheForOtherTypes[this.pageIndex]=[])):(this._uniqueValueCache[this.pageIndex-1]=d,a<this.pageSize&&(this._uniqueValueCache[this.pageIndex]=[],this._isUniqueValueCacheFinish=
!0));0===d.length&&this.pageIndex--;b.resolve(d)}else b.reject("Can't get features from current layer")}),p.hitch(this,function(a){b.reject(a)})):a.getAllFeatures().then(p.hitch(this,function(a){if(a){var d=a.features||[];this.showNullValues||(d=this._getNotNullValues(d));a=0<d.length?!0:!1;d=this._getDistinctValues(d);d=this._getValueLabelsFromFeatures(d);d=this.isKeyQueryLoader?this._getAndStoreValueLabelsForOtherTypes(d,this._uniqueValueCacheForOtherTypes):this._getAndStoreValueLabelsForOtherTypes(d,
this._uniqueValueCache);this._isUniqueValueCacheFinish=!0;b.resolve(a?d:[])}else b.reject("Can't get features from current layer")}),p.hitch(this,function(a){b.reject(a)}));this.pageIndex++;return b},_resolveValueLabelsFromCache:function(a){a=a[this.pageIndex];0!==a.length&&this.pageIndex++;return a},_getAndStoreValueLabelsForOtherTypes:function(a,b){for(var d=0;d<a.length;d+=this.pageSize)b[parseInt(d/this.pageSize,10)+1]=a.slice(d,d+this.pageSize);for(var c in b)a=parseInt(c,10)+1,b[a]||(b[a]=[]);
return b[1]},_getDistinctValues:function(a){var b={},d=[],c;for(c in a){var e=a[c],f=e.attributes[this.fieldInfo.name];b[f]||(b[f]=!0,d.push(e))}return d},_getNotNullValues:function(a){return a=l.filter(a,p.hitch(this,function(a){a=a.attributes[this.fieldInfo.name];return"\x3cNull\x3e"!==a&&null!==a}))},_getValueLabelsFromFeatures:function(a){var b=this.fieldInfo.name;a=l.map(a,function(a){return a.attributes[b]});a=m._getValues(this.layerDefinition,this.fieldPopupInfo,b,a);"esriFieldTypeDate"===
this.fieldInfo.type&&(a=this._getDistinctValueLabelsByFormat(a));return a},_getDistinctValueLabelsByFormat:function(a){var b={},d=[],c;for(c in a){var e=a[c].value;b[e]||(b[e]=!0,d.push(a[c]))}return d}})})},"jimu/dijit/_filter/PredefinedValueProvider":function(){define("dojo/_base/html dojo/_base/declare dojo/text!./PredefinedValueProvider.html dojo/_base/lang dojo/on jimu/dijit/Popup ./PredefinedValuePopup ./ValueProvider".split(" "),function(r,f,l,p,c,q,n,k){return f([k],{templateString:l,nls:null,
url:"",layerDefinition:null,partObj:null,fieldInfo:null,codedValues:null,staticValues:null,layerInfo:null,popupInfo:null,operatorInfo:null,filterCodedValueIfPossible:!1,runtime:!1,providerType:null,valueProvider:null,postCreate:function(){this.inherited(arguments);this.jimuNls=window.jimuNls;r.addClass(this.domNode,"jimu-filter-indexBtn-value-provider");r.addClass(this.valueProviderPopupNode,"value-type-popup");r.setStyle(this.valueProviderPopupNode,"display","none");var c="";"UNIQUE_PREDEFINED_VALUE_PROVIDER"===
this.providerType?c=this.nls.predefinedUniqueTips:"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType&&(c=this.nls.predefinedMultipleTips);this.indexBtnTips.title=c;this.indexBtnTips.innerText=c+" ...";this._initProvider();this._bindEvent()},_initProvider:function(){var c={preDefinedTips:this.indexBtnTips,nls:this.nls,url:this.url,layerDefinition:this.layerDefinition,partObj:this.partObj,fieldInfo:this.fieldInfo,codedValues:this.codedValues,staticValues:this.staticValues,layerInfo:this.layerInfo,
popupInfo:this.popupInfo,operatorInfo:this.operatorInfo,filterCodedValueIfPossible:this.filterCodedValueIfPossible,runtime:this.runtime,selectUI:this.selectUI,providerType:this.providerType};if("UNIQUE_PREDEFINED_VALUE_PROVIDER"===this.providerType||"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType)this.valueProvider=new n(c);this.valueProvider.on("predefinedValuePopup_setApplyBtnState",p.hitch(this,function(c){this.popup&&(c?this.popup.enableButton(0):this.popup.disableButton(0))}))},_bindEvent:function(){this.own(c(this.indexBtn,
"click",p.hitch(this,function(){this.valueProvider&&this.destroyProvider();this._initProvider();this.setValueObject(this.valueObjEnd,this.valueObjEnd.type);this.popup=new q({width:800,height:600,content:this.valueProvider,titleLabel:this.indexBtnTips.title,useFocusLogic:!1,onClose:p.hitch(this,function(){this.getValueObject(!1);this._closeCBXPopup();this.destroyProvider()}),buttons:[{label:this.nls.apply,disable:!0,onClick:p.hitch(this,function(){this.getValueObject(!0)?this.popup.close():alert("please configurate some items")})},
{label:this.jimuNls.common.cancel,classNames:["jimu-btn-vacation"],onClick:p.hitch(this,function(){this.popup.close()})}]});r.addClass(this.popup.domNode,"widget-at-filter-popup");setTimeout(p.hitch(this,function(){this.valueProvider._setApplyState(this.getValueObject(!0));this.valueProvider._setDisplayTypeStyle()}),100)})))},_closeCBXPopup:function(){this.valueProvider.cbxPopup&&this.valueProvider.cbxPopup.domNode&&(this.valueProvider.cbxPopup.onClose=p.hitch(this,function(){return!0}),this.valueProvider.cbxPopup.close())},
_saveData:function(){this.valueProvider.saveData()},reset:function(){},getDijits:function(){return[]},getStatus:function(){return 1},setValueObject:function(c){c&&(this.valueObjEnd=c);this.valueProvider.setValueObject(c,!0)},valueObj:null,getValueObject:function(c){if(c)return this.valueObjEnd=c=this.valueProvider.getValueObject(),c.value.length;delete this.valueObjEnd.valueList;return 0===this.valueObjEnd.value.length?0:this.valueObjEnd},destroyProvider:function(){this.valueProvider&&this.valueProvider.destroyProvider();
this.valueProvider=null}})})},"jimu/dijit/_filter/PredefinedValuePopup":function(){define("dojo/_base/lang dojo/Deferred dojo/_base/html dojo/_base/array dojo/_base/declare dojo/Evented dojo/query ./ValueProvider ./EditTable ./AdvancedListValueSelect dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./PredefinedValuePopup.html dojo/store/Memory jimu/utils jimu/dijit/Popup jimu/dijit/_filter/pageControlForQuery dojox/form/CheckedMultiSelect".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,
m,a,g,d,u,v){return c([k,e,b,q],{templateString:m,codedValues:null,staticValues:null,showNullValues:!1,cbxPopup:null,pageSize:1E3,pageIndex:1,selectUI:null,postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder;this.emptyStr=window.apiNls.widgets.FeatureTable.empty},postCreate:function(){this.inherited(arguments);this.selectUI=this.selectUI?this.selectUI:"dropdown";l.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");
this.controlType="unique";"MULTIPLE_PREDEFINED_VALUE_PROVIDER"===this.providerType&&(this.controlType="multiple");this.isNumberField=g.isNumberField(this.fieldInfo.type);this.editTable||(this.editTable=new h({tableType:this.controlType,dataList:[],codedValues:this.codedValues,emptyStr:this.emptyStr,customValue:this.Nls.addValuePlaceHolder,customLabel:this.Nls.addLabelPlaceHolder,isNumberField:this.isNumberField}),this.editTable.placeAt(this.tableContent),this.editTable.on("editTable_openListSelectByName",
r.hitch(this,this._showListSelectByTable)),this.editTable.on("editTable_itemChanged",r.hitch(this,this._editTableItemChanged)),this.editTable.on("editTable_getValLabelsArrayForNumber",r.hitch(this,this._getValLabelsArrayForNumber)));this.supportPaing=!0;this.pageControlForQuery||(this.pageControlForQuery=new u({pageSize:this.pageSize,pageIndex:1,layerUrl:this.url,fieldInfo:this.fieldInfo,queryWhere:"1\x3d1",layerDefinition:this.layerDefinition,fieldPopupInfo:this.fieldPopupInfo,isNumberField:this.isNumberField}));
this.listSelect||(this.listSelect=new t({emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,selectType:"unique",controlType:"predefined",dataList:[],selectedDataList:[],isNumberField:this.isNumberField}),this.listSelect.on("advancedListValueSelect_itemChecked",r.hitch(this,this._createTarget)),this.listSelect.on("advancedListValueSelect_itemUnChecked",r.hitch(this,this._destoryTarget)),this.listSelect.on("advancedListValueSelect_addNextPage",r.hitch(this,this._addNextPage)),this.listSelect.on("advancedListValueSelect_searchKey",
r.hitch(this,this._searchKey)),this.listSelect.on("advancedListValueSelect_searchKeyLocal",r.hitch(this,this._searchKeyLocal)),this.listSelect.on("advancedListValueSelect_itemCheckedForPredefined",r.hitch(this,this._createTargetForPredefined)));this.mutiValuesSelect||(this.mutiValuesSelect=new v({multiple:!0,required:!1,intermediateChanges:!0,style:{width:"100%"}}));this._multipleSelectProviderEventHandler=r.hitch(this,this._multipleSelectProviderEvent);document.addEventListener("click",this._multipleSelectProviderEventHandler);
var b=new a({idProperty:"id",data:[]});this.listSelect.set("store",b)},_multipleSelectProviderEvent:function(a){var b=a.target||a.srcElement,d=l.isDescendant(b,this.editTable.searchBtn);this.editTable&&this.cbxPopup&&this.cbxPopup.domNode?(d?"block"===l.getStyle(this.cbxPopup.domNode,"display")?l.setStyle(this.cbxPopup.domNode,"display","none"):l.setStyle(this.cbxPopup.domNode,"display","block"):l.isDescendant(b,this.cbxPopup.domNode)||this._createTargetForPredefined(),a.stopPropagation()):this._isInSelectPopup(b)||
this.runtime?a.stopPropagation():l.setStyle(this.valuesPopupNode,"display","none")},_initAdvancedListValueSelect:function(){this.pageControlForQuery.pageIndex=1;this.pageControlForQuery.isKeyQueryLoader=!1;this.listSelect=new t({emptyStr:this.emptyStr,runtime:this.runtime,pageSize:this.pageSize,isCacheFinish:this.pageControlForQuery._isUniqueValueCacheFinish,selectType:"unique",controlType:"predefined",dataList:[],selectedDataList:[],isNumberField:this.isNumberField});this.listSelect.on("advancedListValueSelect_itemChecked",
r.hitch(this,this._createTarget));this.listSelect.on("advancedListValueSelect_itemUnChecked",r.hitch(this,this._destoryTarget));this.listSelect.on("advancedListValueSelect_addNextPage",r.hitch(this,this._addNextPage));this.listSelect.on("advancedListValueSelect_searchKey",r.hitch(this,this._searchKey));this.listSelect.on("advancedListValueSelect_searchKeyLocal",r.hitch(this,this._searchKeyLocal));this.listSelect.on("advancedListValueSelect_itemCheckedForPredefined",r.hitch(this,this._createTargetForPredefined))},
_isInSelectPopup:function(a){for(var b="dijitCheckBoxInput dojoxMultiSelectItemLabel dojoxMultiSelectItemBox dojoxMultiSelectItem dojoxCheckedMultiSelectWrapper dojoxCheckedMultiSelect value-type-popup popupOper pageItem".split(" "),d=!1,c=0;c<=b.length;c++)if(l.hasClass(a,b[c])){d=!0;break}return d},_createTarget:function(){this.editTable._createTarget("","","","",!0);this._editTableItemChanged()},_createTargetForPredefined:function(a,b){this.editTable._setNewLabel(a,b);this.cbxPopup.close();this._editTableItemChanged()},
_destoryTarget:function(a){this.editTable._destroyTarget(a);this._editTableItemChanged()},_editTableItemChanged:function(){if(!this.runtime){var a=this.getValueObject();this._setApplyState(a.value.length)}},_setApplyState:function(a){this.emit("predefinedValuePopup_setApplyBtnState",a)},_cbxWidth:245,_cbxHeight:340,isPopupLoading:!1,_showListSelectByTable:function(a){if(!this.isPopupLoading){this._initAdvancedListValueSelect();this.valueList=[a];this.getCheckedList(this.valueList);a=l.position(this.editTable.searchBtn);
var b=a.x-226,c=a.y+30;window.isRTL&&(b=a.x);this.cbxPopup=new d({width:this._cbxWidth,height:this._cbxHeight,content:this.listSelect.domNode,enableMoveable:!1,hasTitle:!1,hasOverlay:!1,contentHasNoMargin:!0,moveToCenter:!1,customPosition:{left:b,top:c},useFocusLogic:!1,buttons:[]});this.cbxPopup.setDomNodeStyls({"border-radius":0,border:"1px solid #999"});this.cbxPopup.on("popupHasInitedSuccessfully",r.hitch(this,function(){var a=l.position(this.editTable.searchBtn),b=a.x-226,d=a.y+30;window.isRTL&&
(b=a.x);this.cbxPopup.setCustomPosition(b,d)}));this.listSelect.valueInput&&this.listSelect.valueInput.focus();this._showLoadingIcon();this.isPopupLoading=!0;this._valueLabels().then(r.hitch(this,function(a){this.isPopupLoading=!1;this._hideLoadingIcon();if(!0!==a){var b=!1;this.valueList&&0!==this.valueList.length&&(b=!0);this.listSelect.setCBXData(a,b)}}))}},_valueLabels:function(){var a=new f;this.listSelect.codedValues=!1;this.listSelect.disPlayLabel="label";if(this.staticValues)return this._setValueForStaticValues(this.staticValues),
a.resolve(!0),a;if(this.codedValues)if(this.filterCodedValue)this.listSelect.codedValues=!0;else return this._setValueForStaticValues(this.codedValues),a.resolve(!0),a;this.pageControlForQuery.queryByPage(!0).then(r.hitch(this,function(b){a.resolve(b)}),r.hitch(this,function(b){console.log(b);this._hideLoadingIcon();a.reject(b)}));return a},_setValueForStaticValues:function(a){this.listSelect.codedValues=!0;a&&(this.pageControlForQuery._codedvalueCache=a,a=0<a.length?a:[],this.listSelect.setCBXData(a,
!0,!0))},_changeDisplayType:function(a){a=a.target||a.srcElement;a=l.hasClass(a,"option")?a:g.getAncestorDom(a,function(a){return l.hasClass(a,"option")},2);l.hasClass(a,"checked")||(l.addClass(a,"checked"),a=n("."+this.selectUI+"Option ",this.displayTypes)[0],l.removeClass(a,"checked"),this.selectUI="expanded"===this.selectUI?"dropdown":"expanded")},_setDisplayTypeStyle:function(){var a=n(".title",this.displayTypes)[0],b=n(".label",this.displayTypes),a=(l.getStyle(this.displayTypes,"width")-l.getStyle(a,
"width")-80)/2,d=l.getStyle(b[0],"width"),d=d<a?d:a,c=l.getStyle(b[1],"width"),c=c<a?c:a;l.setStyle(b[0],"width",d+"px");l.setStyle(b[1],"width",c+"px")},_addNextPage:function(){this.listSelect&&(this._showLoadingIcon(),this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage).then(r.hitch(this,function(a){this.listSelect.isCacheFinish=this.pageControlForQuery._isUniqueValueCacheFinish;this.listSelect.setCBXData(a,!0);this._hideLoadingIcon()}),r.hitch(this,function(a){console.log(a);this._hideLoadingIcon()})))},
_searchKey:function(a){this.listSelect&&(this._showLoadingIcon(),this.pageControlForQuery._searchKey(a).then(r.hitch(this,function(a){this.listSelect.setCBXContentBySearch(a);this._hideLoadingIcon()}),r.hitch(this,function(a){console.log(a);this._hideLoadingIcon()})))},_searchKeyLocal:function(a){this.listSelect&&(this._showLoadingIcon(),a=this.pageControlForQuery._searchKeyLocal(a),this.listSelect.setCBXContentBySearch(a),this._hideLoadingIcon())},_handlerPageValues:function(){},getCheckedList:function(a){this.listSelect.checkedList=
[];this.isNumberField?p.forEach(a,r.hitch(this,function(a){this.listSelect.checkedList.push(parseFloat(a))})):this.listSelect.checkedList=a},_showPopup:function(){var a=this.getValueObject().valueList;this.valueList=null===a?void 0:a;this.getCheckedList(this.valueList);this.cbxPopup?(this.listSelect.checkCBXItems(!1),this.cbxPopup.show()):(this.cbxPopup=new d({width:355,height:596,content:this.listSelect.domNode,titleLabel:this.layerDefinition.name+"("+this.fieldName+")",isResize:!1,useFocusLogic:!1,
onClose:r.hitch(this,function(){this.cbxPopup.hide();return!1}),buttons:[]}),this._showLoadingIcon(),this.pageControlForQuery.queryByPage().then(r.hitch(this,function(a){this._hideLoadingIcon();var b=!1;this.valueList&&0!==this.valueList.length&&(b=!0);this.listSelect.setCBXData(a,b)})))},getDijits:function(){return[this.mutiValuesSelect]},setValueObject:function(a){a.value=a.value?a.value:[];var b=n("."+(a.selectUI?a.selectUI:this.selectUI)+"Option ",this.displayTypes)[0];l.addClass(b,"checked");
b=null;if(this.isNumberField){for(var b=[],d=0;d<a.value.length;d++)b.push(a.value[d].value);b=this._getValLabelsArrayForNumber(!1,b)}this.editTable.emptyLabel=a.emptyLabel;this.editTable.enableEmpty=a.enableEmpty;this.editTable.setListValues(a.value,b)},_getValLabelsArrayForNumber:function(a,b){b=g._getValues(this.layerDefinition,this.fieldPopupInfo,this.fieldName,b);a&&(this.editTable.currentValLabel=b[0].label);return b},tryGetValueObject:function(){return this.isValidValue()?this.getValueObject():
this.isEmptyValue()?{isValid:!0,selectUI:this.selectUI,type:this.partObj.valueObj.type,value:[],valueList:[]}:null},getValueObject:function(){if(this.isValidValue()){var a=this.editTable.getListValues(),b={isValid:!0,selectUI:this.selectUI,type:this.partObj.valueObj.type,value:a.list,valueList:a.valueList};"unique"===this.controlType&&(b.emptyLabel=a.emptyLabel,b.enableEmpty=a.enableEmpty);return b}return null},setRequired:function(a){this.mutiValuesSelect.set("required",a)},queryByPage:function(){var a=
this.pageControlForQuery.queryByPage(this.listSelect.ifFristPage);a.then(r.hitch(this,function(b){a.resolve(b)}),r.hitch(this,function(b){console.log(b);a.reject(b)}))},_showLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&l.addClass(this.listSelect.listContainer,"jimu-circle-loading")},_hideLoadingIcon:function(){this.listSelect&&this.listSelect.listContainer&&l.removeClass(this.listSelect.listContainer,"jimu-circle-loading")},destroy:function(){this._multipleSelectProviderEventHandler&&
document.removeEventListener("click",this._multipleSelectProviderEventHandler);this.inherited(arguments)},destroyProvider:function(){this.editTable&&this.editTable.destroy();this.listSelect&&this.listSelect.destroy();this.listSelect=null;this.destroy();l.destroy(this.domNode)}})})},"jimu/dijit/_filter/EditTable":function(){define("dojo/_base/lang dojo/_base/html dojo/Evented dojo/on dojo/keys dojo/dom-attr dojo/_base/declare dijit/_WidgetBase dojo/query dijit/form/ValidationTextBox dijit/form/NumberTextBox dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./EditTable.html jimu/utils".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g){return n([k,b,m,l],{templateString:a,currentItem:null,dataList:[],codedValues:null,isNumberField:!0,tableType:"unique",postMixInProperties:function(){this.inherited(arguments);this.CommonNls=window.jimuNls.common;this.Nls=window.jimuNls.filterBuilder},postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-filter-mutcheck-list-value-provider");"unique"===this.tableType?(this.inputType="radio",f.addClass(this.listContent,"radio-items-list-content")):
this.inputType="checkbox"},_onListContentDblClicked:function(a){this.isSearch=!1;var b=a.target||a.srcElement,d=g.getAncestorDom(b,function(a){return f.hasClass(a,"item")},3);if(d&&(f.hasClass(b,"name")||f.hasClass(b,"alias"))&&(!f.hasClass(d,"empty")||!f.hasClass(b,"name"))){this._dijit?(this.editState="active",this.updateInputDivPre=this.updateInputDiv,this._dijitPre=this._dijit):this.editState="negative";a=this._getNodeText(b);var k=decodeURIComponent(f.getAttr(b,"data")),d=f.hasClass(d,"custom");
this.placeHolder=f.hasClass(b,"name")&&!this.codedValues?k:a;d?f.hasClass(b,"alias")&&this.placeHolder!==this.customLabel?this.currentLabel=a:this.currentLabel=NaN:this.currentLabel=this.isNumberField&&f.hasClass(b,"name")&&!this.codedValues?parseFloat(this.placeHolder):this.placeHolder;q.set(b,"innerHTML","");a="";f.hasClass(b,"name")&&(a='\x3cdiv class\x3d"searchBtn"\x3e\x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8"\x3e\x3c/div\x3e\x3c/div\x3e');this.updateInputDiv=f.create("div",{"class":"updateInputDiv",
innerHTML:'\x3cdiv class\x3d"inputDiv"\x3e\x3c/div\x3e'+a},b);a=h(".inputDiv",this.updateInputDiv)[0];this.searchBtn=h(".searchBtn",this.updateInputDiv)[0];this.own(p(this.updateInputDiv,"dblclick",r.hitch(this,function(a){a.stopPropagation();a.preventDefault()})));k={required:!1,intermediateChanges:!1,value:this.currentLabel};this.codedValues&&f.hasClass(b,"name")&&(k.disabled=!0);this.isNumberField&&f.hasClass(b,"name")?(k.constraints={pattern:"#####0.##########"},this._dijit=new e(k)):(k.trim=
!0,this._dijit=new t(k));this._dijit.startup();this._dijit.on("keydown",function(a){(a.keyCode||a.which)===c.ENTER&&this._dijit.emit("blur")}.bind(this));this._dijit.on("blur",r.hitch(this,function(){if(this._dijit){var a="Error"!==this._dijit.state?this._dijit.displayedValue:this.currentLabel;this.isNumberField&&f.hasClass(b,"name")&&"Error"===this._dijit.state&&this._dijit.setValue(parseFloat(a));var a=g.sanitizeHTML(a),d=this._dijit.get("value");""!==d&&d?f.hasClass(b,"name")&&(this.placeHolder===
this.customValue||"NaN"===this.placeHolder&&""!==this._dijit.displayedValue)&&(d=g.getAncestorDom(this._dijit.domNode,function(a){return f.hasClass(a,"item")},4),f.removeClass(d,"custom"),this.emit("editTable_itemChanged")):a=this.placeHolder;this.newLabel=a;setTimeout(r.hitch(this,function(){var a,b;if(this.isSearch||"active"===this.editState)"active"===this.editState&&(d=this.updateInputDivPre.parentNode,b=decodeURIComponent(f.getAttr(d,"data")),f.hasClass(d,"name")?this.currentValLabel=""===this._dijitPre.displayedValue?
b===this.customValue?this.customValue:this.isNumberField?this._getLocalNumber(b):b:this.isNumberField?this._getLocalNumber(this._dijitPre.value):this._dijitPre.value:this.currentValLabel=""===this._dijitPre.displayedValue?b===this.customLabel?this.customLabel:b:this._dijitPre.displayedValue,!f.hasClass(d,"name")||"NaN"===this.newLabel||this.newLabel===this.customValue||this._getNodeText(d.nextSibling)!==this.customLabel&&this._dijit.value!==this.customLabel||(f.isDescendant(this.updateInputDiv,d.nextSibling)?
this._dijit.set("value",this.currentValLabel):(a=this.isNumberField?this.currentValLabel:this.newLabel,f.setAttr(d.nextSibling,"data",encodeURIComponent(a)),this._setNodeText(d.nextSibling,a),f.setAttr(d.nextSibling,"title",a))),a=f.hasClass(d,"name")?""===this._dijitPre.displayedValue?b===this.customValue?this.customValue:b:this._dijitPre.value:this.newLabel,f.setAttr(d,"data",encodeURIComponent(a)),a=f.hasClass(d,"name")?this.currentValLabel:this.newLabel,this._setNodeText(d,a),f.setAttr(d,"title",
a),this._dijitPre=this.updateInputDivPre=null,this.editState="negative");else{var d=this.updateInputDiv.parentNode;b=decodeURIComponent(f.getAttr(d,"data"));f.hasClass(d,"name")?this.currentValLabel=""===this._dijit.displayedValue?b===this.customValue?this.customValue:this.isNumberField?this._getLocalNumber(b):b:this.isNumberField?this._getLocalNumber(this._dijit.value):this._dijit.value:this.currentValLabel=""===this._dijit.displayedValue?b===this.customLabel?this.customLabel:b:this._dijit.displayedValue;
f.hasClass(d,"name")&&"NaN"!==this.newLabel&&this.newLabel!==this.customValue&&this._getNodeText(d.nextSibling)===this.customLabel&&(a=this.isNumberField?this.currentValLabel:this.newLabel,f.setAttr(d.nextSibling,"data",encodeURIComponent(a)),this._setNodeText(d.nextSibling,a),f.setAttr(d.nextSibling,"title",a));a=f.hasClass(d,"name")?""===this._dijit.displayedValue?b===this.customValue?this.customValue:b:this._dijit.value:this.newLabel;f.setAttr(d,"data",encodeURIComponent(a));a=f.hasClass(d,"name")?
this.currentValLabel:this.newLabel;this._setNodeText(d,a);f.setAttr(d,"title",a);this._dijit=null;this.isSearch=!1}}),300);this.placeHolder=""}}));f.setStyle(this._dijit.domNode,"width","100%");this._dijit.placeAt(a);h("input",this._dijit.domNode)[1].focus();this.searchBtn&&(this.own(p(this.searchBtn,"click",r.hitch(this,function(a){this.isSearch||(this.isSearch=!0,this.searchTarget=a.target||a.srcElement,this.emit("editTable_openListSelectByName",this.newLabel),a.stopPropagation(),a.preventDefault())}))),
this.codedValues&&this.searchBtn.click())}},_getLocalNumber:function(a){"string"===typeof a&&(a=parseFloat(a));this.emit("editTable_getValLabelsArrayForNumber",!0,[a]);return this.currentValLabel},_setNewLabel:function(a,b){var d;void 0===a&&void 0===b&&(""!==this._dijit.displayedValue?this.codedValues?(b=this._dijit.displayedValue,a=this._getCodeFromCodevalueLabel(b)):(b=a=this._dijit.value,this.isNumberField&&this.newLabel!==this.customValue&&(b=this._getLocalNumber(a))):(a=b=this.customValue,this.updateInputDiv&&
this.updateInputDiv.parentNode&&(d=this.updateInputDiv.parentNode,d=decodeURIComponent(f.getAttr(d,"data")),d!==this.customValue&&(a=this.isNumberField?parseFloat(d):d,b=this.codedValues?this._getLabelFromCodevalue(a):this.isNumberField?this._getLocalNumber(a):a))));this.updateInputDiv&&this.updateInputDiv.parentNode&&(d=this.updateInputDiv.parentNode,b!==this.customValue&&this._getNodeText(d.nextSibling)===this.customLabel&&(f.setAttr(d.nextSibling,"data",encodeURIComponent(b)),this._setNodeText(d.nextSibling,
b),f.setAttr(d.nextSibling,"title",b)),this.codedValues||(a=a?a:decodeURIComponent(f.getAttr(d,"data"))),f.setAttr(d,"data",encodeURIComponent(a)),a=d.parentNode,b!==this.customValue&&f.removeClass(a,"custom"),this._setNodeText(d,b),f.setAttr(d,"title",b));this._dijit=this.updateInputDiv=null},_onListContentClicked:function(a){a=a.target||a.srcElement;var b=g.getAncestorDom(a,function(a){return f.hasClass(a,"item")},3);b&&(f.hasClass(a,"checkboxEmpty")?f.hasClass(a,"checked")?f.removeClass(a,"checked"):
f.addClass(a,"checked"):f.hasClass(a,this.inputType)?("radio"===this.inputType&&!0===this.currentItem&&(this.currentItem=this.getCurrentItem()),f.hasClass(a,"checked")?"radio"!==this.inputType?f.removeClass(a,"checked"):f.hasClass(this.currentItem,"checked")||f.removeClass(a,"checked"):("radio"===this.inputType&&this.currentItem&&f.removeClass(this.currentItem,"checked"),f.addClass(a,"checked"),this.currentItem=a)):f.hasClass(a,"action")&&(f.hasClass(a,"up")?b.previousElementSibling&&f.place(b,b.previousElementSibling,
"before"):f.hasClass(a,"down")?b.nextElementSibling&&f.place(b,b.nextElementSibling,"after"):f.hasClass(a,"delete")&&(f.destroy(b),this.emit("editTable_itemChanged"))))},_getLabelFromCodevalue:function(a){for(var b=a,d=0;d<this.codedValues.length;d++){var c=this.codedValues[d];if(c.value===a){b=c.label;break}}return b},_getCodeFromCodevalueLabel:function(a){for(var b=a,d=0;d<this.codedValues.length;d++){var c=this.codedValues[d];if(c.label===a){b=c.value;break}}return b},_createEmptyTarget:function(a){for(var b=
this.emptyStr,d=this.emptyLabel?this.emptyLabel:b,c=" checked",e=0;e<a.length;e++)if(a[e].isChecked){c="";break}" checked"===c&&(this.currentItem=!0);var e='data\x3d"'+encodeURIComponent(b)+'"',g="",h=this.Nls.emptyValueTips;if(0===a.length||this.enableEmpty)g=" checked";return f.create("div",{"class":"item empty",innerHTML:'\x3cdiv class\x3d"label name jimu-ellipsis" style\x3d"cursor: default;"'+e+"\x3e"+b+'\x3c/div\x3e\x3cdiv class\x3d"label alias jimu-ellipsis-Blanks" data\x3d"'+d+'"\x3e'+d+'\x3c/div\x3e\x3cdiv class\x3d"label '+
this.inputType+c+' jimu-ellipsis"\x3e\x3c/div\x3e\x3cdiv class\x3d"label checkbox checkboxEmpty'+g+' jimu-ellipsis jimu-flipx" title\x3d"'+h+'"\x3e\x3c/div\x3e'},this.listContent)},_createTarget:function(a,b,c,e,g){var d="item";g&&(a=b=this.customValue,c=this.customLabel,d="item custom");a=a||0===a?a:"";b=b||"";c=c?c:a;e=e?e:"";var k=a;(this.codedValues||this.isNumberField)&&a!==this.Nls.addValuePlaceHolder&&(k=this.codedValues?this._getLabelFromCodevalue(a):b);b=this.isNumberField?a:encodeURIComponent(a);
e=f.create("div",{"class":d,innerHTML:'\x3cdiv class\x3d"label name jimu-ellipsis-Blanks" '+('data\x3d"'+b+'"')+"\x3e"+k+'\x3c/div\x3e\x3cdiv class\x3d"label alias jimu-ellipsis-Blanks" data\x3d"'+c+'"\x3e'+c+'\x3c/div\x3e\x3cdiv class\x3d"label '+this.inputType+e+' jimu-ellipsis"\x3e\x3c/div\x3e\x3cdiv class\x3d"actions jimu-float-trailing"\x3e\x3cdiv class\x3d"delete action jimu-float-trailing"\x3e\x3c/div\x3e\x3cdiv class\x3d"down action jimu-float-trailing"\x3e\x3c/div\x3e\x3cdiv class\x3d"up action jimu-float-trailing"\x3e\x3c/div\x3e\x3c/div\x3e'},
this.listContent);g&&(g=h(".name",e)[0],f.setAttr(g,"title",a),f.setAttr(g.nextSibling,"title",c));return e},_destroyTarget:function(a){for(var b=h(".item .name",this.listContent),d=0;d<b.length;d++){var c=b[d];if(q.get(this._dijit.domNode.parentNode,"innerHTML")===a){f.destroy(c.parentNode);break}}},getCurrentItem:function(){for(var a=h(".item .radio",this.listContent),b=0;b<a.length;b++){var c=a[b];if(f.hasClass(c,"checked"))return c}return null},_getEmptyLabel:function(){var a=h(".label.alias",
this.listContent.firstChild)[0],b=this._getNodeText(a);a.children.length&&(b="Error"===this._dijit.state?decodeURIComponent(f.getAttr(a,"data")):this._dijit.value);return b=g.sanitizeHTML(b)},_getEmptyStatus:function(){var a=h(".checkboxEmpty",this.listContent.firstChild)[0];return f.hasClass(a,"checked")?!0:!1},_getNodeText:function(a){return a.textContent||a.innerText||""},_setNodeText:function(a,b){a.innerHTML="\x26nbsp;";a.textContent?a.textContent=b:a.innerText=b},getListValues:function(){this.listItemsArray=
[];this.listValuesArray=[];for(var a=h(".item .name",this.listContent),b="radio"===this.inputType?1:0;b<a.length;b++){var c=a[b],e=g.getAncestorDom(c,function(a){return f.hasClass(a,"item")},3);if(!f.hasClass(e,"custom")){var e=this._getNodeText(c),k=decodeURIComponent(f.getAttr(c,"data"));if(this.isNumberField||this.codedValues)e=k;c.children.length&&(e="Error"===this._dijit.state?k:this._dijit.value,this.codedValues&&(e=this._getCodeFromCodevalueLabel(e),e=void 0!==e?e:k));e=this.isNumberField?
parseFloat(e):g.sanitizeHTML(e);k=this._getNodeText(c.nextSibling);k===this.customLabel&&(k=e.toString(),this.isNumberField&&(k=this._getLocalNumber(k)));c.nextSibling.children.length&&(k="Error"===this._dijit.state?decodeURIComponent(f.getAttr(c.nextSibling,"data")):this._dijit.value);k=g.sanitizeHTML(k);k={value:e,alias:k,isChecked:!1};this.listItemsArray.push(k);this.listValuesArray.push(e);f.hasClass(c.nextSibling.nextSibling,"checked")&&(k.isChecked=!0)}}a={list:this.listItemsArray,valueList:this.listValuesArray};
"radio"===this.inputType&&(a.emptyLabel=this._getEmptyLabel(),a.enableEmpty=this._getEmptyStatus());return a},setListValues:function(a,b){q.set(this.listContent,"innerHTML","");"radio"===this.inputType&&this._createEmptyTarget(a);for(var d=0;d<a.length;d++){var c=a[d],e="";c.isChecked&&(e=" checked",this.currentItem=!0);this._createTarget(c.value,b?b[d].label:c.value,c.alias,e)}a=h(".name",this.listContent);for(b=0;b<a.length;b++)d=a[b],f.setAttr(d,"title",this._getNodeText(d)),d=d.nextSibling,f.setAttr(d,
"title",this._getNodeText(d))},_initTable:function(){},getDijits:function(){return[this.mutiValuesSelect]},destroy:function(){this.inherited(arguments)}})})},"dojox/form/CheckedMultiSelect":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/event dojo/dom-geometry dojo/dom-class dojo/dom-construct dojo/i18n dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/registry dijit/Menu dijit/MenuItem dijit/Tooltip dijit/form/_FormSelectWidget dijit/form/ComboButton dojo/text!dojox/form/resources/_CheckedMultiSelectMenuItem.html dojo/text!dojox/form/resources/_CheckedMultiSelectItem.html dojo/text!dojox/form/resources/CheckedMultiSelect.html dojo/i18n!dojox/form/nls/CheckedMultiSelect dijit/form/CheckBox".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C){var D=r("dojox.form._CheckedMultiSelectItem",[h,t,e],{templateString:B,baseClass:"dojoxMultiSelectItem",option:null,parent:null,disabled:!1,readOnly:!1,postMixInProperties:function(){this._type=this.parent.multiple?{type:"checkbox",baseClass:"dijitCheckBox"}:{type:"radio",baseClass:"dijitRadio"};this.disabled||(this.disabled=this.option.disabled=this.option.disabled||!1);this.readOnly||(this.readOnly=this.option.readOnly=this.option.readOnly||!1);
this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.labelNode.innerHTML=this.option.label},_changeBox:function(){this.get("disabled")||this.get("readOnly")||(this.parent.multiple?this.option.selected=this.checkBox.get("value")&&!0:this.parent.set("value",this.option.value),this.parent._updateSelection(),this.parent.focus())},_onClick:function(a){this.get("disabled")||this.get("readOnly")?p.stop(a):this.checkBox._onClick(a)},_updateBox:function(){this.checkBox.set("value",
this.option.selected)},_setDisabledAttr:function(a){this.disabled=a||this.option.disabled;this.checkBox.set("disabled",this.disabled);q.toggle(this.domNode,"dojoxMultiSelectDisabled",this.disabled)},_setReadOnlyAttr:function(a){this.checkBox.set("readOnly",a);this.readOnly=a}}),y=r("dojox.form._CheckedMultiSelectMenu",m,{multiple:!1,buildRendering:function(){this.inherited(arguments);var a=this.menuTableNode=this.domNode,b=this.domNode=n.create("div",{style:{overflowX:"hidden",overflowY:"scroll"}});
a.parentNode&&a.parentNode.replaceChild(b,a);q.remove(a,"dijitMenuTable");b.className=a.className+" dojoxCheckedMultiSelectMenu";a.className="dijitReset dijitMenuTable";a.setAttribute("role","listbox");b.setAttribute("role","presentation");b.appendChild(a)},resize:function(a){a&&(c.setMarginBox(this.domNode,a),"w"in a&&(this.menuTableNode.style.width="100%"))},onClose:function(){this.inherited(arguments);this.menuTableNode&&(this.menuTableNode.style.width="")},onItemClick:function(a,b){"undefined"==
typeof this.isShowingNow&&this._markActive();this.focusChild(a);if(a.disabled||a.readOnly)return!1;if(!this.multiple)this.onExecute();a.onClick(b)}}),w=r("dojox.form._CheckedMultiSelectMenuItem",a,{templateString:v,option:null,parent:null,iconClass:"",postMixInProperties:function(){this.parent.multiple?(this._iconClass="dojoxCheckedMultiSelectMenuCheckBoxItemIcon",this._type={type:"checkbox"}):(this._iconClass="",this._type={type:"hidden"});this.disabled=this.option.disabled;this.checked=this.option.selected;
this.label=this.option.label;this.readOnly=this.option.readOnly;this.inherited(arguments)},onChange:function(a){},_updateBox:function(){q.toggle(this.domNode,"dojoxCheckedMultiSelectMenuItemChecked",!!this.option.selected);this.domNode.setAttribute("aria-checked",this.option.selected);this.inputNode.checked=this.option.selected;this.parent.multiple||q.toggle(this.domNode,"dijitSelectSelectedOption",!!this.option.selected)},_onClick:function(a){this.disabled||this.readOnly||(this.parent.multiple?(this.option.selected=
!this.option.selected,this.parent.onChange(),this.onChange(this.option.selected)):this.option.selected||(l.forEach(this.parent.getChildren(),function(a){a.option.selected=!1}),this.option.selected=!0,this.parent.onChange(),this.onChange(this.option.selected)));this.inherited(arguments)}});return r("dojox.form.CheckedMultiSelect",d,{templateString:z,baseClass:"dojoxCheckedMultiSelect",required:!1,invalidMessage:"$_unset_$",_message:"",dropDown:!1,labelText:"",tooltipPosition:[],postMixInProperties:function(){this.inherited(arguments);
this._nlsResources=k.getLocalization("dojox.form","CheckedMultiSelect",this.lang);"$_unset_$"==this.invalidMessage&&(this.invalidMessage=this._nlsResources.invalidMessage)},_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this.value=this.options[0<=a?a:0].value}this.dropDown&&(q.toggle(this.selectNode,"dojoxCheckedMultiSelectHidden"),this.dropDownMenu=new y({id:this.id+"_menu",style:"display: none;",multiple:this.multiple,
onChange:f.hitch(this,"_updateSelection")}))},startup:function(){this.dropDown&&(this.dropDownButton=new u({label:this.labelText,dropDown:this.dropDownMenu,baseClass:"dojoxCheckedMultiSelectButton",maxHeight:this.maxHeight},this.comboButtonNode));this.inherited(arguments)},_onMouseDown:function(a){a.preventDefault()},validator:function(){return this.required?l.some(this.getOptions(),function(a){return a.selected&&null!=a.value&&0!=a.value.toString().length}):!0},validate:function(a){g.hide(this.domNode);
(a=this.isValid(a))||this.displayMessage(this.invalidMessage);return a},isValid:function(a){return this.validator()},getErrorMessage:function(a){return this.invalidMessage},displayMessage:function(a){g.hide(this.domNode);a&&g.show(a,this.domNode,this.tooltipPosition)},onAfterAddOptionItem:function(a,b){},_addOptionItem:function(a){var b;this.dropDown?(b=new w({option:a,parent:this.dropDownMenu}),this.dropDownMenu.addChild(b)):(b=new D({option:a,parent:this,disabled:this.disabled,readOnly:this.readOnly}),
this.wrapperDiv.appendChild(b.domNode));this.onAfterAddOptionItem(b,a)},_refreshState:function(){this.validate(this.focused)},onChange:function(a){this._refreshState()},reset:function(){this.inherited(arguments);g.hide(this.domNode)},_updateSelection:function(){this.inherited(arguments);this._handleOnChange(this.value);l.forEach(this._getChildren(),function(a){a._updateBox()});n.empty(this.containerNode);var a=this;l.forEach(this.value,function(b){b=n.create("option",{value:b,label:b,selected:"selected"});
n.place(b,a.containerNode)});if(this.dropDown&&this.dropDownButton){var b=0,d="";l.forEach(this.options,function(a){a.selected&&(b++,d=a.label)});this.dropDownButton.set("label",this.multiple?f.replace(this._nlsResources.multiSelectLabelText,{num:b}):d)}},_getChildren:function(){return this.dropDown?this.dropDownMenu.getChildren():l.map(this.wrapperDiv.childNodes,function(a){return b.byNode(a)})},invertSelection:function(a){this.multiple&&(l.forEach(this.options,function(a){a.selected=!a.selected}),
this._updateSelection())},_setDisabledAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDownButton.set("disabled",a);l.forEach(this._getChildren(),function(b){b&&b.set&&b.set("disabled",a)})},_setReadOnlyAttr:function(a){this.inherited(arguments);"readOnly"in this.attributeMap&&this[this.attributeMap.readOnly].setAttribute("readonly",a);this.readOnly=a;l.forEach(this._getChildren(),function(b){b&&b.set&&b.set("readOnly",a)})},uninitialize:function(){g.hide(this.domNode);l.forEach(this._getChildren(),
function(a){a.destroyRecursive()});this.inherited(arguments)}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d){e("dijit-legacy-requires")&&d(0,function(){r(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return l("dijit.Menu",
g,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):f.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return m.get(this._iframeContentDocument(a))||this._iframeContentDocument(a).__parent__||a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||
a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(a){a=p.byId(a,this.ownerDocument);var d;if("iframe"==a.tagName.toLowerCase()){var e=a;d=this._iframeContentWindow(e);d=b.body(d.document)}else d=a==b.body(this.ownerDocument)?this.ownerDocument.documentElement:a;var f={node:a,iframe:e};c.set(a,"_dijitMenu"+this.id,this._bindings.push(f));var g=h.hitch(this,function(a){var b=this.selector,d=b?function(a){return t.selector(b,
a)}:function(a){return a},c=this;return[t(a,d(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<c._lastKeyDown+500||c._scheduleOpen(this,e,{x:a.pageX,y:a.pageY},a.target)}),t(a,d("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==k.F10||c.leftClickToOpen&&a.keyCode==k.SPACE)a.stopPropagation(),a.preventDefault(),c._scheduleOpen(this,e,null,a.target),c._lastKeyDown=(new Date).getTime()})]});f.connects=d?g(d):[];e&&(f.onloadHandler=
h.hitch(this,function(){var a=this._iframeContentWindow(e),a=b.body(a.document);f.connects=g(a)}),e.addEventListener?e.addEventListener("load",f.onloadHandler,!1):e.attachEvent("onload",f.onloadHandler))},unBindDomNode:function(a){var b;try{b=p.byId(a,this.ownerDocument)}catch(D){return}a="_dijitMenu"+this.id;if(b&&c.has(b,a)){for(var d=c.get(b,a)-1,e=this._bindings[d],f;f=e.connects.pop();)f.remove();(f=e.iframe)&&(f.removeEventListener?f.removeEventListener("load",e.onloadHandler,!1):f.detachEvent("onload",
e.onloadHandler));c.remove(b,a);delete this._bindings[d]}},_scheduleOpen:function(a,b,d,c){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:c,delegatedTarget:a,iframe:b,coords:d})},1))},_openMyself:function(b){function d(){t.refocus&&u&&u.focus();a.close(t)}var c=b.target,f=b.iframe,g=b.coords,h=!g;this.currentTarget=b.delegatedTarget;if(g){if(f){b=q.position(f,!0);var c=this._iframeContentWindow(f),c=q.docScroll(c.document),k=n.getComputedStyle(f),
l=n.toPixelValue,m=(e("ie")&&e("quirks")?0:l(f,k.paddingLeft))+(e("ie")&&e("quirks")?l(f,k.borderLeftWidth):0),f=(e("ie")&&e("quirks")?0:l(f,k.paddingTop))+(e("ie")&&e("quirks")?l(f,k.borderTopWidth):0);g.x+=b.x+m-c.x;g.y+=b.y+f-c.y}}else g=q.position(c,!0),g.x+=10,g.y+=10;var t=this,f=this._focusManager.get("prevNode");b=this._focusManager.get("curNode");var u=!b||p.isDescendant(b,this.domNode)?f:b;a.open({popup:this,x:g.x,y:g.y,onExecute:d,onCancel:d,orient:this.isLeftToRight()?"L":"R"});this.focus();
h||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);a.close(this)}},destroy:function(){f.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(r,f,l,p,c,q,n,k,h){p("dijit-legacy-requires")&&
q(0,function(){r(["dijit/form/RadioButton"])});return f("dijit.form.CheckBox",[n,k],{templateString:h,baseClass:"dijitCheckBox",_setValueAttr:function(c,e){"string"==typeof c&&(this.inherited(arguments),c=!0);this._created&&this.set("checked",c,e)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&
c("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&c("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(r,f){return r("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(l){this._set("readOnly",l);f.set(this.focusNode,"readOnly",
l)},_setLabelAttr:void 0,_getSubmitValue:function(f){return null==f||""===f?"on":f},_setValueAttr:function(l){l=this._getSubmitValue(l);this._set("value",l);f.set(this.focusNode,"value",l)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));f.set(this.focusNode,"value",this.value)},_onClick:function(f){return this.readOnly?(f.stopPropagation(),f.preventDefault(),!1):this.inherited(arguments)}})})},"jimu/dijit/_filter/NumberListValueProvider":function(){define("dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/declare ./ValueProvider dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./NumberListValueProvider.html dijit/form/NumberTextBox dijit/form/Select".split(" "),
function(r,f,l,p,c,q,n,k){return p([c,q,n],{templateString:k,postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-number-list-filter-value-provider");this.rangeSelect.removeOption(this.rangeSelect.getOptions());l.forEach("dateOperatorMinutes dateOperatorHours dateOperatorDays dateOperatorWeeks dateOperatorMonths dateOperatorYears".split(" "),r.hitch(this,function(c){this.rangeSelect.addOption({value:c,label:this.nls[c]})}));this.rangeSelect.set("value","dateOperatorDays")},
getDijits:function(){return[this._dijit1,this.rangeSelect]},setValueObject:function(c){this.isDefined(c.value)&&this._dijit1.set("value",c.value);this.isDefined(c.range)&&this.rangeSelect.set("value",c.range)},getValueObject:function(){return this.isValidValue()?{isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()}:null},_getRangeByUI:function(){var c=this.rangeSelect.get("value");"none"===c&&(c=null);return c},tryGetValueObject:function(){if(this.isValidValue())return this.getValueObject();
if(this.isEmptyValue()){var c={isValid:!0,type:this.partObj.valueObj.type,value:parseFloat(this._dijit1.get("value")),range:this._getRangeByUI()};isNaN(c.value)&&(c.value=null);return c}return null},setRequired:function(c){this._dijit1.set("required",c);this.rangeSelect.set("required",c)}})})},"jimu/dijit/_filter/DateIsInValueProvider":function(){define("dojo/Evented dojo/_base/html dojo/_base/lang dojo/_base/declare dijit/_WidgetsInTemplateMixin dojo/text!./DateIsInValueProvider.html ./ValueProvider jimu/filterUtils jimu/utils dijit/form/Select dijit/form/DateTextBox".split(" "),
function(r,f,l,p,c,q,n,k,h){return p([n,c,r],{templateString:q,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.filterBuilder},virtualDates:null,postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-date-is-in-value-provider");this.dateTypeSelect.addOption({value:"",label:"\x26nbsp;"});return["thisWeek","thisMonth","thisQuarter","thisYear"].forEach(l.hitch(this,function(c){this.dateTypeSelect.addOption({value:c,label:this.nls[c]})}))},getDijits:function(){return[this.dateTypeSelect]},
_setValueObject:function(c,e,b,f){if(this.isDefined(e[b])){var a={value:null,virtualDate:""};a.value=e[b];a.virtualDate=e[f];c.setValueObject(a)}},setValueObject:function(c){this.dateTypeSelect.set("value",c.virtualDate)},getValueObject:function(){return this.isValidValue()?this.tryGetValueObject():null},tryGetValueObject:function(){if(this.isInvalidValue())return null;var c={isValid:!0,type:this.partObj.valueObj.type,value:null,virtualDate:this.dateTypeSelect.get("value")},e=this.dateTypeSelect.get("value"),
b=k.getRealDateByVirtualDate(e);c.virtualDate=e;b&&(c.value1=h.getDateTimeStr(b[0],"YYYY-MM-DD"),c.value2=h.getDateTimeStr(b[1],"YYYY-MM-DD"));return c},setRequired:function(c){this.dateTypeSelect.set("required",c)},getStatus:function(){return this.dateTypeSelect.get("value")?1:0},_onDateTypeSelectChanged:function(){this.emit("change")}})})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(r,f,l){return r("dijit.form.DateTextBox",l,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",
popupClass:f,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"jimu/dijit/_SingleFilter":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilter.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/keys dijit/a11yclick dijit/focus dojo/query dojo/store/Memory jimu/utils jimu/filterUtils dijit/Tooltip dojo/mouse jimu/dijit/_filter/ValueProviderFactory dijit/popup jimu/dijit/CheckBox dijit/form/Select dijit/form/FilteringSelect dijit/form/ValidationTextBox".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,z,C){return f([l,p,c,r],{templateString:q,baseClass:"jimu-single-filter",declaredClass:"jimu.dijit._SingleFilter",nls:null,url:null,layerInfo:null,popupFieldsInfo:[],stringFieldType:"",dateFieldType:"",numberFieldTypes:[],supportFieldTypes:[],part:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,valueProvider:null,dateOptionsObj:{status:!1},allDates:[u.VIRTUAL_DATE_CUSTOM,u.VIRTUAL_DATE_TODAY,u.VIRTUAL_DATE_YESTERDAY,u.VIRTUAL_DATE_TOMORROW],
runtime:!1,widgetId:"",postMixInProperties:function(){this.supportFieldTypes=[];this.supportFieldTypes.push(this.stringFieldType);this.supportFieldTypes.push(this.dateFieldType);this.supportFieldTypes=this.supportFieldTypes.concat(this.numberFieldTypes);this.nls=window.jimuNls.filterBuilder;this.nls.deleteText=window.jimuNls.common.deleteText},postCreate:function(){this.inherited(arguments);this._initSelf();this.own(t(this.valueTypeSetNode,b,n.hitch(this,this._onValueTypeSetClick)));this.own(t(this.btnDelete,
b,n.hitch(this,function(){this._destroySelf()})));this.own(t(document,"click",n.hitch(this,function(a){a=a.target;k.isDescendant(a,this.valueTypePopupNode)&&!k.hasClass(a,"value-type-popup-icon")||this._closeEsriPopup()})));this.customDijit&&this.own(t(window,"resize",n.hitch(this,function(){this._closeEsriPopup()})))},toJson:function(){var a={fieldObj:"",operator:"",valueObj:"",interactiveObj:"",caseSensitive:!1},b=this._getFieldObjByUI();if(!b)return null;a.fieldObj=b;b=this._getOperatorByUI();
if(!b)return null;a.operator=b;a.caseSensitive=this.cbxCaseSensitive.getStatus()&&this.cbxCaseSensitive.getValue();var b=this._getValueTypeByUI(),c=this._isUseAskForValues();if(c){if(!this.promptTB.validate())return this._showValidationErrorTip(this.promptTB),null;a.interactiveObj={prompt:d.sanitizeHTML(this.promptTB.get("value")),hint:d.sanitizeHTML(this.hintTB.get("value")),cascade:"none"};this.dateOptionsObj.status&&(1===this.dateOptionsObj.num?a.interactiveObj.virtualDates=this._getRelativeDatesByUI("start"):
(a.interactiveObj.virtualDates1=this._getRelativeDatesByUI("start"),a.interactiveObj.virtualDates2=this._getRelativeDatesByUI("end")));if("unique"===b||"multiple"===b)a.interactiveObj.cascade=this.cascadeSelect.get("value")}a.valueObj={isValid:!0,type:""};c=c?this.valueProvider.tryGetValueObject():this.valueProvider.getValueObject();if(!c)return null;c.type=b;a.valueObj=c;return a},_getRelativeDatesByUI:function(a){var b=[];h.forEach(this.allDates,function(d){this[d+"_"+a+"_date"].checked&&b.push(d)},
this);return b},_removeRelativeDateChangeEvents:function(){h.forEach(this.allDates,function(a){var b=this[a+"_start_date"];b.changeEvent&&b.changeEvent.remove();2===this.dateOptionsObj.num&&(a=this[a+"_end_date"],a.changeEvent&&a.changeEvent.remove())},this)},_getFieldObjByUI:function(){var a=this._getSelectedFilteringItem(this.fieldsSelect);if(!a)return null;var b="";0!==this.popupFieldsInfo.length&&(b=d.getDateFieldFormatByFieldName(this.popupFieldsInfo,a.name));return{name:a.name,label:a.name,
dateFormat:b,shortType:a.shortType,type:a.type}},_getOperatorByUI:function(){var a=this.operatorsSelect.get("value");"none"===a&&(a=null);return a},showDelteIcon:function(){k.setStyle(this.btnDelete,"display","inline-block")},hideDeleteIcon:function(){k.setStyle(this.btnDelete,"display","none")},_showCaseSensitive:function(){k.setStyle(this.cbxCaseSensitive.domNode,"display","inline-block")},_hideCaseSensitive:function(){k.setStyle(this.cbxCaseSensitive.domNode,"display","none")},_showAndEnableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!0);
this._showCaseSensitive()},_hideAndDisableCaseSensitive:function(){this.cbxCaseSensitive.setStatus(!1);this._hideCaseSensitive()},_initSelf:function(){this.isHosted&&(this.cbxCaseSensitive.setValue(!1),this.cbxCaseSensitive.setStatus(!1),this.cbxCaseSensitive.domNode.title=this.nls.notSupportCaseSensitiveTip);this.own(t(this.fieldsSelect,"MouseEnter",n.hitch(this,this._updateFieldsSelectTitle)));this.own(t(this.operatorsSelect,"MouseEnter",n.hitch(this,this._updateOperatorsSelectTitle)));this.enableAskForValues?
(k.setStyle(this.cbxAskValues.domNode,"display","inline-block"),k.setStyle(this.promptSection,"display","block"),this.own(t(this.cbxAskValues,"status-change",n.hitch(this,this._onCbxAskValuesStatusChanged))),this.cbxAskValues.onChange=n.hitch(this,this._onCbxAskValuesClicked)):(k.setStyle(this.cbxAskValues.domNode,"display","none"),k.setStyle(this.promptSection,"display","none"));var a=this.layerInfo.fields;a&&0<a.length&&(a=h.filter(a,n.hitch(this,function(a){return 0<=this.supportFieldTypes.indexOf(a.type)})),
0<a.length&&(this._initValueTypeUI(),this._enableAllValueTypeOptions(),this._initFieldsSelect(a),this.part?this._showPart(this.part):this._resetByFieldAndOperator(),setTimeout(n.hitch(this,function(){this._bindFieldsSelectChangeAndOperatorChangeEvents()}),10)))},_bindFieldsSelectChangeAndOperatorChangeEvents:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this.fieldsSelect&&(this._handle1=t(this.fieldsSelect,"change",n.hitch(this,this._onFieldsSelectChange)));this.operatorsSelect&&
(this._handle2=t(this.operatorsSelect,"change",n.hitch(this,this._onOperatorsSelectChange)))},_removeFieldsSelectChangeAndOperatorChangeEvents:function(){this._handle1&&this._handle1.remove();this._handle2&&this._handle2.remove();this._handle2=this._handle1=null},_isServiceSupportDistinctValues:function(a,b){if(this._isStreamServer(a))return!1;a=b.currentVersion?b:b.toJson().layerDefinition;return 10.1<=parseFloat(a.currentVersion)},_isStreamServer:function(a){a=(a||"").replace(/\/*$/g,"");return/\/StreamServer$/gi.test(a)},
_updateFieldsSelectTitle:function(){this.fieldsSelect.domNode.title="";var a=this._getSelectedFilteringItem(this.fieldsSelect);a&&(this.fieldsSelect.domNode.title=a.displayName||a.alias||a.name)},_updateOperatorsSelectTitle:function(){this.operatorsSelect.domNode.title="";var a=this.operatorsSelect.get("value");a&&(a=this.operatorsSelect.getOptions(a),this.operatorsSelect.domNode.title=a.label,k.setAttr(this.operatorsSelect.domNode,"aria-label",a.label))},_showValidationErrorTip:function(a){try{!a.validate()&&
a.domNode&&a.focusNode&&(a.focusNode.focus(),a.focusNode.blur())}catch(y){console.error(y)}},_getSelectedFilteringItem:function(a){if(a.validate()){var b=a.get("item");if(b)return b}this._showValidationErrorTip(a);return null},_getShortTypeByFieldType:function(a){return a===this.stringFieldType?"string":a===this.dateFieldType?"date":0<=this.numberFieldTypes.indexOf(a)?"number":null},_initFieldsSelect:function(a){a=h.map(a,n.hitch(this,function(a,b){var d=n.mixin({},a);d.id=b;d.shortType=this._getShortTypeByFieldType(a.type);
d.alias||(d.alias=d.name);a="";"string"===d.shortType?a=this.nls.string:"number"===d.shortType?a=this.nls.number:"date"===d.shortType&&(a=this.nls.date);d.displayName=d.alias+" ("+a+")";return d}));if(0<a.length){var b=new g({data:a});this.fieldsSelect.set("store",b);this.fieldsSelect.set("value",a[0].id)}setTimeout(n.hitch(this,function(){this.fieldsSelect&&this.fieldsSelect.focusNode&&this.fieldsSelect.focusNode.focus()}),2);this._updateOperatorsByFieldsSelect()},_showPart:function(a){if((this.part=
a)&&this.part.fieldObj&&this.part.operator&&this.part.valueObj){this._removeFieldsSelectChangeAndOperatorChangeEvents();var b=this.part.fieldObj.name;a=this.part.operator;this.part.caseSensitive=!!this.part.caseSensitive;b=this.fieldsSelect.store.query({name:b});0!==b.length&&(b=b[0])&&(this.fieldsSelect.set("value",b.id),this._updateOperatorsByFieldsSelect(),this.operatorsSelect.set("value",a),this._resetByFieldAndOperator(this.part),a=this.part.interactiveObj)&&(this.cbxAskValues.check(),this._updatePrompt(),
this.promptTB.set("value",a.prompt||""),this.hintTB.set("value",a.hint||""),"unique"===this.part.valueObj.type||"multiple"===this.part.valueObj.type?this.cascadeSelect.set("value",a.cascade):this.cascadeSelect.set("value","none"))}},_onFieldsSelectChange:function(){this._updateOperatorsByFieldsSelect();this._resetByFieldAndOperator()},_updateOperatorsByFieldsSelect:function(){this._updateFieldsSelectTitle();this.operatorsSelect.removeOption(this.operatorsSelect.getOptions());this.operatorsSelect.addOption({value:"none",
label:this.nls.none});var a=this._getSelectedFilteringItem(this.fieldsSelect);a&&(this.operatorsSelect.shortType=a.shortType,a=z.getOperatorsByShortType(a.shortType,this.isHosted),this.operatorsSelect.removeOption(this.operatorsSelect.getOptions()),h.forEach(a,n.hitch(this,function(a){this.operatorsSelect.addOption({value:a,label:this.nls[a]})})))},_onOperatorsSelectChange:function(){this._resetByFieldAndOperator()},_updateValueTypeClass:function(){k.removeClass(this.domNode,"value-type");k.removeClass(this.domNode,
"field-type");k.removeClass(this.domNode,"unique-type");k.removeClass(this.domNode,"support-cascade");var a=this._getValueTypeByUI();"value"===a?(k.addClass(this.domNode,"value-type"),this.cascadeSelect.set("value","none")):"field"===a?(k.addClass(this.domNode,"field-type"),this.cascadeSelect.set("value","none")):(k.addClass(this.domNode,"unique-type"),this.cascadeSelect.set("value","previous"),a=!0,a=this._getSelectedFilteringItem(this.fieldsSelect),a=d.getCodedValuesOrTypesCount(a,this.layerInfo),
(a=0<a?d.isCodedValuesSupportFilter(this.layerInfo,a):!0)?(this.cascadeSelect.set("value","previous"),k.addClass(this.domNode,"support-cascade")):this.cascadeSelect.set("value","none"))},_enableValueTypeSelectOption:function(b,d){b=a("li[data-type\x3d"+b+"]",this.valueTypePopupNode)[0];d?(k.removeClass(b,"disabled"),k.setAttr(b,"aria-disabled","false")):(k.addClass(b,"disabled"),k.setAttr(b,"aria-disabled","true"))},_setVisibleValueTypeSelectOption:function(b,d){b=a("li[data-type\x3d"+b+"]",this.valueTypePopupNode)[0];
d?k.setStyle(b,"display","block"):k.setStyle(b,"display","none")},_calcValueTypePosition:function(a){var b,d;a=k.position(a.target);b=k.position(document.body).w;d=k.position(document.body).h;var c=k.getStyle(this.valueTypePopupNode,"width"),e=k.getStyle(this.valueTypePopupNode,"height");d=d-a.y-16-10>=e?a.y+16+10:a.y-e-10;b=b-a.x>=c?a.x:a.x+16-c;window.isRTL&&(b=a.x+16>=c?a.x+16-c:a.x);return{left:b,top:d}},_onValueTypeSetClick:function(a){C.open({popup:this.customDijit,around:a.target});var b=this._calcValueTypePosition(a);
C.open({x:b.left,y:b.top,popup:this.customDijit});a.stopPropagation();d.isInNavMode()&&m.focus(this.valueTypePopupDelBtn)},_onValueTypeClick:function(b){var d=k.getAttr(b.currentTarget,"data-type");k.hasClass(b.currentTarget,"disabled")?b.stopPropagation():(a("li",this.valueTypePopupNode).forEach(function(a){k.removeClass(a,"selected")}),k.addClass(b.currentTarget,"selected"),this._resetByFieldAndOperator(null,d),this._closeEsriPopup())},_enableValueTypeOption:function(a){this._enableValueTypeSelectOption("value",
a)},_enableFieldTypeOption:function(a){this._enableValueTypeSelectOption("field",a)},_enableUniqueTypeOption:function(a){this._enableValueTypeSelectOption("unique",a)},_enableUniquePredefinedTypeOption:function(a){this.runtime?this._setVisibleValueTypeSelectOption("uniquePredefined",!1):this._enableValueTypeSelectOption("uniquePredefined",a)},_enableValuesTypeOption:function(a){this._enableValueTypeSelectOption("values",a)},_enableMultipleTypeOption:function(a){this._enableValueTypeSelectOption("multiple",
a)},_enableMultiplePredefinedTypeOption:function(a){this.runtime?this._setVisibleValueTypeSelectOption("multiplePredefined",!1):this._enableValueTypeSelectOption("multiplePredefined",a)},_enableAllValueTypeOptions:function(){this._enableValueTypeOption(!0);this._enableFieldTypeOption(!0);this._enableUniqueTypeOption(!0);this._enableUniquePredefinedTypeOption(!0);this._enableMultipleTypeOption(!0);this._enableMultiplePredefinedTypeOption(!0)},_disableAllValueTypeOptions:function(){this._enableValueTypeOption(!1);
this._enableFieldTypeOption(!1);this._enableUniqueTypeOption(!1);this._enableUniquePredefinedTypeOption(!1);this._enableMultipleTypeOption(!1);this._enableMultiplePredefinedTypeOption(!1)},_resetByFieldAndOperator:function(a,b){this._updateOperatorsSelectTitle();this.valueProvider&&this.valueProvider.destroy();this._hideCaseSensitive();this._disableAllValueTypeOptions();a||(a={fieldObj:"",operator:"",valueObj:"",interactiveObj:"",caseSensitive:!1},a.fieldObj=this._getFieldObjByUI(),a.operator=this._getOperatorByUI());
a.widgetId=this.widgetId;var d=[],c=null;a.fieldObj&&a.operator&&(d=this.valueProviderFactory.getSupportedValueTypes(a.fieldObj.name,a.operator),a.valueObj?c=a.valueObj.type:(c=b&&0<=d.indexOf(b)?b:d[0],a.valueObj={type:c}),0<=d.indexOf("value")&&this._enableValueTypeOption(!0),0<=d.indexOf("field")&&this._enableFieldTypeOption(!0),0<=d.indexOf("unique")&&this._enableUniqueTypeOption(!0),0<=d.indexOf("values")&&this._enableValuesTypeOption(!0),0<=d.indexOf("uniquePredefined")&&this._enableUniquePredefinedTypeOption(!0),
0<=d.indexOf("multiple")&&this._enableMultipleTypeOption(!0),0<=d.indexOf("multiplePredefined")&&this._enableMultiplePredefinedTypeOption(!0),"value"===c?(this._enableValueTypeOption(!0),this.dateOptionsObj.status=!1,k.removeClass(this.domNode,"support-relative-start-date"),k.removeClass(this.domNode,"support-relative-end-date"),this._initDateOptionsUI(a)):"field"===c?this._enableFieldTypeOption(!0):"unique"===c?this._enableUniqueTypeOption(!0):"values"===c?this._enableValuesTypeOption(!0):"uniquePredefined"===
c?this._enableUniquePredefinedTypeOption(!0):"multiple"===c?this._enableMultipleTypeOption(!0):"multiplePredefined"===c&&this._enableMultiplePredefinedTypeOption(!0),this._updateValueTypeUI(c));0<d.length?(this.valueProvider=this.valueProviderFactory.getValueProvider(a,this.runtime),this.valueProvider.placeAt(this.valueProviderContainer),this.valueProvider.setValueObject(a.valueObj),this.own(t(this.valueProvider,"change",n.hitch(this,function(a,b){a&&this.dateOptionsObj.status&&this[a+"_"+b+"_date"].setValue(!0);
this.emit("change")}))),this.valueProvider.bindChangeEvents(),this.valueProvider.isBlankValueProvider()?(k.addClass(this.valueProvider.domNode,"hidden"),k.addClass(this.attributeValueContainer,"hidden")):k.removeClass(this.attributeValueContainer,"hidden"),(b=z.getOperatorInfo(a.operator))&&c&&(b[c]&&b[c].supportCaseSensitive&&this._showCaseSensitive(),a&&this.cbxCaseSensitive.setValue(a.caseSensitive))):k.addClass(this.attributeValueContainer,"hidden");this._updateWhenValueRadioChanged();this.emit("change")},
_initDateOptionsUI:function(a){a.fieldObj.type===this.dateFieldType&&(this.dateOptionsObj=z.isSupportVirtualDates(a.operator),this.dateOptionsObj.status&&(1===this.dateOptionsObj.num?(this._initDateOptions(a.interactiveObj.virtualDates,"start"),this.startDateOptions.innerHTML=this.nls.dateOptions):(this._initDateOptions(a.interactiveObj.virtualDates1,"start"),this._initDateOptions(a.interactiveObj.virtualDates2,"end"),k.addClass(this.domNode,"support-relative-end-date"),this.startDateOptions.innerHTML=
this.nls.startDateOptions),k.addClass(this.domNode,"support-relative-start-date")))},_initDateOptions:function(a,b){a||(a=this.allDates);h.forEach(this.allDates,function(d){var c=this[d+"_"+b+"_date"];c.changeEvent&&c.changeEvent.remove();c.setValue(0<=a.indexOf(d));c.changeEvent=t(c,"change",n.hitch(this,this._onShowTooltipCBXsChange,c,d,b))},this)},_onShowTooltipCBXsChange:function(a,b,d){if(a&&!1===a.checked){var c="";if(this._isCurrentDateOptIsSelected(b,d))c=this.nls.notUncheckedCurrent;else if(this._isDateOptionsAllHide(d))c=
this.nls.atLeastOne;else return;a.check();v.hide();v.show(c,a.domNode);this.own(t.once(a.domNode,B.leave,n.hitch(this,function(){v.hide(a.domNode)})))}},_isDateOptionsAllHide:function(a){var b=!0;h.some(this.allDates,function(d){if(!0===this[d+"_"+a+"_date"].checked)return b=!1,!0},this);return b},_isCurrentDateOptIsSelected:function(a,b){var d=this.valueProvider.getValueObject();if(d)if("start"===b)if(1===this.dateOptionsObj.num){if(!d.virtualDate&&a===u.VIRTUAL_DATE_CUSTOM||d.virtualDate===a)return!0}else{if(!d.virtualDate1&&
a===u.VIRTUAL_DATE_CUSTOM||d.virtualDate1===a)return!0}else if(!d.virtualDate2&&a===u.VIRTUAL_DATE_CUSTOM||d.virtualDate2===a)return!0;return!1},_updateWhenValueRadioChanged:function(){this._updatePrompt(!1,!0);this._updateValueTypeClass()},_onCbxAskValuesClicked:function(){this._updateRequiredProperty();this._updatePrompt(!0)},_onCbxAskValuesStatusChanged:function(){this._updateRequiredProperty()},_isUseAskForValues:function(){var a=this._getValueTypeByUI();return"uniquePredefined"===a||"multiplePredefined"===
a?!0:this.cbxAskValues.status&&this.cbxAskValues.checked},_isValueRequired:function(){return!this._isUseAskForValues()},_updateRequiredProperty:function(){var a=this._isValueRequired();this.valueProvider.setRequired(a)},_getValueTypeByUI:function(){var b=a("li.selected",this.valueTypePopupNode)[0];return b?k.getAttr(b,"data-type"):null},_closeEsriPopup:function(){this.customDijit&&C.close(this.customDijit)},_destroyEsriPopup:function(){this.customDijit&&(this.customDijit.destroy(),C.close(this.customDijit))},
_initValueTypeUI:function(){if(!this.valueTypePopupNode){this.valueTypePopupNode=document.createElement("DIV");k.addClass(this.valueTypePopupNode,"value-type-popup");this.valueTypePopupNode.innerHTML='\x3cdiv class\x3d"value-type-popup-header"\x3e\x3cspan class\x3d"value-type-popup-title jimu-ellipsis" title\x3d"'+this.nls.setInputType+'"\x3e'+this.nls.setInputType+'\x3c/span\x3e\x3cspan role\x3d"button" tabindex\x3d"0" aria-label\x3d"'+this.nls.deleteText+'" class\x3d"value-type-popup-icon jimu-icon jimu-icon-delete"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul role\x3d"listbox" tabindex\x3d"0"\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"value" title\x3d"'+
this.nls.value+'"\x3e\x3cspan\x3e'+this.nls.value+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"field" title\x3d"'+this.nls.field+'"\x3e\x3cspan\x3e'+this.nls.field+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"unique" title\x3d"'+this.nls.unique+'"\x3e\x3cspan\x3e'+this.nls.unique+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"uniquePredefined" title\x3d"'+
this.nls.uniquePredefined+'"\x3e\x3cspan\x3e'+this.nls.uniquePredefined+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"multiple" title\x3d"'+this.nls.multiple+'"\x3e\x3cspan\x3e'+this.nls.multiple+'\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3cli role\x3d"option" tabindex\x3d"-1" data-type\x3d"multiplePredefined" title\x3d"'+this.nls.multiplePredefined+'"\x3e\x3cspan\x3e'+this.nls.multiplePredefined+"\x3c/span\x3e\x3cspan\x3e\x3c/span\x3e\x3c/li\x3e\x3c/ul\x3e";
this.customDijit=new l({baseClass:"jimu-filter-valueType",domNode:this.valueTypePopupNode});this.valueTypePopupDelBtn=a(".value-type-popup-icon",this.valueTypePopupNode)[0];this.own(t(this.valueTypePopupDelBtn,"click",n.hitch(this,function(a){this._closeEsriPopup();a.stopPropagation()})));this.own(t(this.valueTypePopupDelBtn,"keydown",n.hitch(this,function(a){a.keyCode===e.ENTER||a.keyCode===e.SPACE||a.keyCode===e.ESCAPE?(a.stopPropagation(),this._closeEsriPopup(),d.isInNavMode()&&m.focus(this.valueTypeSetNode)):
a.shiftKey||a.keyCode!==e.TAB||this.valueTypeList.focus()})));this.valueTypeList=a("ul",this.valueTypePopupNode)[0];var b=a("li",this.valueTypePopupNode);this.own(t(this.valueTypeList,"focus",n.hitch(this,function(){this.selectedValueType=a("li.selected",this.valueTypePopupNode)[0];this.selectedValueType.focus()})));this.own(t(this.valueTypeList,"keydown",n.hitch(this,function(a){if(a.keyCode===e.TAB)a.shiftKey?(a.preventDefault(),this.valueTypePopupDelBtn.focus()):(a.preventDefault(),this._closeEsriPopup(),
d.isInNavMode()&&m.focus(this.valueTypeSetNode));else{var c,f=!1;if(a.keyCode===e.DOWN_ARROW)for(c=this.selectedValueType,a=0;a<b.length-1;a++)if(f){if("none"!==k.getStyle(b[a],"display")){c=b[a];break}}else b[a]===this.selectedValueType&&(f=!0);else if(a.keyCode===e.UP_ARROW)for(c=this.selectedValueType,a=b.length-1;0<=a;a--)if(f){if("none"!==k.getStyle(b[a],"display")){c=b[a];break}}else b[a]===this.selectedValueType&&(f=!0);else if(a.keyCode===e.HOME)c=b[0];else if(a.keyCode===e.END)for(a=b.length-
1;0<=a;a--)if("none"!==k.getStyle(b[a],"display")){c=b[a];break}c&&(this.selectedValueType=c,c.focus())}})));this.own(t(b,"click",n.hitch(this,function(a){this._onValueTypeClick(a)})));this.own(t(b,"keydown",n.hitch(this,function(a){a.keyCode===e.ENTER&&(this._onValueTypeClick(a),k.hasClass(a.target,"disabled")||this.valueTypeSetNode.focus())})));this.own(t(this.valueTypePopupNode,"keydown",n.hitch(this,function(a){a.keyCode===e.ESCAPE&&(a.stopPropagation(),m.focus(this.valueTypePopupDelBtn))})))}},
_updateValueTypeUI:function(b){a("li",this.valueTypePopupNode).forEach(function(a){k.removeClass(a,"selected")});if(b=a("li[data-type\x3d"+b+"]",this.valueTypePopupNode)[0])return k.addClass(b,"selected")},_updatePrompt:function(a,b){this.promptTB.set("value","");this.hintTB.set("value","");this.cbxAskValues.setStatus(!0);!a&&b&&this.cbxAskValues.uncheck(!0);k.setStyle(this.promptTable,"display","table");b=this.operatorsSelect.get("value");var d=this.nls[b],c=!1,e=this._getValueTypeByUI(),f=z.getOperatorInfo(b);
f&&e&&(f=f[e])&&f.supportAskForValue&&(c=!0);c||(this.cbxAskValues.uncheck(!0),this.cbxAskValues.setStatus(!1));f=this.cbxAskValues.getValue();(e=0<=["uniquePredefined","multiplePredefined"].indexOf(e)?!0:!1)?this.cbxAskValues.check(!0):a?f?this.cbxAskValues.check(!0):this.cbxAskValues.uncheck(!0):c?this.cbxAskValues.status||this.cbxAskValues.check(!0):this.cbxAskValues.uncheck(!0);this.cbxAskValues.status&&this.cbxAskValues.checked?(k.setStyle(this.promptTable,"display","table"),(a=this._getSelectedFilteringItem(this.fieldsSelect))&&
"none"!==b&&this.promptTB.set("value",(a.alias||a.name)+" "+d)):k.setStyle(this.promptTable,"display","none");e?(this.cbxAskValues.setStatus(!1),this.cascadeSelect.setDisabled(!0)):this.cascadeSelect.setDisabled(!1)},_destroySelf:function(){this.destroy()},destroy:function(){this._removeFieldsSelectChangeAndOperatorChangeEvents();this.dateOptionsObj.status&&this._removeRelativeDateChangeEvents();this._destroyEsriPopup();this.inherited(arguments)}})})},"jimu/dijit/_FilterSet":function(){define("dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_FilterSet.html dijit/registry dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dijit/a11yclick dojo/aspect dojo/query ./_SingleFilter".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g){return f([l,p,c,r],{templateString:q,baseClass:"jimu-filter-set",nls:null,url:null,layerInfo:null,popupFieldsInfo:[],stringFieldType:"",dateFieldType:"",numberFieldTypes:[],partsObj:null,OPERATORS:null,enableAskForValues:!1,isHosted:!1,valueProviderFactory:null,runtime:!1,widgetId:"",postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this.nls.deleteText=window.jimuNls.common.deleteText;this.nls.addText=window.jimuNls.common.add;this.inherited(arguments)},
postCreate:function(){this.inherited(arguments);this._initSelf()},toJson:function(){var b=a(".jimu-single-filter",this.allExpsBox),b=t.map(b,k.hitch(this,function(a){return n.byNode(a).toJson()}));return t.every(b,k.hitch(this,function(a){return!!a}))&&0<b.length?{logicalOperator:this.allAnySelect.value,parts:b}:null},showDelteIcon:function(){h.setStyle(this.btnDelete,"display","block")},hideDeleteIcon:function(){h.setStyle(this.btnDelete,"display","none")},_initSelf:function(){this.own(e(this.btnDelete,
b,k.hitch(this,function(){this._destroySelf()})));this.own(e(this.btnAdd,b,k.hitch(this,function(){this._addSingleFilter();this.emit("change")})));if(this.partsObj){this.allAnySelect.value=this.partsObj.logicalOperator;var a=this.partsObj.parts||[];0===a.length?(this._addSingleFilter(),this._addSingleFilter()):1===a.length?(this._addSingleFilter(a[0]),this._addSingleFilter()):t.forEach(a,k.hitch(this,function(a){this._addSingleFilter(a)}))}else this._addSingleFilter(),this._addSingleFilter();setTimeout(k.hitch(this,
function(){this.allAnySelect.focus()}),5)},_addSingleFilter:function(a){a=new g({widgetId:this.widgetId,url:this.url,layerInfo:this.layerInfo,popupFieldsInfo:this.popupFieldsInfo,stringFieldType:this.stringFieldType,dateFieldType:this.dateFieldType,numberFieldTypes:this.numberFieldTypes,part:a,OPERATORS:this.OPERATORS,enableAskForValues:this.enableAskForValues,isHosted:this.isHosted,valueProviderFactory:this.valueProviderFactory,isInFilterSet:!0,runtime:this.runtime});a.placeAt(this.allExpsBox);a.startup();
this.own(m.after(a,"_destroySelf",k.hitch(this,function(){this._checkFilterNumbers();this.allAnySelect.focus()})));this.own(e(a,"change",k.hitch(this,function(){this.emit("change")})));this._checkFilterNumbers();return a},_checkFilterNumbers:function(){var b=a(".jimu-single-filter",this.allExpsBox),c=2<b.length;t.forEach(b,k.hitch(this,function(a){a=n.byNode(a);c?a.showDelteIcon():a.hideDeleteIcon()}))},_destroySelf:function(){this.destroy()}})})},"jimu/dijit/FilterParameters":function(){define("dojo/on dojo/Evented dojo/Deferred dojo/promise/all dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/lang dojo/_base/html dojo/_base/array dojo/query dijit/registry jimu/filterUtils jimu/utils ./_SingleFilterParameter ./_filter/ValueProviderFactory".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u){return c([q,n,k,f],{baseClass:"jimu-filter-parameters",templateString:'\x3cdiv\x3e\x3ctable style\x3d"width:100%;border-collapse:collapse;"\x3e\x3ctbody data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e',_filterUtils:null,_spObj:null,nls:null,partsObj:null,layerInfo:null,OPERATORS:null,url:null,featureLayerId:null,widgetId:"",postMixInProperties:function(){this.nls=window.jimuNls.filterBuilder;this._filterUtils=new a;this.OPERATORS=
h.clone(this._filterUtils.OPERATORS);this._spObj={}},destroy:function(){this.clear();this._filterUtils=null;this.inherited(arguments)},getFilterExpr:function(a){var b=this._getNewValidPartsObj(this.partsObj,!0),d=b?this._getFilterExprByPartsObj(b):null;return a&&a.ifDisplaySQL?void 0===b.displaySQL?d:b.displaySQL:d},getValueProviders:function(){for(var a=[],b=this._getAllInteractiveSinglePartArray(this.partsObj),d=0;d<b.length;d++){var c=b[d].spId;c&&(c=this._getSingleFilterParameterBySpId(c),a.push(c))}return a},
_getNewValidPartsObj:function(a,b){a=h.clone(a);for(var d={logicalOperator:a.logicalOperator,parts:[]},c=h.hitch(this,function(a){if(a.spId){var b=this._getSingleFilterParameterBySpId(a.spId),d=b.getValueObject();a.valueObj=d;if(!d||"uniquePredefined"!==d.type&&"multiplePredefined"!==d.type)return d&&"multipleDynamic"===d.type?0<d.value.length?1:-1:d&&"unique"===d.type?null===d.value||void 0===d.value||""===d.value?-1:1:b.getStatus();var b=[],c;for(c in d.value)d.value[c].isChecked&&b.push(d.value[c]);
if(0<b.length)return a.valueObj.value=b,1;a.valueObj.value="";return-1}return a.valueObj?1:-1}),f=h.hitch(this,function(a){var b=c(a);0<b&&d.parts.push(a);return b}),g=h.hitch(this,function(a){var b=[];a.parts=e.filter(a.parts,h.hitch(this,function(a){a=c(a);b.push(a);return 0<a}));1===a.parts.length?d.parts.push(a.parts[0]):2<=a.parts.length&&d.parts.push(a);return Math.min.apply(b,b)}),k=0;k<a.parts.length;k++){var l=a.parts[k];if(l.parts){if(0>g(l)&&b)return null}else if(0>f(l)&&b&&l.valueObj&&
"uniquePredefined"!==l.valueObj.type&&"multiplePredefined"!==l.valueObj.type&&"unique"!==l.valueObj.type)return null}return d},_getFilterExprByPartsObj:function(a){this._filterUtils.isHosted=g.isHostedService(this.url);return this._filterUtils.getExprByFilterObj(a)},_getSingleFilterParameterBySpId:function(a){return this._spObj[a]},_getCascadeFilterPartsObj:function(a){var b={logicalOperator:this.partsObj.logicalOperator,parts:[]},d=h.clone(this.partsObj),c,f,g;c="none";a.interactiveObj&&a.interactiveObj.cascade&&
(c=a.interactiveObj.cascade);if("previous"===c)for(c=0;c<d.parts.length;c++)f=d.parts[c],f.majorCascadeIndex<a.majorCascadeIndex?b.parts.push(f):f.parts&&f.majorCascadeIndex===a.majorCascadeIndex&&(g=h.clone(f),g.parts=e.filter(g.parts,h.hitch(this,function(b){return b.minorCascadeIndex<a.minorCascadeIndex})),b.parts.push(g));else if("all"===c)for(c=0;c<d.parts.length;c++)f=d.parts[c],f.majorCascadeIndex!==a.majorCascadeIndex?b.parts.push(f):f.majorCascadeIndex===a.majorCascadeIndex&&f.parts&&(g=
h.clone(f),e.some(f.parts,h.hitch(this,function(b){return b.spId===a.spId}))&&(g.parts=e.filter(g.parts,h.hitch(this,function(b){return b.minorCascadeIndex!==a.minorCascadeIndex})),b.parts.push(g)));return b=this._getNewValidPartsObj(b,!1)},_getCascadeFilterExpr:function(a){var b="1\x3d1";(a=this._getCascadeFilterPartsObj(a))&&(b=this._getFilterExprByPartsObj(a));b||(b="1\x3d1");return b},clear:function(){this.featureLayerId=this.url=null;this.widgetId="";var a=b(".jimu-single-filter-parameter",this.tbody);
e.forEach(a,h.hitch(this,function(a){m.byNode(a).destroy()}));t.empty(this.tbody);this.layerInfo=this.partsObj=null},build:function(a,c,f,g,k){var m=new l;this.clear();this.url=a;this.layerInfo=c;this.partsObj=h.clone(f);this.partsObj=this._updatePartsObj(this.partsObj);this.featureLayerId=g;this.widgetId=k;this._setCascadeIndexForPartsObj(this.partsObj);a=this._getAllInteractiveSinglePartArray(this.partsObj);var n=this.partsObj.wId;if(0<a.length){var q=new u({url:this.url,layerDefinition:c,featureLayerId:this.featureLayerId});
a=e.map(a,h.hitch(this,function(a,e){n&&(a.vpId=n+"_"+e);a.widgetId=this.widgetId;e=t.create("tr",{innerHTML:"\x3ctd\x3e\x3c/td\x3e"},this.tbody);e=b("td",e)[0];var f=this._getFieldInfo(a.fieldObj.name,this.layerInfo),f=new d({nls:this.nls,url:this.url,layerDefinition:c,fieldInfo:f,part:a,valueProviderFactory:q});this.own(r(f,"change",h.hitch(this,this._onSingleFilterParameterChanged)));this.own(r(f,"enter",h.hitch(this,this._catchSingleFilterParameterEnter)));f.placeAt(e);f.startup();a.spId=f.id;
return this._spObj[f.id]=f}));e.forEach(a,h.hitch(this,function(a){a.valueProvider.getCascadeFilterExpr=h.hitch(this,this._getCascadeFilterExpr,a.part);a.valueProvider.getCascadeFilterPartsObj=h.hitch(this,this._getCascadeFilterPartsObj,a.part)}));a=e.map(a,h.hitch(this,function(a){return a.init()}));p(a).then(h.hitch(this,function(a){m.resolve(a)}),h.hitch(this,function(){m.reject()}))}else m.resolve();return m},_updatePartsObj:function(a){e.forEach(a,h.hitch(this,function(a){a.parts?e.forEach(a.parts,
h.hitch(this,function(a){a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")})):a.interactiveObj&&!0===a.interactiveObj.cascade?a.interactiveObj.cascade="previous":!1===a.interactiveObj.cascade&&(a.interactiveObj.cascade="none")}));return a},_setCascadeIndexForPartsObj:function(a){for(var b=0;b<a.parts.length;b++){var d=a.parts[b];d.majorCascadeIndex="AND"===a.logicalOperator?b:0;d.minorCascadeIndex=0;
d.cascadeIndex=d.majorCascadeIndex;if(d.parts)for(var c=0;c<d.parts.length;c++){var e=d.parts[c];e.majorCascadeIndex=d.majorCascadeIndex;e.minorCascadeIndex="AND"===d.logicalOperator?c:0;e.cascadeIndex=parseFloat(e.majorCascadeIndex+"."+e.minorCascadeIndex)}}},_getFieldInfo:function(a,b){b=b.fields;for(var d=0;d<b.length;d++){var c=b[d];if(a===c.name)return c}return null},_getAllInteractiveSinglePartArray:function(a){for(var b=[],d=0;d<a.parts.length;d++){var c=a.parts[d];if(c.parts)for(var e=0;e<
c.parts.length;e++){var f=c.parts[e];f.interactiveObj&&b.push(f)}else c.interactiveObj&&b.push(c)}return b},_catchSingleFilterParameterEnter:function(){this.emit("enter")},_onSingleFilterParameterChanged:function(){this.emit("change",this.getFilterExpr(!1))}})})},"jimu/dijit/_SingleFilterParameter":function(){define("dojo/on dojo/Evented dojo/Deferred dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/_SingleFilterParameter.html dojo/_base/lang ../utils".split(" "),
function(r,f,l,p,c,q,n,k,h,t){return p([c,q,n,f],{baseClass:"jimu-single-filter-parameter",templateString:k,valueProvider:null,nls:null,url:null,layerDefinition:null,fieldInfo:null,part:null,valueProviderFactory:null,postCreate:function(){this.inherited(arguments);this.valueProvider=this.valueProviderFactory.getValueProvider(this.part,!0);this.valueProvider.placeAt(this.valueProviderTd);this.own(r(this.valueProvider,"change",h.hitch(this,this._onValueProviderChanged)));this.own(r(this.valueProvider,
"enter",h.hitch(this,this._onValueProviderEnter)));this.valueProvider.bindChangeEvents()},getValueObject:function(){return this.valueProvider.getValueObject()},init:function(){return this.build(this.fieldInfo,this.part)},build:function(c,b){var e=null;this.fieldInfo=c;this.part=b;if(c=b.interactiveObj)this.promptNode.innerHTML=t.sanitizeHTML(c.prompt||""),this.hintNode.innerHTML=t.sanitizeHTML(c.hint||"");(c=this.valueProvider.setValueObject(this.part.valueObj))&&"function"===typeof c.then?e=c:(e=
new l,e.resolve(this.valueProvider));return e},disable:function(){this.valueProvider.disable()},enable:function(){this.valueProvider.enable()},isEnabled:function(){return this.valueProvider.isEnabled()},getStatus:function(){return this.valueProvider.getStatus()},_showValidationErrorTip:function(c){!c.validate()&&c.domNode&&c.focusNode&&(c.focusNode.focus(),c.focusNode.blur())},_onValueProviderEnter:function(){this.emit("enter")},_onValueProviderChanged:function(){this.emit("change")}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),
function(r,f,l,p,c,q,n,k,h){return q("dijit.layout._LayoutWidget",[f,l,p],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);n.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var f=this.getParent&&this.getParent();f&&f.isLayoutContainer||(this.resize(),this.own(c.on("resize",r.hitch(this,"resize"))))}},resize:function(c,e){var b=this.domNode;c&&k.setMarginBox(b,c);e=e||{};
r.mixin(e,c||{});"h"in e&&"w"in e||(e=r.mixin(k.getMarginBox(b),e));c=h.getComputedStyle(b);var f=k.getMarginExtents(b,c),a=k.getBorderExtents(b,c);e=this._borderBox={w:e.w-(f.w+a.w),h:e.h-(f.h+a.h)};f=k.getPadExtents(b,c);this._contentBox={l:h.toPixelValue(b,c.paddingLeft),t:h.toPixelValue(b,c.paddingTop),w:e.w-f.w,h:e.h-f.h};this.layout()},layout:function(){},_setupChild:function(c){n.add(c.domNode,this.baseClass+"-child "+(c.baseClass?this.baseClass+"-"+c.baseClass:""))},addChild:function(c,e){this.inherited(arguments);
this._started&&this._setupChild(c)},removeChild:function(c){n.remove(c.domNode,this.baseClass+"-child"+(c.baseClass?" "+this.baseClass+"-"+c.baseClass:""));this.inherited(arguments)}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],function(r,f,l){return r("dgrid.OnDemandGrid",[f,l],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),
function(r,f,l,p,c,q,n){function k(c,b){b&&b.nodeType&&c.appendChild(b)}function h(c,b,f,a){if(this.formatter){a=this.formatter;var e=this.grid.formatterScope;f.innerHTML="string"===typeof a&&e?e[a](b,c):this.formatter(b,c)}else null!=b&&f.appendChild(document.createTextNode(b))}var t=8>p("ie")&&!p("quirks");f=f("dgrid.Grid",q,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(c){return"object"!=typeof c?this.columns[c]:this.cell(c).column},listType:"grid",cell:function(c,
b){if(c.column&&c.element)return c;c.target&&c.target.nodeType&&(c=c.target);var e;if(c.nodeType){do{if(this._rowIdToObject[c.id])break;var a=c.columnId;if(a){b=a;e=c;break}c=c.parentNode}while(c&&c!=this.domNode)}if(!e&&"undefined"!=typeof b){var f=this.row(c);if(a=f&&f.element)for(var a=a.getElementsByTagName("td"),d=0;d<a.length;d++)if(a[d].columnId==b){e=a[d];break}}if(null!=c)return{row:f||this.row(c),column:b&&this.column(b),element:e}},createRowCells:function(e,b,f,a){var g=c("table.dgrid-row-table[role\x3dpresentation]"),
d=9>p("ie")||p("quirks")?c(g,"tbody"):g,h,k,l,m,q,r,y,w,A,G;f=f||this.subRows;k=0;for(l=f.length;k<l;k++)for(r=f[k],h=c(d,"tr"),r.className&&c(h,"."+r.className),m=0,q=r.length;m<q;m++){y=r[m];w=y.id;A=y.field?".field-"+n.escapeCssIdentifier(y.field,"-"):"";(G="function"===typeof y.className?y.className(a):y.className)&&(A+="."+G);A=c(e+(".dgrid-cell.dgrid-cell-padding"+(w?".dgrid-column-"+n.escapeCssIdentifier(w,"-"):"")+A.replace(/ +/g,"."))+"[role\x3d"+("th"===e?"columnheader":"gridcell")+"]");
A.columnId=w;t?(w=c(A,"!dgrid-cell-padding div.dgrid-cell-padding"),A.contents=w):w=A;if(G=y.colSpan)A.colSpan=G;if(G=y.rowSpan)A.rowSpan=G;b(w,y);h.appendChild(A)}return g},left:function(c,b){c.element||(c=this.cell(c));return this.cell(this._move(c,-(b||1),"dgrid-cell"))},right:function(c,b){c.element||(c=this.cell(c));return this.cell(this._move(c,b||1,"dgrid-cell"))},renderRow:function(e,b){var f=this.createRowCells("td",function(a,c){var d=e;c.get?d=c.get(e):"field"in c&&"_item"!=c.field&&(d=
d[c.field]);c.renderCell?k(a,c.renderCell(e,d,a,b)):h.call(c,e,d,a,b)},b&&b.subRows,e);return c("div[role\x3drow]\x3e",f)},renderHeader:function(){var e=this,b=this.headerNode,f=b.childNodes.length;for(b.setAttribute("role","row");f--;)c(b.childNodes[f],"!");f=this.createRowCells("th",function(a,b){var d=b.headerNode=a;t&&(a=a.parentNode);var c=b.field;c&&(a.field=c);b.renderHeaderCell?k(d,b.renderHeaderCell(d)):("label"in b||b.field)&&d.appendChild(document.createTextNode("label"in b?b.label:b.field));
!1!==b.sortable&&c&&"_item"!=c&&(a.sortable=!0,a.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[f.id=this.id+"-header"]=this.columns;b.appendChild(f);this._sortListener&&this._sortListener.remove();this._sortListener=l(f,"click,keydown",function(a){if("click"==a.type||32==a.keyCode||!p("opera")&&13==a.keyCode){var c=a.target,d,f,h;do if(c.sortable){h=[{attribute:d=c.field||c.columnId,descending:(f=e._sort[0])&&f.attribute==d&&!f.descending}];d={bubbles:!0,
cancelable:!0,grid:e,parentType:a.type,sort:h};l.emit(a.target,"dgrid-sort",d)&&(e._sortNode=c,e.set("sort",h));break}while((c=c.parentNode)&&c!=b)}})},resize:function(){var c=this.headerNode.firstChild,b=this.contentNode,f;this.inherited(arguments);if(!p("ie")||7<p("ie")&&!p("quirks"))b.style.width="",b&&c&&(f=c.offsetWidth)!=b.offsetWidth&&(b.style.width=f+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(c,
b){this.inherited(arguments);this.updateSortArrow(this._sort)},_findSortArrowParent:function(c){var b=this.columns,e;for(e in b){var a=b[e];if(a.field==c)return a.headerNode}},updateSortArrow:function(e,b){this._lastSortedArrow&&(c(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),c(this._lastSortedArrow,"!"),delete this._lastSortedArrow);b&&(this._sort=e);if(e[0]){b=e[0].attribute;e=e[0].descending;b=this._sortNode||this._findSortArrowParent(b);var f;delete this._sortNode;b&&(b=b.contents||
b,f=this._lastSortedArrow=c("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]"),f.innerHTML="\x26nbsp;",b.insertBefore(f,b.firstChild),c(b,e?".dgrid-sort-down":".dgrid-sort-up"),this.resize())}},styleColumn:function(c,b){return this.addCssRule("#"+n.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+n.escapeCssIdentifier(c,"-"),b)},_configColumns:function(c,b){var e=[],a=b instanceof Array;n.each(b,function(f,d){"string"==typeof f&&(b[d]=f={label:f});a||f.field||(f.field=d);d=f.id=f.id||(isNaN(d)?
d:c+d);this._configColumn&&(this._configColumn(f,d,b,c),d=f.id);a&&(this.columns[d]=f);f.grid=this;"function"===typeof f.init&&f.init();e.push(f)},this);return a?b:e},_destroyColumns:function(){var c=this.subRows,b=c&&c.length,f,a,g,d;this.cleanup();for(f=0;f<b;f++)for(a=0,d=c[f].length;a<d;a++)g=c[f][a],"function"===typeof g.destroy&&g.destroy()},configStructure:function(){var c=this.subRows,b=this._columns=this.columns;this.columns=!b||b instanceof Array?{}:b;if(c)for(b=0;b<c.length;b++)c[b]=this._configColumns(b+
"-",c[b]);else this.subRows=[this._configColumns("",b)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(c){this._destroyColumns();this.subRows=null;this.columns=c;this._updateColumns()},_setSubRows:function(c){this._destroyColumns();this.subRows=c;this._updateColumns()},setColumns:function(c){r.deprecated("setColumns(...)",'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",c)},setSubRows:function(c){r.deprecated("setSubRows(...)",'use set("subRows", ...) instead',
"dgrid 0.4");this.set("subRows",c)},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});f.appendIfNode=k;f.defaultRenderCell=h;return f})},"put-selector/put":function(){(function(r){var f,l=/[-+,> ]/;r([],f=function(p,c){function q(c){function b(){u&&d&&u!=d&&(d==c&&(e||(e=l.test(C)&&p.createDocumentFragment()))?
e:d).insertBefore(u,f||null)}for(var e,a,f,d,u,r=arguments,B=r[0],z=0;z<r.length;z++){var C=r[z];if("object"==typeof C){a=!1;if(C instanceof Array){u=p.createDocumentFragment();for(var D=0;D<C.length;D++)u.appendChild(q(C[D]));C=u}if(C.nodeType)u=C,b(),d=C,f=0;else for(D in C)u[D]=C[D]}else if(a)a=!1,u.appendChild(p.createTextNode(C));else{1>z&&(c=null);a=!0;if(B=C.replace(n,function(a,e,g,l,m,n){e&&(b(),"-"==e||"+"==e?(d=(f=u||d).parentNode,u=null,"+"==e&&(f=f.nextSibling)):("\x3c"==e?d=u=(u||d).parentNode:
(","==e?d=c:u&&(d=u),u=null),f=0),u&&(d=u));if((a=!g&&l)||!u&&(g||m))"$"==a?(a=r[++z],d.appendChild(p.createTextNode(a))):(a=a||q.defaultTag,(e=t&&r[z+1]&&r[z+1].name)&&(a="\x3c"+a+' name\x3d"'+e+'"\x3e'),u=h&&~(k=a.indexOf("|"))?p.createElementNS(h[a.slice(0,k)],a.slice(k+1)):p.createElement(a));if(g)if("$"==l&&(l=r[++z]),"#"==g)u.id=l;else if(e=(a=u.className)&&(" "+a+" ").replace(" "+l+" "," "),"."==g)u.className=a?(e+l).substring(1):l;else if("!"==C){var v;t?q("div",u,"\x3c").innerHTML="":(v=
u.parentNode)&&v.removeChild(u)}else e=e.substring(1,e.length-1),e!=a&&(u.className=e);m&&("$"==n&&(n=r[++z]),"style"==m?u.style.cssText=n:(g="!"==m.charAt(0)?(m=m.substring(1))&&"removeAttribute":"setAttribute",n=""===n?m:n,h&&~(k=m.indexOf("|"))?u[g+"NS"](h[m.slice(0,k)],m.slice(k+1),n):u[g](m,n)));return""}))throw new SyntaxError("Unexpected char "+B+" in "+C);b();d=B=u||d}}c&&e&&c.appendChild(e);return B}l=c||l;var n=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,
k,h=!1;p=p||document;var t="object"==typeof p.createElement;q.addNamespace=function(c,b){p.createElementNS?(h||(h={}))[c]=b:p.namespaces.add(c,b)};q.defaultTag="div";q.forDocument=f;return q})})(function(r,f,l){l=l||f;"function"===typeof define?define([],function(){return l()}):"undefined"==typeof window?require("./node-html")(module,l):put=l()})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),
function(r,f,l,p,c,q,n,k,h){function t(a,b){h(document.body,a,".dgrid-scrollbar-measure");b=a["offset"+b]-a["client"+b];a.className="";document.body.removeChild(a);return b}function e(a){var b=a?"."+a.replace(v,"."):"";this._class&&(b="!"+this._class.replace(v,"!")+b);h(this.domNode,b);this._class=a}function b(){return this._class}function m(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function a(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&
(this.bodyNode.scrollTop=a.y)}k("mozilla","opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var g,d;c.add("dom-scrollbar-width",function(a,b,d){return t(d,"Width")});c.add("dom-scrollbar-height",function(a,b,d){return t(d,"Height")});c.add("dom-rtl-scrollbar-left",function(a,b,d){a=h("div");h(document.body,d,".dgrid-scrollbar-measure[dir\x3drtl]");h(d,a);b=!!c("ie")||!!c("trident")||a.offsetLeft>=c("dom-scrollbar-width");d.className="";document.body.removeChild(d);h(a,"!");d.removeAttribute("dir");
return b});var u=0,v=/ +/g,B=7>c("ie")&&!c("quirks")?function(){var a,b,d;this._started&&(a=document.documentElement,b=a.clientWidth,a=a.clientHeight,d=this._prevWinDims||[],d[0]!==b||d[1]!==a)&&(this.resize(),this._prevWinDims=[b,a])}:function(){this._started&&this.resize()};return f("dgrid.List",c("touch")?n:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,
postscript:function(a,b){var d=this;(this._Row=function(a,b,d){this.id=a;this.data=b;this.element=d}).prototype.remove=function(){d.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,b){b=this.domNode=b||h("div");var d;a?(this.params=a,f.safeMixin(this,a),d=a["class"]||a.className||b.className,this._sort=a.sort||[],delete this.sort):this._sort=[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject=
{};this.postMixInProperties&&this.postMixInProperties();this.id=b.id=b.id||this.id||"dgrid_"+u++;null===this.useTouchScroll&&(this.useTouchScroll=!c("dom-scrollbar-width"));this.buildRendering();d&&e.call(this,d);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var a=this.domNode,b=this.addUiClasses,d=this,e,f,g,k;k=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();a.className=
"";h(a,"[role\x3dgrid].dgrid.dgrid-"+this.listType+(b?".ui-widget":""));e=this.headerNode=h(a,"div.dgrid-header.dgrid-header-row"+(b?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));(c("quirks")||8>c("ie"))&&h(a,"div.dgrid-spacer");f=this.bodyNode=h(a,"div.dgrid-scroller");c("ff")&&(f.tabIndex=-1);this.headerScrollNode=h(a,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(b?".ui-widget-header":""));g=this.footerNode=h("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));
h(a,g);k&&(a.className+=" dgrid-rtl"+(c("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));p(f,"scroll",function(b){d.showHeader&&(e.scrollLeft=b.scrollLeft||f.scrollLeft);b.stopPropagation();p.emit(a,"scroll",{scrollTarget:f})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=h(this.bodyNode,"div.dgrid-content"+(b?".ui-widget-content":""));this._listeners.push(this._resizeHandle=p(window,"resize",q.throttleDelayed(B,this)))},postCreate:c("touch")?function(){this.useTouchScroll&&
this.inherited(arguments)}:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this._sort))},configStructure:function(){},resize:function(){var a=this.bodyNode,b=this.headerNode,e=this.footerNode,f=b.offsetHeight,h=this.showFooter?e.offsetHeight:0,k=c("quirks")||7>c("ie");this.headerScrollNode.style.height=a.style.marginTop=f+"px";a.style.marginBottom=h+"px";k&&(a.style.height="",a.style.height=Math.max(this.domNode.offsetHeight-
f-h,0)+"px",h&&(e.style.bottom="1px",setTimeout(function(){e.style.bottom=""},0)));g||(g=c("dom-scrollbar-width"),d=c("dom-scrollbar-height"),c("ie")&&(g++,d++),q.addCssRule(".dgrid-scrollbar-width","width: "+g+"px"),q.addCssRule(".dgrid-scrollbar-height","height: "+d+"px"),17==g||k||(q.addCssRule(".dgrid-header-row","right: "+g+"px"),q.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+g+"px")));k&&(b.style.width=a.clientWidth+"px",setTimeout(function(){b.scrollLeft=a.scrollLeft},0))},addCssRule:function(a,
b){a=q.addCssRule(a,b);this.cleanAddedRules&&this._listeners.push(a);return a},on:function(a,b){a=p(this.domNode,a,b);c("dom-addeventlistener")||this._listeners.push(a);return a},cleanup:function(){var a=this.observers,b;for(b in this._rowIdToObject)if(this._rowIdToObject[b]!=this.columns){var d=document.getElementById(b);d&&this.removeRow(d,!0)}for(b=0;b<a.length;b++)(d=a[b])&&d.cancel();this.observers=[];this._numObservers=0;this.preload=null},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();
delete this._listeners}this._started=!1;this.cleanup();h(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},newRow:function(a,b,d,c,e){if(b){var f=this.insertRow(a,b,d,c,e);h(f,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":""));setTimeout(function(){h(f,"!dgrid-highlight!ui-state-highlight")},this.highlightDuration);return f}},adjustRowIndices:function(a){var b=
a.rowIndex;if(-1<b){do-1<a.rowIndex&&(this.maintainOddEven&&-1<(a.className+" ").indexOf("dgrid-row ")&&h(a,"."+(1==b%2?"dgrid-row-odd":"dgrid-row-even")+"!"+(0==b%2?"dgrid-row-odd":"dgrid-row-even")),a.rowIndex=b++);while((a=a.nextSibling)&&a.rowIndex!=b)}},renderArray:function(a,b,d){function c(){var b=arguments;if(-1<q)for(var c=0;c<b.length;c++){var f=b[c],g=n[f?0:n.length-1];if(g=g&&e(g)){var k=g[f?"previousSibling":"nextSibling"];k&&(k=h.row(k));k&&k.element!=g&&(f=f?"unshift":"push",a[f](k.data),
n[f](k.element),d.count++)}}}function e(a){return!l.isDescendant(a,h.domNode)&&document.getElementById(a.id)?h.row(a.id.slice(h.id.length+5)).element:a}function f(a){u=h.insertRow(a,r,null,k++,d);u.observerIndex=q;return u}function g(a){v=a.slice(0);(p=b?b.parentNode:h.contentNode)&&p.parentNode&&(p!==h.contentNode||a.length)?(p.insertBefore(r,b||null),(u=a[a.length-1])&&h.adjustRowIndices(u)):m[q]&&h.cleanEmptyObservers&&"undefined"!==typeof q&&(m[q].cancel(),m[q]=0,h._numObservers--);n=a;t&&(t.rows=
n)}d=d||{};var h=this,k=d.start||0,m=this.observers,n,p,q;b||(this._lastCollection=a);if(a.observe&&this.shouldObserveStore){h._numObservers++;var t=a.observe(function(f,g,k){var l,m,t;-1<g&&n[g]&&(l=n.splice(g,1)[0],l.parentNode==p&&((m=l.nextSibling)&&g!=k&&m.rowIndex--,h.removeRow(l)),d.count--,h._processScroll&&h._processScroll());if(-1<k){if(n.length)if(0===k)t=(t=n[k])&&e(t);else{if(t=n[k-1])t=e(t),t=(t.connected||t).nextSibling}else t=h._getFirstRowSibling&&h._getFirstRowSibling(p);l&&t&&l.id===
t.id&&(t=(t.connected||t).nextSibling);t&&!t.parentNode&&(t=document.getElementById(t.id));l=b&&b.parentNode||t&&t.parentNode||h.contentNode;if(l=h.newRow(f,l,t,d.start+k,d))if(l.observerIndex=q,n.splice(k,0,l),!m||k<g)m=(m=l.previousSibling)&&m.rowIndex+1!=l.rowIndex&&0!=l.rowIndex?m:l;d.count++}0===g?c(1,1):g===a.length-(-1===k?0:1)&&c(0,0);g!=k&&m&&h.adjustRowIndices(m);h._onNotification(n,f,g,k)},!0);q=m.push(t)-1}var r=document.createDocumentFragment(),u,v;if(a.map){if(n=a.map(f,console.error),
n.then)return a.then(function(b){a=b;return n.then(function(a){g(a);c(1,1,0,0);return v})})}else{n=[];for(var z=0,B=a.length;z<B;z++)n[z]=f(a[z])}g(n);c(1,1,0,0);return v},_onNotification:function(a,b,d,c){},renderHeader:function(){},_autoId:0,insertRow:function(a,b,d,c,e){var f=e.parentId,f=this.id+"-row-"+(f?f+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(a):this._autoId++),g=document.getElementById(f),h=g&&g.previousSibling;g&&(g===d&&(d=(d.connected||d).nextSibling),this.removeRow(g));
g=this.renderRow(a,e);g.className=(g.className||"")+" dgrid-row "+(1==c%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[g.id=f]=a;b.insertBefore(g,d||null);h&&this.adjustRowIndices(h);g.rowIndex=c;return g},renderRow:function(a,b){return h("div",""+a)},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||h(a,"!")},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var d=
a.id;if(b=this._rowIdToObject[d])return new this._Row(d.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!=this.domNode)}else return"object"==typeof a?b=this.store.getIdentity(a):(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,d,c){var e,f;f=e=a.element;b=b||1;do if(a=e[0>b?"previousSibling":"nextSibling"]){do if((e=a)&&-1<(e.className+" ").indexOf(d+" ")){f=e;b+=0>b?
1:-1;break}while(a=(!c||!e.hidden)&&e[0>b?"lastChild":"firstChild"])}else if(e=e.parentNode,!e||e===this.bodyNode||e===this.headerNode)break;while(b);return f},up:function(a,b,d){a.element||(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",d))},down:function(a,b,d){a.element||(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",d))},scrollTo:c("touch")?function(b){return this.useTouchScroll?this.inherited(arguments):a.call(this,b)}:a,getScrollPosition:c("touch")?function(){return this.useTouchScroll?
this.inherited(arguments):m.call(this)}:m,get:function(a){var b="_get"+a.charAt(0).toUpperCase()+a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,1)):this[a]},set:function(a,b){if("object"===typeof a)for(var d in a)this.set(d,a[d]);else d="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[d]?this[d].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:b,_setClass:e,_getClassName:b,_setClassName:e,_setSort:function(a,b){this._sort=
"string"!=typeof a?a:[{attribute:a,descending:b}];this.refresh();this._lastCollection&&(a.length&&("string"!=typeof a&&(b=a[0].descending,a=a[0].attribute),this._lastCollection.sort(function(d,c){d=d[a];c=c[a];void 0===d&&(d="");void 0===c&&(c="");return d==c?0:d>c==!b?1:-1})),this.renderArray(this._lastCollection))},sort:function(a,b){r.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",a,b)},_getSort:function(){return this._sort},_setShowHeader:function(a){var b=
this.headerNode;this.showHeader=a;h(b,(a?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();a&&(b.scrollLeft=this.getScrollPosition().x)},setShowHeader:function(a){r.deprecated("setShowHeader(...)",'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",a)},_setShowFooter:function(a){this.showFooter=a;h(this.footerNode,(a?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has","put-selector/put"],function(r,f){r.add("dom-contains",
function(c,f,e){return!!e.contains});var l=[],p,c,q,n=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,k={defaultDelay:15,throttle:function(c,f,e){var b=!1;e=e||k.defaultDelay;return function(){b||(b=!0,c.apply(f,arguments),setTimeout(function(){b=!1},e))}},throttleDelayed:function(c,f,e){var b=!1;e=e||k.defaultDelay;return function(){if(!b){b=!0;var h=arguments;setTimeout(function(){b=!1;c.apply(f,h)},e)}}},debounce:function(c,f,e){var b;e=e||k.defaultDelay;return function(){b&&(clearTimeout(b),b=null);var h=arguments;
b=setTimeout(function(){c.apply(f,h)},e)}},each:function(c,f,e){var b,h;if(c)if("number"===typeof c.length)for(b=0,h=c.length;b<h;b++)f.call(e,c[b],b,c);else for(b in c)f.call(e,c[b],b,c)},contains:function(c,f){return r("dom-contains")?c.contains(f):c.compareDocumentPosition(f)&8},addCssRule:function(h,k){p||(p=f(document.getElementsByTagName("head")[0],"style"),p=p.sheet||p.styleSheet,c=p.deleteRule?"deleteRule":"removeRule",q=p.cssRules?"cssRules":"rules");var e=l.length;l[e]=(p.cssRules||p.rules).length;
p.addRule?p.addRule(h,k):p.insertRule(h+"{"+k+"}",l[e]);return{get:function(b){return p[q][l[e]].style[b]},set:function(b,c){"undefined"!==typeof l[e]&&(p[q][l[e]].style[b]=c)},remove:function(){var b=l[e],f,a;if(void 0!==b)for(p[c](b),l[e]=void 0,f=e+1,a=l.length;f<a;f++)l[f]>b&&l[f]--}}},escapeCssIdentifier:function(c,f){return"string"===typeof c?c.replace(n,f||"\\$1"):c}};return k})},"xstyle/has-class":function(){define(["dojo/has"],function(r){var f={};return function(){for(var l,p=arguments,
c=0;c<p.length;c++)if(l=p[c],!f[l]){f[l]=!0;var q=l.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),n=r(q[2]),k=-q[4];(0<k?k<=n&&(-q[5]||k)>=n:!!n)==!q[1]&&(document.documentElement.className+=" has-"+l)}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),function(r,f,l,p,c,q,n,k,h){return l("dgrid.OnDemandList",[r,f],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,
bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:k.defaultDelay,keepScrollPosition:!1,rowHeight:22,postCreate:function(){this.inherited(arguments);var c=this;n(this.bodyNode,"scroll",k[this.pagingMethod](function(e){c._processScroll(e)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},renderQuery:function(f,e){function b(a){h(t,"!");if(a)throw k._refreshDeferred&&(k._refreshDeferred.reject(a),
delete k._refreshDeferred),a;}var k=this,a=e&&e.container||this.contentNode,g={query:f,count:0,options:e},d,l=this.preload,n,q={node:h(a,"div.dgrid-preload",{rowIndex:0}),count:0,query:f,next:g,options:e};q.node.style.height="0";g.node=d=h(a,"div.dgrid-preload");g.previous=q;d.rowIndex=this.minRowsPerPage;l?((g.next=l.next)&&d.offsetTop>=l.node.offsetTop?g.previous=l:(g.next=l,g.previous=l.previous),g.previous.next=g,g.next.previous=g):this.preload=g;var t=h(d,"-div.dgrid-loading");h(t,"div.dgrid-below").innerHTML=
this.loadingMessage;e=p.mixin(this.get("queryOptions"),e,{start:0,count:this.minRowsPerPage},"level"in f?{queryLevel:f.level}:null);this._trackError(function(){return n=f(e)});if("undefined"===typeof n)b();else return c.when(k.renderArray(n,d,e),function(a){return c.when("undefined"===typeof n.total?n.length:n.total,function(b){var c=a.length,f=d.parentNode,l=k.noDataNode;h(t,"!");"queryLevel"in e||(k._total=b);0===b&&f&&(l&&(h(l,"!"),delete k.noDataNode),k.noDataNode=l=h("div.dgrid-no-data"),f.insertBefore(l,
k._getFirstRowSibling(f)),l.innerHTML=k.noDataMessage);for(l=f=0;l<c;l++)f+=k._calcRowHeight(a[l]);c&&f&&(k.rowHeight=f/c);f=k.rowHeight*k.bufferRows;f>k.farOffRemoval&&(k.farOffRemoval=f);b-=c;g.count=b;d.rowIndex=c;b?d.style.height=Math.min(b*k.rowHeight,k.maxEmptySpace)+"px":(d.style.display="none",e.count++);k._previousScrollPosition&&(k.scrollTo(k._previousScrollPosition),delete k._previousScrollPosition);k._processScroll();k._refreshDeferred&&(k._refreshDeferred.resolve(n),delete k._refreshDeferred);
return a},b)},b),n},refresh:function(f){var e=this,b=f&&f.keepScrollPosition,h;"undefined"===typeof b&&(b=this.keepScrollPosition);b&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this.store)return b=this._refreshDeferred=new c,h=e.renderQuery(function(a){return e.store.query(e.query,a)}),"undefined"===typeof h&&b.reject(),b.then(function(a){e._refreshTimeout=setTimeout(function(){n.emit(e.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:e,results:a});
e._refreshTimeout=null},0);delete e._refreshDeferred;return a},function(a){delete e._refreshDeferred;throw a;})},resize:function(){this.inherited(arguments);this._processScroll()},_getFirstRowSibling:function(c){return c.lastChild},_calcRowHeight:function(c){var e=c.nextSibling;return e&&!/\bdgrid-preload\b/.test(e.className)?e.offsetTop-c.offsetTop:c.offsetHeight},lastScrollTop:0,_processScroll:function(f){function e(d,c,e,f){var g=a.farOffRemoval,k=d.node;if(c>2*g){for(var l,m=k[e],n=0,p=0,q=[];l=
m;){var t=a._calcRowHeight(l);if(n+t+g>c||0>m.className.indexOf("dgrid-row")&&0>m.className.indexOf("dgrid-loading"))break;m=l[e];n+=t;p+=l.count||1;a.removeRow(l,!0);q.push(l)}d.count+=p;f?(k.rowIndex-=p,b(d)):k.style.height=k.offsetHeight+n+"px";var r=h("div",q);setTimeout(function(){h(r,"!")},1)}}function b(b,d){b.node.style.height=Math.min(b.count*a.rowHeight,d?Infinity:a.maxEmptySpace)+"px"}function k(a,b){do a=b?a.next:a.previous;while(a&&!a.node.offsetWidth);return a}var a=this,g=a.bodyNode;
f=f&&f.scrollTop||this.getScrollPosition().y;var g=g.offsetHeight+f,d,l,n=a.preload,q=a.lastScrollTop,t=a.bufferRows*a.rowHeight,r=t-a.rowHeight,D,y,w,A=!0;for(a.lastScrollTop=f;n&&!n.node.offsetWidth;)n=n.previous;for(;n&&n!=d;){d=a.preload;a.preload=n;l=n.node;var G=l.offsetTop;if(g+1+r<G)n=k(n,A=!1);else if(f-1-r>G+l.offsetHeight)n=k(n,A=!0);else{var E=((l.rowIndex?f-t:g)-G)/a.rowHeight,G=(g-f+2*t)/a.rowHeight,G=G+Math.min(Math.abs(Math.max(Math.min((f-q)*a.rowHeight,a.maxRowsPerPage/2),a.maxRowsPerPage/
-2)),10);0==l.rowIndex&&(E-=G);E=Math.max(E,0);10>E&&0<E&&G+E<a.maxRowsPerPage&&(G+=Math.max(0,E),E=0);G=Math.min(Math.max(G,a.minRowsPerPage),a.maxRowsPerPage,n.count);if(0==G)n=k(n,A);else{var G=Math.ceil(G),E=Math.min(Math.floor(E),n.count-G),F=p.mixin(a.get("queryOptions"),n.options);n.count-=G;var H=l,L,N=a.queryRowsOverlap,M=(0<l.rowIndex||l.offsetTop>f)&&n;if(M){var J=n.previous;J&&(e(J,f-(J.node.offsetTop+J.node.offsetHeight),"nextSibling"),0<E&&J.node==l.previousSibling?(E=Math.min(n.count,
E),n.previous.count+=E,b(n.previous,!0),l.rowIndex+=E,N=0):G+=E,n.count-=E);F.start=l.rowIndex-N;F.count=Math.min(G+N,a.maxRowsPerPage);l.rowIndex=F.start+F.count}else n.next&&(e(n.next,n.next.node.offsetTop-g,"previousSibling",!0),H=l.nextSibling,H==n.next.node?(n.next.count+=n.count-E,n.next.node.rowIndex=E+G,b(n.next),n.count=E,N=0):L=!0),F.start=n.count,F.count=Math.min(G+N,a.maxRowsPerPage);L&&H&&H.offsetWidth&&(L=H.offsetTop);b(n);"level"in n.query&&(F.queryLevel=n.query.level);if("queryLevel"in
F||!(F.start>a._total||0>F.count)){l=h(H,"-div.dgrid-loading[style\x3dheight:"+G*a.rowHeight+"px]");h(l,"div.dgrid-"+(M?"below":"above")).innerHTML=a.loadingMessage;l.count=G;var K=n.query(F);if(void 0===a._trackError(function(){return K})){h(l,"!");return}(function(d,e,f,g){w=c.when(a.renderArray(g,d,F),function(k){y=g;H=d.nextSibling;h(d,"!");if(f&&H&&H.offsetWidth){var l=a.getScrollPosition();a.scrollTo({x:l.x,y:l.y+H.offsetTop-f,preserveMomentum:!0})}c.when(g.total||g.length,function(d){"queryLevel"in
F||(a._total=d);e&&(e.count=d-e.node.rowIndex,0===e.count&&F.count++,b(e))});a._processScroll();return k},function(a){h(d,"!");throw a;})}).call(this,l,M,L,K);n=n.previous}}}}w&&(D=this._refreshDeferred)&&(delete this._refreshDeferred,c.when(w,function(){D.resolve(y)}))},removeRow:function(c,e){if(c){var b=c.previousSibling,f=c.nextSibling,a;if(a=b)a=b.observerIndex,a=null!=a?a:b.previousObserverIndex;b=a;if(a=f)a=f.observerIndex,a=null!=a?a:f.nextObserverIndex;f=c.observerIndex;c.observerIndex=void 0;
e&&(c.nextObserverIndex=a,c.previousObserverIndex=b);if(this.cleanEmptyObservers&&-1<f&&f!==b&&f!==a&&(b=this.observers,a=b[f])){if(!e)for(var g=a.rows,d=0;d<g.length;d++)if(g[d]!=c&&q.isDescendant(g[d],this.domNode))return this.inherited(arguments);a.cancel();this._numObservers--;b[f]=0}}this.inherited(arguments)}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),function(r,f,l,p,c,
q,n){function k(c){return c}function h(f){if("object"!==typeof f)f=Error(f);else if("cancel"===f.dojoType)return;f.grid=this;c.emit(this.domNode,"dgrid-error",{grid:this,error:f,cancelable:!0,bubbles:!0})&&console.error(f)}return f("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};q.before(this,"configStructure",l.hitch(this,
function(){this._columnsWithSet={}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},destroy:function(){this.inherited(arguments);this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(c){c.set&&(this._columnsWithSet[c.field]=c);this.inherited(arguments)},_updateNotifyHandle:function(c){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);c&&"function"===typeof c.notify&&this.shouldObserveStore&&(this._notifyHandle=
q.after(c,"notify",l.hitch(this,"_onNotify"),!0),(c=this.get("sort"))&&c.length||console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},_setStore:function(c,e,b){this._updateNotifyHandle(c);this.store=c;this.dirty={};this.set("query",e,b)},_setQuery:function(c,e){var b=e&&e.sort;this.query=void 0!==c?c:this.query;this.queryOptions=e||this.queryOptions;this._started&&
(b?this.set("sort",b):this.refresh())},setStore:function(c,e,b){r.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",c,e,b)},setQuery:function(c,e){r.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",c,e)},_getQueryOptions:function(){var c=l.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)c.sort=this._sort;return c},_getQuery:function(){var c=this.query;return"object"==typeof c&&null!=
c?l.delegate(c,{}):c},_setSort:function(c,e){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(c,e){this.inherited(arguments);c&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var c=this.inherited(arguments);this.store||(this.noDataNode=n(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return c},renderArray:function(){var c=this,e=this.inherited(arguments);this.store||p.when(e,function(b){b.length&&
c.noDataNode&&n(c.noDataNode,"!")});return e},insertRow:function(c,e,b,f,a){var g=this.store,d=this.dirty,g=g&&g.getIdentity(c),h;g in d&&!(g in this._updating)&&(h=d[g]);h&&(c=l.delegate(c,h));return this.inherited(arguments)},updateDirty:function(c,e,b){var f=this.dirty,a=f[c];a||(a=f[c]={});a[e]=b},setDirty:function(c,e,b){r.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(c,e,b)},save:function(){function c(a,d){return function(c){var g=e._columnsWithSet,h=e._updating,
k,l;if("function"===typeof c.set)c.set(d);else for(k in d)c[k]=d[k];for(k in g)l=g[k].set(c),void 0!==l&&(c[k]=l);h[a]=!0;return p.when(b.put(c),function(){delete f[a];delete h[a]})}}var e=this,b=this.store,f=this.dirty,a=new p,g=a.promise,d=function(a){var d;return e.getBeforePut||!(d=e.row(a).data)?function(){return b.get(a)}:function(){return d}},h;for(h in f)var k=c(h,f[h]),g=g.then(d(h)).then(k);a.resolve();return g},revert:function(){this.dirty={};this.refresh()},_trackError:function(c){var e;
"string"==typeof c&&(c=l.hitch(this,c));try{e=c()}catch(b){h.call(this,b)}return p.when(e,k,l.hitch(this,h))},newRow:function(){var c=this.inherited(arguments);this.noDataNode&&(n(this.noDataNode,"!"),delete this.noDataNode);return c},removeRow:function(c,e){var b={element:c};!e&&this.noDataMessage&&this.up(b).element===c&&this.down(b).element===c&&(this.noDataNode=n(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},"dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),
function(r,f,l,p,c,q,n,k,h){function t(a,b){b=a.unselectable=b?"on":"";a=a.getElementsByTagName("*");for(var d=a.length;--d;)"INPUT"!==a[d].tagName&&"TEXTAREA"!==a[d].tagName&&(a[d].unselectable=b)}function e(a,b){var d=a.bodyNode,e=b?"text":21>c("ff")?"-moz-none":"none";m&&"msUserSelect"!==m?d.style[m]=e:c("dom-selectstart")?b||a._selectstartHandle?b&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):a._selectstartHandle=p(d,"selectstart",function(a){var b=a.target&&
a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==b&&a.preventDefault()}):(t(d,!b),b||a._unselectableHandle)?b&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle):a._unselectableHandle=q.after(a,"renderRow",function(a){t(a,!0);return a})}c.add("dom-comparedocumentposition",function(a,b,d){return!!d.compareDocumentPosition});c.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});c.add("css-user-select",function(a,b,d){a=d.style;
b=["Khtml","O","ms","Moz","Webkit"];d=b.length;var c="userSelect";do if("undefined"!==typeof a[c])return c;while(d--&&(c=b[d]+"UserSelect"));return!1});c.add("dom-selectstart","undefined"!==typeof document.onselectstart);var b=c("mac")?"metaKey":"ctrlKey",m=c("css-user-select"),a=(n=c("pointer"))&&"MS"===n.slice(0,2),g=n?n+(a?"Down":"down"):"mousedown",d=n?n+(a?"Up":"up"):"mouseup";"WebkitUserSelect"===m&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(m=!1);return f("dgrid.Selection",
null,{selectionDelegate:".dgrid-row",selectionEvents:g+","+d+",dgrid-cellfocusin",selectionTouchEvents:c("touch")?k.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);
this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){r.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");
this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?e(this,a):e(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,b){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(b))&&("dgrid-cellfocusin"!==a.type||"mousedown"!==a.parentType)&&(a.type!==d||b==this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32==a.keyCode)if(!a.shiftKey&&a.type===g&&this.isSelected(b))this._waitForMouseUp=
b;else this[this._selectionHandlerName](a,b);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,d){a=a.keyCode?a.ctrlKey:a[b];this._lastSelected===d?this.select(d,null,!a||!this.isSelected(d)):(this.clearSelection(),this.select(d),this._lastSelected=d)},_multipleSelectionHandler:function(a,d){var c=this._lastSelected,e=a.keyCode?a.ctrlKey:a[b],f;a.shiftKey||(f=e?null:!0,c=null);this.select(d,c,f);c||(this._lastSelected=d)},_extendedSelectionHandler:function(a,d){(2===a.button?this.isSelected(d):
a.keyCode?a.ctrlKey:a[b])||this.clearSelection(null,!0);this._multipleSelectionHandler(a,d)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var a=this,e=this.contentNode,f=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};c("touch")&&!c("pointer")&&this.selectionTouchEvents?(p(e,k.selector(f,this.selectionTouchEvents),function(b){a._handleSelect(b,this);a._ignoreMouseSelect=this}),p(e,p.selector(f,this.selectionEvents),function(b){a._ignoreMouseSelect!==
this?a._handleSelect(b,this):b.type===d&&(a._ignoreMouseSelect=null)})):p(e,p.selector(f,this.selectionEvents),function(b){a._handleSelect(b,this)});this.addKeyHandler&&this.addKeyHandler(32,function(b){a._handleSelect(b,b.target)});if(this.allowSelectAll)this.on("keydown",function(d){d[b]&&65==d.keyCode&&!/\bdgrid-input\b/.test(d.target.className)&&(d.preventDefault(),a[a.allSelected?"clearSelection":"selectAll"]())});this._setStore&&q.after(this,"_setStore",function(){a._updateDeselectionAspect()});
this._updateDeselectionAspect()},_updateDeselectionAspect:function(){function a(a,d,c){a=d||a&&a[b.idProperty||"id"];if(null!=a&&(d=(a=b.row(a))&&b.selection[a.id]))b[c](a,null,d)}var b=this,d=this.store,c,e;this._removeDeselectSignals&&this._removeDeselectSignals();d&&d.notify?(c=q.before(d,"notify",function(b,d){b||a(b,d,"deselect")}),e=q.after(d,"notify",function(b,d){a(b,d,"select")},!0),this._removeDeselectSignals=function(){c.remove();e.remove()}):(c=q.before(this,"removeRow",function(a,b){b||
(a=this.row(a))&&a.id in this.selection&&this.deselect(a)}),this._removeDeselectSignals=function(){c.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],d=this._selectionTriggerEvent,c;c={bubbles:!0,grid:this};d&&(c.parentType=d.type);c[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];p.emit(this.contentNode,"dgrid-"+a,c)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},
_select:function(a,b,d){var c,e,f;"undefined"===typeof d&&(d=!0);a.element||(a=this.row(a));if(!1===d||this.allowSelect(a))if(c=this.selection,e=!!c[a.id],null===d&&(d=!e),f=a.element,d||this.allSelected?c[a.id]=d:delete this.selection[a.id],f&&(d?h(f,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):h(f,"!dgrid-selected!ui-state-active")),d!==e&&f&&this._selectionEventQueues[(d?"":"de")+"select"].push(a),b)if(b.element||(b=this.row(b)),b){if(b=b.element)for(c=this._determineSelectionDirection(f,
b),c||(b=document.getElementById(b.id),c=this._determineSelectionDirection(f,b));a.element!=b&&(a=this[c](a));)this._select(a,null,d)}else this._lastSelected=f,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},_determineSelectionDirection:c("dom-comparedocumentposition")?function(a,
b){a=b.compareDocumentPosition(a);return a&1?!1:2===a?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,d){this._select(a,b,d);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var d in this.selection)a!==d&&this._select(d,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=
this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var a=this,b=this.inherited(arguments);l.when(b,function(b){var d=a.selection,
c,e,f;for(c=0;c<b.length;c++)e=a.row(b[c]),(f=e.id in d?d[e.id]:a.allSelected)&&a._select(e,null,f);a._fireSelectionEvents()});return b}})})},"xstyle/main":function(){define("xstyle/main",["require","xstyle/core/parser","xstyle/core/base","xstyle/core/elemental","xstyle/core/generate"],function(r,f,l,p,c){function q(c){c=document.getElementsByTagName(c);for(var e=0;e<c.length;e++)k(c[e])}function n(){q("link");q("style")}function k(c,e,b){function f(){r(["xstyle/core/load-imports"],function(a){a(c,
function(){k(c,e,!0)})})}function a(a){for(var b=a.cssRules,c=0;c<b.length;c++){var f=b[c];if(f.selectorText&&"x-"==f.selectorText.substring(0,2)&&(d=!0,/^'/.test(f.style.content)))return h(eval(f.style.content),a,e),!0}}var g=c.sheet||c.styleSheet;if(g&&(!g.processed||b)){g.processed=!0;var d=g.needsParsing,l=g.rules||g.cssRules;if((g.href||g.imports&&g.imports.length)&&!b)return f();if(!d)for(var n=0;n<l.length;n++){var p=l[n];if(p.href&&!b){if(!a(p.styleSheet))return f();return}}h(g.localSource||
(g.ownerNode||g.owningElement).innerHTML,g,e)}}function h(c,e,b){e.addRule||(e.addRule=function(a,b,d){return this.insertRule(a+"{"+b+"}",0<=d?d:this.cssRules.length)});e.deleteRule||(e.deleteRule=e.removeRule);var h=1;(e.href||location.href).replace(/[^\/]+$/,"");l.css=c;f(l,c,e);0==--h&&b&&b(e);return l}p.ready(n);f.getStyleSheet=function(c,e){return c.styleSheet||c};return{process:k,processAll:n,parse:h,generate:c,update:p.update,load:function(c,e,b,f){e(["xstyle/css"],function(a){a.load(c,e,function(a){a?
k({sheet:a},b):(n(),b())},f)})}}})},"xstyle/core/parser":function(){define("xstyle/core/parser",[],function(){function r(){this.push.apply(this,arguments)}function f(b){this.value=b}function l(){var b,c=this.args[0];if("string"==typeof c)b=c.split(/\s*,\s*/);else if(c){b=[];for(var a=0,e=0;e<c.length+1;e++){var d=c[e];if("string"==typeof d||void 0===d)if(d=d&&d.split(/\s*,\s*/),1<b.length||void 0===d){var f=c.slice(a,e);0<a&&f.unshift(b.pop());a=e+1;b.push(f);d&&b.push.apply(b,d.slice(1))}}}else return[];
return b}function p(b,e,a){function g(a,e){function u(a){z=!1;var b=m.lastIndex;a.then(function(){z=!0;d&&(m.lastIndex=b,B())});var d=!0}function B(){function b(a){a&&"string"==typeof a&&C&&(a=C+a);I?I.push?"string"==typeof I[I.length-1]&&"string"==typeof a?I[I.length-1]+=a:a&&I.push(a):"string"==typeof I&&"string"==typeof a?I+=a:I=new r(I,a):I=a}for(z=!0;z;){var n=m.exec(a);if(!n)break;var B=n[5],C=n[1],D=n[2],A=n[3],Q=n[4],P,R,I,V,Q=Q&&t(Q),D=D&&t(D);H?(A?(R=D,P=A.charAt(0),V="?"==A.charAt(1),-1<
A.indexOf("\n")&&(Q=A.slice(1))):Q=D,I=Q,H=!1):(Q=A?D+A:D,b(Q));"{"!=B&&(F+=n[0]);switch(B){case "'":case '"':var X="'"==B?c:q;X.lastIndex=m.lastIndex;(B=X.exec(a))||y("unterminated string");D=B[1].replace(/\\([a-fA-F\d]{0,5}[ a-fA-F\d]?)/g,function(a,b){if(b)return String.fromCharCode(parseInt(b,16))});m.lastIndex=X.lastIndex;b(new f(D));F+=B[0];continue;case "\\":B=X.lastIndex++;b(a.charAt(B));continue;case "(":case "{":case "[":if("{"==B){H=!0;":"==P&&A&&(D+=A);D&&C&&(D=C+D);F=t((F+D).replace(/\s+/g,
" "));b(A=w.newRule(F));"\x3d"==P&&(E=!1,I.creating=!0);var T=null,Y=G;n[6]&&(Q=e.cssRules||e.rules,A.cssRule=T=Q[n[6].slice(1)])&&(F=T.selectorText);if(w.root&&E)for(Q=e.cssRules||e.rules;T=Q[G++];)if(T.selectorText==F||T.selectorText&&T.selectorText.replace(/::/g,":").replace(/'/g,'"')==F.replace(/::/g,":").replace(/'/g,'"')){A.cssRule=T;break}T||(A.ruleIndex=G=Y);A.styleSheet=e;I.creating?(A.selector="."+("\x3d"==P?D.match(/[\w-]*$/g,"")[0]:"")+"-x-"+h++,A.creating=!0):/^@(?!font-face)(?!FONT-FACE)/.test(F)?
A.setMediaSelector(F):A.selector=w.root?F:w.selector+" "+F;F=""}else D=Q.match(/(.*?)([\w-]*)$/),b(A=w.newCall(D[2],I,w)),A.ref=w.getDefinition(D[2]),A.getArgs=l,(I.calls||(I.calls=[])).push(A);w.currentName=R;w.currentSequence=I;w.assignmentOperator=P;var Z;"{"==B&&(Z=A.selector.match(/[@:]\w+/))&&(Z=Z[0],(R=w.getDefinition(Z))&&R.selector&&R.selector(A));v.push(w=A);w.operator=B;w.start=m.lastIndex;I=R=null;continue}if(I)if(D="string"==typeof I?I:I[0],D.charAt&&"@"==D.charAt(0))if(n=D.match(/\w+/)[0],
"import"==n)D=p.getStyleSheet((e.cssRules||e.imports)[G++],I,e),n=m.lastIndex,g(D.localSource,D),m.lastIndex=n;else{if("xstyle"==n){if("start"==D.slice(8,13))A=w?w.newRule(""):ba,A.root=w.root,v.push(w=A);else{var ba=w||ba;v.pop();w=v[v.length-1]}m=w?d:/(@[\w\s])/g}}else if("\x3d"===P)try{var W=w.declareDefinition(R,I,V);W&&W.then&&u(W)}catch(S){y(S)}switch(B){case ":":"\x3d"==P?(H=!0,P=":"):b(":");break;case "}":if(R&&!w.root&&!w.isMediaBlock)try{w[":"==P?"setValue":"declareDefinition"](R,I,V)}catch(S){y(S)}case ")":case "]":k[w.operator]!=
B&&y("Incorrect opening operator "+w.operator+" with closing operator "+B);R=null;R=a.slice(w.start,m.lastIndex-1);w.cssText=w.cssText?w.cssText+";"+R:R;if("}"==B){"}"==aa&&(aa=w.parent.selector)&&"@"==!aa.charAt(0)&&y("A nested rule must end with a semicolon");if(w.root)y("Unmatched "+B);else{try{w.onRule(w.selector,w)}catch(S){y(S)}E=!0}F=""}if(")"==B||"]"==B)w.args=[I];if(")"==B&&!P){try{W=v[v.length-2].onArguments&&v[v.length-2].onArguments(w)}catch(S){y(S)}W&&W.then&&u(W)}v.pop();w=v[v.length-
1];I=w.currentSequence;R=w.currentName;P=w.assignmentOperator;if(w.root&&"}"==B){if(P)try{w[":"==P?"setValue":"declareDefinition"](R,I,V)}catch(S){y(S)}H=!0;P=!1}break;case "":case void 0:return;case ";":if(w&&R){try{(W=w[":"==P?"setValue":"declareDefinition"](R,I,V))&&W.then&&u(W)}catch(S){y(S)}R}I=null;H=!0;P=E=!1;F=""}var aa=B}}function y(b){var d=a.slice(0,m.lastIndex).split("\n"),c=d[d.length-1],d=(e.href||"in-page stylesheet")+":"+d.length+":"+c.length+" near:\n"+c.slice(-40);if(g.onerror)g.onerror(b,
d);console.error(b.message||b,d);b.stack&&console.error(b.stack)}a=a.replace(n,function(a){return a.replace(/[^\n]/g,"")});var w=b;m.lastIndex=0;var z,G=0,E=!0,F="",H=!0;B()}a=a||{addRule:function(){},cssRules:[]};var d,m=d=/(\s*)((?:[^{\}\[\]\(\)\\'":=;]|\[(?:[^\]'"]|'(?:\\.|[^'])*'|"(?:\\.|[^"])*")\])*)([=:]\??\s*([^{\}\[\]\(\)\\'":;]*))?(?:([{\}\[\]\(\)\\'":;])(\/\d+)?|$)/g,v=[b];b.parse=g;g(e,a)}var c=/((?:\\.|[^'])*)'/g,q=/((?:\\.|[^"])*)"/g,n=/\/\*[\w\W]*?\*\//g,k={"{":"}","[":"]","(":")"},
h=0,t="".trim?function(b){return b.trim()}:function(b){return b.replace(/^\s+|\s+$/g,"")},e=r.prototype=[];e.toString=function(){return this.join("")};e.isSequence=!0;f.prototype.toString=function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};f.prototype.isLiteralString=!0;return p})},"xstyle/core/base":function(){define("xstyle/core/base","xstyle/core/elemental xstyle/core/expression xstyle/core/Definition xstyle/core/utils put-selector/put xstyle/core/Rule xstyle/core/es6".split(" "),
function(r,f,l,p,c,q,n){function k(a,d,c){function e(d){return{selectElement:function(b){c.newElement&&(b=b.parentNode);if(d&&d.selector)for(;!u(b,d);)if(b=b.parentNode,!b)throw Error("Rule not found");if(c.inherit)for(;!(a in b);)if(b=b.parentNode,!b)throw Error(a?a+" not found":"Property was never defined");return b},forElement:function(e){var f=e;e=this.selectElement(e);c.newElement&&(e["_"+a+"Node"]=f);e=c.get?c.get(e,a):e[a];return void 0===e&&d?b(a).valueOf().forRule(d):e},forRule:c.inherit&&
function(a){return e(a)}}}var f=new l(function(){return e(d)});f.define=function(b,d){return k(a||d,b,c)};f.keepCSSValue=!0;f.put=c.inherit?function(d,c){return b(a).put(d,c,a)}:function(b){return{forElement:function(e){if(d&&d.selector)for(;!u(e,d);)if(e=e.parentNode,!e)throw Error("Rule not found");c.set?c.set(e,a,b):e[a]=b;f.invalidate({elements:[e]})}}};return f}function h(a,b,d,c){return p.when(f.evaluate(a,d),function(b){b.forElement?r.addRenderer(a,function(a){c(b.forElement(a),a)}):c(b)})}
function t(a,b){return{apply:function(d,c,e){h(d,e,c[0],function(c,f){c.observe(function(c){c=c?a:b;value.toString().replace(new RegExp(a+"\\([^)]+\\)","g"),c);f?f.style[e]=c:d.setStyle(e,c)})})}}}function e(a,b){var d=a.variables;if(d&&b in d)return d[b];if(a=a.bases)for(d=0;d<a.length;d++){var c=e(a[d],b);if(void 0!==c)return c}}function b(a){var b=v[a];b||(b=v[a]=new l(function(){return{forRule:function(b){a:{do{var d=e(b,a);if(void 0!==d){b=d;break a}b=b.parent}while(b);b=void 0}return b}}}),
b.put=function(a,d,c){return{forRule:function(d){function e(a){f.push(a);for(var b in a.rules)e(a.rules[b])}(d.variables||(d.variables={}))[c]=a;for(var f=[];d;)e(d),d=d.parent;b.invalidate({rules:f})}}});return b}var m=c("div"),a=navigator.userAgent,g=-1<a.indexOf("WebKit")?"-webkit-":-1<a.indexOf("Firefox")?"-moz-":-1<a.indexOf("MSIE")?"-ms-":-1<a.indexOf("Opera")?"-o-":"",d;q=new q;var u=r.matchesRule;q.root=!0;var v={};q.definitions={Math:Math,window:window,global:window,module:f.selfResolving(function(a,
b){a[0].value&&(a=a[0].value);b||require([a]);return{then:function(b){return(new n.Promise(function(b){require([a],function(a){b(a)})})).then(b)}}}),item:k("item",null,{inherit:!0}),pageContent:new l,content:k("content",null,{inherit:!0,newElement:function(){return this.element}}),elementProperty:k(null,null,{}),elementClass:k(null,null,{get:function(a,b){return-1<(" "+a.className+" ").indexOf(" "+b+" ")},set:function(a,b,d){this.get(a,b)!=d&&(a.className=d?a.className+(" "+b):(" "+a.className+" ").replace(" "+
b+" ","").replace(/^ +| +$/g,""))}}),element:{forElement:function(a){return a},define:function(a){return{forElement:function(b){for(;!u(b,a);)if(b=b.parentNode,!b)throw Error("Rule not found");return b}}}},event:{observe:function(a){a(d)},valueOf:function(){return d}},each:{put:function(a){return{forRule:function(b){b.each=a}}}},prefix:{put:function(a,b,d){return{forRule:function(b){if("string"==typeof m.style[g+d])return b._setStyleFromValue(g+d,a),!0}}}},"var":{define:function(a,d){return b(d)},
selfResolving:!0,apply:function(a,d){return b(p.convertCssNameToJs(d[0]))}},inline:t("inline","none"),block:t("block","none"),visible:t("visible","hidden"),"extends":{apply:function(a,b){for(;0<b.length;)return p.extend(a,b[0],console.error)}},set:{selfExecuting:!0,apply:function(a,b){return b[0].put(b[1].valueOf())}},get:{apply:function(a,b){return b[0]},put:function(a,b){f.evaluate(b,a)}},toggle:{selfExecuting:!0,apply:function(a,b){return b[0].put(!b[0].valueOf())}},on:{put:function(a,b,c){return{forRule:function(b){r.on(document,
c.charAt(2).toLowerCase()+c.slice(3),b,function(e){d=e;try{p.when(f.evaluate(b,a).valueOf(),function(a){a&&a.forRule&&(a=a.forRule(b));a&&a.forElement&&(a=a.forElement(e.target));d=null},function(b){console.error("Error in "+c+" event handler, executing "+a,b)})}catch(w){console.error("Error in "+c+" event handler, executing "+a,w)}})}}}},title:{put:function(a){return{forRule:function(b){f.observe(f.evaluate(b,a),function(a){document.title=a})}}}},"@supports":{selector:function(a){function b(a){var d;
if(d=a.match(/^\s*not(.*)/))return!b(d[1]);if(d=a.match(/\((.*)\)/))return b(d[1]);if(d=a.match(/([^:]*):(.*)/))return a=p.convertCssNameToJs(d[1]),d=m.style[a]=d[2],m.style[a]==d;if(d=a.match(/\w+\[(.*)=(.*)\]/))return c(d[0])[d[1]]==d[2];if(d=a.match(/\w+/))return p.isTagSupported(d);throw Error("can't parse @supports string");}b(a.selector.slice(10))?a.selector="":a.disabled=!0}},"true":!0,"false":!1,"null":null};q.elementProperty=k;return q})},"xstyle/core/elemental":function(){define("xstyle/core/elemental",
["put-selector/put","xstyle/core/utils"],function(r,f){function l(a,d,c,e){function f(a){if(!c)return e(a);var b=a.target;do if(D(b,c))return e(a);while((b=b.parentNode)&&1===b.nodeType)}b?a.addEventListener(d,f,!!m[d]):p(a,m[d]||d,f)}function p(a,b,d){b="on"+b;var c=a[b];a[b]=function(a){a=a||window.event;a.target=a.target||a.srcElement;c&&c(a);d(a)}}function c(a){/e/.test(t.readyState||"")?a():t.addEventListener("DOMContentLoaded",a)}function q(a){for(var b=t.querySelectorAll(a.selector),d=a.name,
c=0,e=b.length;c<e;c++){var f=b[c],g=f.elementalStyle;g||(g=f.elementalStyle={},f.elementalSpecificities={});var h=f.renderings;h||(h=f.renderings=[],B.push(f));h.push({name:d,rendered:g[d]==a.propertyValue,renderer:a});g[d]=a.propertyValue}}function n(){for(;B.length;){for(var a=B.shift(),b=a.renderings,d=a.elementalStyle;b.length;){var c=b.shift(),e=c.renderer,f=e.rendered;C=d[c.name]==e.propertyValue;if(!f&&C)try{e.render(a)}catch(H){console.error(H,H.stack),r(a,"div.error",H.toString())}f&&!C&&
e.unrender&&e.unrender(a)}a.renderings=void 0}}function k(a,b){for(var d=0,c=u.length;d<c;d++){var e=u[d];b&&b!=e.selector||!D(a,e.rule)||e.render(a)}}function h(a,b){var d={selector:a.selector,rule:a,render:b};u.push(d);z&&q(d);n();return{remove:function(){u.splice(u.indexOf(d),1)}}}var t=document,e=1,b=!!t.addEventListener,m={blur:"focusout",focus:"focusin"};l(t,"change",null,function(a){a=a.target;for(var b=0,d=v.length;b<d;b++){var c=v[b];if(-1<(" "+a.className+" ").indexOf(c.rule.selector.slice(1))){var e=
c.definition.valueOf();e&&e.forRule&&(e=e.forRule(c.rule));e&&e.forElement&&(e=e.forElement(a));var f="checkbox"===a.type?a.checked:a.value;"number"===typeof e&&isFinite(f)&&(f=+f);(e=c.definition.put(f))&&e.forRule&&(e=e.forRule(c.rule));e&&e.forElement&&e.forElement(a)}}});navigator.userAgent.match(/MSIE|Trident/)&&l(t,"keydown",null,function(a){if(13==a.keyCode){var b=a.target;if(document.createEvent)a=document.createEvent("Events"),a.initEvent("change",!0,!0),b.dispatchEvent(a);else document.onchange({target:b})}});
var a=t.createElement("div"),g={"dom-qsa2.1":!!a.querySelectorAll},d=a.matches||a.matchesSelector||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector,u=[],v=[],B=[],z;c(function(){if(!z)if(z=!0,g["dom-qsa2.1"]){for(var a=0,b=u.length;a<b;a++)q(u[a]);n()}else for(var d=t.all,a=0,b=d.length;a<b;a++)k(d[a])});var C,D=d?function(a,b){return d.call(a,b.selector)}:function(a,b){b.ieId||b.setStyle(b.ieId="x-ie-"+e++,"true");return!!a.currentStyle[b.ieId]};return{ready:c,
on:l,matchesRule:D,addRenderer:h,addInputConnector:function(a,b){v.push({rule:a,definition:b})},update:k,clearRenderers:function(){u=[]},observeForElement:function(a,b,d){return f.when(a,function(a){function c(a){a.observe?a.observe(d):d(a)}a.forElement?h(b,function(b){c(a.forElement(b))}):c(a)})}}})},"xstyle/core/utils":function(){define("xstyle/core/utils",[],function(){function r(c,f){for(var l=0,k=c.length;l<k;l++){var h=c[l];if(h&&"object"==typeof h&&f in h)return!0}}function f(c,f){return f.toUpperCase()}
var l="div"==document.createElement("div").tagName,p={};return{when:function(c,f,l){return c&&c.then?c.then(f,l)||c:f(c)},whenAll:function(c,f){return r(c,"then")?{then:function(l,k){function h(){n--;n||l(f(e))}for(var n=1,e=[],b=0;b<c.length;b++){var m=c[b];n++;m&&m.then?function(a){m.then(function(b){e[a]=b;h()},k)}(b):(e[b]=m,h())}h()},inputs:c}:f(c)},convertCssNameToJs:function(c){return c.replace(/-(\w)/g,f)},isTagSupported:function(c){if(c in p)return p[c];var f=document.createElement(c);l?
(f=f.toString(),f=!("[object HTMLUnknownElement]"==f||"[object]"==f)):f=f.tagName==c.toUpperCase();return p[c]=f},extend:function(c,f){var l=f.split(".");f=l[0];var k=c.getDefinition(f,"rules");l[0]="";c.selector+=c.extraSelector=l.join(".");if(k)return this.when(k,function(f){if(f.extend)f.extend(c,!0);else for(var h in f)c[h]=f[h]});c.tagName=f;if(!this.isTagSupported(f))throw Error("Extending undefined definition "+f);},someHasProperty:r}})},"xstyle/core/expression":function(){define("xstyle/core/expression",
["xstyle/core/utils","xstyle/core/Definition"],function(r,f){function l(a,b){var d=b[0];return d&&a?(d=h(d),l(a.property?a.property(d):a[d],b.slice(1))):a}function p(a,b,d){if(t(b,a)){var c={};c[a]=function(c){for(var e=[],f=0,g=b.length;f<g;f++){var h=b[f];h&&"function"==typeof h[a]&&(h=h[a](c));e[f]=h}return d(e)};return c}return d(b)}function c(a,b){return{apply:function(d,c,e){for(var f=0,g=c.length;f<g;f++){var h=c[f];h.dependencyOf&&h.dependencyOf(e)}f=function(){var b=[];if(a.selfExecuting)return a.apply(d,
c,e);for(var f=0,g=c.length;f<g;f++)b[f]=c[f].valueOf();if(a.selfWaiting)return a.apply(d,b,e);b.push(d);return r.whenAll(b,function(b){var d=b.pop();return p("forRule",b,function(b){return p("forElement",b,function(b){return a.apply(d,b,e)})})})};f.reverse=function(a){return b(a,c)};return f}}}function q(a){return b[a]||(b[a]=new Function("a","b","return "+a))}function n(a,b,d,f,h){function g(a){a.skipResolve=!0;a.precedence=b;a.infix=!1!==h}var k=function(a,b){var d=b[0];b=b[1];if(d&&d.put)a=f(a,
b&&b.valueOf()),a!==e&&d.put(a);else if(b&&b.put)b.put(h(a,d&&d.valueOf()));else throw new TypeError("Can not put");},l={apply:function(b,e,l){var n;d=q(d);f=f&&q(f);h=h&&q(h);m[a]=n=c(d,k);g(n);return n.apply(b,e,l)}};g(l);m[a]=l}function k(a,b){function d(a){for(;n<=a.precedence;){var b=p.pop(),d=m[p.pop()],c=new f;c.setCompute(d.apply(null,d.infix?[p.pop(),b]:[b],c));q=p.length?p[p.length-1]:void 0;p.push(c);n=q&&m[q]&&m[q].precedence}}var e,g;b=b.join?b.slice():[b];for(e=0;e<b.length;e++)if(g=
b[e],"string"==typeof g){var h=g.match(/"[^\"]*"|[+\-<>\|\/\?\:^*!&|]+|[\w_$\.\/-]+/g);g=[e,1];h&&g.push.apply(g,h);b.splice.apply(b,g);e+=g.length-3}var n,p=[],q,h={};for(e=0;e<b.length;e++){g=b[e];if("("==g.operator){var t=p[p.length-1];void 0===t||m.hasOwnProperty(t)?g=k(a,g.getArgs()[0]):(p.pop(),g=function(b,d){function e(e){return r.when(b.valueOf(),function(f){var m=b.parent&&b.parent.valueOf();if(!f.selfResolving){if(!g){g=[];for(var n=0,p=d.length;n<p;n++)g[n]=k(a,d[n]);h=f.selfReacting?
f.apply(m,g,l):c(f).apply(m,g,l)}return h()}f=f.apply(m,d,l);return e?f:f.valueOf()})}var g,h,l=new f(e);l.setReverseCompute(function(){var a=arguments;return r.when(e(!0),function(b){return b.put.apply(b,a)})});return l}(t,g.getArgs()))}else if(m.hasOwnProperty(g))t=m[g],d(t),n=(q||t).precedence;else if(-1<g)g=+g;else if(g.isLiteralString)g=g.value;else{g=g.split(/\s*\/\s*/);var t=g[0],w=a.getDefinition(t);if("string"==typeof w||w instanceof Array)w=k(a,w);else if(void 0===w)throw Error('Could not find reference "'+
t+'"');h[t]=w;1<g.length&&(w=l(w,g.slice(1)));g=w}p.push(g)}d({precedence:100});if(1<p.length)throw Error("Could not reduce expression");g=p[0];g.inputs=h;return g}var h=r.convertCssNameToJs,t=r.someHasProperty,e={},b={},m={};n("+",6,"a+b","a-b","a-b");n("-",6,"a-b","a+b","b-a");n("*",5,"a*b","a/b","a/b");n("/",5,"a/b","a*b","b/a");n("?",16,"b[a?0:1]","a\x3d\x3d\x3db[0]||(a\x3d\x3d\x3db[1]?false:deny)","[a,b]");n(":",15,"[a,b]","a[0]?a[1]:deny","a[1]");n("!",4,"!a","!a",!1);n("%",5,"a%b");n("\x3e",
8,"a\x3eb");n("\x3e\x3d",8,"a\x3e\x3db");n("\x3c",8,"a\x3cb");n("\x3c\x3d",8,"a\x3c\x3db");n("\x3d\x3d",9,"a\x3d\x3d\x3db");n("\x26",8,"a\x26\x26b");n("|",8,"a||b");return{react:c,evaluate:k,selfResolving:function(a){a.selfResolving=!0;return a}}})},"xstyle/core/Definition":function(){define(["xstyle/core/utils","xstyle/core/es6"],function(r,f){function l(c){(this.computeValue=c)&&c.reverse&&this.setReverseCompute(c.reverse)}function p(k,h,l){if(h&&h.forElement)return{forElement:function(e){e=h.selectElement?
h.selectElement(e):e;var b=["_cache_"+k.id];if(b in e){var m=e[b+"observe"];m.addKey&&m.addKey(l);return e[b][l]}var a=e[b]=h.forElement(e),g=e[b+"observe"]=c(k,a,l,{elements:[e]});e.xcleanup=function(b){b&&f.unobserve(a,g)};return a[l]}}}function c(c,h,l,e){var b=c._properties,k;"object"==typeof h&&(k=function(a){for(var c=0;c<a.length;c++){var d=b[a[c].name];d&&d.invalidate&&d.invalidate(e)}},f.observe(h,k),k.addKey&&k.addKey(l));return k}var q={},n=1;l.prototype={id:"x-variable-"+n++,cache:q,valueOf:function(){if((this.dependents||
this._properties)&&this.cache!==q)return this.cache;var c=this,f=this.computeValue;if(f.then)return this.cache=f.then(function(f){c.computeValue=f;(f=c.cache=f())&&f.then&&f.then(function(e){c.cache=e});return f});(f=c.cache=f())&&f.then&&f.then(function(f){c.cache=f});return f},property:function(f){var h=this._properties||(this._properties={}),k=h[f];if(!k){var e=this,k=h[f]=new l(function(){return r.when(e.valueOf(),function(b){if(b&&b.forRule)return{forRule:function(a){a=b.selectRule?b.selectRule(a):
a;var g=["_cache_"+e.id],d;if((d=g in a?a[g]:a[g]=b.forRule(a))&&d.forElement)return p(e,d,f);var h=a[g+"observe"];h&&(h.addKey?h.addKey(f):a[g+"observe"]=c(e,d,f,{rules:[a]}));return d[f]}};if(b&&b.forElement)return p(e,b,f);var h=e.cacheObserve;h?h.addKey&&h.addKey(f):h=e.cacheObserve=c(e,b,f);return b[f]})});k.key=f;k.parent=this;k.put=function(b){return r.when(e.valueOf(),function(c){function a(a){if(a.forElement)return{forElement:function(d){a.forElement(d)[f]=b}};a[f]=b}if(c.forRule)return{forRule:function(b){return a(c.forRule(b))}};
a(c)})};k.id=this.id+"-"+f}return k},invalidate:function(c){var h=this.cacheObserve;h&&(f.unobserve(this.cache,h),this.cacheObserve=null);this.cache=q;var k,h=this._properties;for(k in h)h[k].invalidate(c);var e=this.dependents||0;k=0;for(h=e.length;k<h;k++)try{e[k].invalidate(c)}catch(b){console.error(b,"invalidating a definition")}},dependencyOf:function(c){(this.dependents||(this.dependents=[])).push(c)},notDependencyOf:function(c){for(var f=this.dependents||0,k=0;k<f.length;k++)f[k]===c&&f.splice(k--,
1)},setReverseCompute:function(c){this.put=function(){var f=c.apply(this,arguments);this.invalidate();return f}},setCompute:function(c){(this.computeValue=c)&&c.reverse&&this.setReverseCompute(c.reverse);this.invalidate()},setSource:function(c){this.computeValue=function(){return c};this.invalidate()},observe:function(c){this.computeValue&&c(this.valueOf());var f=this;return this.dependencyOf({invalidate:function(){c(f.valueOf())}})},newElement:function(){return r.when(this.valueOf(),function(c){return c&&
c.newElement&&c.newElement()})}};return l})},"xstyle/core/es6":function(){define("xstyle/core/es6",[],function(){function r(b,a,c){q?-1===q.indexOf(b)&&q.push(b):(q=[b],setTimeout(function(){q.forEach(function(a){var b=[];a.properties.forEach(function(d){b.push({target:a.object,name:d})});a(b);a.object=null;a.properties=null});q=null},0));b.object=a;b=b.properties||(b.properties=[]);-1===b.indexOf(c)&&b.push(c)}function f(){return f}var l=Object.observe,p;if(p=Object.defineProperty)a:{try{Object.defineProperty({},
"t",{});p=!0;break a}catch(m){}p=void 0}var c={observe:l,defineProperty:p,promise:"undefined"!==typeof Promise,WeakMap:"function"===typeof WeakMap},l=c.observe?Object.observe:c.defineProperty?function(b,a){a.addKey=function(c){var d="key"+c;if(!this[d]){this[d]=!0;var e=b[c];if((d=Object.getOwnPropertyDescriptor(b,c))&&d.set){var f=d.set,g=d.get;Object.defineProperty(b,c,{get:function(){return e=g.call(this)},set:function(b){f.call(this,b);e!==b&&(e=b,a&&r(a,this,c))}})}else Object.defineProperty(b,
c,{get:function(){return e},set:function(b){e!==b&&(e=b,a&&r(a,this,c))}})}};a.remove=function(){a=null}}:function(b,a){t||(t=!0,setInterval(function(){for(var a=0,b=n.length;a<b;a++){var d=k[a],c=n[a],e=h[a],f=void 0,g=void 0;for(g in d)d.hasOwnProperty(g)&&d[g]!==c[g]&&(d[g]=c[g],(f||(f=[])).push({name:g}));for(g in c)c.hasOwnProperty(g)&&!d.hasOwnProperty(g)&&(d[g]=c[g],(f||(f=[])).push({name:g}));f&&e(f)}},20));var c={},d;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);n.push(b);k.push(c);h.push(a)},
q;p=c.observe?Object.unobserve:function(b,a){a.remove&&a.remove();for(var c=0,d=n.length;c<d;c++)if(n[c]===b&&h[c]===a){n.splice(c,1);k.splice(c,1);h.splice(c,1);break}};var n=[],k=[],h=[],t=!1,e=1,b=function(){};b.prototype.toJSON=f;return{Promise:c.promise?Promise:function(){function b(a){function c(a){a&&a.then?a.then(c,d):(h=a,e())}function d(a){k=a;e()}function e(){f=!0;for(var a=0,b=l.length;a<b;a++)l[a]();l=0}var f,h,k,l=0;a(c,d);return{then:function(a,d){return new b(function(b,c){function e(){try{k&&
!d?c(k):b(k?d(k):a?a(h):h)}catch(E){c(E)}}f?e():(l||(l=[])).push(e)})}}}return b}(),WeakMap:c.WeakMap?WeakMap:function(f,a){var g="__"+(a||"")+e++;return c.defineProperty?{get:function(a){return a[g]},set:function(a,b){Object.defineProperty(a,g,{value:b,enumerable:!1})}}:{get:function(a){return(a=a[g])&&a.value},set:function(a,c){(a[g]||(a[g]=new b)).value=c}}},observe:l,unobserve:p,copy:function(b,a){for(var c in a)b[c]=a[c];return b}}})},"xstyle/core/Rule":function(){define("xstyle/core/Rule",["xstyle/core/expression",
"xstyle/core/Definition","put-selector/put","xstyle/core/es6","xstyle/core/utils"],function(r,f,l,p,c){function q(a,b,d){try{a[b]=d}catch(z){}}function n(){}function k(a,d,c,e){if(a.calls){var g;for(c=0;c<a.length;c++){var k=a[c];if(k instanceof h){a.hasOwnProperty(c)||(a[c]=k=b(k));var l=k.ref&&(k.ref.selfResolving?k.ref.apply(d,k.getArgs(),d):r.evaluate(d,[k.caller,k]));void 0!==l&&((g||(g=[])).push(l),k.evaluated=!0)}}}if(g)return d=r.react(function(){for(var b=0,d=a.slice(),c=0;c<a.length;c++){var e=
a[c];e instanceof h&&e.evaluated&&(d[c-1]=a[c-1].slice(0,-e.caller.length),d[c]=arguments[b++])}return d.join("")}),d.skipResolve=!0,e=new f,e.setCompute(d.apply(e,g,e)),e;if(!e)return a.toString()}function h(a){this.caller=a;this.args=[]}function t(a,b,d,f){return c.when(b,function(b){var c=b;b&&b.forRule&&((a._subRuleListeners||(a._subRuleListeners=[])).push(function(a){var b=c.forRule(a,!0);b&&b.forElement?e(a,b,f):d&&d(b)}),b=b.forRule(a));if(b&&b.forElement)return e(a,b,f);d&&d(b)})}function e(a,
b,d){return require(["xstyle/core/elemental"],function(c){c.addRenderer(a,function(a){var c=b.forElement(a);d&&d(c,a)})})}var b=Object.create||function(a){function b(){}b.prototype=a;return new b},m=c.convertCssNameToJs,a={"{":"}","[":"]","(":")"},g=l("div").style;n.prototype={property:function(a){return(this._properties||(this._properties={}))[a]||(this._properties[a]=new Proxy(this.get(a)))},eachProperty:function(a){for(var b=this.values||0,d=0;d<b.length;d++){var c=b[d];a.call(this,c||"unnamed",
b[c])}},fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},newRule:function(a){a=(this.rules||(this.rules={}))[a]=new n;a.disabled=this.disabled;a.parent=this;return a},newCall:function(a){a=new h(a);a.parent=this;return a},addSheetRule:function(a,b){if("@"!=a.charAt(0)){var d=this.styleSheet,c=d.cssRules||d.rules,e=-1<this.ruleIndex?this.ruleIndex:c.length;try{d.addRule(a,b||" ",e)}catch(D){a.match(/-(moz|webkit|ie)-/)||console.warn("Unable to add rule",
a,b)}return c[e]}},onRule:function(){var a=this.getCssRule();if(this.installStyles)for(var b=0;b<this.installStyles.length;b++){var d=this.installStyles[b];q(a.style,d[0],d[1])}},setMediaSelector:function(a){this.isMediaBlock=!0;this.selector=a},setStyle:function(a,b){this.cssRule?q(this.cssRule.style,a,b):(this.installStyles||(this.installStyles=[])).push([a,b])},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(a){return this.values[a]},
elements:function(a){var b=this;require(["xstyle/core/elemental"],function(d){d.addRenderer(b,function(b){a(b)})})},declareDefinition:function(a,b,d){a=a&&m(a);if(!this.disabled){var e=this;if(b.length)if("\x3e"==b[0].toString().charAt(0))a||(this.generator=b,require(["xstyle/core/generate","xstyle/core/elemental"],function(a,d){b=a.forSelector(b,e);d.addRenderer(e,b)}));else{var f=a in g||this.getDefinition(a);if(!d||!f){d=this.definitions||(this.definitions={});var h=b[0];if(h.indexOf&&-1<h.indexOf(","))for(var h=
b.join("").split(/\s*,\s*/),k=[],l=0;l<h.length;l++)k[l]=r.evaluate(this,h[l]);b[0]&&"{"==b[0].operator?k=b[0]:b[1]&&"{"==b[1].operator&&(k=b[1],c.extend(k,b[0]));k=k||r.evaluate(this,b);if(k.then)var n=k,k={then:function(a){return n.then(function(b){return a(p(b))})}};var p=function(b){b.define&&(b=b.define(e,a));return b};f&&console.warn('Overriding existing property "'+a+'"');return d[a]=p(k)}}else return d=this.definitions||(this.definitions={}),d[a]=b}},onArguments:function(a){var b=a.ref;return b&&
b.apply(this,a.getArgs(),this)},setValue:function(a,b,d){var c=m(a);if(!this.disabled){var e=this.values||(this.values=[]);e.push(a);e[a]=b;if(a){do{e=(d||this).getDefinition(a);if(void 0!==e){if(this.cssRule&&(!e||!e.keepCSSValue)){var f=this.cssRule.style;c in f&&q(f,c,"")}t(this,e.put(b,this,c))}a=a.substring(0,a.lastIndexOf("-"))}while(a)}c in g&&this._setStyleFromValue(c,b,!0)}},_setStyleFromValue:function(a,b,d){var f=b[0];if(f instanceof n)for(d=f.values,f=0;f<d.length;f++){var g=d[f];this._setStyleFromValue(a+
("main"==g?"":g.charAt(0).toUpperCase()+g.slice(1)),d[g])}else{if(b.calls){var h=this;if(b.expression=k(b,this,a,!0)){var l=b.expression&&b.expression.valueOf(),m=function(b,d){var c=l&&l.forRule?l.forRule(b,!0):l;if(c&&c.forElement)if(d=d&&d.elements)for(var f=0;f<d.length;f++)for(var g=d[f].querySelectorAll(b.selector),h=0;h<g.length;h++){var k=g[h];q(k.style,a,c.forElement(k))}else e(b,c,function(b,d){q(d.style,a,b)});else b.setStyle(a,c)},p=[h];c.when(l,function(a){(l=a)&&l.forRule&&(h._subRuleListeners||
(h._subRuleListeners=[])).push(function(a){p.push(a);m(a)});m(h)});b.expression.dependencyOf({invalidate:function(a){c.when(b.expression.valueOf(),function(b){l=b;for(b=0;b<p.length;b++){var d=!0,c=p[b];if(a&&a.rules)for(var d=!1,e=0;e<a.rules.length;e++)if(a.rules[e]===c){d=!0;break}d&&m(c,a)}})}})}}d||this.setStyle(a,b)}},put:function(a){var b=this;return{forRule:function(d){b.extend(d);if("defaults"!=a&&a&&"string"==typeof a&&b.values)for(var c=a.toString().split(/,\s*/),e=0;e<c.length;e++){var f=
b.values[e];f&&d.setValue(f,c[e],b)}}}},extend:function(a,d){(this.derivatives||(this.derivatives=[])).push(a);var c=this.extraSelector;c&&(a.selector+=c);for(var e=this.cssRule.style,f=a.getCssRule().style,h=a.inheritedStyles||(a.inheritedStyles={}),c=0;c<e.length;c++){var k=m(e[c]);if(!f[k]||h[k])f[k]=e[k],h[k]=!0}if(c=this.values){var c=b(c),l=a.values;a.values=l?p.copy(c,l):c}if(d){if(c=this.definitions){var c=b(c),n=a.definitions;a.definitions=n?p.copy(c,n):c}a.tagName=this.tagName||a.tagName}(a.bases||
(a.bases=[])).push(this);d=this._subRuleListeners||0;for(c=0;c<d.length;c++)d[c](a);var q=a.getCssRule().style;this.eachProperty(function(d,c){d=m(d);"object"==typeof c&&(c=b(c));d in g&&!q[d]&&a._setStyleFromValue(d,c)});if(l&&a.definitions)for(c=0,d=l.length;c<d;c++)k=l[c],e=m(k),a.definitions[e]!==(n&&n[e])&&a.setValue(k,l[e]);if(l=this.generator){if(l instanceof Array)for(l=l.slice(0),c=0;c<l.length;c++)n=l[c],"{"===n.operator&&(d=a.newRule(),d.selector=n.selector+a.selector.slice(1),d.styleSheet=
a.styleSheet||a.cssRule.parentStyleSheet,n.extend(d,!0),l[c]=d);a.declareDefinition(null,l)}},getDefinition:function(a,b){a=m(a);var d=this;do{var c=d.definitions&&d.definitions[a];void 0===c&&b&&d[b]&&(c=d[b][a]);d=d.parent}while(void 0===c&&d);return c},newElement:function(){return l((this.tagName||"span")+(this.selector||""))},cssText:""};r.evaluateText=k;var d=h.prototype=new n;d.declareDefinition=d.setValue=function(a,b){this.args.push(b)};d.toString=function(){var b=this.operator;return b+this.args+
a[b]};n.updateStaleProperties=function(){};return n})},"xstyle/core/generate":function(){define("xstyle/core/generate",["xstyle/core/elemental","put-selector/put","xstyle/core/utils","xstyle/core/expression","xstyle/core/base"],function(r,f,l,p,c){function q(a,b){a=a.sort?a:[a];return function(d,c,e){var k=d,m;"content"in d||(d.content=void 0);if(void 0===e){var p=(d._contentNode||d).childNodes||0,q=p[0];if(q){var u=g.createDocumentFragment();do u.appendChild(q);while(q=p[0]);d.content=u}if(d._contentNode){d._contentNode=
void 0;try{d.innerHTML=""}catch(I){}}}for(var v=0,B=[d],z=[],p=0,q=a.length;p<q;p++){var C=N,N=a[p];try{if(N.eachProperty){if(N.args)if("("==N.operator){var M=a[p+1];n(N,M,k,function(a,d,c){t(a,d,c,b)})}else{var J=N.args[0];if("string"===typeof J){var K=J.split("\x3d");try{k.setAttribute(K[0],K[1])}catch(I){console.error(I)}}else{var O=J[0].replace(/=$/,""),Q=J[1];"("==Q.operator?n(J[1],O,k,function(a,d,c){h(a,d,c,b)}):k.setAttribute(O,Q.value)}}}else if("string"==typeof N){"\x3d"==N.charAt(0)&&(N=
N.slice(1));var P=k,M=a[p+1],K=[];N.replace(/([,\n]+)?([\t ]*)?(\.|#)?([-\w%$|\.\#]+)(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,function(){K.push(arguments)});for(var R=0;R<K.length;R++)(function(a,g,h,n,p,q,r){function t(){var a=P._contentNode;a&&(a.innerHTML="",P=a)}g?(a=h?h.length:0,a>v?(t(),B[a]=P):P=B[a]||P,v=a):t();var u;if(n)u=(C&&C.args?"":"span")+n+p;else{n=p.match(/^[-\w]+/);if(!n)throw new SyntaxError("Unable to parse selector",p);n=n[0];var w;R===K.length-1&&M&&M.selector?(M.bases||l.extend(M,
n),w=M):w=b.getDefinition(n);w&&(w.then||w.newElement)?P=function(a,b,d,c){var e,g;l.when(w&&w.newElement&&w.newElement(),function(a){(e=a)?(d=d.slice(c.length))&&f(e,d):e=f(d);if(g){g.parentNode.replaceChild(e,g);a=g.childNodes;var b;for(e=e._contentNode||e;b=a[0];)e.appendChild(b)}});if(e)return a.insertBefore(e,b||null);g=f("span");return a.insertBefore(g,b||null)}(P,e,p,n):u=p}u&&(P=f(e||P,(e?"-":"")+u));e=null;q&&P.setAttribute(q,""===r?q:r);c&&(P.item=c);m=m||P;(R<K.length-1||P!=k&&P!=d)&&z.push(R==
K.length-1&&M&&M.selector,P);k=P}).apply(this,K[R])}else k.appendChild(g.createTextNode(N.value))}catch(I){console.error(I,I.stack),k.innerHTML&&(k.innerHTML=""),k.appendChild(g.createTextNode(I))}}for(;N=z.pop();)r.update(N,z.pop());return m}}function n(a,b,c,e){var g,h;b&&b.eachProperty?(f(c,g=b.selector),h=b):(f(c,g=a.selector||(a.selector=".-xbind-"+d++)),h=a);var k=a.getArgs()[0],l=a.expressionResult,m=a.expressionDefinition;m||(m=a.expressionDefinition=p.evaluate(a.parent,k),l=m.valueOf(),r.addInputConnector(h,
m),function(b,d,c){a.expressionResult=l;c.dependencyOf&&c.dependencyOf({invalidate:function(a){a=a?r.matchesRule(a.elements[0],h)?a.elements:a.elements[0].querySelectorAll(d):document.querySelectorAll(d);for(var f=0,g=a.length;f<g;f++)e(a[f],b,c.valueOf())}})}(b,g,m));e(c,b,l)}function k(a,b,d,c){return l.when(a,function(a){a&&a.forRule&&(a=a.forRule(b));a&&a.forElement&&(a=a.forElement(d));c(a)})}function h(a,b,d,c){k(d,c,a,function(d){a.setAttribute(b,d)})}function t(b,d,c,h){b._defaultBinding=
!0;if(c&&c.then&&"INPUT"!==b.tagName)try{b.appendChild(g.createTextNode("Loading"))}catch(C){}k(c,h,b,function(c){if(b._defaultBinding)if(e(b),b.childNodes.length&&(b.innerHTML=""),c&&c.sort)if(c.isSequence)q(c,h)(b);else{var k=d&&d.definitions&&d.definitions.each,l=h.newRule(),k=k?q(k,l):function(a,b,d){return f(d||a,(d?"-":"")+(m[a.tagName]||"span"),""+b)},n=[],p;c.track&&(c=c.track(),p=c.tracking);c.forEach(function(a){n.push(k(b,a,null))});if(c.on)var r=c.on("add,delete,update",function(a){var d=
a.target,c=a.previousIndex;a=a.index;if(-1<c){var f=n[c];e(f,!0);f.parentNode.removeChild(f);n.splice(c,1)}-1<a&&n.splice(a,0,k(b,d,n[a]||null))});if(p=p||r)b.xcleanup=function(){p.remove()}}else c&&c.nodeType?b.appendChild(c):(c=void 0===c?"":c,b.tagName in a?"checkbox"===b.type?b.checked=c:b.value=c:b.appendChild(g.createTextNode(c)))})}function e(a,b){a.xcleanup&&a.xcleanup(b);a=a.getElementsByTagName("*");b=0;for(var d=a.length;b<d;b++){var c=a[b];c.xcleanup&&c.xcleanup(!0)}}function b(a,b){return q(b,
c)(a)}var m={TABLE:"tr",TBODY:"tr",TR:"td",UL:"li",OL:"li",SELECT:"option"},a={INPUT:1,TEXTAREA:1,SELECT:1},g=document,d=1;b.forSelector=q;return b})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b){l.isAsync||k(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var m=f("dojo.dnd.Source",e,{isSource:!0,
horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(a,b){p.mixin(this,p.mixin({},b));a=this.accept;if(a.length)for(this.accept={},b=0;b<a.length;++b)this.accept[a[b]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&c.add(this.node,"dojoDndSource");this.targetState="";this.accept&&c.add(this.node,"dojoDndTarget");
this.horizontal&&c.add(this.node,"dojoDndHorizontal");this.topics=[h.subscribe("/dnd/source/over",p.hitch(this,"onDndSourceOver")),h.subscribe("/dnd/start",p.hitch(this,"onDndStart")),h.subscribe("/dnd/drop",p.hitch(this,"onDndDrop")),h.subscribe("/dnd/cancel",p.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==a)return!this.copyOnly||this.selfAccept;for(var d=0;d<b.length;++d){for(var c=a.getItem(b[d].id).type,e=!1,f=0;f<c.length;++f)if(c[f]in this.accept){e=!0;break}if(!e)return!1}return!0},
copyState:function(a,c){if(a)return!0;2>arguments.length&&(c=this==b.manager().target);if(c){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){m.superclass.destroy.call(this);r.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(a){if(!this.isDragging||"Disabled"!=this.targetState){m.superclass.onMouseMove.call(this,a);var c=b.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(a.pageX-this._lastX)>
this.delay||Math.abs(a.pageY-this._lastY)>this.delay)){var d=this.getSelectedNodes();d.length&&c.startDrag(this,d,this.copyState(t.getCopyKeyState(a),!0))}this.isDragging&&(d=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=q.position(this.current,!0)),d=this.horizontal?a.pageX-this.targetBox.x<this.targetBox.w/2==q.isBodyLtr(this.current.ownerDocument):a.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||d!=this.before)&&(this._markTargetAnchor(d),
c.canDrop(!this.current||c.source!=this||!(this.current.id in this.selection)))}},onMouseDown:function(a){this.mouseDown||!this._legalMouseDown(a)||this.skipForm&&t.isFormElement(a)||(this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,m.superclass.onMouseDown.call(this,a))},onMouseUp:function(a){this.mouseDown&&(this.mouseDown=!1,m.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=b.manager(),
a.canDrop("Disabled"!=this.targetState&&(!this.current||a.source!=this||!(this.current.id in this.selection))))},onDndStart:function(a,c,d){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?d?"Copied":"Moved":"");c=this.accept&&this.checkAcceptance(a,c);this._changeState("Target",c?"":"Disabled");this==a&&b.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,b,d,c){if(this==c)this.onDrop(a,b,d);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&
(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,d){if(this!=a)this.onDropExternal(a,b,d);else this.onDropInternal(b,d)},onDropExternal:function(a,b,d){var c=this._normalizedCreator;this._normalizedCreator=this.creator?function(b,d){return c.call(this,a.getItem(b.id).data,d)}:d?function(b){var d=a.getItem(b.id);b=b.cloneNode(!0);b.id=t.getUniqueId();return{node:b,
data:d.data,type:d.type}}:function(b){var d=a.getItem(b.id);a.delItem(b.id);return{node:b,data:d.data,type:d.type}};this.selectNone();d||this.creator||a.selectNone();this.insertNodes(!0,b,this.before,this.current);!d&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=c},onDropInternal:function(a,b){var d=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(b)this._normalizedCreator=this.creator?function(a,b){return d.call(this,this.getItem(a.id).data,b)}:function(a){var b=
this.getItem(a.id);a=a.cloneNode(!0);a.id=t.getUniqueId();return{node:a,data:b.data,type:b.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=d}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){m.superclass.onOverEvent.call(this);b.manager().overSource(this);if(this.isDragging&&"Disabled"!=
this.targetState)this.onDraggingOver()},onOutEvent:function(){m.superclass.onOutEvent.call(this);b.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){if(this.current!=this.targetAnchor||this.before!=a)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":
"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!n.isLeft(a))return!1;if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(c.contains(a,"dojoDndHandle"))return!0;if(c.contains(a,"dojoDndItem")||c.contains(a,
"dojoDndIgnore"))break}return!1}});return m})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b){var m=f("dojo.dnd.Selector",b,{constructor:function(a,b){b||(b={});this.singular=b.singular;this.autoSync=b.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(h(this.node,t.press,p.hitch(this,
"onMouseDown")),h(this.node,t.release,p.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var a=new k,b=e._empty,d;for(d in this.selection)d in b||a.push(c.byId(d));return a},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(a,b){this._addItemClass(c.byId(b),"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=e._empty,b;for(b in this.selection)if(!(b in a)){var d=
c.byId(b);this.delItem(b);q.destroy(d)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,b){b=b||l.global;var d=this.selection,c=e._empty,f;for(f in d)f in c||a.call(b,this.getItem(f),f,this)},sync:function(){m.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],b=e._empty,d;for(d in this.selection)d in b||this.getItem(d)||a.push(d);r.forEach(a,function(a){delete this.selection[a]},this);return this},insertNodes:function(a,
b,d,c){var e=this._normalizedCreator;this._normalizedCreator=function(b,d){b=e.call(this,b,d);a?(this.anchor?this.anchor!=b.node&&(this._removeItemClass(b.node,"Anchor"),this._addItemClass(b.node,"Selected")):(this.anchor=b.node,this._removeItemClass(b.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[b.node.id]=1):(this._removeItemClass(b.node,"Selected"),this._removeItemClass(b.node,"Anchor"));return b};m.superclass.insertNodes.call(this,b,d,c);this._normalizedCreator=e;
return this},destroy:function(){m.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!e.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,n.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){e.getCopyKeyState(a)||this._removeSelection();var b=this.getAllNodes();if(b.length&&(this.anchor||(this.anchor=b[0],this._addItemClass(this.anchor,
"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var d=0,c;d<b.length&&(c=b[d],c!=this.anchor&&c!=this.current);++d);for(++d;d<b.length;++d){c=b[d];if(c==this.anchor||c==this.current)break;this._addItemClass(c,"Selected");this.selection[c.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?e.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,
"Anchor"),this.selection[this.current.id]=1):e.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||
(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=h(this.node,t.move,p.hitch(this,"onMouseMove"))},
onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=e._empty,b;for(b in this.selection)if(!(b in a)){var d=c.byId(b);d&&this._removeItemClass(d,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return m})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e,b,m,a){f=f("dojo.dnd.Container",h,{skipForm:!1,allowNested:!1,constructor:function(a,b){this.node=q.byId(a);b||(b={});this.creator=b.creator||null;this.skipForm=b.skipForm;this.parent=b.dropParent&&q.byId(b.dropParent);this.map={};this.current=null;this.containerState="";n.add(this.node,"dojoDndContainer");b&&b._skipStartup||this.startup();this.events=[e(this.node,m.over,p.hitch(this,"onMouseOver")),e(this.node,m.out,p.hitch(this,"onMouseOut")),e(this.node,"dragstart",
p.hitch(this,"onSelectStart")),e(this.node,"selectstart",p.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},setItem:function(a,b){this.map[a]=b},delItem:function(a){delete this.map[a]},forInItems:function(b,d){d=d||l.global;var c=this.map,e=a._empty,f;for(f in c)f in e||b.call(d,c[f],f,this);return d},clearItems:function(){this.map={}},getAllNodes:function(){return b((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var b={};this.getAllNodes().forEach(function(d){if(d.id){var c=
this.getItem(d.id);if(c){b[d.id]=c;return}}else d.id=a.getUniqueId();var c=d.getAttribute("dndType"),e=d.getAttribute("dndData");b[d.id]={data:e||d.innerHTML,type:c?c.split(/\s*,\s*/):["text"]}},this);this.map=b;return this},insertNodes:function(a,b,c){this.parent.firstChild?b?c||(c=this.parent.firstChild):c&&(c=c.nextSibling):c=null;var d;if(c)for(b=0;b<a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),c.parentNode.insertBefore(d.node,c);else for(b=0;b<
a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),this.parent.appendChild(d.node);return this},destroy:function(){r.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,b,c){a._skipStartup=!0;return new c(b,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var b=this.parent.getElementsByTagName("tbody");b&&b.length&&(this.parent=
b[0])}this.defaultCreator=a._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var b=a.relatedTarget;b&&b!=this.node;)try{b=b.parentNode}catch(u){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(d){a=null}}this.current&&
(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(b){this.withHandles||this.skipForm&&a.isFormElement(b)||(b.stopPropagation(),b.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,b){var d="dojoDnd"+a;a=a.toLowerCase()+"State";n.replace(this.node,d+b,d+this[a]);this[a]=b},_addItemClass:function(a,b){n.add(a,"dojoDndItem"+b)},_removeItemClass:function(a,b){n.remove(a,"dojoDndItem"+
b)},_getChildByEvent:function(a){if(a=a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==this.parent||this.allowNested)&&n.contains(a,"dojoDndItem"))return a;return null},_normalizedCreator:function(b,c){b=(this.creator||this.defaultCreator).call(this,b,c);p.isArray(b.type)||(b.type=["text"]);b.node.id||(b.node.id=a.getUniqueId());n.add(b.node,"dojoDndItem");return b}});a._createNode=function(b){return b?function(a){return k.create(b,{innerHTML:a})}:a._createSpan};a._createTrTd=function(a){var b=
k.create("tr");k.create("td",{innerHTML:a},b);return b};a._createSpan=function(a){return k.create("span",{innerHTML:a})};a._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};a._defaultCreator=function(b){b=b.tagName.toLowerCase();var c="tbody"==b||"thead"==b?a._createTrTd:a._createNode(a._defaultCreatorNodes[b]);return function(b,d){var e=b&&p.isObject(b),f;e&&b.tagName&&b.nodeType&&b.getAttribute?(f=b.getAttribute("dndData")||b.innerHTML,e=(e=b.getAttribute("dndType"))?e.split(/\s*,\s*/):["text"]):
(f=e&&b.data?b.data:b,e=e&&b.type?b.type:["text"],b=("avatar"==d?a._createSpan:c)(String(f)));b.id||(b.id=a.getUniqueId());return{node:b,data:f,type:e}}};return f})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m,a){var g=f("dojo.dnd.Manager",[q],{constructor:function(){this.source=this.avatar=null;this.nodes=
[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:n("touch")?4:16,OFFSET_Y:n("touch")?4:16,overSource:function(a){this.avatar&&(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());t.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),t.publish("/dnd/source/over",null)):t.publish("/dnd/source/over",null)},startDrag:function(a,b,f){function d(a){a.preventDefault();
a.stopPropagation()}m.autoScrollStart(p.doc);this.source=a;this.nodes=b;this.copy=!!f;this.avatar=this.makeAvatar();p.body().appendChild(this.avatar.node);t.publish("/dnd/start",a,b,this.copy);this.events=[h(p.doc,e.move,l.hitch(this,"onMouseMove")),h(p.doc,e.release,l.hitch(this,"onMouseUp")),h(p.doc,"keydown",l.hitch(this,"onKeyDown")),h(p.doc,"keyup",l.hitch(this,"onKeyUp")),h(p.doc,"dragstart",d),h(p.body(),"selectstart",d)];a="dojoDnd"+(f?"Copy":"Move");c.add(p.body(),a)},canDrop:function(a){a=
!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){c.remove(p.body(),["dojoDndCopy","dojoDndMove"]);r.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new a(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var c=this.avatar;c&&(m.autoScrollNodes(a),c=c.node.style,c.left=a.pageX+this.OFFSET_X+"px",c.top=
a.pageY+this.OFFSET_Y+"px",c=!!this.source.copyState(b.getCopyKeyState(a)),this.copy!=c&&this._setCopyStatus(c));n("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&this.canDropFlag){var c=!!this.source.copyState(b.getCopyKeyState(a));t.publish("/dnd/drop/before",this.source,this.nodes,c,this.target,a);t.publish("/dnd/drop",this.source,this.nodes,c,this.target,a)}else t.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case k.CTRL:a=
!!this.source.copyState(!0);this.copy!=a&&this._setCopyStatus(a);break;case k.ESCAPE:t.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==k.CTRL&&(a=!!this.source.copyState(!1),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();c.replace(p.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});b._manager=null;g.manager=b.manager=function(){b._manager||
(b._manager=new g);return b._manager};return g})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(r,f,l,p,c,q,n,k){return r("dojo.dnd.Avatar",null,{constructor:function(c){this.manager=c;this.construct()},construct:function(){var c=q.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),f=this.manager.source,e,b=q.create("tbody",null,c),k=q.create("tr",
null,b),a=q.create("td",null,k),g=Math.min(5,this.manager.nodes.length),d=0;n("highcontrast")&&q.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},a);q.create("span",{innerHTML:f.generateText?this._generateText():""},a);for(p.set(k,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});d<g;++d)f.creator?e=f._normalizedCreator(f.getItem(this.manager.nodes[d].id).data,"avatar").node:(e=this.manager.nodes[d].cloneNode(!0),"tr"==e.tagName.toLowerCase()&&(k=q.create("table"),q.create("tbody",
null,k).appendChild(e),e=k)),e.id="",k=q.create("tr",null,b),a=q.create("td",null,k),a.appendChild(e),p.set(k,{"class":"dojoDndAvatarItem",style:{opacity:(9-d)/10}});this.node=c},destroy:function(){q.destroy(this.node);this.node=!1},update:function(){c.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(n("highcontrast")){var f=l.byId("a11yIcon"),p="+";this.manager.canDropFlag&&!this.manager.copy?p="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(p="x"):
p="o";f.innerHTML=p}k("tr.dojoDndAvatarHeader td span"+(n("highcontrast")?" span":""),this.node).forEach(function(c){c.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(r,f,l,p){return r("dijit.CheckedMenuItem",l,{baseClass:"dijitMenuItem dijitCheckedMenuItem",
templateString:p,checked:!1,_setCheckedAttr:function(c){this.domNode.setAttribute("aria-checked",c?"true":"false");this._set("checked",c)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(c){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(c)}})})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(r,f,l,p,c,q,n,k,h,t,e){var b=h("dijit.ColorPalette",[l,p,c],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:f,baseClass:"dijitColorPalette",_dyeFactory:function(b,a,c,d){return new this._dyeClass(b,
a,c,d)},buildRendering:function(){this.inherited(arguments);this._dyeClass=h(b._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],n.getLocalization("dojo","colors",this.lang))}});b._Color=h("dijit._Color",k,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":r.toUrl("./themes/a11y/colors7x10.png"),"3x4":r.toUrl("./themes/a11y/colors3x4.png")},constructor:function(b,a,c,d){this._title=d;this._row=a;this._col=c;this.setColor(k.named[b])},getValue:function(){return this.toHex()},fillCell:function(b,a){a=e.substitute(q("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:a,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});t.place(a,b)}});return b})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(r,f,l,p,c,q,n,k,h,t,e){return r("dijit._PaletteMixin",k,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(b){return new ("string"==
typeof this.dyeClass?q.getObject(this.dyeClass):this.dyeClass)(b)},_preparePalette:function(b,f){this._cells=[];var a=this._blankGif;this.own(n(this.gridNode,h,q.hitch(this,"_onCellClick")));for(var g=0;g<b.length;g++)for(var d=p.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),k=0;k<b[g].length;k++){var l=b[g][k];if(l){var m=this._dyeFactory(l,g,k,f[l]),l=p.create("td",{"class":this.cellClass,tabIndex:"-1",title:f[l],role:"gridcell"},d);m.fillCell(l,a);l.idx=this._cells.length;this._cells.push({node:l,
dye:m})}}this._xDim=b[0].length;this._yDim=b.length;var r={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},t;for(t in r)this.own(e.addKeyListener(this.domNode,{keyCode:c[t],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=r[t];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){t.focus(this._currentFocus)},
_onCellClick:function(b){for(var c=b.target;"TD"!=c.tagName;){if(!c.parentNode||c==this.gridNode)return;c=c.parentNode}var a=this._getDye(c).getValue();this._setCurrent(c);t.focus(c);this._setValueAttr(a,!0);b.stopPropagation();b.preventDefault()},_setCurrent:function(b){"_currentFocus"in this&&f.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=b)&&f.set(b,"tabIndex",this.tabIndex)},_setValueAttr:function(b,c){0<=this._selectedCell&&l.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(b)for(var a=0;a<this._cells.length;a++)if(b==this._cells[a].dye.getValue()){this._selectedCell=a;l.add(this._cells[a].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?b:null);if(c||void 0===c)this.onChange(b)},onChange:function(){},_navigateByKey:function(b,c){-1!=c&&(b=this._currentFocus.idx+b,b<this._cells.length&&-1<b&&(b=this._cells[b].node,this._setCurrent(b),this.defer(q.hitch(t,"focus",b))))},_getDye:function(b){return this._cells[b.idx].dye}})})},
"dojo/_base/query":function(){define(["../query","./NodeList"],function(r){return r})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(r,f,l){return r("dijit.form.ComboBox",[f,l],{})})},"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang","../when","../_base/array"],function(r,f,l,p){r=function(c){function q(e,b){var f=c[e];f&&(c[e]=function(a){var g;"put"===e&&(g=c.getIdentity(a));if(r)return f.apply(this,arguments);
r=!0;try{var d=f.apply(this,arguments);l(d,function(c){b("object"==typeof c&&c||a,g)});return d}finally{r=!1}})}var n=[],k=0;c=f.delegate(c);c.notify=function(c,b){k++;for(var e=n.slice(),a=0,f=e.length;a<f;a++)e[a](c,b)};var h=c.query;c.query=function(e,b){b=b||{};var m=h.apply(this,arguments);if(m&&m.forEach){var a=f.mixin({},b);delete a.start;delete a.count;var g=c.queryEngine&&c.queryEngine(e,a),d=k,q=[],r;m.observe=function(a,e){1==q.push(a)&&n.push(r=function(a,f){l(m,function(h){var l=h.length!=
b.count,m,n;if(++d!=k)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var r,t=-1,u=-1;if(void 0!==f){var v=[].concat(h);g&&!a&&(v=g(h));m=0;for(n=h.length;m<n;m++){var w=h[m];if(c.getIdentity(w)==f&&!(0>v.indexOf(w))){r=w;t=m;!g&&a||h.splice(m,1);break}}}g?a&&(g.matches?g.matches(a):g([a]).length)&&(m=-1<t?t:h.length,h.splice(m,0,a),u=p.indexOf(g(h),a),h.splice(m,1),b.start&&0==u||!l&&u==h.length?u=-1:h.splice(u,0,a)):a&&(void 0!==f?u=t:b.start||(u=
c.defaultIndex||0,h.splice(u,0,a)));if((-1<t||-1<u)&&(e||!g||t!=u))for(l=q.slice(),m=0;h=l[m];m++)h(a||r,t,u)})});var f={};f.remove=f.cancel=function(){var b=p.indexOf(q,a);-1<b&&(q.splice(b,1),q.length||n.splice(p.indexOf(n,r),1))};return f}}return m};var r;q("put",function(e,b){c.notify(e,b)});q("add",function(e){c.notify(e)});q("remove",function(e){c.notify(void 0,e)});return c};f.setObject("dojo.store.Observable",r);return r})},"dijit/form/SimpleTextarea":function(){define(["dojo/_base/declare",
"dojo/dom-class","dojo/sniff","./TextBox"],function(r,f,l,p){return r("dijit.form.SimpleTextarea",p,{baseClass:"dijitTextBox dijitTextArea",rows:"3",cols:"20",templateString:"\x3ctextarea ${!nameAttrSetting} data-dojo-attach-point\x3d'focusNode,containerNode,textbox' autocomplete\x3d'off'\x3e\x3c/textarea\x3e",postMixInProperties:function(){!this.value&&this.srcNodeRef&&(this.value=this.srcNodeRef.value);this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);l("ie")&&this.cols&&
f.add(this.textbox,"dijitTextAreaCols")},filter:function(c){c&&(c=c.replace(/\r/g,""));return this.inherited(arguments)},_onInput:function(c){if(this.maxLength){var f=parseInt(this.maxLength),n=this.textbox.value.replace(/\r/g,""),f=n.length-f;if(0<f){var k=this.textbox;if(k.selectionStart){var h=k.selectionStart,p=0;l("opera")&&(p=(this.textbox.value.substring(0,h).match(/\r/g)||[]).length);this.textbox.value=n.substring(0,h-f-p)+n.substring(h-p);k.setSelectionRange(h-f,h-f)}else this.ownerDocument.selection&&
(k.focus(),n=this.ownerDocument.selection.createRange(),n.moveStart("character",-f),n.text="",n.select())}}this.inherited(arguments)}})})},"dijit/form/RadioButton":function(){define(["dojo/_base/declare","./CheckBox","./_RadioButtonMixin"],function(r,f,l){return r("dijit.form.RadioButton",[f,l],{baseClass:"dijitRadio"})})},"dijit/form/_RadioButtonMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/lang dojo/query!css2 ../registry".split(" "),function(r,f,l,p,c,q){return f("dijit.form._RadioButtonMixin",
null,{type:"radio",_getRelatedWidgets:function(){var f=[];c("input[type\x3dradio]",this.focusNode.form||this.ownerDocument).forEach(p.hitch(this,function(c){c.name==this.name&&c.form==this.focusNode.form&&(c=q.getEnclosingWidget(c))&&f.push(c)}));return f},_setCheckedAttr:function(c){this.inherited(arguments);this._created&&c&&r.forEach(this._getRelatedWidgets(),p.hitch(this,function(c){c!=this&&c.checked&&c.set("checked",!1)}))},_getSubmitValue:function(c){return null==c?"on":c},_onClick:function(c){if(this.checked||
this.disabled)return c.stopPropagation(),c.preventDefault(),!1;if(this.readOnly)return c.stopPropagation(),c.preventDefault(),r.forEach(this._getRelatedWidgets(),p.hitch(this,function(c){l.set(this.focusNode||this.domNode,"checked",c.checked)})),!1;var f=!1,h;r.some(this._getRelatedWidgets(),function(c){return c.checked?(h=c,!0):!1});this.checked=!0;h&&(h.checked=!1);if(!1===this.onClick(c)||c.defaultPrevented)f=!0;this.checked=!1;h&&(h.checked=!0);f?c.preventDefault():this.set("checked",!0);return!f}})})},
"url:jimu/dijit/templates/AGOLLoading.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/AddItemForm.html":'\x3cdiv style\x3d"width: 100%" class\x3d"jimu-item-form"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"itemForm" encType\x3d"multipart/form-data" action\x3d"" method\x3d""\x3e\r\n    \x3cdiv class\x3d"line"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.title}\x3c/div\x3e\r\n      \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-attach-point\x3d"itemName"\r\n      required\x3d"true" class\x3d"input-item"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"line line-margin"\x3e\r\n      \x3cdiv class\x3d"input-label"\x3e${nls.folder}\x3c/div\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"itemFolder" data-dojo-type\x3d"dijit/form/FilteringSelect" trim\x3d"true" class\x3d"input-item"\x3e\x3c/input\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/SymbolChooser.html":'\x3cdiv class\x3d"symbol-chooser" style\x3d"width:320px;"\x3e\r\n\t\x3cdiv class\x3d"symbol-section point-symbol-section" data-dojo-attach-point\x3d"pointSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-sym-class-select-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"pointSymClassSelect" data-dojo-type\x3d"jimu/dijit/formSelect" aria-label\x3d"${nls.markerCategory}" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointCustomImageTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" data-dojo-attach-point\x3d"customImageTd" class\x3d"custom-image-td"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"image-file-tip jimu-ellipsis jimu-leading-margin1" data-dojo-attach-point\x3d"imageNameNode"\x3e${nls.noFileChoosen}\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-icon-tables-tr" data-dojo-attach-point\x3d"pointIconTablesTr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2" style\x3d"position:relative"\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-attach-point\x3d"loadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"pointIconTables"\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-symbolSize"\x3e${nls.symbolSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointSize" data-dojo-type\x3d"dijit/form/NumberSpinner" data-a11y-label-by\x3d"point-symbol-section-symbolSize" style\x3d"width:100%;" data-dojo-props\x3d\'value:18,smallDelta:1,largeDelta:10,constraints:{min:1,max:50},intermediateChanges:true,required:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-color"\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"point-symbol-section-color" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,128]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOpacityTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-transparency"\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-a11y-label-by\x3d"point-symbol-section-transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOutlineColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-outlineColor"\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"point-symbol-section-outlineColor" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,255]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOulineWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"point-symbol-section-outlineWidth"\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner"  data-a11y-label-by\x3d"point-symbol-section-outlineWidth" style\x3d"width:100%;" data-dojo-props\x3d\'value:1,smallDelta:1,constraints:{min:0,max:5},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section line-symbol-section" data-dojo-attach-point\x3d"lineSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineSymPreview" style\x3d"width:100%;overflow:hidden;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"lineIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-color"\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"line-symbol-section-color" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-style"\x3e${nls.style}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cselect class\x3d"restrict-select-width" data-dojo-attach-point\x3d"lineStylesSelect" data-dojo-type\x3d"jimu/dijit/formSelect" data-a11y-label-by\x3d"line-symbol-section-style" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"solid"\x3e${nls.solid}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dash"\x3e${nls.dash}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dot"\x3e${nls.dot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dashdot"\x3e${nls.dashDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"longdashdotdot"\x3e${nls.dashDotDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-transparency"\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-a11y-label-by\x3d"line-symbol-section-transparency" data-dojo-props\x3d\'alpha:1\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"line-symbol-section-width"\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"lineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-a11y-label-by\x3d"line-symbol-section-width" data-dojo-props\x3d\'value:3,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true,required:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section fill-symbol-section" data-dojo-attach-point\x3d"fillSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"fillIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-color"\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"fill-symbol-section-color" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"arrowWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"arrow-symbol-section-width"\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"arrowWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-a11y-label-by\x3d"arrow-symbol-section-width" data-dojo-props\x3d\'value:12,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true,required:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-transparency"\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-a11y-label-by\x3d"fill-symbol-section-transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-outlineColor"\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"fill-symbol-section-outlineColor" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#738c3d"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"fill-symbol-section-outlineWidth"\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"fillOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-a11y-label-by\x3d"fill-symbol-section-outlineWidth" data-dojo-props\x3d\'value:2,smallDelta:1,constraints:{min:0,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section text-symbol-section" data-dojo-attach-point\x3d"textSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word"\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"textPreview"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"text-symbol-section-text"\x3e${nls.text}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput class\x3d"text-input" data-dojo-attach-point\x3d"inputText" type\x3d"text"  data-a11y-label-by\x3d"text-symbol-section-text" style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"text-symbol-section-fontColor"\x3e${nls.fontColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"textColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" data-a11y-label-by\x3d"text-symbol-section-fontColor" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#000"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan class\x3d"jimu-break-word" data-a11y-label-id\x3d"text-symbol-section-fontSize"\x3e${nls.fontSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"textFontSize" data-dojo-type\x3d"dijit/form/NumberSpinner"\r\n\t\t\t\t\t\tdata-a11y-label-by\x3d"text-symbol-section-fontSize" style\x3d"width:100%;" data-dojo-props\x3d\'value:20,smallDelta:1,constraints:{min:1,max:100},intermediateChanges:true,required:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ImageChooser.html":'\x3cdiv class\x3d"jimu-image-chooser js-fileapi-wrapper"\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintText"\x3e\r\n\t\t\x3cspan class\x3d"display-text" data-dojo-attach-point\x3d"displayText"\x3e\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintImage"\x3e\r\n\t\t\x3cimg class\x3d"display-image" data-dojo-attach-point\x3d"selfImg"\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--\r\n  \x3cform data-dojo-attach-point\x3d"fileForm"\x3e\r\n    \x3clabel data-dojo-attach-point\x3d"mask"\x3e\x3c/label\x3e\r\n    \x3cinput type\x3d"file" data-dojo-attach-point\x3d"fileInput"\x3e\r\n  \x3c/form\x3e\r\n  \x3cimg class\x3d"tmp-image" style\x3d"display:none" data-dojo-attach-point\x3d"tmpImg"\x3e--\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_CropImage.html":'\x3cdiv class\x3d"jimu-crop-image"\x3e\r\n\t\x3cimg class\x3d"loading-image" data-dojo-attach-point\x3d"loadingImg" src\x3d""\x3e\r\n\r\n\t\x3cimg class\x3d"base-image hide-status" data-dojo-attach-point\x3d"baseImage" width\x3d"100%" height\x3d"100%" style\x3d"display:none;width:100%;height:100%"\x3e\r\n\x3c/div\x3e\r\n',"url:dojox/widget/ColorPicker/ColorPicker.html":'\x3ctable class\x3d"dojoxColorPicker" dojoAttachEvent\x3d"onkeypress: _handleKey" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\x3ctr\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxColorPickerBox"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg title\x3d"${saturationPickerTitle}" alt\x3d"${saturationPickerTitle}" class\x3d"dojoxColorPickerPoint" src\x3d"${_pickerPointer}" tabIndex\x3d"0" dojoAttachPoint\x3d"cursorNode" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cimg role\x3d"presentation" alt\x3d"" dojoAttachPoint\x3d"colorUnderlay" dojoAttachEvent\x3d"onclick: _setPoint, onmousedown: _stopDrag" class\x3d"dojoxColorPickerUnderlay" src\x3d"${_underlay}" ondragstart\x3d"return false"\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxHuePicker"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg dojoAttachPoint\x3d"hueCursorNode" tabIndex\x3d"0" class\x3d"dojoxHuePickerPoint" title\x3d"${huePickerTitle}" alt\x3d"${huePickerTitle}" src\x3d"${_huePickerPointer}" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dojoxHuePickerUnderlay" dojoAttachPoint\x3d"hueNode"\x3e\r\n\t\t\t\t    \x3cimg role\x3d"presentation" alt\x3d"" dojoAttachEvent\x3d"onclick: _setHuePoint, onmousedown: _stopDrag" src\x3d"${_hueUnderlay}"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerPreviewContainer"\x3e\r\n\t\t\t\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"previewNode" class\x3d"dojoxColorPickerPreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"safePreviewNode" class\x3d"dojoxColorPickerWebSafePreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"bottom"\x3e\r\n\t\t\t\t\t\t\x3ctable class\x3d"dojoxColorPickerOptional" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerRgb" dojoAttachPoint\x3d"rgbNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_r"\x3e${redLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_r" dojoAttachPoint\x3d"Rval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_g"\x3e${greenLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_g" dojoAttachPoint\x3d"Gval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_b"\x3e${blueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_b" dojoAttachPoint\x3d"Bval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerHsv" dojoAttachPoint\x3d"hsvNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_h"\x3e${hueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_h" dojoAttachPoint\x3d"Hval"size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${degLabel}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_s"\x3e${saturationLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_s" dojoAttachPoint\x3d"Sval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_v"\x3e${valueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_v" dojoAttachPoint\x3d"Vval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dojoxColorPickerHex" dojoAttachPoint\x3d"hexNode" aria-live\x3d"polite"\x3e\t\r\n\t\t\t\t\t\t\t\t\t\t\x3clabel for\x3d"${_uId}_hex"\x3e\x26nbsp;${hexLabel}\x26nbsp;\x3c/label\x3e\x3cinput id\x3d"${_uId}_hex" dojoAttachPoint\x3d"hexCode, focusNode, valueNode" size\x3d"6" class\x3d"dojoxColorPickerHexCode" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/td\x3e\r\n\t\x3c/tr\x3e\r\n\x3c/table\x3e\r\n\r\n',
"url:jimu/dijit/templates/_Transparency.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"opacitySlider" data-dojo-type\x3d"dijit/form/HorizontalSlider" showbuttons\x3d"true" value\x3d"0" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"101" intermediatechanges\x3d"true" style\x3d"width:100%;" data-dojo-attach-event\x3d"change: _onAlphaChanged"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${nls.opaque},${nls.transparent}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\r\n    \x3c/div\x3e\r\n    \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height: 1em; font-size: 0.75em; color: darkblue;"\x3e\r\n      \x3cli\x3e${_nls0}\x3c/li\x3e\r\n      \x3cli\x3e${_nls50}\x3c/li\x3e\r\n      \x3cli\x3e${_nls100}\x3c/li\x3e\r\n    \x3c/ol\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/TabContainer3.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"tabTr"\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/DrawBox.html":'\x3cdiv style\x3d"position:relative;width:100%;"\x3e\r\n\t\x3cdiv class\x3d"draw-items"\x3e\r\n\t\t\x3cdiv title\x3d"${nls.point}" data-geotype\x3d"POINT" data-commontype\x3d"point" class\x3d"draw-item point-icon" data-dojo-attach-point\x3d"pointIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.line}" data-geotype\x3d"LINE" data-commontype\x3d"polyline" class\x3d"draw-item line-icon" data-dojo-attach-point\x3d"lineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polyline}" data-geotype\x3d"POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item polyline-icon" data-dojo-attach-point\x3d"polylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolyline}" data-geotype\x3d"FREEHAND_POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item freehand-polyline-icon" data-dojo-attach-point\x3d"freehandPolylineIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.arrow}" data-geotype\x3d"ARROW" data-commontype\x3d"arrow" class\x3d"draw-item arrow-icon" data-dojo-attach-point\x3d"arrowIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.triangle}" data-geotype\x3d"TRIANGLE" data-commontype\x3d"polygon" class\x3d"draw-item triangle-icon" data-dojo-attach-point\x3d"triangleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.extent}" data-geotype\x3d"EXTENT" data-commontype\x3d"polygon" class\x3d"draw-item extent-icon" data-dojo-attach-point\x3d"extentIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.circle}" data-geotype\x3d"CIRCLE" data-commontype\x3d"polygon" class\x3d"draw-item circle-icon" data-dojo-attach-point\x3d"circleIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.ellipse}" data-geotype\x3d"ELLIPSE" data-commontype\x3d"polygon" class\x3d"draw-item ellipse-icon" data-dojo-attach-point\x3d"ellipseIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polygon}" data-geotype\x3d"POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item polygon-icon" data-dojo-attach-point\x3d"polygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolygon}" data-geotype\x3d"FREEHAND_POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item freehand-polygon-icon" data-dojo-attach-point\x3d"freehandPolygonIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.text}" data-geotype\x3d"TEXT" data-commontype\x3d"text" class\x3d"draw-item text-icon" data-dojo-attach-point\x3d"textIcon" data-dojo-attach-point\x3d"textIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"drawings-clear" data-dojo-attach-point\x3d"btnClear" title\x3d"${nls.clear}"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ColorRecords.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\t\t\x3ctr tabindex\x3d"0" role\x3d"row" data-dojo-attach-point\x3d"container"\x3e\r\n\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/Filter.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"contentSection" class\x3d"content-section"\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"desktopAddSection" class\x3d"desktop-add-section hidden"\x3e\r\n\t\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"btnAddExpDesktop" class\x3d"add-with-icon add-expression jimu-float-leading jimu-state-disabled"\x3e\r\n\t\t\t\t\x3cspan class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addAnotherExpression}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"btnAddSetDesktop" class\x3d"add-with-icon add-set jimu-float-leading jimu-state-disabled"\x3e\r\n\t\t\t\t\x3cspan class\x3d"jimu-icon jimu-icon-add"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan class\x3d"add-label"\x3e${nls.addSet}\x3c/span\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"matchMsg" class\x3d"match-msg"\x3e\r\n\t\t\t\x3cdiv data-dojo-attach-point\x3d"oneOrZeroMsg" tabindex\x3d"0" style\x3d"display:none;"\x3e${nls.oneOrZeroMsg}\x3c/div\x3e\r\n\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect" data-dojo-type\x3d"jimu/dijit/formSelect" class\x3d"dijit-form-Select restrict-select-width" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.matchMsgAll}\x3c/option\x3e\r\n\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.matchMsgAny}\x3c/option\x3e\r\n\t\t\t\x3c/select\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"allExpsBox" data-dojo-attach-point\x3d"allExpsBox"\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"errorSection" class\x3d"hidden"\x3e\r\n\t\t\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"errorTip" class\x3d"error-tip"\x3e\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"mobileAddSection" class\x3d"mobile-add-section hidden"\x3e\r\n\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" title\x3d"${nls.addAnotherExpression}" class\x3d"jimu-btn jimu-btn-vacation jimu-float-leading jimu-state-disabled" data-dojo-attach-point\x3d"btnAddExpMobile"\x3e\r\n\t\t\t+ ${nls.addAnotherExpression}\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv role\x3d"button" tabindex\x3d"0" title\x3d"${nls.addSet}" class\x3d"jimu-btn jimu-btn-vacation jimu-float-leading jimu-state-disabled" data-dojo-attach-point\x3d"btnAddSetMobile"\x3e\r\n\t\t\t+ ${nls.addSet}\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"noFilterTipSection" class\x3d"no-filter-tip hidden" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"loading" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:jimu/dijit/templates/dateTimePicker.html":'\x3cdiv data-dojo-attach-point\x3d"dateTimeBox" class\x3d"jimu-dateTimeBox"\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"calendarDiv"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"timeTextContainerRuntime" class\x3d"timeTextContainer timeTextContainerRuntime"\x3e\r\n\t\t\x3cdiv class\x3d"timeTextIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"timeTextBoxDiv"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"timeTextContainerSetting" class\x3d"timeTextContainer" style\x3d"display:none;"\x3e\r\n\t\t\x3cdiv class\x3d"timeCheckbox" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"timeCheckbox" data-dojo-props\x3d"checked:true, label:\'${timeNls.showTime}\'"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"timeTableContainer" style\x3d"display:none;"\x3e\r\n\t\t\t\x3cdiv class\x3d"timeGroup"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"timeLabel jimu-ellipsis" title\x3d"${timeUnit.hour}"\x3e${timeUnit.hour}\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"timeLabel jimu-ellipsis" title\x3d"${timeUnit.minute}"\x3e${timeUnit.minute}\x3c/div\x3e\r\n\t\t\t\t\x3cdiv class\x3d"timeLabel jimu-ellipsis" title\x3d"${timeUnit.second}"\x3e${timeUnit.second}\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\t\x3cdiv class\x3d"timeGroup"\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"hourSelect" data-dojo-type\x3d"dijit/form/TimeTextBox"\r\n\t\t\t\t\tdata-dojo-props\x3d"constraints:{timePattern:\'HH\', clickableIncrement: \'T01:00:00\', visibleIncrement: \'T01:00:00\'}"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"minuteSelect" data-dojo-type\x3d"dijit/form/TimeTextBox"\r\n\t\t\t\t\tdata-dojo-props\x3d"constraints:{timePattern:\'mm\', clickableIncrement: \'T00:05:00\', visibleIncrement: \'T00:05:00\',pickerMin: \'T01:00:00\',pickerMax: \'T01:59:00\'}"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"secondSelect" data-dojo-type\x3d"dijit/form/TimeTextBox"\r\n\t\t\t\t\tdata-dojo-props\x3d"constraints:{timePattern:\'ss\', clickableIncrement: \'T00:00:05\', visibleIncrement: \'T00:00:05\',pickerMin: \'T01:00:00\',pickerMax: \'T01:00:59\'}"\x3e\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/TwoNumbersValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"numberRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;" data-dojo-attach-point\x3d"_dijit1_container"\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;" data-dojo-attach-point\x3d"_dijit2_container"\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/TwoDatesValueProvider.html":'\x3cdiv\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"dateRangeTable" style\x3d"width:100%;border-collapse:collapse;" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:40%;"\x3e\r\n\t\t\t\t\t\x3c!-- \x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"jimu/dijit/_filter/DateValueSelector" data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged" /\x3e --\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"_dijitDiv1"  data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd style\x3d"width:20%;text-align:center;"\x3e\r\n\t\t\t\t\t\x3cspan\x3e${nls.and}\x3c/span\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3c!-- \x3cinput data-dojo-attach-point\x3d"_dijit2" data-dojo-type\x3d"jimu/dijit/_filter/DateValueSelector" data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged" /\x3e --\x3e\r\n\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"_dijitDiv2"  data-dojo-attach-event\x3d"change:_onDateValueSelectorChanged"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/AdvancedListValueSelect.html":'\x3cdiv class\x3d"jimu-list-multiple-select" data-dojo-attach-point\x3d"multipleSelect" tabindex\x3d"0"\x3e\r\n  \x3cdiv class\x3d"selectedContainer" data-dojo-attach-point\x3d"selectedContainer"\x3e\r\n    \x3cdiv class\x3d"jimu-multiple-items-list items-content" data-dojo-attach-point\x3d"selectedListContent" tabindex\x3d"0"\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv\x3e\r\n    \x3c!-- \x3cdiv style\x3d"position:absolute;height:345px;width:100%;z-index:1;display:none;" data-dojo-attach-point\x3d"listContainerOverlay"\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"searchKeyInput" data-dojo-attach-point\x3d"searchKeyInput" style\x3d"display:none;"\x3e\r\n      \x3cinput value\x3d"" placeholder\x3d"${jimuCommonNls.search}" data-dojo-type\x3d"dijit/form/ValidationTextBox"\r\n       data-dojo-attach-point\x3d"valueInput" data-dojo-props\x3d\'"required":false,intermediateChanges:true\' style\x3d"width:100%;" tabindex\x3d"0"/\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"items-content loading-center" data-dojo-attach-point\x3d"listContainer"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"listContentStore"style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\r\n      \x3c/div\x3e --\x3e\r\n      \x3cdiv class\x3d"jimu-multiple-items-list" data-dojo-attach-point\x3d"listContent" tabindex\x3d"0"\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"loadMoreDataBtn" class\x3d"jimu-list-multiple-select-Tips load-more-data-Tips"\x3e${jimuCommonNls.searchMore}\x3c/div\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"noDataTips" class\x3d"jimu-list-multiple-select-Tips no-data-Tips"\x3e${Nls.noData}\x3c/div\x3e --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"noDataTips" class\x3d"jimu-list-multiple-select-Tips no-data-Tips"\x3e${noDataNls}\x3c/div\x3e\r\n      \x3c!-- \x3cdiv class\x3d"createNewItem" data-dojo-attach-point\x3d"createNewItem" data-dojo-attach-event\x3d"click:_createTarget"\x3e\x26nbsp;\x3c/div\x3e --\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--\r\n  \x3cdiv class\x3d"selectedToggleDiv" style\x3d"display:none;" data-dojo-attach-point\x3d"selectedToggleDiv"\x3e\r\n    \x3cspan class\x3d"selectedToggle" data-dojo-attach-point\x3d"selectedToggle"\x3e\x3c/span\x3e\r\n    \x3cspan class\x3d"toggleTxt" title\x3d"${Nls.showSelected}"\x3e${Nls.showSelected}\x3c/span\x3e\r\n  \x3c/div\x3e\r\n  --\x3e\r\n\r\n  \x3cdiv class\x3d"selectedToggleDiv" style\x3d"display:none;" data-dojo-attach-point\x3d"selectedToggleDiv"\x3e\r\n      \x3cdiv class\x3d"showAllIcon iconHover jimu-flipx" title\x3d"${Nls.showAll}" data-dojo-attach-point\x3d"showAllIconBtn"  tabindex\x3d"0"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"showSelectedIcon jimu-flipx" title\x3d"${Nls.showSelected}" data-dojo-attach-point\x3d"showSelectedIconBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"clearAllSelectedIcon jimu-flipx" title\x3d"${Nls.unCheckAll}" data-dojo-attach-point\x3d"clearAllSelectedBtn" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/AdvancedListValueProvider.html":'\x3cdiv\x3e\r\n   \x3cdiv role\x3d"button" aria-haspopup\x3d"true" class\x3d"checkBtn" tabindex\x3d"0" data-dojo-attach-point\x3d"checkedBtn" style\x3d"display:none;" data-dojo-attach-event\x3d"click:_checkedBtnEvent"\x3e\r\n       \x3cspan class\x3d"screen-readers-only" data-dojo-attach-point\x3d"promptLabel"\x3e\x3c/span\x3e\r\n       \x3cdiv data-dojo-attach-point\x3d"checkedNumDiv" class\x3d"checkedNumDiv"\x3e\x3cspan class\x3d"checkedNum" data-dojo-attach-point\x3d"checkedNum"\x3e\x3c/span\x3e${CommonNls.selected}\x3c/div\x3e\r\n       \x3cdiv data-dojo-attach-point\x3d"checkedNameDiv" class\x3d"checkedNum checkedNameDiv jimu-ellipsis-Blanks"\x3e\x3c/div\x3e\r\n       \x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8 checkBtnDownIcon"\x3e\x3c/div\x3e\r\n   \x3c/div\x3e\r\n   \x3cdiv data-dojo-attach-point\x3d"listContent"\x3e\x3c/div\x3e\r\n   \x3cdiv class\x3d"value-multiple-popup" data-dojo-attach-point\x3d"listContentPopup"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"listContent"\x3e\x3c/div\x3e\r\n   \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/pageControlForQuery.html":'\x3cdiv class\x3d"pageControl pageItem"\x3e\r\n  \x3c!--\r\n  \x3cdiv data-dojo-attach-point\x3d"prevPage" class\x3d"pageBtn pageDisabled pageItem"\x3e\x3c-prevPage\x3c/div\x3e\r\n  \x3cdiv class\x3d"pageItem" data-dojo-attach-point\x3d"currentPage"\x3e1\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"nextPage" class\x3d"pageBtn pageItem"\x3enextPage-\x3e\x3c/div\x3e\r\n  --\x3e\r\n\r\n  \x3c!-- \x3cdiv data-dojo-attach-point\x3d"addNextPage"\x3eLoad more data(Test)\x3c/div\x3e --\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/PredefinedValueProvider.html":'\x3cdiv\x3e\r\n    \x3c!-- \x3cdiv data-dojo-attach-point\x3d"valueproviderStore" style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"jimu-filter-popup-btn jimu-not-selectable"\x3e\r\n      \x3cdiv class\x3d"predefined-btn"  data-dojo-attach-point\x3d\'indexBtn\'\x3e\r\n        \x3cdiv class\x3d"tip jimu-ellipsis" title\x3d"predefined" data-dojo-attach-point\x3d\'indexBtnTips\'\x3epredefined\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d\'valueProviderPopupNode\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/EditTable.html":'\x3cdiv\x3e\r\n    \x3cdiv class\x3d"jimu-multiple-set-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"" class\x3d"items-list-content items-list-header"  \x3e\r\n        \x3cdiv class\x3d"item"\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis" title\x3d"${Nls.value}"\x3e${Nls.value}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis" title\x3d"${CommonNls.label}"\x3e${CommonNls.label}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label checkboxHeader jimu-ellipsis" title\x3d"${CommonNls.defaults}"\x3e${CommonNls.defaults}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label lableR jimu-ellipsis" title\x3d"${CommonNls.actions}"\x3e${CommonNls.actions}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"listContent" class\x3d"items-list-content" data-dojo-attach-event\x3d"click:_onListContentClicked, dblclick:_onListContentDblClicked"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e',
"url:jimu/dijit/_filter/PredefinedValuePopup.html":'\x3cdiv\x3e\r\n   \x3c!--\r\n    \x3cselect data-dojo-attach-point\x3d"valProviderSelect" class\x3d"dijit-form-Select multiple-Select"  data-dojo-attach-event\x3d"onclick:_showPopup"\x3e\r\n    \x3c/select\x3e\r\n    --\x3e\r\n    \x3c!-- \x3cdiv class\x3d"subTitle"\x3e${CommonNls.layer}: \x3cspan data-dojo-attach-point\x3d"layerName"\x3e\x3c/span\x3e\x3c/div\x3e --\x3e\r\n    \x3cdiv class\x3d"jimu-filter-popup-btn jimu-not-selectable"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"listSelectStore" style\x3d"height:1px;visibility:hidden;overflow:hidden;"\x3e\x3c/div\x3e --\x3e\r\n\r\n      \x3c!-- for list select popup --\x3e\r\n      \x3c!-- \x3cdiv class\x3d"add-label-btn" data-dojo-attach-event\x3d"click:_showPopup"\x3e --\x3e\r\n      \x3c!-- for eidtTable --\x3e\r\n      \x3cdiv class\x3d"add-label-btn" data-dojo-attach-event\x3d"click:_createTarget"\x3e\r\n        \x3cdiv class\x3d"icon"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"tip"\x3e${CommonNls.add}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3c!--\r\n      \x3cdiv class\x3d"add-btn" data-dojo-attach-event\x3d"click:_showPopup"\x3e\r\n        \x3cdiv class\x3d"tip"\x3eopenLayer-temp\x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"add-btn add-btn-right" data-dojo-attach-event\x3d"click:_createTarget"\x3e\r\n        \x3cdiv class\x3d"tip"\x3e${CommonNls.add}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n       --\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"tableContent"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"displayTypes" data-dojo-attach-point\x3d"displayTypes" data-dojo-attach-event\x3d"click:_changeDisplayType"\x3e\r\n      \x3cdiv class\x3d"title jimu-ellipsis"\x3e${Nls.displayAs}\x3c/div\x3e\r\n      \x3cspan class\x3d"option dropdownOption"\x3e\r\n        \x3cdiv class\x3d"radio"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"label jimu-ellipsis"\x3e${Nls.aDrowdownList}\x3c/div\x3e\r\n      \x3c/span\x3e\r\n      \x3cspan class\x3d"option expandedOption"\x3e\r\n      \x3cdiv class\x3d"radio"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"label jimu-ellipsis"\x3e${Nls.aExpandedList}\x3c/div\x3e\r\n      \x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3c!--\r\n    \x3cdiv class\x3d"jimu-multiple-set-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"" class\x3d"items-list-content items-list-header"  \x3e\r\n        \x3cdiv class\x3d"item"\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis"\x3e${CommonNls.name}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label jimu-ellipsis"\x3e${CommonNls.label}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label checkboxHeader jimu-ellipsis" title\x3d"set default?"\x3e${CommonNls.defaults}\x3c/div\x3e\r\n          \x3cdiv class\x3d"label lableR jimu-ellipsis"\x3e${CommonNls.actions}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"listContent" class\x3d"items-list-content" data-dojo-attach-event\x3d"click:_onListContentClicked"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    --\x3e\r\n\r\n    \x3cdiv class\x3d"value-type-popup" data-dojo-attach-point\x3d"valuesPopupNode" style\x3d"display:none;"\x3e\r\n      \x3c!-- \x3cdiv data-dojo-attach-point\x3d"mutiValuesSelect" multiple\x3d"true" data-dojo-type\x3d"dojox/form/CheckedMultiSelect" data-dojo-props\x3d\'searchAttr:"label",required:false,intermediateChanges:true\' style\x3d"width:100%;" \x3e\x3c/div\x3e --\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"pageControlContainer"\x3eLoad more data\x3c/div\x3e\r\n\r\n    \x3c/div\x3e\r\n\r\n    \x3c!-- \x3ca data-dojo-attach-event\x3d"onclick:_setSelectType" class\x3d"popupOper" style\x3d"display:none;"\x3etype\x3c/a\x3e --\x3e\r\n  \x3c/div\x3e',
"url:dojox/form/resources/_CheckedMultiSelectMenuItem.html":'\x3ctr class\x3d"dijitReset dijitMenuItem" dojoAttachPoint\x3d"focusNode" role\x3d"menuitemcheckbox" tabIndex\x3d"-1"\r\n\tdojoAttachEvent\x3d"ondijitclick:_onClick"\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\r\n\t\t\x3e\x3cdiv src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitMenuItemIcon ${_iconClass}" dojoAttachPoint\x3d"iconNode"\r\n\t\t\t\x3e\x3cinput class\x3d"dojoxCheckedMultiSelectCheckBoxInput" dojoAttachPoint\x3d"inputNode" type\x3d"${_type.type}"\r\n\t\t/\x3e\x3c/div\x3e\x3c/td\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" dojoAttachPoint\x3d"containerNode,labelNode"\x3e\x3c/td\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" dojoAttachPoint\x3d"accelKeyNode"\x3e\x3c/td\r\n\t\x3e\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26nbsp;\x3c/td\r\n\x3e\x3c/tr\x3e',
"url:dojox/form/resources/_CheckedMultiSelectItem.html":'\x3cdiv class\x3d"dijitReset ${baseClass}"\r\n\t\x3e\x3cinput class\x3d"${baseClass}Box" data-dojo-type\x3d"dijit.form.CheckBox" data-dojo-attach-point\x3d"checkBox" \r\n\t\tdata-dojo-attach-event\x3d"_onClick:_changeBox" type\x3d"${_type.type}" data-dojo-props\x3d\'disabled:${disabled}, readOnly:${readOnly}\' baseClass\x3d"${_type.baseClass}"\r\n\t/\x3e\x3cdiv class\x3d"dijitInline ${baseClass}Label" data-dojo-attach-point\x3d"labelNode" data-dojo-attach-event\x3d"onclick:_onClick"\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dojox/form/resources/CheckedMultiSelect.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}"\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"comboButtonNode"\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"selectNode" class\x3d"dijit dijitReset dijitInline ${baseClass}Wrapper" data-dojo-attach-event\x3d"onmousedown:_onMouseDown,onclick:focus"\r\n\t\t\x3e\x3cselect class\x3d"${baseClass}Select dojoxCheckedMultiSelectHidden" multiple\x3d"true" data-dojo-attach-point\x3d"containerNode,focusNode"\x3e\x3c/select\r\n\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"wrapperDiv"\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',"url:jimu/dijit/_filter/NumberListValueProvider.html":'\x3cdiv\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"numberListTable" style\x3d"width:100%;border-collapse:collapse;"\r\n        cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n        \x3ctbody\x3e\r\n            \x3ctr\x3e\r\n                \x3ctd style\x3d"width:50%;"\x3e\r\n                    \x3cinput data-dojo-attach-point\x3d"_dijit1" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n                        data-dojo-props\x3d\'"required":false,constraints:{min:0,pattern:"#####0.##########"}\'\r\n                        style\x3d"width:100%;" /\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd\x3e\r\n                    \x3cselect data-dojo-attach-point\x3d"rangeSelect" data-dojo-type\x3d"dijit/form/Select"\r\n                        style\x3d"width:100%;" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n                        \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n                    \x3c/select\x3e\r\n                \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n        \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/_filter/DateIsInValueProvider.html":'\x3cdiv\x3e\r\n\t\x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"dateTypeSelect" class\x3d"date-type-select restrict-select-width" data-dojo-attach-event\x3d"change:_onDateTypeSelectChanged"\x3e\r\n\t\x3c/select\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/_SingleFilter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"settings-container"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"fieldsSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-props\x3d\'searchAttr:"displayName",required:true,intermediateChanges:true\' class\x3d"fields-select dijit-form-FilteringSelect"\x3e\x3c/div\x3e\r\n    \x3cselect data-dojo-attach-point\x3d"operatorsSelect" data-dojo-type\x3d"dijit/form/Select" class\x3d"operator-select dijit-form-Select restrict-select-width"\x3e\r\n      \x3coption value\x3d"none"\x3e${nls.none}\x3c/option\x3e\r\n    \x3c/select\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"attributeValueContainer" class\x3d"attribute-value-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"valueProviderContainer" class\x3d"value-provider-container"\x3e\x3c/div\x3e\r\n      \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"valueTypeSetNode" title\x3d"${nls.setInputType}" class\x3d"value-type-set jimu-icon jimu-icon-setting"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv role\x3d"button" tabindex\x3d"0" aria-label\x3d"\'${nls.deleteText}\'" class\x3d"jimu-icon jimu-icon-delete" data-dojo-attach-point\x3d"btnDelete"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv class\x3d"askvalues"\x3e\r\n    \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxAskValues" label\x3d"${nls.askForValues}" class\x3d"jimu-trailing-margin6"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"cbxCaseSensitive" label\x3d"${nls.caseSensitive}" style\x3d"display:none;"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"promptSection" class\x3d"prompt"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"promptTable" cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"prompt-table" style\x3d"width:100%;"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.prompt}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"promptTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"required:true,trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cspan\x3e${nls.hint}\x3c/span\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"hintTB" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"trim:true" style\x3d"width:257px;" class\x3d"dijit-form-ValidationTextBox" \x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"relativeDatesTr" class\x3d"relative-start-date-tr"\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"startDateOptions"\x3e${nls.dateOptions}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"custom_start_date" data-dojo-props\x3d\'title:"${nls.custom}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.custom}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"today_start_date" data-dojo-props\x3d\'title:"${nls.today}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.today}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"yesterday_start_date" data-dojo-props\x3d\'title:"${nls.yesterday}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.yesterday}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"tomorrow_start_date" data-dojo-props\x3d\'title:"${nls.tomorrow}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.tomorrow}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"relativeDatesTr" class\x3d"relative-end-date-tr"\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"endDateOptions"\x3e${nls.endDateOptions}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"custom_end_date" data-dojo-props\x3d\'title:"${nls.custom}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.custom}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"today_end_date" data-dojo-props\x3d\'title:"${nls.today}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.today}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"yesterday_end_date" data-dojo-props\x3d\'title:"${nls.yesterday}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.yesterday}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n\r\n            \x3cdiv class\x3d"showItems"\x3e\r\n              \x3cdiv class\x3d"opers" data-dojo-type\x3d"jimu/dijit/CheckBox" data-dojo-attach-point\x3d"tomorrow_end_date" data-dojo-props\x3d\'title:"${nls.tomorrow}"\'\x3e\x3c/div\x3e\r\n              \x3cspan\x3e${nls.tomorrow}\x3c/span\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"cascadeTr" class\x3d"cascade-tr"\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv style\x3d"margin-bottom:5px;"\x3e${nls.listValues}:\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"second-td"\x3e\r\n            \x3cselect data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"cascadeSelect" class\x3d"cascade-select restrict-select-width" style\x3d"width:100%;"\x3e\r\n              \x3coption value\x3d"none"\x3e${nls.noneCascadeFilterTip}\x3c/option\x3e\r\n              \x3coption value\x3d"previous"\x3e${nls.previousCascadeFilterTip}\x3c/option\x3e\r\n              \x3coption value\x3d"all"\x3e${nls.allCascadeFilterTip}\x3c/option\x3e\r\n            \x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_FilterSet.html":'\x3cdiv\x3e\r\n\t\x3ctable class\x3d"header-table" cellspacing\x3d"0" cellpadding\x3d"0"\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"allAnySelect"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"AND" selected\x3e${nls.matchMsgSetAll}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"OR"\x3e${nls.matchMsgSetAny}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"jimu-filter-set-delete"\x3e\r\n\t\t\t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"btnDelete" aria-label\x3d"\'${nls.deleteText}\'" class\x3d"jimu-icon jimu-icon-delete" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd class\x3d"jimu-filter-set-add"\x3e\r\n\t\t\t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"btnAdd" aria-label\x3d"\'${nls.addText}\'" class\x3d"jimu-icon jimu-icon-add" tabindex\x3d"0"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"allExpsBox" class\x3d"jimu-filter-exps-box"\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_SingleFilterParameter.html":'\x3cdiv\x3e\r\n  \x3ctable style\x3d"width:100%;"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"first-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"prompt" data-dojo-attach-point\x3d"promptNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"second-tr"\x3e\r\n        \x3ctd data-dojo-attach-point\x3d"valueProviderTd"\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"third-tr"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"hint" data-dojo-attach-point\x3d"hintNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"*now":function(r){r(['dojo/i18n!*preload*jimu/nls/main*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},
"*noref":1}});
define("./ConfigManager ./LayoutManager ./DataManager ./WidgetManager ./FeatureActionManager ./SelectionManager ./DataSourceManager ./FilterManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/keys dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query esri/config esri/request esri/urlUtils esri/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main esri/main dojo/ready".split(" "),function(r,f,l,p,c,q,n,k,h,t,e,b,m,a,g,d,u,v,B,
z,C,D,y,w,A,G,E,F,H,L){function N(){var a=window.location.search,b={query:!0};if(""===a)return{};var a=B.queryToObject(a.substr(1)),c;for(c in a)b[c]||(a[c]=A.sanitizeHTML(a[c]));return a}function M(a,b){J=a;"loadingPageChange"!==b&&h.setStyle(jimuConfig.mainPageId,"display","block")}u={};var J;window.topic=g;z.defaults.io.timeout=18E4;"function"!==typeof d.getAll&&(d.getAll=function(a){var b=[];(a=d(a))&&b.push(a);return b});window.jimuNls=F;window.apiNls=H.bundle;y.setProtocolErrorHandler(function(){return!0});
y=A.getAncestorWindow();var K=!1,O=/^http(s?):\/\//gi;try{K=0===y.location.href.indexOf("https://")}catch(Q){}C.setRequestPreCallback(function(a){a.content&&a.content.printFlag&&(a.timeout=3E5);K&&(a.url=a.url.replace(O,"//"));if(-1!==a.url.indexOf("/queryRelatedRecords?")){var b=a.url,c=z.defaults.io.proxyUrl;c&&0===a.url.indexOf(c+"?")&&(b=a.url.replace(c+"?",""));A.isHostedService(b)||(a.url=a.url.replace("FeatureServer","MapServer"))}/GPServer\/.+\/jobs/.test(a.url)&&(a.preventCache=(new Date).getTime());
window.isBuilder||!J||J.mode||(J.appProxies&&0<J.appProxies.length&&e.some(J.appProxies,function(b){var c=b.sourceUrl;b=b.proxyUrl;K&&(c=c.replace(O,"//"),b=b.replace(O,"//"));if(0<=a.url.indexOf(c))return a.url=a.url.replace(c,b),!0}),J.map.appProxy&&e.some(J.map.appProxy.proxyItems,function(b){if(!b.useProxy||!b.proxyUrl)return!1;var c=b.sourceUrl;b=b.proxyUrl;K&&(c=c.replace(O,"//"),b=b.replace(O,"//"));if(0<=a.url.indexOf(c))return a.url=a.url.replace(c,b),!0}));return a});b(window,"mousedown",
function(b){A.isInNavMode()&&(h.removeClass(document.body,"jimu-nav-mode"),window.isMoveFocusWhenInit=!1);if(a.isMiddle(b))return b.preventDefault(),b.stopPropagation(),b.returnValue=!1});b(window,"keydown",function(a){a.keyCode!==m.TAB||A.isInNavMode()||h.addClass(document.body,"jimu-nav-mode")});String.prototype.startWith=function(a){return this.substr(0,a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-a.length,a.length)===a?!0:!1};Number.isNaN=Number.isNaN||
function(a){return a!==a};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=t.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.16";window.productVersion="Online 8.1";window.isBuilder?(g.subscribe("app/appConfigLoaded",M),g.subscribe("app/appConfigChanged",M)):(g.subscribe("appConfigLoaded",M),g.subscribe("appConfigChanged",
M));if(t=A.has("ie"))9<t?h.addClass(document.body,"ie-nav-mode"):h.addClass(document.body,"ie-low-nav-mode"),10<t&&h.addClass(document.body,"ie-gte-10");u.initApp=function(){var a,b;console.log("jimu.js init...");a=N();if(a.mobileBreakPoint)try{b=parseInt(a.mobileBreakPoint,10),jimuConfig.breakPoints[0]=b}catch(R){console.error("mobileBreakPoint URL parameter must be a number.",R)}a.mode&&(h.setStyle(jimuConfig.loadingId,"display","none"),h.setStyle(jimuConfig.mainPageId,"display","block"));l.getInstance(p.getInstance());
c.getInstance();q.getInstance();n.getInstance();k.getInstance();b=f.getInstance({mapId:jimuConfig.mapId,urlParams:a},jimuConfig.layoutId);a=r.getInstance(a);b.startup();a.loadConfig();G(["dynamic-modules/preload"]);L(function(){setTimeout(function(){h.removeClass(document.body,"dj_a11y")},50)})};return u});