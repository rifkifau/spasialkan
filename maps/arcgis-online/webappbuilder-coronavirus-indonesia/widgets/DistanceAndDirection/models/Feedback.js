// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/Stateful dojo/_base/lang dojo/Deferred esri/toolbars/draw esri/geometry/Point esri/graphic esri/geometry/geometryEngineAsync esri/units esri/tasks/GeometryService esri/SpatialReference esri/request esri/tasks/ProjectParameters esri/geometry/webMercatorUtils".split(" "),function(m,n,f,h,p,l,q,r,c,t,k,u,v,e){return m([p,n],{startPoint:null,_setStartPoint:function(a){this._set("startPoint",a)},endPoint:null,_setEndPoint:function(a){this._set("endPoint",a)},lengthUnit:"meters",
_setLengthUnit:function(a){this._set("lengthUnit",a)},angleUnit:"degrees",_setAngle:function(a){this._set("angleUnit",a)},isDiameter:!0,canProjectLocally:!1,constructor:function(){r.isSimple(new l({x:-122.65,y:45.53,spatialReference:{wkid:4326}}))},initGeometryService:function(){var a=this.appConfig.geometryService;a||(a="//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer");this.geomService=new t(a);a=new l({x:0,y:0,spatialReference:this.map.spatialReference});e.canProject(a,
new k(3857))&&(this.canProjectLocally=!0)},getRadiusUnitType:function(){var a=c.METERS;switch(this.lengthUnit){case "meters":a=c.METERS;break;case "feet":a=c.FEET;break;case "kilometers":a=c.KILOMETERS;break;case "miles":a=c.MILES;break;case "nautical-miles":a=c.NAUTICAL_MILES;break;case "yards":a=c.YARDS}return a},addStartGraphic:function(a,b){this.removeStartGraphic();this.startGraphic=new q(a,b);this.map.graphics.add(this.startGraphic)},removeStartGraphic:function(){this.startGraphic&&this.map.graphics.remove(this.startGraphic);
this.startGraphic=null},_processAfterMapClick:function(a){var b=new h;4326!==a.spatialReference.wkid?this.getDDPoint(a).then(f.hitch(this,function(a){b.resolve(a)}),function(a){b.reject(a)}):b.resolve(a);return b},getDDPoint:function(a){var b=new h,g=new k(3857);e.canProject(a,g)?b.resolve(e.webMercatorToGeographic(e.project(a,g))):(new u({url:this.geomService.url+"/findTransformations",content:{f:"json",inSR:a.spatialReference.wkid,outSR:4326},handleAs:"json",callbackParamName:"callback"},{usePost:!1})).then(f.hitch(this,
function(d){d=d&&d.transformations?d.transformations:void 0;this.projectPointForDD(b,a,4326,d&&0<d.length?d[0].wkid:void 0)}),f.hitch(this,function(){this.projectPointForDD(b,a,4326,null)}));return b},projectPointForDD:function(a,b,g,d){var c=new v;c.outSR=new k(g);c.geometries=[b];d&&(c.transformForward=!0,c.transformation=d);this.geomService.project(c,f.hitch(this,function(b){a.resolve(b[0])}),function(b){a.reject(b)})},getProjectedGeometry:function(a,b){var c,d;c=new h;e.canProject(a,b)?(d=e.project(a,
b),c.resolve(d)):this.geomService.project([a],b,function(a){d=a[0];c.resolve(d)});return c.promise}})});