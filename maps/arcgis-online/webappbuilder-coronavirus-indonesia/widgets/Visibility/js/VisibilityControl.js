// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Visibility/templates/VisibilityControl.html":'\x3cdiv\x3e\r\n\x3cdiv data-dojo-attach-point\x3d"visibiltyWidget"\x3e\r\n    \x3cdiv class\x3d"esriCTFullWidth esriCTNewHeader"\x3e\r\n\x3c!-- Panel Title --\x3e\r\n\x3cdiv class\x3d"esriCTMainTitleDiv esriCTEllipsis" title\x3d"${nls.mainPageTitle}"\x3e\r\n  ${nls.mainPageTitle}\r\n  \x3c/div\x3e\r\n  \x3c!-- Settings Icon --\x3e\r\n  \x3cdiv class\x3d"esriCTSaveToLayerIcon esriCTPointer esriCTHidden" title\x3d"${nls.resultsTitle}" tabindex\x3d"0"  role\x3d\'button\' aria-label\x3d\'${nls.resultsTitle}\' data-dojo-attach-point\x3d"saveToLayerIcon"\x3e\x3c/div\x3e\r\n\r\n  \x3clabel data-dojo-attach-point\x3d"errorText" style\x3d"display: none"\x3e\x3c/label\x3e\r\n  \x3cdiv class\x3d"controls" data-dojo-attach-point\x3d"controls"\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"observerCoordsContainer"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel class\x3d"titleLabel" data-dojo-attach-point\x3d"FOVLabel"\x3e${nls.fieldOfView}\x3c/label\x3e\r\n      \x3cdiv class\x3d"center" data-dojo-attach-point\x3d"FOVGroup"\x3e\r\n        \x3cinput type\x3d"text" value\x3d"360" class\x3d"fov" data-displayInput\x3d"true" data-cursor\x3d"true" disabled\x3d"true"\r\n          data-dojo-attach-point\x3d"FOVInput" aria-label\x3d"${nls.fieldOfView}" /\x3e\r\n        \x3cp class\x3d"cursortooltip" data-dojo-attach-point\x3d"tooltip" hidden\x3d\'true\'\x3e\x3c/p\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3cinput class\x3d"switch-toggle" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-attach-point\x3d"angleUnits" checked\x3d"false" aria-label\x3d"${nls.useMilsText}"/\x3e\r\n      \x3clabel class\x3d"titleLabel"\x3e${nls.useMilsText}\x3c/label\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel class\x3d"titleLabel"\x3e${nls.observerHeight}\x3c/label\x3e\r\n      \x3cdiv\x3e\r\n        \x3cinput class\x3d"inputNumberTextbox" data-dojo-type\x3d\'dijit/form/NumberTextBox\' required\x3d"true" value\x3d"2"\r\n          data-dojo-props\x3d\'\r\n          constraints: {min: 0},\r\n          invalidMessage: "${nls.invalidMessage}",\r\n          rangeMessage: "${nls.observerRangeMessage}"\'\r\n          data-dojo-attach-point\x3d"observerHeight" aria-label\x3d"${nls.observerHeight}"\x3e\r\n        \x3cselect style\x3d"width: 100px" class\x3d"controlSpace noResize" data-dojo-type\x3d"jimu/dijit/formSelect"\r\n          data-dojo-attach-point\x3d"observerHeightDD" aria-label\x3d"${nls.observerHeight}"\x3e\r\n        \x3c/select\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel class\x3d"titleLabel"\x3e${nls.minObsDistance}\x3c/label\x3e\r\n      \x3cdiv\x3e\r\n        \x3cinput class\x3d"inputNumberTextbox" data-dojo-type\x3d\'dijit/form/NumberTextBox\' required\x3d"true" value\x3d"3"\r\n          data-dojo-props\x3d\'constraints: {min: 0}\' data-dojo-attach-point\x3d"minObsRange" aria-label\x3d"${nls.minObsDistance}"\x3e\r\n        \x3cselect style\x3d"width: 100px" class\x3d"controlSpace noResize" data-dojo-type\x3d"jimu/dijit/formSelect"\r\n          data-dojo-attach-point\x3d"distanceUnitDD" aria-label\x3d"${nls.minObsDistance}"\x3e\r\n        \x3c/select\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"controlGroup"\x3e\r\n      \x3clabel class\x3d"titleLabel"\x3e${nls.maxObsDistance}\x3c/label\x3e\r\n      \x3cdiv\x3e\r\n        \x3cinput class\x3d"inputNumberTextbox" data-dojo-type\x3d\'dijit/form/NumberTextBox\' required\x3d"true" value\x3d"5"\r\n          data-dojo-props\x3d\'constraints: {min: 0}\' data-dojo-attach-point\x3d"maxObsRange" aria-label\x3d"${nls.maxObsDistance}"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"buttonContainer" data-dojo-attach-point\x3d"buttonContainer"\x3e\r\n      \x3cdiv class\x3d"btnContainer HalfWidthLeft"\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"btnCreate" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.createBtn}"\x3e${nls.createBtn}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"btnContainer HalfWidthRight"\x3e\r\n        \x3cdiv class\x3d"jimu-btn controlSpace" data-dojo-attach-point\x3d"btnClear" tabindex\x3d"0" role\x3d"button" aria-label\x3d"${nls.clearBtn}"\x3e${nls.clearBtn}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n\x3c/div\x3e\r\n\x3cdiv class\x3d"esriCTHidden" data-dojo-attach-point\x3d"portalPublishContainer"\x3e\x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/_base/kernel dojo/_base/event dojo/Deferred dojo/_base/lang dojo/_base/array dojo/on dojo/number dojo/string dojo/dom-style dojo/mouse dojo/promise/all dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!../templates/VisibilityControl.html jimu/dijit/Message esri/dijit/util/busyIndicator esri/graphic esri/layers/GraphicsLayer esri/tasks/FeatureSet esri/graphicsUtils esri/symbols/SimpleFillSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleMarkerSymbol esri/renderers/SimpleRenderer esri/Color esri/dijit/analysis/CreateViewshed esri/layers/FeatureLayer esri/geometry/Polygon esri/geometry/geometryEngine ./geometryUtils jimu/dijit/CoordinateControl ./util jimu/utils dojo/keys dijit/focus ./portal-publish dojo/dom-class dojo/dom-construct esri/renderers/UniqueValueRenderer jimu/LayerStructure dijit/form/NumberTextBox jimu/dijit/CheckBox ./jquery.knob.min".split(" "),
function(C,F,G,y,c,m,e,H,I,r,u,J,K,L,M,N,z,O,n,D,P,E,v,g,Q,R,k,S,T,A,p,t,U,V,w,q,B,W,l,X,Y,Z){return C([K,L,M],{templateString:N,baseClass:"jimu-widget-visibility-control",FOV:180,LA:180,map:null,_currentOpenPanel:"mainPage",portalPublishObj:null,_renderer:null,Azimuth1:null,Azimuth2:null,graphics:null,_layerList:null,constructor:function(a){C.safeMixin(this,a);this.nls=a.nls},postCreate:function(){this.openAtStartAysn=!0;var a=[],b;m.forEach("meters kilometers miles feet yards nauticalMiles".split(" "),
c.hitch(this,function(f){b={value:f,label:window.jimuNls.units[f]};a.push(b)}));this.observerHeightDD.addOption(a);this.utils=new V({appConfig:this.appConfig,nls:this.nls});this.distanceUnitDD.addOption(c.clone(a));this.observerHeightDD.set("value",this.config.defaultObserverHeightUnit);this.distanceUnitDD.set("value",this.config.defaultObservableDistanceUnit);this.angleUnits.setValue(this.config.defaultAngleUnits);if(this.portalUrl){this._setUpSymbology();this._createRenderer();this._layerList=this._getAllMapLayers();
var f=new R(this._ptSym);this._observerLocation=new D({id:"observerLocation"});this._observerLocation.spatialReference=this.map.spatialReference;this._observerLocation.setRenderer(f);this.map.addLayer(this._observerLocation);this.distanceUnit=this.distanceUnitDD.get("value");this.observerHeightUnit=this.observerHeightDD.get("value");this.inputControl=new U({parentWidget:this.parentWidget,label:this.nls.observerLocation,input:!0,showCopyButton:!1,showFormatButton:!0,showDrawPoint:!0,drawButtonLabel:this.nls.addPointToolTip,
graphicsLayer:this._observerLocation});this.inputControl.placeAt(this.observerCoordsContainer);this.inputControl.startup();this._initGL();this._syncEvents();this.minObsRange.invalidMessage=this.nls.invalidMessage;this.minObsRange.rangeMessage=this.nls.minimumRangeMessage;this.maxObsRange.invalidMessage=this.nls.invalidMessage;this.maxObsRange.rangeMessage=this.nls.maximumRangeMessage}else this._showPortalURLError(this.nls.portalURLError);this.resetInputColor();this._suppoprtAccessibility()},startup:function(){this.busyIndicator=
O.create({target:this.domNode.parentNode.parentNode.parentNode,backgroundOpacity:0});this.FOVInput.id="fovinput"+this.parentWidget.id;var a=c.hitch(this,function(a,f,d){this.LA=this.angleUnits.checked?a/17.777777777778:a;this.FOV=Math.round(f);this.tooltip.innerHTML=360===d&&this.angleUnits.checked?$("#"+this.FOVInput.id).val()+" "+this.nls.milsLabel:this.angleUnits.checked?d+" "+this.nls.milsLabel:d+" "+this.nls.degreesLabel});$("#"+this.FOVInput.id).knob({min:0,max:360,cursor:360,width:160,height:160,
draw:function(){a(this.v,this.o.cursor,this.cv);window.isRTL&&this.i.css({"margin-right":"-"+(3*this.w/4+2>>0)+"px","margin-left":"auto"})}})},destroy:function(){this.map.removeLayer(this._observerLocation);this.map.removeLayer(this.graphicsLayer)},_showPortalURLError:function(a){r.set(this.controls,"display","none");r.set(this.buttonContainer,"display","none");this.errorText.innerHTML=a;r.set(this.errorText,"display","")},_setUpSymbology:function(){this._ptSym=new Q(this.pointSymbol);this.visibleArea=
new v;this.visibleArea.setOutline(new g(g.STYLE_SOLID,new k([0,0,0,0]),1));this.visibleArea.setColor(new k([0,255,0,.5]));this.notVisibleArea=new v;this.notVisibleArea.setOutline(new g(g.STYLE_SOLID,new k([0,0,0,0]),1));this.notVisibleArea.setColor(new k([255,0,0,.5]));this.fullWedge=new v;this.fullWedge.setOutline(new g(g.STYLE_DASH,new k([0,0,0,1]),1));this.fullWedge.setColor(new k([0,0,0,0]));this.wedge=new v;this.wedge.setOutline(new g(g.STYLE_SOLID,new k([255,0,0,1]),1));this.wedge.setColor(new k([0,
0,0,0]))},_initGL:function(){this.graphicsLayer=new D;this.graphicsLayer.name="Viewshed Layer";this.map.addLayer(this.graphicsLayer)},_syncEvents:function(){this.own(e(this.btnCreate,"click",c.hitch(this,this.createButtonWasClicked)),e(this.btnCreate,"keydown",c.hitch(this,function(a){a.keyCode!==q.ENTER&&a.keyCode!==q.SPACE||this.createButtonWasClicked()})),e(this.btnClear,"click",c.hitch(this,function(){l.add(this.saveToLayerIcon,"esriCTHidden");this.onClearBtnClicked();this._suppoprtAccessibility()})),
e(this.btnClear,"keydown",c.hitch(this,function(a){if(a.keyCode===q.ENTER||a.keyCode===q.SPACE)l.add(this.saveToLayerIcon,"esriCTHidden"),this.onClearBtnClicked(),this._suppoprtAccessibility()})),e(this.minObsRange,"keyup",c.hitch(this,this.minObsRangeKeyWasPressed)),e(this.FOVInput,"mousemove",c.hitch(this,this.mouseMoveOverFOVInput)),e(this.FOVInput,u.leave,c.hitch(this,this.mouseMoveOutFOVInput)),e(this.FOVGroup,u.leave,c.hitch(this,function(){this.tooltip.hidden=!0})),e(this.FOVGroup,u.enter,
c.hitch(this,this.mouseMoveOverFOVGroup)),e(this.FOVInput,u.enter,c.hitch(this,function(){this.tooltip.hidden=!0})),e(this.FOVInput,"keypress",c.hitch(this,function(a){isNaN(a.key)&&13!==a.charCode&&G.stop(a)})),this.angleUnits.on("change",c.hitch(this,this.angleUnitsDidChange)),this.observerHeightDD.on("change",c.hitch(this,this.distanceUnitDDDidChange)),this.distanceUnitDD.on("change",c.hitch(this,this.distanceUnitDDDidChange)),e(this.inputControl.dt,"DrawComplete",c.hitch(this,function(){this.feedbackDidComplete();
B.focus(this.inputControl.coordtext)})),e(this.inputControl,"get-coordinate-complete",c.hitch(this,this.feedbackDidComplete)));e(this.saveToLayerIcon,"click",c.hitch(this,function(){l.contains(this.saveToLayerIcon,"esriCTHidden")||this._showPanel("publishPage")}));e(this.saveToLayerIcon,"keydown",c.hitch(this,function(a){if(a.keyCode===q.ENTER||a.keyCode===q.SPACE)l.contains(this.saveToLayerIcon,"esriCTHidden")||this._showPanel("publishPage")}))},minObsRangeKeyWasPressed:function(){this.minObsRange.isValid()&&
(this.maxObsRange.constraints.min=Number(this.minObsRange.displayedValue)+.001,this.maxObsRange.set("value",Number(this.minObsRange.displayedValue)+1))},mouseMoveOverFOVGroup:function(){!1===this.FOVInput.disabled&&(this.mouseMoveOverFOVInput(),this.tooltip.hidden=!1)},mouseMoveOverFOVInput:function(){var a=this.tooltip;!1===this.FOVInput.disabled&&$(document).ready(function(){$(document).mousemove(function(b){r.set(a,{left:b.pageX+10+"px",top:b.pageY+10+"px"})})})},mouseMoveOutFOVInput:function(){this.tooltip.hidden=
!1;this.FOVInput.blur()},angleUnitsDidChange:function(){this.angleUnits.checked?($("#"+this.FOVInput.id).trigger("configure",{max:6400,units:"mils",milsValue:6400}),$("#"+this.FOVInput.id).val(6400).trigger("change")):($("#"+this.FOVInput.id).trigger("configure",{max:360,units:"degrees",milsValue:6400}),$("#"+this.FOVInput.id).val(360).trigger("change"));this.resetInputColor()},distanceUnitDDDidChange:function(){var a="",b={};this.distanceUnit=this.distanceUnitDD.get("value");this.observerHeightUnit=
this.observerHeightDD.get("value");if(this.distanceUnit){switch(this.distanceUnit){case "miles":b.max=31;break;case "nauticalMiles":b.max=26.9383;break;case "kilometers":b.max=50;break;case "yards":b.max=54680;break;case "feet":b.max=164041;break;case "meters":b.max=5E4}a=I.substitute(this.nls.maximumRangeMessage,{units:window.jimuNls.units[this.distanceUnit],limit:H.format(b.max,{places:2,locale:F.locale})});b.min=Number(this.minObsRange.displayedValue)+.001;this.maxObsRange.set("constraints",b);
this.maxObsRange.set("rangeMessage",a)}},feedbackDidComplete:function(){this.inputControl.deactivateDrawTool();this.map.enableMapNavigation();this.enableFOVDial()},enableFOVDial:function(){this.FOVInput.disabled&&(this.FOVInput.disabled=!1,$("#"+this.FOVInput.id).trigger("configure",{fgColor:"#00ff66",bgColor:"#f37371",inputColor:"#ccc"}));this.resetInputColor()},_createWedgesUsingBuffers:function(a,b,f,d){b=E.getGeometries(b);d=p.geodesicBuffer(b,[d],"meters",!0);0<f?(f=p.geodesicBuffer(b,[f],"meters",
!0),d=p.difference(d[0],f[0])):d=d[0];a.resolve([d,d])},_createWedgesUsingAngles:function(a,b,f,d,c,x){var e,h,g;b=b.geometry;e=[];h=[];this.Azimuth1=f>d?f-360:f;x=t.getPointsForArc(f,d,b,x);h.push([b.x,b.y]);m.forEach(x,function(a){h.push([a.x,a.y])});h.push([b.x,b.y]);0<c?(g=t.getDestinationPoint(b,f,c),f=t.getPointsForArc(f,d,b,c),e.push([g.x,g.y]),m.forEach(x,function(a){e.push([a.x,a.y])}),f.reverse(),m.forEach(f,function(a){e.push([a.x,a.y])}),e.push([g.x,g.y])):e=h;f=new A(e);f.setSpatialReference(b.spatialReference);
d=new A(h);d.setSpatialReference(b.spatialReference);a.resolve([f,d])},_createWedges:function(a,b,f){var d=new y;this.Azimuth1=parseInt(this.LA-this.FOV/2,10);0>this.Azimuth1&&(this.Azimuth1+=360);this.Azimuth2=parseInt(this.LA+this.FOV/2,10);360<this.Azimuth2&&(this.Azimuth2-=360);360===this.FOV?(this.Azimuth1=0,this.Azimuth2=360,this._createWedgesUsingBuffers(d,a,b,f)):this._createWedgesUsingAngles(d,a[0],this.Azimuth1,this.Azimuth2,b,f);return d.promise},_getFeatureCollectionLayer:function(a){m.forEach(a,
c.hitch(this,function(a,f){a.attributes={};a.attributes.ObjectID=f}));return new T({featureSet:{features:a,geometryType:"esriGeometryPoint"},layerDefinition:{name:"InputLayer",geometryType:"esriGeometryPoint",objectIdField:"ObjectID",fields:[{name:"ObjectID",alias:"ObjectID",type:"esriFieldTypeOID"}]}})},_initAnalysisProcess:function(a){this._createWedges(a.InputObserver.features,a.MinimumRadius,a.MaximumRadius).then(c.hitch(this,function(b){var f,d=[],e;b&&2===b.length&&(e=this.appConfig.geometryService,
f=t.getProjectedGeometry(b[0],this.map.spatialReference,e).then(c.hitch(this,function(a){this._wedgeGeometry=a})),d.push(f),b=t.getProjectedGeometry(b[1],this.map.spatialReference,e).then(c.hitch(this,function(a){this._fullWedgeGeometry=a})),d.push(b),J(d).then(c.hitch(this,function(){this._createViewShed(a)})))}))},_createViewShed:function(a){a={portalUrl:this.portalUrl,inputLayer:this._getFeatureCollectionLayer(a.InputObserver.features),maxDistanceUnits:"Meters",maximumDistance:a.MaximumRadius,
observerHeightUnits:"Meters",observerHeight:a.ObserverHeight,showSelectAnalysisLayer:!1,targetHeightUnits:"Meters",map:this.map,showChooseExtent:!1,returnFeatureCollection:!0};a=new S(a);a.startup();a.on("job-result",c.hitch(this,this._onViewShedCreated));a.on("job-status",c.hitch(this,function(a){"esriJobFailed"===a.jobStatus&&this._showJobError(a)}));a.on("job-fail",c.hitch(this,this._showJobError));a._form.validate()?(this.busyIndicator.show(),a._handleSaveBtnClick()):new z({message:this.nls.validationError})},
_showJobError:function(a){new z({message:a.message});this.busyIndicator.hide()},_onViewShedCreated:function(a){var b=[];m.forEach(a.value.featureSet.features,c.hitch(this,function(a){a=new A(a.geometry);a.setSpatialReference(this.map.spatialReference);(a=p.difference(this._wedgeGeometry,a))&&(a=p.difference(this._wedgeGeometry,a));a=new n(a,this.visibleArea);b.push(a)}));this._showGraphicsOnMap(b)},_drawWedge:function(a,b){for(var f=new y,d=0,c=a.length;d<c;d++){var e=a[d];e&&e.geometry&&(e.setSymbol(b),
this.graphicsLayer.add(e))}f.resolve("success");return f.promise},_drawViewshed:function(a){var b,c,d,e=new y;this.graphics=[];d=new n(this._wedgeGeometry,this.notVisibleArea);d.setAttributes({type:0});this.graphicsLayer.add(d);for(var g=0,k=a.length;g<k;g++){var h=a[g];h&&h.geometry&&(b=h.geometry,h.setSymbol(this.visibleArea),h.setAttributes({type:1}),c=h,this.graphicsLayer.add(h))}b&&(this.graphics.push(c),a=p.difference(this._wedgeGeometry,b),d=new n(a,this.notVisibleArea),d.setAttributes({type:0}));
this.graphics.push(d);e.resolve("success");return e.promise},_showGraphicsOnMap:function(a){this._drawWedge([new n(this._fullWedgeGeometry)],this.fullWedge);this._drawWedge([new n(this._wedgeGeometry)],this.wedge);this._drawViewshed(a).then(c.hitch(this,function(){this.map.setExtent(E.graphicsExtent(this.graphicsLayer.graphics),!0);l.remove(this.saveToLayerIcon,"esriCTHidden");this.busyIndicator.hide();this._createPortalPublishUI();this._suppoprtAccessibility()}))},createButtonWasClicked:function(){if(this.minObsRange.isValid()&&
this.maxObsRange.isValid()&&this.observerHeight.isValid()&&0!==parseInt(this.FOVInput.value,10)){var a=new n(this.inputControl.getMapCoordinateDD()),b=new P;b.features=[a];a={InputObserver:b,MinimumRadius:this.utils.convertToMeters(this.minObsRange.value,this.distanceUnit),MaximumRadius:this.utils.convertToMeters(this.maxObsRange.value,this.distanceUnit),ObserverHeight:this.utils.convertToMeters(this.observerHeight.value,this.observerHeightUnit)};this._initAnalysisProcess(a)}else new z({message:this.nls.validationError})},
onClearBtnClicked:function(){this.angleUnits&&(this.angleUnits.setValue(this.config.defaultAngleUnits),this.observerHeightDD.set("value",this.config.defaultObserverHeightUnit),this.distanceUnitDD.set("value",this.config.defaultObservableDistanceUnit),this.graphicsLayer.clear(),this.inputControl.clear(),this.FOVInput.disabled=!0,this.angleUnitsDidChange(),$("#"+this.FOVInput.id).trigger("configure",{fgColor:"#ccc",bgColor:"#ccc",inputColor:"#ccc"}),this.tooltip.hidden=!0,this.resetInputColor())},resetInputColor:function(){setTimeout(c.hitch(this,
function(){r.set(this.FOVInput,"color","gray")}),100)},_suppoprtAccessibility:function(){"mainPage"===this._currentOpenPanel&&(l.contains(this.saveToLayerIcon,"esriCTHidden")?(w.initFirstFocusNode(this.parentWidget.domNode,this.inputControl.coordtext),w.isAutoFocusFirstNodeWidget(this)&&B.focus(this.inputControl.coordtext)):(w.initFirstFocusNode(this.parentWidget.domNode,this.saveToLayerIcon),B.focus(this.saveToLayerIcon)),w.initLastFocusNode(this.parentWidget.domNode,this.btnClear));"publishPage"===
this._currentOpenPanel&&this.portalPublishObj._setFirstLastFocusNodes()},_createPortalPublishUI:function(){this.portalPublishObj=new W({config:this.config,appConfig:this.appConfig,graphicsLayer:this.graphicsLayer,graphics:this.graphics,_renderer:this._renderer,map:this.map,nls:this.nls,parentNode:this.parentWidget.domNode,observerHeight:this.observerHeight.value,minObsRange:this.minObsRange.value,maxObsRange:this.maxObsRange.value,distanceUnitDD:this.distanceUnitDD.getOptions(this.distanceUnitDD.value).label,
observerHeightDD:this.observerHeightDD.getOptions(this.observerHeightDD.value).label,angleUnits:this.nls.degreesLabel,centerPoint:this.inputControl.coordtext.value,fovStartAngle:this.Azimuth1,fovEndAngle:this.Azimuth2,_layerList:this._layerList});X.empty(this.portalPublishContainer);this.portalPublishObj.placeAt(this.portalPublishContainer);this.portalPublishObj.startup();this.own(e(this.portalPublishObj,"displayMainPageOnBack",c.hitch(this,function(){this._showPanel("mainPage")})));this._showPanel("publishPage")},
_showPanel:function(a){var b;this._currentOpenPanel&&(b=this._getNodeByName(this._currentOpenPanel),l.add(b,"esriCTHidden"));b=this._getNodeByName(a);l.remove(b,"esriCTHidden");this._lastOpenPanel=this._currentOpenPanel;this._currentOpenPanel=a;this._suppoprtAccessibility()},_getNodeByName:function(a){var b;switch(a){case "mainPage":b=this.visibiltyWidget;break;case "publishPage":b=this.portalPublishContainer}return b},_createRenderer:function(){this._renderer=new Y({type:"uniqueValue",field1:"RegionType",
uniqueValueInfos:[{value:1,symbol:{color:[0,255,0,128],outline:{color:[0,0,0,0],width:.75,type:"esriSLS",style:"esriSFSSolid"},type:"esriSFS",style:"esriSFSSolid"}},{value:0,symbol:{color:[255,0,0,128],outline:{color:[0,0,0,0],width:1,type:"esriSLS",style:"esriSFSSolid"},type:"esriSFS",style:"esriSFSSolid"}}]});this._renderer.removeValue("others")},_getAllMapLayers:function(){var a=[];Z.getInstance().traversal(function(b){"undefined"!==typeof b._layerInfo.layerObject.type&&-1===b._layerInfo.layerObject.type.indexOf("tile")&&
"esriGeometryPolygon"===b._layerInfo.layerObject.geometryType&&a.push(b._layerInfo.layerObject)});return a}})});