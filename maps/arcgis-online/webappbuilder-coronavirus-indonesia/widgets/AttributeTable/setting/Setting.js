// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/AttributeTable/utils":function(){define("dojo/_base/lang dojo/_base/array jimu/LayerInfos/LayerInfos dojo/Deferred dojo/promise/all exports dojo/store/Observable dojo/store/Cache dojo/store/Memory esri/lang ./table/FeatureLayerQueryStore jimu/ArcadeUtils jimu/utils esri/graphic dojo/i18n!./nls/strings".split(" "),function(f,m,t,n,e,c,g,l,y,A,u,p,v,w,B){function z(b,a){if(!b||!b.length)return a||[];if(!a||!a.length)return b;for(var d=[],h=0,k=b.length;h<k;h++)for(var q=b[h],
c=0,g=a.length;c<g;c++){var e=a[c];if(e.name===q.name){e.alias!==q.alias&&(q.alias=e.alias);d.push(q);break}}return d}c.readLayerInfosObj=function(b){return t.getInstance(b,b.itemInfo)};c.readLayerInfosFromMap=function(b,a,d){var h=new n;t.getInstance(b,b.itemInfo).then(f.hitch(this,function(k){var b=[];a?k.traversalLayerInfosOfWebmap(function(a){b.push(a)}):k.traversal(function(a){b.push(a)});if(d){var c=[],g=k.getMapNotesLayerInfoArray();m.forEach(g,function(a){c.push(a.id);a.traversal(function(a){c.push(a.id)})});
b=m.filter(b,function(a){return-1===c.indexOf(a.id)})}k=k.getTableInfoArray();b=b.concat(k);h.resolve(b)}),f.hitch(this,function(a){console.error(a);h.reject(a)}));return h.promise};c.generateColumnsFromFields=function(b,a,d,h,k,q,g,e){function y(a){var b=a.name;if(r&&A.isDefined(r.fieldInfos))for(var d=0,k=r.fieldInfos.length;d<k;d++){var h=r.fieldInfos[d];if(h.fieldName===b&&h.format)return h.format}return(a=v.getDefaultPortalFieldInfo(a))&&a.format?a.format:null}var r=a.getPopupInfo()||a.getPopupInfoFromLayerObject&&
a.getPopupInfoFromLayerObject(),x={selectionHandle:{label:"",className:"selection-handle-column",hidden:!1,unhidable:!0,field:null,sortable:!1,_cache:{sortable:!1,statistics:!1},renderCell:function(a,b,d){d.setAttribute("role","button");d.setAttribute("title",B.selectionHandleLabel)}}};m.forEach(d,f.hitch(c,function(d,r,l){r="field"+r;var C=!!d.domain,w="esriFieldTypeDate"===d.type,B=h&&d.name===h,n="esriFieldTypeDouble"===d.type||"esriFieldTypeSingle"===d.type||"esriFieldTypeInteger"===d.type||"esriFieldTypeSmallInteger"===
d.type,p="esriFieldTypeString"===d.type,t=0===d.name.indexOf("expression/"),u=d.alias||d.name,z;z=1===l.length?!1:b&&b[r]?b[r].hidden:d?!d.show&&A.isDefined(d.show):!1;x[r]={label:u,className:r,hidden:z,unhidable:1===l.length?!1:!d.show&&A.isDefined(d.show)&&d._pk,field:d.name,sortable:!1,_cache:{sortable:!!q,statistics:g&&!C&&n}};p?x[r].formatter=f.hitch(c,c.urlFormatter):w?x[r].formatter=f.hitch(c,c.dateFormatter,y(d)):n&&(x[r].formatter=f.hitch(c,c.numberFormatter,y(d)));C?x[r].get="range"===(d.domain&&
d.domain.type)?f.hitch(c,function(a,d,b){return this.getRangeDomainValue(d.name,b)},e,d):f.hitch(c,function(a,d,b){return this.getCodeValue(a,d.name,b)},e,d):B?x[r].get=f.hitch(c,function(a,d,b){return this.getTypeName(b[a.name],d)},d,k):t?(l=this.arcade.getExpressionInfosFromLayerInfo(a),C=v.getFeatureLayerDefinition(e),x[r]._cache.sortable=!1,x[r].get=f.hitch(c,function(a,d,b,h){return this.arcade.getAttributes(h,a,b)[d.name]||""},l,d,C)):C||w||B||t||(x[r].get=f.hitch(c,function(a,d,b,h,k){var q=
null;b&&h&&0<h.length&&(h=(h=m.filter(h,f.hitch(c,function(a){return a.id===k[b]})))&&h[0]||null)&&h.domains&&h.domains[d.name]&&h.domains[d.name].codedValues&&(q=this.getCodeValue(a,d.name,k));return(a=null!==q?q:k[d.name])||isFinite(a)?a:""},e,d,h,k))}));return x};c.getTypeName=function(b,a){return v.fieldFormatter.getTypeName(b,a)};c.getCodeValue=function(b,a,d){return(b=v.getDisplayValueForCodedValueOrSubtype(b,a,d))&&b.isCodedValueOrSubtype?b.displayValue||"":""};c.getRangeDomainValue=function(b,
a){return(b=a[b])?b:""};c.urlFormatter=function(b){return v.fieldFormatter.getFormattedUrl(b)};c.dateFormatter=function(b,a){return v.fieldFormatter.getFormattedDate(a,b)};c.numberFormatter=function(b,a){return v.fieldFormatter.getFormattedNumber(a,b)};c.readLayerObjectsFromMap=function(b,a,d){var h=new n,k=[];this.readLayerInfosFromMap(b,a,d).then(f.hitch(this,function(a){m.forEach(a,f.hitch(this,function(a){k.push(a.getLayerObject())}));e(k).then(f.hitch(this,function(a){h.resolve(a)}),f.hitch(this,
function(a){h.reject(a);console.error(a)}))}),f.hitch(this,function(a){h.reject(a)}));return h.promise};c.readSupportTableInfoFromLayerInfos=function(b){var a=new n,d=[];m.forEach(b,f.hitch(this,function(a){d.push(a.getSupportTableInfo())}));e(d).then(f.hitch(this,function(d){d=f.clone(d);m.forEach(d,function(a,d){a.id=b[d].id});a.resolve(d)}),function(d){a.reject(d)});return a.promise};c.readConfigLayerInfosFromMap=function(b,a,d){var h=new n,k=[];this.readLayerInfosFromMap(b,a,d).then(f.hitch(this,
function(a){var d=[];m.forEach(a,function(a){k.push(a.getSupportTableInfo())});e(k).then(f.hitch(this,function(b){m.forEach(b,f.hitch(this,function(b,h){b.isSupportedLayer&&(a[h].name=a[h].title,d.push(a[h]))}));h.resolve(d)}),f.hitch(this,function(a){h.reject(a)}))}),f.hitch(this,function(a){h.reject(a)}));return h.promise};c.getConfigInfosFromLayerInfos=function(b){return m.map(b,function(a){return c.getConfigInfoFromLayerInfo(a)})};c.getConfigInfoFromLayerInfo=function(b){var a={};a.name=b.name||
b.title;a.id=b.id;a.show=b.isShowInMap();a.layer={url:b.getUrl()};var d=b.getPopupInfo();d&&!d.description&&(a.layer.fields=m.map(d.fieldInfos,function(a){return{name:a.fieldName,alias:a.label,show:a.visible,format:a.format}}),b=f.getObject("layerObject.fields",!1,b),a.layer.fields=z(a.layer.fields,b),m.some(a.layer.fields,function(a){return a.show})||(a.layer.fields&&0<a.layer.fields.length?a.layer.fields[0].show=!0:console.warn("We do not get fields info.")));return a};c.generateCacheStore=function(b,
a,d,h,k){b=new u({layer:b,objectIds:b._objectIds||null,totalCount:a,batchCount:d,where:h||"1\x3d1",spatialFilter:k});a=new y;return new l(b,a,{})};c.generateMemoryStore=function(b,a){return new g(new y({data:b||[],idProperty:a}))};c.merge=function(b,a,d,h){for(var k=m.map(a,function(a){return a[d]}),q=0,c=b.length;q<c;q++){var g=k.indexOf(b[q][d]);-1<g&&h(b[q],a[g])}};c.syncOrderWith=function(b,a,d){function h(a,d){return m.map(a,function(a){return a[d]})}if(!f.isArray(a)||!d)return b;for(var k=h(b,
d),q=[],c=0,g=a.length;c<g;c++){var e=k.indexOf(a[c][d]);-1<e&&(q=q.concat(b.splice(e,1)),k=h(b,d))}return q.concat(b)};c.arcade={};c.arcade.getExpressionInfosFromLayer=function(b,a){b=p.readExprInfo.getArcadeProfilesByType(b,a,"infoTemplate");return 0<b.length&&b[0].expressionInfos?b[0].expressionInfos:[]};c.arcade.getExpressionInfosFromLayerInfo=function(b){return(b=b&&b.getPopupInfo())&&b.expressionInfos||[]};c.arcade.getAttributes=function(b,a,d){var h=new w(b.geometry,null,b);return p.customExpr.getAttributesFromCustomArcadeExpr(a,
h,d)||b};c.arcade.appendArcadeExpressionsToFields=function(b,a){if(b){a=c.arcade.getExpressionInfosFromLayerInfo(a);if(0<a.length){var d=/^expression\//;m.forEach(a,function(a){m.some(b,function(b){if(d.test(b.name))return b=b.name.substr(11),a.name===b})||b.push({name:"expression/"+a.name,alias:a.title,show:!0})})}return b}};c.arcade.isArcadeExpressionField=function(b){return b&&"string"===typeof b.name&&0===b.name.indexOf("expression/")};c.arcade.parseArcadeExpressions=function(b){return p.InfoTemplate._parseArcadeExpressions(b)};
c.getSortbyFields=function(b,a){b=b&&b.get("sort")||[];a=a&&a.objectIdField;0<b.length?b=m.map(b,function(a){return a.attribute+" "+(a.descending?"DESC":"ASC")}):a&&b.push(a+" ASC");return b}})},"dojo/store/Cache":function(){define(["../_base/lang","../when"],function(f,m){var t=function(n,e,c){c=c||{};return f.delegate(n,{query:function(g,l){g=n.query(g,l);g.forEach(function(g){c.isLoaded&&!c.isLoaded(g)||e.put(g)});return g},queryEngine:n.queryEngine||e.queryEngine,get:function(c,l){return m(e.get(c),
function(g){return g||m(n.get(c,l),function(g){g&&e.put(g,{id:c});return g})})},add:function(c,l){return m(n.add(c,l),function(g){e.add(g&&"object"==typeof g?g:c,l);return g})},put:function(c,l){e.remove(l&&l.id||this.getIdentity(c));return m(n.put(c,l),function(g){e.put(g&&"object"==typeof g?g:c,l);return g})},remove:function(c,l){return m(n.remove(c,l),function(g){return e.remove(c,l)})},evict:function(c){return e.remove(c)}})};f.setObject("dojo.store.Cache",t);return t})},"widgets/AttributeTable/table/FeatureLayerQueryStore":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/tasks/query esri/tasks/QueryTask ./FeatureLayerQueryResult".split(" "),
function(f,m,t,n,e,c){return f(null,{queryUrl:"",idProperty:"id",data:null,_entityData:null,constructor:function(c){f.safeMixin(this,c);this.data=[];this._entityData=[];this.layer=c.layer;this.objectIds=c.objectIds;this.where=c.where;this.orderByFields=c.orderByFields;this.totalCount=c.totalCount;this.batchCount=c.batchCount||25;this.idProperty=this.layer.objectIdField;this.spatialFilter=c.spatialFilter;this.layer&&this.layer.url&&(this.queryTask=new e(this.layer.url))},get:function(c){return this.data[c]},
getIdentity:function(c){return c[this.idProperty]},query:function(e,l){var g=new n,f=l&&l.start||0,u=l._export_count||this.batchCount,p=null;"function"===typeof e?p=e(this._entityData):"[object Array]"===Object.prototype.toString.call(e)&&(p=e);this.objectIds?(p=p?p:this.objectIds,g.objectIds=p.length>=f+this.batchCount?p.slice(f,f+u):p.slice(f)):(p&&0<p.length?g.objectIds=p.length>=f+this.batchCount?p.slice(f,f+u):p.slice(f):(g.start=f,g.num=u,g.where=this.where,g.geometry=this.spatialFilter,g.spatialRelationship=
n.SPATIAL_REL_INTERSECTS),(e=l.sort)&&0<e.length&&(e=t.map(e,function(c){return c.attribute+" "+(c.descending?"DESC":"ASC")}),g.orderByFields=e));g.returnGeometry="esriGeometryPoint"===this.layer.geometryType;g.outFields=["*"];var v=this.totalCount;e=null;e=!g.where;if(!(g.objectIds&&0<g.objectIds.length)&&e)return new c([]);e=this.queryTask?this.queryTask.execute(g):this.layer.queryFeatures(g);e.total=e.then(m.hitch(this,function(c){var e=0,f=this.layer.objectIdField;if(this.objectIds){if(!f)for(e=
0;e<c.fields.length;e++)if("esriFieldTypeOID"===c.fields[e].type){f=c.fields[e].name;break}for(var b={},e=0;e<c.features.length;e++)b[c.features[e].attributes[f]]=c.features[e];c.features=t.map(g.objectIds,function(a){return b[a]})}for(e=0;e<c.features.length;e++)if(c.features[e]){var a=c.features[e];c.features[e]=m.mixin(m.clone(a.attributes),{geometry:a.geometry});this.data[c.features[e][f]]=c.features[e];this._entityData.push(c.features[e])}c=c.features;return v}),function(){console.log("FeatureLayerQueryStore queryFeatures failed.");
return 0});return new c(e)}})})},"widgets/AttributeTable/table/FeatureLayerQueryResult":function(){define("esri/main dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/DeferredList dojo/_base/array".split(" "),function(f,m,t,n){var e=function(c){function g(g){c[g]||(c[g]=function(){var f=arguments;return n.when(c,function(c){Array.prototype.unshift.call(f,c.features||c);return e(t[g].apply(t,f))})})}if(!c)return c;c.then&&(c=m.delegate(c));c.total||(c.total=n.when(c,function(c){return f._isDefined(c.total)?
c.total:c.length||0}));g("forEach");g("filter");g("map");g("some");g("every");return c};return e})},"widgets/AttributeTable/setting/_build-generate_module":function(){define(["dojo/text!./Setting.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/AttributeTable/setting/Setting.html":'\x3cdiv style\x3d"width:100%;"\x3e\r\n  \x3cdiv class\x3d"instruction"\x3e\r\n    \x3cp\x3e${nls.instruction}\x3c/p\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"check-syncwithlayers" data-dojo-attach-point\x3d"syncWithLayersCheck"\r\n    data-dojo-type\x3d"jimu/dijit/CheckBox" label\x3d"${nls.syncWithLayers}"\x3e\x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"tableLayerInfos" class\x3d"table-layer-infos"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"table-options jimu-ellipsis"\x3e\r\n    \x3cul\x3e\r\n      \x3cli\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"exportcsv" checked\r\n        data-dojo-type\x3d"jimu/dijit/CheckBox" label\x3d"${nls.exportCSV}"\x3e\x3c/div\x3e\r\n      \x3c/li\x3e\r\n      \x3cli\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"expand" data-dojo-type\x3d"jimu/dijit/CheckBox" label\x3d"${nls.expand}"\x3e\x3c/div\x3e\r\n      \x3c/li\x3e\r\n      \x3cli\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"filterByMapExtent" data-dojo-type\x3d"jimu/dijit/CheckBox" label\x3d"${nls.filterByExtent}"\x3e\x3c/div\x3e\r\n      \x3c/li\x3e\r\n      \x3cli\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"textSelection" data-dojo-type\x3d"jimu/dijit/CheckBox" label\x3d"${nls.allowTextSelection}"\x3e\x3c/div\x3e\r\n      \x3c/li\x3e\r\n    \x3c/ul\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/AttributeTable/setting/css/style.css":".jimu-widget-attributetable-setting{margin:0; padding:0; font-size:14px; width: 100%; height: 100%; position: relative; color: #596679;}.jimu-widget-attributetable-setting .instruction{font-size: 12px; margin-bottom: 10px;}.jimu-widget-attributetable-setting .check-syncwithlayers {margin-bottom: 10px; padding-left: 8px; padding-right: 8px;}.jimu-widget-attributetable-setting .show{width: 120px;}.jimu-widget-attributetable-setting .symbol{width: 200px;}.jimu-widget-attributetable-setting .table-layer-infos{width: 100%; height: 240px;}.jimu-widget-attributetable-setting .table-options ul{list-style-type: none; padding: 0;}.jimu-widget-attributetable-setting .jimu-checkbox{margin-right: 20px;}.jimu-rtl .jimu-widget-attributetable-setting .jimu-checkbox{margin-left: 20px; margin-right: 0;}.jimu-widget-attributetable-setting .jimu-checkbox.jimu-state-disabled {color: #e5e5e5;}.jimu-widget-attributetable-setting .jimu-checkbox.jimu-state-disabled .checkbox{cursor: default;}.jimu-widget-attributetable-setting th.isDescending .jimu-checkbox {display: none;}.jimu-widget-attributetable-setting td.isDescending {text-align: center;}.jimu-widget-attributetable-setting td.isDescending .jimu-checkbox {top: 5px; margin: 0;}.jimu-widget-attributetable-setting td.isDescending .jimu-checkbox .checkbox {background: transparent; background-image: url('images/order_up.svg'); width: 16px; height: 16px; background-repeat: no-repeat; background-position-x: 0;}.jimu-widget-attributetable-setting td.isDescending .jimu-checkbox .checkbox.jimu-icon-checked {background-image: url('images/order_down.svg');}.jimu-rtl .jimu-widget-attributetable-setting td.isDescending .jimu-checkbox .checkbox {-webkit-transform: rotateY(180deg); transform: rotateY(180deg);}.jimu-widget-attributetable-setting .sortField .dijitSelect{height: 20px; background: #fff; margin: 5px 0;}.jimu-widget-attributetable-setting .sortField .dijitSelect .dijitButtonContents{border-right-width: 0;}.jimu-rtl .jimu-widget-attributetable-setting .sortField .dijitSelect .dijitButtonContents{border-left-width: 0;}.jimu-widget-attributetable-setting .sortField .dijitSelect .dijitButtonText{overflow: hidden; text-overflow: ellipsis; width: 90px;}.jimu-widget-attributetable-setting .sortField .dijitSelect .dijitInputField{padding-top: 0; padding-bottom: 0;}.jimu-widget-attributetable-setting .sortField .dijitSelect .dijitArrowButton{background: #fff;}.has-webkit .jimu-simple-table.vertical-scroll .head-section \x3e .table-div{padding-right: 6px;}.jimu-rtl.has-webkit .jimu-simple-table.vertical-scroll .head-section \x3e .table-div{padding-left: 6px;}",
"*now":function(f){f(['dojo/i18n!*preload*widgets/AttributeTable/setting/nls/Setting*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin jimu/BaseWidgetSetting jimu/dijit/SimpleTable dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/Deferred dojo/promise/all dojo/query dijit/registry jimu/dijit/Popup jimu/dijit/Message jimu/dijit/CheckBox jimu/dijit/LoadingShelter ../utils".split(" "),function(f,m,t,n,e,c,g,l,y,A,u,p,v,w,B,z,b){return f([t,m],{baseClass:"jimu-widget-attributetable-setting",currentFieldTable:null,_allLayerFields:null,_layerInfos:null,_tableInfos:null,
_delayedLayerInfos:null,_delayedLayerInfosAfterInit:null,_unSpportQueryCampsite:null,startup:function(){this.inherited(arguments);this.config.layerInfos||(this.config.layerInfos=[]);this._allLayerFields=[];this._layerInfos=[];this._tableInfos=[];this._delayedLayerInfos=[];this._delayedLayerInfosAfterInit=[];this._unSpportQueryCampsite={};this.displayFieldsTable=new n({fields:[{name:"show",title:this.nls.show,width:"auto",type:"checkbox","class":"show"},{name:"label",title:this.nls.label,width:"60%",
type:"text"},{name:"url",title:this.nls.url,type:"text",hidden:!0},{name:"index",title:"index",type:"text",hidden:!0},{name:"sortField",title:this.nls.sortField,type:"dropdown",width:"130"},{name:"isDescending",title:"",width:"40",type:"checkbox","class":"sort-order"},{name:"actions",title:this.nls.actions,type:"actions",width:"20%",actions:["edit"],"class":"symbol"},{name:"showAttachments",title:"",type:"checkbox",hidden:!0}],selectable:!0,autoHeight:!1});this.displayFieldsTable.placeAt(this.tableLayerInfos);
c.setStyle(this.displayFieldsTable.domNode,{height:"100%"});this.shelter=new z({hidden:!0});this.shelter.placeAt(this.domNode.parentNode.parentNode||this.domNode);this.shelter.startup();this.shelter.show();b.readLayerInfosObj(this.map).then(e.hitch(this,function(a){this.own(a.on("layerInfosChanged",e.hitch(this,this.onLayerInfosChanged)));this.own(l(this.displayFieldsTable,"actions-edit",e.hitch(this,this.editFieldsClick)));this.own(l(this.displayFieldsTable,"row-click",e.hitch(this,this._verifiedOnShowClick)));
this.own(l(this.displayFieldsTable,"row-add",e.hitch(this,function(a){this._addTooltipToSortOrderNode(a)})));this.own(l(this.syncWithLayersCheck,"change",e.hitch(this,function(a){this._toggleTableShowOption(a)})));this.setConfig(this.config)}))},editFieldsClick:function(a){var d=u(".action-item-parent",a);if(d&&d.length)if(d=this.displayFieldsTable.getRowData(a),d.show){var b=parseInt(d.index,10);this.shelter.show();this._getLayerFields(b).then(e.hitch(this,function(d){this.openFieldsDialog(a,d,b)}),
e.hitch(this,function(a){console.error(a)})).always(e.hitch(this,function(){this.shelter.hide()}))}else var c=new w({message:this.nls.warning,buttons:[{label:this.nls.ok,onClick:e.hitch(this,function(){c.close()})}]})},_verifiedOnShowClick:function(a){var d=this.displayFieldsTable.getRowData(a),b=parseInt(d.index,10),c=null,c=this.config&&this.config.layerInfos&&0<this.config.layerInfos.length?this.config.layerInfos[b]:this._layerInfos[b],b=-1<this._unSpportQueryCampsite.layerNames.indexOf(c.name||
c.title);d.show&&b&&(new w({message:this.nls.unsupportQueryWarning}),d.show=!1,this.displayFieldsTable.editRow(a,d))},_getLayerFields:function(a){return this._layerInfos[a].getLayerObject().then(e.hitch(this,function(d){var c=this._allLayerFields[a];d=g.map(d.fields,function(a){return{name:a.name,alias:a.alias,show:!0}});d=b.arcade.appendArcadeExpressionsToFields(d,this._layerInfos[a]);b.merge(d,c,"name",function(a,d){e.mixin(a,d)});return d=b.syncOrderWith(d,c,"name")}))},_addTooltipToSortOrderNode:function(a){var d=
u(".sort-order .jimu-checkbox",a)[0];a=p.byNode(d);var b=this.nls,c=function(a){d.title=a?b.sortOrderTooltips.toAscending:b.sortOrderTooltips.toDescending};a&&(this.own(l(a,"change",c)),c(a.checked))},openFieldsDialog:function(a,d,b){var k=!1,h=this._layerInfos[b];(h=h&&h.layerObject)&&(k=h.hasAttachments&&h.objectIdField);var h=c.create("div"),g=this._createFieldsTable(d,b);c.place(g.domNode,h);var f=null;k&&(f=new B({label:this.nls.showAttachments,style:"margin-top:10px;"}),d=this.displayFieldsTable.getRowData(a),
f.setValue(d.showAttachments),f.placeAt(h));this.currentFieldTable=g;d=600;f&&(d=640);var l=new v({titleLabel:this.nls.configureLayerFields,width:640,maxHeight:d,autoHeight:!0,content:h,buttons:[{label:this.nls.ok,onClick:e.hitch(this,function(){this._allLayerFields[b]=g.getData();var d=f?f.getValue():!1;this.displayFieldsTable.editRow(a,{showAttachments:d});l.close();l=null})},{label:this.nls.cancel,classNames:["jimu-btn-vacation"],onClick:e.hitch(this,function(){l.close();l=null})}],onClose:function(){l=
null}});g.startup()},_createFieldsTable:function(a){for(var d=null,b={fields:[{name:"show",title:this.nls.fieldVisibility,type:"checkbox","class":"show",onChange:e.hitch(this,function(a){var b=d.getData();!g.some(b,e.hitch(this,function(a){return a.show}))&&(new w({message:this.nls.fieldCheckWarning}),b=d.getRowData(a))&&(b.show=!0,d.editRow(a,b))})},{name:"name",title:this.nls.fieldName,type:"text"},{name:"alias",title:this.nls.fieldAlias,editable:!0,type:"text"},{name:"actions",title:this.nls.fieldActions,
type:"actions",actions:["up","down"],"class":"symbol"}],selectable:!0,autoHeight:!1,style:{height:"300px",maxHeight:"300px"}},d=new n(b),b=0;b<a.length;b++)a[b].show=void 0===a[b].show?!0:!!a[b].show,d.addRow(a[b]);return d},setConfig:function(a){this.config=a;this.displayFieldsTable.clear();this._allLayerFields=[];this._processTableData().then(e.hitch(this,function(a){this._init(a);this.shelter.hide()}),e.hitch(this,function(a){new w({message:a.message||a})}))},onLayerInfosChanged:function(a,b,c){"added"===
b&&c&&a&&c.getSupportTableInfo().then(e.hitch(this,function(a){a.isSupportedLayer&&(this._layerInfos&&0===this._layerInfos.length?this._delayedLayerInfos.push(c):this._layerInfos&&0<this._layerInfos.length&&!this._getLayerInfoById(c.id)&&(this._delayedLayerInfosAfterInit.push(c),this._processDelayedLayerInfosAfterInit(this._delayedLayerInfosAfterInit)))}))},_processDelayedLayerInfosAfterInit:function(a){for(var d=this._layerInfos.length,c=[],k=0;k<a.length;k++){var g=b.getConfigInfoFromLayerInfo(a[k]),
f={label:g.name||g.title,url:g.layer.url,index:""+(d+k),isDescending:!0,show:g.show};this._allLayerFields.push(g.layer.fields);this._layerInfos.push(a[k]);c.push(this._prepareSortField(f,k))}A(c).then(e.hitch(this,function(a){for(var b=0;b<a.length;b++)this._addRowToDisplayFieldsTable(a[b])}),e.hitch(this,function(a){console.error(a)}))},_processDelayedLayerInfos:function(){0<this._delayedLayerInfos.length&&(g.forEach(this._delayedLayerInfos,e.hitch(this,function(a){this._getLayerInfoById(a.id)||
this._layerInfos.push(a)})),this._delayedLayerInfos=[])},_processTableData:function(){var a=new y;b.readConfigLayerInfosFromMap(this.map,!0,!0).then(e.hitch(this,function(d){this._layerInfos=d;this._processDelayedLayerInfos();b.readSupportTableInfoFromLayerInfos(this._layerInfos).then(e.hitch(this,function(c){this._tableInfos=c;this.config&&this.config.layerInfos&&0<this.config.layerInfos.length?(c=b.getConfigInfosFromLayerInfos(this._layerInfos),b.merge(c,this.config.layerInfos,"id",e.hitch(this,
function(a,d){var c=this._getLayerInfoById(a.id);a.layer.fields=b.arcade.appendArcadeExpressionsToFields(a.layer.fields,c);a.show=d.show;a.showAttachments=d.showAttachments;a.sortField=d.sortField;a.isDescending=d.isDescending;a.layer.url=d.layer.url;e.getObject("layer.fields.length",!1,a)&&e.getObject("layer.fields.length",!1,d)?(b.merge(a.layer.fields,d.layer.fields,"name",function(a,b){e.mixin(a,b)}),a.layer.fields=b.syncOrderWith(a.layer.fields,d.layer.fields,"name")):a.layer.fields=d.layer.fields})),
this.config.layerInfos=c,this._unSpportQueryCampsite.fromConfig=!0,this._unSpportQueryCampsite.layerNames=this._getUnsupportQueryLayerNames(this.config.layerInfos)):(this._unSpportQueryCampsite.fromConfig=!1,this._unSpportQueryCampsite.layerNames=this._getUnsupportQueryLayerNames(this._layerInfos),c=b.getConfigInfosFromLayerInfos(d),c=g.map(c,e.hitch(this,function(a){var d=e.getObject("layer.fields",!1,a),c=this._getLayerInfoById(a.id);d&&(d=b.arcade.appendArcadeExpressionsToFields(a.layer.fields,
c),a.layer.fields=d);return a})));a.resolve(c)}),function(b){console.error(b);a.reject(b)})}),e.hitch(this,function(b){console.error(b);a.reject(b)}));return a},_getUnsupportQueryLayerNames:function(a){var b=[];g.forEach(a,e.hitch(this,function(a){var d=this._getSupportTableInfoById(a.id);d&&!d.isSupportQuery&&b.push(a.name||a.title)}));return b},_init:function(a){for(var b=[],g=[],k=0;k<a.length;k++){var f=a[k].show&&this._getSupportTableInfoById(a[k].id).isSupportQuery,f={label:a[k].name||a[k].title,
url:a[k].layer.url,index:""+k,show:f,sorting:{fields:a[k].layer.fields,selectedField:a[k].sortField},isDescending:a[k].isDescending,showAttachments:!!a[k].showAttachments};this._allLayerFields.push(a[k].layer.fields);g.push(this._prepareSortField(f,k));this._unSpportQueryCampsite.fromConfig&&(f=(f=this._unSpportQueryCampsite.layerNames)&&-1<f.indexOf(a[k].name||a[k].title),a[k].show&&f&&b.push(a[k].name||a[k].title))}A(g).then(e.hitch(this,function(a){for(var b=0;b<a.length;b++)this._addRowToDisplayFieldsTable(a[b])}),
e.hitch(this,function(a){console.error(a)}));this._unSpportQueryCampsite.fromConfig&&0<b.length&&new w({message:this.nls.unsupportQueryLayers+"\x3cbr\x3e\x3cbr\x3e"+b.toString()});this.config.hideExportButton?this.exportcsv.uncheck():this.exportcsv.check();this.config.initiallyExpand?this.expand.check():this.expand.uncheck();this._canUseOpenAtStart()&&(this.openAtStart?this.expand.check():this.expand.uncheck(),this.expand.status=!1,c.addClass(this.expand.domNode,"disable-checkbox"));this.config.filterByMapExtent?
this.filterByMapExtent.check():this.filterByMapExtent.uncheck();this.config.allowTextSelection?this.textSelection.check():this.textSelection.uncheck();this.config.syncWithLayers?this.syncWithLayersCheck.check():this.syncWithLayersCheck.uncheck()},_addRowToDisplayFieldsTable:function(a){this.displayFieldsTable.addRow(a)},_prepareSortField:function(a,b){var d=new y;a.sorting&&a.sorting.fields?(a.sortField=this._prepareSortFieldOptions(a.sorting),d.resolve(a)):this._getLayerFields(b).then(e.hitch(this,
function(b){a.sorting?a.sorting.fields=b:a.sorting={fields:b};a.sortField=this._prepareSortFieldOptions(a.sorting);d.resolve(a)}),e.hitch(this,function(a){console.error(a);d.reject(a)}));return d},_prepareSortFieldOptions:function(a){if(a&&a.fields&&Array.isArray(a.fields))return g.map(a.fields,function(b){var d={value:b.name,label:b.alias};a.selectedField===b.name&&(d.selected=!0);0===b.name.indexOf("expression/")&&(d.disabled=!0);return d})},_canUseOpenAtStart:function(){return this.closeable||
!this.isOnScreen},_getLayerInfoById:function(a){for(var b=0,c=this._layerInfos.length;b<c;b++)if(this._layerInfos[b].id===a)return this._layerInfos[b]},_getSupportTableInfoById:function(a){for(var b=0,c=this._tableInfos.length;b<c;b++)if(this._tableInfos[b].id===a)return this._tableInfos[b]},getConfig:function(){var a=this.displayFieldsTable.getData(),b=[],c=a.length;if(this.config&&this.config.layerInfos&&0<this.config.layerInfos.length)g.forEach(a,e.hitch(this,function(c,d){c=this.config.layerInfos[d];
var e={};e.name=c.name||c.title;e.id=c.id;e.layer={};e.layer.url=a[d].url;e.layer.fields=this._allLayerFields[d];e.show=a[d].show;e.showAttachments=a[d].showAttachments;e.sortField=a[d].sortField;e.isDescending=a[d].isDescending;b.push(e)}));else for(var f=0;f<c;f++){var l={};l.name=this._layerInfos[f].name||this._layerInfos[f].title;l.id=this._layerInfos[f].id;l.layer={};l.layer.url=a[f].url;l.layer.fields=this._allLayerFields[f];l.show=a[f].show;l.showAttachments=a[f].showAttachments;l.sortField=
a[f].sortField;l.isDescending=a[f].isDescending;b.push(l)}this.config.layerInfos=b;this.config.hideExportButton=!this.exportcsv.getValue();this.config.filterByMapExtent=this.filterByMapExtent.getValue();this.config.allowTextSelection=this.textSelection.getValue();this.config.syncWithLayers=this.syncWithLayersCheck.getValue();this._canUseOpenAtStart()||(this.config.initiallyExpand=this.expand.getValue());return this.config},_toggleTableShowOption:function(a){this.displayFieldsTable&&u(".show .jimu-checkbox").forEach(function(b){p.byNode(b).setStatus(!a)})}})});