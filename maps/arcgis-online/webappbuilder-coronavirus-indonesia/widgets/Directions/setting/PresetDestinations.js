// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/Directions/setting/PresetDestinations.html":'\x3cdiv\x3e\r\n  \x3cspan class\x3d"title"\x3e${nls.presetDestinations}\x3c/span\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\r\n  \x3ctable style\x3d"width:98%;" cellspacing\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd style\x3d"width:50%;"\x3e\r\n        \x3ctable style\x3d"width:100%;" cellspacing\x3d"0"\x3e\r\n          \x3ctbody\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd style\x3d"width:200px;"\x3e\r\n              \x3cspan class\x3d"impedance-attribute jimu-ellipsis"\x3e${nls.startPoint}\x3c/span\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd style\x3d"width:auto;"\x3e\r\n              \x3cspan data-dojo-attach-point\x3d"startSearchDom" style\x3d"width:220px;"\x3e\x3c/span\x3e\r\n              \x3cdiv data-dojo-attach-point\x3d"startSearchResultsNode" class\x3d"searchResults arcgisSearch"\x3e\x3c/div\x3e\r\n              \x3c!--\x3cdiv data-dojo-attach-point\x3d"startSearchError" class\x3d"hide preset-des-error"\x3eNo Results\x3c/div\x3e--\x3e\r\n            \x3c/td\x3e\r\n\r\n            \x3ctd style\x3d"width:200px;"\x3e\r\n              \x3cspan class\x3d"impedance-attribute jimu-ellipsis"\x3e${nls.endPoint}\x3c/span\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd style\x3d"width:auto;"\x3e\r\n              \x3cspan data-dojo-attach-point\x3d"endSearchDom" class\x3d"end-search" style\x3d"width:220px;"\x3e\x3c/span\x3e\r\n              \x3cdiv data-dojo-attach-point\x3d"endSearchResultsNode" class\x3d"searchResults arcgisSearch"\x3e\x3c/div\x3e\r\n              \x3c!--\x3cdiv data-dojo-attach-point\x3d"endSearchError" class\x3d"hide preset-des-error"\x3eNo Results\x3c/div\x3e--\x3e\r\n            \x3c/td\x3e\r\n          \x3c/tr\x3e\r\n          \x3c/tbody\x3e\r\n        \x3c/table\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/_base/lang dojo/on dojo/_base/html dojo/query esri/lang dojo/Deferred esri/tasks/locator jimu/utils ../searchUtil jimu/LayerInfos/LayerInfos dojo/when dojo/promise/all dojo/_base/array esri/layers/FeatureLayer dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./PresetDestinations.html esri/dijit/Search jimu/dijit/RadioBtn".split(" "),function(w,c,f,e,l,x,t,u,n,p,y,z,A,q,B,C,D,E,F,v){return w([C,D,E],{templateString:F,_defaultLocations:null,
_startSearchResults:null,_endSearchResults:null,_isSearchResultsShown:!1,_ERROR_CLASS:"have-error",constructor:function(b){b&&(this._defaultLocations=[],this._defaultLocations=this._parseDefaultLocations(b.defaultLocations),this.nls=b.nls)},postCreate:function(){this.inherited(arguments)},startup:function(){this._getLayerInfos().then(c.hitch(this,function(){this.startSearch=new v({enableSuggestions:!1,enableButtonMode:!1,theme:"arcgisSearch"});this.startSearch.placeAt(this.startSearchDom);this.own(f(this.startSearch,
"search-results",c.hitch(this,"_onStartSearchResults")));this.own(f(this.startSearchResultsNode,"li:click",c.hitch(this,"_onSelectStartSearchResult")));this.own(f(this.startSearch.inputNode,"focus",c.hitch(this,"_onCleanStartError")));this.own(f(this.startSearch.inputNode,"blur",c.hitch(this,function(){!1===this._isSearchResultsShown&&this.startSearch&&this.startSearch.search&&this.startSearch.search()})));this.endSearch=new v({enableSuggestions:!1,enableButtonMode:!1,theme:"arcgisSearch"});this.endSearch.placeAt(this.endSearchDom);
this.own(f(this.endSearch,"search-results",c.hitch(this,"_onEndSearchResults")));this.own(f(this.endSearchResultsNode,"li:click",c.hitch(this,"_onSelectEndSearchResult")));this.own(f(this.endSearch.inputNode,"focus",c.hitch(this,"_onCleanEndError")));this.own(f(this.endSearch.inputNode,"blur",c.hitch(this,function(){!1===this._isSearchResultsShown&&this.endSearch&&this.endSearch.search&&this.endSearch.search()})));this.own(f(window.document,"click",c.hitch(this,function(a){e.isDescendant(a.target,
this.searchResultsNode)||this._hideResultMenu()})));if(this._defaultLocations&&this._defaultLocations.length&&0<this._defaultLocations.length)for(var b=0,a=this._defaultLocations.length;b<a;b++)0===b?this._setSearchValue(this.startSearch,this._defaultLocations[b]):1===b&&this._setSearchValue(this.endSearch,this._defaultLocations[b])}));this.inherited(arguments)},_setSearchValue:function(b,a){"string"===typeof a?b.set("value",a):a.name&&(b.set("selectedResult",a),b.set("value",a.name))},getValue:function(){var b=
[],a=this._getSearchRest(this.startSearch,this._defaultLocations[0]);b.push(a);a=this._getSearchRest(this.endSearch,this._defaultLocations[1]);b.push(a);return b},_getSearchRest:function(b,a){var d=b.selectedResult;if(d)d.feature&&(d.feature._layer&&(d.feature._layer=""),d.feature._sourceLayer&&(d.feature._sourceLayer=""));else if(b.value)d=!1,"string"===typeof a?d=a!==b.value:a.name&&(d=a.name!==b.value),d=d?b.value:a;else return"";return d},_parseDefaultLocations:function(b){for(var a=[],d=0,r=
b.length;d<r;d++)a.push(b[d]);return a},setValue:function(b){b&&0<b.length&&(this._defaultLocations=[],this._defaultLocations=this._parseDefaultLocations(b))},validate:function(){var b=!1;l(".searchLoading",this.domNode).forEach(c.hitch(this,function(){b=!0}));return!1!==b||e.hasClass(this.startSearch,this._ERROR_CLASS)||e.hasClass(this.endSearch,this._ERROR_CLASS)?!1:!0},setSources:function(b){if(b&&b.sources&&b.sources.length)this.shelter.show(),z(p.getConfigInfo(b)).then(c.hitch(this,function(a){return A(this._convertConfig(a)).then(function(a){return q.filter(a,
function(a){return a})})})).then(c.hitch(this,function(a){this.startSearch.set("sources",a);this.endSearch.set("sources",a);this.shelter.hide()}));else if(a&&a.url&&a.singleLineFieldName){var a={locator:new u(a.url||""),outFields:["*"],singleLineFieldName:a.singleLineFieldName};this.startSearch.set("sources",[a]);this.endSearch.set("sources",[a])}else this.startSearch.set("sources",[]),this.endSearch.set("sources",[])},_onCleanError:function(b){e.removeClass(b,this._ERROR_CLASS)},_onCleanStartError:function(){this._onCleanError(this.startSearch)},
_onCleanEndError:function(){this._onCleanError(this.endSearch)},_onStartSearchResults:function(b){this._onSearchResults(b,{searchDijit:this.startSearch,searchResultsNode:this.startSearchResultsNode,searchError:this.startSearchError,results:"start"})},_onEndSearchResults:function(b){this._onSearchResults(b,{searchDijit:this.endSearch,searchResultsNode:this.endSearchResultsNode,searchError:this.endSearchError,results:"end"})},_onSearchResults:function(b,a){var d=a.searchDijit.get("sources"),r=a.searchDijit.get("activeSourceIndex"),
g=a.searchDijit.get("value"),c="",k=b.results;if(""!==g)if(k&&0<b.numResults){"start"===a.results?this._startSearchResults=k:"end"===a.results&&(this._endSearchResults=k);var c=c+'\x3cdiv class\x3d"searchMenu searchResultsMenu" role\x3d"menu"\x3e',h;for(h in k)if(k[h]&&k[h].length){b=d[parseInt(h,10)].name;1<d.length&&"all"===r&&(c+='\x3cdiv title\x3d"'+b+'" class\x3d"menuHeader"\x3e'+b+"\x3c/div\x3e");c+="\x3cul\x3e";b=d[h].maxResults||5;for(var g=0,f=k[h].length;g<f&&g<b;g++){var m;x.isDefined(k[h][g].name)?
(m=k[h][g].name,m=n.sanitizeHTML(m)):m=this.nls.untitled;c+='\x3cli title\x3d"'+m+'" data-index\x3d"'+g+'" data-source-index\x3d"'+h+'" role\x3d"menuitem" tabindex\x3d"0"\x3e'+m.toString()+"\x3c/li\x3e"}c+="\x3c/url\x3e"}a.searchResultsNode.innerHTML=c+"\x3c/div\x3e";this._showResultMenu(a.searchDijit,a.searchResultsNode);this._resetSelectorPosition(a.searchDijit,".searchResultsMenu")}else e.addClass(a.searchDijit,this._ERROR_CLASS),this._resetSelectorPosition(a.searchDijit,".noResultsMenu")},_onSelectStartSearchResult:function(b){this._onSelectSearchResult(b,
this.startSearch,this._startSearchResults)},_onSelectEndSearchResult:function(b){this._onSelectSearchResult(b,this.endSearch,this._endSearchResults)},_onSelectSearchResult:function(b,a,d){for(b=b.target;!e.hasAttr(b,"data-source-index")||!e.getAttr(b,"data-index");)b=b.parentNode;var c=null,c=e.getAttr(b,"data-source-index");b=parseInt(e.getAttr(b,"data-index"),10);"all"!==c&&(c=parseInt(c,10));d&&d[c]&&d[c][b]&&(c=d[c][b],a.select(c),c.name&&a.set("value",c.name))},_showResultMenu:function(b,a){e.setStyle(a,
"display","block");l(".searchMenu",a).style("display","block");this._isSearchResultsShown=!0;if(b=l(".searchInputGroup",b.domNode)[0])b={width:e.getMarginBox(b).w+"px"},l(".searchMenu",a).style(b)},_resetSelectorPosition:function(b,a){var d=e.getMarginBox(this.domNode.offsetParent);l(a,this.domNode).forEach(c.hitch(this,function(c){var g=e.position(c),f=e.position(b.domNode),f=".noResultsMenu"===a?0:f.h;g.y+g.h>d.h&&e.setStyle(c,"top",-(g.h+f)-4+"px")}))},_hideResultMenu:function(){l(".searchMenu",
this.domNode).style("display","none");this._isSearchResultsShown=!1},_getLayerInfos:function(){var b=new t;y.getInstance(this.map,this.map.itemInfo).then(c.hitch(this,function(a){this.layerInfosObj=a;this.own(this.layerInfosObj.on("layerInfosFilterChanged",c.hitch(this,function(a){p.config.onLayerInfosFilterChanged(a,this.config)})));b.resolve()}));return b},_convertConfig:function(b){return q.map(b.sources,c.hitch(this,function(a){var b=new t;if(a&&a.url&&"locator"===a.type){var e={locator:new u(a.url||
""),outFields:["*"],singleLineFieldName:a.singleLineFieldName||"",name:n.stripHTML(a.name||""),placeholder:n.stripHTML(a.placeholder||""),countryCode:a.countryCode||"",maxSuggestions:a.maxSuggestions,useMapExtent:!!a.searchInCurrentMapExtent};a.enableLocalSearch&&(e.localSearchOptions={minScale:a.localSearchMinScale,distance:a.localSearchDistance});a.zoomScale&&(e.autoNavigate=!1);b.resolve(e)}else a&&a.url&&"query"===a.type?(e=new B(a.url||null,{outFields:["*"]}),this.own(f(e,"load",c.hitch(this,
function(d){var e=d.layer;d=this.map.getLayer(a.layerId);var f=this.layerInfosObj.getLayerInfoById(a.layerId);d?f=d=!1:f?f=d=!1:(d=!1,f=!0);var h=null;a.searchFields&&0<a.searchFields.length?h=a.searchFields:(h=[],q.forEach(e.fields,function(a){"esriFieldTypeOID"!==a.type&&a.name!==e.objectIdField&&"esriFieldTypeGeometry"!==a.type&&h.push(a.name)}));var g={featureLayer:e,outFields:["*"],searchFields:h,autoNavigate:!1,displayField:a.displayField||"",exactMatch:!!a.exactMatch,name:n.stripHTML(a.name||
""),placeholder:n.stripHTML(a.placeholder||""),maxSuggestions:a.maxSuggestions||6,useMapExtent:!!a.searchInCurrentMapExtent,showInfoWindowOnSelect:d,enableInfoWindow:f,_featureLayerId:a.layerId};g._featureLayerId&&(d=this.layerInfosObj.getLayerInfoById(g._featureLayerId))&&e.setDefinitionExpression(d.getFilter());p.config.getInfoTemplate(e,a,this.layerInfosObj).then(c.hitch(this,function(a){g.infoTemplate=c.clone(a);b.resolve(g)}),c.hitch(this,function(){b.resolve(g)}))}))),this.own(f(e,"error",function(){b.resolve(null)}))):
b.resolve(null);return b}))}})});