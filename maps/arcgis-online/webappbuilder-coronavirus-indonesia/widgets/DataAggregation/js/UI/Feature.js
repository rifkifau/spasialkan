// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/DataAggregation/js/UI/templates/Feature.html":'\x3cdiv class\x3d"pad-left-5 no-select"\x3e\r\n\r\n  \x3c!-- Title table --\x3e\r\n  \x3ctable class\x3d"page-table display-none table-layout" cellpading\x3d"0" data-dojo-attach-point\x3d"featureTitleTable"\r\n    tabindex\x3d"0" role\x3d"region"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d"panel-title-td"\x3e\r\n          \x3cdiv class\x3d"panel-title-text" data-dojo-attach-point\x3d"pageTitleDiv"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d"bottom-border-bold task-instruction-row"\x3e\r\n        \x3ctd class\x3d"panel-title-hint-td"\x3e\r\n          \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"pageHintDiv"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3c!--Feature toolbar table--\x3e\r\n  \x3ctable class\x3d"page-table display-none table-layout" cellpading\x3d"0" data-dojo-attach-point\x3d"featureToolbarTable"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n        \x3ctd data-dojo-attach-point\x3d"reviewRowRecordTd" class\x3d"pad-bottom-10 pad-top-10"\x3e\r\n          \x3cspan class\x3d"float-left main-text pad-right-10 display-none pad-left-5" data-dojo-attach-point\x3d"reviewText"\r\n            style\x3d"line-height:30px;"\x3e${nls.review.item}\x3c/span\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"_duplicateFlag" class\x3d"pad-bottom-10 duplicate-flag"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d"pad-bottom-10 pad-top-10 feature-toolbar-td"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"featureToolbar"\x3e\r\n\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3c!--feature toggle table--\x3e\r\n  \x3ctable data-dojo-attach-point\x3d"featureToggleTable" class\x3d"page-table display-none table-layout" cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border toggle-expand-row" data-dojo-attach-point\x3d"featureTr" data-dojo-attach-event\x3d"onclick:_toggleFeature  , onkeydown:_toggleFeature" tabindex\x3d"0"\r\n        role\x3d"button" aria-label\x3d"${nls.review.feature}" aria-expanded\x3d"false"\x3e\r\n        \x3ctd colspan\x3d"2" class\x3d"field-control-td text-left field-row-width pad-left-5"\x3e\r\n          \x3cdiv class\x3d"font-size-med main-text float-left"\x3e\r\n            ${nls.review.feature}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd style\x3d"width: 20px;" nowrap class\x3d"page-item-td-nav" data-dojo-attach-point\x3d"featureTd"\x3e\r\n          \x3cdiv class\x3d"float-right bg-img-toggle bg-toggle-down-img margin-left-5"\r\n            data-dojo-attach-point\x3d"toggleFeature"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"featureInformation" class\x3d"display-none"\x3e\r\n\r\n    \x3c!--feature controls table--\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"featureTable" class\x3d"page-table display-none table-layout" cellpading\x3d"0"\x3e\r\n      \x3ccolgroup\x3e\r\n        \x3ccol width\x3d"30%" /\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n      \x3c/colgroup\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"featureControlTable"\x3e\x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3c!--location toggle table--\x3e\r\n  \x3ctable data-dojo-attach-point\x3d"locationControlToggleTable" class\x3d"page-table display-none table-layout"\r\n    cellpading\x3d"0"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr class\x3d"bottom-border toggle-expand-row"  data-dojo-attach-point\x3d"locationTr" data-dojo-attach-event\x3d"onclick:_toggleLocation , onkeydown:_toggleLocation" tabindex\x3d"0"\r\n        role\x3d"button" aria-label\x3d"${nls.review.locationInfo}" aria-expanded\x3d"false"\x3e\r\n        \x3ctd class\x3d"field-control-td text-left field-row-width pad-left-5"\x3e\r\n          \x3cdiv class\x3d"font-size-med main-text float-left"\x3e\r\n            ${nls.review.locationInfo}\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd style\x3d"width: 20px;" class\x3d"page-item-td-nav" data-dojo-attach-point\x3d"locationTd"\x3e\r\n          \x3cdiv class\x3d"float-right bg-img-toggle bg-toggle-down-img margin-left-5"\r\n            data-dojo-attach-point\x3d"toggleLocation"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"locationInformation" class\x3d"display-none"\x3e\r\n\r\n    \x3c!--location toolbar--\x3e\r\n    \x3ctable class\x3d"page-table display-none" cellpading\x3d"0" data-dojo-attach-point\x3d"locationSyncTable"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr class\x3d"bottom-border task-instruction-row"\x3e\r\n          \x3ctd class\x3d"field-control-td pad-left-5"\x3e\r\n            \x3cdiv class\x3d"instruction" data-dojo-attach-point\x3d"locationHint"\x3e${nls.review.locationControlHint}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"field-control-td" title\x3d"${nls.review.sync}"\x3e\r\n            \x3cdiv class\x3d"float-right bg-ft-img bg-sync feature-toolbar-btn" data-dojo-attach-point\x3d"syncFields"\r\n              data-dojo-attach-event\x3d"onclick:_syncAddressInfo , keydown:_syncAddressInfo"\r\n              role\x3d"button" aria-label\x3d"${nls.review.sync}"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd title\x3d"${nls.featureToolbar.locate}"\x3e\r\n            \x3cdiv class\x3d"bg-ft-img bg-locate feature-toolbar-btn float-right" data-dojo-attach-point\x3d"locateButton"\r\n              data-dojo-attach-event\x3d"onclick:_locate , keydown:_locate" role\x3d"button" aria-label\x3d"${nls.featureToolbar.locate}"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\r\n    \x3c!--location controls table--\x3e\r\n    \x3ctable class\x3d"page-table display-none" cellpading\x3d"0" data-dojo-attach-point\x3d"locationControlTable"\x3e\r\n      \x3ccolgroup\x3e\r\n        \x3ccol width\x3d"35%" /\x3e\r\n        \x3ccol width\x3d"65%" /\x3e\r\n      \x3c/colgroup\x3e\r\n      \x3ctbody\x3e\x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n\r\n  \x3c/div\x3e\r\n\r\n\x3c/div\x3e\r\n\r\n'}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/keys dijit/registry dijit/form/ValidationTextBox jimu/dijit/formSelect dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/query dojo/on dijit/form/DateTextBox dojo/text!./templates/Feature.html dojo/Deferred ./FeatureToolbar esri/tasks/query jimu/dijit/Popup jimu/utils esri/lang".split(" "),function(w,d,e,f,g,l,m,x,u,t,y,z,A,B,p,C,D,E,n,F,q,v,r,G){return w([y,
z,A,B],{baseClass:"cf-feature",declaredClass:"CriticalFacilities.Feature",templateString:E,_started:null,label:"Feature",parent:null,nls:null,map:null,appConfig:null,config:null,_featureToolbar:null,fields:[],feature:null,fileAddress:{},isDuplicate:!1,isDuplicateLocated:!1,isUnMatchedLocated:!1,isUnMatched:!1,_useGeomFromFile:!1,_useGeomFromLayer:!0,_useValuesFromFile:!1,_useValuesFromLayer:!0,_featureExpanded:!1,_locationExpanded:!1,theme:"",styleColor:"black",layer:null,_changedFileAttributeRows:[],
_changedLayerAttributeRows:[],_changedAddressRows:[],_editToolbar:null,_featureQuery:null,_skipFields:[],csvStore:null,constructor:function(a){d.mixin(this,a)},postCreate:function(){this.inherited(arguments);this.pageHintDiv.innerHTML=this.pageHint;this.pageTitleDiv.innerHTML=this.pageTitle;l.set(this.featureTitleTable,"aria-label",this.pageTitle+" "+this.pageHint);this._initUnMatched();this._initToolbar(this.featureToolbar);this._updateAltIndexes();this.lastFocusNode=this.locationTr},_initUnMatched:function(){if((this.isUnMatched=
-1!==this.label.indexOf("UnMatchedFeatures"))&&this.feature.fieldInfo&&this.feature.fieldInfo.length)for(var a=0;a<this.feature.fieldInfo.length;a++){var b=this.feature.fieldInfo[a];"matchScore"===b.name&&(this.isUnMatchedLocated=0!==b.value)}},_updateAltIndexes:function(){if(this.pageContainer){var a=this.pageContainer.getViewByTitle("Review");a&&(this.altHomeIndex=a.index)}},_initSkipFields:function(a){this._skipFields=["DestinationOID","matchScore","hasDuplicateUpdates","duplicateState",this.layer.objectIdField];
e.forEach(a,d.hitch(this,function(a){-1<a.name.indexOf(this.csvStore.matchFieldPrefix)&&this._skipFields.push(a.name)}))},startup:function(){var a=this.feature.fieldInfo;this._initSkipFields(a);this._initRows(a,this.featureControlTable);this.isDuplicate?this._initDuplicateReview(a):this._initStandardReview();this._getFeature().then(d.hitch(this,function(a){this._feature=a;this._featureToolbar._panToAndSelectFeature(a);!this.isDuplicate&&this._feature&&this._feature.geometry&&this._toggleEditControls(!1)}));
this._getEditFeature().then(d.hitch(this,function(a){this._editFeature=a;this.isDuplicate&&this._editFeature&&this._editFeature.geometry&&this._toggleLocationControls(!0)}));this.onShown()},onShown:function(){this._isReviewed=!0;this._showView();this._featureToolbar._panToAndSelectFeature(this.isDuplicate&&this._useGeomFromLayer?this._editFeature:this._feature);this.isShowing=!0;this.pageContainer.nextDisabled=!1;this.pageContainer.backDisabled=!1;!this.isDuplicate&&this._feature&&this._feature.geometry&&
this._toggleEditControls(!1);this.isDuplicate&&this._useGeomFromFile&&"make-change"===this._duplicateFlag.fromSelect.value&&this._toggleEditControls(!1)},onHidden:function(){this.isShowing=!1},validate:function(a,b){var c=new n;"next-view"===a?c.resolve(this._nextView()):"back-view"===a?c.resolve(this._backView()):this._homeView(b).then(function(a){c.resolve(a)});return c},_nextView:function(){return!0},_backView:function(){return!0},_homeView:function(a){var b=new n;this.pageContainer.getViewByTitle("Home").verifyClearSettings(a).then(function(a){b.resolve(a)});
return b},_showView:function(){g.remove(this.featureTitleTable,"display-none");g.remove(this.featureTable,"display-none");g.remove(this.featureToggleTable,"display-none");g.remove(this.locationSyncTable,"display-none");g.remove(this.locationControlTable,"display-none");g.remove(this.locationControlToggleTable,"display-none");g.remove(this.featureToolbarTable,"display-none");this.isDuplicate&&g.remove(this.reviewText,"display-none");this._updateInfoRows()},_getFeature:function(){var a=new n,b=this.layer.objectIdField,
c=this.feature.fieldInfo.filter(function(a){return a.name===b});this._featureQuery=new q;this._featureQuery.objectIds=[c[0].value];this.layer.queryFeatures(this._featureQuery).then(d.hitch(this,function(b){a.resolve(b.features[0])}));return a},_getEditFeature:function(){var a=new n,b=this.feature.fieldInfo.filter(function(a){return"DestinationOID"===a.name});b&&0<b.length?(this._editQuery=new q,this._editQuery.objectIds=[b[0].value],this.parent.editLayer.queryFeatures(this._editQuery).then(d.hitch(this,
function(b){a.resolve(b.features[0])}))):a.resolve();return a},_initStandardReview:function(){this._useValuesFromFile=!0;this._useValuesFromLayer=!1},_initDuplicateReview:function(a){this._initDuplicateSelect();this._initDuplicateReviewRows(a);g.add(this.featureToolbar,"display-none")},_initDuplicateSelect:function(){var a=new t({"aria-label":this.nls.review.item,style:{display:"table","min-width":"100px",height:"28px"},options:[{label:this.nls.review.duplicateAction,value:"no-change",selected:!0},
{label:this.nls.review.duplicateModify,value:"make-change"},{label:this.nls.review.duplicateSave,value:"not-duplicate"}],onChange:d.hitch(this,this._updateDuplicateUI)});this._duplicateFlag.fromSelect=a;f.place(a.domNode,this._duplicateFlag);a.startup();this._toggleEditControls(!0)},_updateDuplicateUI:function(a){this._updateDuplicateAttributes(a,null);"make-change"===a?g.remove(this.featureToolbar,"display-none"):g.add(this.featureToolbar,"display-none");this._toggleEditControls("make-change"===
a?!1:!0);"not-duplicate"===a&&this._showShouldLocateFeaturePopup().then(d.hitch(this,function(b){b?(this.resetAddressValues(this._featureToolbar._originalValues,a),this._featureToolbar._locateFeature(!0).then(d.hitch(this,function(){var a=new v({titleLabel:this.nls.review.featureLocated,width:400,autoHeight:!0,content:f.create("div",{innerHTML:this.nls.warningsAndErrors.itemMoveMatch,style:"padding-bottom: 10px;"}),buttons:[{label:this.nls.ok,onClick:d.hitch(this,d.hitch(this,function(){a.close();
a=null}))}],onClose:d.hitch(this,function(){a=null;this._featureToolbar._save({},!0)})})}))):this._duplicateFlag.fromSelect.set("value","no-change")}));this._updateLocationPanelLastNode()},_updateDuplicateAttributes:function(a,b){this._feature.attributes.duplicateState=null!==a?a:this._feature.attributes.duplicateState;this._feature.attributes.hasDuplicateUpdates=null!==b?b:this._feature.attributes.hasDuplicateUpdates},_showShouldLocateFeaturePopup:function(){var a=new n,b=f.create("div");f.create("div",
{innerHTML:this.nls.warningsAndErrors.itemWillBeLocated,style:"padding-bottom: 10px;"},b);f.create("div",{innerHTML:this.nls.warningsAndErrors.proceed},b);var c=new v({titleLabel:this.nls.review.locateFeature,width:400,autoHeight:!0,content:b,buttons:[{label:this.nls.yes,onClick:d.hitch(this,function(){c.close();c=null;a.resolve(!0)})},{label:this.nls.no,onClick:d.hitch(this,function(){c.close();c=null;a.resolve(!1)})}],onClose:function(){c=null}});return a},_initDuplicateReviewRows:function(a){var b=
f.create("tr",{className:"bottom-border",isHeaderRow:!0},this.reviewTable);f.create("td",{className:"text-left"},b);var c=f.create("td",{className:"text-left"},b);f.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.target},c);b=f.create("td",{className:"text-left"},b);f.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.source},b);e.forEach(a,d.hitch(this,function(a){if(-1===this._skipFields.indexOf(a.name)){var b=
f.create("tr",{className:"bottom-border",isLabelRow:!0,isControlRow:!0},this.reviewTable);b.fieldName=a.name;b.parent=this;var c=f.create("td",{className:"field-control-td text-left"},b);f.create("div",{className:"main-text float-left",innerHTML:a.label},c);this._initLabel(b,a.duplicateFieldInfo.value,!1,!1);this._initLabel(b,a.value,!0,!1)}}))},_initToolbar:function(a){this._featureToolbar=new F({nls:this.nls,map:this.map,parent:this.parent,config:this.config,appConfig:this.appConfig,feature:this.feature,
theme:this.theme,layer:this.layer,featureView:this,_editToolbar:this._editToolbar,csvStore:this.csvStore,_stageLayer:this.csvStore.matchedFeatureLayer,styleColor:this.styleColor,pageContainer:this.pageContainer});this._featureToolbar.placeAt(a);this._featureToolbar.startup()},_initRows:function(a,b){if(this.isDuplicate){this._initSelectRow(this.nls.review.use,this.locationControlTable,this._useGeomChanged,"geom");this._initSelectRow(this.nls.review.use,this.featureControlTable,this._useValuesChanged,
"values");var c=f.create("tr",{className:"bottom-border",isHeaderRow:!0},b);f.create("td",{className:"text-left"},c);var h=f.create("td",{className:"text-left"},c);f.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.target},h);c=f.create("td",{className:"text-left"},c);f.create("div",{className:"duplicate-col-headers main-text float-left",innerHTML:this.nls.review.source},c)}(this._syncEnabled=0<Object.keys(this._parentFeatureList._syncFields).length)?
this._syncFields=this._parentFeatureList._syncFields:g.add(this.syncFields,"display-none");var k=0;e.forEach(a,d.hitch(this,function(a){if(-1===this._skipFields.indexOf(a.name)){var c=f.create("tr",{className:"bottom-border",isRadioRow:!1,isEditRow:!0,rowIndex:k},b);c.fieldName=a.name;c.parent=this;var h=f.create("td",{className:"field-control-td text-left field-row-width pad-left-5"},c);f.create("div",{className:"main-text float-left",innerHTML:a.label},h);this.isDuplicate&&this._initValidationBox(a.label,
c,a.duplicateFieldInfo.value,!1,!1);this._initValidationBox(a.label,c,a.value,!0,!1);k+=1}}));this.addressFields=this.csvStore.useMultiFields?this.csvStore.multiFields:this.csvStore.useAddr?this.csvStore.singleFields:this.getXYFields();e.forEach(this.addressFields,d.hitch(this,function(a){var b=f.create("tr",{className:"bottom-border",isRadioRow:!1,isEditRow:!1,isAddressRow:!0},this.locationControlTable);b.label=a.label;b.keyField=a.keyField;b.parent=this;var c=f.create("td",{className:"field-control-td text-left pad-left-5"},
b);f.create("div",{className:"main-text float-left",innerHTML:a.label},c);var h=this.csvStore.matchFieldPrefix,c=this.feature.fieldInfo.filter(function(b){return b.name===h+a.keyField})[0];this._initValidationBox(a.label,b,c.value,!1,!0)}))},_syncAddressInfo:function(a){"keydown"===a.type&&a.keyCode!==m.ENTER&&a.keyCode!==m.SPACE||this._featureToolbar._syncDisabled||(a=this._getAddress(),this._updateAddressFields(a,!0),this._featureToolbar._hasAddressEdit=!1,this._featureToolbar._updateSync(!0))},
_locate:function(a){this._featureToolbar._locate(a)},getXYFields:function(){this._featureToolbar._isAddressFeature=!1;var a=this.parent._pageContainer.getViewByTitle("Coordinates"),b=a.xField,a=a.yField;this._featureToolbar.xField=this.csvStore.xFieldName;this._featureToolbar.yField=this.csvStore.yFieldName;return[{keyField:this.csvStore.xFieldName,label:b.label,value:this.csvStore.xFieldName},{keyField:this.csvStore.yFieldName,label:a.label,value:this.csvStore.yFieldName}]},_updateAddressFields:function(a,
b){this._address=a;b?e.forEach(this.locationControlTable.rows,d.hitch(this,function(a){if(this._syncFields.hasOwnProperty(a.keyField))for(var b=this._syncFields[a.keyField],c=0;c<this.featureControlTable.rows.length;c++){var f=this.featureControlTable.rows[c];if(f.isEditRow&&f.fieldName===b.layerFieldName){a=this.csvStore.matchFieldPrefix+a.keyField;a=this._address&&this._address.hasOwnProperty(a)?this._address[a]:"";this.isDuplicate&&this._useValuesFromLayer?(f.layerValueTextBox.set("value",a),f.layerValueTextBox.emit("keyUp")):
(f.fileValueTextBox.set("value",a),f.fileValueTextBox.emit("keyUp"));break}}})):e.forEach(this.locationControlTable.rows,d.hitch(this,function(a){var b=this.csvStore.useAddr&&!this.csvStore.useMultiFields?"Match_addr":a.keyField;a.addressValueTextBox&&(this.csvStore.useAddr||(b=this.csvStore.xFieldName===b?"x":"y"),b=this._address&&this._address.hasOwnProperty(b)?this._address[b]:"",a.addressValueTextBox.set("value",b))}))},_validateAddressDifference:function(){var a=!1;this.locationControlTable&&
e.forEach(this.locationControlTable.rows,d.hitch(this,function(b){if(this._syncFields&&this._syncFields.hasOwnProperty(b.keyField)&&!a){var c=b.addressValueTextBox.displayedValue;b=this._syncFields[b.keyField];for(var h=0;h<this.featureControlTable.rows.length;h++){var k=this.featureControlTable.rows[h];if(k.isEditRow&&k.fieldName===b.layerFieldName&&!a){a=this.isDuplicate&&this._useValuesFromLayer?k.layerValueTextBox.displayedValue!==c:k.fileValueTextBox.displayedValue!==c;break}}}}));return a},
_getAddress:function(){this._address={};e.forEach(this.locationControlTable.rows,d.hitch(this,function(a){a.addressValueTextBox&&(this._address[this.csvStore.matchFieldPrefix+a.keyField]=a.addressValueTextBox.value)}));return this._address},_getAddressFieldsValues:function(){var a={};e.forEach(this.locationControlTable.rows,function(b){b.addressValueTextBox&&(a[b.keyField]=b.addressValueTextBox.value)});return a},_initLabel:function(a,b,c,h){var k=this._getField(a),d=f.create("td",{className:"field-control-td field-row-width2"},
a),e=new u({style:{width:"100%",height:"32px"},title:b,invalidMessage:this.nls.review.valuesDoNotMatch});e.decimalSeperator=this.csvStore.decimalSeperator;this._addLocalizeFloatSupport(e,b,h,k);e.set("value",b);e.set("readonly",!0);e.placeAt(d);e.startup();e.isFile=c;e.isAddress=h;e.row=a;e.parent=this;c?(a.fileValueTextBox=e,a.fileValue=b):h?(a.addressValueTextBox=e,a.addressValue=b):(a.layerValueTextBox=e,a.layerValue=b);c&&(e.validator=this._valuesMatch,e.validate())},_initValidationBox:function(a,
b,c,h,k){var d=this._getField(b),g=f.create("td",{className:"field-control-td",colspan:this.isDuplicate?1:2},b);if(d&&d.type&&"date"===d.type){var l=d.fieldInfo&&d.fieldInfo.format?d.fieldInfo:void 0;c=-1===[null,void 0,""].indexOf(c)?new Date(c):void 0;var m=-1===[null,void 0,""].indexOf(c)?!0:!1;a=new D({"aria-label":a,style:{width:"100%",height:"32px"},title:m?l?r.localizeDateByFieldInfo(c,l):r.localizeDate(c):"",onChange:this._onChange})}else if(d&&d.domainValues){l=function(a){var b;-1<d.values.indexOf(a)&&
(b=d.domainValues.filter(function(b){return b.label===a}));return b&&-1<b.length?b[0].value:a};c=-1<[null,void 0,""].indexOf(c)?"":-1<d.codes.indexOf(c)?c:l(c);var n=[{label:this.nls.review.selectValue,value:null,selected:!0}],p=c;e.forEach(d.domainValues,function(a){if(c.toString()===a.value.toString()||c.toString()===a.label.toString())p=a.label;n.push({label:a.label,value:a.value})});a=new t({"aria-label":a,style:{width:"100%",height:"32px"},options:n,onChange:this._onChange,title:p});g.style.overflow=
"hidden"}else a=new u({"aria-label":a,style:{width:"100%",height:"32px"},title:c});a.decimalSeperator=this.csvStore.decimalSeperator;this._addLocalizeFloatSupport(a,c,k,d);a.set("intermediateChanges",!0);a.set("value",this.isDuplicate&&k?"":c);a.placeAt(g);a.startup();this.lastValueTextBox=a.domNode;a.isFile=h;a.isAddress=k;a.row=b;a.featureToolbar=this._featureToolbar;if(!k){var q;d&&d.length&&(q=G.substitute({num:d.length},this.nls.warningsAndErrors.rangeMessage));a.invalidLengthMessage=q;a.invalidTypeMessage=
this.nls.warningsAndErrors.invalidMessage;a.fieldLength=d.length;a.fieldType=d.type;a.fieldNullable=d.nullable;d&&d.type&&"date"!==d.type&&(a.validator=this._valuesValidForType)}a.parent=this;h?(b.fileValueTextBox=a,b.fileValue=c):k?(b.addressValueTextBox=a,b.addressValue=c):(b.layerValueTextBox=a,b.layerValue=c);a.on("keyUp",function(a){var b;a="undefined"!==typeof a.target.value?this.parent._getValue(a.target.value):"date"===this.fieldType?"":this.value;if(this.isAddress)a=a!==this.parent._getValue(this.row.addressValue),
b=this.parent._changedAddressRows.indexOf(this.row.rowIndex),-1===b&&a?this.parent._changedAddressRows.push(this.row.rowIndex):-1<b&&!a&&this.parent._changedAddressRows.splice(b,1),this.parent.emit("address-change",0<this.parent._changedAddressRows.length);else if(b=this.validate(),this.row._isValid=b){b=this.parent._getValue(this.row.fileValue);var c=this.parent._getValue(this.row.layerValue);a=this.isFile?a!==b:a!==c;c=this.isFile?this.parent._changedFileAttributeRows:this.parent._changedLayerAttributeRows;
b=c.indexOf(this.row.rowIndex);-1===b&&a?c.push(this.row.rowIndex):-1<b&&!a&&c.splice(b,1);var d=!0;e.forEach(this.parent.featureControlTable.rows,function(a){"undefined"===typeof a._isValid||a._isValid||(d=!1)});d?this.parent.emit("attribute-change",0<c.length):this.featureToolbar._updateSave(!0)}else this.featureToolbar._updateSave(!0)})},_getField:function(a){for(var b,c=0;c<this.csvStore.fsFields.length;c++){var d=this.csvStore.fsFields[c];if(d.name===a.fieldName){b=d;break}}return b},_addLocalizeFloatSupport:function(a,
b,c,d){"."!==a.decimalSeperator&&(c&&!this.csvStore.useAddr||d&&d.type&&"float"===d.type)&&(a.title=-1!==[null,void 0,""].indexOf(b)?"":isNaN(b)||"."===a.decimalSeperator?b:r.localizeNumber(b),a.format=function(a){return-1!==[null,void 0,""].indexOf(a)||isNaN(a)?a:r.localizeNumber(a).toString().replace(".","")},a.parse=function(a){return a&&a.toString&&-1<a.toString().indexOf(this.decimalSeperator)?a.toString().replace(this.decimalSeperator,"."):a})},_onChange:function(a){var b;a="undefined"!==typeof a?
this.parent._getValue(a):"date"===this.fieldType?"":this.value;b=this.validate();if(this.row._isValid=b){b=this.parent._getValue(this.row.fileValue);var c=this.parent._getValue(this.row.layerValue);a=this.isFile?a.toString()!==b.toString():a.toString()!==c.toString();c=this.isFile?this.parent._changedFileAttributeRows:this.parent._changedLayerAttributeRows;b=c.indexOf(this.row.rowIndex);-1===b&&a?c.push(this.row.rowIndex):-1<b&&!a&&c.splice(b,1);var d=!0;e.forEach(this.parent.featureControlTable.rows,
function(a){"undefined"===typeof a._isValid||a._isValid||(d=!1)});d?this.parent.emit("attribute-change",0<c.length):this.featureToolbar._updateSave(!0)}else this.featureToolbar._updateSave(!0)},_valuesValidForType:function(a){var b=a.toString();if(b.length>this.fieldLength)return this.invalidMessage=this.invalidLengthMessage,!1;if(0===b.length)return"undefined"!==typeof this.fieldNullable?this.fieldNullable:!0;this.invalidMessage=this.invalidTypeMessage;switch(this.fieldType){case "int":return/^-?[0-9]+$/.exec(a);
case "float":return"."!==this.decimalSeperator?/^-?[0-9]+[.,]?[0-9]*$/.exec(a):/^-?[0-9]+[.]?[0-9]*$/.exec(a);case "date":if(a)try{return!isNaN((new Date(a)).getTime())}catch(c){return console.error(c),!1}else return!0;case "domainInt":return/^-?[0-9]+$/.exec(a);case "domain":return!0;case "other":return!0}},_valuesMatch:function(){return this.row.fileValueTextBox&&this.row.layerValueTextBox?this.row.fileValueTextBox.value===this.row.layerValueTextBox.value:!0},_validateValues:function(){var a=!0;
e.forEach(this.featureControlTable.rows,d.hitch(this,function(b){if(b.isEditRow){"undefined"===typeof b._isValid||b._isValid||(a=!1);var c="date"===b.fileValueTextBox.fieldType&&b.fileValueTextBox.value.toString()===b.fileValueTextBox._invalidDate?"":this._getValue(b.fileValueTextBox.value),d=this._getValue(b.fileValue),e="date"===b.layerValueTextBox.fieldType&&b.layerValueTextBox.value.toString()===b.layerValueTextBox._invalidDate?"":this._getValue(b.layerValueTextBox.value),f=this._getValue(b.layerValue);
b.parent._useValuesFromFile&&(c===d&&c===f||this._changedFileAttributeRows.push(b.rowIndex));b.parent._useValuesFromLayer&&e!==f&&this._changedLayerAttributeRows.push(b.rowIndex)}}));var b=this._useValuesFromFile?this._changedFileAttributeRows:this._changedLayerAttributeRows;a?this.emit("attribute-change",0<b.length):this._featureToolbar._updateSave(!0)},_getValue:function(a){return-1===[null,void 0,""].indexOf(a)?a:""},_validateGeoms:function(){var a=this._featureToolbar._hasAttributeEdit,b=this._featureToolbar._hasGeometryEdit;
this._useGeomFromLayer?this._featureToolbar._updateSaveAndCancel(!a):b?this._featureToolbar._updateSaveAndCancel(!a&&!b):this._featureToolbar._updateSaveAndCancel(!a)},_initSelectRow:function(a,b,c,d){b=f.create("tr",{className:"task-instruction-row bottom-border",isRadioRow:!0,isEditRow:!1},b);b.radioButtons=[];b.useType=d;var e=f.create("td",{},b);f.create("div",{className:"main-text float-left pad-left-5",innerHTML:a},e);this._createSelect(b,c,d)},_createSelect:function(a,b,c){var e=f.create("td",
{colspan:2,className:"field-control-td"},a);b=new t({style:{display:"table",width:"100%",height:"28px"},options:[{label:this.nls.review.fromLayer,value:"layer",selected:!0},{label:this.nls.review.fromFile,value:"file"}],onChange:d.hitch(this,b)});a.fromSelect=b;f.place(b.domNode,e);b.startup();"geom"===c&&this.own(C(a.fromSelect,"change",d.hitch(this,function(){this._updateLocationPanelLastNode()})))},_useGeomChanged:function(a){this._useGeomFromFile=a="file"===a;this._useGeomFromLayer=!a;a&&this.resetAddressValues(this._featureToolbar._originalValues);
a&&!this._hasBeenLocatedForFile?this._hasBeenLocatedForFile||this._featureToolbar._locateFeature().then(d.hitch(this,function(a){this._featureToolbar._originalValues.duplicateGeometry=a.feature.geometry;this._hasBeenLocatedForFile=!0;var b=[a.feature,this._editFeature];if(a.feature.geometry.x!==this._editFeature.geometry.x||a.feature.geometry.y!==this._editFeature.geometry.y)this.map&&this.map.extent&&this.map.extent.contains?this.map.extent.contains(a.feature.geometry)&&this.map.extent.contains(this._editFeature.geometry)||
this.csvStore._zoomToData(b):this.csvStore._zoomToData(b);this._featureToolbar._flashFeatures(b);this._validateGeoms()})):(this._featureToolbar._updateFeature(this._useGeomFromFile?this._featureToolbar._originalValues.duplicateGeometry:this._editFeature.geometry,!1,!0),this._featureToolbar._flashFeatures([a?this._feature:this._editFeature]),this._validateGeoms());this._useGeomFromLayer&&this._updateAddressFields(this._featureToolbar._originalValues.editAddress,!1);this._toggleLocationControls(!1);
this._syncFields&&this._featureToolbar._updateSync(!this._validateAddressDifference())},_toggleFeature:function(a){if("keydown"!==a.type||a.keyCode===m.ENTER||a.keyCode===m.SPACE)(this._featureExpanded=!this._featureExpanded)?(this._locationExpanded=!1,l.set(this.featureTr,"aria-expanded","true"),l.set(this.locationTr,"aria-expanded","false"),this.lastFocusNode=this.locationTr):l.set(this.featureTr,"aria-expanded","false"),this._updateInfoRows(),this.parent.updateFirstLastNode(!1)},_toggleLocation:function(a){if("keydown"!==
a.type||a.keyCode===m.ENTER||a.keyCode===m.SPACE)(this._locationExpanded=!this._locationExpanded)?(this._featureExpanded=!1,l.set(this.featureTr,"aria-expanded","false"),l.set(this.locationTr,"aria-expanded","true")):(l.set(this.locationTr,"aria-expanded","false"),this.lastFocusNode=this.locationTr),this._updateInfoRows(),this._updateLocationPanelLastNode()},_updateLocationPanelLastNode:function(){var a,b=!1;g.contains(this.toggleLocation,"bg-toggle-down-img")?this.lastFocusNode=this.locationTr:(a=
x.findWidgets(this.locationInformation))&&0<a.length&&(a.reverse(),e.some(a,d.hitch(this,function(a){if(a&&!a.disabled)return b=!0,this.lastFocusNode=a.domNode,!0})));b||(this.lastFocusNode=this.locationTr);this.parent.updateFirstLastNode(!1)},_updateInfoRows:function(){this._updateRow(this._featureExpanded,this.featureInformation,this.toggleFeature);this._updateRow(this._locationExpanded,this.locationInformation,this.toggleLocation)},_updateRow:function(a,b,c){var d=["bg-toggle-up-img","bg-toggle-up-img-white"],
e=["bg-toggle-down-img","bg-toggle-down-img-white"];a?g.remove(b,"display-none"):g.add(b,"display-none");this._updateImageNode(a?d:e,a?e:d,c)},updateImageNodes:function(){var a=this.pageContainer.isDarkTheme,b=a?"next-arrow-img":"next-arrow-img-white",c=a?"next-arrow-img-white":"next-arrow-img",d=p("."+b,this.domNode);e.forEach(d,function(a){g.remove(a,b);g.add(a,c)});b=a?"bg-toggle-up-img":"bg-toggle-up-img-white";c=a?"bg-toggle-up-img-white":"bg-toggle-up-img";d=p("."+b,this.domNode);e.forEach(d,
function(a){g.remove(a,b);g.add(a,c)});b=a?"bg-toggle-down-img":"bg-toggle-down-img-white";c=a?"bg-toggle-down-img-white":"bg-toggle-down-img";d=p("."+b,this.domNode);e.forEach(d,function(a){g.remove(a,b);g.add(a,c)})},_updateImageNode:function(a,b,c){var d=this.pageContainer.isDarkTheme;g.remove(c,d?b[1]:b[0]);g.add(c,d?a[1]:a[0])},_toggleLocationControls:function(a){var b=this.isDuplicate&&this._useGeomFromLayer?!0:a;this.locationControlTable&&e.forEach(this.locationControlTable.rows,function(c){c.fromSelect&&
c.fromSelect.set("disabled",a);c.isAddressRow&&c.addressValueTextBox&&c.addressValueTextBox.set("disabled",b)});b?this._featureToolbar._disableEdit():this._featureToolbar._enableEdit()},_useValuesChanged:function(a){this._useValuesFromFile=a="file"===a;this._useValuesFromLayer=!a;this._toggleEnabled(a);this._validateValues();this._syncFields&&this._featureToolbar._updateSync(!this._validateAddressDifference())},_toggleEnabled:function(a){e.forEach(this.featureControlTable.rows,function(b){b.isRadioRow||
(b.fileValueTextBox&&b.fileValueTextBox.set("disabled",!a),b.layerValueTextBox&&b.layerValueTextBox.set("disabled",a))})},_toggleEditControls:function(a){this.featureControlTable&&e.forEach(this.featureControlTable.rows,function(b){b.isRadioRow&&b.fromSelect.set("disabled",a);b.isEditRow&&(b.fileValueTextBox&&(a?b.fileValueTextBox.set("disabled",a):b.parent.isDuplicate&&b.parent._useValuesFromFile?b.fileValueTextBox.set("disabled",a):b.parent.isDuplicate||b.fileValueTextBox.set("disabled",a)),b.layerValueTextBox&&
(a?b.layerValueTextBox.set("disabled",a):b.parent.isDuplicate&&b.parent._useValuesFromLayer?b.layerValueTextBox.set("disabled",a):b.parent.isDuplicate||b.layerValueTextBox.set("disabled",a)))});this._toggleLocationControls(a)},resetAttributeValues:function(){e.forEach(this.featureControlTable.rows,d.hitch(this,function(a){a.fileValueTextBox&&a.fileValueTextBox.set("value",a.fileValue);a.layerValueTextBox&&a.layerValueTextBox.set("value",a.layerValue)}));this._changedFileAttributeRows=[];this._changedLayerAttributeRows=
[]},resetAddressValues:function(a,b){e.forEach(this.locationControlTable.rows,d.hitch(this,function(c){var d=this.csvStore.useAddr&&!this.csvStore.useMultiFields?"Match_addr":c.keyField;c.addressValueTextBox&&(d=this.isDuplicate&&this._useGeomFromLayer&&"not-duplicate"!==b?a.editAddress&&a.editAddress.hasOwnProperty(d)?a.editAddress[d]:void 0:c.addressValue,c.addressValueTextBox.set("value",d))}))},resetGeometry:function(a){this._feature.geometry=a;this.feature.geometry=a;this._featureToolbar._updateLayer(this.layer,
null,[this._feature],null,!1,!0).then(d.hitch(this,function(){this._featureToolbar._flashFeatures([this._feature])}));this.resetFromLayerRows()},resetFromLayerRows:function(){this.isDuplicate&&(this._featureToolbar._fileGeometryModified||(this._useGeomFromLayer=!0),this._featureToolbar._fileValuesModified||(this._useValuesFromLayer=!0),e.forEach(this.featureControlTable.rows,d.hitch(this,function(a){a.fromSelect&&("geom"===a.useType&&this._useGeomFromLayer||"values"===a.useType&&this._useValuesFromLayer)&&
a.fromSelect.set("value","layer")})),e.forEach(this.locationControlTable.rows,d.hitch(this,function(a){a.fromSelect&&("geom"===a.useType&&!this._useGeomFromLayer||"values"===a.useType&&this._useValuesFromLayer)&&a.fromSelect.set("value","layer")})))},setStyleColor:function(a){this.styleColor=a;this._featureToolbar.styleColor=a}})});