// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/Query/TaskSetting":function(){define("dojo/_base/declare dijit/_WidgetBase jimu/dijit/BindLabelPropsMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./TaskSetting.html dojo/on dojo/keys dojo/Deferred dojo/_base/lang dojo/_base/html dojo/_base/array dojo/promise/all jimu/filterUtils jimu/dijit/FilterParameters ./utils jimu/utils ./SingleQueryLoader ./SpatialFilterByDrawing jimu/dijit/SpatialFilterByFeatures esri/tasks/query esri/dijit/PopupTemplate jimu/dijit/formSelect".split(" "),
function(n,k,q,p,c,f,l,h,r,e,b,a,d,m,v,t,x,A,w,F,G,z,D){return n([k,q,p,c,f],{baseClass:"query-task-setting",templateString:l,askForValues:!1,_defaultRelationship:"SPATIAL_REL_INTERSECTS",nls:null,map:null,currentAttrs:null,layerInfosObj:null,postMixInProperties:function(){this.inherited(arguments);this.isRenderIdForAttrs=!0;this.nls.back=window.jimuNls.common.back},postCreate:function(){this.inherited(arguments);this._initSelf()},run:function(){var a=this._getCleanClonedCurrentAttrs(this.currentAttrs);
a.query.relationship=this._getRestRelationship();var d=this.getWhere(),e=this.getGeometry();m([d,e]).then(b.hitch(this,function(b){this.deactivate();a.query.where=b[0];a.query.geometry=b[1];if("function"===typeof this.onApply)this.onApply(a)}),b.hitch(this,function(a){console.error(a)}))},hideTempLayers:function(){this.spatialFilterByDrawing&&this.spatialFilterByDrawing.hideTempLayers();this.spatialFilterByFeatures&&this.spatialFilterByFeatures.hideTempLayers()},showTempLayers:function(){this.spatialFilterByDrawing&&
this.spatialFilterByDrawing.showTempLayers();this.spatialFilterByFeatures&&this.spatialFilterByFeatures.showTempLayers()},_getCleanClonedCurrentAttrs:function(a){var d=w.getCleanCurrentAttrsTemplate(),m=null,e;for(e in a)if("queryTr"!==e&&"query"!==e&&"layerObject"!==e)if(m=a[e],"relationshipPopupTemplates"===e){for(var g in m)m[g]=new D(m[g].toJson());d[e]=m}else d[e]=b.clone(m);d.queryTr=a.queryTr;d.query.maxRecordCount=a.query.maxRecordCount;return d},onGetQueryResponse:function(){this.deactivate();
this._tryResetSpatialFilterByDrawing();this._tryResetSpatialFilterByFeatures()},getWhere:function(){var a=new e,b=this._getWhereInfo();if(1===b.status){var d=this.currentAttrs.config.webMapLayerId;if(d){var m=null,m=x.isTable(this.currentAttrs.layerInfo)?this.layerInfosObj.getTableInfoById(d):this.layerInfosObj.getLayerInfoById(d),d="";m&&(d=m.getFilter());m=b.where;d&&(m="("+d+") AND ("+b.where+")");a.resolve(m)}else a.resolve(b.where)}else a.reject("Can't get a valid sql");return a},_getWhereInfo:function(){var a=
{status:0,where:""};if(this.askForValues){var b=this.filterParams.getFilterExpr();b&&"string"===typeof b?(a.status=1,a.where=b):(a.status=-1,a.where=null)}else a.status=1,a.where=this.currentAttrs.config.filter.expr;1!==a.status||a.where||(a.where="1\x3d1");return a},_updateExecuteButtonStatus:function(){var b=this._isValidWhereToExecute()&&this._isValidGeometryToExecute()&&this._isValidLayerNameToExecute();b?a.removeClass(this.btnExecute,"disabled"):a.addClass(this.btnExecute,"disabled");return b},
_isValidWhereToExecute:function(){return 0<this._getWhereInfo().status},_isValidLayerNameToExecute:function(){return this.layerNameTextBox.get("value")},_isValidGeometryToExecute:function(){var a=this.spatialTypeSelect.get("value");if("currentMapExtent"!==a){if("drawing"===a)return!!this.spatialFilterByDrawing.getGeometryInfo().geometry;if("useFeatures"===a)return this.spatialFilterByFeatures.isValidSearchDistance()}return!0},getGeometry:function(){var a=new e,d=this.spatialTypeSelect.get("value");
"currentMapExtent"===d?a.resolve(this.map.extent):"drawing"===d?(d=this.spatialFilterByDrawing.getGeometryInfo(),0>d.status?a.reject("Invalid search distance"):(0===d.status&&console.log("User doesn't draw anything"),a.resolve(d.geometry))):"useFeatures"===d?this.spatialFilterByFeatures.getGeometryInfo().then(b.hitch(this,function(b){-2===b.status?a.reject("Invalid search distance"):(-1===b.status?console.log("User doesn't select a layer"):0===b.status&&console.log("User doesn't select any features"),
a.resolve(b.geometry))}),b.hitch(this,function(b){a.reject(b)})):a.resolve(null);return a},deactivate:function(){this.spatialFilterByDrawing&&this.spatialFilterByDrawing.deactivate();this.spatialFilterByFeatures&&this.spatialFilterByFeatures.deactivate()},clearAllGraphics:function(){this.spatialFilterByDrawing&&this.spatialFilterByDrawing.clearAllGraphics();this.spatialFilterByFeatures&&this.spatialFilterByFeatures.clearAllGraphics()},canAutoRunning:function(){return this._canAttributeFilterAutoRunning()&&
this._canSpatialFilterAutoRunning()},_canAttributeFilterAutoRunning:function(){return 0<this._getWhereInfo().status&&!this.askForValues},_canSpatialFilterAutoRunning:function(){var a=this.spatialTypeSelect.getOptions()||[];return 0===a.length?!0:1===a.length?(a=this.spatialTypeSelect.get("value"),"drawing"!==a&&"useFeatures"!==a):!1},_initSelf:function(){var m=this.currentAttrs.config,e=this.currentAttrs.layerInfo,c=this.currentAttrs.layerObject||e,f=m.name||"",f=A.sanitizeHTML(f);this.taskNameDiv.innerHTML=
f;this.taskNameDiv.title=this.taskNameDiv.innerHTML;m.customResultName?this._showLayerNameContainer():this._hideLayerNameContainer();if(this.showFilterLabel){var g=this.criteiraLabel||"",g=A.sanitizeHTML(g);this.criteiraLabelDiv.innerHTML=g;this.criteiraLabelDiv.title=this.criteiraLabelDiv.innerHTML;g=this.spatialFilterLabel||"";g=A.sanitizeHTML(g);this.spatialFilterLabelDiv.innerHTML=g;this.spatialFilterLabelDiv.title=this.spatialFilterLabelDiv.innerHTML;this._showCriteiraLabelDiv();this._showSpatialFilterLabelDiv()}else this.criteiraLabelDiv.innerHTML=
"",this.criteiraLabelDiv.title="",this.spatialFilterLabelDiv.innerHTML="",this.spatialFilterLabelDiv.title="",this._hideCriteiraLabelDiv(),this._hideSpatialFilterLabelDiv();this.filterParams=new t;this.filterParams.placeAt(this.sqlDiv,"before");var E={ifDisplaySQL:!0};this.own(h(this.filterParams,"change",b.hitch(this,this._updateExecuteButtonStatus)));this.own(h(this.filterParams,"enter",b.hitch(this,this._onBtnApplyClicked)));g=b.clone(m.filter);g.wId="widgets_Query_Widget"+this.wId+"_"+this.id;
this.filterParams.build(m.url,c,g,m.webMapLayerId,this.id);c=new v;g=this.currentAttrs.config.filter;this.askForValues=c.isAskForValues(g);var u=!0,c=!1;if(this.askForValues){u=!0;g.displaySQL?this.sqlDiv.innerHTML=g.displaySQL:g.expr&&(this.sqlDiv.innerHTML=g.expr);if(g=this.filterParams.getFilterExpr(E))this.sqlDiv.innerHTML=g;this.own(h(this.filterParams,"change",b.hitch(this,function(){this.sqlDiv.innerHTML="";var a=this.filterParams.getFilterExpr(E);a&&this.currentAttrs.config.showSQL&&(this.sqlDiv.innerHTML=
a)})))}else this.currentAttrs.config.showSQL?u="1\x3d1"!==g.expr:(u=!1,c="1\x3d1"===g.expr),this.sqlDiv.innerHTML=g.displaySQL?g.displaySQL:g.expr;this.currentAttrs.config.showSQL?a.removeClass(this.sqlDiv,"not-visible"):(this.sqlDiv.innerHTML="",a.addClass(this.sqlDiv,"not-visible"));u?(a.removeClass(this.attributesSectionDiv,"not-visible"),(this.showFilterLabel&&""!==this.criteiraLabelDiv.innerHTML||this.currentAttrs.config.showSQL)&&a.setAttr(this.attributesSectionDiv,"tabindex","0")):a.addClass(this.attributesSectionDiv,
"not-visible");g=this.currentAttrs.config.spatialFilter;u=null;g||(g={});x.isTable(e)&&(g={});g.currentMapExtent&&(u={value:"currentMapExtent",label:this.nls.useCurrentExtentTip},this.spatialTypeSelect.addOption(u),g.currentMapExtent["default"]&&this.spatialTypeSelect.set("value",u.value));g.drawing&&(u={value:"drawing",label:this.nls.useDrawGraphicTip},this.spatialTypeSelect.addOption(u),g.drawing["default"]&&this.spatialTypeSelect.set("value",u.value),u=g.drawing.buffer,this.spatialFilterByDrawing=
new F({drawBoxOption:{map:this.map,geoTypes:g.drawing.geometryTypes},nls:this.nls,enableBuffer:!!u,distance:b.getObject("defaultDistance",!1,u)||0,unit:b.getObject("defaultUnit",!1,u)||""}),this.own(h(this.spatialFilterByDrawing,"change",b.hitch(this,this._updateExecuteButtonStatus))),this.spatialFilterByDrawing.placeAt(this.drawingSection));if(g.useFeatures){u={value:"useFeatures",label:this.nls.useFeaturesTip};this.spatialTypeSelect.addOption(u);g.useFeatures["default"]&&this.spatialTypeSelect.set("value",
u.value);var u=g.useFeatures.buffer,l=[];m.webMapLayerId&&l.push(m.webMapLayerId);this.spatialFilterByFeatures=new G({map:this.map,nls:this.nls,enableBuffer:!!u,distance:b.getObject("defaultDistance",!1,u)||0,unit:b.getObject("defaultUnit",!1,u)||"",showLoading:!1,ignoredFeaturelayerIds:l});this.spatialFilterByFeatures.tipNode&&a.setStyle(this.spatialFilterByFeatures.tipNode,"display","block");this.spatialFilterByFeatures.placeAt(this.featuresSection);this.own(h(this.spatialFilterByFeatures,"loading",
b.hitch(this,function(){this.domNode&&this.shelter.show()})));this.own(h(this.spatialFilterByFeatures,"unloading",b.hitch(this,function(){this.domNode&&this.shelter.hide()})));this.own(h(this.spatialFilterByFeatures,"search-distance-change",b.hitch(this,this._updateExecuteButtonStatus)));(m=g.useFeatures.relationships)&&0<m.length?d.forEach(m,b.hitch(this,function(a){this.relationshipSelect.addOption({value:a.relationship,label:a.label})})):this.relationshipSelect.addOption({value:this._defaultRelationship,
label:this._defaultRelationship})}g.fullLayerExtent&&(u={value:"fullLayerExtent",label:this.nls.noSpatialLimitTip},this.spatialTypeSelect.addOption(u),g.fullLayerExtent["default"]&&this.spatialTypeSelect.set("value",u.value));m=!0;g=this.spatialTypeSelect.getOptions()||[];0===g.length?(m=!1,this.spatialFilterTip.innerHTML=this.nls.noSpatialLimitTip):1===g.length?(m="fullLayerExtent"!==g[0].value,this.spatialFilterTip.innerHTML=g[0].label,a.addClass(this.spatialTypeSelect.domNode,"not-visible"),a.setAttr(this.spatialSectionDiv,
"tabindex","0")):m=!0;x.isTable(e)&&(m=!1);m?a.removeClass(this.spatialSectionDiv,"not-visible"):a.addClass(this.spatialSectionDiv,"not-visible");this._onSpatialTypeSelectChanged();c&&!m&&a.removeClass(this.noFilterTip,"not-visible");e=this._getBestQueryName(f);this.layerNameTextBox.set("value",e)},getQueryResultName:function(){return this.layerNameTextBox.get("value")},_getConstantRelationship:function(){var a=this._defaultRelationship;"useFeatures"===this.spatialTypeSelect.get("value")&&(a=this.relationshipSelect.get("value"));
return a},_getRestRelationship:function(){var a=this._getConstantRelationship();return z[a]},_onSpatialTypeSelectChanged:function(){var b=this.spatialTypeSelect.get("value");"drawing"===b?a.setStyle(this.drawingSection,"display","block"):(a.setStyle(this.drawingSection,"display","none"),this._tryResetSpatialFilterByDrawing());"useFeatures"===b?a.setStyle(this.featuresSection,"display","block"):(a.setStyle(this.featuresSection,"display","none"),this._tryResetSpatialFilterByFeatures());this.spatialTypeSelect.domNode.title=
"";b&&(b=this.spatialTypeSelect.getOptions(b))&&(this.spatialTypeSelect.domNode.title=b.label);this._updateExecuteButtonStatus()},_tryResetSpatialFilterByDrawing:function(){this.spatialFilterByDrawing&&this.spatialFilterByDrawing.reset()},_tryResetSpatialFilterByFeatures:function(){this.spatialFilterByFeatures&&this.spatialFilterByFeatures.reset()},_onBtnParamsBackClicked:function(){this._tryResetSpatialFilterByDrawing();this._tryResetSpatialFilterByFeatures();if("function"===typeof this.onBack)this.onBack()},
_onBtnParamsBackKeydown:function(a){a.keyCode!==r.ENTER&&a.keyCode!==r.SPACE||this._onBtnParamsBackClicked()},_getBestQueryName:function(a){for(var m=a=a?a+(" _"+this.nls.queryResult):a+this.nls.queryResult,e=d.map(this.map.graphicsLayerIds,b.hitch(this,function(a){return this.map.getLayer(a).name})),c=2;0<=d.indexOf(e,m);)m=a+"_"+c,c++;return m},_onLayerNameTextChanged:function(){this._updateExecuteButtonStatus()},_onBtnApplyClicked:function(){this._updateExecuteButtonStatus()&&this.run()},_onBtnApplyKeydown:function(a){a.keyCode!==
r.ENTER&&a.keyCode!==r.SPACE||this._onBtnApplyClicked()},_showLayerNameContainer:function(){a.setStyle(this.layerNameContainer,"display","block")},_hideLayerNameContainer:function(){a.setStyle(this.layerNameContainer,"display","none")},_showCriteiraLabelDiv:function(){a.setStyle(this.criteiraLabelDiv,"display","block")},_hideCriteiraLabelDiv:function(){a.setStyle(this.criteiraLabelDiv,"display","none")},_showSpatialFilterLabelDiv:function(){a.setStyle(this.spatialFilterLabelDiv,"display","block")},
_hideSpatialFilterLabelDiv:function(){a.setStyle(this.spatialFilterLabelDiv,"display","none")}})})},"widgets/Query/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/Deferred jimu/utils jimu/portalUrlUtils jimu/LayerInfos/LayerInfos esri/request esri/kernel esri/symbols/PictureMarkerSymbol esri/symbols/jsonUtils".split(" "),function(n,k,q,p,c,f,l,h,r,e){return{getDefaultPopupInfo:function(b,a,d){var m={title:"",fieldInfos:[],description:null,showAttachments:!1,mediaInfos:[]};d=
!!d;if(b.displayField){var e=this._getRealFieldName(b.displayField,b);m.title="{"+e+"}"}else if(e=p.getObjectIdField(b))m.title="{"+e+"}";m.showAttachments=!!b.hasAttachments;e=b=b.fields;a||(e=k.filter(b,n.hitch(this,function(a){return"esriFieldTypeGeometry"!==a.type})));a=k.map(e,n.hitch(this,function(a){a=p.getDefaultPortalFieldInfo(a);a.visible=d;return a}));m.fieldInfos=a;return m},_getRealFieldName:function(b,a){b=b.toUpperCase();if(a.fields&&0<a.fields.length)for(var d=0;d<a.fields.length;d++)if(a.fields[d].name.toUpperCase()===
b)return a.fields[d].name;return""},getPortalFieldInfosWithoutShape:function(b,a){return k.filter(a,n.hitch(this,function(a){return(a=p.getFieldInfoByFieldName(b.fields,a.fieldName))?"esriFieldTypeGeometry"!==a.type:!0}))},getPopupInfoByAttributes:function(b,a){var d=this.getDefaultPopupInfo(b,!1),m=[],e={},c;for(c in a){m.push(c);var f=p.getFieldInfoByFieldName(b.fields,c).type;if("esriFieldTypeSingle"===f||"esriFieldTypeDouble"===f)f=a[c],null!==f&&void 0!==f&&(f=parseFloat(f),isNaN(f)||(f=f.toString().split("."),
2===f.length&&(e[c]=f[1].length)))}d.fieldInfos=k.filter(d.fieldInfos,n.hitch(this,function(a){var b=a.fieldName;e.hasOwnProperty(b)&&(a.format.places=e[b]);return m.indexOf(b)}));return d},upgradePopupToPopupInfo:function(b,a){var d=this.getDefaultPopupInfo(b,!1,!1);d.title=a.title||"";d.title=d.title.replace("${","{");if(a.fields){var m={};k.forEach(a.fields,n.hitch(this,function(a){m[a.name]=a}));k.forEach(d.fieldInfos,n.hitch(this,function(a){var b=a.fieldName,e=m[b];e&&(a.label=e.alias||a.label,
a.visible=!0,"image"===e.specialType&&(b="{"+b+"}",d.mediaInfos.push({title:"",type:"image",caption:a.label,value:{sourceURL:b,linkURL:b}})))}))}return d},isImageServiceLayer:function(b){return b.url&&-1<b.url.indexOf("/ImageServer")},isTable:function(b){return"Table"===b.type},getConfigWithValidDataSource:function(b){b=n.clone(b);var a=f.getInstanceSync();b.queries=k.filter(b.queries,n.hitch(this,function(b){return(b=b.webMapLayerId)?a.getLayerInfoById(b)?!0:!!a.getTableInfoById(b):!0}));return b},
removePopupInfoUnsupportFields:function(b,a){var d=k.map(b.fields,n.hitch(this,function(a){return a.name}));a.fieldInfos&&0<a.fieldInfos.length&&(a.fieldInfos=k.filter(a.fieldInfos,n.hitch(this,function(a){return 0<=d.indexOf(a.fieldName)})))},overridePopupTemplateMethodGetAttachments:function(b,a,d){b.getAttachments=function(b){var m=new q;try{var e=b.attributes[d],f=a+"/"+e+"/attachments";b={url:f,content:{f:"json"},callbackParamName:"callback"};var c="",n=h.id.findCredential(a);n&&n.token&&(c=
"?token\x3d"+n.token);l(b).then(function(a){a=a.attachmentInfos;k.forEach(a,function(a){a.url=f+"/"+a.id+c;a.objectId=e});m.resolve(a)},function(a){m.reject(a)})}catch(F){console.error(F)}return m}},isServiceSupportsOrderBy:function(b){var a=!1;b.advancedQueryCapabilities&&b.advancedQueryCapabilities.supportsOrderBy&&(a=!0);return a},isServiceSupportsPagination:function(b){var a=!1;b.advancedQueryCapabilities&&b.advancedQueryCapabilities.supportsPagination&&(a=!0);return a},isSupportObjectIds:function(b){var a=
0,d=p.getObjectIdField(b);b.currentVersion&&(a=parseFloat(b.currentVersion));return!!d&&(10<=a||b.hasOwnProperty("typeIdField"))},getQueryType:function(b){var a=-1;return a=this.isServiceSupportsOrderBy(b)&&this.isServiceSupportsPagination(b)?1:this.isSupportObjectIds(b)?2:3},getWebMapPopupInfoByUrl:function(b,a){var d=null;a=a.replace(/\/*$/g,"");var m=c.removeProtocol(a);k.some(b.operationalLayers,n.hitch(this,function(a){if(a&&a.url){var b=c.removeProtocol(a.url.replace(/\/*$/g,""));if(a.popupInfo){if(b===
m)return d=a.popupInfo,!0}else if(a.layers&&0<a.layers.length)return k.some(a.layers,n.hitch(this,function(e){return b+"/"+e.id===m?(d=a.popupInfo,!0):!1}))}return!1}));return d},getPopupInfoForRelatedLayer:function(b,a,d){(b=this.getWebMapPopupInfoByUrl(b,a))||(b=this.getDefaultPopupInfo(d,!1,!0));!b.title&&(d=p.getObjectIdField(d))&&(b.title="{"+d+"}");return b},dynamicUpdateConfigIcon:function(b,a){a=window.location.protocol+"//"+window.location.hostname+a;b.icon&&"object"===typeof b.icon?b.icon=
e.fromJson(b.icon):"string"===typeof b.icon&&(a=new r({yoffset:16,type:"picturemarkersymbol",url:b.icon?b.icon:a,width:24,height:24,size:16,xoffset:0}),b.icon=a)},tryGetLayerObject:function(b){var a=new q;if(!b)return a.resolve(),a;b=this._tryGetLayerInfo(b);if(!b)return console.error("Invalid data source"),a.resolve(),a;b.getLayerObject().then(function(b){a.resolve(b)}.bind(this),function(b){a.reject(b)});return a},_tryGetLayerInfo:function(b){var a=f.getInstanceSync(),d=a.getLayerInfoById(b);d||
(d=a.getTableInfoById(b));return d}}})},"widgets/Query/SingleQueryLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred jimu/utils esri/tasks/query esri/tasks/QueryTask esri/layers/FeatureLayer".split(" "),function(n,k,q,p,c,f,l,h){function r(){return{queryTr:null,config:null,layerInfo:null,relationshipLayerInfos:null,relationshipPopupTemplates:null,queryType:-1,query:{maxRecordCount:1E3,resultLayer:null,where:"",geometry:null,relationship:null,nextIndex:0,foundedNum:0,
allCount:0,objectIds:[]}}}n=n(null,{tempResultLayer:null,map:null,currentAttrs:null,constructor:function(e,b){this.map=e;this.currentAttrs=b;0<this.currentAttrs.layerInfo.maxRecordCount&&(this.currentAttrs.query.maxRecordCount=this.currentAttrs.layerInfo.maxRecordCount)},resetCurrentAttrs:function(){this.currentAttrs=r()},getCurrentAttrs:function(){return this.currentAttrs},executeQueryForFirstTime:function(){var e=null,e=this.currentAttrs.query.where,b=this.currentAttrs.query.geometry;return e=1===
this.currentAttrs.queryType?this.doQuery_SupportOrderByAndPagination(e,b):2===this.currentAttrs.queryType?this.doQuery_SupportObjectIds(e,b):this.doQuery_NotSupportObjectIds(e,b)},executeQueryWhenScrollToBottom:function(){var e=null;1===this.currentAttrs.queryType?e=this.onResultsScroll_SupportOrderByAndPagination():2===this.currentAttrs.queryType&&(e=this.onResultsScroll_SupportObjectIds());return e},_isServiceSupportsOrderBy:function(e){var b=!1;e.advancedQueryCapabilities&&e.advancedQueryCapabilities.supportsOrderBy&&
(b=!0);return b},_isServiceSupportsPagination:function(e){var b=!1;e.advancedQueryCapabilities&&e.advancedQueryCapabilities.supportsPagination&&(b=!0);return b},_tryLocaleNumber:function(e){var b=c.localizeNumber(e);if(null===b||void 0===b)b=e;return b},_tryLocaleDate:function(e){var b=c.localizeDate(e);b||(b=e.toLocaleDateString());return b},_getLayerIndexByLayerUrl:function(e){var b=e.lastIndexOf("/");e=e.slice(b+1,e.length);return parseInt(e,10)},_getServiceUrlByLayerUrl:function(e){var b=e.lastIndexOf("/");
return e.slice(0,b)},_isSupportObjectIds:function(e){var b=0;e.currentVersion&&(b=parseFloat(e.currentVersion));return 10<=b||e.hasOwnProperty("typeIdField")},_isImageServiceLayer:function(e){return-1<e.indexOf("/ImageServer")},_isTable:function(e){return"Table"===e.type},_getBestQueryName:function(e){for(var b=e=e?e+(" _"+this.nls.queryResult):e+this.nls.queryResult,a=q.map(this.map.graphicsLayerIds,k.hitch(this,function(a){return this.map.getLayer(a).name})),d=2;0<=q.indexOf(a,b);)b=e+"_"+d,d++;
return b},getObjectIdsForAllRelatedRecordsAction:function(){var e=new p;if(this.currentAttrs.query.objectIds&&0<this.currentAttrs.query.objectIds.length)e.resolve(this.currentAttrs.query.objectIds);else if(1===this.currentAttrs.queryType)e=this._queryIds(this.currentAttrs.query.where,this.currentAttrs.query.geometry,this.currentAttrs.query.relationship);else if(3===this.currentAttrs.queryType){var b=this.currentAttrs.config.objectIdField,a=q.map(this.currentAttrs.query.resultLayer.graphics,k.hitch(this,
function(a){return parseInt(a.attributes[b],10)}));e.resolve(a)}return e},doQuery_SupportOrderByAndPagination:function(e,b){var a=new p,d=k.hitch(this,function(b){console.error(b);a.reject(b)}),m=this.currentAttrs.query.relationship;this._queryCount(e,b,m).then(k.hitch(this,function(f){this.currentAttrs.query.allCount=f;if(0===f)a.resolve([]);else{this.currentAttrs.query.nextIndex=0;this.currentAttrs.query.foundedNum=0;var c=this.currentAttrs.query.maxRecordCount;this._queryWithPaginationAndOrder(e,
b,0,c,m).then(k.hitch(this,function(b){b=b.features;this.currentAttrs.query.nextIndex+=c;this.currentAttrs.query.foundedNum+=b.length;a.resolve(b)}),d)}}),d);return a},onResultsScroll_SupportOrderByAndPagination:function(){var e=new p,b=this.currentAttrs.query.nextIndex;if(this.currentAttrs.query.foundedNum>=this.currentAttrs.query.allCount)return e.resolve([]),e;var a=k.hitch(this,function(a){console.error(a);e.reject(a)}),d=this.currentAttrs.query.maxRecordCount;this._queryWithPaginationAndOrder(this.currentAttrs.query.where,
this.currentAttrs.query.geometry,b,d,this.currentAttrs.query.relationship).then(k.hitch(this,function(a){a=a.features;this.currentAttrs.query.nextIndex+=d;this.currentAttrs.query.foundedNum+=a.length;e.resolve(a)}),a);return e},doQuery_SupportObjectIds:function(e,b){var a=new p,d=k.hitch(this,function(b){console.error(b);a.reject(b)}),m=this.currentAttrs.query.relationship;this._queryIds(e,b,m).then(k.hitch(this,function(b){if(b&&0<b.length){var e=this.currentAttrs.query.allCount=b.length;this.currentAttrs.query.objectIds=
b;this.currentAttrs.query.nextIndex=0;this.currentAttrs.query.foundedNum=0;var f=this.currentAttrs.query.maxRecordCount,c=[],c=e>f?b.slice(0,f):b;this._queryByObjectIds(c,!0,m).then(k.hitch(this,function(b){b=b.features;this.currentAttrs.query.nextIndex+=c.length;this.currentAttrs.query.foundedNum+=b.length;a.resolve(b)}),k.hitch(this,function(a){d(a)}))}else this.currentAttrs.query.allCount=0,a.resolve([])}),d);return a},onResultsScroll_SupportObjectIds:function(){var e=new p,b=this.currentAttrs.query.objectIds,
a=this.currentAttrs.query.nextIndex;if(this.currentAttrs.query.foundedNum>=this.currentAttrs.query.allCount)e.resolve([]);else{var d=b.slice(a,a+Math.min(b.length-a,this.currentAttrs.query.maxRecordCount));if(0===d.length)e.resolve([]);else return this._queryByObjectIds(d,!0,this.currentAttrs.query.relationship).then(k.hitch(this,function(a){a=a.features;this.currentAttrs.query.nextIndex+=d.length;this.currentAttrs.query.foundedNum+=a.length;e.resolve(a)}),k.hitch(this,function(a){e.reject(a)})),
e}},doQuery_NotSupportObjectIds:function(e,b){var a=new p;this._query(e,b,!0,this.currentAttrs.query.relationship).then(k.hitch(this,function(b){b=b.features;this.currentAttrs.query.allCount=b.length;a.resolve(b)}),k.hitch(this,function(b){console.error(b);a.reject(b)}));return a},getOutputFields:function(){var e=[];q.forEach(this.currentAttrs.layerInfo.fields,k.hitch(this,function(b){b&&b.name&&"esriFieldTypeGeometry"!==b.type&&e.push(b.name)}));return e},_getObjectIdField:function(){return this.currentAttrs.config.objectIdField},
_getRequiredFieldNames:function(){var e=k.clone(this.currentAttrs.layerInfo);return(new h({layerDefinition:e,featureSet:null})).getOutFields()},_getPopupInfoFieldNames:function(){var e=[],b=[],a=q.filter(this.currentAttrs.layerInfo.fields,k.hitch(this,function(a){return"esriFieldTypeGeometry"!==a.type})),d=this.currentAttrs.config.popupInfo,b=b.concat(this._getPlaceholderFieldNames(a,d.title));d.description?b=b.concat(this._getPlaceholderFieldNames(a,d.description)):d.fieldInfos&&0<d.fieldInfos.length&&
q.forEach(d.fieldInfos,k.hitch(this,function(a){a.visible&&b.push(a.fieldName)}));d.mediaInfos&&0<d.mediaInfos.length&&q.forEach(d.mediaInfos,k.hitch(this,function(d){b=b.concat(this._getPlaceholderFieldNames(a,d.title));b=b.concat(this._getPlaceholderFieldNames(a,d.caption));if(d=d.value){var e=d.fields;e&&0<e.length&&q.forEach(e,k.hitch(this,function(a){b.push(a)}));d.normalizeField&&b.push(d.normalizeField);d.tooltipField&&b.push(d.tooltipField);d.sourceURL&&(b=b.concat(this._getPlaceholderFieldNames(a,
d.sourceURL)));d.linkURL&&(b=b.concat(this._getPlaceholderFieldNames(a,d.linkURL)))}}));q.forEach(b,k.hitch(this,function(a){0>e.indexOf(a)&&e.push(a)}));return e},_getPlaceholderFieldNames:function(e,b){var a=[];if(b){var d=[];q.forEach(e,k.hitch(this,function(a){a=a.name;0<=b.indexOf("{"+a+"}")&&d.push(a)}));q.forEach(d,k.hitch(this,function(b){0>a.indexOf(b)&&a.push(b)}))}return a},_query:function(e,b,a,d){var c=new f;c.where=e;b&&(c.geometry=b);c.outSpatialReference=this.map.spatialReference;
c.returnGeometry=!!a;c.spatialRelationship=d;c.outFields=this.getOutputFields();return(new l(this.currentAttrs.config.url)).execute(c)},_queryIds:function(e,b,a){var d=new f;d.where=e;b&&(d.geometry=b);d.returnGeometry=!1;d.spatialRelationship=a;d.outSpatialReference=this.map.spatialReference;return(new l(this.currentAttrs.config.url)).executeForIds(d)},_queryByObjectIds:function(e,b,a){var d=new p,c=new f;c.returnGeometry=!!b;c.outSpatialReference=this.map.spatialReference;c.outFields=this.getOutputFields();
c.objectIds=e;c.spatialRelationship=a;(new l(this.currentAttrs.config.url)).execute(c).then(k.hitch(this,function(a){d.resolve(a)}),k.hitch(this,function(c){if(400===c.code){var f=this._getObjectIdField(),m="",h=e.length;q.forEach(e,k.hitch(this,function(a,b){m+=f+" \x3d "+a;b!==h-1&&(m+=" OR ")}));this._query(m,null,b,a).then(k.hitch(this,function(a){d.resolve(a)}),k.hitch(this,function(a){d.reject(a)}))}else d.reject(c)}));return d},_queryCount:function(e,b,a){var d=new f;d.where=e;b&&(d.geometry=
b);d.returnGeometry=!1;d.outSpatialReference=this.map.spatialReference;d.spatialRelationship=a;return(new l(this.currentAttrs.config.url)).executeForCount(d)},_queryWithPaginationAndOrder:function(e,b,a,d,c){var m=new f;m.where=e;b&&(m.geometry=b);m.outSpatialReference=this.map.spatialReference;m.returnGeometry=!0;m.spatialRelationship=c;m.outFields=this.getOutputFields();m.start=a;m.num=d;(e=this.currentAttrs.config.orderByFields)&&0<e.length&&(m.orderByFields=e,e=q.map(e,k.hitch(this,function(a){return a.split(" ")[0]})),
q.forEach(e,k.hitch(this,function(a){0>m.outFields.indexOf(a)&&m.outFields.push(a)})));return(new l(this.currentAttrs.config.url)).execute(m)}});n.getCleanCurrentAttrsTemplate=r;return n})},"widgets/Query/SpatialFilterByDrawing":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/on dojo/Evented dojo/_base/html dojo/_base/lang jimu/symbolUtils jimu/dijit/DrawBox jimu/dijit/SearchDistance esri/graphic esri/symbols/jsonUtils esri/layers/GraphicsLayer esri/renderers/SimpleRenderer esri/geometry/geometryEngine".split(" "),
function(n,k,q,p,c,f,l,h,r,e,b,a,d,m,v,t){return n([k,q,p,f],{baseClass:"jimu-query-spatial-filter-drawing",templateString:'\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d"drawBoxDiv"\x3e\x3c/div\x3e\x3cdiv style\x3d"margin-top: 15px;" data-dojo-attach-point\x3d"clearShapeCbx"data-dojo-props\x3d"checked:true" data-dojo-type\x3d"jimu/dijit/CheckBox"\x3e\x3c/div\x3e\x3cdiv class\x3d"search-distance-div" data-dojo-attach-point\x3d"searchDistanceDiv"\x3e\x3c/div\x3e\x3c/div\x3e',map:null,bufferLayer:null,
drawBoxOption:null,nls:null,enableBuffer:!0,distance:0,unit:"",postCreate:function(){this.inherited(arguments);this.clearShapeCbx.setLabel(this.nls.clearShapeTip);this.map=this.drawBoxOption.map;this.bufferLayer=new m;var a=d.fromJson({style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}}),f=new v(a);this.bufferLayer.setRenderer(f);this.map.addLayer(this.bufferLayer);this.drawBoxOption.showClear=!0;this.drawBoxOption.keepOneGraphic=
!0;this.drawBox=new e(this.drawBoxOption);this.drawBox.setPolygonSymbol(a);a=r.getGreyPinMarkerSymbol();this.drawBox.setPointSymbol(a);this.drawBox.setLineSymbol(d.fromJson({color:[79,129,189,255],width:1.5,type:"esriSLS",style:"esriSLSDash"}));this.drawBox.placeAt(this.drawBoxDiv);this.own(c(this.drawBox,"user-clear",h.hitch(this,this._onDrawBoxClear)));this.own(c(this.drawBox,"draw-end",h.hitch(this,this._onDrawEnd)));this.drawBox.btnClear?l.removeClass(this.drawBox.btnClear,"jimu-float-trailing"):
l.addClass(this.drawBox.btnClear,"jimu-float-leading");this.searchDistance=new b({distance:this.distance,unit:this.unit});this.searchDistance.placeAt(this.searchDistanceDiv);this.enableBuffer?(this.searchDistance.enable(),this.own(c(this.searchDistance,"change",h.hitch(this,this._onSearchDistanceChange)))):(this.searchDistance.disable(),l.setStyle(this.searchDistanceDiv,"display","none"))},reset:function(a){this.clearShapeCbx.getValue()&&(this.drawBox.reset(),this.clearAllGraphics());a&&(this.searchDistance.reset(),
this.searchDistance.setDistance(this.distance),this.searchDistance.setUnit(this.unit))},clearAllGraphics:function(){this.drawBox.clear();this._clearBufferLayer()},hideTempLayers:function(){this.bufferLayer&&this.bufferLayer.hide();this.drawBox&&this.drawBox.hideLayer()},showTempLayers:function(){this.bufferLayer&&this.bufferLayer.show();this.drawBox&&this.drawBox.showLayer()},deactivate:function(){this.drawBox&&this.drawBox.deactivate()},isValidSearchDistance:function(){return 0<=this._getStatusOfSearchDistance()},
getGeometryInfo:function(){var a={status:0,geometry:null},b=this._getStatusOfSearchDistance();0>b?(a.status=-1,a.geometry=null,this.searchDistance.tryShowValidationError()):0===b?(a.geometry=this._getGeometryFromDrawBox(),a.status=a.geometry?1:0):0<b&&(0<this.bufferLayer.graphics.length&&(a.geometry=this.bufferLayer.graphics[0].geometry),a.status=a.geometry?1:0);return a},_getGeometryFromDrawBox:function(){var a=null,b=this.drawBox.getFirstGraphic();b&&(a=b.geometry);return a},_getGeometryFromBufferLayer:function(){var a=
null;0<this.bufferLayer.graphics.length&&(a=this.bufferLayer.graphics[0].geometry);return a},_getStatusOfSearchDistance:function(){return this.searchDistance.getStatus()},_onSearchDistanceChange:function(){this._updateBuffer()},_onDrawBoxClear:function(){this._clearBufferLayer()},_onDrawEnd:function(){this._updateBuffer()},_clearBufferLayer:function(){this.bufferLayer&&this.bufferLayer.clear();this.emit("change")},_updateBuffer:function(){this._clearBufferLayer();if(0<this._getStatusOfSearchDistance()){var b=
this._getGeometryFromDrawBox();if(b){var d=this.searchDistance.getData(),b=t.simplify(b),e=b.spatialReference,c=null,c=e.isWebMercator()||4326===e.wkid?t.geodesicBuffer(b,d.distance,d.bufferUnit,!0):t.buffer(b,d.distance,d.bufferUnit,!0),b=new a(c);this.bufferLayer.add(b)}}this.emit("change")},destroy:function(){this.bufferLayer&&this.map.removeLayer(this.bufferLayer);this.bufferLayer=null;this.inherited(arguments)}})})},"jimu/dijit/SearchDistance":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SearchDistance.html dojo/Evented dojo/_base/lang jimu/utils jimu/dijit/CheckBox esri/tasks/GeometryService jimu/dijit/formSelect dijit/form/NumberTextBox".split(" "),
function(n,k,q,p,c,f,l,h,r,e){return n([k,q,p,f],{baseClass:"jimu-dijit-searchdistance",templateString:c,lastMeters:0,tip:"",distance:0,unit:"",postMixInProperties:function(){this.inherited(arguments);this.nls=l.clone(window.jimuNls.units);this.tip||(this.tip=window.jimuNls.searchDistance.applySearchDistance)},postCreate:function(){this.inherited(arguments);this.cbx=new r({label:this.tip,onChange:l.hitch(this,this._onCbxChanged)});this.cbx.placeAt(this.cbxDiv);this.reset();this.setDistance(this.distance);
this.setUnit(this.unit);this.lastMeters=this.getMeters()},enable:function(){this.cbx.check()},disable:function(){this.cbx.uncheck()},isEnabled:function(){return this.cbx.getValue()},reset:function(){this.numberTextBox.set("value",0);this.unitSelect.set("value","MILES")},getData:function(){return{status:this.getStatus(),isEnabled:this.isEnabled(),distance:this.getDistance(),unit:this.getUnit(),bufferUnit:this.getUnitToBuffer(),meters:this.getMeters()}},getStatus:function(){var b;this.isEnabled()?(b=
this.getDistance(),b=0<b?1:0===b?0:-1):b=0;return b},getMeters:function(){var b=0,a=this.getStatus();if(0<a){var a=this.getDistance(),d=this.getUnit();"MILES"===d?b=1609.344*a:"KILOMETERS"===d?b=1E3*a:"FEET"===d?b=.3048*a:"METERS"===d?b=a:"YARDS"===d?b=.9144*a:"NAUTICAL_MILES"===d&&(b=1852*a);b=parseFloat(b.toFixed(3))}else 0===a?b=0:0>a&&(b=-1);return b},setDistance:function(b){"number"===typeof b&&0<=b&&this.numberTextBox.set("value",b)},setUnit:function(b){b&&"string"===typeof b&&this.unitSelect.set("value",
b)},tryShowValidationError:function(){this.numberTextBox.validate()||h.showValidationErrorTipForFormDijit(this.numberTextBox)},getDistance:function(){return this.numberTextBox.validate()?this.numberTextBox.get("value"):(h.showValidationErrorTipForFormDijit(this.numberTextBox),-1)},getUnit:function(){return this.unitSelect.get("value")},getUnitToBuffer:function(){var b="";switch(this.unitSelect.get("value")){case "MILES":b=e.UNIT_STATUTE_MILE;break;case "KILOMETERS":b=e.UNIT_KILOMETER;break;case "FEET":b=
e.UNIT_FOOT;break;case "METERS":b=e.UNIT_METER;break;case "YARDS":b=e.UNIT_INTERNATIONAL_YARD;break;case "NAUTICAL_MILES":b=e.UNIT_NAUTICAL_MILE}return b},_onCbxChanged:function(){this.cbx.getValue()?(this.numberTextBox.set("disabled",!1),this.unitSelect.set("disabled",!1)):(this.numberTextBox.set("disabled",!0),this.unitSelect.set("disabled",!0));this._emitEvent()},_onNumberTextBoxChanged:function(){this._emitEvent()},_onUnitSelectChanged:function(){this._emitEvent()},_emitEvent:function(){var b=
this.getData();b.meters!==this.lastMeters&&(this.lastMeters=b.meters,this.emit("change",b))}})})},"jimu/dijit/SpatialFilterByFeatures":function(){define("dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SpatialFilterByFeatures.html dojo/on dojo/Evented dojo/Deferred dojo/_base/html dojo/_base/lang jimu/utils jimu/Query jimu/dijit/CheckBox jimu/dijit/FeaturelayerChooserFromMap jimu/dijit/LayerChooserFromMapWithDropbox jimu/dijit/SearchDistance jimu/LayerInfos/LayerInfos esri/graphic esri/tasks/query esri/symbols/jsonUtils esri/layers/GraphicsLayer esri/renderers/SimpleRenderer esri/geometry/geometryEngine jimu/dijit/FeatureSetChooserForSingleLayer".split(" "),
function(n,k,q,p,c,f,l,h,r,e,b,a,d,m,v,t,x,A,w,F,G,z,D,C,J){k=k([q,p,c,h],{baseClass:"jimu-dijit-spatial-filter-features",templateString:f,_bufferLayer:null,_defaultRelationship:"SPATIAL_REL_INTERSECTS",drawBox:null,selectionRadio:null,_selectionHandle:null,layerInfosObj:null,_layerAllFeaturesCache:null,map:null,types:null,enableBuffer:!1,distance:0,unit:"",showLoading:!1,ignoredFeaturelayerIds:null,postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.spatialFilterByFeatures;
this.ignoredFeaturelayerIds||(this.ignoredFeaturelayerIds=[]);this._layerAllFeaturesCache={}},postCreate:function(){this.inherited(arguments);this.selectionRadio=new m({label:this.nls.selectedFeatures});this.selectionRadio.placeAt(this.selectionOptionDiv);this.selectionRadio.setStatus(!1);this.own(l(this.selectionRadio,"change",b.hitch(this,this._onRadioChanged)));e.setStyle(this.domNode,"position","relative");var a=G.fromJson({style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",
color:[54,93,141,255],width:1.5,type:"esriSLS"}}),a=new D(a);this._bufferLayer=new z;this._bufferLayer.setRenderer(a);this.map.addLayer(this._bufferLayer);a=new v({createMapResponse:this.map.webMapResponse,types:this.types,showLayerFromFeatureSet:!0,onlyShowVisible:!1,updateWhenLayerInfosIsShowInMapChanged:!0,ignoredFeaturelayerIds:this.ignoredFeaturelayerIds});this.layerChooserFromMapWithDropbox=new t({label:this.nls.relatedLayer,layerChooser:a});this.layerChooserFromMapWithDropbox.placeAt(this.layerSelectDiv);
this.own(l(this.layerChooserFromMapWithDropbox,"selection-change",b.hitch(this,this._onLayerChanged)));this.layerInfosObj=A.getInstanceSync();this.own(l(this.layerInfosObj,"layerInfosIsShowInMapChanged",b.hitch(this,this._onLayerInfosIsShowInMapChanged)));this.searchDistance=new x({tip:window.jimuNls.searchDistance.applySearchDistanceToFeatures,distance:this.distance,unit:this.unit});this.searchDistance.placeAt(this.searchDistanceDiv);this.enableBuffer?(this.searchDistance.enable(),this.own(l(this.searchDistance,
"change",b.hitch(this,this._onSearchDistanceChange)))):(this.searchDistance.disable(),e.setStyle(this.searchDistanceDiv,"display","none"));this._onLayerChanged()},reset:function(a){a&&(this.searchDistance.reset(),this.searchDistance.setDistance(this.distance),this.searchDistance.setUnit(this.unit));this.clearAllGraphics()},hideTempLayers:function(){this._bufferLayer&&this._bufferLayer.hide();this.drawBox&&this.drawBox.hideLayer();this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.hideMiddleFeatureLayer()},
showTempLayers:function(){this._bufferLayer&&this._bufferLayer.show();this.drawBox&&this.drawBox.showLayer();this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.showMiddleFeatureLayer()},disable:function(a){a&&this._hideAllLayers()},enable:function(){this._showAllLayers()},deactivate:function(){this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.deactivate()},clearAllGraphics:function(){this._clearBufferLayer();this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.clearAllGraphics()},
setSelectedLayer:function(a){return this.layerChooserFromMapWithDropbox.setSelectedLayer(a)},getSelectedLayer:function(){return this._getSelectedLayerInfomation().layer},checkSelectedFeaturesRadio:function(){this.selectionRadio.getValue()||this.selectionRadio.check()},uncheckSelectedFeaturesRadio:function(){this.selectionRadio.getValue()&&this.selectionRadio.uncheck()},isValidSearchDistance:function(){return 0<=this.searchDistance.getStatus()},getGeometryInfo:function(a){var d=new r,g={status:null,
geometry:null};this._updateBuffer();if(0===this._getSelectedLayerInfomation().type)return g.status=-1,d.resolve(g),d;if(0>this.searchDistance.getData().status)return g.status=-2,d.resolve(g),d;this._getFeatures(a).then(b.hitch(this,function(){g.geometry=this._updateBuffer();g.status=g.geometry?1:0;d.resolve(g)}),b.hitch(this,function(a){d.reject(a)}));return d},getFeatureSet:function(d){var e=new r,g=null,c=this._getSelectedLayerInfomation().layer;c?this._getFeatures(d).then(b.hitch(this,function(b){g=
a.getFeatureSetByLayerAndFeatures(c,b);e.resolve(g)}),b.hitch(this,function(a){e.reject(a)})):e.resolve(g);return e},_getFeatures:function(){var a=new r,b=[],g=this._getSelectedLayerInfomation(),d=g.type;0===d?a.resolve(b):this.selectionRadio.getStatus()&&this.selectionRadio.getValue()?(b=g.layer.getSelectedFeatures(),a.resolve(b)):this.featureSetChooserForSingleLayer.isLoading()?a=this.featureSetChooserForSingleLayer.getFeatures():(b=this.featureSetChooserForSingleLayer.syncGetFeatures(),0<b.length?
a.resolve(b):3===d?(b=g.layer.graphics,a.resolve(b)):a=this._getAllFeaturesFromFeaturelayer(g.layer));return a},_getAllFeaturesFromFeaturelayer:function(e){var c=new r;if(this._layerAllFeaturesCache[e.id])c.resolve(this._layerAllFeaturesCache[e.id]);else{var g=a.getFeatureLayerDefinition(e);g||(g={currentVersion:e.currentVersion,fields:b.clone(e.fields)});this.emit("loading");g=new F;g.where=e.getDefinitionExpression()||"1\x3d1";g.geometry=null;g.outSpatialReference=this.map.spatialReference;g.returnGeometry=
!0;(new d({url:e.url,query:g})).getAllFeatures().then(b.hitch(this,function(a){this.emit("unloading");a?(a=a.features||[],this._layerAllFeaturesCache[e.id]=a,c.resolve(a)):c.reject("Can't get all features from featureLayer "+e.id)}),b.hitch(this,function(a){this.emit("unloading");c.reject(a)}))}return c},_syncGetFeatures:function(){var a=[],b=this._getSelectedLayerInfomation(),g=b.type;0!==g&&(this.selectionRadio.getStatus()&&this.selectionRadio.getValue()?a=b.layer.getSelectedFeatures():(a=this.featureSetChooserForSingleLayer.syncGetFeatures(),
0===a.length&&(3===g?a=b.layer.graphics:(b=this._layerAllFeaturesCache[b.layer.id])&&(a=b))));return a},isLoading:function(){return this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.isLoading()},_onLoading:function(){this.showLoading&&this.loading.show();this.emit("loading")},_onUnloading:function(){this.loading.hide();this.emit("unloading")},_showAllLayers:function(){this._bufferLayer&&this._bufferLayer.show()},_hideAllLayers:function(){this._bufferLayer&&this._bufferLayer.hide()},
_onRadioChanged:function(){this.selectionRadio.getValue()&&this.featureSetChooserForSingleLayer&&(this.featureSetChooserForSingleLayer.deactivate(),this.featureSetChooserForSingleLayer.clearAllGraphics());this._updateBuffer()},_getSelectedLayerInfomation:function(){var a=0,b=null,g=null,d=this.layerChooserFromMapWithDropbox.getSelectedItems();0<d.length&&(b=d[0]);b&&(g=b.layerInfo.layerObject,a=g.url?0<=this.map.graphicsLayerIds.indexOf(g.id)?1:2:3);return{type:a,layerItem:b,layer:g}},_onLayerChanged:function(){this.clearAllGraphics();
this._clearSelectionHandle();this._updateSelectedFeaturesCount();this.featureSetChooserForSingleLayer&&this.featureSetChooserForSingleLayer.destroy();this.featureSetChooserForSingleLayer=null;var a=this._getSelectedLayerInfomation();0<a.type&&(this.featureSetChooserForSingleLayer=new J({map:this.map,featureLayer:a.layer,updateSelection:!1}),this._selectionHandle=l(a.layer,"selection-complete",b.hitch(this,function(){var a=this.selectionRadio.getStatus()&&this.selectionRadio.getValue();this._updateSelectedFeaturesCount();
a&&this._updateBuffer()})),this.own(l(this.featureSetChooserForSingleLayer,"user-clear",b.hitch(this,this._onUserClear))),this.own(l(this.featureSetChooserForSingleLayer,"loading",b.hitch(this,b.hitch(this,function(){this._clearBufferLayer();this._onLoading()})))),this.own(l(this.featureSetChooserForSingleLayer,"unloading",b.hitch(this,b.hitch(this,function(){this._onUnloading();this._updateBuffer()})))),this.featureSetChooserForSingleLayer.placeAt(this.featureSetChooserDiv),this.own(l(this.featureSetChooserForSingleLayer,
"draw-activate",b.hitch(this,function(){this.uncheckSelectedFeaturesRadio()}))));this._updateFeatureSetChooserForSingleLayerStatus();this._updateBuffer()},_onLayerInfosIsShowInMapChanged:function(){this._updateFeatureSetChooserForSingleLayerStatus()},_onSearchDistanceChange:function(){this._updateBuffer();this.emit("search-distance-change")},_updateFeatureSetChooserForSingleLayerStatus:function(){if(this.featureSetChooserForSingleLayer){var a=!1,b=this.featureSetChooserForSingleLayer.getFeatureLayer();
(b=this.layerInfosObj.getLayerInfoById(b.id))&&(a=b.isShowInMap());a?(this.featureSetChooserForSingleLayer.enable(),e.removeClass(this.featureSetChooserForSingleLayer.domNode,"not-visible")):(this.featureSetChooserForSingleLayer.disable(),this.featureSetChooserForSingleLayer.clearAllGraphics(),e.addClass(this.featureSetChooserForSingleLayer.domNode,"not-visible"),this._updateBuffer())}},_updateBuffer:function(){this._clearBufferLayer();var d=this.searchDistance.getData(),e=d.status,g=d.distance,d=
d.bufferUnit;if(0>e)return null;var c=this._syncGetFeatures(),f=null,m=[];n.forEach(c,b.hitch(this,function(a){a&&a.geometry&&m.push(a.geometry)}));0<m.length&&(f="polygon"===m[0].type?C.union(m):a.combineGeometries(m));return 0===e?f:f?(f=C.simplify(f),c=f.spatialReference,e=null,e=c.isWebMercator()||4326===c.wkid?C.geodesicBuffer(f,g,d,!0):C.buffer(f,g,d,!0),g=new w(e),this._bufferLayer.add(g),e):null},_onUserClear:function(){this.clearAllGraphics()},_clearBufferLayer:function(){this._bufferLayer&&
this._bufferLayer.clear()},_updateSelectedFeaturesCount:function(){this.selectionRadio.setStatus(!0);var a=this._getSelectedLayerInfomation(),b=0;a.layer&&(a=a.layer.getSelectedFeatures())&&(b=a.length);0===b?(this.selectionRadio.getValue()&&this.selectionRadio.uncheck(),this.selectionRadio.setStatus(!1),e.addClass(this.selectionOptionDiv,"not-visible")):e.removeClass(this.selectionOptionDiv,"not-visible");this.selectionRadio.setLabel(this.nls.selectedFeatures+(window.isRTL?"\x26rlm;":" ")+"("+b+
")")},_clearSelectionHandle:function(){this._selectionHandle&&this._selectionHandle.remove();this._selectionHandle=null},destroy:function(){this._bufferLayer&&this.map.removeLayer(this._bufferLayer);this._bufferLayer=null;this._clearSelectionHandle();this.inherited(arguments)}});k.NONE_SELECTED_FEATURES_NOT_DRAW_SHAPES="NONE_SELECTED_FEATURES_NOT_DRAW_SHAPES";return k})},"jimu/dijit/FeaturelayerChooserFromMap":function(){define(["dojo/_base/declare","dojo/Deferred","dojo/_base/html","dojo/_base/lang",
"./LayerChooserFromMap"],function(n,k,q,p,c){return n([c],{baseClass:"jimu-featurelayer-chooser-from-map",declaredClass:"jimu.dijit.FeaturelayerChooserFromMap",types:null,showLayerFromFeatureSet:!1,showTable:!1,onlyShowVisible:!1,ignoredFeaturelayerIds:null,mustSupportStatistics:!1,ignoreVirtualLayer:!1,postMixInProperties:function(){this.inherited(arguments);this.ignoredFeaturelayerIds||(this.ignoredFeaturelayerIds=[]);this.basicFilter=p.hitch(this,this.basicFilter);this.filter=c.createFeaturelayerFilter(this.types,
this.showLayerFromFeatureSet,this.showTable,this.mustSupportStatistics);this.ignoreVirtualLayer&&(this.filter=c.andCombineFilters([this.filter,p.hitch(this,this._ignoreVirtualLayerFilter)]))},postCreate:function(){this.inherited(arguments);q.addClass(this.domNode,"jimu-basic-layer-chooser-from-map")},_ignoreVirtualLayerFilter:function(c){return c.getLayerType().then(function(c){return!("ArcGISDynamicMapServiceLayer"===c||"ArcGISTiledMapServiceLayer"===c||"GroupLayer"===c)})},basicFilter:function(c){var f=
new k;0<=this.ignoredFeaturelayerIds.indexOf(c.id)?f.resolve(!1):this.onlyShowVisible&&"Table"!==c.getLayerType()?f.resolve(c.isShowInMap()):f.resolve(!0);return f},getHandledItem:function(c){var f=this.inherited(arguments),h=c&&c.layerInfo,h=h&&h.layerObject;f.url=h&&h.url||"";return f}})})},"jimu/dijit/LayerChooserFromMap":function(){define("dojo/on dojo/Evented dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/store/Memory dojo/Deferred dojo/store/Observable dijit/tree/ObjectStoreModel dojo/promise/all dojo/_base/lang dojo/_base/html dojo/_base/array jimu/utils jimu/dijit/_Tree jimu/LayerInfos/LayerInfos jimu/dijit/LoadingIndicator".split(" "),
function(n,k,q,p,c,f,l,h,r,e,b,a,d,m,v,t,x,A){var w=q([p,c,f,k],{templateString:'\x3cdiv style\x3d"width:100%;"\x3e\x3cdiv data-dojo-attach-point\x3d"errorTipSection" class\x3d"error-tip-section"\x3e\x3cspan class\x3d"jimu-icon jimu-icon-error"\x3e\x3c/span\x3e\x3cspan class\x3d"jimu-state-error-text" data-dojo-attach-point\x3d"errTip"\x3e${nls.noLayersTip}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e',_store:null,_id:0,_treeClass:"layer-chooser-tree",createMapResponse:null,multiple:!1,onlyShowVisible:!1,
updateWhenLayerInfosIsShowInMapChanged:!1,onlyShowWebMapLayers:!1,displayTooltipForTreeNode:!1,postMixInProperties:function(){this.nls=window.jimuNls.basicLayerChooserFromMap},postCreate:function(){this.inherited(arguments);d.addClass(this.domNode,"jimu-basic-layer-chooser-from-map");this.multiple=!!this.multiple;this.shelter=new A({hidden:!0});this.shelter.placeAt(this.domNode);this.shelter.startup();this._createTree();this.basicFilter=a.hitch(this,this.basicFilter);this.filter=w.andCombineFilters([this.basicFilter,
this.filter]);this.createMapResponse&&this.setCreateMapResponse(this.createMapResponse)},basicFilter:function(a){var b=new h;this.onlyShowVisible?b.resolve(a.isShowInMap()):b.resolve(!0);return b},filter:function(a){a=new h;a.resolve(!0);return a},getSelectedItems:function(){var b=this.tree.getSelectedItems();return m.map(b,a.hitch(this,function(a){return this.getHandledItem(a)}))},getAllItems:function(){var b=this.tree.getAllItems(),d=[];m.forEach(b,a.hitch(this,function(a){"root"!==a.id&&(a=this.getHandledItem(a),
d.push(a))}));return d},getHandledItem:function(a){return{name:a.name,layerInfo:a.layerInfo}},_isLeafItem:function(a){return a.isLeaf},setCreateMapResponse:function(b){this.createMapResponse=b;x.getInstance(this.createMapResponse.map,this.createMapResponse.itemInfo).then(a.hitch(this,function(b){this.layerInfosObj=b;this.own(n(this.layerInfosObj,"layerInfosChanged",a.hitch(this,this._onLayerInfosChanged)));this.updateWhenLayerInfosIsShowInMapChanged&&this.own(n(this.layerInfosObj,"layerInfosIsShowInMapChanged",
a.hitch(this,this._onLayerInfosIsShowInMapChanged)));this._buildTree(this.layerInfosObj)}))},_onLayerInfosChanged:function(a,b){this._buildTree(this.layerInfosObj);this.emit("update")},_onLayerInfosIsShowInMapChanged:function(a){this._buildTree(this.layerInfosObj);this.emit("update")},_buildTree:function(b){this._clear();d.setStyle(this.errorTipSection,"display","block");var c=[];this.onlyShowWebMapLayers?(c=b.getLayerInfoArrayOfWebmap(),c=c.concat(b.getTableInfoArrayOfWebmap())):(c=b.getLayerInfoArray(),
c=c.concat(b.getTableInfoArray()));0!==c.length&&(d.setStyle(this.errorTipSection,"display","none"),m.forEach(c,a.hitch(this,function(a){this._addDirectLayerInfo(a)})))},_addDirectLayerInfo:function(b){b&&b.getLayerObject().then(a.hitch(this,function(){this._addItem("root",b)}),a.hitch(this,function(a){console.error(a)}))},_clear:function(){var b=this._store.query({parent:"root"});m.forEach(b,a.hitch(this,function(a){a&&"root"!==a.id&&this._store.remove(a.id)}))},_addItem:function(d,c){var e=null,
f=c.getLayerType(),h=this.filter(c);b({layerType:f,valid:h}).then(a.hitch(this,function(f){if(f.valid){var h=a.hitch(this,function(a,b){this._id++;e={name:c.title||"",parent:d,layerInfo:c,type:f.layerType,layerClass:c.layerObject.declaredClass,id:this._id.toString(),isLeaf:a,hasChildren:b};this._store.add(e)}),l=c.getSubLayers(),g=0===l.length;g?h(g,!1):(l=m.map(l,a.hitch(this,function(a){return this.filter(a)})),b(l).then(a.hitch(this,function(a){(a=m.some(a,function(a){return a}))&&h(g,a)})))}}))},
_getRootItem:function(){return{id:"root",name:"Map Root",type:"root",isLeaf:!1,hasChildren:!0}},_createTree:function(){var b=this._getRootItem(),b=new l({data:[b],getChildren:function(a){return this.query({parent:a.id})}});this._store=new r(b);b=new e({store:this._store,query:{id:"root"},mayHaveChildren:a.hitch(this,this._mayHaveChildren)});this.tree=new t({multiple:this.multiple,model:b,showRoot:!1,isLeafItem:a.hitch(this,this._isLeafItem),style:{width:"100%"},onOpen:a.hitch(this,function(a,b){"root"!==
a.id&&this._onTreeOpen(a,b)}),onClick:a.hitch(this,function(a,b,d){this._onTreeClick(a,b,d);this.emit("tree-click",a,b,d)}),getIconStyle:a.hitch(this,function(a,b){var d=null;if(!a||"root"===a.id)return null;var c={width:"20px",height:"20px",backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundImage:""},e=window.location.protocol+"//"+window.location.host+require.toUrl("jimu");if(a=this._getIconInfo(a,b).imageName)c.backgroundImage="url("+e+"/css/images/"+a+")",d=c;return d}),
getIconClass:a.hitch(this,function(a,b){return this._getIconInfo(a,b).className}),getTooltip:a.hitch(this,function(a){return this.displayTooltipForTreeNode?a.layerInfo.title:""})});d.addClass(this.tree.domNode,this._treeClass);this.tree.placeAt(this.shelter.domNode,"before")},_mayHaveChildren:function(a){return a.hasChildren},_getIconInfo:function(a,b){var d="",c="";"ArcGISDynamicMapServiceLayer"===a.type||"ArcGISTiledMapServiceLayer"===a.type?b?(d="mapserver_open.png",c="mapservice-layer-icon open"):
(d="mapserver_close.png",c="mapservice-layer-icon close"):"GroupLayer"===a.type?b?(d="group_layer2.png",c="group-layer-icon open"):(d="group_layer1.png",c="group-layer-icon close"):"FeatureLayer"===a.type?(a=v.getTypeByGeometryType(a.layerInfo.layerObject.geometryType),"point"===a?(d="point_layer1.png",c="point-layer-icon"):"polyline"===a?(d="line_layer1.png",c="line-layer-icon"):"polygon"===a&&(d="polygon_layer1.png",c="polygon-layer-icon")):"Table"===a.type?(d="table.png",c="table-icon"):"ArcGISImageServiceLayer"===
a.type||"ArcGISImageServiceVectorLayer"===a.type?(d="image_layer.png",c="iamge-layer-icon"):b?(d="mapserver_open.png",c="mapservice-layer-icon open"):(d="mapserver_close.png",c="mapservice-layer-icon close");return{imageName:d,className:c}},_onTreeOpen:function(d,c){if("root"!==d.id){var e=[];c=[];e=d.layerInfo.getSubLayers();d.checked||(this.shelter.show(),c=m.map(e,a.hitch(this,function(a){return a.getLayerObject()})),b(c).then(a.hitch(this,function(){this.domNode&&(m.forEach(e,a.hitch(this,function(a){this._addItem(d.id,
a)})),d.checked=!0,this.shelter.hide())}),a.hitch(this,function(a){console.error(a);this.shelter.hide()})))}},_onTreeClick:function(a,b,d){},destroy:function(){this.shelter&&(this.shelter.destroy(),this.shelter=null);this.tree&&this.tree.destroy();this.inherited(arguments)}});w.createFilterByLayerType=function(d){a.isArrayLike(d)||(d=[]);return function(a){var c=new h;if(0===d.length)c.resolve(!0);else{var e=[];a.traversal(function(a){e.push(a.getLayerType())});b(e).then(function(a){for(var b=0;b<
a.length;b++)for(var e=0;e<d.length;e++)if(a[b]===d[e]){c.resolve(!0);return}c.resolve(!1)},function(a){console.error(a);c.reject(a)})}return c}};w.createFeaturelayerFilter=function(a,d,c,e){var f=["point","polyline","polygon"];a&&0<a.length?(a=m.filter(a,function(a){return 0<=f.indexOf(a)}),0===a.length&&(a=f)):a=f;return function(f){var h=f.getLayerType();f=f.getLayerObject();return b({layerType:h,layerObject:f}).then(function(b){var g=b.layerType;b=b.layerObject;if("ArcGISDynamicMapServiceLayer"===
g||"ArcGISTiledMapServiceLayer"===g||"GroupLayer"===g||"FeatureCollection"===g)return!0;if("FeatureLayer"===g){var g=v.getTypeByGeometryType(b.geometryType),g=0<=m.indexOf(a,g),f=w._shouldPassStatisticsCheck(e,b);return b.url?(b=v.isFeaturelayerUrlSupportQuery(b.url,b.capabilities),g&&b&&f):d&&g}return"Table"===g?(g=v.isFeaturelayerUrlSupportQuery(b.url,b.capabilities),b=w._shouldPassStatisticsCheck(e,b),c&&g&&b):!1})}};w.createImageServiceLayerFilter=function(a,d){return function(c){var e=c.getLayerType();
c=c.getLayerObject();return b({layerType:e,layerObject:c}).then(function(b){var c=b.layerType,e=b.layerObject;return"ArcGISImageServiceLayer"===c||"ArcGISImageServiceVectorLayer"===c?a?v.isImageServiceSupportQuery(b.layerObject.capabilities)?d?w._shouldPassStatisticsCheck(d,e):!0:!1:!0:!1})}};w._shouldPassStatisticsCheck=function(a,b){return a?(a=!1,a=b.advancedQueryCapabilities?!!b.advancedQueryCapabilities.supportsStatistics:!!b.supportsStatistics):!0};w.createQueryableLayerFilter=function(a){var b=
w.createFeaturelayerFilter(["point","polyline","polygon"],!1,!0,a);a=w.createImageServiceLayerFilter(!0,a);return w.orCombineFilters([b,a])};w.andCombineFilters=function(a){return w._combineFilters(a,!0)};w.orCombineFilters=function(a){return w._combineFilters(a,!1)};w._combineFilters=function(a,d){return function(c){var e=new h,f=m.map(a,function(a){return a(c)});b(f).then(function(a){var b=!1,b=d?m.every(a,function(a){return a}):m.some(a,function(a){return a});e.resolve(b)},function(a){console.error(a);
e.reject(a)});return e}};return w})},"dijit/tree/ObjectStoreModel":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/Deferred dojo/_base/lang dojo/when ../Destroyable".split(" "),function(n,k,q,p,c,f,l){return q("dijit.tree.ObjectStoreModel",l,{store:null,labelAttr:"name",labelType:"text",root:null,query:null,constructor:function(f){c.mixin(this,f);this.childrenCache={}},getRoot:function(h,l){if(this.root)h(this.root);else{var e=this.store.query(this.query);e.then&&this.own(e);
f(e,c.hitch(this,function(b){if(1!=b.length)throw Error("dijit.tree.ObjectStoreModel: root query returned "+b.length+" items, but must return exactly one");this.root=b[0];h(this.root);e.observe&&e.observe(c.hitch(this,function(a){this.onChange(a)}),!0)}),l)}},mayHaveChildren:function(){return!0},getChildren:function(h,l,e){var b=this.store.getIdentity(h);if(this.childrenCache[b])f(this.childrenCache[b],l,e);else{var a=this.childrenCache[b]=this.store.getChildren(h);a.then&&this.own(a);a.observe&&
this.own(a.observe(c.hitch(this,function(b,e,l){this.onChange(b);e!=l&&f(a,c.hitch(this,"onChildrenChange",h))}),!0));f(a,l,e)}},isItem:function(){return!0},getIdentity:function(c){return this.store.getIdentity(c)},getLabel:function(c){return c[this.labelAttr]},newItem:function(c,f,e,b){return this.store.put(c,{parent:f,before:b})},pasteItem:function(f,l,e,b,a,d){var m=new p;if(l===e&&!b&&!d)return m.resolve(!0),m;l&&!b?this.getChildren(l,c.hitch(this,function(a){a=[].concat(a);var b=n.indexOf(a,
f);a.splice(b,1);this.onChildrenChange(l,a);m.resolve(this.store.put(f,{overwrite:!0,parent:e,oldParent:l,before:d,isCopy:!1}))})):m.resolve(this.store.put(f,{overwrite:!0,parent:e,oldParent:l,before:d,isCopy:!0}));return m},onChange:function(){},onChildrenChange:function(){},onDelete:function(){}})})},"jimu/dijit/_Tree":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/_TreeNode.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/event dojo/query dojo/aspect dojo/on dojo/keys dojo/Evented dijit/registry dijit/Tree jimu/utils".split(" "),
function(n,k,q,p,c,f,l,h,r,e,b,a,d,m,v,t){var x=n([v._TreeNode,d],{templateString:p,declaredClass:"jimu._TreeNode",isLeaf:!1,groupId:"",postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-tree-node");this.isLeaf=!!this.isLeaf;this.groupId?(this.checkNode=f.toDom('\x3cinput type\x3d"radio" /\x3e'),this.checkNode.name=this.groupId):this.checkNode=f.toDom('\x3cinput type\x3d"checkbox" /\x3e');f.addClass(this.checkNode,"jimu-tree-check-node");f.place(this.checkNode,this.contentNode,
"first");this.own(b(this.checkNode,"click",c.hitch(this,this._onClick)));this.own(b(this.rowNode,"keydown",c.hitch(this,function(b,d){d.target=b;d.keyCode!==a.ENTER&&d.keyCode!==a.SPACE||this._onClick(d)},this.checkNode)));this.isLeaf?this.groupId?f.setStyle(this.checkNode,"display","none"):f.setStyle(this.checkNode,"display","inline"):f.setStyle(this.checkNode,"display","none");this.isLeaf?f.addClass(this.domNode,"jimu-tree-leaf-node"):f.addClass(this.domNode,"jimu-tree-not-leaf-node")},select:function(){this.isLeaf&&
(this.checkNode.checked=!0,f.addClass(this.domNode,"jimu-tree-selected-leaf-node"))},unselect:function(){this.isLeaf&&(this.checkNode.checked=!1,f.removeClass(this.domNode,"jimu-tree-selected-leaf-node"))},toggleSelect:function(){this.isLeaf&&(this.checkNode.checked?this.unselect():this.select())},_onClick:function(a){(a.target||a.srcElement)===this.checkNode?this.tree._onCheckNodeClick(this,this.checkNode.checked,a):this.tree._onClick(this,a)},_onChange:function(){this.isLeaf&&setTimeout(c.hitch(this,
function(){this.checkNode.checked?this.emit("tn-select",this):this.emit("tn-unselect",this)}),100)},destroy:function(){delete this.tree;this.inherited(arguments)}});return n([v,d],{declaredClass:"jimu._Tree",openOnClick:!0,multiple:!0,uniqueId:"",showRoot:!1,postMixInProperties:function(){this.inherited(arguments);this.uniqueId="tree_"+t.getRandomString()},postCreate:function(){this.inherited(arguments);f.addClass(this.domNode,"jimu-tree");this.own(e.before(this,"onClick",c.hitch(this,this._jimuBeforeClick)));
this.rootLoadingIndicator&&f.setStyle(this.rootLoadingIndicator,"display","none");this.dndController.singular=!0;f.setAttr(this.domNode,"tabindex",0)},removeItem:function(a){this.model.store.remove(a)},getAllItems:function(){var a=this.getAllTreeNodeWidgets();return l.map(a,c.hitch(this,function(a){var b=a.item;b.selected=a.checkNode.checked;return b}))},getSelectedItems:function(){var a=this.getAllTreeNodeWidgets(),a=l.filter(a,c.hitch(this,function(a){return a.checkNode.checked}));return l.map(a,
c.hitch(this,function(a){return a.item}))},getFilteredItems:function(a){var b=this.getAllTreeNodeWidgets(),b=l.map(b,c.hitch(this,function(a){var b=a.item;b.selected=a.checkNode.checked;return b}));return l.filter(b,c.hitch(this,function(b){return a(b)}))},getTreeNodeByItemId:function(a){for(var b=this._getAllTreeNodeDoms(),d=0;d<b.length;d++){var c=m.byNode(b[d]);if(c.item.id.toString()===a.toString())return c}return null},selectItem:function(a){(a=this.getTreeNodeByItemId(a))&&a.isLeaf&&this.selectNodeWidget(a)},
unselectItem:function(a){(a=this.getTreeNodeByItemId(a))&&a.isLeaf&&a.unselect()},getAllLeafTreeNodeWidgets:function(){var a=this.getAllTreeNodeWidgets();return l.filter(a,c.hitch(this,function(a){return a.isLeaf}))},getAllTreeNodeWidgets:function(){var a=this._getAllTreeNodeDoms();return l.map(a,c.hitch(this,function(a){return m.byNode(a)}))},isLeafItem:function(a){return a&&a.isLeaf},_getAllTreeNodeDoms:function(){return r(".dijitTreeNode",this.domNode)},_createTreeNode:function(a){a.isLeaf=this.isLeafItem(a.item);
this.multiple||(a.groupId=this.uniqueId);return new x(a)},_onTreeNodeSelect:function(a){this.emit("item-select",{item:a.item,treeNode:a})},_onTreeNodeUnselect:function(a){this.emit("item-unselect",{item:a.item,treeNode:a})},selectNodeWidget:function(a){this.multiple||this.unselectAllLeafNodeWidgets();a.select()},_jimuBeforeClick:function(a,b,d){b.isLeaf&&(f.hasClass(d.target||d.srcElement,"jimu-tree-check-node")||(this.multiple?b.toggleSelect():this.selectNodeWidget(b)));return arguments},_onCheckNodeClick:function(a,
b,d){!this.multiple&&b&&this.unselectAllLeafNodeWidgets();h.stop(d);this.focusNode(a);setTimeout(c.hitch(this,function(){b?this.selectNodeWidget(a):a.unselect();this.onClick(a.item,a,d)}),0)},unselectAllLeafNodeWidgets:function(){var a=this.getAllLeafTreeNodeWidgets();l.forEach(a,c.hitch(this,function(a){a.unselect()}))}})})},"dijit/Tree":function(){define("dojo/_base/array dojo/aspect dojo/cookie dojo/_base/declare dojo/Deferred dojo/promise/all dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/errors/create dojo/fx dojo/has dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/topic dojo/touch dojo/when ./a11yclick ./focus ./registry ./_base/manager ./_Widget ./_TemplatedMixin ./_Container ./_Contained ./_CssStateMixin ./_KeyNavMixin dojo/text!./templates/TreeNode.html dojo/text!./templates/Tree.html ./tree/TreeStoreModel ./tree/ForestStoreModel ./tree/_dndSelector dojo/query!css2".split(" "),
function(n,k,q,p,c,f,l,h,r,e,b,a,d,m,v,t,x,A,w,F,G,z,D,C,J,B,K,g,E,u,I,L,y,N,P){function H(a){return t.delegate(a.promise||a,{addCallback:function(a){this.then(a)},addErrback:function(a){this.otherwise(a)}})}var O=p("dijit._TreeNode",[J,B,K,g,E],{item:null,isTreeNode:!0,label:"",_setLabelAttr:function(a){this.labelNode["html"==this.labelType?"innerHTML":"innerText"in this.labelNode?"innerText":"textContent"]=a;this._set("label",a);d("dojo-bidi")&&this.applyTextDir(this.labelNode)},labelType:"text",
isExpandable:null,isExpanded:!1,state:"NotLoaded",templateString:I,baseClass:"dijitTreeNode",cssStateNodes:{rowNode:"dijitTreeRow"},_setTooltipAttr:{node:"rowNode",type:"attribute",attribute:"title"},buildRendering:function(){this.inherited(arguments);this._setExpando();this._updateItemClasses(this.item);this.isExpandable&&this.labelNode.setAttribute("aria-expanded",this.isExpanded);this.setSelected(!1)},_setIndentAttr:function(a){var b=Math.max(a,0)*this.tree._nodePixelIndent+"px";e.set(this.domNode,
"backgroundPosition",b+" 0px");e.set(this.rowNode,this.isLeftToRight()?"paddingLeft":"paddingRight",b);n.forEach(this.getChildren(),function(b){b.set("indent",a+1)});this._set("indent",a)},markProcessing:function(){this.state="Loading";this._setExpando(!0)},unmarkProcessing:function(){this._setExpando(!1)},_updateItemClasses:function(a){var b=this.tree,d=b.model;b._v10Compat&&a===d.root&&(a=null);this._applyClassAndStyle(a,"icon","Icon");this._applyClassAndStyle(a,"label","Label");this._applyClassAndStyle(a,
"row","Row");this.tree._startPaint(!0)},_applyClassAndStyle:function(a,b,d){var c="_"+b+"Class";b+="Node";var g=this[c];this[c]=this.tree["get"+d+"Class"](a,this.isExpanded);h.replace(this[b],this[c]||"",g||"");e.set(this[b],this.tree["get"+d+"Style"](a,this.isExpanded)||{})},_updateLayout:function(){var a=this.getParent(),a=!a||!a.rowNode||"none"==a.rowNode.style.display;h.toggle(this.domNode,"dijitTreeIsRoot",a);h.toggle(this.domNode,"dijitTreeIsLast",!a&&!this.getNextSibling())},_setExpando:function(a){var b=
["dijitTreeExpandoLoading","dijitTreeExpandoOpened","dijitTreeExpandoClosed","dijitTreeExpandoLeaf"];a=a?0:this.isExpandable?this.isExpanded?1:2:3;h.replace(this.expandoNode,b[a],b);this.expandoNodeText.innerHTML=["*","-","+","*"][a]},expand:function(){if(this._expandDeferred)return H(this._expandDeferred);this._collapseDeferred&&(this._collapseDeferred.cancel(),delete this._collapseDeferred);this.isExpanded=!0;this.labelNode.setAttribute("aria-expanded","true");(this.tree.showRoot||this!==this.tree.rootNode)&&
this.containerNode.setAttribute("role","group");h.add(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);this==this.tree.rootNode&&this.tree.showRoot&&this.tree.domNode.setAttribute("aria-expanded","true");var b=a.wipeIn({node:this.containerNode,duration:C.defaultDuration}),d=this._expandDeferred=new c(function(){b.stop()});k.after(b,"onEnd",function(){d.resolve(!0)},!0);b.play();return H(d)},collapse:function(){if(this._collapseDeferred)return H(this._collapseDeferred);
this._expandDeferred&&(this._expandDeferred.cancel(),delete this._expandDeferred);this.isExpanded=!1;this.labelNode.setAttribute("aria-expanded","false");this==this.tree.rootNode&&this.tree.showRoot&&this.tree.domNode.setAttribute("aria-expanded","false");h.remove(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);var b=a.wipeOut({node:this.containerNode,duration:C.defaultDuration}),d=this._collapseDeferred=new c(function(){b.stop()});k.after(b,"onEnd",
function(){d.resolve(!0)},!0);b.play();return H(d)},indent:0,setChildItems:function(a){var b=this.tree,d=b.model,c=[],g=b.focusedChild,e=this.getChildren();n.forEach(e,function(a){K.prototype.removeChild.call(this,a)},this);this.defer(function(){n.forEach(e,function(a){if(!a._destroyed&&!a.getParent()){var c=function(a){var g=d.getIdentity(a.item),e=b._itemNodesMap[g];1==e.length?delete b._itemNodesMap[g]:(g=n.indexOf(e,a),-1!=g&&e.splice(g,1));n.forEach(a.getChildren(),c)};b.dndController.removeTreeNode(a);
c(a);if(b.persist){var e=n.map(a.getTreePath(),function(a){return b.model.getIdentity(a)}).join("/"),y;for(y in b._openedNodes)y.substr(0,e.length)==e&&delete b._openedNodes[y];b._saveExpandedNodes()}b.lastFocusedChild&&!l.isDescendant(b.lastFocusedChild.domNode,b.domNode)&&delete b.lastFocusedChild;g&&!l.isDescendant(g.domNode,b.domNode)&&b.focus();a.destroyRecursive()}})});this.state="Loaded";a&&0<a.length?(this.isExpandable=!0,n.forEach(a,function(a){var g=d.getIdentity(a),e=b._itemNodesMap[g],
y;if(e)for(var f=0;f<e.length;f++)if(e[f]&&!e[f].getParent()){y=e[f];y.set("indent",this.indent+1);break}y||(y=this.tree._createTreeNode({item:a,tree:b,isExpandable:d.mayHaveChildren(a),label:b.getLabel(a),labelType:b.model&&b.model.labelType||"text",tooltip:b.getTooltip(a),ownerDocument:b.ownerDocument,dir:b.dir,lang:b.lang,textDir:b.textDir,indent:this.indent+1}),e?e.push(y):b._itemNodesMap[g]=[y]);this.addChild(y);(this.tree.autoExpand||this.tree._state(y))&&c.push(b._expandNode(y))},this),n.forEach(this.getChildren(),
function(a){a._updateLayout()})):this.isExpandable=!1;this._setExpando&&this._setExpando(!1);this._updateItemClasses(this.item);a=f(c);this.tree._startPaint(a);return H(a)},getTreePath:function(){for(var a=this,b=[];a&&a!==this.tree.rootNode;)b.unshift(a.item),a=a.getParent();b.unshift(this.tree.rootNode.item);return b},getIdentity:function(){return this.tree.model.getIdentity(this.item)},removeChild:function(a){this.inherited(arguments);var b=this.getChildren();0==b.length&&(this.isExpandable=!1,
this.collapse());n.forEach(b,function(a){a._updateLayout()})},makeExpandable:function(){this.isExpandable=!0;this._setExpando(!1)},setSelected:function(a){this.labelNode.setAttribute("aria-selected",a?"true":"false");h.toggle(this.rowNode,"dijitTreeRowSelected",a)},focus:function(){z.focus(this.focusNode)}});d("dojo-bidi")&&O.extend({_setTextDirAttr:function(a){!a||this.textDir==a&&this._created||(this._set("textDir",a),this.applyTextDir(this.labelNode),n.forEach(this.getChildren(),function(b){b.set("textDir",
a)},this))}});var M=p("dijit.Tree",[J,u,B,E],{baseClass:"dijitTree",store:null,model:null,query:null,label:"",showRoot:!0,childrenAttr:["children"],paths:[],path:[],selectedItems:null,selectedItem:null,openOnClick:!1,openOnDblClick:!1,templateString:L,persist:!1,autoExpand:!1,dndController:P,dndParams:"onDndDrop itemCreator onDndCancel checkAcceptance checkItemAcceptance dragThreshold betweenThreshold".split(" "),onDndDrop:null,itemCreator:null,onDndCancel:null,checkAcceptance:null,checkItemAcceptance:null,
dragThreshold:5,betweenThreshold:0,_nodePixelIndent:19,_publish:function(a,b){A.publish(this.id,t.mixin({tree:this,event:a},b||{}))},postMixInProperties:function(){this.tree=this;this.autoExpand&&(this.persist=!1);this._itemNodesMap={};!this.cookieName&&this.id&&(this.cookieName=this.id+"SaveStateCookie");this.expandChildrenDeferred=new c;this.pendingCommandsPromise=this.expandChildrenDeferred.promise;this.inherited(arguments)},postCreate:function(){this._initState();var a=this;this.own(x(this.containerNode,
x.selector(".dijitTreeNode",w.enter),function(b){a._onNodeMouseEnter(D.byNode(this),b)}),x(this.containerNode,x.selector(".dijitTreeNode",w.leave),function(b){a._onNodeMouseLeave(D.byNode(this),b)}),x(this.containerNode,x.selector(".dijitTreeRow",G.press),function(b){a._onNodePress(D.getEnclosingWidget(this),b)}),x(this.containerNode,x.selector(".dijitTreeRow",G),function(b){a._onClick(D.getEnclosingWidget(this),b)}),x(this.containerNode,x.selector(".dijitTreeRow","dblclick"),function(b){a._onDblClick(D.getEnclosingWidget(this),
b)}));this.model||this._store2model();this.own(k.after(this.model,"onChange",t.hitch(this,"_onItemChange"),!0),k.after(this.model,"onChildrenChange",t.hitch(this,"_onItemChildrenChange"),!0),k.after(this.model,"onDelete",t.hitch(this,"_onItemDelete"),!0));this.inherited(arguments);if(this.dndController){t.isString(this.dndController)&&(this.dndController=t.getObject(this.dndController));for(var b={},d=0;d<this.dndParams.length;d++)this[this.dndParams[d]]&&(b[this.dndParams[d]]=this[this.dndParams[d]]);
this.dndController=new this.dndController(this,b)}this._load();this.onLoadDeferred=H(this.pendingCommandsPromise);this.onLoadDeferred.then(t.hitch(this,"onLoad"))},_store2model:function(){this._v10Compat=!0;m.deprecated("Tree: from version 2.0, should specify a model object rather than a store/query");var a={id:this.id+"_ForestStoreModel",store:this.store,query:this.query,childrenAttrs:this.childrenAttr};this.params.mayHaveChildren&&(a.mayHaveChildren=t.hitch(this,"mayHaveChildren"));this.params.getItemChildren&&
(a.getChildren=t.hitch(this,function(a,b,d){this.getItemChildren(this._v10Compat&&a===this.model.root?null:a,b,d)}));this.model=new N(a);this.showRoot=!!this.label},onLoad:function(){},_load:function(){this.model.getRoot(t.hitch(this,function(a){var b=this.rootNode=this.tree._createTreeNode({item:a,tree:this,isExpandable:!0,label:this.label||this.getLabel(a),labelType:this.model.labelType||"text",textDir:this.textDir,indent:this.showRoot?0:-1});this.showRoot?(this.domNode.setAttribute("aria-multiselectable",
!this.dndController.singular),this.rootLoadingIndicator.style.display="none"):(b.rowNode.style.display="none",this.domNode.setAttribute("role","presentation"),this.domNode.removeAttribute("aria-expanded"),this.domNode.removeAttribute("aria-multiselectable"),this["aria-label"]?(b.containerNode.setAttribute("aria-label",this["aria-label"]),this.domNode.removeAttribute("aria-label")):this["aria-labelledby"]&&(b.containerNode.setAttribute("aria-labelledby",this["aria-labelledby"]),this.domNode.removeAttribute("aria-labelledby")),
b.labelNode.setAttribute("role","presentation"),b.labelNode.removeAttribute("aria-selected"),b.containerNode.setAttribute("role","tree"),b.containerNode.setAttribute("aria-expanded","true"),b.containerNode.setAttribute("aria-multiselectable",!this.dndController.singular));this.containerNode.appendChild(b.domNode);a=this.model.getIdentity(a);this._itemNodesMap[a]?this._itemNodesMap[a].push(b):this._itemNodesMap[a]=[b];b._updateLayout();this._expandNode(b).then(t.hitch(this,function(){this._destroyed||
(this.rootLoadingIndicator.style.display="none",this.expandChildrenDeferred.resolve(!0))}))}),t.hitch(this,function(a){console.error(this,": error loading root: ",a)}))},getNodesByItem:function(a){if(!a)return[];a=t.isString(a)?a:this.model.getIdentity(a);return[].concat(this._itemNodesMap[a])},_setSelectedItemAttr:function(a){this.set("selectedItems",[a])},_setSelectedItemsAttr:function(a){var b=this;return this.pendingCommandsPromise=this.pendingCommandsPromise.always(t.hitch(this,function(){var d=
n.map(a,function(a){return!a||t.isString(a)?a:b.model.getIdentity(a)}),c=[];n.forEach(d,function(a){c=c.concat(b._itemNodesMap[a]||[])});this.set("selectedNodes",c)}))},_setPathAttr:function(a){return a.length?H(this.set("paths",[a]).then(function(a){return a[0]})):H(this.set("paths",[]).then(function(a){return a[0]}))},_setPathsAttr:function(a){function b(a,c){var g=a.shift(),e=n.filter(c,function(a){return a.getIdentity()==g})[0];if(e)return a.length?d._expandNode(e).then(function(){return b(a,
e.getChildren())}):e;throw new M.PathError("Could not expand path at "+g);}var d=this;return H(this.pendingCommandsPromise=this.pendingCommandsPromise.always(function(){return f(n.map(a,function(a){a=n.map(a,function(a){return a&&t.isObject(a)?d.model.getIdentity(a):a});if(a.length)return b(a,[d.rootNode]);throw new M.PathError("Empty path");}))}).then(function(a){d.set("selectedNodes",a);return d.paths}))},_setSelectedNodeAttr:function(a){this.set("selectedNodes",[a])},_setSelectedNodesAttr:function(a){this.dndController.setSelection(a)},
expandAll:function(){function a(d){return b._expandNode(d).then(function(){var b=n.filter(d.getChildren()||[],function(a){return a.isExpandable});return f(n.map(b,a))})}var b=this;return H(a(this.rootNode))},collapseAll:function(){function a(d){var c=n.filter(d.getChildren()||[],function(a){return a.isExpandable}),c=f(n.map(c,a));return!d.isExpanded||d==b.rootNode&&!b.showRoot?c:c.then(function(){return b._collapseNode(d)})}var b=this;return H(a(this.rootNode))},mayHaveChildren:function(){},getItemChildren:function(){},
getLabel:function(a){return this.model.getLabel(a)},getIconClass:function(a,b){return!a||this.model.mayHaveChildren(a)?b?"dijitFolderOpened":"dijitFolderClosed":"dijitLeaf"},getLabelClass:function(){},getRowClass:function(){},getIconStyle:function(){},getLabelStyle:function(){},getRowStyle:function(){},getTooltip:function(){return""},_onDownArrow:function(a,b){(a=this._getNext(b))&&a.isTreeNode&&this.focusNode(a)},_onUpArrow:function(a,b){if(a=b.getPreviousSibling())for(b=a;b.isExpandable&&b.isExpanded&&
b.hasChildren();)b=b.getChildren(),b=b[b.length-1];else if(a=b.getParent(),this.showRoot||a!==this.rootNode)b=a;b&&b.isTreeNode&&this.focusNode(b)},_onRightArrow:function(a,b){b.isExpandable&&!b.isExpanded?this._expandNode(b):b.hasChildren()&&(b=b.getChildren()[0])&&b.isTreeNode&&this.focusNode(b)},_onLeftArrow:function(a,b){b.isExpandable&&b.isExpanded?this._collapseNode(b):(a=b.getParent())&&a.isTreeNode&&(this.showRoot||a!==this.rootNode)&&this.focusNode(a)},focusLastChild:function(){var a=this._getLast();
a&&a.isTreeNode&&this.focusNode(a)},_getFirst:function(){return this.showRoot?this.rootNode:this.rootNode.getChildren()[0]},_getLast:function(){for(var a=this.rootNode;a.isExpanded;){var b=a.getChildren();if(!b.length)break;a=b[b.length-1]}return a},_getNext:function(a){if(a.isExpandable&&a.isExpanded&&a.hasChildren())return a.getChildren()[0];for(;a&&a.isTreeNode;){var b=a.getNextSibling();if(b)return b;a=a.getParent()}return null},childSelector:".dijitTreeRow",isExpandoNode:function(a,b){return l.isDescendant(a,
b.expandoNode)||l.isDescendant(a,b.expandoNodeText)},_onNodePress:function(a,b){this.focusNode(a)},__click:function(a,b,d,c){var g=this.isExpandoNode(b.target,a);a.isExpandable&&(d||g)?this._onExpandoClick({node:a}):(this._publish("execute",{item:a.item,node:a,evt:b}),this[c](a.item,a,b),this.focusNode(a));b.stopPropagation();b.preventDefault()},_onClick:function(a,b){this.__click(a,b,this.openOnClick,"onClick")},_onDblClick:function(a,b){this.__click(a,b,this.openOnDblClick,"onDblClick")},_onExpandoClick:function(a){a=
a.node;this.focusNode(a);a.isExpanded?this._collapseNode(a):this._expandNode(a)},onClick:function(){},onDblClick:function(){},onOpen:function(){},onClose:function(){},_getNextNode:function(a){m.deprecated(this.declaredClass+"::_getNextNode(node) is deprecated. Use _getNext(node) instead.","","2.0");return this._getNext(a)},_getRootOrFirstNode:function(){m.deprecated(this.declaredClass+"::_getRootOrFirstNode() is deprecated. Use _getFirst() instead.","","2.0");return this._getFirst()},_collapseNode:function(a){a._expandNodeDeferred&&
delete a._expandNodeDeferred;if("Loading"!=a.state&&a.isExpanded){var b=a.collapse();this.onClose(a.item,a);this._state(a,!1);this._startPaint(b);return b}},_expandNode:function(a){if(a._expandNodeDeferred)return a._expandNodeDeferred;var b=this.model,d=a.item,g=this;a._loadDeferred||(a.markProcessing(),a._loadDeferred=new c,b.getChildren(d,function(b){a.unmarkProcessing();a.setChildItems(b).then(function(){a._loadDeferred.resolve(b)})},function(b){console.error(g,": error loading "+a.label+" children: ",
b);a._loadDeferred.reject(b)}));b=a._loadDeferred.then(t.hitch(this,function(){var b=a.expand();this.onOpen(a.item,a);this._state(a,!0);return b}));this._startPaint(b);return b},focusNode:function(a){for(var b=[],d=this.domNode;d&&d.tagName&&"IFRAME"!==d.tagName.toUpperCase();d=d.parentNode)b.push({domNode:d.contentWindow||d,scrollLeft:d.scrollLeft||0,scrollTop:d.scrollTop||0});this.focusChild(a);this.defer(function(){for(var a=0,d=b.length;a<d;a++)b[a].domNode.scrollLeft=b[a].scrollLeft,b[a].domNode.scrollTop=
b[a].scrollTop},0)},_onNodeMouseEnter:function(){},_onNodeMouseLeave:function(){},_onItemChange:function(a){var b=this.model.getIdentity(a);if(b=this._itemNodesMap[b]){var d=this.getLabel(a),c=this.getTooltip(a);n.forEach(b,function(b){b.set({item:a,label:d,tooltip:c});b._updateItemClasses(a)})}},_onItemChildrenChange:function(a,b){a=this.model.getIdentity(a);(a=this._itemNodesMap[a])&&n.forEach(a,function(a){a.setChildItems(b)})},_onItemDelete:function(a){a=this.model.getIdentity(a);var b=this._itemNodesMap[a];
b&&(n.forEach(b,function(a){this.dndController.removeTreeNode(a);var b=a.getParent();b&&b.removeChild(a);this.lastFocusedChild&&!l.isDescendant(this.lastFocusedChild.domNode,this.domNode)&&delete this.lastFocusedChild;this.focusedChild&&!l.isDescendant(this.focusedChild.domNode,this.domNode)&&this.focus();a.destroyRecursive()},this),delete this._itemNodesMap[a])},_initState:function(){this._openedNodes={};if(this.persist&&this.cookieName){var a=q(this.cookieName);a&&n.forEach(a.split(","),function(a){this._openedNodes[a]=
!0},this)}},_state:function(a,b){if(!this.persist)return!1;var d=n.map(a.getTreePath(),function(a){return this.model.getIdentity(a)},this).join("/");if(1===arguments.length)return this._openedNodes[d];b?this._openedNodes[d]=!0:delete this._openedNodes[d];this._saveExpandedNodes()},_saveExpandedNodes:function(){if(this.persist&&this.cookieName){var a=[],b;for(b in this._openedNodes)a.push(b);q(this.cookieName,a.join(","),{expires:365})}},destroy:function(){this._curSearch&&(this._curSearch.timer.remove(),
delete this._curSearch);this.rootNode&&this.rootNode.destroyRecursive();this.dndController&&!t.isString(this.dndController)&&this.dndController.destroy();this.rootNode=null;this.inherited(arguments)},destroyRecursive:function(){this.destroy()},resize:function(a){a&&r.setMarginBox(this.domNode,a);this._nodePixelIndent=r.position(this.tree.indentDetector).w||this._nodePixelIndent;this.expandChildrenDeferred.then(t.hitch(this,function(){this.rootNode.set("indent",this.showRoot?0:-1);this._adjustWidths()}))},
_outstandingPaintOperations:0,_startPaint:function(a){this._outstandingPaintOperations++;this._adjustWidthsTimer&&(this._adjustWidthsTimer.remove(),delete this._adjustWidthsTimer);var b=t.hitch(this,function(){this._outstandingPaintOperations--;0>=this._outstandingPaintOperations&&!this._adjustWidthsTimer&&this._started&&(this._adjustWidthsTimer=this.defer("_adjustWidths"))});F(a,b,b)},_adjustWidths:function(){this._adjustWidthsTimer&&(this._adjustWidthsTimer.remove(),delete this._adjustWidthsTimer);
this.containerNode.style.width="auto";this.containerNode.style.width=this.domNode.scrollWidth>this.domNode.offsetWidth?"auto":"100%"},_createTreeNode:function(a){return new O(a)},focus:function(){this.lastFocusedChild?this.focusNode(this.lastFocusedChild):this.focusFirstChild()}});d("dojo-bidi")&&M.extend({_setTextDirAttr:function(a){a&&this.textDir!=a&&(this._set("textDir",a),this.rootNode.set("textDir",a))}});M.PathError=b("TreePathError");M._TreeNode=O;return M})},"dijit/tree/TreeStoreModel":function(){define(["dojo/_base/array",
"dojo/aspect","dojo/_base/declare","dojo/_base/lang"],function(n,k,q,p){return q("dijit.tree.TreeStoreModel",null,{store:null,childrenAttrs:["children"],newItemIdAttr:"id",labelAttr:"",root:null,query:null,deferItemLoadingUntilExpand:!1,constructor:function(c){p.mixin(this,c);this.connects=[];c=this.store;if(!c.getFeatures()["dojo.data.api.Identity"])throw Error("dijit.tree.TreeStoreModel: store must support dojo.data.Identity");c.getFeatures()["dojo.data.api.Notification"]&&(this.connects=this.connects.concat([k.after(c,
"onNew",p.hitch(this,"onNewItem"),!0),k.after(c,"onDelete",p.hitch(this,"onDeleteItem"),!0),k.after(c,"onSet",p.hitch(this,"onSetItem"),!0)]))},destroy:function(){for(var c;c=this.connects.pop();)c.remove()},getRoot:function(c,f){this.root?c(this.root):this.store.fetch({query:this.query,onComplete:p.hitch(this,function(f){if(1!=f.length)throw Error("dijit.tree.TreeStoreModel: root query returned "+f.length+" items, but must return exactly one");this.root=f[0];c(this.root)}),onError:f})},mayHaveChildren:function(c){return n.some(this.childrenAttrs,
function(f){return this.store.hasAttribute(c,f)},this)},getChildren:function(c,f,l){var h=this.store;if(h.isItemLoaded(c)){for(var k=[],e=0;e<this.childrenAttrs.length;e++)var b=h.getValues(c,this.childrenAttrs[e]),k=k.concat(b);var a=0;this.deferItemLoadingUntilExpand||n.forEach(k,function(b){h.isItemLoaded(b)||a++});0==a?f(k):n.forEach(k,function(b,d){h.isItemLoaded(b)||h.loadItem({item:b,onItem:function(b){k[d]=b;0==--a&&f(k)},onError:l})})}else{var d=p.hitch(this,arguments.callee);h.loadItem({item:c,
onItem:function(a){d(a,f,l)},onError:l})}},isItem:function(c){return this.store.isItem(c)},fetchItemByIdentity:function(c){this.store.fetchItemByIdentity(c)},getIdentity:function(c){return this.store.getIdentity(c)},getLabel:function(c){return this.labelAttr?this.store.getValue(c,this.labelAttr):this.store.getLabel(c)},newItem:function(c,f,l){var h={parent:f,attribute:this.childrenAttrs[0]},k;this.newItemIdAttr&&c[this.newItemIdAttr]?this.fetchItemByIdentity({identity:c[this.newItemIdAttr],scope:this,
onItem:function(e){e?this.pasteItem(e,null,f,!0,l):(k=this.store.newItem(c,h))&&void 0!=l&&this.pasteItem(k,f,f,!1,l)}}):(k=this.store.newItem(c,h))&&void 0!=l&&this.pasteItem(k,f,f,!1,l)},pasteItem:function(c,f,l,h,k){var e=this.store,b=this.childrenAttrs[0];f&&n.forEach(this.childrenAttrs,function(a){if(e.containsValue(f,a,c)){if(!h){var d=n.filter(e.getValues(f,a),function(a){return a!=c});e.setValues(f,a,d)}b=a}});if(l)if("number"==typeof k){var a=e.getValues(l,b).slice();a.splice(k,0,c);e.setValues(l,
b,a)}else e.setValues(l,b,e.getValues(l,b).concat(c))},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onNewItem:function(c,f){f&&this.getChildren(f.item,p.hitch(this,function(c){this.onChildrenChange(f.item,c)}))},onDeleteItem:function(c){this.onDelete(c)},onSetItem:function(c,f){if(-1!=n.indexOf(this.childrenAttrs,f))this.getChildren(c,p.hitch(this,function(f){this.onChildrenChange(c,f)}));else this.onChange(c)}})})},"dijit/tree/ForestStoreModel":function(){define(["dojo/_base/array",
"dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","./TreeStoreModel"],function(n,k,q,p,c){return k("dijit.tree.ForestStoreModel",c,{rootId:"$root$",rootLabel:"ROOT",query:null,constructor:function(c){this.root={store:this,root:!0,id:c.rootId,label:c.rootLabel,children:c.rootChildren}},mayHaveChildren:function(c){return c===this.root||this.inherited(arguments)},getChildren:function(c,l,h){c===this.root?this.root.children?l(this.root.children):this.store.fetch({query:this.query,onComplete:p.hitch(this,
function(c){this.root.children=c;l(c)}),onError:h}):this.inherited(arguments)},isItem:function(c){return c===this.root?!0:this.inherited(arguments)},fetchItemByIdentity:function(c){if(c.identity==this.root.id){var f=c.scope||q.global;c.onItem&&c.onItem.call(f,this.root)}else this.inherited(arguments)},getIdentity:function(c){return c===this.root?this.root.id:this.inherited(arguments)},getLabel:function(c){return c===this.root?this.root.label:this.inherited(arguments)},newItem:function(c,l,h){return l===
this.root?(this.onNewRootItem(c),this.store.newItem(c)):this.inherited(arguments)},onNewRootItem:function(){},pasteItem:function(c,l,h,k,e){if(l===this.root&&!k)this.onLeaveRoot(c);this.inherited(arguments,[c,l===this.root?null:l,h===this.root?null:h,k,e]);if(h===this.root)this.onAddToRoot(c)},onAddToRoot:function(c){console.log(this,": item ",c," added to root")},onLeaveRoot:function(c){console.log(this,": item ",c," removed from root")},_requeryTop:function(){var c=this.root.children||[];this.store.fetch({query:this.query,
onComplete:p.hitch(this,function(f){this.root.children=f;if(c.length!=f.length||n.some(c,function(c,l){return f[l]!=c}))this.onChildrenChange(this.root,f)})})},onNewItem:function(c,l){this._requeryTop();this.inherited(arguments)},onDeleteItem:function(c){-1!=n.indexOf(this.root.children,c)&&this._requeryTop();this.inherited(arguments)},onSetItem:function(c,l,h,k){this._requeryTop();this.inherited(arguments)}})})},"dijit/tree/_dndSelector":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/dnd/common dojo/dom dojo/mouse dojo/on dojo/touch ../a11yclick ./_dndContainer".split(" "),
function(n,k,q,p,c,f,l,h,r,e,b){return k("dijit.tree._dndSelector",b,{constructor:function(){this.selection={};this.anchor=null;this.events.push(h(this.tree.domNode,r.press,p.hitch(this,"onMouseDown")),h(this.tree.domNode,r.release,p.hitch(this,"onMouseUp")),h(this.tree.domNode,r.move,p.hitch(this,"onMouseMove")),h(this.tree.domNode,e.press,p.hitch(this,"onClickPress")),h(this.tree.domNode,e.release,p.hitch(this,"onClickRelease")))},singular:!1,getSelectedTreeNodes:function(){var a=[],b=this.selection,
c;for(c in b)a.push(b[c]);return a},selectNone:function(){this.setSelection([]);return this},destroy:function(){this.inherited(arguments);this.selection=this.anchor=null},addTreeNode:function(a,b){this.setSelection(this.getSelectedTreeNodes().concat([a]));b&&(this.anchor=a);return a},removeTreeNode:function(a){var b=n.filter(this.getSelectedTreeNodes(),function(b){return!f.isDescendant(b.domNode,a.domNode)});this.setSelection(b);return a},isTreeNodeSelected:function(a){return a.id&&!!this.selection[a.id]},
setSelection:function(a){var b=this.getSelectedTreeNodes();n.forEach(this._setDifference(b,a),p.hitch(this,function(a){a.setSelected(!1);this.anchor==a&&delete this.anchor;delete this.selection[a.id]}));n.forEach(this._setDifference(a,b),p.hitch(this,function(a){a.setSelected(!0);this.selection[a.id]=a}));this._updateSelectionProperties()},_setDifference:function(a,b){n.forEach(b,function(a){a.__exclude__=!0});a=n.filter(a,function(a){return!a.__exclude__});n.forEach(b,function(a){delete a.__exclude__});
return a},_updateSelectionProperties:function(){var a=this.getSelectedTreeNodes(),b=[],c=[];n.forEach(a,function(a){var d=a.getTreePath();c.push(a);b.push(d)},this);a=n.map(c,function(a){return a.item});this.tree._set("paths",b);this.tree._set("path",b[0]||[]);this.tree._set("selectedNodes",c);this.tree._set("selectedNode",c[0]||null);this.tree._set("selectedItems",a);this.tree._set("selectedItem",a[0]||null)},onClickPress:function(a){if(!(this.current&&this.current.isExpandable&&this.tree.isExpandoNode(a.target,
this.current))){"mousedown"==a.type&&l.isLeft(a)&&a.preventDefault();var b="keydown"==a.type?this.tree.focusedChild:this.current;if(b){var e=c.getCopyKeyState(a),f=b.id;this.singular||a.shiftKey||!this.selection[f]?(this._doDeselect=!1,this.userSelect(b,e,a.shiftKey)):this._doDeselect=!0}}},onClickRelease:function(a){this._doDeselect&&(this._doDeselect=!1,this.userSelect("keyup"==a.type?this.tree.focusedChild:this.current,c.getCopyKeyState(a),a.shiftKey))},onMouseMove:function(){this._doDeselect=
!1},onMouseDown:function(){},onMouseUp:function(){},_compareNodes:function(a,b){if(a===b)return 0;if("sourceIndex"in document.documentElement)return a.sourceIndex-b.sourceIndex;if("compareDocumentPosition"in document.documentElement)return a.compareDocumentPosition(b)&2?1:-1;if(document.createRange){var c=doc.createRange();c.setStartBefore(a);a=doc.createRange();a.setStartBefore(b);return c.compareBoundaryPoints(c.END_TO_END,a)}throw Error("dijit.tree._compareNodes don't know how to compare two different nodes in this browser");
},userSelect:function(a,b,c){if(this.singular)this.anchor==a&&b?this.selectNone():(this.setSelection([a]),this.anchor=a);else if(c&&this.anchor){b=this._compareNodes(this.anchor.rowNode,a.rowNode);c=this.anchor;0>b?b=c:(b=a,a=c);for(c=[];b!=a;)c.push(b),b=this.tree._getNext(b);c.push(a);this.setSelection(c)}else this.selection[a.id]&&b?this.removeTreeNode(a):b?this.addTreeNode(a,!0):(this.setSelection([a]),this.anchor=a)},getItem:function(a){return{data:this.selection[a],type:["treeNode"]}},forInSelectedItems:function(a,
b){b=b||q.global;for(var c in this.selection)a.call(b,this.getItem(c),c,this)}})})},"dijit/tree/_dndContainer":function(){define("dojo/aspect dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/on dojo/touch".split(" "),function(n,k,q,p,c,f){return k("dijit.tree._dndContainer",null,{constructor:function(l,h){this.tree=l;this.node=l.domNode;p.mixin(this,h);this.containerState="";q.add(this.node,"dojoDndContainer");this.events=[c(this.node,f.enter,p.hitch(this,"onOverEvent")),c(this.node,f.leave,
p.hitch(this,"onOutEvent")),n.after(this.tree,"_onNodeMouseEnter",p.hitch(this,"onMouseOver"),!0),n.after(this.tree,"_onNodeMouseLeave",p.hitch(this,"onMouseOut"),!0),c(this.node,"dragstart, selectstart",function(c){c.preventDefault()})]},destroy:function(){for(var c;c=this.events.pop();)c.remove();this.node=this.parent=null},onMouseOver:function(c){this.current=c},onMouseOut:function(){this.current=null},_changeState:function(c,f){var h="dojoDnd"+c;c=c.toLowerCase()+"State";q.replace(this.node,h+
f,h+this[c]);this[c]=f},_addItemClass:function(c,f){q.add(c,"dojoDndItem"+f)},_removeItemClass:function(c,f){q.remove(c,"dojoDndItem"+f)},onOverEvent:function(){this._changeState("Container","Over")},onOutEvent:function(){this._changeState("Container","")}})})},"jimu/dijit/LayerChooserFromMapWithDropbox":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/keys dojo/Evented dojo/Deferred dijit/popup dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/LayerChooserFromMapWithDropbox.html jimu/LayerInfos/LayerInfos".split(" "),
function(n,k,q,p,c,f,l,h,r,e,b,a){return n([r,e,f],{templateString:b,baseClass:"jimu-layer-chooser-from-map-withdropbox",declaredClass:"jimu.dijit.LayerChooserFromMapWithDropbox",_selectedItem:null,_isLayerChooserShow:!1,layerInfosObj:null,layerChooser:null,customClass:"",postMixInProperties:function(){this.inherited(arguments);this.nls=window.jimuNls.queryableLayerSource;this.nls.customSelectLayer=this.label?this.label:this.nls.selectLayer},postCreate:function(){this.inherited(arguments);this.layerInfosObj=
a.getInstanceSync();this.layerChooser.domNode.style.zIndex=1;this.layerChooser.tree.domNode.style.borderTop="0";this.layerChooser.tree.domNode.style.maxHeight="290px";this.own(p(this.layerChooser,"tree-click",k.hitch(this,this._onTreeClick)));this.own(p(this.layerChooser,"update",k.hitch(this,this._onLayerChooserUpdate)));this.own(p(document.body,"click",k.hitch(this,this._onBodyClicked)));this.own(p(document.body,"keydown",k.hitch(this,function(a){a.keyCode===c.ENTER&&this._onBodyClicked(a)})));
this.own(p(this.layerChooser.domNode,"keydown",k.hitch(this,function(a){a.keyCode===c.ESCAPE&&this.hideLayerChooser()})))},destroy:function(){this.hideLayerChooser();this.layerChooser&&this.layerChooser.destroy();this.layerChooser=null;this.inherited(arguments)},getLayerChooser:function(){return this.layerChooser},setSelectedLayer:function(a){var b=new l;if(a){var c=this.layerInfosObj.getLayerOrTableInfoById(a.id);c?this.layerChooser.filter(c).then(k.hitch(this,function(d){d?(this._onSelectNewItem({layerInfo:c,
name:c.title,url:a.url}),b.resolve(!0)):b.resolve(!1)}),k.hitch(this,function(){b.resolve(!1)})):b.resolve(!1)}else this._onSelectNewItem(null),b.resolve(!0);return b},getSelectedItem:function(){return this._selectedItem},getSelectedItems:function(){return[this._selectedItem]},_onBodyClicked:function(a){a=a.target||a.srcElement;a===this.domNode||q.isDescendant(a,this.domNode)||a===this.layerChooser.domNode||q.isDescendant(a,this.layerChooser.domNode)||this.hideLayerChooser()},_onDropDownClick:function(a){a.stopPropagation();
a.preventDefault();this._isLayerChooserShow?this.hideLayerChooser():(this.isActive=!0,this.showLayerChooser())},_onDropDownKeydown:function(a){a.keyCode===c.ENTER&&this._onDropDownClick(a)},_getSelectedItems:function(){return this.layerChooser.getSelectedItems()},showLayerChooser:function(){this.layerChooser.domNode.style.minWidth=this.domNode.clientWidth+2+"px";h.open({parent:this,popup:this.layerChooser,around:this.domNode});var a=this.layerChooser.domNode.parentNode;a&&(q.addClass(a,"jimu-layer-chooser-from-map-withdropbox-popup"),
this.customClass&&q.addClass(a,this.customClass),this.layerChooser.tree.domNode.focus());this._isLayerChooserShow=!0},hideLayerChooser:function(){h.close(this.layerChooser);this._isLayerChooserShow=!1;this.isActive&&(this.dropDownBtn.focus(),this.isActive=!1)},_onLayerChooserUpdate:function(){this._selectedItem&&this.layerChooser.onlyShowVisible&&!this._selectedItem.layerInfo.isShowInMap()&&(this._selectedItem=null,this.emit("selection-change",[]))},_onSelectNewItem:function(a){var b=k.getObject("layerInfo.id",
!1,this._selectedItem)||-1,c=k.getObject("layerInfo.id",!1,a)||-1,b=b!==c;this._selectedItem=a;this.hideLayerChooser();a=k.getObject("layerInfo.title",!1,this._selectedItem)||"";this.layerNameNode.innerHTML=a;q.setAttr(this.layerNameNode,"title",a);a=k.getObject("layerInfo.layerObject",!1,this._selectedItem);b&&this.emit("selection-change",[a])},_onTreeClick:function(){var a=this._getSelectedItems();this._onSelectNewItem(0<a.length?a[0]:null)}})})},"jimu/dijit/FeatureSetChooserForSingleLayer":function(){define("dojo/on dojo/Evented dojo/_base/lang dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin jimu/dijit/DrawBox jimu/dijit/_FeatureSetChooserCore esri/symbols/jsonUtils".split(" "),
function(n,k,q,p,c,f,l,h,r,e,b){return c([f,l,h,k],{baseClass:"jimu-single-layer-featureset-chooser",templateString:"\x3cdiv\x3e\x3c/div\x3e",drawBox:null,map:null,featureLayer:null,updateSelection:!1,postCreate:function(){this.inherited(arguments);var a=b.fromJson({style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}});this.drawBox=new r({map:this.map,showClear:!0,keepOneGraphic:!0,geoTypes:["EXTENT"]});this.drawBox.setPolygonSymbol(a);
a=this.drawBox.getDrawItemIcons();p.forEach(a,q.hitch(this,function(a){a.title=""}));this.drawBox.extentIcon.title=window.jimuNls.spatialFilterByFeatures.drawShapesTip;this.drawBox.placeAt(this.domNode);this.own(n(this.drawBox,"user-clear",q.hitch(this,this._onDrawBoxUserClear)));this.own(n(this.drawBox,"draw-activate",q.hitch(this,function(){this.emit("draw-activate")})));this.own(n(this.drawBox,"draw-deactivate",q.hitch(this,function(){this.emit("draw-deactivate")})));this.own(n(this.drawBox,"draw-end",
q.hitch(this,this._onDrawEnd)));this.featureSetChooserCore=new e({map:this.map,featureLayer:this.featureLayer,drawBox:this.drawBox,updateSelection:this.updateSelection});this.own(n(this.featureSetChooserCore,"loading",q.hitch(this,function(){this.emit("loading")})));this.own(n(this.featureSetChooserCore,"unloading",q.hitch(this,function(){this.emit("unloading")})));this.own(n(this.featureLayer,"visibility-change",q.hitch(this,function(){this.featureLayer.visible?this.drawBox.enable():this.drawBox.disable()})))},
getFeatures:function(){return this.featureSetChooserCore.getFeatures()},syncGetFeatures:function(){return this.featureSetChooserCore.syncGetFeatures()},disable:function(){this.drawBox.disable()},enable:function(){this.drawBox.enable()},deactivate:function(){this.drawBox.deactivate()},clearAllGraphics:function(){this.featureSetChooserCore.clear(!1)},isLoading:function(){return this.featureSetChooserCore.isLoading()},getFeatureLayer:function(){return this.featureLayer},destroy:function(){this.featureSetChooserCore&&
this.featureSetChooserCore.destroy();this.featureSetChooserCore=null;this.inherited(arguments)},_onDrawEnd:function(){this.drawBox.clear()},_onDrawBoxUserClear:function(){this.clearAllGraphics();this.emit("user-clear")},showMiddleFeatureLayer:function(){this.featureSetChooserCore&&this.featureSetChooserCore.showMiddleFeatureLayer()},hideMiddleFeatureLayer:function(){this.featureSetChooserCore&&this.featureSetChooserCore.hideMiddleFeatureLayer()}})})},"jimu/dijit/_FeatureSetChooserCore":function(){define("dojo/on dojo/sniff dojo/Evented dojo/Deferred dojo/_base/lang dojo/_base/array dojo/_base/declare jimu/utils jimu/symbolUtils jimu/SelectionManager jimu/LayerInfos/LayerInfos esri/graphic esri/tasks/query esri/tasks/QueryTask esri/layers/FeatureLayer esri/symbols/jsonUtils esri/geometry/geometryEngine".split(" "),
function(n,k,q,p,c,f,l,h,r,e,b,a,d,m,v,t,x){return l([q],{baseClass:"jimu-featureset-chooser-core",_middleFeatureLayer:null,_isLoading:!1,_def:null,_isDestroyed:!1,_handles:null,selectionManager:null,layerInfosObj:null,layerInfo:null,map:null,featureLayer:null,drawBox:null,updateSelection:!1,fullyWithin:!1,constructor:function(a){c.mixin(this,a);this.layerInfosObj=b.getInstanceSync();this.selectionManager=e.getInstance();this.featureLayer.getSelectionSymbol()||this.selectionManager.setSelectionSymbol(this.featureLayer);
a=h.getFeatureLayerDefinition(this.featureLayer);delete a.id;this._middleFeatureLayer=new v({layerDefinition:a,featureSet:null},{id:"featureLayer_"+h.getRandomString()});a=null;var d=this._middleFeatureLayer.geometryType;"esriGeometryPoint"===d?a=r.getDefaultMarkerSymbol():"esriGeometryPolyline"===d?a=r.getDefaultLineSymbol():"esriGeometryPolygon"===d&&(a=t.fromJson({style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}}));
this._middleFeatureLayer.setSelectionSymbol(a);a=n(this.drawBox,"user-clear",c.hitch(this,this._onDrawBoxUserClear));d=n(this.drawBox,"draw-end",c.hitch(this,this._onDrawEnd));this._handles=[a,d];if(this.layerInfo=this.layerInfosObj.getLayerInfoById(this.featureLayer.id))a=n(this.layerInfo,"filterChanged",c.hitch(this,this._handleFilterChange)),this._handles.push(a)},hideMiddleFeatureLayer:function(){if(this._middleFeatureLayer){this._middleFeatureLayer.hide();var a=this.selectionManager.getDisplayLayer(this._middleFeatureLayer.id);
a&&a.hide()}},showMiddleFeatureLayer:function(){if(this._middleFeatureLayer){this._middleFeatureLayer.show();var a=this.selectionManager.getDisplayLayer(this._middleFeatureLayer.id);a&&a.show()}},clear:function(a){this.drawBox.clear();this._clearMiddleFeatureLayer();a&&this.selectionManager.clearSelection(this.featureLayer)},getFeatures:function(){var a=new p,b=c.hitch(this,function(){var b=this.syncGetFeatures();a.resolve(b)}),d=c.hitch(this,function(b){a.reject(b)});1===this._getDeferredStatus(this._def)?
this._def.then(b,d):b();return a},syncGetFeatures:function(){return(this.updateSelection?this.featureLayer:this._middleFeatureLayer).getSelectedFeatures()},isLoading:function(){return 1===this._getDeferredStatus(this._def)},_onLoading:function(){this.drawBox.deactivate();this.emit("loading")},_onUnloading:function(){this.emit("unloading")},_getDeferredStatus:function(a){var b=0;return b=a?a.isResolved()?2:a.isRejected()?-1:1:0},_onDrawEnd:function(a,b,d,e,f,h){if(this.isLoading())throw"should not draw when loading";
if(this.featureLayer.visible){var l=new p;this._def=l;var m=v.SELECTION_NEW;e&&(m=v.SELECTION_ADD);k("mac")?h&&(m=v.SELECTION_SUBTRACT):f&&(m=v.SELECTION_SUBTRACT);this.emit("loading");this._getFeaturesByGeometry(a.geometry).then(c.hitch(this,function(a){this.selectionManager.updateSelectionByFeatures(this.updateSelection?this.featureLayer:this._middleFeatureLayer,a,m);this._onUnloading();l.resolve(a)}),c.hitch(this,function(a){console.error(a);this._onUnloading();l.reject(a)}))}},_addTolerance:function(a){var b=
2.54*this.map.getScale()/9600;return x.buffer(a,10*b,"meters")},_getFeaturesByGeometry:function(b){"point"!==b.type&&"polyline"!==b.type||"esriGeometryPoint"!==this.featureLayer.geometryType||(b=this._addTolerance(b));var e=new p,h=[];if(this.featureLayer.getMap()&&this.featureLayer.mode!==v.MODE_SELECTION)b=this.selectionManager.getClientFeaturesByGeometry(this.featureLayer,b,this.fullyWithin),0<b.length&&(h=f.map(b,c.hitch(this,function(b){return new a(b.toJson())}))),e.resolve(h);else{h=new d;
h.geometry=b;h.outSpatialReference=this.map.spatialReference;h.returnGeometry=!0;h.spatialRelationship=this.fullyWithin?d.SPATIAL_REL_CONTAINS:d.SPATIAL_REL_INTERSECTS;(b=this.featureLayer.getDefinitionExpression())||(b="1\x3d1");if(this.layerInfo){var k=this.layerInfo.getFilter();k&&(b="("+b+") AND ("+k+")")}b&&(h.where=b);h.outFields=["*"];(new m(this.featureLayer.url)).execute(h).then(c.hitch(this,function(a){e.resolve(a.features)}),c.hitch(this,function(a){e.reject(a)}))}return e},_onDrawBoxUserClear:function(){this.clear()},
_clearMiddleFeatureLayer:function(){this._middleFeatureLayer&&(this._middleFeatureLayer.clear(),this.selectionManager.clearSelection(this._middleFeatureLayer))},_handleFilterChange:function(){var a=this.layerInfo.getFilter()||"1\x3d1",b=this.featureLayer.getSelectedFeatures(),e=this.featureLayer.objectIdField;if(b&&0<b.length){var h=f.map(b,function(a){return a.attributes[e]}),k=new d;k.where=e+" in ("+h.join(",")+") AND "+a;(new m(this.featureLayer.url)).executeForIds(k).then(c.hitch(this,function(a){f.forEach(b,
function(b){0<=a.indexOf(b.attributes[e])?b.show():b.hide()});this.selectionManager._isLayerNeedDisplayLayer(this.featureLayer)&&this.selectionManager._updateDisplayLayer(this.featureLayer,b,v.SELECTION_NEW);this.featureLayer.emit("selection-complete",{features:this.featureLayer.getSelectedFeatures()})}),c.hitch(this,function(a){console.error(a)}))}},destroy:function(){this._isDestroyed||(f.forEach(this._handles,c.hitch(this,function(a){a.remove()})),this._handles=null,this.clear());this._isDestroyed=
!0}})})},"widgets/Query/SingleQueryResult":function(){define("dojo/_base/declare dijit/_WidgetBase jimu/dijit/BindLabelPropsMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./SingleQueryResult.html dojo/_base/lang dojo/on dojo/keys dojo/_base/query dojo/_base/html dojo/_base/array dojo/Deferred esri/lang esri/tasks/QueryTask esri/tasks/FeatureSet esri/dijit/PopupTemplate esri/dijit/PopupRenderer esri/tasks/RelationshipQuery esri/renderers/SimpleRenderer jimu/utils jimu/symbolUtils jimu/dijit/Popup jimu/dijit/Message jimu/dijit/FeatureActionPopupMenu jimu/BaseFeatureAction jimu/dijit/SymbolChooser jimu/LayerInfos/LayerInfos jimu/FeatureActionManager ./SingleQueryLoader ./RelatedRecordsResult jimu/dijit/LoadingIndicator jimu/dijit/formSelect".split(" "),
function(n,k,q,p,c,f,l,h,r,e,b,a,d,m,v,t,x,A,w,F,G,z,D,C,J,B,K,g,E,u,I,L){return n([k,q,p,c,f],{baseClass:"single-query-result",templateString:l,singleQueryLoader:null,featureLayer:null,singleRelatedRecordsResult:null,multipleRelatedRecordsResult:null,popupMenu:null,map:null,nls:null,currentAttrs:null,queryWidget:null,_lastFeatureClass:"jimu-table-row-last",_lastFeatureArrowClass:"popup-title-icon",_lastRelatedClass:"related-table-btn-last",postMixInProperties:function(){this.inherited(arguments);
this.isRenderIdForAttrs=!0;var a=window.jimuNls.common;this.nls.back=a.back;this.nls.expand=a.expand.split(" $")[0];this.nls.collapse=a.collapse.split(" $")[0]},getCurrentAttrs:function(){return this.singleQueryLoader?this.singleQueryLoader.getCurrentAttrs():null},postCreate:function(){this.inherited(arguments);this.singleQueryLoader=new I(this.map,this.currentAttrs);this.popupMenu=B.getInstance();this.featureActionManager=u.getInstance();this.btnFeatureAction.title=window.jimuNls.featureActions.featureActions;
this._initExpandListIcon();this.own(r(this.multipleRelatedRecordsDiv,"keydown",h.hitch(this,function(a){a.keyCode===e.ESCAPE&&a.target!==this.multipleRelatedRecordsResultBackBtn&&(a.stopPropagation(),this.multipleRelatedRecordsResultBackBtn.focus())})));this.own(r(this.singleRelatedRecordsResultDiv,"keydown",h.hitch(this,function(a){a.keyCode===e.ESCAPE&&a.target!==this.singleRelatedRecordsResultBackBtn&&(a.stopPropagation(),this.singleRelatedRecordsResultBackBtn.focus())})))},_initExpandListIcon:function(){var b=
this.getCurrentAttrs();(b=b&&b.config)&&b.defaultExpand?(a.addClass(this.expandedListIcon,"expanded"),this.expandedListIcon.title=this.nls.collapseAll,a.addClass(this.resultsTbody,"expanded")):(a.addClass(this.expandedListIcon,"folded"),this.expandedListIcon.title=this.nls.expandAll,a.addClass(this.resultsTbody,"folded"))},destroy:function(){this.emit("features-update",{taskIndex:this.currentAttrs.queryTr.taskIndex});this.queryWidget=null;var a=this.getCurrentAttrs();a&&a.query&&(a.query.resultLayer&&
a.query.resultLayer.getMap()&&this.map.removeLayer(a.query.resultLayer),a.query.resultLayer=null);this.inherited(arguments)},_isValidNumber:function(a){return"number"===typeof a&&!isNaN(a)},zoomToLayer:function(){var a=this.getCurrentAttrs(),b=a.query.resultLayer;b&&!this._isTable(a.layerInfo)&&(a=d.filter(b.graphics,h.hitch(this,function(a){return(a=a.geometry)?"point"===a.type?this._isValidNumber(a.x)&&this._isValidNumber(a.y):"multipoint"===a.type?a.points&&0<a.points.length?d.every(a.points,h.hitch(this,
function(a){return a?this._isValidNumber(a[0])&&this._isValidNumber(a[1]):!1})):!1:!0:!1})),0<a.length&&(a=z.toFeatureSet(a),z.zoomToFeatureSet(this.map,a)))},_emitFeaturesUpdate:function(){this.emit("features-update",{taskIndex:this.currentAttrs.queryTr.taskIndex,features:this.currentAttrs.query.resultLayer.graphics})},executeQueryForFirstTime:function(){var a=new m;this._clearResultPage();this._hideResultsNumberDiv();var b=this.getCurrentAttrs(),c=b.query.resultLayer,d=h.hitch(this,function(d){if(this.domNode){this.shelter.hide();
var g=b.query.allCount;this._updateNumSpan(b.query.foundedNum,g);0<g&&(this._addResultItems(d,c),this._addResultLayerToMap(c),this.zoomToLayer());a.resolve(g);this._emitFeaturesUpdate()}}),g=h.hitch(this,function(b){console.error(b);this.domNode&&(this.shelter.hide(),c&&this.map.removeLayer(c),c=null,this._showQueryErrorMsg(),a.reject(b))});this.shelter.show();3!==b.queryType&&this._showResultsNumberDiv();this.singleQueryLoader.executeQueryForFirstTime().then(d,g);return a},getResultLayer:function(){var a=
this.getCurrentAttrs();return h.getObject("query.resultLayer",!1,a)},showResultLayer:function(){var a=this.getResultLayer();a&&a.show()},hideResultLayer:function(){var a=this.getResultLayer();a&&a.hide()},showLayer:function(){this.showResultLayer();this.multipleRelatedRecordsResult&&this.multipleRelatedRecordsResult.showLayer();this.singleRelatedRecordsResult&&this.singleRelatedRecordsResult.showLayer()},hideLayer:function(){this.hideResultLayer();this.multipleRelatedRecordsResult&&this.multipleRelatedRecordsResult.hideLayer();
this.singleRelatedRecordsResult&&this.singleRelatedRecordsResult.hideLayer()},_addResultLayerToMap:function(a){0>this.map.graphicsLayerIds.indexOf(a.id)&&this.map.addLayer(a)},_showResultsNumberDiv:function(){a.setStyle(this.resultsNumberDiv,"display","flex")},_hideResultsNumberDiv:function(){a.setStyle(this.resultsNumberDiv,"display","none")},_updateNumSpan:function(a,b){a>b&&(a=b);this._updateLoadMoreVisible(a<b);a=z.localizeNumber(a);b=z.localizeNumber(b);this.numSpan.innerHTML=a+"/"+b},_isTable:function(a){return"Table"===
a.type},_onResultsScroll:function(){z.isScrollToBottom(this.resultsContainer)&&this._continueQuery()},_continueQuery:function(){var a=this.getCurrentAttrs(),b=a.query.allCount,c=a.query.foundedNum;if(!(c>=b)){var d=a.query.resultLayer,g=h.hitch(this,function(g){this.domNode&&(this._updateLoadMoreState(!1),this.shelter.hide(),c=a.query.foundedNum,this._updateNumSpan(c,b),this._addResultItems(g,d),this.zoomToLayer(),this._emitFeaturesUpdate(),this.emit("features-layout-update"))}),e=h.hitch(this,function(a){console.error(a);
this.domNode&&(this._updateLoadMoreState(!1),this._showQueryErrorMsg(),this.shelter.hide())});this.shelter.show();this._updateLoadMoreState(!0);this.singleQueryLoader.executeQueryWhenScrollToBottom().then(g,e)}},_clearResultPage:function(){this._hideInfoWindow();this._unSelectResultTr();a.empty(this.resultsTbody);this._updateNumSpan(0,0)},_unSelectResultTr:function(){this.resultTr&&a.removeClass(this.resultTr,"jimu-state-active");this.resultTr=null},_selectResultTr:function(b){this._unSelectResultTr();
(this.resultTr=b)&&a.addClass(this.resultTr,"jimu-state-active")},_addResultItems:function(a,b){var c=this.getCurrentAttrs(),g=c.config.url,e=c.config.objectIdField,f=this._getCurrentRelationships(),y=h.clone(c.config.popupInfo);y.mediaInfos=[];var u=new A(y),k=!0;b.renderer||(k=!1);var E=this._isWebMapShowRelatedRecordsEnabled();this._featuresNum=a.length;d.forEach(a,h.hitch(this,function(a,d){var y="",y=0===d%2?"even":"odd";b.add(a);this._createQueryResultItem({resultLayer:b,feature:a,trClass:y,
popupTemplate2:u,relationships:f,objectIdField:e,url:g,relationshipPopupTemplates:c.relationshipPopupTemplates,shouldCreateSymbolNode:k,isWebMapShowRelatedRecordsEnabled:E},d)}))},_updateLoadMoreVisible:function(b){b?a.removeClass(this.loadMoreIcon,"query-hidden"):a.addClass(this.loadMoreIcon,"query-hidden")},_updateLoadMoreState:function(b){b?a.addClass(this.loadMoreIcon,"loading"):a.removeClass(this.loadMoreIcon,"loading")},_onLoadMoreClicked:function(){this._continueQuery()},_onLoadMoreKeydown:function(a){a.keyCode!==
e.ENTER&&a.keyCode!==e.SPACE||this._onLoadMoreClicked()},_clearPopItemClass:function(){var a=b(".query-result-item-table .popup-td.expanded",this.resultsTbody),c=b(".query-result-item-table .popup-td.folded",this.resultsTbody);a&&a.length&&a.removeClass("expanded");c&&c.length&&c.removeClass("folded")},_onExpandClicked:function(){var c=this.nls.expand;this._clearPopItemClass();a.hasClass(this.resultsTbody,"expanded")?(a.addClass(this.expandedListIcon,"folded"),a.removeClass(this.resultsTbody,"expanded"),
a.addClass(this.resultsTbody,"folded"),this.expandedListIcon.title=this.nls.expandAll):(a.removeClass(this.expandedListIcon,"folded"),a.addClass(this.resultsTbody,"expanded"),a.removeClass(this.resultsTbody,"folded"),this.expandedListIcon.title=this.nls.collapseAll,c=this.nls.collapse);for(var d=b(".popup-title-icon",this.resultsTbody),g=0;g<d.length;g++)a.setAttr(d[g],"aria-label",c);this.emit("features-layout-update")},_onExpandKeydown:function(a){a.keyCode!==e.ENTER&&a.keyCode!==e.SPACE||this._onExpandClicked()},
_getPopupTitle:function(a,b){if(a)return"function"===typeof a.title?a.title(b):a.title},_createQueryResultItem:function(c,g){var e="",f="",y="";g===this._featuresNum-1&&(e=" "+this._lastFeatureClass,f=" "+this._lastRelatedClass,y='data-lastArrow\x3d"true"');var u=c.resultLayer,k=c.feature,E=c.trClass,l=c.popupTemplate2,m=c.relationships,n=c.objectIdField,p=c.url,N=c.relationshipPopupTemplates,q=c.shouldCreateSymbolNode;c=c.isWebMapShowRelatedRecordsEnabled;if(k&&k.attributes){var z=this._getPopupTitle(l,
k),e=a.toDom('\x3ctr role\x3d"button" tabindex\x3d"0" class\x3d"jimu-table-row jimu-table-row-separator query-result-item'+e+'"  cellpadding\x3d"0" cellspacing\x3d"0"\x3e\x3ctd\x3e\x3ctable class\x3d"query-result-item-table"\x3e\x3ctbody\x3e\x3ctr\x3e\x3ctd class\x3d"symbol-td"\x3e\x3c/td\x3e\x3ctd class\x3d"popup-td expanded"\x3e\x3cdiv class\x3d"popup-title-container"\x3e\x3cdiv class\x3d"popup-title"\x3e'+z+'\x3c/div\x3e\x3cdiv role\x3d"button" tabindex\x3d"0" aria-label\x3d"'+this.nls.collapse+
'" '+y+' class\x3d"popup-title-icon"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"popup-content"\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e');a.addClass(e,E);a.place(e,this.resultsTbody);e.feature=k;E=b(".symbol-td",e)[0];if(q)try{var I=u.renderer;if(I){var r=I.getSymbol(k);if(r){var t=D.createSymbolNode(r,{width:32,height:32});t&&a.place(t,E)}}}catch(Q){console.error(Q)}else a.destroy(E);var C=b(".popup-td .popup-content",e)[0],u=l.title,q=l.info&&l.info.title;
l.title=null;q&&(l.info.title=null);I=new w({template:l,graphic:k,chartTheme:l.chartTheme});a.place(I.domNode,C);I.startup();l.title=u;q&&(l.info.title=q);if(n&&m&&0<m.length&&c){var L=k.attributes[n];d.forEach(m,h.hitch(this,function(b,c){var d=this._getRelationshipLayerInfo(b.relatedTableId),e=d.name,y=N[b.relatedTableId],h="related-table-btn";g===this._featuresNum-1&&c===m.length-1&&(h=h+" "+f);c=a.create("div",{"class":h,role:"button",tabindex:"0",innerHTML:e},C);c.queryStatus="unload";c.url=
p;c.layerName=e;c.objectId=L;c.relationship=b;c.relationshipLayerInfo=d;c.relationshipPopupTemplate=y}))}}},_onBtnMultipleRelatedBackClicked:function(){this._showFeaturesResultDiv()},_onBtnMultipleRelatedBackKeydown:function(a){a.keyCode===e.ENTER||a.keyCode===e.SPACE||a.keyCode===e.ESCAPE?(a.stopPropagation(),this._onBtnMultipleRelatedBackClicked(),this.btnFeatureAction.focus()):a.keyCode===e.TAB&&a.shiftKey&&(a.preventDefault(),this.multipleRelatedRecordsResult.lastFocusItem.focus())},_onBtnSingleRelatedBackClicked:function(){this._showFeaturesResultDiv()},
_onBtnSingleRelatedBackKeydown:function(a){a.keyCode===e.ENTER||a.keyCode===e.SPACE||a.keyCode===e.ESCAPE?(a.stopPropagation(),this._onBtnSingleRelatedBackClicked(),this._currentRelatedRecord.focus()):a.keyCode===e.TAB&&a.shiftKey&&a.stopPropagation()},_onBtnSingleRelatedTitleKeydown:function(a){a.keyCode===e.TAB&&a.shiftKey&&(a.preventDefault(),this.singleRelatedRecordsResult.lastFocusItem.focus())},_showFeaturesResultDiv:function(){this.multipleRelatedRecordsResult&&this.multipleRelatedRecordsResult.destroy();
this.multipleRelatedRecordsResult=null;this.singleRelatedRecordsResult&&this.singleRelatedRecordsResult.destroy();this.singleRelatedRecordsResult=null;a.addClass(this.multipleRelatedRecordsDiv,"not-visible");a.addClass(this.singleRelatedRecordsResultDiv,"not-visible");a.removeClass(this.featuresResultDiv,"not-visible");this.emit("hide-related-records")},_showMultipleRelatedRecords:function(){this.singleRelatedRecordsResult&&this.singleRelatedRecordsResult.destroy();this.singleRelatedRecordsResult=
null;a.addClass(this.featuresResultDiv,"not-visible");a.addClass(this.singleRelatedRecordsResultDiv,"not-visible");a.removeClass(this.multipleRelatedRecordsDiv,"not-visible");this.emit("show-related-records");var b=this._getCurrentRelationships();this.relatedLayersSelect.removeOption(this.relatedLayersSelect.getOptions());d.forEach(b,h.hitch(this,function(a){var b=this._getRelationshipLayerInfo(a.relatedTableId);this.relatedLayersSelect.addOption({value:a.id+"",label:b.name,relationship:a,relationshipLayerInfo:b,
relationshipPopupTemplate:this.currentAttrs.relationshipPopupTemplates[a.relatedTableId]})}));this._onRelatedLayersSelectChanged()},_onRelatedLayersSelectChanged:function(){var a=this.relatedLayersSelect.get("value"),b=this.relatedLayersSelect.getOptions(a);if(b){this.multipleRelatedRecordsResult&&this.multipleRelatedRecordsResult.destroy();this.multipleRelatedRecordsResult=new L({map:this.map,layerDefinition:b.relationshipLayerInfo,nls:this.nls,config:this.currentAttrs.config});this.multipleRelatedRecordsResult.placeAt(this.multipleRelatedRecordsDiv);
this.multipleRelatedRecordsResult.lastFocusItem=this.multipleRelatedRecordsResultBackBtn;this.multipleRelatedRecordsResultBackBtn.focus();this.own(r(this.multipleRelatedRecordsResult,"focus-result-header",h.hitch(this,function(){this.multipleRelatedRecordsResultBackBtn.focus()})));var c=this.currentAttrs.config.url;this.shelter.show();var g=h.hitch(this,function(a){console.error(a);this.domNode&&this.shelter.hide()});this.singleQueryLoader.getObjectIdsForAllRelatedRecordsAction().then(h.hitch(this,
function(a){this._queryRelatedRecords(c,a,b.relationship.id).then(h.hitch(this,function(c){if(this.domNode){this.shelter.hide();var g=[];d.forEach(a,h.hitch(this,function(a){(a=c[a])&&a.features&&0<a.features.length&&(g=g.concat(a.features))}));var e=b.relationshipLayerInfo,f=new x;f.fields=h.clone(e.fields);f.features=g;f.geometryType=e.geometryType;f.fieldAliases={};d.forEach(f.fields,h.hitch(this,function(a){var b=a.name;f.fieldAliases[b]=a.alias||b}));this.multipleRelatedRecordsResult.setResult(b.relationshipPopupTemplate,
f)}}),g)}),g)}},_showSingleRelatedRecordsDiv:function(){this.multipleRelatedRecordsResult&&this.multipleRelatedRecordsResult.destroy();this.multipleRelatedRecordsResult=null;a.addClass(this.featuresResultDiv,"not-visible");a.addClass(this.multipleRelatedRecordsDiv,"not-visible");a.removeClass(this.singleRelatedRecordsResultDiv,"not-visible");this.emit("show-related-records")},_onSingleRelatedTableButtonClicked:function(a){this.singleRelatedRecordsResult&&this.singleRelatedRecordsResult.destroy();
this.singleRelatedRecordsResult=null;var b=a.url,c=a.layerName,g=a.objectId,e=a.relationship,f=a.relationshipLayerInfo,u=a.relationshipPopupTemplate;this.singleRelatedRecordsResult=new L({map:this.map,layerDefinition:f,nls:this.nls,config:this.currentAttrs.config});this.singleRelatedRecordsResult.placeAt(this.singleRelatedRecordsResultDiv);this.singleRelatedRecordsResultTitle.lastFocusItem=this.singleRelatedRecordsResultBackBtn;this.own(r(this.singleRelatedRecordsResult,"focus-result-header",h.hitch(this,
function(){this.singleRelatedRecordsResultTitle.focus()})));this._showSingleRelatedRecordsDiv();var k=h.hitch(this,function(){var b=new x;b.fields=h.clone(f.fields);b.features=a.relatedFeatures;b.geometryType=f.geometryType;b.fieldAliases={};d.forEach(b.fields,h.hitch(this,function(a){var c=a.name;b.fieldAliases[c]=a.alias||c}));this.singleRelatedRecordsResult.setResult(u,b);this.relatedTitleDiv.innerHTML=c;this.singleRelatedRecordsResultTitle.focus();this._currentRelatedRecord=a});"unload"===a.queryStatus?
(a.queryStatus="loading",this.shelter.show(),this._queryRelatedRecords(b,[g],e.id).then(h.hitch(this,function(b){this.domNode&&(this.shelter.hide(),b=(b=(b=b&&b[g])&&b.features)||[],a.relatedFeatures=b,a.queryStatus="loaded",k())}),h.hitch(this,function(b){this.domNode&&(this.shelter.hide(),console.error(b),a.queryStatus="unload",k())}))):"loaded"===a.queryStatus&&k()},_queryRelatedRecords:function(a,b,c){a=new t(a);var d=new F;d.objectIds=b;d.relationshipId=c;d.outFields=["*"];d.returnGeometry=!0;
d.outSpatialReference=this.map.spatialReference;return a.executeRelationshipQuery(d)},_getCurrentRelationships:function(){return this.getCurrentAttrs().queryTr.layerInfo.relationships||[]},_getRelationshipInfo:function(a){for(var b=this._getCurrentRelationships(),c=0;c<b.length;c++)if(b[c].id===a)return b[c];return null},_getRelationshipLayerInfo:function(a){return this.getCurrentAttrs().relationshipLayerInfos[a]},_tryLocaleNumber:function(a){var b=a;if(v.isDefined(a)&&isFinite(a))try{var c=z.localizeNumber(a);
"string"===typeof c&&(b=c)}catch(H){console.error(H)}return b+""},_showQueryErrorMsg:function(a){new J({message:a||this.nls.queryError})},_onSinglePopupExpandIconClicked:function(b){var c=this.nls.expand,d=b.parentNode.parentNode;if(d){var g=a.hasClass(this.resultsTbody,"expanded");a.hasClass(d,"expanded")||a.hasClass(d,"folded")?a.hasClass(d,"expanded")?(a.removeClass(d,"expanded"),a.addClass(d,"folded")):(a.addClass(d,"expanded"),a.removeClass(d,"folded"),c=this.nls.collapse):g?(a.addClass(d,"folded"),
a.removeClass(d,"expanded")):(a.addClass(d,"expanded"),a.removeClass(d,"folded"),c=this.nls.collapse);a.setAttr(b,"aria-label",c);"true"===a.getAttr(b,"data-lastArrow")&&this.emit("features-layout-update")}},_onResultsTableKeydown:function(a){a.keyCode!==e.ENTER&&a.keyCode!==e.SPACE||this._onResultsTableClicked(a)},_onResultsTableClicked:function(b){b=b.target||b.srcElement;if(a.isDescendant(b,this.resultsTable))if(a.hasClass(b,"popup-title-icon"))this._onSinglePopupExpandIconClicked(b);else if(a.hasClass(b,
"related-table-btn"))this._onSingleRelatedTableButtonClicked(b);else if(b=a.hasClass(b,"query-result-item")?b:z.getAncestorDom(b,h.hitch(this,function(b){return a.hasClass(b,"query-result-item")}),this.resultsTbody)){this._selectResultTr(b);a.addClass(b,"jimu-state-active");b=b.feature;var c=b.geometry;if(c){var d=c.type,g;"point"===d?g=c:"multipoint"===d?1===c.points.length?g=c.getPoint(0):1<c.points.length&&(g=c.getPoint(0)):"polyline"===d?(g=c.getExtent(),g=g.expand(1.4),g=g.getCenter()):"polygon"===
d?(g=c.getExtent(),g=g.expand(1.4),g=g.getCenter()):"extent"===d&&(g=c.expand(1.4),g=g.getCenter());c=z.toFeatureSet(b);z.zoomToFeatureSet(this.map,c);"function"===typeof this.map.infoWindow.setFeatures&&this.map.infoWindow.setFeatures([b]);"function"===typeof this.map.infoWindow.reposition&&this.map.infoWindow.reposition();this.map.infoWindow.show(g)}}},_hideInfoWindow:function(){this.map&&this.map.infoWindow&&(this.map.infoWindow.hide(),"function"===typeof this.map.infoWindow.setFeatures&&this.map.infoWindow.setFeatures([]))},
_getFeatureSet:function(){var a=this.currentAttrs.query.resultLayer,b=null,c=this.currentAttrs.config&&this.currentAttrs.config.popupInfo;c&&(b=c.fieldInfos);var g=new x;g.fields=h.clone(a.fields);g.features=[].concat(a.graphics);g.geometryType=a.geometryType;g.fieldAliases={};d.forEach(g.fields,h.hitch(this,function(a){var c=a.name;a=this._getFieldAliasByPopupInfo(a,b);g.fieldAliases[c]=a}));return g},_getFieldAliasByPopupInfo:function(a,b){var c=a.name;a=a.alias||c;b&&b.length&&(b=b.filter(function(a){return a.fieldName===
c})[0])&&(a=b.label);return a},_onBtnMenuClicked:function(b){var c=a.position(b.target||b.srcElement),g=this._getFeatureSet(),e=this.getCurrentAttrs();this.featureActionManager.getSupportedActions(g,e.query.resultLayer).then(h.hitch(this,function(a){d.forEach(a,h.hitch(this,function(a){a.data=g}));if(!e.config.enableExport){var b=["ExportToCSV","ExportToFeatureCollection","ExportToGeoJSON","SaveToMyContent"];a=d.filter(a,h.hitch(this,function(a){return 0>b.indexOf(a.name)}))}a=d.filter(a,h.hitch(this,
function(a){return"CreateLayer"!==a.name}));var f=new K({name:"RemoveQueryResult",iconClass:"icon-close",label:this.nls.removeThisResult,iconFormat:"svg",map:this.map,onExecute:h.hitch(this,this._removeResult)});f.name="RemoveQueryResult";f.data=g;a.push(f);(f=this._getRelatedTableAction(g))&&a.push(f);(f=this._getSymbolAction(g))&&a.push(f);this.popupMenu.setActions(a);this.popupMenu._setFocusedNodeBeforeOpen();this.popupMenu.show(c)}))},_onBtnMenuKeydown:function(a){a.keyCode!==e.ENTER&&a.keyCode!==
e.SPACE||this._onBtnMenuClicked(a)},_getObjectIdField:function(){return this.currentAttrs.config.objectIdField},_getSymbolAction:function(a){var b=null;this.currentAttrs.query.resultLayer.renderer&&this.currentAttrs.config.canModifySymbol&&(b=new K({name:"ChangeSymbol",label:this.nls.changeSymbol,data:a&&a.features,iconClass:"icon-edit-symbol",iconFormat:"svg",map:this.map,onExecute:h.hitch(this,this._showSymbolChooser)}));return b},_showSymbolChooser:function(){var a=this.currentAttrs.query.resultLayer,
b=a.renderer,c={};(b=b.defaultSymbol||b.symbol)?c.symbol=b:(a=z.getSymbolTypeByGeometryType(a.geometryType),c.type=a);var d=new g(c),e=new C({width:380,autoHeight:!0,titleLabel:this.nls.changeSymbol,content:d,onClose:h.hitch(this,function(){d.destroy();e=d=null}),buttons:[{label:window.jimuNls.common.ok,onClick:h.hitch(this,function(){var a=d.getSymbol();this._updateSymbol(a);e.close()})},{label:window.jimuNls.common.cancel,onClick:h.hitch(this,function(){e.close()})}]})},_updateSymbol:function(c){var g=
new G(c),e=this.currentAttrs.query.resultLayer;e.setRenderer(g);e.redraw();g=b(".symbol",this.resultsTable);d.forEach(g,h.hitch(this,function(b){var d=b.parentElement;a.destroy(b);(b=D.createSymbolNode(c,{width:32,height:32}))&&a.place(b,d)}))},_getRelatedTableAction:function(a){var b=null,c=a&&a.features,d=this._getCurrentRelationships();this._getObjectIdField()&&0<c.length&&d&&0<d.length&&this._isWebMapShowRelatedRecordsEnabled()&&(b=new K({iconClass:"icon-show-related-record",icon:"",data:a,label:this.nls.showAllRelatedRecords,
onExecute:h.hitch(this,function(){this._showMultipleRelatedRecords();var a=new m;a.resolve();return a}),getIcon:function(){return""}}));return b},_isWebMapShowRelatedRecordsEnabled:function(){var a=this.currentAttrs.config.popupInfo;return a.relatedRecordsInfo?!1!==a.relatedRecordsInfo.showRelatedRecords:!0},_removeResult:function(){this.queryWidget.removeSingleQueryResult(this);this._hideInfoWindow()},_getAvailableWidget:function(a){return(a=this.queryWidget.appConfig.getConfigElementsByName(a)[0])&&
a.visible?a:null},_openAttributeTable:function(){var a=this._getAvailableWidget("AttributeTable");if(a){var b=E.getInstanceSync().getLayerInfoById(this.currentAttrs.query.resultLayer.id);this.queryWidget.widgetManager.triggerWidgetOpen(a.id).then(h.hitch(this,function(){this.queryWidget.publishData({target:"AttributeTable",layer:b})}))}}})})},"widgets/Query/RelatedRecordsResult":function(){define("dojo/query dojo/keys dojo/Evented dojo/_base/html dojo/_base/lang dojo/_base/array dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./RelatedRecordsResult.html esri/dijit/PopupRenderer esri/layers/FeatureLayer esri/renderers/SimpleRenderer jimu/utils jimu/symbolUtils jimu/BaseFeatureAction jimu/dijit/Popup jimu/dijit/FeatureActionPopupMenu jimu/dijit/SymbolChooser jimu/FeatureActionManager".split(" "),
function(n,k,q,p,c,f,l,h,r,e,b,a,d,m,v,t,x,A,w,F,G){return l([h,r,e,q],{baseClass:"related-records-result",templateString:b,popupMenu:null,featureActionManager:null,featureSet:null,layer:null,map:null,layerDefinition:null,nls:null,config:null,postCreate:function(){this.inherited(arguments);this.popupMenu=w.getInstance();this.featureActionManager=G.getInstance();this.btnAction.title=window.jimuNls.featureActions.featureActions;if("Table"!==this.layerDefinition.type){this.layer=new d({layerDefinition:{type:this.layerDefinition.type,
geometryType:this.layerDefinition.geometryType,fields:this.layerDefinition.fields,typeIdField:this.layerDefinition.typeIdField,types:this.layerDefinition.types}});var a=v.getTypeByGeometryType(this.layerDefinition.geometryType),b=null;"point"===a?b=t.getDefaultMarkerSymbol():"polyline"===a?b=t.getDefaultLineSymbol():"polygon"===a&&(b=t.getDefaultFillSymbol());b&&(a=new m(b),this.layer.setRenderer(a));this.map.addLayer(this.layer)}else this.layer=new d({layerDefinition:{type:this.layerDefinition.type,
fields:this.layerDefinition.fields,typeIdField:this.layerDefinition.typeIdField,types:this.layerDefinition.types}})},destroy:function(){this.layer&&this.map.removeLayer(this.layer);this.layer=null;this.inherited(arguments)},setResult:function(a,b){this.layer&&this.layer.clear();this.featureSet=b;if(0<b.features.length){f.forEach(b.features,c.hitch(this,function(b,c){this.layer&&this.layer.add(b);this._createItem(a,b,c)}));var d=n(".item-title",this.content);this.lastFocusItem=d[d.length-1];p.removeClass(this.btnAction,
"not-visible");p.addClass(this.noResultTip,"not-visible");p.removeClass(this.content,"not-visible");b.geometryType&&v.zoomToFeatureSet(this.map,b)}else p.addClass(this.btnAction,"not-visible"),p.removeClass(this.noResultTip,"not-visible"),p.addClass(this.content,"not-visible"),this.lastFocusItem=this.noResultTip},_onNoResultTipKeydown:function(a){a.keyCode!==k.TAB||a.shiftKey||(a.preventDefault(),this.emit("focus-result-header"))},getLayer:function(){return this.layer},showLayer:function(){this.layer&&
this.layer.show()},hideLayer:function(){this.layer&&this.layer.hide()},_createItem:function(b,c,d){var e=b.getTitle(c)||"",f="";d===this.featureSet.features.length-1&&(f='data-isLastItem\x3d"true"');d=p.toDom('\x3cdiv class\x3d"item"\x3e\x3cdiv class\x3d"item-title" '+f+' role\x3d"button" tabindex\x3d"0"\x3e'+e+'\x3c/div\x3e\x3cdiv class\x3d"item-content" '+f+' tabindex\x3d"0"\x3e\x3c/div\x3e\x3c/div\x3e');e=n(".item-content",d)[0];b=new a({template:b,graphic:c,chartTheme:b.chartTheme});p.place(b.domNode,
e);b.startup();p.place(d,this.content)},_onContentClicked:function(a){a=a.target||a.srcElement;var b=null;if(b=p.hasClass(a,"item-title")?a:v.getAncestorDom(a,function(a){return p.hasClass(a,"item-title")},this.content)){var c=b.parentNode;p.toggleClass(c,"selected");var d=p.hasClass(c,"selected");n(".item",this.content).removeClass("selected");d&&p.addClass(c,"selected");"true"===p.getAttr(a,"data-isLastItem")&&(this.lastFocusItem=d?b.nextElementSibling:b)}},_onContentKeydown:function(a){if(a.keyCode===
k.ENTER||a.keyCode===k.SPACE)this._onContentClicked(a);else if(a.keyCode===k.TAB&&!a.shiftKey&&"true"===p.getAttr(a.target,"data-isLastItem")){var b=p.hasClass(a.target.parentNode,"selected");if(!b||b&&p.hasClass(a.target,"item-content"))a.preventDefault(),this.emit("focus-result-header")}},_onBtnBackClicked:function(){this.emit("back")},_onBtnMenuClicked:function(a){if(this.featureSet){var b=p.position(a.target||a.srcElement);this.featureActionManager.getSupportedActions(this.featureSet).then(c.hitch(this,
function(a){f.forEach(a,c.hitch(this,function(a){a.data=this.featureSet}));if(!this.config.enableExport){var d=["ExportToCSV","ExportToFeatureCollection","ExportToGeoJSON","SaveToMyContent"];a=f.filter(a,c.hitch(this,function(a){return 0>d.indexOf(a.name)}))}a=f.filter(a,c.hitch(this,function(a){return"CreateLayer"!==a.name}));var e=this._getSymbolAction();e&&a.push(e);this.popupMenu.setActions(a);this.popupMenu._setFocusedNodeBeforeOpen();this.popupMenu.show(b)}))}},_onBtnMenuKeydown:function(a){a.keyCode!==
k.ENTER&&a.keyCode!==k.SPACE||this._onBtnMenuClicked(a)},_getSymbolAction:function(){var a=null;"Table"!==this.layerDefinition.type&&this.layer&&this.layer.renderer&&this.config.canModifySymbol&&((a=this.featureSet&&this.featureSet.features)||(a=[]),a=new x({name:"ChangeSymbol",label:this.nls.changeSymbol,data:a,iconClass:"icon-edit-symbol",iconFormat:"svg",map:this.map,onExecute:c.hitch(this,this._showSymbolChooser)}));return a},_showSymbolChooser:function(){if(this.layer){var a=this.layer.renderer,
b={};(a=a.defaultSymbol||a.symbol)?b.symbol=a:(a=v.getSymbolTypeByGeometryType(this.layer.geometryType),b.type=a);var d=new F(b),e=new A({width:380,autoHeight:!0,titleLabel:this.nls.changeSymbol,content:d,onClose:c.hitch(this,function(){d.destroy();e=d=null}),buttons:[{label:window.jimuNls.common.ok,onClick:c.hitch(this,function(){var a=d.getSymbol(),a=new m(a);this.layer.setRenderer(a);this.layer.redraw();e.close()})},{label:window.jimuNls.common.cancel,onClick:c.hitch(this,function(){e.close()})}]})}}})})},
"widgets/Query/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/Query/TaskSetting.html":'\x3cdiv tabindex\x3d"0" data-a11y-label-by\x3d"taskSettingName"\x3e\r\n  \x3ctable class\x3d"top"\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd class\x3d"first-td"\x3e\r\n        \x3cdiv role\x3d"button" tabindex\x3d"0" aria-label\x3d"${nls.back}" class\x3d"back-arrow feature-action icon-arrow-back" data-dojo-attach-point\x3d"backArrow" data-dojo-attach-event\x3d"onclick:_onBtnParamsBackClicked,onkeydown:_onBtnParamsBackKeydown"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd class\x3d"second-td"\x3e\r\n        \x3cdiv class\x3d"task-name jimu-ellipsis" data-dojo-attach-point\x3d"taskNameDiv" data-a11y-label-id\x3d"taskSettingName"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd class\x3d"third-td"\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n  \x3cdiv class\x3d"content-container"\x3e\r\n\r\n    \x3cdiv class\x3d"params-container" data-dojo-attach-point\x3d"paramsContainer"\x3e\r\n      \x3cdiv tabindex\x3d"0" class\x3d"not-visible" data-dojo-attach-point\x3d"noFilterTip"\x3e${nls.noAttributeSpatialFilterTip}\x3c/div\x3e\r\n      \x3cdiv class\x3d"attributes-section" data-dojo-attach-point\x3d"attributesSectionDiv" data-a11y-label-by\x3d"queryCriteira-label queryCriteira-sql"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"criteiraLabelDiv" class\x3d"first-stress attribute-filter-label" data-a11y-label-id\x3d"queryCriteira-label"\x3e${nls.queryCriteira}\x3c/div\x3e\r\n        \x3cdiv class\x3d"sql-div jimu-widget-note" data-dojo-attach-point\x3d"sqlDiv" data-a11y-label-id\x3d"queryCriteira-sql"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"spatial-section" data-dojo-attach-point\x3d"spatialSectionDiv" data-a11y-label-by\x3d"spatialFilter-label spatialFilter-tip"\x3e\r\n        \x3cdiv tabindex\x3d"0" class\x3d"spearator not-visible" data-dojo-attach-point\x3d"spatialSpearator"\x3e\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"spatialFilterLabelDiv" class\x3d"first-stress spatial-filter-label" data-a11y-label-id\x3d"spatialFilter-label"\x3e${nls.spatialFilter}\x3c/div\x3e\r\n        \x3cdiv class\x3d"spatial-filter-tip" data-dojo-attach-point\x3d"spatialFilterTip" data-a11y-label-id\x3d"spatialFilter-tip"\x3e\x3c/div\x3e\r\n        \x3cselect data-dojo-type\x3d"jimu/dijit/formSelect" data-a11y-label-by\x3d"spatialFilter-label spatialFilter-tip" data-dojo-attach-point\x3d"spatialTypeSelect" data-dojo-attach-event\x3d"change:_onSpatialTypeSelectChanged" class\x3d"restrict-select-width" style\x3d"width:100%;box-sizing:border-box;"\x3e\x3c/select\x3e\r\n\r\n        \x3cdiv class\x3d"spatial-filter-content" data-dojo-attach-point\x3d"spatialFilterContent"\x3e\r\n          \x3cdiv class\x3d"drawing-section" data-dojo-attach-point\x3d"drawingSection"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"features-section" data-dojo-attach-point\x3d"featuresSection"\x3e\r\n            \x3cdiv class\x3d"relationship-section"\x3e\r\n              \x3cdiv class\x3d"second-stress relationship-tip" data-a11y-label-id\x3d"spatialRelationship"\x3e${nls.spatialRelationship}\x3c/div\x3e\r\n              \x3cselect data-dojo-attach-point\x3d"relationshipSelect" data-a11y-label-by\x3d"spatialRelationship" data-dojo-type\x3d"jimu/dijit/formSelect" class\x3d"restrict-select-width relationship-select" style\x3d"width:100%;box-sizing:border-box;"\x3e\x3c/select\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"layerNameContainer" class\x3d"result-name-container"\x3e\r\n      \x3cdiv class\x3d"first-stress" data-a11y-label-id\x3d"layerName" \x3e${nls.layerName}\x3c/div\x3e\r\n      \x3cdiv class\x3d"result-name-text" data-a11y-label-by\x3d"layerName" data-dojo-attach-point\x3d"layerNameTextBox" data-dojo-type\x3d"dijit/form/TextBox" data-dojo-attach-event\x3d"change:_onLayerNameTextChanged"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"jimu-btn btn-execute" data-dojo-attach-point\x3d"btnExecute" data-dojo-attach-event\x3d"onclick:_onBtnApplyClicked,onkeydown:_onBtnApplyKeydown"\x3e${nls.apply}\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/SearchDistance.html":'\x3cdiv\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"cbxDiv"\x3e\x3c/div\x3e\r\n\t\x3ctable style\x3d"table-layout:fixed;width:100%;"\x3e\r\n\t\t\x3ccolgroup\x3e\r\n\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3ccol width\x3d"15px"\x3e\x3c/col\x3e\r\n\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\x3c/colgroup\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"numberTextBox" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n\t\t\t\t\t data-dojo-props\x3d\'"required":true,intermediateChanges:false,constraints:{min:0,pattern:"#####0.##########"}\'\r\n\t\t\t\t\t style\x3d"width:100%;" data-dojo-attach-event\x3d"change:_onNumberTextBoxChanged" /\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cselect data-dojo-type\x3d"jimu/dijit/formSelect" data-dojo-attach-point\x3d"unitSelect"\r\n\t\t\t\t\tdata-dojo-attach-event\x3d"change:_onUnitSelectChanged" style\x3d"width:100%;"\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"MILES" selected\x3e${nls.miles}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"KILOMETERS"\x3e${nls.kilometers}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"FEET"\x3e${nls.feet}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"METERS"\x3e${nls.meters}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"YARDS"\x3e${nls.yards}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3coption value\x3d"NAUTICAL_MILES"\x3e${nls.nauticalMiles}\x3c/option\x3e\r\n\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/SpatialFilterByFeatures.html":'\x3cdiv\x3e\r\n\t\x3cdiv class\x3d"layer-tip second-stress" data-dojo-attach-point\x3d"tipNode"\x3e${nls.relatedLayer}\x3c/div\x3e\r\n\t\x3ctable\x3e\r\n\t\t\x3ccolgroup\x3e\r\n\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3ccol width\x3d"100"\x3e\x3c/col\x3e\r\n\t\t\x3c/colgroup\x3e\r\n\t\t\x3ctbody\x3e\r\n\t\t\t\x3ctr\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv class\x3d"layers-select-div" data-dojo-attach-point\x3d"layerSelectDiv"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\x3cdiv class\x3d"jimu-float-trailing" data-dojo-attach-point\x3d"featureSetChooserDiv"\x3e\x3c/div\x3e\r\n\t\t\t\t\x3c/td\x3e\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\r\n\t\x3cdiv class\x3d"selection-option not-visible" data-dojo-attach-point\x3d"selectionOptionDiv"\x3e\x3c/div\x3e\r\n\r\n\t\x3cdiv class\x3d"search-distance-div" data-dojo-attach-point\x3d"searchDistanceDiv"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"loading" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/_TreeNode.html":'\x3cdiv class\x3d"dijitTreeNode" role\x3d"presentation"\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"rowNode" class\x3d"dijitTreeRow" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"expandoNode" class\x3d"dijitInline dijitTreeExpando" role\x3d"presentation"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"expandoNodeText" class\x3d"dijitExpandoText" role\x3d"presentation"\x3e\x3c/span\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"contentNode" class\x3d"dijitTreeContent" role\x3d"presentation"\x3e\r\n\t\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTreeIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"labelNode,focusNode" class\x3d"dijitTreeLabel" role\x3d"treeitem" tabindex\x3d"-1" aria-selected\x3d"false"\x3e\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeNodeContainer" role\x3d"presentation" style\x3d"display: none;"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/TreeNode.html":'\x3cdiv class\x3d"dijitTreeNode" role\x3d"presentation"\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"rowNode" class\x3d"dijitTreeRow" role\x3d"presentation"\r\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"expandoNode" class\x3d"dijitInline dijitTreeExpando" role\x3d"presentation"\x3e\x3c/span\r\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"expandoNodeText" class\x3d"dijitExpandoText" role\x3d"presentation"\x3e\x3c/span\r\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"contentNode"\r\n\t\t\tclass\x3d"dijitTreeContent" role\x3d"presentation"\x3e\r\n\t\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTreeIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan data-dojo-attach-point\x3d"labelNode,focusNode" class\x3d"dijitTreeLabel" role\x3d"treeitem"\r\n\t\t\t\t   tabindex\x3d"-1" aria-selected\x3d"false" id\x3d"${id}_label"\x3e\x3c/span\x3e\r\n\t\t\x3c/span\r\n\t\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeNodeContainer" role\x3d"presentation"\r\n\t\t style\x3d"display: none;" aria-labelledby\x3d"${id}_label"\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/templates/Tree.html":'\x3cdiv role\x3d"tree"\x3e\r\n\t\x3cdiv class\x3d"dijitInline dijitTreeIndent" style\x3d"position: absolute; top: -9999px" data-dojo-attach-point\x3d"indentDetector"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dijitTreeExpando dijitTreeExpandoLoading" data-dojo-attach-point\x3d"rootLoadingIndicator"\x3e\x3c/div\x3e\r\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeContainer" role\x3d"presentation"\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',"url:jimu/dijit/templates/LayerChooserFromMapWithDropbox.html":'\x3cdiv\x3e\r\n\x3ctable role\x3d"listbox" aria-haspopup\x3d"true" data-dojo-attach-point\x3d"dropDownBtn" data-dojo-attach-event\x3d"onclick: _onDropDownClick,onkeydown: _onDropDownKeydown"\r\n  tabindex\x3d"0" title\x3d"${nls.customSelectLayer}" aria-label\x3d"${nls.customSelectLayer}"\x3e\r\n    \x3ccaption class\x3d"screen-readers-only-no-position"\x3e${nls.customSelectLayer}\x3c/caption\x3e\r\n    \x3ccolgroup\x3e\r\n      \x3ccol width\x3d"10px"\x3e\x3c/col\x3e\r\n      \x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n      \x3ccol width\x3d"30px"\x3e\x3c/col\x3e\r\n    \x3c/colgroup\x3e\r\n    \x3ctbody\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd\x3e\x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"layer-name jimu-ellipsis" data-dojo-attach-point\x3d"layerNameNode"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv class\x3d"drop-select jimu-float-trailing" data-dojo-attach-point\x3d"dropArrowNode"\x3e\r\n            \x3cdiv class\x3d"jimu-icon jimu-icon-down-arrow-8"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/Query/SingleQueryResult.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"features-result" data-dojo-attach-point\x3d"featuresResultDiv"\x3e\r\n    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"popup-menu-button query-result-action-button" data-dojo-attach-point\x3d"btnFeatureAction" data-dojo-attach-event\x3d"click:_onBtnMenuClicked,keydown:_onBtnMenuKeydown"\x3e\x3c/div\x3e\r\n    \x3cdiv tabindex\x3d"0" class\x3d"results-number" data-dojo-attach-point\x3d"resultsNumberDiv"\x3e\r\n      \x3cdiv class\x3d"number-container"\x3e\r\n        \x3cdiv\x3e${nls.displayedFeatures}:\x3c/div\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"numSpan"\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"action-container"\x3e\r\n        \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"loadMoreIcon" class\x3d"icon load-more-button query-hidden" title\x3d"${nls.loadMore}" data-dojo-attach-event\x3d"onclick:_onLoadMoreClicked,onkeydown:_onLoadMoreKeydown"\x3e\x3c/div\x3e\r\n        \x3cdiv role\x3d"button" tabindex\x3d"0" data-dojo-attach-point\x3d"expandedListIcon" class\x3d"icon expand-list" data-dojo-attach-event\x3d"onclick:_onExpandClicked,onkeydown:_onExpandKeydown"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"results-container" data-dojo-attach-point\x3d"resultsContainer" data-dojo-attach-event\x3d"onscroll:_onResultsScroll" onselectstart\x3d"return false;"\x3e\r\n      \x3ctable data-dojo-attach-point\x3d"resultsTable" valign\x3d"top" class\x3d"results-table" data-dojo-attach-event\x3d"onclick:_onResultsTableClicked,onkeydown:_onResultsTableKeydown" cellpadding\x3d"0" cellspacing\x3d"0" \x3e\r\n        \x3ctbody data-dojo-attach-point\x3d"resultsTbody"\x3e\x3c/tbody\x3e\r\n      \x3c/table\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"multiple-related-records-section not-visible" data-dojo-attach-point\x3d"multipleRelatedRecordsDiv"\x3e\r\n    \x3ctable class\x3d"related-records-header multiple-related-records-header"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv role\x3d"button" tabindex\x3d"0" aria-label\x3d"${nls.back}" class\x3d"back-arrow feature-action icon-arrow-back"  data-dojo-attach-point\x3d"multipleRelatedRecordsResultBackBtn" data-dojo-attach-event\x3d"onclick:_onBtnMultipleRelatedBackClicked,onkeydown:_onBtnMultipleRelatedBackKeydown"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"middle-td"\x3e\r\n            \x3cselect data-dojo-type\x3d"jimu/dijit/formSelect" aria-label\x3d"${nls.relatedLayer}" data-dojo-attach-point\x3d"relatedLayersSelect" data-dojo-attach-event\x3d"change:_onRelatedLayersSelectChanged" style\x3d"width:100%;"\x3e\x3c/select\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"last-td"\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"single-related-records-section not-visible" data-dojo-attach-point\x3d"singleRelatedRecordsResultDiv"\x3e\r\n    \x3ctable role\x3d"title" tabindex\x3d"0" class\x3d"related-records-header single-related-records-header" data-dojo-attach-point\x3d"singleRelatedRecordsResultTitle" data-a11y-label-by\x3d"single-related-records-title"  data-dojo-attach-event\x3d"onkeydown:_onBtnSingleRelatedTitleKeydown"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd class\x3d"first-td"\x3e\r\n            \x3cdiv role\x3d"button" tabindex\x3d"0" aria-label\x3d"${nls.back}" class\x3d"back-arrow feature-action icon-arrow-back" data-dojo-attach-point\x3d"singleRelatedRecordsResultBackBtn" data-dojo-attach-event\x3d"onclick:_onBtnSingleRelatedBackClicked,onkeydown:_onBtnSingleRelatedBackKeydown"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"middle-td"\x3e\r\n            \x3cdiv class\x3d"related-records-title jimu-ellipsis" data-dojo-attach-point\x3d"relatedTitleDiv" data-a11y-label-id\x3d"single-related-records-title"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"last-td"\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d"hidden:true"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Query/RelatedRecordsResult.html":'\x3cdiv\x3e\r\n  \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"popup-menu-button related-records-action-button not-visible" data-dojo-attach-point\x3d"btnAction" data-dojo-attach-event\x3d"click:_onBtnMenuClicked,keydown:_onBtnMenuKeydown"\x3e\x3c/div\x3e\r\n  \x3cdiv tabindex\x3d"0" class\x3d"noresult-tip not-visible" data-dojo-attach-point\x3d"noResultTip" data-dojo-attach-event\x3d"keydown:_onNoResultTipKeydown"\x3e${nls.noResult}\x3c/div\x3e\r\n  \x3cdiv class\x3d"content not-visible" data-dojo-attach-point\x3d"content" data-dojo-attach-event\x3d"click:_onContentClicked,keydown:_onContentKeydown"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Query/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"jimu-widget-normal query-widget-content"\x3e\r\n    \x3cdiv class\x3d"query-tab-header" data-dojo-attach-point\x3d"tabHeader" data-dojo-attach-event\x3d"onclick:_onTabHeaderClicked,onkeydown:_onTabHeaderKeydown"\x3e\r\n      \x3cdiv role\x3d"tab" tabindex\x3d"0" aria-selected\x3d"true" class\x3d"query-tab-item jimu-ellipsis jimu-float-leading selected firstFocusNode" data-dojo-attach-point\x3d"taskQueryItem" title\x3d"${labelTasks}"\x3e${labelTasks}\x3c/div\x3e\r\n      \x3cdiv role\x3d"tab" tabindex\x3d"-1" aria-selected\x3d"false" class\x3d"query-tab-item jimu-ellipsis jimu-float-trailing" data-dojo-attach-point\x3d"resultQueryItem" title\x3d"${labelResults}"\x3e${labelResults}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"query-tabs-container"\x3e\r\n      \x3cdiv class\x3d"query-tab-view task-tab-view selected" data-dojo-attach-point\x3d"taskTabView"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"taskList" class\x3d"task-list"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"tasksNode" class\x3d"tasks"\x3e\r\n              \x3cdiv class\x3d"execute-tip not-visible"\x3e${nls.executeQueryTip}\x3c/div\x3e\r\n              \x3cdiv class\x3d"tasks-table-container"\x3e\r\n                \x3ctable data-dojo-attach-event\x3d"onclick:_onTaskListClicked,onkeydown:_onTaskListKeydown"\r\n                cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"list-table tasks-table" onselectstart\x3d"return false;"\x3e\r\n                  \x3ccolgroup\x3e\r\n                    \x3ccol width\x3d"40px"\x3e\x3c/col\x3e\r\n                    \x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n                  \x3c/colgroup\x3e\r\n                  \x3ctbody data-dojo-attach-point\x3d"tasksTbody"\x3e\x3c/tbody\x3e\r\n                \x3c/table\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv tabindex\x3d"0" data-dojo-attach-point\x3d"noQueryTipSection" class\x3d"no-query-tip"\x3e${nls.noTask}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"taskSettingContainer" class\x3d"task-setting-container"\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n\r\n      \x3cdiv class\x3d"query-tab-view result-tab-view" data-dojo-attach-point\x3d"resultTabView"\x3e\r\n        \x3cdiv class\x3d"result-section" data-dojo-attach-point\x3d"resultSection"\x3e\r\n          \x3cdiv class\x3d"resultlayers-select-div" data-dojo-attach-point\x3d"resultLayersSelectDiv"\x3e\r\n            \x3cdiv data-dojo-type\x3d"jimu/dijit/formSelect" aria-label\x3d"${nls.layerName}" data-dojo-attach-point\x3d"resultLayersSelect" class\x3d"restrict-select-width" style\x3d"width:100%;" data-dojo-attach-event\x3d"change:_onResultLayerSelectChanged"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv class\x3d"single-result-details" data-dojo-attach-point\x3d"singleResultDetails"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv tabindex\x3d"0" class\x3d"no-result-section" data-dojo-attach-point\x3d"noresultSection"\x3e${nls.noResult}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3c!--virtual last focus node--\x3e\r\n  \x3cdiv tabindex\x3d"0" class\x3d"screen-readers-only lastFocusNode" data-dojo-attach-point\x3d"lastNode_framework"\x3e\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:widgets/Query/css/style.css":'.jimu-widget-query{position: relative; width: 99%; height: 100%; min-width: 222px; min-height: 237px; overflow-x: hidden;}.jimu-widget-query .list-table tr.single-task:first-child,.jimu-widget-query .query-task-setting,.jimu-widget-query .back-arrow,.jimu-widget-query .single-query-result .query-result-action-button,.jimu-widget-query .single-query-result .query-result-item.jimu-table-row,.jimu-widget-query table.related-records-header,.jimu-widget-query .related-records-result .related-records-action-button,.jimu-widget-query .related-records-result .noresult-tip,.jimu-widget-query .related-records-result .content .item,.jimu-widget-query .related-records-result .content .item-title,.jimu-widget-query .related-records-result .content .item.selected .item-content{outline-offset: -2px !important;}.jimu-widget-query .popup-menu-button {width: 28px; height: 28px;}.jimu-widget-query .query-hidden {visibility: hidden;}.jimu-widget-query .text-ellipsis{white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}.jimu-widget-query .first-stress{font-family: "Avenir Light"; font-size: 14px; color: #000; margin-bottom: 5px; font-weight: bold;}.jimu-widget-query .second-stress{font-size: 12px; color: #353535; margin-bottom: 5px;}.jimu-widget-query .jimu-table-row{color: #000;}.jimu-widget-query .jimu-table-row.jimu-state-active{font-weight: normal; background-color: #eee;}.jimu-widget-query .query-result-item.jimu-table-row:first-child{border-top: 1px solid #cbcbcb;}.jimu-widget-query .not-visible{display: none !important;}.jimu-widget-query .jimu-checkbox .label{font-size: 12px; position: relative; top: 2px;}.jimu-widget-query .query-widget-content{position: absolute; width: 100%; left: 0; right: 0; height: auto; top: 0; bottom: 0;}.jimu-widget-query .query-tab-header{position: absolute; width: 100%; height: 30px; left: 0; right: 0; top: 0; font-size: 14px; border-bottom: 2px solid #ccc;}.jimu-widget-query .query-tab-item{width: calc(50% - 4px); height: 28px; line-height: 28px; cursor: pointer; text-align: center; padding: 0 5px; margin-top: 2px;}.jimu-widget-query .query-tab-item:first-child{margin-left: 2px;}.jimu-widget-query .query-tab-item:last-child{margin-right: 2px;}.jimu-rtl .jimu-widget-query .query-tab-item:first-child{margin-left: 0; margin-right: 2px;}.jimu-rtl .jimu-widget-query .query-tab-item:last-child{margin-right: 0; margin-left: 2px;}.jimu-widget-query .query-tab-item.selected{border-bottom: 2px solid #898989; font-weight: bold; color: #000;}.jimu-widget-query .query-tabs-container{position: absolute; width: 100%; left: 0; right: 0; top: 30px; bottom: 0;}.jimu-widget-query .query-tab-view{display: none; position: relative; width: 100%; height: 100%;}.jimu-widget-query .query-tab-view.selected{display: block;}.jimu-widget-query .list-table{width: 99%; border-collapse: collapse; table-layout: fixed; margin-left: auto; margin-right: auto;}.jimu-widget-query .list-table tr.single-task{border-top: 1px solid #D7D7D7; border-bottom: 1px solid #D7D7D7;}.jimu-widget-query .list-table tr.single-task:first-child{border-top: 0;}.jimu-widget-query .list-table tr.single-task:hover, .jimu-widget-query .list-table tr.single-task.selected{background-color: #eee;}.jimu-widget-query .list-table tr.single-task \x3e td{padding-top: 13px; padding-bottom: 13px; cursor: pointer; vertical-align: top;}.jimu-widget-query .list-table tr.single-task .list-item-name{width: 100%; overflow: hidden; text-overflow: ellipsis; display: inline-block; line-height: 16px;}.jimu-widget-query .list-table tr.single-task .first-td{text-align: center;}.jimu-widget-query .list-table tr.single-task .task-icon{width: 16px; height: 16px; vertical-align: middle;}.jimu-widget-query .task-list{position: absolute; top: 10px; bottom: 0; width: 100%;}.jimu-widget-query .task-list .tasks{position: absolute; width: 100%; height: 100%; left: 0; top: 0; overflow-y: auto;}.jimu-widget-query .task-list .tasks .execute-tip{margin-top: 10px; line-height: 20px;}.jimu-widget-query .task-list .tasks .tasks-table-container{width: 100%;}.jimu-widget-query .task-list .invalid-config{display: none; position: absolute; width: 100%; height: 100%; left: 0; top: 0;}.jimu-widget-query .task-list .no-query-tip{display: none; margin: 0 2px; line-height: 20px;}.jimu-widget-query .task-setting-container{height: 100%; display: none;}.jimu-widget-query .query-task-setting{position: relative; height: 100%;}.jimu-widget-query .query-task-setting table.top{width: 100%; table-layout: fixed; padding-top: 12px;}.jimu-widget-query .query-task-setting table.top .first-td{width: 30px;}.jimu-widget-query .query-task-setting table.top .second-td{width: auto;}.jimu-widget-query .query-task-setting table.top .third-td{width: 30px;}.jimu-widget-query.only-one-task .query-task-setting table.top .first-td,.jimu-widget-query.only-one-task .query-task-setting table.top .third-td{width: 0;}.jimu-widget-query.only-one-task .query-task-setting table.top .first-td,.jimu-widget-query.only-one-task .query-task-setting table.top .third-td{display: none; overflow: hidden;}.jimu-widget-query .back-arrow{display: inline-block; width: 16px; height: 16px;}.jimu-rtl .jimu-widget-query .back-arrow{-webkit-transform: rotate(180deg); -ms-transform: rotate(180deg); transform: rotate(180deg);}.jimu-widget-query .query-task-setting .task-name{text-align: center;}.jimu-widget-query .query-task-setting .content-container {position: absolute; width: 100%; top: 50px; overflow-x: hidden; overflow-y: auto; bottom: 50px; padding: 2px;}.jimu-widget-query .query-task-setting .content-container .result-name-container {margin-top: 12px;}.jimu-widget-query .query-task-setting .content-container .result-name-container .result-name-text {width: 100%;}.jimu-widget-query .query-task-setting .spatial-section .spearator{height: 1px; margin-bottom: 12px; border-top: 1px solid #D7D7D7; display: none;}.jimu-widget-query .query-task-setting .spatial-section .relationship-section{margin-top: 10px;}.jimu-widget-query .query-task-setting .spatial-section .jimu-dijit-spatial-filter-features{margin-top: 10px;}.jimu-widget-query .query-task-setting .attributes-section{margin-bottom: 12px;}.jimu-widget-query .query-task-setting .attributes-section .jimu-filter-parameters .jimu-single-filter-parameter .hint{color:#666666;}.jimu-widget-query .query-task-setting .attributes-section .jimu-filter-parameters .jimu-single-filter-parameter .prompt{color:#000000;}.jimu-widget-query .query-task-setting .attributes-section .attribute-filter-label{margin-bottom: 5px;}.jimu-widget-query .query-task-setting .btn-execute.jimu-btn{position: absolute; width: calc(100% - 4px); margin: 0 2px; bottom: 2px; text-align: center; background-color: #59A700; border-radius: 0;}.jimu-widget-query .query-task-setting .btn-execute.jimu-btn.disabled{background-color: #ccc !important; cursor: default;}.jimu-widget-query .query-task-setting .btn-execute:hover{background-color: #417505;}.jimu-widget-query .query-task-setting .btn-execute:active{background-color: #59A700;}.jimu-query-spatial-filter-drawing \x3e .jimu-checkbox {width: 100%;}.jimu-query-spatial-filter-drawing \x3e .jimu-checkbox \x3e div.label {white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 90%;}.jimu-query-spatial-filter-drawing .search-distance-div{margin-top: 15px;}.jimu-query-spatial-filter-drawing .jimu-draw-box .drawings-clear{margin-left: 18px;}.jimu-rtl .jimu-query-spatial-filter-drawing .jimu-draw-box .drawings-clear{margin-left: 0; margin-right: 18px;}.jimu-widget-query .result-list{padding-top: 10px;}.jimu-widget-query .result-tab-view .result-section{position: absolute; left: 0; right: 0; top: 0; bottom: 0;}.jimu-widget-query .result-tab-view .no-result-section{position: absolute; top: 10px; margin: 0 2px; line-height: 20px; width: calc(100% - 4px);}.jimu-widget-query .resultlayers-select-div{position: absolute; left: 2px; right: 37px; top: 15px; text-align: center; overflow: visible;}.jimu-rtl .jimu-widget-query .resultlayers-select-div{left: 37px; right: 2px;}.jimu-widget-query .single-result-details{position: absolute; width: 100%; left: 0; right: 0; top: 45px; bottom: 5px;}.jimu-widget-query .single-query-result,.jimu-widget-query .single-query-result .features-result{position: relative; width: 100%; height: 100%;}.jimu-widget-query .single-query-result .multiple-related-records-section,.jimu-widget-query .single-query-result .single-related-records-section{position: relative; width: 100%; height: calc(100% + 45px); top: -45px;}.jimu-widget-query .single-query-result .query-result-action-button{position: absolute; top: -28px; right: 0;}.jimu-rtl .jimu-widget-query .single-query-result .query-result-action-button{right: auto; left: 0;}.jimu-widget-query .single-query-result .results-number{position: relative; top: 13px; margin: 0 2px; display: flex; align-items: center; justify-content: space-between;}.jimu-widget-query .single-query-result .results-number .number-container {display: flex; align-items: center; justify-content: flex-start;}.jimu-widget-query .single-query-result .results-number .action-container {display: flex; align-items: center; justify-content: space-between; width: 52px;}.jimu-widget-query .single-query-result .results-number .action-container .icon {width: 16px; height: 16px; cursor: pointer; background-position: center; background-repeat: no-repeat; background-size: contain; background-clip: content-box;}.jimu-widget-query .single-query-result .results-number .action-container .icon.load-more-button {background-image: url(images/load-light-hover.svg); opacity: 0.5;}.jimu-widget-query .single-query-result .results-number .action-container .icon.load-more-button.loading,.jimu-widget-query .single-query-result .results-number .action-container .icon.load-more-button.loading:hover {background-image: url(images/loading-light.svg); -webkit-animation: load8 1.1s infinite linear; animation: load8 1.1s infinite linear;}.jimu-widget-query .single-query-result .results-number .action-container .icon.load-more-button:hover {background-image: url(images/load-light-hover.svg); opacity:1;}.jimu-widget-query .single-query-result .results-number .action-container .icon.expand-list {background-image: url(images/fold-list-light-hover.svg); opacity: 0.5;}.jimu-widget-query .single-query-result .results-number .action-container .icon.expand-list:hover {background-image: url(images/fold-list-light-hover.svg); opacity: 1;}.jimu-widget-query .single-query-result .results-number .action-container .icon.expand-list.folded {background-image: url(images/expand-list-light-hover.svg); opacity:0.5;}.jimu-widget-query .single-query-result .results-number .action-container .icon.expand-list.folded:hover {background-image: url(images/expand-list-light-hover.svg); opacity:1;}.jimu-widget-query .single-query-result .results-container{position: absolute; width: 100%; left: 0; right: 0; top: 40px; bottom: 0; overflow-x: hidden; overflow-y: auto;}.jimu-widget-query .single-query-result .results-container .query-result-item-table .popup-td .popup-title-container {display: flex; align-items: center; justify-content: space-between;}.jimu-widget-query .single-query-result .results-container .query-result-item-table .popup-td .popup-title-container .popup-title {font-weight: bold;}.jimu-widget-query .single-query-result .results-container .query-result-item-table .popup-td .popup-content {margin-top: 8px;}.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td .popup-content,.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td.folded .popup-content,.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td.folded .popup-content {display: none;}.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td .popup-content,.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td.expanded .popup-content,.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td.expanded .popup-content {display: block;}.jimu-widget-query .single-query-result .results-container .query-result-item-table .popup-td .popup-title-icon {width: 24px; height: 16px;}.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td .popup-title-icon,.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td.folded .popup-title-icon,.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td.folded .popup-title-icon {background: url(images/expand-item-light-hover.svg) center center no-repeat content-box; opacity: 0.5;}.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td .popup-title-icon:hover,.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td.folded .popup-title-icon:hover,.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td.folded .popup-title-icon:hover {background: url(images/expand-item-light-hover.svg) center center no-repeat content-box; opacity: 1;}.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td .popup-title-icon,.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td.expanded .popup-title-icon,.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td.expanded .popup-title-icon {background: url(images/fold-item-light-hover.svg) center center no-repeat content-box; opacity: 0.5; outline-offset: -1px !important;}.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td .popup-title-icon:hover,.jimu-widget-query .single-query-result .results-container tbody.expanded .query-result-item-table .popup-td.expanded .popup-title-icon:hover,.jimu-widget-query .single-query-result .results-container tbody.folded .query-result-item-table .popup-td.expanded .popup-title-icon:hover {background: url(images/fold-item-light-hover.svg) center center no-repeat content-box; opacity: 1;}.jimu-widget-query .single-query-result .results-table{table-layout: fixed; width: 100%; border-collapse: collapse;}.jimu-widget-query .single-query-result .query-result-item.jimu-table-row{border-left: 0 !important; border-right: 0 !important;}.jimu-widget-query .single-query-result .query-result-item \x3e td{padding-top: 8px; padding-bottom: 8px; cursor: pointer;}.jimu-rtl .jimu-widget-query .single-query-result .query-result-item \x3e td{padding-left: 0; padding-right: 15px;}.jimu-widget-query .single-query-result .query-result-item .esriViewPopup .header{margin-bottom: 8px;}.jimu-widget-query .single-query-result .query-result-item .esriViewPopup .hzLine{display: none;}.jimu-widget-query .single-query-result .query-result-item .esriViewPopup .mainSection .break{display: none;}.jimu-widget-query .single-query-result .query-result-item-table{width: 100%; table-layout: fixed; border-collapse: collapse;}.jimu-widget-query .single-query-result .query-result-item-table .symbol-td{width: 36px;}.jimu-widget-query .single-query-result .query-result-item-table .popup-td{width: auto;}.jimu-widget-query .single-query-result .query-result-item .related-table-btn{height: 30px; line-height: 30px; margin: 5px 2px; padding: 0 5px; background: url(images/arrow_right1.png) right center no-repeat content-box; overflow: hidden; text-overflow: hidden; white-space: nowrap; font-family: "Avenir Medium"; color: #000;}.jimu-widget-query .single-query-result .query-result-item .related-table-btn:hover{font-weight: bold; background: url(images/arrow_right2.png) right center no-repeat content-box;}.jimu-rtl .jimu-widget-query .single-query-result .query-result-item .related-table-btn{background: url(images/arrow_left1.png) left center no-repeat content-box;}.jimu-rtl .jimu-widget-query .single-query-result .query-result-item .related-table-btn:hover{background: url(images/arrow_left2.png) left center no-repeat content-box;}.jimu-widget-query table.related-records-header{margin-top: 5px; width: 100%; min-height: 36px; border-collapse: collapse; table-layout: fixed;}.jimu-widget-query table.related-records-header\x3etbody\x3etr\x3etd{height: 36px;}.jimu-widget-query table.related-records-header\x3etbody\x3etr\x3e.first-td{width: 30px;}.jimu-widget-query table.related-records-header\x3etbody\x3etr\x3e.middle-td{width: auto;}.jimu-widget-query table.related-records-header\x3etbody\x3etr\x3e.last-td{width: 40px;}.jimu-widget-query table.related-records-header .related-records-title{text-align: center;}.jimu-widget-query .related-records-result{position: absolute; left: 0; right: 0; top: 45px; bottom: 0; width: 100%; height: calc(100% - 45px);}.jimu-widget-query .related-records-result .related-records-action-button{position: absolute; right: 0; top: -40px; z-index: 1;}.jimu-rtl .jimu-widget-query .related-records-result .related-records-action-button{position: absolute; right: auto; left: 0; top: 0;}.jimu-widget-query .related-records-result .noresult-tip{line-height: 25px; padding: 0 2px;}.jimu-widget-query .related-records-result .content{position: absolute; left: 0; right: 0; top: 0; bottom: 0; overflow: auto;}.jimu-widget-query .related-records-result .content .item{border-top: 1px solid #E2E2E2;}.jimu-widget-query .related-records-result .content .item:last-child{border-bottom: 1px solid #E2E2E2;}.jimu-widget-query .related-records-result .content .item-title{position: relative; height: 36px; line-height: 36px; cursor: pointer; background: url(images/arrow_right1.png) right center no-repeat content-box;}.jimu-rtl .jimu-widget-query .related-records-result .content .item-title{background: url(images/arrow_left1.png) left center no-repeat content-box;}.jimu-widget-query .related-records-result .content .item.selected .item-title{background: url(images/arrow_down.png) right center no-repeat content-box;}.jimu-rtl .jimu-widget-query .related-records-result .content .item.selected .item-title{background: url(images/arrow_down.png) left center no-repeat content-box;}.jimu-widget-query .related-records-result .content .item-title .esriNumericValue{position: absolute; left: 4px; right: 18px; top: 0; bottom: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-rtl .jimu-widget-query .related-records-result .content .item-title .esriNumericValue{left: 18px; right: 4px;}.jimu-widget-query .related-records-result .content .item-content{border-top: 1px solid #E2E2E2; display: none;}.jimu-widget-query .related-records-result .content .item.selected .item-content{display: block;}.jimu-widget-query .related-records-result .esriViewPopup .header{display: none;}.jimu-widget-query .related-records-result .esriViewPopup .hzLine{display: none;}.query-resultlayer-tooltipdialog-content{cursor: default;}.query-resultlayer-tooltipdialog-content .result-item{height: 20px; line-height: 20px; cursor: pointer;}.query-operations-tooltipdialog-content{cursor: default;}.query-operations-tooltipdialog-content .operation-item{height: 20px; line-height: 20px; cursor: pointer;}',
"*now":function(n){n(['dojo/i18n!*preload*widgets/Query/nls/Widget*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("dojo/on dojo/keys dojo/query dojo/Deferred dojo/_base/lang dojo/_base/html dojo/_base/array dojo/promise/all dojo/_base/declare dijit/_WidgetsInTemplateMixin jimu/utils jimu/BaseWidget jimu/MapManager jimu/filterUtils jimu/dijit/Message jimu/symbolUtils esri/lang esri/request esri/symbols/jsonUtils esri/layers/FeatureLayer esri/dijit/PopupTemplate esri/renderers/SimpleRenderer ./TaskSetting ./SingleQueryLoader ./SingleQueryResult ./utils jimu/LayerInfos/LayerInfos jimu/dijit/LoadingIndicator jimu/dijit/formSelect".split(" "),function(n,
k,q,p,c,f,l,h,r,e,b,a,d,m,v,t,x,A,w,F,G,z,D,C,J,B,K){return r([a,e],{name:"Query",baseClass:"jimu-widget-query",currentTaskSetting:null,hiddenClass:"not-visible",_resultLayerInfos:null,mapManager:null,layerInfosObj:null,labelTasks:"",labelResults:"",_focusNodes:{},miniCycleHandlers:{},postMixInProperties:function(){this.inherited(arguments);this.layerInfosObj=K.getInstanceSync();this.mapManager=d.getInstance();this._resultLayerInfos=[];var a=x.substitute({clearResults:this.nls.clearResults},this.nls.operationalTip);
this.nls.operationalTip=a;this.nls.layerName=window.apiNls.widgets.directions.layerName;this.labelTasks=this.nls.tasks;this.labelResults=this.nls.queryResults;this._setUrlForConfig();this._showFilterLabel=!0;this.config&&(this.config=B.getConfigWithValidDataSource(this.config),this._updateConfig(),this.config.labelTasks&&(this.labelTasks=this.config.labelTasks),this.config.labelResults&&(this.labelResults=this.config.labelResults),this._showFilterLabel=this.config.showFilterLabel)},_updateConfig:function(){this.config&&
this.config.queries&&0<this.config.queries.length&&l.forEach(this.config.queries,c.hitch(this,function(a){this._rebuildFilter(a.url,a.filter)}));this.config&&("undefined"===typeof this.config.showFilterLabel&&(this.config.showFilterLabel=!0),"undefined"===typeof this.config.criteiraLabel&&(this.config.criteiraLabel=this.nls.queryCriteira),"undefined"===typeof this.config.spatialFilterLabel&&(this.config.spatialFilterLabel=this.nls.spatialFilter))},_setUrlForConfig:function(){this.config&&this.config.queries&&
0<this.config.queries.length&&l.forEach(this.config.queries,c.hitch(this,function(a){if(a.webMapLayerId){var b=this.layerInfosObj.getLayerOrTableInfoById(a.webMapLayerId);b&&(a.url=b.getUrl())}}))},_rebuildFilter:function(a,c){try{if(c){delete c.expr;var d=new m;d.isHosted=b.isHostedService(a);d.getExprByFilterObj(c)}}catch(I){console.log(I)}},postCreate:function(){this.inherited(arguments);this._initSelf();this._updateResultDetailUI();var a=q(".single-task",this.tasksTbody);1===a.length?(f.addClass(this.domNode,
"only-one-task"),this._showTaskSettingPane(!0),this._onClickTaskTr(a[0])):(this._updateFocusNodes("taskList"),this.own(n(this.taskTabView,"keydown",c.hitch(this,function(a){a.keyCode===k.ESCAPE&&(a.stopPropagation(),this.taskQueryItem.focus())}))));this.own(n(this.resultTabView,"keydown",c.hitch(this,function(a){a.keyCode===k.ESCAPE&&(a.stopPropagation(),this.resultQueryItem.focus())})));this.own(n(this.lastNode_framework,"focus",c.hitch(this,function(){("true"===f.getAttr(this.taskQueryItem,"aria-selected")?
this.taskQueryItem:this.resultQueryItem).focus()})))},_focusCurrentFirstNode:function(a){a||(a="true"===f.getAttr(this.taskQueryItem,"aria-selected")?"none"!==f.getStyle(this.taskList,"display")?this._focusNodes.taskList.first:this._focusNodes.taskSetting?this._focusNodes.taskSetting.first:null:this._focusNodes.result?this._focusNodes.result.first:null);a&&a.focus()},_updateFocusNodes:function(a){var b,c;if("taskList"===a)c=q(".single-task",this.tasksTbody),0===c.length?b=c=this.noQueryTipSection:
(b=c[0],c=c[c.length-1]),this._focusNodes.taskList={first:b,last:c};else if("taskSetting"===a)b=this.currentTaskSetting.domNode,c=this.currentTaskSetting.btnExecute,this._focusNodes.taskSetting={first:b,last:c};else if("result"===a){if(0===this._resultLayerInfos.length)c=b=this.noresultSection;else{b=q("."+this.singleQueryResult._lastFeatureClass,this.singleQueryResult.resultsTbody);if(b[0]){b=b[b.length-1];c=q("."+this.singleQueryResult._lastRelatedClass,b)[0];var d=q(".popup-content",b)[0],d="block"===
f.getStyle(d,"display");c=c&&d?c:q("."+this.singleQueryResult._lastFeatureArrowClass,b)[0]}else c=this.singleQueryResult.expandedListIcon;b=this.resultLayersSelect.domNode}this._focusNodes.result={first:b,last:c}}this._initMiniCycle(a,b,c)},_initMiniCycle:function(a,b,d){this.miniCycleHandlers[a]?(this.miniCycleHandlers[a].first.remove(),this.miniCycleHandlers[a].last.remove()):this.miniCycleHandlers[a]={};this.miniCycleHandlers[a].first=n(b,"keydown",c.hitch(this,function(a){a.keyCode===k.TAB&&a.shiftKey&&
a.target===b&&(a.preventDefault(),d.focus())}));this.miniCycleHandlers[a].last=n(d,"keydown",c.hitch(this,function(a){a.keyCode!==k.TAB||a.shiftKey||(a.preventDefault(),b.focus())}))},_onFeaturesLayoutUpdate:function(){this._updateFocusNodes("result")},onOpen:function(){var a=this._getCurrentResultLayerInfo();(a=a&&a.singleQueryResult)&&a.showLayer();this._showTempLayers();this.inherited(arguments)},onActive:function(){this._showTempLayers()},onDeActive:function(){this.currentTaskSetting&&this.currentTaskSetting.deactivate();
this.mapManager.enableWebMapPopup();this._hideTempLayers()},onClose:function(){this.config.hideLayersAfterWidgetClosed&&this._hideAllLayers();this._hideInfoWindow();this._hideTempLayers();this.inherited(arguments)},destroy:function(){this._hideInfoWindow();this._removeResultLayerInfos(this._resultLayerInfos);this.inherited(arguments)},_hideTempLayers:function(){this.currentTaskSetting&&this.currentTaskSetting.hideTempLayers()},_showTempLayers:function(){this.currentTaskSetting&&this.currentTaskSetting.showTempLayers()},
_initSelf:function(){var a=this.config.queries;0===a.length?(f.setStyle(this.tasksNode,"display","none"),f.setStyle(this.noQueryTipSection,"display","block")):l.forEach(a,c.hitch(this,function(a,b){B.dynamicUpdateConfigIcon(a,this.folderUrl+"css/images/default_task_icon.png");var c=a.name,d=f.toDom('\x3ctr role\x3d"button" tabindex\x3d"0" class\x3d"single-task"\x3e\x3ctd class\x3d"first-td"\x3e\x3cspan class\x3d"task-icon"\x3e\x3c/span\x3e\x3c/td\x3e\x3ctd class\x3d"second-td"\x3e\x3cdiv class\x3d"list-item-name task-name-div"\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e');
q(".task-name-div",d)[0].innerHTML=c;f.place(d,this.tasksTbody);var c=q("span.task-icon",d)[0],e=a.icon;if(e){var g=null;e.url||e.imageData?(e.setWidth(16),e.setHeight(16)):(g={width:17,height:17},e.setSize(16));e=t.createSymbolNode(e,g);f.place(e,c)}d.taskIndex=b;d.singleConfig=a;0===b%2?f.addClass(d,"even"):f.addClass(d,"odd")}))},_onTabHeaderClicked:function(a){a=a.target||a.srcElement;a===this.taskQueryItem?((a=this._getCurrentResultLayerInfo())&&(a=a.singleQueryResult)&&(a.singleRelatedRecordsResult||
a.multipleRelatedRecordsResult)&&a._showFeaturesResultDiv(),this._switchToTaskTab()):a===this.resultQueryItem&&this._switchToResultTab()},_onTabHeaderKeydown:function(a){var b=a.target||a.srcElement;a.keyCode===k.ENTER?this._onTabHeaderClicked(a):a.keyCode===k.LEFT_ARROW||a.keyCode===k.RIGHT_ARROW?(b===this.taskQueryItem?this.resultQueryItem:this.taskQueryItem).focus():a.keyCode===k.TAB&&(a.shiftKey?a.preventDefault():b===this.taskQueryItem&&"-1"===f.getAttr(this.taskQueryItem,"tabindex")&&(a.preventDefault(),
this._focusCurrentFirstNode()))},_switchToTaskTab:function(){f.removeClass(this.resultQueryItem,"selected");f.removeClass(this.resultTabView,"selected");f.addClass(this.taskQueryItem,"selected");f.addClass(this.taskTabView,"selected");f.setAttr(this.resultQueryItem,"tabindex","-1");f.setAttr(this.resultQueryItem,"aria-selected","false");f.setAttr(this.taskQueryItem,"tabindex","0");f.setAttr(this.taskQueryItem,"aria-selected","true");b.initFirstFocusNode(this.domNode,this.taskQueryItem)},_switchToResultTab:function(){this._updateResultDetailUI();
f.removeClass(this.taskQueryItem,"selected");f.removeClass(this.taskTabView,"selected");f.addClass(this.resultQueryItem,"selected");f.addClass(this.resultTabView,"selected");f.setAttr(this.taskQueryItem,"tabindex","-1");f.setAttr(this.taskQueryItem,"aria-selected","false");f.setAttr(this.resultQueryItem,"tabindex","0");f.setAttr(this.resultQueryItem,"aria-selected","true");this._updateFocusNodes("result");b.initFirstFocusNode(this.domNode,this.resultQueryItem)},_updateResultDetailUI:function(){0<
this._resultLayerInfos.length?(f.removeClass(this.resultSection,this.hiddenClass),f.addClass(this.noresultSection,this.hiddenClass)):(f.addClass(this.resultSection,this.hiddenClass),f.removeClass(this.noresultSection,this.hiddenClass),this.noresultSection.focus())},_showTaskListPane:function(){f.setStyle(this.taskList,"display","block");f.setStyle(this.taskSettingContainer,"display","none");this._switchToTaskTab()},_showTaskSettingPane:function(){f.setStyle(this.taskList,"display","none");f.setStyle(this.taskSettingContainer,
"display","block");this._switchToTaskTab()},_onTaskListClicked:function(a){(a=b.getAncestorDom(a.target||a.srcElement,c.hitch(this,function(a){return f.hasClass(a,"single-task")}),10))&&this._onClickTaskTr(a)},_onTaskListKeydown:function(a){a.keyCode!==k.ENTER&&a.keyCode!==k.SPACE||this._onClickTaskTr(a.target||a.srcElement)},_onClickTaskTr:function(a){this._getLayerInfoAndRelationshipLayerInfos(a).then(c.hitch(this,function(d){var e=d.layerInfo,g=d.layerObject,h=d.relationshipLayerInfos;d=d.relationshipPopupTemplates;
a.singleConfig.objectIdField=b.getObjectIdField(e);var l=this._getPopupInfo(e,a.singleConfig);l||console.error("can't get popupInfo");l.fieldInfos=B.getPortalFieldInfosWithoutShape(e,l.fieldInfos);delete l.readFromWebMap;var m=C.getCleanCurrentAttrsTemplate();m.queryTr=a;m.config=c.clone(a.singleConfig);m.config.popupInfo=l;m.layerInfo=e;m.layerObject=g;m.relationshipLayerInfos=h;m.relationshipPopupTemplates=d;m.query.maxRecordCount=e.maxRecordCount||1E3;m.queryType=B.getQueryType(e);this.currentTaskSetting&&
this.currentTaskSetting.destroy();this.currentTaskSetting=null;this._showTaskSettingPane();this.currentTaskSetting=new D({wId:this.id,nls:this.nls,map:this.map,showFilterLabel:this._showFilterLabel,criteiraLabel:this.config.criteiraLabel,spatialFilterLabel:this.config.spatialFilterLabel,currentAttrs:m,layerInfosObj:this.layerInfosObj,onBack:c.hitch(this,function(){this._showTaskListPane();this._focusCurrentFirstNode()}),onApply:c.hitch(this,function(a){this._onBtnApplyClicked(a)})});this.currentTaskSetting.canAutoRunning()&&
(this._switchToResultTab(),this.currentTaskSetting.run());this.currentTaskSetting.placeAt(this.taskSettingContainer);this._updateFocusNodes("taskSetting");this._focusCurrentFirstNode();this.own(n(this.currentTaskSetting.domNode,"keydown",c.hitch(this,function(a){a.keyCode===k.ESCAPE&&(a.stopPropagation(),f.hasClass(this.domNode,"only-one-task")||a.target===this.currentTaskSetting.backArrow?this.taskQueryItem.focus():this.currentTaskSetting.backArrow.focus())})))}),c.hitch(this,function(a){console.error("can't get layerInfo",
a)}))},_getLayerInfoAndServiceInfo:function(a){var b=new p,d=this._getLayerInfo(a),e=this._getServiceInfo(a);this.shelter.show();h([d,e]).then(c.hitch(this,function(c){this.domNode&&(this.shelter.hide(),a.layerInfo=c[0],a.serviceInfo=c[1],b.resolve({layerInfo:a.layerInfo,serviceInfo:a.serviceInfo}))}),c.hitch(this,function(a){console.error(a);if(this.domNode){this.shelter.hide();var c="";a&&403===a.httpCode&&(c=this.nls.noPermissionsMsg);this._showQueryErrorMsg(c);b.reject()}}));return b},_getLayerInfoAndRelationshipLayerInfos:function(a){var b=
new p;this.shelter.show();var d=this._getLayerInfo(a),e=B.tryGetLayerObject(a.singleConfig.webMapLayerId);h([d,e]).then(c.hitch(this,function(d){var e=d[0],g=d[1];a.layerInfo=e;a.layerObject=g;this._getRelationshipLayerInfos(a).then(c.hitch(this,function(c){if(this.domNode){a.relationshipLayerInfos=c;var d={},f=this.map.itemInfo.itemData,h=a.singleConfig.url.replace(/\d*\/*$/g,""),k;for(k in c){var l=B.getPopupInfoForRelatedLayer(f,h+k,c[k]);d[k]=new G(l)}this.shelter.hide();b.resolve({layerInfo:e,
layerObject:g,relationshipLayerInfos:c,relationshipPopupTemplates:d})}}),c.hitch(this,function(a){this.domNode&&(this.shelter.hide(),b.reject(a))}))}),c.hitch(this,function(a){this.domNode&&(this.shelter.hide(),b.reject(a))}));return b},_getLayerInfo:function(a){var b=new p;a.layerInfo?b.resolve(a.layerInfo):A({url:a.singleConfig.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(c.hitch(this,function(c){a.layerInfo=c;b.resolve(c)}),c.hitch(this,function(a){b.reject(a)}));
return b},_getServiceInfo:function(a){var b=new p;if(a.serviceInfo)b.resolve(a.serviceInfo);else{var d=this._getServiceUrlByLayerUrl(a.singleConfig.url);A({url:d,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(c.hitch(this,function(c){a.serviceInfo=c;b.resolve(c)}),c.hitch(this,function(a){b.reject(a)}))}return b},_getRelationshipLayerInfos:function(a){var b=new p;if(a.relationshipLayerInfos)b.resolve(a.relationshipLayerInfos);else{var d=a.layerInfo.relationships;if(d&&0<d.length){var e=
this._getServiceUrlByLayerUrl(a.singleConfig.url),g=l.map(d,c.hitch(this,function(a){return A({url:e+"/"+a.relatedTableId,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})}));h(g).then(c.hitch(this,function(e){a.relationshipLayerInfos={};l.forEach(d,c.hitch(this,function(b,c){a.relationshipLayerInfos[b.relatedTableId]=e[c]}));b.resolve(a.relationshipLayerInfos)}),c.hitch(this,function(c){a.relationshipLayerInfos=null;b.reject(c)}))}else a.relationshipLayerInfos={},b.resolve(a.relationshipLayerInfos)}return b},
_getServiceUrlByLayerUrl:function(a){var b=a.lastIndexOf("/");return a.slice(0,b)},_getPopupInfo:function(a,b){var d=null,e=B.getDefaultPopupInfo(a,!1,!1),d=e,d=null;b.popupInfo?b.popupInfo.readFromWebMap?b.webMapLayerId?(d=null,d=(d=B.isTable(a)?this.layerInfosObj.getTableInfoById(b.webMapLayerId):this.layerInfosObj.getLayerInfoById(b.webMapLayerId))?(d=d.getPopupInfo())?c.clone(d):e:e):d=e:(d=c.clone(b.popupInfo),delete d.readFromWebMap):d=b.popup?B.upgradePopupToPopupInfo(a,b.popup):e;d||(d=e);
d.showAttachments=!!a.hasAttachments;B.removePopupInfoUnsupportFields(a,d);return d},_onBtnApplyClicked:function(a){this.mapManager.enableWebMapPopup();f.addClass(this.resultTabView,this.hiddenClass);if(a.config.singleResultLayer){var d=this._getResultLayerInfosByTaskIndex(a.queryTr.taskIndex);0<d.length&&this._removeResultLayerInfos(d)}var e=this.currentTaskSetting.getQueryResultName(),e=b.sanitizeHTML(e);this._createNewResultLayer(a,e);this.shelter.show();var g=new J({map:this.map,nls:this.nls,
label:e,currentAttrs:a,queryWidget:this,onBack:c.hitch(this,function(){this._switchToResultTab()})});this.own(n(g,"show-related-records",c.hitch(this,this._onShowRelatedRecords)));this.own(n(g,"hide-related-records",c.hitch(this,this._onHideRelatedRecords)));this.own(n(g,"features-update",c.hitch(this,this._onFeaturesUpdate)));this.own(n(g,"features-layout-update",c.hitch(this,this._onFeaturesLayoutUpdate)));g.executeQueryForFirstTime().then(c.hitch(this,function(){this.domNode&&(this.shelter.hide(),
f.removeClass(this.resultTabView,this.hiddenClass),this._onSingleQueryFinished(g,e),this._updateResultDetailUI(),this.singleQueryResult=g,this._updateFocusNodes("result"),this._focusCurrentFirstNode())}),c.hitch(this,function(a){console.error(a);this.domNode&&(this.shelter.hide(),f.removeClass(this.resultTabView,this.hiddenClass))}))},_createNewResultLayer:function(a,b){var d=null,e=null,e=a.queryTr.taskIndex,d=c.clone(a.layerInfo);d.name=b;d.drawingInfo||(d.drawingInfo={});d.drawingInfo.transparency=
0;d.minScale=0;d.maxScale=0;d.effectiveMinScale=0;d.effectiveMaxScale=0;d.defaultVisibility=!0;delete d.extent;var f=(new C(this.map,a)).getOutputFields();d.fields=l.filter(d.fields,c.hitch(this,function(a){return 0<=f.indexOf(a.name)}));d=new F({layerDefinition:d,featureSet:null});d._queryWidgetTaskIndex=e;b=c.clone(a.config.popupInfo);e=new G(b);b.showAttachments&&B.overridePopupTemplateMethodGetAttachments(e,a.config.url,a.config.objectIdField);d.setInfoTemplate(e);a.query.resultLayer=d;B.isTable(a.layerInfo)||
a.config.useLayerSymbol||!a.config.resultsSymbol||(a=w.fromJson(a.config.resultsSymbol),e=new z(a),d.setRenderer(e));return d},_onSingleQueryFinished:function(a,c){this.currentTaskSetting.onGetQueryResponse();a.placeAt(this.singleResultDetails);this._hideAllSingleQueryResultDijits();this._switchToResultTab();f.setStyle(a.domNode,"display","block");var d=a.getCurrentAttrs().queryTr.taskIndex;a={value:b.getRandomString(),label:c,taskIndex:d,singleQueryResult:a};this._resultLayerInfos.push(a);this.resultLayersSelect.addOption({value:a.value,
label:a.label});this.resultLayersSelect.set("value",a.value);this._showResultLayerInfo(a);this._updateResultDetailUI()},_onResultLayerSelectChanged:function(){var a=this._getCurrentResultLayerInfo();a&&this._showResultLayerInfo(a)},_getCurrentResultLayerInfo:function(){var a=null,b=this.resultLayersSelect.get("value");b&&(a=this._getResultLayerInfoByValue(b));return a},_hideAllLayers:function(a){var b=this._getAllSingleQueryResultDijits();l.forEach(b,c.hitch(this,function(b){b&&b!==a&&b.hideLayer()}))},
_removeResultLayerInfosByTaskIndex:function(a){a=this._getResultLayerInfosByTaskIndex(a);this._removeResultLayerInfos(a)},_getResultLayerInfoByValue:function(a){var b=null;l.some(this._resultLayerInfos,c.hitch(this,function(c){return c.value===a?(b=c,!0):!1}));return b},_getResultLayerInfosByTaskIndex:function(a){var b=this._resultLayerInfos;return b=l.filter(b,c.hitch(this,function(b){return b.taskIndex===a}))},_removeResultLayerInfoByValues:function(a){var b=[];l.forEach(this._resultLayerInfos,
c.hitch(this,function(c,d){0<=a.indexOf(c.value)&&(b.push(d),c.singleQueryResult&&c.singleQueryResult.domNode&&c.singleQueryResult.destroy(),c.singleQueryResult=null)}));b.reverse();l.forEach(b,c.hitch(this,function(a){this._resultLayerInfos.splice(a,1)}));this.resultLayersSelect.removeOption(a);var d=this.resultLayersSelect.getOptions();d&&0<d.length?this.resultLayersSelect.set("value",d[0].value):"function"===typeof this.resultLayersSelect._setDisplay&&this.resultLayersSelect._setDisplay("");this._updateResultDetailUI()},
_removeResultLayerInfos:function(a){a=l.map(a,c.hitch(this,function(a){return a.value}));return this._removeResultLayerInfoByValues(a)},_getAllSingleQueryResultDijits:function(){var a=[];this._resultLayerInfos&&0<this._resultLayerInfos.length&&l.forEach(this._resultLayerInfos,c.hitch(this,function(b){b&&b.singleQueryResult&&a.push(b.singleQueryResult)}));return a},_hideAllSingleQueryResultDijits:function(){var a=this._getAllSingleQueryResultDijits();l.forEach(a,c.hitch(this,function(a){f.setStyle(a.domNode,
"display","none")}))},_showResultLayerInfo:function(a){this._hideAllSingleQueryResultDijits();a=a.singleQueryResult;this._hideAllLayers(a);a&&(f.setStyle(a.domNode,"display","block"),a.showLayer(),a.zoomToLayer())},removeSingleQueryResult:function(a){var b=null;l.some(this._resultLayerInfos,c.hitch(this,function(c){return c.singleQueryResult===a?(b=c.value,!0):!1}));null!==b&&this._removeResultLayerInfoByValues([b])},_onShowRelatedRecords:function(){f.addClass(this.resultLayersSelectDiv,this.hiddenClass)},
_onHideRelatedRecords:function(){f.removeClass(this.resultLayersSelectDiv,this.hiddenClass)},_onFeaturesUpdate:function(a){var b=a.taskIndex;a=a.features;try{this.updateDataSourceData(b,{features:a})}catch(u){console.error(u)}},_isImageServiceLayer:function(a){return-1<a.indexOf("/ImageServer")},_showQueryErrorMsg:function(a){new v({message:a||this.nls.queryError})},_hideInfoWindow:function(){this.map&&this.map.infoWindow&&(this.map.infoWindow.hide(),"function"===typeof this.map.infoWindow.setFeatures&&
this.map.infoWindow.setFeatures([]))}})});