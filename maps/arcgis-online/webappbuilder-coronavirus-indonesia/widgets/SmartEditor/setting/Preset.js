// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:widgets/SmartEditor/setting/Preset.html":'\x3cdiv class\x3d"esriCTPresetPopUpDiv"\x3e\r\n    \x3cdiv class\x3d"esriCTWrapper"\x3e\r\n        \x3cdiv style\x3d"width:50%; float:left;"\x3e\r\n            \x3cdiv class\x3d"esriCTPresetPopUpLabel"\x3e${nls.intersectionPage.groupNameLabel}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTPresetPopupdijitWrapper"\x3e\r\n                \x3cdiv class\x3d"esriCTPresetPopupdijit" style\x3d"width: 100%" data-dojo-attach-point\x3d"groupNameDiv"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv style\x3d"width:50%; float:left;"\x3e\r\n            \x3cdiv class\x3d"esriCTPresetPopUpLabel"\x3e${nls.intersectionPage.dataTypeLabel}\x3c/div\x3e\r\n            \x3cdiv class\x3d"esriCTPresetPopupdijitWrapper"\x3e\r\n                \x3cdiv class\x3d"esriCTPresetPopupdijit" style\x3d"width: 100%" data-dojo-attach-point\x3d"dataTypeDropdownDiv"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTRowContainer row esriCTHidden"\x3e\r\n        \x3cdiv style\x3d"width: 100%;" data-dojo-attach-point\x3d"showOnlyDomainFieldsNode" class\x3d"esriCTPresetPopUpLabel"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTWrapper"\x3e\r\n        \x3cfieldset class\x3d"esriCTFieldset"\x3e\r\n            \x3clegend class\x3d"esriCTLegendTitle"\x3e${nls.smartActionsPage.layerAndFieldsApplyLabel}\x3c/legend\x3e\r\n            \x3cdiv class\x3d"esriCTTableParentContainer" data-dojo-attach-point\x3d"tableParentContainer"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/fieldset\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTWrapper"\x3e\r\n        \x3cdiv class\x3d"esriCTPresetPopUpLabel"\x3e${nls.presetPopup.presetValueLAbel}\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriCTPresetPopupdijitWrapper" data-dojo-attach-point\x3d"presetValuedijitWrapper"\x3e\r\n            \x3cdiv class\x3d"esriCTPresetPopupdijit" style\x3d"width: 100%" data-dojo-attach-point\x3d"presetValueDiv"\x3e\r\n            \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"jimu-btn esriCTSelectValueBtn" data-dojo-attach-point\x3d"selectPresetValueBtn"\r\n            data-dojo-attach-event\x3d"onClick:_onSelectPresetValueButtonClick"\x3e${nls.chooseFromLayer.selectValueLabel}\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriCTRowContainer row"\x3e\r\n        \x3cdiv style\x3d"width: 100%;" data-dojo-attach-point\x3d"hideInPresetDisplayNode" class\x3d"esriCTPresetPopUpLabel"\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("dojo/_base/declare dojo/Evented dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/on dojo/mouse dojo/text!./Preset.html dijit/_TemplatedMixin jimu/BaseWidgetSetting jimu/dijit/Popup jimu/dijit/CheckBox dijit/form/Select dijit/form/ValidationTextBox ./ChooseFromLayer ./RelativeDates ./RelativeDomains dojo/dom-class dijit/form/NumberTextBox ./layersAndFieldsApplyOn ../presetUtils jimu/utils".split(" "),function(q,r,c,h,k,g,t,u,v,w,x,n,y,l,z,A,B,C,D,E,m,p){return q([w,r,v],{baseClass:"jimu-widget-smartEditor-setting-presetPopup",
templateString:u,groupNameTextBox:null,dataTypeDropdown:null,hasDomainField:null,presetValueDijitNode:null,presetValueTimeNode:null,_selectedRelativeDate:null,_selectedRelativeDomains:null,_selectedDomainFields:[],ValidFieldsByTypeToApplyOn:{esriFieldTypeInteger:["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],esriFieldTypeGUID:["esriFieldTypeGUID"],esriFieldTypeDate:["esriFieldTypeDate"],esriFieldTypeString:["esriFieldTypeString"]},_isSelectPresetValueButtonClicked:!1,
_isFirstTime:!0,postCreate:function(){this.inherited(arguments);this._isDomainField();this._initControls();this.isDelete||this.showDialog();this._isSelectPresetValueButtonClicked=!1;this._isFirstTime=!0},_initControls:function(){this.groupNameTextBox=new l({required:!0,trim:!0,style:{width:"100%"}});this.groupNameTextBox.placeAt(this.groupNameDiv);this.groupNameTextBox.validator=c.hitch(this,function(b){return b?b!==this.prevName&&this.editUtils.isDuplicateGroupName(b,this.existingGroupNames)?(this.groupNameTextBox.set("invalidMessage",
this.nls.smartActionsPage.uniqueGroupNameMsg),!1):!0:(this.groupNameTextBox.set("invalidMessage",this.nls.smartActionsPage.requiredGroupNameMsg),!1)});this.groupNameTextBox.startup();this.name&&this.groupNameTextBox.set("value",this.name);this.dataTypeDropdown=new y({options:this._addDataTypeOptions(),style:{width:"100%"}});this.own(g(this.dataTypeDropdown,"change",c.hitch(this,function(b){var a;this.chooseFromLayerInfo&&(this.chooseFromLayerInfo=null);this.showOnlyDomainFieldsCB.getValue()||"esriFieldTypeDate"!==
b||(this._selectedRelativeDate=a={dateType:"fixed"});this._createValueDijit(b,a,!0);this._domainTableData=[];this._enableDisablePresetValueDijit()})));this.dataTypeDropdown.placeAt(this.dataTypeDropdownDiv);this.dataTypeDropdown.startup();this.showOnlyDomainFieldsCB=new n({label:this.nls.presetPage.showOnlyDomainFields},k.create("div",{},this.showOnlyDomainFieldsNode));this.showOnlyDomainFields&&this.showOnlyDomainFieldsCB.setValue(!0);this.own(g(this.showOnlyDomainFieldsCB,"change",c.hitch(this,
function(b){var a,e=this.dataTypeDropdown.get("value");b||"esriFieldTypeDate"!==e||(this._selectedRelativeDate=a={dateType:"fixed"});this._createValueDijit(e,a,!0);this._createLayersAndFields(e,b)})));this.dataType&&(this.dataTypeDropdown.set("value",this.dataType,!1),this.showOnlyDomainFields?this._selectedRelativeDomains=this._domainTableData=this.presetValue:"esriFieldTypeDate"===this.dataType&&(this._selectedRelativeDate=this.presetValue),this._createValueDijit(this.dataType,this.presetValue,
!0));this.hideInPresetDisplayCB=new n({label:this.nls.presetPage.hideInPresetDisplay},k.create("div",{},this.hideInPresetDisplayNode));this.hideInPresetDisplay&&this.hideInPresetDisplayCB.setValue(!0)},_createValueDijit:function(b,a,e){var d;if(d=this.createDijitOnDataTypeChange(b))this.presetValueDijitNode=d,this.own(g(this.presetValueDijitNode.domNode,t.enter,c.hitch(this,function(){if(this._selectedRelativeDate&&"esriFieldTypeDate"===this.dataTypeDropdown.get("value")){var a=m.getDateFromRelativeInfo(this._selectedRelativeDate,
!0);""===a&&(a=this.nls.relativeDates.noDateDefinedTooltip);this.presetValueDijitNode.set("title",a)}else this.presetValueDijitNode.set("title",this.presetValueDijitNode.get("value"))}))),this.presetValueDijitNode.placeAt(this.presetValueDiv),this.presetValueDijitNode.startup(),this.own(g(this.presetValueDijitNode,"change",c.hitch(this,function(a){this._checkIfDomainFieldSelected()||"esriFieldTypeDate"===b||this._isSelectPresetValueButtonClicked||this._isFirstTime?this._isSelectPresetValueButtonClicked=
!1:this.chooseFromLayerInfo=null;this._isFirstTime=!1}))),a&&(this.showOnlyDomainFields?this.presetValueDijitNode.set("value",this._getDefaultDomain(a)):"esriFieldTypeDate"===b&&a.dateType?"fixed"===a.dateType?a.dateTime?this.presetValueDijitNode.set("value",m.getDateFromRelativeInfo(a,!0)):this.presetValueDijitNode.set("value",""):this.presetValueDijitNode.set("value",this.nls.relativeDates[a.dateType]):this.presetValueDijitNode.set("value",a)),e&&this._createLayersAndFields(b,!1)},_addDataTypeOptions:function(){return[{label:this.nls.dataType.esriFieldTypeString,
value:"esriFieldTypeString"},{label:this.nls.dataType.esriFieldTypeInteger,value:"esriFieldTypeInteger"},{label:this.nls.dataType.esriFieldTypeDate,value:"esriFieldTypeDate"},{label:this.nls.dataType.esriFieldTypeGUID,value:"esriFieldTypeGUID"}]},_isDomainField:function(){h.forEach(this._totalLayers,c.hitch(this,function(b){h.some(b.layerObject.fields,c.hitch(this,function(a){if(a.domain&&"codedValue"===a.domain.type)return this.hasDomainField=!0}))}))},_createLayerFieldsFilter:function(b,a){var e=
[],d={};h.forEach(this._totalLayers,c.hitch(this,function(f){(!f.isTable||f.isTable&&0<f.layerObject.relationships.length)&&h.forEach(f.layerObject.fields,c.hitch(this,function(c){this.ValidFieldsByTypeToApplyOn[b]&&(e=this.ValidFieldsByTypeToApplyOn[b],-1<e.indexOf(c.type)&&c.editable&&(!a||c.domain&&(!c.domain||"range"!==c.domain.type))&&(d[f.id]||(d[f.id]={}),d[f.id][c.name]=c))}))}));return d},_createLayersAndFields:function(b,a){this._layerAndFieldsApplyOnObj=new E({map:this.map,showDomainFieldIndicator:!0,
layerInfos:this.layerInfos,_configInfos:this._configInfos,actionName:"Preset",nls:this.nls,prevName:this.prevName,existingGroups:this.existingGroups,_configuredPresetInfos:this._configuredPresetInfos,layerDetails:this._createLayerFieldsFilter(b,a),appliedOn:this.appliedOn});k.empty(this.tableParentContainer);this._layerAndFieldsApplyOnObj.placeAt(this.tableParentContainer);this._layerAndFieldsApplyOnObj.startup();C.add(this._layerAndFieldsApplyOnObj.layerAndFieldsMainDiv,"esriCTOverrideForPreset");
g(this._layerAndFieldsApplyOnObj,"layerFieldsUpdated",c.hitch(this,function(a){this._fieldsToAppliedUpdated=!0;this.tableDomains=this._consolidateLayerDomains();this._domainTableData=this._createDomainData();this._checkIfDomainFieldSelected()||a||this._createValueDijit(this.dataTypeDropdown.get("value"),this.presetValueDijitNode.get("value"),!1);this._enableDisablePresetValueDijit(a)}))},_enableDisablePresetValueDijit:function(b){var a=this._checkIfDomainFieldSelected();this.presetValueDijitNode&&
(a||"esriFieldTypeDate"===this.dataTypeDropdown.get("value")?(this.presetValueDijitNode.set("disabled",!0),b=b?this.presetValue:this._domainTableData,b=this._getDefaultDomain(b),a&&this.presetValueDijitNode.set("value",b)):(this.presetValueDijitNode.set("disabled",!1),this.presetValueDijitNode.isValid()||this.presetValueDijitNode.set("value","")))},_isDomainValueSelected:function(){var b=!1,a;h.some(this._domainTableData,c.hitch(this,function(c){if(c.isDefault)return b=!0,a=c,!0}));return{isDomainSelected:b,
selectedDomain:a}},deleteGroup:function(){this._layerAndFieldsApplyOnObj.deleteGroup()},showDialog:function(){this.presetPopup=new x({titleLabel:this.nls.fieldsPage.fieldsSettingsTable.canPresetValue,width:950,maxHeight:600,autoHeight:!1,"class":this.baseClass,content:this,buttons:[{label:this.nls.ok,onClick:c.hitch(this,function(){var b=!0,a;a={};if(this.groupNameTextBox.isValid()){a.name=p.stripHTML(this.groupNameTextBox.get("value"));a.dataType=this.dataTypeDropdown.get("value");"esriFieldTypeGUID"===
a.dataType&&""===this.presetValueDijitNode.get("value")&&(b=!1);var e=this._checkIfDomainFieldSelected();!b||this.presetValueDijitNode.isValid()||e?(a.showOnlyDomainFields=e,a.hideInPresetDisplay=this.hideInPresetDisplayCB.getValue(),e&&this._domainTableData?a.presetValue=c.clone(this._domainTableData):"esriFieldTypeDate"===a.dataType?a.presetValue=c.clone(this._selectedRelativeDate):this.presetValueDijitNode&&(a.presetValue=this.presetValueDijitNode.get("value")),this.chooseFromLayerInfo&&(a.chooseFromLayerInfo=
this.chooseFromLayerInfo),a.appliedOn=this._layerAndFieldsApplyOnObj.getCheckedFields(a),this.emit("groupInfoUpdated",a),this.presetPopup.close()):this.presetValueDijitNode.focus()}else this.groupNameTextBox.focus()})},{label:this.nls.cancel,classNames:["jimu-btn-vacation"],onClick:c.hitch(this,function(){this.presetPopup.close()})}]})},createDijitOnDataTypeChange:function(b){k.empty(this.presetValueDiv);this.presetValueDijitNode=this.presetValueTimeNode=null;if(this._checkIfDomainFieldSelected()||
"esriFieldTypeDate"===b)b=new l({required:!1,disabled:!0,trim:!0,style:{width:"100%"}});else switch(b){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":case "esriFieldTypeSingle":case "esriFieldTypeDouble":b=new D({style:"width:100%"});break;case "esriFieldTypeGUID":b=new l({style:"width:100%"});b.validator=c.hitch(this,function(a){return""===a?!0:m.isGuid(a)});break;default:b=new l({required:!1,trim:!0,style:{width:"100%"}})}return b},_onSelectPresetValueButtonClick:function(){this._isSelectPresetValueButtonClicked=
!0;var b=this.dataTypeDropdown.get("value");this._checkIfDomainFieldSelected()?(this._relativeDomainsObj=new B({nls:this.nls,layerInfos:this.layerInfos,domainTableData:this._domainTableData,dataType:this.dataTypeDropdown.get("value"),_selectedRelativeDomains:this._selectedRelativeDomains,selectedDomainFields:this._selectedDomainFields}),this.own(g(this._relativeDomainsObj,"updatePresetValue",c.hitch(this,function(a){this._selectedRelativeDomains=this._domainTableData=a.domainData;this.presetValueDijitNode.set("value",
a.defaultValue)})))):"esriFieldTypeDate"===b?(this._relativeDatesObj=new A({nls:this.nls,relativeDates:this._selectedRelativeDate}),this.own(g(this._relativeDatesObj,"updatePresetValue",c.hitch(this,function(a){this._selectedRelativeDate=a;"fixed"===this._selectedRelativeDate.dateType?this._selectedRelativeDate.dateTime?this.presetValueDijitNode.set("value",m.getDateFromRelativeInfo(this._selectedRelativeDate,!0)):this.presetValueDijitNode.set("value",""):this.presetValueDijitNode.set("value",this.nls.relativeDates[a.dateType])})))):
(this.ChooseFromLayerObj=new z({map:this.map,nls:this.nls,allLayers:this._totalLayers,dataType:this.dataTypeDropdown.get("value"),layerInfos:this.layerInfos,chooseFromLayerInfo:this.chooseFromLayerInfo?this.chooseFromLayerInfo:null}),g(this.ChooseFromLayerObj,"updatePresetValue",c.hitch(this,function(a){this.chooseFromLayerInfo=a;this.presetValueDijitNode.set("value",a.selectedValue)})),g(this.ChooseFromLayerObj,"cancelButtonClicked",c.hitch(this,function(){this._isSelectPresetValueButtonClicked=
!1})))},_getDefaultDomain:function(b){var a="";h.some(b,c.hitch(this,function(b){if(b.isDefault)return a=b.label,!0}));return a},_consolidateLayerDomains:function(){var b=[],a,e,d,f={};e=this._layerAndFieldsApplyOnObj.getOnlyCheckedFields();this._selectedDomainFields=[];for(var g in e)d=this.layerInfos.getLayerOrTableInfoById(g),h.forEach(e[g],c.hitch(this,function(b){(a=d.layerObject.getField(b))&&a.domain&&a.domain.codedValues&&(b=p.getDefaultPortalFieldInfo(a),this._selectedDomainFields.push(b.label),
h.forEach(a.domain.codedValues,c.hitch(this,function(a){f.hasOwnProperty(a.code)?0>f[a.code].indexOf(a.name)&&f[a.code].push(a.name):(f[a.code]=[],f[a.code].push(a.name))})))}));for(var k in f)b.push({value:k,displayedLabel:f[k].join(" | ")});return b},_createDomainData:function(){var b=[];h.forEach(this._selectedRelativeDomains,c.hitch(this,function(a){for(var c,d=this.tableDomains.length-1;0<=d;d--)if(c=this.tableDomains[d].value,"esriFieldTypeString"!==this.dataTypeDropdown.get("value")&&(c=Number(c)),
a.value.toString()===c.toString()){b.push({showInList:a.showInList,value:this.tableDomains[d].value,label:this.tableDomains[d].displayedLabel,isDefault:a.isDefault});this.tableDomains.splice(d,1);break}}));h.forEach(this.tableDomains,c.hitch(this,function(a,c){b.push({showInList:!0,value:""+a.value+"",label:a.displayedLabel,isDefault:!1})}));return b},_checkIfDomainFieldSelected:function(){var b=!1;this._domainTableData&&(b=0<this._domainTableData.length?!0:!1);return b}})});